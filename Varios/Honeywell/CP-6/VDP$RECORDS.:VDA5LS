VERSION A05

PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:1    
        1        1        /*M* VDP$RDELETE:  Handle Accessor-to-Presenter "DELETE" calls.  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=4,IND=0,DCI=4,CSI=2,IAD=2,DTI=2,AND,ECI=0,DIN=2,STI=2 */
        8        8
        9        9        VDP$RDELETE: PROC ( DELETION_FID,
       10       10              DELETION_RANGE,
       11       11              FROM_PRESENTER )
       12       12              ALTRET;
       13       13
       14       14          %INCLUDE CP_6;
       15       95
       16       96            %B$TCB;
       17       99            %B$ALT;
       18      107    1     DCL B$TCB$ PTR SYMREF;
       19      108
       20      109          %FPT_DELREC;
       21      128
       22      129          %INCLUDE VD_MACROS_M;
       23     2344
       24     2345          %VD$NUMBER ( NAME = VD_$$MON_PRES,
       25     2346                       STCLASS = SYMREF );
       26     2391          %VD$NUMBER ( NAME = VD_$SCREEN,
       27     2392                       STCLASS = SYMREF );
       28     2437          %VD_6E ( STCLASS = SYMREF );
       29     2473    1     DCL VD_CURRENT_WINDOW$ PTR SYMREF;
       30     2474
       31     2475          %VD$KEY ( NAME = DELETION_FID,
       32     2476                    STCLASS = PARAM );
       33     2490          %VD$RANGE ( NAME = DELETION_RANGE,
       34     2491                      STCLASS = PARAM );
       35     2560    1     DCL FROM_PRESENTER BIT(1) ALIGNED PARAM;
       36     2561
       37     2562          %VD$KEY_NUMBER ( NAME = VD_KEY_MX_EDITKEY, STCLASS = SYMREF );
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:2    
       38     2577
       39     2578    1     DCL CURRENT_WINDOW$ PTR;
       40     2579    1     DCL DELETION_FID$ PTR;
       41     2580    1     DCL DELETION_FIRST_KEY$ PTR;
       42     2581    1     DCL DELETION_LAST_KEY$ PTR;
       43     2582    1     DCL FEP_FIRST_KEY UBIN;
       44     2583    1     DCL FEP_LAST_KEY UBIN;
       45     2584    1     DCL LEVEL_INDEX UBIN;
       46     2585    1     DCL RECORD_SET_FIRST_KEY$ PTR;
       47     2586    1     DCL RECORD_SET_LAST_KEY$ PTR;
       48     2587    1     DCL VD_ERR$ PTR;
       49     2588    1     DCL WINDOW$ PTR;
       50     2589    1     DCL WINDOW_FID$ PTR;
       51     2590
       52     2591          %VD$BLOCK_DESC;
       53     2738          %VD$BUFFER;
       54     2796          %VD$ERR ( STCLASS = "BASED ( VD_ERR$ )" );
       55     2849          %VD$FILE_NODE;
       56     2942          %VD$PORT;
       57     3040          %VD$RECORD_SET;
       58     3118          %VD$STREAM;
       59     3224          %VD$TEXTC;
       60     3247          %VD$TEXTC_NUMBER;
       61     3261          %VD$TEXTC_REMOTE;
       62     3322          %VD$WINDOW_SPEC ( NAME = WINDOW$SPEC,
       63     3323                            STCLASS = "BASED ( CURRENT_WINDOW$ )" );
       64     3389
       65     3390    1     DCL VDG$MPRES_FEPDELREC ENTRY (3);
       66     3391    1     DCL VDG$MPRES_RDELETE ENTRY (3);
       67     3392    1     DCL VDG$MONERR ENTRY ALTRET;
       68     3393    1     DCL VDP$WERASE ENTRY (1) ALTRET;
       69     3394    1     DCL VDP$WSCROLL_UP ENTRY (6) ALTRET;
       70     3395        %EJECT;
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:3    
       71     3396    1       IF VD_$$MON_PRES.V# > 0
       72     3397    1       THEN
       73     3398    1         CALL VDG$MPRES_RDELETE ( DELETION_FID,
       74     3399    1           DELETION_RANGE,
       75     3400    1           FROM_PRESENTER );
       76     3401
       77     3402    1       IF VD_$SCREEN.V# < %MN_SCREEN_EDITING_HEIGHT
       78     3403    1       THEN
       79     3404    1         RETURN;
       80     3405
       81     3406    1   FIND_LOWEST_LEVEL:
       82     3407    2       DO LEVEL_INDEX = 0 TO %MX_LOCATION_LEVELS - 1;
       83     3408    2         IF DELETION_RANGE.START.KEY ( LEVEL_INDEX ) = %CLEAR
       84     3409    2         THEN
       85     3410    2           EXIT FIND_LOWEST_LEVEL;
       86     3411    2       END FIND_LOWEST_LEVEL;
       87     3412
       88     3413            %GETKEY ( KEY = "DELETION_RANGE.START.KEY",
       89     3414            INDX = "LEVEL_INDEX - 1",
       90     3415            PTR = DELETION_FIRST_KEY$ );
       91     3425
       92     3426    1       IF DELETION_RANGE.ENDD.EOF
       93     3427    1       THEN
       94     3428    2         DO;
       95     3429    2           DELETION_LAST_KEY$ = ADDR ( VD_KEY_MX_EDITKEY.LENGTH# );
       96     3430    2         END;
       97     3431    1       ELSE
       98     3432    2         DO;
       99     3433                %GETKEY ( KEY = "DELETION_RANGE.ENDD.KEY",
      100     3434                INDX = "LEVEL_INDEX - 1",
      101     3435                PTR = DELETION_LAST_KEY$ );
      102     3445    2         END;
      103     3446
      104     3447            %GETKEY ( KEY = "DELETION_FID",
      105     3448            PTR = DELETION_FID$ );
      106     3458
      107     3459    1       WINDOW$ = VD_6E.WINDOWS$ -> VD$STREAM.PORT$ ->
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:4    
      108     3460    1         VD$PORT.LEVEL.INTERNAL$ ( %LVL_FILE ) -> VD$FILE_NODE.HEAD$;
      109     3461
      110     3462    1   CHECK_ALL_THE_WINDOWS:
      111     3463    2       DO WHILE ( WINDOW$ ~= ADDR (NIL) );
      112     3464
      113     3465              /*  If we were called FROM_PRESENTER,
      114     3466                  and this VD$FILE_NODE is the VD_CURRENT_WINDOW$,
      115     3467                  skip it.  */
      116     3468    2         IF ADDR ( FROM_PRESENTER ) ~= ADDR ( NIL )
      117     3469    2         THEN
      118     3470    2           IF FROM_PRESENTER
      119     3471    2             AND WINDOW$ = VD_CURRENT_WINDOW$
      120     3472    2           THEN
      121     3473    2             GOTO NEXT_FILE_NODE_PLEASE;
      122     3474
      123     3475    2         CURRENT_WINDOW$ = WINDOW$ -> VD$FILE_NODE.DESC.SPEC.V$;
      124     3476
      125     3477              /*  If this is the command window,
      126     3478                  or if it has no EDIT_BLOCK,
      127     3479                  skip it.  */
      128     3480    2         IF NOT WINDOW$SPEC.COMMAND
      129     3481    2           AND WINDOW$SPEC.OPERAND.EDIT_BLOCK$ ~= ADDR (NIL)
      130     3482    2         THEN
      131     3483    2   CHECK_THIS_WINDOW:
      132     3484    3           DO;
      133     3485                  %GETKEY ( KEY =
              3485                      "WINDOW$SPEC.OPERAND.EDIT_BLOCK$ -> VD$BLOCK_DESC.FILE_KEY",
      134     3486                  PTR = WINDOW_FID$ );
      135     3496
      136     3497    3             IF DELETION_FID$ -> VD$TEXTC = WINDOW_FID$ -> VD$TEXTC
      137     3498    3             THEN
      138     3499    3   COMPARE_RANGE_W_WINDOW:
      139     3500    4               DO;
      140     3501
      141     3502                      /*  RDELETE, as opposed to, say, RWRITE,
      142     3503                          doesn't check for BOB and/or EOB_DISPLAYED.
      143     3504                          The current thinking is:  "If it ain't out there,
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:5    
      144     3505                          don't delete it."  This may change.  */
      145     3506    4                 IF WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.N_ENTRIES# = 0
      146     3507    4                 THEN
      147     3508    4                   GOTO NEXT_FILE_NODE_PLEASE;
      148     3509
      149     3510                      %GETKEY ( KEY = "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.DESC.KEY",
      150     3511                      INDX = 0,
      151     3512                      PTR = RECORD_SET_FIRST_KEY$ );
      152     3522                      %GETKEY ( KEY = "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.DESC.KEY",
      153     3523                      INDX = "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.N_ENTRIES# - 1",
      154     3524                      PTR = RECORD_SET_LAST_KEY$ );
      155     3534
      156     3535                      /*  If the any keys to delete
      157     3536                          lie within the record set...  */
      158     3537    4                 IF DELETION_FIRST_KEY$ -> VD$TEXTC.BYTES <=
      159     3538    4                   RECORD_SET_LAST_KEY$ -> VD$TEXTC.BYTES
      160     3539    4                   AND DELETION_LAST_KEY$ -> VD$TEXTC.BYTES >=
      161     3540    4                   RECORD_SET_FIRST_KEY$ -> VD$TEXTC.BYTES
      162     3541                      /*  ...then delete the range.  */
      163     3542    4                 THEN
      164     3543    4   DELETE_THE_RANGE:
      165     3544    5                   DO;
      166     3545
      167     3546    5                     IF WINDOW$SPEC.RECORD_SET$ ->
      168     3547    5                       VD$RECORD_SET.DESC.KEY.TYPE#(0) = %KT_STRING
      169     3548    5                     THEN
      170     3549    6                       DO;
      171     3550    6                         CALL VDP$WERASE (WINDOW$SPEC) ALTRET (RETALT);
      172     3551    6                         RETURN;
      173     3552    6                       END;
      174     3553
      175     3554    5                     WINDOW$SPEC.SCREEN_UPDATED = %FALSE;
      176     3555    5                     FPT_DELREC.V.DCB# = WINDOW$SPEC.DCB#;
      177     3556
      178     3557    5                     FPT_DELREC.KEY_ = VECTOR ( FEP_FIRST_KEY );
      179     3558    5                     FPT_DELREC.LKEY_ = VECTOR ( FEP_LAST_KEY );
      180     3559    5                     FEP_FIRST_KEY = DELETION_FIRST_KEY$ -> VD$TEXTC_NUMBER.BYTES#;
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:6    
      181     3560    5                     FEP_LAST_KEY = DELETION_LAST_KEY$ -> VD$TEXTC_NUMBER.BYTES#;
      182     3561    5                     IF VD_$$MON_PRES.V# > 0
      183     3562    5                     THEN
      184     3563    5                       CALL VDG$MPRES_FEPDELREC ( WINDOW$SPEC.DCB#,
      185     3564    5                         DELETION_RANGE.START.KEY ( LEVEL_INDEX - 1 ),
      186     3565    5                         DELETION_RANGE.ENDD.KEY ( LEVEL_INDEX - 1 ) );
      187     3566
      188     3567    5                     CALL M$DELREC ( FPT_DELREC )
      189     3568    5                     WHENALTRETURN
      190     3569    6                       DO;
      191     3570    6                         CALL VDG$MONERR;
      192     3571    6                         GOTO RETALT;
      193     3572    6                       END;
      194     3573
      195     3574                          /*  For the RECORD_SET:
      196     3575                              call VDP$WSCROLL_UP to scroll up by whatever
      197     3576                              part of the deleted range lies in this window.  */
      198     3577    5                     CALL VDP$WSCROLL_UP ( WINDOW$SPEC,
      199     3578    5                       /* no scroll_key */,
      200     3579    5                       /* no scroll_spec */,
      201     3580    5                       /* no scroll_data */,
      202     3581    5                       DELETION_RANGE.START.KEY ( LEVEL_INDEX - 1 ),
      203     3582    5                       DELETION_RANGE.ENDD.KEY ( LEVEL_INDEX - 1 ) )
      204     3583    5                     WHENALTRETURN
      205     3584    6                       DO;
      206     3585    6   RETALT:               ;
      207     3586    6                         ALTRETURN;
      208     3587    6                       END;
      209     3588
      210     3589    5                   END DELETE_THE_RANGE;
      211     3590
      212     3591    4               END COMPARE_RANGE_W_WINDOW;
      213     3592
      214     3593    3           END CHECK_THIS_WINDOW;
      215     3594
      216     3595    2   NEXT_FILE_NODE_PLEASE:
      217     3596    2         WINDOW$ = WINDOW$ -> VD$FILE_NODE.FLINK$;
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:7    
      218     3597
      219     3598    2       END CHECK_ALL_THE_WINDOWS;
      220     3599
      221     3600    1       RETURN;
      222     3601
      223     3602    1   END VDP$RDELETE;
      224     3603        %EOD;

PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:8    
--  Include file information  --

   VD_MACROS_M.:VDA5TOU  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E04TOU  was found in the system file and is never referenced.
   CP_6_C.:E04TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure VDP$RDELETE.

   Procedure VDP$RDELETE requires 261 words for executable code.
   Procedure VDP$RDELETE requires 24 words of local(AUTO) storage.

PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:9    

 Object Unit name= VDP$RDELETE                                File name= VDP$RECORDS.:VDA5TOU
 UTS= JUL 04 '97 11:37:30.32 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none    10     12  VDP$RDELETE
    2   Proc  even  none   261    405  VDP$RDELETE
    3  RoData even  none     3      3  VDP$RDELETE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        3  VDP$RDELETE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       3 VDG$MPRES_RDELETE
 yes     yes           Std       1 VDP$WERASE
         yes           Std       3 VDG$MPRES_FEPDELREC
 yes     yes           Std       0 VDG$MONERR
 yes     yes           Std       6 VDP$WSCROLL_UP
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:10   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  VD_$$MON_PRES                         VD_$SCREEN
     VD_6E                                 VD_CURRENT_WINDOW$                    VD_KEY_MX_EDITKEY
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:11   


        1        1        /*M* VDP$RDELETE:  Handle Accessor-to-Presenter "DELETE" calls.  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=4,IND=0,DCI=4,CSI=2,IAD=2,DTI=2,AND,ECI=0,DIN=2,STI=2 */
        8        8
        9        9        VDP$RDELETE: PROC ( DELETION_FID,

      9  2 000000   000000 700200 xent  VDP$RDELETE  TSX0  ! X66_AUTO_3
         2 000001   000030 000003                    ZERO    24,3

       10       10              DELETION_RANGE,
       11       11              FROM_PRESENTER )
       12       12              ALTRET;
       13       13
       14       14          %INCLUDE CP_6;
       15       95
       16       96            %B$TCB;
       17       99            %B$ALT;
       18      107    1     DCL B$TCB$ PTR SYMREF;
       19      108
       20      109          %FPT_DELREC;
       21      128
       22      129          %INCLUDE VD_MACROS_M;
       23     2344
       24     2345          %VD$NUMBER ( NAME = VD_$$MON_PRES,
       25     2346                       STCLASS = SYMREF );
       26     2391          %VD$NUMBER ( NAME = VD_$SCREEN,
       27     2392                       STCLASS = SYMREF );
       28     2437          %VD_6E ( STCLASS = SYMREF );
       29     2473    1     DCL VD_CURRENT_WINDOW$ PTR SYMREF;
       30     2474
       31     2475          %VD$KEY ( NAME = DELETION_FID,
       32     2476                    STCLASS = PARAM );
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:12   
       33     2490          %VD$RANGE ( NAME = DELETION_RANGE,
       34     2491                      STCLASS = PARAM );
       35     2560    1     DCL FROM_PRESENTER BIT(1) ALIGNED PARAM;
       36     2561
       37     2562          %VD$KEY_NUMBER ( NAME = VD_KEY_MX_EDITKEY, STCLASS = SYMREF );
       38     2577
       39     2578    1     DCL CURRENT_WINDOW$ PTR;
       40     2579    1     DCL DELETION_FID$ PTR;
       41     2580    1     DCL DELETION_FIRST_KEY$ PTR;
       42     2581    1     DCL DELETION_LAST_KEY$ PTR;
       43     2582    1     DCL FEP_FIRST_KEY UBIN;
       44     2583    1     DCL FEP_LAST_KEY UBIN;
       45     2584    1     DCL LEVEL_INDEX UBIN;
       46     2585    1     DCL RECORD_SET_FIRST_KEY$ PTR;
       47     2586    1     DCL RECORD_SET_LAST_KEY$ PTR;
       48     2587    1     DCL VD_ERR$ PTR;
       49     2588    1     DCL WINDOW$ PTR;
       50     2589    1     DCL WINDOW_FID$ PTR;
       51     2590
       52     2591          %VD$BLOCK_DESC;
       53     2738          %VD$BUFFER;
       54     2796          %VD$ERR ( STCLASS = "BASED ( VD_ERR$ )" );
       55     2849          %VD$FILE_NODE;
       56     2942          %VD$PORT;
       57     3040          %VD$RECORD_SET;
       58     3118          %VD$STREAM;
       59     3224          %VD$TEXTC;
       60     3247          %VD$TEXTC_NUMBER;
       61     3261          %VD$TEXTC_REMOTE;
       62     3322          %VD$WINDOW_SPEC ( NAME = WINDOW$SPEC,
       63     3323                            STCLASS = "BASED ( CURRENT_WINDOW$ )" );
       64     3389
       65     3390    1     DCL VDG$MPRES_FEPDELREC ENTRY (3);
       66     3391    1     DCL VDG$MPRES_RDELETE ENTRY (3);
       67     3392    1     DCL VDG$MONERR ENTRY ALTRET;
       68     3393    1     DCL VDP$WERASE ENTRY (1) ALTRET;
       69     3394    1     DCL VDP$WSCROLL_UP ENTRY (6) ALTRET;
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:13   
       70     3395        %EJECT;
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:14   
       71     3396    1       IF VD_$$MON_PRES.V# > 0

   3396  2 000002   000003 235000 xsym               LDA     VD_$$MON_PRES+3
         2 000003   000010 604400 2                  TMOZ    s:3402

       72     3397    1       THEN
       73     3398    1         CALL VDG$MPRES_RDELETE ( DELETION_FID,

   3398  2 000004   200003 630500                    EPPR0   @DELETION_FID,,AUTO
         2 000005   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000006   000000 701000 xent               TSX1    VDG$MPRES_RDELETE
         2 000007   000000 011000                    NOP     0

       74     3399    1           DELETION_RANGE,
       75     3400    1           FROM_PRESENTER );
       76     3401
       77     3402    1       IF VD_$SCREEN.V# < %MN_SCREEN_EDITING_HEIGHT

   3402  2 000010   000003 235000 xsym               LDA     VD_$SCREEN+3
         2 000011   000003 115007                    CMPA    3,DL
         2 000012   000014 605000 2                  TPL     FIND_LOWEST_LEVEL

       78     3403    1       THEN
       79     3404    1         RETURN;

   3404  2 000013   000000 702200 xent               TSX2  ! X66_ARET

       80     3405
       81     3406    1   FIND_LOWEST_LEVEL:
       82     3407    2       DO LEVEL_INDEX = 0 TO %MX_LOCATION_LEVELS - 1;

   3407  2 000014   200014 450100       FIND_LOWEST* STZ     LEVEL_INDEX,,AUTO
         2 000015   000030 710000 2                  TRA     s:3411+3

       83     3408    2         IF DELETION_RANGE.START.KEY ( LEVEL_INDEX ) = %CLEAR

   3408  2 000016   200014 235100                    LDA     LEVEL_INDEX,,AUTO
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:15   
         2 000017   000003 735000                    ALS     3
         2 000020   200004 470500                    LDP0    @DELETION_RANGE,,AUTO
         2 000021   000000 106505                    CMPC    fill='000'O
         2 000022   000000 000010                    ADSC9   0,A,PR0                  cn=0,n=8
         2 000023   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
         2 000024   000033 600000 2                  TZE     s:3422

       84     3409    2         THEN
       85     3410    2           EXIT FIND_LOWEST_LEVEL;
       86     3411    2       END FIND_LOWEST_LEVEL;

   3411  2 000025   200014 236100                    LDQ     LEVEL_INDEX,,AUTO
         2 000026   000001 036007                    ADLQ    1,DL
         2 000027   200014 756100                    STQ     LEVEL_INDEX,,AUTO
         2 000030   200014 235100                    LDA     LEVEL_INDEX,,AUTO
         2 000031   000004 115007                    CMPA    4,DL
         2 000032   000016 602000 2                  TNC     s:3408

       87     3412
       88     3413            %GETKEY ( KEY = "DELETION_RANGE.START.KEY",
       89     3414            INDX = "LEVEL_INDEX - 1",
       90     3415            PTR = DELETION_FIRST_KEY$ );

   3422  2 000033   200014 235100                    LDA     LEVEL_INDEX,,AUTO
         2 000034   000001 735000                    ALS     1
         2 000035   200004 470500                    LDP0    @DELETION_RANGE,,AUTO
         2 000036   077776 720105                    LXL0    -2,AL,PR0
         2 000037   000002 100003                    CMPX0   2,DU
         2 000040   000045 601000 2                  TNZ     s:3422+10

   3422  2 000041   077777 471505                    LDP1    -1,AL,PR0
         2 000042   100002 633500                    EPPR3   2,,PR1
         2 000043   200010 453500                    STP3    DELETION_FIRST_KEY$,,AUTO
         2 000044   000052 710000 2                  TRA     s:3426

   3422  2 000045   200014 236100                    LDQ     LEVEL_INDEX,,AUTO
         2 000046   000023 736000                    QLS     19
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:16   
         2 000047   000001 136003                    SBLQ    1,DU
         2 000050   200004 036100                    ADLQ    @DELETION_RANGE,,AUTO
         2 000051   200010 756100                    STQ     DELETION_FIRST_KEY$,,AUTO

       91     3425
       92     3426    1       IF DELETION_RANGE.ENDD.EOF

   3426  2 000052   000021 236100                    LDQ     17,,PR0
         2 000053   400000 316007                    CANQ    -131072,DL
         2 000054   000060 600000 2                  TZE     s:3442

       93     3427    1       THEN
       94     3428    2         DO;

       95     3429    2           DELETION_LAST_KEY$ = ADDR ( VD_KEY_MX_EDITKEY.LENGTH# );

   3429  2 000055   000000 236000 3                  LDQ     0
         2 000056   200011 756100                    STQ     DELETION_LAST_KEY$,,AUTO

       96     3430    2         END;

   3430  2 000057   000074 710000 2                  TRA     s:3455

       97     3431    1       ELSE
       98     3432    2         DO;

       99     3433                %GETKEY ( KEY = "DELETION_RANGE.ENDD.KEY",
      100     3434                INDX = "LEVEL_INDEX - 1",
      101     3435                PTR = DELETION_LAST_KEY$ );

   3442  2 000060   000007 721105                    LXL1    7,AL,PR0
         2 000061   000002 101003                    CMPX1   2,DU
         2 000062   000067 601000 2                  TNZ     s:3442+7

   3442  2 000063   000010 471505                    LDP1    8,AL,PR0
         2 000064   100002 633500                    EPPR3   2,,PR1
         2 000065   200011 453500                    STP3    DELETION_LAST_KEY$,,AUTO
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:17   
         2 000066   000074 710000 2                  TRA     s:3455

   3442  2 000067   200014 236100                    LDQ     LEVEL_INDEX,,AUTO
         2 000070   000023 736000                    QLS     19
         2 000071   000010 036003                    ADLQ    8,DU
         2 000072   200004 036100                    ADLQ    @DELETION_RANGE,,AUTO
         2 000073   200011 756100                    STQ     DELETION_LAST_KEY$,,AUTO

      102     3445    2         END;

      103     3446
      104     3447            %GETKEY ( KEY = "DELETION_FID",
      105     3448            PTR = DELETION_FID$ );

   3455  2 000074   200003 471500                    LDP1    @DELETION_FID,,AUTO
         2 000075   100000 721100                    LXL1    0,,PR1
         2 000076   000002 101003                    CMPX1   2,DU
         2 000077   000104 601000 2                  TNZ     s:3455+8

   3455  2 000100   100001 473500                    LDP3    1,,PR1
         2 000101   300002 634500                    EPPR4   2,,PR3
         2 000102   200007 454500                    STP4    DELETION_FID$,,AUTO
         2 000103   000107 710000 2                  TRA     s:3459

   3455  2 000104   200003 236100                    LDQ     @DELETION_FID,,AUTO
         2 000105   000001 036003                    ADLQ    1,DU
         2 000106   200007 756100                    STQ     DELETION_FID$,,AUTO

      106     3458
      107     3459    1       WINDOW$ = VD_6E.WINDOWS$ -> VD$STREAM.PORT$ ->

   3459  2 000107   000006 473400 xsym               LDP3    VD_6E+6
         2 000110   300001 474500                    LDP4    1,,PR3
         2 000111   400031 475500                    LDP5    25,,PR4
         2 000112   500012 236100                    LDQ     10,,PR5
         2 000113   200020 756100                    STQ     WINDOW$,,AUTO

PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:18   
      108     3460    1         VD$PORT.LEVEL.INTERNAL$ ( %LVL_FILE ) -> VD$FILE_NODE.HEAD$;
      109     3461
      110     3462    1   CHECK_ALL_THE_WINDOWS:
      111     3463    2       DO WHILE ( WINDOW$ ~= ADDR (NIL) );

   3463  2 000114   000402 710000 2     CHECK_ALL_T* TRA     s:3598

      112     3464
      113     3465              /*  If we were called FROM_PRESENTER,
      114     3466                  and this VD$FILE_NODE is the VD_CURRENT_WINDOW$,
      115     3467                  skip it.  */
      116     3468    2         IF ADDR ( FROM_PRESENTER ) ~= ADDR ( NIL )

   3468  2 000115   200005 236100                    LDQ     @FROM_PRESENTER,,AUTO
         2 000116   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000117   000126 600000 2                  TZE     s:3475

      117     3469    2         THEN
      118     3470    2           IF FROM_PRESENTER

   3470  2 000120   200005 470500                    LDP0    @FROM_PRESENTER,,AUTO
         2 000121   000000 234100                    SZN     0,,PR0
         2 000122   000126 605000 2                  TPL     s:3475
         2 000123   200020 236100                    LDQ     WINDOW$,,AUTO
         2 000124   000000 116000 xsym               CMPQ    VD_CURRENT_WINDOW$
         2 000125   000377 600000 2                  TZE     NEXT_FILE_NODE_PLEASE

      119     3471    2             AND WINDOW$ = VD_CURRENT_WINDOW$
      120     3472    2           THEN
      121     3473    2             GOTO NEXT_FILE_NODE_PLEASE;
      122     3474
      123     3475    2         CURRENT_WINDOW$ = WINDOW$ -> VD$FILE_NODE.DESC.SPEC.V$;

   3475  2 000126   200020 470500                    LDP0    WINDOW$,,AUTO
         2 000127   000007 236100                    LDQ     7,,PR0
         2 000130   200006 756100                    STQ     CURRENT_WINDOW$,,AUTO

PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:19   
      124     3476
      125     3477              /*  If this is the command window,
      126     3478                  or if it has no EDIT_BLOCK,
      127     3479                  skip it.  */
      128     3480    2         IF NOT WINDOW$SPEC.COMMAND

   3480  2 000131   200006 471500                    LDP1    CURRENT_WINDOW$,,AUTO
         2 000132   100002 236100                    LDQ     2,,PR1
         2 000133   000400 316003                    CANQ    256,DU
         2 000134   000377 601000 2                  TNZ     NEXT_FILE_NODE_PLEASE
         2 000135   100012 236100                    LDQ     10,,PR1
         2 000136   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000137   000377 600000 2                  TZE     NEXT_FILE_NODE_PLEASE

      129     3481    2           AND WINDOW$SPEC.OPERAND.EDIT_BLOCK$ ~= ADDR (NIL)
      130     3482    2         THEN
      131     3483    2   CHECK_THIS_WINDOW:
      132     3484    3           DO;

   3484  2 000140                       CHECK_THIS_* null
      133     3485                  %GETKEY ( KEY =
              3485                      "WINDOW$SPEC.OPERAND.EDIT_BLOCK$ -> VD$BLOCK_DESC.FILE_KEY",
      134     3486                  PTR = WINDOW_FID$ );

   3493  2 000140   100012 473500                    LDP3    10,,PR1
         2 000141   300001 720100                    LXL0    1,,PR3
         2 000142   000002 100003                    CMPX0   2,DU
         2 000143   000150 601000 2                  TNZ     s:3493+4

   3493  2 000144   300002 474500                    LDP4    2,,PR3
         2 000145   400002 635500                    EPPR5   2,,PR4
         2 000146   200021 455500                    STP5    WINDOW_FID$,,AUTO
         2 000147   000152 710000 2                  TRA     s:3497

   3493  2 000150   300002 634500                    EPPR4   2,,PR3
         2 000151   200021 454500                    STP4    WINDOW_FID$,,AUTO

PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:20   
      135     3496
      136     3497    3             IF DELETION_FID$ -> VD$TEXTC = WINDOW_FID$ -> VD$TEXTC

   3497  2 000152   200007 474500                    LDP4    DELETION_FID$,,AUTO
         2 000153   400000 236100                    LDQ     0,,PR4
         2 000154   000033 772000                    QRL     27
         2 000155   000001 621006                    EAX1    1,QL
         2 000156   200021 475500                    LDP5    WINDOW_FID$,,AUTO
         2 000157   500000 236100                    LDQ     0,,PR5
         2 000160   000033 772000                    QRL     27
         2 000161   000001 622006                    EAX2    1,QL
         2 000162   000140 106540                    CMPC    fill='000'O
         2 000163   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1
         2 000164   500000 000012                    ADSC9   0,,PR5                   cn=0,n=*X2
         2 000165   000377 601000 2                  TNZ     NEXT_FILE_NODE_PLEASE

      137     3498    3             THEN
      138     3499    3   COMPARE_RANGE_W_WINDOW:
      139     3500    4               DO;

   3500  2 000166                       COMPARE_RAN* null
      140     3501
      141     3502                      /*  RDELETE, as opposed to, say, RWRITE,
      142     3503                          doesn't check for BOB and/or EOB_DISPLAYED.
      143     3504                          The current thinking is:  "If it ain't out there,
      144     3505                          don't delete it."  This may change.  */
      145     3506    4                 IF WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.N_ENTRIES# = 0

   3506  2 000166   100016 476500                    LDP6    14,,PR1
         2 000167   600002 223100                    LDX3    2,,PR6
         2 000170   000377 600000 2                  TZE     NEXT_FILE_NODE_PLEASE

      146     3507    4                 THEN
      147     3508    4                   GOTO NEXT_FILE_NODE_PLEASE;
      148     3509
      149     3510                      %GETKEY ( KEY = "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.DESC.KEY",
      150     3511                      INDX = 0,
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:21   
      151     3512                      PTR = RECORD_SET_FIRST_KEY$ );

   3519  2 000171   600003 724100                    LXL4    3,,PR6
         2 000172   000002 104003                    CMPX4   2,DU
         2 000173   000200 601000 2                  TNZ     s:3519+7

   3519  2 000174   600004 477500                    LDP7    4,,PR6
         2 000175   700002 630500                    EPPR0   2,,PR7
         2 000176   200015 450500                    STP0    RECORD_SET_FIRST_KEY$,,AUTO
         2 000177   000202 710000 2                  TRA     s:3531

   3519  2 000200   600004 637500                    EPPR7   4,,PR6
         2 000201   200015 457500                    STP7    RECORD_SET_FIRST_KEY$,,AUTO

      152     3522                      %GETKEY ( KEY = "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.DESC.KEY",
      153     3523                      INDX = "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.N_ENTRIES# - 1",
      154     3524                      PTR = RECORD_SET_LAST_KEY$ );

   3531  2 000202   600002 236100                    LDQ     2,,PR6
         2 000203   000022 732000                    QRS     18
         2 000204   000006 402007                    MPY     6,DL
         2 000205   677775 725106                    LXL5    -3,QL,PR6
         2 000206   000002 105003                    CMPX5   2,DU
         2 000207   000217 601000 2                  TNZ     s:3531+13

   3531  2 000210   600002 236100                    LDQ     2,,PR6
         2 000211   000022 732000                    QRS     18
         2 000212   000006 402007                    MPY     6,DL
         2 000213   677776 470506                    LDP0    -2,QL,PR6
         2 000214   000002 637500                    EPPR7   2,,PR0
         2 000215   200016 457500                    STP7    RECORD_SET_LAST_KEY$,,AUTO
         2 000216   000224 710000 2                  TRA     s:3537

   3531  2 000217   600002 236100                    LDQ     2,,PR6
         2 000220   000022 732000                    QRS     18
         2 000221   000006 402007                    MPY     6,DL
         2 000222   677776 630506                    EPPR0   -2,QL,PR6
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:22   
         2 000223   200016 450500                    STP0    RECORD_SET_LAST_KEY$,,AUTO

      155     3534
      156     3535                      /*  If the any keys to delete
      157     3536                          lie within the record set...  */
      158     3537    4                 IF DELETION_FIRST_KEY$ -> VD$TEXTC.BYTES <=

   3537  2 000224   200010 470500                    LDP0    DELETION_FIRST_KEY$,,AUTO
         2 000225   000000 236100                    LDQ     0,,PR0
         2 000226   000033 772000                    QRL     27
         2 000227   200016 477500                    LDP7    RECORD_SET_LAST_KEY$,,AUTO
         2 000230   000000 625006                    EAX5    0,QL
         2 000231   700000 236100                    LDQ     0,,PR7
         2 000232   000033 772000                    QRL     27
         2 000233   000000 626006                    EAX6    0,QL
         2 000234   040140 106540                    CMPC    fill='040'O
         2 000235   700000 200016                    ADSC9   0,,PR7                   cn=1,n=*X6
         2 000236   000000 200015                    ADSC9   0,,PR0                   cn=1,n=*X5
         2 000237   000377 602000 2                  TNC     NEXT_FILE_NODE_PLEASE
         2 000240   200011 470500                    LDP0    DELETION_LAST_KEY$,,AUTO
         2 000241   000000 236100                    LDQ     0,,PR0
         2 000242   000033 772000                    QRL     27
         2 000243   200015 470500                    LDP0    RECORD_SET_FIRST_KEY$,,AUTO
         2 000244   000000 625006                    EAX5    0,QL
         2 000245   000000 236100                    LDQ     0,,PR0
         2 000246   000033 772000                    QRL     27
         2 000247   200011 470500                    LDP0    DELETION_LAST_KEY$,,AUTO
         2 000250   200015 471500                    LDP1    RECORD_SET_FIRST_KEY$,,AUTO
         2 000251   000000 620006                    EAX0    0,QL
         2 000252   040140 106540                    CMPC    fill='040'O
         2 000253   000000 200015                    ADSC9   0,,PR0                   cn=1,n=*X5
         2 000254   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
         2 000255   000377 602000 2                  TNC     NEXT_FILE_NODE_PLEASE

      159     3538    4                   RECORD_SET_LAST_KEY$ -> VD$TEXTC.BYTES
      160     3539    4                   AND DELETION_LAST_KEY$ -> VD$TEXTC.BYTES >=
      161     3540    4                   RECORD_SET_FIRST_KEY$ -> VD$TEXTC.BYTES
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:23   
      162     3541                      /*  ...then delete the range.  */
      163     3542    4                 THEN
      164     3543    4   DELETE_THE_RANGE:
      165     3544    5                   DO;

   3544  2 000256                       DELETE_THE_* null
      166     3545
      167     3546    5                     IF WINDOW$SPEC.RECORD_SET$ ->

   3546  2 000256   200006 473500                    LDP3    CURRENT_WINDOW$,,AUTO
         2 000257   300016 476500                    LDP6    14,,PR3
         2 000260   600003 220100                    LDX0    3,,PR6
         2 000261   000002 100003                    CMPX0   2,DU
         2 000262   000270 601000 2                  TNZ     s:3554

      168     3547    5                       VD$RECORD_SET.DESC.KEY.TYPE#(0) = %KT_STRING
      169     3548    5                     THEN
      170     3549    6                       DO;

      171     3550    6                         CALL VDP$WERASE (WINDOW$SPEC) ALTRET (RETALT);

   3550  2 000263   200006 630500                    EPPR0   CURRENT_WINDOW$,,AUTO
         2 000264   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000265   000000 701000 xent               TSX1    VDP$WERASE
         2 000266   000376 702000 2                  TSX2    RETALT

      172     3551    6                         RETURN;

   3551  2 000267   000000 702200 xent               TSX2  ! X66_ARET

      173     3552    6                       END;
      174     3553
      175     3554    5                     WINDOW$SPEC.SCREEN_UPDATED = %FALSE;

   3554  2 000270   000001 236000 3                  LDQ     1
         2 000271   300015 356100                    ANSQ    13,,PR3

PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:24   
      176     3555    5                     FPT_DELREC.V.DCB# = WINDOW$SPEC.DCB#;

   3555  2 000272   300014 720100                    LXL0    12,,PR3
         2 000273   000010 740000 1                  STX0    FPT_DELREC+8

      177     3556
      178     3557    5                     FPT_DELREC.KEY_ = VECTOR ( FEP_FIRST_KEY );

   3557  2 000274   777640 235007                    LDA     -96,DL
         2 000275   200022 452500                    STP2    WINDOW_FID$+1,,AUTO
         2 000276   200022 236100                    LDQ     WINDOW_FID$+1,,AUTO
         2 000277   000012 036003                    ADLQ    10,DU
         2 000300   000002 757000 1                  STAQ    FPT_DELREC+2

      179     3558    5                     FPT_DELREC.LKEY_ = VECTOR ( FEP_LAST_KEY );

   3558  2 000301   777640 235007                    LDA     -96,DL
         2 000302   200022 452500                    STP2    WINDOW_FID$+1,,AUTO
         2 000303   200022 236100                    LDQ     WINDOW_FID$+1,,AUTO
         2 000304   000013 036003                    ADLQ    11,DU
         2 000305   000004 757000 1                  STAQ    FPT_DELREC+4

      180     3559    5                     FEP_FIRST_KEY = DELETION_FIRST_KEY$ -> VD$TEXTC_NUMBER.BYTES#;

   3559  2 000306   200010 476500                    LDP6    DELETION_FIRST_KEY$,,AUTO
         2 000307   600000 236100                    LDQ     0,,PR6
         2 000310   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000311   200012 756100                    STQ     FEP_FIRST_KEY,,AUTO

      181     3560    5                     FEP_LAST_KEY = DELETION_LAST_KEY$ -> VD$TEXTC_NUMBER.BYTES#;

   3560  2 000312   000000 236100                    LDQ     0,,PR0
         2 000313   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000314   200013 756100                    STQ     FEP_LAST_KEY,,AUTO

      182     3561    5                     IF VD_$$MON_PRES.V# > 0

PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:25   
   3561  2 000315   000003 235000 xsym               LDA     VD_$$MON_PRES+3
         2 000316   000340 604400 2                  TMOZ    s:3567

      183     3562    5                     THEN
      184     3563    5                       CALL VDG$MPRES_FEPDELREC ( WINDOW$SPEC.DCB#,

   3563  2 000317   200014 236100                    LDQ     LEVEL_INDEX,,AUTO
         2 000320   000023 736000                    QLS     19
         2 000321   000007 036003                    ADLQ    7,DU
         2 000322   200004 036100                    ADLQ    @DELETION_RANGE,,AUTO
         2 000323   200024 756100                    STQ     WINDOW_FID$+3,,AUTO
         2 000324   200014 236100                    LDQ     LEVEL_INDEX,,AUTO
         2 000325   000023 736000                    QLS     19
         2 000326   000002 136003                    SBLQ    2,DU
         2 000327   200004 036100                    ADLQ    @DELETION_RANGE,,AUTO
         2 000330   200023 756100                    STQ     WINDOW_FID$+2,,AUTO
         2 000331   200006 236100                    LDQ     CURRENT_WINDOW$,,AUTO
         2 000332   000002 036000 3                  ADLQ    2
         2 000333   200022 756100                    STQ     WINDOW_FID$+1,,AUTO
         2 000334   200022 630500                    EPPR0   WINDOW_FID$+1,,AUTO
         2 000335   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000336   000000 701000 xent               TSX1    VDG$MPRES_FEPDELREC
         2 000337   000000 011000                    NOP     0

      185     3564    5                         DELETION_RANGE.START.KEY ( LEVEL_INDEX - 1 ),
      186     3565    5                         DELETION_RANGE.ENDD.KEY ( LEVEL_INDEX - 1 ) );
      187     3566
      188     3567    5                     CALL M$DELREC ( FPT_DELREC )

   3567  2 000340   000000 630400 1                  EPPR0   FPT_DELREC
         2 000341   440002 713400                    CLIMB   alt,+16386
         2 000342   401400 401760                    pmme    nvectors=4
         2 000343   000345 702000 2                  TSX2    s:3570
         2 000344   000351 710000 2                  TRA     s:3577

      189     3568    5                     WHENALTRETURN
      190     3569    6                       DO;
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:26   

      191     3570    6                         CALL VDG$MONERR;

   3570  2 000345   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000346   000000 701000 xent               TSX1    VDG$MONERR
         2 000347   000000 011000                    NOP     0

      192     3571    6                         GOTO RETALT;

   3571  2 000350   000376 710000 2                  TRA     RETALT

      193     3572    6                       END;
      194     3573
      195     3574                          /*  For the RECORD_SET:
      196     3575                              call VDP$WSCROLL_UP to scroll up by whatever
      197     3576                              part of the deleted range lies in this window.  */
      198     3577    5                     CALL VDP$WSCROLL_UP ( WINDOW$SPEC,

   3577  2 000351   200014 236100                    LDQ     LEVEL_INDEX,,AUTO
         2 000352   000023 736000                    QLS     19
         2 000353   000007 036003                    ADLQ    7,DU
         2 000354   200004 036100                    ADLQ    @DELETION_RANGE,,AUTO
         2 000355   200027 756100                    STQ     WINDOW_FID$+6,,AUTO
         2 000356   200014 236100                    LDQ     LEVEL_INDEX,,AUTO
         2 000357   000023 736000                    QLS     19
         2 000360   000002 136003                    SBLQ    2,DU
         2 000361   200004 036100                    ADLQ    @DELETION_RANGE,,AUTO
         2 000362   200026 756100                    STQ     WINDOW_FID$+5,,AUTO
         2 000363   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000364   000001 235000 xsym               LDA     B_VECTNIL+1
         2 000365   200024 757100                    STAQ    WINDOW_FID$+3,,AUTO
         2 000366   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000367   200006 235100                    LDA     CURRENT_WINDOW$,,AUTO
         2 000370   200022 757100                    STAQ    WINDOW_FID$+1,,AUTO
         2 000371   200022 630500                    EPPR0   WINDOW_FID$+1,,AUTO
         2 000372   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 000373   000000 701000 xent               TSX1    VDP$WSCROLL_UP
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:27   
         2 000374   000376 702000 2                  TSX2    RETALT
         2 000375   000377 710000 2                  TRA     NEXT_FILE_NODE_PLEASE

      199     3578    5                       /* no scroll_key */,
      200     3579    5                       /* no scroll_spec */,
      201     3580    5                       /* no scroll_data */,
      202     3581    5                       DELETION_RANGE.START.KEY ( LEVEL_INDEX - 1 ),
      203     3582    5                       DELETION_RANGE.ENDD.KEY ( LEVEL_INDEX - 1 ) )
      204     3583    5                     WHENALTRETURN
      205     3584    6                       DO;

   3582  2 000376                       RETALT       null
      206     3585    6   RETALT:               ;
      207     3586    6                         ALTRETURN;

   3586  2 000376   000000 702200 xent               TSX2  ! X66_AALT

      208     3587    6                       END;
      209     3588
      210     3589    5                   END DELETE_THE_RANGE;

      211     3590
      212     3591    4               END COMPARE_RANGE_W_WINDOW;

      213     3592
      214     3593    3           END CHECK_THIS_WINDOW;

      215     3594
      216     3595    2   NEXT_FILE_NODE_PLEASE:
      217     3596    2         WINDOW$ = WINDOW$ -> VD$FILE_NODE.FLINK$;

   3596  2 000377   200020 470500       NEXT_FILE_N* LDP0    WINDOW$,,AUTO
         2 000400   000002 236100                    LDQ     2,,PR0
         2 000401   200020 756100                    STQ     WINDOW$,,AUTO

      218     3597
      219     3598    2       END CHECK_ALL_THE_WINDOWS;
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:28   

   3598  2 000402   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000403   000115 601000 2                  TNZ     s:3468

      220     3599
      221     3600    1       RETURN;

   3600  2 000404   000000 702200 xent               TSX2  ! X66_ARET
      222     3601
      223     3602    1   END VDP$RDELETE;
      224     3603        %EOD;

PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:29   
--  Include file information  --

   VD_MACROS_M.:VDA5TOU  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E04TOU  was found in the system file and is never referenced.
   CP_6_C.:E04TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure VDP$RDELETE.
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:30   

 **** Variables and constants ****

  ****  Section 001  Data  VDP$RDELETE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(360)   r     1 FPT_DELREC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DELETION_FID              4-0-0/w PTR         r     1 @DELETION_RANGE
     5-0-0/w PTR         r     1 @FROM_PRESENTER            6-0-0/w PTR         r     1 CURRENT_WINDOW$
    *0-0-0/w STRC(72)    r     1 DELETION_FID               7-0-0/w PTR         r     1 DELETION_FID$
    10-0-0/w PTR         r     1 DELETION_FIRST_KEY$       11-0-0/w PTR         r     1 DELETION_LAST_KEY$
    *0-0-0/w STRC(648)   r     1 DELETION_RANGE            12-0-0/w UBIN        r     1 FEP_FIRST_KEY
    13-0-0/w UBIN        r     1 FEP_LAST_KEY              *0-0-0/w BIT         r     1 FROM_PRESENTER
    14-0-0/w UBIN        r     1 LEVEL_INDEX
    15-0-0/w PTR         r     1 RECORD_SET_FIRST_KEY$
    16-0-0/w PTR         r     1 RECORD_SET_LAST_KEY$      17-0-0/w PTR         r     1 VD_ERR$
    20-0-0/w PTR         r     1 WINDOW$                   21-0-0/w PTR         r     1 WINDOW_FID$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(144)   r     1 VD_$$MON_PRES              0-0-0/w STRC(144)   r     1 VD_$SCREEN
     0-0-0/w STRC(22644) r     1 VD_6E                      0-0-0/w PTR         r     1 VD_CURRENT_WINDOW$
     0-0-0/w STRC(72)    r     1 VD_KEY_MX_EDITKEY

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:31   
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(936)   r     1 VD$BLOCK_DESC              0-0-0/w ASTR(90)    r     1 VD$BUFFER
     0-0-0/w STRC(468)   r     1 VD$FILE_NODE               0-0-0/w STRC(1944)  r     1 VD$PORT
     0-0-0/w STRC(324)   r     1 VD$RECORD_SET              0-0-0/w STRC(864)   r     1 VD$STREAM
     0-0-0/w ASTR(9)     r     1 VD$TEXTC                   0-0-0/w STRC        r     1 VD$TEXTC_NUMBER
     0-0-0/w ASTR(81)    r     1 VD$TEXTC_REMOTE            0-0-0/w STRC(900)   r     1 WINDOW$SPEC


   Procedure VDP$RDELETE requires 261 words for executable code.
   Procedure VDP$RDELETE requires 24 words of local(AUTO) storage.
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:32   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:33   
          MINI XREF LISTING

B$ALT.CODE
       101**DCL       101--REDEF     102--REDEF     102--REDEF
B$ALT.ERR.ERR#
       103**DCL       103--REDEF
B$ALT.EVID
       102**DCL       102--REDEF     102--REDEF
CURRENT_WINDOW$
      2578**DCL      3331--IMP-PTR  3475<<ASSIGN   3480>>IF       3480>>IF       3493>>IF       3493>>ASSIGN
      3493>>ASSIGN   3506>>IF       3519>>IF       3519>>ASSIGN   3519>>ASSIGN   3531>>IF       3531>>IF
      3531>>ASSIGN   3531>>ASSIGN   3531>>ASSIGN   3531>>ASSIGN   3546>>IF       3550>>CALL     3554>>ASSIGN
      3555>>ASSIGN   3563>>CALL     3577>>CALL
DELETION_FID
      2484**DCL         9--PROC     3398<>CALL
DELETION_FID.REP#
      2488**DCL      3455>>IF
DELETION_FID.V$
      2488**DCL      3455>>ASSIGN   3455--ASSIGN
DELETION_FID$
      2579**DCL      3455<<ASSIGN   3455<<ASSIGN   3497>>IF       3497>>IF
DELETION_FIRST_KEY$
      2580**DCL      3422<<ASSIGN   3422<<ASSIGN   3537>>IF       3537>>IF       3559>>ASSIGN
DELETION_LAST_KEY$
      2581**DCL      3429<<ASSIGN   3442<<ASSIGN   3442<<ASSIGN   3537>>IF       3537>>IF       3560>>ASSIGN
DELETION_RANGE
      2499**DCL         9--PROC     3398<>CALL
DELETION_RANGE.ENDD.EOF
      2557**DCL      3426>>IF
DELETION_RANGE.ENDD.KEY
      2553**DCL      3563<>CALL     3577<>CALL
DELETION_RANGE.ENDD.KEY.REP#
      2555**DCL      3442>>IF
DELETION_RANGE.ENDD.KEY.V$
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:34   
      2555**DCL      3442>>ASSIGN   3442--ASSIGN
DELETION_RANGE.START.KEY
      2525**DCL      3408>>IF       3563<>CALL     3577<>CALL
DELETION_RANGE.START.KEY.REP#
      2527**DCL      3422>>IF
DELETION_RANGE.START.KEY.V$
      2527**DCL      3422>>ASSIGN   3422--ASSIGN
FEP_FIRST_KEY
      2582**DCL      3557--ASSIGN   3559<<ASSIGN
FEP_LAST_KEY
      2583**DCL      3558--ASSIGN   3560<<ASSIGN
FIND_LOWEST_LEVEL
      3407**LABEL    3410--EXIT
FPT_DELREC
       120**DCL      3567<>CALL
FPT_DELREC.KEY_
       120**DCL      3557<<ASSIGN
FPT_DELREC.LKEY_
       122**DCL      3558<<ASSIGN
FPT_DELREC.V
       123**DCL       120--DCLINIT
FPT_DELREC.V.DCB#
       124**DCL      3555<<ASSIGN
FROM_PRESENTER
      2560**DCL         9--PROC     3398<>CALL     3468--IF       3470>>IF
LEVEL_INDEX
      2584**DCL      3407<<DOINDEX  3408>>IF       3422>>IF       3422>>ASSIGN   3422>>ASSIGN   3442>>IF
      3442>>ASSIGN   3442>>ASSIGN   3563>>CALL     3563>>CALL     3577>>CALL     3577>>CALL
M$DELREC
        25**DCL-ENT  3567--CALL
NEXT_FILE_NODE_PLEASE
      3596**LABEL    3473--GOTO     3508--GOTO
RECORD_SET_FIRST_KEY$
      2585**DCL      3519<<ASSIGN   3519<<ASSIGN   3537>>IF       3537>>IF
RECORD_SET_LAST_KEY$
      2586**DCL      3531<<ASSIGN   3531<<ASSIGN   3537>>IF       3537>>IF
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:35   
RETALT
      3582**LABEL    3550--CALLALT  3571--GOTO
VD$BLOCK_DESC.FILE_KEY.REP#
      2637**DCL      3493>>IF
VD$BLOCK_DESC.FILE_KEY.V$
      2637**DCL      3493>>ASSIGN   3493--ASSIGN
VD$BUFFER.LENGTH#
      2789**DCL      2791--IMP-SIZ
VD$FILE_NODE.DESC.SPEC.V$
      2936**DCL      3475>>ASSIGN
VD$FILE_NODE.FLINK$
      2883**DCL      3596>>ASSIGN
VD$FILE_NODE.HEAD$
      2940**DCL      3459>>ASSIGN
VD$PORT.LEVEL.INTERNAL$
      3037**DCL      3459>>ASSIGN
VD$RECORD_SET.DESC.KEY.REP#
      3099**DCL      3519>>IF       3531>>IF
VD$RECORD_SET.DESC.KEY.TYPE#
      3099**DCL      3546>>IF
VD$RECORD_SET.DESC.KEY.V$
      3099**DCL      3519>>ASSIGN   3519--ASSIGN   3531>>ASSIGN   3531--ASSIGN
VD$RECORD_SET.N_ENTRIES#
      3074**DCL      3506>>IF       3531>>IF       3531>>ASSIGN   3531>>ASSIGN
VD$STREAM.PORT$
      3152**DCL      3459>>ASSIGN
VD$TEXTC
      3232**DCL      3497>>IF       3497>>IF
VD$TEXTC.BYTES
      3242**DCL      3537>>IF       3537>>IF       3537>>IF       3537>>IF
VD$TEXTC.LENGTH#
      3240**DCL      3242--IMP-SIZ  3497>>IF       3497>>IF       3537>>IF       3537>>IF       3537>>IF
      3537>>IF
VD$TEXTC_NUMBER.BYTES#
      3259**DCL      3559>>ASSIGN   3560>>ASSIGN
VD$TEXTC_REMOTE.LENGTH#
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:36   
      3315**DCL      3317--IMP-SIZ  3422--ASSIGN   3442--ASSIGN   3455--ASSIGN   3493--ASSIGN   3519--ASSIGN
      3531--ASSIGN
VDG$MONERR
      3392**DCL-ENT  3570--CALL
VDG$MPRES_FEPDELREC
      3390**DCL-ENT  3563--CALL
VDG$MPRES_RDELETE
      3391**DCL-ENT  3398--CALL
VDP$WERASE
      3393**DCL-ENT  3550--CALL
VDP$WSCROLL_UP
      3394**DCL-ENT  3577--CALL
VD_$$MON_PRES.V#
      2388**DCL      3396>>IF       3561>>IF
VD_$SCREEN.V#
      2434**DCL      3402>>IF
VD_6E.WINDOWS$
      2451**DCL      3459>>ASSIGN
VD_CURRENT_WINDOW$
      2473**DCL      3470>>IF
VD_ERR$
      2587**DCL      2804--IMP-PTR
VD_KEY_MX_EDITKEY.LENGTH#
      2574**DCL      3429--ASSIGN
WINDOW$
      2588**DCL      3459<<ASSIGN   3463>>DOWHILE  3470>>IF       3475>>ASSIGN   3596<<ASSIGN   3596>>ASSIGN
WINDOW$SPEC
      3331**DCL      3550<>CALL     3577<>CALL
WINDOW$SPEC.COMMAND
      3357**DCL      3480>>IF
WINDOW$SPEC.DCB#
      3374**DCL      3555>>ASSIGN   3563<>CALL
WINDOW$SPEC.OPERAND.EDIT_BLOCK$
      3372**DCL      3480>>IF       3493>>IF       3493>>ASSIGN   3493>>ASSIGN
WINDOW$SPEC.RECORD_SET$
      3375**DCL      3506>>IF       3519>>IF       3519>>ASSIGN   3519>>ASSIGN   3531>>IF       3531>>IF
PL6.E3A0      #001=VDP$RDELETE File=VDP$RECORDS.:VDA5TSI                         FRI 07/04/97 11:37 Page:37   
      3531>>ASSIGN   3531>>ASSIGN   3531>>ASSIGN   3531>>ASSIGN   3546>>IF
WINDOW$SPEC.SCREEN_UPDATED
      3375**DCL      3554<<ASSIGN
WINDOW_FID$
      2589**DCL      3493<<ASSIGN   3493<<ASSIGN   3497>>IF       3497>>IF

PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:38   
      225        1        /*M* VDP$RWRITE:  Handle Accessor-to-Presenter "WRITE" calls.  */
      226        2        /*T***********************************************************/
      227        3        /*T*                                                         */
      228        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      229        5        /*T*                                                         */
      230        6        /*T***********************************************************/
      231        7        /*X* DMC,PLM=4,IND=0,DCI=4,CSI=2,IAD=2,DTI=2,AND,ECI=0,DIN=2,STI=2 */
      232        8
      233        9        VDP$RWRITE: PROC ( WRITE_FID,
      234       10              WRITE_LOCATION,
      235       11              WRITE_SPEC,
      236       12              WRITE_DATA,
      237       13              FROM_PRESENTER )
      238       14              ALTRET;
      239       15
      240       16          %INCLUDE CP_6;
      241       97
      242       98            %B$TCB;
      243      101            %B$ALT;
      244      109    1     DCL B$TCB$ PTR SYMREF;
      245      110
      246      111          %FPT_WRITE (BP=YES);
      247      142
      248      143          %INCLUDE VD_MACROS_M;
      249     2358
      250     2359          %VD$NUMBER ( NAME = VD_$$MON_PRES,
      251     2360                       STCLASS = SYMREF );
      252     2405          %VD$NUMBER ( NAME = VD_$SCREEN,
      253     2406                       STCLASS = SYMREF );
      254     2451          %VD_6E ( STCLASS = SYMREF );
      255     2487    1     DCL VD_CURRENT_WINDOW$ PTR SYMREF;
      256     2488
      257     2489          %VD$KEY ( NAME = WRITE_FID,
      258     2490                    STCLASS = PARAM );
      259     2504          %VD$LOCATION ( NAME = WRITE_LOCATION,
      260     2505                         STCLASS = PARAM );
      261     2533          %VD$SPEC ( NAME = WRITE_SPEC,
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:39   
      262     2534                     STCLASS = PARAM );
      263     2548          %VD$BUFFER ( NAME = WRITE_DATA,
      264     2549                       STCLASS = PARAM );
      265     2607    1     DCL FROM_PRESENTER BIT(1) ALIGNED;
      266     2608
      267     2609    1     DCL LOGICAL_BOB SBIN CONSTANT INIT(%BITBIN('003000000000'O));
      268     2610    1     DCL LOGICAL_EOB SBIN CONSTANT INIT(%BITBIN('003777777777'O));
      269     2611
      270     2612    1     DCL CURRENT_WINDOW$ PTR;
      271     2613    1     DCL FEP_KEY UBIN;
      272     2614    1     DCL LEVEL_INDEX UBIN;
      273     2615    1     DCL RECORD_SET_FIRST_KEY$ PTR;
      274     2616    1     DCL RECORD_SET_LAST_KEY$ PTR;
      275     2617    1     DCL VD_ERR$ PTR;
      276     2618    1     DCL WINDOW$ PTR;
      277     2619    1     DCL WINDOW_FID$ PTR;
      278     2620    1     DCL WRITE_FID$ PTR;
      279     2621    1     DCL WRITE_KEY$ PTR;
      280     2622
      281     2623          %VD$BLOCK_DESC;
      282     2770          %VD$ERR ( STCLASS = "BASED ( VD_ERR$ )" );
      283     2823          %VD$FILE_NODE;
      284     2916          %VD$PORT;
      285     3014          %VD$RECORD_SET;
      286     3092          %VD$STREAM;
      287     3198          %VD$TEXTC;
      288     3221          %VD$TEXTC_NUMBER;
      289     3235          %VD$TEXTC_REMOTE;
      290     3296          %VD$WINDOW_SPEC ( NAME = WINDOW$SPEC,
      291     3297                            STCLASS = "BASED ( CURRENT_WINDOW$ )" );
      292     3363
      293     3364    1     DCL VDG$MPRES_FEPWRITE ENTRY (3);
      294     3365    1     DCL VDG$MPRES_RWRITE ENTRY (4);
      295     3366    1     DCL VDG$MPRES_RWRITE_RETURN ENTRY;
      296     3367    1     DCL VDG$MONERR ENTRY ALTRET;
      297     3368    1     DCL VDP$WERASE ENTRY (1) ALTRET;
      298     3369    1     DCL VDP$WSCROLL_DOWN ENTRY (4) ALTRET;
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:40   
      299     3370        %EJECT;
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:41   
      300     3371    1       IF VD_$$MON_PRES.V# > 0
      301     3372    1       THEN
      302     3373    1         CALL VDG$MPRES_RWRITE ( WRITE_FID,
      303     3374    1           WRITE_LOCATION,
      304     3375    1           WRITE_SPEC,
      305     3376    1           WRITE_DATA );
      306     3377
      307     3378    1       IF VD_$SCREEN.V# < %MN_SCREEN_EDITING_HEIGHT
      308     3379    1       THEN
      309     3380    1         RETURN;
      310     3381
      311     3382    1   FIND_LOWEST_LEVEL:
      312     3383    2       DO LEVEL_INDEX = 0 TO %MX_LOCATION_LEVELS - 1;
      313     3384    2         IF WRITE_LOCATION.KEY ( LEVEL_INDEX ) = %CLEAR
      314     3385    2         THEN
      315     3386    2           EXIT FIND_LOWEST_LEVEL;
      316     3387    2       END FIND_LOWEST_LEVEL;
      317     3388
      318     3389            %GETKEY ( KEY = "WRITE_LOCATION.KEY",
      319     3390            INDX = "LEVEL_INDEX - 1",
      320     3391            PTR = WRITE_KEY$ );
      321     3401
      322     3402            %GETKEY ( KEY = "WRITE_FID",
      323     3403            PTR = WRITE_FID$ );
      324     3413
      325     3414    1       WINDOW$ = VD_6E.WINDOWS$ -> VD$STREAM.PORT$ ->
      326     3415    1         VD$PORT.LEVEL.INTERNAL$ ( %LVL_FILE ) -> VD$FILE_NODE.HEAD$;
      327     3416
      328     3417    1   CHECK_ALL_THE_WINDOWS:
      329     3418    2       DO WHILE ( WINDOW$ ~= ADDR (NIL) );
      330     3419
      331     3420              /*  If we were called FROM_PRESENTER,
      332     3421                  and this VD$FILE_NODE is the VD_CURRENT_WINDOW$,
      333     3422                  skip it.  */
      334     3423    2         IF ADDR ( FROM_PRESENTER ) ~= ADDR ( NIL )
      335     3424    2         THEN
      336     3425    2           IF FROM_PRESENTER
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:42   
      337     3426    2             AND WINDOW$ = VD_CURRENT_WINDOW$
      338     3427    2           THEN
      339     3428    2             GOTO NEXT_FILE_NODE_PLEASE;
      340     3429
      341     3430    2         CURRENT_WINDOW$ = WINDOW$ -> VD$FILE_NODE.DESC.SPEC.V$;
      342     3431
      343     3432              /*  If this is the command window,
      344     3433                  or if it has no EDIT_BLOCK,
      345     3434                  skip it.  */
      346     3435    2         IF NOT WINDOW$SPEC.COMMAND
      347     3436    2           AND WINDOW$SPEC.OPERAND.EDIT_BLOCK$ ~= ADDR (NIL)
      348     3437    2         THEN
      349     3438    2   CHECK_THIS_WINDOW:
      350     3439    3           DO;
      351     3440                  %GETKEY ( KEY =
              3440                      "WINDOW$SPEC.OPERAND.EDIT_BLOCK$ -> VD$BLOCK_DESC.FILE_KEY",
      352     3441                  PTR = WINDOW_FID$ );
      353     3451
      354     3452    3             IF WRITE_FID$ -> VD$TEXTC = WINDOW_FID$ -> VD$TEXTC
      355     3453    3             THEN
      356     3454    3   CHECK_COMPONENT:
      357     3455    4               DO;
      358     3456
      359     3457    4                 IF ( WINDOW$SPEC.OPERAND.EDIT_BLOCK$ ->
      360     3458    4                   VD$BLOCK_DESC.OPTIONS.COMPONENT# = %CO_DATA
      361     3459    4                   AND ADDR(WRITE_DATA) ~= ADDR(NIL) )
      362     3460    4                   OR ( WINDOW$SPEC.OPERAND.EDIT_BLOCK$ ->
      363     3461    4                   VD$BLOCK_DESC.OPTIONS.COMPONENT# = %CO_SPEC
      364     3462    4                   AND ADDR(WRITE_SPEC) ~= ADDR(NIL) )
      365     3463    4                 THEN
      366     3464    4   COMPARE_RANGE_W_WINDOW:
      367     3465    5                   DO;
      368     3466
      369     3467    5                     IF WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.MX_ENTRIES# = 507
      370     3468    5                     THEN EXIT;
      371     3469    5                     IF WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.N_ENTRIES# = 0
      372     3470    5                       OR WINDOW$SPEC.BOB_DISPLAYED
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:43   
      373     3471    5                     THEN
      374     3472    5                       RECORD_SET_FIRST_KEY$ = ADDR ( LOGICAL_BOB );
      375     3473    5                     ELSE
      376     3474    6                       DO;
      377     3475                              %GETKEY ( KEY =
              3475                                  "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.DESC.KEY",
      378     3476                              INDX = 0,
      379     3477                              PTR = RECORD_SET_FIRST_KEY$ );
      380     3487    6                       END;
      381     3488
      382     3489    5                     IF WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.N_ENTRIES# = 0
      383     3490    5                       OR WINDOW$SPEC.EOB_DISPLAYED
      384     3491    5                     THEN
      385     3492    5                       RECORD_SET_LAST_KEY$ = ADDR ( LOGICAL_EOB );
      386     3493    5                     ELSE
      387     3494    6                       DO;
      388     3495                              %GETKEY ( KEY =
              3495                                  "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.DESC.KEY",
      389     3496                              INDX =
              3496                                  "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.N_ENTRIES# - 1",
      390     3497                              PTR = RECORD_SET_LAST_KEY$ );
      391     3507    6                       END;
      392     3508
      393     3509                          /*  If the newly-written record
      394     3510                              is within the record set...
      395     3511                              ...write it out.  */
      396     3512    5                     IF ( WRITE_KEY$ -> VD$TEXTC.BYTES >=
      397     3513    5                       RECORD_SET_FIRST_KEY$ -> VD$TEXTC.BYTES )
      398     3514    5                       AND ( WRITE_KEY$ -> VD$TEXTC.BYTES <=
      399     3515    5                       RECORD_SET_LAST_KEY$ -> VD$TEXTC.BYTES )
      400     3516    5                     THEN
      401     3517    5   REPLACE_OR_INSERT_THE_RECORD:
      402     3518    6                       DO;
      403     3519
      404     3520    6                         IF WRITE_LOCATION.KEY.TYPE# (LEVEL_INDEX-1) = %KT_STRING
      405     3521    6                         THEN
      406     3522    7                           DO;
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:44   
      407     3523    7                             CALL VDP$WERASE (WINDOW$SPEC) ALTRET (RETALT);
      408     3524    7                             RETURN;
      409     3525    7                           END;
      410     3526
      411     3527    6                         WINDOW$SPEC.SCREEN_UPDATED = %FALSE;
      412     3528    6                         FPT_WRITE.V.DCB# = WINDOW$SPEC.DCB#;
      413     3529    6                         IF WRITE_DATA.LENGTH# = 0
      414     3530    6                         THEN
      415     3531    6                           FPT_WRITE.BUF_ = VECTOR ( NIL );
      416     3532    6                         ELSE
      417     3533    6                           FPT_WRITE.BUF_ = VECTOR ( WRITE_DATA.BYTES );
      418     3534
      419     3535    6                         FPT_WRITE.KEY_ = VECTOR ( FEP_KEY );
      420     3536    6                         FEP_KEY = WRITE_KEY$ -> VD$TEXTC_NUMBER.BYTES#;
      421     3537    6                         IF VD_$$MON_PRES.V# > 0
      422     3538    6                         THEN
      423     3539    6                           CALL VDG$MPRES_FEPWRITE ( WINDOW$SPEC.DCB#,
      424     3540    6                             WRITE_LOCATION.KEY ( LEVEL_INDEX - 1 ) );
      425     3541
      426     3542    6                         CALL M$WRITE ( FPT_WRITE )
      427     3543    6                         WHENALTRETURN
      428     3544    7                           DO;
      429     3545    7                             CALL VDG$MONERR;
      430     3546    7                             GOTO RETALT;
      431     3547    7                           END;
      432     3548
      433     3549                            /*  For RECORD_SET:
      434     3550                                call VDP$WSCROLL_DOWN to scroll down 1
      435     3551                                from the inserted key.
      436     3552                                (Insertions only:  scroll routine decides.)  */
      437     3553    6                         CALL VDP$WSCROLL_DOWN ( WINDOW$SPEC,
      438     3554    6                           WRITE_LOCATION.KEY ( LEVEL_INDEX - 1 ),
      439     3555    6                           /* no scroll_spec */,
      440     3556    6                           WRITE_DATA )
      441     3557    6                         WHENALTRETURN
      442     3558    7                           DO;
      443     3559    7   RETALT:                   ;
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:45   
      444     3560    7                             ALTRETURN;
      445     3561    7                           END;
      446     3562
      447     3563    6                       END REPLACE_OR_INSERT_THE_RECORD;
      448     3564
      449     3565    5                   END COMPARE_RANGE_W_WINDOW;
      450     3566
      451     3567    4               END CHECK_COMPONENT;
      452     3568
      453     3569    3           END CHECK_THIS_WINDOW;
      454     3570
      455     3571    2   NEXT_FILE_NODE_PLEASE:
      456     3572    2         WINDOW$ = WINDOW$ -> VD$FILE_NODE.FLINK$;
      457     3573
      458     3574    2       END CHECK_ALL_THE_WINDOWS;
      459     3575
      460     3576    1       RETURN;
      461     3577
      462     3578    1   END VDP$RWRITE;

PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:46   
--  Include file information  --

   VD_MACROS_M.:VDA5TOU  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E04TOU  was found in the system file and is never referenced.
   CP_6_C.:E04TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure VDP$RWRITE.

   Procedure VDP$RWRITE requires 258 words for executable code.
   Procedure VDP$RWRITE requires 22 words of local(AUTO) storage.

    No errors detected in file VDP$RECORDS.:VDA5TSI    .

PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:47   

 Object Unit name= VDP$RWRITE                                 File name= VDP$RECORDS.:VDA5TOU
 UTS= JUL 04 '97 11:37:42.76 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none    12     14  VDP$RWRITE
    2  RoData even  UTS      2      2  VDP$RWRITE
    3   Proc  even  none   258    402  VDP$RWRITE
    4  RoData even  none     7      7  VDP$RWRITE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes    yes     yes      Std        5  VDP$RWRITE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       4 VDG$MPRES_RWRITE
 yes     yes           Std       1 VDP$WERASE
 yes     yes           Std       0 VDG$MONERR
 yes     yes           Std       4 VDP$WSCROLL_DOWN
         yes           Std       3 VDG$MPRES_FEPWRITE
                       nStd      0 X66_AUTO_5
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:48   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  VD_$$MON_PRES                         VD_$SCREEN
     VD_6E                                 VD_CURRENT_WINDOW$                    B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:49   


      225        1        /*M* VDP$RWRITE:  Handle Accessor-to-Presenter "WRITE" calls.  */
      226        2        /*T***********************************************************/
      227        3        /*T*                                                         */
      228        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      229        5        /*T*                                                         */
      230        6        /*T***********************************************************/
      231        7        /*X* DMC,PLM=4,IND=0,DCI=4,CSI=2,IAD=2,DTI=2,AND,ECI=0,DIN=2,STI=2 */
      232        8
      233        9        VDP$RWRITE: PROC ( WRITE_FID,

      9  3 000000   000000 700200 xent  VDP$RWRITE   TSX0  ! X66_AUTO_5
         3 000001   000026 000005                    ZERO    22,5

      234       10              WRITE_LOCATION,
      235       11              WRITE_SPEC,
      236       12              WRITE_DATA,
      237       13              FROM_PRESENTER )
      238       14              ALTRET;
      239       15
      240       16          %INCLUDE CP_6;
      241       97
      242       98            %B$TCB;
      243      101            %B$ALT;
      244      109    1     DCL B$TCB$ PTR SYMREF;
      245      110
      246      111          %FPT_WRITE (BP=YES);
      247      142
      248      143          %INCLUDE VD_MACROS_M;
      249     2358
      250     2359          %VD$NUMBER ( NAME = VD_$$MON_PRES,
      251     2360                       STCLASS = SYMREF );
      252     2405          %VD$NUMBER ( NAME = VD_$SCREEN,
      253     2406                       STCLASS = SYMREF );
      254     2451          %VD_6E ( STCLASS = SYMREF );
      255     2487    1     DCL VD_CURRENT_WINDOW$ PTR SYMREF;
      256     2488
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:50   
      257     2489          %VD$KEY ( NAME = WRITE_FID,
      258     2490                    STCLASS = PARAM );
      259     2504          %VD$LOCATION ( NAME = WRITE_LOCATION,
      260     2505                         STCLASS = PARAM );
      261     2533          %VD$SPEC ( NAME = WRITE_SPEC,
      262     2534                     STCLASS = PARAM );
      263     2548          %VD$BUFFER ( NAME = WRITE_DATA,
      264     2549                       STCLASS = PARAM );
      265     2607    1     DCL FROM_PRESENTER BIT(1) ALIGNED;
      266     2608
      267     2609    1     DCL LOGICAL_BOB SBIN CONSTANT INIT(%BITBIN('003000000000'O));
      268     2610    1     DCL LOGICAL_EOB SBIN CONSTANT INIT(%BITBIN('003777777777'O));
      269     2611
      270     2612    1     DCL CURRENT_WINDOW$ PTR;
      271     2613    1     DCL FEP_KEY UBIN;
      272     2614    1     DCL LEVEL_INDEX UBIN;
      273     2615    1     DCL RECORD_SET_FIRST_KEY$ PTR;
      274     2616    1     DCL RECORD_SET_LAST_KEY$ PTR;
      275     2617    1     DCL VD_ERR$ PTR;
      276     2618    1     DCL WINDOW$ PTR;
      277     2619    1     DCL WINDOW_FID$ PTR;
      278     2620    1     DCL WRITE_FID$ PTR;
      279     2621    1     DCL WRITE_KEY$ PTR;
      280     2622
      281     2623          %VD$BLOCK_DESC;
      282     2770          %VD$ERR ( STCLASS = "BASED ( VD_ERR$ )" );
      283     2823          %VD$FILE_NODE;
      284     2916          %VD$PORT;
      285     3014          %VD$RECORD_SET;
      286     3092          %VD$STREAM;
      287     3198          %VD$TEXTC;
      288     3221          %VD$TEXTC_NUMBER;
      289     3235          %VD$TEXTC_REMOTE;
      290     3296          %VD$WINDOW_SPEC ( NAME = WINDOW$SPEC,
      291     3297                            STCLASS = "BASED ( CURRENT_WINDOW$ )" );
      292     3363
      293     3364    1     DCL VDG$MPRES_FEPWRITE ENTRY (3);
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:51   
      294     3365    1     DCL VDG$MPRES_RWRITE ENTRY (4);
      295     3366    1     DCL VDG$MPRES_RWRITE_RETURN ENTRY;
      296     3367    1     DCL VDG$MONERR ENTRY ALTRET;
      297     3368    1     DCL VDP$WERASE ENTRY (1) ALTRET;
      298     3369    1     DCL VDP$WSCROLL_DOWN ENTRY (4) ALTRET;
      299     3370        %EJECT;
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:52   
      300     3371    1       IF VD_$$MON_PRES.V# > 0

   3371  3 000002   000003 235000 xsym               LDA     VD_$$MON_PRES+3
         3 000003   000010 604400 3                  TMOZ    s:3378

      301     3372    1       THEN
      302     3373    1         CALL VDG$MPRES_RWRITE ( WRITE_FID,

   3373  3 000004   200003 630500                    EPPR0   @WRITE_FID,,AUTO
         3 000005   000022 631400 xsym               EPPR1   B_VECTNIL+18
         3 000006   000000 701000 xent               TSX1    VDG$MPRES_RWRITE
         3 000007   000000 011000                    NOP     0

      303     3374    1           WRITE_LOCATION,
      304     3375    1           WRITE_SPEC,
      305     3376    1           WRITE_DATA );
      306     3377
      307     3378    1       IF VD_$SCREEN.V# < %MN_SCREEN_EDITING_HEIGHT

   3378  3 000010   000003 235000 xsym               LDA     VD_$SCREEN+3
         3 000011   000003 115007                    CMPA    3,DL
         3 000012   000014 605000 3                  TPL     FIND_LOWEST_LEVEL

      308     3379    1       THEN
      309     3380    1         RETURN;

   3380  3 000013   000000 702200 xent               TSX2  ! X66_ARET

      310     3381
      311     3382    1   FIND_LOWEST_LEVEL:
      312     3383    2       DO LEVEL_INDEX = 0 TO %MX_LOCATION_LEVELS - 1;

   3383  3 000014   200012 450100       FIND_LOWEST* STZ     LEVEL_INDEX,,AUTO
         3 000015   000030 710000 3                  TRA     s:3387+3

      313     3384    2         IF WRITE_LOCATION.KEY ( LEVEL_INDEX ) = %CLEAR

PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:53   
   3384  3 000016   200012 235100                    LDA     LEVEL_INDEX,,AUTO
         3 000017   000003 735000                    ALS     3
         3 000020   200004 470500                    LDP0    @WRITE_LOCATION,,AUTO
         3 000021   000000 106505                    CMPC    fill='000'O
         3 000022   000000 000010                    ADSC9   0,A,PR0                  cn=0,n=8
         3 000023   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
         3 000024   000033 600000 3                  TZE     s:3398

      314     3385    2         THEN
      315     3386    2           EXIT FIND_LOWEST_LEVEL;
      316     3387    2       END FIND_LOWEST_LEVEL;

   3387  3 000025   200012 236100                    LDQ     LEVEL_INDEX,,AUTO
         3 000026   000001 036007                    ADLQ    1,DL
         3 000027   200012 756100                    STQ     LEVEL_INDEX,,AUTO
         3 000030   200012 235100                    LDA     LEVEL_INDEX,,AUTO
         3 000031   000004 115007                    CMPA    4,DL
         3 000032   000016 602000 3                  TNC     s:3384

      317     3388
      318     3389            %GETKEY ( KEY = "WRITE_LOCATION.KEY",
      319     3390            INDX = "LEVEL_INDEX - 1",
      320     3391            PTR = WRITE_KEY$ );

   3398  3 000033   200012 235100                    LDA     LEVEL_INDEX,,AUTO
         3 000034   000001 735000                    ALS     1
         3 000035   200004 470500                    LDP0    @WRITE_LOCATION,,AUTO
         3 000036   077776 720105                    LXL0    -2,AL,PR0
         3 000037   000002 100003                    CMPX0   2,DU
         3 000040   000045 601000 3                  TNZ     s:3398+10

   3398  3 000041   077777 471505                    LDP1    -1,AL,PR0
         3 000042   100002 633500                    EPPR3   2,,PR1
         3 000043   200021 453500                    STP3    WRITE_KEY$,,AUTO
         3 000044   000052 710000 3                  TRA     s:3410

   3398  3 000045   200012 236100                    LDQ     LEVEL_INDEX,,AUTO
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:54   
         3 000046   000023 736000                    QLS     19
         3 000047   000001 136003                    SBLQ    1,DU
         3 000050   200004 036100                    ADLQ    @WRITE_LOCATION,,AUTO
         3 000051   200021 756100                    STQ     WRITE_KEY$,,AUTO

      321     3401
      322     3402            %GETKEY ( KEY = "WRITE_FID",
      323     3403            PTR = WRITE_FID$ );

   3410  3 000052   200003 471500                    LDP1    @WRITE_FID,,AUTO
         3 000053   100000 721100                    LXL1    0,,PR1
         3 000054   000002 101003                    CMPX1   2,DU
         3 000055   000062 601000 3                  TNZ     s:3410+8

   3410  3 000056   100001 473500                    LDP3    1,,PR1
         3 000057   300002 634500                    EPPR4   2,,PR3
         3 000060   200020 454500                    STP4    WRITE_FID$,,AUTO
         3 000061   000065 710000 3                  TRA     s:3414

   3410  3 000062   200003 236100                    LDQ     @WRITE_FID,,AUTO
         3 000063   000001 036003                    ADLQ    1,DU
         3 000064   200020 756100                    STQ     WRITE_FID$,,AUTO

      324     3413
      325     3414    1       WINDOW$ = VD_6E.WINDOWS$ -> VD$STREAM.PORT$ ->

   3414  3 000065   000006 473400 xsym               LDP3    VD_6E+6
         3 000066   300001 474500                    LDP4    1,,PR3
         3 000067   400031 475500                    LDP5    25,,PR4
         3 000070   500012 236100                    LDQ     10,,PR5
         3 000071   200016 756100                    STQ     WINDOW$,,AUTO

      326     3415    1         VD$PORT.LEVEL.INTERNAL$ ( %LVL_FILE ) -> VD$FILE_NODE.HEAD$;
      327     3416
      328     3417    1   CHECK_ALL_THE_WINDOWS:
      329     3418    2       DO WHILE ( WINDOW$ ~= ADDR (NIL) );

PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:55   
   3418  3 000072   000377 710000 3     CHECK_ALL_T* TRA     s:3574

      330     3419
      331     3420              /*  If we were called FROM_PRESENTER,
      332     3421                  and this VD$FILE_NODE is the VD_CURRENT_WINDOW$,
      333     3422                  skip it.  */
      334     3423    2         IF ADDR ( FROM_PRESENTER ) ~= ADDR ( NIL )

   3423  3 000073   200007 236100                    LDQ     @FROM_PRESENTER,,AUTO
         3 000074   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 000075   000104 600000 3                  TZE     s:3430

      335     3424    2         THEN
      336     3425    2           IF FROM_PRESENTER

   3425  3 000076   200007 470500                    LDP0    @FROM_PRESENTER,,AUTO
         3 000077   000000 234100                    SZN     0,,PR0
         3 000100   000104 605000 3                  TPL     s:3430
         3 000101   200016 236100                    LDQ     WINDOW$,,AUTO
         3 000102   000000 116000 xsym               CMPQ    VD_CURRENT_WINDOW$
         3 000103   000374 600000 3                  TZE     NEXT_FILE_NODE_PLEASE

      337     3426    2             AND WINDOW$ = VD_CURRENT_WINDOW$
      338     3427    2           THEN
      339     3428    2             GOTO NEXT_FILE_NODE_PLEASE;
      340     3429
      341     3430    2         CURRENT_WINDOW$ = WINDOW$ -> VD$FILE_NODE.DESC.SPEC.V$;

   3430  3 000104   200016 470500                    LDP0    WINDOW$,,AUTO
         3 000105   000007 236100                    LDQ     7,,PR0
         3 000106   200010 756100                    STQ     CURRENT_WINDOW$,,AUTO

      342     3431
      343     3432              /*  If this is the command window,
      344     3433                  or if it has no EDIT_BLOCK,
      345     3434                  skip it.  */
      346     3435    2         IF NOT WINDOW$SPEC.COMMAND
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:56   

   3435  3 000107   200010 471500                    LDP1    CURRENT_WINDOW$,,AUTO
         3 000110   100002 236100                    LDQ     2,,PR1
         3 000111   000400 316003                    CANQ    256,DU
         3 000112   000374 601000 3                  TNZ     NEXT_FILE_NODE_PLEASE
         3 000113   100012 236100                    LDQ     10,,PR1
         3 000114   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 000115   000374 600000 3                  TZE     NEXT_FILE_NODE_PLEASE

      347     3436    2           AND WINDOW$SPEC.OPERAND.EDIT_BLOCK$ ~= ADDR (NIL)
      348     3437    2         THEN
      349     3438    2   CHECK_THIS_WINDOW:
      350     3439    3           DO;

   3439  3 000116                       CHECK_THIS_* null
      351     3440                  %GETKEY ( KEY =
              3440                      "WINDOW$SPEC.OPERAND.EDIT_BLOCK$ -> VD$BLOCK_DESC.FILE_KEY",
      352     3441                  PTR = WINDOW_FID$ );

   3448  3 000116   100012 473500                    LDP3    10,,PR1
         3 000117   300001 720100                    LXL0    1,,PR3
         3 000120   000002 100003                    CMPX0   2,DU
         3 000121   000126 601000 3                  TNZ     s:3448+4

   3448  3 000122   300002 474500                    LDP4    2,,PR3
         3 000123   400002 635500                    EPPR5   2,,PR4
         3 000124   200017 455500                    STP5    WINDOW_FID$,,AUTO
         3 000125   000130 710000 3                  TRA     s:3452

   3448  3 000126   300002 634500                    EPPR4   2,,PR3
         3 000127   200017 454500                    STP4    WINDOW_FID$,,AUTO

      353     3451
      354     3452    3             IF WRITE_FID$ -> VD$TEXTC = WINDOW_FID$ -> VD$TEXTC

   3452  3 000130   200020 474500                    LDP4    WRITE_FID$,,AUTO
         3 000131   400000 236100                    LDQ     0,,PR4
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:57   
         3 000132   000033 772000                    QRL     27
         3 000133   000001 621006                    EAX1    1,QL
         3 000134   200017 475500                    LDP5    WINDOW_FID$,,AUTO
         3 000135   500000 236100                    LDQ     0,,PR5
         3 000136   000033 772000                    QRL     27
         3 000137   000001 622006                    EAX2    1,QL
         3 000140   000140 106540                    CMPC    fill='000'O
         3 000141   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1
         3 000142   500000 000012                    ADSC9   0,,PR5                   cn=0,n=*X2
         3 000143   000374 601000 3                  TNZ     NEXT_FILE_NODE_PLEASE

      355     3453    3             THEN
      356     3454    3   CHECK_COMPONENT:
      357     3455    4               DO;

   3455  3 000144                       CHECK_COMPO* null
      358     3456
      359     3457    4                 IF ( WINDOW$SPEC.OPERAND.EDIT_BLOCK$ ->

   3457  3 000144   300026 723100                    LXL3    22,,PR3
         3 000145   000003 103003                    CMPX3   3,DU
         3 000146   000152 601000 3                  TNZ     CHECK_COMPONENT+6
         3 000147   200006 236100                    LDQ     @WRITE_DATA,,AUTO
         3 000150   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 000151   000157 601000 3                  TNZ     COMPARE_RANGE_W_WINDOW
         3 000152   000002 103003                    CMPX3   2,DU
         3 000153   000374 601000 3                  TNZ     NEXT_FILE_NODE_PLEASE
         3 000154   200005 236100                    LDQ     @WRITE_SPEC,,AUTO
         3 000155   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 000156   000374 600000 3                  TZE     NEXT_FILE_NODE_PLEASE

      360     3458    4                   VD$BLOCK_DESC.OPTIONS.COMPONENT# = %CO_DATA
      361     3459    4                   AND ADDR(WRITE_DATA) ~= ADDR(NIL) )
      362     3460    4                   OR ( WINDOW$SPEC.OPERAND.EDIT_BLOCK$ ->
      363     3461    4                   VD$BLOCK_DESC.OPTIONS.COMPONENT# = %CO_SPEC
      364     3462    4                   AND ADDR(WRITE_SPEC) ~= ADDR(NIL) )
      365     3463    4                 THEN
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:58   
      366     3464    4   COMPARE_RANGE_W_WINDOW:
      367     3465    5                   DO;

   3465  3 000157                       COMPARE_RAN* null
      368     3466
      369     3467    5                     IF WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.MX_ENTRIES# = 507

   3467  3 000157   100016 476500                    LDP6    14,,PR1
         3 000160   600002 724100                    LXL4    2,,PR6
         3 000161   000773 104003                    CMPX4   507,DU
         3 000162   000374 600000 3                  TZE     NEXT_FILE_NODE_PLEASE

      370     3468    5                     THEN EXIT;
      371     3469    5                     IF WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.N_ENTRIES# = 0

   3469  3 000163   600002 225100                    LDX5    2,,PR6
         3 000164   000167 600000 3                  TZE     s:3472
         3 000165   100015 234100                    SZN     13,,PR1
         3 000166   000172 605000 3                  TPL     s:3484

      372     3470    5                       OR WINDOW$SPEC.BOB_DISPLAYED
      373     3471    5                     THEN
      374     3472    5                       RECORD_SET_FIRST_KEY$ = ADDR ( LOGICAL_BOB );

   3472  3 000167   000000 236000 4                  LDQ     0
         3 000170   200013 756100                    STQ     RECORD_SET_FIRST_KEY$,,AUTO
         3 000171   000203 710000 3                  TRA     s:3489

      375     3473    5                     ELSE
      376     3474    6                       DO;

      377     3475                              %GETKEY ( KEY =
              3475                                  "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.DESC.KEY",
      378     3476                              INDX = 0,
      379     3477                              PTR = RECORD_SET_FIRST_KEY$ );

   3484  3 000172   600003 726100                    LXL6    3,,PR6
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:59   
         3 000173   000002 106003                    CMPX6   2,DU
         3 000174   000201 601000 3                  TNZ     s:3484+7

   3484  3 000175   600004 477500                    LDP7    4,,PR6
         3 000176   700002 630500                    EPPR0   2,,PR7
         3 000177   200013 450500                    STP0    RECORD_SET_FIRST_KEY$,,AUTO
         3 000200   000203 710000 3                  TRA     s:3489

   3484  3 000201   600004 637500                    EPPR7   4,,PR6
         3 000202   200013 457500                    STP7    RECORD_SET_FIRST_KEY$,,AUTO

      380     3487    6                       END;

      381     3488
      382     3489    5                     IF WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.N_ENTRIES# = 0

   3489  3 000203   000000 105003                    CMPX5   0,DU
         3 000204   000210 600000 3                  TZE     s:3492
         3 000205   100015 236100                    LDQ     13,,PR1
         3 000206   200000 316003                    CANQ    65536,DU
         3 000207   000213 600000 3                  TZE     s:3504

      383     3490    5                       OR WINDOW$SPEC.EOB_DISPLAYED
      384     3491    5                     THEN
      385     3492    5                       RECORD_SET_LAST_KEY$ = ADDR ( LOGICAL_EOB );

   3492  3 000210   000001 236000 4                  LDQ     1
         3 000211   200014 756100                    STQ     RECORD_SET_LAST_KEY$,,AUTO
         3 000212   000235 710000 3                  TRA     s:3512

      386     3493    5                     ELSE
      387     3494    6                       DO;

      388     3495                              %GETKEY ( KEY =
              3495                                  "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.DESC.KEY",
      389     3496                              INDX =
              3496                                 "WINDOW$SPEC.RECORD_SET$ -> VD$RECORD_SET.N_ENTRIES# - 1",
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:60   
      390     3497                              PTR = RECORD_SET_LAST_KEY$ );

   3504  3 000213   600002 236100                    LDQ     2,,PR6
         3 000214   000022 732000                    QRS     18
         3 000215   000006 402007                    MPY     6,DL
         3 000216   677775 726106                    LXL6    -3,QL,PR6
         3 000217   000002 106003                    CMPX6   2,DU
         3 000220   000230 601000 3                  TNZ     s:3504+13

   3504  3 000221   600002 236100                    LDQ     2,,PR6
         3 000222   000022 732000                    QRS     18
         3 000223   000006 402007                    MPY     6,DL
         3 000224   677776 470506                    LDP0    -2,QL,PR6
         3 000225   000002 637500                    EPPR7   2,,PR0
         3 000226   200014 457500                    STP7    RECORD_SET_LAST_KEY$,,AUTO
         3 000227   000235 710000 3                  TRA     s:3512

   3504  3 000230   600002 236100                    LDQ     2,,PR6
         3 000231   000022 732000                    QRS     18
         3 000232   000006 402007                    MPY     6,DL
         3 000233   677776 630506                    EPPR0   -2,QL,PR6
         3 000234   200014 450500                    STP0    RECORD_SET_LAST_KEY$,,AUTO

      391     3507    6                       END;

      392     3508
      393     3509                          /*  If the newly-written record
      394     3510                              is within the record set...
      395     3511                              ...write it out.  */
      396     3512    5                     IF ( WRITE_KEY$ -> VD$TEXTC.BYTES >=

   3512  3 000235   200021 470500                    LDP0    WRITE_KEY$,,AUTO
         3 000236   000000 236100                    LDQ     0,,PR0
         3 000237   000033 772000                    QRL     27
         3 000240   200013 477500                    LDP7    RECORD_SET_FIRST_KEY$,,AUTO
         3 000241   000000 626006                    EAX6    0,QL
         3 000242   700000 236100                    LDQ     0,,PR7
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:61   
         3 000243   000033 772000                    QRL     27
         3 000244   000000 627006                    EAX7    0,QL
         3 000245   040140 106540                    CMPC    fill='040'O
         3 000246   000000 200016                    ADSC9   0,,PR0                   cn=1,n=*X6
         3 000247   700000 200017                    ADSC9   0,,PR7                   cn=1,n=*X7
         3 000250   000374 602000 3                  TNC     NEXT_FILE_NODE_PLEASE
         3 000251   200014 470500                    LDP0    RECORD_SET_LAST_KEY$,,AUTO
         3 000252   000000 236100                    LDQ     0,,PR0
         3 000253   000033 772000                    QRL     27
         3 000254   000000 620006                    EAX0    0,QL
         3 000255   200021 471500                    LDP1    WRITE_KEY$,,AUTO
         3 000256   040140 106540                    CMPC    fill='040'O
         3 000257   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
         3 000260   100000 200016                    ADSC9   0,,PR1                   cn=1,n=*X6
         3 000261   000374 602000 3                  TNC     NEXT_FILE_NODE_PLEASE

      397     3513    5                       RECORD_SET_FIRST_KEY$ -> VD$TEXTC.BYTES )
      398     3514    5                       AND ( WRITE_KEY$ -> VD$TEXTC.BYTES <=
      399     3515    5                       RECORD_SET_LAST_KEY$ -> VD$TEXTC.BYTES )
      400     3516    5                     THEN
      401     3517    5   REPLACE_OR_INSERT_THE_RECORD:
      402     3518    6                       DO;

   3518  3 000262                       REPLACE_OR_* null
      403     3519
      404     3520    6                         IF WRITE_LOCATION.KEY.TYPE# (LEVEL_INDEX-1) = %KT_STRING

   3520  3 000262   200012 235100                    LDA     LEVEL_INDEX,,AUTO
         3 000263   000001 735000                    ALS     1
         3 000264   200004 473500                    LDP3    @WRITE_LOCATION,,AUTO
         3 000265   377776 223105                    LDX3    -2,AL,PR3
         3 000266   000002 103003                    CMPX3   2,DU
         3 000267   000275 601000 3                  TNZ     s:3527

      405     3521    6                         THEN
      406     3522    7                           DO;

PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:62   
      407     3523    7                             CALL VDP$WERASE (WINDOW$SPEC) ALTRET (RETALT);

   3523  3 000270   200010 630500                    EPPR0   CURRENT_WINDOW$,,AUTO
         3 000271   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000272   000000 701000 xent               TSX1    VDP$WERASE
         3 000273   000373 702000 3                  TSX2    RETALT

      408     3524    7                             RETURN;

   3524  3 000274   000000 702200 xent               TSX2  ! X66_ARET

      409     3525    7                           END;
      410     3526
      411     3527    6                         WINDOW$SPEC.SCREEN_UPDATED = %FALSE;

   3527  3 000275   200010 476500                    LDP6    CURRENT_WINDOW$,,AUTO
         3 000276   000002 236000 4                  LDQ     2
         3 000277   600015 356100                    ANSQ    13,,PR6

      412     3528    6                         FPT_WRITE.V.DCB# = WINDOW$SPEC.DCB#;

   3528  3 000300   600014 720100                    LXL0    12,,PR6
         3 000301   000010 740000 1                  STX0    FPT_WRITE+8

      413     3529    6                         IF WRITE_DATA.LENGTH# = 0

   3529  3 000302   200006 470500                    LDP0    @WRITE_DATA,,AUTO
         3 000303   000002 221100                    LDX1    2,,PR0
         3 000304   000310 601000 3                  TNZ     s:3533

      414     3530    6                         THEN
      415     3531    6                           FPT_WRITE.BUF_ = VECTOR ( NIL );

   3531  3 000305   000004 237000 4                  LDAQ    4
         3 000306   000004 757000 1                  STAQ    FPT_WRITE+4
         3 000307   000316 710000 3                  TRA     s:3535

PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:63   
      416     3532    6                         ELSE
      417     3533    6                           FPT_WRITE.BUF_ = VECTOR ( WRITE_DATA.BYTES );

   3533  3 000310   000000 635011                    EAA     0,X1
         3 000311   000002 731000                    ARS     2
         3 000312   000140 135007                    SBLA    96,DL
         3 000313   200006 236100                    LDQ     @WRITE_DATA,,AUTO
         3 000314   000003 036000 4                  ADLQ    3
         3 000315   000004 757000 1                  STAQ    FPT_WRITE+4

      418     3534
      419     3535    6                         FPT_WRITE.KEY_ = VECTOR ( FEP_KEY );

   3535  3 000316   777640 235007                    LDA     -96,DL
         3 000317   200022 452500                    STP2    WRITE_KEY$+1,,AUTO
         3 000320   200022 236100                    LDQ     WRITE_KEY$+1,,AUTO
         3 000321   000011 036003                    ADLQ    9,DU
         3 000322   000002 757000 1                  STAQ    FPT_WRITE+2

      420     3536    6                         FEP_KEY = WRITE_KEY$ -> VD$TEXTC_NUMBER.BYTES#;

   3536  3 000323   100000 236100                    LDQ     0,,PR1
         3 000324   000032 376000 xsym               ANQ     B_VECTNIL+26
         3 000325   200011 756100                    STQ     FEP_KEY,,AUTO

      421     3537    6                         IF VD_$$MON_PRES.V# > 0

   3537  3 000326   000003 235000 xsym               LDA     VD_$$MON_PRES+3
         3 000327   000344 604400 3                  TMOZ    s:3542

      422     3538    6                         THEN
      423     3539    6                           CALL VDG$MPRES_FEPWRITE ( WINDOW$SPEC.DCB#,

   3539  3 000330   200012 236100                    LDQ     LEVEL_INDEX,,AUTO
         3 000331   000023 736000                    QLS     19
         3 000332   000002 136003                    SBLQ    2,DU
         3 000333   200004 036100                    ADLQ    @WRITE_LOCATION,,AUTO
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:64   
         3 000334   200023 756100                    STQ     WRITE_KEY$+2,,AUTO
         3 000335   200010 236100                    LDQ     CURRENT_WINDOW$,,AUTO
         3 000336   000006 036000 4                  ADLQ    6
         3 000337   200022 756100                    STQ     WRITE_KEY$+1,,AUTO
         3 000340   200022 630500                    EPPR0   WRITE_KEY$+1,,AUTO
         3 000341   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000342   000000 701000 xent               TSX1    VDG$MPRES_FEPWRITE
         3 000343   000000 011000                    NOP     0

      424     3540    6                             WRITE_LOCATION.KEY ( LEVEL_INDEX - 1 ) );
      425     3541
      426     3542    6                         CALL M$WRITE ( FPT_WRITE )

   3542  3 000344   000000 630400 1                  EPPR0   FPT_WRITE
         3 000345   440001 713400                    CLIMB   alt,write
         3 000346   401400 401760                    pmme    nvectors=4
         3 000347   000351 702000 3                  TSX2    s:3545
         3 000350   000355 710000 3                  TRA     s:3553

      427     3543    6                         WHENALTRETURN
      428     3544    7                           DO;

      429     3545    7                             CALL VDG$MONERR;

   3545  3 000351   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000352   000000 701000 xent               TSX1    VDG$MONERR
         3 000353   000000 011000                    NOP     0

      430     3546    7                             GOTO RETALT;

   3546  3 000354   000373 710000 3                  TRA     RETALT

      431     3547    7                           END;
      432     3548
      433     3549                            /*  For RECORD_SET:
      434     3550                                call VDP$WSCROLL_DOWN to scroll down 1
      435     3551                                from the inserted key.
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:65   
      436     3552                                (Insertions only:  scroll routine decides.)  */
      437     3553    6                         CALL VDP$WSCROLL_DOWN ( WINDOW$SPEC,

   3553  3 000355   200006 236100                    LDQ     @WRITE_DATA,,AUTO
         3 000356   000001 235000 xsym               LDA     B_VECTNIL+1
         3 000357   200024 757100                    STAQ    WRITE_KEY$+3,,AUTO
         3 000360   200012 236100                    LDQ     LEVEL_INDEX,,AUTO
         3 000361   000023 736000                    QLS     19
         3 000362   000002 136003                    SBLQ    2,DU
         3 000363   200004 036100                    ADLQ    @WRITE_LOCATION,,AUTO
         3 000364   200010 235100                    LDA     CURRENT_WINDOW$,,AUTO
         3 000365   200022 757100                    STAQ    WRITE_KEY$+1,,AUTO
         3 000366   200022 630500                    EPPR0   WRITE_KEY$+1,,AUTO
         3 000367   000022 631400 xsym               EPPR1   B_VECTNIL+18
         3 000370   000000 701000 xent               TSX1    VDP$WSCROLL_DOWN
         3 000371   000373 702000 3                  TSX2    RETALT
         3 000372   000374 710000 3                  TRA     NEXT_FILE_NODE_PLEASE

      438     3554    6                           WRITE_LOCATION.KEY ( LEVEL_INDEX - 1 ),
      439     3555    6                           /* no scroll_spec */,
      440     3556    6                           WRITE_DATA )
      441     3557    6                         WHENALTRETURN
      442     3558    7                           DO;

   3554  3 000373                       RETALT       null
      443     3559    7   RETALT:                   ;
      444     3560    7                             ALTRETURN;

   3560  3 000373   000000 702200 xent               TSX2  ! X66_AALT

      445     3561    7                           END;
      446     3562
      447     3563    6                       END REPLACE_OR_INSERT_THE_RECORD;

      448     3564
      449     3565    5                   END COMPARE_RANGE_W_WINDOW;

PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:66   
      450     3566
      451     3567    4               END CHECK_COMPONENT;

      452     3568
      453     3569    3           END CHECK_THIS_WINDOW;

      454     3570
      455     3571    2   NEXT_FILE_NODE_PLEASE:
      456     3572    2         WINDOW$ = WINDOW$ -> VD$FILE_NODE.FLINK$;

   3572  3 000374   200016 470500       NEXT_FILE_N* LDP0    WINDOW$,,AUTO
         3 000375   000002 236100                    LDQ     2,,PR0
         3 000376   200016 756100                    STQ     WINDOW$,,AUTO

      457     3573
      458     3574    2       END CHECK_ALL_THE_WINDOWS;

   3574  3 000377   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 000400   000073 601000 3                  TNZ     s:3423

      459     3575
      460     3576    1       RETURN;

   3576  3 000401   000000 702200 xent               TSX2  ! X66_ARET
      461     3577
      462     3578    1   END VDP$RWRITE;

PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:67   
--  Include file information  --

   VD_MACROS_M.:VDA5TOU  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E04TOU  was found in the system file and is never referenced.
   CP_6_C.:E04TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure VDP$RWRITE.
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:68   

 **** Variables and constants ****

  ****  Section 001  Data  VDP$RWRITE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(432)   r     1 FPT_WRITE

  ****  Section 002 RoData VDP$RWRITE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 LOGICAL_BOB                1-0-0/w SBIN        r     1 LOGICAL_EOB

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/w PTR         r     1 @FROM_PRESENTER            6-0-0/w PTR         r     1 @WRITE_DATA
     3-0-0/w PTR         r     1 @WRITE_FID                 4-0-0/w PTR         r     1 @WRITE_LOCATION
     5-0-0/w PTR         r     1 @WRITE_SPEC               10-0-0/w PTR         r     1 CURRENT_WINDOW$
    11-0-0/w UBIN        r     1 FEP_KEY                   *0-0-0/w BIT         r     1 FROM_PRESENTER
    12-0-0/w UBIN        r     1 LEVEL_INDEX
    13-0-0/w PTR         r     1 RECORD_SET_FIRST_KEY$
    14-0-0/w PTR         r     1 RECORD_SET_LAST_KEY$      15-0-0/w PTR         r     1 VD_ERR$
    16-0-0/w PTR         r     1 WINDOW$                   17-0-0/w PTR         r     1 WINDOW_FID$
    *0-0-0/w ASTR(90)    r     1 WRITE_DATA                *0-0-0/w STRC(72)    r     1 WRITE_FID
    20-0-0/w PTR         r     1 WRITE_FID$                21-0-0/w PTR         r     1 WRITE_KEY$
    *0-0-0/w STRC(324)   r     1 WRITE_LOCATION            *0-0-0/w STRC(72)    r     1 WRITE_SPEC

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:69   

     0-0-0/w STRC(144)   r     1 VD_$$MON_PRES              0-0-0/w STRC(144)   r     1 VD_$SCREEN
     0-0-0/w STRC(22644) r     1 VD_6E                      0-0-0/w PTR         r     1 VD_CURRENT_WINDOW$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(936)   r     1 VD$BLOCK_DESC              0-0-0/w STRC(468)   r     1 VD$FILE_NODE
     0-0-0/w STRC(1944)  r     1 VD$PORT                    0-0-0/w STRC(324)   r     1 VD$RECORD_SET
     0-0-0/w STRC(864)   r     1 VD$STREAM                  0-0-0/w ASTR(9)     r     1 VD$TEXTC
     0-0-0/w STRC        r     1 VD$TEXTC_NUMBER            0-0-0/w ASTR(81)    r     1 VD$TEXTC_REMOTE
     0-0-0/w STRC(900)   r     1 WINDOW$SPEC


   Procedure VDP$RWRITE requires 258 words for executable code.
   Procedure VDP$RWRITE requires 22 words of local(AUTO) storage.

    No errors detected in file VDP$RECORDS.:VDA5TSI    .
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:70   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:71   
          MINI XREF LISTING

B$ALT.CODE
       103**DCL       103--REDEF     104--REDEF     104--REDEF
B$ALT.ERR.ERR#
       105**DCL       105--REDEF
B$ALT.EVID
       104**DCL       104--REDEF     104--REDEF
CURRENT_WINDOW$
      2612**DCL      3305--IMP-PTR  3430<<ASSIGN   3435>>IF       3435>>IF       3448>>IF       3448>>ASSIGN
      3448>>ASSIGN   3457>>IF       3457>>IF       3467>>IF       3469>>IF       3469>>IF       3484>>IF
      3484>>ASSIGN   3484>>ASSIGN   3489>>IF       3489>>IF       3504>>IF       3504>>IF       3504>>ASSIGN
      3504>>ASSIGN   3504>>ASSIGN   3504>>ASSIGN   3523>>CALL     3527>>ASSIGN   3528>>ASSIGN   3539>>CALL
      3553>>CALL
FEP_KEY
      2613**DCL      3535--ASSIGN   3536<<ASSIGN
FIND_LOWEST_LEVEL
      3383**LABEL    3386--EXIT
FPT_WRITE
       128**DCL      3542<>CALL
FPT_WRITE.BUF_
       128**DCL      3531<<ASSIGN   3533<<ASSIGN
FPT_WRITE.KEY_
       128**DCL      3535<<ASSIGN
FPT_WRITE.STATION_
       130**DCL       130--REDEF
FPT_WRITE.V
       131**DCL       128--DCLINIT
FPT_WRITE.V.DCB#
       131**DCL      3528<<ASSIGN
FPT_WRITE.V.DVBYTE.VFC#
       137**DCL       137--REDEF
FROM_PRESENTER
      2607**DCL         9--PROC     3423--IF       3425>>IF
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:72   
LEVEL_INDEX
      2614**DCL      3383<<DOINDEX  3384>>IF       3398>>IF       3398>>ASSIGN   3398>>ASSIGN   3520>>IF
      3539>>CALL     3553>>CALL
LOGICAL_BOB
      2609**DCL      3472--ASSIGN
LOGICAL_EOB
      2610**DCL      3492--ASSIGN
M$WRITE
        26**DCL-ENT  3542--CALL
NEXT_FILE_NODE_PLEASE
      3572**LABEL    3428--GOTO
RECORD_SET_FIRST_KEY$
      2615**DCL      3472<<ASSIGN   3484<<ASSIGN   3484<<ASSIGN   3512>>IF       3512>>IF
RECORD_SET_LAST_KEY$
      2616**DCL      3492<<ASSIGN   3504<<ASSIGN   3504<<ASSIGN   3512>>IF       3512>>IF
RETALT
      3554**LABEL    3523--CALLALT  3546--GOTO
VD$BLOCK_DESC.FILE_KEY.REP#
      2669**DCL      3448>>IF
VD$BLOCK_DESC.FILE_KEY.V$
      2669**DCL      3448>>ASSIGN   3448--ASSIGN
VD$BLOCK_DESC.OPTIONS.COMPONENT#
      2752**DCL      3457>>IF       3457>>IF
VD$FILE_NODE.DESC.SPEC.V$
      2910**DCL      3430>>ASSIGN
VD$FILE_NODE.FLINK$
      2857**DCL      3572>>ASSIGN
VD$FILE_NODE.HEAD$
      2914**DCL      3414>>ASSIGN
VD$PORT.LEVEL.INTERNAL$
      3011**DCL      3414>>ASSIGN
VD$RECORD_SET.DESC.KEY.REP#
      3073**DCL      3484>>IF       3504>>IF
VD$RECORD_SET.DESC.KEY.V$
      3073**DCL      3484>>ASSIGN   3484--ASSIGN   3504>>ASSIGN   3504--ASSIGN
VD$RECORD_SET.MX_ENTRIES#
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:73   
      3048**DCL      3467>>IF
VD$RECORD_SET.N_ENTRIES#
      3048**DCL      3469>>IF       3489>>IF       3504>>IF       3504>>ASSIGN   3504>>ASSIGN
VD$STREAM.PORT$
      3126**DCL      3414>>ASSIGN
VD$TEXTC
      3206**DCL      3452>>IF       3452>>IF
VD$TEXTC.BYTES
      3216**DCL      3512>>IF       3512>>IF       3512>>IF       3512>>IF
VD$TEXTC.LENGTH#
      3214**DCL      3216--IMP-SIZ  3452>>IF       3452>>IF       3512>>IF       3512>>IF       3512>>IF
      3512>>IF
VD$TEXTC_NUMBER.BYTES#
      3233**DCL      3536>>ASSIGN
VD$TEXTC_REMOTE.LENGTH#
      3289**DCL      3291--IMP-SIZ  3398--ASSIGN   3410--ASSIGN   3448--ASSIGN   3484--ASSIGN   3504--ASSIGN
VDG$MONERR
      3367**DCL-ENT  3545--CALL
VDG$MPRES_FEPWRITE
      3364**DCL-ENT  3539--CALL
VDG$MPRES_RWRITE
      3365**DCL-ENT  3373--CALL
VDP$WERASE
      3368**DCL-ENT  3523--CALL
VDP$WSCROLL_DOWN
      3369**DCL-ENT  3553--CALL
VD_$$MON_PRES.V#
      2402**DCL      3371>>IF       3537>>IF
VD_$SCREEN.V#
      2448**DCL      3378>>IF
VD_6E.WINDOWS$
      2465**DCL      3414>>ASSIGN
VD_CURRENT_WINDOW$
      2487**DCL      3425>>IF
VD_ERR$
      2617**DCL      2778--IMP-PTR
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:74   
WINDOW$
      2618**DCL      3414<<ASSIGN   3418>>DOWHILE  3425>>IF       3430>>ASSIGN   3572<<ASSIGN   3572>>ASSIGN
WINDOW$SPEC
      3305**DCL      3523<>CALL     3553<>CALL
WINDOW$SPEC.BOB_DISPLAYED
      3348**DCL      3469>>IF
WINDOW$SPEC.COMMAND
      3331**DCL      3435>>IF
WINDOW$SPEC.DCB#
      3348**DCL      3528>>ASSIGN   3539<>CALL
WINDOW$SPEC.EOB_DISPLAYED
      3348**DCL      3489>>IF
WINDOW$SPEC.OPERAND.EDIT_BLOCK$
      3346**DCL      3435>>IF       3448>>IF       3448>>ASSIGN   3448>>ASSIGN   3457>>IF       3457>>IF
WINDOW$SPEC.RECORD_SET$
      3349**DCL      3467>>IF       3469>>IF       3484>>IF       3484>>ASSIGN   3484>>ASSIGN   3489>>IF
      3504>>IF       3504>>IF       3504>>ASSIGN   3504>>ASSIGN   3504>>ASSIGN   3504>>ASSIGN
WINDOW$SPEC.SCREEN_UPDATED
      3349**DCL      3527<<ASSIGN
WINDOW_FID$
      2619**DCL      3448<<ASSIGN   3448<<ASSIGN   3452>>IF       3452>>IF
WRITE_DATA
      2574**DCL         9--PROC     3373<>CALL     3457--IF       3553<>CALL
WRITE_DATA.BYTES
      2602**DCL      3533--ASSIGN
WRITE_DATA.LENGTH#
      2600**DCL      2602--IMP-SIZ  3373>>CALL     3529>>IF       3533>>ASSIGN   3553>>CALL
WRITE_FID
      2498**DCL         9--PROC     3373<>CALL
WRITE_FID.REP#
      2502**DCL      3410>>IF
WRITE_FID.V$
      2502**DCL      3410>>ASSIGN   3410--ASSIGN
WRITE_FID$
      2620**DCL      3410<<ASSIGN   3410<<ASSIGN   3452>>IF       3452>>IF
WRITE_KEY$
PL6.E3A0      #002=VDP$RWRITE File=VDP$RECORDS.:VDA5TSI                          FRI 07/04/97 11:37 Page:75   
      2621**DCL      3398<<ASSIGN   3398<<ASSIGN   3512>>IF       3512>>IF       3512>>IF       3512>>IF
      3536>>ASSIGN
WRITE_LOCATION
      2513**DCL         9--PROC     3373<>CALL
WRITE_LOCATION.KEY
      2527**DCL      3384>>IF       3539<>CALL     3553<>CALL
WRITE_LOCATION.KEY.REP#
      2529**DCL      3398>>IF
WRITE_LOCATION.KEY.TYPE#
      2529**DCL      3520>>IF
WRITE_LOCATION.KEY.V$
      2529**DCL      3398>>ASSIGN   3398--ASSIGN
WRITE_SPEC
      2542**DCL         9--PROC     3373<>CALL     3457--IF
