VERSION E05

PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:1    
        1        1        /*M* NMV$VERIFY - Verify devices specified                         */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DFC=YES, DMC=YES, EDMC=YES                                    */
        8        8        /*F*
        9        9        NAME:           NMV$VERIFY
       10       10
       11       11        PURSPOSE:       To verify the devices specified
       12       12        */
       13       13        NMV$VERIFY:     PROC ( I, STATE1, STATE2 ) ALTRET ;
       14       14        /*
       15       15                        Includes
       16       16        */
       17       17        %INCLUDE                CP_6 ;
       18     5576        %INCLUDE                FM$GRAN ;
       19     5645        %INCLUDE                NI$TABLES ;
       20     5861        %INCLUDE                NI_DATA_C ;
       21     5974        %INCLUDE                NM_PERR_C ;
       22     6051        %INCLUDE                NM_MACRO_M ;
       23     7456        /*
       24     7457                        Parameters
       25     7458        */
       26     7459    1   DCL 1 I                 SBIN WORD ALIGNED PARAM ;
       27     7460    1   DCL 1 STATE1            SBIN WORD ALIGNED PARAM ;
       28     7461    1   DCL 1 STATE2            SBIN WORD ALIGNED PARAM ;
       29     7462        /*
       30     7463                        Entries
       31     7464        */
       32     7465    1   DCL 1 NME$ERRMSG        ENTRY(6) ;
       33     7466    1   DCL 1 NMU$READ          ENTRY(3) ALTRET ;
       34     7467        /*
       35     7468                        Variables
       36     7469        */
       37     7470                                %B$ALT ( NAME =
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:2    
       38     7471              B$ALT             , STCLASS = BASED
       39     7472                                                                        ) ;
       40     7480                                %B$TCB ( NAME =
       41     7481              B$TCB             , STCLASS = "BASED(B$TCB$)"
       42     7482                                                                        ) ;
       43     7485    1   DCL 1 B$TCB$            PTR SYMREF ;
       44     7486                                %NI$DCT ( NAME =
       45     7487              DCT               , STCLASS = BASED
       46     7488                                                                        ) ;
       47     7536                                %FM$VID ( FM$VID =
       48     7537              FM$VID            , BASED = BASED
       49     7538                                                                        ) ;
       50     7544    1   DCL 1 J                 SBIN WORD ALIGNED AUTO ;
       51     7545                                %NMD_PIT ( FPTN =
       52     7546              NMD_PIT           , STCLASS = SYMREF
       53     7547                                                                        ) ;
       54     8000                                %VLP_ERRCODE ( FPTN =
       55     8001              NMV#BAD_DGT       , STCLASS = CONSTANT
       56     8002                                , ERR# = %E$NMD#BAD_DGT
       57     8003                                , FCG  = %NMD#FCG
       58     8004                                , MID  = 'V'
       59     8005                                , MON  = %NO#
       60     8006                                , SEV  = 5
       61     8007                                                                        ) ;
       62     8052                                %VLP_ERRCODE ( FPTN =
       63     8053              NMV#BAD_PACKSIZE  , STCLASS = CONSTANT
       64     8054                                , ERR# = %E$NMD#BAD_PACKSIZE
       65     8055                                , FCG  = %NMD#FCG
       66     8056                                , MID  = 'V'
       67     8057                                , MON  = %NO#
       68     8058                                , SEV  = 5
       69     8059                                                                        ) ;
       70     8104                                %VLP_ERRCODE ( FPTN =
       71     8105              NMV#BAD_VSN       , STCLASS = CONSTANT
       72     8106                                , ERR# = %E$NMD#BAD_VSN
       73     8107                                , FCG  = %NMD#FCG
       74     8108                                , MID  = 'V'
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:3    
       75     8109                                , MON  = %NO#
       76     8110                                , SEV  = 5
       77     8111                                                                        ) ;
       78     8156                                %VLP_ERRCODE ( FPTN =
       79     8157              NMV#NOT_MIRRORED  , STCLASS = CONSTANT
       80     8158                                , ERR# = %E$NMD#NOT_MIRRORED
       81     8159                                , FCG  = %NMD#FCG
       82     8160                                , MID  = 'V'
       83     8161                                , MON  = %NO#
       84     8162                                , SEV  = 5
       85     8163                                                                        ) ;
       86     8208                                %VLP_ERRCODE ( FPTN =
       87     8209              NMV#NOT_PAIR      , STCLASS = CONSTANT
       88     8210                                , ERR# = %E$NMD#NOT_PAIR
       89     8211                                , FCG  = %NMD#FCG
       90     8212                                , MID  = 'V'
       91     8213                                , MON  = %NO#
       92     8214                                , SEV  = 5
       93     8215                                                                        ) ;
       94     8260                                %VLP_ERRCODE ( FPTN =
       95     8261              NMV#NOT_PART      , STCLASS = CONSTANT
       96     8262                                , ERR# = %E$NMD#NOT_PART
       97     8263                                , FCG  = %NMD#FCG
       98     8264                                , MID  = 'V'
       99     8265                                , MON  = %NO#
      100     8266                                , SEV  = 5
      101     8267                                                                        ) ;
      102     8312                                %VLP_ERRCODE ( FPTN =
      103     8313              NMV#NOT_PRIMARY  , STCLASS = CONSTANT
      104     8314                                , ERR# = %E$NMD#NOT_PRIMARY
      105     8315                                , FCG  = %NMD#FCG
      106     8316                                , MID  = 'V'
      107     8317                                , MON  = %NO#
      108     8318                                , SEV  = 5
      109     8319                                                                        ) ;
      110     8364                                %VLP_ERRCODE ( FPTN =
      111     8365              NMV#NOT_SAME      , STCLASS = CONSTANT
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:4    
      112     8366                                , ERR# = %E$NMD#NOT_SAME
      113     8367                                , FCG  = %NMD#FCG
      114     8368                                , MID  = 'V'
      115     8369                                , MON  = %NO#
      116     8370                                , SEV  = 5
      117     8371                                                                        ) ;
      118     8416                                %VLP_ERRCODE ( FPTN =
      119     8417              NMV#NOT_STATE     , STCLASS = CONSTANT
      120     8418                                , ERR# = %E$NMD#NOT_STATE
      121     8419                                , FCG  = %NMD#FCG
      122     8420                                , MID  = 'V'
      123     8421                                , MON  = %NO#
      124     8422                                , SEV  = 5
      125     8423                                                                        ) ;
      126     8468                                %VLP_ERRCODE ( FPTN =
      127     8469              NMV#NOT_STATES    , STCLASS = CONSTANT
      128     8470                                , ERR# = %E$NMD#NOT_STATES
      129     8471                                , FCG  = %NMD#FCG
      130     8472                                , MID  = 'V'
      131     8473                                , MON  = %NO#
      132     8474                                , SEV  = 5
      133     8475                                                                        ) ;
      134     8520                                %VLP_ERRCODE ( FPTN =
      135     8521              NMV#NOW_MIRRORED  , STCLASS = CONSTANT
      136     8522                                , ERR# = %E$NMD#NOW_MIRRORED
      137     8523                                , FCG  = %NMD#FCG
      138     8524                                , MID  = 'V'
      139     8525                                , MON  = %NO#
      140     8526                                , SEV  = 5
      141     8527                                                                        ) ;
      142     8572                                %VLP_ERRCODE ( FPTN =
      143     8573              NMV#PARTITIONED   , STCLASS = CONSTANT
      144     8574                                , ERR# = %E$NMD#PARTITIONED
      145     8575                                , FCG  = %NMD#FCG
      146     8576                                , MID  = 'V'
      147     8577                                , MON  = %NO#
      148     8578                                , SEV  = 5
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:5    
      149     8579                                                                        ) ;
      150     8624                                %VLP_ERRCODE ( FPTN =
      151     8625              NMV#SAME_DEV      , STCLASS = CONSTANT
      152     8626                                , ERR# = %E$NMD#SAME_DEV
      153     8627                                , FCG  = %NMD#FCG
      154     8628                                , MID  = 'V'
      155     8629                                , MON  = %NO#
      156     8630                                , SEV  = 5
      157     8631                                                                        ) ;
      158     8676                                %VLP_ERRCODE ( FPTN =
      159     8677              NMV#STATE_CHANGED , STCLASS = CONSTANT
      160     8678                                , ERR# = %E$NMD#STATE_CHANGED
      161     8679                                , FCG  = %NMD#FCG
      162     8680                                , MID  = 'V'
      163     8681                                , MON  = %NO#
      164     8682                                , SEV  = 3
      165     8683                                                                        ) ;
      166     8728    1   DCL 1 S1                SBIN WORD ALIGNED AUTO ;
      167     8729    1   DCL 1 S2                SBIN WORD ALIGNED AUTO ;
      168     8730        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:6    
      169     8731        /*D*
      170     8732        NAME:           NMV$CHGSTATE
      171     8733
      172     8734        CALL:           CALL NMV$CHGSTATE ( i ) ALTRET ( error ) ;
      173     8735
      174     8736        PARAMETERS:
      175     8737        */
      176     8738        /*K*
      177     8739        i               is a UBIN WORD that specifies the DEV index.
      178     8740                i must be either 0 or 1.
      179     8741        */
      180     8742        /*D*
      181     8743        DESCRIPTION:
      182     8744
      183     8745        The NMV$CHGSTATE procedure is used to report the "device
      184     8746        unexpectedly changed state" error message.  It always
      185     8747        makes an altreturn to the calling procedure.
      186     8748
      187     8749        */
      188     8750
      189     8751        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:7    
      190     8752    1   NMV$CHGSTATE:           ENTRY ( I )     ALTRET ;
      191     8753
      192     8754
      193     8755
      194     8756    1           S1 = NMD_PIT.DEV.STATE(I) ;
      195     8757    1           S2 = NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.STATE ;
      196     8758        /*E*
      197     8759        ERROR:  NMV-E$NMD#STATE_CHANGED-3
      198     8760        MESSAGE:  Command aborted:  %U1 state changed from %U2 to %U3
      199     8761        DESCRIPTION:  The command has been aborted because
      200     8762                      one of the devices unexpectedly changed state.
      201     8763                      This state change may have been caused either by
      202     8764                      an IO error or by some other user request.
      203     8765        */
      204     8766    1           CALL NME$ERRMSG ( NMV#STATE_CHANGED,
      205     8767    1                             NMD_PIT.DEV.DCB#(I),
      206     8768    1                             VECTOR(NMD_PIT.DEV.NAME(I)),
      207     8769    1                             NMD_PIT.STATE.V_(S1),
      208     8770    1                             NMD_PIT.STATE.V_(S2) ) ;
      209     8771    1           ALTRETURN ;
      210     8772
      211     8773        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:8    
      212     8774        /*D*
      213     8775        NAME:           NMV$DEV
      214     8776
      215     8777        CALL:           CALL NMV$DEV ALTRET ( error ) ;
      216     8778
      217     8779        PARAMETERS:     None.
      218     8780
      219     8781        DESCRIPTION:
      220     8782
      221     8783        The NMV$DEV procedure is used to verify that both
      222     8784        Mirrored Disk devices are different devices.  If they
      223     8785        are, this routine simply returns.  If they are not,
      224     8786        an error message is printed, and this routine makes
      225     8787        an altreturn to the calling procedure.
      226     8788
      227     8789        */
      228     8790
      229     8791        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:9    
      230     8792    1   NMV$DEV:                ENTRY           ALTRET ;
      231     8793
      232     8794
      233     8795
      234     8796    1           IF  NMD_PIT.DEV.DCT$(0)->DCT.DEVNM =
      235     8797    1               NMD_PIT.DEV.DCT$(1)->DCT.DEVNM
      236     8798    2           THEN DO ;
      237     8799        /*E*
      238     8800        ERROR:  NMV-E$NMD#SAME_DEV-5
      239     8801        MESSAGE:  Devices %U1 and %U2 are the same device.
      240     8802        DESCRIPTION:  For the specified operation, the devices must be
      241     8803                      different devices.
      242     8804        */
      243     8805    2               CALL NME$ERRMSG ( NMV#SAME_DEV, ,
      244     8806    2                                 VECTOR(NMD_PIT.DEV.NAME(0)),
      245     8807    2                                 VECTOR(NMD_PIT.DEV.NAME(1))) ;
      246     8808    2               ALTRETURN ;
      247     8809    2               END ;
      248     8810
      249     8811    1           RETURN ;
      250     8812
      251     8813        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:10   
      252     8814        /*D*
      253     8815        NAME:           NMV$DGT
      254     8816
      255     8817        CALL:           CALL NMV$DGT ALTRET ( error ) ;
      256     8818
      257     8819        PARAMETERS:     None.
      258     8820
      259     8821        DESCRIPTION:
      260     8822
      261     8823        The NMV$DGT procedure is used to verify the defective
      262     8824        granule tables (DGTs) of the devices specified on the
      263     8825        command line.  If the DGTs match, NMD_PIT.DGT is setup.
      264     8826        If the DGTs don't match, an error message is printed
      265     8827        and an altreturn is made to the calling procedure.
      266     8828
      267     8829        */
      268     8830
      269     8831        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:11   
      270     8832    1   NMV$DGT:                ENTRY           ALTRET ;
      271     8833
      272     8834
      273     8835
      274     8836    2           DO  J = 0 TO 63 ;
      275     8837    2               IF  NMD_PIT.DEV.VID$(0)->FM$VID.DGT(J) ~=
      276     8838    2                   NMD_PIT.DEV.VID$(1)->FM$VID.DGT(J)
      277     8839    3               THEN DO ;
      278     8840        /*E*
      279     8841        ERROR:  NMV-E$NMD#BAD_DGT-5
      280     8842        MESSAGE:  Defective Granule Tables (DGTs) don't match.
      281     8843        DESCRIPTION:  The Defective Track Table (DTT) and Defective Granule
      282     8844                      Table (DGT) must match on Mirrored Disk devices.
      283     8845                      This error indicates an error in the VOLINIT of the
      284     8846                      Mirrored Disk devices.
      285     8847        */
      286     8848    3                   CALL NME$ERRMSG ( NMV#BAD_DGT ) ;
      287     8849    3                   ALTRETURN ;
      288     8850    3                   END ;
      289     8851    3               ELSE DO ;
      290     8852    3                   NMD_PIT.DGT.FGRAN(J) = NMD_PIT.DEV.VID$(0)->FM$VID.DGT.FGRAN(J) ;
      291     8853    3                   NMD_PIT.DGT.LGRAN(J) = NMD_PIT.DEV.VID$(1)->FM$VID.DGT.LGRAN(J) ;
      292     8854    3                   END ;
      293     8855    2               END ;
      294     8856
      295     8857    1           NMD_PIT.DGT.I = 0 ;
      296     8858
      297     8859    1           NMD_PIT.DGT.FGRAN(64) = NMD_PIT.PACKSIZE ;
      298     8860    1           NMD_PIT.DGT.LGRAN(64) = NMD_PIT.PACKSIZE ;
      299     8861
      300     8862    1           RETURN ;
      301     8863
      302     8864        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:12   
      303     8865        /*D*
      304     8866        NAME:           NMV$MIRRORED
      305     8867
      306     8868        CALL:           CALL NMV$MIRRORED ( i ) ALTRET ( error ) ;
      307     8869
      308     8870        PARAMETERS:
      309     8871        */
      310     8872        /*K*
      311     8873        i               is a UBIN WORD that specifies the DEV index.
      312     8874                i must be either 0 or 1.
      313     8875        */
      314     8876        /*D*
      315     8877        DESCRIPTION:
      316     8878
      317     8879        The NMV$MIRRORED procedure is used to verify that DEV(i)
      318     8880        is a Mirrored Disk device.  If the device is a Mirrored
      319     8881        Disk device, this routine simply returns.  If the device
      320     8882        is not a Mirrored Disk device, an error message is printed
      321     8883        and this routine makes an altreturn to the calling procedure.
      322     8884
      323     8885        */
      324     8886
      325     8887        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:13   
      326     8888    1   NMV$MIRRORED:   ENTRY ( I )     ALTRET ;
      327     8889
      328     8890
      329     8891
      330     8892    1           IF  NOT NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.FLAG
      331     8893    2           THEN DO ;
      332     8894        /*E*
      333     8895        ERROR:  NMV-E$NMD#NOT_MIRRORED-5
      334     8896        MESSAGE:  %U1 is not a Mirrored Disk
      335     8897        DESCRIPTION:  The specified device must be a Mirrored Disk device.
      336     8898        */
      337     8899    2               CALL NME$ERRMSG ( NMV#NOT_MIRRORED, ,
      338     8900    2                                 VECTOR(NMD_PIT.DEV.NAME(I)) ) ;
      339     8901    2               ALTRETURN ;
      340     8902    2               END ;
      341     8903
      342     8904    1           RETURN ;
      343     8905
      344     8906        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:14   
      345     8907        /*D*
      346     8908        NAME:           NMV$MSTATE
      347     8909
      348     8910        CALL:           CALL NMV$MSTATE ( i, state1 ) ALTRET ( error ) ;
      349     8911
      350     8912        PARAMETERS:
      351     8913        */
      352     8914        /*K*
      353     8915        i               is a UBIN WORD that specifies the DEV index.
      354     8916                i must be either 0 or 1.
      355     8917        */
      356     8918        /*K*
      357     8919        state1          is a UBIN WORD that specifies the expected
      358     8920                state of the mirror of the specified device.
      359     8921        */
      360     8922        /*D*
      361     8923        DESCRIPTION:
      362     8924
      363     8925        The NMV$MSTATE procedure is used to verify that mirror
      364     8926        of the specified device is in the specified state.  If
      365     8927        the mirror is in the specified state, this routine
      366     8928        simple returns.  If the mirror is not in the specified
      367     8929        state, an error message is printed, and an altreturn
      368     8930        is made to the calling procedure.
      369     8931
      370     8932        */
      371     8933
      372     8934        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:15   
      373     8935    1   NMV$MSTATE:             ENTRY ( I, STATE1 ) ALTRET ;
      374     8936
      375     8937
      376     8938
      377     8939    1           J = 1 - I ;
      378     8940
      379     8941    1           IF  NMD_PIT.DEV.DCT$(J)->DCT.DP.MIRROR.STATE ~= STATE1
      380     8942    2           THEN DO ;
      381     8943        /*E*
      382     8944        ERROR:  NMV-E$NMD#NOT_STATE-5
      383     8945        MESSAGE:  Device %U1 is not %U2.
      384     8946        DESCRIPTION:  For the specified operation, the device must be
      385     8947                      in the specified state.
      386     8948        */
      387     8949    2               CALL NME$ERRMSG ( NMV#NOT_STATE, ,
      388     8950    2                                 VECTOR(NMD_PIT.DEV.NAME(J)),
      389     8951    2                                 NMD_PIT.STATE.V_(STATE1)            ) ;
      390     8952    2               ALTRETURN ;
      391     8953    2               END ;
      392     8954
      393     8955    1           RETURN ;
      394     8956
      395     8957        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:16   
      396     8958        /*D*
      397     8959        NAME:           NMV$NOTMIRROED
      398     8960
      399     8961        CALL:           CALL NMV$NOTMIRROED ( i ) ALTRET ( error ) ;
      400     8962
      401     8963        PARAMETERS:
      402     8964        */
      403     8965        /*K*
      404     8966        i               is a UBIN WORD that specifies the DEV index.
      405     8967                i must be either 0 or 1.
      406     8968        */
      407     8969        /*D*
      408     8970        DESCRIPTION:
      409     8971
      410     8972        The NMV$NOTMIRROED procedure is used to verify that DEV(i)
      411     8973        is a not a Mirrored Disk device.  If the device is not a Mirrored
      412     8974        Disk device, this routine simply returns.  If the device
      413     8975        is a Mirrored Disk device, an error message is printed
      414     8976        and this routine makes an altreturn to the calling procedure.
      415     8977
      416     8978        */
      417     8979
      418     8980        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:17   
      419     8981    1   NMV$NOTMIRRORED:        ENTRY ( I )     ALTRET ;
      420     8982
      421     8983
      422     8984
      423     8985    1           IF  NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.FLAG
      424     8986    2           THEN DO ;
      425     8987        /*E*
      426     8988        ERROR:  NMV-E$NMD#NOW_MIRRORED-5
      427     8989        MESSAGE:  %U1 already is a Mirrored Disk
      428     8990        DESCRIPTION:  The specified device must not be a Mirrored Disk device.
      429     8991        */
      430     8992    2               CALL NME$ERRMSG ( NMV#NOW_MIRRORED, ,
      431     8993    2                                 VECTOR(NMD_PIT.DEV.NAME(I)) ) ;
      432     8994    2               ALTRETURN ;
      433     8995    2               END ;
      434     8996
      435     8997    1           RETURN ;
      436     8998
      437     8999        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:18   
      438     9000        /*D*
      439     9001        NAME:           NMV$NOTPART
      440     9002
      441     9003        CALL:           CALL NMV$NOTPART ( i ) ALTRET ( error ) ;
      442     9004
      443     9005        PARAMETERS:
      444     9006        */
      445     9007        /*K*
      446     9008        i               is a UBIN WORD that specifies the DEV index.
      447     9009                i must be either 0 or 1.
      448     9010        */
      449     9011        /*D*
      450     9012        DESCRIPTION:
      451     9013
      452     9014        The NMV$NOTPART procedure is used to verify that DEV(i)
      453     9015        is not partitioned.  If the device is not partitioned, this routine
      454     9016        simply returns.  If the device is partitioned, an
      455     9017        error message is printed, and an altreturn is made to
      456     9018        the calling procedure.
      457     9019
      458     9020        */
      459     9021
      460     9022        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:19   
      461     9023    1   NMV$NOTPART:            ENTRY ( I )     ALTRET ;
      462     9024
      463     9025
      464     9026
      465     9027    1           IF  NMD_PIT.DEV.DCT$(I)->DCT.STATUS.DOWN
      466     9028    1           OR  NMD_PIT.DEV.DCT$(I)->DCT.STATUS.SYSCON_PART
      467     9029    1           OR  NMD_PIT.DEV.DCT$(I)->DCT.STATUS.MSOS_PART
      468     9030    2           THEN DO ;
      469     9031        /*E*
      470     9032        ERROR:  NMV-E$NMD#PARTITIONED-5
      471     9033        MESSAGE:  %U1 is partitioned.
      472     9034        DESCRIPTION:  For the specified operation, the disk device
      473     9035                      cannot be partitoned or marked for delayed
      474     9036                      partitioning.
      475     9037        */
      476     9038    2               CALL NME$ERRMSG ( NMV#PARTITIONED, ,
      477     9039    2                                 VECTOR(NMD_PIT.DEV.NAME(I)) ) ;
      478     9040    2               ALTRETURN ;
      479     9041    2               END ;
      480     9042
      481     9043    1           RETURN ;
      482     9044
      483     9045        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:20   
      484     9046        /*D*
      485     9047        NAME:           NMV$PACKSIZE
      486     9048
      487     9049        CALL:           CALL NMV$PACKSIZE  ALTRET ( error ) ;
      488     9050
      489     9051        PARAMETERS:     None.
      490     9052
      491     9053        DESCRIPTION:
      492     9054
      493     9055        The NMV$PACKSIZE procedure is used to verify that the
      494     9056        packsizes of the two specified devices are the same.
      495     9057        If the packsizes are the same, NMD_PIT.PACKSIZEM1 is
      496     9058        calculated, and this routine returns to the calling
      497     9059        procedure.  If the packsizes are not the same, and
      498     9060        error message is printed, and this routine makes an
      499     9061        altreturn to the calling procedure.
      500     9062
      501     9063        */
      502     9064
      503     9065        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:21   
      504     9066    1   NMV$PACKSIZE:           ENTRY           ALTRET ;
      505     9067
      506     9068
      507     9069
      508     9070    1           IF  NMD_PIT.DEV.PACKSIZE(0) ~= NMD_PIT.DEV.PACKSIZE(1)
      509     9071    2           THEN DO ;
      510     9072        /*E*
      511     9073        ERROR:  NMV-E$NMD#BAD_PACKSIZE-5
      512     9074        MESSAGE:  PACKSIZE doesn't match.
      513     9075        DESCRIPTION:  The PACKSIZE must match on Mirrored Disk devices.
      514     9076                      This error indicates an error in the selection of
      515     9077                      incompatible devices for the Mirrored Disk devices.
      516     9078        */
      517     9079    2               CALL NME$ERRMSG ( NMV#BAD_PACKSIZE ) ;
      518     9080    2               ALTRETURN ;
      519     9081    2               END ;
      520     9082
      521     9083    1           NMD_PIT.PACKSIZE = NMD_PIT.DEV.PACKSIZE(0) ;
      522     9084
      523     9085    1           RETURN ;
      524     9086
      525     9087        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:22   
      526     9088        /*D*
      527     9089        NAME:           NMV$PAIR
      528     9090
      529     9091        CALL:           CALL NMV$PAIR ALTRET ( error ) ;
      530     9092
      531     9093        PARAMETERS:     None.
      532     9094
      533     9095        DESCRIPTION:
      534     9096
      535     9097        The NMV$PAIR procedure is used to verify that the
      536     9098        Mirrored Disk devices are mirrors of each other (i.e.,
      537     9099        a Mirrored Disk pair).  If the devices are a pair,
      538     9100        this routine merely returns.  If the devices are not
      539     9101        a pair, an error message is printed, and this routine
      540     9102        makes an altreturn to the calling procedure.
      541     9103
      542     9104        */
      543     9105
      544     9106        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:23   
      545     9107    1   NMV$PAIR:               ENTRY           ALTRET ;
      546     9108
      547     9109
      548     9110
      549     9111    1           IF  NMD_PIT.DEV.DCT$(0)->DCT.DP.MIRROR.DCTX ~= NMD_PIT.DEV.DCTX(1)
      550     9112    1           OR  NMD_PIT.DEV.DCT$(1)->DCT.DP.MIRROR.DCTX ~= NMD_PIT.DEV.DCTX(0)
      551     9113    2           THEN DO ;
      552     9114        /*E*
      553     9115        ERROR:  NMV-E$NMD#NOT_PAIR-5
      554     9116        MESSAGE:  %U1 is not a mirror of %U2.
      555     9117        DESCRIPTION:  %U1 and %U2 are Mirrored Disks.  But they are not
      556     9118                      mirrors of each other.
      557     9119        */
      558     9120    2               CALL NME$ERRMSG ( NMV#NOT_PAIR, ,
      559     9121    2                                 VECTOR(NMD_PIT.DEV.NAME(0)),
      560     9122    2                                 VECTOR(NMD_PIT.DEV.NAME(1)) ) ;
      561     9123    2               ALTRETURN ;
      562     9124    2               END ;
      563     9125
      564     9126    1           RETURN ;
      565     9127
      566     9128        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:24   
      567     9129        /*D*
      568     9130        NAME:           NMV$PART
      569     9131
      570     9132        CALL:           CALL NMV$PART ( i ) ALTRET ( error ) ;
      571     9133
      572     9134        PARAMETERS:
      573     9135        */
      574     9136        /*K*
      575     9137        i               is a UBIN WORD that specifies the DEV index.
      576     9138                i must be either 0 or 1.
      577     9139        */
      578     9140        /*D*
      579     9141        DESCRIPTION:
      580     9142
      581     9143        The NMV$PART procedure is used to verify that DEV(i)
      582     9144        is partitioned.  If the device is partitioned, this routine
      583     9145        simply returns.  If the device is not partitioned, an
      584     9146        error message is printed, and an altreturn is made to
      585     9147        the calling procedure.
      586     9148
      587     9149        */
      588     9150
      589     9151        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:25   
      590     9152    1   NMV$PART:               ENTRY ( I )     ALTRET ;
      591     9153
      592     9154
      593     9155
      594     9156    1           IF  NOT NMD_PIT.DEV.DCT$(I)->DCT.STATUS.DOWN
      595     9157    2           THEN DO ;
      596     9158        /*E*
      597     9159        ERROR:  NMV-E$NMD#NOT_PART-5
      598     9160        MESSAGE:  %U1 is not partitioned.
      599     9161        DESCRIPTION:  For the specified operation, if one Mirrored Disk
      600     9162                      device is partitioned, the other Mirrored Disk
      601     9163                      device must also be partitioned.
      602     9164        */
      603     9165    2               CALL NME$ERRMSG ( NMV#NOT_PART, ,
      604     9166    2                                 VECTOR(NMD_PIT.DEV.NAME(I)) ) ;
      605     9167    2               ALTRETURN ;
      606     9168    2               END ;
      607     9169
      608     9170    1           RETURN ;
      609     9171
      610     9172        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:26   
      611     9173        /*D*
      612     9174        NAME:           NMV$PRIMARY
      613     9175
      614     9176        CALL:           CALL NMV$PRIMARY ( i ) ALTRET ( error ) ;
      615     9177
      616     9178        PARAMETERS:
      617     9179        */
      618     9180        /*K*
      619     9181        i               is a UBIN WORD that specifies the DEV index.
      620     9182                i must be either 0 or 1.
      621     9183        */
      622     9184        /*D*
      623     9185        DESCRIPTION:
      624     9186
      625     9187        The NMV$PRIMARY procedure is used to verify that DEV(i)
      626     9188        is a primary Mirrored Disk device.  If the device is a
      627     9189        primary Mirrored Disk device, this routine simply returns.
      628     9190        If the device is not a primary Mirrored Disk device,
      629     9191        an error message is printed, and this routine makes an
      630     9192        altreturn to the calling procedure.
      631     9193
      632     9194        */
      633     9195
      634     9196        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:27   
      635     9197    1   NMV$PRIMARY:            ENTRY ( I )     ALTRET ;
      636     9198
      637     9199
      638     9200
      639     9201    1           IF  NOT NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.PRI
      640     9202    2           THEN DO ;
      641     9203        /*E*
      642     9204        ERROR:  NMV-E$NMD#NOT_PRIMARY-5
      643     9205        MESSAGE:  %U1 is not primary device.
      644     9206        DESCRIPTION:  For the specified operation, the specified device
      645     9207                      must be a primary Mirrored Disk device.
      646     9208        */
      647     9209    2               CALL NME$ERRMSG ( NMV#NOT_PRIMARY, ,
      648     9210    2                                 VECTOR(NMD_PIT.DEV.NAME(I)) ) ;
      649     9211    2               ALTRETURN ;
      650     9212    2               END ;
      651     9213
      652     9214    1           RETURN ;
      653     9215
      654     9216        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:28   
      655     9217        /*D*
      656     9218        NAME:           NMV$SAME_STATE
      657     9219
      658     9220        CALL:           CALL NMV$SAME_STATE ALTRET ( error ) ;
      659     9221
      660     9222        PARAMETERS:     None.
      661     9223
      662     9224        DESCRIPTION:
      663     9225
      664     9226        The NMV$SAME_STATE procedure is used to verify that both
      665     9227        Mirrored Disk devices are in the same state.  If they
      666     9228        are, this routine simply returns.  If they are not,
      667     9229        an error message is printed, and this routine makes
      668     9230        an altreturn to the calling procedure.
      669     9231
      670     9232        */
      671     9233
      672     9234        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:29   
      673     9235    1   NMV$SAME_STATE:         ENTRY           ALTRET ;
      674     9236
      675     9237
      676     9238
      677     9239    1           IF  NMD_PIT.DEV.DCT$(0)->DCT.DP.MIRROR.STATE ~=
      678     9240    1               NMD_PIT.DEV.DCT$(1)->DCT.DP.MIRROR.STATE
      679     9241    2           THEN DO ;
      680     9242        /*E*
      681     9243        ERROR:  NMV-E$NMD#NOT_SAME-5
      682     9244        MESSAGE:  Devices %U1 and %U2 must be in the same state.
      683     9245        DESCRIPTION:  For the specified operation, the devices must be in
      684     9246                      the same state.
      685     9247        */
      686     9248    2               CALL NME$ERRMSG ( NMV#NOT_SAME, ,
      687     9249    2                                 VECTOR(NMD_PIT.DEV.NAME(0)),
      688     9250    2                                 VECTOR(NMD_PIT.DEV.NAME(1))) ;
      689     9251    2               ALTRETURN ;
      690     9252    2               END ;
      691     9253
      692     9254    1           RETURN ;
      693     9255
      694     9256        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:30   
      695     9257        /*D*
      696     9258        NAME:           NMV$SCRATCH
      697     9259
      698     9260        CALL:           CALL NMV$SCRATCH ( i ) ALTRET ( error ) ;
      699     9261
      700     9262        PARAMETERS:
      701     9263        */
      702     9264        /*K*
      703     9265        i               is a UBIN WORD that specifies the DEV index.
      704     9266                i must be either 0 or 1.
      705     9267        */
      706     9268        /*D*
      707     9269        DESCRIPTION:
      708     9270
      709     9271        The NMV$SCRATCH procedure is used to verify that DEV(i)
      710     9272        is a scratch disk device.  DRZERO is calculated for
      711     9273        this device.  If this device is a scratch device,
      712     9274        this routine merely returns.  If it is not, an error
      713     9275        message is printed, and an altreturn is made to the
      714     9276        calling procedure.
      715     9277
      716     9278        */
      717     9279
      718     9280        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:31   
      719     9281    1   NMV$SCRATCH:            ENTRY ( I )     ALTRET ;
      720     9282
      721     9283
      722     9284
      723     9285    1           IF  (     NMD_PIT.DEV.VID$(I)->FM$VID.VOLCNT         = 0
      724     9286    1                 AND NMD_PIT.DEV.VID$(I)->FM$VID.SECTSTRT(1)    = 0 )
      725     9287    1           OR  ( NMD_PIT.DEV.VID$(I)->FM$VID.MIRROR.C           = 'MIRROR  '
      726     9288    1                AND NMD_PIT.DEV.VID$(I)->FM$VID.MIRROR.STATE(0) = %NI_MIRROR_FAIL )
      727     9289    2           THEN DO ;
      728     9290    2               NMD_PIT.DEV.FLAGS.SCRATCH(I) = '1'B ;
      729     9291    2               NMD_PIT.DEV.DRZERO(I)        = 0 ;
      730     9292    2               END ;
      731     9293    2           ELSE DO ;
      732     9294    2               NMD_PIT.DEV.FLAGS.SCRATCH(I) = '0'B ;
      733     9295    2               IF  NMD_PIT.DEV.VID$(I)->FM$VID.PSN = 'CP-6''S'
      734     9296    2               THEN
      735     9297    2                   NMD_PIT.DEV.DRZERO(I) = NMD_PIT.DEV.VID$(I)->FM$VID.SYSSIZE ;
      736     9298    2               ELSE
      737     9299    2                   NMD_PIT.DEV.DRZERO(I) = 0 ;
      738     9300    2               ALTRETURN ;
      739     9301    2               END ;
      740     9302
      741     9303    1           RETURN ;
      742     9304
      743     9305        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:32   
      744     9306        /*D*
      745     9307        NAME:           NMV$STATE
      746     9308
      747     9309        CALL:           CALL NMV$STATE ( i, state1[, state2 ] )
      748     9310                        ALTRET ( error ) ;
      749     9311
      750     9312        PARAMETERS:
      751     9313        */
      752     9314        /*K*
      753     9315        i               is a UBIN WORD that specifies the DEV index.
      754     9316                i must be either 0 or 1.
      755     9317        */
      756     9318        /*K*
      757     9319        state1          is a UBIN WORD that specifies the expected
      758     9320                state of the device.
      759     9321        */
      760     9322        /*K*
      761     9323        state2          is a UBIN WORD that specifies an optional
      762     9324                second expected state of the device.
      763     9325        */
      764     9326        /*D*
      765     9327        DESCRIPTION:
      766     9328
      767     9329        The NMV$STATE procedure is used to verify that DEV(i)
      768     9330        is in one of the specified states.  If the device is in one
      769     9331        of the specified states, this routine simply returns.  If the
      770     9332        device is not in the specified state, an error message
      771     9333        is printed, and an altreturn is made to the calling
      772     9334        procedure.
      773     9335
      774     9336        */
      775     9337
      776     9338        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:33   
      777     9339    1   NMV$STATE:              ENTRY ( I, STATE1, STATE2 ) ALTRET ;
      778     9340
      779     9341
      780     9342
      781     9343    1           IF  NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.STATE ~= STATE1
      782     9344    2           THEN DO ;
      783     9345    2               IF  ADDR(STATE2) = ADDR(NIL)
      784     9346    3               THEN DO ;
      785     9347        /*
      786     9348        ERROR:  NMV-E$NMD#NOT_STATE-5
      787     9349        MESSAGE:  (Previously defined.)
      788     9350        DESCRIPTION:  (Previously defined.)
      789     9351        */
      790     9352    3                   CALL NME$ERRMSG ( NMV#NOT_STATE, ,
      791     9353    3                                     VECTOR(NMD_PIT.DEV.NAME(I)),
      792     9354    3                                     NMD_PIT.STATE.V_(STATE1)             ) ;
      793     9355    3                   GOTO ERROR ;
      794     9356    3                   END ;
      795     9357
      796     9358    2               ELSE IF  NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.STATE ~= STATE2
      797     9359    3               THEN DO ;
      798     9360        /*E*
      799     9361        ERROR:  NMV-E$NMD#NOT_STATES-5
      800     9362        MESSAGE:  Device %U1 is not %U2 or %U3.
      801     9363        DESCRIPTION:  For the specified operation, the device must be
      802     9364                      in one of the specified states.
      803     9365        */
      804     9366    3                   CALL NME$ERRMSG ( NMV#NOT_STATES,
      805     9367    3                                     VECTOR(NMD_PIT.DEV.NAME(I)),
      806     9368    3                                     NMD_PIT.STATE.V_(STATE1),
      807     9369    3                                     NMD_PIT.STATE.V_(STATE2)              ) ;
      808     9370    3                   GOTO ERROR ;
      809     9371    3                   END ;
      810     9372    2               END ;
      811     9373
      812     9374    1           RETURN ;
      813     9375
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:34   
      814     9376    1   ERROR:  ALTRETURN ;
      815     9377
      816     9378        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:35   
      817     9379        /*D*
      818     9380        NAME:           NMV$VSN
      819     9381
      820     9382        CALL:           CALL NMV$VSN ALTRET ( error ) ;
      821     9383
      822     9384        PARAMETERS:     None.
      823     9385
      824     9386        DESCRIPTION:
      825     9387
      826     9388        The NMV$VSN procedure is used to verify that both
      827     9389        Mirrored Disk devices have the same VSN.  If they do,
      828     9390        this routine simply returns.  If they don't, an error
      829     9391        message is printed, and an altreturn is made to the calling
      830     9392        procedure.
      831     9393
      832     9394        */
      833     9395
      834     9396        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:36   
      835     9397    1   NMV$VSN:                ENTRY           ALTRET ;
      836     9398
      837     9399
      838     9400
      839     9401    1           IF  NMD_PIT.DEV.VID$(0) -> FM$VID.VSN ~=
      840     9402    1               NMD_PIT.DEV.VID$(1) -> FM$VID.VSN
      841     9403    2           THEN DO ;
      842     9404        /*E*
      843     9405        ERROR:  NMV-E$NMD#BAD_VSN-5
      844     9406        MESSAGE:  VSN doesn't match.
      845     9407        DESCRIPTION:  The VSN must match on Mirrored Disk devices.
      846     9408                      This error indicates an error in the preparation or
      847     9409                      selection of the devices used for the Mirrored Disk devices.
      848     9410        */
      849     9411    2               CALL NME$ERRMSG ( NMV#BAD_VSN ) ;
      850     9412    2               ALTRETURN ;
      851     9413    2               END ;
      852     9414    2           ELSE DO ;
      853     9415    2               NMD_PIT.DEV.VSN(0) = NMD_PIT.DEV.VID$(0)->FM$VID.VSN ;
      854     9416    2               NMD_PIT.DEV.VSN(1) = NMD_PIT.DEV.VID$(1)->FM$VID.VSN ;
      855     9417    2               END ;
      856     9418
      857     9419    1           RETURN ;
      858     9420
      859     9421    1           END NMV$VERIFY ;

PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:37   
--  Include file information  --

   NM_SUBS_C.:E05TOU  is referenced.
   NM_EQU_E.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NM_MACRO_M.:E05TOU  is referenced.
   NM_PERR_C.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NMV$VERIFY.

   Procedure NMV$VERIFY requires 506 words for executable code.
   Procedure NMV$VERIFY requires 22 words of local(AUTO) storage.

    No errors detected in file NMV$VERIFY.:E05TSI    .

PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:38   

 Object Unit name= NMV$VERIFY                                 File name= NMV$VERIFY.:E05TOU
 UTS= JUL 30 '97 03:51:16.76 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     18     22  NMV$VERIFY
    2   Proc  even  none   506    772  NMV$VERIFY
    3  RoData even  none    24     30  NMV$VERIFY

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        3  NMV$VERIFY
     2      3          yes     yes      Std        1  NMV$CHGSTATE
     2     56          yes     yes      Std        0  NMV$DEV
     2    101          yes     yes      Std        0  NMV$DGT
     2    137          yes     yes      Std        1  NMV$MIRRORED
     2    171          yes     yes      Std        2  NMV$MSTATE
     2    243          yes     yes      Std        1  NMV$NOTMIRRORED
     2    275          yes     yes      Std        1  NMV$NOTPART
     2    345          yes     yes      Std        0  NMV$PACKSIZE
     2    361          yes     yes      Std        0  NMV$PAIR
     2    410          yes     yes      Std        1  NMV$PART
     2    442          yes     yes      Std        1  NMV$PRIMARY
     2    475          yes     yes      Std        0  NMV$SAME_STATE
     2    520          yes     yes      Std        1  NMV$SCRATCH
     2    631          yes     yes      Std        3  NMV$STATE
     2    752          yes     yes      Std        0  NMV$VSN
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:39   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       6 NME$ERRMSG
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B$TCB$                                NMD_PIT
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:40   


        1        1        /*M* NMV$VERIFY - Verify devices specified                         */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DFC=YES, DMC=YES, EDMC=YES                                    */
        8        8        /*F*
        9        9        NAME:           NMV$VERIFY
       10       10
       11       11        PURSPOSE:       To verify the devices specified
       12       12        */
       13       13        NMV$VERIFY:     PROC ( I, STATE1, STATE2 ) ALTRET ;

     13  2 000000   000000 700200 xent  NMV$VERIFY   TSX0  ! X66_AUTO_3
         2 000001   000026 000003                    ZERO    22,3
         2 000002   000005 710000 2                  TRA     s:8756

       14       14        /*
       15       15                        Includes
       16       16        */
       17       17        %INCLUDE                CP_6 ;
       18     5576        %INCLUDE                FM$GRAN ;
       19     5645        %INCLUDE                NI$TABLES ;
       20     5861        %INCLUDE                NI_DATA_C ;
       21     5974        %INCLUDE                NM_PERR_C ;
       22     6051        %INCLUDE                NM_MACRO_M ;
       23     7456        /*
       24     7457                        Parameters
       25     7458        */
       26     7459    1   DCL 1 I                 SBIN WORD ALIGNED PARAM ;
       27     7460    1   DCL 1 STATE1            SBIN WORD ALIGNED PARAM ;
       28     7461    1   DCL 1 STATE2            SBIN WORD ALIGNED PARAM ;
       29     7462        /*
       30     7463                        Entries
       31     7464        */
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:41   
       32     7465    1   DCL 1 NME$ERRMSG        ENTRY(6) ;
       33     7466    1   DCL 1 NMU$READ          ENTRY(3) ALTRET ;
       34     7467        /*
       35     7468                        Variables
       36     7469        */
       37     7470                                %B$ALT ( NAME =
       38     7471              B$ALT             , STCLASS = BASED
       39     7472                                                                        ) ;
       40     7480                                %B$TCB ( NAME =
       41     7481              B$TCB             , STCLASS = "BASED(B$TCB$)"
       42     7482                                                                        ) ;
       43     7485    1   DCL 1 B$TCB$            PTR SYMREF ;
       44     7486                                %NI$DCT ( NAME =
       45     7487              DCT               , STCLASS = BASED
       46     7488                                                                        ) ;
       47     7536                                %FM$VID ( FM$VID =
       48     7537              FM$VID            , BASED = BASED
       49     7538                                                                        ) ;
       50     7544    1   DCL 1 J                 SBIN WORD ALIGNED AUTO ;
       51     7545                                %NMD_PIT ( FPTN =
       52     7546              NMD_PIT           , STCLASS = SYMREF
       53     7547                                                                        ) ;
       54     8000                                %VLP_ERRCODE ( FPTN =
       55     8001              NMV#BAD_DGT       , STCLASS = CONSTANT
       56     8002                                , ERR# = %E$NMD#BAD_DGT
       57     8003                                , FCG  = %NMD#FCG
       58     8004                                , MID  = 'V'
       59     8005                                , MON  = %NO#
       60     8006                                , SEV  = 5
       61     8007                                                                        ) ;
       62     8052                                %VLP_ERRCODE ( FPTN =
       63     8053              NMV#BAD_PACKSIZE  , STCLASS = CONSTANT
       64     8054                                , ERR# = %E$NMD#BAD_PACKSIZE
       65     8055                                , FCG  = %NMD#FCG
       66     8056                                , MID  = 'V'
       67     8057                                , MON  = %NO#
       68     8058                                , SEV  = 5
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:42   
       69     8059                                                                        ) ;
       70     8104                                %VLP_ERRCODE ( FPTN =
       71     8105              NMV#BAD_VSN       , STCLASS = CONSTANT
       72     8106                                , ERR# = %E$NMD#BAD_VSN
       73     8107                                , FCG  = %NMD#FCG
       74     8108                                , MID  = 'V'
       75     8109                                , MON  = %NO#
       76     8110                                , SEV  = 5
       77     8111                                                                        ) ;
       78     8156                                %VLP_ERRCODE ( FPTN =
       79     8157              NMV#NOT_MIRRORED  , STCLASS = CONSTANT
       80     8158                                , ERR# = %E$NMD#NOT_MIRRORED
       81     8159                                , FCG  = %NMD#FCG
       82     8160                                , MID  = 'V'
       83     8161                                , MON  = %NO#
       84     8162                                , SEV  = 5
       85     8163                                                                        ) ;
       86     8208                                %VLP_ERRCODE ( FPTN =
       87     8209              NMV#NOT_PAIR      , STCLASS = CONSTANT
       88     8210                                , ERR# = %E$NMD#NOT_PAIR
       89     8211                                , FCG  = %NMD#FCG
       90     8212                                , MID  = 'V'
       91     8213                                , MON  = %NO#
       92     8214                                , SEV  = 5
       93     8215                                                                        ) ;
       94     8260                                %VLP_ERRCODE ( FPTN =
       95     8261              NMV#NOT_PART      , STCLASS = CONSTANT
       96     8262                                , ERR# = %E$NMD#NOT_PART
       97     8263                                , FCG  = %NMD#FCG
       98     8264                                , MID  = 'V'
       99     8265                                , MON  = %NO#
      100     8266                                , SEV  = 5
      101     8267                                                                        ) ;
      102     8312                                %VLP_ERRCODE ( FPTN =
      103     8313              NMV#NOT_PRIMARY  , STCLASS = CONSTANT
      104     8314                                , ERR# = %E$NMD#NOT_PRIMARY
      105     8315                                , FCG  = %NMD#FCG
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:43   
      106     8316                                , MID  = 'V'
      107     8317                                , MON  = %NO#
      108     8318                                , SEV  = 5
      109     8319                                                                        ) ;
      110     8364                                %VLP_ERRCODE ( FPTN =
      111     8365              NMV#NOT_SAME      , STCLASS = CONSTANT
      112     8366                                , ERR# = %E$NMD#NOT_SAME
      113     8367                                , FCG  = %NMD#FCG
      114     8368                                , MID  = 'V'
      115     8369                                , MON  = %NO#
      116     8370                                , SEV  = 5
      117     8371                                                                        ) ;
      118     8416                                %VLP_ERRCODE ( FPTN =
      119     8417              NMV#NOT_STATE     , STCLASS = CONSTANT
      120     8418                                , ERR# = %E$NMD#NOT_STATE
      121     8419                                , FCG  = %NMD#FCG
      122     8420                                , MID  = 'V'
      123     8421                                , MON  = %NO#
      124     8422                                , SEV  = 5
      125     8423                                                                        ) ;
      126     8468                                %VLP_ERRCODE ( FPTN =
      127     8469              NMV#NOT_STATES    , STCLASS = CONSTANT
      128     8470                                , ERR# = %E$NMD#NOT_STATES
      129     8471                                , FCG  = %NMD#FCG
      130     8472                                , MID  = 'V'
      131     8473                                , MON  = %NO#
      132     8474                                , SEV  = 5
      133     8475                                                                        ) ;
      134     8520                                %VLP_ERRCODE ( FPTN =
      135     8521              NMV#NOW_MIRRORED  , STCLASS = CONSTANT
      136     8522                                , ERR# = %E$NMD#NOW_MIRRORED
      137     8523                                , FCG  = %NMD#FCG
      138     8524                                , MID  = 'V'
      139     8525                                , MON  = %NO#
      140     8526                                , SEV  = 5
      141     8527                                                                        ) ;
      142     8572                                %VLP_ERRCODE ( FPTN =
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:44   
      143     8573              NMV#PARTITIONED   , STCLASS = CONSTANT
      144     8574                                , ERR# = %E$NMD#PARTITIONED
      145     8575                                , FCG  = %NMD#FCG
      146     8576                                , MID  = 'V'
      147     8577                                , MON  = %NO#
      148     8578                                , SEV  = 5
      149     8579                                                                        ) ;
      150     8624                                %VLP_ERRCODE ( FPTN =
      151     8625              NMV#SAME_DEV      , STCLASS = CONSTANT
      152     8626                                , ERR# = %E$NMD#SAME_DEV
      153     8627                                , FCG  = %NMD#FCG
      154     8628                                , MID  = 'V'
      155     8629                                , MON  = %NO#
      156     8630                                , SEV  = 5
      157     8631                                                                        ) ;
      158     8676                                %VLP_ERRCODE ( FPTN =
      159     8677              NMV#STATE_CHANGED , STCLASS = CONSTANT
      160     8678                                , ERR# = %E$NMD#STATE_CHANGED
      161     8679                                , FCG  = %NMD#FCG
      162     8680                                , MID  = 'V'
      163     8681                                , MON  = %NO#
      164     8682                                , SEV  = 3
      165     8683                                                                        ) ;
      166     8728    1   DCL 1 S1                SBIN WORD ALIGNED AUTO ;
      167     8729    1   DCL 1 S2                SBIN WORD ALIGNED AUTO ;
      168     8730        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:45   
      169     8731        /*D*
      170     8732        NAME:           NMV$CHGSTATE
      171     8733
      172     8734        CALL:           CALL NMV$CHGSTATE ( i ) ALTRET ( error ) ;
      173     8735
      174     8736        PARAMETERS:
      175     8737        */
      176     8738        /*K*
      177     8739        i               is a UBIN WORD that specifies the DEV index.
      178     8740                i must be either 0 or 1.
      179     8741        */
      180     8742        /*D*
      181     8743        DESCRIPTION:
      182     8744
      183     8745        The NMV$CHGSTATE procedure is used to report the "device
      184     8746        unexpectedly changed state" error message.  It always
      185     8747        makes an altreturn to the calling procedure.
      186     8748
      187     8749        */
      188     8750
      189     8751        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:46   
      190     8752    1   NMV$CHGSTATE:           ENTRY ( I )     ALTRET ;

   8752  2 000003   000000 700200 xent  NMV$CHGSTATE TSX0  ! X66_AUTO_3
         2 000004   000026 000003                    ZERO    22,3

      191     8753
      192     8754
      193     8755
      194     8756    1           S1 = NMD_PIT.DEV.STATE(I) ;

   8756  2 000005   200003 470500                    LDP0    @I,,AUTO
         2 000006   000000 236100                    LDQ     0,,PR0
         2 000007   000015 402007                    MPY     13,DL
         2 000010   000001 736000                    QLS     1
         2 000011   000025 235006 xsym               LDA     NMD_PIT+21,QL
         2 000012   200007 755100                    STA     S1,,AUTO

      195     8757    1           S2 = NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.STATE ;

   8757  2 000013   000000 236100                    LDQ     0,,PR0
         2 000014   000015 402007                    MPY     13,DL
         2 000015   000001 736000                    QLS     1
         2 000016   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000017   100036 236100                    LDQ     30,,PR1
         2 000020   000030 772000                    QRL     24
         2 000021   000077 376007                    ANQ     63,DL
         2 000022   200010 756100                    STQ     S2,,AUTO

      196     8758        /*E*
      197     8759        ERROR:  NMV-E$NMD#STATE_CHANGED-3
      198     8760        MESSAGE:  Command aborted:  %U1 state changed from %U2 to %U3
      199     8761        DESCRIPTION:  The command has been aborted because
      200     8762                      one of the devices unexpectedly changed state.
      201     8763                      This state change may have been caused either by
      202     8764                      an IO error or by some other user request.
      203     8765        */
      204     8766    1           CALL NME$ERRMSG ( NMV#STATE_CHANGED,
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:47   

   8766  2 000023   000000 236100                    LDQ     0,,PR0
         2 000024   000015 402007                    MPY     13,DL
         2 000025   000000 235000 3                  LDA     0
         2 000026   200012 756100                    STQ     S2+2,,AUTO
         2 000027   000023 736000                    QLS     19
         2 000030   000001 036000 3                  ADLQ    1
         2 000031   200014 757100                    STAQ    S2+4,,AUTO
         2 000032   200010 236100                    LDQ     S2,,AUTO
         2 000033   000023 736000                    QLS     19
         2 000034   000002 036000 3                  ADLQ    2
         2 000035   200022 756100                    STQ     S2+10,,AUTO
         2 000036   200007 236100                    LDQ     S1,,AUTO
         2 000037   000023 736000                    QLS     19
         2 000040   000002 036000 3                  ADLQ    2
         2 000041   200021 756100                    STQ     S2+9,,AUTO
         2 000042   200014 631500                    EPPR1   S2+4,,AUTO
         2 000043   200020 451500                    STP1    S2+8,,AUTO
         2 000044   200012 236100                    LDQ     S2+2,,AUTO
         2 000045   000023 736000                    QLS     19
         2 000046   000003 036000 3                  ADLQ    3
         2 000047   000004 235000 3                  LDA     4
         2 000050   200016 757100                    STAQ    S2+6,,AUTO
         2 000051   200016 630500                    EPPR0   S2+6,,AUTO
         2 000052   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000053   000000 701000 xent               TSX1    NME$ERRMSG
         2 000054   000000 011000                    NOP     0

      205     8767    1                             NMD_PIT.DEV.DCB#(I),
      206     8768    1                             VECTOR(NMD_PIT.DEV.NAME(I)),
      207     8769    1                             NMD_PIT.STATE.V_(S1),
      208     8770    1                             NMD_PIT.STATE.V_(S2) ) ;
      209     8771    1           ALTRETURN ;

   8771  2 000055   000000 702200 xent               TSX2  ! X66_AALT

      210     8772
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:48   
      211     8773        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:49   
      212     8774        /*D*
      213     8775        NAME:           NMV$DEV
      214     8776
      215     8777        CALL:           CALL NMV$DEV ALTRET ( error ) ;
      216     8778
      217     8779        PARAMETERS:     None.
      218     8780
      219     8781        DESCRIPTION:
      220     8782
      221     8783        The NMV$DEV procedure is used to verify that both
      222     8784        Mirrored Disk devices are different devices.  If they
      223     8785        are, this routine simply returns.  If they are not,
      224     8786        an error message is printed, and this routine makes
      225     8787        an altreturn to the calling procedure.
      226     8788
      227     8789        */
      228     8790
      229     8791        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:50   
      230     8792    1   NMV$DEV:                ENTRY           ALTRET ;

   8792  2 000056   000000 700200 xent  NMV$DEV      TSX0  ! X66_AUTO_3
         2 000057   000026 000003                    ZERO    22,3

      231     8793
      232     8794
      233     8795
      234     8796    1           IF  NMD_PIT.DEV.DCT$(0)->DCT.DEVNM =

   8796  2 000060   000010 470400 xsym               LDP0    NMD_PIT+8
         2 000061   000042 471400 xsym               LDP1    NMD_PIT+34
         2 000062   040100 106500                    CMPC    fill='040'O
         2 000063   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         2 000064   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         2 000065   000100 601000 2                  TNZ     s:8811

      235     8797    1               NMD_PIT.DEV.DCT$(1)->DCT.DEVNM
      236     8798    2           THEN DO ;

      237     8799        /*E*
      238     8800        ERROR:  NMV-E$NMD#SAME_DEV-5
      239     8801        MESSAGE:  Devices %U1 and %U2 are the same device.
      240     8802        DESCRIPTION:  For the specified operation, the devices must be
      241     8803                      different devices.
      242     8804        */
      243     8805    2               CALL NME$ERRMSG ( NMV#SAME_DEV, ,

   8805  2 000066   000010 237000 3                  LDAQ    8
         2 000067   200014 757100                    STAQ    S2+4,,AUTO
         2 000070   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000071   000012 235000 3                  LDA     10
         2 000072   200012 757100                    STAQ    S2+2,,AUTO
         2 000073   200012 630500                    EPPR0   S2+2,,AUTO
         2 000074   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000075   000000 701000 xent               TSX1    NME$ERRMSG
         2 000076   000000 011000                    NOP     0
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:51   

      244     8806    2                                 VECTOR(NMD_PIT.DEV.NAME(0)),
      245     8807    2                                 VECTOR(NMD_PIT.DEV.NAME(1))) ;
      246     8808    2               ALTRETURN ;

   8808  2 000077   000000 702200 xent               TSX2  ! X66_AALT

      247     8809    2               END ;
      248     8810
      249     8811    1           RETURN ;

   8811  2 000100   000000 702200 xent               TSX2  ! X66_ARET

      250     8812
      251     8813        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:52   
      252     8814        /*D*
      253     8815        NAME:           NMV$DGT
      254     8816
      255     8817        CALL:           CALL NMV$DGT ALTRET ( error ) ;
      256     8818
      257     8819        PARAMETERS:     None.
      258     8820
      259     8821        DESCRIPTION:
      260     8822
      261     8823        The NMV$DGT procedure is used to verify the defective
      262     8824        granule tables (DGTs) of the devices specified on the
      263     8825        command line.  If the DGTs match, NMD_PIT.DGT is setup.
      264     8826        If the DGTs don't match, an error message is printed
      265     8827        and an altreturn is made to the calling procedure.
      266     8828
      267     8829        */
      268     8830
      269     8831        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:53   
      270     8832    1   NMV$DGT:                ENTRY           ALTRET ;

   8832  2 000101   000000 700200 xent  NMV$DGT      TSX0  ! X66_AUTO_3
         2 000102   000026 000003                    ZERO    22,3

      271     8833
      272     8834
      273     8835
      274     8836    2           DO  J = 0 TO 63 ;

   8836  2 000103   200006 450100                    STZ     J,,AUTO

      275     8837    2               IF  NMD_PIT.DEV.VID$(0)->FM$VID.DGT(J) ~=

   8837  2 000104   000064 470400 xsym               LDP0    NMD_PIT+52
         2 000105   200006 720100                    LXL0    J,,AUTO
         2 000106   000032 471400 xsym               LDP1    NMD_PIT+26
         2 000107   100300 236110                    LDQ     192,X0,PR1
         2 000110   000300 116110                    CMPQ    192,X0,PR0
         2 000111   000117 600000 2                  TZE     s:8852

      276     8838    2                   NMD_PIT.DEV.VID$(1)->FM$VID.DGT(J)
      277     8839    3               THEN DO ;

      278     8840        /*E*
      279     8841        ERROR:  NMV-E$NMD#BAD_DGT-5
      280     8842        MESSAGE:  Defective Granule Tables (DGTs) don't match.
      281     8843        DESCRIPTION:  The Defective Track Table (DTT) and Defective Granule
      282     8844                      Table (DGT) must match on Mirrored Disk devices.
      283     8845                      This error indicates an error in the VOLINIT of the
      284     8846                      Mirrored Disk devices.
      285     8847        */
      286     8848    3                   CALL NME$ERRMSG ( NMV#BAD_DGT ) ;

   8848  2 000112   000013 630400 3                  EPPR0   11
         2 000113   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000114   000000 701000 xent               TSX1    NME$ERRMSG
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:54   
         2 000115   000000 011000                    NOP     0

      287     8849    3                   ALTRETURN ;

   8849  2 000116   000000 702200 xent               TSX2  ! X66_AALT

      288     8850    3                   END ;
      289     8851    3               ELSE DO ;

      290     8852    3                   NMD_PIT.DGT.FGRAN(J) = NMD_PIT.DEV.VID$(0)->FM$VID.DGT.FGRAN(J) ;

   8852  2 000117   100300 236110                    LDQ     192,X0,PR1
         2 000120   000022 772000                    QRL     18
         2 000121   000067 756010 xsym               STQ     NMD_PIT+55,X0

      291     8853    3                   NMD_PIT.DGT.LGRAN(J) = NMD_PIT.DEV.VID$(1)->FM$VID.DGT.LGRAN(J) ;

   8853  2 000122   000064 470400 xsym               LDP0    NMD_PIT+52
         2 000123   000300 236110                    LDQ     192,X0,PR0
         2 000124   777777 376007                    ANQ     -1,DL
         2 000125   000170 756010 xsym               STQ     NMD_PIT+120,X0

      292     8854    3                   END ;

      293     8855    2               END ;

   8855  2 000126   200006 054100                    AOS     J,,AUTO
         2 000127   200006 235100                    LDA     J,,AUTO
         2 000130   000077 115007                    CMPA    63,DL
         2 000131   000104 604400 2                  TMOZ    s:8837

      294     8856
      295     8857    1           NMD_PIT.DGT.I = 0 ;

   8857  2 000132   000066 450000 xsym               STZ     NMD_PIT+54

      296     8858
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:55   
      297     8859    1           NMD_PIT.DGT.FGRAN(64) = NMD_PIT.PACKSIZE ;

   8859  2 000133   000307 236000 xsym               LDQ     NMD_PIT+199
         2 000134   000167 756000 xsym               STQ     NMD_PIT+119

      298     8860    1           NMD_PIT.DGT.LGRAN(64) = NMD_PIT.PACKSIZE ;

   8860  2 000135   000270 756000 xsym               STQ     NMD_PIT+184

      299     8861
      300     8862    1           RETURN ;

   8862  2 000136   000000 702200 xent               TSX2  ! X66_ARET

      301     8863
      302     8864        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:56   
      303     8865        /*D*
      304     8866        NAME:           NMV$MIRRORED
      305     8867
      306     8868        CALL:           CALL NMV$MIRRORED ( i ) ALTRET ( error ) ;
      307     8869
      308     8870        PARAMETERS:
      309     8871        */
      310     8872        /*K*
      311     8873        i               is a UBIN WORD that specifies the DEV index.
      312     8874                i must be either 0 or 1.
      313     8875        */
      314     8876        /*D*
      315     8877        DESCRIPTION:
      316     8878
      317     8879        The NMV$MIRRORED procedure is used to verify that DEV(i)
      318     8880        is a Mirrored Disk device.  If the device is a Mirrored
      319     8881        Disk device, this routine simply returns.  If the device
      320     8882        is not a Mirrored Disk device, an error message is printed
      321     8883        and this routine makes an altreturn to the calling procedure.
      322     8884
      323     8885        */
      324     8886
      325     8887        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:57   
      326     8888    1   NMV$MIRRORED:   ENTRY ( I )     ALTRET ;

   8888  2 000137   000000 700200 xent  NMV$MIRRORED TSX0  ! X66_AUTO_3
         2 000140   000026 000003                    ZERO    22,3

      327     8889
      328     8890
      329     8891
      330     8892    1           IF  NOT NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.FLAG

   8892  2 000141   200003 470500                    LDP0    @I,,AUTO
         2 000142   000000 236100                    LDQ     0,,PR0
         2 000143   000015 402007                    MPY     13,DL
         2 000144   000001 736000                    QLS     1
         2 000145   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000146   100036 234100                    SZN     30,,PR1
         2 000147   000170 604000 2                  TMI     s:8904

      331     8893    2           THEN DO ;

      332     8894        /*E*
      333     8895        ERROR:  NMV-E$NMD#NOT_MIRRORED-5
      334     8896        MESSAGE:  %U1 is not a Mirrored Disk
      335     8897        DESCRIPTION:  The specified device must be a Mirrored Disk device.
      336     8898        */
      337     8899    2               CALL NME$ERRMSG ( NMV#NOT_MIRRORED, ,

   8899  2 000150   000000 236100                    LDQ     0,,PR0
         2 000151   000015 402007                    MPY     13,DL
         2 000152   000000 235000 3                  LDA     0
         2 000153   000023 736000                    QLS     19
         2 000154   000001 036000 3                  ADLQ    1
         2 000155   200012 757100                    STAQ    S2+2,,AUTO
         2 000156   200012 631500                    EPPR1   S2+2,,AUTO
         2 000157   200016 451500                    STP1    S2+6,,AUTO
         2 000160   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000161   000014 235000 3                  LDA     12
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:58   
         2 000162   200014 757100                    STAQ    S2+4,,AUTO
         2 000163   200014 630500                    EPPR0   S2+4,,AUTO
         2 000164   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000165   000000 701000 xent               TSX1    NME$ERRMSG
         2 000166   000000 011000                    NOP     0

      338     8900    2                                 VECTOR(NMD_PIT.DEV.NAME(I)) ) ;
      339     8901    2               ALTRETURN ;

   8901  2 000167   000000 702200 xent               TSX2  ! X66_AALT

      340     8902    2               END ;
      341     8903
      342     8904    1           RETURN ;

   8904  2 000170   000000 702200 xent               TSX2  ! X66_ARET

      343     8905
      344     8906        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:59   
      345     8907        /*D*
      346     8908        NAME:           NMV$MSTATE
      347     8909
      348     8910        CALL:           CALL NMV$MSTATE ( i, state1 ) ALTRET ( error ) ;
      349     8911
      350     8912        PARAMETERS:
      351     8913        */
      352     8914        /*K*
      353     8915        i               is a UBIN WORD that specifies the DEV index.
      354     8916                i must be either 0 or 1.
      355     8917        */
      356     8918        /*K*
      357     8919        state1          is a UBIN WORD that specifies the expected
      358     8920                state of the mirror of the specified device.
      359     8921        */
      360     8922        /*D*
      361     8923        DESCRIPTION:
      362     8924
      363     8925        The NMV$MSTATE procedure is used to verify that mirror
      364     8926        of the specified device is in the specified state.  If
      365     8927        the mirror is in the specified state, this routine
      366     8928        simple returns.  If the mirror is not in the specified
      367     8929        state, an error message is printed, and an altreturn
      368     8930        is made to the calling procedure.
      369     8931
      370     8932        */
      371     8933
      372     8934        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:60   
      373     8935    1   NMV$MSTATE:             ENTRY ( I, STATE1 ) ALTRET ;

   8935  2 000171   000000 700200 xent  NMV$MSTATE   TSX0  ! X66_AUTO_3
         2 000172   000026 000003                    ZERO    22,3

      374     8936
      375     8937
      376     8938
      377     8939    1           J = 1 - I ;

   8939  2 000173   200003 470500                    LDP0    @I,,AUTO
         2 000174   000000 235100                    LDA     0,,PR0
         2 000175   000027 675000 xsym               ERA     B_VECTNIL+23
         2 000176   000002 035007                    ADLA    2,DL
         2 000177   200006 755100                    STA     J,,AUTO

      378     8940
      379     8941    1           IF  NMD_PIT.DEV.DCT$(J)->DCT.DP.MIRROR.STATE ~= STATE1

   8941  2 000200   200006 236100                    LDQ     J,,AUTO
         2 000201   000032 402007                    MPY     26,DL
         2 000202   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000203   200004 473500                    LDP3    @STATE1,,AUTO
         2 000204   100036 236100                    LDQ     30,,PR1
         2 000205   000030 772000                    QRL     24
         2 000206   000077 376007                    ANQ     63,DL
         2 000207   300000 116100                    CMPQ    0,,PR3
         2 000210   000242 600000 2                  TZE     s:8955

      380     8942    2           THEN DO ;

      381     8943        /*E*
      382     8944        ERROR:  NMV-E$NMD#NOT_STATE-5
      383     8945        MESSAGE:  Device %U1 is not %U2.
      384     8946        DESCRIPTION:  For the specified operation, the device must be
      385     8947                      in the specified state.
      386     8948        */
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:61   
      387     8949    2               CALL NME$ERRMSG ( NMV#NOT_STATE, ,

   8949  2 000211   000000 235000 3                  LDA     0
         2 000212   200006 236100                    LDQ     J,,AUTO
         2 000213   200012 755100                    STA     S2+2,,AUTO
         2 000214   000032 402003                    MPY     26,DU
         2 000215   000001 036000 3                  ADLQ    1
         2 000216   200012 235100                    LDA     S2+2,,AUTO
         2 000217   200014 757100                    STAQ    S2+4,,AUTO
         2 000220   300000 235100                    LDA     0,,PR3
         2 000221   200020 755100                    STA     S2+8,,AUTO
         2 000222   200014 237100                    LDAQ    S2+4,,AUTO
         2 000223   200016 757100                    STAQ    S2+6,,AUTO
         2 000224   200020 236100                    LDQ     S2+8,,AUTO
         2 000225   000023 736000                    QLS     19
         2 000226   000002 036000 3                  ADLQ    2
         2 000227   200025 756100                    STQ     S2+13,,AUTO
         2 000230   200016 631500                    EPPR1   S2+6,,AUTO
         2 000231   200024 451500                    STP1    S2+12,,AUTO
         2 000232   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000233   000015 235000 3                  LDA     13
         2 000234   200022 757100                    STAQ    S2+10,,AUTO
         2 000235   200022 630500                    EPPR0   S2+10,,AUTO
         2 000236   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000237   000000 701000 xent               TSX1    NME$ERRMSG
         2 000240   000000 011000                    NOP     0

      388     8950    2                                 VECTOR(NMD_PIT.DEV.NAME(J)),
      389     8951    2                                 NMD_PIT.STATE.V_(STATE1)            ) ;
      390     8952    2               ALTRETURN ;

   8952  2 000241   000000 702200 xent               TSX2  ! X66_AALT

      391     8953    2               END ;
      392     8954
      393     8955    1           RETURN ;

PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:62   
   8955  2 000242   000000 702200 xent               TSX2  ! X66_ARET

      394     8956
      395     8957        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:63   
      396     8958        /*D*
      397     8959        NAME:           NMV$NOTMIRROED
      398     8960
      399     8961        CALL:           CALL NMV$NOTMIRROED ( i ) ALTRET ( error ) ;
      400     8962
      401     8963        PARAMETERS:
      402     8964        */
      403     8965        /*K*
      404     8966        i               is a UBIN WORD that specifies the DEV index.
      405     8967                i must be either 0 or 1.
      406     8968        */
      407     8969        /*D*
      408     8970        DESCRIPTION:
      409     8971
      410     8972        The NMV$NOTMIRROED procedure is used to verify that DEV(i)
      411     8973        is a not a Mirrored Disk device.  If the device is not a Mirrored
      412     8974        Disk device, this routine simply returns.  If the device
      413     8975        is a Mirrored Disk device, an error message is printed
      414     8976        and this routine makes an altreturn to the calling procedure.
      415     8977
      416     8978        */
      417     8979
      418     8980        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:64   
      419     8981    1   NMV$NOTMIRRORED:        ENTRY ( I )     ALTRET ;

   8981  2 000243   000000 700200 xent  NMV$NOTMIRR* TSX0  ! X66_AUTO_3
         2 000244   000026 000003                    ZERO    22,3

      420     8982
      421     8983
      422     8984
      423     8985    1           IF  NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.FLAG

   8985  2 000245   200003 470500                    LDP0    @I,,AUTO
         2 000246   000000 236100                    LDQ     0,,PR0
         2 000247   000015 402007                    MPY     13,DL
         2 000250   000001 736000                    QLS     1
         2 000251   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000252   100036 234100                    SZN     30,,PR1
         2 000253   000274 605000 2                  TPL     s:8997

      424     8986    2           THEN DO ;

      425     8987        /*E*
      426     8988        ERROR:  NMV-E$NMD#NOW_MIRRORED-5
      427     8989        MESSAGE:  %U1 already is a Mirrored Disk
      428     8990        DESCRIPTION:  The specified device must not be a Mirrored Disk device.
      429     8991        */
      430     8992    2               CALL NME$ERRMSG ( NMV#NOW_MIRRORED, ,

   8992  2 000254   000000 236100                    LDQ     0,,PR0
         2 000255   000015 402007                    MPY     13,DL
         2 000256   000000 235000 3                  LDA     0
         2 000257   000023 736000                    QLS     19
         2 000260   000001 036000 3                  ADLQ    1
         2 000261   200012 757100                    STAQ    S2+2,,AUTO
         2 000262   200012 631500                    EPPR1   S2+2,,AUTO
         2 000263   200016 451500                    STP1    S2+6,,AUTO
         2 000264   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000265   000016 235000 3                  LDA     14
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:65   
         2 000266   200014 757100                    STAQ    S2+4,,AUTO
         2 000267   200014 630500                    EPPR0   S2+4,,AUTO
         2 000270   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000271   000000 701000 xent               TSX1    NME$ERRMSG
         2 000272   000000 011000                    NOP     0

      431     8993    2                                 VECTOR(NMD_PIT.DEV.NAME(I)) ) ;
      432     8994    2               ALTRETURN ;

   8994  2 000273   000000 702200 xent               TSX2  ! X66_AALT

      433     8995    2               END ;
      434     8996
      435     8997    1           RETURN ;

   8997  2 000274   000000 702200 xent               TSX2  ! X66_ARET

      436     8998
      437     8999        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:66   
      438     9000        /*D*
      439     9001        NAME:           NMV$NOTPART
      440     9002
      441     9003        CALL:           CALL NMV$NOTPART ( i ) ALTRET ( error ) ;
      442     9004
      443     9005        PARAMETERS:
      444     9006        */
      445     9007        /*K*
      446     9008        i               is a UBIN WORD that specifies the DEV index.
      447     9009                i must be either 0 or 1.
      448     9010        */
      449     9011        /*D*
      450     9012        DESCRIPTION:
      451     9013
      452     9014        The NMV$NOTPART procedure is used to verify that DEV(i)
      453     9015        is not partitioned.  If the device is not partitioned, this routine
      454     9016        simply returns.  If the device is partitioned, an
      455     9017        error message is printed, and an altreturn is made to
      456     9018        the calling procedure.
      457     9019
      458     9020        */
      459     9021
      460     9022        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:67   
      461     9023    1   NMV$NOTPART:            ENTRY ( I )     ALTRET ;

   9023  2 000275   000000 700200 xent  NMV$NOTPART  TSX0  ! X66_AUTO_3
         2 000276   000026 000003                    ZERO    22,3

      462     9024
      463     9025
      464     9026
      465     9027    1           IF  NMD_PIT.DEV.DCT$(I)->DCT.STATUS.DOWN

   9027  2 000277   200003 470500                    LDP0    @I,,AUTO
         2 000300   000000 236100                    LDQ     0,,PR0
         2 000301   000015 402007                    MPY     13,DL
         2 000302   000001 736000                    QLS     1
         2 000303   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000304   100027 234100                    SZN     23,,PR1
         2 000305   000324 604000 2                  TMI     s:9038
         2 000306   000000 236100                    LDQ     0,,PR0
         2 000307   000015 402007                    MPY     13,DL
         2 000310   000001 736000                    QLS     1
         2 000311   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000312   100027 236100                    LDQ     23,,PR1
         2 000313   004000 316003                    CANQ    2048,DU
         2 000314   000324 601000 2                  TNZ     s:9038
         2 000315   000000 236100                    LDQ     0,,PR0
         2 000316   000015 402007                    MPY     13,DL
         2 000317   000001 736000                    QLS     1
         2 000320   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000321   100027 236100                    LDQ     23,,PR1
         2 000322   002000 316003                    CANQ    1024,DU
         2 000323   000344 600000 2                  TZE     s:9043

      466     9028    1           OR  NMD_PIT.DEV.DCT$(I)->DCT.STATUS.SYSCON_PART
      467     9029    1           OR  NMD_PIT.DEV.DCT$(I)->DCT.STATUS.MSOS_PART
      468     9030    2           THEN DO ;

      469     9031        /*E*
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:68   
      470     9032        ERROR:  NMV-E$NMD#PARTITIONED-5
      471     9033        MESSAGE:  %U1 is partitioned.
      472     9034        DESCRIPTION:  For the specified operation, the disk device
      473     9035                      cannot be partitoned or marked for delayed
      474     9036                      partitioning.
      475     9037        */
      476     9038    2               CALL NME$ERRMSG ( NMV#PARTITIONED, ,

   9038  2 000324   000000 236100                    LDQ     0,,PR0
         2 000325   000015 402007                    MPY     13,DL
         2 000326   000000 235000 3                  LDA     0
         2 000327   000023 736000                    QLS     19
         2 000330   000001 036000 3                  ADLQ    1
         2 000331   200012 757100                    STAQ    S2+2,,AUTO
         2 000332   200012 631500                    EPPR1   S2+2,,AUTO
         2 000333   200016 451500                    STP1    S2+6,,AUTO
         2 000334   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000335   000017 235000 3                  LDA     15
         2 000336   200014 757100                    STAQ    S2+4,,AUTO
         2 000337   200014 630500                    EPPR0   S2+4,,AUTO
         2 000340   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000341   000000 701000 xent               TSX1    NME$ERRMSG
         2 000342   000000 011000                    NOP     0

      477     9039    2                                 VECTOR(NMD_PIT.DEV.NAME(I)) ) ;
      478     9040    2               ALTRETURN ;

   9040  2 000343   000000 702200 xent               TSX2  ! X66_AALT

      479     9041    2               END ;
      480     9042
      481     9043    1           RETURN ;

   9043  2 000344   000000 702200 xent               TSX2  ! X66_ARET

      482     9044
      483     9045        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:69   
      484     9046        /*D*
      485     9047        NAME:           NMV$PACKSIZE
      486     9048
      487     9049        CALL:           CALL NMV$PACKSIZE  ALTRET ( error ) ;
      488     9050
      489     9051        PARAMETERS:     None.
      490     9052
      491     9053        DESCRIPTION:
      492     9054
      493     9055        The NMV$PACKSIZE procedure is used to verify that the
      494     9056        packsizes of the two specified devices are the same.
      495     9057        If the packsizes are the same, NMD_PIT.PACKSIZEM1 is
      496     9058        calculated, and this routine returns to the calling
      497     9059        procedure.  If the packsizes are not the same, and
      498     9060        error message is printed, and this routine makes an
      499     9061        altreturn to the calling procedure.
      500     9062
      501     9063        */
      502     9064
      503     9065        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:70   
      504     9066    1   NMV$PACKSIZE:           ENTRY           ALTRET ;

   9066  2 000345   000000 700200 xent  NMV$PACKSIZE TSX0  ! X66_AUTO_3
         2 000346   000026 000003                    ZERO    22,3

      505     9067
      506     9068
      507     9069
      508     9070    1           IF  NMD_PIT.DEV.PACKSIZE(0) ~= NMD_PIT.DEV.PACKSIZE(1)

   9070  2 000347   000023 236000 xsym               LDQ     NMD_PIT+19
         2 000350   000055 116000 xsym               CMPQ    NMD_PIT+45
         2 000351   000357 600000 2                  TZE     s:9083

      509     9071    2           THEN DO ;

      510     9072        /*E*
      511     9073        ERROR:  NMV-E$NMD#BAD_PACKSIZE-5
      512     9074        MESSAGE:  PACKSIZE doesn't match.
      513     9075        DESCRIPTION:  The PACKSIZE must match on Mirrored Disk devices.
      514     9076                      This error indicates an error in the selection of
      515     9077                      incompatible devices for the Mirrored Disk devices.
      516     9078        */
      517     9079    2               CALL NME$ERRMSG ( NMV#BAD_PACKSIZE ) ;

   9079  2 000352   000020 630400 3                  EPPR0   16
         2 000353   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000354   000000 701000 xent               TSX1    NME$ERRMSG
         2 000355   000000 011000                    NOP     0

      518     9080    2               ALTRETURN ;

   9080  2 000356   000000 702200 xent               TSX2  ! X66_AALT

      519     9081    2               END ;
      520     9082
      521     9083    1           NMD_PIT.PACKSIZE = NMD_PIT.DEV.PACKSIZE(0) ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:71   

   9083  2 000357   000307 756000 xsym               STQ     NMD_PIT+199

      522     9084
      523     9085    1           RETURN ;

   9085  2 000360   000000 702200 xent               TSX2  ! X66_ARET

      524     9086
      525     9087        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:72   
      526     9088        /*D*
      527     9089        NAME:           NMV$PAIR
      528     9090
      529     9091        CALL:           CALL NMV$PAIR ALTRET ( error ) ;
      530     9092
      531     9093        PARAMETERS:     None.
      532     9094
      533     9095        DESCRIPTION:
      534     9096
      535     9097        The NMV$PAIR procedure is used to verify that the
      536     9098        Mirrored Disk devices are mirrors of each other (i.e.,
      537     9099        a Mirrored Disk pair).  If the devices are a pair,
      538     9100        this routine merely returns.  If the devices are not
      539     9101        a pair, an error message is printed, and this routine
      540     9102        makes an altreturn to the calling procedure.
      541     9103
      542     9104        */
      543     9105
      544     9106        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:73   
      545     9107    1   NMV$PAIR:               ENTRY           ALTRET ;

   9107  2 000361   000000 700200 xent  NMV$PAIR     TSX0  ! X66_AUTO_3
         2 000362   000026 000003                    ZERO    22,3

      546     9108
      547     9109
      548     9110
      549     9111    1           IF  NMD_PIT.DEV.DCT$(0)->DCT.DP.MIRROR.DCTX ~= NMD_PIT.DEV.DCTX(1)

   9111  2 000363   000010 470400 xsym               LDP0    NMD_PIT+8
         2 000364   000037 236100                    LDQ     31,,PR0
         2 000365   000022 772000                    QRL     18
         2 000366   000043 116000 xsym               CMPQ    NMD_PIT+35
         2 000367   000375 601000 2                  TNZ     s:9120
         2 000370   000042 471400 xsym               LDP1    NMD_PIT+34
         2 000371   100037 236100                    LDQ     31,,PR1
         2 000372   000022 772000                    QRL     18
         2 000373   000011 116000 xsym               CMPQ    NMD_PIT+9
         2 000374   000407 600000 2                  TZE     s:9126

      550     9112    1           OR  NMD_PIT.DEV.DCT$(1)->DCT.DP.MIRROR.DCTX ~= NMD_PIT.DEV.DCTX(0)
      551     9113    2           THEN DO ;

      552     9114        /*E*
      553     9115        ERROR:  NMV-E$NMD#NOT_PAIR-5
      554     9116        MESSAGE:  %U1 is not a mirror of %U2.
      555     9117        DESCRIPTION:  %U1 and %U2 are Mirrored Disks.  But they are not
      556     9118                      mirrors of each other.
      557     9119        */
      558     9120    2               CALL NME$ERRMSG ( NMV#NOT_PAIR, ,

   9120  2 000375   000010 237000 3                  LDAQ    8
         2 000376   200014 757100                    STAQ    S2+4,,AUTO
         2 000377   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000400   000021 235000 3                  LDA     17
         2 000401   200012 757100                    STAQ    S2+2,,AUTO
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:74   
         2 000402   200012 630500                    EPPR0   S2+2,,AUTO
         2 000403   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000404   000000 701000 xent               TSX1    NME$ERRMSG
         2 000405   000000 011000                    NOP     0

      559     9121    2                                 VECTOR(NMD_PIT.DEV.NAME(0)),
      560     9122    2                                 VECTOR(NMD_PIT.DEV.NAME(1)) ) ;
      561     9123    2               ALTRETURN ;

   9123  2 000406   000000 702200 xent               TSX2  ! X66_AALT

      562     9124    2               END ;
      563     9125
      564     9126    1           RETURN ;

   9126  2 000407   000000 702200 xent               TSX2  ! X66_ARET

      565     9127
      566     9128        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:75   
      567     9129        /*D*
      568     9130        NAME:           NMV$PART
      569     9131
      570     9132        CALL:           CALL NMV$PART ( i ) ALTRET ( error ) ;
      571     9133
      572     9134        PARAMETERS:
      573     9135        */
      574     9136        /*K*
      575     9137        i               is a UBIN WORD that specifies the DEV index.
      576     9138                i must be either 0 or 1.
      577     9139        */
      578     9140        /*D*
      579     9141        DESCRIPTION:
      580     9142
      581     9143        The NMV$PART procedure is used to verify that DEV(i)
      582     9144        is partitioned.  If the device is partitioned, this routine
      583     9145        simply returns.  If the device is not partitioned, an
      584     9146        error message is printed, and an altreturn is made to
      585     9147        the calling procedure.
      586     9148
      587     9149        */
      588     9150
      589     9151        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:76   
      590     9152    1   NMV$PART:               ENTRY ( I )     ALTRET ;

   9152  2 000410   000000 700200 xent  NMV$PART     TSX0  ! X66_AUTO_3
         2 000411   000026 000003                    ZERO    22,3

      591     9153
      592     9154
      593     9155
      594     9156    1           IF  NOT NMD_PIT.DEV.DCT$(I)->DCT.STATUS.DOWN

   9156  2 000412   200003 470500                    LDP0    @I,,AUTO
         2 000413   000000 236100                    LDQ     0,,PR0
         2 000414   000015 402007                    MPY     13,DL
         2 000415   000001 736000                    QLS     1
         2 000416   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000417   100027 234100                    SZN     23,,PR1
         2 000420   000441 604000 2                  TMI     s:9170

      595     9157    2           THEN DO ;

      596     9158        /*E*
      597     9159        ERROR:  NMV-E$NMD#NOT_PART-5
      598     9160        MESSAGE:  %U1 is not partitioned.
      599     9161        DESCRIPTION:  For the specified operation, if one Mirrored Disk
      600     9162                      device is partitioned, the other Mirrored Disk
      601     9163                      device must also be partitioned.
      602     9164        */
      603     9165    2               CALL NME$ERRMSG ( NMV#NOT_PART, ,

   9165  2 000421   000000 236100                    LDQ     0,,PR0
         2 000422   000015 402007                    MPY     13,DL
         2 000423   000000 235000 3                  LDA     0
         2 000424   000023 736000                    QLS     19
         2 000425   000001 036000 3                  ADLQ    1
         2 000426   200012 757100                    STAQ    S2+2,,AUTO
         2 000427   200012 631500                    EPPR1   S2+2,,AUTO
         2 000430   200016 451500                    STP1    S2+6,,AUTO
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:77   
         2 000431   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000432   000022 235000 3                  LDA     18
         2 000433   200014 757100                    STAQ    S2+4,,AUTO
         2 000434   200014 630500                    EPPR0   S2+4,,AUTO
         2 000435   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000436   000000 701000 xent               TSX1    NME$ERRMSG
         2 000437   000000 011000                    NOP     0

      604     9166    2                                 VECTOR(NMD_PIT.DEV.NAME(I)) ) ;
      605     9167    2               ALTRETURN ;

   9167  2 000440   000000 702200 xent               TSX2  ! X66_AALT

      606     9168    2               END ;
      607     9169
      608     9170    1           RETURN ;

   9170  2 000441   000000 702200 xent               TSX2  ! X66_ARET

      609     9171
      610     9172        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:78   
      611     9173        /*D*
      612     9174        NAME:           NMV$PRIMARY
      613     9175
      614     9176        CALL:           CALL NMV$PRIMARY ( i ) ALTRET ( error ) ;
      615     9177
      616     9178        PARAMETERS:
      617     9179        */
      618     9180        /*K*
      619     9181        i               is a UBIN WORD that specifies the DEV index.
      620     9182                i must be either 0 or 1.
      621     9183        */
      622     9184        /*D*
      623     9185        DESCRIPTION:
      624     9186
      625     9187        The NMV$PRIMARY procedure is used to verify that DEV(i)
      626     9188        is a primary Mirrored Disk device.  If the device is a
      627     9189        primary Mirrored Disk device, this routine simply returns.
      628     9190        If the device is not a primary Mirrored Disk device,
      629     9191        an error message is printed, and this routine makes an
      630     9192        altreturn to the calling procedure.
      631     9193
      632     9194        */
      633     9195
      634     9196        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:79   
      635     9197    1   NMV$PRIMARY:            ENTRY ( I )     ALTRET ;

   9197  2 000442   000000 700200 xent  NMV$PRIMARY  TSX0  ! X66_AUTO_3
         2 000443   000026 000003                    ZERO    22,3

      636     9198
      637     9199
      638     9200
      639     9201    1           IF  NOT NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.PRI

   9201  2 000444   200003 470500                    LDP0    @I,,AUTO
         2 000445   000000 236100                    LDQ     0,,PR0
         2 000446   000015 402007                    MPY     13,DL
         2 000447   000001 736000                    QLS     1
         2 000450   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000451   100036 236100                    LDQ     30,,PR1
         2 000452   020000 316003                    CANQ    8192,DU
         2 000453   000474 601000 2                  TNZ     s:9214

      640     9202    2           THEN DO ;

      641     9203        /*E*
      642     9204        ERROR:  NMV-E$NMD#NOT_PRIMARY-5
      643     9205        MESSAGE:  %U1 is not primary device.
      644     9206        DESCRIPTION:  For the specified operation, the specified device
      645     9207                      must be a primary Mirrored Disk device.
      646     9208        */
      647     9209    2               CALL NME$ERRMSG ( NMV#NOT_PRIMARY, ,

   9209  2 000454   000000 236100                    LDQ     0,,PR0
         2 000455   000015 402007                    MPY     13,DL
         2 000456   000000 235000 3                  LDA     0
         2 000457   000023 736000                    QLS     19
         2 000460   000001 036000 3                  ADLQ    1
         2 000461   200012 757100                    STAQ    S2+2,,AUTO
         2 000462   200012 631500                    EPPR1   S2+2,,AUTO
         2 000463   200016 451500                    STP1    S2+6,,AUTO
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:80   
         2 000464   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000465   000023 235000 3                  LDA     19
         2 000466   200014 757100                    STAQ    S2+4,,AUTO
         2 000467   200014 630500                    EPPR0   S2+4,,AUTO
         2 000470   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000471   000000 701000 xent               TSX1    NME$ERRMSG
         2 000472   000000 011000                    NOP     0

      648     9210    2                                 VECTOR(NMD_PIT.DEV.NAME(I)) ) ;
      649     9211    2               ALTRETURN ;

   9211  2 000473   000000 702200 xent               TSX2  ! X66_AALT

      650     9212    2               END ;
      651     9213
      652     9214    1           RETURN ;

   9214  2 000474   000000 702200 xent               TSX2  ! X66_ARET

      653     9215
      654     9216        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:81   
      655     9217        /*D*
      656     9218        NAME:           NMV$SAME_STATE
      657     9219
      658     9220        CALL:           CALL NMV$SAME_STATE ALTRET ( error ) ;
      659     9221
      660     9222        PARAMETERS:     None.
      661     9223
      662     9224        DESCRIPTION:
      663     9225
      664     9226        The NMV$SAME_STATE procedure is used to verify that both
      665     9227        Mirrored Disk devices are in the same state.  If they
      666     9228        are, this routine simply returns.  If they are not,
      667     9229        an error message is printed, and this routine makes
      668     9230        an altreturn to the calling procedure.
      669     9231
      670     9232        */
      671     9233
      672     9234        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:82   
      673     9235    1   NMV$SAME_STATE:         ENTRY           ALTRET ;

   9235  2 000475   000000 700200 xent  NMV$SAME_ST* TSX0  ! X66_AUTO_3
         2 000476   000026 000003                    ZERO    22,3

      674     9236
      675     9237
      676     9238
      677     9239    1           IF  NMD_PIT.DEV.DCT$(0)->DCT.DP.MIRROR.STATE ~=

   9239  2 000477   000042 470400 xsym               LDP0    NMD_PIT+34
         2 000500   000010 471400 xsym               LDP1    NMD_PIT+8
         2 000501   100036 236100                    LDQ     30,,PR1
         2 000502   000036 676100                    ERQ     30,,PR0
         2 000503   007700 376003                    ANQ     4032,DU
         2 000504   000517 600000 2                  TZE     s:9254

      678     9240    1               NMD_PIT.DEV.DCT$(1)->DCT.DP.MIRROR.STATE
      679     9241    2           THEN DO ;

      680     9242        /*E*
      681     9243        ERROR:  NMV-E$NMD#NOT_SAME-5
      682     9244        MESSAGE:  Devices %U1 and %U2 must be in the same state.
      683     9245        DESCRIPTION:  For the specified operation, the devices must be in
      684     9246                      the same state.
      685     9247        */
      686     9248    2               CALL NME$ERRMSG ( NMV#NOT_SAME, ,

   9248  2 000505   000010 237000 3                  LDAQ    8
         2 000506   200014 757100                    STAQ    S2+4,,AUTO
         2 000507   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000510   000024 235000 3                  LDA     20
         2 000511   200012 757100                    STAQ    S2+2,,AUTO
         2 000512   200012 630500                    EPPR0   S2+2,,AUTO
         2 000513   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000514   000000 701000 xent               TSX1    NME$ERRMSG
         2 000515   000000 011000                    NOP     0
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:83   

      687     9249    2                                 VECTOR(NMD_PIT.DEV.NAME(0)),
      688     9250    2                                 VECTOR(NMD_PIT.DEV.NAME(1))) ;
      689     9251    2               ALTRETURN ;

   9251  2 000516   000000 702200 xent               TSX2  ! X66_AALT

      690     9252    2               END ;
      691     9253
      692     9254    1           RETURN ;

   9254  2 000517   000000 702200 xent               TSX2  ! X66_ARET

      693     9255
      694     9256        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:84   
      695     9257        /*D*
      696     9258        NAME:           NMV$SCRATCH
      697     9259
      698     9260        CALL:           CALL NMV$SCRATCH ( i ) ALTRET ( error ) ;
      699     9261
      700     9262        PARAMETERS:
      701     9263        */
      702     9264        /*K*
      703     9265        i               is a UBIN WORD that specifies the DEV index.
      704     9266                i must be either 0 or 1.
      705     9267        */
      706     9268        /*D*
      707     9269        DESCRIPTION:
      708     9270
      709     9271        The NMV$SCRATCH procedure is used to verify that DEV(i)
      710     9272        is a scratch disk device.  DRZERO is calculated for
      711     9273        this device.  If this device is a scratch device,
      712     9274        this routine merely returns.  If it is not, an error
      713     9275        message is printed, and an altreturn is made to the
      714     9276        calling procedure.
      715     9277
      716     9278        */
      717     9279
      718     9280        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:85   
      719     9281    1   NMV$SCRATCH:            ENTRY ( I )     ALTRET ;

   9281  2 000520   000000 700200 xent  NMV$SCRATCH  TSX0  ! X66_AUTO_3
         2 000521   000026 000003                    ZERO    22,3

      720     9282
      721     9283
      722     9284
      723     9285    1           IF  (     NMD_PIT.DEV.VID$(I)->FM$VID.VOLCNT         = 0

   9285  2 000522   200003 470500                    LDP0    @I,,AUTO
         2 000523   000000 236100                    LDQ     0,,PR0
         2 000524   000015 402007                    MPY     13,DL
         2 000525   000001 736000                    QLS     1
         2 000526   000032 471406 xsym               LDP1    NMD_PIT+26,QL
         2 000527   100004 720100                    LXL0    4,,PR1
         2 000530   000537 601000 2                  TNZ     s:9285+13
         2 000531   000000 236100                    LDQ     0,,PR0
         2 000532   000015 402007                    MPY     13,DL
         2 000533   000001 736000                    QLS     1
         2 000534   000032 471406 xsym               LDP1    NMD_PIT+26,QL
         2 000535   100011 235100                    LDA     9,,PR1
         2 000536   000557 600000 2                  TZE     s:9290
         2 000537   000000 236100                    LDQ     0,,PR0
         2 000540   000015 402007                    MPY     13,DL
         2 000541   000001 736000                    QLS     1
         2 000542   000032 471406 xsym               LDP1    NMD_PIT+26,QL
         2 000543   040000 106500                    CMPC    fill='040'O
         2 000544   100042 000010                    ADSC9   34,,PR1                  cn=0,n=8
         2 000545   000016 000010 1                  ADSC9   NMV#STATE_CHANGED+1      cn=0,n=8
         2 000546   000572 601000 2                  TNZ     s:9294
         2 000547   000000 236100                    LDQ     0,,PR0
         2 000550   000015 402007                    MPY     13,DL
         2 000551   000001 736000                    QLS     1
         2 000552   000032 471406 xsym               LDP1    NMD_PIT+26,QL
         2 000553   100045 236100                    LDQ     37,,PR1
         2 000554   770000 376003                    ANQ     -4096,DU
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:86   
         2 000555   010000 116003                    CMPQ    4096,DU
         2 000556   000572 601000 2                  TNZ     s:9294

      724     9286    1                 AND NMD_PIT.DEV.VID$(I)->FM$VID.SECTSTRT(1)    = 0 )
      725     9287    1           OR  ( NMD_PIT.DEV.VID$(I)->FM$VID.MIRROR.C           = 'MIRROR  '
      726     9288    1                AND NMD_PIT.DEV.VID$(I)->FM$VID.MIRROR.STATE(0) = %NI_MIRROR_FAIL )
      727     9289    2           THEN DO ;

      728     9290    2               NMD_PIT.DEV.FLAGS.SCRATCH(I) = '1'B ;

   9290  2 000557   000000 236100                    LDQ     0,,PR0
         2 000560   000015 402007                    MPY     13,DL
         2 000561   000001 736000                    QLS     1
         2 000562   000000 620006                    EAX0    0,QL
         2 000563   100000 236003                    LDQ     32768,DU
         2 000564   000014 256010 xsym               ORSQ    NMD_PIT+12,X0

      729     9291    2               NMD_PIT.DEV.DRZERO(I)        = 0 ;

   9291  2 000565   000000 236100                    LDQ     0,,PR0
         2 000566   000015 402007                    MPY     13,DL
         2 000567   000001 736000                    QLS     1
         2 000570   000012 450006 xsym               STZ     NMD_PIT+10,QL

      730     9292    2               END ;

   9292  2 000571   000630 710000 2                  TRA     s:9303

      731     9293    2           ELSE DO ;

      732     9294    2               NMD_PIT.DEV.FLAGS.SCRATCH(I) = '0'B ;

   9294  2 000572   000000 236100                    LDQ     0,,PR0
         2 000573   000015 402007                    MPY     13,DL
         2 000574   000001 736000                    QLS     1
         2 000575   000000 620006                    EAX0    0,QL
         2 000576   000025 236000 3                  LDQ     21
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:87   
         2 000577   000014 356010 xsym               ANSQ    NMD_PIT+12,X0

      733     9295    2               IF  NMD_PIT.DEV.VID$(I)->FM$VID.PSN = 'CP-6''S'

   9295  2 000600   000000 236100                    LDQ     0,,PR0
         2 000601   000015 402007                    MPY     13,DL
         2 000602   000001 736000                    QLS     1
         2 000603   000032 471406 xsym               LDP1    NMD_PIT+26,QL
         2 000604   040000 106500                    CMPC    fill='040'O
         2 000605   100003 000006                    ADSC9   3,,PR1                   cn=0,n=6
         2 000606   000020 000006 1                  ADSC9   NMV#STATE_CHANGED+3      cn=0,n=6
         2 000607   000623 601000 2                  TNZ     s:9299

      734     9296    2               THEN
      735     9297    2                   NMD_PIT.DEV.DRZERO(I) = NMD_PIT.DEV.VID$(I)->FM$VID.SYSSIZE ;

   9297  2 000610   000000 236100                    LDQ     0,,PR0
         2 000611   000015 402007                    MPY     13,DL
         2 000612   000001 736000                    QLS     1
         2 000613   000000 620006                    EAX0    0,QL
         2 000614   000000 236100                    LDQ     0,,PR0
         2 000615   000015 402007                    MPY     13,DL
         2 000616   000001 736000                    QLS     1
         2 000617   000032 471406 xsym               LDP1    NMD_PIT+26,QL
         2 000620   100005 235100                    LDA     5,,PR1
         2 000621   000012 755010 xsym               STA     NMD_PIT+10,X0
         2 000622   000627 710000 2                  TRA     s:9300

      736     9298    2               ELSE
      737     9299    2                   NMD_PIT.DEV.DRZERO(I) = 0 ;

   9299  2 000623   000000 236100                    LDQ     0,,PR0
         2 000624   000015 402007                    MPY     13,DL
         2 000625   000001 736000                    QLS     1
         2 000626   000012 450006 xsym               STZ     NMD_PIT+10,QL

      738     9300    2               ALTRETURN ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:88   

   9300  2 000627   000000 702200 xent               TSX2  ! X66_AALT

      739     9301    2               END ;
      740     9302
      741     9303    1           RETURN ;

   9303  2 000630   000000 702200 xent               TSX2  ! X66_ARET

      742     9304
      743     9305        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:89   
      744     9306        /*D*
      745     9307        NAME:           NMV$STATE
      746     9308
      747     9309        CALL:           CALL NMV$STATE ( i, state1[, state2 ] )
      748     9310                        ALTRET ( error ) ;
      749     9311
      750     9312        PARAMETERS:
      751     9313        */
      752     9314        /*K*
      753     9315        i               is a UBIN WORD that specifies the DEV index.
      754     9316                i must be either 0 or 1.
      755     9317        */
      756     9318        /*K*
      757     9319        state1          is a UBIN WORD that specifies the expected
      758     9320                state of the device.
      759     9321        */
      760     9322        /*K*
      761     9323        state2          is a UBIN WORD that specifies an optional
      762     9324                second expected state of the device.
      763     9325        */
      764     9326        /*D*
      765     9327        DESCRIPTION:
      766     9328
      767     9329        The NMV$STATE procedure is used to verify that DEV(i)
      768     9330        is in one of the specified states.  If the device is in one
      769     9331        of the specified states, this routine simply returns.  If the
      770     9332        device is not in the specified state, an error message
      771     9333        is printed, and an altreturn is made to the calling
      772     9334        procedure.
      773     9335
      774     9336        */
      775     9337
      776     9338        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:90   
      777     9339    1   NMV$STATE:              ENTRY ( I, STATE1, STATE2 ) ALTRET ;

   9339  2 000631   000000 700200 xent  NMV$STATE    TSX0  ! X66_AUTO_3
         2 000632   000026 000003                    ZERO    22,3

      778     9340
      779     9341
      780     9342
      781     9343    1           IF  NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.STATE ~= STATE1

   9343  2 000633   200003 470500                    LDP0    @I,,AUTO
         2 000634   000000 236100                    LDQ     0,,PR0
         2 000635   000015 402007                    MPY     13,DL
         2 000636   000001 736000                    QLS     1
         2 000637   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000640   200004 473500                    LDP3    @STATE1,,AUTO
         2 000641   100036 236100                    LDQ     30,,PR1
         2 000642   000030 772000                    QRL     24
         2 000643   000077 376007                    ANQ     63,DL
         2 000644   300000 116100                    CMPQ    0,,PR3
         2 000645   000750 600000 2                  TZE     s:9374

      782     9344    2           THEN DO ;

      783     9345    2               IF  ADDR(STATE2) = ADDR(NIL)

   9345  2 000646   200005 236100                    LDQ     @STATE2,,AUTO
         2 000647   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000650   000701 601000 2                  TNZ     s:9358

      784     9346    3               THEN DO ;

      785     9347        /*
      786     9348        ERROR:  NMV-E$NMD#NOT_STATE-5
      787     9349        MESSAGE:  (Previously defined.)
      788     9350        DESCRIPTION:  (Previously defined.)
      789     9351        */
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:91   
      790     9352    3                   CALL NME$ERRMSG ( NMV#NOT_STATE, ,

   9352  2 000651   000000 236100                    LDQ     0,,PR0
         2 000652   000015 402007                    MPY     13,DL
         2 000653   000000 235000 3                  LDA     0
         2 000654   000023 736000                    QLS     19
         2 000655   000001 036000 3                  ADLQ    1
         2 000656   200012 757100                    STAQ    S2+2,,AUTO
         2 000657   300000 235100                    LDA     0,,PR3
         2 000660   200016 755100                    STA     S2+6,,AUTO
         2 000661   200012 237100                    LDAQ    S2+2,,AUTO
         2 000662   200014 757100                    STAQ    S2+4,,AUTO
         2 000663   200016 236100                    LDQ     S2+6,,AUTO
         2 000664   000023 736000                    QLS     19
         2 000665   000002 036000 3                  ADLQ    2
         2 000666   200023 756100                    STQ     S2+11,,AUTO
         2 000667   200014 631500                    EPPR1   S2+4,,AUTO
         2 000670   200022 451500                    STP1    S2+10,,AUTO
         2 000671   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000672   000015 235000 3                  LDA     13
         2 000673   200020 757100                    STAQ    S2+8,,AUTO
         2 000674   200020 630500                    EPPR0   S2+8,,AUTO
         2 000675   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000676   000000 701000 xent               TSX1    NME$ERRMSG
         2 000677   000000 011000                    NOP     0

      791     9353    3                                     VECTOR(NMD_PIT.DEV.NAME(I)),
      792     9354    3                                     NMD_PIT.STATE.V_(STATE1)             ) ;
      793     9355    3                   GOTO ERROR ;

   9355  2 000700   000751 710000 2                  TRA     ERROR

      794     9356    3                   END ;
      795     9357
      796     9358    2               ELSE IF  NMD_PIT.DEV.DCT$(I)->DCT.DP.MIRROR.STATE ~= STATE2

   9358  2 000701   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:92   
         2 000702   000015 402007                    MPY     13,DL
         2 000703   000001 736000                    QLS     1
         2 000704   000010 471406 xsym               LDP1    NMD_PIT+8,QL
         2 000705   200005 474500                    LDP4    @STATE2,,AUTO
         2 000706   100036 236100                    LDQ     30,,PR1
         2 000707   000030 772000                    QRL     24
         2 000710   000077 376007                    ANQ     63,DL
         2 000711   400000 116100                    CMPQ    0,,PR4
         2 000712   000750 600000 2                  TZE     s:9374

      797     9359    3               THEN DO ;

      798     9360        /*E*
      799     9361        ERROR:  NMV-E$NMD#NOT_STATES-5
      800     9362        MESSAGE:  Device %U1 is not %U2 or %U3.
      801     9363        DESCRIPTION:  For the specified operation, the device must be
      802     9364                      in one of the specified states.
      803     9365        */
      804     9366    3                   CALL NME$ERRMSG ( NMV#NOT_STATES,

   9366  2 000713   000000 236100                    LDQ     0,,PR0
         2 000714   000015 402007                    MPY     13,DL
         2 000715   000000 235000 3                  LDA     0
         2 000716   000023 736000                    QLS     19
         2 000717   000001 036000 3                  ADLQ    1
         2 000720   200012 757100                    STAQ    S2+2,,AUTO
         2 000721   300000 235100                    LDA     0,,PR3
         2 000722   200014 755100                    STA     S2+4,,AUTO
         2 000723   400000 235100                    LDA     0,,PR4
         2 000724   200020 755100                    STA     S2+8,,AUTO
         2 000725   200012 237100                    LDAQ    S2+2,,AUTO
         2 000726   200016 757100                    STAQ    S2+6,,AUTO
         2 000727   200020 236100                    LDQ     S2+8,,AUTO
         2 000730   000023 736000                    QLS     19
         2 000731   000002 036000 3                  ADLQ    2
         2 000732   200025 756100                    STQ     S2+13,,AUTO
         2 000733   200014 236100                    LDQ     S2+4,,AUTO
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:93   
         2 000734   000023 736000                    QLS     19
         2 000735   000002 036000 3                  ADLQ    2
         2 000736   200024 756100                    STQ     S2+12,,AUTO
         2 000737   200016 631500                    EPPR1   S2+6,,AUTO
         2 000740   200023 451500                    STP1    S2+11,,AUTO
         2 000741   000026 236000 3                  LDQ     22
         2 000742   200022 756100                    STQ     S2+10,,AUTO
         2 000743   200022 630500                    EPPR0   S2+10,,AUTO
         2 000744   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000745   000000 701000 xent               TSX1    NME$ERRMSG
         2 000746   000000 011000                    NOP     0

      805     9367    3                                     VECTOR(NMD_PIT.DEV.NAME(I)),
      806     9368    3                                     NMD_PIT.STATE.V_(STATE1),
      807     9369    3                                     NMD_PIT.STATE.V_(STATE2)              ) ;
      808     9370    3                   GOTO ERROR ;

   9370  2 000747   000751 710000 2                  TRA     ERROR

      809     9371    3                   END ;
      810     9372    2               END ;
      811     9373
      812     9374    1           RETURN ;

   9374  2 000750   000000 702200 xent               TSX2  ! X66_ARET

      813     9375
      814     9376    1   ERROR:  ALTRETURN ;

   9376  2 000751   000000 702200 xent  ERROR        TSX2  ! X66_AALT

      815     9377
      816     9378        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:94   
      817     9379        /*D*
      818     9380        NAME:           NMV$VSN
      819     9381
      820     9382        CALL:           CALL NMV$VSN ALTRET ( error ) ;
      821     9383
      822     9384        PARAMETERS:     None.
      823     9385
      824     9386        DESCRIPTION:
      825     9387
      826     9388        The NMV$VSN procedure is used to verify that both
      827     9389        Mirrored Disk devices have the same VSN.  If they do,
      828     9390        this routine simply returns.  If they don't, an error
      829     9391        message is printed, and an altreturn is made to the calling
      830     9392        procedure.
      831     9393
      832     9394        */
      833     9395
      834     9396        %EJECT ;
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:95   
      835     9397    1   NMV$VSN:                ENTRY           ALTRET ;

   9397  2 000752   000000 700200 xent  NMV$VSN      TSX0  ! X66_AUTO_3
         2 000753   000026 000003                    ZERO    22,3

      836     9398
      837     9399
      838     9400
      839     9401    1           IF  NMD_PIT.DEV.VID$(0) -> FM$VID.VSN ~=

   9401  2 000754   000032 470400 xsym               LDP0    NMD_PIT+26
         2 000755   000064 471400 xsym               LDP1    NMD_PIT+52
         2 000756   000002 236100                    LDQ     2,,PR0
         2 000757   100002 116100                    CMPQ    2,,PR1
         2 000760   000766 600000 2                  TZE     s:9415

      840     9402    1               NMD_PIT.DEV.VID$(1) -> FM$VID.VSN
      841     9403    2           THEN DO ;

      842     9404        /*E*
      843     9405        ERROR:  NMV-E$NMD#BAD_VSN-5
      844     9406        MESSAGE:  VSN doesn't match.
      845     9407        DESCRIPTION:  The VSN must match on Mirrored Disk devices.
      846     9408                      This error indicates an error in the preparation or
      847     9409                      selection of the devices used for the Mirrored Disk devices.
      848     9410        */
      849     9411    2               CALL NME$ERRMSG ( NMV#BAD_VSN ) ;

   9411  2 000761   000027 630400 3                  EPPR0   23
         2 000762   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000763   000000 701000 xent               TSX1    NME$ERRMSG
         2 000764   000000 011000                    NOP     0

      850     9412    2               ALTRETURN ;

   9412  2 000765   000000 702200 xent               TSX2  ! X66_AALT

PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:96   
      851     9413    2               END ;
      852     9414    2           ELSE DO ;

      853     9415    2               NMD_PIT.DEV.VSN(0) = NMD_PIT.DEV.VID$(0)->FM$VID.VSN ;

   9415  2 000766   000033 756000 xsym               STQ     NMD_PIT+27

      854     9416    2               NMD_PIT.DEV.VSN(1) = NMD_PIT.DEV.VID$(1)->FM$VID.VSN ;

   9416  2 000767   100002 235100                    LDA     2,,PR1
         2 000770   000065 755000 xsym               STA     NMD_PIT+53

      855     9417    2               END ;

      856     9418
      857     9419    1           RETURN ;

   9419  2 000771   000000 702200 xent               TSX2  ! X66_ARET
      858     9420
      859     9421    1           END NMV$VERIFY ;

PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:97   
--  Include file information  --

   NM_SUBS_C.:E05TOU  is referenced.
   NM_EQU_E.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NM_MACRO_M.:E05TOU  is referenced.
   NM_PERR_C.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NMV$VERIFY.
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:98   

 **** Variables and constants ****

  ****  Section 001 RoData NMV$VERIFY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 NMV#BAD_DGT                1-0-0/w STRC        r     1 NMV#BAD_PACKSIZE
     2-0-0/w STRC        r     1 NMV#BAD_VSN                3-0-0/w STRC        r     1 NMV#NOT_MIRRORED
     4-0-0/w STRC        r     1 NMV#NOT_PAIR               5-0-0/w STRC        r     1 NMV#NOT_PART
     6-0-0/w STRC        r     1 NMV#NOT_PRIMARY            7-0-0/w STRC        r     1 NMV#NOT_SAME
    10-0-0/w STRC        r     1 NMV#NOT_STATE             11-0-0/w STRC        r     1 NMV#NOT_STATES
    12-0-0/w STRC        r     1 NMV#NOW_MIRRORED          13-0-0/w STRC        r     1 NMV#PARTITIONED
    14-0-0/w STRC        r     1 NMV#SAME_DEV              15-0-0/w STRC        r     1 NMV#STATE_CHANGED

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @I                         4-0-0/w PTR         r     1 @STATE1
     5-0-0/w PTR         r     1 @STATE2                   *0-0-0/w SBIN        r     1 I
     6-0-0/w SBIN        r     1 J                          7-0-0/w SBIN        r     1 S1
    10-0-0/w SBIN        r     1 S2                        *0-0-0/w SBIN        r     1 STATE1
    *0-0-0/w SBIN        r     1 STATE2

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/d STRC(8892)  r     1 NMD_PIT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:99   

     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w STRC(36864) r     1 FM$VID


   Procedure NMV$VERIFY requires 506 words for executable code.
   Procedure NMV$VERIFY requires 22 words of local(AUTO) storage.

    No errors detected in file NMV$VERIFY.:E05TSI    .
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:100  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:101  
          MINI XREF LISTING

B$ALT.CODE
      7474**DCL      7474--REDEF    7475--REDEF    7475--REDEF
B$ALT.ERR.ERR#
      7476**DCL      7476--REDEF
B$ALT.EVID
      7475**DCL      7475--REDEF    7475--REDEF
B$TCB$
      7485**DCL      7483--IMP-PTR
DCT.DEVNM
      7497**DCL      8796>>IF       8796>>IF
DCT.DP
      7517**DCL      7524--REDEF    7527--REDEF    7528--REDEF    7530--REDEF    7530--REDEF    7531--REDEF
      7532--REDEF    7532--REDEF
DCT.DP.MIRROR.DCTX
      7522**DCL      9111>>IF       9111>>IF
DCT.DP.MIRROR.FLAG
      7519**DCL      8892>>IF       8985>>IF
DCT.DP.MIRROR.PRI
      7521**DCL      9201>>IF
DCT.DP.MIRROR.STATE
      7521**DCL      8757>>ASSIGN   8941>>IF       9239>>IF       9239>>IF       9343>>IF       9358>>IF
DCT.MPC.IOCHANX
      7525**DCL      7525--REDEF
DCT.STATUS.DOWN
      7514**DCL      9027>>IF       9156>>IF
DCT.STATUS.MSOS_PART
      7516**DCL      9027>>IF
DCT.STATUS.SYSCON_PART
      7515**DCL      9027>>IF
ERROR
      9376**LABEL    9355--GOTO     9370--GOTO
FM$VID.DGT
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:102  
      7541**DCL      8837>>IF       8837>>IF
FM$VID.DGT.FGRAN
      7541**DCL      8852>>ASSIGN
FM$VID.DGT.LGRAN
      7541**DCL      8853>>ASSIGN
FM$VID.DTT
      7541**DCL      7541--REDEF
FM$VID.MIRROR.C
      7540**DCL      9285>>IF
FM$VID.MIRROR.STATE
      7540**DCL      9285>>IF
FM$VID.PSN
      7539**DCL      9295>>IF
FM$VID.SECTSTRT
      7540**DCL      9285>>IF
FM$VID.SYSSIZE
      7539**DCL      9297>>ASSIGN
FM$VID.VOLCNT
      7539**DCL      9285>>IF
FM$VID.VSN
      7539**DCL      9401>>IF       9401>>IF       9415>>ASSIGN   9416>>ASSIGN
I
      7459**DCL        13--PROC     8752--ENTRY    8756>>ASSIGN   8757>>ASSIGN   8766>>CALL     8766>>CALL
      8888--ENTRY    8892>>IF       8899>>CALL     8935--ENTRY    8939>>ASSIGN   8981--ENTRY    8985>>IF
      8992>>CALL     9023--ENTRY    9027>>IF       9027>>IF       9027>>IF       9038>>CALL     9152--ENTRY
      9156>>IF       9165>>CALL     9197--ENTRY    9201>>IF       9209>>CALL     9281--ENTRY    9285>>IF
      9285>>IF       9285>>IF       9285>>IF       9290>>ASSIGN   9291>>ASSIGN   9294>>ASSIGN   9295>>IF
      9297>>ASSIGN   9297>>ASSIGN   9299>>ASSIGN   9339--ENTRY    9343>>IF       9352>>CALL     9358>>IF
      9366>>CALL
J
      7544**DCL      8836<<DOINDEX  8837>>IF       8837>>IF       8852>>ASSIGN   8852>>ASSIGN   8853>>ASSIGN
      8853>>ASSIGN   8939<<ASSIGN   8941>>IF       8949>>CALL
NMD_PIT.DEV.DCB#
      7596**DCL      8766<>CALL
NMD_PIT.DEV.DCT$
      7608**DCL      8757>>ASSIGN   8796>>IF       8796>>IF       8892>>IF       8941>>IF       8985>>IF
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:103  
      9027>>IF       9027>>IF       9027>>IF       9111>>IF       9111>>IF       9156>>IF       9201>>IF
      9239>>IF       9239>>IF       9343>>IF       9358>>IF
NMD_PIT.DEV.DCTX
      7613**DCL      9111>>IF       9111>>IF
NMD_PIT.DEV.DRZERO
      7618**DCL      9291<<ASSIGN   9297<<ASSIGN   9299<<ASSIGN
NMD_PIT.DEV.FLAGS.SCRATCH
      7643**DCL      9290<<ASSIGN   9294<<ASSIGN
NMD_PIT.DEV.NAME
      7663**DCL      8766--CALL     8805--CALL     8805--CALL     8899--CALL     8949--CALL     8992--CALL
      9038--CALL     9120--CALL     9120--CALL     9165--CALL     9209--CALL     9248--CALL     9248--CALL
      9352--CALL     9366--CALL
NMD_PIT.DEV.PACKSIZE
      7678**DCL      9070>>IF       9070>>IF       9083>>ASSIGN
NMD_PIT.DEV.STATE
      7688**DCL      8756>>ASSIGN
NMD_PIT.DEV.VID$
      7710**DCL      8837>>IF       8837>>IF       8852>>ASSIGN   8853>>ASSIGN   9285>>IF       9285>>IF
      9285>>IF       9285>>IF       9295>>IF       9297>>ASSIGN   9401>>IF       9401>>IF       9415>>ASSIGN
      9416>>ASSIGN
NMD_PIT.DEV.VSN
      7716**DCL      9415<<ASSIGN   9416<<ASSIGN
NMD_PIT.DGT.FGRAN
      7723**DCL      8852<<ASSIGN   8859<<ASSIGN
NMD_PIT.DGT.I
      7722**DCL      8857<<ASSIGN
NMD_PIT.DGT.LGRAN
      7724**DCL      8853<<ASSIGN   8860<<ASSIGN
NMD_PIT.PACKSIZE
      7932**DCL      8859>>ASSIGN   8860>>ASSIGN   9083<<ASSIGN
NMD_PIT.STATE.V_
      7987**DCL      8766<>CALL     8766<>CALL     8949<>CALL     9352<>CALL     9366<>CALL     9366<>CALL
NME$ERRMSG
      7465**DCL-ENT  8766--CALL     8805--CALL     8848--CALL     8899--CALL     8949--CALL     8992--CALL
      9038--CALL     9079--CALL     9120--CALL     9165--CALL     9209--CALL     9248--CALL     9352--CALL
      9366--CALL     9411--CALL
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:104  
NMV#BAD_DGT
      8019**DCL      8848<>CALL
NMV#BAD_PACKSIZE
      8071**DCL      9079<>CALL
NMV#BAD_VSN
      8123**DCL      9411<>CALL
NMV#NOT_MIRRORED
      8175**DCL      8899<>CALL
NMV#NOT_PAIR
      8227**DCL      9120<>CALL
NMV#NOT_PART
      8279**DCL      9165<>CALL
NMV#NOT_PRIMARY
      8331**DCL      9209<>CALL
NMV#NOT_SAME
      8383**DCL      9248<>CALL
NMV#NOT_STATE
      8435**DCL      8949<>CALL     9352<>CALL
NMV#NOT_STATES
      8487**DCL      9366<>CALL
NMV#NOW_MIRRORED
      8539**DCL      8992<>CALL
NMV#PARTITIONED
      8591**DCL      9038<>CALL
NMV#SAME_DEV
      8643**DCL      8805<>CALL
NMV#STATE_CHANGED
      8695**DCL      8766<>CALL
S1
      8728**DCL      8756<<ASSIGN   8766>>CALL
S2
      8729**DCL      8757<<ASSIGN   8766>>CALL
STATE1
      7460**DCL        13--PROC     8935--ENTRY    8941>>IF       8949>>CALL     9339--ENTRY    9343>>IF
      9352>>CALL     9366>>CALL
STATE2
PL6.E3A0      #001=NMV$VERIFY File=NMV$VERIFY.:E05TSI                            WED 07/30/97 03:51 Page:105  
      7461**DCL        13--PROC     9339--ENTRY    9345--IF       9358>>IF       9366>>CALL
