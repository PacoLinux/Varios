VERSION E05

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:1    
        1        1        /*M* KVC$CNC - Initialize VDI context                                         */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
        8        8        KVC$CNC: PROC (PRM) ALTRET;
        9        9
       10       10        /*F* NAME: KVC$CNC                                                            */
       11       11        /*F*                                                                          */
       12       12        /*F* KVC$CNC initializes the context needed for a VDH user. In its            */
       13       13        /*F* current state it will set up the entire context, but in later            */
       14       14        /*F* releases there will be seperate calls to initialize different            */
       15       15        /*F* sections of the context.                                                 */
       16       16
       17       17        %INCLUDE F_ERRORS_C;
       18      257        %INCLUDE KL_AFCN_C;
       19      358        %INCLUDE KL_MACRO_C;
       20     3710        %INCLUDE KV_ERRORS_C;
       21     3770 S      %INCLUDE KV_GLBCNS_E;
       22     3771        %KV_STRTYP_E;
       23     3809        %KV_VDH_EVT_ID_E;
       24     3815        %KV_USR_EVT_ID_E;
       25     3835        %INCLUDE KV$BPC;
       26     3864 S      %INCLUDE KV$GLBCTX;
       27     3865 S      %INCLUDE KV$GLB;
       28     3866        %INCLUDE KV$INPFNC;
       29     4425 S      %INCLUDE KV$INT;
       30     4426 S      %INCLUDE KV$SND;
       31     4427        %KV_SND_FNC_E;
       32     4443 S      %INCLUDE KV$VDH;
       33     4444 S      %INCLUDE KV$VDO;
       34     4445 S      %INCLUDE KV$USR;
       35     4446        %INCLUDE KV_INT_M;
       36     4589 S      %INCLUDE KV_PRMID_E;
       37     4590        %INCLUDE LCP_6;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:2    
       38     4781        %INCLUDE K_ID_E;
       39     4831        %K#ENTID_E;
       40     4850        %K#LYRID_E;
       41     4857        %KV_PRMID_E;
       42     5013        %KV_BFRRLSDSP_E;
       43     5019        %KV#VD_ORG_E;
       44     5027        %KV_SCP_E;
       45     5037        %KV_PHSPSTMOD_E;
       46     5044
       47     5045        %KV$BPC (STCLASS="BASED(KV_B_POOL$)");
       48     5067        %KV$INPFNCTBL;
       49     5151        %KV$LIN;
       50     5175        %KV$LIN (NAME=KV_LIN, STCLASS=SYMREF READONLY);
       51     5199        %KV$LINLST (STCLASS="BASED(KV@VDH_GETBFR.BFR$)");
       52     5226        %EQU KV_LINLST=CHARTEXT('KV$LINLST');
       53     5227        %KV$MRD;                                /*  MASTER REAL DEVICE CONTEXT BLOCK  */
       54     5274        %KV$PTR;                                /*  VDH POINTER BLOCK                 */
       55     5317        %KV$RCRLST (STCLASS="BASED(KV@VDH_GETBFR.BFR$)");
       56     5353        %EQU KV_RCRLST=CHARTEXT('KV$RCRLST');
       57     5354        %KV$RCRLST (NAME=KV_RCRLST, STCLASS=CONSTANT SYMDEF);
       58     5390        %KV$VDI;                                /*  VDI CONTEXT BLOCK                 */
       59     5461        %KV$SSN;                                /*  SESSION BLOCK                     */
       60     5540        %KV$STR;                                /*  STREAM CONTEXT BLOCK              */
       61     5627        %KV$STT;
       62     6021        %KV$MVD;                                /*  MASTER VIRTUAL DEVICE             */
       63     6065        %KV$SRD;                                /*  SECONDARY REAL DEVICE             */
       64     6340        %KV$TRCBFR;
       65     6398        %KV$TRCENT;
       66     6427        %KV$USRPRM;
       67     6478        %KV$SHRBFR;                             /*  SHARED BUFFER FORMAT              */
       68     6510    1   DCL KV_ACTCHRTBLNRM UBIN SYMREF;
       69     6511
       70     6512    1   DCL Y$PTR$ PTR BASED;
       71     6513
       72     6514    1   DCL CHR8 CHAR(8) BASED;
       73     6515    1   DCL KV_SSNCNT UBIN SYMREF;
       74     6516    1   DCL KV_SSNMAX UBIN SYMREF;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:3    
       75     6517
       76     6518    1   DCL KVC$ADJWND ENTRY(1) ALTRET;
       77     6519    1   DCL KVC$DRWBRD ENTRY;
       78     6520    1   DCL KVC$RLSFRM ENTRY;
       79     6521    1   DCL KVC$RLSSSNNO_CNC ENTRY;
       80     6522    1   DCL KVC$RLSMVD ENTRY;
       81     6523    1   DCL KVC$RLSSTR ENTRY;
       82     6524    1   DCL KVI$NEWINPFNCTBL ENTRY;
       83     6525    1   DCL KVO$ERSSRD ENTRY;
       84     6526    1   DCL KVP$SETPRM ENTRY(1);
       85     6527    1   DCL KVS$GETBFR ENTRY(1) ALTRET;
       86     6528    1   DCL KVS$RLSBFR ENTRY(1) ALTRET;
       87     6529    1   DCL KVV$CALUSR_EVT ENTRY(1) ALTRET;
       88     6530    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
       89     6531    1   DCL KVM$SND ENTRY(1) ALTRET;
       90     6532
       91     6533    1   DCL KV_B_POOL$ PTR SYMREF;
       92     6534        %KV$VDH_GETBFR(NAME = KV_VDH_GETBFR, STCLASS = "SYMREF READONLY");
       93     6599        %KV$VDH_RLSBFR(NAME = KV_VDH_RLSBFR, STCLASS = "SYMREF READONLY");
       94     6635        %KV$VDH_SETPRM(NAME = KV_VDH_SETPRM, STCLASS = "SYMREF READONLY");
       95     6697        %KV$SND_CNC (NAME=KV_SND_CNC, STCLASS=SYMREF READONLY);
       96     6785
       97     6786        /* LOCAL VARIABLES                                                            */
       98     6787
       99     6788    1   DCL PRM CHAR(PRM_STRID);                /* Dummy parameter for redefs         */
      100     6789        %KV$VDH_CNC (NAME=PRM_VDH_CNC, STCLASS=REDEF PRM); /*  VDH CONNECT PARAMETER  */
      101     6881    1   DCL PRM_STRID REDEF PRM UBIN;
      102     6882        %VLP_WINDOW (FPTN=PRM_WINDOW, STCLASS=REDEF PRM);
      103     6926        %SET KV_VDO_FNC_OPNSTR = 0;
      104     6927        %KV$VDO_OPNSTR (NAME=PRM_VDO_OPNSTR, STCLASS=REDEF PRM);
      105     6970        %KV$VDH_GETBFR(NAME = KV@VDH_GETBFR, STCLASS = AUTO);
      106     7035        %KV$VDH_RLSBFR;
      107     7071        %EQU VDH_RLSBFR = CHARTEXT('ADDR(KV@VDH_GETBFR)->KV$VDH_RLSBFR');
      108     7072        %KV$VDH_SETPRM(NAME = KV@VDH_SETPRM, STCLASS = AUTO);
      109     7134        %KV$SND_CNC(NAME = KV@SND_CNC, STCLASS = AUTO);
      110     7222    1   DCL ORGPTR$ PTR;                        /* Original KV$PTR$                   */
      111     7223    1   DCL TEMP UBIN;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:4    
      112     7224    1   DCL STEMP REDEF TEMP SBIN;
      113     7225        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:5    
      114     7226
      115     7227        /* First check that there's a bit of memory left. */
      116     7228    1      TEMP = KV$BPC.USE/16;
      117     7229    1      IF KV_SSNCNT>0 THEN TEMP=TEMP/KV_SSNCNT;
      118     7230    1      IF KV$BPC.TOT-KV$BPC.USE<64*TEMP THEN GOTO CANTGETCTX;
      119     7231
      120     7232    1      ORGPTR$ = KV$PTR$;
      121     7233    1      KV@VDH_GETBFR = KV_VDH_GETBFR;
      122     7234    1      KV@VDH_GETBFR.SCRNO_MMR = '0'B;
      123     7235
      124     7236        /* Get KV$PTR for session, unless this is the first.                          */
      125     7237    2      IF KV$PTR.SSN$~=ADDR(NIL) THEN DO;
      126     7238    3         IF %KV_VDI.SSNCNT=KV_SSNMAX THEN DO;
      127     7239    3            IF KV$PTR.STR$~=ADDR(NIL)
      128     7240    3            THEN %KV_STR.ERR.COD = %E$TOOMANYSSNS;
      129     7241        /*E* ERROR: KVC-E$TOOMANYSSNS-C
      130     7242             MESSAGE: Too many sessions on the device to start another.
      131     7243        */
      132     7244    3            GOTO ERRXIT;
      133     7245    3         END;
      134     7246    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_PTR;
      135     7247    2         CALL KVS$GETBFR(KV@VDH_GETBFR) ALTRET(CANTGETCTX);
      136     7248
      137     7249        /* Set up the new session's synchronous KV$PTR.                               */
      138     7250
      139     7251    2         KV$PTR$ = KV@VDH_GETBFR.BFR$;
      140     7252    2         KV$PTR.VDI$ = ORGPTR$->KV$PTR.VDI$;
      141     7253    2         CALL CALUSRGETSTR;
      142     7254    2      END;
      143     7255
      144     7256        /* Get session context.                                                       */
      145     7257
      146     7258    1      KV@VDH_GETBFR.STRTYP = %KV_STRTYP_SSN;
      147     7259    2      CALL KVS$GETBFR(KV@VDH_GETBFR) WHENALTRETURN DO; /* GET SSN CONTEXT BLOCK  */
      148     7260    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_PTR;
      149     7261    2         KV@VDH_GETBFR.BFR$ = KV$PTR$;
      150     7262    2         KV$PTR$ = ORGPTR$;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:6    
      151     7263    2         IF ORGPTR$~=KV@VDH_GETBFR.BFR$
      152     7264    2         THEN CALL KVS$RLSBFR (KV@VDH_GETBFR);
      153     7265    2         GOTO CANTGETCTX;
      154     7266    2      END;
      155     7267
      156     7268        /* Link the new KV$SSN in at the head of the KV$SSN chain. */
      157     7269
      158     7270    1      KV@VDH_GETBFR.BFR$->KV$SSN.LNK$ = %KV_VDI.SSN$;
      159     7271    1      %KV_VDI.SSN$ = KV@VDH_GETBFR.BFR$;
      160     7272    1      KV$PTR.SSN$ = KV@VDH_GETBFR.BFR$;
      161     7273    1      KV@VDH_GETBFR.BFR$->KV$SSN.SNCPTR$ = KV$PTR$;
      162     7274    1      KV@VDH_GETBFR.BFR$->KV$SSN.VDI$ = KV$PTR.VDI$;
      163     7275    1      CALL CALUSRGETSTR;
      164     7276
      165     7277    2      IF %KV_VDI.TRCBFR$ ~= ADDR(NIL) THEN DO;
      166     7278        /*
      167     7279        KV$VDI has a trace buffer.
      168     7280        */
      169     7281    3         IF %KV_VDI.SHRTRCBFR THEN DO;
      170     7282        /*
      171     7283        We're to share trace buffers between KV$VDI and KV$SSN.
      172     7284        */
      173     7285    3            %KV_SSN.TRCBFR$ = %KV_VDI.TRCBFR$;
      174     7286    3         END; ELSE DO;                     /* ELSE IF NOT SHRTRCBFR              */
      175     7287        /*
      176     7288        We're to get a separate trace buffer for this session.
      177     7289        */
      178     7290    3            KV@VDH_GETBFR.STRTYP = %KV_STRTYP_TRCBFR;
      179     7291    3            KV@VDH_GETBFR.BYTSIZ = %KV_VDI.TRCBFRBYTSIZ;
      180     7292    3            CALL KVS$GETBFR(KV@VDH_GETBFR)
      181     7293    4            WHENRETURN DO;
      182     7294    4               %KV_SSN.TRCBFR$ = KV@VDH_GETBFR.BFR$;
      183     7295    4            END;                           /* END WHENRETURN                     */
      184     7296    3         END;                              /* END ELSE IF SHRTRCBFR              */
      185     7297    2      END; /* END IF KV$VDI.TRCBFR$ ~= NIL */
      186     7298    2      IF PRM_VDH_CNC.SSNCNCINT THEN DO;
      187     7299        /*
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:7    
      188     7300        We're initiating the session connection (as opposed to
      189     7301        processing a received session-initiation/connection request).
      190     7302        */
      191     7303    2         %KV_SSN.SSNCNCINT = '1'B;
      192     7304    2         %KV_VDI.LINSPD = PRM_VDH_CNC.LINSPD;
      193     7305    2      END; /* END IF PRM_VDH_CNC.SSNCNCINT */
      194     7306    1      ELSE IF PRM_VDH_CNC.NEWSSN THEN %KV_SSN.SSNCNCINT = '1'B;
      195     7307    1      ELSE %KV_SSN.SSNCNCID = PRM_VDH_CNC.DSTNTWADR.LDCTX;
      196     7308
      197     7309    2      IF %KV_SSN.LNK$ = ADDR(NIL) THEN DO;
      198     7310        /*
      199     7311        This is the first session on this chain of sessions.
      200     7312        Allocate some context that would otherwise be shared among
      201     7313        the sessions.
      202     7314        */
      203     7315
      204     7316        /* GET KV$MVD                                                                 */
      205     7317
      206     7318    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_MVD;
      207     7319    2         CALL KVS$GETBFR(KV@VDH_GETBFR) ALTRET(BUMMER);
      208     7320
      209     7321    2         KV$PTR.MVD$ = KV@VDH_GETBFR.BFR$;
      210     7322
      211     7323    2         IF %KV_USRPRM.INPFNCTBLHEDPTR$~=ADDR(NIL)
      212     7324    2         THEN KV@VDH_GETBFR.BFR$->KV$MVD.SSTINPFNCTBL$ =
      213     7325    2           %KV_USRPRM.INPFNCTBLHEDPTR$->Y$PTR$;
      214     7326        /* Set the default translate table, in case there's no profile */
      215     7327    2         IF %KV_USRPRM.TRNTBLHEDPTR$~=ADDR(NIL)
      216     7328    2         THEN KV@VDH_GETBFR.BFR$->KV$MVD.TRNTBL$ =
      217     7329    2           %KV_USRPRM.TRNTBLHEDPTR$->Y$PTR$;
      218     7330    2         CALL CALUSRGETSTR;
      219     7331
      220     7332        /* GET KV$SRD                                                                 */
      221     7333
      222     7334    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_SRD;
      223     7335    2         CALL KVS$GETBFR(KV@VDH_GETBFR) ALTRET(BUMMER);
      224     7336
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:8    
      225     7337    2         KV$PTR.SRD$ = KV@VDH_GETBFR.BFR$;
      226     7338    2         %KV_MVD.SRD$ = KV@VDH_GETBFR.BFR$;
      227     7339    2         CALL CALUSRGETSTR;
      228     7340
      229     7341        /* GET KV$MRD FOR DEVICE                                                      */
      230     7342
      231     7343    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_MRD;
      232     7344    2         CALL KVS$GETBFR(KV@VDH_GETBFR) ALTRET(BUMMER);
      233     7345
      234     7346    2         KV$PTR.MRD$ = KV@VDH_GETBFR.BFR$;
      235     7347    2         KV@VDH_GETBFR.BFR$->KV$MRD.SRD$ = KV$PTR.SRD$;
      236     7348    2         KV@VDH_GETBFR.BFR$->KV$MRD.MVD$ = KV$PTR.MVD$;
      237     7349    2         IF %KV_USRPRM.PRFFNCTBL$~=ADDR(NIL)
      238     7350    2         THEN KV@VDH_GETBFR.BFR$->KV$MRD.PRFINPFNCTBL$ = %KV_USRPRM.PRFFNCTBL$;
      239     7351    2         %KV_SRD.MRD$ = KV@VDH_GETBFR.BFR$;
      240     7352    2         CALL CALUSRGETSTR;
      241     7353    2         CALL KVI$NEWINPFNCTBL;
      242     7354    2      END; ELSE DO;
      243     7355        /*
      244     7356        We're adding another session to this instance of VDI.
      245     7357        Share some context we'd otherwise allocate.
      246     7358        */
      247     7359    2         KV@VDH_GETBFR.BFR$ = %KV_SSN.LNK$;
      248     7360    2         KV$PTR.MRD$ = ORGPTR$->KV$PTR.MRD$;
      249     7361    2         KV$PTR.SRD$ = ORGPTR$->KV$PTR.SRD$;
      250     7362    2         KV$PTR.MVD$ = ORGPTR$->KV$PTR.MVD$;
      251     7363        /*
      252     7364           Compute a unique SSNID for this session.
      253     7365        */
      254     7366    2         TEMP = 1;
      255     7367    3         DO WHILE KV@VDH_GETBFR.BFR$~=ADDR(NIL);
      256     7368    4            IF TEMP=KV@VDH_GETBFR.BFR$->KV$SSN.SSNID THEN DO;
      257     7369    4               TEMP = TEMP+1;
      258     7370    4               KV@VDH_GETBFR.BFR$ = KV$PTR.SSN$;
      259     7371    4            END;
      260     7372    3            KV@VDH_GETBFR.BFR$ = KV@VDH_GETBFR.BFR$->KV$SSN.LNK$;
      261     7373    3         END;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:9    
      262     7374    2         %KV_SSN.SSNID = TEMP;
      263     7375    2      END; /* END ELSE IF %KV_SSN.LNK$ = ADR(NIL) */
      264     7376
      265     7377        /* Get type-ahead buffer.                                                     */
      266     7378
      267     7379    1      KV@VDH_GETBFR.STRTYP = %KV_STRTYP_TYPAHDBFR;
      268     7380    1      CALL KVS$GETBFR(KV@VDH_GETBFR) ALTRET(BUMMER);
      269     7381
      270     7382    1      %KV_SSN.TYPAHDBFRHED$ = KV@VDH_GETBFR.BFR$;
      271     7383    1      %KV_SSN.TYPAHDBFRINS$ = KV@VDH_GETBFR.BFR$;
      272     7384    1      %KV_SSN.TYPAHDBFRCNT = 1;
      273     7385
      274     7386        /* GET ONE STREAM                                                              */
      275     7387
      276     7388    1      IF NOT PRM_VDH_CNC.NEWSSN            /* Unless we already have one to use. */
      277     7389    1      THEN CALL Y$GETSTR(1) ALTRET(BUMMER);
      278     7390    2      ELSE DO;
      279     7391    2         %KV_SSN.STR$ = ORGPTR$->KV$PTR.STR$;
      280     7392    2         KV$PTR.STR$ = ORGPTR$->KV$PTR.STR$;
      281     7393    2         %KV_STR.SSN$ = KV$PTR.SSN$;
      282     7394    2         %KV_STR.ID = 1;
      283     7395    2         KV$PTR.SSN$ = ORGPTR$->KV$PTR.SSN$;
      284     7396    2         CALL KVC$RLSSTR;                  /* Unchain from the old session       */
      285     7397    2         KV$PTR.SSN$ = %KV_STR.SSN$;
      286     7398        /*N* Account for moved structures. Put a valid stream into ORGPTR. */
      287     7399    2      END;
      288     7400
      289     7401    2      IF PRM_VDH_CNC.PRF_.ADR$~=ADDR(NIL) THEN DO;
      290     7402
      291     7403        /* SET PROFILE FOR THIS USER                                                  */
      292     7404
      293     7405    2         KV@VDH_SETPRM = KV_VDH_SETPRM;
      294     7406    2         KV@VDH_SETPRM.PRMID = %KV_PRMID_TYPLNG;
      295     7407    2         KV@VDH_SETPRM.VAL_ = PRM_VDH_CNC.PRF_;
      296     7408    2         CALL KVP$SETPRM(KV@VDH_SETPRM);
      297     7409    2      END; /* END IF PRM_VDH_CNC.PRF_.ADR$~=ADDR(NIL) */
      298     7410
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:10   
      299     7411        /* CALL KVM$SND to start the connection protocol. */
      300     7412
      301     7413    1      KV@SND_CNC = KV_SND_CNC;
      302     7414    1      KV@SND_CNC.LGN_ = PRM_VDH_CNC.LGN_;
      303     7415    1      KV@SND_CNC.SCNENDPNTID = PRM_VDH_CNC.LCLENDPNTID;
      304     7416        /*N* Need to get SCN/LCLENDPNDID from user, via GETPRM */
      305     7417        /*N* Get PRF_ from user, via GETPRM? */
      306     7418    1      KV@SND_CNC.LINSPD = %KV_VDI.LINSPD;
      307     7419    1      IF (PRM_VDH_CNC.DSTNTWRSR = ' ')
      308     7420    2        AND (PRM_VDH_CNC.DSTNTWADR = '0'B) THEN DO;
      309     7421        /*
      310     7422        The destination network resource is blanks, and there is no
      311     7423        destination network address being passed.  Connect to the
      312     7424        logon process, by default.
      313     7425        */
      314     7426    2         KV@SND_CNC.DSTNTWRSR = 'LOGON';
      315     7427    2         %KV_SSN.LGN = '1'B;
      316     7428    2      END; ELSE DO;
      317     7429        /*
      318     7430        Connect to whatever the caller specified.
      319     7431        */
      320     7432    2         KV@SND_CNC.DSTNTWADR = PRM_VDH_CNC.DSTNTWADR;
      321     7433    2         KV@SND_CNC.DSTNTWRSR = PRM_VDH_CNC.DSTNTWRSR;
      322     7434    2      END; /* END ELSE IF DSTNTWRSR = ' ' ... */
      323     7435    1      CALL KVM$SND (KV@SND_CNC) ALTRET(BUMMER);
      324     7436
      325     7437    2      IF ORGPTR$=KV$PTR$ THEN DO;
      326     7438
      327     7439        /* This is the first session to be allocated. */
      328     7440        /* We succeeded in connecting. Disable KV_VDH_EVT_ID_RLSVDI.                  */
      329     7441        /* We'll set it later if we want it on again.                                 */
      330     7442
      331     7443    2         %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RLSVDI) = '0'B;
      332     7444
      333     7445    2      END;
      334     7446    1      IF %KV_SSN.SSNCNCINT
      335     7447        /* Restore the original context unless this is a received INIT message. */
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:11   
      336     7448    1      THEN KV$PTR$ = ORGPTR$;
      337     7449    1      IF %KV_STR.SSN$~=KV$PTR.SSN$
      338     7450        /*
      339     7451           We just made a new session for an existing VDI. STR$ is bad.
      340     7452        */
      341     7453    1      THEN KV$PTR.STR$ = ADDR(NIL);
      342     7454
      343     7455    1      KV_SSNCNT = KV_SSNCNT+1;   /* Count active SSNs for memory check purposes. */
      344     7456    1      %KV_VDI.SSNCNT = %KV_VDI.SSNCNT+1;
      345     7457    1      %KV_STT.CNCEVTCNT = %KV_STT.CNCEVTCNT+1;
      346     7458    1      RETURN;
      347     7459
      348     7460
      349     7461        /* SOME ERROR HAS OCCURED. WE MUST RELEASE ALL CONTEXT WE MIGHT HAVE          */
      350     7462        /* GOTTEN.                                                                    */
      351     7463
      352     7464    1   BUMMER:
      353     7465    1      CALL KVC$RLSSSNNO_CNC;
      354     7466
      355     7467    1      KV$PTR$ = ORGPTR$;
      356     7468    1   CANTGETCTX:;
      357     7469    1      IF KV$PTR.STR$~=ADDR(NIL)
      358     7470    1      THEN %KV_STR.ERR.COD = %E$CANTGETCTX;
      359     7471         /*E*  ERROR: KVC-E$CANTGETCTX-E
      360     7472                 MESSAGE:Insufficient communications handler memory available.
      361     7473                 MESSAGE1:Communications handler memory insufficient.  Your system
      362     7474                          manager may want to adjust the handler's boot parameters.
      363     7475           */
      364     7476    1   ERRXIT:;
      365     7477        /*
      366     7478           Send INIT_ACK if that seems to be appropriate.
      367     7479        */
      368     7480    2      IF PRM_VDH_CNC.DSTNTWADR AND KV$PTR.SSN$~=ADDR(NIL) THEN DO;
      369     7481    2         KV@SND_CNC = KV_SND_CNC;
      370     7482    2         KV@SND_CNC.DSTNTWADR = PRM_VDH_CNC.DSTNTWADR;
      371     7483    2         KV@SND_CNC.ERR = '1'B;
      372     7484    2         %KV_SSN.SSNCNCINT = '0'B;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:12   
      373     7485    2         CALL KVM$SND (KV@SND_CNC);
      374     7486    2      END;
      375     7487    1      ALTRETURN;
      376     7488
      377     7489        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:13   
      378     7490    1   KVC$WINDOW1: ENTRY (PRM) ALTRET;
      379     7491
      380     7492        /*F* NAME: KVC$WINDOW1, KVC$WINDOW2.
      381     7493             PURPOSE: Creates(-1) or modifies(-2) a window.  The parameter is a
      382     7494             VLP_WINDOW specifying the new parameters to be established.
      383     7495             KVC$WINDOW1 modifies some items in VLP_WINDOW for later use by
      384     7496             KVC$WINDOW2, so it must be writable, and KVC$WINDOW1 must not be
      385     7497             called more than once with the same VLP_WINDOW. */
      386     7498
      387     7499        /* First check that windows are permitted on the device. */
      388     7500
      389     7501    1      IF NOT %KV_MRD.BLANKERASES AND NOT %KV_MRD.FSTERS
      390     7502    1        OR NOT %KV_MRD.PHSFRM
      391     7503    1        OR NOT %KV_MRD.CURSORUP THEN ALTRETURN;
      392     7504    1      ORGPTR$ = %KV_SSN.STR$;
      393     7505    2      DO WHILE ORGPTR$~=ADDR(NIL);
      394     7506    2         IF ORGPTR$->KV$STR.ID=PRM_WINDOW.FSTR.ID THEN EXIT;
      395     7507    2         ORGPTR$ = ORGPTR$->KV$STR.LNK$;
      396     7508    2      END;
      397     7509    1      IF ORGPTR$=ADDR(NIL) THEN PRM_WINDOW.FWINDOW$ = ORGPTR$;
      398     7510    1      ELSE PRM_WINDOW.FWINDOW$ = ORGPTR$->KV$STR.MVD$->KV$MVD.SRD$;
      399     7511
      400     7512        /* Get a MVD-SRD pair if we need one. */
      401     7513
      402     7514    2      IF %KV_MVD.USRCNT>1 AND PRM_WINDOW.POSITION~=0 THEN DO;
      403     7515
      404     7516    2         ORGPTR$ = KV$PTR.MVD$;            /* In case we don't succeed.          */
      405     7517    2         IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN THEN CALL KVV$CALUSR_PST;
      406     7518    2         KV@VDH_GETBFR = KV_VDH_GETBFR;
      407     7519    2         CALL Y$GETMVD ALTRET(NO_CTX);
      408     7520    2         CALL CALUSRGETSTR;
      409     7521    3         CALL Y$GETSRD WHENALTRETURN DO;
      410     7522    3            CALL KVC$RLSMVD;
      411     7523    3            %KV_STR.MVD$ = ORGPTR$;
      412     7524    3            KV$PTR.MVD$ = ORGPTR$;
      413     7525    3            %KV_MVD.USRCNT = %KV_MVD.USRCNT+1;
      414     7526    3            GOTO NO_CTX;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:14   
      415     7527    3         END;
      416     7528    2         CALL CALUSRGETSTR;
      417     7529    2      END;
      418     7530    2      ELSE DO;
      419     7531    2         PRM_WINDOW.POSITION = 0;
      420     7532    2      END;
      421     7533    1      RETURN;
      422     7534        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:15   
      423     7535    1   KVC$WINDOW2: ENTRY (PRM) ALTRET;
      424     7536
      425     7537        /* Findchange in length required. */
      426     7538
      427     7539    1      IF PRM_WINDOW.POSITION~=%G_POSITION_LEFT#
      428     7540    2        AND PRM_WINDOW.POSITION~=%G_POSITION_RIGHT# THEN DO;
      429     7541    3         IF PRM_WINDOW.LENGTH>%G_WINDOW_PERCENT# THEN DO;
      430     7542    3            IF PRM_WINDOW.POSITION~=0 THEN TEMP = %KV_MRD.LNG;
      431     7543    3            ELSE IF PRM_WINDOW.FWINDOW$~=ADDR(NIL)
      432     7544    3            THEN TEMP = PRM_WINDOW.FWINDOW$->KV$SRD.SRDEND.LIN-
      433     7545    3              PRM_WINDOW.FWINDOW$->KV$SRD.ORG.LIN;
      434     7546    3            ELSE TEMP = %KV_SRD.SRDEND.LIN-%KV_SRD.ORG.LIN;
      435     7547    3            PRM_WINDOW.LENGTH = TEMP*(PRM_WINDOW.LENGTH-%G_WINDOW_PERCENT#)
      436     7548    3              /100-%KV_SRD.SRDEND.LIN+%KV_SRD.ORG.LIN;
      437     7549    2         END; ELSE IF PRM_WINDOW.LENGTH>=%G_WINDOW_ABSVAL#
      438     7550    2         THEN PRM_WINDOW.LENGTH =
      439     7551    2           PRM_WINDOW.LENGTH-%G_WINDOW_ABSVAL#-%KV_SRD.SRDEND.LIN+%KV_SRD.ORG.LIN;
      440     7552    2      END;
      441     7553    1      ELSE PRM_WINDOW.LENGTH = 0;
      442     7554
      443     7555        /* Compute the change in width required. */
      444     7556
      445     7557    1      IF PRM_WINDOW.POSITION~=%G_POSITION_TOP#
      446     7558    2        AND PRM_WINDOW.POSITION~=%G_POSITION_BOTTOM# THEN DO;
      447     7559    3         IF PRM_WINDOW.WIDTH>%G_WINDOW_PERCENT# THEN DO;
      448     7560    3            IF PRM_WINDOW.POSITION~=0 THEN TEMP = %KV_MRD.WDT;
      449     7561    3            ELSE IF PRM_WINDOW.FWINDOW$~=ADDR(NIL)
      450     7562    3            THEN TEMP = PRM_WINDOW.FWINDOW$->KV$SRD.WDT;
      451     7563    3            ELSE TEMP = %KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM;
      452     7564    3            PRM_WINDOW.WIDTH = TEMP*(PRM_WINDOW.WIDTH-%G_WINDOW_PERCENT#)
      453     7565    3              /100-%KV_SRD.SRDEND.CLM+%KV_SRD.ORG.CLM;
      454     7566    2         END; ELSE IF PRM_WINDOW.WIDTH>=%G_WINDOW_ABSVAL#
      455     7567    2         THEN PRM_WINDOW.WIDTH =
      456     7568    2           PRM_WINDOW.WIDTH-%G_WINDOW_ABSVAL#-%KV_SRD.SRDEND.CLM+%KV_SRD.ORG.CLM;
      457     7569    2      END;
      458     7570    1      ELSE PRM_WINDOW.WIDTH = 0;
      459     7571
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:16   
      460     7572        /* Now call the recursive size changer. */
      461     7573
      462     7574    2      IF PRM_WINDOW.LENGTH~=0 OR PRM_WINDOW.POSITION~=0 THEN DO;
      463     7575    2         CALL KVC$ADJWND (PRM);
      464     7576    2         PRM_WINDOW.LENGTH = 0;
      465     7577    2      END;
      466     7578    1      IF PRM_WINDOW.WIDTH~=0 AND PRM_WINDOW.POSITION=0 THEN CALL KVC$ADJWND (PRM);
      467     7579    1      RETURN;
      468     7580        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:17   
      469     7581        /*F* NAME: KVC$DCLSTR.
      470     7582             PURPOSE: Adds another stream to an existing session.
      471     7583             CALL: The single parameter is a UBIN stream-id. */
      472     7584    1   KVC$DCLSTR: ENTRY (PRM) ALTRET;
      473     7585
      474     7586    1      ORGPTR$ = KV$PTR.STR$;
      475     7587    1      KV@VDH_GETBFR = KV_VDH_GETBFR;
      476     7588    2      CALL Y$GETSTR (PRM_VDH_CNC) WHENALTRETURN DO;
      477     7589    2   NO_CTX:;
      478     7590    2         %KV_STR.ERR.COD = %E$CANTGETCTX;
      479     7591    2         ALTRETURN;
      480     7592    2      END;
      481     7593    1      KV$PTR.STR$ = ORGPTR$;
      482     7594    1      RETURN;
      483     7595        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:18   
      484     7596    1   KVC$OPNFRM: ENTRY (PRM) ALTRET;
      485     7597        /*F* NAME: KVC$OPNFRM
      486     7598
      487     7599           PURPOSE: KVC$OPNFRM initializes the context needed for a forms,
      488     7600        X3.64 or editing window.                                                          */
      489     7601
      490     7602    1      KV@VDH_GETBFR.BFR$ = KV$PTR.LINLST$;
      491     7603    1      IF %KV_MVD.ORG=PRM_VDO_OPNSTR.ORG
      492     7604    1      THEN IF %KV_MVD.ORG~=%KV#VD_ORG_SE
      493     7605    1        OR (PRM_VDO_OPNSTR.NRECS=0 OR %KV_RCRLST.MAXRCR>=PRM_VDO_OPNSTR.NRECS)
      494     7606    1        AND (PRM_VDO_OPNSTR.KEYL=0 OR %KV_RCRLST.KEYLNG=PRM_VDO_OPNSTR.KEYL)
      495     7607    1        AND (PRM_VDO_OPNSTR.SPARE=0 OR %KV_RCRLST.SPRCNT=PRM_VDO_OPNSTR.SPARE)
      496     7608    1      THEN RETURN;                         /* That was easy                      */
      497     7609    1      KV@VDH_SETPRM = KV_VDH_SETPRM;
      498     7610    1      KV@VDH_SETPRM.SCP = %KV_SCP_ONE_ONLY;
      499     7611
      500     7612    1      KV@VDH_GETBFR = KV_VDH_GETBFR;       /* Sets up RLSBFR ok, too.            */
      501     7613    1      IF %KV_MVD.LINLST$~=ADDR(NIL) THEN CALL KVC$RLSFRM;
      502     7614
      503     7615        /* Release the unusable MVD appendages. */
      504     7616
      505     7617    2      IF PRM_VDO_OPNSTR.ORG=%KV#VD_ORG_FORM THEN DO;
      506     7618    2         IF %KV_SRD.WDT~=%KV_MRD.WDT AND %KV_MRD.MAXATRPERLIN<%KV_MRD.WDT
      507     7619    2           AND NOT %KV_MRD.DCLATRWHNOTP OR %KV_SRD.LNG=0 THEN GOTO NOTCOM_ERR;
      508     7620    2         %KV_SRD.MINWDT = %KV_SRD.WDT;
      509     7621    2         %KV_SRD.MINLNG = %KV_SRD.LNG;
      510     7622    2         %KV_SRD.OPT = '0'B;
      511     7623        /* Run short screens in hard-copy (scrolling) mode. */
      512     7624    2         IF NOT %KV_MRD.CURSORUP THEN %KV_MVD.RETYPOVR = '0'B;
      513     7625    3         IF NOT %KV_MVD.RETYPOVR AND %KV_MVD.USRCNT>1 THEN DO;
      514     7626    3            CALL Y$GETMVD ALTRET(NO_CTX); /* Get another MVD for the FORM stream */
      515     7627    4            IF NOT %KV_MRD.PHSFRM THEN DO;
      516     7628
      517     7629        /* The paper is not fixed length, use a sensible value (not 255).             */
      518     7630
      519     7631    4               %KV_SRD.MINLNG = 24;
      520     7632    4            END /* IF */;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:19   
      521     7633    3         END /* IF NOT RETYPOVR */;
      522     7634
      523     7635    2         %VDH_RLSBFR.BFR$ = %KV_MVD.INPTAB$;
      524     7636    2         %VDH_RLSBFR.STRTYP = %KV_STRTYP_INPTAB;
      525     7637    2         %KV_MVD.INPTAB$ = ADDR(NIL);
      526     7638    2         CALL KVS$RLSBFR (%VDH_RLSBFR);
      527     7639    2      END;
      528     7640    1      ELSE IF NOT %KV_MVD.RETYPOVR OR NOT %KV_MRD.CURSORUP THEN GOTO NOTCOM_ERR;
      529     7641         /*E*  ERROR:KV-E$ORGNOTCOM-E
      530     7642                 MESSAGE:SE, FORM, or X364 needs RETYPOVR. FORM needs wide window.
      531     7643                 MESSAGE1:For ORG=SE, FORM, or X364, RETYPOVR=YES and HEIGHT>=24
      532     7644                          must be true. For C00 FORMs, the window must be full width.
      533     7645           */
      534     7646
      535     7647    2      IF PRM_VDO_OPNSTR.ORG~=%KV#VD_ORG_X364 THEN DO;
      536     7648    3         IF %KV_MVD.USRCNT>1 THEN DO;
      537     7649    3   NOTCOM_ERR:;
      538     7650    3            %KV_STR.ERR.COD = %E$ORGNOTCOM;
      539     7651    3            ALTRETURN;
      540     7652    3         END;
      541     7653    2         IF NOT %KV_MVD.RETYPOVR THEN EXIT;
      542     7654    2         %KV_SRD.TRUNCATE = '0'B;
      543     7655        /* No scroll for FORM or SE */
      544     7656    2         IF NOT %KV_SRD.SCROLL THEN EXIT;
      545     7657    2         KV@VDH_SETPRM.PRMID = %KV_PRMID_SCROLL;
      546     7658    2         CALL KVP$SETPRM (KV@VDH_SETPRM);
      547     7659    2      END;
      548     7660
      549     7661    1      %KV_SRD.NXTNONBLNLIN = 255;
      550     7662    2      IF %KV_MVD.RETYPOVR THEN DO;
      551     7663    2         %KV_SRD.NOOPTMIZ = '0'B;
      552     7664    2         %KV_MVD.EDITOVR = '1'B;
      553     7665    2      END;
      554     7666    1      %VDH_RLSBFR.BFR$ = %KV_MVD.VFU$;
      555     7667    1      %VDH_RLSBFR.STRTYP = %KV_STRTYP_VFU;
      556     7668    1      CALL KVS$RLSBFR (%VDH_RLSBFR);
      557     7669    1      %KV_MVD.VFU$ = ADDR(NIL);
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:20   
      558     7670        /* strip the form stream                                                      */
      559     7671
      560     7672    1      CALL Y$STRSTR;
      561     7673    1      %KV_STR.ACTCHRTBL$ = ADDR(KV_ACTCHRTBLNRM);
      562     7674
      563     7675    1      %KV_MVD.WDT = %KV_SRD.WDT;
      564     7676    1      %KV_MVD.LNG = 0;
      565     7677
      566     7678        /* Now get the LINLST area. */
      567     7679
      568     7680    2      DO CASE PRM_VDO_OPNSTR.ORG;
      569     7681    2      CASE %KV#VD_ORG_FORM;
      570     7682    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_LINLST;
      571     7683    2         KV@VDH_GETBFR.BYTSIZ = 2*SIZEW(KV$LINLST)+2*SIZEW(KV$LIN)*%KV_SRD.MINLNG;
      572     7684    2      CASE %KV#VD_ORG_SE;
      573     7685    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_RCRLST;
      574     7686    2         TEMP = MAXIMUM (%KV_MRD.DSPHEIGHT+10, MINIMUM (50,
      575     7687    2           MAXIMUM (PRM_VDO_OPNSTR.NRECS, %KV_SRD.LNG*2)));
      576     7688    2         KV@VDH_GETBFR.BYTSIZ = SIZEC(KV$RCRLST)+SIZEC(KV$RCRLST.RCR$)*(TEMP-1);
      577     7689    2      CASE %KV#VD_ORG_X364;
      578     7690    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_X364;
      579     7691    2      END; /* END DO CASE .ORG */
      580     7692    1      CALL KVS$GETBFR (KV@VDH_GETBFR) ALTRET(NO_CTX);
      581     7693    1      %KV_MVD.LINLST$ = KV@VDH_GETBFR.BFR$;
      582     7694    1      KV$PTR.LINLST$ = KV@VDH_GETBFR.BFR$;
      583     7695    2      IF KV@VDH_GETBFR.STRTYP=%KV_STRTYP_LINLST THEN DO;
      584     7696    2         %KV_LINLST = '0'B;
      585     7697    2         %KV_LINLST.LSTCELWRDX = KV@VDH_GETBFR.BYTSIZ/2-1;
      586     7698    2         %KV_LINLST.LSTENTWRDX = SIZEW(KV$LINLST)+(%KV_SRD.MINLNG-1)*SIZEW(KV$LIN);
      587     7699    2         STEMP = SIZEW(KV$LINLST);
      588     7700    3         DO UNTIL STEMP > %KV_LINLST.LSTENTWRDX;
      589     7701
      590     7702        /* This loop is traversed for each KV$LIN entry in the KV$LINLST              */
      591     7703        /* table initialized.                                                         */
      592     7704
      593     7705    3            PINCRW(ADDR(%KV_LINLST),STEMP)->KV$LIN = KV_LIN;
      594     7706    3            PINCRW(ADDR(%KV_LINLST),STEMP)->KV$LIN.VRTLIN =
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:21   
      595     7707    3              TEMP/SIZEW(KV$LIN) - SIZEW(KV$LINLST)/SIZEW(KV$LIN) + 1;
      596     7708    3            STEMP = STEMP+SIZEW(KV$LIN);
      597     7709    3         END /* LOOP */;
      598     7710    2      END;
      599     7711    2      ELSE IF KV@VDH_GETBFR.STRTYP=%KV_STRTYP_RCRLST THEN DO;
      600     7712    2         %KV_RCRLST = KV_RCRLST;
      601     7713    2         %KV_RCRLST.STRBYTSIZ = KV@VDH_GETBFR.BYTSIZ;
      602     7714    2         %KV_RCRLST.MAXRCR = TEMP;
      603     7715    2         IF PRM_VDO_OPNSTR.KEYL~=0
      604     7716    2         THEN %KV_RCRLST.KEYLNG = MINIMUM(4, PRM_VDO_OPNSTR.KEYL);
      605     7717    2         IF PRM_VDO_OPNSTR.SPARE>1
      606     7718    2         THEN %KV_RCRLST.SPRCNT = MINIMUM(TEMP/2, PRM_VDO_OPNSTR.SPARE);
      607     7719    2         ELSE %KV_RCRLST.SPRCNT = MAXIMUM(TEMP/4,1);
      608     7720    2      END;
      609     7721    1      %KV_MVD.ORG = PRM_VDO_OPNSTR.ORG;
      610     7722
      611     7723        /* Set up the set-parameter request structure for setting the                 */
      612     7724        /* system input function table associated with the forms virtual              */
      613     7725        /* device to "FRM1".                                                          */
      614     7726
      615     7727    2      DO SELECT KV@VDH_GETBFR.STRTYP;
      616     7728    2         SELECT %KV_STRTYP_LINLST;
      617     7729    2         ADDR(KV@SND_CNC)->CHR8 = 'FRM1';
      618     7730    2         SELECT %KV_STRTYP_RCRLST;
      619     7731    2         ADDR(KV@SND_CNC)->CHR8 = 'SE1';
      620     7732    2         IF PRM_VDO_OPNSTR.SPARE>99 THEN SUBSTR(ADDR(KV@SND_CNC)->CHR8,2,1) = '2';
      621     7733    2         SELECT %KV_STRTYP_X364;
      622     7734    2         ADDR(KV@SND_CNC)->CHR8 = 'X364';
      623     7735    2      END; /* END DO SELECT .STRTYP */
      624     7736    1      KV@VDH_SETPRM.VAL_.ADR$ = ADDR(KV@SND_CNC);
      625     7737    1      KV@VDH_SETPRM.VAL_.BYTSIZ = 8;
      626     7738    1      KV@VDH_SETPRM.PRMID = %KV_PRMID_FCNTBL;
      627     7739    1      CALL KVP$SETPRM(KV@VDH_SETPRM) ;
      628     7740    2      IF %KV_MVD.RETYPOVR THEN DO;
      629     7741    2         IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN CALL KVC$DRWBRD;
      630     7742        /* Get rid of any borders for ORG=FORM */
      631     7743    2         CALL KVO$ERSSRD;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:22   
      632     7744    2      END;
      633     7745    1      IF PRM_VDO_OPNSTR.ORG~=%KV#VD_ORG_X364 AND %KV_SSN.LSTEDTBFRSTRID=%KV_STR.ID
      634     7746    1      THEN %KV_SSN.LSTEDTBFRSTRID = 1;
      635     7747    1      RETURN;
      636     7748        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:23   
      637     7749    1   Y$GETSTR: PROC(ID) ALTRET;
      638     7750        /* Gets a stream structure (KV$STR)                                           */
      639     7751    2   DCL ID UBIN;
      640     7752    2   DCL KV_SHRBFR_PRM1 UBIN SYMREF;
      641     7753    2   DCL KV_SHRBFR_PRM2 UBIN SYMREF;
      642     7754    2   DCL KV_SHRBFR_PRM3 UBIN SYMREF;
      643     7755    2   DCL PRMPTRS(0:3) PTR CONSTANT
      644     7756    2    INIT(ADDR(KV_SHRBFR_PRM1)*2,ADDR(KV_SHRBFR_PRM2),ADDR(KV_SHRBFR_PRM3));
      645     7757        /* Reports get-structure event to user                                        */
      646     7758
      647     7759        /* LOCAL                                                                      */
      648     7760
      649     7761        %KV$USR_EVT(NAME = KV@USR_EVT, STCLASS = AUTO);
      650     7796        %KV$USR_EVT(NAME = KV_USR_EVT, STCLASS = "SYMREF READONLY");
      651     7831        %KV$STR (NAME=Y@STR, STCLASS="BASED(KV@VDH_GETBFR.BFR$)");
      652     7918
      653     7919    2      KV@VDH_GETBFR.STRTYP = %KV_STRTYP_STR;
      654     7920    3      CALL KVS$GETBFR(KV@VDH_GETBFR) WHENALTRETURN DO; ALTRETURN; END;
      655     7921
      656     7922    3      IF KV$PTR.STR$~=ADDR(NIL) THEN DO;
      657     7923    3         Y@STR.ACTONTRN = %KV_STR.ACTONTRN;
      658     7924    3         Y@STR.AUTTABCLM = %KV_STR.AUTTABCLM;
      659     7925    3         Y@STR.WRDWRPCLM = %KV_STR.WRDWRPCLM;
      660     7926    3         Y@STR.WRDWRP = %KV_STR.WRDWRP;
      661     7927    3         Y@STR.OTPTAB$ = %KV_STR.OTPTAB$;
      662     7928    3         CALL Y$INCSHRBFR (Y@STR.OTPTAB$->KV$SHRBFR);
      663     7929    3         Y@STR.LFTMRGCLM = %KV_STR.LFTMRGCLM;
      664     7930    3         Y@STR.LNK$ = %KV_SSN.STR$->KV$STR.LNK$;
      665     7931    3         %KV_SSN.STR$->KV$STR.LNK$ = KV@VDH_GETBFR.BFR$;
      666     7932    3      END;
      667     7933    3      ELSE DO;
      668     7934    3         %KV_SSN.STR$ = KV@VDH_GETBFR.BFR$;
      669     7935    3      END;
      670     7936    2      Y@STR.SSN$ = KV$PTR.SSN$;
      671     7937    2      Y@STR.ID = ID;
      672     7938    2      Y@STR.MVD$ = KV$PTR.MVD$;
      673     7939    2      KV$PTR.STR$ = KV@VDH_GETBFR.BFR$;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:24   
      674     7940    2      %KV_MVD.USRCNT = %KV_MVD.USRCNT+1;
      675     7941    2      IF ID<4 THEN Y@STR.PRM$ = PRMPTRS(ID);
      676     7942
      677     7943    2   CALUSRGETSTR: ENTRY ALTRET;
      678     7944        /* Reports get-structure event to user                                        */
      679     7945
      680     7946        /* CHECK TO SEE IF USER WANTS EVENT FOR PARTICULAR STRUCTURE                  */
      681     7947
      682     7948    3      IF %KV_USRPRM.STREVTENB(KV@VDH_GETBFR.STRTYP) THEN DO;
      683     7949
      684     7950        /* WE MUST TELL THE USER                                                      */
      685     7951    3         KV@USR_EVT = KV_USR_EVT;
      686     7952    3         KV@USR_EVT.ID = %KV_USR_EVT_ID_GETSTR;
      687     7953    3         KV@USR_EVT.PRM = KV@VDH_GETBFR.STRTYP;
      688     7954    3         CALL KVV$CALUSR_EVT (KV@USR_EVT);
      689     7955    3      END /* IF */;
      690     7956    2   END /* SUBROUTINE */;
      691     7957        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:25   
      692     7958        /* Strip a stream of its appendages.                                          */
      693     7959
      694     7960
      695     7961    1   Y$STRSTR: PROC;
      696     7962
      697     7963        /* Release the prompt buffer.                                                 */
      698     7964
      699     7965    2      %VDH_RLSBFR.BFR$ = %KV_STR.PRM$;
      700     7966    2      %VDH_RLSBFR.STRTYP = %KV_STRTYP_PRM;
      701     7967    2      CALL KVS$RLSBFR(%VDH_RLSBFR);
      702     7968    2      %KV_STR.PRM$ = ADDR(NIL);
      703     7969
      704     7970        /* Release the edit buffer, if there is one.                                  */
      705     7971
      706     7972    2      %VDH_RLSBFR.STRTYP = %KV_STRTYP_REDBFR;
      707     7973    2      %VDH_RLSBFR.BFR$ = %KV_STR.EDTBFR__.ADR$;
      708     7974    2      %VDH_RLSBFR.BYTSIZ = %KV_STR.EDTBFR__.BFRBYTSIZ;
      709     7975    2      IF %KV_STR.EDTBFR__.BFRRLSDSP~=%KV_BFRRLSDSP_NON
      710     7976    2      THEN CALL KVS$RLSBFR(%VDH_RLSBFR);
      711     7977    2      %KV_STR.EDTBFR__ = '0'B;
      712     7978
      713     7979        /* strip activation character set                                             */
      714     7980
      715     7981    2      %VDH_RLSBFR.STRTYP = %KV_STRTYP_ACTCHR;
      716     7982    2      %VDH_RLSBFR.BFR$ = %KV_STR.ACTCHRTBL$;
      717     7983    2      CALL KVS$RLSBFR(%VDH_RLSBFR);
      718     7984    2      %KV_STR.ACTCHRTBL$ = ADDR(NIL);
      719     7985    2      %VDH_RLSBFR.STRTYP = %KV_STRTYP_OTPTAB;
      720     7986    2      %VDH_RLSBFR.BFR$ = %KV_STR.OTPTAB$;
      721     7987    2      %KV_STR.OTPTAB$ = ADDR(NIL);
      722     7988    2      CALL KVS$RLSBFR(%VDH_RLSBFR);
      723     7989
      724     7990    2   END /* SUBROUTINE */;
      725     7991        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:26   
      726     7992    1   Y$GETMVD: PROC ALTRET;
      727     7993        %KV$MVD (NAME=Y@MVD, STCLASS="BASED(KV@VDH_GETBFR.BFR$)");
      728     8037
      729     8038    2      KV@VDH_GETBFR.STRTYP = %KV_STRTYP_MVD;
      730     8039    2      CALL KVS$GETBFR (KV@VDH_GETBFR)
      731     8040    3      WHENALTRETURN DO;
      732     8041
      733     8042        /* We got an error return on the request to get memory for the                */
      734     8043        /* KV$MVD structure.                                                          */
      735     8044
      736     8045    3         ALTRETURN;
      737     8046    3      END /* IF */;
      738     8047    2      Y@MVD = %KV_MVD;                     /* Initialize from the current one.   */
      739     8048    2      %KV_MVD.USRCNT = %KV_MVD.USRCNT-1;
      740     8049    2      %KV_STR.MVD$ = KV@VDH_GETBFR.BFR$;
      741     8050    2      Y@MVD.SRD$ = KV$PTR.SRD$;
      742     8051    2      %KV_SRD.USRCNT = %KV_SRD.USRCNT+1;
      743     8052    2      Y@MVD.LNK$ = %KV_MRD.MVD$;
      744     8053    2      %KV_MRD.MVD$ = KV@VDH_GETBFR.BFR$;
      745     8054    2      Y@MVD.ORG = %KV#VD_ORG_UR;
      746     8055    2      Y@MVD.USRCNT = 1;
      747     8056    2      Y@MVD.LINLST$ = ADDR(NIL);
      748     8057    2      Y@MVD.PAGBRKPND = '0'B;
      749     8058    2      Y@MVD.FRMSCNINH = '0'B;
      750     8059    2      CALL Y$INCSHRBFR (Y@MVD.INPTAB$->KV$SHRBFR);
      751     8060    2      Y@MVD.INPFNCCPY = '11'B;
      752     8061    2      CALL Y$INCSHRBFR (Y@MVD.USRINPFNCTBL$->KV$SHRBFR);
      753     8062    2      CALL Y$INCSHRBFR (Y@MVD.SSTINPFNCTBL$->KV$SHRBFR);
      754     8063    2      CALL Y$INCSHRBFR (Y@MVD.VFU$->KV$SHRBFR);
      755     8064    2      CALL Y$INCSHRBFR (Y@MVD.TRNTBL$->KV$SHRBFR);
      756     8065    2      CALL Y$INCSHRBFR (Y@MVD.DCBHDN$->KV$SHRBFR);
      757     8066
      758     8067    2      KV$PTR.MVD$ = KV@VDH_GETBFR.BFR$;
      759     8068
      760     8069    2   END /* SUBROUTINE */;
      761     8070        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:27   
      762     8071    1   Y$INCSHRBFR: PROC(Y@SHRBFR);
      763     8072        %KV$SHRBFR (NAME=Y@SHRBFR, STCLASS=);
      764     8104
      765     8105    2      IF ADDR(Y@SHRBFR)~=ADDR(NIL)
      766     8106    2      THEN IF Y@SHRBFR.USRCNT~=%KV_SHRBFR_CNSUSRCNT
      767     8107    2      THEN Y@SHRBFR.USRCNT = Y@SHRBFR.USRCNT+1;
      768     8108    2   END Y$INCSHRBFR;
      769     8109        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:28   
      770     8110    1   Y$GETSRD: PROC ALTRET;
      771     8111
      772     8112        /* Get a new subordinate real device.                                           */
      773     8113
      774     8114        %KV$SRD (NAME=Y@SRD, STCLASS="BASED(KV@VDH_GETBFR.BFR$)");
      775     8389
      776     8390    2      KV@VDH_GETBFR.STRTYP = %KV_STRTYP_SRD;
      777     8391    2      CALL KVS$GETBFR(KV@VDH_GETBFR)
      778     8392    3      WHENALTRETURN DO;
      779     8393
      780     8394        /* We got an error return on the request to get memory for the                */
      781     8395        /* KV$SRD structure.                                                          */
      782     8396
      783     8397    3         ALTRETURN;
      784     8398    3      END /* IF */;
      785     8399    2      IF PRM_WINDOW.FWINDOW$=ADDR(NIL)
      786     8400    2      THEN PRM_WINDOW.FWINDOW$ = KV$PTR.SRD$;
      787     8401    2      Y@SRD = PRM_WINDOW.FWINDOW$->Y@SRD;
      788     8402    2      Y@SRD.LNK$ = %KV_MRD.SRD$;
      789     8403    2      %KV_MRD.SRD$ = KV@VDH_GETBFR.BFR$;
      790     8404    2      %KV_MRD.USRCNT = %KV_MRD.USRCNT+1;
      791     8405    2      Y@SRD.USRCNT = 1;
      792     8406    2      %KV_SRD.USRCNT = %KV_SRD.USRCNT-1;
      793     8407    2      Y@SRD.VRTPSTOK = '0'B;
      794     8408    2      Y@SRD.ADJTOPLFT = '0'B;
      795     8409    3      DO CASE (PRM_WINDOW.POSITION);
      796     8410    3      CASE (%G_POSITION_TOP#);
      797     8411    3         Y@SRD.SRDEND.LIN = Y@SRD.ORG.LIN;
      798     8412    3      CASE (%G_POSITION_LEFT#);
      799     8413    3         Y@SRD.SRDEND.CLM = Y@SRD.ORG.CLM;
      800     8414    3      CASE (%G_POSITION_RIGHT#);
      801     8415    3         Y@SRD.ORG.CLM = Y@SRD.SRDEND.CLM;
      802     8416    3         Y@SRD.ADJTOPLFT = '1'B;
      803     8417    3      CASE (%G_POSITION_BOTTOM#);
      804     8418    3         Y@SRD.ORG.LIN = Y@SRD.SRDEND.LIN;
      805     8419    3         Y@SRD.ADJTOPLFT = '1'B;
      806     8420    3      END;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:29   
      807     8421    2      Y@SRD.LNG = Y@SRD.SRDEND.LIN-Y@SRD.ORG.LIN;
      808     8422    2      Y@SRD.WDT = Y@SRD.SRDEND.CLM-Y@SRD.ORG.CLM;
      809     8423    2      Y@SRD.CRT.LIN = Y@SRD.TOPLFT.LIN+Y@SRD.DVCLINBIS;
      810     8424    2      Y@SRD.CRTVRTLINPHSLIN = Y@SRD.CRT.LIN;
      811     8425    2      Y@SRD.ENTSRDCHR$ = ADDR(NIL);
      812     8426    2      Y@SRD.DVCLINBIS = 0;
      813     8427    2      Y@SRD.TOPLFT_PST = Y@SRD.ORG_PST+%BITBIN('10001'X);
      814     8428    2      %KV_MVD.WDT = Y@SRD.WDT;
      815     8429    2      Y@SRD.BTMRHT = Y@SRD.SRDEND;
      816     8430    2      Y@SRD.BRDUPD = Y@SRD.BRDEXS;
      817     8431    2      Y@SRD.HI_NONBLN = Y@SRD.BTMRHT;
      818     8432    2      Y@SRD.FLDEND = '0'B;
      819     8433    2      KV$PTR.SRD$ = KV@VDH_GETBFR.BFR$;
      820     8434    2      Y@SRD.MRD$ = KV$PTR.MRD$;
      821     8435    2      %KV_MVD.SRD$ = KV@VDH_GETBFR.BFR$;
      822     8436    2      IF %KV_MRD.USRCNT=2
      823     8437    2      THEN Y@SRD.LNK$->Y@SRD.ADJTOPLFT = ~Y@SRD.ADJTOPLFT;
      824     8438    2   END /* SUBROUTINE */;
      825     8439    1   END;
      826     8440        %EOD;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:30   
--  Include file information  --

   K_ID_E.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KV_ERRORS_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KVC$CNC.

   Procedure KVC$CNC requires 2783 words for executable code.
   Procedure KVC$CNC requires 74 words of local(AUTO) storage.

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:31   

 Object Unit name= KVC$CNC                                    File name= KVC$CNC.:E05TOU
 UTS= JUL 30 '97 01:54:49.00 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     35     23  KVC$CNC
    1   Proc  even  none  2783    ADF  KVC$CNC
    2  RoData even  none     2      2  KVC$CNC

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KVC$CNC
     1    34B          yes     yes      Std        1  KVC$WINDOW1
     1    3EA          yes     yes      Std        1  KVC$WINDOW2
     1    4C4          yes     yes      Std        1  KVC$DCLSTR
     1    4F7          yes     yes      Std        1  KVC$OPNFRM

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    0      0  KV_RCRLST
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:32   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KVS$GETBFR
 yes     yes           Std       0 KVV$CALUSR_PST
         yes           Std       0 KVO$ERSSRD
 yes     yes           Std       1 KVS$RLSBFR
         yes           Std       0 KVI$NEWINPFNCTBL
         yes           Std       0 KVC$RLSSTR
 yes     yes           Std       1 KVC$ADJWND
         yes           Std       1 KVP$SETPRM
         yes           Std       0 KVC$RLSSSNNO_CNC
         yes           Std       0 KVC$RLSFRM
 yes     yes           Std       1 KVM$SND
         yes           Std       0 KVC$RLSMVD
         yes           Std       0 KVC$DRWBRD
 yes     yes           Std       1 KVV$CALUSR_EVT
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KV_LIN                                KV$PTR$                               KV_ACTCHRTBLNRM
     KV_SSNCNT                             KV_SSNMAX                             KV_B_POOL$
r    KV_VDH_GETBFR                    r    KV_VDH_SETPRM                    r    KV_SND_CNC
     KV_SHRBFR_PRM1                        KV_SHRBFR_PRM2                        KV_SHRBFR_PRM3
r    KV_USR_EVT                       r    G$ROS$
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:33   


        1        1        /*M* KVC$CNC - Initialize VDI context                                         */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
        8        8        KVC$CNC: PROC (PRM) ALTRET;

      8   1 000000  D380 0000 0000  xent KVC$CNC         LNJ,B5   X6A_AUTO_1
          1 000003       004A 0001                       DC       74,1

        9        9
       10       10        /*F* NAME: KVC$CNC                                                            */
       11       11        /*F*                                                                          */
       12       12        /*F* KVC$CNC initializes the context needed for a VDH user. In its            */
       13       13        /*F* current state it will set up the entire context, but in later            */
       14       14        /*F* releases there will be seperate calls to initialize different            */
       15       15        /*F* sections of the context.                                                 */
       16       16
       17       17        %INCLUDE F_ERRORS_C;
       18      257        %INCLUDE KL_AFCN_C;
       19      358        %INCLUDE KL_MACRO_C;
       20     3710        %INCLUDE KV_ERRORS_C;
       21     3770 S      %INCLUDE KV_GLBCNS_E;
       22     3771        %KV_STRTYP_E;
       23     3809        %KV_VDH_EVT_ID_E;
       24     3815        %KV_USR_EVT_ID_E;
       25     3835        %INCLUDE KV$BPC;
       26     3864 S      %INCLUDE KV$GLBCTX;
       27     3865 S      %INCLUDE KV$GLB;
       28     3866        %INCLUDE KV$INPFNC;
       29     4425 S      %INCLUDE KV$INT;
       30     4426 S      %INCLUDE KV$SND;
       31     4427        %KV_SND_FNC_E;
       32     4443 S      %INCLUDE KV$VDH;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:34   
       33     4444 S      %INCLUDE KV$VDO;
       34     4445 S      %INCLUDE KV$USR;
       35     4446        %INCLUDE KV_INT_M;
       36     4589 S      %INCLUDE KV_PRMID_E;
       37     4590        %INCLUDE LCP_6;
       38     4781        %INCLUDE K_ID_E;
       39     4831        %K#ENTID_E;
       40     4850        %K#LYRID_E;
       41     4857        %KV_PRMID_E;
       42     5013        %KV_BFRRLSDSP_E;
       43     5019        %KV#VD_ORG_E;
       44     5027        %KV_SCP_E;
       45     5037        %KV_PHSPSTMOD_E;
       46     5044
       47     5045        %KV$BPC (STCLASS="BASED(KV_B_POOL$)");
       48     5067        %KV$INPFNCTBL;
       49     5151        %KV$LIN;
       50     5175        %KV$LIN (NAME=KV_LIN, STCLASS=SYMREF READONLY);
       51     5199        %KV$LINLST (STCLASS="BASED(KV@VDH_GETBFR.BFR$)");
       52     5226        %EQU KV_LINLST=CHARTEXT('KV$LINLST');
       53     5227        %KV$MRD;                                /*  MASTER REAL DEVICE CONTEXT BLOCK  */
       54     5274        %KV$PTR;                                /*  VDH POINTER BLOCK                 */
       55     5317        %KV$RCRLST (STCLASS="BASED(KV@VDH_GETBFR.BFR$)");
       56     5353        %EQU KV_RCRLST=CHARTEXT('KV$RCRLST');
       57     5354        %KV$RCRLST (NAME=KV_RCRLST, STCLASS=CONSTANT SYMDEF);
       58     5390        %KV$VDI;                                /*  VDI CONTEXT BLOCK                 */
       59     5461        %KV$SSN;                                /*  SESSION BLOCK                     */
       60     5540        %KV$STR;                                /*  STREAM CONTEXT BLOCK              */
       61     5627        %KV$STT;
       62     6021        %KV$MVD;                                /*  MASTER VIRTUAL DEVICE             */
       63     6065        %KV$SRD;                                /*  SECONDARY REAL DEVICE             */
       64     6340        %KV$TRCBFR;
       65     6398        %KV$TRCENT;
       66     6427        %KV$USRPRM;
       67     6478        %KV$SHRBFR;                             /*  SHARED BUFFER FORMAT              */
       68     6510    1   DCL KV_ACTCHRTBLNRM UBIN SYMREF;
       69     6511
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:35   
       70     6512    1   DCL Y$PTR$ PTR BASED;
       71     6513
       72     6514    1   DCL CHR8 CHAR(8) BASED;
       73     6515    1   DCL KV_SSNCNT UBIN SYMREF;
       74     6516    1   DCL KV_SSNMAX UBIN SYMREF;
       75     6517
       76     6518    1   DCL KVC$ADJWND ENTRY(1) ALTRET;
       77     6519    1   DCL KVC$DRWBRD ENTRY;
       78     6520    1   DCL KVC$RLSFRM ENTRY;
       79     6521    1   DCL KVC$RLSSSNNO_CNC ENTRY;
       80     6522    1   DCL KVC$RLSMVD ENTRY;
       81     6523    1   DCL KVC$RLSSTR ENTRY;
       82     6524    1   DCL KVI$NEWINPFNCTBL ENTRY;
       83     6525    1   DCL KVO$ERSSRD ENTRY;
       84     6526    1   DCL KVP$SETPRM ENTRY(1);
       85     6527    1   DCL KVS$GETBFR ENTRY(1) ALTRET;
       86     6528    1   DCL KVS$RLSBFR ENTRY(1) ALTRET;
       87     6529    1   DCL KVV$CALUSR_EVT ENTRY(1) ALTRET;
       88     6530    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
       89     6531    1   DCL KVM$SND ENTRY(1) ALTRET;
       90     6532
       91     6533    1   DCL KV_B_POOL$ PTR SYMREF;
       92     6534        %KV$VDH_GETBFR(NAME = KV_VDH_GETBFR, STCLASS = "SYMREF READONLY");
       93     6599        %KV$VDH_RLSBFR(NAME = KV_VDH_RLSBFR, STCLASS = "SYMREF READONLY");
       94     6635        %KV$VDH_SETPRM(NAME = KV_VDH_SETPRM, STCLASS = "SYMREF READONLY");
       95     6697        %KV$SND_CNC (NAME=KV_SND_CNC, STCLASS=SYMREF READONLY);
       96     6785
       97     6786        /* LOCAL VARIABLES                                                            */
       98     6787
       99     6788    1   DCL PRM CHAR(PRM_STRID);                /* Dummy parameter for redefs         */
      100     6789        %KV$VDH_CNC (NAME=PRM_VDH_CNC, STCLASS=REDEF PRM); /*  VDH CONNECT PARAMETER  */
      101     6881    1   DCL PRM_STRID REDEF PRM UBIN;
      102     6882        %VLP_WINDOW (FPTN=PRM_WINDOW, STCLASS=REDEF PRM);
      103     6926        %SET KV_VDO_FNC_OPNSTR = 0;
      104     6927        %KV$VDO_OPNSTR (NAME=PRM_VDO_OPNSTR, STCLASS=REDEF PRM);
      105     6970        %KV$VDH_GETBFR(NAME = KV@VDH_GETBFR, STCLASS = AUTO);
      106     7035        %KV$VDH_RLSBFR;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:36   
      107     7071        %EQU VDH_RLSBFR = CHARTEXT('ADDR(KV@VDH_GETBFR)->KV$VDH_RLSBFR');
      108     7072        %KV$VDH_SETPRM(NAME = KV@VDH_SETPRM, STCLASS = AUTO);
      109     7134        %KV$SND_CNC(NAME = KV@SND_CNC, STCLASS = AUTO);
      110     7222    1   DCL ORGPTR$ PTR;                        /* Original KV$PTR$                   */
      111     7223    1   DCL TEMP UBIN;
      112     7224    1   DCL STEMP REDEF TEMP SBIN;
      113     7225        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:37   
      114     7226
      115     7227        /* First check that there's a bit of memory left. */
      116     7228    1      TEMP = KV$BPC.USE/16;

   7228   1 000005  EC80 0000 0000  xsym                 LDB,B6   KV_B_POOL$
          1 000008  8CC6 0002                            LDI      2,B6
          1 00000A  70C4                                 DOR,R7   4
          1 00000B  E857                                 LDR,R6   R7
          1 00000C  EF47 003D                            STR,R6   TEMP,AUTO

      117     7229    1      IF KV_SSNCNT>0 THEN TEMP=TEMP/KV_SSNCNT;

   7229   1 00000E  D800 0000 0000  xsym                 LDR,R5   KV_SSNCNT
          1 000011  5901 0007                            BEZ,R5   s:7230,PREL

   7229   1 000013  F856                                 LDR,R7   R6
          1 000014  6C00                                 LDV,R6   0
          1 000015  F355                                 DIV,R7   R5
          1 000016  E857                                 LDR,R6   R7
          1 000017  EF47 003D                            STR,R6   TEMP,AUTO

      118     7230    1      IF KV$BPC.TOT-KV$BPC.USE<64*TEMP THEN GOTO CANTGETCTX;

   7230   1 000019  8C86                                 LDI      ,B6
          1 00001A  84C6 0002                            SID      2,B6
          1 00001C  8D47 0048                            SDI      @Y@SHRBFR+2,AUTO
          1 00001E  F847 003D                            LDR,R7   TEMP,AUTO
          1 000020  6C00                                 LDV,R6   0
          1 000021  7086                                 DOL,R7   6
          1 000022  84C7 0048                            SID      @Y@SHRBFR+2,AUTO
          1 000024  6A01 02E2                            BGZ,R6   s:7467,PREL
          1 000026  6801 0003                            BLZ,R6   s:7232,PREL
          1 000028  7981 02DE                            BNEZ,R7  s:7467,PREL

      119     7231
      120     7232    1      ORGPTR$ = KV$PTR$;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:38   
   7232   1 00002A  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00002D  DFC7 003B                            STB,B5   ORGPTR$,AUTO

      121     7233    1      KV@VDH_GETBFR = KV_VDH_GETBFR;

   7233   1 00002F  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_GETBFR
          1 000032  2C00                                 LDV,R2   0
          1 000033  6C16                                 LDV,R6   22
          1 000034  BB87                                 LAB,B3   ,AUTO
          1 000035  3C0C                                 LDV,R3   12
          1 000036  0008                                 MMM

      122     7234    1      KV@VDH_GETBFR.SCRNO_MMR = '0'B;

   7234   1 000037  8847 000C                            LBF,'0001'X       KV@VDH_GETBFR+6,AUTO
   7234   1 000039       0001

      123     7235
      124     7236        /* Get KV$PTR for session, unless this is the first.                          */
      125     7237    2      IF KV$PTR.SSN$~=ADDR(NIL) THEN DO;

   7237   1 00003A  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00003D  8DC6 0002                            CMN      2,B6
          1 00003F  0901 0030                            BE       s:7258,PREL

      126     7238    3         IF %KV_VDI.SSNCNT=KV_SSNMAX THEN DO;

   7238   1 000041  DC86                                 LDB,B5   ,B6
          1 000042  E845 000E                            LDR,R6   14,B5
          1 000044  E900 0000 0000  xsym                 CMR,R6   KV_SSNMAX
          1 000047  0981 000D                            BNE      s:7246,PREL

      127     7239    3            IF KV$PTR.STR$~=ADDR(NIL)

   7239   1 000049  8DC6 0004                            CMN      4,B6
          1 00004B  0901 0007                            BE       s:7244,PREL

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:39   
      128     7240    3            THEN %KV_STR.ERR.COD = %E$TOOMANYSSNS;

   7240   1 00004D  CCC6 0004                            LDB,B4   4,B6
          1 00004F  D870 05C6                            LDR,R5   1478,IMO
          1 000051  DF44 0013                            STR,R5   19,B4

      129     7241        /*E* ERROR: KVC-E$TOOMANYSSNS-C
      130     7242             MESSAGE: Too many sessions on the device to start another.
      131     7243        */
      132     7244    3            GOTO ERRXIT;

   7244   1 000053  0F81 02C0                            B        s:7469,PREL

      133     7245    3         END;
      134     7246    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_PTR;

   7246   1 000055  5C10                                 LDV,R5   16
          1 000056  D7C7 000C                            STH,R5   KV@VDH_GETBFR+6,AUTO

      135     7247    2         CALL KVS$GETBFR(KV@VDH_GETBFR) ALTRET(CANTGETCTX);

   7247   1 000058  DBC7 0006                            LAB,B5   KV@VDH_GETBFR,AUTO
          1 00005A  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 00005C  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 00005E  CBF0 0100                            LAB,B4   256,IMO
          1 000060  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 000063       02A4                            DC       s:7467,PREL

      136     7248
      137     7249        /* Set up the new session's synchronous KV$PTR.                               */
      138     7250
      139     7251    2         KV$PTR$ = KV@VDH_GETBFR.BFR$;

   7251   1 000064  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000066  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      140     7252    2         KV$PTR.VDI$ = ORGPTR$->KV$PTR.VDI$;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:40   

   7252   1 000069  DCC7 003B                            LDB,B5   ORGPTR$,AUTO
          1 00006B  CC85                                 LDB,B4   ,B5
          1 00006C  CF86                                 STB,B4   ,B6

      141     7253    2         CALL CALUSRGETSTR;

   7253   1 00006D  E3C0 081A                            LNJ,B6   s:0,PREL
          1 00006F       0001                            DC       s:7258,PREL

      142     7254    2      END;

      143     7255
      144     7256        /* Get session context.                                                       */
      145     7257
      146     7258    1      KV@VDH_GETBFR.STRTYP = %KV_STRTYP_SSN;

   7258   1 000070  6C13                                 LDV,R6   19
          1 000071  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      147     7259    2      CALL KVS$GETBFR(KV@VDH_GETBFR) WHENALTRETURN DO; /* GET SSN CONTEXT BLOCK  */

   7259   1 000073  EBC7 0006                            LAB,B6   KV@VDH_GETBFR,AUTO
          1 000075  EFC7 0048                            STB,B6   @Y@SHRBFR+2,AUTO
          1 000077  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 000079  CBF0 0100                            LAB,B4   256,IMO
          1 00007B  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 00007E       0003                            DC       s:7260,PREL
          1 00007F  0F81 0020                            B        s:7270,PREL

      148     7260    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_PTR;

   7260   1 000081  6C10                                 LDV,R6   16
          1 000082  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      149     7261    2         KV@VDH_GETBFR.BFR$ = KV$PTR$;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:41   
   7261   1 000084  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000087  EFC7 0007                            STB,B6   KV@VDH_GETBFR+1,AUTO

      150     7262    2         KV$PTR$ = ORGPTR$;

   7262   1 000089  DCC7 003B                            LDB,B5   ORGPTR$,AUTO
          1 00008B  DF80 0000 0000  xsym                 STB,B5   KV$PTR$

      151     7263    2         IF ORGPTR$~=KV@VDH_GETBFR.BFR$

   7263   1 00008E  DDC7 0007                            CMB,B5   KV@VDH_GETBFR+1,AUTO
          1 000090  0901 000D                            BE       s:7265,PREL

      152     7264    2         THEN CALL KVS$RLSBFR (KV@VDH_GETBFR);

   7264   1 000092  CBC7 0006                            LAB,B4   KV@VDH_GETBFR,AUTO
          1 000094  CFC7 0048                            STB,B4   @Y@SHRBFR+2,AUTO
          1 000096  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 000098  CBF0 0100                            LAB,B4   256,IMO
          1 00009A  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 00009D       0001                            DC       s:7265,PREL

      153     7265    2         GOTO CANTGETCTX;

   7265   1 00009E  0F81 0268                            B        s:7467,PREL

      154     7266    2      END;
      155     7267
      156     7268        /* Link the new KV$SSN in at the head of the KV$SSN chain. */
      157     7269
      158     7270    1      KV@VDH_GETBFR.BFR$->KV$SSN.LNK$ = %KV_VDI.SSN$;

   7270   1 0000A0  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0000A3  DC86                                 LDB,B5   ,B6
          1 0000A4  CCC5 0004                            LDB,B4   4,B5
          1 0000A6  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 0000A8  CFC3 0002                            STB,B4   2,B3
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:42   

      159     7271    1      %KV_VDI.SSN$ = KV@VDH_GETBFR.BFR$;

   7271   1 0000AA  DC86                                 LDB,B5   ,B6
          1 0000AB  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 0000AD  CFC5 0004                            STB,B4   4,B5

      160     7272    1      KV$PTR.SSN$ = KV@VDH_GETBFR.BFR$;

   7272   1 0000AF  DCC7 0007                            LDB,B5   KV@VDH_GETBFR+1,AUTO
          1 0000B1  DFC6 0002                            STB,B5   2,B6

      161     7273    1      KV@VDH_GETBFR.BFR$->KV$SSN.SNCPTR$ = KV$PTR$;

   7273   1 0000B3  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 0000B5  EFC4 0008                            STB,B6   8,B4

      162     7274    1      KV@VDH_GETBFR.BFR$->KV$SSN.VDI$ = KV$PTR.VDI$;

   7274   1 0000B7  DC86                                 LDB,B5   ,B6
          1 0000B8  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 0000BA  DF84                                 STB,B5   ,B4

      163     7275    1      CALL CALUSRGETSTR;

   7275   1 0000BB  E3C0 07CC                            LNJ,B6   s:0,PREL
          1 0000BD       0001                            DC       s:7277,PREL

      164     7276
      165     7277    2      IF %KV_VDI.TRCBFR$ ~= ADDR(NIL) THEN DO;

   7277   1 0000BE  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0000C1  DC86                                 LDB,B5   ,B6
          1 0000C2  8DC5 0012                            CMN      18,B5
          1 0000C4  0901 002B                            BE       s:7298,PREL

      166     7278        /*
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:43   
      167     7279        KV$VDI has a trace buffer.
      168     7280        */
      169     7281    3         IF %KV_VDI.SHRTRCBFR THEN DO;

   7281   1 0000C6  82C5 001D                            LB,'0002'X        29,B5
   7281   1 0000C8       0002
          1 0000C9  0581 0009                            BBF      s:7290,PREL

      170     7282        /*
      171     7283        We're to share trace buffers between KV$VDI and KV$SSN.
      172     7284        */
      173     7285    3            %KV_SSN.TRCBFR$ = %KV_VDI.TRCBFR$;

   7285   1 0000CB  CCC6 0002                            LDB,B4   2,B6
          1 0000CD  BCC5 0012                            LDB,B3   18,B5
          1 0000CF  BFC4 0010                            STB,B3   16,B4

      174     7286    3         END; ELSE DO;                     /* ELSE IF NOT SHRTRCBFR              */

   7286   1 0000D1  0F81 001E                            B        s:7298,PREL

      175     7287        /*
      176     7288        We're to get a separate trace buffer for this session.
      177     7289        */
      178     7290    3            KV@VDH_GETBFR.STRTYP = %KV_STRTYP_TRCBFR;

   7290   1 0000D3  6C21                                 LDV,R6   33
          1 0000D4  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      179     7291    3            KV@VDH_GETBFR.BYTSIZ = %KV_VDI.TRCBFRBYTSIZ;

   7291   1 0000D6  DC86                                 LDB,B5   ,B6
          1 0000D7  D845 0014                            LDR,R5   20,B5
          1 0000D9  DF47 0009                            STR,R5   KV@VDH_GETBFR+3,AUTO

      180     7292    3            CALL KVS$GETBFR(KV@VDH_GETBFR)

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:44   
   7292   1 0000DB  DBC7 0006                            LAB,B5   KV@VDH_GETBFR,AUTO
          1 0000DD  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 0000DF  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0000E1  CBF0 0100                            LAB,B4   256,IMO
          1 0000E3  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 0000E6       000A                            DC       s:7298,PREL

      181     7293    4            WHENRETURN DO;

      182     7294    4               %KV_SSN.TRCBFR$ = KV@VDH_GETBFR.BFR$;

   7294   1 0000E7  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0000EA  DCC6 0002                            LDB,B5   2,B6
          1 0000EC  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 0000EE  CFC5 0010                            STB,B4   16,B5

      183     7295    4            END;                           /* END WHENRETURN                     */

      184     7296    3         END;                              /* END ELSE IF SHRTRCBFR              */

      185     7297    2      END; /* END IF KV$VDI.TRCBFR$ ~= NIL */

      186     7298    2      IF PRM_VDH_CNC.SSNCNCINT THEN DO;

   7298   1 0000F0  ECC7 0004                            LDB,B6   @PRM,AUTO
          1 0000F2  89C6 000A                            CMZ      10,B6
          1 0000F4  0881 0012                            BAGE     s:7306,PREL

      187     7299        /*
      188     7300        We're initiating the session connection (as opposed to
      189     7301        processing a received session-initiation/connection request).
      190     7302        */
      191     7303    2         %KV_SSN.SSNCNCINT = '1'B;

   7303   1 0000F6  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0000F9  CCC5 0002                            LDB,B4   2,B5
          1 0000FB  8944 0028                            LBT,'0008'X       40,B4
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:45   
          1 0000FD       0008

      192     7304    2         %KV_VDI.LINSPD = PRM_VDH_CNC.LINSPD;

   7304   1 0000FE  CC85                                 LDB,B4   ,B5
          1 0000FF  E846 000A                            LDR,R6   10,B6
          1 000101  E570 00FF                            AND,R6   255,IMO
          1 000103  E7C4 001E                            STH,R6   30,B4

      193     7305    2      END; /* END IF PRM_VDH_CNC.SSNCNCINT */

   7305   1 000105  0F81 0019                            B        s:7309,PREL

      194     7306    1      ELSE IF PRM_VDH_CNC.NEWSSN THEN %KV_SSN.SSNCNCINT = '1'B;

   7306   1 000107  82C6 000A                            LB,'4000'X        10,B6
   7306   1 000109       4000
          1 00010A  0581 000B                            BBF      s:7307,PREL

   7306   1 00010C  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00010F  CCC5 0002                            LDB,B4   2,B5
          1 000111  8944 0028                            LBT,'0008'X       40,B4
          1 000113       0008
          1 000114  0F81 000A                            B        s:7309,PREL

      195     7307    1      ELSE %KV_SSN.SSNCNCID = PRM_VDH_CNC.DSTNTWADR.LDCTX;

   7307   1 000116  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000119  CCC5 0002                            LDB,B4   2,B5
          1 00011B  E846 0014                            LDR,R6   20,B6
          1 00011D  EF44 0024                            STR,R6   36,B4

      196     7308
      197     7309    2      IF %KV_SSN.LNK$ = ADDR(NIL) THEN DO;

   7309   1 00011F  CCC5 0002                            LDB,B4   2,B5
          1 000121  8DC4 0002                            CMN      2,B4
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:46   
          1 000123  0981 008F                            BNE      s:7359,PREL

      198     7310        /*
      199     7311        This is the first session on this chain of sessions.
      200     7312        Allocate some context that would otherwise be shared among
      201     7313        the sessions.
      202     7314        */
      203     7315
      204     7316        /* GET KV$MVD                                                                 */
      205     7317
      206     7318    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_MVD;

   7318   1 000125  6C0C                                 LDV,R6   12
          1 000126  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      207     7319    2         CALL KVS$GETBFR(KV@VDH_GETBFR) ALTRET(BUMMER);

   7319   1 000128  CBC7 0006                            LAB,B4   KV@VDH_GETBFR,AUTO
          1 00012A  CFC7 0048                            STB,B4   @Y@SHRBFR+2,AUTO
          1 00012C  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 00012E  CBF0 0100                            LAB,B4   256,IMO
          1 000130  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 000133       01C9                            DC       s:7465,PREL

      208     7320
      209     7321    2         KV$PTR.MVD$ = KV@VDH_GETBFR.BFR$;

   7321   1 000134  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000136  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000139  EFC5 0006                            STB,B6   6,B5

      210     7322
      211     7323    2         IF %KV_USRPRM.INPFNCTBLHEDPTR$~=ADDR(NIL)

   7323   1 00013B  CC85                                 LDB,B4   ,B5
          1 00013C  BCC4 0008                            LDB,B3   8,B4
          1 00013E  8DC3 002F                            CMN      47,B3
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:47   
          1 000140  0901 0008                            BE       s:7327,PREL

      212     7324    2         THEN KV@VDH_GETBFR.BFR$->KV$MVD.SSTINPFNCTBL$ =

   7324   1 000142  ACC3 002F                            LDB,B2   47,B3
          1 000144  9C82                                 LDB,B1   ,B2
          1 000145  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000147  9FC6 000A                            STB,B1   10,B6

      213     7325    2           %KV_USRPRM.INPFNCTBLHEDPTR$->Y$PTR$;
      214     7326        /* Set the default translate table, in case there's no profile */
      215     7327    2         IF %KV_USRPRM.TRNTBLHEDPTR$~=ADDR(NIL)

   7327   1 000149  EC85                                 LDB,B6   ,B5
          1 00014A  CCC6 0008                            LDB,B4   8,B6
          1 00014C  8DC4 0031                            CMN      49,B4
          1 00014E  0901 0008                            BE       s:7330,PREL

      216     7328    2         THEN KV@VDH_GETBFR.BFR$->KV$MVD.TRNTBL$ =

   7328   1 000150  BCC4 0031                            LDB,B3   49,B4
          1 000152  AC83                                 LDB,B2   ,B3
          1 000153  9CC7 0007                            LDB,B1   KV@VDH_GETBFR+1,AUTO
          1 000155  AFC1 000E                            STB,B2   14,B1

      217     7329    2           %KV_USRPRM.TRNTBLHEDPTR$->Y$PTR$;
      218     7330    2         CALL CALUSRGETSTR;

   7330   1 000157  E3C0 0730                            LNJ,B6   s:0,PREL
          1 000159       0001                            DC       s:7334,PREL

      219     7331
      220     7332        /* GET KV$SRD                                                                 */
      221     7333
      222     7334    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_SRD;

   7334   1 00015A  6C12                                 LDV,R6   18
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:48   
          1 00015B  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      223     7335    2         CALL KVS$GETBFR(KV@VDH_GETBFR) ALTRET(BUMMER);

   7335   1 00015D  EBC7 0006                            LAB,B6   KV@VDH_GETBFR,AUTO
          1 00015F  EFC7 0048                            STB,B6   @Y@SHRBFR+2,AUTO
          1 000161  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 000163  CBF0 0100                            LAB,B4   256,IMO
          1 000165  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 000168       0194                            DC       s:7465,PREL

      224     7336
      225     7337    2         KV$PTR.SRD$ = KV@VDH_GETBFR.BFR$;

   7337   1 000169  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 00016B  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00016E  EFC5 000A                            STB,B6   10,B5

      226     7338    2         %KV_MVD.SRD$ = KV@VDH_GETBFR.BFR$;

   7338   1 000170  CCC5 0006                            LDB,B4   6,B5
          1 000172  EF84                                 STB,B6   ,B4

      227     7339    2         CALL CALUSRGETSTR;

   7339   1 000173  E3C0 0714                            LNJ,B6   s:0,PREL
          1 000175       0001                            DC       s:7343,PREL

      228     7340
      229     7341        /* GET KV$MRD FOR DEVICE                                                      */
      230     7342
      231     7343    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_MRD;

   7343   1 000176  6C0A                                 LDV,R6   10
          1 000177  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      232     7344    2         CALL KVS$GETBFR(KV@VDH_GETBFR) ALTRET(BUMMER);
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:49   

   7344   1 000179  EBC7 0006                            LAB,B6   KV@VDH_GETBFR,AUTO
          1 00017B  EFC7 0048                            STB,B6   @Y@SHRBFR+2,AUTO
          1 00017D  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 00017F  CBF0 0100                            LAB,B4   256,IMO
          1 000181  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 000184       0178                            DC       s:7465,PREL

      233     7345
      234     7346    2         KV$PTR.MRD$ = KV@VDH_GETBFR.BFR$;

   7346   1 000185  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000187  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00018A  EFC5 0008                            STB,B6   8,B5

      235     7347    2         KV@VDH_GETBFR.BFR$->KV$MRD.SRD$ = KV$PTR.SRD$;

   7347   1 00018C  CCC5 000A                            LDB,B4   10,B5
          1 00018E  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 000190  CFC3 0002                            STB,B4   2,B3

      236     7348    2         KV@VDH_GETBFR.BFR$->KV$MRD.MVD$ = KV$PTR.MVD$;

   7348   1 000192  ECC5 0006                            LDB,B6   6,B5
          1 000194  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 000196  EFC4 000D                            STB,B6   13,B4

      237     7349    2         IF %KV_USRPRM.PRFFNCTBL$~=ADDR(NIL)

   7349   1 000198  BC85                                 LDB,B3   ,B5
          1 000199  ACC3 0008                            LDB,B2   8,B3
          1 00019B  8DC2 0037                            CMN      55,B2
          1 00019D  0901 0005                            BE       s:7351,PREL

      238     7350    2         THEN KV@VDH_GETBFR.BFR$->KV$MRD.PRFINPFNCTBL$ = %KV_USRPRM.PRFFNCTBL$;

   7350   1 00019F  9CC2 0037                            LDB,B1   55,B2
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:50   
          1 0001A1  9FC4 0006                            STB,B1   6,B4

      239     7351    2         %KV_SRD.MRD$ = KV@VDH_GETBFR.BFR$;

   7351   1 0001A3  ECC5 000A                            LDB,B6   10,B5
          1 0001A5  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 0001A7  CF86                                 STB,B4   ,B6

      240     7352    2         CALL CALUSRGETSTR;

   7352   1 0001A8  E3C0 06DF                            LNJ,B6   s:0,PREL
          1 0001AA       0001                            DC       s:7353,PREL

      241     7353    2         CALL KVI$NEWINPFNCTBL;

   7353   1 0001AB  CBF0 0000                            LAB,B4   0,IMO
          1 0001AD  E380 0000 0000  xent                 LNJ,B6   KVI$NEWINPFNCTBL
          1 0001B0       0001                            DC       s:7354,PREL

      242     7354    2      END; ELSE DO;

   7354   1 0001B1  0F81 003B                            B        s:7379,PREL

      243     7355        /*
      244     7356        We're adding another session to this instance of VDI.
      245     7357        Share some context we'd otherwise allocate.
      246     7358        */
      247     7359    2         KV@VDH_GETBFR.BFR$ = %KV_SSN.LNK$;

   7359   1 0001B3  BCC4 0002                            LDB,B3   2,B4
          1 0001B5  BFC7 0007                            STB,B3   KV@VDH_GETBFR+1,AUTO

      248     7360    2         KV$PTR.MRD$ = ORGPTR$->KV$PTR.MRD$;

   7360   1 0001B7  CCC7 003B                            LDB,B4   ORGPTR$,AUTO
          1 0001B9  ACC4 0008                            LDB,B2   8,B4
          1 0001BB  AFC5 0008                            STB,B2   8,B5
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:51   

      249     7361    2         KV$PTR.SRD$ = ORGPTR$->KV$PTR.SRD$;

   7361   1 0001BD  BCC4 000A                            LDB,B3   10,B4
          1 0001BF  BFC5 000A                            STB,B3   10,B5

      250     7362    2         KV$PTR.MVD$ = ORGPTR$->KV$PTR.MVD$;

   7362   1 0001C1  9CC4 0006                            LDB,B1   6,B4
          1 0001C3  9FC5 0006                            STB,B1   6,B5

      251     7363        /*
      252     7364           Compute a unique SSNID for this session.
      253     7365        */
      254     7366    2         TEMP = 1;

   7366   1 0001C5  6C01                                 LDV,R6   1
          1 0001C6  EF47 003D                            STR,R6   TEMP,AUTO

      255     7367    3         DO WHILE KV@VDH_GETBFR.BFR$~=ADDR(NIL);

   7367   1 0001C8  0F81 0018                            B        s:7373,PREL

      256     7368    4            IF TEMP=KV@VDH_GETBFR.BFR$->KV$SSN.SSNID THEN DO;

   7368   1 0001CA  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 0001CC  E2C6 0037                            LLH,R6   55,B6
          1 0001CE  E947 003D                            CMR,R6   TEMP,AUTO
          1 0001D0  0981 000A                            BNE      s:7372,PREL

      257     7369    4               TEMP = TEMP+1;

   7369   1 0001D2  8AC7 003D                            INC      TEMP,AUTO

      258     7370    4               KV@VDH_GETBFR.BFR$ = KV$PTR.SSN$;

   7370   1 0001D4  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:52   
          1 0001D7  CCC5 0002                            LDB,B4   2,B5
          1 0001D9  CFC7 0007                            STB,B4   KV@VDH_GETBFR+1,AUTO

      259     7371    4            END;

      260     7372    3            KV@VDH_GETBFR.BFR$ = KV@VDH_GETBFR.BFR$->KV$SSN.LNK$;

   7372   1 0001DB  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 0001DD  DCC6 0002                            LDB,B5   2,B6
          1 0001DF  DFC7 0007                            STB,B5   KV@VDH_GETBFR+1,AUTO

      261     7373    3         END;

   7373   1 0001E1  8DC7 0007                            CMN      KV@VDH_GETBFR+1,AUTO
          1 0001E3  09E7                                 BNE      s:7368,SPREL

      262     7374    2         %KV_SSN.SSNID = TEMP;

   7374   1 0001E4  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0001E7  DCC6 0002                            LDB,B5   2,B6
          1 0001E9  E847 003D                            LDR,R6   TEMP,AUTO
          1 0001EB  E7C5 0037                            STH,R6   55,B5

      263     7375    2      END; /* END ELSE IF %KV_SSN.LNK$ = ADR(NIL) */

      264     7376
      265     7377        /* Get type-ahead buffer.                                                     */
      266     7378
      267     7379    1      KV@VDH_GETBFR.STRTYP = %KV_STRTYP_TYPAHDBFR;

   7379   1 0001ED  6C19                                 LDV,R6   25
          1 0001EE  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      268     7380    1      CALL KVS$GETBFR(KV@VDH_GETBFR) ALTRET(BUMMER);

   7380   1 0001F0  EBC7 0006                            LAB,B6   KV@VDH_GETBFR,AUTO
          1 0001F2  EFC7 0048                            STB,B6   @Y@SHRBFR+2,AUTO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:53   
          1 0001F4  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0001F6  CBF0 0100                            LAB,B4   256,IMO
          1 0001F8  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 0001FB       0101                            DC       s:7465,PREL

      269     7381
      270     7382    1      %KV_SSN.TYPAHDBFRHED$ = KV@VDH_GETBFR.BFR$;

   7382   1 0001FC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0001FF  DCC6 0002                            LDB,B5   2,B6
          1 000201  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 000203  CFC5 000A                            STB,B4   10,B5

      271     7383    1      %KV_SSN.TYPAHDBFRINS$ = KV@VDH_GETBFR.BFR$;

   7383   1 000205  DCC6 0002                            LDB,B5   2,B6
          1 000207  CFC5 000E                            STB,B4   14,B5

      272     7384    1      %KV_SSN.TYPAHDBFRCNT = 1;

   7384   1 000209  DCC6 0002                            LDB,B5   2,B6
          1 00020B  6C01                                 LDV,R6   1
          1 00020C  E7C5 0027                            STH,R6   39,B5

      273     7385
      274     7386        /* GET ONE STREAM                                                              */
      275     7387
      276     7388    1      IF NOT PRM_VDH_CNC.NEWSSN            /* Unless we already have one to use. */

   7388   1 00020E  DCC7 0004                            LDB,B5   @PRM,AUTO
          1 000210  82C5 000A                            LB,'4000'X        10,B5
          1 000212       4000
          1 000213  0501 000A                            BBT      s:7391,PREL

      277     7389    1      THEN CALL Y$GETSTR(1) ALTRET(BUMMER);

   7389   1 000215  BBF0 0001                            LAB,B3   1,IMO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:54   
          1 000217  BFC7 0040                            STB,B3   TEMP+3,AUTO
          1 000219  E3C0 05D9                            LNJ,B6   s:0,PREL
          1 00021B       00E1                            DC       s:7465,PREL
          1 00021C  0F81 0029                            B        s:7401,PREL

      278     7390    2      ELSE DO;

      279     7391    2         %KV_SSN.STR$ = ORGPTR$->KV$PTR.STR$;

   7391   1 00021E  BCC6 0002                            LDB,B3   2,B6
          1 000220  ACC7 003B                            LDB,B2   ORGPTR$,AUTO
          1 000222  9CC2 0004                            LDB,B1   4,B2
          1 000224  9FC3 0004                            STB,B1   4,B3

      280     7392    2         KV$PTR.STR$ = ORGPTR$->KV$PTR.STR$;

   7392   1 000226  CCC2 0004                            LDB,B4   4,B2
          1 000228  CFC6 0004                            STB,B4   4,B6

      281     7393    2         %KV_STR.SSN$ = KV$PTR.SSN$;

   7393   1 00022A  BCC6 0002                            LDB,B3   2,B6
          1 00022C  BF84                                 STB,B3   ,B4

      282     7394    2         %KV_STR.ID = 1;

   7394   1 00022D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000230  CCC6 0004                            LDB,B4   4,B6
          1 000232  E7C4 001C                            STH,R6   28,B4

      283     7395    2         KV$PTR.SSN$ = ORGPTR$->KV$PTR.SSN$;

   7395   1 000234  CCC2 0002                            LDB,B4   2,B2
          1 000236  CFC6 0002                            STB,B4   2,B6

      284     7396    2         CALL KVC$RLSSTR;                  /* Unchain from the old session       */

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:55   
   7396   1 000238  CBF0 0000                            LAB,B4   0,IMO
          1 00023A  E380 0000 0000  xent                 LNJ,B6   KVC$RLSSTR
          1 00023D       0001                            DC       s:7397,PREL

      285     7397    2         KV$PTR.SSN$ = %KV_STR.SSN$;

   7397   1 00023E  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000241  DCC6 0004                            LDB,B5   4,B6
          1 000243  CC85                                 LDB,B4   ,B5
          1 000244  CFC6 0002                            STB,B4   2,B6

      286     7398        /*N* Account for moved structures. Put a valid stream into ORGPTR. */
      287     7399    2      END;

      288     7400
      289     7401    2      IF PRM_VDH_CNC.PRF_.ADR$~=ADDR(NIL) THEN DO;

   7401   1 000246  ECC7 0004                            LDB,B6   @PRM,AUTO
          1 000248  8DC6 0001                            CMN      1,B6
          1 00024A  0901 001E                            BE       s:7413,PREL

      290     7402
      291     7403        /* SET PROFILE FOR THIS USER                                                  */
      292     7404
      293     7405    2         KV@VDH_SETPRM = KV_VDH_SETPRM;

   7405   1 00024C  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_SETPRM
          1 00024F  2C00                                 LDV,R2   0
          1 000250  6C10                                 LDV,R6   16
          1 000251  BB87                                 LAB,B3   ,AUTO
          1 000252  3C22                                 LDV,R3   34
          1 000253  0008                                 MMM

      294     7406    2         KV@VDH_SETPRM.PRMID = %KV_PRMID_TYPLNG;

   7406   1 000254  6C3F                                 LDV,R6   63
          1 000255  EF47 0012                            STR,R6   KV@VDH_SETPRM+1,AUTO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:56   

      295     7407    2         KV@VDH_SETPRM.VAL_ = PRM_VDH_CNC.PRF_;

   7407   1 000257  AB86                                 LAB,B2   ,B6
          1 000258  2C02                                 LDV,R2   2
          1 000259  6C08                                 LDV,R6   8
          1 00025A  BB87                                 LAB,B3   ,AUTO
          1 00025B  3C28                                 LDV,R3   40
          1 00025C  0008                                 MMM

      296     7408    2         CALL KVP$SETPRM(KV@VDH_SETPRM);

   7408   1 00025D  DBC7 0011                            LAB,B5   KV@VDH_SETPRM,AUTO
          1 00025F  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 000261  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 000263  CBF0 0100                            LAB,B4   256,IMO
          1 000265  E380 0000 0000  xent                 LNJ,B6   KVP$SETPRM
          1 000268       0001                            DC       s:7413,PREL

      297     7409    2      END; /* END IF PRM_VDH_CNC.PRF_.ADR$~=ADDR(NIL) */

      298     7410
      299     7411        /* CALL KVM$SND to start the connection protocol. */
      300     7412
      301     7413    1      KV@SND_CNC = KV_SND_CNC;

   7413   1 000269  AB80 0000 0000  xsym                 LAB,B2   KV_SND_CNC
          1 00026C  2C00                                 LDV,R2   0
          1 00026D  6C44                                 LDV,R6   68
          1 00026E  BB87                                 LAB,B3   ,AUTO
          1 00026F  3C32                                 LDV,R3   50
          1 000270  0008                                 MMM

      302     7414    1      KV@SND_CNC.LGN_ = PRM_VDH_CNC.LGN_;

   7414   1 000271  ACC7 0004                            LDB,B2   @PRM,AUTO
          1 000273  2C0E                                 LDV,R2   14
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:57   
          1 000274  6C06                                 LDV,R6   6
          1 000275  BB87                                 LAB,B3   ,AUTO
          1 000276  3C52                                 LDV,R3   82
          1 000277  0008                                 MMM

      303     7415    1      KV@SND_CNC.SCNENDPNTID = PRM_VDH_CNC.LCLENDPNTID;

   7415   1 000278  2C16                                 LDV,R2   22
          1 000279  6C10                                 LDV,R6   16
          1 00027A  BB87                                 LAB,B3   ,AUTO
          1 00027B  3C5A                                 LDV,R3   90
          1 00027C  0008                                 MMM

      304     7416        /*N* Need to get SCN/LCLENDPNDID from user, via GETPRM */
      305     7417        /*N* Get PRF_ from user, via GETPRM? */
      306     7418    1      KV@SND_CNC.LINSPD = %KV_VDI.LINSPD;

   7418   1 00027D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000280  DC86                                 LDB,B5   ,B6
          1 000281  E2C5 001E                            LLH,R6   30,B5
          1 000283  EAC7 002C                            SRM,R6,'00FF'X    KV@SND_CNC+19,AUTO
          1 000285       00FF

      307     7419    1      IF (PRM_VDH_CNC.DSTNTWRSR = ' ')

   7419   1 000286  DB80 0000 0000  02                   LAB,B5   0
          1 000289  0022                                 ACM      ;
          1 00028A       4802 0015                                ALPHANUM(21,B2,,8,FILL),;
          1 00028C       4105 0000                                ALPHANUM(0,B5,,1,FILL)
          1 00028E  5301 001C                            CBNE     s:7432,PREL
          1 000290  DB80 0000 0000  02                   LAB,B5   0
          1 000293  5C01                                 LDV,R5   1
          1 000294  0022                                 ACM      ;
          1 000295       4402 0013                                ALPHANUM(19,B2,,4,FILL),;
          1 000297       4005 0001                                ALPHANUM(1,B5,,R5,FILL)
          1 000299  5301 0011                            CBNE     s:7432,PREL

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:58   
      308     7420    2        AND (PRM_VDH_CNC.DSTNTWADR = '0'B) THEN DO;

      309     7421        /*
      310     7422        The destination network resource is blanks, and there is no
      311     7423        destination network address being passed.  Connect to the
      312     7424        logon process, by default.
      313     7425        */
      314     7426    2         KV@SND_CNC.DSTNTWRSR = 'LOGON';

   7426   1 00029B  DB80 0000 0000  00                   LAB,B5   KV_RCRLST
          1 00029E  0021                                 ALR      ;
          1 00029F       4505 001A                                ALPHANUM(26,B5,,5),;
          1 0002A1       4807 0037                                ALPHANUM(KV@SND_CNC+30,AUTO,,8,FILL)

      315     7427    2         %KV_SSN.LGN = '1'B;

   7427   1 0002A3  437F                                 CSYNC    s:7426+7,SPREL
          1 0002A4  DCC6 0002                            LDB,B5   2,B6
          1 0002A6  8945 0027                            LBT,'0001'X       39,B5
          1 0002A8       0001

      316     7428    2      END; ELSE DO;

   7428   1 0002A9  0F81 000A                            B        s:7435,PREL

      317     7429        /*
      318     7430        Connect to whatever the caller specified.
      319     7431        */
      320     7432    2         KV@SND_CNC.DSTNTWADR = PRM_VDH_CNC.DSTNTWADR;

   7432   1 0002AB  8CC2 0013                            LDI      19,B2
          1 0002AD  8D47 0035                            SDI      KV@SND_CNC+28,AUTO

      321     7433    2         KV@SND_CNC.DSTNTWRSR = PRM_VDH_CNC.DSTNTWRSR;

   7433   1 0002AF  2C2A                                 LDV,R2   42
          1 0002B0  6C08                                 LDV,R6   8
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:59   
          1 0002B1  BB87                                 LAB,B3   ,AUTO
          1 0002B2  3C6E                                 LDV,R3   110
          1 0002B3  0008                                 MMM

      322     7434    2      END; /* END ELSE IF DSTNTWRSR = ' ' ... */

      323     7435    1      CALL KVM$SND (KV@SND_CNC) ALTRET(BUMMER);

   7435   1 0002B4  EBC7 0019                            LAB,B6   KV@SND_CNC,AUTO
          1 0002B6  EFC7 0048                            STB,B6   @Y@SHRBFR+2,AUTO
          1 0002B8  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0002BA  CBF0 0100                            LAB,B4   256,IMO
          1 0002BC  E380 0000 0000  xent                 LNJ,B6   KVM$SND
          1 0002BF       003D                            DC       s:7465,PREL

      324     7436
      325     7437    2      IF ORGPTR$=KV$PTR$ THEN DO;

   7437   1 0002C0  ECC7 003B                            LDB,B6   ORGPTR$,AUTO
          1 0002C2  ED80 0000 0000  xsym                 CMB,B6   KV$PTR$
          1 0002C5  0981 0008                            BNE      s:7446,PREL

      326     7438
      327     7439        /* This is the first session to be allocated. */
      328     7440        /* We succeeded in connecting. Disable KV_VDH_EVT_ID_RLSVDI.                  */
      329     7441        /* We'll set it later if we want it on again.                                 */
      330     7442
      331     7443    2         %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RLSVDI) = '0'B;

   7443   1 0002C7  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0002CA  CC85                                 LDB,B4   ,B5
          1 0002CB  8844 001F                            LBF,'0002'X       31,B4
          1 0002CD       0002

      332     7444
      333     7445    2      END;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:60   
      334     7446    1      IF %KV_SSN.SSNCNCINT

   7446   1 0002CE  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0002D1  CCC5 0002                            LDB,B4   2,B5
          1 0002D3  82C4 0028                            LB,'0008'X        40,B4
          1 0002D5       0008
          1 0002D6  0581 0004                            BBF      s:7449,PREL

      335     7447        /* Restore the original context unless this is a received INIT message. */
      336     7448    1      THEN KV$PTR$ = ORGPTR$;

   7448   1 0002D8  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      337     7449    1      IF %KV_STR.SSN$~=KV$PTR.SSN$

   7449   1 0002DB  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0002DE  CCC5 0004                            LDB,B4   4,B5
          1 0002E0  BC84                                 LDB,B3   ,B4
          1 0002E1  BDC5 0002                            CMB,B3   2,B5
          1 0002E3  0901 0006                            BE       s:7455,PREL

      338     7450        /*
      339     7451           We just made a new session for an existing VDI. STR$ is bad.
      340     7452        */
      341     7453    1      THEN KV$PTR.STR$ = ADDR(NIL);

   7453   1 0002E5  AB80 0000 0000                       LAB,B2   0
          1 0002E8  AFC5 0004                            STB,B2   4,B5

      342     7454
      343     7455    1      KV_SSNCNT = KV_SSNCNT+1;   /* Count active SSNs for memory check purposes. */

   7455   1 0002EA  8A80 0000 0000  xsym                 INC      KV_SSNCNT

      344     7456    1      %KV_VDI.SSNCNT = %KV_VDI.SSNCNT+1;

   7456   1 0002ED  CC85                                 LDB,B4   ,B5
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:61   
          1 0002EE  8AC4 000E                            INC      14,B4

      345     7457    1      %KV_STT.CNCEVTCNT = %KV_STT.CNCEVTCNT+1;

   7457   1 0002F0  CC85                                 LDB,B4   ,B5
          1 0002F1  BCC4 0008                            LDB,B3   8,B4
          1 0002F3  ACC3 0033                            LDB,B2   51,B3
          1 0002F5  8AC2 0037                            INC      55,B2
          1 0002F7  8EC2 0036                            CAD      54,B2

      346     7458    1      RETURN;

   7458   1 0002F9  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      347     7459
      348     7460
      349     7461        /* SOME ERROR HAS OCCURED. WE MUST RELEASE ALL CONTEXT WE MIGHT HAVE          */
      350     7462        /* GOTTEN.                                                                    */
      351     7463
      352     7464    1   BUMMER:
      353     7465    1      CALL KVC$RLSSSNNO_CNC;

   7465   1 0002FC  CBF0 0000            BUMMER          LAB,B4   0,IMO
          1 0002FE  E380 0000 0000  xent                 LNJ,B6   KVC$RLSSSNNO_CNC
          1 000301       0001                            DC       s:7467,PREL

      354     7466
      355     7467    1      KV$PTR$ = ORGPTR$;

   7467   1 000302  ECC7 003B                            LDB,B6   ORGPTR$,AUTO
          1 000304  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

   7467   1                              CANTGETCTX      null
      356     7468    1   CANTGETCTX:;
      357     7469    1      IF KV$PTR.STR$~=ADDR(NIL)

   7469   1 000307  EC80 0000 0000  xsym CANTGETCTX      LDB,B6   KV$PTR$
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:62   
          1 00030A  8DC6 0004                            CMN      4,B6
          1 00030C  0901 0007                            BE       s:7469,PREL

      358     7470    1      THEN %KV_STR.ERR.COD = %E$CANTGETCTX;

   7470   1 00030E  DCC6 0004                            LDB,B5   4,B6
          1 000310  E870 05C8                            LDR,R6   1480,IMO
          1 000312  EF45 0013                            STR,R6   19,B5

   7469   1                              ERRXIT          null
      359     7471         /*E*  ERROR: KVC-E$CANTGETCTX-E
      360     7472                 MESSAGE:Insufficient communications handler memory available.
      361     7473                 MESSAGE1:Communications handler memory insufficient.  Your system
      362     7474                          manager may want to adjust the handler's boot parameters.
      363     7475           */
      364     7476    1   ERRXIT:;
      365     7477        /*
      366     7478           Send INIT_ACK if that seems to be appropriate.
      367     7479        */
      368     7480    2      IF PRM_VDH_CNC.DSTNTWADR AND KV$PTR.SSN$~=ADDR(NIL) THEN DO;

   7480   1 000314  DCC7 0004            ERRXIT          LDB,B5   @PRM,AUTO
          1 000316  CB80 0000 0000  02                   LAB,B4   0
          1 000319  5C01                                 LDV,R5   1
          1 00031A  0022                                 ACM      ;
          1 00031B       4405 0013                                ALPHANUM(19,B5,,4,FILL),;
          1 00031D       4004 0001                                ALPHANUM(1,B4,,R5,FILL)
          1 00031F  5381 0028                            CBE      s:7487,PREL
          1 000321  8DC6 0002                            CMN      2,B6
          1 000323  0901 0024                            BE       s:7487,PREL

      369     7481    2         KV@SND_CNC = KV_SND_CNC;

   7481   1 000325  AB80 0000 0000  xsym                 LAB,B2   KV_SND_CNC
          1 000328  2C00                                 LDV,R2   0
          1 000329  6C44                                 LDV,R6   68
          1 00032A  BB87                                 LAB,B3   ,AUTO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:63   
          1 00032B  3C32                                 LDV,R3   50
          1 00032C  0008                                 MMM

      370     7482    2         KV@SND_CNC.DSTNTWADR = PRM_VDH_CNC.DSTNTWADR;

   7482   1 00032D  8CC5 0013                            LDI      19,B5
          1 00032F  8D47 0035                            SDI      KV@SND_CNC+28,AUTO

      371     7483    2         KV@SND_CNC.ERR = '1'B;

   7483   1 000331  8947 0028                            LBT,'8000'X       KV@SND_CNC+15,AUTO
   7483   1 000333       8000

      372     7484    2         %KV_SSN.SSNCNCINT = '0'B;

   7484   1 000334  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000337  CCC6 0002                            LDB,B4   2,B6
          1 000339  8844 0028                            LBF,'0008'X       40,B4
          1 00033B       0008

      373     7485    2         CALL KVM$SND (KV@SND_CNC);

   7485   1 00033C  CBC7 0019                            LAB,B4   KV@SND_CNC,AUTO
          1 00033E  CFC7 0048                            STB,B4   @Y@SHRBFR+2,AUTO
          1 000340  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 000342  CBF0 0100                            LAB,B4   256,IMO
          1 000344  E380 0000 0000  xent                 LNJ,B6   KVM$SND
          1 000347       0001                            DC       s:7487,PREL

      374     7486    2      END;

      375     7487    1      ALTRETURN;

   7487   1 000348  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      376     7488
      377     7489        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:64   
      378     7490    1   KVC$WINDOW1: ENTRY (PRM) ALTRET;

   7490   1 00034B  D380 0000 0000  xent KVC$WINDOW1     LNJ,B5   X6A_AUTO_1
          1 00034E       004A 0001                       DC       74,1

      379     7491
      380     7492        /*F* NAME: KVC$WINDOW1, KVC$WINDOW2.
      381     7493             PURPOSE: Creates(-1) or modifies(-2) a window.  The parameter is a
      382     7494             VLP_WINDOW specifying the new parameters to be established.
      383     7495             KVC$WINDOW1 modifies some items in VLP_WINDOW for later use by
      384     7496             KVC$WINDOW2, so it must be writable, and KVC$WINDOW1 must not be
      385     7497             called more than once with the same VLP_WINDOW. */
      386     7498
      387     7499        /* First check that windows are permitted on the device. */
      388     7500
      389     7501    1      IF NOT %KV_MRD.BLANKERASES AND NOT %KV_MRD.FSTERS

   7501   1 000350  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000353  DCC6 0008                            LDB,B5   8,B6
          1 000355  82C5 0016                            LB,'0002'X        22,B5
          1 000357       0002
          1 000358  0501 0006                            BBT      s:7501+15,PREL
          1 00035A  82C5 0017                            LB,'0001'X        23,B5
          1 00035C       0001
          1 00035D  0581 000B                            BBF      s:7503,PREL
          1 00035F  82C5 0018                            LB,'0400'X        24,B5
          1 000361       0400
          1 000362  0581 0006                            BBF      s:7503,PREL
          1 000364  82C5 0017                            LB,'0002'X        23,B5
          1 000366       0002
          1 000367  0501 0004                            BBT      s:7504,PREL

      390     7502    1        OR NOT %KV_MRD.PHSFRM
      391     7503    1        OR NOT %KV_MRD.CURSORUP THEN ALTRETURN;

   7503   1 000369  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:65   
      392     7504    1      ORGPTR$ = %KV_SSN.STR$;

   7504   1 00036C  CCC6 0002                            LDB,B4   2,B6
          1 00036E  BCC4 0004                            LDB,B3   4,B4
          1 000370  BFC7 003B                            STB,B3   ORGPTR$,AUTO

      393     7505    2      DO WHILE ORGPTR$~=ADDR(NIL);

   7505   1 000372  0F81 000F                            B        s:7508,PREL

      394     7506    2         IF ORGPTR$->KV$STR.ID=PRM_WINDOW.FSTR.ID THEN EXIT;

   7506   1 000374  ECC7 003B                            LDB,B6   ORGPTR$,AUTO
          1 000376  E2C6 001C                            LLH,R6   28,B6
          1 000378  DCC7 0004                            LDB,B5   @PRM,AUTO
          1 00037A  D285                                 LLH,R5   ,B5
          1 00037B  E955                                 CMR,R6   R5
          1 00037C  0901 0008                            BE       s:7509,PREL

      395     7507    2         ORGPTR$ = ORGPTR$->KV$STR.LNK$;

   7507   1 00037E  CCC6 0002                            LDB,B4   2,B6
          1 000380  CFC7 003B                            STB,B4   ORGPTR$,AUTO

      396     7508    2      END;

   7508   1 000382  8DC7 003B                            CMN      ORGPTR$,AUTO
          1 000384  09F0                                 BNE      s:7506,SPREL

      397     7509    1      IF ORGPTR$=ADDR(NIL) THEN PRM_WINDOW.FWINDOW$ = ORGPTR$;

   7509   1 000385  8DC7 003B                            CMN      ORGPTR$,AUTO
          1 000387  0981 0008                            BNE      s:7510,PREL

   7509   1 000389  ECC7 003B                            LDB,B6   ORGPTR$,AUTO
          1 00038B  DCC7 0004                            LDB,B5   @PRM,AUTO
          1 00038D  EF85                                 STB,B6   ,B5
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:66   
          1 00038E  0F81 0009                            B        s:7514,PREL

      398     7510    1      ELSE PRM_WINDOW.FWINDOW$ = ORGPTR$->KV$STR.MVD$->KV$MVD.SRD$;

   7510   1 000390  ECC7 003B                            LDB,B6   ORGPTR$,AUTO
          1 000392  DCC6 0004                            LDB,B5   4,B6
          1 000394  CC85                                 LDB,B4   ,B5
          1 000395  BCC7 0004                            LDB,B3   @PRM,AUTO
          1 000397  CF83                                 STB,B4   ,B3

      399     7511
      400     7512        /* Get a MVD-SRD pair if we need one. */
      401     7513
      402     7514    2      IF %KV_MVD.USRCNT>1 AND PRM_WINDOW.POSITION~=0 THEN DO;

   7514   1 000398  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00039B  CCC5 0006                            LDB,B4   6,B5
          1 00039D  E844 0012                            LDR,R6   18,B4
          1 00039F  6D01                                 CMV,R6   1
          1 0003A0  0381 0042                            BLE      s:7531,PREL
          1 0003A2  BCC7 0004                            LDB,B3   @PRM,AUTO
          1 0003A4  D2C3 0004                            LLH,R5   4,B3
          1 0003A6  5901 003C                            BEZ,R5   s:7531,PREL

      403     7515
      404     7516    2         ORGPTR$ = KV$PTR.MVD$;            /* In case we don't succeed.          */

   7516   1 0003A8  CFC7 003B                            STB,B4   ORGPTR$,AUTO

      405     7517    2         IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN THEN CALL KVV$CALUSR_PST;

   7517   1 0003AA  EC85                                 LDB,B6   ,B5
          1 0003AB  C846 001A                            LDR,R4   26,B6
          1 0003AD  4D02                                 CMV,R4   2
          1 0003AE  0981 0007                            BNE      s:7518,PREL

   7517   1 0003B0  CBF0 0000                            LAB,B4   0,IMO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:67   
          1 0003B2  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          1 0003B5       0001                            DC       s:7518,PREL

      406     7518    2         KV@VDH_GETBFR = KV_VDH_GETBFR;

   7518   1 0003B6  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_GETBFR
          1 0003B9  2C00                                 LDV,R2   0
          1 0003BA  6C16                                 LDV,R6   22
          1 0003BB  BB87                                 LAB,B3   ,AUTO
          1 0003BC  3C0C                                 LDV,R3   12
          1 0003BD  0008                                 MMM

      407     7519    2         CALL Y$GETMVD ALTRET(NO_CTX);

   7519   1 0003BE  E3C0 0584                            LNJ,B6   s:0,PREL
          1 0003C0       0121                            DC       s:7589,PREL

      408     7520    2         CALL CALUSRGETSTR;

   7520   1 0003C1  E3C0 04C6                            LNJ,B6   s:0,PREL
          1 0003C3       0001                            DC       s:7521,PREL

      409     7521    3         CALL Y$GETSRD WHENALTRETURN DO;

   7521   1 0003C4  E3C0 062D                            LNJ,B6   s:0,PREL
          1 0003C6       0003                            DC       s:7522,PREL
          1 0003C7  0F81 0016                            B        s:7528,PREL

      410     7522    3            CALL KVC$RLSMVD;

   7522   1 0003C9  CBF0 0000                            LAB,B4   0,IMO
          1 0003CB  E380 0000 0000  xent                 LNJ,B6   KVC$RLSMVD
          1 0003CE       0001                            DC       s:7523,PREL

      411     7523    3            %KV_STR.MVD$ = ORGPTR$;

   7523   1 0003CF  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:68   
          1 0003D2  DCC6 0004                            LDB,B5   4,B6
          1 0003D4  CCC7 003B                            LDB,B4   ORGPTR$,AUTO
          1 0003D6  CFC5 0004                            STB,B4   4,B5

      412     7524    3            KV$PTR.MVD$ = ORGPTR$;

   7524   1 0003D8  CFC6 0006                            STB,B4   6,B6

      413     7525    3            %KV_MVD.USRCNT = %KV_MVD.USRCNT+1;

   7525   1 0003DA  8AC4 0012                            INC      18,B4

      414     7526    3            GOTO NO_CTX;

   7526   1 0003DC  0F81 0104                            B        s:7589,PREL

      415     7527    3         END;
      416     7528    2         CALL CALUSRGETSTR;

   7528   1 0003DE  E3C0 04A9                            LNJ,B6   s:0,PREL
          1 0003E0       0001                            DC       s:7529,PREL

      417     7529    2      END;

   7529   1 0003E1  0F81 0005                            B        s:7533,PREL

      418     7530    2      ELSE DO;

      419     7531    2         PRM_WINDOW.POSITION = 0;

   7531   1 0003E3  BCC7 0004                            LDB,B3   @PRM,AUTO
          1 0003E5  87C3 0004                            CLH      4,B3

      420     7532    2      END;

      421     7533    1      RETURN;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:69   
   7533   1 0003E7  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      422     7534        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:70   
      423     7535    1   KVC$WINDOW2: ENTRY (PRM) ALTRET;

   7535   1 0003EA  D380 0000 0000  xent KVC$WINDOW2     LNJ,B5   X6A_AUTO_1
          1 0003ED       004A 0001                       DC       74,1

      424     7536
      425     7537        /* Findchange in length required. */
      426     7538
      427     7539    1      IF PRM_WINDOW.POSITION~=%G_POSITION_LEFT#

   7539   1 0003EF  ECC7 0004                            LDB,B6   @PRM,AUTO
          1 0003F1  E2C6 0004                            LLH,R6   4,B6
          1 0003F3  6D02                                 CMV,R6   2
          1 0003F4  0901 0053                            BE       s:7553,PREL
          1 0003F6  6D03                                 CMV,R6   3
          1 0003F7  0901 0050                            BE       s:7553,PREL

      428     7540    2        AND PRM_WINDOW.POSITION~=%G_POSITION_RIGHT# THEN DO;

      429     7541    3         IF PRM_WINDOW.LENGTH>%G_WINDOW_PERCENT# THEN DO;

   7541   1 0003F9  D846 0002                            LDR,R5   2,B6
          1 0003FB  D970 4000                            CMR,R5   16384,IMO
          1 0003FD  0A81 0037                            BALE     s:7549+2,PREL

      430     7542    3            IF PRM_WINDOW.POSITION~=0 THEN TEMP = %KV_MRD.LNG;

   7542   1 0003FF  6901 000C                            BEZ,R6   s:7543,PREL

   7542   1 000401  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000404  CCC5 0008                            LDB,B4   8,B5
          1 000406  C2C4 0015                            LLH,R4   21,B4
          1 000408  CF47 003D                            STR,R4   TEMP,AUTO
          1 00040A  0F81 0018                            B        s:7547,PREL

      431     7543    3            ELSE IF PRM_WINDOW.FWINDOW$~=ADDR(NIL)

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:71   
   7543   1 00040C  8D86                                 CMN      ,B6
          1 00040D  0901 000A                            BE       s:7546,PREL

      432     7544    3            THEN TEMP = PRM_WINDOW.FWINDOW$->KV$SRD.SRDEND.LIN-

   7544   1 00040F  DC86                                 LDB,B5   ,B6
          1 000410  C845 001A                            LDR,R4   26,B5
          1 000412  C245 0007                            SUB,R4   7,B5
          1 000414  CF47 003D                            STR,R4   TEMP,AUTO
          1 000416  0F81 000C                            B        s:7547,PREL

      433     7545    3              PRM_WINDOW.FWINDOW$->KV$SRD.ORG.LIN;
      434     7546    3            ELSE TEMP = %KV_SRD.SRDEND.LIN-%KV_SRD.ORG.LIN;

   7546   1 000418  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00041B  CCC5 000A                            LDB,B4   10,B5
          1 00041D  C844 001A                            LDR,R4   26,B4
          1 00041F  C244 0007                            SUB,R4   7,B4
          1 000421  CF47 003D                            STR,R4   TEMP,AUTO

      435     7547    3            PRM_WINDOW.LENGTH = TEMP*(PRM_WINDOW.LENGTH-%G_WINDOW_PERCENT#)

   7547   1 000423  DA70 C000                            ADD,R5   -16384,IMO
          1 000425  DB54                                 MUL,R5   R4
          1 000426  D370 0064                            DIV,R5   100,IMO
          1 000428  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00042B  CCC5 000A                            LDB,B4   10,B5
          1 00042D  D244 001A                            SUB,R5   26,B4
          1 00042F  DA44 0007                            ADD,R5   7,B4
          1 000431  DF46 0002                            STR,R5   2,B6

      436     7548    3              /100-%KV_SRD.SRDEND.LIN+%KV_SRD.ORG.LIN;
      437     7549    2         END; ELSE IF PRM_WINDOW.LENGTH>=%G_WINDOW_ABSVAL#

   7549   1 000433  0F81 0016                            B        s:7557,PREL

   7549   1 000435  D970 2000                            CMR,R5   8192,IMO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:72   
          1 000437  0801 0012                            BAL      s:7557,PREL

      438     7550    2         THEN PRM_WINDOW.LENGTH =

   7550   1 000439  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00043C  CCC5 000A                            LDB,B4   10,B5
          1 00043E  D244 001A                            SUB,R5   26,B4
          1 000440  DA44 0007                            ADD,R5   7,B4
          1 000442  DA70 E000                            ADD,R5   -8192,IMO
          1 000444  DF46 0002                            STR,R5   2,B6

      439     7551    2           PRM_WINDOW.LENGTH-%G_WINDOW_ABSVAL#-%KV_SRD.SRDEND.LIN+%KV_SRD.ORG.LIN;
      440     7552    2      END;

   7552   1 000446  0F81 0003                            B        s:7557,PREL

      441     7553    1      ELSE PRM_WINDOW.LENGTH = 0;

   7553   1 000448  8746 0002                            CL       2,B6

      442     7554
      443     7555        /* Compute the change in width required. */
      444     7556
      445     7557    1      IF PRM_WINDOW.POSITION~=%G_POSITION_TOP#

   7557   1 00044A  6D01                                 CMV,R6   1
          1 00044B  0901 0051                            BE       s:7570,PREL
          1 00044D  6D04                                 CMV,R6   4
          1 00044E  0901 004E                            BE       s:7570,PREL

      446     7558    2        AND PRM_WINDOW.POSITION~=%G_POSITION_BOTTOM# THEN DO;

      447     7559    3         IF PRM_WINDOW.WIDTH>%G_WINDOW_PERCENT# THEN DO;

   7559   1 000450  D846 0003                            LDR,R5   3,B6
          1 000452  D970 4000                            CMR,R5   16384,IMO
          1 000454  0A81 0035                            BALE     s:7566+2,PREL
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:73   

      448     7560    3            IF PRM_WINDOW.POSITION~=0 THEN TEMP = %KV_MRD.WDT;

   7560   1 000456  6901 000C                            BEZ,R6   s:7561,PREL

   7560   1 000458  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00045B  CCC5 0008                            LDB,B4   8,B5
          1 00045D  C844 000B                            LDR,R4   11,B4
          1 00045F  CF47 003D                            STR,R4   TEMP,AUTO
          1 000461  0F81 0016                            B        s:7564,PREL

      449     7561    3            ELSE IF PRM_WINDOW.FWINDOW$~=ADDR(NIL)

   7561   1 000463  8D86                                 CMN      ,B6
          1 000464  0901 0008                            BE       s:7563,PREL

      450     7562    3            THEN TEMP = PRM_WINDOW.FWINDOW$->KV$SRD.WDT;

   7562   1 000466  DC86                                 LDB,B5   ,B6
          1 000467  C845 000D                            LDR,R4   13,B5
          1 000469  CF47 003D                            STR,R4   TEMP,AUTO
          1 00046B  0F81 000C                            B        s:7564,PREL

      451     7563    3            ELSE TEMP = %KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM;

   7563   1 00046D  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000470  CCC5 000A                            LDB,B4   10,B5
          1 000472  C844 001B                            LDR,R4   27,B4
          1 000474  C244 0008                            SUB,R4   8,B4
          1 000476  CF47 003D                            STR,R4   TEMP,AUTO

      452     7564    3            PRM_WINDOW.WIDTH = TEMP*(PRM_WINDOW.WIDTH-%G_WINDOW_PERCENT#)

   7564   1 000478  DA70 C000                            ADD,R5   -16384,IMO
          1 00047A  DB54                                 MUL,R5   R4
          1 00047B  D370 0064                            DIV,R5   100,IMO
          1 00047D  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:74   
          1 000480  CCC5 000A                            LDB,B4   10,B5
          1 000482  D244 001B                            SUB,R5   27,B4
          1 000484  DA44 0008                            ADD,R5   8,B4
          1 000486  DF46 0003                            STR,R5   3,B6

      453     7565    3              /100-%KV_SRD.SRDEND.CLM+%KV_SRD.ORG.CLM;
      454     7566    2         END; ELSE IF PRM_WINDOW.WIDTH>=%G_WINDOW_ABSVAL#

   7566   1 000488  0F81 0016                            B        s:7574,PREL

   7566   1 00048A  D970 2000                            CMR,R5   8192,IMO
          1 00048C  0801 0012                            BAL      s:7574,PREL

      455     7567    2         THEN PRM_WINDOW.WIDTH =

   7567   1 00048E  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000491  CCC5 000A                            LDB,B4   10,B5
          1 000493  D244 001B                            SUB,R5   27,B4
          1 000495  DA44 0008                            ADD,R5   8,B4
          1 000497  DA70 E000                            ADD,R5   -8192,IMO
          1 000499  DF46 0003                            STR,R5   3,B6

      456     7568    2           PRM_WINDOW.WIDTH-%G_WINDOW_ABSVAL#-%KV_SRD.SRDEND.CLM+%KV_SRD.ORG.CLM;
      457     7569    2      END;

   7569   1 00049B  0F81 0003                            B        s:7574,PREL

      458     7570    1      ELSE PRM_WINDOW.WIDTH = 0;

   7570   1 00049D  8746 0003                            CL       3,B6

      459     7571
      460     7572        /* Now call the recursive size changer. */
      461     7573
      462     7574    2      IF PRM_WINDOW.LENGTH~=0 OR PRM_WINDOW.POSITION~=0 THEN DO;

   7574   1 00049F  D846 0002                            LDR,R5   2,B6
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:75   
          1 0004A1  5981 0003                            BNEZ,R5  s:7575,PREL
          1 0004A3  6901 000D                            BEZ,R6   s:7578,PREL

      463     7575    2         CALL KVC$ADJWND (PRM);

   7575   1 0004A5  BBC7 0004                            LAB,B3   @PRM,AUTO
          1 0004A7  CBF0 0100                            LAB,B4   256,IMO
          1 0004A9  E380 0000 0000  xent                 LNJ,B6   KVC$ADJWND
          1 0004AC       0001                            DC       s:7576,PREL

      464     7576    2         PRM_WINDOW.LENGTH = 0;

   7576   1 0004AD  ECC7 0004                            LDB,B6   @PRM,AUTO
          1 0004AF  8746 0002                            CL       2,B6

      465     7577    2      END;

      466     7578    1      IF PRM_WINDOW.WIDTH~=0 AND PRM_WINDOW.POSITION=0 THEN CALL KVC$ADJWND (PRM);

   7578   1 0004B1  E846 0003                            LDR,R6   3,B6
          1 0004B3  6901 000D                            BEZ,R6   s:7579,PREL
          1 0004B5  D2C6 0004                            LLH,R5   4,B6
          1 0004B7  5981 0009                            BNEZ,R5  s:7579,PREL

   7578   1 0004B9  BBC7 0004                            LAB,B3   @PRM,AUTO
          1 0004BB  CBF0 0100                            LAB,B4   256,IMO
          1 0004BD  E380 0000 0000  xent                 LNJ,B6   KVC$ADJWND
          1 0004C0       0001                            DC       s:7579,PREL

      467     7579    1      RETURN;

   7579   1 0004C1  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      468     7580        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:76   
      469     7581        /*F* NAME: KVC$DCLSTR.
      470     7582             PURPOSE: Adds another stream to an existing session.
      471     7583             CALL: The single parameter is a UBIN stream-id. */
      472     7584    1   KVC$DCLSTR: ENTRY (PRM) ALTRET;

   7584   1 0004C4  D380 0000 0000  xent KVC$DCLSTR      LNJ,B5   X6A_AUTO_1
          1 0004C7       004A 0001                       DC       74,1

      473     7585
      474     7586    1      ORGPTR$ = KV$PTR.STR$;

   7586   1 0004C9  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0004CC  DCC6 0004                            LDB,B5   4,B6
          1 0004CE  DFC7 003B                            STB,B5   ORGPTR$,AUTO

      475     7587    1      KV@VDH_GETBFR = KV_VDH_GETBFR;

   7587   1 0004D0  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_GETBFR
          1 0004D3  2C00                                 LDV,R2   0
          1 0004D4  6C16                                 LDV,R6   22
          1 0004D5  BB87                                 LAB,B3   ,AUTO
          1 0004D6  3C0C                                 LDV,R3   12
          1 0004D7  0008                                 MMM

      476     7588    2      CALL Y$GETSTR (PRM_VDH_CNC) WHENALTRETURN DO;

   7588   1 0004D8  ECC7 0004                            LDB,B6   @PRM,AUTO
          1 0004DA  EFC7 0040                            STB,B6   TEMP+3,AUTO
          1 0004DC  E3C0 0316                            LNJ,B6   s:0,PREL
          1 0004DE       0003                            DC       s:7589,PREL
          1 0004DF  0F81 000D                            B        s:7593,PREL

      477     7589    2   NO_CTX:;

   7589   1                              NO_CTX          null
      478     7590    2         %KV_STR.ERR.COD = %E$CANTGETCTX;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:77   
   7590   1 0004E1  EC80 0000 0000  xsym NO_CTX          LDB,B6   KV$PTR$
          1 0004E4  DCC6 0004                            LDB,B5   4,B6
          1 0004E6  E870 05C8                            LDR,R6   1480,IMO
          1 0004E8  EF45 0013                            STR,R6   19,B5

      479     7591    2         ALTRETURN;

   7591   1 0004EA  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      480     7592    2      END;
      481     7593    1      KV$PTR.STR$ = ORGPTR$;

   7593   1 0004ED  ECC7 003B                            LDB,B6   ORGPTR$,AUTO
          1 0004EF  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0004F2  EFC5 0004                            STB,B6   4,B5

      482     7594    1      RETURN;

   7594   1 0004F4  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      483     7595        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:78   
      484     7596    1   KVC$OPNFRM: ENTRY (PRM) ALTRET;

   7596   1 0004F7  D380 0000 0000  xent KVC$OPNFRM      LNJ,B5   X6A_AUTO_1
          1 0004FA       004A 0001                       DC       74,1

      485     7597        /*F* NAME: KVC$OPNFRM
      486     7598
      487     7599           PURPOSE: KVC$OPNFRM initializes the context needed for a forms,
      488     7600        X3.64 or editing window.                                                         */
      489     7601
      490     7602    1      KV@VDH_GETBFR.BFR$ = KV$PTR.LINLST$;

   7602   1 0004FC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0004FF  DCC6 000E                            LDB,B5   14,B6
          1 000501  DFC7 0007                            STB,B5   KV@VDH_GETBFR+1,AUTO

      491     7603    1      IF %KV_MVD.ORG=PRM_VDO_OPNSTR.ORG

   7603   1 000503  CCC6 0006                            LDB,B4   6,B6
          1 000505  E2C4 0015                            LLH,R6   21,B4
          1 000507  BCC7 0004                            LDB,B3   @PRM,AUTO
          1 000509  D2C3 0001                            LLH,R5   1,B3
          1 00050B  E955                                 CMR,R6   R5
          1 00050C  0981 002D                            BNE      s:7609,PREL

      492     7604    1      THEN IF %KV_MVD.ORG~=%KV#VD_ORG_SE

   7604   1 00050E  6D05                                 CMV,R6   5
          1 00050F  0981 0027                            BNE      s:7608,PREL
          1 000511  82C3 0001                            LB,'00FF'X        1,B3
          1 000513       00FF
          1 000514  0581 0009                            BBF      s:7604+16,PREL
          1 000516  C843 0001                            LDR,R4   1,B3
          1 000518  C570 00FF                            AND,R4   255,IMO
          1 00051A  C945 0002                            CMR,R4   2,B5
          1 00051C  0A01 001D                            BAG      s:7609,PREL
          1 00051E  C2C3 0002                            LLH,R4   2,B3
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:79   
          1 000520  4901 0006                            BEZ,R4   s:7604+25,PREL
          1 000522  B2C5 000B                            LLH,R3   11,B5
          1 000524  B954                                 CMR,R3   R4
          1 000525  0981 0014                            BNE      s:7609,PREL
          1 000527  82C3 0002                            LB,'00FF'X        2,B3
          1 000529       00FF
          1 00052A  0581 000C                            BBF      s:7608,PREL
          1 00052C  B845 000B                            LDR,R3   11,B5
          1 00052E  B570 00FF                            AND,R3   255,IMO
          1 000530  A843 0002                            LDR,R2   2,B3
          1 000532  A570 00FF                            AND,R2   255,IMO
          1 000534  B952                                 CMR,R3   R2
          1 000535  0981 0004                            BNE      s:7609,PREL

      493     7605    1        OR (PRM_VDO_OPNSTR.NRECS=0 OR %KV_RCRLST.MAXRCR>=PRM_VDO_OPNSTR.NRECS)
      494     7606    1        AND (PRM_VDO_OPNSTR.KEYL=0 OR %KV_RCRLST.KEYLNG=PRM_VDO_OPNSTR.KEYL)
      495     7607    1        AND (PRM_VDO_OPNSTR.SPARE=0 OR %KV_RCRLST.SPRCNT=PRM_VDO_OPNSTR.SPARE)
      496     7608    1      THEN RETURN;                         /* That was easy                      */

   7608   1 000537  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      497     7609    1      KV@VDH_SETPRM = KV_VDH_SETPRM;

   7609   1 00053A  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_SETPRM
          1 00053D  2C00                                 LDV,R2   0
          1 00053E  6C10                                 LDV,R6   16
          1 00053F  BB87                                 LAB,B3   ,AUTO
          1 000540  3C22                                 LDV,R3   34
          1 000541  0008                                 MMM

      498     7610    1      KV@VDH_SETPRM.SCP = %KV_SCP_ONE_ONLY;

   7610   1 000542  6C08                                 LDV,R6   8
          1 000543  E7C7 0018                            STH,R6   KV@VDH_SETPRM+7,AUTO

      499     7611
      500     7612    1      KV@VDH_GETBFR = KV_VDH_GETBFR;       /* Sets up RLSBFR ok, too.            */
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:80   

   7612   1 000545  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_GETBFR
          1 000548  2C00                                 LDV,R2   0
          1 000549  6C16                                 LDV,R6   22
          1 00054A  BB87                                 LAB,B3   ,AUTO
          1 00054B  3C0C                                 LDV,R3   12
          1 00054C  0008                                 MMM

      501     7613    1      IF %KV_MVD.LINLST$~=ADDR(NIL) THEN CALL KVC$RLSFRM;

   7613   1 00054D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000550  DCC6 0006                            LDB,B5   6,B6
          1 000552  8DC5 0010                            CMN      16,B5
          1 000554  0901 0007                            BE       s:7617,PREL

   7613   1 000556  CBF0 0000                            LAB,B4   0,IMO
          1 000558  E380 0000 0000  xent                 LNJ,B6   KVC$RLSFRM
          1 00055B       0001                            DC       s:7617,PREL

      502     7614
      503     7615        /* Release the unusable MVD appendages. */
      504     7616
      505     7617    2      IF PRM_VDO_OPNSTR.ORG=%KV#VD_ORG_FORM THEN DO;

   7617   1 00055C  ECC7 0004                            LDB,B6   @PRM,AUTO
          1 00055E  E2C6 0001                            LLH,R6   1,B6
          1 000560  6D04                                 CMV,R6   4
          1 000561  0981 0077                            BNE      s:7640,PREL

      506     7618    2         IF %KV_SRD.WDT~=%KV_MRD.WDT AND %KV_MRD.MAXATRPERLIN<%KV_MRD.WDT

   7618   1 000563  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000566  CCC5 000A                            LDB,B4   10,B5
          1 000568  BCC5 0008                            LDB,B3   8,B5
          1 00056A  D844 000D                            LDR,R5   13,B4
          1 00056C  D943 000B                            CMR,R5   11,B3
          1 00056E  0901 000C                            BE       s:7618+24,PREL
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:81   
          1 000570  C2C3 0016                            LLH,R4   22,B3
          1 000572  C943 000B                            CMR,R4   11,B3
          1 000574  0281 0006                            BGE      s:7618+24,PREL
          1 000576  82C3 0018                            LB,'0200'X        24,B3
          1 000578       0200
          1 000579  0581 0081                            BBF      s:7649,PREL
          1 00057B  C2C4 000E                            LLH,R4   14,B4
          1 00057D  4901 007D                            BEZ,R4   s:7649,PREL

      507     7619    2           AND NOT %KV_MRD.DCLATRWHNOTP OR %KV_SRD.LNG=0 THEN GOTO NOTCOM_ERR;
      508     7620    2         %KV_SRD.MINWDT = %KV_SRD.WDT;

   7620   1 00057F  D7C4 001E                            STH,R5   30,B4

      509     7621    2         %KV_SRD.MINLNG = %KV_SRD.LNG;

   7621   1 000581  CCC5 000A                            LDB,B4   10,B5
          1 000583  E2C4 000E                            LLH,R6   14,B4
          1 000585  EAC4 001E                            SRM,R6,'00FF'X    30,B4
          1 000587       00FF

      510     7622    2         %KV_SRD.OPT = '0'B;

   7622   1 000588  CCC5 000A                            LDB,B4   10,B5
          1 00058A  8844 001C                            LBF,'8000'X       28,B4
          1 00058C       8000

      511     7623        /* Run short screens in hard-copy (scrolling) mode. */
      512     7624    2         IF NOT %KV_MRD.CURSORUP THEN %KV_MVD.RETYPOVR = '0'B;

   7624   1 00058D  CCC5 0008                            LDB,B4   8,B5
          1 00058F  82C4 0017                            LB,'0002'X        23,B4
          1 000591       0002
          1 000592  0501 0006                            BBT      s:7625,PREL

   7624   1 000594  BCC5 0006                            LDB,B3   6,B5
          1 000596  8843 0016                            LBF,'0080'X       22,B3
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:82   
          1 000598       0080

      513     7625    3         IF NOT %KV_MVD.RETYPOVR AND %KV_MVD.USRCNT>1 THEN DO;

   7625   1 000599  CCC5 0006                            LDB,B4   6,B5
          1 00059B  82C4 0016                            LB,'0080'X        22,B4
          1 00059D       0080
          1 00059E  0501 0019                            BBT      s:7635,PREL
          1 0005A0  E844 0012                            LDR,R6   18,B4
          1 0005A2  6D01                                 CMV,R6   1
          1 0005A3  0381 0014                            BLE      s:7635,PREL

      514     7626    3            CALL Y$GETMVD ALTRET(NO_CTX); /* Get another MVD for the FORM stream */

   7626   1 0005A5  E3C0 039D                            LNJ,B6   s:0,PREL
          1 0005A7       FF3A                            DC       s:7589,PREL

      515     7627    4            IF NOT %KV_MRD.PHSFRM THEN DO;

   7627   1 0005A8  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0005AB  DCC6 0008                            LDB,B5   8,B6
          1 0005AD  82C5 0018                            LB,'0400'X        24,B5
          1 0005AF       0400
          1 0005B0  0501 0007                            BBT      s:7635,PREL

      516     7628
      517     7629        /* The paper is not fixed length, use a sensible value (not 255).             */
      518     7630
      519     7631    4               %KV_SRD.MINLNG = 24;

   7631   1 0005B2  CCC6 000A                            LDB,B4   10,B6
          1 0005B4  6C18                                 LDV,R6   24
          1 0005B5  EAC4 001E                            SRM,R6,'00FF'X    30,B4
          1 0005B7       00FF

      520     7632    4            END /* IF */;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:83   
      521     7633    3         END /* IF NOT RETYPOVR */;

      522     7634
      523     7635    2         %VDH_RLSBFR.BFR$ = %KV_MVD.INPTAB$;

   7635   1 0005B8  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0005BB  DCC6 0006                            LDB,B5   6,B6
          1 0005BD  CCC5 0004                            LDB,B4   4,B5
          1 0005BF  CFC7 0007                            STB,B4   KV@VDH_GETBFR+1,AUTO

      524     7636    2         %VDH_RLSBFR.STRTYP = %KV_STRTYP_INPTAB;

   7636   1 0005C1  6C07                                 LDV,R6   7
          1 0005C2  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      525     7637    2         %KV_MVD.INPTAB$ = ADDR(NIL);

   7637   1 0005C4  DCC6 0006                            LDB,B5   6,B6
          1 0005C6  BB80 0000 0000                       LAB,B3   0
          1 0005C9  BFC5 0004                            STB,B3   4,B5

      526     7638    2         CALL KVS$RLSBFR (%VDH_RLSBFR);

   7638   1 0005CB  DBC7 0006                            LAB,B5   KV@VDH_GETBFR,AUTO
          1 0005CD  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 0005CF  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0005D1  CBF0 0100                            LAB,B4   256,IMO
          1 0005D3  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 0005D6       0001                            DC       s:7639,PREL

      527     7639    2      END;

   7639   1 0005D7  0F81 0012                            B        s:7647,PREL

      528     7640    1      ELSE IF NOT %KV_MVD.RETYPOVR OR NOT %KV_MRD.CURSORUP THEN GOTO NOTCOM_ERR;

   7640   1 0005D9  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:84   
          1 0005DC  CCC5 0006                            LDB,B4   6,B5
          1 0005DE  82C4 0016                            LB,'0080'X        22,B4
          1 0005E0       0080
          1 0005E1  0581 0019                            BBF      s:7649,PREL
          1 0005E3  BCC5 0008                            LDB,B3   8,B5
          1 0005E5  82C3 0017                            LB,'0002'X        23,B3
          1 0005E7       0002
          1 0005E8  0581 0012                            BBF      s:7649,PREL

      529     7641         /*E*  ERROR:KV-E$ORGNOTCOM-E
      530     7642                 MESSAGE:SE, FORM, or X364 needs RETYPOVR. FORM needs wide window.
      531     7643                 MESSAGE1:For ORG=SE, FORM, or X364, RETYPOVR=YES and HEIGHT>=24
      532     7644                          must be true. For C00 FORMs, the window must be full width.
      533     7645           */
      534     7646
      535     7647    2      IF PRM_VDO_OPNSTR.ORG~=%KV#VD_ORG_X364 THEN DO;

   7647   1 0005EA  ECC7 0004                            LDB,B6   @PRM,AUTO
          1 0005EC  E2C6 0001                            LLH,R6   1,B6
          1 0005EE  6D02                                 CMV,R6   2
          1 0005EF  0901 0034                            BE       s:7661,PREL

      536     7648    3         IF %KV_MVD.USRCNT>1 THEN DO;

   7648   1 0005F1  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0005F4  CCC5 0006                            LDB,B4   6,B5
          1 0005F6  D844 0012                            LDR,R5   18,B4
          1 0005F8  5D01                                 CMV,R5   1
          1 0005F9  0381 000A                            BLE      s:7653,PREL

      537     7649    3   NOTCOM_ERR:;

   7649   1                              NOTCOM_ERR      null
      538     7650    3            %KV_STR.ERR.COD = %E$ORGNOTCOM;

   7650   1 0005FB  CCC5 0004            NOTCOM_ERR      LDB,B4   4,B5
          1 0005FD  D870 030F                            LDR,R5   783,IMO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:85   
          1 0005FF  DF44 0013                            STR,R5   19,B4

      539     7651    3            ALTRETURN;

   7651   1 000601  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      540     7652    3         END;
      541     7653    2         IF NOT %KV_MVD.RETYPOVR THEN EXIT;

   7653   1 000604  82C4 0016                            LB,'0080'X        22,B4
   7653   1 000606       0080
          1 000607  0581 001C                            BBF      s:7661,PREL

      542     7654    2         %KV_SRD.TRUNCATE = '0'B;

   7654   1 000609  BCC5 000A                            LDB,B3   10,B5
          1 00060B  8843 000E                            LBF,'0004'X       14,B3
          1 00060D       0004

      543     7655        /* No scroll for FORM or SE */
      544     7656    2         IF NOT %KV_SRD.SCROLL THEN EXIT;

   7656   1 00060E  CCC5 000A                            LDB,B4   10,B5
          1 000610  82C4 000E                            LB,'0008'X        14,B4
          1 000612       0008
          1 000613  0581 0010                            BBF      s:7661,PREL

      545     7657    2         KV@VDH_SETPRM.PRMID = %KV_PRMID_SCROLL;

   7657   1 000615  6C4F                                 LDV,R6   79
          1 000616  EF47 0012                            STR,R6   KV@VDH_SETPRM+1,AUTO

      546     7658    2         CALL KVP$SETPRM (KV@VDH_SETPRM);

   7658   1 000618  CBC7 0011                            LAB,B4   KV@VDH_SETPRM,AUTO
          1 00061A  CFC7 0048                            STB,B4   @Y@SHRBFR+2,AUTO
          1 00061C  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:86   
          1 00061E  CBF0 0100                            LAB,B4   256,IMO
          1 000620  E380 0000 0000  xent                 LNJ,B6   KVP$SETPRM
          1 000623       0001                            DC       s:7661,PREL

      547     7659    2      END;

      548     7660
      549     7661    1      %KV_SRD.NXTNONBLNLIN = 255;

   7661   1 000624  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000627  DCC6 000A                            LDB,B5   10,B6
          1 000629  E870 00FF                            LDR,R6   255,IMO
          1 00062B  EF45 0014                            STR,R6   20,B5

      550     7662    2      IF %KV_MVD.RETYPOVR THEN DO;

   7662   1 00062D  DCC6 0006                            LDB,B5   6,B6
          1 00062F  82C5 0016                            LB,'0080'X        22,B5
          1 000631       0080
          1 000632  0581 000B                            BBF      s:7666,PREL

      551     7663    2         %KV_SRD.NOOPTMIZ = '0'B;

   7663   1 000634  CCC6 000A                            LDB,B4   10,B6
          1 000636  8844 001D                            LBF,'8000'X       29,B4
          1 000638       8000

      552     7664    2         %KV_MVD.EDITOVR = '1'B;

   7664   1 000639  DCC6 0006                            LDB,B5   6,B6
          1 00063B  8945 0016                            LBT,'0040'X       22,B5
          1 00063D       0040

      553     7665    2      END;

      554     7666    1      %VDH_RLSBFR.BFR$ = %KV_MVD.VFU$;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:87   
   7666   1 00063E  DCC6 0006                            LDB,B5   6,B6
          1 000640  CCC5 000C                            LDB,B4   12,B5
          1 000642  CFC7 0007                            STB,B4   KV@VDH_GETBFR+1,AUTO

      555     7667    1      %VDH_RLSBFR.STRTYP = %KV_STRTYP_VFU;

   7667   1 000644  5C1E                                 LDV,R5   30
          1 000645  D7C7 000C                            STH,R5   KV@VDH_GETBFR+6,AUTO

      556     7668    1      CALL KVS$RLSBFR (%VDH_RLSBFR);

   7668   1 000647  DBC7 0006                            LAB,B5   KV@VDH_GETBFR,AUTO
          1 000649  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 00064B  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 00064D  CBF0 0100                            LAB,B4   256,IMO
          1 00064F  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 000652       0001                            DC       s:7669,PREL

      557     7669    1      %KV_MVD.VFU$ = ADDR(NIL);

   7669   1 000653  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000656  DCC6 0006                            LDB,B5   6,B6
          1 000658  CB80 0000 0000                       LAB,B4   0
          1 00065B  CFC5 000C                            STB,B4   12,B5

      558     7670        /* strip the form stream                                                      */
      559     7671
      560     7672    1      CALL Y$STRSTR;

   7672   1 00065D  E3C0 0254                            LNJ,B6   s:0,PREL
          1 00065F       0001                            DC       s:7673,PREL

      561     7673    1      %KV_STR.ACTCHRTBL$ = ADDR(KV_ACTCHRTBLNRM);

   7673   1 000660  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000663  DCC6 0004                            LDB,B5   4,B6
          1 000665  CB80 0000 0000  xsym                 LAB,B4   KV_ACTCHRTBLNRM
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:88   
          1 000668  CFC5 000A                            STB,B4   10,B5

      562     7674
      563     7675    1      %KV_MVD.WDT = %KV_SRD.WDT;

   7675   1 00066A  DCC6 0006                            LDB,B5   6,B6
          1 00066C  CCC6 000A                            LDB,B4   10,B6
          1 00066E  E844 000D                            LDR,R6   13,B4
          1 000670  EF45 0013                            STR,R6   19,B5

      564     7676    1      %KV_MVD.LNG = 0;

   7676   1 000672  DCC6 0006                            LDB,B5   6,B6
          1 000674  87C5 0014                            CLH      20,B5

      565     7677
      566     7678        /* Now get the LINLST area. */
      567     7679
      568     7680    2      DO CASE PRM_VDO_OPNSTR.ORG;

   7680   1 000676  DCC7 0004                            LDB,B5   @PRM,AUTO
          1 000678  B2C5 0001                            LLH,R3   1,B5
          1 00067A  3D06                                 CMV,R3   6
          1 00067B  0281 0045                            BGE      s:7692,PREL
          1 00067D  A830 0000 0683  01                   LDR,R2   s:7680+13,R3
          1 000680  83A0 0000 0689  01                   JMP      s:7682,R2
          1 000683       0038                            DC       s:7692,PREL
          1 000684       0038                            DC       s:7692,PREL
          1 000685       0035                            DC       s:7690,PREL
          1 000686       0038                            DC       s:7692,PREL
          1 000687       0000                            DC       s:7682,PREL
          1 000688       000F                            DC       s:7685,PREL

      569     7681    2      CASE %KV#VD_ORG_FORM;

      570     7682    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_LINLST;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:89   
   7682   1 000689  6C09                                 LDV,R6   9
          1 00068A  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      571     7683    2         KV@VDH_GETBFR.BYTSIZ = 2*SIZEW(KV$LINLST)+2*SIZEW(KV$LIN)*%KV_SRD.MINLNG;

   7683   1 00068C  CCC6 000A                            LDB,B4   10,B6
          1 00068E  D844 001E                            LDR,R5   30,B4
          1 000690  5003                                 SOL,R5   3
          1 000691  D570 07F8                            AND,R5   2040,IMO
          1 000693  5E10                                 ADV,R5   16
          1 000694  DF47 0009                            STR,R5   KV@VDH_GETBFR+3,AUTO
          1 000696  0F81 002A                            B        s:7692,PREL

      572     7684    2      CASE %KV#VD_ORG_SE;

      573     7685    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_RCRLST;

   7685   1 000698  6C24                                 LDV,R6   36
          1 000699  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      574     7686    2         TEMP = MAXIMUM (%KV_MRD.DSPHEIGHT+10, MINIMUM (50,

   7686   1 00069B  CCC6 000A                            LDB,B4   10,B6
          1 00069D  D2C4 000E                            LLH,R5   14,B4
          1 00069F  5001                                 SOL,R5   1
          1 0006A0  C845 0001                            LDR,R4   1,B5
          1 0006A2  C570 00FF                            AND,R4   255,IMO
          1 0006A4  C955                                 CMR,R4   R5
          1 0006A5  0381 0002                            BLE      s:7686+13,PREL
          1 0006A7  D854                                 LDR,R5   R4
          1 0006A8  D970 0032                            CMR,R5   50,IMO
          1 0006AA  0381 0002                            BLE      s:7686+18,PREL
          1 0006AC  5C32                                 LDV,R5   50
          1 0006AD  BCC6 0008                            LDB,B3   8,B6
          1 0006AF  B2C3 000A                            LLH,R3   10,B3
          1 0006B1  3E0A                                 ADV,R3   10
          1 0006B2  B955                                 CMR,R3   R5
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:90   
          1 0006B3  0381 0002                            BLE      s:7686+27,PREL
          1 0006B5  D853                                 LDR,R5   R3
          1 0006B6  DF47 003D                            STR,R5   TEMP,AUTO

      575     7687    2           MAXIMUM (PRM_VDO_OPNSTR.NRECS, %KV_SRD.LNG*2)));
      576     7688    2         KV@VDH_GETBFR.BYTSIZ = SIZEC(KV$RCRLST)+SIZEC(KV$RCRLST.RCR$)*(TEMP-1);

   7688   1 0006B8  5002                                 SOL,R5   2
          1 0006B9  5E20                                 ADV,R5   32
          1 0006BA  DF47 0009                            STR,R5   KV@VDH_GETBFR+3,AUTO
          1 0006BC  0F81 0004                            B        s:7692,PREL

      577     7689    2      CASE %KV#VD_ORG_X364;

      578     7690    2         KV@VDH_GETBFR.STRTYP = %KV_STRTYP_X364;

   7690   1 0006BE  6C22                                 LDV,R6   34
          1 0006BF  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      579     7691    2      END; /* END DO CASE .ORG */

      580     7692    1      CALL KVS$GETBFR (KV@VDH_GETBFR) ALTRET(NO_CTX);

   7692   1 0006C1  CBC7 0006                            LAB,B4   KV@VDH_GETBFR,AUTO
          1 0006C3  CFC7 0048                            STB,B4   @Y@SHRBFR+2,AUTO
          1 0006C5  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0006C7  CBF0 0100                            LAB,B4   256,IMO
          1 0006C9  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 0006CC       FE15                            DC       s:7589,PREL

      581     7693    1      %KV_MVD.LINLST$ = KV@VDH_GETBFR.BFR$;

   7693   1 0006CD  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0006D0  DCC6 0006                            LDB,B5   6,B6
          1 0006D2  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 0006D4  CFC5 0010                            STB,B4   16,B5

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:91   
      582     7694    1      KV$PTR.LINLST$ = KV@VDH_GETBFR.BFR$;

   7694   1 0006D6  CFC6 000E                            STB,B4   14,B6

      583     7695    2      IF KV@VDH_GETBFR.STRTYP=%KV_STRTYP_LINLST THEN DO;

   7695   1 0006D8  E2C7 000C                            LLH,R6   KV@VDH_GETBFR+6,AUTO
          1 0006DA  6D09                                 CMV,R6   9
          1 0006DB  0981 0042                            BNE      s:7711,PREL

      584     7696    2         %KV_LINLST = '0'B;

   7696   1 0006DD  5C10                                 LDV,R5   16
          1 0006DE  0021                                 ALR      ;
          1 0006DF       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 0006E1       4004 0000                                ALPHANUM(0,B4,,R5,FILL)

      585     7697    2         %KV_LINLST.LSTCELWRDX = KV@VDH_GETBFR.BYTSIZ/2-1;

   7697   1 0006E3  437F                                 CSYNC    s:7696+5,SPREL
          1 0006E4  E847 0009                            LDR,R6   KV@VDH_GETBFR+3,AUTO
          1 0006E6  6041                                 SOR,R6   1
          1 0006E7  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 0006E9  6EFF                                 ADV,R6   -1
          1 0006EA  EF06                                 STR,R6   ,B6

      586     7698    2         %KV_LINLST.LSTENTWRDX = SIZEW(KV$LINLST)+(%KV_SRD.MINLNG-1)*SIZEW(KV$LIN);

   7698   1 0006EB  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0006EE  DCC6 000A                            LDB,B5   10,B6
          1 0006F0  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 0006F2  E845 001E                            LDR,R6   30,B5
          1 0006F4  6002                                 SOL,R6   2
          1 0006F5  E570 03FC                            AND,R6   1020,IMO
          1 0006F7  6E04                                 ADV,R6   4
          1 0006F8  EF44 0001                            STR,R6   1,B4

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:92   
      587     7699    2         STEMP = SIZEW(KV$LINLST);

   7699   1 0006FA  6C08                                 LDV,R6   8
          1 0006FB  EF47 003D                            STR,R6   TEMP,AUTO

      588     7700    3         DO UNTIL STEMP > %KV_LINLST.LSTENTWRDX;

      589     7701
      590     7702        /* This loop is traversed for each KV$LIN entry in the KV$LINLST              */
      591     7703        /* table initialized.                                                         */
      592     7704
      593     7705    3            PINCRW(ADDR(%KV_LINLST),STEMP)->KV$LIN = KV_LIN;

   7705   1 0006FD  AB80 0000 0000  xsym                 LAB,B2   KV_LIN
          1 000700  2C00                                 LDV,R2   0
          1 000701  6C08                                 LDV,R6   8
          1 000702  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 000704  B847 003D                            LDR,R3   TEMP,AUTO
          1 000706  3001                                 SOL,R3   1
          1 000707  0008                                 MMM

      594     7706    3            PINCRW(ADDR(%KV_LINLST),STEMP)->KV$LIN.VRTLIN =

   7706   1 000708  E847 003D                            LDR,R6   TEMP,AUTO
          1 00070A  6042                                 SOR,R6   2
          1 00070B  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 00070D  B847 003D                            LDR,R3   TEMP,AUTO
          1 00070F  3E02                                 ADV,R3   2
          1 000710  6EFF                                 ADV,R6   -1
          1 000711  EF36                                 STR,R6   ,B6,R3

      595     7707    3              TEMP/SIZEW(KV$LIN) - SIZEW(KV$LINLST)/SIZEW(KV$LIN) + 1;
      596     7708    3            STEMP = STEMP+SIZEW(KV$LIN);

   7708   1 000712  E847 003D                            LDR,R6   TEMP,AUTO
          1 000714  6E04                                 ADV,R6   4
          1 000715  EF47 003D                            STR,R6   TEMP,AUTO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:93   

      597     7709    3         END /* LOOP */;

   7709   1 000717  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000719  E946 0001                            CMR,R6   1,B6
          1 00071B  0AE2                                 BALE     s:7705,SPREL

      598     7710    2      END;

   7710   1 00071C  0F81 0044                            B        s:7721,PREL

      599     7711    2      ELSE IF KV@VDH_GETBFR.STRTYP=%KV_STRTYP_RCRLST THEN DO;

   7711   1 00071E  6D24                                 CMV,R6   36
          1 00071F  0981 0041                            BNE      s:7721,PREL

      600     7712    2         %KV_RCRLST = KV_RCRLST;

   7712   1 000721  AB80 0000 0000  00                   LAB,B2   KV_RCRLST
          1 000724  2C00                                 LDV,R2   0
          1 000725  6C24                                 LDV,R6   36
          1 000726  BB84                                 LAB,B3   ,B4
          1 000727  3C00                                 LDV,R3   0
          1 000728  0008                                 MMM

      601     7713    2         %KV_RCRLST.STRBYTSIZ = KV@VDH_GETBFR.BYTSIZ;

   7713   1 000729  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 00072B  E847 0009                            LDR,R6   KV@VDH_GETBFR+3,AUTO
          1 00072D  EF06                                 STR,R6   ,B6

      602     7714    2         %KV_RCRLST.MAXRCR = TEMP;

   7714   1 00072E  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000730  E847 003D                            LDR,R6   TEMP,AUTO
          1 000732  EF46 0002                            STR,R6   2,B6

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:94   
      603     7715    2         IF PRM_VDO_OPNSTR.KEYL~=0

   7715   1 000734  ECC7 0004                            LDB,B6   @PRM,AUTO
          1 000736  D2C6 0002                            LLH,R5   2,B6
          1 000738  5901 000A                            BEZ,R5   s:7717,PREL

      604     7716    2         THEN %KV_RCRLST.KEYLNG = MINIMUM(4, PRM_VDO_OPNSTR.KEYL);

   7716   1 00073A  D970 0004                            CMR,R5   4,IMO
          1 00073C  0381 0002                            BLE      s:7716+5,PREL
          1 00073E  5C04                                 LDV,R5   4
          1 00073F  DCC7 0007                            LDB,B5   KV@VDH_GETBFR+1,AUTO
          1 000741  D7C5 000B                            STH,R5   11,B5

      605     7717    2         IF PRM_VDO_OPNSTR.SPARE>1

   7717   1 000743  D846 0002                            LDR,R5   2,B6
          1 000745  D570 00FF                            AND,R5   255,IMO
          1 000747  5D01                                 CMV,R5   1
          1 000748  0381 000D                            BLE      s:7719,PREL

      606     7718    2         THEN %KV_RCRLST.SPRCNT = MINIMUM(TEMP/2, PRM_VDO_OPNSTR.SPARE);

   7718   1 00074A  6041                                 SOR,R6   1
          1 00074B  D956                                 CMR,R5   R6
          1 00074C  0281 0002                            BGE      s:7718+5,PREL
          1 00074E  E855                                 LDR,R6   R5
          1 00074F  DCC7 0007                            LDB,B5   KV@VDH_GETBFR+1,AUTO
          1 000751  EAC5 000B                            SRM,R6,'00FF'X    11,B5
          1 000753       00FF
          1 000754  0F81 000C                            B        s:7721,PREL

      607     7719    2         ELSE %KV_RCRLST.SPRCNT = MAXIMUM(TEMP/4,1);

   7719   1 000756  6042                                 SOR,R6   2
          1 000757  E970 0001                            CMR,R6   1,IMO
          1 000759  0281 0002                            BGE      s:7719+6,PREL
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:95   
          1 00075B  6C01                                 LDV,R6   1
          1 00075C  DCC7 0007                            LDB,B5   KV@VDH_GETBFR+1,AUTO
          1 00075E  EAC5 000B                            SRM,R6,'00FF'X    11,B5
          1 000760       00FF

      608     7720    2      END;

      609     7721    1      %KV_MVD.ORG = PRM_VDO_OPNSTR.ORG;

   7721   1 000761  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000764  DCC6 0006                            LDB,B5   6,B6
          1 000766  CCC7 0004                            LDB,B4   @PRM,AUTO
          1 000768  E2C4 0001                            LLH,R6   1,B4
          1 00076A  E7C5 0015                            STH,R6   21,B5

      610     7722
      611     7723        /* Set up the set-parameter request structure for setting the                 */
      612     7724        /* system input function table associated with the forms virtual              */
      613     7725        /* device to "FRM1".                                                          */
      614     7726
      615     7727    2      DO SELECT KV@VDH_GETBFR.STRTYP;

   7727   1 00076C  E2C7 000C                            LLH,R6   KV@VDH_GETBFR+6,AUTO
          1 00076E  E970 0022                            CMR,R6   34,IMO
          1 000770  0201 0008                            BL       s:7727+13,PREL
          1 000772  0901 002B                            BE       s:7734,PREL
          1 000774  6D24                                 CMV,R6   36
          1 000775  0981 0030                            BNE      s:7736,PREL
          1 000777  0F81 0011                            B        s:7731,PREL
          1 000779  6D09                                 CMV,R6   9
          1 00077A  0981 002B                            BNE      s:7736,PREL
          1 00077C  0F81 0001                            B        s:7729,PREL

      616     7728    2         SELECT %KV_STRTYP_LINLST;

      617     7729    2         ADDR(KV@SND_CNC)->CHR8 = 'FRM1';

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:96   
   7729   1 00077E  DB80 0000 0000  00                   LAB,B5   KV_RCRLST
          1 000781  0021                                 ALR      ;
          1 000782       4405 001D                                ALPHANUM(29,B5,,4),;
          1 000784       4807 0019                                ALPHANUM(KV@SND_CNC,AUTO,,8,FILL)
          1 000786  437F                                 CSYNC    s:7729+7,SPREL
          1 000787  0F81 001E                            B        s:7736,PREL

      618     7730    2         SELECT %KV_STRTYP_RCRLST;

      619     7731    2         ADDR(KV@SND_CNC)->CHR8 = 'SE1';

   7731   1 000789  DB80 0000 0000  00                   LAB,B5   KV_RCRLST
          1 00078C  0021                                 ALR      ;
          1 00078D       4305 001F                                ALPHANUM(31,B5,,3),;
          1 00078F       4807 0019                                ALPHANUM(KV@SND_CNC,AUTO,,8,FILL)

      620     7732    2         IF PRM_VDO_OPNSTR.SPARE>99 THEN SUBSTR(ADDR(KV@SND_CNC)->CHR8,2,1) = '2';

   7732   1 000791  437F                                 CSYNC    s:7731+7,SPREL
          1 000792  D844 0002                            LDR,R5   2,B4
          1 000794  D570 00FF                            AND,R5   255,IMO
          1 000796  5D63                                 CMV,R5   99
          1 000797  0381 000E                            BLE      s:7736,PREL

   7732   1 000799  4C32                                 LDV,R4   50
          1 00079A  C7C7 001A                            STH,R4   KV@SND_CNC+1,AUTO
          1 00079C  0F81 0009                            B        s:7736,PREL

      621     7733    2         SELECT %KV_STRTYP_X364;

      622     7734    2         ADDR(KV@SND_CNC)->CHR8 = 'X364';

   7734   1 00079E  DB80 0000 0000  00                   LAB,B5   KV_RCRLST
          1 0007A1  0021                                 ALR      ;
          1 0007A2       4405 0021                                ALPHANUM(33,B5,,4),;
          1 0007A4       4807 0019                                ALPHANUM(KV@SND_CNC,AUTO,,8,FILL)

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:97   
      623     7735    2      END; /* END DO SELECT .STRTYP */

      624     7736    1      KV@VDH_SETPRM.VAL_.ADR$ = ADDR(KV@SND_CNC);

   7736   1 0007A6  DBC7 0019                            LAB,B5   KV@SND_CNC,AUTO
          1 0007A8  DFC7 0014                            STB,B5   KV@VDH_SETPRM+3,AUTO

      625     7737    1      KV@VDH_SETPRM.VAL_.BYTSIZ = 8;

   7737   1 0007AA  5C08                                 LDV,R5   8
          1 0007AB  DF47 0017                            STR,R5   KV@VDH_SETPRM+6,AUTO

      626     7738    1      KV@VDH_SETPRM.PRMID = %KV_PRMID_FCNTBL;

   7738   1 0007AD  4C7D                                 LDV,R4   125
          1 0007AE  CF47 0012                            STR,R4   KV@VDH_SETPRM+1,AUTO

      627     7739    1      CALL KVP$SETPRM(KV@VDH_SETPRM) ;

   7739   1 0007B0  BBC7 0011                            LAB,B3   KV@VDH_SETPRM,AUTO
          1 0007B2  437F                                 CSYNC    s:7739+1,SPREL
          1 0007B3  BFC7 0048                            STB,B3   @Y@SHRBFR+2,AUTO
          1 0007B5  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0007B7  CBF0 0100                            LAB,B4   256,IMO
          1 0007B9  E380 0000 0000  xent                 LNJ,B6   KVP$SETPRM
          1 0007BC       0001                            DC       s:7740,PREL

      628     7740    2      IF %KV_MVD.RETYPOVR THEN DO;

   7740   1 0007BD  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0007C0  DCC6 0006                            LDB,B5   6,B6
          1 0007C2  82C5 0016                            LB,'0080'X        22,B5
          1 0007C4       0080
          1 0007C5  0581 0012                            BBF      s:7745,PREL

      629     7741    2         IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN CALL KVC$DRWBRD;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:98   
   7741   1 0007C7  E2C5 0015                            LLH,R6   21,B5
          1 0007C9  6D04                                 CMV,R6   4
          1 0007CA  0981 0007                            BNE      s:7743,PREL

   7741   1 0007CC  CBF0 0000                            LAB,B4   0,IMO
          1 0007CE  E380 0000 0000  xent                 LNJ,B6   KVC$DRWBRD
          1 0007D1       0001                            DC       s:7743,PREL

      630     7742        /* Get rid of any borders for ORG=FORM */
      631     7743    2         CALL KVO$ERSSRD;

   7743   1 0007D2  CBF0 0000                            LAB,B4   0,IMO
          1 0007D4  E380 0000 0000  xent                 LNJ,B6   KVO$ERSSRD
          1 0007D7       0001                            DC       s:7745,PREL

      632     7744    2      END;

      633     7745    1      IF PRM_VDO_OPNSTR.ORG~=%KV#VD_ORG_X364 AND %KV_SSN.LSTEDTBFRSTRID=%KV_STR.ID

   7745   1 0007D8  ECC7 0004                            LDB,B6   @PRM,AUTO
          1 0007DA  E2C6 0001                            LLH,R6   1,B6
          1 0007DC  6D02                                 CMV,R6   2
          1 0007DD  0901 0012                            BE       s:7747,PREL
          1 0007DF  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0007E2  CCC5 0002                            LDB,B4   2,B5
          1 0007E4  BCC5 0004                            LDB,B3   4,B5
          1 0007E6  D2C4 0026                            LLH,R5   38,B4
          1 0007E8  C2C3 001C                            LLH,R4   28,B3
          1 0007EA  D954                                 CMR,R5   R4
          1 0007EB  0981 0004                            BNE      s:7747,PREL

      634     7746    1      THEN %KV_SSN.LSTEDTBFRSTRID = 1;

   7746   1 0007ED  3C01                                 LDV,R3   1
          1 0007EE  B7C4 0026                            STH,R3   38,B4

      635     7747    1      RETURN;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:99   

   7747   1 0007F0  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      636     7748        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:100  
      637     7749    1   Y$GETSTR: PROC(ID) ALTRET;

   7749   1 0007F3  EFC7 003E            Y$GETSTR        STB,B6   TEMP+1,AUTO

      638     7750        /* Gets a stream structure (KV$STR)                                           */
      639     7751    2   DCL ID UBIN;
      640     7752    2   DCL KV_SHRBFR_PRM1 UBIN SYMREF;
      641     7753    2   DCL KV_SHRBFR_PRM2 UBIN SYMREF;
      642     7754    2   DCL KV_SHRBFR_PRM3 UBIN SYMREF;
      643     7755    2   DCL PRMPTRS(0:3) PTR CONSTANT
      644     7756    2    INIT(ADDR(KV_SHRBFR_PRM1)*2,ADDR(KV_SHRBFR_PRM2),ADDR(KV_SHRBFR_PRM3));
      645     7757        /* Reports get-structure event to user                                        */
      646     7758
      647     7759        /* LOCAL                                                                      */
      648     7760
      649     7761        %KV$USR_EVT(NAME = KV@USR_EVT, STCLASS = AUTO);
      650     7796        %KV$USR_EVT(NAME = KV_USR_EVT, STCLASS = "SYMREF READONLY");
      651     7831        %KV$STR (NAME=Y@STR, STCLASS="BASED(KV@VDH_GETBFR.BFR$)");
      652     7918
      653     7919    2      KV@VDH_GETBFR.STRTYP = %KV_STRTYP_STR;

   7919   1 0007F5  6C16                                 LDV,R6   22
          1 0007F6  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      654     7920    3      CALL KVS$GETBFR(KV@VDH_GETBFR) WHENALTRETURN DO; ALTRETURN; END;

   7920   1 0007F8  DBC7 0006                            LAB,B5   KV@VDH_GETBFR,AUTO
          1 0007FA  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 0007FC  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0007FE  CBF0 0100                            LAB,B4   256,IMO
          1 000800  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 000803       0003                            DC       s:7920+14,PREL
          1 000804  0F81 0005                            B        s:7922,PREL

   7920   1 000806  ECC7 003E                            LDB,B6   TEMP+1,AUTO
          1 000808  B806                                 LDR,R3   ,B6
          1 000809  C3B6                                 LNJ,B4   ,B6,R3
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:101  

      655     7921
      656     7922    3      IF KV$PTR.STR$~=ADDR(NIL) THEN DO;

   7922   1 00080A  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00080D  8DC6 0004                            CMN      4,B6
          1 00080F  0901 0049                            BE       s:7934,PREL

      657     7923    3         Y@STR.ACTONTRN = %KV_STR.ACTONTRN;

   7923   1 000811  DCC6 0004                            LDB,B5   4,B6
          1 000813  E845 001C                            LDR,R6   28,B5
          1 000815  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 000817  EAC4 001C                            SRM,R6,'0080'X    28,B4
          1 000819       0080

      658     7924    3         Y@STR.AUTTABCLM = %KV_STR.AUTTABCLM;

   7924   1 00081A  DCC6 0004                            LDB,B5   4,B6
          1 00081C  E2C5 001E                            LLH,R6   30,B5
          1 00081E  E7C4 001E                            STH,R6   30,B4

      659     7925    3         Y@STR.WRDWRPCLM = %KV_STR.WRDWRPCLM;

   7925   1 000820  DCC6 0004                            LDB,B5   4,B6
          1 000822  E2C5 001D                            LLH,R6   29,B5
          1 000824  E7C4 001D                            STH,R6   29,B4

      660     7926    3         Y@STR.WRDWRP = %KV_STR.WRDWRP;

   7926   1 000826  DCC6 0004                            LDB,B5   4,B6
          1 000828  E845 001E                            LDR,R6   30,B5
          1 00082A  EAC4 001E                            SRM,R6,'0040'X    30,B4
          1 00082C       0040

      661     7927    3         Y@STR.OTPTAB$ = %KV_STR.OTPTAB$;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:102  
   7927   1 00082D  DCC6 0004                            LDB,B5   4,B6
          1 00082F  BCC5 0006                            LDB,B3   6,B5
          1 000831  BFC4 0006                            STB,B3   6,B4

      662     7928    3         CALL Y$INCSHRBFR (Y@STR.OTPTAB$->KV$SHRBFR);

   7928   1 000833  DCC7 0007                            LDB,B5   KV@VDH_GETBFR+1,AUTO
          1 000835  CCC5 0006                            LDB,B4   6,B5
          1 000837  CFC7 0046                            STB,B4   KV@USR_EVT+4,AUTO
          1 000839  E3C0 01A5                            LNJ,B6   s:0,PREL
          1 00083B       0001                            DC       s:7929,PREL

      663     7929    3         Y@STR.LFTMRGCLM = %KV_STR.LFTMRGCLM;

   7929   1 00083C  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00083F  DCC6 0004                            LDB,B5   4,B6
          1 000841  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 000843  E845 001A                            LDR,R6   26,B5
          1 000845  EF44 001A                            STR,R6   26,B4

      664     7930    3         Y@STR.LNK$ = %KV_SSN.STR$->KV$STR.LNK$;

   7930   1 000847  DCC6 0002                            LDB,B5   2,B6
          1 000849  BCC5 0004                            LDB,B3   4,B5
          1 00084B  ACC3 0002                            LDB,B2   2,B3
          1 00084D  AFC4 0002                            STB,B2   2,B4

      665     7931    3         %KV_SSN.STR$->KV$STR.LNK$ = KV@VDH_GETBFR.BFR$;

   7931   1 00084F  DCC6 0002                            LDB,B5   2,B6
          1 000851  CCC5 0004                            LDB,B4   4,B5
          1 000853  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 000855  BFC4 0002                            STB,B3   2,B4

      666     7932    3      END;

   7932   1 000857  0F81 0007                            B        s:7936,PREL
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:103  

      667     7933    3      ELSE DO;

      668     7934    3         %KV_SSN.STR$ = KV@VDH_GETBFR.BFR$;

   7934   1 000859  DCC6 0002                            LDB,B5   2,B6
          1 00085B  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 00085D  CFC5 0004                            STB,B4   4,B5

      669     7935    3      END;

      670     7936    2      Y@STR.SSN$ = KV$PTR.SSN$;

   7936   1 00085F  DCC6 0002                            LDB,B5   2,B6
          1 000861  CCC7 0007                            LDB,B4   KV@VDH_GETBFR+1,AUTO
          1 000863  DF84                                 STB,B5   ,B4

      671     7937    2      Y@STR.ID = ID;

   7937   1 000864  ECC7 0040                            LDB,B6   @ID,AUTO
          1 000866  E806                                 LDR,R6   ,B6
          1 000867  DCC7 0007                            LDB,B5   KV@VDH_GETBFR+1,AUTO
          1 000869  E7C5 001C                            STH,R6   28,B5

      672     7938    2      Y@STR.MVD$ = KV$PTR.MVD$;

   7938   1 00086B  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 00086E  BCC4 0006                            LDB,B3   6,B4
          1 000870  BFC5 0004                            STB,B3   4,B5

      673     7939    2      KV$PTR.STR$ = KV@VDH_GETBFR.BFR$;

   7939   1 000872  DCC7 0007                            LDB,B5   KV@VDH_GETBFR+1,AUTO
          1 000874  DFC4 0004                            STB,B5   4,B4

      674     7940    2      %KV_MVD.USRCNT = %KV_MVD.USRCNT+1;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:104  
   7940   1 000876  BCC4 0006                            LDB,B3   6,B4
          1 000878  8AC3 0012                            INC      18,B3

      675     7941    2      IF ID<4 THEN Y@STR.PRM$ = PRMPTRS(ID);

   7941   1 00087A  E806                                 LDR,R6   ,B6
          1 00087B  6D04                                 CMV,R6   4
          1 00087C  0281 0009                            BGE      s:7941+12,PREL

   7941   1 00087E  B856                                 LDR,R3   R6
          1 00087F  DCB0 0000 0012  00                   LDB,B5   PRMPTRS,R3
          1 000882  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 000884  DFC3 0008                            STB,B5   8,B3
          1 000886  0F81 0003                            B        s:7948,PREL

      676     7942
      677     7943    2   CALUSRGETSTR: ENTRY ALTRET;

   7943   1 000888  EFC7 003E            CALUSRGETSTR    STB,B6   TEMP+1,AUTO

      678     7944        /* Reports get-structure event to user                                        */
      679     7945
      680     7946        /* CHECK TO SEE IF USER WANTS EVENT FOR PARTICULAR STRUCTURE                  */
      681     7947
      682     7948    3      IF %KV_USRPRM.STREVTENB(KV@VDH_GETBFR.STRTYP) THEN DO;

   7948   1 00088A  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00088D  DC86                                 LDB,B5   ,B6
          1 00088E  CCC5 0008                            LDB,B4   8,B5
          1 000890  BBC4 002B                            LAB,B3   43,B4
          1 000892  B2C7 000C                            LLH,R3   KV@VDH_GETBFR+6,AUTO
          1 000894  82B3                                 LB       ,B3,R3
          1 000895  0581 0018                            BBF      s:7956,PREL

      683     7949
      684     7950        /* WE MUST TELL THE USER                                                      */
      685     7951    3         KV@USR_EVT = KV_USR_EVT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:105  

   7951   1 000897  8C80 0000 0000  xsym                 LDI      KV_USR_EVT
          1 00089A  8D47 0042                            SDI      KV@USR_EVT,AUTO

      686     7952    3         KV@USR_EVT.ID = %KV_USR_EVT_ID_GETSTR;

   7952   1 00089C  5C06                                 LDV,R5   6
          1 00089D  DAC7 0042                            SRM,R5,'007F'X    KV@USR_EVT,AUTO
          1 00089F       007F

      687     7953    3         KV@USR_EVT.PRM = KV@VDH_GETBFR.STRTYP;

   7953   1 0008A0  BF47 0043                            STR,R3   KV@USR_EVT+1,AUTO

      688     7954    3         CALL KVV$CALUSR_EVT (KV@USR_EVT);

   7954   1 0008A2  DBC7 0042                            LAB,B5   KV@USR_EVT,AUTO
          1 0008A4  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 0008A6  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0008A8  CBF0 0100                            LAB,B4   256,IMO
          1 0008AA  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_EVT
          1 0008AD       0001                            DC       s:7956,PREL

      689     7955    3      END /* IF */;

      690     7956    2   END /* SUBROUTINE */;

   7956   1 0008AE  ECC7 003E                            LDB,B6   TEMP+1,AUTO
          1 0008B0  C3C6 0001                            LNJ,B4   1,B6

      691     7957        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:106  
      692     7958        /* Strip a stream of its appendages.                                          */
      693     7959
      694     7960
      695     7961    1   Y$STRSTR: PROC;

   7961   1 0008B2  EFC7 003E            Y$STRSTR        STB,B6   TEMP+1,AUTO

      696     7962
      697     7963        /* Release the prompt buffer.                                                 */
      698     7964
      699     7965    2      %VDH_RLSBFR.BFR$ = %KV_STR.PRM$;

   7965   1 0008B4  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0008B7  CCC5 0004                            LDB,B4   4,B5
          1 0008B9  BCC4 0008                            LDB,B3   8,B4
          1 0008BB  BFC7 0007                            STB,B3   KV@VDH_GETBFR+1,AUTO

      700     7966    2      %VDH_RLSBFR.STRTYP = %KV_STRTYP_PRM;

   7966   1 0008BD  6C0F                                 LDV,R6   15
          1 0008BE  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      701     7967    2      CALL KVS$RLSBFR(%VDH_RLSBFR);

   7967   1 0008C0  CBC7 0006                            LAB,B4   KV@VDH_GETBFR,AUTO
          1 0008C2  CFC7 0048                            STB,B4   @Y@SHRBFR+2,AUTO
          1 0008C4  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0008C6  CBF0 0100                            LAB,B4   256,IMO
          1 0008C8  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 0008CB       0001                            DC       s:7968,PREL

      702     7968    2      %KV_STR.PRM$ = ADDR(NIL);

   7968   1 0008CC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0008CF  DCC6 0004                            LDB,B5   4,B6
          1 0008D1  CB80 0000 0000                       LAB,B4   0
          1 0008D4  CFC5 0008                            STB,B4   8,B5
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:107  

      703     7969
      704     7970        /* Release the edit buffer, if there is one.                                  */
      705     7971
      706     7972    2      %VDH_RLSBFR.STRTYP = %KV_STRTYP_REDBFR;

   7972   1 0008D6  6C11                                 LDV,R6   17
          1 0008D7  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      707     7973    2      %VDH_RLSBFR.BFR$ = %KV_STR.EDTBFR__.ADR$;

   7973   1 0008D9  DCC6 0004                            LDB,B5   4,B6
          1 0008DB  CCC5 000C                            LDB,B4   12,B5
          1 0008DD  CFC7 0007                            STB,B4   KV@VDH_GETBFR+1,AUTO

      708     7974    2      %VDH_RLSBFR.BYTSIZ = %KV_STR.EDTBFR__.BFRBYTSIZ;

   7974   1 0008DF  DCC6 0004                            LDB,B5   4,B6
          1 0008E1  D845 0010                            LDR,R5   16,B5
          1 0008E3  DF47 0009                            STR,R5   KV@VDH_GETBFR+3,AUTO

      709     7975    2      IF %KV_STR.EDTBFR__.BFRRLSDSP~=%KV_BFRRLSDSP_NON

   7975   1 0008E5  DCC6 0004                            LDB,B5   4,B6
          1 0008E7  82C5 0011                            LB,'00FF'X        17,B5
          1 0008E9       00FF
          1 0008EA  0581 000D                            BBF      s:7977,PREL

      710     7976    2      THEN CALL KVS$RLSBFR(%VDH_RLSBFR);

   7976   1 0008EC  BBC7 0006                            LAB,B3   KV@VDH_GETBFR,AUTO
          1 0008EE  BFC7 0048                            STB,B3   @Y@SHRBFR+2,AUTO
          1 0008F0  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0008F2  CBF0 0100                            LAB,B4   256,IMO
          1 0008F4  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 0008F7       0001                            DC       s:7977,PREL

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:108  
      711     7977    2      %KV_STR.EDTBFR__ = '0'B;

   7977   1 0008F8  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0008FB  DCC6 0004                            LDB,B5   4,B6
          1 0008FD  5C0C                                 LDV,R5   12
          1 0008FE  0021                                 ALR      ;
          1 0008FF       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 000901       4005 000C                                ALPHANUM(12,B5,,R5,FILL)

      712     7978
      713     7979        /* strip activation character set                                             */
      714     7980
      715     7981    2      %VDH_RLSBFR.STRTYP = %KV_STRTYP_ACTCHR;

   7981   1 000903  6C01                                 LDV,R6   1
          1 000904  437F                                 CSYNC    s:7981,SPREL
          1 000905  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      716     7982    2      %VDH_RLSBFR.BFR$ = %KV_STR.ACTCHRTBL$;

   7982   1 000907  DCC6 0004                            LDB,B5   4,B6
          1 000909  CCC5 000A                            LDB,B4   10,B5
          1 00090B  CFC7 0007                            STB,B4   KV@VDH_GETBFR+1,AUTO

      717     7983    2      CALL KVS$RLSBFR(%VDH_RLSBFR);

   7983   1 00090D  DBC7 0006                            LAB,B5   KV@VDH_GETBFR,AUTO
          1 00090F  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 000911  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 000913  CBF0 0100                            LAB,B4   256,IMO
          1 000915  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 000918       0001                            DC       s:7984,PREL

      718     7984    2      %KV_STR.ACTCHRTBL$ = ADDR(NIL);

   7984   1 000919  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00091C  DCC6 0004                            LDB,B5   4,B6
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:109  
          1 00091E  CB80 0000 0000                       LAB,B4   0
          1 000921  CFC5 000A                            STB,B4   10,B5

      719     7985    2      %VDH_RLSBFR.STRTYP = %KV_STRTYP_OTPTAB;

   7985   1 000923  6C0D                                 LDV,R6   13
          1 000924  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      720     7986    2      %VDH_RLSBFR.BFR$ = %KV_STR.OTPTAB$;

   7986   1 000926  DCC6 0004                            LDB,B5   4,B6
          1 000928  CCC5 0006                            LDB,B4   6,B5
          1 00092A  CFC7 0007                            STB,B4   KV@VDH_GETBFR+1,AUTO

      721     7987    2      %KV_STR.OTPTAB$ = ADDR(NIL);

   7987   1 00092C  DCC6 0004                            LDB,B5   4,B6
          1 00092E  BB80 0000 0000                       LAB,B3   0
          1 000931  BFC5 0006                            STB,B3   6,B5

      722     7988    2      CALL KVS$RLSBFR(%VDH_RLSBFR);

   7988   1 000933  DBC7 0006                            LAB,B5   KV@VDH_GETBFR,AUTO
          1 000935  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 000937  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 000939  CBF0 0100                            LAB,B4   256,IMO
          1 00093B  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 00093E       0001                            DC       s:7990,PREL

      723     7989
      724     7990    2   END /* SUBROUTINE */;

   7990   1 00093F  ECC7 003E                            LDB,B6   TEMP+1,AUTO
          1 000941  C3C6 0001                            LNJ,B4   1,B6

      725     7991        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:110  
      726     7992    1   Y$GETMVD: PROC ALTRET;

   7992   1 000943  EFC7 003E            Y$GETMVD        STB,B6   TEMP+1,AUTO

      727     7993        %KV$MVD (NAME=Y@MVD, STCLASS="BASED(KV@VDH_GETBFR.BFR$)");
      728     8037
      729     8038    2      KV@VDH_GETBFR.STRTYP = %KV_STRTYP_MVD;

   8038   1 000945  6C0C                                 LDV,R6   12
          1 000946  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      730     8039    2      CALL KVS$GETBFR (KV@VDH_GETBFR)

   8039   1 000948  DBC7 0006                            LAB,B5   KV@VDH_GETBFR,AUTO
          1 00094A  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 00094C  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 00094E  CBF0 0100                            LAB,B4   256,IMO
          1 000950  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 000953       0003                            DC       s:8045,PREL
          1 000954  0F81 0005                            B        s:8047,PREL

      731     8040    3      WHENALTRETURN DO;

      732     8041
      733     8042        /* We got an error return on the request to get memory for the                */
      734     8043        /* KV$MVD structure.                                                          */
      735     8044
      736     8045    3         ALTRETURN;

   8045   1 000956  ECC7 003E                            LDB,B6   TEMP+1,AUTO
          1 000958  B806                                 LDR,R3   ,B6
          1 000959  C3B6                                 LNJ,B4   ,B6,R3

      737     8046    3      END /* IF */;
      738     8047    2      Y@MVD = %KV_MVD;                     /* Initialize from the current one.   */

   8047   1 00095A  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:111  
          1 00095D  DCC6 0006                            LDB,B5   6,B6
          1 00095F  AB85                                 LAB,B2   ,B5
          1 000960  2C00                                 LDV,R2   0
          1 000961  6C40                                 LDV,R6   64
          1 000962  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 000964  3C00                                 LDV,R3   0
          1 000965  0008                                 MMM

      739     8048    2      %KV_MVD.USRCNT = %KV_MVD.USRCNT-1;

   8048   1 000966  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000969  CCC6 0006                            LDB,B4   6,B6
          1 00096B  88C4 0012                            DEC      18,B4

      740     8049    2      %KV_STR.MVD$ = KV@VDH_GETBFR.BFR$;

   8049   1 00096D  CCC6 0004                            LDB,B4   4,B6
          1 00096F  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 000971  BFC4 0004                            STB,B3   4,B4

      741     8050    2      Y@MVD.SRD$ = KV$PTR.SRD$;

   8050   1 000973  CCC6 000A                            LDB,B4   10,B6
          1 000975  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 000977  CF83                                 STB,B4   ,B3

      742     8051    2      %KV_SRD.USRCNT = %KV_SRD.USRCNT+1;

   8051   1 000978  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00097B  CCC6 000A                            LDB,B4   10,B6
          1 00097D  8AC4 0006                            INC      6,B4

      743     8052    2      Y@MVD.LNK$ = %KV_MRD.MVD$;

   8052   1 00097F  CCC6 0008                            LDB,B4   8,B6
          1 000981  BCC4 000D                            LDB,B3   13,B4
          1 000983  9CC7 0007                            LDB,B1   KV@VDH_GETBFR+1,AUTO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:112  
          1 000985  BFC1 0002                            STB,B3   2,B1

      744     8053    2      %KV_MRD.MVD$ = KV@VDH_GETBFR.BFR$;

   8053   1 000987  CCC6 0008                            LDB,B4   8,B6
          1 000989  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 00098B  BFC4 000D                            STB,B3   13,B4

      745     8054    2      Y@MVD.ORG = %KV#VD_ORG_UR;

   8054   1 00098D  6C01                                 LDV,R6   1
          1 00098E  E7C3 0015                            STH,R6   21,B3

      746     8055    2      Y@MVD.USRCNT = 1;

   8055   1 000990  EF43 0012                            STR,R6   18,B3

      747     8056    2      Y@MVD.LINLST$ = ADDR(NIL);

   8056   1 000992  CB80 0000 0000                       LAB,B4   0
          1 000995  CFC3 0010                            STB,B4   16,B3

      748     8057    2      Y@MVD.PAGBRKPND = '0'B;

   8057   1 000997  8843 0016                            LBF,'0001'X       22,B3
   8057   1 000999       0001

      749     8058    2      Y@MVD.FRMSCNINH = '0'B;

   8058   1 00099A  8843 0016                            LBF,'0010'X       22,B3
   8058   1 00099C       0010

      750     8059    2      CALL Y$INCSHRBFR (Y@MVD.INPTAB$->KV$SHRBFR);

   8059   1 00099D  9CC3 0004                            LDB,B1   4,B3
          1 00099F  9FC7 0046                            STB,B1   KV@USR_EVT+4,AUTO
          1 0009A1  E3C0 003D                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:113  
          1 0009A3       0001                            DC       s:8060,PREL

      751     8060    2      Y@MVD.INPFNCCPY = '11'B;

   8060   1 0009A4  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 0009A6  8946 001F                            LBT,'0060'X       31,B6
          1 0009A8       0060

      752     8061    2      CALL Y$INCSHRBFR (Y@MVD.USRINPFNCTBL$->KV$SHRBFR);

   8061   1 0009A9  DCC6 0008                            LDB,B5   8,B6
          1 0009AB  DFC7 0046                            STB,B5   KV@USR_EVT+4,AUTO
          1 0009AD  E3C0 0031                            LNJ,B6   s:0,PREL
          1 0009AF       0001                            DC       s:8062,PREL

      753     8062    2      CALL Y$INCSHRBFR (Y@MVD.SSTINPFNCTBL$->KV$SHRBFR);

   8062   1 0009B0  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 0009B2  DCC6 000A                            LDB,B5   10,B6
          1 0009B4  DFC7 0046                            STB,B5   KV@USR_EVT+4,AUTO
          1 0009B6  E3C0 0028                            LNJ,B6   s:0,PREL
          1 0009B8       0001                            DC       s:8063,PREL

      754     8063    2      CALL Y$INCSHRBFR (Y@MVD.VFU$->KV$SHRBFR);

   8063   1 0009B9  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 0009BB  DCC6 000C                            LDB,B5   12,B6
          1 0009BD  DFC7 0046                            STB,B5   KV@USR_EVT+4,AUTO
          1 0009BF  E3C0 001F                            LNJ,B6   s:0,PREL
          1 0009C1       0001                            DC       s:8064,PREL

      755     8064    2      CALL Y$INCSHRBFR (Y@MVD.TRNTBL$->KV$SHRBFR);

   8064   1 0009C2  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 0009C4  DCC6 000E                            LDB,B5   14,B6
          1 0009C6  DFC7 0046                            STB,B5   KV@USR_EVT+4,AUTO
          1 0009C8  E3C0 0016                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:114  
          1 0009CA       0001                            DC       s:8065,PREL

      756     8065    2      CALL Y$INCSHRBFR (Y@MVD.DCBHDN$->KV$SHRBFR);

   8065   1 0009CB  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 0009CD  DCC6 0006                            LDB,B5   6,B6
          1 0009CF  DFC7 0046                            STB,B5   KV@USR_EVT+4,AUTO
          1 0009D1  E3C0 000D                            LNJ,B6   s:0,PREL
          1 0009D3       0001                            DC       s:8067,PREL

      757     8066
      758     8067    2      KV$PTR.MVD$ = KV@VDH_GETBFR.BFR$;

   8067   1 0009D4  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 0009D6  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0009D9  EFC5 0006                            STB,B6   6,B5

      759     8068
      760     8069    2   END /* SUBROUTINE */;

   8069   1 0009DB  ECC7 003E                            LDB,B6   TEMP+1,AUTO
          1 0009DD  C3C6 0001                            LNJ,B4   1,B6

      761     8070        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:115  
      762     8071    1   Y$INCSHRBFR: PROC(Y@SHRBFR);

   8071   1 0009DF  EFC7 0044            Y$INCSHRBFR     STB,B6   KV@USR_EVT+2,AUTO

      763     8072        %KV$SHRBFR (NAME=Y@SHRBFR, STCLASS=);
      764     8104
      765     8105    2      IF ADDR(Y@SHRBFR)~=ADDR(NIL)

   8105   1 0009E1  DCC7 0046                            LDB,B5   @Y@SHRBFR,AUTO
          1 0009E3  8DD5                                 CMN      B5
          1 0009E4  0901 0009                            BE       s:8108,PREL

      766     8106    2      THEN IF Y@SHRBFR.USRCNT~=%KV_SHRBFR_CNSUSRCNT

   8106   1 0009E6  E845 0003                            LDR,R6   3,B5
          1 0009E8  E970 7FFF                            CMR,R6   32767,IMO
          1 0009EA  0901 0003                            BE       s:8108,PREL

      767     8107    2      THEN Y@SHRBFR.USRCNT = Y@SHRBFR.USRCNT+1;

   8107   1 0009EC  8AC5 0003                            INC      3,B5

      768     8108    2   END Y$INCSHRBFR;

   8108   1 0009EE  ECC7 0044                            LDB,B6   KV@USR_EVT+2,AUTO
          1 0009F0  C3C6 0001                            LNJ,B4   1,B6

      769     8109        %EJECT;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:116  
      770     8110    1   Y$GETSRD: PROC ALTRET;

   8110   1 0009F2  EFC7 003E            Y$GETSRD        STB,B6   TEMP+1,AUTO

      771     8111
      772     8112        /* Get a new subordinate real device.                                           */
      773     8113
      774     8114        %KV$SRD (NAME=Y@SRD, STCLASS="BASED(KV@VDH_GETBFR.BFR$)");
      775     8389
      776     8390    2      KV@VDH_GETBFR.STRTYP = %KV_STRTYP_SRD;

   8390   1 0009F4  6C12                                 LDV,R6   18
          1 0009F5  E7C7 000C                            STH,R6   KV@VDH_GETBFR+6,AUTO

      777     8391    2      CALL KVS$GETBFR(KV@VDH_GETBFR)

   8391   1 0009F7  DBC7 0006                            LAB,B5   KV@VDH_GETBFR,AUTO
          1 0009F9  DFC7 0048                            STB,B5   @Y@SHRBFR+2,AUTO
          1 0009FB  BBC7 0048                            LAB,B3   @Y@SHRBFR+2,AUTO
          1 0009FD  CBF0 0100                            LAB,B4   256,IMO
          1 0009FF  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 000A02       0003                            DC       s:8397,PREL
          1 000A03  0F81 0005                            B        s:8399,PREL

      778     8392    3      WHENALTRETURN DO;

      779     8393
      780     8394        /* We got an error return on the request to get memory for the                */
      781     8395        /* KV$SRD structure.                                                          */
      782     8396
      783     8397    3         ALTRETURN;

   8397   1 000A05  ECC7 003E                            LDB,B6   TEMP+1,AUTO
          1 000A07  B806                                 LDR,R3   ,B6
          1 000A08  C3B6                                 LNJ,B4   ,B6,R3

      784     8398    3      END /* IF */;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:117  
      785     8399    2      IF PRM_WINDOW.FWINDOW$=ADDR(NIL)

   8399   1 000A09  ECC7 0004                            LDB,B6   @PRM,AUTO
          1 000A0B  8D86                                 CMN      ,B6
          1 000A0C  0981 0007                            BNE      s:8401,PREL

      786     8400    2      THEN PRM_WINDOW.FWINDOW$ = KV$PTR.SRD$;

   8400   1 000A0E  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000A11  CCC5 000A                            LDB,B4   10,B5
          1 000A13  CF86                                 STB,B4   ,B6

      787     8401    2      Y@SRD = PRM_WINDOW.FWINDOW$->Y@SRD;

   8401   1 000A14  DC86                                 LDB,B5   ,B6
          1 000A15  AB85                                 LAB,B2   ,B5
          1 000A16  2C00                                 LDV,R2   0
          1 000A17  6C3E                                 LDV,R6   62
          1 000A18  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 000A1A  3C00                                 LDV,R3   0
          1 000A1B  0008                                 MMM

      788     8402    2      Y@SRD.LNK$ = %KV_MRD.SRD$;

   8402   1 000A1C  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 000A1F  BCC4 0008                            LDB,B3   8,B4
          1 000A21  9CC3 0002                            LDB,B1   2,B3
          1 000A23  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000A25  9FC6 0002                            STB,B1   2,B6

      789     8403    2      %KV_MRD.SRD$ = KV@VDH_GETBFR.BFR$;

   8403   1 000A27  ECC4 0008                            LDB,B6   8,B4
          1 000A29  BCC7 0007                            LDB,B3   KV@VDH_GETBFR+1,AUTO
          1 000A2B  BFC6 0002                            STB,B3   2,B6

      790     8404    2      %KV_MRD.USRCNT = %KV_MRD.USRCNT+1;
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:118  

   8404   1 000A2D  ECC4 0008                            LDB,B6   8,B4
          1 000A2F  E846 000A                            LDR,R6   10,B6
          1 000A31  EA70 0001                            ADD,R6   1,IMO
          1 000A33  EAC6 000A                            SRM,R6,'00FF'X    10,B6
          1 000A35       00FF

      791     8405    2      Y@SRD.USRCNT = 1;

   8405   1 000A36  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000A38  6C01                                 LDV,R6   1
          1 000A39  EF46 0006                            STR,R6   6,B6

      792     8406    2      %KV_SRD.USRCNT = %KV_SRD.USRCNT-1;

   8406   1 000A3B  ECC4 000A                            LDB,B6   10,B4
          1 000A3D  88C6 0006                            DEC      6,B6

      793     8407    2      Y@SRD.VRTPSTOK = '0'B;

   8407   1 000A3F  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000A41  8846 000E                            LBF,'0010'X       14,B6
          1 000A43       0010

      794     8408    2      Y@SRD.ADJTOPLFT = '0'B;

   8408   1 000A44  8846 000F                            LBF,'0008'X       15,B6
   8408   1 000A46       0008

      795     8409    3      DO CASE (PRM_WINDOW.POSITION);

   8409   1 000A47  BCC7 0004                            LDB,B3   @PRM,AUTO
          1 000A49  B2C3 0004                            LLH,R3   4,B3
          1 000A4B  3D05                                 CMV,R3   5
          1 000A4C  0281 002C                            BGE      s:8421,PREL
          1 000A4E  A830 0000 0A54  01                   LDR,R2   s:8409+13,R3
          1 000A51  83A0 0000 0A59  01                   JMP      s:8411,R2
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:119  
          1 000A54       0020                            DC       s:8421,PREL
          1 000A55       0000                            DC       s:8411,PREL
          1 000A56       0006                            DC       s:8413,PREL
          1 000A57       000C                            DC       s:8415,PREL
          1 000A58       0017                            DC       s:8418,PREL

      796     8410    3      CASE (%G_POSITION_TOP#);

      797     8411    3         Y@SRD.SRDEND.LIN = Y@SRD.ORG.LIN;

   8411   1 000A59  D846 0007                            LDR,R5   7,B6
          1 000A5B  DF46 001A                            STR,R5   26,B6
          1 000A5D  0F81 001B                            B        s:8421,PREL

      798     8412    3      CASE (%G_POSITION_LEFT#);

      799     8413    3         Y@SRD.SRDEND.CLM = Y@SRD.ORG.CLM;

   8413   1 000A5F  D846 0008                            LDR,R5   8,B6
          1 000A61  DF46 001B                            STR,R5   27,B6
          1 000A63  0F81 0015                            B        s:8421,PREL

      800     8414    3      CASE (%G_POSITION_RIGHT#);

      801     8415    3         Y@SRD.ORG.CLM = Y@SRD.SRDEND.CLM;

   8415   1 000A65  D846 001B                            LDR,R5   27,B6
          1 000A67  DF46 0008                            STR,R5   8,B6

      802     8416    3         Y@SRD.ADJTOPLFT = '1'B;

   8416   1 000A69  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000A6B  8946 000F                            LBT,'0008'X       15,B6
          1 000A6D       0008
          1 000A6E  0F81 000A                            B        s:8421,PREL

      803     8417    3      CASE (%G_POSITION_BOTTOM#);
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:120  

      804     8418    3         Y@SRD.ORG.LIN = Y@SRD.SRDEND.LIN;

   8418   1 000A70  D846 001A                            LDR,R5   26,B6
          1 000A72  DF46 0007                            STR,R5   7,B6

      805     8419    3         Y@SRD.ADJTOPLFT = '1'B;

   8419   1 000A74  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000A76  8946 000F                            LBT,'0008'X       15,B6
          1 000A78       0008

      806     8420    3      END;

      807     8421    2      Y@SRD.LNG = Y@SRD.SRDEND.LIN-Y@SRD.ORG.LIN;

   8421   1 000A79  D846 001A                            LDR,R5   26,B6
          1 000A7B  D246 0007                            SUB,R5   7,B6
          1 000A7D  D7C6 000E                            STH,R5   14,B6

      808     8422    2      Y@SRD.WDT = Y@SRD.SRDEND.CLM-Y@SRD.ORG.CLM;

   8422   1 000A7F  D846 001B                            LDR,R5   27,B6
          1 000A81  D246 0008                            SUB,R5   8,B6
          1 000A83  DF46 000D                            STR,R5   13,B6

      809     8423    2      Y@SRD.CRT.LIN = Y@SRD.TOPLFT.LIN+Y@SRD.DVCLINBIS;

   8423   1 000A85  C846 0009                            LDR,R4   9,B6
          1 000A87  CA46 0019                            ADD,R4   25,B6
          1 000A89  CF46 0015                            STR,R4   21,B6

      810     8424    2      Y@SRD.CRTVRTLINPHSLIN = Y@SRD.CRT.LIN;

   8424   1 000A8B  CF46 0013                            STR,R4   19,B6

      811     8425    2      Y@SRD.ENTSRDCHR$ = ADDR(NIL);
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:121  

   8425   1 000A8D  9B80 0000 0000                       LAB,B1   0
          1 000A90  9FC6 0004                            STB,B1   4,B6

      812     8426    2      Y@SRD.DVCLINBIS = 0;

   8426   1 000A92  ECC7 0007                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 000A94  8746 0019                            CL       25,B6

      813     8427    2      Y@SRD.TOPLFT_PST = Y@SRD.ORG_PST+%BITBIN('10001'X);

   8427   1 000A96  8CC6 0007                            LDI      7,B6
          1 000A98  8470 0001 0001                       AID      65537,IMO
          1 000A9B  8D46 0009                            SDI      9,B6

      814     8428    2      %KV_MVD.WDT = Y@SRD.WDT;

   8428   1 000A9D  9CC4 0006                            LDB,B1   6,B4
          1 000A9F  D846 000D                            LDR,R5   13,B6
          1 000AA1  DF41 0013                            STR,R5   19,B1

      815     8429    2      Y@SRD.BTMRHT = Y@SRD.SRDEND;

   8429   1 000AA3  8CC6 001A                            LDI      26,B6
          1 000AA5  8D46 000B                            SDI      11,B6

      816     8430    2      Y@SRD.BRDUPD = Y@SRD.BRDEXS;

   8430   1 000AA7  D846 000F                            LDR,R5   15,B6
          1 000AA9  5041                                 SOR,R5   1
          1 000AAA  DAC6 000F                            SRM,R5,'0010'X    15,B6
          1 000AAC       0010

      817     8431    2      Y@SRD.HI_NONBLN = Y@SRD.BTMRHT;

   8431   1 000AAD  8D46 0017                            SDI      23,B6

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:122  
      818     8432    2      Y@SRD.FLDEND = '0'B;

   8432   1 000AAF  8746 0010                            CL       16,B6
          1 000AB1  8746 0011                            CL       17,B6

      819     8433    2      KV$PTR.SRD$ = KV@VDH_GETBFR.BFR$;

   8433   1 000AB3  EFC4 000A                            STB,B6   10,B4

      820     8434    2      Y@SRD.MRD$ = KV$PTR.MRD$;

   8434   1 000AB5  9CC4 0008                            LDB,B1   8,B4
          1 000AB7  9F86                                 STB,B1   ,B6

      821     8435    2      %KV_MVD.SRD$ = KV@VDH_GETBFR.BFR$;

   8435   1 000AB8  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000ABB  CCC6 0006                            LDB,B4   6,B6
          1 000ABD  9CC7 0007                            LDB,B1   KV@VDH_GETBFR+1,AUTO
          1 000ABF  9F84                                 STB,B1   ,B4

      822     8436    2      IF %KV_MRD.USRCNT=2

   8436   1 000AC0  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000AC3  CCC6 0008                            LDB,B4   8,B6
          1 000AC5  E844 000A                            LDR,R6   10,B4
          1 000AC7  E570 00FF                            AND,R6   255,IMO
          1 000AC9  6D02                                 CMV,R6   2
          1 000ACA  0981 0010                            BNE      s:8438,PREL

      823     8437    2      THEN Y@SRD.LNK$->Y@SRD.ADJTOPLFT = ~Y@SRD.ADJTOPLFT;

   8437   1 000ACC  9CC7 0007                            LDB,B1   KV@VDH_GETBFR+1,AUTO
          1 000ACE  ECC1 0002                            LDB,B6   2,B1
          1 000AD0  E841 000F                            LDR,R6   15,B1
          1 000AD2  600C                                 SOL,R6   12
          1 000AD3  E570 8000                            AND,R6   -32768,IMO
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:123  
          1 000AD5  E670 8000                            XOR,R6   -32768,IMO
          1 000AD7  604C                                 SOR,R6   12
          1 000AD8  EAC6 000F                            SRM,R6,'0008'X    15,B6
          1 000ADA       0008

      824     8438    2   END /* SUBROUTINE */;

   8438   1 000ADB  ECC7 003E                            LDB,B6   TEMP+1,AUTO
          1 000ADD  C3C6 0001                            LNJ,B4   1,B6
      825     8439    1   END;
      826     8440        %EOD;

PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:124  
--  Include file information  --

   K_ID_E.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KV_ERRORS_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KVC$CNC.
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:125  

 **** Variables and constants ****

  ****  Section 000 RoData KVC$CNC

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(288)   r     1 KV_RCRLST
    12-0-0/w PTR         r     1 PRMPTRS(0:3)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    40-0-0/w PTR         r     1 @ID                        4-0-0/w PTR         r     1 @PRM
    46-0-0/w PTR         r     1 @Y@SHRBFR                 *0-0-0/w UBIN(16)    r     1 ID
    19-0-0/w STRC(544)   r     1 KV@SND_CNC                42-0-0/w STRC(32)    r     1 KV@USR_EVT
     6-0-0/w STRC(176)   r     1 KV@VDH_GETBFR             11-0-0/w STRC(128)   r     1 KV@VDH_SETPRM
    3B-0-0/w PTR         r     1 ORGPTR$                   *0-0-0/w ACHR        r     1 PRM
    *0-0-0/w UBIN(16)    r     1 PRM_STRID                 *0-0-0/w STRC(400)   r     1 PRM_VDH_CNC
    *0-0-0/w STRC(48)    r     1 PRM_VDO_OPNSTR            *0-0-0/w STRC(256)   r     1 PRM_WINDOW
    3D-0-0/w SBIN(16)    r     1 STEMP                     3D-0-0/w UBIN(16)    r     1 TEMP
    *0-0-0/w STRC(64)    r     1 Y@SHRBFR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w UBIN(16)    r     1 KV_ACTCHRTBLNRM
     0-0-0/w PTR         r     1 KV_B_POOL$                 0-0-0/w STRC(64)    r     1 KV_LIN
     0-0-0/w UBIN(16)    r     1 KV_SHRBFR_PRM1             0-0-0/w UBIN(16)    r     1 KV_SHRBFR_PRM2
     0-0-0/w UBIN(16)    r     1 KV_SHRBFR_PRM3             0-0-0/w STRC(544)   r     1 KV_SND_CNC
     0-0-0/w UBIN(16)    r     1 KV_SSNCNT                  0-0-0/w UBIN(16)    r     1 KV_SSNMAX
     0-0-0/w STRC(32)    r     1 KV_USR_EVT                 0-0-0/w STRC(176)   r     1 KV_VDH_GETBFR
     0-0-0/w STRC(128)   r     1 KV_VDH_SETPRM
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:126  

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(8)     r     1 CHR8                       0-0-0/w ASTR(1824)  r     1 KV$BPC
     0-0-0/w STRC(64)    r     1 KV$LIN                     0-0-0/w STRC(128)   r     1 KV$LINLST
     0-0-0/w STRC(512)   r     1 KV$MRD                     0-0-0/w STRC(512)   r     1 KV$MVD
     0-0-0/w STRC(480)   r     1 KV$PTR                     0-0-0/w STRC(288)   r     1 KV$RCRLST
     0-0-0/w STRC(64)    r     1 KV$SHRBFR                  0-0-0/w STRC(496)   r     1 KV$SRD
     0-0-0/w STRC(1024)  r     1 KV$SSN                     0-0-0/w STRC(512)   r     1 KV$STR
     0-0-0/w STRC(8960)  r     1 KV$STT                     0-0-0/w STRC(912)   r     1 KV$USRPRM
     0-0-0/w STRC(112)   r     1 KV$VDH_RLSBFR              0-0-0/w STRC(512)   r     1 KV$VDI
     0-0-0/w PTR         r     1 Y$PTR$                     0-0-0/w STRC(512)   r     1 Y@MVD
     0-0-0/w STRC(496)   r     1 Y@SRD                      0-0-0/w STRC(512)   r     1 Y@STR


   Procedure KVC$CNC requires 2783 words for executable code.
   Procedure KVC$CNC requires 74 words of local(AUTO) storage.
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:127  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:128  
          MINI XREF LISTING

BUMMER
      7465**LABEL    7319--CALLALT  7335--CALLALT  7344--CALLALT  7380--CALLALT  7389--CALLALT  7435--CALLALT
CALUSRGETSTR IN PROCEDURE Y$GETSTR
      7943**ENTRY    7253--CALL     7275--CALL     7330--CALL     7339--CALL     7352--CALL     7520--CALL
      7528--CALL
CANTGETCTX
      7467**LABEL    7230--GOTO     7247--CALLALT  7265--GOTO
CHR8
      6514**DCL      7729<<ASSIGN   7731<<ASSIGN   7732<<ASSIGN   7734<<ASSIGN
ERRXIT
      7469**LABEL    7244--GOTO
ID IN PROCEDURE Y$GETSTR
      7751**DCL      7749--PROC     7937>>ASSIGN   7941>>IF       7941>>ASSIGN
KV$BPC.BITMAPSIZ
      5061**DCL      5064--IMP-SIZ
KV$BPC.TOT
      5054**DCL      7230>>IF
KV$BPC.USE
      5054**DCL      7228>>ASSIGN   7230>>IF
KV$LIN
      5172**DCL      7683--ASSIGN   7698--ASSIGN   7705<<ASSIGN   7706--ASSIGN   7706--ASSIGN   7708--ASSIGN
KV$LIN.VRTLIN
      5172**DCL      7706<<ASSIGN
KV$LINLST
      5220**DCL      7683--ASSIGN   7696<<ASSIGN   7698--ASSIGN   7699--ASSIGN   7705--ASSIGN   7706--ASSIGN
      7706--ASSIGN
KV$LINLST.LSTCELWRDX
      5220**DCL      7697<<ASSIGN
KV$LINLST.LSTENTWRDX
      5220**DCL      7698<<ASSIGN   7700>>DOUNTIL
KV$MRD.BLANKERASES
      5256**DCL      7501>>IF
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:129  
KV$MRD.CURSORUP
      5260**DCL      7501>>IF       7624>>IF       7640>>IF
KV$MRD.DCLATRWHNOTP
      5262**DCL      7618>>IF
KV$MRD.DSPHEIGHT
      5250**DCL      7686>>ASSIGN
KV$MRD.FSTERS
      5260**DCL      7501>>IF
KV$MRD.LNG
      5253**DCL      7542>>ASSIGN
KV$MRD.MAXATRPERLIN
      5254**DCL      7618>>IF
KV$MRD.MVD$
      5252**DCL      7348<<ASSIGN   8052>>ASSIGN   8053<<ASSIGN
KV$MRD.PHSFRM
      5262**DCL      7501>>IF       7627>>IF
KV$MRD.PRFINPFNCTBL$
      5249**DCL      7350<<ASSIGN
KV$MRD.SRD$
      5248**DCL      7347<<ASSIGN   8402>>ASSIGN   8403<<ASSIGN
KV$MRD.USRCNT
      5250**DCL      8404<<ASSIGN   8404>>ASSIGN   8436>>IF
KV$MRD.WDT
      5250**DCL      7560>>ASSIGN   7618>>IF       7618>>IF
KV$MVD
      6043**DCL      8047>>ASSIGN
KV$MVD.EDITOVR
      6051**DCL      7664<<ASSIGN
KV$MVD.INPTAB$
      6043**DCL      7635>>ASSIGN   7637<<ASSIGN
KV$MVD.LINLST$
      6046**DCL      7613>>IF       7693<<ASSIGN
KV$MVD.LNG
      6047**DCL      7676<<ASSIGN
KV$MVD.ORG
      6048**DCL      7603>>IF       7604>>IF       7721<<ASSIGN   7741>>IF
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:130  
KV$MVD.RETYPOVR
      6051**DCL      7624<<ASSIGN   7625>>IF       7640>>IF       7653>>IF       7662>>IF       7740>>IF
KV$MVD.SRD$
      6043**DCL      7338<<ASSIGN   7510>>ASSIGN   8435<<ASSIGN
KV$MVD.SSTINPFNCTBL$
      6045**DCL      7324<<ASSIGN
KV$MVD.TRNTBL$
      6045**DCL      7328<<ASSIGN
KV$MVD.USRCNT
      6046**DCL      7514>>IF       7525<<ASSIGN   7525>>ASSIGN   7625>>IF       7648>>IF       7940<<ASSIGN
      7940>>ASSIGN   8048<<ASSIGN   8048>>ASSIGN
KV$MVD.VFU$
      6045**DCL      7666>>ASSIGN   7669<<ASSIGN
KV$MVD.WDT
      6047**DCL      7675<<ASSIGN   8428<<ASSIGN
KV$PTR.INPCNDPND
      5301**DCL      5310--REDEF    5314--REDEF
KV$PTR.LINLST$
      5297**DCL      5298--REDEF    7602>>ASSIGN   7694<<ASSIGN
KV$PTR.MRD$
      5296**DCL      7346<<ASSIGN   7360<<ASSIGN   7360>>ASSIGN   7501>>IF       7501>>IF       7501>>IF
      7501>>IF       7542>>ASSIGN   7560>>ASSIGN   7618>>IF       7618>>IF       7618>>IF       7618>>IF
      7624>>IF       7627>>IF       7640>>IF       7686>>ASSIGN   8052>>ASSIGN   8053>>ASSIGN   8402>>ASSIGN
      8403>>ASSIGN   8404>>ASSIGN   8404>>ASSIGN   8434>>ASSIGN   8436>>IF
KV$PTR.MVD$
      5296**DCL      7321<<ASSIGN   7338>>ASSIGN   7348>>ASSIGN   7362<<ASSIGN   7362>>ASSIGN   7514>>IF
      7516>>ASSIGN   7524<<ASSIGN   7525>>ASSIGN   7525>>ASSIGN   7603>>IF       7604>>IF       7613>>IF
      7624>>ASSIGN   7625>>IF       7625>>IF       7635>>ASSIGN   7637>>ASSIGN   7640>>IF       7648>>IF
      7653>>IF       7662>>IF       7664>>ASSIGN   7666>>ASSIGN   7669>>ASSIGN   7675>>ASSIGN   7676>>ASSIGN
      7693>>ASSIGN   7721>>ASSIGN   7740>>IF       7741>>IF       7938>>ASSIGN   7940>>ASSIGN   7940>>ASSIGN
      8047>>ASSIGN   8048>>ASSIGN   8048>>ASSIGN   8067<<ASSIGN   8428>>ASSIGN   8435>>ASSIGN
KV$PTR.SRD$
      5297**DCL      7337<<ASSIGN   7347>>ASSIGN   7351>>ASSIGN   7361<<ASSIGN   7361>>ASSIGN   7546>>ASSIGN
      7546>>ASSIGN   7547>>ASSIGN   7547>>ASSIGN   7550>>ASSIGN   7550>>ASSIGN   7563>>ASSIGN   7563>>ASSIGN
      7564>>ASSIGN   7564>>ASSIGN   7567>>ASSIGN   7567>>ASSIGN   7618>>IF       7618>>IF       7620>>ASSIGN
      7620>>ASSIGN   7621>>ASSIGN   7621>>ASSIGN   7622>>ASSIGN   7631>>ASSIGN   7654>>ASSIGN   7656>>IF
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:131  
      7661>>ASSIGN   7663>>ASSIGN   7675>>ASSIGN   7683>>ASSIGN   7686>>ASSIGN   7698>>ASSIGN   8050>>ASSIGN
      8051>>ASSIGN   8051>>ASSIGN   8400>>ASSIGN   8406>>ASSIGN   8406>>ASSIGN   8433<<ASSIGN
KV$PTR.SSN$
      5295**DCL      7237>>IF       7272<<ASSIGN   7285>>ASSIGN   7294>>ASSIGN   7303>>ASSIGN   7306>>ASSIGN
      7307>>ASSIGN   7309>>IF       7359>>ASSIGN   7370>>ASSIGN   7374>>ASSIGN   7382>>ASSIGN   7383>>ASSIGN
      7384>>ASSIGN   7391>>ASSIGN   7393>>ASSIGN   7395<<ASSIGN   7395>>ASSIGN   7397<<ASSIGN   7427>>ASSIGN
      7446>>IF       7449>>IF       7480>>IF       7484>>ASSIGN   7504>>ASSIGN   7745>>IF       7746>>ASSIGN
      7930>>ASSIGN   7931>>ASSIGN   7934>>ASSIGN   7936>>ASSIGN
KV$PTR.STR$
      5295**DCL      7239>>IF       7240>>ASSIGN   7391>>ASSIGN   7392<<ASSIGN   7392>>ASSIGN   7393>>ASSIGN
      7394>>ASSIGN   7397>>ASSIGN   7449>>IF       7453<<ASSIGN   7469>>IF       7470>>ASSIGN   7523>>ASSIGN
      7586>>ASSIGN   7590>>ASSIGN   7593<<ASSIGN   7650>>ASSIGN   7673>>ASSIGN   7745>>IF       7922>>IF
      7923>>ASSIGN   7924>>ASSIGN   7925>>ASSIGN   7926>>ASSIGN   7927>>ASSIGN   7929>>ASSIGN   7939<<ASSIGN
      7965>>ASSIGN   7968>>ASSIGN   7973>>ASSIGN   7974>>ASSIGN   7975>>IF       7977>>ASSIGN   7982>>ASSIGN
      7984>>ASSIGN   7986>>ASSIGN   7987>>ASSIGN   8049>>ASSIGN
KV$PTR.VDI$
      5295**DCL      7238>>IF       7252<<ASSIGN   7252>>ASSIGN   7270>>ASSIGN   7271>>ASSIGN   7274>>ASSIGN
      7277>>IF       7281>>IF       7285>>ASSIGN   7291>>ASSIGN   7304>>ASSIGN   7323>>IF       7324>>ASSIGN
      7327>>IF       7328>>ASSIGN   7349>>IF       7350>>ASSIGN   7418>>ASSIGN   7443>>ASSIGN   7456>>ASSIGN
      7456>>ASSIGN   7457>>ASSIGN   7457>>ASSIGN   7517>>IF       7948>>IF
KV$PTR$
      5289**DCL      5295--IMP-PTR  7232>>ASSIGN   7237>>IF       7238>>IF       7239>>IF       7240>>ASSIGN
      7251<<ASSIGN   7252>>ASSIGN   7261>>ASSIGN   7262<<ASSIGN   7270>>ASSIGN   7271>>ASSIGN   7272>>ASSIGN
      7273>>ASSIGN   7274>>ASSIGN   7277>>IF       7281>>IF       7285>>ASSIGN   7285>>ASSIGN   7291>>ASSIGN
      7294>>ASSIGN   7303>>ASSIGN   7304>>ASSIGN   7306>>ASSIGN   7307>>ASSIGN   7309>>IF       7321>>ASSIGN
      7323>>IF       7324>>ASSIGN   7327>>IF       7328>>ASSIGN   7337>>ASSIGN   7338>>ASSIGN   7346>>ASSIGN
      7347>>ASSIGN   7348>>ASSIGN   7349>>IF       7350>>ASSIGN   7351>>ASSIGN   7359>>ASSIGN   7360>>ASSIGN
      7361>>ASSIGN   7362>>ASSIGN   7370>>ASSIGN   7374>>ASSIGN   7382>>ASSIGN   7383>>ASSIGN   7384>>ASSIGN
      7391>>ASSIGN   7392>>ASSIGN   7393>>ASSIGN   7393>>ASSIGN   7394>>ASSIGN   7395>>ASSIGN   7397>>ASSIGN
      7397>>ASSIGN   7418>>ASSIGN   7427>>ASSIGN   7437>>IF       7443>>ASSIGN   7446>>IF       7448<<ASSIGN
      7449>>IF       7449>>IF       7453>>ASSIGN   7456>>ASSIGN   7456>>ASSIGN   7457>>ASSIGN   7457>>ASSIGN
      7467<<ASSIGN   7469>>IF       7470>>ASSIGN   7480>>IF       7484>>ASSIGN   7501>>IF       7501>>IF
      7501>>IF       7501>>IF       7504>>ASSIGN   7514>>IF       7516>>ASSIGN   7517>>IF       7523>>ASSIGN
      7524>>ASSIGN   7525>>ASSIGN   7525>>ASSIGN   7542>>ASSIGN   7546>>ASSIGN   7546>>ASSIGN   7547>>ASSIGN
      7547>>ASSIGN   7550>>ASSIGN   7550>>ASSIGN   7560>>ASSIGN   7563>>ASSIGN   7563>>ASSIGN   7564>>ASSIGN
      7564>>ASSIGN   7567>>ASSIGN   7567>>ASSIGN   7586>>ASSIGN   7590>>ASSIGN   7593>>ASSIGN   7602>>ASSIGN
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:132  
      7603>>IF       7604>>IF       7613>>IF       7618>>IF       7618>>IF       7618>>IF       7618>>IF
      7618>>IF       7618>>IF       7620>>ASSIGN   7620>>ASSIGN   7621>>ASSIGN   7621>>ASSIGN   7622>>ASSIGN
      7624>>IF       7624>>ASSIGN   7625>>IF       7625>>IF       7627>>IF       7631>>ASSIGN   7635>>ASSIGN
      7637>>ASSIGN   7640>>IF       7640>>IF       7648>>IF       7650>>ASSIGN   7653>>IF       7654>>ASSIGN
      7656>>IF       7661>>ASSIGN   7662>>IF       7663>>ASSIGN   7664>>ASSIGN   7666>>ASSIGN   7669>>ASSIGN
      7673>>ASSIGN   7675>>ASSIGN   7675>>ASSIGN   7676>>ASSIGN   7683>>ASSIGN   7686>>ASSIGN   7686>>ASSIGN
      7693>>ASSIGN   7694>>ASSIGN   7698>>ASSIGN   7721>>ASSIGN   7740>>IF       7741>>IF       7745>>IF
      7745>>IF       7746>>ASSIGN   7922>>IF       7923>>ASSIGN   7924>>ASSIGN   7925>>ASSIGN   7926>>ASSIGN
      7927>>ASSIGN   7929>>ASSIGN   7930>>ASSIGN   7931>>ASSIGN   7934>>ASSIGN   7936>>ASSIGN   7938>>ASSIGN
      7939>>ASSIGN   7940>>ASSIGN   7940>>ASSIGN   7948>>IF       7965>>ASSIGN   7968>>ASSIGN   7973>>ASSIGN
      7974>>ASSIGN   7975>>IF       7977>>ASSIGN   7982>>ASSIGN   7984>>ASSIGN   7986>>ASSIGN   7987>>ASSIGN
      8047>>ASSIGN   8048>>ASSIGN   8048>>ASSIGN   8049>>ASSIGN   8050>>ASSIGN   8051>>ASSIGN   8051>>ASSIGN
      8052>>ASSIGN   8053>>ASSIGN   8067>>ASSIGN   8400>>ASSIGN   8402>>ASSIGN   8403>>ASSIGN   8404>>ASSIGN
      8404>>ASSIGN   8406>>ASSIGN   8406>>ASSIGN   8428>>ASSIGN   8433>>ASSIGN   8434>>ASSIGN   8435>>ASSIGN
      8436>>IF
KV$RCRLST
      5339**DCL      7688--ASSIGN   7712<<ASSIGN
KV$RCRLST.KEYLNG
      5344**DCL      7604>>IF       7716<<ASSIGN
KV$RCRLST.MAXRCR
      5340**DCL      7604>>IF       7714<<ASSIGN
KV$RCRLST.RCR$
      5351**DCL      7688--ASSIGN
KV$RCRLST.SPRCNT
      5344**DCL      7604>>IF       7718<<ASSIGN   7719<<ASSIGN
KV$RCRLST.STRBYTSIZ
      5339**DCL      7713<<ASSIGN
KV$SHRBFR
      6495**DCL      7928<>CALL     8059<>CALL     8061<>CALL     8062<>CALL     8063<>CALL     8064<>CALL
      8065<>CALL
KV$SRD.BTMRHT
      6182**DCL      6187--REDEF
KV$SRD.CRT
      6258**DCL      6263--REDEF
KV$SRD.FLDEND
      6222**DCL      6227--REDEF
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:133  
KV$SRD.HI_NONBLN
      6292**DCL      6297--REDEF
KV$SRD.LNG
      6190**DCL      7618>>IF       7621>>ASSIGN   7686>>ASSIGN
KV$SRD.MINLNG
      6338**DCL      7621<<ASSIGN   7631<<ASSIGN   7683>>ASSIGN   7698>>ASSIGN
KV$SRD.MINWDT
      6338**DCL      7620<<ASSIGN
KV$SRD.MRD$
      6086**DCL      7351<<ASSIGN
KV$SRD.NOOPTMIZ
      6336**DCL      7663<<ASSIGN
KV$SRD.NXTNONBLNLIN
      6230**DCL      7661<<ASSIGN
KV$SRD.OPT
      6335**DCL      7622<<ASSIGN
KV$SRD.ORG
      6114**DCL      6119--REDEF
KV$SRD.ORG.CLM
      6116**DCL      7563>>ASSIGN   7564>>ASSIGN   7567>>ASSIGN
KV$SRD.ORG.LIN
      6116**DCL      7544>>ASSIGN   7546>>ASSIGN   7547>>ASSIGN   7550>>ASSIGN
KV$SRD.SCROLL
      6191**DCL      7656>>IF
KV$SRD.SRDEND
      6327**DCL      6332--REDEF
KV$SRD.SRDEND.CLM
      6329**DCL      7563>>ASSIGN   7564>>ASSIGN   7567>>ASSIGN
KV$SRD.SRDEND.LIN
      6329**DCL      7544>>ASSIGN   7546>>ASSIGN   7547>>ASSIGN   7550>>ASSIGN
KV$SRD.TOPLFT
      6148**DCL      6153--REDEF
KV$SRD.TRUNCATE
      6192**DCL      7654<<ASSIGN
KV$SRD.USRCNT
      6087**DCL      8051<<ASSIGN   8051>>ASSIGN   8406<<ASSIGN   8406>>ASSIGN
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:134  
KV$SRD.WDT
      6190**DCL      7562>>ASSIGN   7618>>IF       7620>>ASSIGN   7675>>ASSIGN
KV$SSN.LGN
      5498**DCL      7427<<ASSIGN
KV$SSN.LNK$
      5484**DCL      7270<<ASSIGN   7309>>IF       7359>>ASSIGN   7372>>ASSIGN
KV$SSN.LSTEDTBFRSTRID
      5495**DCL      7745>>IF       7746<<ASSIGN
KV$SSN.REDRSPCNT
      5490**DCL      5491--REDEF
KV$SSN.SNCPTR$
      5485**DCL      7273<<ASSIGN
KV$SSN.SSNCNCID
      5493**DCL      7307<<ASSIGN
KV$SSN.SSNCNCINT
      5501**DCL      7303<<ASSIGN   7306<<ASSIGN   7446>>IF       7484<<ASSIGN
KV$SSN.SSNID
      5534**DCL      7368>>IF       7374<<ASSIGN
KV$SSN.STR$
      5484**DCL      7391<<ASSIGN   7504>>ASSIGN   7930>>ASSIGN   7931>>ASSIGN   7934<<ASSIGN
KV$SSN.TRCBFR$
      5487**DCL      7285<<ASSIGN   7294<<ASSIGN
KV$SSN.TYPAHDBFRCNT
      5495**DCL      7384<<ASSIGN
KV$SSN.TYPAHDBFRHED$
      5486**DCL      7382<<ASSIGN
KV$SSN.TYPAHDBFRINS$
      5487**DCL      7383<<ASSIGN
KV$SSN.VDI$
      5484**DCL      7274<<ASSIGN
KV$STR.ACTCHRTBL$
      5563**DCL      7673<<ASSIGN   7982>>ASSIGN   7984<<ASSIGN
KV$STR.ACTONTRN
      5621**DCL      7923>>ASSIGN
KV$STR.AUTTABCLM
      5623**DCL      7924>>ASSIGN
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:135  
KV$STR.EDTBFR__
      5585**DCL      7977<<ASSIGN
KV$STR.EDTBFR__.ADR$
      5587**DCL      7973>>ASSIGN
KV$STR.EDTBFR__.BFRBYTSIZ
      5588**DCL      7974>>ASSIGN
KV$STR.EDTBFR__.BFRRLSDSP
      5589**DCL      7975>>IF
KV$STR.ERR.COD
      5615**DCL      7240<<ASSIGN   7470<<ASSIGN   7590<<ASSIGN   7650<<ASSIGN
KV$STR.ID
      5621**DCL      7394<<ASSIGN   7506>>IF       7745>>IF
KV$STR.LFTMRGCLM
      5619**DCL      7929>>ASSIGN
KV$STR.LNK$
      5561**DCL      7507>>ASSIGN   7930>>ASSIGN   7931<<ASSIGN
KV$STR.MVD$
      5561**DCL      7510>>ASSIGN   7523<<ASSIGN   8049<<ASSIGN
KV$STR.OTPTAB$
      5562**DCL      7927>>ASSIGN   7986>>ASSIGN   7987<<ASSIGN
KV$STR.PRM$
      5562**DCL      7965>>ASSIGN   7968<<ASSIGN
KV$STR.SSN$
      5561**DCL      7393<<ASSIGN   7397>>ASSIGN   7449>>IF
KV$STR.WRDWRP
      5624**DCL      7926>>ASSIGN
KV$STR.WRDWRPCLM
      5623**DCL      7925>>ASSIGN
KV$STT.CNCEVTCNT
      6010**DCL      7457<<ASSIGN   7457>>ASSIGN
KV$STT.REQSTATS.DSPMSK
      5900**DCL      5906--REDEF
KV$STT.REQSTATS.SLCMSK
      5941**DCL      5948--REDEF
KV$USRPRM.INPFNCTBLHEDPTR$
      6474**DCL      7323>>IF       7324>>ASSIGN
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:136  
KV$USRPRM.PRFFNCTBL$
      6476**DCL      7349>>IF       7350>>ASSIGN
KV$USRPRM.STREVTENB
      6472**DCL      7948>>IF
KV$USRPRM.STT$
      6475**DCL      7457>>ASSIGN   7457>>ASSIGN
KV$USRPRM.TRNTBLHEDPTR$
      6474**DCL      7327>>IF       7328>>ASSIGN
KV$VDH_RLSBFR
      7062**DCL      7638<>CALL     7668<>CALL     7967<>CALL     7976<>CALL     7983<>CALL     7988<>CALL
KV$VDH_RLSBFR.BFR$
      7068**DCL      7635<<ASSIGN   7666<<ASSIGN   7965<<ASSIGN   7973<<ASSIGN   7982<<ASSIGN   7986<<ASSIGN
KV$VDH_RLSBFR.BYTSIZ
      7068**DCL      7974<<ASSIGN
KV$VDH_RLSBFR.STRTYP
      7068**DCL      7636<<ASSIGN   7667<<ASSIGN   7966<<ASSIGN   7972<<ASSIGN   7981<<ASSIGN   7985<<ASSIGN
KV$VDI.LINSPD
      5453**DCL      7304<<ASSIGN   7418>>ASSIGN
KV$VDI.OTPCNDPND.PST
      5448**DCL      7517>>IF
KV$VDI.SHRTRCBFR
      5453**DCL      7281>>IF
KV$VDI.SSN$
      5411**DCL      7270>>ASSIGN   7271<<ASSIGN
KV$VDI.SSNCNT
      5440**DCL      7238>>IF       7456<<ASSIGN   7456>>ASSIGN
KV$VDI.TRCBFR$
      5441**DCL      7277>>IF       7285>>ASSIGN
KV$VDI.TRCBFRBYTSIZ
      5441**DCL      7291>>ASSIGN
KV$VDI.USRPRM$
      5412**DCL      7323>>IF       7324>>ASSIGN   7327>>IF       7328>>ASSIGN   7349>>IF       7350>>ASSIGN
      7457>>ASSIGN   7457>>ASSIGN   7948>>IF
KV$VDI.VDHEVTENB
      5459**DCL      7443<<ASSIGN
KV@SND_CNC
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:137  
      7148**DCL      7413<<ASSIGN   7435<>CALL     7481<<ASSIGN   7485<>CALL     7729--ASSIGN   7731--ASSIGN
      7732--ASSIGN   7734--ASSIGN   7736--ASSIGN
KV@SND_CNC.DSTNTWADR
      7219**DCL      7432<<ASSIGN   7482<<ASSIGN
KV@SND_CNC.DSTNTWRSR
      7219**DCL      7426<<ASSIGN   7433<<ASSIGN
KV@SND_CNC.ERR
      7188**DCL      7483<<ASSIGN
KV@SND_CNC.LGN_
      7188**DCL      7414<<ASSIGN
KV@SND_CNC.LINSPD
      7189**DCL      7418<<ASSIGN
KV@SND_CNC.SCNENDPNTID
      7206**DCL      7415<<ASSIGN
KV@SND_CNC.SCNENDPNTID.TERM
      7208**DCL      7217--REDEF
KV@SND_CNC.VDOVLP
      7182**DCL      7185--REDEF
KV@USR_EVT IN PROCEDURE Y$GETSTR
      7788**DCL      7951<<ASSIGN   7954<>CALL
KV@USR_EVT.ID IN PROCEDURE Y$GETSTR
      7794**DCL      7952<<ASSIGN
KV@USR_EVT.PRM IN PROCEDURE Y$GETSTR
      7794**DCL      7953<<ASSIGN
KV@VDH_GETBFR
      6997**DCL      7233<<ASSIGN   7247<>CALL     7259<>CALL     7264<>CALL     7292<>CALL     7319<>CALL
      7335<>CALL     7344<>CALL     7380<>CALL     7518<<ASSIGN   7587<<ASSIGN   7612<<ASSIGN   7635--ASSIGN
      7636--ASSIGN   7638--CALL     7666--ASSIGN   7667--ASSIGN   7668--CALL     7692<>CALL     7920<>CALL
      7965--ASSIGN   7966--ASSIGN   7967--CALL     7972--ASSIGN   7973--ASSIGN   7974--ASSIGN   7976--CALL
      7981--ASSIGN   7982--ASSIGN   7983--CALL     7985--ASSIGN   7986--ASSIGN   7988--CALL     8039<>CALL
      8391<>CALL
KV@VDH_GETBFR.BFR$
      7003**DCL      5220--IMP-PTR  5339--IMP-PTR  7251>>ASSIGN   7261<<ASSIGN   7263>>IF       7270>>ASSIGN
      7271>>ASSIGN   7272>>ASSIGN   7273>>ASSIGN   7274>>ASSIGN   7294>>ASSIGN   7321>>ASSIGN   7324>>ASSIGN
      7328>>ASSIGN   7337>>ASSIGN   7338>>ASSIGN   7346>>ASSIGN   7347>>ASSIGN   7348>>ASSIGN   7350>>ASSIGN
      7351>>ASSIGN   7359<<ASSIGN   7367>>DOWHILE  7368>>IF       7370<<ASSIGN   7372<<ASSIGN   7372>>ASSIGN
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:138  
      7382>>ASSIGN   7383>>ASSIGN   7602<<ASSIGN   7604>>IF       7604>>IF       7604>>IF       7693>>ASSIGN
      7694>>ASSIGN   7696>>ASSIGN   7697>>ASSIGN   7698>>ASSIGN   7700>>DOUNTIL  7705>>ASSIGN   7706>>ASSIGN
      7712>>ASSIGN   7713>>ASSIGN   7714>>ASSIGN   7716>>ASSIGN   7718>>ASSIGN   7719>>ASSIGN   7852--IMP-PTR
      7923>>ASSIGN   7924>>ASSIGN   7925>>ASSIGN   7926>>ASSIGN   7927>>ASSIGN   7928>>CALL     7929>>ASSIGN
      7930>>ASSIGN   7931>>ASSIGN   7934>>ASSIGN   7936>>ASSIGN   7937>>ASSIGN   7938>>ASSIGN   7939>>ASSIGN
      7941>>ASSIGN   8015--IMP-PTR  8047>>ASSIGN   8049>>ASSIGN   8050>>ASSIGN   8052>>ASSIGN   8053>>ASSIGN
      8054>>ASSIGN   8055>>ASSIGN   8056>>ASSIGN   8057>>ASSIGN   8058>>ASSIGN   8059>>CALL     8060>>ASSIGN
      8061>>CALL     8062>>CALL     8063>>CALL     8064>>CALL     8065>>CALL     8067>>ASSIGN   8135--IMP-PTR
      8401>>ASSIGN   8402>>ASSIGN   8403>>ASSIGN   8405>>ASSIGN   8407>>ASSIGN   8408>>ASSIGN   8411>>ASSIGN
      8411>>ASSIGN   8413>>ASSIGN   8413>>ASSIGN   8415>>ASSIGN   8415>>ASSIGN   8416>>ASSIGN   8418>>ASSIGN
      8418>>ASSIGN   8419>>ASSIGN   8421>>ASSIGN   8421>>ASSIGN   8421>>ASSIGN   8422>>ASSIGN   8422>>ASSIGN
      8422>>ASSIGN   8423>>ASSIGN   8423>>ASSIGN   8423>>ASSIGN   8424>>ASSIGN   8424>>ASSIGN   8425>>ASSIGN
      8426>>ASSIGN   8427>>ASSIGN   8427>>ASSIGN   8428>>ASSIGN   8429>>ASSIGN   8429>>ASSIGN   8430>>ASSIGN
      8430>>ASSIGN   8431>>ASSIGN   8431>>ASSIGN   8432>>ASSIGN   8433>>ASSIGN   8434>>ASSIGN   8435>>ASSIGN
      8437>>ASSIGN   8437>>ASSIGN
KV@VDH_GETBFR.BYTSIZ
      7003**DCL      7291<<ASSIGN   7683<<ASSIGN   7688<<ASSIGN   7697>>ASSIGN   7713>>ASSIGN
KV@VDH_GETBFR.SCRNO_MMR
      7007**DCL      7234<<ASSIGN
KV@VDH_GETBFR.STRTYP
      7003**DCL      7246<<ASSIGN   7258<<ASSIGN   7260<<ASSIGN   7290<<ASSIGN   7318<<ASSIGN   7334<<ASSIGN
      7343<<ASSIGN   7379<<ASSIGN   7682<<ASSIGN   7685<<ASSIGN   7690<<ASSIGN   7695>>IF       7711>>IF
      7727>>DOSELCT  7919<<ASSIGN   7948>>IF       7953>>ASSIGN   8038<<ASSIGN   8390<<ASSIGN
KV@VDH_SETPRM
      7099**DCL      7405<<ASSIGN   7408<>CALL     7609<<ASSIGN   7658<>CALL     7739<>CALL
KV@VDH_SETPRM.PRMID
      7105**DCL      7406<<ASSIGN   7657<<ASSIGN   7738<<ASSIGN
KV@VDH_SETPRM.SCP
      7132**DCL      7610<<ASSIGN
KV@VDH_SETPRM.VAL_
      7127**DCL      7407<<ASSIGN
KV@VDH_SETPRM.VAL_.ADR$
      7129**DCL      7736<<ASSIGN
KV@VDH_SETPRM.VAL_.BYTSIZ
      7129**DCL      7737<<ASSIGN
KVC$ADJWND
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:139  
      6518**DCL-ENT  7575--CALL     7578--CALL
KVC$DRWBRD
      6519**DCL-ENT  7741--CALL
KVC$RLSFRM
      6520**DCL-ENT  7613--CALL
KVC$RLSMVD
      6522**DCL-ENT  7522--CALL
KVC$RLSSSNNO_CNC
      6521**DCL-ENT  7465--CALL
KVC$RLSSTR
      6523**DCL-ENT  7396--CALL
KVI$NEWINPFNCTBL
      6524**DCL-ENT  7353--CALL
KVM$SND
      6531**DCL-ENT  7435--CALL     7485--CALL
KVO$ERSSRD
      6525**DCL-ENT  7743--CALL
KVP$SETPRM
      6526**DCL-ENT  7408--CALL     7658--CALL     7739--CALL
KVS$GETBFR
      6527**DCL-ENT  7247--CALL     7259--CALL     7292--CALL     7319--CALL     7335--CALL     7344--CALL
      7380--CALL     7692--CALL     7920--CALL     8039--CALL     8391--CALL
KVS$RLSBFR
      6528**DCL-ENT  7264--CALL     7638--CALL     7668--CALL     7967--CALL     7976--CALL     7983--CALL
      7988--CALL
KVV$CALUSR_EVT
      6529**DCL-ENT  7954--CALL
KVV$CALUSR_PST
      6530**DCL-ENT  7517--CALL
KV_ACTCHRTBLNRM
      6510**DCL      7673--ASSIGN
KV_B_POOL$
      6533**DCL      5050--IMP-PTR  7228>>ASSIGN   7230>>IF       7230>>IF
KV_LIN
      5196**DCL      7705>>ASSIGN
KV_RCRLST
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:140  
      5376**DCL      7712>>ASSIGN
KV_SHRBFR_PRM1 IN PROCEDURE Y$GETSTR
      7752**DCL      7756--DCLINIT
KV_SHRBFR_PRM2 IN PROCEDURE Y$GETSTR
      7753**DCL      7756--DCLINIT
KV_SHRBFR_PRM3 IN PROCEDURE Y$GETSTR
      7754**DCL      7756--DCLINIT
KV_SND_CNC
      6711**DCL      7413>>ASSIGN   7481>>ASSIGN
KV_SND_CNC.SCNENDPNTID.TERM
      6771**DCL      6780--REDEF
KV_SND_CNC.VDOVLP
      6745**DCL      6748--REDEF
KV_SSNCNT
      6515**DCL      7229>>IF       7229>>ASSIGN   7455<<ASSIGN   7455>>ASSIGN
KV_SSNMAX
      6516**DCL      7238>>IF
KV_USR_EVT IN PROCEDURE Y$GETSTR
      7823**DCL      7951>>ASSIGN
KV_VDH_GETBFR
      6561**DCL      7233>>ASSIGN   7518>>ASSIGN   7587>>ASSIGN   7612>>ASSIGN
KV_VDH_SETPRM
      6662**DCL      7405>>ASSIGN   7609>>ASSIGN
NOTCOM_ERR
      7649**LABEL    7619--GOTO     7640--GOTO
NO_CTX
      7589**LABEL    7519--CALLALT  7526--GOTO     7626--CALLALT  7692--CALLALT
ORGPTR$
      7222**DCL      7232<<ASSIGN   7252>>ASSIGN   7262>>ASSIGN   7263>>IF       7360>>ASSIGN   7361>>ASSIGN
      7362>>ASSIGN   7391>>ASSIGN   7392>>ASSIGN   7395>>ASSIGN   7437>>IF       7448>>ASSIGN   7467>>ASSIGN
      7504<<ASSIGN   7505>>DOWHILE  7506>>IF       7507<<ASSIGN   7507>>ASSIGN   7509>>IF       7509>>ASSIGN
      7510>>ASSIGN   7516<<ASSIGN   7523>>ASSIGN   7524>>ASSIGN   7586<<ASSIGN   7593>>ASSIGN
PRM
      6788**DCL         8--PROC     6816--REDEF    6881--REDEF    6900--REDEF    6960--REDEF    7490--ENTRY
      7535--ENTRY    7575<>CALL     7578<>CALL     7584--ENTRY    7596--ENTRY
PRMPTRS IN PROCEDURE Y$GETSTR
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:141  
      7755**DCL      7941>>ASSIGN
PRM_STRID
      6881**DCL      6788--IMP-SIZ  7575>>CALL     7578>>CALL
PRM_VDH_CNC
      6816**DCL      7588<>CALL
PRM_VDH_CNC.DSTNTWADR
      6879**DCL      7419>>IF       7432>>ASSIGN   7480>>IF       7482>>ASSIGN
PRM_VDH_CNC.DSTNTWADR.LDCTX
      6879**DCL      7307>>ASSIGN
PRM_VDH_CNC.DSTNTWRSR
      6879**DCL      7419>>IF       7433>>ASSIGN
PRM_VDH_CNC.LCLENDPNTID
      6866**DCL      7415>>ASSIGN
PRM_VDH_CNC.LCLENDPNTID.TERM
      6868**DCL      6877--REDEF
PRM_VDH_CNC.LGN_
      6848**DCL      7414>>ASSIGN
PRM_VDH_CNC.LINSPD
      6849**DCL      7304>>ASSIGN
PRM_VDH_CNC.NEWSSN
      6848**DCL      7306>>IF       7388>>IF
PRM_VDH_CNC.PRF_
      6843**DCL      7407>>ASSIGN
PRM_VDH_CNC.PRF_.ADR$
      6845**DCL      7401>>IF
PRM_VDH_CNC.SSNCNCINT
      6848**DCL      7298>>IF
PRM_VDO_OPNSTR.KEYL
      6968**DCL      7604>>IF       7604>>IF       7715>>IF       7716>>ASSIGN
PRM_VDO_OPNSTR.NRECS
      6967**DCL      7604>>IF       7604>>IF       7686>>ASSIGN
PRM_VDO_OPNSTR.ORG
      6967**DCL      7603>>IF       7617>>IF       7647>>IF       7680>>DOCASE   7721>>ASSIGN   7745>>IF
PRM_VDO_OPNSTR.SPARE
      6968**DCL      7604>>IF       7604>>IF       7717>>IF       7718>>ASSIGN   7732>>IF
PRM_WINDOW.FSTR.ID
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:142  
      6900**DCL      7506>>IF
PRM_WINDOW.FWINDOW
      6900**DCL      6900--REDEF    6901--REDEF
PRM_WINDOW.FWINDOW$
      6901**DCL      7509<<ASSIGN   7510<<ASSIGN   7543>>IF       7544>>ASSIGN   7544>>ASSIGN   7561>>IF
      7562>>ASSIGN   8399>>IF       8400<<ASSIGN   8401>>ASSIGN
PRM_WINDOW.LENGTH
      6914**DCL      7541>>IF       7547<<ASSIGN   7547>>ASSIGN   7549>>IF       7550<<ASSIGN   7550>>ASSIGN
      7553<<ASSIGN   7574>>IF       7576<<ASSIGN
PRM_WINDOW.POSITION
      6914**DCL      7514>>IF       7531<<ASSIGN   7539>>IF       7539>>IF       7542>>IF       7557>>IF
      7557>>IF       7560>>IF       7574>>IF       7578>>IF       8409>>DOCASE
PRM_WINDOW.WIDTH
      6914**DCL      7559>>IF       7564<<ASSIGN   7564>>ASSIGN   7566>>IF       7567<<ASSIGN   7567>>ASSIGN
      7570<<ASSIGN   7578>>IF
STEMP
      7224**DCL      7699<<ASSIGN   7700>>DOUNTIL  7705>>ASSIGN   7706>>ASSIGN   7708<<ASSIGN   7708>>ASSIGN
TEMP
      7223**DCL      7224--REDEF    7228<<ASSIGN   7229<<ASSIGN   7229>>ASSIGN   7230>>IF       7366<<ASSIGN
      7368>>IF       7369<<ASSIGN   7369>>ASSIGN   7374>>ASSIGN   7542<<ASSIGN   7544<<ASSIGN   7546<<ASSIGN
      7547>>ASSIGN   7560<<ASSIGN   7562<<ASSIGN   7563<<ASSIGN   7564>>ASSIGN   7686<<ASSIGN   7688>>ASSIGN
      7706>>ASSIGN   7714>>ASSIGN   7718>>ASSIGN   7719>>ASSIGN
Y$GETMVD
      7992**PROC     7519--CALL     7626--CALL
Y$GETSRD
      8110**PROC     7521--CALL
Y$GETSTR
      7749**PROC     7389--CALL     7588--CALL
Y$INCSHRBFR
      8071**PROC     7928--CALL     8059--CALL     8061--CALL     8062--CALL     8063--CALL     8064--CALL
      8065--CALL
Y$PTR$
      6512**DCL      7324>>ASSIGN   7328>>ASSIGN
Y$STRSTR
      7961**PROC     7672--CALL
Y@MVD IN PROCEDURE Y$GETMVD
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:143  
      8015**DCL      8047<<ASSIGN
Y@MVD.DCBHDN$ IN PROCEDURE Y$GETMVD
      8016**DCL      8065>>CALL
Y@MVD.FRMSCNINH IN PROCEDURE Y$GETMVD
      8024**DCL      8058<<ASSIGN
Y@MVD.INPFNCCPY IN PROCEDURE Y$GETMVD
      8035**DCL      8060<<ASSIGN
Y@MVD.INPTAB$ IN PROCEDURE Y$GETMVD
      8015**DCL      8059>>CALL
Y@MVD.LINLST$ IN PROCEDURE Y$GETMVD
      8018**DCL      8056<<ASSIGN
Y@MVD.LNK$ IN PROCEDURE Y$GETMVD
      8015**DCL      8052<<ASSIGN
Y@MVD.ORG IN PROCEDURE Y$GETMVD
      8020**DCL      8054<<ASSIGN
Y@MVD.PAGBRKPND IN PROCEDURE Y$GETMVD
      8025**DCL      8057<<ASSIGN
Y@MVD.SRD$ IN PROCEDURE Y$GETMVD
      8015**DCL      8050<<ASSIGN
Y@MVD.SSTINPFNCTBL$ IN PROCEDURE Y$GETMVD
      8017**DCL      8062>>CALL
Y@MVD.TRNTBL$ IN PROCEDURE Y$GETMVD
      8017**DCL      8064>>CALL
Y@MVD.USRCNT IN PROCEDURE Y$GETMVD
      8018**DCL      8055<<ASSIGN
Y@MVD.USRINPFNCTBL$ IN PROCEDURE Y$GETMVD
      8016**DCL      8061>>CALL
Y@MVD.VFU$ IN PROCEDURE Y$GETMVD
      8017**DCL      8063>>CALL
Y@SHRBFR IN PROCEDURE Y$INCSHRBFR
      8089**DCL      8071--PROC     8105--IF
Y@SHRBFR.USRCNT IN PROCEDURE Y$INCSHRBFR
      8102**DCL      8106>>IF       8107<<ASSIGN   8107>>ASSIGN
Y@SRD IN PROCEDURE Y$GETSRD
      8135**DCL      8401<<ASSIGN   8401>>ASSIGN
Y@SRD.ADJTOPLFT IN PROCEDURE Y$GETSRD
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:144  
      8243**DCL      8408<<ASSIGN   8416<<ASSIGN   8419<<ASSIGN   8437<<ASSIGN   8437>>ASSIGN
Y@SRD.BRDEXS IN PROCEDURE Y$GETSRD
      8242**DCL      8430>>ASSIGN
Y@SRD.BRDUPD IN PROCEDURE Y$GETSRD
      8243**DCL      8430<<ASSIGN
Y@SRD.BTMRHT IN PROCEDURE Y$GETSRD
      8231**DCL      8236--REDEF    8429<<ASSIGN   8431>>ASSIGN
Y@SRD.CRT IN PROCEDURE Y$GETSRD
      8307**DCL      8312--REDEF
Y@SRD.CRT.LIN IN PROCEDURE Y$GETSRD
      8309**DCL      8423<<ASSIGN   8424>>ASSIGN
Y@SRD.CRTVRTLINPHSLIN IN PROCEDURE Y$GETSRD
      8279**DCL      8424<<ASSIGN
Y@SRD.DVCLINBIS IN PROCEDURE Y$GETSRD
      8349**DCL      8423>>ASSIGN   8426<<ASSIGN
Y@SRD.ENTSRDCHR$ IN PROCEDURE Y$GETSRD
      8135**DCL      8425<<ASSIGN
Y@SRD.FLDEND IN PROCEDURE Y$GETSRD
      8271**DCL      8276--REDEF    8432<<ASSIGN
Y@SRD.HI_NONBLN IN PROCEDURE Y$GETSRD
      8341**DCL      8346--REDEF    8431<<ASSIGN
Y@SRD.LNG IN PROCEDURE Y$GETSRD
      8239**DCL      8421<<ASSIGN
Y@SRD.LNK$ IN PROCEDURE Y$GETSRD
      8135**DCL      8402<<ASSIGN   8437>>ASSIGN
Y@SRD.MRD$ IN PROCEDURE Y$GETSRD
      8135**DCL      8434<<ASSIGN
Y@SRD.ORG IN PROCEDURE Y$GETSRD
      8163**DCL      8168--REDEF
Y@SRD.ORG.CLM IN PROCEDURE Y$GETSRD
      8165**DCL      8413>>ASSIGN   8415<<ASSIGN   8422>>ASSIGN
Y@SRD.ORG.LIN IN PROCEDURE Y$GETSRD
      8165**DCL      8411>>ASSIGN   8418<<ASSIGN   8421>>ASSIGN
Y@SRD.ORG_PST IN PROCEDURE Y$GETSRD
      8168**DCL      8427>>ASSIGN
Y@SRD.SRDEND IN PROCEDURE Y$GETSRD
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:145  
      8376**DCL      8381--REDEF    8429>>ASSIGN
Y@SRD.SRDEND.CLM IN PROCEDURE Y$GETSRD
      8378**DCL      8413<<ASSIGN   8415>>ASSIGN   8422>>ASSIGN
Y@SRD.SRDEND.LIN IN PROCEDURE Y$GETSRD
      8378**DCL      8411<<ASSIGN   8418>>ASSIGN   8421>>ASSIGN
Y@SRD.TOPLFT IN PROCEDURE Y$GETSRD
      8197**DCL      8202--REDEF
Y@SRD.TOPLFT.LIN IN PROCEDURE Y$GETSRD
      8199**DCL      8423>>ASSIGN
Y@SRD.TOPLFT_PST IN PROCEDURE Y$GETSRD
      8202**DCL      8427<<ASSIGN
Y@SRD.USRCNT IN PROCEDURE Y$GETSRD
      8136**DCL      8405<<ASSIGN
Y@SRD.VRTPSTOK IN PROCEDURE Y$GETSRD
      8240**DCL      8407<<ASSIGN
Y@SRD.WDT IN PROCEDURE Y$GETSRD
      8239**DCL      8422<<ASSIGN   8428>>ASSIGN
Y@STR.ACTONTRN IN PROCEDURE Y$GETSTR
      7912**DCL      7923<<ASSIGN
Y@STR.AUTTABCLM IN PROCEDURE Y$GETSTR
      7914**DCL      7924<<ASSIGN
Y@STR.ID IN PROCEDURE Y$GETSTR
      7912**DCL      7937<<ASSIGN
Y@STR.LFTMRGCLM IN PROCEDURE Y$GETSTR
      7910**DCL      7929<<ASSIGN
Y@STR.LNK$ IN PROCEDURE Y$GETSTR
      7852**DCL      7930<<ASSIGN
Y@STR.MVD$ IN PROCEDURE Y$GETSTR
      7852**DCL      7938<<ASSIGN
Y@STR.OTPTAB$ IN PROCEDURE Y$GETSTR
      7853**DCL      7927<<ASSIGN   7928>>CALL
Y@STR.PRM$ IN PROCEDURE Y$GETSTR
      7853**DCL      7941<<ASSIGN
Y@STR.SSN$ IN PROCEDURE Y$GETSTR
      7852**DCL      7936<<ASSIGN
Y@STR.WRDWRP IN PROCEDURE Y$GETSTR
PL6.E3A0      #001=KVC$CNC File=KVC$CNC.:E05TSI                                  WED 07/30/97 01:54 Page:146  
      7915**DCL      7926<<ASSIGN
Y@STR.WRDWRPCLM IN PROCEDURE Y$GETSTR
      7914**DCL      7925<<ASSIGN

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:147  
      827        1        /*T***********************************************************/
      828        2        /*T*                                                         */
      829        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      830        4        /*T*                                                         */
      831        5        /*T***********************************************************/
      832        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
      833        7        KVC$ADJWND: PROC (PRM_WINDOW) ALTRET;
      834        8        /*F* NAME: KVC$ADJWND.
      835        9             PURPOSE: Adjusts the size of the current SRD according to the
      836       10             values in the parameter VLP_WINDOW, all of which are now in
      837       11             incremental form. */
      838       12
      839       13 S      %INCLUDE KV$GLB;
      840       14 S      %INCLUDE KV$GLBCTX;
      841       15 S      %INCLUDE KV_GLBCNS_E;
      842       16 S      %INCLUDE KV$INT;
      843       17 S      %INCLUDE KV$USR;
      844       18        %INCLUDE LCP_6;
      845      209
      846      210        %KV$MRD;
      847      257        %KV$MVD;
      848      301        %KV$MVD (NAME=Y@MVD, STCLASS="BASED(Y@MVD$)");
      849      345        %KV#VD_ORG_E;
      850      353        %KV$RCRLST (NAME=Y@RCRLST);
      851      389        %EQU KV_RCRLST=CHARTEXT('Y@MVD.LINLST$->Y@RCRLST');
      852      390        %KV$PTR;
      853      433        %KV$VDI;
      854      504        %KV$SRD (STCLASS="BASED(Y@SRD$)");
      855      779        %EQU KV_SRD=CHARTEXT('KV$SRD');
      856      780        %KV$SRD (NAME=Y@SRD, STCLASS="BASED(VLP@WINDOW.FWINDOW$)");
      857     1055        %KV$SSN;
      858     1134        %KV$STR;
      859     1221        %KV$USR_ERS (NAME=KV_USR_ERS, STCLASS=SYMREF);
      860     1325    1   DCL KVC$DRWBRD ENTRY;
      861     1326    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
      862     1327
      863     1328        %VLP_WINDOW (FPTN=PRM_WINDOW, STCLASS=PARAM);
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:148  
      864     1372    1   DCL Y@MVD$ PTR;
      865     1373    1   DCL Y@SRD$ PTR;
      866     1374    1   DCL U$ PTR;                             /* Ptr to various things              */
      867     1375    1   DCL T$ PTR;                             /* Ptr to other things                */
      868     1376
      869     1377        %VLP_WINDOW (FPTN=VLP@WINDOW, STCLASS=AUTO, FILCHRS=0);
      870     1421    1   DCL Y@S$(0:15) PTR;
      871     1422    1   DCL Y@ORG(0:15) BIT(1) UNAL;
      872     1423    1   DCL Y@X SBIN;
      873     1424        %KV$USR_ERS (NAME=KV@USR_ERS, STCLASS=AUTO);
      874     1528        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:149  
      875     1529    1      Y@MVD$ = KV$PTR.MVD$;
      876     1530    1      Y@SRD$ = KV$PTR.SRD$;
      877     1531
      878     1532        /* First make sure erases happen for existing empty windows. */
      879     1533
      880     1534    1      IF %KV_SRD.WDT=0 OR %KV_SRD.LNG=0 THEN %KV_SRD.UNKPST = '1'B;
      881     1535    1      IF Y@MVD.SRD$=Y@SRD$
      882     1536
      883     1537        /* Not called from here (to make/take space in another window */
      884     1538
      885     1539    2      THEN IF PRM_WINDOW.POSITION~=0 THEN DO;
      886     1540
      887     1541        /* This is the first time for this window. We know where to get the space. */
      888     1542
      889     1543    2         VLP@WINDOW.FWINDOW$ = PRM_WINDOW.FWINDOW$;
      890     1544    2         VLP@WINDOW.POSITION = 5-PRM_WINDOW.POSITION;
      891     1545    2         IF VLP@WINDOW.POSITION=%G_POSITION_TOP#
      892     1546    2           OR VLP@WINDOW.POSITION=%G_POSITION_BOTTOM#
      893     1547    2         THEN IF PRM_WINDOW.LENGTH<=0
      894     1548    2           OR PRM_WINDOW.LENGTH>VLP@WINDOW.FWINDOW$->KV$SRD.LNG
      895     1549    2         THEN PRM_WINDOW.LENGTH=VLP@WINDOW.FWINDOW$->KV$SRD.LNG-1;
      896     1550    2         ELSE;
      897     1551    2         ELSE IF PRM_WINDOW.WIDTH<=0
      898     1552    2           OR PRM_WINDOW.WIDTH>VLP@WINDOW.FWINDOW$->KV$SRD.WDT
      899     1553    2         THEN PRM_WINDOW.WIDTH=(VLP@WINDOW.FWINDOW$->KV$SRD.SRDEND.CLM -
      900     1554    2           VLP@WINDOW.FWINDOW$->KV$SRD.ORG.CLM)/2;
      901     1555    2         %KV_SRD.UNKPST = '0'B;  /* New windows don't erase if the cursors in it */
      902     1556    2      END;
      903     1557    2      ELSE DO;
      904     1558
      905     1559        /* Modify specifying an existing window as "where to get it from". */
      906     1560
      907     1561    2         VLP@WINDOW.POSITION = 0;
      908     1562    2         VLP@WINDOW.FWINDOW$ = PRM_WINDOW.FWINDOW$;
      909     1563    2         IF VLP@WINDOW.FWINDOW$~=Y@SRD$ AND VLP@WINDOW.FWINDOW$~=ADDR(NIL)
      910     1564    3         THEN IF PRM_WINDOW.LENGTH~=0 THEN DO;
      911     1565    3            IF Y@SRD.ORG.CLM=%KV_SRD.ORG.CLM
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:150  
      912     1566    3              AND Y@SRD.SRDEND.CLM=%KV_SRD.SRDEND.CLM
      913     1567        /* Anything non-zero will do ... Y$FNDSPCLNG will get it right. */
      914     1568    3            THEN VLP@WINDOW.POSITION = %G_POSITION_TOP#;
      915     1569    3         END;
      916     1570    2         ELSE IF Y@SRD.ORG.LIN=%KV_SRD.ORG.LIN
      917     1571    2           AND Y@SRD.SRDEND.LIN=%KV_SRD.SRDEND.LIN
      918     1572        /* Anything non-zero will do ... Y$FNDSPCWDT will get it right. */
      919     1573    2         THEN VLP@WINDOW.POSITION = %G_POSITION_LEFT#;
      920     1574    2      END;
      921     1575    2      ELSE DO;
      922     1576    2         Y@MVD$ = %KV_MRD.MVD$;
      923     1577    3         DO WHILE Y@MVD.SRD$~=Y@SRD$;
      924     1578    3            Y@MVD$ = Y@MVD.LNK$;
      925     1579    3         END;
      926     1580    2         VLP@WINDOW.POSITION = 5-PRM_WINDOW.POSITION;
      927     1581    2         VLP@WINDOW.FWINDOW$ = ADDR(NIL);
      928     1582    2      END;
      929     1583
      930     1584    1      KV@USR_ERS = KV_USR_ERS;
      931     1585    1      KV@USR_ERS.TOPLFT_PST = %KV_SRD.ORG_PST+%BITBIN('10001'X);
      932     1586    1      KV@USR_ERS.BTMRHT = %KV_SRD.SRDEND;
      933     1587
      934     1588    2      IF PRM_WINDOW.LENGTH~=0 THEN DO;
      935     1589
      936     1590        /* Adjust the length. */
      937     1591
      938     1592    2         VLP@WINDOW.LENGTH = -PRM_WINDOW.LENGTH;
      939     1593    2         VLP@WINDOW.WIDTH = 0;
      940     1594    2         IF %KV_SRD.LNG-VLP@WINDOW.LENGTH<%KV_SRD.MINLNG
      941     1595    2         THEN IF %KV_SRD.OPT
      942     1596    2         THEN VLP@WINDOW.LENGTH = %KV_SRD.SRDEND.LIN-%KV_SRD.ORG.LIN;
      943     1597    2         ELSE VLP@WINDOW.LENGTH = %KV_SRD.LNG-%KV_SRD.MINLNG;
      944     1598
      945     1599    2         IF KV$PTR.MVD$=Y@MVD$ THEN CALL Y$FNDSPCLNG;
      946     1600
      947     1601    2         IF Y@MVD.ORG=%KV#VD_ORG_SE AND %KV_RCRLST.LSTRCR>=0
      948     1602    2         THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.FRSRCR-1;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:151  
      949     1603    3         IF VLP@WINDOW.POSITION=%G_POSITION_TOP# THEN DO;
      950     1604
      951     1605        /* The adjustment is to be done on ORG_PST. */
      952     1606
      953     1607    3            IF Y@MVD.ORG=%KV#VD_ORG_FORM THEN VLP@WINDOW.LENGTH = 0;
      954     1608    3            KV@USR_ERS.BTMRHT.LIN = %KV_SRD.TOPLFT.LIN-1;
      955     1609    3            KV@USR_ERS.TOPLFT.LIN = KV@USR_ERS.TOPLFT.LIN+VLP@WINDOW.LENGTH;
      956     1610    3            %KV_SRD.ORG.LIN = KV@USR_ERS.TOPLFT.LIN-1;
      957     1611    3            %KV_SRD.TOPLFT.LIN = KV@USR_ERS.TOPLFT.LIN;
      958     1612    3            IF %KV_SRD.TOPBRD
      959     1613    3            THEN %KV_SRD.TOPLFT.LIN = %KV_SRD.TOPLFT.LIN+%KV_SRD.HBRDSIZ;
      960     1614    3            Y@X = %KV_SRD.TOPLFT.LIN-%KV_SRD.DVCLINBIS;
      961     1615    3            IF %KV_SRD.CRT.LIN<Y@X
      962     1616    3              OR %KV_SRD.HI_NONBLN.LIN<Y@X
      963     1617    3              OR %KV_SRD.CRTVRTLINPHSLIN<Y@X
      964     1618    3            THEN %KV_SRD.UNKPST = '1'B;
      965     1619    3            ELSE IF %KV_SRD.DVCLINBIS>0
      966     1620    3              AND (%KV_SRD.CRT.LIN<%KV_SRD.TOPLFT.LIN
      967     1621    3              OR %KV_SRD.CRTVRTLINPHSLIN<%KV_SRD.TOPLFT.LIN)
      968     1622    4            THEN DO;
      969     1623    4               Y@X = %KV_SRD.TOPLFT.LIN
      970     1624    4                 -MINIMUM(%KV_SRD.CRT.LIN,%KV_SRD.CRTVRTLINPHSLIN);
      971     1625    4               %KV_SRD.CRT.LIN = %KV_SRD.CRT.LIN+Y@X;
      972     1626    4               %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+Y@X;
      973     1627    4               %KV_SRD.HI_NONBLN.LIN = %KV_SRD.HI_NONBLN.LIN+Y@X;
      974     1628    4               %KV_SRD.DVCLINBIS = %KV_SRD.DVCLINBIS-Y@X;
      975     1629    4            END;
      976     1630    3         END;
      977     1631    3         ELSE DO;
      978     1632        /* Adjust BTMRHT */
      979     1633
      980     1634    3            KV@USR_ERS.TOPLFT.LIN = %KV_SRD.BTMRHT.LIN+1;
      981     1635    3            KV@USR_ERS.BTMRHT.LIN = KV@USR_ERS.BTMRHT.LIN-VLP@WINDOW.LENGTH;
      982     1636    3            %KV_SRD.BTMRHT.LIN = %KV_SRD.BTMRHT.LIN-VLP@WINDOW.LENGTH;
      983     1637    3            %KV_SRD.SRDEND.LIN = KV@USR_ERS.BTMRHT.LIN;
      984     1638    3            Y@X = %KV_SRD.BTMRHT.LIN-%KV_SRD.DVCLINBIS;
      985     1639    3            IF %KV_SRD.CRT.LIN>Y@X
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:152  
      986     1640    3              OR %KV_SRD.HI_NONBLN.LIN>Y@X
      987     1641    3              OR %KV_SRD.CRTVRTLINPHSLIN>Y@X
      988     1642    3            THEN %KV_SRD.UNKPST = '1'B;
      989     1643    3         END;
      990     1644    2         CALL Y$FIXWDT;                    /* Decide whether to scroll           */
      991     1645    2         PRM_WINDOW.LENGTH = -VLP@WINDOW.LENGTH;
      992     1646    2         IF VLP@WINDOW.LENGTH=0 THEN ALTRETURN;
      993     1647    2         IF %KV_SRD.BTMRHT.LIN<%KV_SRD.TOPLFT.LIN THEN %KV_SRD.LNG = 0;
      994     1648    2         ELSE %KV_SRD.LNG = %KV_SRD.BTMRHT.LIN-%KV_SRD.TOPLFT.LIN+1;
      995     1649    2         IF PRM_WINDOW.LENGTH<=0 OR %KV_SRD.LNG=0 THEN GOTO NO_ERASE;
      996     1650    2      END; ELSE IF PRM_WINDOW.WIDTH~=0 THEN DO;
      997     1651
      998     1652        /* Adjust the width. */
      999     1653
     1000     1654    2         VLP@WINDOW.WIDTH = -PRM_WINDOW.WIDTH;
     1001     1655    2         VLP@WINDOW.LENGTH = 0;
     1002     1656    2         IF %KV_SRD.WDT-VLP@WINDOW.WIDTH<%KV_SRD.MINWDT
     1003     1657    2         THEN IF %KV_SRD.OPT OR %KV_SRD.MINWDT=0
     1004     1658    2         THEN VLP@WINDOW.WIDTH = %KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM;
     1005     1659    2         ELSE VLP@WINDOW.WIDTH = %KV_SRD.WDT-%KV_SRD.MINWDT;
     1006     1660
     1007     1661    2         IF KV$PTR.MVD$=Y@MVD$ THEN CALL Y$FNDSPCWDT;
     1008     1662
     1009     1663    2         IF Y@MVD.ORG=%KV#VD_ORG_SE AND %KV_RCRLST.LSTRCR>=0
     1010     1664    2         THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.FRSRCR-1;
     1011     1665    3         IF VLP@WINDOW.POSITION=%G_POSITION_LEFT# THEN DO;
     1012     1666
     1013     1667        /* The adjustment is to be done on ORG_PST. */
     1014     1668
     1015     1669    3            KV@USR_ERS.BTMRHT.CLM = KV@USR_ERS.TOPLFT.CLM-1;
     1016     1670    3            KV@USR_ERS.TOPLFT.CLM = KV@USR_ERS.TOPLFT.CLM+VLP@WINDOW.WIDTH;
     1017     1671    3            %KV_SRD.ORG.CLM = KV@USR_ERS.TOPLFT.CLM-1;
     1018     1672    3            %KV_SRD.TOPLFT.CLM = %KV_SRD.TOPLFT.CLM+VLP@WINDOW.WIDTH;
     1019     1673    3            IF %KV_SRD.CRT.CLM<KV@USR_ERS.TOPLFT.CLM
     1020     1674    3              OR %KV_SRD.HI_NONBLN.CLM<KV@USR_ERS.TOPLFT.CLM
     1021     1675    3            THEN %KV_SRD.UNKPST = '1'B;
     1022     1676    3         END;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:153  
     1023     1677    3         ELSE DO;
     1024     1678        /* Adjust BTMRHT */
     1025     1679
     1026     1680    3            KV@USR_ERS.TOPLFT.CLM = %KV_SRD.BTMRHT.CLM+1;
     1027     1681    3            KV@USR_ERS.BTMRHT.CLM = KV@USR_ERS.BTMRHT.CLM-VLP@WINDOW.WIDTH;
     1028     1682    3            %KV_SRD.BTMRHT.CLM = %KV_SRD.BTMRHT.CLM-VLP@WINDOW.WIDTH;
     1029     1683    3            %KV_SRD.SRDEND.CLM = KV@USR_ERS.BTMRHT.CLM;
     1030     1684    3            IF %KV_SRD.CRT.CLM>%KV_SRD.BTMRHT.CLM
     1031     1685    3              OR %KV_SRD.HI_NONBLN.CLM>%KV_SRD.BTMRHT.CLM
     1032     1686    3            THEN %KV_SRD.UNKPST = '1'B;
     1033     1687    3         END;
     1034     1688    2         IF %KV_SRD.BTMRHT.CLM>=%KV_SRD.TOPLFT.CLM
     1035     1689    2         THEN %KV_SRD.WDT = %KV_SRD.BTMRHT.CLM-%KV_SRD.TOPLFT.CLM+1;
     1036     1690    2         ELSE %KV_SRD.WDT = 0;
     1037     1691        /* Fix the MVDs, too. */
     1038     1692    2         CALL Y$FIXWDT;
     1039     1693    2         PRM_WINDOW.WIDTH = -VLP@WINDOW.WIDTH;
     1040     1694    2         IF VLP@WINDOW.WIDTH=0 THEN ALTRETURN;
     1041     1695    2         IF PRM_WINDOW.WIDTH<=0 OR %KV_SRD.WDT=0 THEN GOTO NO_ERASE;
     1042     1696    3         IF %KV_SRD.UNKPST THEN DO;
     1043     1697
     1044     1698        /* The cursor went nuts. fix it. */
     1045     1699
     1046     1700    3            %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;
     1047     1701    3         END;
     1048     1702    2      END;
     1049     1703        /* We extended the window, and it wasn't empty.  Erase the added space. */
     1050     1704
     1051     1705    1      KV@USR_ERS.BGNPHSCLM = KV@USR_ERS.TOPLFT.CLM;
     1052     1706    1      KV@USR_ERS.ENDPHSCLM = KV@USR_ERS.BTMRHT.CLM;
     1053     1707    1      %KV_SRD.HI_NONBLN.LIN = %KV_SRD.HI_NONBLN.LIN+127;
     1054     1708    2      IF %KV_SRD.BRDEXS THEN DO;
     1055     1709        /* Make sure we can position to all the extension area */
     1056     1710    2         %KV_SRD.BTMRHT = %KV_SRD.SRDEND;
     1057     1711    2         %KV_SRD.TOPLFT_PST = %KV_SRD.ORG_PST+%BITBIN('10001'X);
     1058     1712        /* KVC$DRWBRD will fix up the boundaries later */
     1059     1713    2      END;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:154  
     1060     1714    1      CALL KVV$CALUSR (KV@USR_ERS);
     1061     1715    1      %KV_SRD.HI_NONBLN.LIN = %KV_SRD.HI_NONBLN.LIN-127;
     1062     1716    1   NO_ERASE:;
     1063     1717    2      IF %KV_SRD.UNKPST THEN DO;
     1064     1718
     1065     1719        /* The cursor went nuts. fix it. */
     1066     1720    2         CALL Y$FIXPST;
     1067     1721    2      END;
     1068     1722    1      IF PRM_WINDOW.LENGTH~=0 OR PRM_WINDOW.WIDTH~=0
     1069     1723    2      THEN IF Y@MVD$~=KV$PTR.MVD$ AND %KV_SRD.BRDEXS THEN DO;
     1070     1724    2         Y@SRD$ = KV$PTR.MVD$;
     1071     1725    2         KV$PTR.MVD$ = Y@MVD$;
     1072     1726    2         CALL KVC$DRWBRD;
     1073     1727    2         KV$PTR.MVD$ = Y@SRD$;
     1074     1728    2      END;
     1075     1729    1      ELSE IF %KV_SRD.BRDEXS THEN %KV_SRD.BRDUPD = '1'B;
     1076     1730    1      RETURN;
     1077     1731        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:155  
     1078     1732    1   Y$FIXWDT: PROC;
     1079     1733        %EQU Y_MVD=CHARTEXT('Y@MVD');
     1080     1734        %EQU Y_SRD=CHARTEXT('KV$SRD');
     1081     1735        %EQU Y_MRD=CHARTEXT('KV$SRD.MRD$->KV$MRD');
     1082     1736
     1083     1737        /* Notices changes in width affecting the ability to scroll */
     1084     1738
     1085     1739    2      %Y_SRD.UNKRGN = '1'B;
     1086     1740    2      %Y_MVD.WDT = %Y_SRD.WDT;
     1087     1741    3      IF %Y_SRD.BTMRHT.CLM=%Y_MRD.WDT THEN DO;
     1088     1742    3         %Y_SRD.FSTERS = %Y_MRD.FSTERS;
     1089     1743    3         IF %Y_SRD.BTMRHT.CLM=%Y_SRD.WDT THEN %Y_SRD.VRTSCR = '1'B;
     1090     1744    3         ELSE %Y_SRD.VRTSCR = '0'B;
     1091     1745    3      END; ELSE DO;
     1092     1746    3         %Y_SRD.FSTERS = '0'B;
     1093     1747    3         %Y_SRD.VRTSCR = '0'B;
     1094     1748    3      END;
     1095     1749    2      IF %Y_SRD.SCROLL AND (NOT %Y_SRD.VRTSCR
     1096     1750    3        OR NOT %Y_MRD.VRTSCR AND (%Y_SRD.BRDEXS OR %Y_MRD.USRCNT>1)) THEN DO;
     1097     1751    3         %Y_SRD.VRTSCR = '0'B;
     1098     1752    3         %Y_SRD.SCROLL = '0'B;
     1099     1753    3         %Y_SRD.UNKPST = '1'B;
     1100     1754    3         %Y_SRD.CRT.LIN = 0;          /* A bad value so KVC$DRWBRD notices it    */
     1101     1755    3      END; ELSE IF %Y_SRD.VRTSCR AND %Y_SRD.SAVSCROLL THEN DO;
     1102     1756        /* Scrolling might be possible, and it was on originally */
     1103     1757    3         %Y_SRD.VRTSCR = %Y_MRD.VRTSCR;
     1104     1758    3         IF (%Y_SRD.BRDEXS OR %Y_MRD.DSPHEIGHT~=%Y_SRD.BTMRHT.LIN-%Y_SRD.ORG.LIN)
     1105     1759    3           AND NOT %Y_SRD.VRTSCR THEN EXIT;
     1106     1760    3         %Y_SRD.SCROLL = '1'B;
     1107     1761    2      END; ELSE IF %Y_SRD.VRTSCR THEN %Y_SRD.VRTSCR = %Y_MRD.VRTSCR;
     1108     1762    2      RETURN;
     1109     1763        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:156  
     1110     1764    2   Y$FIXPST: ENTRY;
     1111     1765
     1112     1766        /* Recovers from invalid position parameters by positioning thru SCREND */
     1113     1767
     1114     1768    3      IF %Y_MVD.ORG>%KV#VD_ORG_X364 THEN DO;
     1115     1769    3         %Y_SRD.UNKPST = '0'B;
     1116     1770    3         RETURN;
     1117     1771    3      END;
     1118     1772    2      IF NOT %Y_SRD.SCROLL THEN %Y_SRD.DVCLINBIS=0;
     1119     1773    2      ELSE %Y_SRD.DVCLINBIS = %Y_SRD.BTMRHT.LIN-%Y_SRD.TOPLFT.LIN;
     1120     1774    2      %Y_SRD.CRT.LIN = %Y_SRD.BTMRHT.LIN-%Y_SRD.DVCLINBIS;
     1121     1775    2      IF %Y_MVD.ORG~=%KV#VD_ORG_X364
     1122     1776    2      THEN %Y_SRD.CRTVRTLINPHSLIN = %Y_SRD.CRT.LIN+1;
     1123     1777    3      ELSE DO;
     1124     1778    3         %Y_SRD.CRTVRTLINPHSLIN = %Y_SRD.CRT.LIN;
     1125     1779    3         %Y_MVD.VRTLIN = %Y_SRD.LNG;
     1126     1780    3      END;
     1127     1781    2      %Y_SRD.HI_NONBLN = %Y_SRD.CRT;
     1128     1782    2      %Y_SRD.VRTPSTOK = '0'B;
     1129     1783    2      %Y_SRD.NXTNONBLNLIN = 255;
     1130     1784    3      IF Y@MVD$=KV$PTR.MVD$ THEN DO;
     1131     1785    3         %Y_SRD.UNKPST = '0'B;
     1132     1786    3         %Y_MVD.VRTCLM = 1;
     1133     1787    3      END;
     1134     1788    2      RETURN;
     1135     1789    2   END Y$FIXWDT;
     1136     1790        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:157  
     1137     1791    1   KVC$FIXWDT: ENTRY (PRM_WINDOW) ALTRET;
     1138     1792    1      Y@MVD$ = ADDR(PRM_WINDOW);
     1139     1793    1      Y@SRD$ = Y@MVD.SRD$;
     1140     1794    1      CALL Y$FIXWDT;
     1141     1795    1      RETURN;
     1142     1796
     1143     1797    1   KVC$FIXPST: ENTRY (PRM_WINDOW) ALTRET;
     1144     1798    1      Y@MVD$ = ADDR(PRM_WINDOW);
     1145     1799    1      Y@SRD$ = Y@MVD.SRD$;
     1146     1800    1      CALL Y$FIXPST;
     1147     1801    1      RETURN;
     1148     1802
     1149     1803        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:158  
     1150     1804    1   Y$FNDSPCLNG: PROC;
     1151     1805
     1152     1806        /* Finds adjacent windows above and below, building a list of them */
     1153     1807
     1154     1808    2   DCL Y@WDTPLS1 SBIN;
     1155     1809    2   DCL Y@WDTMNS1 SBIN;
     1156     1810    2   DCL Y@TMP SBIN;
     1157     1811    2   DCL Y@RQS SBIN;
     1158     1812    2   DCL Y@DLT SBIN;
     1159     1813    2   DCL Y@DLTU REDEF Y@DLT UBIN;            /* For division by 2                  */
     1160     1814    2   DCL Y@CRT(0:1) SBIN;
     1161     1815    2   DCL Y@CRTU REDEF Y@CRT UBIN(32);
     1162     1816    2   DCL Y@AVL(0:1) SBIN;
     1163     1817    2   DCL 1 Y@T1 REDEF Y@AVL,
     1164     1818    2          2 F(0:15) BIT(1) UNAL,
     1165     1819    2          2 S SBIN;
     1166     1820    2   DCL Y@NSS(0:1) SBIN;
     1167     1821    2   DCL 1 Y@T2 REDEF Y@NSS,
     1168     1822    2          2 T SBIN,
     1169     1823    2          2 F(0:15) REDEF T BIT(1) UNAL,
     1170     1824    2          2 S SBIN;
     1171     1825    2   DCL Y@ORGCLM SBIN;
     1172     1826    2   DCL Y@ENDCLM SBIN;
     1173     1827    2   DCL Y@ORGLIN SBIN;
     1174     1828    2   DCL Y@ENDLIN SBIN;
     1175     1829    2      Y@WDTPLS1 = 0;
     1176     1830    2      Y@WDTMNS1 = 0;
     1177     1831    2      Y@TMP = %Y_MRD.LNG;
     1178     1832    2      Y@RQS = -VLP@WINDOW.LENGTH;
     1179     1833    2      GOTO COMMON;
     1180     1834    2   Y$FNDSPCWDT: ENTRY;
     1181     1835
     1182     1836        /* Same as Y$FNDSPCLNG, but for width modification.
     1183     1837           This code is written for length.  For width use, pointers are adjusted
     1184     1838           to point at the other half of KV$PST items. */
     1185     1839
     1186     1840    2      Y@WDTPLS1 = 1;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:159  
     1187     1841    2      Y@WDTMNS1 = -1;
     1188     1842    2      Y@TMP = %Y_MRD.WDT;
     1189     1843    2      Y@RQS = -VLP@WINDOW.WIDTH;
     1190     1844    2   COMMON:;
     1191     1845
     1192     1846        /* First make sure we're not trying to go off the screen. */
     1193     1847
     1194     1848    2      T$ = PINCRW(Y@SRD$,Y@WDTPLS1);
     1195     1849    2      Y@ORGLIN = T$->Y@SRD.ORG.LIN;
     1196     1850    2      Y@ENDLIN = T$->Y@SRD.SRDEND.LIN;
     1197     1851
     1198     1852    2      T$ = PINCRW(Y@SRD$,Y@WDTMNS1);
     1199     1853    2      Y@ORGCLM = T$->Y@SRD.ORG.CLM;
     1200     1854    2      Y@ENDCLM = T$->Y@SRD.SRDEND.CLM;
     1201     1855    2      Y@ORG = '0'B;
     1202     1856    2      Y@NSS = '0'B;
     1203     1857    2      Y@X = 0;
     1204     1858    2      Y@AVL(1) = Y@ORGLIN;
     1205     1859        /* Don't acquire space outside the display area. */
     1206     1860    2      IF Y@WDTMNS1=0 THEN Y@AVL(1) = Y@AVL(1)+%Y_MRD.DSPHEIGHT-Y@TMP;
     1207     1861    2      Y@AVL(0) = Y@TMP-Y@ENDLIN;
     1208     1862    2      Y@CRTU = %BITBIN('7FFF7FFF'X);
     1209     1863    3      IF VLP@WINDOW.POSITION~=0 THEN DO;
     1210     1864    3         Y@X = Y@X+1;
     1211     1865    3         Y@S$(0) = VLP@WINDOW.FWINDOW$;
     1212     1866    3      END;
     1213     1867
     1214     1868        /* Look at all the windows for adjacent ones */
     1215     1869
     1216     1870    2      T$ = %Y_MRD.MVD$;
     1217     1871    3      DO UNTIL T$=ADDR(NIL);
     1218     1872    3         VLP@WINDOW.FWINDOW$ = PINCRW(T$->Y@MVD.SRD$,Y@WDTMNS1);
     1219     1873    3         IF T$~=Y@MVD$ AND Y@SRD.ORG.CLM<Y@ENDCLM
     1220     1874    4           AND Y@SRD.SRDEND.CLM>Y@ORGCLM THEN DO;
     1221     1875
     1222     1876        /* It occupies some of the modification space. */
     1223     1877         /* Set a flag if it doesn't overlap an edge. */
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:160  
     1224     1878
     1225     1879    4            Y@TMP = 0;
     1226     1880    4            IF Y@SRD.ORG.CLM>=Y@ORGCLM
     1227     1881    4              AND Y@SRD.SRDEND.CLM<=Y@ENDCLM THEN Y@TMP = -1;
     1228     1882
     1229     1883        /* Now see how close it is, and how much we can get from or put into it */
     1230     1884
     1231     1885    4            VLP@WINDOW.FWINDOW$ = PINCRW(T$->Y@MVD.SRD$,Y@WDTPLS1);
     1232     1886    4            Y@DLT = Y@ENDLIN-Y@SRD.ORG.LIN; /* <=0 if past us                    */
     1233     1887    4            IF Y@DLT>0 THEN Y@DLT = Y@ORGLIN-Y@SRD.SRDEND.LIN+1;
     1234     1888
     1235     1889        /* If its adjacent and not overlapping, see how modifyable it is.
     1236     1890           If not, we won't extend into it */
     1237     1891
     1238     1892    5            IF Y@DLTU/2=0 THEN DO;
     1239     1893
     1240     1894        /* First check for moving ORG_PST in a form - we can't handle that. */
     1241     1895
     1242     1896    5               IF T$->Y@MVD.ORG=%KV#VD_ORG_FORM AND Y@DLT=0 THEN EXIT;
     1243     1897
     1244     1898        /* Ignore expansion into overlapping ones, Y@AVL will get set ok below. */
     1245     1899
     1246     1900    5               IF Y@SRD.SRDEND.LIN-Y@SRD.ORG.LIN>0 AND Y@TMP=0 THEN EXIT;
     1247     1901        /* Remember the smallest adjacent one for choosing which way to go. */
     1248     1902
     1249     1903    5               Y@TMP = Y@SRD.SRDEND.LIN-Y@SRD.ORG.LIN;
     1250     1904
     1251     1905        /* Ignore empty windows if this one is also empty, they'll be on t'other side */
     1252     1906
     1253     1907    5               IF Y@TMP=0 AND Y@ENDLIN=Y@ORGLIN THEN GOTO SKIP_IT;
     1254     1908    5               IF Y@DLT=0 THEN Y@CRT(0) = MINIMUM(Y@CRT(0),Y@TMP);
     1255     1909    5               ELSE Y@CRT(1) = MINIMUM(Y@CRT(1),Y@TMP);
     1256     1910
     1257     1911        /* Find out how much we can reduce it. */
     1258     1912
     1259     1913    5               IF NOT T$->Y@MVD.SRD$->Y@SRD.OPT THEN IF Y@WDTPLS1>0
     1260     1914    5               THEN Y@TMP = T$->Y@MVD.SRD$->Y@SRD.WDT-T$->Y@MVD.SRD$->Y@SRD.MINWDT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:161  
     1261     1915    5               ELSE Y@TMP = T$->Y@MVD.SRD$->Y@SRD.LNG-T$->Y@MVD.SRD$->Y@SRD.MINLNG;
     1262     1916
     1263     1917        /* If there's nothing doing here, don't bother */
     1264     1918
     1265     1919    5               IF Y@TMP=0 AND Y@RQS>0
     1266     1920    5                 OR Y@X>SIZEW(Y@S$)/2 AND T$->Y@MVD.SRD$~=Y@S$(0) THEN EXIT;
     1267     1921
     1268     1922
     1269     1923        /* Check whether it is part of our session, then put in the list. */
     1270     1924
     1271     1925    5               VLP@WINDOW.FWINDOW$ = %KV_SSN.STR$;
     1272     1926    6               DO WHILE VLP@WINDOW.FWINDOW$~=ADDR(NIL);
     1273     1927    6                  IF VLP@WINDOW.FWINDOW$->KV$STR.MVD$=T$ THEN EXIT;
     1274     1928    6                  VLP@WINDOW.FWINDOW$ = VLP@WINDOW.FWINDOW$->KV$STR.LNK$;
     1275     1929    6               END;
     1276     1930    5               IF VLP@WINDOW.FWINDOW$=ADDR(NIL) THEN Y@NSS(Y@DLT) = Y@NSS(Y@DLT)+1;
     1277     1931    6               IF T$->Y@MVD.SRD$~=Y@S$(0) OR Y@X=0 THEN DO;
     1278     1932    6                  Y@S$(Y@X) = T$->Y@MVD.SRD$;
     1279     1933    6                  Y@X = Y@X+1;
     1280     1934    6               END;
     1281     1935    6               IF Y@DLT~=0 THEN DO;
     1282     1936    6                  Y@DLT = Y@DLT+Y@TMP;
     1283     1937    6                  IF T$->Y@MVD.SRD$~=Y@S$(0)
     1284     1938    6                  THEN Y@ORG(Y@X-1) = '1'B;
     1285     1939    6                  ELSE Y@ORG(0) = '1'B;
     1286     1940    5               END; ELSE Y@DLT = -Y@TMP;
     1287     1941    5            END;                           /* If adjacent, non-overlapping       */
     1288     1942    4            ELSE IF T$->Y@MVD.SRD$=Y@S$(0) AND Y@X>0
     1289     1943        /* Do nothing if the FWINDOW specification isn't an adjacent window. */
     1290     1944    4            THEN Y@RQS = 0;
     1291     1945    4            Y@DLT = -Y@DLT;
     1292     1946    5            IF Y@DLT<0 THEN DO;
     1293     1947    5               Y@DLT = -Y@DLT-1;
     1294     1948    5               IF Y@DLT<Y@AVL(1) THEN Y@AVL(1) = Y@DLT;
     1295     1949    4            END; ELSE IF Y@DLT<Y@AVL(0) THEN Y@AVL(0) = Y@DLT;
     1296     1950    4         END;                         /* If any overlapping of modification area */
     1297     1951    3   SKIP_IT:;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:162  
     1298     1952    3         T$ = T$->Y@MVD.LNK$;
     1299     1953    3      END;
     1300     1954
     1301     1955        /* Now lets see what is available, and pick the best one */
     1302     1956
     1303     1957    2      Y@DLT = 0;
     1304     1958    2      IF %KV_SRD.ADJTOPLFT THEN Y@DLT = Y@DLT-1;
     1305     1959    2      IF Y@NSS(0)~=Y@NSS(1)
     1306     1960    2      THEN IF Y@NSS(0)=0 THEN Y@DLT = 0;
     1307     1961    2      ELSE IF Y@NSS(1)=0 THEN Y@DLT = Y@DLT-1;
     1308     1962    3      IF Y@RQS>0 AND Y@AVL(0)~=Y@AVL(1) THEN DO;
     1309     1963    3         IF Y@AVL(1)=0 THEN Y@DLT = 0;
     1310     1964    3         IF Y@AVL(0)=0 THEN Y@DLT = Y@DLT-1;
     1311     1965    3         IF MINIMUM(Y@AVL(0),Y@AVL(1))>=Y@RQS THEN EXIT;
     1312     1966    3         IF Y@AVL(0)>Y@AVL(1) THEN Y@DLT = 0;
     1313     1967    3         ELSE Y@DLT = Y@DLT-1;
     1314     1968    3      END; ELSE DO;
     1315     1969    3         IF Y@CRT(0)=%BITBIN('7FFF'X)
     1316     1970    3         THEN IF Y@CRT(0)=Y@CRT(1) THEN Y@RQS = 0; /* No shrink if no others     */
     1317     1971    3         ELSE Y@DLT = Y@DLT-1;
     1318     1972    3         ELSE IF Y@CRT(1)=%BITBIN('7FFF'X) THEN Y@DLT = 0;
     1319     1973    3      END;
     1320     1974    2      IF VLP@WINDOW.POSITION=0 AND Y@DLT=0
     1321     1975    3        OR VLP@WINDOW.POSITION~=0 AND NOT Y@ORG(0) THEN DO;
     1322     1976    3         IF Y@AVL(0)<Y@RQS THEN Y@RQS = Y@AVL(0);
     1323     1977    3         Y@T2.T = 0;                  /* Make a mask for the ones that matter    */
     1324     1978    3         Y@T2.F(Y@X-1) = '1'B;
     1325     1979    3         Y@T2.T = -Y@T2.T;                 /* Y@T2.T and Y@T2.F are REDEFs       */
     1326     1980    3         Y@ORG = Y@ORG\Y@T2.F;             /* Pick only the BTMRHT ones.         */
     1327     1981    3         VLP@WINDOW.POSITION = %G_POSITION_BOTTOM#-Y@WDTPLS1;
     1328     1982    3      END; ELSE DO;
     1329     1983    3         IF Y@AVL(1)<Y@RQS THEN Y@RQS = Y@AVL(1);
     1330     1984    3         VLP@WINDOW.POSITION = %G_POSITION_TOP#+Y@WDTPLS1;
     1331     1985    3         Y@CRT(0) = Y@CRT(1);
     1332     1986    3      END;
     1333     1987
     1334     1988        /* If we're shrinking from empty windows, make sure we only do one for each
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:163  
     1335     1989           position along the edge, since they all look ok. */
     1336     1990
     1337     1991    2      IF Y@CRT(0)>0 OR Y@X=1 THEN GOTO DO_MODS;
     1338     1992        /* First sort by starting position along the edge,
     1339     1993           noting the empty ones in Y@T1.F, and resetting Y@ORG for non_empty ones that
     1340     1994           overlap empty ones, and for empty ones that overlap the edges of this one. */
     1341     1995    2      Y@T1 = '0'B;
     1342     1996    3      DO Y@TMP=0 TO Y@X-1;
     1343     1997    4         IF Y@ORG(Y@TMP) THEN DO;
     1344     1998    4            U$ = PINCRW(Y@S$(Y@TMP),Y@WDTMNS1);
     1345     1999    5            DO Y@DLT=Y@TMP+1 TO Y@X-1;
     1346     2000    5               IF Y@ORG(Y@DLT)
     1347     2001    5               THEN IF PINCRW(Y@S$(Y@DLT),Y@WDTMNS1)->Y@SRD.ORG.CLM
     1348     2002    6                 < U$->Y@SRD.ORG.CLM THEN DO;
     1349     2003    6                  T$ = U$;
     1350     2004    6                  U$ = PINCRW(Y@S$(Y@DLT),Y@WDTMNS1);
     1351     2005    6                  Y@S$(Y@DLT) = PINCRW(T$,Y@WDTPLS1);
     1352     2006    6               END;                        /* if CLM(Y@DLT) < CLM(Y@TMP)         */
     1353     2007    5            END;                           /* index on Y@DLT                     */
     1354     2008    4            Y@S$(Y@TMP) = PINCRW(U$,Y@WDTPLS1);
     1355     2009    4            T$ = PINCRW(Y@S$(Y@TMP),Y@WDTPLS1);
     1356     2010    5            IF T$->Y@SRD.SRDEND.LIN=T$->Y@SRD.ORG.LIN THEN DO;
     1357     2011    5               Y@T1.F(Y@TMP) = '1'B;
     1358     2012    5               IF Y@TMP>0 AND NOT Y@T1.F(Y@TMP-1)
     1359     2013    5                 AND Y@T1.S>U$->Y@SRD.ORG.CLM
     1360     2014    5               THEN Y@ORG(Y@TMP-1) = '0'B; /* This empty overlaps that non_empty. */
     1361     2015    5               IF U$->Y@SRD.ORG.CLM<Y@ORGCLM OR U$->Y@SRD.SRDEND.CLM>Y@ENDCLM
     1362     2016    5               THEN Y@ORG(Y@TMP) = '0'B;
     1363     2017    5            END;
     1364     2018    4            ELSE IF Y@T1.S>U$->Y@SRD.ORG.CLM
     1365     2019    4            THEN Y@ORG(Y@TMP) = '0'B; /* This non_empty overlaps that empty.     */
     1366     2020    4            IF U$->Y@SRD.SRDEND.CLM>Y@T1.S THEN Y@T1.S = U$->Y@SRD.SRDEND.CLM;
     1367     2021    4         END;                              /* if Y@ORG(Y@TMP)                    */
     1368     2022    3      END; /* index on Y@TMP */
     1369     2023    2      IF NOT Y@ORG THEN Y@RQS = 0;         /* Nothing left to adjust             */
     1370     2024    2      IF NOT Y@ORG OR NOT Y@T1.F THEN GOTO DO_MODS;
     1371     2025        /* Now go through and pick out a set that doesn't overlap. */
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:164  
     1372     2026    2      Y@T2.F = Y@ORG;                      /* Pick one with a maximal effect     */
     1373     2027    2      Y@T2.S = 0;
     1374     2028    2      Y@ORG = '0'B;
     1375     2029    3      DO UNTIL NOT Y@T2.F;
     1376     2030    3         Y@T1.F = Y@T2.F;
     1377     2031    3         Y@DLT = 0;
     1378     2032    3         Y@T1.S = 511;
     1379     2033    4         DO UNTIL Y@TMP=0;
     1380     2034    4            Y@TMP = Y@TMP-1;
     1381     2035    5            IF Y@T2.F(Y@TMP) THEN DO;
     1382     2036    5               T$ = PINCRW(Y@S$(Y@TMP),Y@WDTMNS1);
     1383     2037    5               IF T$->Y@SRD.SRDEND.CLM>=Y@T1.S
     1384     2038    5               THEN Y@T1.F(Y@TMP) = '0'B;
     1385     2039    6               ELSE DO;
     1386     2040    6                  Y@T1.S = T$->Y@SRD.ORG.CLM+1;
     1387     2041    6                  Y@DLT = Y@DLT+T$->Y@SRD.SRDEND.CLM-T$->Y@SRD.ORG.CLM;
     1388     2042    6                  Y@T2.F(Y@TMP) = '0'B;
     1389     2043    6               END;
     1390     2044    5            END;
     1391     2045    4         END;
     1392     2046    4         IF Y@DLT>=Y@T2.S THEN DO;
     1393     2047    4            Y@T2.S = Y@DLT;
     1394     2048    4            Y@ORG = Y@T1.F;
     1395     2049    4         END;
     1396     2050    3         Y@TMP = Y@X;
     1397     2051    3      END;
     1398     2052    2   DO_MODS:;
     1399     2053
     1400     2054        /* Do the modification(s) */
     1401     2055
     1402     2056    2      IF Y@WDTPLS1~=0 THEN VLP@WINDOW.WIDTH = -Y@RQS;
     1403     2057    2      ELSE VLP@WINDOW.LENGTH = -Y@RQS;
     1404     2058    3      IF Y@RQS~=0 THEN DO WHILE Y@X>0;
     1405     2059    3         Y@X = Y@X-1;
     1406     2060    3         KV$PTR.SRD$ = Y@S$(Y@X);
     1407     2061    3         IF Y@ORG(Y@X) THEN CALL KVC$ADJWND(VLP@WINDOW);
     1408     2062    3      END;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:165  
     1409     2063    2      KV$PTR.SRD$ = Y@SRD$;
     1410     2064    2      RETURN;
     1411     2065    2   END Y$FNDSPCLNG;
     1412     2066        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:166  
     1413     2067        /*F* NAME: KVC$RLSWND.
     1414     2068             PURPOSE: Releases the screen space occuppied by an SRD. */
     1415     2069
     1416     2070    1   KVC$RLSWND: ENTRY ALTRET;
     1417     2071
     1418     2072        /* Just make a VLP@WINDOW that shrinks this SRD to nothing. */
     1419     2073
     1420     2074    1      Y@SRD$ = KV$PTR.SRD$;
     1421     2075    1      VLP@WINDOW.FWINDOW$ = KV$PTR.SRD$;
     1422     2076    2      IF %KV_MRD.USRCNT=2 THEN DO;
     1423     2077        /*
     1424     2078           If its the penultimate one, make sure the other one will recover all
     1425     2079           the space.
     1426     2080        */
     1427     2081    2         IF %KV_SRD.LNK$=ADDR(NIL) THEN Y@MVD$ = %KV_MRD.SRD$;
     1428     2082    2         ELSE Y@MVD$ = %KV_SRD.LNK$;
     1429     2083    2         IF Y@MVD$->Y@SRD.SRDEND.CLM-Y@MVD$->Y@SRD.ORG.CLM=%KV_MRD.WDT
     1430     2084    2           AND %KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM=%KV_MRD.WDT
     1431     2085    2           AND (Y@MVD$->Y@SRD.SRDEND.LIN-%KV_SRD.ORG.LIN>=%KV_MRD.DSPHEIGHT
     1432     2086    2           OR %KV_SRD.SRDEND.LIN-Y@MVD$->Y@SRD.ORG.LIN>=%KV_MRD.DSPHEIGHT)
     1433     2087    2           AND (Y@MVD$->Y@SRD.SRDEND.LIN=%KV_SRD.ORG.LIN
     1434     2088    2           OR Y@MVD$->Y@SRD.ORG.LIN=%KV_SRD.SRDEND.LIN) THEN EXIT;
     1435     2089    2         IF Y@MVD$->Y@SRD.SRDEND.LIN-Y@MVD$->Y@SRD.ORG.LIN>=%KV_MRD.DSPHEIGHT
     1436     2090    2           AND %KV_SRD.ORG.LIN=Y@MVD$->Y@SRD.ORG.LIN
     1437     2091    2           AND %KV_SRD.SRDEND.LIN=Y@MVD$->Y@SRD.SRDEND.LIN
     1438     2092    2           AND (Y@MVD$->Y@SRD.SRDEND.CLM-%KV_SRD.ORG.CLM=%KV_MRD.WDT
     1439     2093    2           OR %KV_SRD.SRDEND.CLM-Y@MVD$->Y@SRD.ORG.CLM>=%KV_MRD.WDT)
     1440     2094    2           AND (Y@MVD$->Y@SRD.SRDEND.CLM=%KV_SRD.ORG.CLM
     1441     2095    2           OR Y@MVD$->Y@SRD.ORG.CLM=%KV_SRD.SRDEND.CLM) THEN EXIT;
     1442     2096        /*
     1443     2097           It wont work.  Make it happen by putting the last one past the last column.
     1444     2098        */
     1445     2099    2         Y@MVD$->Y@SRD.LNG = %KV_MRD.DSPHEIGHT;
     1446     2100    2         Y@MVD$->Y@SRD.SRDEND.LIN = %KV_MRD.LNG;
     1447     2101    2         Y@MVD$->Y@SRD.ORG.LIN = Y@MVD$->Y@SRD.SRDEND.LIN-Y@MVD$->Y@SRD.LNG;
     1448     2102    2         %KV_SRD.ORG.LIN = Y@MVD$->Y@SRD.ORG.LIN;
     1449     2103    2         Y@MVD$->Y@SRD.SRDEND.CLM = %KV_MRD.WDT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:167  
     1450     2104    2         Y@MVD$->Y@SRD.ORG.CLM = Y@MVD$->Y@SRD.SRDEND.CLM;
     1451     2105    2         %KV_SRD.ORG.CLM = 0;
     1452     2106    2         Y@MVD$->Y@SRD.BTMRHT_PST = Y@MVD$->Y@SRD.SRDEND_PST;
     1453     2107    2         %KV_SRD.SRDEND_PST = Y@MVD$->Y@SRD.SRDEND_PST;
     1454     2108    2         Y@MVD$->Y@SRD.TOPLFT_PST = Y@MVD$->Y@SRD.ORG_PST+%BITBIN('10001'X);
     1455     2109    2         Y@MVD$->Y@SRD.WDT = 0;
     1456     2110    2      END;
     1457     2111    1      %KV_SRD.TOPLFT_PST = %KV_SRD.ORG_PST+%BITBIN('10001'X);
     1458     2112    1      %KV_SRD.BTMRHT = %KV_SRD.SRDEND;
     1459     2113    1      %KV_SRD.WDT = %KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM;
     1460     2114    1      %KV_SRD.LNG = %KV_SRD.SRDEND.LIN-%KV_SRD.ORG.LIN;
     1461     2115    1      VLP@WINDOW.LENGTH = -%KV_SRD.LNG;
     1462     2116    1      VLP@WINDOW.WIDTH = -%KV_SRD.WDT;
     1463     2117    1      VLP@WINDOW.POSITION = 0;
     1464     2118    1      %KV_SRD.OPT = '1'B;
     1465     2119    1      CALL KVC$ADJWND (VLP@WINDOW);
     1466     2120    2      IF %KV_SRD.LNG~=0 THEN DO;
     1467     2121    2         VLP@WINDOW.LENGTH = 0;       /* That didn't work - try pushing sideways */
     1468     2122    2         CALL KVC$ADJWND (VLP@WINDOW);
     1469     2123    2      END;
     1470     2124    1      RETURN;
     1471     2125    1   END KVC$ADJWND;
     1472     2126        %EOD;

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:168  
--  Include file information  --

   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KVC$ADJWND.

   Procedure KVC$ADJWND requires 2178 words for executable code.
   Procedure KVC$ADJWND requires 86 words of local(AUTO) storage.

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:169  

 Object Unit name= KVC$ADJWND                                 File name= KVC$CNC.:E05TOU
 UTS= JUL 30 '97 01:56:35.44 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none  2178    882  KVC$ADJWND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  KVC$ADJWND
     0    3F6          yes     yes      Std        1  KVC$FIXWDT
     0    408          yes     yes      Std        1  KVC$FIXPST
     0    788          yes     yes      Std        0  KVC$RLSWND

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KVV$CALUSR
         yes           Std       0 KVC$DRWBRD
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                               KV_USR_ERS                       r    G$ROS$
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:170  


      827        1        /*T***********************************************************/
      828        2        /*T*                                                         */
      829        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      830        4        /*T*                                                         */
      831        5        /*T***********************************************************/
      832        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
      833        7        KVC$ADJWND: PROC (PRM_WINDOW) ALTRET;

      7   0 000000  D380 0000 0000  xent KVC$ADJWND      LNJ,B5   X6A_AUTO_1
          0 000003       0056 0001                       DC       86,1

      834        8        /*F* NAME: KVC$ADJWND.
      835        9             PURPOSE: Adjusts the size of the current SRD according to the
      836       10             values in the parameter VLP_WINDOW, all of which are now in
      837       11             incremental form. */
      838       12
      839       13 S      %INCLUDE KV$GLB;
      840       14 S      %INCLUDE KV$GLBCTX;
      841       15 S      %INCLUDE KV_GLBCNS_E;
      842       16 S      %INCLUDE KV$INT;
      843       17 S      %INCLUDE KV$USR;
      844       18        %INCLUDE LCP_6;
      845      209
      846      210        %KV$MRD;
      847      257        %KV$MVD;
      848      301        %KV$MVD (NAME=Y@MVD, STCLASS="BASED(Y@MVD$)");
      849      345        %KV#VD_ORG_E;
      850      353        %KV$RCRLST (NAME=Y@RCRLST);
      851      389        %EQU KV_RCRLST=CHARTEXT('Y@MVD.LINLST$->Y@RCRLST');
      852      390        %KV$PTR;
      853      433        %KV$VDI;
      854      504        %KV$SRD (STCLASS="BASED(Y@SRD$)");
      855      779        %EQU KV_SRD=CHARTEXT('KV$SRD');
      856      780        %KV$SRD (NAME=Y@SRD, STCLASS="BASED(VLP@WINDOW.FWINDOW$)");
      857     1055        %KV$SSN;
      858     1134        %KV$STR;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:171  
      859     1221        %KV$USR_ERS (NAME=KV_USR_ERS, STCLASS=SYMREF);
      860     1325    1   DCL KVC$DRWBRD ENTRY;
      861     1326    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
      862     1327
      863     1328        %VLP_WINDOW (FPTN=PRM_WINDOW, STCLASS=PARAM);
      864     1372    1   DCL Y@MVD$ PTR;
      865     1373    1   DCL Y@SRD$ PTR;
      866     1374    1   DCL U$ PTR;                             /* Ptr to various things              */
      867     1375    1   DCL T$ PTR;                             /* Ptr to other things                */
      868     1376
      869     1377        %VLP_WINDOW (FPTN=VLP@WINDOW, STCLASS=AUTO, FILCHRS=0);
      870     1421    1   DCL Y@S$(0:15) PTR;
      871     1422    1   DCL Y@ORG(0:15) BIT(1) UNAL;
      872     1423    1   DCL Y@X SBIN;
      873     1424        %KV$USR_ERS (NAME=KV@USR_ERS, STCLASS=AUTO);
      874     1528        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:172  
      875     1529    1      Y@MVD$ = KV$PTR.MVD$;

   1529   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DCC6 0006                            LDB,B5   6,B6
          0 00000A  DFC7 0006                            STB,B5   Y@MVD$,AUTO

      876     1530    1      Y@SRD$ = KV$PTR.SRD$;

   1530   0 00000C  CCC6 000A                            LDB,B4   10,B6
          0 00000E  CFC7 0008                            STB,B4   Y@SRD$,AUTO

      877     1531
      878     1532        /* First make sure erases happen for existing empty windows. */
      879     1533
      880     1534    1      IF %KV_SRD.WDT=0 OR %KV_SRD.LNG=0 THEN %KV_SRD.UNKPST = '1'B;

   1534   0 000010  E844 000D                            LDR,R6   13,B4
          0 000012  6901 0005                            BEZ,R6   s:1534+8,PREL
          0 000014  D2C4 000E                            LLH,R5   14,B4
          0 000016  5981 0004                            BNEZ,R5  s:1535,PREL

   1534   0 000018  8944 001C                            LBT,'4000'X       28,B4
   1534   0 00001A       4000

      881     1535    1      IF Y@MVD.SRD$=Y@SRD$

   1535   0 00001B  BC85                                 LDB,B3   ,B5
          0 00001C  BDC7 0008                            CMB,B3   Y@SRD$,AUTO
          0 00001E  0981 0073                            BNE      s:1576,PREL

      882     1536
      883     1537        /* Not called from here (to make/take space in another window */
      884     1538
      885     1539    2      THEN IF PRM_WINDOW.POSITION~=0 THEN DO;

   1539   0 000020  ACC7 0004                            LDB,B2   @PRM_WINDOW,AUTO
          0 000022  D2C2 0004                            LLH,R5   4,B2
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:173  
          0 000024  5901 003A                            BEZ,R5   s:1561,PREL

      886     1540
      887     1541        /* This is the first time for this window. We know where to get the space. */
      888     1542
      889     1543    2         VLP@WINDOW.FWINDOW$ = PRM_WINDOW.FWINDOW$;

   1543   0 000026  9C82                                 LDB,B1   ,B2
          0 000027  9FC7 000E                            STB,B1   VLP@WINDOW,AUTO

      890     1544    2         VLP@WINDOW.POSITION = 5-PRM_WINDOW.POSITION;

   1544   0 000029  E2C2 0004                            LLH,R6   4,B2
          0 00002B  8256                                 NEG      R6
          0 00002C  6E05                                 ADV,R6   5
          0 00002D  E7C7 0012                            STH,R6   VLP@WINDOW+4,AUTO

      891     1545    2         IF VLP@WINDOW.POSITION=%G_POSITION_TOP#

   1545   0 00002F  E2C7 0012                            LLH,R6   VLP@WINDOW+4,AUTO
          0 000031  6D01                                 CMV,R6   1
          0 000032  0901 0004                            BE       s:1547,PREL
          0 000034  6D04                                 CMV,R6   4
          0 000035  0981 0011                            BNE      s:1551,PREL

      892     1546    2           OR VLP@WINDOW.POSITION=%G_POSITION_BOTTOM#
      893     1547    2         THEN IF PRM_WINDOW.LENGTH<=0

   1547   0 000037  D842 0002                            LDR,R5   2,B2
          0 000039  5A81 0006                            BLEZ,R5  s:1549,PREL
          0 00003B  C2C1 000E                            LLH,R4   14,B1
          0 00003D  C955                                 CMR,R4   R5
          0 00003E  0881 001B                            BAGE     s:1555,PREL

      894     1548    2           OR PRM_WINDOW.LENGTH>VLP@WINDOW.FWINDOW$->KV$SRD.LNG
      895     1549    2         THEN PRM_WINDOW.LENGTH=VLP@WINDOW.FWINDOW$->KV$SRD.LNG-1;

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:174  
   1549   0 000040  D2C1 000E                            LLH,R5   14,B1
          0 000042  5EFF                                 ADV,R5   -1
          0 000043  DF42 0002                            STR,R5   2,B2
          0 000045  0F81 0014                            B        s:1555,PREL

      896     1550    2         ELSE;
      897     1551    2         ELSE IF PRM_WINDOW.WIDTH<=0

   1551   0 000047  D842 0003                            LDR,R5   3,B2
          0 000049  5A81 0007                            BLEZ,R5  s:1553,PREL
          0 00004B  5801 000E                            BLZ,R5   s:1555,PREL
          0 00004D  D941 000D                            CMR,R5   13,B1
          0 00004F  0381 000A                            BLE      s:1555,PREL

      898     1552    2           OR PRM_WINDOW.WIDTH>VLP@WINDOW.FWINDOW$->KV$SRD.WDT
      899     1553    2         THEN PRM_WINDOW.WIDTH=(VLP@WINDOW.FWINDOW$->KV$SRD.SRDEND.CLM -

   1553   0 000051  C841 001B                            LDR,R4   27,B1
          0 000053  C241 0008                            SUB,R4   8,B1
          0 000055  C370 0002                            DIV,R4   2,IMO
          0 000057  D854                                 LDR,R5   R4
          0 000058  DF42 0003                            STR,R5   3,B2

      900     1554    2           VLP@WINDOW.FWINDOW$->KV$SRD.ORG.CLM)/2;
      901     1555    2         %KV_SRD.UNKPST = '0'B;  /* New windows don't erase if the cursors in it */

   1555   0 00005A  8844 001C                            LBF,'4000'X       28,B4
   1555   0 00005C       4000

      902     1556    2      END;

   1556   0 00005D  0F81 0056                            B        s:1584,PREL

      903     1557    2      ELSE DO;

      904     1558
      905     1559        /* Modify specifying an existing window as "where to get it from". */
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:175  
      906     1560
      907     1561    2         VLP@WINDOW.POSITION = 0;

   1561   0 00005F  87C7 0012                            CLH      VLP@WINDOW+4,AUTO

      908     1562    2         VLP@WINDOW.FWINDOW$ = PRM_WINDOW.FWINDOW$;

   1562   0 000061  BC82                                 LDB,B3   ,B2
          0 000062  BFC7 000E                            STB,B3   VLP@WINDOW,AUTO

      909     1563    2         IF VLP@WINDOW.FWINDOW$~=Y@SRD$ AND VLP@WINDOW.FWINDOW$~=ADDR(NIL)

   1563   0 000064  BDC7 0008                            CMB,B3   Y@SRD$,AUTO
          0 000066  0901 004D                            BE       s:1584,PREL
          0 000068  8DC7 000E                            CMN      VLP@WINDOW,AUTO
          0 00006A  0901 0049                            BE       s:1584,PREL

      910     1564    3         THEN IF PRM_WINDOW.LENGTH~=0 THEN DO;

   1564   0 00006C  E842 0002                            LDR,R6   2,B2
          0 00006E  6901 0012                            BEZ,R6   s:1570,PREL

      911     1565    3            IF Y@SRD.ORG.CLM=%KV_SRD.ORG.CLM

   1565   0 000070  D843 0008                            LDR,R5   8,B3
          0 000072  D944 0008                            CMR,R5   8,B4
          0 000074  0981 003F                            BNE      s:1584,PREL
          0 000076  C843 001B                            LDR,R4   27,B3
          0 000078  C944 001B                            CMR,R4   27,B4
          0 00007A  0981 0039                            BNE      s:1584,PREL

      912     1566    3              AND Y@SRD.SRDEND.CLM=%KV_SRD.SRDEND.CLM
      913     1567        /* Anything non-zero will do ... Y$FNDSPCLNG will get it right. */
      914     1568    3            THEN VLP@WINDOW.POSITION = %G_POSITION_TOP#;

   1568   0 00007C  3C01                                 LDV,R3   1
          0 00007D  B7C7 0012                            STH,R3   VLP@WINDOW+4,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:176  

      915     1569    3         END;

   1569   0 00007F  0F81 0034                            B        s:1584,PREL

      916     1570    2         ELSE IF Y@SRD.ORG.LIN=%KV_SRD.ORG.LIN

   1570   0 000081  D843 0007                            LDR,R5   7,B3
          0 000083  D944 0007                            CMR,R5   7,B4
          0 000085  0981 002E                            BNE      s:1584,PREL
          0 000087  C843 001A                            LDR,R4   26,B3
          0 000089  C944 001A                            CMR,R4   26,B4
          0 00008B  0981 0028                            BNE      s:1584,PREL

      917     1571    2           AND Y@SRD.SRDEND.LIN=%KV_SRD.SRDEND.LIN
      918     1572        /* Anything non-zero will do ... Y$FNDSPCWDT will get it right. */
      919     1573    2         THEN VLP@WINDOW.POSITION = %G_POSITION_LEFT#;

   1573   0 00008D  3C02                                 LDV,R3   2
          0 00008E  B7C7 0012                            STH,R3   VLP@WINDOW+4,AUTO

      920     1574    2      END;

   1574   0 000090  0F81 0023                            B        s:1584,PREL

      921     1575    2      ELSE DO;

      922     1576    2         Y@MVD$ = %KV_MRD.MVD$;

   1576   0 000092  ACC6 0008                            LDB,B2   8,B6
          0 000094  9CC2 000D                            LDB,B1   13,B2
          0 000096  9FC7 0006                            STB,B1   Y@MVD$,AUTO

      923     1577    3         DO WHILE Y@MVD.SRD$~=Y@SRD$;

   1577   0 000098  DC81                                 LDB,B5   ,B1
          0 000099  DDC7 0008                            CMB,B5   Y@SRD$,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:177  
          0 00009B  0901 000B                            BE       s:1580,PREL

      924     1578    3            Y@MVD$ = Y@MVD.LNK$;

   1578   0 00009D  ECC7 0006                            LDB,B6   Y@MVD$,AUTO
          0 00009F  DCC6 0002                            LDB,B5   2,B6
          0 0000A1  DFC7 0006                            STB,B5   Y@MVD$,AUTO

      925     1579    3         END;

   1579   0 0000A3  EC85                                 LDB,B6   ,B5
          0 0000A4  EDC7 0008                            CMB,B6   Y@SRD$,AUTO
          0 0000A6  09F7                                 BNE      s:1578,SPREL

      926     1580    2         VLP@WINDOW.POSITION = 5-PRM_WINDOW.POSITION;

   1580   0 0000A7  ECC7 0004                            LDB,B6   @PRM_WINDOW,AUTO
          0 0000A9  E2C6 0004                            LLH,R6   4,B6
          0 0000AB  8256                                 NEG      R6
          0 0000AC  6E05                                 ADV,R6   5
          0 0000AD  E7C7 0012                            STH,R6   VLP@WINDOW+4,AUTO

      927     1581    2         VLP@WINDOW.FWINDOW$ = ADDR(NIL);

   1581   0 0000AF  DB80 0000 0000                       LAB,B5   0
          0 0000B2  DFC7 000E                            STB,B5   VLP@WINDOW,AUTO

      928     1582    2      END;

      929     1583
      930     1584    1      KV@USR_ERS = KV_USR_ERS;

   1584   0 0000B4  AB80 0000 0000  xsym                 LAB,B2   KV_USR_ERS
          0 0000B7  2C00                                 LDV,R2   0
          0 0000B8  6C0E                                 LDV,R6   14
          0 0000B9  BB87                                 LAB,B3   ,AUTO
          0 0000BA  3C74                                 LDV,R3   116
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:178  
          0 0000BB  0008                                 MMM

      931     1585    1      KV@USR_ERS.TOPLFT_PST = %KV_SRD.ORG_PST+%BITBIN('10001'X);

   1585   0 0000BC  ECC7 0008                            LDB,B6   Y@SRD$,AUTO
          0 0000BE  8CC6 0007                            LDI      7,B6
          0 0000C0  8470 0001 0001                       AID      65537,IMO
          0 0000C3  8D47 003B                            SDI      KV@USR_ERS+1,AUTO

      932     1586    1      KV@USR_ERS.BTMRHT = %KV_SRD.SRDEND;

   1586   0 0000C5  8CC6 001A                            LDI      26,B6
          0 0000C7  8D47 003D                            SDI      KV@USR_ERS+3,AUTO

      933     1587
      934     1588    2      IF PRM_WINDOW.LENGTH~=0 THEN DO;

   1588   0 0000C9  DCC7 0004                            LDB,B5   @PRM_WINDOW,AUTO
          0 0000CB  D845 0002                            LDR,R5   2,B5
          0 0000CD  5901 0109                            BEZ,R5   s:1650+2,PREL

      935     1589
      936     1590        /* Adjust the length. */
      937     1591
      938     1592    2         VLP@WINDOW.LENGTH = -PRM_WINDOW.LENGTH;

   1592   0 0000CF  8255                                 NEG      R5
          0 0000D0  DF47 0010                            STR,R5   VLP@WINDOW+2,AUTO

      939     1593    2         VLP@WINDOW.WIDTH = 0;

   1593   0 0000D2  8747 0011                            CL       VLP@WINDOW+3,AUTO

      940     1594    2         IF %KV_SRD.LNG-VLP@WINDOW.LENGTH<%KV_SRD.MINLNG

   1594   0 0000D4  C2C6 000E                            LLH,R4   14,B6
          0 0000D6  C255                                 SUB,R4   R5
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:179  
          0 0000D7  B846 001E                            LDR,R3   30,B6
          0 0000D9  B570 00FF                            AND,R3   255,IMO
          0 0000DB  B954                                 CMR,R3   R4
          0 0000DC  0A81 0014                            BALE     s:1599,PREL

      941     1595    2         THEN IF %KV_SRD.OPT

   1595   0 0000DE  89C6 001C                            CMZ      28,B6
          0 0000E0  0881 000A                            BAGE     s:1597,PREL

      942     1596    2         THEN VLP@WINDOW.LENGTH = %KV_SRD.SRDEND.LIN-%KV_SRD.ORG.LIN;

   1596   0 0000E2  C846 001A                            LDR,R4   26,B6
          0 0000E4  C246 0007                            SUB,R4   7,B6
          0 0000E6  D854                                 LDR,R5   R4
          0 0000E7  DF47 0010                            STR,R5   VLP@WINDOW+2,AUTO
          0 0000E9  0F81 0007                            B        s:1599,PREL

      943     1597    2         ELSE VLP@WINDOW.LENGTH = %KV_SRD.LNG-%KV_SRD.MINLNG;

   1597   0 0000EB  C2C6 000E                            LLH,R4   14,B6
          0 0000ED  C253                                 SUB,R4   R3
          0 0000EE  D854                                 LDR,R5   R4
          0 0000EF  DF47 0010                            STR,R5   VLP@WINDOW+2,AUTO

      944     1598
      945     1599    2         IF KV$PTR.MVD$=Y@MVD$ THEN CALL Y$FNDSPCLNG;

   1599   0 0000F1  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          0 0000F4  ACC4 0006                            LDB,B2   6,B4
          0 0000F6  ADC7 0006                            CMB,B2   Y@MVD$,AUTO
          0 0000F8  0981 0004                            BNE      s:1601,PREL

   1599   0 0000FA  E3C0 031F                            LNJ,B6   s:0,PREL
          0 0000FC       0001                            DC       s:1601,PREL

      946     1600
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:180  
      947     1601    2         IF Y@MVD.ORG=%KV#VD_ORG_SE AND %KV_RCRLST.LSTRCR>=0

   1601   0 0000FD  ECC7 0006                            LDB,B6   Y@MVD$,AUTO
          0 0000FF  E2C6 0015                            LLH,R6   21,B6
          0 000101  6D05                                 CMV,R6   5
          0 000102  0981 000C                            BNE      s:1603,PREL
          0 000104  DCC6 0010                            LDB,B5   16,B6
          0 000106  D845 0005                            LDR,R5   5,B5
          0 000108  5801 0006                            BLZ,R5   s:1603,PREL

      948     1602    2         THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.FRSRCR-1;

   1602   0 00010A  D845 0004                            LDR,R5   4,B5
          0 00010C  5EFF                                 ADV,R5   -1
          0 00010D  DF45 0005                            STR,R5   5,B5

      949     1603    3         IF VLP@WINDOW.POSITION=%G_POSITION_TOP# THEN DO;

   1603   0 00010F  E2C7 0012                            LLH,R6   VLP@WINDOW+4,AUTO
          0 000111  6D01                                 CMV,R6   1
          0 000112  0981 006E                            BNE      s:1634,PREL

      950     1604
      951     1605        /* The adjustment is to be done on ORG_PST. */
      952     1606
      953     1607    3            IF Y@MVD.ORG=%KV#VD_ORG_FORM THEN VLP@WINDOW.LENGTH = 0;

   1607   0 000114  D2C6 0015                            LLH,R5   21,B6
          0 000116  5D04                                 CMV,R5   4
          0 000117  0981 0003                            BNE      s:1608,PREL

   1607   0 000119  8747 0010                            CL       VLP@WINDOW+2,AUTO

      954     1608    3            KV@USR_ERS.BTMRHT.LIN = %KV_SRD.TOPLFT.LIN-1;

   1608   0 00011B  DCC7 0008                            LDB,B5   Y@SRD$,AUTO
          0 00011D  C845 0009                            LDR,R4   9,B5
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:181  
          0 00011F  4EFF                                 ADV,R4   -1
          0 000120  CF47 003D                            STR,R4   KV@USR_ERS+3,AUTO

      955     1609    3            KV@USR_ERS.TOPLFT.LIN = KV@USR_ERS.TOPLFT.LIN+VLP@WINDOW.LENGTH;

   1609   0 000122  D847 003B                            LDR,R5   KV@USR_ERS+1,AUTO
          0 000124  DA47 0010                            ADD,R5   VLP@WINDOW+2,AUTO
          0 000126  DF47 003B                            STR,R5   KV@USR_ERS+1,AUTO

      956     1610    3            %KV_SRD.ORG.LIN = KV@USR_ERS.TOPLFT.LIN-1;

   1610   0 000128  5EFF                                 ADV,R5   -1
          0 000129  DF45 0007                            STR,R5   7,B5

      957     1611    3            %KV_SRD.TOPLFT.LIN = KV@USR_ERS.TOPLFT.LIN;

   1611   0 00012B  E847 003B                            LDR,R6   KV@USR_ERS+1,AUTO
          0 00012D  EF45 0009                            STR,R6   9,B5

      958     1612    3            IF %KV_SRD.TOPBRD

   1612   0 00012F  82C5 001C                            LB,'2000'X        28,B5
   1612   0 000131       2000
          0 000132  0581 000A                            BBF      s:1614,PREL

      959     1613    3            THEN %KV_SRD.TOPLFT.LIN = %KV_SRD.TOPLFT.LIN+%KV_SRD.HBRDSIZ;

   1613   0 000134  C845 001C                            LDR,R4   28,B5
          0 000136  4048                                 SOR,R4   8
          0 000137  C570 000F                            AND,R4   15,IMO
          0 000139  CA56                                 ADD,R4   R6
          0 00013A  E854                                 LDR,R6   R4
          0 00013B  EF45 0009                            STR,R6   9,B5

      960     1614    3            Y@X = %KV_SRD.TOPLFT.LIN-%KV_SRD.DVCLINBIS;

   1614   0 00013D  E245 0019                            SUB,R6   25,B5
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:182  
          0 00013F  EF47 0039                            STR,R6   Y@X,AUTO

      961     1615    3            IF %KV_SRD.CRT.LIN<Y@X

   1615   0 000141  E945 0015                            CMR,R6   21,B5
          0 000143  0A01 0009                            BAG      s:1618,PREL
          0 000145  E945 0017                            CMR,R6   23,B5
          0 000147  0A01 0005                            BAG      s:1618,PREL
          0 000149  E945 0013                            CMR,R6   19,B5
          0 00014B  0A81 0006                            BALE     s:1619,PREL

      962     1616    3              OR %KV_SRD.HI_NONBLN.LIN<Y@X
      963     1617    3              OR %KV_SRD.CRTVRTLINPHSLIN<Y@X
      964     1618    3            THEN %KV_SRD.UNKPST = '1'B;

   1618   0 00014D  8945 001C                            LBT,'4000'X       28,B5
   1618   0 00014F       4000
          0 000150  0F81 005A                            B        s:1644,PREL

      965     1619    3            ELSE IF %KV_SRD.DVCLINBIS>0

   1619   0 000152  C845 0019                            LDR,R4   25,B5
          0 000154  4A81 0056                            BLEZ,R4  s:1644,PREL
          0 000156  B845 0015                            LDR,R3   21,B5
          0 000158  B945 0009                            CMR,R3   9,B5
          0 00015A  0801 0007                            BAL      s:1623,PREL
          0 00015C  A845 0013                            LDR,R2   19,B5
          0 00015E  A945 0009                            CMR,R2   9,B5
          0 000160  0881 004A                            BAGE     s:1644,PREL

      966     1620    3              AND (%KV_SRD.CRT.LIN<%KV_SRD.TOPLFT.LIN
      967     1621    3              OR %KV_SRD.CRTVRTLINPHSLIN<%KV_SRD.TOPLFT.LIN)
      968     1622    4            THEN DO;

      969     1623    4               Y@X = %KV_SRD.TOPLFT.LIN

   1623   0 000162  A845 0013                            LDR,R2   19,B5
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:183  
          0 000164  A953                                 CMR,R2   R3
          0 000165  0A81 0002                            BALE     s:1623+6,PREL
          0 000167  A853                                 LDR,R2   R3
          0 000168  A245 0009                            SUB,R2   9,B5
          0 00016A  E852                                 LDR,R6   R2
          0 00016B  8256                                 NEG      R6
          0 00016C  EF47 0039                            STR,R6   Y@X,AUTO

      970     1624    4                 -MINIMUM(%KV_SRD.CRT.LIN,%KV_SRD.CRTVRTLINPHSLIN);
      971     1625    4               %KV_SRD.CRT.LIN = %KV_SRD.CRT.LIN+Y@X;

   1625   0 00016E  BA56                                 ADD,R3   R6
          0 00016F  BF45 0015                            STR,R3   21,B5

      972     1626    4               %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+Y@X;

   1626   0 000171  EA45 0013                            ADD,R6   19,B5
          0 000173  EF45 0013                            STR,R6   19,B5

      973     1627    4               %KV_SRD.HI_NONBLN.LIN = %KV_SRD.HI_NONBLN.LIN+Y@X;

   1627   0 000175  A845 0017                            LDR,R2   23,B5
          0 000177  AA47 0039                            ADD,R2   Y@X,AUTO
          0 000179  AF45 0017                            STR,R2   23,B5

      974     1628    4               %KV_SRD.DVCLINBIS = %KV_SRD.DVCLINBIS-Y@X;

   1628   0 00017B  C247 0039                            SUB,R4   Y@X,AUTO
          0 00017D  CF45 0019                            STR,R4   25,B5

      975     1629    4            END;

      976     1630    3         END;

   1630   0 00017F  0F81 002B                            B        s:1644,PREL

      977     1631    3         ELSE DO;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:184  

      978     1632        /* Adjust BTMRHT */
      979     1633
      980     1634    3            KV@USR_ERS.TOPLFT.LIN = %KV_SRD.BTMRHT.LIN+1;

   1634   0 000181  DCC7 0008                            LDB,B5   Y@SRD$,AUTO
          0 000183  D845 000B                            LDR,R5   11,B5
          0 000185  5E01                                 ADV,R5   1
          0 000186  DF47 003B                            STR,R5   KV@USR_ERS+1,AUTO

      981     1635    3            KV@USR_ERS.BTMRHT.LIN = KV@USR_ERS.BTMRHT.LIN-VLP@WINDOW.LENGTH;

   1635   0 000188  C847 003D                            LDR,R4   KV@USR_ERS+3,AUTO
          0 00018A  C247 0010                            SUB,R4   VLP@WINDOW+2,AUTO
          0 00018C  CF47 003D                            STR,R4   KV@USR_ERS+3,AUTO

      982     1636    3            %KV_SRD.BTMRHT.LIN = %KV_SRD.BTMRHT.LIN-VLP@WINDOW.LENGTH;

   1636   0 00018E  B845 000B                            LDR,R3   11,B5
          0 000190  B247 0010                            SUB,R3   VLP@WINDOW+2,AUTO
          0 000192  BF45 000B                            STR,R3   11,B5

      983     1637    3            %KV_SRD.SRDEND.LIN = KV@USR_ERS.BTMRHT.LIN;

   1637   0 000194  E847 003D                            LDR,R6   KV@USR_ERS+3,AUTO
          0 000196  EF45 001A                            STR,R6   26,B5

      984     1638    3            Y@X = %KV_SRD.BTMRHT.LIN-%KV_SRD.DVCLINBIS;

   1638   0 000198  B245 0019                            SUB,R3   25,B5
          0 00019A  BF47 0039                            STR,R3   Y@X,AUTO

      985     1639    3            IF %KV_SRD.CRT.LIN>Y@X

   1639   0 00019C  B945 0015                            CMR,R3   21,B5
          0 00019E  0801 0009                            BAL      s:1642,PREL
          0 0001A0  B945 0017                            CMR,R3   23,B5
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:185  
          0 0001A2  0801 0005                            BAL      s:1642,PREL
          0 0001A4  B945 0013                            CMR,R3   19,B5
          0 0001A6  0881 0004                            BAGE     s:1644,PREL

      986     1640    3              OR %KV_SRD.HI_NONBLN.LIN>Y@X
      987     1641    3              OR %KV_SRD.CRTVRTLINPHSLIN>Y@X
      988     1642    3            THEN %KV_SRD.UNKPST = '1'B;

   1642   0 0001A8  8945 001C                            LBT,'4000'X       28,B5
   1642   0 0001AA       4000

      989     1643    3         END;

      990     1644    2         CALL Y$FIXWDT;                    /* Decide whether to scroll           */

   1644   0 0001AB  E3C0 0164                            LNJ,B6   s:0,PREL
          0 0001AD       0001                            DC       s:1645,PREL

      991     1645    2         PRM_WINDOW.LENGTH = -VLP@WINDOW.LENGTH;

   1645   0 0001AE  ECC7 0004                            LDB,B6   @PRM_WINDOW,AUTO
          0 0001B0  E847 0010                            LDR,R6   VLP@WINDOW+2,AUTO
          0 0001B2  8256                                 NEG      R6
          0 0001B3  EF46 0002                            STR,R6   2,B6

      992     1646    2         IF VLP@WINDOW.LENGTH=0 THEN ALTRETURN;

   1646   0 0001B5  D847 0010                            LDR,R5   VLP@WINDOW+2,AUTO
          0 0001B7  5981 0004                            BNEZ,R5  s:1647,PREL

   1646   0 0001B9  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      993     1647    2         IF %KV_SRD.BTMRHT.LIN<%KV_SRD.TOPLFT.LIN THEN %KV_SRD.LNG = 0;

   1647   0 0001BC  DCC7 0008                            LDB,B5   Y@SRD$,AUTO
          0 0001BE  C845 000B                            LDR,R4   11,B5
          0 0001C0  C945 0009                            CMR,R4   9,B5
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:186  
          0 0001C2  0881 0005                            BAGE     s:1648,PREL

   1647   0 0001C4  87C5 000E                            CLH      14,B5
          0 0001C6  0F81 0006                            B        s:1649,PREL

      994     1648    2         ELSE %KV_SRD.LNG = %KV_SRD.BTMRHT.LIN-%KV_SRD.TOPLFT.LIN+1;

   1648   0 0001C8  C245 0009                            SUB,R4   9,B5
          0 0001CA  4E01                                 ADV,R4   1
          0 0001CB  C7C5 000E                            STH,R4   14,B5

      995     1649    2         IF PRM_WINDOW.LENGTH<=0 OR %KV_SRD.LNG=0 THEN GOTO NO_ERASE;

   1649   0 0001CD  E846 0002                            LDR,R6   2,B6
          0 0001CF  6A81 00FA                            BLEZ,R6  s:1715,PREL
          0 0001D1  D2C5 000E                            LLH,R5   14,B5
          0 0001D3  5901 00F6                            BEZ,R5   s:1715,PREL

      996     1650    2      END; ELSE IF PRM_WINDOW.WIDTH~=0 THEN DO;

   1650   0 0001D5  0F81 00C2                            B        s:1705,PREL

   1650   0 0001D7  C845 0003                            LDR,R4   3,B5
          0 0001D9  4901 00BE                            BEZ,R4   s:1705,PREL

      997     1651
      998     1652        /* Adjust the width. */
      999     1653
     1000     1654    2         VLP@WINDOW.WIDTH = -PRM_WINDOW.WIDTH;

   1654   0 0001DB  8254                                 NEG      R4
          0 0001DC  CF47 0011                            STR,R4   VLP@WINDOW+3,AUTO

     1001     1655    2         VLP@WINDOW.LENGTH = 0;

   1655   0 0001DE  8747 0010                            CL       VLP@WINDOW+2,AUTO

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:187  
     1002     1656    2         IF %KV_SRD.WDT-VLP@WINDOW.WIDTH<%KV_SRD.MINWDT

   1656   0 0001E0  C246 000D                            SUB,R4   13,B6
          0 0001E2  8254                                 NEG      R4
          0 0001E3  D2C6 001E                            LLH,R5   30,B6
          0 0001E5  C955                                 CMR,R4   R5
          0 0001E6  0881 0014                            BAGE     s:1661,PREL

     1003     1657    2         THEN IF %KV_SRD.OPT OR %KV_SRD.MINWDT=0

   1657   0 0001E8  89C6 001C                            CMZ      28,B6
          0 0001EA  0801 0003                            BAL      s:1658,PREL
          0 0001EC  5981 0009                            BNEZ,R5  s:1659,PREL

     1004     1658    2         THEN VLP@WINDOW.WIDTH = %KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM;

   1658   0 0001EE  C846 001B                            LDR,R4   27,B6
          0 0001F0  C246 0008                            SUB,R4   8,B6
          0 0001F2  CF47 0011                            STR,R4   VLP@WINDOW+3,AUTO
          0 0001F4  0F81 0006                            B        s:1661,PREL

     1005     1659    2         ELSE VLP@WINDOW.WIDTH = %KV_SRD.WDT-%KV_SRD.MINWDT;

   1659   0 0001F6  D246 000D                            SUB,R5   13,B6
          0 0001F8  8255                                 NEG      R5
          0 0001F9  DF47 0011                            STR,R5   VLP@WINDOW+3,AUTO

     1006     1660
     1007     1661    2         IF KV$PTR.MVD$=Y@MVD$ THEN CALL Y$FNDSPCWDT;

   1661   0 0001FB  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          0 0001FE  ACC4 0006                            LDB,B2   6,B4
          0 000200  ADC7 0006                            CMB,B2   Y@MVD$,AUTO
          0 000202  0981 0004                            BNE      s:1663,PREL

   1661   0 000204  E3C0 0229                            LNJ,B6   s:0,PREL
          0 000206       0001                            DC       s:1663,PREL
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:188  

     1008     1662
     1009     1663    2         IF Y@MVD.ORG=%KV#VD_ORG_SE AND %KV_RCRLST.LSTRCR>=0

   1663   0 000207  ECC7 0006                            LDB,B6   Y@MVD$,AUTO
          0 000209  E2C6 0015                            LLH,R6   21,B6
          0 00020B  6D05                                 CMV,R6   5
          0 00020C  0981 000C                            BNE      s:1665,PREL
          0 00020E  DCC6 0010                            LDB,B5   16,B6
          0 000210  D845 0005                            LDR,R5   5,B5
          0 000212  5801 0006                            BLZ,R5   s:1665,PREL

     1010     1664    2         THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.FRSRCR-1;

   1664   0 000214  D845 0004                            LDR,R5   4,B5
          0 000216  5EFF                                 ADV,R5   -1
          0 000217  DF45 0005                            STR,R5   5,B5

     1011     1665    3         IF VLP@WINDOW.POSITION=%G_POSITION_LEFT# THEN DO;

   1665   0 000219  E2C7 0012                            LLH,R6   VLP@WINDOW+4,AUTO
          0 00021B  6D02                                 CMV,R6   2
          0 00021C  0981 0028                            BNE      s:1680,PREL

     1012     1666
     1013     1667        /* The adjustment is to be done on ORG_PST. */
     1014     1668
     1015     1669    3            KV@USR_ERS.BTMRHT.CLM = KV@USR_ERS.TOPLFT.CLM-1;

   1669   0 00021E  D847 003C                            LDR,R5   KV@USR_ERS+2,AUTO
          0 000220  5EFF                                 ADV,R5   -1
          0 000221  DF47 003E                            STR,R5   KV@USR_ERS+4,AUTO

     1016     1670    3            KV@USR_ERS.TOPLFT.CLM = KV@USR_ERS.TOPLFT.CLM+VLP@WINDOW.WIDTH;

   1670   0 000223  C847 003C                            LDR,R4   KV@USR_ERS+2,AUTO
          0 000225  CA47 0011                            ADD,R4   VLP@WINDOW+3,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:189  
          0 000227  CF47 003C                            STR,R4   KV@USR_ERS+2,AUTO

     1017     1671    3            %KV_SRD.ORG.CLM = KV@USR_ERS.TOPLFT.CLM-1;

   1671   0 000229  DCC7 0008                            LDB,B5   Y@SRD$,AUTO
          0 00022B  4EFF                                 ADV,R4   -1
          0 00022C  CF45 0008                            STR,R4   8,B5

     1018     1672    3            %KV_SRD.TOPLFT.CLM = %KV_SRD.TOPLFT.CLM+VLP@WINDOW.WIDTH;

   1672   0 00022E  E845 000A                            LDR,R6   10,B5
          0 000230  EA47 0011                            ADD,R6   VLP@WINDOW+3,AUTO
          0 000232  EF45 000A                            STR,R6   10,B5

     1019     1673    3            IF %KV_SRD.CRT.CLM<KV@USR_ERS.TOPLFT.CLM

   1673   0 000234  D845 0016                            LDR,R5   22,B5
          0 000236  D947 003C                            CMR,R5   KV@USR_ERS+2,AUTO
          0 000238  0801 0007                            BAL      s:1675,PREL
          0 00023A  B845 0018                            LDR,R3   24,B5
          0 00023C  B947 003C                            CMR,R3   KV@USR_ERS+2,AUTO
          0 00023E  0881 0028                            BAGE     s:1688,PREL

     1020     1674    3              OR %KV_SRD.HI_NONBLN.CLM<KV@USR_ERS.TOPLFT.CLM
     1021     1675    3            THEN %KV_SRD.UNKPST = '1'B;

   1675   0 000240  8945 001C                            LBT,'4000'X       28,B5
   1675   0 000242       4000

     1022     1676    3         END;

   1676   0 000243  0F81 0023                            B        s:1688,PREL

     1023     1677    3         ELSE DO;

     1024     1678        /* Adjust BTMRHT */
     1025     1679
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:190  
     1026     1680    3            KV@USR_ERS.TOPLFT.CLM = %KV_SRD.BTMRHT.CLM+1;

   1680   0 000245  DCC7 0008                            LDB,B5   Y@SRD$,AUTO
          0 000247  D845 000C                            LDR,R5   12,B5
          0 000249  5E01                                 ADV,R5   1
          0 00024A  DF47 003C                            STR,R5   KV@USR_ERS+2,AUTO

     1027     1681    3            KV@USR_ERS.BTMRHT.CLM = KV@USR_ERS.BTMRHT.CLM-VLP@WINDOW.WIDTH;

   1681   0 00024C  C847 003E                            LDR,R4   KV@USR_ERS+4,AUTO
          0 00024E  C247 0011                            SUB,R4   VLP@WINDOW+3,AUTO
          0 000250  CF47 003E                            STR,R4   KV@USR_ERS+4,AUTO

     1028     1682    3            %KV_SRD.BTMRHT.CLM = %KV_SRD.BTMRHT.CLM-VLP@WINDOW.WIDTH;

   1682   0 000252  B845 000C                            LDR,R3   12,B5
          0 000254  B247 0011                            SUB,R3   VLP@WINDOW+3,AUTO
          0 000256  BF45 000C                            STR,R3   12,B5

     1029     1683    3            %KV_SRD.SRDEND.CLM = KV@USR_ERS.BTMRHT.CLM;

   1683   0 000258  E847 003E                            LDR,R6   KV@USR_ERS+4,AUTO
          0 00025A  EF45 001B                            STR,R6   27,B5

     1030     1684    3            IF %KV_SRD.CRT.CLM>%KV_SRD.BTMRHT.CLM

   1684   0 00025C  B945 0016                            CMR,R3   22,B5
          0 00025E  0801 0005                            BAL      s:1686,PREL
          0 000260  B945 0018                            CMR,R3   24,B5
          0 000262  0881 0004                            BAGE     s:1688,PREL

     1031     1685    3              OR %KV_SRD.HI_NONBLN.CLM>%KV_SRD.BTMRHT.CLM
     1032     1686    3            THEN %KV_SRD.UNKPST = '1'B;

   1686   0 000264  8945 001C                            LBT,'4000'X       28,B5
   1686   0 000266       4000

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:191  
     1033     1687    3         END;

     1034     1688    2         IF %KV_SRD.BTMRHT.CLM>=%KV_SRD.TOPLFT.CLM

   1688   0 000267  E845 000C                            LDR,R6   12,B5
          0 000269  E945 000A                            CMR,R6   10,B5
          0 00026B  0801 0008                            BAL      s:1690,PREL

     1035     1689    2         THEN %KV_SRD.WDT = %KV_SRD.BTMRHT.CLM-%KV_SRD.TOPLFT.CLM+1;

   1689   0 00026D  E245 000A                            SUB,R6   10,B5
          0 00026F  6E01                                 ADV,R6   1
          0 000270  EF45 000D                            STR,R6   13,B5
          0 000272  0F81 0003                            B        s:1692,PREL

     1036     1690    2         ELSE %KV_SRD.WDT = 0;

   1690   0 000274  8745 000D                            CL       13,B5

     1037     1691        /* Fix the MVDs, too. */
     1038     1692    2         CALL Y$FIXWDT;

   1692   0 000276  E3C0 0099                            LNJ,B6   s:0,PREL
          0 000278       0001                            DC       s:1693,PREL

     1039     1693    2         PRM_WINDOW.WIDTH = -VLP@WINDOW.WIDTH;

   1693   0 000279  ECC7 0004                            LDB,B6   @PRM_WINDOW,AUTO
          0 00027B  E847 0011                            LDR,R6   VLP@WINDOW+3,AUTO
          0 00027D  8256                                 NEG      R6
          0 00027E  EF46 0003                            STR,R6   3,B6

     1040     1694    2         IF VLP@WINDOW.WIDTH=0 THEN ALTRETURN;

   1694   0 000280  D847 0011                            LDR,R5   VLP@WINDOW+3,AUTO
          0 000282  5981 0004                            BNEZ,R5  s:1695,PREL

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:192  
   1694   0 000284  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1041     1695    2         IF PRM_WINDOW.WIDTH<=0 OR %KV_SRD.WDT=0 THEN GOTO NO_ERASE;

   1695   0 000287  6A81 0042                            BLEZ,R6  s:1715,PREL
          0 000289  DCC7 0008                            LDB,B5   Y@SRD$,AUTO
          0 00028B  C845 000D                            LDR,R4   13,B5
          0 00028D  4901 003C                            BEZ,R4   s:1715,PREL

     1042     1696    3         IF %KV_SRD.UNKPST THEN DO;

   1696   0 00028F  82C5 001C                            LB,'4000'X        28,B5
   1696   0 000291       4000
          0 000292  0581 0005                            BBF      s:1705,PREL

     1043     1697
     1044     1698        /* The cursor went nuts. fix it. */
     1045     1699
     1046     1700    3            %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;

   1700   0 000294  B845 000A                            LDR,R3   10,B5
          0 000296  BF45 0016                            STR,R3   22,B5

     1047     1701    3         END;

     1048     1702    2      END;

     1049     1703        /* We extended the window, and it wasn't empty.  Erase the added space. */
     1050     1704
     1051     1705    1      KV@USR_ERS.BGNPHSCLM = KV@USR_ERS.TOPLFT.CLM;

   1705   0 000298  E847 003C                            LDR,R6   KV@USR_ERS+2,AUTO
          0 00029A  EF47 003F                            STR,R6   KV@USR_ERS+5,AUTO

     1052     1706    1      KV@USR_ERS.ENDPHSCLM = KV@USR_ERS.BTMRHT.CLM;

   1706   0 00029C  D847 003E                            LDR,R5   KV@USR_ERS+4,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:193  
          0 00029E  DF47 0040                            STR,R5   KV@USR_ERS+6,AUTO

     1053     1707    1      %KV_SRD.HI_NONBLN.LIN = %KV_SRD.HI_NONBLN.LIN+127;

   1707   0 0002A0  ECC7 0008                            LDB,B6   Y@SRD$,AUTO
          0 0002A2  C846 0017                            LDR,R4   23,B6
          0 0002A4  4E7F                                 ADV,R4   127
          0 0002A5  CF46 0017                            STR,R4   23,B6

     1054     1708    2      IF %KV_SRD.BRDEXS THEN DO;

   1708   0 0002A7  82C6 000F                            LB,'0020'X        15,B6
   1708   0 0002A9       0020
          0 0002AA  0581 000C                            BBF      s:1714,PREL

     1055     1709        /* Make sure we can position to all the extension area */
     1056     1710    2         %KV_SRD.BTMRHT = %KV_SRD.SRDEND;

   1710   0 0002AC  8CC6 001A                            LDI      26,B6
          0 0002AE  8D46 000B                            SDI      11,B6

     1057     1711    2         %KV_SRD.TOPLFT_PST = %KV_SRD.ORG_PST+%BITBIN('10001'X);

   1711   0 0002B0  8CC6 0007                            LDI      7,B6
          0 0002B2  8470 0001 0001                       AID      65537,IMO
          0 0002B5  8D46 0009                            SDI      9,B6

     1058     1712        /* KVC$DRWBRD will fix up the boundaries later */
     1059     1713    2      END;

     1060     1714    1      CALL KVV$CALUSR (KV@USR_ERS);

   1714   0 0002B7  DBC7 003A                            LAB,B5   KV@USR_ERS,AUTO
          0 0002B9  DFC7 0054                            STB,B5   Y@ENDLIN+2,AUTO
          0 0002BB  BBC7 0054                            LAB,B3   Y@ENDLIN+2,AUTO
          0 0002BD  CBF0 0100                            LAB,B4   256,IMO
          0 0002BF  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:194  
          0 0002C2       0001                            DC       s:1715,PREL

     1061     1715    1      %KV_SRD.HI_NONBLN.LIN = %KV_SRD.HI_NONBLN.LIN-127;

   1715   0 0002C3  ECC7 0008                            LDB,B6   Y@SRD$,AUTO
          0 0002C5  E846 0017                            LDR,R6   23,B6
          0 0002C7  6E81                                 ADV,R6   -127
          0 0002C8  EF46 0017                            STR,R6   23,B6

   1715   0                              NO_ERASE        null
     1062     1716    1   NO_ERASE:;
     1063     1717    2      IF %KV_SRD.UNKPST THEN DO;

   1717   0 0002CA  ECC7 0008            NO_ERASE        LDB,B6   Y@SRD$,AUTO
          0 0002CC  82C6 001C                            LB,'4000'X        28,B6
          0 0002CE       4000
          0 0002CF  0581 0004                            BBF      s:1722,PREL

     1064     1718
     1065     1719        /* The cursor went nuts. fix it. */
     1066     1720    2         CALL Y$FIXPST;

   1720   0 0002D1  E3C0 00CF                            LNJ,B6   s:0,PREL
          0 0002D3       0001                            DC       s:1722,PREL

     1067     1721    2      END;

     1068     1722    1      IF PRM_WINDOW.LENGTH~=0 OR PRM_WINDOW.WIDTH~=0

   1722   0 0002D4  ECC7 0004                            LDB,B6   @PRM_WINDOW,AUTO
          0 0002D6  E846 0002                            LDR,R6   2,B6
          0 0002D8  6981 0005                            BNEZ,R6  s:1723,PREL
          0 0002DA  D846 0003                            LDR,R5   3,B6
          0 0002DC  5901 0030                            BEZ,R5   s:1730,PREL

     1069     1723    2      THEN IF Y@MVD$~=KV$PTR.MVD$ AND %KV_SRD.BRDEXS THEN DO;

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:195  
   1723   0 0002DE  DCC7 0006                            LDB,B5   Y@MVD$,AUTO
          0 0002E0  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          0 0002E3  DDC4 0006                            CMB,B5   6,B4
          0 0002E5  0901 001D                            BE       s:1729,PREL
          0 0002E7  BCC7 0008                            LDB,B3   Y@SRD$,AUTO
          0 0002E9  82C3 000F                            LB,'0020'X        15,B3
          0 0002EB       0020
          0 0002EC  0581 0016                            BBF      s:1729,PREL

     1070     1724    2         Y@SRD$ = KV$PTR.MVD$;

   1724   0 0002EE  ACC4 0006                            LDB,B2   6,B4
          0 0002F0  AFC7 0008                            STB,B2   Y@SRD$,AUTO

     1071     1725    2         KV$PTR.MVD$ = Y@MVD$;

   1725   0 0002F2  DFC4 0006                            STB,B5   6,B4

     1072     1726    2         CALL KVC$DRWBRD;

   1726   0 0002F4  CBF0 0000                            LAB,B4   0,IMO
          0 0002F6  E380 0000 0000  xent                 LNJ,B6   KVC$DRWBRD
          0 0002F9       0001                            DC       s:1727,PREL

     1073     1727    2         KV$PTR.MVD$ = Y@SRD$;

   1727   0 0002FA  ECC7 0008                            LDB,B6   Y@SRD$,AUTO
          0 0002FC  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 0002FF  EFC5 0006                            STB,B6   6,B5

     1074     1728    2      END;

   1728   0 000301  0F81 000B                            B        s:1730,PREL

     1075     1729    1      ELSE IF %KV_SRD.BRDEXS THEN %KV_SRD.BRDUPD = '1'B;

   1729   0 000303  BCC7 0008                            LDB,B3   Y@SRD$,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:196  
          0 000305  82C3 000F                            LB,'0020'X        15,B3
          0 000307       0020
          0 000308  0581 0004                            BBF      s:1730,PREL

   1729   0 00030A  8943 000F                            LBT,'0010'X       15,B3
   1729   0 00030C       0010

     1076     1730    1      RETURN;

   1730   0 00030D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1077     1731        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:197  
     1078     1732    1   Y$FIXWDT: PROC;

   1732   0 000310  EFC7 0042            Y$FIXWDT        STB,B6   KV@USR_ERS+8,AUTO

     1079     1733        %EQU Y_MVD=CHARTEXT('Y@MVD');
     1080     1734        %EQU Y_SRD=CHARTEXT('KV$SRD');
     1081     1735        %EQU Y_MRD=CHARTEXT('KV$SRD.MRD$->KV$MRD');
     1082     1736
     1083     1737        /* Notices changes in width affecting the ability to scroll */
     1084     1738
     1085     1739    2      %Y_SRD.UNKRGN = '1'B;

   1739   0 000312  DCC7 0008                            LDB,B5   Y@SRD$,AUTO
          0 000314  8945 000F                            LBT,'0002'X       15,B5
          0 000316       0002

     1086     1740    2      %Y_MVD.WDT = %Y_SRD.WDT;

   1740   0 000317  ECC7 0006                            LDB,B6   Y@MVD$,AUTO
          0 000319  E845 000D                            LDR,R6   13,B5
          0 00031B  EF46 0013                            STR,R6   19,B6

     1087     1741    3      IF %Y_SRD.BTMRHT.CLM=%Y_MRD.WDT THEN DO;

   1741   0 00031D  CC85                                 LDB,B4   ,B5
          0 00031E  D845 000C                            LDR,R5   12,B5
          0 000320  5801 001B                            BLZ,R5   s:1746,PREL
          0 000322  D944 000B                            CMR,R5   11,B4
          0 000324  0981 0017                            BNE      s:1746,PREL

     1088     1742    3         %Y_SRD.FSTERS = %Y_MRD.FSTERS;

   1742   0 000326  C844 0017                            LDR,R4   23,B4
          0 000328  4006                                 SOL,R4   6
          0 000329  CAC5 000F                            SRM,R4,'0040'X    15,B5
          0 00032B       0040

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:198  
     1089     1743    3         IF %Y_SRD.BTMRHT.CLM=%Y_SRD.WDT THEN %Y_SRD.VRTSCR = '1'B;

   1743   0 00032C  5801 000A                            BLZ,R5   s:1744,PREL
          0 00032E  D945 000D                            CMR,R5   13,B5
          0 000330  0981 0006                            BNE      s:1744,PREL

   1743   0 000332  8945 001D                            LBT,'4000'X       29,B5
   1743   0 000334       4000
          0 000335  0F81 000C                            B        s:1749,PREL

     1090     1744    3         ELSE %Y_SRD.VRTSCR = '0'B;

   1744   0 000337  8845 001D                            LBF,'4000'X       29,B5
   1744   0 000339       4000

     1091     1745    3      END; ELSE DO;

   1745   0 00033A  0F81 0007                            B        s:1749,PREL

     1092     1746    3         %Y_SRD.FSTERS = '0'B;

   1746   0 00033C  8845 000F                            LBF,'0040'X       15,B5
   1746   0 00033E       0040

     1093     1747    3         %Y_SRD.VRTSCR = '0'B;

   1747   0 00033F  8845 001D                            LBF,'4000'X       29,B5
   1747   0 000341       4000

     1094     1748    3      END;

     1095     1749    2      IF %Y_SRD.SCROLL AND (NOT %Y_SRD.VRTSCR

   1749   0 000342  82C5 000E                            LB,'0008'X        14,B5
   1749   0 000344       0008
          0 000345  0581 0024                            BBF      s:1755+2,PREL
          0 000347  82C5 001D                            LB,'4000'X        29,B5
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:199  
          0 000349       4000
          0 00034A  0581 0012                            BBF      s:1751,PREL
          0 00034C  82C4 0018                            LB,'0020'X        24,B4
          0 00034E       0020
          0 00034F  0501 001A                            BBT      s:1755+2,PREL
          0 000351  82C5 000F                            LB,'0020'X        15,B5
          0 000353       0020
          0 000354  0501 0008                            BBT      s:1751,PREL
          0 000356  E844 000A                            LDR,R6   10,B4
          0 000358  E570 00FF                            AND,R6   255,IMO
          0 00035A  6D01                                 CMV,R6   1
          0 00035B  0381 000E                            BLE      s:1755+2,PREL

     1096     1750    3        OR NOT %Y_MRD.VRTSCR AND (%Y_SRD.BRDEXS OR %Y_MRD.USRCNT>1)) THEN DO;

     1097     1751    3         %Y_SRD.VRTSCR = '0'B;

   1751   0 00035D  8845 001D                            LBF,'4000'X       29,B5
   1751   0 00035F       4000

     1098     1752    3         %Y_SRD.SCROLL = '0'B;

   1752   0 000360  8845 000E                            LBF,'0008'X       14,B5
   1752   0 000362       0008

     1099     1753    3         %Y_SRD.UNKPST = '1'B;

   1753   0 000363  8945 001C                            LBT,'4000'X       28,B5
   1753   0 000365       4000

     1100     1754    3         %Y_SRD.CRT.LIN = 0;          /* A bad value so KVC$DRWBRD notices it    */

   1754   0 000366  8745 0015                            CL       21,B5

     1101     1755    3      END; ELSE IF %Y_SRD.VRTSCR AND %Y_SRD.SAVSCROLL THEN DO;

   1755   0 000368  0F81 0034                            B        s:1762,PREL
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:200  

   1755   0 00036A  82C5 001D                            LB,'4000'X        29,B5
   1755   0 00036C       4000
          0 00036D  0581 0024                            BBF      s:1761+2,PREL
          0 00036F  82C5 000F                            LB,'0001'X        15,B5
          0 000371       0001
          0 000372  0581 001F                            BBF      s:1761+2,PREL

     1102     1756        /* Scrolling might be possible, and it was on originally */
     1103     1757    3         %Y_SRD.VRTSCR = %Y_MRD.VRTSCR;

   1757   0 000374  E844 0018                            LDR,R6   24,B4
          0 000376  6009                                 SOL,R6   9
          0 000377  EAC5 001D                            SRM,R6,'4000'X    29,B5
          0 000379       4000

     1104     1758    3         IF (%Y_SRD.BRDEXS OR %Y_MRD.DSPHEIGHT~=%Y_SRD.BTMRHT.LIN-%Y_SRD.ORG.LIN)

   1758   0 00037A  82C5 000F                            LB,'0020'X        15,B5
   1758   0 00037C       0020
          0 00037D  0501 000A                            BBT      s:1758+14,PREL
          0 00037F  E845 000B                            LDR,R6   11,B5
          0 000381  E245 0007                            SUB,R6   7,B5
          0 000383  C2C4 000A                            LLH,R4   10,B4
          0 000385  C956                                 CMR,R4   R6
          0 000386  0901 0006                            BE       s:1760,PREL
          0 000388  82C5 001D                            LB,'4000'X        29,B5
          0 00038A       4000
          0 00038B  0581 0004                            BBF      s:1761,PREL

     1105     1759    3           AND NOT %Y_SRD.VRTSCR THEN EXIT;
     1106     1760    3         %Y_SRD.SCROLL = '1'B;

   1760   0 00038D  8945 000E                            LBT,'0008'X       14,B5
   1760   0 00038F       0008

     1107     1761    2      END; ELSE IF %Y_SRD.VRTSCR THEN %Y_SRD.VRTSCR = %Y_MRD.VRTSCR;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:201  

   1761   0 000390  0F81 000C                            B        s:1762,PREL

   1761   0 000392  82C5 001D                            LB,'4000'X        29,B5
   1761   0 000394       4000
          0 000395  0581 0007                            BBF      s:1762,PREL

   1761   0 000397  E844 0018                            LDR,R6   24,B4
          0 000399  6009                                 SOL,R6   9
          0 00039A  EAC5 001D                            SRM,R6,'4000'X    29,B5
          0 00039C       4000

     1108     1762    2      RETURN;

   1762   0 00039D  ECC7 0042                            LDB,B6   KV@USR_ERS+8,AUTO
          0 00039F  C3C6 0001                            LNJ,B4   1,B6

     1109     1763        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:202  
     1110     1764    2   Y$FIXPST: ENTRY;

   1764   0 0003A1  EFC7 0042            Y$FIXPST        STB,B6   KV@USR_ERS+8,AUTO

     1111     1765
     1112     1766        /* Recovers from invalid position parameters by positioning thru SCREND */
     1113     1767
     1114     1768    3      IF %Y_MVD.ORG>%KV#VD_ORG_X364 THEN DO;

   1768   0 0003A3  DCC7 0006                            LDB,B5   Y@MVD$,AUTO
          0 0003A5  E2C5 0015                            LLH,R6   21,B5
          0 0003A7  6D02                                 CMV,R6   2
          0 0003A8  0381 000A                            BLE      s:1772,PREL

     1115     1769    3         %Y_SRD.UNKPST = '0'B;

   1769   0 0003AA  CCC7 0008                            LDB,B4   Y@SRD$,AUTO
          0 0003AC  8844 001C                            LBF,'4000'X       28,B4
          0 0003AE       4000

     1116     1770    3         RETURN;

   1770   0 0003AF  ECC7 0042                            LDB,B6   KV@USR_ERS+8,AUTO
          0 0003B1  C3C6 0001                            LNJ,B4   1,B6

     1117     1771    3      END;
     1118     1772    2      IF NOT %Y_SRD.SCROLL THEN %Y_SRD.DVCLINBIS=0;

   1772   0 0003B3  CCC7 0008                            LDB,B4   Y@SRD$,AUTO
          0 0003B5  82C4 000E                            LB,'0008'X        14,B4
          0 0003B7       0008
          0 0003B8  0501 0005                            BBT      s:1773,PREL

   1772   0 0003BA  8744 0019                            CL       25,B4
          0 0003BC  0F81 0007                            B        s:1774,PREL

     1119     1773    2      ELSE %Y_SRD.DVCLINBIS = %Y_SRD.BTMRHT.LIN-%Y_SRD.TOPLFT.LIN;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:203  

   1773   0 0003BE  D844 000B                            LDR,R5   11,B4
          0 0003C0  D244 0009                            SUB,R5   9,B4
          0 0003C2  DF44 0019                            STR,R5   25,B4

     1120     1774    2      %Y_SRD.CRT.LIN = %Y_SRD.BTMRHT.LIN-%Y_SRD.DVCLINBIS;

   1774   0 0003C4  E844 000B                            LDR,R6   11,B4
          0 0003C6  E244 0019                            SUB,R6   25,B4
          0 0003C8  EF44 0015                            STR,R6   21,B4

     1121     1775    2      IF %Y_MVD.ORG~=%KV#VD_ORG_X364

   1775   0 0003CA  D2C5 0015                            LLH,R5   21,B5
          0 0003CC  5D02                                 CMV,R5   2
          0 0003CD  0901 0006                            BE       s:1778,PREL

     1122     1776    2      THEN %Y_SRD.CRTVRTLINPHSLIN = %Y_SRD.CRT.LIN+1;

   1776   0 0003CF  6E01                                 ADV,R6   1
          0 0003D0  EF44 0013                            STR,R6   19,B4
          0 0003D2  0F81 0007                            B        s:1781,PREL

     1123     1777    3      ELSE DO;

     1124     1778    3         %Y_SRD.CRTVRTLINPHSLIN = %Y_SRD.CRT.LIN;

   1778   0 0003D4  EF44 0013                            STR,R6   19,B4

     1125     1779    3         %Y_MVD.VRTLIN = %Y_SRD.LNG;

   1779   0 0003D6  D2C4 000E                            LLH,R5   14,B4
          0 0003D8  DF45 001A                            STR,R5   26,B5

     1126     1780    3      END;

     1127     1781    2      %Y_SRD.HI_NONBLN = %Y_SRD.CRT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:204  

   1781   0 0003DA  8CC4 0015                            LDI      21,B4
          0 0003DC  8D44 0017                            SDI      23,B4

     1128     1782    2      %Y_SRD.VRTPSTOK = '0'B;

   1782   0 0003DE  8844 000E                            LBF,'0010'X       14,B4
   1782   0 0003E0       0010

     1129     1783    2      %Y_SRD.NXTNONBLNLIN = 255;

   1783   0 0003E1  D870 00FF                            LDR,R5   255,IMO
          0 0003E3  DF44 0014                            STR,R5   20,B4

     1130     1784    3      IF Y@MVD$=KV$PTR.MVD$ THEN DO;

   1784   0 0003E5  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0003E8  DDC6 0006                            CMB,B5   6,B6
          0 0003EA  0981 0007                            BNE      s:1788,PREL

     1131     1785    3         %Y_SRD.UNKPST = '0'B;

   1785   0 0003EC  8844 001C                            LBF,'4000'X       28,B4
   1785   0 0003EE       4000

     1132     1786    3         %Y_MVD.VRTCLM = 1;

   1786   0 0003EF  4C01                                 LDV,R4   1
          0 0003F0  CF45 001B                            STR,R4   27,B5

     1133     1787    3      END;

     1134     1788    2      RETURN;

   1788   0 0003F2  ECC7 0042                            LDB,B6   KV@USR_ERS+8,AUTO
          0 0003F4  C3C6 0001                            LNJ,B4   1,B6

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:205  
     1135     1789    2   END Y$FIXWDT;
     1136     1790        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:206  
     1137     1791    1   KVC$FIXWDT: ENTRY (PRM_WINDOW) ALTRET;

   1791   0 0003F6  D380 0000 0000  xent KVC$FIXWDT      LNJ,B5   X6A_AUTO_1
          0 0003F9       0056 0001                       DC       86,1

     1138     1792    1      Y@MVD$ = ADDR(PRM_WINDOW);

   1792   0 0003FB  ECC7 0004                            LDB,B6   @PRM_WINDOW,AUTO
          0 0003FD  EFC7 0006                            STB,B6   Y@MVD$,AUTO

     1139     1793    1      Y@SRD$ = Y@MVD.SRD$;

   1793   0 0003FF  DC86                                 LDB,B5   ,B6
          0 000400  DFC7 0008                            STB,B5   Y@SRD$,AUTO

     1140     1794    1      CALL Y$FIXWDT;

   1794   0 000402  E3C0 FF0D                            LNJ,B6   s:0,PREL
          0 000404       0001                            DC       s:1795,PREL

     1141     1795    1      RETURN;

   1795   0 000405  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1142     1796
     1143     1797    1   KVC$FIXPST: ENTRY (PRM_WINDOW) ALTRET;

   1797   0 000408  D380 0000 0000  xent KVC$FIXPST      LNJ,B5   X6A_AUTO_1
          0 00040B       0056 0001                       DC       86,1

     1144     1798    1      Y@MVD$ = ADDR(PRM_WINDOW);

   1798   0 00040D  ECC7 0004                            LDB,B6   @PRM_WINDOW,AUTO
          0 00040F  EFC7 0006                            STB,B6   Y@MVD$,AUTO

     1145     1799    1      Y@SRD$ = Y@MVD.SRD$;

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:207  
   1799   0 000411  DC86                                 LDB,B5   ,B6
          0 000412  DFC7 0008                            STB,B5   Y@SRD$,AUTO

     1146     1800    1      CALL Y$FIXPST;

   1800   0 000414  E3C0 FF8C                            LNJ,B6   s:0,PREL
          0 000416       0001                            DC       s:1801,PREL

     1147     1801    1      RETURN;

   1801   0 000417  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1148     1802
     1149     1803        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:208  
     1150     1804    1   Y$FNDSPCLNG: PROC;

   1804   0 00041A  EFC7 0042            Y$FNDSPCLNG     STB,B6   KV@USR_ERS+8,AUTO

     1151     1805
     1152     1806        /* Finds adjacent windows above and below, building a list of them */
     1153     1807
     1154     1808    2   DCL Y@WDTPLS1 SBIN;
     1155     1809    2   DCL Y@WDTMNS1 SBIN;
     1156     1810    2   DCL Y@TMP SBIN;
     1157     1811    2   DCL Y@RQS SBIN;
     1158     1812    2   DCL Y@DLT SBIN;
     1159     1813    2   DCL Y@DLTU REDEF Y@DLT UBIN;            /* For division by 2                  */
     1160     1814    2   DCL Y@CRT(0:1) SBIN;
     1161     1815    2   DCL Y@CRTU REDEF Y@CRT UBIN(32);
     1162     1816    2   DCL Y@AVL(0:1) SBIN;
     1163     1817    2   DCL 1 Y@T1 REDEF Y@AVL,
     1164     1818    2          2 F(0:15) BIT(1) UNAL,
     1165     1819    2          2 S SBIN;
     1166     1820    2   DCL Y@NSS(0:1) SBIN;
     1167     1821    2   DCL 1 Y@T2 REDEF Y@NSS,
     1168     1822    2          2 T SBIN,
     1169     1823    2          2 F(0:15) REDEF T BIT(1) UNAL,
     1170     1824    2          2 S SBIN;
     1171     1825    2   DCL Y@ORGCLM SBIN;
     1172     1826    2   DCL Y@ENDCLM SBIN;
     1173     1827    2   DCL Y@ORGLIN SBIN;
     1174     1828    2   DCL Y@ENDLIN SBIN;
     1175     1829    2      Y@WDTPLS1 = 0;

   1829   0 00041C  8747 0044                            CL       Y@WDTPLS1,AUTO

     1176     1830    2      Y@WDTMNS1 = 0;

   1830   0 00041E  8747 0045                            CL       Y@WDTMNS1,AUTO

     1177     1831    2      Y@TMP = %Y_MRD.LNG;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:209  

   1831   0 000420  DCC7 0008                            LDB,B5   Y@SRD$,AUTO
          0 000422  CC85                                 LDB,B4   ,B5
          0 000423  E2C4 0015                            LLH,R6   21,B4
          0 000425  EF47 0046                            STR,R6   Y@TMP,AUTO

     1178     1832    2      Y@RQS = -VLP@WINDOW.LENGTH;

   1832   0 000427  D847 0010                            LDR,R5   VLP@WINDOW+2,AUTO
          0 000429  8255                                 NEG      R5
          0 00042A  DF47 0047                            STR,R5   Y@RQS,AUTO

     1179     1833    2      GOTO COMMON;

   1833   0 00042C  0F81 0015                            B        s:1843,PREL

     1180     1834    2   Y$FNDSPCWDT: ENTRY;

   1834   0 00042E  EFC7 0042            Y$FNDSPCWDT     STB,B6   KV@USR_ERS+8,AUTO

     1181     1835
     1182     1836        /* Same as Y$FNDSPCLNG, but for width modification.
     1183     1837           This code is written for length.  For width use, pointers are adjusted
     1184     1838           to point at the other half of KV$PST items. */
     1185     1839
     1186     1840    2      Y@WDTPLS1 = 1;

   1840   0 000430  6C01                                 LDV,R6   1
          0 000431  EF47 0044                            STR,R6   Y@WDTPLS1,AUTO

     1187     1841    2      Y@WDTMNS1 = -1;

   1841   0 000433  8947 0045                            LBT,'FFFF'X       Y@WDTMNS1,AUTO
   1841   0 000435       FFFF

     1188     1842    2      Y@TMP = %Y_MRD.WDT;

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:210  
   1842   0 000436  DCC7 0008                            LDB,B5   Y@SRD$,AUTO
          0 000438  CC85                                 LDB,B4   ,B5
          0 000439  D844 000B                            LDR,R5   11,B4
          0 00043B  DF47 0046                            STR,R5   Y@TMP,AUTO

     1189     1843    2      Y@RQS = -VLP@WINDOW.WIDTH;

   1843   0 00043D  C847 0011                            LDR,R4   VLP@WINDOW+3,AUTO
          0 00043F  8254                                 NEG      R4
          0 000440  CF47 0047                            STR,R4   Y@RQS,AUTO

   1843   0                              COMMON          null
     1190     1844    2   COMMON:;
     1191     1845
     1192     1846        /* First make sure we're not trying to go off the screen. */
     1193     1847
     1194     1848    2      T$ = PINCRW(Y@SRD$,Y@WDTPLS1);

   1848   0 000442  B847 0044            COMMON          LDR,R3   Y@WDTPLS1,AUTO
          0 000444  BBB5                                 LAB,B3   ,B5,R3
          0 000445  BFC7 000C                            STB,B3   T$,AUTO

     1195     1849    2      Y@ORGLIN = T$->Y@SRD.ORG.LIN;

   1849   0 000447  E843 0007                            LDR,R6   7,B3
          0 000449  EF47 0051                            STR,R6   Y@ORGLIN,AUTO

     1196     1850    2      Y@ENDLIN = T$->Y@SRD.SRDEND.LIN;

   1850   0 00044B  D843 001A                            LDR,R5   26,B3
          0 00044D  DF47 0052                            STR,R5   Y@ENDLIN,AUTO

     1197     1851
     1198     1852    2      T$ = PINCRW(Y@SRD$,Y@WDTMNS1);

   1852   0 00044F  A847 0045                            LDR,R2   Y@WDTMNS1,AUTO
          0 000451  ABA5                                 LAB,B2   ,B5,R2
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:211  
          0 000452  AFC7 000C                            STB,B2   T$,AUTO

     1199     1853    2      Y@ORGCLM = T$->Y@SRD.ORG.CLM;

   1853   0 000454  C842 0008                            LDR,R4   8,B2
          0 000456  CF47 004F                            STR,R4   Y@ORGCLM,AUTO

     1200     1854    2      Y@ENDCLM = T$->Y@SRD.SRDEND.CLM;

   1854   0 000458  9842 001B                            LDR,R1   27,B2
          0 00045A  9F47 0050                            STR,R1   Y@ENDCLM,AUTO

     1201     1855    2      Y@ORG = '0'B;

   1855   0 00045C  8747 0038                            CL       Y@ORG,AUTO

     1202     1856    2      Y@NSS = '0'B;

   1856   0 00045E  8747 004D                            CL       Y@NSS,AUTO
          0 000460  8747 004E                            CL       Y@NSS+1,AUTO

     1203     1857    2      Y@X = 0;

   1857   0 000462  8747 0039                            CL       Y@X,AUTO

     1204     1858    2      Y@AVL(1) = Y@ORGLIN;

   1858   0 000464  EF47 004C                            STR,R6   Y@AVL+1,AUTO

     1205     1859        /* Don't acquire space outside the display area. */
     1206     1860    2      IF Y@WDTMNS1=0 THEN Y@AVL(1) = Y@AVL(1)+%Y_MRD.DSPHEIGHT-Y@TMP;

   1860   0 000466  2981 0009                            BNEZ,R2  s:1861,PREL

   1860   0 000468  E2C4 000A                            LLH,R6   10,B4
          0 00046A  EA47 004C                            ADD,R6   Y@AVL+1,AUTO
          0 00046C  E247 0046                            SUB,R6   Y@TMP,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:212  
          0 00046E  EF47 004C                            STR,R6   Y@AVL+1,AUTO

     1207     1861    2      Y@AVL(0) = Y@TMP-Y@ENDLIN;

   1861   0 000470  D247 0046                            SUB,R5   Y@TMP,AUTO
          0 000472  8255                                 NEG      R5
          0 000473  DF47 004B                            STR,R5   Y@AVL,AUTO

     1208     1862    2      Y@CRTU = %BITBIN('7FFF7FFF'X);

   1862   0 000475  8CF0 7FFF 7FFF                       LDI      2147450879,IMO
          0 000478  8D47 0049                            SDI      Y@CRT,AUTO

     1209     1863    3      IF VLP@WINDOW.POSITION~=0 THEN DO;

   1863   0 00047A  E2C7 0012                            LLH,R6   VLP@WINDOW+4,AUTO
          0 00047C  6901 0007                            BEZ,R6   s:1870,PREL

     1210     1864    3         Y@X = Y@X+1;

   1864   0 00047E  8AC7 0039                            INC      Y@X,AUTO

     1211     1865    3         Y@S$(0) = VLP@WINDOW.FWINDOW$;

   1865   0 000480  BCC7 000E                            LDB,B3   VLP@WINDOW,AUTO
          0 000482  BFC7 0018                            STB,B3   Y@S$,AUTO

     1212     1866    3      END;

     1213     1867
     1214     1868        /* Look at all the windows for adjacent ones */
     1215     1869
     1216     1870    2      T$ = %Y_MRD.MVD$;

   1870   0 000484  BCC4 000D                            LDB,B3   13,B4
          0 000486  BFC7 000C                            STB,B3   T$,AUTO

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:213  
     1217     1871    3      DO UNTIL T$=ADDR(NIL);

     1218     1872    3         VLP@WINDOW.FWINDOW$ = PINCRW(T$->Y@MVD.SRD$,Y@WDTMNS1);

   1872   0 000488  ECC7 000C                            LDB,B6   T$,AUTO
          0 00048A  DC86                                 LDB,B5   ,B6
          0 00048B  B847 0045                            LDR,R3   Y@WDTMNS1,AUTO
          0 00048D  CBB5                                 LAB,B4   ,B5,R3
          0 00048E  CFC7 000E                            STB,B4   VLP@WINDOW,AUTO

     1219     1873    3         IF T$~=Y@MVD$ AND Y@SRD.ORG.CLM<Y@ENDCLM

   1873   0 000490  EDC7 0006                            CMB,B6   Y@MVD$,AUTO
          0 000492  0901 0106                            BE       s:1950,PREL
          0 000494  E844 0008                            LDR,R6   8,B4
          0 000496  E947 0050                            CMR,R6   Y@ENDCLM,AUTO
          0 000498  0881 0100                            BAGE     s:1950,PREL
          0 00049A  D844 001B                            LDR,R5   27,B4
          0 00049C  D947 004F                            CMR,R5   Y@ORGCLM,AUTO
          0 00049E  0A81 00FA                            BALE     s:1950,PREL

     1220     1874    4           AND Y@SRD.SRDEND.CLM>Y@ORGCLM THEN DO;

     1221     1875
     1222     1876        /* It occupies some of the modification space. */
     1223     1877         /* Set a flag if it doesn't overlap an edge. */
     1224     1878
     1225     1879    4            Y@TMP = 0;

   1879   0 0004A0  8747 0046                            CL       Y@TMP,AUTO

     1226     1880    4            IF Y@SRD.ORG.CLM>=Y@ORGCLM

   1880   0 0004A2  E947 004F                            CMR,R6   Y@ORGCLM,AUTO
          0 0004A4  0801 0008                            BAL      s:1885,PREL
          0 0004A6  D947 0050                            CMR,R5   Y@ENDCLM,AUTO
          0 0004A8  0A01 0004                            BAG      s:1885,PREL
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:214  

     1227     1881    4              AND Y@SRD.SRDEND.CLM<=Y@ENDCLM THEN Y@TMP = -1;

   1881   0 0004AA  8947 0046                            LBT,'FFFF'X       Y@TMP,AUTO
   1881   0 0004AC       FFFF

     1228     1882
     1229     1883        /* Now see how close it is, and how much we can get from or put into it */
     1230     1884
     1231     1885    4            VLP@WINDOW.FWINDOW$ = PINCRW(T$->Y@MVD.SRD$,Y@WDTPLS1);

   1885   0 0004AD  DC86                                 LDB,B5   ,B6
          0 0004AE  A847 0044                            LDR,R2   Y@WDTPLS1,AUTO
          0 0004B0  BBA5                                 LAB,B3   ,B5,R2
          0 0004B1  BFC7 000E                            STB,B3   VLP@WINDOW,AUTO

     1232     1886    4            Y@DLT = Y@ENDLIN-Y@SRD.ORG.LIN; /* <=0 if past us                    */

   1886   0 0004B3  E847 0052                            LDR,R6   Y@ENDLIN,AUTO
          0 0004B5  E243 0007                            SUB,R6   7,B3
          0 0004B7  EF47 0048                            STR,R6   Y@DLT,AUTO

     1233     1887    4            IF Y@DLT>0 THEN Y@DLT = Y@ORGLIN-Y@SRD.SRDEND.LIN+1;

   1887   0 0004B9  6A81 0009                            BLEZ,R6  s:1892,PREL

   1887   0 0004BB  D847 0051                            LDR,R5   Y@ORGLIN,AUTO
          0 0004BD  D243 001A                            SUB,R5   26,B3
          0 0004BF  E855                                 LDR,R6   R5
          0 0004C0  6E01                                 ADV,R6   1
          0 0004C1  EF47 0048                            STR,R6   Y@DLT,AUTO

     1234     1888
     1235     1889        /* If its adjacent and not overlapping, see how modifyable it is.
     1236     1890           If not, we won't extend into it */
     1237     1891
     1238     1892    5            IF Y@DLTU/2=0 THEN DO;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:215  

   1892   0 0004C3  D847 0048                            LDR,R5   Y@DLT,AUTO
          0 0004C5  5041                                 SOR,R5   1
          0 0004C6  5981 00B1                            BNEZ,R5  s:1942,PREL

     1239     1893
     1240     1894        /* First check for moving ORG_PST in a form - we can't handle that. */
     1241     1895
     1242     1896    5               IF T$->Y@MVD.ORG=%KV#VD_ORG_FORM AND Y@DLT=0 THEN EXIT;

   1896   0 0004C8  D2C6 0015                            LLH,R5   21,B6
          0 0004CA  5D04                                 CMV,R5   4
          0 0004CB  0981 0003                            BNE      s:1900,PREL
          0 0004CD  6901 00A8                            BEZ,R6   s:1941,PREL

     1243     1897
     1244     1898        /* Ignore expansion into overlapping ones, Y@AVL will get set ok below. */
     1245     1899
     1246     1900    5               IF Y@SRD.SRDEND.LIN-Y@SRD.ORG.LIN>0 AND Y@TMP=0 THEN EXIT;

   1900   0 0004CF  C843 001A                            LDR,R4   26,B3
          0 0004D1  C243 0007                            SUB,R4   7,B3
          0 0004D3  4A81 0005                            BLEZ,R4  s:1903,PREL
          0 0004D5  C847 0046                            LDR,R4   Y@TMP,AUTO
          0 0004D7  4901 009E                            BEZ,R4   s:1941,PREL

     1247     1901        /* Remember the smallest adjacent one for choosing which way to go. */
     1248     1902
     1249     1903    5               Y@TMP = Y@SRD.SRDEND.LIN-Y@SRD.ORG.LIN;

   1903   0 0004D9  C843 001A                            LDR,R4   26,B3
          0 0004DB  C243 0007                            SUB,R4   7,B3
          0 0004DD  CF47 0046                            STR,R4   Y@TMP,AUTO

     1250     1904
     1251     1905        /* Ignore empty windows if this one is also empty, they'll be on t'other side */
     1252     1906
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:216  
     1253     1907    5               IF Y@TMP=0 AND Y@ENDLIN=Y@ORGLIN THEN GOTO SKIP_IT;

   1907   0 0004DF  4981 0007                            BNEZ,R4  s:1908,PREL
          0 0004E1  9847 0052                            LDR,R1   Y@ENDLIN,AUTO
          0 0004E3  9947 0051                            CMR,R1   Y@ORGLIN,AUTO
          0 0004E5  0901 00B3                            BE       s:1950,PREL

     1254     1908    5               IF Y@DLT=0 THEN Y@CRT(0) = MINIMUM(Y@CRT(0),Y@TMP);

   1908   0 0004E7  6981 000B                            BNEZ,R6  s:1909,PREL

   1908   0 0004E9  C947 0049                            CMR,R4   Y@CRT,AUTO
          0 0004EB  0A81 0003                            BALE     s:1908+8,PREL
          0 0004ED  C847 0049                            LDR,R4   Y@CRT,AUTO
          0 0004EF  CF47 0049                            STR,R4   Y@CRT,AUTO
          0 0004F1  0F81 0009                            B        s:1913,PREL

     1255     1909    5               ELSE Y@CRT(1) = MINIMUM(Y@CRT(1),Y@TMP);

   1909   0 0004F3  C947 004A                            CMR,R4   Y@CRT+1,AUTO
          0 0004F5  0A81 0003                            BALE     s:1909+6,PREL
          0 0004F7  C847 004A                            LDR,R4   Y@CRT+1,AUTO
          0 0004F9  CF47 004A                            STR,R4   Y@CRT+1,AUTO

     1256     1910
     1257     1911        /* Find out how much we can reduce it. */
     1258     1912
     1259     1913    5               IF NOT T$->Y@MVD.SRD$->Y@SRD.OPT THEN IF Y@WDTPLS1>0

   1913   0 0004FB  DC86                                 LDB,B5   ,B6
          0 0004FC  89C5 001C                            CMZ      28,B5
          0 0004FE  0801 0015                            BAL      s:1919,PREL

   1913   0 000500  2A81 000A                            BLEZ,R2  s:1915,PREL

     1260     1914    5               THEN Y@TMP = T$->Y@MVD.SRD$->Y@SRD.WDT-T$->Y@MVD.SRD$->Y@SRD.MINWDT;

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:217  
   1914   0 000502  C2C5 001E                            LLH,R4   30,B5
          0 000504  C245 000D                            SUB,R4   13,B5
          0 000506  8254                                 NEG      R4
          0 000507  CF47 0046                            STR,R4   Y@TMP,AUTO
          0 000509  0F81 000A                            B        s:1919,PREL

     1261     1915    5               ELSE Y@TMP = T$->Y@MVD.SRD$->Y@SRD.LNG-T$->Y@MVD.SRD$->Y@SRD.MINLNG;

   1915   0 00050B  C2C5 000E                            LLH,R4   14,B5
          0 00050D  9845 001E                            LDR,R1   30,B5
          0 00050F  9570 00FF                            AND,R1   255,IMO
          0 000511  C251                                 SUB,R4   R1
          0 000512  CF47 0046                            STR,R4   Y@TMP,AUTO

     1262     1916
     1263     1917        /* If there's nothing doing here, don't bother */
     1264     1918
     1265     1919    5               IF Y@TMP=0 AND Y@RQS>0

   1919   0 000514  C847 0046                            LDR,R4   Y@TMP,AUTO
          0 000516  4981 0005                            BNEZ,R4  s:1919+8,PREL
          0 000518  9847 0047                            LDR,R1   Y@RQS,AUTO
          0 00051A  1A01 005B                            BGZ,R1   s:1941,PREL
          0 00051C  9847 0039                            LDR,R1   Y@X,AUTO
          0 00051E  1D10                                 CMV,R1   16
          0 00051F  0A81 0005                            BALE     s:1925,PREL
          0 000521  DDC7 0018                            CMB,B5   Y@S$,AUTO
          0 000523  0981 0052                            BNE      s:1941,PREL

     1266     1920    5                 OR Y@X>SIZEW(Y@S$)/2 AND T$->Y@MVD.SRD$~=Y@S$(0) THEN EXIT;
     1267     1921
     1268     1922
     1269     1923        /* Check whether it is part of our session, then put in the list. */
     1270     1924
     1271     1925    5               VLP@WINDOW.FWINDOW$ = %KV_SSN.STR$;

   1925   0 000525  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:218  
          0 000528  ACC4 0002                            LDB,B2   2,B4
          0 00052A  9CC2 0004                            LDB,B1   4,B2
          0 00052C  9FC7 000E                            STB,B1   VLP@WINDOW,AUTO

     1272     1926    6               DO WHILE VLP@WINDOW.FWINDOW$~=ADDR(NIL);

   1926   0 00052E  0F81 000D                            B        s:1929,PREL

     1273     1927    6                  IF VLP@WINDOW.FWINDOW$->KV$STR.MVD$=T$ THEN EXIT;

   1927   0 000530  ECC7 000E                            LDB,B6   VLP@WINDOW,AUTO
          0 000532  DCC6 0004                            LDB,B5   4,B6
          0 000534  DDC7 000C                            CMB,B5   T$,AUTO
          0 000536  0901 0008                            BE       s:1930,PREL

     1274     1928    6                  VLP@WINDOW.FWINDOW$ = VLP@WINDOW.FWINDOW$->KV$STR.LNK$;

   1928   0 000538  CCC6 0002                            LDB,B4   2,B6
          0 00053A  CFC7 000E                            STB,B4   VLP@WINDOW,AUTO

     1275     1929    6               END;

   1929   0 00053C  8DC7 000E                            CMN      VLP@WINDOW,AUTO
          0 00053E  09F2                                 BNE      s:1927,SPREL

     1276     1930    5               IF VLP@WINDOW.FWINDOW$=ADDR(NIL) THEN Y@NSS(Y@DLT) = Y@NSS(Y@DLT)+1;

   1930   0 00053F  8DC7 000E                            CMN      VLP@WINDOW,AUTO
          0 000541  0981 0005                            BNE      s:1931,PREL

   1930   0 000543  B847 0048                            LDR,R3   Y@DLT,AUTO
          0 000545  3E4D                                 ADV,R3   77
          0 000546  8AB7                                 INC      ,AUTO,R3

     1277     1931    6               IF T$->Y@MVD.SRD$~=Y@S$(0) OR Y@X=0 THEN DO;

   1931   0 000547  ECC7 000C                            LDB,B6   T$,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:219  
          0 000549  DC86                                 LDB,B5   ,B6
          0 00054A  DDC7 0018                            CMB,B5   Y@S$,AUTO
          0 00054C  0981 0005                            BNE      s:1932,PREL
          0 00054E  E847 0039                            LDR,R6   Y@X,AUTO
          0 000550  6981 0007                            BNEZ,R6  s:1935,PREL

     1278     1932    6                  Y@S$(Y@X) = T$->Y@MVD.SRD$;

   1932   0 000552  B847 0039                            LDR,R3   Y@X,AUTO
          0 000554  3E0C                                 ADV,R3   12
          0 000555  DFB7                                 STB,B5   ,AUTO,R3

     1279     1933    6                  Y@X = Y@X+1;

   1933   0 000556  8AC7 0039                            INC      Y@X,AUTO

     1280     1934    6               END;

     1281     1935    6               IF Y@DLT~=0 THEN DO;

   1935   0 000558  E847 0048                            LDR,R6   Y@DLT,AUTO
          0 00055A  6901 0016                            BEZ,R6   s:1940+2,PREL

     1282     1936    6                  Y@DLT = Y@DLT+Y@TMP;

   1936   0 00055C  EA47 0046                            ADD,R6   Y@TMP,AUTO
          0 00055E  EF47 0048                            STR,R6   Y@DLT,AUTO

     1283     1937    6                  IF T$->Y@MVD.SRD$~=Y@S$(0)

   1937   0 000560  DDC7 0018                            CMB,B5   Y@S$,AUTO
          0 000562  0901 0009                            BE       s:1939,PREL

     1284     1938    6                  THEN Y@ORG(Y@X-1) = '1'B;

   1938   0 000564  CBC7 0037                            LAB,B4   Y@S$+31,AUTO
          0 000566  B847 0039                            LDR,R3   Y@X,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:220  
          0 000568  3E0F                                 ADV,R3   15
          0 000569  8934                                 LBT      ,B4,R3
          0 00056A  0F81 0018                            B        s:1945,PREL

     1285     1939    6                  ELSE Y@ORG(0) = '1'B;

   1939   0 00056C  8947 0038                            LBT,'8000'X       Y@ORG,AUTO
   1939   0 00056E       8000

     1286     1940    5               END; ELSE Y@DLT = -Y@TMP;

   1940   0 00056F  0F81 0013                            B        s:1945,PREL

   1940   0 000571  E847 0046                            LDR,R6   Y@TMP,AUTO
          0 000573  8256                                 NEG      R6
          0 000574  EF47 0048                            STR,R6   Y@DLT,AUTO

     1287     1941    5            END;                           /* If adjacent, non-overlapping       */

   1941   0 000576  0F81 000C                            B        s:1945,PREL

     1288     1942    4            ELSE IF T$->Y@MVD.SRD$=Y@S$(0) AND Y@X>0

   1942   0 000578  DC86                                 LDB,B5   ,B6
          0 000579  DDC7 0018                            CMB,B5   Y@S$,AUTO
          0 00057B  0981 0007                            BNE      s:1945,PREL
          0 00057D  D847 0039                            LDR,R5   Y@X,AUTO
          0 00057F  5A81 0003                            BLEZ,R5  s:1945,PREL

     1289     1943        /* Do nothing if the FWINDOW specification isn't an adjacent window. */
     1290     1944    4            THEN Y@RQS = 0;

   1944   0 000581  8747 0047                            CL       Y@RQS,AUTO

     1291     1945    4            Y@DLT = -Y@DLT;

   1945   0 000583  8256                                 NEG      R6
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:221  
          0 000584  EF47 0048                            STR,R6   Y@DLT,AUTO

     1292     1946    5            IF Y@DLT<0 THEN DO;

   1946   0 000586  6881 000C                            BGEZ,R6  s:1949+2,PREL

     1293     1947    5               Y@DLT = -Y@DLT-1;

   1947   0 000588  8656                                 CPL      R6
          0 000589  EF47 0048                            STR,R6   Y@DLT,AUTO

     1294     1948    5               IF Y@DLT<Y@AVL(1) THEN Y@AVL(1) = Y@DLT;

   1948   0 00058B  E947 004C                            CMR,R6   Y@AVL+1,AUTO
          0 00058D  0881 000B                            BAGE     s:1950,PREL

   1948   0 00058F  EF47 004C                            STR,R6   Y@AVL+1,AUTO

     1295     1949    4            END; ELSE IF Y@DLT<Y@AVL(0) THEN Y@AVL(0) = Y@DLT;

   1949   0 000591  0F81 0007                            B        s:1950,PREL

   1949   0 000593  E947 004B                            CMR,R6   Y@AVL,AUTO
          0 000595  0881 0003                            BAGE     s:1950,PREL

   1949   0 000597  EF47 004B                            STR,R6   Y@AVL,AUTO

     1296     1950    4         END;                         /* If any overlapping of modification area */

   1949   0                              SKIP_IT         null
     1297     1951    3   SKIP_IT:;
     1298     1952    3         T$ = T$->Y@MVD.LNK$;

   1952   0 000599  DCC6 0002            SKIP_IT         LDB,B5   2,B6
          0 00059B  DFC7 000C                            STB,B5   T$,AUTO

     1299     1953    3      END;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:222  

   1953   0 00059D  8DC7 000C                            CMN      T$,AUTO
          0 00059F  0981 FEE8                            BNE      s:1872,PREL

     1300     1954
     1301     1955        /* Now lets see what is available, and pick the best one */
     1302     1956
     1303     1957    2      Y@DLT = 0;

   1957   0 0005A1  8747 0048                            CL       Y@DLT,AUTO

     1304     1958    2      IF %KV_SRD.ADJTOPLFT THEN Y@DLT = Y@DLT-1;

   1958   0 0005A3  ECC7 0008                            LDB,B6   Y@SRD$,AUTO
          0 0005A5  82C6 000F                            LB,'0008'X        15,B6
          0 0005A7       0008
          0 0005A8  0581 0003                            BBF      s:1959,PREL

   1958   0 0005AA  88C7 0048                            DEC      Y@DLT,AUTO

     1305     1959    2      IF Y@NSS(0)~=Y@NSS(1)

   1959   0 0005AC  E847 004D                            LDR,R6   Y@NSS,AUTO
          0 0005AE  E947 004E                            CMR,R6   Y@NSS+1,AUTO
          0 0005B0  0901 000D                            BE       s:1962,PREL

     1306     1960    2      THEN IF Y@NSS(0)=0 THEN Y@DLT = 0;

   1960   0 0005B2  6981 0005                            BNEZ,R6  s:1961,PREL

   1960   0 0005B4  8747 0048                            CL       Y@DLT,AUTO
          0 0005B6  0F81 0007                            B        s:1962,PREL

     1307     1961    2      ELSE IF Y@NSS(1)=0 THEN Y@DLT = Y@DLT-1;

   1961   0 0005B8  D847 004E                            LDR,R5   Y@NSS+1,AUTO
          0 0005BA  5981 0003                            BNEZ,R5  s:1962,PREL
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:223  

   1961   0 0005BC  88C7 0048                            DEC      Y@DLT,AUTO

     1308     1962    3      IF Y@RQS>0 AND Y@AVL(0)~=Y@AVL(1) THEN DO;

   1962   0 0005BE  D847 0047                            LDR,R5   Y@RQS,AUTO
          0 0005C0  5A81 0024                            BLEZ,R5  s:1969,PREL
          0 0005C2  C847 004B                            LDR,R4   Y@AVL,AUTO
          0 0005C4  C947 004C                            CMR,R4   Y@AVL+1,AUTO
          0 0005C6  0901 001E                            BE       s:1969,PREL

     1309     1963    3         IF Y@AVL(1)=0 THEN Y@DLT = 0;

   1963   0 0005C8  B847 004C                            LDR,R3   Y@AVL+1,AUTO
          0 0005CA  3981 0003                            BNEZ,R3  s:1964,PREL

   1963   0 0005CC  8747 0048                            CL       Y@DLT,AUTO

     1310     1964    3         IF Y@AVL(0)=0 THEN Y@DLT = Y@DLT-1;

   1964   0 0005CE  4981 0003                            BNEZ,R4  s:1965,PREL

   1964   0 0005D0  88C7 0048                            DEC      Y@DLT,AUTO

     1311     1965    3         IF MINIMUM(Y@AVL(0),Y@AVL(1))>=Y@RQS THEN EXIT;

   1965   0 0005D2  B954                                 CMR,R3   R4
          0 0005D3  0A81 0002                            BALE     s:1965+4,PREL
          0 0005D5  B854                                 LDR,R3   R4
          0 0005D6  B955                                 CMR,R3   R5
          0 0005D7  0881 000B                            BAGE     s:1968,PREL

     1312     1966    3         IF Y@AVL(0)>Y@AVL(1) THEN Y@DLT = 0;

   1966   0 0005D9  C947 004C                            CMR,R4   Y@AVL+1,AUTO
          0 0005DB  0A81 0005                            BALE     s:1967,PREL

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:224  
   1966   0 0005DD  8747 0048                            CL       Y@DLT,AUTO
          0 0005DF  0F81 001F                            B        s:1974,PREL

     1313     1967    3         ELSE Y@DLT = Y@DLT-1;

   1967   0 0005E1  88C7 0048                            DEC      Y@DLT,AUTO

     1314     1968    3      END; ELSE DO;

   1968   0 0005E3  0F81 001B                            B        s:1974,PREL

     1315     1969    3         IF Y@CRT(0)=%BITBIN('7FFF'X)

   1969   0 0005E5  C847 0049                            LDR,R4   Y@CRT,AUTO
          0 0005E7  C970 7FFF                            CMR,R4   32767,IMO
          0 0005E9  0981 000D                            BNE      s:1972,PREL

     1316     1970    3         THEN IF Y@CRT(0)=Y@CRT(1) THEN Y@RQS = 0; /* No shrink if no others     */

   1970   0 0005EB  C947 004A                            CMR,R4   Y@CRT+1,AUTO
          0 0005ED  0981 0005                            BNE      s:1971,PREL

   1970   0 0005EF  8747 0047                            CL       Y@RQS,AUTO
          0 0005F1  0F81 000D                            B        s:1974,PREL

     1317     1971    3         ELSE Y@DLT = Y@DLT-1;

   1971   0 0005F3  88C7 0048                            DEC      Y@DLT,AUTO
          0 0005F5  0F81 0009                            B        s:1974,PREL

     1318     1972    3         ELSE IF Y@CRT(1)=%BITBIN('7FFF'X) THEN Y@DLT = 0;

   1972   0 0005F7  B847 004A                            LDR,R3   Y@CRT+1,AUTO
          0 0005F9  B970 7FFF                            CMR,R3   32767,IMO
          0 0005FB  0981 0003                            BNE      s:1974,PREL

   1972   0 0005FD  8747 0048                            CL       Y@DLT,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:225  

     1319     1973    3      END;

     1320     1974    2      IF VLP@WINDOW.POSITION=0 AND Y@DLT=0

   1974   0 0005FF  D2C7 0012                            LLH,R5   VLP@WINDOW+4,AUTO
          0 000601  5981 0005                            BNEZ,R5  s:1974+8,PREL
          0 000603  C847 0048                            LDR,R4   Y@DLT,AUTO
          0 000605  4901 0007                            BEZ,R4   s:1976,PREL
          0 000607  5901 0028                            BEZ,R5   s:1983,PREL
          0 000609  89C7 0038                            CMZ      Y@ORG,AUTO
          0 00060B  0801 0024                            BAL      s:1983,PREL

     1321     1975    3        OR VLP@WINDOW.POSITION~=0 AND NOT Y@ORG(0) THEN DO;

     1322     1976    3         IF Y@AVL(0)<Y@RQS THEN Y@RQS = Y@AVL(0);

   1976   0 00060D  C847 004B                            LDR,R4   Y@AVL,AUTO
          0 00060F  C947 0047                            CMR,R4   Y@RQS,AUTO
          0 000611  0881 0003                            BAGE     s:1977,PREL

   1976   0 000613  CF47 0047                            STR,R4   Y@RQS,AUTO

     1323     1977    3         Y@T2.T = 0;                  /* Make a mask for the ones that matter    */

   1977   0 000615  8747 004D                            CL       Y@NSS,AUTO

     1324     1978    3         Y@T2.F(Y@X-1) = '1'B;

   1978   0 000617  CBC7 004C                            LAB,B4   Y@AVL+1,AUTO
          0 000619  B847 0039                            LDR,R3   Y@X,AUTO
          0 00061B  3E0F                                 ADV,R3   15
          0 00061C  8934                                 LBT      ,B4,R3

     1325     1979    3         Y@T2.T = -Y@T2.T;                 /* Y@T2.T and Y@T2.F are REDEFs       */

   1979   0 00061D  E847 004D                            LDR,R6   Y@NSS,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:226  
          0 00061F  8256                                 NEG      R6
          0 000620  EF47 004D                            STR,R6   Y@NSS,AUTO

     1326     1980    3         Y@ORG = Y@ORG\Y@T2.F;             /* Pick only the BTMRHT ones.         */

   1980   0 000622  A847 0038                            LDR,R2   Y@ORG,AUTO
          0 000624  A647 004D                            XOR,R2   Y@NSS,AUTO
          0 000626  AF47 0038                            STR,R2   Y@ORG,AUTO

     1327     1981    3         VLP@WINDOW.POSITION = %G_POSITION_BOTTOM#-Y@WDTPLS1;

   1981   0 000628  9847 0044                            LDR,R1   Y@WDTPLS1,AUTO
          0 00062A  8251                                 NEG      R1
          0 00062B  1E04                                 ADV,R1   4
          0 00062C  97C7 0012                            STH,R1   VLP@WINDOW+4,AUTO

     1328     1982    3      END; ELSE DO;

   1982   0 00062E  0F81 0012                            B        s:1991,PREL

     1329     1983    3         IF Y@AVL(1)<Y@RQS THEN Y@RQS = Y@AVL(1);

   1983   0 000630  C847 004C                            LDR,R4   Y@AVL+1,AUTO
          0 000632  C947 0047                            CMR,R4   Y@RQS,AUTO
          0 000634  0881 0003                            BAGE     s:1984,PREL

   1983   0 000636  CF47 0047                            STR,R4   Y@RQS,AUTO

     1330     1984    3         VLP@WINDOW.POSITION = %G_POSITION_TOP#+Y@WDTPLS1;

   1984   0 000638  B847 0044                            LDR,R3   Y@WDTPLS1,AUTO
          0 00063A  3E01                                 ADV,R3   1
          0 00063B  B7C7 0012                            STH,R3   VLP@WINDOW+4,AUTO

     1331     1985    3         Y@CRT(0) = Y@CRT(1);

   1985   0 00063D  D847 004A                            LDR,R5   Y@CRT+1,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:227  
          0 00063F  DF47 0049                            STR,R5   Y@CRT,AUTO

     1332     1986    3      END;

     1333     1987
     1334     1988        /* If we're shrinking from empty windows, make sure we only do one for each
     1335     1989           position along the edge, since they all look ok. */
     1336     1990
     1337     1991    2      IF Y@CRT(0)>0 OR Y@X=1 THEN GOTO DO_MODS;

   1991   0 000641  D847 0049                            LDR,R5   Y@CRT,AUTO
          0 000643  5A01 0101                            BGZ,R5   s:2051,PREL
          0 000645  C847 0039                            LDR,R4   Y@X,AUTO
          0 000647  4D01                                 CMV,R4   1
          0 000648  0901 00FC                            BE       s:2051,PREL

     1338     1992        /* First sort by starting position along the edge,
     1339     1993           noting the empty ones in Y@T1.F, and resetting Y@ORG for non_empty ones that
     1340     1994           overlap empty ones, and for empty ones that overlap the edges of this one. */
     1341     1995    2      Y@T1 = '0'B;

   1995   0 00064A  8747 004B                            CL       Y@AVL,AUTO
          0 00064C  8747 004C                            CL       Y@AVL+1,AUTO

     1342     1996    3      DO Y@TMP=0 TO Y@X-1;

   1996   0 00064E  8747 0046                            CL       Y@TMP,AUTO
          0 000650  0F81 008E                            B        s:2022+2,PREL

     1343     1997    4         IF Y@ORG(Y@TMP) THEN DO;

   1997   0 000652  EBC7 0038                            LAB,B6   Y@ORG,AUTO
          0 000654  B847 0046                            LDR,R3   Y@TMP,AUTO
          0 000656  82B6                                 LB       ,B6,R3
          0 000657  0581 0085                            BBF      s:2022,PREL

     1344     1998    4            U$ = PINCRW(Y@S$(Y@TMP),Y@WDTMNS1);
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:228  

   1998   0 000659  3E0C                                 ADV,R3   12
          0 00065A  ECB7                                 LDB,B6   ,AUTO,R3
          0 00065B  A847 0045                            LDR,R2   Y@WDTMNS1,AUTO
          0 00065D  DBA6                                 LAB,B5   ,B6,R2
          0 00065E  DFC7 000A                            STB,B5   U$,AUTO

     1345     1999    5            DO Y@DLT=Y@TMP+1 TO Y@X-1;

   1999   0 000660  E847 0046                            LDR,R6   Y@TMP,AUTO
          0 000662  6E01                                 ADV,R6   1
          0 000663  EF47 0048                            STR,R6   Y@DLT,AUTO
          0 000665  0F81 0024                            B        s:2007+2,PREL

     1346     2000    5               IF Y@ORG(Y@DLT)

   2000   0 000667  EBC7 0038                            LAB,B6   Y@ORG,AUTO
          0 000669  B847 0048                            LDR,R3   Y@DLT,AUTO
          0 00066B  82B6                                 LB       ,B6,R3
          0 00066C  0581 001B                            BBF      s:2007,PREL

     1347     2001    5               THEN IF PINCRW(Y@S$(Y@DLT),Y@WDTMNS1)->Y@SRD.ORG.CLM

   2001   0 00066E  3E0C                                 ADV,R3   12
          0 00066F  ECB7                                 LDB,B6   ,AUTO,R3
          0 000670  A847 0045                            LDR,R2   Y@WDTMNS1,AUTO
          0 000672  2E08                                 ADV,R2   8
          0 000673  DCC7 000A                            LDB,B5   U$,AUTO
          0 000675  E826                                 LDR,R6   ,B6,R2
          0 000676  E945 0008                            CMR,R6   8,B5
          0 000678  0881 000F                            BAGE     s:2007,PREL

     1348     2002    6                 < U$->Y@SRD.ORG.CLM THEN DO;

     1349     2003    6                  T$ = U$;

   2003   0 00067A  DFC7 000C                            STB,B5   T$,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:229  

     1350     2004    6                  U$ = PINCRW(Y@S$(Y@DLT),Y@WDTMNS1);

   2004   0 00067C  9847 0045                            LDR,R1   Y@WDTMNS1,AUTO
          0 00067E  CB96                                 LAB,B4   ,B6,R1
          0 00067F  CFC7 000A                            STB,B4   U$,AUTO

     1351     2005    6                  Y@S$(Y@DLT) = PINCRW(T$,Y@WDTPLS1);

   2005   0 000681  B847 0044                            LDR,R3   Y@WDTPLS1,AUTO
          0 000683  EBB5                                 LAB,B6   ,B5,R3
          0 000684  B847 0048                            LDR,R3   Y@DLT,AUTO
          0 000686  3E0C                                 ADV,R3   12
          0 000687  EFB7                                 STB,B6   ,AUTO,R3

     1352     2006    6               END;                        /* if CLM(Y@DLT) < CLM(Y@TMP)         */

     1353     2007    5            END;                           /* index on Y@DLT                     */

   2007   0 000688  8AC7 0048                            INC      Y@DLT,AUTO
          0 00068A  E847 0048                            LDR,R6   Y@DLT,AUTO
          0 00068C  E947 0039                            CMR,R6   Y@X,AUTO
          0 00068E  0859                                 BAL      s:2000,SPREL

     1354     2008    4            Y@S$(Y@TMP) = PINCRW(U$,Y@WDTPLS1);

   2008   0 00068F  ECC7 000A                            LDB,B6   U$,AUTO
          0 000691  B847 0044                            LDR,R3   Y@WDTPLS1,AUTO
          0 000693  DBB6                                 LAB,B5   ,B6,R3
          0 000694  A847 0046                            LDR,R2   Y@TMP,AUTO
          0 000696  2E0C                                 ADV,R2   12
          0 000697  DFA7                                 STB,B5   ,AUTO,R2

     1355     2009    4            T$ = PINCRW(Y@S$(Y@TMP),Y@WDTPLS1);

   2009   0 000698  CBB5                                 LAB,B4   ,B5,R3
          0 000699  CFC7 000C                            STB,B4   T$,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:230  

     1356     2010    5            IF T$->Y@SRD.SRDEND.LIN=T$->Y@SRD.ORG.LIN THEN DO;

   2010   0 00069B  D844 001A                            LDR,R5   26,B4
          0 00069D  D944 0007                            CMR,R5   7,B4
          0 00069F  0981 002A                            BNE      s:2018,PREL

     1357     2011    5               Y@T1.F(Y@TMP) = '1'B;

   2011   0 0006A1  BBC7 004B                            LAB,B3   Y@AVL,AUTO
          0 0006A3  9847 0046                            LDR,R1   Y@TMP,AUTO
          0 0006A5  8913                                 LBT      ,B3,R1

     1358     2012    5               IF Y@TMP>0 AND NOT Y@T1.F(Y@TMP-1)

   2012   0 0006A6  1A81 0010                            BLEZ,R1  s:2015,PREL
          0 0006A8  BBC7 004A                            LAB,B3   Y@CRT+1,AUTO
          0 0006AA  1E0F                                 ADV,R1   15
          0 0006AB  8293                                 LB       ,B3,R1
          0 0006AC  0501 000A                            BBT      s:2015,PREL
          0 0006AE  C847 004C                            LDR,R4   Y@AVL+1,AUTO
          0 0006B0  C946 0008                            CMR,R4   8,B6
          0 0006B2  0A81 0004                            BALE     s:2015,PREL

     1359     2013    5                 AND Y@T1.S>U$->Y@SRD.ORG.CLM
     1360     2014    5               THEN Y@ORG(Y@TMP-1) = '0'B; /* This empty overlaps that non_empty. */

   2014   0 0006B4  BBC7 0037                            LAB,B3   Y@S$+31,AUTO
          0 0006B6  8813                                 LBF      ,B3,R1

     1361     2015    5               IF U$->Y@SRD.ORG.CLM<Y@ORGCLM OR U$->Y@SRD.SRDEND.CLM>Y@ENDCLM

   2015   0 0006B7  C846 0008                            LDR,R4   8,B6
          0 0006B9  C947 004F                            CMR,R4   Y@ORGCLM,AUTO
          0 0006BB  0801 0007                            BAL      s:2016,PREL
          0 0006BD  9846 001B                            LDR,R1   27,B6
          0 0006BF  9947 0050                            CMR,R1   Y@ENDCLM,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:231  
          0 0006C1  0A81 0013                            BALE     s:2020,PREL

     1362     2016    5               THEN Y@ORG(Y@TMP) = '0'B;

   2016   0 0006C3  BBC7 0038                            LAB,B3   Y@ORG,AUTO
          0 0006C5  9847 0046                            LDR,R1   Y@TMP,AUTO
          0 0006C7  8813                                 LBF      ,B3,R1

     1363     2017    5            END;

   2017   0 0006C8  0F81 000C                            B        s:2020,PREL

     1364     2018    4            ELSE IF Y@T1.S>U$->Y@SRD.ORG.CLM

   2018   0 0006CA  C847 004C                            LDR,R4   Y@AVL+1,AUTO
          0 0006CC  C946 0008                            CMR,R4   8,B6
          0 0006CE  0A81 0006                            BALE     s:2020,PREL

     1365     2019    4            THEN Y@ORG(Y@TMP) = '0'B; /* This non_empty overlaps that empty.     */

   2019   0 0006D0  BBC7 0038                            LAB,B3   Y@ORG,AUTO
          0 0006D2  9847 0046                            LDR,R1   Y@TMP,AUTO
          0 0006D4  8813                                 LBF      ,B3,R1

     1366     2020    4            IF U$->Y@SRD.SRDEND.CLM>Y@T1.S THEN Y@T1.S = U$->Y@SRD.SRDEND.CLM;

   2020   0 0006D5  C846 001B                            LDR,R4   27,B6
          0 0006D7  C947 004C                            CMR,R4   Y@AVL+1,AUTO
          0 0006D9  0A81 0003                            BALE     s:2022,PREL

   2020   0 0006DB  CF47 004C                            STR,R4   Y@AVL+1,AUTO

     1367     2021    4         END;                              /* if Y@ORG(Y@TMP)                    */

     1368     2022    3      END; /* index on Y@TMP */

   2022   0 0006DD  8AC7 0046                            INC      Y@TMP,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:232  
          0 0006DF  E847 0046                            LDR,R6   Y@TMP,AUTO
          0 0006E1  E947 0039                            CMR,R6   Y@X,AUTO
          0 0006E3  0801 FF6E                            BAL      s:1997,PREL

     1369     2023    2      IF NOT Y@ORG THEN Y@RQS = 0;         /* Nothing left to adjust             */

   2023   0 0006E5  D847 0038                            LDR,R5   Y@ORG,AUTO
          0 0006E7  5981 0003                            BNEZ,R5  s:2024,PREL

   2023   0 0006E9  8747 0047                            CL       Y@RQS,AUTO

     1370     2024    2      IF NOT Y@ORG OR NOT Y@T1.F THEN GOTO DO_MODS;

   2024   0 0006EB  5901 0059                            BEZ,R5   s:2051,PREL
          0 0006ED  C847 004B                            LDR,R4   Y@AVL,AUTO
          0 0006EF  4901 0055                            BEZ,R4   s:2051,PREL

     1371     2025        /* Now go through and pick out a set that doesn't overlap. */
     1372     2026    2      Y@T2.F = Y@ORG;                      /* Pick one with a maximal effect     */

   2026   0 0006F1  DF47 004D                            STR,R5   Y@NSS,AUTO

     1373     2027    2      Y@T2.S = 0;

   2027   0 0006F3  8747 004E                            CL       Y@NSS+1,AUTO

     1374     2028    2      Y@ORG = '0'B;

   2028   0 0006F5  8747 0038                            CL       Y@ORG,AUTO

     1375     2029    3      DO UNTIL NOT Y@T2.F;

     1376     2030    3         Y@T1.F = Y@T2.F;

   2030   0 0006F7  E847 004D                            LDR,R6   Y@NSS,AUTO
          0 0006F9  EF47 004B                            STR,R6   Y@AVL,AUTO

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:233  
     1377     2031    3         Y@DLT = 0;

   2031   0 0006FB  8747 0048                            CL       Y@DLT,AUTO

     1378     2032    3         Y@T1.S = 511;

   2032   0 0006FD  D870 01FF                            LDR,R5   511,IMO
          0 0006FF  DF47 004C                            STR,R5   Y@AVL+1,AUTO

     1379     2033    4         DO UNTIL Y@TMP=0;

     1380     2034    4            Y@TMP = Y@TMP-1;

   2034   0 000701  88C7 0046                            DEC      Y@TMP,AUTO

     1381     2035    5            IF Y@T2.F(Y@TMP) THEN DO;

   2035   0 000703  EBC7 004D                            LAB,B6   Y@NSS,AUTO
          0 000705  B847 0046                            LDR,R3   Y@TMP,AUTO
          0 000707  82B6                                 LB       ,B6,R3
          0 000708  0581 0025                            BBF      s:2045,PREL

     1382     2036    5               T$ = PINCRW(Y@S$(Y@TMP),Y@WDTMNS1);

   2036   0 00070A  3E0C                                 ADV,R3   12
          0 00070B  ECB7                                 LDB,B6   ,AUTO,R3
          0 00070C  A847 0045                            LDR,R2   Y@WDTMNS1,AUTO
          0 00070E  DBA6                                 LAB,B5   ,B6,R2
          0 00070F  DFC7 000C                            STB,B5   T$,AUTO

     1383     2037    5               IF T$->Y@SRD.SRDEND.CLM>=Y@T1.S

   2037   0 000711  E845 001B                            LDR,R6   27,B5
          0 000713  E947 004C                            CMR,R6   Y@AVL+1,AUTO
          0 000715  0801 0008                            BAL      s:2040,PREL

     1384     2038    5               THEN Y@T1.F(Y@TMP) = '0'B;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:234  

   2038   0 000717  CBC7 004B                            LAB,B4   Y@AVL,AUTO
          0 000719  9847 0046                            LDR,R1   Y@TMP,AUTO
          0 00071B  8814                                 LBF      ,B4,R1
          0 00071C  0F81 0011                            B        s:2045,PREL

     1385     2039    6               ELSE DO;

     1386     2040    6                  Y@T1.S = T$->Y@SRD.ORG.CLM+1;

   2040   0 00071E  D845 0008                            LDR,R5   8,B5
          0 000720  5E01                                 ADV,R5   1
          0 000721  DF47 004C                            STR,R5   Y@AVL+1,AUTO

     1387     2041    6                  Y@DLT = Y@DLT+T$->Y@SRD.SRDEND.CLM-T$->Y@SRD.ORG.CLM;

   2041   0 000723  EA47 0048                            ADD,R6   Y@DLT,AUTO
          0 000725  E245 0008                            SUB,R6   8,B5
          0 000727  EF47 0048                            STR,R6   Y@DLT,AUTO

     1388     2042    6                  Y@T2.F(Y@TMP) = '0'B;

   2042   0 000729  CBC7 004D                            LAB,B4   Y@NSS,AUTO
          0 00072B  9847 0046                            LDR,R1   Y@TMP,AUTO
          0 00072D  8814                                 LBF      ,B4,R1

     1389     2043    6               END;

     1390     2044    5            END;

     1391     2045    4         END;

   2045   0 00072E  E847 0046                            LDR,R6   Y@TMP,AUTO
          0 000730  69D1                                 BNEZ,R6  s:2034,SPREL

     1392     2046    4         IF Y@DLT>=Y@T2.S THEN DO;

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:235  
   2046   0 000731  D847 0048                            LDR,R5   Y@DLT,AUTO
          0 000733  D947 004E                            CMR,R5   Y@NSS+1,AUTO
          0 000735  0801 0007                            BAL      s:2050,PREL

     1393     2047    4            Y@T2.S = Y@DLT;

   2047   0 000737  DF47 004E                            STR,R5   Y@NSS+1,AUTO

     1394     2048    4            Y@ORG = Y@T1.F;

   2048   0 000739  C847 004B                            LDR,R4   Y@AVL,AUTO
          0 00073B  CF47 0038                            STR,R4   Y@ORG,AUTO

     1395     2049    4         END;

     1396     2050    3         Y@TMP = Y@X;

   2050   0 00073D  E847 0039                            LDR,R6   Y@X,AUTO
          0 00073F  EF47 0046                            STR,R6   Y@TMP,AUTO

     1397     2051    3      END;

   2051   0 000741  C847 004D                            LDR,R4   Y@NSS,AUTO
          0 000743  4981 FFB3                            BNEZ,R4  s:2030,PREL

   2051   0                              DO_MODS         null
     1398     2052    2   DO_MODS:;
     1399     2053
     1400     2054        /* Do the modification(s) */
     1401     2055
     1402     2056    2      IF Y@WDTPLS1~=0 THEN VLP@WINDOW.WIDTH = -Y@RQS;

   2056   0 000745  E847 0044            DO_MODS         LDR,R6   Y@WDTPLS1,AUTO
          0 000747  6901 0008                            BEZ,R6   s:2057,PREL

   2056   0 000749  D847 0047                            LDR,R5   Y@RQS,AUTO
          0 00074B  8255                                 NEG      R5
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:236  
          0 00074C  DF47 0011                            STR,R5   VLP@WINDOW+3,AUTO
          0 00074E  0F81 0006                            B        s:2058,PREL

     1403     2057    2      ELSE VLP@WINDOW.LENGTH = -Y@RQS;

   2057   0 000750  D847 0047                            LDR,R5   Y@RQS,AUTO
          0 000752  8255                                 NEG      R5
          0 000753  DF47 0010                            STR,R5   VLP@WINDOW+2,AUTO

     1404     2058    3      IF Y@RQS~=0 THEN DO WHILE Y@X>0;

   2058   0 000755  C847 0047                            LDR,R4   Y@RQS,AUTO
          0 000757  4901 0025                            BEZ,R4   s:2063,PREL

   2058   0 000759  B847 0039                            LDR,R3   Y@X,AUTO
          0 00075B  3A81 0021                            BLEZ,R3  s:2063,PREL

     1405     2059    3         Y@X = Y@X-1;

   2059   0 00075D  88C7 0039                            DEC      Y@X,AUTO

     1406     2060    3         KV$PTR.SRD$ = Y@S$(Y@X);

   2060   0 00075F  B847 0039                            LDR,R3   Y@X,AUTO
          0 000761  3E0C                                 ADV,R3   12
          0 000762  ECB7                                 LDB,B6   ,AUTO,R3
          0 000763  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 000766  EFC5 000A                            STB,B6   10,B5

     1407     2061    3         IF Y@ORG(Y@X) THEN CALL KVC$ADJWND(VLP@WINDOW);

   2061   0 000768  CBC7 0038                            LAB,B4   Y@ORG,AUTO
          0 00076A  A847 0039                            LDR,R2   Y@X,AUTO
          0 00076C  82A4                                 LB       ,B4,R2
          0 00076D  0581 000C                            BBF      s:2062,PREL

   2061   0 00076F  CBC7 000E                            LAB,B4   VLP@WINDOW,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:237  
          0 000771  CFC7 0054                            STB,B4   Y@ENDLIN+2,AUTO
          0 000773  BBC7 0054                            LAB,B3   Y@ENDLIN+2,AUTO
          0 000775  CBF0 0100                            LAB,B4   256,IMO
          0 000777  E3C0 F888                            LNJ,B6   s:7,PREL
          0 000779       0001                            DC       s:2062,PREL

     1408     2062    3      END;

   2062   0 00077A  E847 0039                            LDR,R6   Y@X,AUTO
          0 00077C  6A61                                 BGZ,R6   s:2059,SPREL

     1409     2063    2      KV$PTR.SRD$ = Y@SRD$;

   2063   0 00077D  ECC7 0008                            LDB,B6   Y@SRD$,AUTO
          0 00077F  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 000782  EFC5 000A                            STB,B6   10,B5

     1410     2064    2      RETURN;

   2064   0 000784  ECC7 0042                            LDB,B6   KV@USR_ERS+8,AUTO
          0 000786  C3C6 0001                            LNJ,B4   1,B6

     1411     2065    2   END Y$FNDSPCLNG;
     1412     2066        %EJECT;
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:238  
     1413     2067        /*F* NAME: KVC$RLSWND.
     1414     2068             PURPOSE: Releases the screen space occuppied by an SRD. */
     1415     2069
     1416     2070    1   KVC$RLSWND: ENTRY ALTRET;

   2070   0 000788  D380 0000 0000  xent KVC$RLSWND      LNJ,B5   X6A_AUTO_1
          0 00078B       0056 0001                       DC       86,1

     1417     2071
     1418     2072        /* Just make a VLP@WINDOW that shrinks this SRD to nothing. */
     1419     2073
     1420     2074    1      Y@SRD$ = KV$PTR.SRD$;

   2074   0 00078D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000790  DCC6 000A                            LDB,B5   10,B6
          0 000792  DFC7 0008                            STB,B5   Y@SRD$,AUTO

     1421     2075    1      VLP@WINDOW.FWINDOW$ = KV$PTR.SRD$;

   2075   0 000794  DFC7 000E                            STB,B5   VLP@WINDOW,AUTO

     1422     2076    2      IF %KV_MRD.USRCNT=2 THEN DO;

   2076   0 000796  CCC6 0008                            LDB,B4   8,B6
          0 000798  E844 000A                            LDR,R6   10,B4
          0 00079A  E570 00FF                            AND,R6   255,IMO
          0 00079C  6D02                                 CMV,R6   2
          0 00079D  0981 009D                            BNE      s:2111,PREL

     1423     2077        /*
     1424     2078           If its the penultimate one, make sure the other one will recover all
     1425     2079           the space.
     1426     2080        */
     1427     2081    2         IF %KV_SRD.LNK$=ADDR(NIL) THEN Y@MVD$ = %KV_MRD.SRD$;

   2081   0 00079F  8DC5 0002                            CMN      2,B5
          0 0007A1  0981 0007                            BNE      s:2082,PREL
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:239  

   2081   0 0007A3  BCC4 0002                            LDB,B3   2,B4
          0 0007A5  BFC7 0006                            STB,B3   Y@MVD$,AUTO
          0 0007A7  0F81 0005                            B        s:2083,PREL

     1428     2082    2         ELSE Y@MVD$ = %KV_SRD.LNK$;

   2082   0 0007A9  BCC5 0002                            LDB,B3   2,B5
          0 0007AB  BFC7 0006                            STB,B3   Y@MVD$,AUTO

     1429     2083    2         IF Y@MVD$->Y@SRD.SRDEND.CLM-Y@MVD$->Y@SRD.ORG.CLM=%KV_MRD.WDT

   2083   0 0007AD  D843 001B                            LDR,R5   27,B3
          0 0007AF  D243 0008                            SUB,R5   8,B3
          0 0007B1  5801 002B                            BLZ,R5   s:2089,PREL
          0 0007B3  D944 000B                            CMR,R5   11,B4
          0 0007B5  0981 0027                            BNE      s:2089,PREL
          0 0007B7  D845 001B                            LDR,R5   27,B5
          0 0007B9  D245 0008                            SUB,R5   8,B5
          0 0007BB  5801 0021                            BLZ,R5   s:2089,PREL
          0 0007BD  D944 000B                            CMR,R5   11,B4
          0 0007BF  0981 001D                            BNE      s:2089,PREL
          0 0007C1  D843 001A                            LDR,R5   26,B3
          0 0007C3  D245 0007                            SUB,R5   7,B5
          0 0007C5  C2C4 000A                            LLH,R4   10,B4
          0 0007C7  C955                                 CMR,R4   R5
          0 0007C8  0A81 0008                            BALE     s:2083+36,PREL
          0 0007CA  D845 001A                            LDR,R5   26,B5
          0 0007CC  D243 0007                            SUB,R5   7,B3
          0 0007CE  C955                                 CMR,R4   R5
          0 0007CF  0A01 000D                            BAG      s:2089,PREL
          0 0007D1  D843 001A                            LDR,R5   26,B3
          0 0007D3  D945 0007                            CMR,R5   7,B5
          0 0007D5  0901 0065                            BE       s:2111,PREL
          0 0007D7  B843 0007                            LDR,R3   7,B3
          0 0007D9  B945 001A                            CMR,R3   26,B5
          0 0007DB  0901 005F                            BE       s:2111,PREL
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:240  

     1430     2084    2           AND %KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM=%KV_MRD.WDT
     1431     2085    2           AND (Y@MVD$->Y@SRD.SRDEND.LIN-%KV_SRD.ORG.LIN>=%KV_MRD.DSPHEIGHT
     1432     2086    2           OR %KV_SRD.SRDEND.LIN-Y@MVD$->Y@SRD.ORG.LIN>=%KV_MRD.DSPHEIGHT)
     1433     2087    2           AND (Y@MVD$->Y@SRD.SRDEND.LIN=%KV_SRD.ORG.LIN
     1434     2088    2           OR Y@MVD$->Y@SRD.ORG.LIN=%KV_SRD.SRDEND.LIN) THEN EXIT;
     1435     2089    2         IF Y@MVD$->Y@SRD.SRDEND.LIN-Y@MVD$->Y@SRD.ORG.LIN>=%KV_MRD.DSPHEIGHT

   2089   0 0007DD  D843 001A                            LDR,R5   26,B3
          0 0007DF  D243 0007                            SUB,R5   7,B3
          0 0007E1  C2C4 000A                            LLH,R4   10,B4
          0 0007E3  C955                                 CMR,R4   R5
          0 0007E4  0A01 002D                            BAG      s:2099,PREL
          0 0007E6  D845 0007                            LDR,R5   7,B5
          0 0007E8  D943 0007                            CMR,R5   7,B3
          0 0007EA  0981 0027                            BNE      s:2099,PREL
          0 0007EC  B845 001A                            LDR,R3   26,B5
          0 0007EE  B943 001A                            CMR,R3   26,B3
          0 0007F0  0981 0021                            BNE      s:2099,PREL
          0 0007F2  A843 001B                            LDR,R2   27,B3
          0 0007F4  A245 0008                            SUB,R2   8,B5
          0 0007F6  2801 0005                            BLZ,R2   s:2089+31,PREL
          0 0007F8  A944 000B                            CMR,R2   11,B4
          0 0007FA  0901 000B                            BE       s:2089+41,PREL
          0 0007FC  A845 001B                            LDR,R2   27,B5
          0 0007FE  A243 0008                            SUB,R2   8,B3
          0 000800  2801 0011                            BLZ,R2   s:2099,PREL
          0 000802  A944 000B                            CMR,R2   11,B4
          0 000804  0201 000D                            BL       s:2099,PREL
          0 000806  A843 001B                            LDR,R2   27,B3
          0 000808  A945 0008                            CMR,R2   8,B5
          0 00080A  0901 0030                            BE       s:2111,PREL
          0 00080C  9843 0008                            LDR,R1   8,B3
          0 00080E  9945 001B                            CMR,R1   27,B5
          0 000810  0901 002A                            BE       s:2111,PREL

     1436     2090    2           AND %KV_SRD.ORG.LIN=Y@MVD$->Y@SRD.ORG.LIN
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:241  
     1437     2091    2           AND %KV_SRD.SRDEND.LIN=Y@MVD$->Y@SRD.SRDEND.LIN
     1438     2092    2           AND (Y@MVD$->Y@SRD.SRDEND.CLM-%KV_SRD.ORG.CLM=%KV_MRD.WDT
     1439     2093    2           OR %KV_SRD.SRDEND.CLM-Y@MVD$->Y@SRD.ORG.CLM>=%KV_MRD.WDT)
     1440     2094    2           AND (Y@MVD$->Y@SRD.SRDEND.CLM=%KV_SRD.ORG.CLM
     1441     2095    2           OR Y@MVD$->Y@SRD.ORG.CLM=%KV_SRD.SRDEND.CLM) THEN EXIT;
     1442     2096        /*
     1443     2097           It wont work.  Make it happen by putting the last one past the last column.
     1444     2098        */
     1445     2099    2         Y@MVD$->Y@SRD.LNG = %KV_MRD.DSPHEIGHT;

   2099   0 000812  C7C3 000E                            STH,R4   14,B3

     1446     2100    2         Y@MVD$->Y@SRD.SRDEND.LIN = %KV_MRD.LNG;

   2100   0 000814  CCC6 0008                            LDB,B4   8,B6
          0 000816  E2C4 0015                            LLH,R6   21,B4
          0 000818  EF43 001A                            STR,R6   26,B3

     1447     2101    2         Y@MVD$->Y@SRD.ORG.LIN = Y@MVD$->Y@SRD.SRDEND.LIN-Y@MVD$->Y@SRD.LNG;

   2101   0 00081A  D2C3 000E                            LLH,R5   14,B3
          0 00081C  D256                                 SUB,R5   R6
          0 00081D  8255                                 NEG      R5
          0 00081E  DF43 0007                            STR,R5   7,B3

     1448     2102    2         %KV_SRD.ORG.LIN = Y@MVD$->Y@SRD.ORG.LIN;

   2102   0 000820  DF45 0007                            STR,R5   7,B5

     1449     2103    2         Y@MVD$->Y@SRD.SRDEND.CLM = %KV_MRD.WDT;

   2103   0 000822  CCC6 0008                            LDB,B4   8,B6
          0 000824  E844 000B                            LDR,R6   11,B4
          0 000826  EF43 001B                            STR,R6   27,B3

     1450     2104    2         Y@MVD$->Y@SRD.ORG.CLM = Y@MVD$->Y@SRD.SRDEND.CLM;

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:242  
   2104   0 000828  EF43 0008                            STR,R6   8,B3

     1451     2105    2         %KV_SRD.ORG.CLM = 0;

   2105   0 00082A  8745 0008                            CL       8,B5

     1452     2106    2         Y@MVD$->Y@SRD.BTMRHT_PST = Y@MVD$->Y@SRD.SRDEND_PST;

   2106   0 00082C  8CC3 001A                            LDI      26,B3
          0 00082E  8D43 000B                            SDI      11,B3

     1453     2107    2         %KV_SRD.SRDEND_PST = Y@MVD$->Y@SRD.SRDEND_PST;

   2107   0 000830  8D45 001A                            SDI      26,B5

     1454     2108    2         Y@MVD$->Y@SRD.TOPLFT_PST = Y@MVD$->Y@SRD.ORG_PST+%BITBIN('10001'X);

   2108   0 000832  8CC3 0007                            LDI      7,B3
          0 000834  8470 0001 0001                       AID      65537,IMO
          0 000837  8D43 0009                            SDI      9,B3

     1455     2109    2         Y@MVD$->Y@SRD.WDT = 0;

   2109   0 000839  8743 000D                            CL       13,B3

     1456     2110    2      END;

     1457     2111    1      %KV_SRD.TOPLFT_PST = %KV_SRD.ORG_PST+%BITBIN('10001'X);

   2111   0 00083B  8CC5 0007                            LDI      7,B5
          0 00083D  8470 0001 0001                       AID      65537,IMO
          0 000840  8D45 0009                            SDI      9,B5

     1458     2112    1      %KV_SRD.BTMRHT = %KV_SRD.SRDEND;

   2112   0 000842  8CC5 001A                            LDI      26,B5
          0 000844  8D45 000B                            SDI      11,B5
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:243  

     1459     2113    1      %KV_SRD.WDT = %KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM;

   2113   0 000846  D845 001B                            LDR,R5   27,B5
          0 000848  D245 0008                            SUB,R5   8,B5
          0 00084A  DF45 000D                            STR,R5   13,B5

     1460     2114    1      %KV_SRD.LNG = %KV_SRD.SRDEND.LIN-%KV_SRD.ORG.LIN;

   2114   0 00084C  C845 001A                            LDR,R4   26,B5
          0 00084E  C245 0007                            SUB,R4   7,B5
          0 000850  C7C5 000E                            STH,R4   14,B5

     1461     2115    1      VLP@WINDOW.LENGTH = -%KV_SRD.LNG;

   2115   0 000852  C2C5 000E                            LLH,R4   14,B5
          0 000854  8254                                 NEG      R4
          0 000855  CF47 0010                            STR,R4   VLP@WINDOW+2,AUTO

     1462     2116    1      VLP@WINDOW.WIDTH = -%KV_SRD.WDT;

   2116   0 000857  D845 000D                            LDR,R5   13,B5
          0 000859  8255                                 NEG      R5
          0 00085A  DF47 0011                            STR,R5   VLP@WINDOW+3,AUTO

     1463     2117    1      VLP@WINDOW.POSITION = 0;

   2117   0 00085C  87C7 0012                            CLH      VLP@WINDOW+4,AUTO

     1464     2118    1      %KV_SRD.OPT = '1'B;

   2118   0 00085E  8945 001C                            LBT,'8000'X       28,B5
   2118   0 000860       8000

     1465     2119    1      CALL KVC$ADJWND (VLP@WINDOW);

   2119   0 000861  CBC7 000E                            LAB,B4   VLP@WINDOW,AUTO
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:244  
          0 000863  CFC7 0054                            STB,B4   Y@ENDLIN+2,AUTO
          0 000865  BBC7 0054                            LAB,B3   Y@ENDLIN+2,AUTO
          0 000867  CBF0 0100                            LAB,B4   256,IMO
          0 000869  E3C0 F796                            LNJ,B6   s:7,PREL
          0 00086B       0001                            DC       s:2120,PREL

     1466     2120    2      IF %KV_SRD.LNG~=0 THEN DO;

   2120   0 00086C  ECC7 0008                            LDB,B6   Y@SRD$,AUTO
          0 00086E  E2C6 000E                            LLH,R6   14,B6
          0 000870  6901 000E                            BEZ,R6   s:2124,PREL

     1467     2121    2         VLP@WINDOW.LENGTH = 0;       /* That didn't work - try pushing sideways */

   2121   0 000872  8747 0010                            CL       VLP@WINDOW+2,AUTO

     1468     2122    2         CALL KVC$ADJWND (VLP@WINDOW);

   2122   0 000874  DBC7 000E                            LAB,B5   VLP@WINDOW,AUTO
          0 000876  DFC7 0054                            STB,B5   Y@ENDLIN+2,AUTO
          0 000878  BBC7 0054                            LAB,B3   Y@ENDLIN+2,AUTO
          0 00087A  CBF0 0100                            LAB,B4   256,IMO
          0 00087C  E3C0 F783                            LNJ,B6   s:7,PREL
          0 00087E       0001                            DC       s:2124,PREL

     1469     2123    2      END;

     1470     2124    1      RETURN;

   2124   0 00087F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1471     2125    1   END KVC$ADJWND;
     1472     2126        %EOD;

PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:245  
--  Include file information  --

   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KVC$ADJWND.
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:246  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PRM_WINDOW               3A-0-0/w STRC(112)   r     1 KV@USR_ERS
    *0-0-0/w STRC(256)   r     1 PRM_WINDOW                 C-0-0/w PTR         r     1 T$
     A-0-0/w PTR         r     1 U$                         E-0-0/w STRC(152)   r     1 VLP@WINDOW
    4B-0-0/w SBIN(16)    r     1 Y@AVL(0:1)                49-0-0/w SBIN(16)    r     1 Y@CRT(0:1)
    49-0-0/w UBIN(32)    r     1 Y@CRTU                    48-0-0/w SBIN(16)    r     1 Y@DLT
    48-0-0/w UBIN(16)    r     1 Y@DLTU                    50-0-0/w SBIN(16)    r     1 Y@ENDCLM
    52-0-0/w SBIN(16)    r     1 Y@ENDLIN                   6-0-0/w PTR         r     1 Y@MVD$
    4D-0-0/w SBIN(16)    r     1 Y@NSS(0:1)                38-0-0/b BIT         r     1 Y@ORG(0:15)
    4F-0-0/w SBIN(16)    r     1 Y@ORGCLM                  51-0-0/w SBIN(16)    r     1 Y@ORGLIN
    47-0-0/w SBIN(16)    r     1 Y@RQS                     18-0-0/w PTR         r     1 Y@S$(0:15)
     8-0-0/w PTR         r     1 Y@SRD$                    4B-0-0/w STRC(32)    r     1 Y@T1
    4D-0-0/w STRC(32)    r     1 Y@T2                      46-0-0/w SBIN(16)    r     1 Y@TMP
    45-0-0/w SBIN(16)    r     1 Y@WDTMNS1                 44-0-0/w SBIN(16)    r     1 Y@WDTPLS1
    39-0-0/w SBIN(16)    r     1 Y@X

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(112)   r     1 KV_USR_ERS

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KV$MRD                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(496)   r     1 KV$SRD                     0-0-0/w STRC(1024)  r     1 KV$SSN
     0-0-0/w STRC(512)   r     1 KV$STR                     0-0-0/w STRC(512)   r     1 Y@MVD
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:247  
     0-0-0/w STRC(288)   r     1 Y@RCRLST                   0-0-0/w STRC(496)   r     1 Y@SRD


   Procedure KVC$ADJWND requires 2178 words for executable code.
   Procedure KVC$ADJWND requires 86 words of local(AUTO) storage.
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:248  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:249  
          MINI XREF LISTING

COMMON IN PROCEDURE Y$FNDSPCLNG
      1843**LABEL    1833--GOTO
DO_MODS IN PROCEDURE Y$FNDSPCLNG
      2051**LABEL    1991--GOTO     2024--GOTO
KV$MRD.DSPHEIGHT
       233**DCL      1758>>IF       1860>>ASSIGN   2083>>IF       2083>>IF       2089>>IF       2099>>ASSIGN
KV$MRD.FSTERS
       243**DCL      1742>>ASSIGN
KV$MRD.LNG
       236**DCL      1831>>ASSIGN   2100>>ASSIGN
KV$MRD.MVD$
       235**DCL      1576>>ASSIGN   1870>>ASSIGN
KV$MRD.SRD$
       231**DCL      2081>>ASSIGN
KV$MRD.USRCNT
       233**DCL      1749>>IF       2076>>IF
KV$MRD.VRTSCR
       246**DCL      1749>>IF       1757>>ASSIGN   1761>>ASSIGN
KV$MRD.WDT
       233**DCL      1741>>IF       1842>>ASSIGN   2083>>IF       2083>>IF       2089>>IF       2089>>IF
      2103>>ASSIGN
KV$PTR.INPCNDPND
       417**DCL       426--REDEF     430--REDEF
KV$PTR.LINLST$
       413**DCL       414--REDEF
KV$PTR.MRD$
       412**DCL      1576>>ASSIGN   2076>>IF       2081>>ASSIGN   2083>>IF       2083>>IF       2083>>IF
      2083>>IF       2089>>IF       2089>>IF       2089>>IF       2099>>ASSIGN   2100>>ASSIGN   2103>>ASSIGN
KV$PTR.MVD$
       412**DCL      1529>>ASSIGN   1599>>IF       1661>>IF       1723>>IF       1724>>ASSIGN   1725<<ASSIGN
      1727<<ASSIGN   1784>>IF
KV$PTR.SRD$
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:250  
       413**DCL      1530>>ASSIGN   2060<<ASSIGN   2063<<ASSIGN   2074>>ASSIGN   2075>>ASSIGN
KV$PTR.SSN$
       411**DCL      1925>>ASSIGN
KV$PTR$
       405**DCL       411--IMP-PTR  1529>>ASSIGN   1530>>ASSIGN   1576>>ASSIGN   1599>>IF       1661>>IF
      1723>>IF       1724>>ASSIGN   1725>>ASSIGN   1727>>ASSIGN   1784>>IF       1925>>ASSIGN   2060>>ASSIGN
      2063>>ASSIGN   2074>>ASSIGN   2075>>ASSIGN   2076>>IF       2081>>ASSIGN   2083>>IF       2083>>IF
      2083>>IF       2083>>IF       2089>>IF       2089>>IF       2089>>IF       2099>>ASSIGN   2100>>ASSIGN
      2103>>ASSIGN
KV$SRD.ADJTOPLFT
       633**DCL      1958>>IF
KV$SRD.BRDEXS
       632**DCL      1708>>IF       1723>>IF       1729>>IF       1749>>IF       1758>>IF
KV$SRD.BRDUPD
       633**DCL      1729<<ASSIGN
KV$SRD.BTMRHT
       621**DCL       626--REDEF    1710<<ASSIGN   2112<<ASSIGN
KV$SRD.BTMRHT.CLM
       623**DCL      1680>>ASSIGN   1682<<ASSIGN   1682>>ASSIGN   1684>>IF       1684>>IF       1688>>IF
      1689>>ASSIGN   1741>>IF       1743>>IF
KV$SRD.BTMRHT.LIN
       623**DCL      1634>>ASSIGN   1636<<ASSIGN   1636>>ASSIGN   1638>>ASSIGN   1647>>IF       1648>>ASSIGN
      1758>>IF       1773>>ASSIGN   1774>>ASSIGN
KV$SRD.CRT
       697**DCL       702--REDEF    1781>>ASSIGN
KV$SRD.CRT.CLM
       699**DCL      1673>>IF       1684>>IF       1700<<ASSIGN
KV$SRD.CRT.LIN
       699**DCL      1615>>IF       1619>>IF       1623>>ASSIGN   1625<<ASSIGN   1625>>ASSIGN   1639>>IF
      1754<<ASSIGN   1774<<ASSIGN   1776>>ASSIGN   1778>>ASSIGN
KV$SRD.CRTVRTLINPHSLIN
       669**DCL      1615>>IF       1619>>IF       1623>>ASSIGN   1626<<ASSIGN   1626>>ASSIGN   1639>>IF
      1776<<ASSIGN   1778<<ASSIGN
KV$SRD.DVCLINBIS
       739**DCL      1614>>ASSIGN   1619>>IF       1628<<ASSIGN   1628>>ASSIGN   1638>>ASSIGN   1772<<ASSIGN
      1773<<ASSIGN   1774>>ASSIGN
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:251  
KV$SRD.FLDEND
       661**DCL       666--REDEF
KV$SRD.FSTERS
       632**DCL      1742<<ASSIGN   1746<<ASSIGN
KV$SRD.HBRDSIZ
       775**DCL      1613>>ASSIGN
KV$SRD.HI_NONBLN
       731**DCL       736--REDEF    1781<<ASSIGN
KV$SRD.HI_NONBLN.CLM
       733**DCL      1673>>IF       1684>>IF
KV$SRD.HI_NONBLN.LIN
       733**DCL      1615>>IF       1627<<ASSIGN   1627>>ASSIGN   1639>>IF       1707<<ASSIGN   1707>>ASSIGN
      1715<<ASSIGN   1715>>ASSIGN
KV$SRD.LNG
       629**DCL      1534>>IF       1547>>IF       1549>>ASSIGN   1594>>IF       1597>>ASSIGN   1647<<ASSIGN
      1648<<ASSIGN   1649>>IF       1779>>ASSIGN   2114<<ASSIGN   2115>>ASSIGN   2120>>IF
KV$SRD.LNK$
       525**DCL      2081>>IF       2082>>ASSIGN
KV$SRD.MINLNG
       777**DCL      1594>>IF       1597>>ASSIGN
KV$SRD.MINWDT
       777**DCL      1656>>IF       1657>>IF       1659>>ASSIGN
KV$SRD.MRD$
       525**DCL      1741>>IF       1742>>ASSIGN   1749>>IF       1749>>IF       1757>>ASSIGN   1758>>IF
      1761>>ASSIGN   1831>>ASSIGN   1842>>ASSIGN   1860>>ASSIGN   1870>>ASSIGN
KV$SRD.NXTNONBLNLIN
       669**DCL      1783<<ASSIGN
KV$SRD.OPT
       774**DCL      1595>>IF       1657>>IF       2118<<ASSIGN
KV$SRD.ORG
       553**DCL       558--REDEF
KV$SRD.ORG.CLM
       555**DCL      1553>>ASSIGN   1565>>IF       1658>>ASSIGN   1671<<ASSIGN   2083>>IF       2089>>IF
      2089>>IF       2105<<ASSIGN   2113>>ASSIGN
KV$SRD.ORG.LIN
       555**DCL      1570>>IF       1596>>ASSIGN   1610<<ASSIGN   1758>>IF       2083>>IF       2083>>IF
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:252  
      2089>>IF       2102<<ASSIGN   2114>>ASSIGN
KV$SRD.ORG_PST
       558**DCL      1585>>ASSIGN   1711>>ASSIGN   2111>>ASSIGN
KV$SRD.SAVSCROLL
       634**DCL      1755>>IF
KV$SRD.SCROLL
       630**DCL      1749>>IF       1752<<ASSIGN   1760<<ASSIGN   1772>>IF
KV$SRD.SRDEND
       766**DCL       771--REDEF    1586>>ASSIGN   1710>>ASSIGN   2112>>ASSIGN
KV$SRD.SRDEND.CLM
       768**DCL      1553>>ASSIGN   1565>>IF       1658>>ASSIGN   1683<<ASSIGN   2083>>IF       2089>>IF
      2089>>IF       2113>>ASSIGN
KV$SRD.SRDEND.LIN
       768**DCL      1570>>IF       1596>>ASSIGN   1637<<ASSIGN   2083>>IF       2083>>IF       2089>>IF
      2114>>ASSIGN
KV$SRD.SRDEND_PST
       771**DCL      2107<<ASSIGN
KV$SRD.TOPBRD
       774**DCL      1612>>IF
KV$SRD.TOPLFT
       587**DCL       592--REDEF
KV$SRD.TOPLFT.CLM
       589**DCL      1672<<ASSIGN   1672>>ASSIGN   1688>>IF       1689>>ASSIGN   1700>>ASSIGN
KV$SRD.TOPLFT.LIN
       589**DCL      1608>>ASSIGN   1611<<ASSIGN   1613<<ASSIGN   1613>>ASSIGN   1614>>ASSIGN   1619>>IF
      1619>>IF       1623>>ASSIGN   1647>>IF       1648>>ASSIGN   1773>>ASSIGN
KV$SRD.TOPLFT_PST
       592**DCL      1711<<ASSIGN   2111<<ASSIGN
KV$SRD.UNKPST
       774**DCL      1534<<ASSIGN   1555<<ASSIGN   1618<<ASSIGN   1642<<ASSIGN   1675<<ASSIGN   1686<<ASSIGN
      1696>>IF       1717>>IF       1753<<ASSIGN   1769<<ASSIGN   1785<<ASSIGN
KV$SRD.UNKRGN
       633**DCL      1739<<ASSIGN
KV$SRD.VRTPSTOK
       630**DCL      1782<<ASSIGN
KV$SRD.VRTSCR
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:253  
       775**DCL      1743<<ASSIGN   1744<<ASSIGN   1747<<ASSIGN   1749>>IF       1751<<ASSIGN   1755>>IF
      1757<<ASSIGN   1758>>IF       1761>>IF       1761<<ASSIGN
KV$SRD.WDT
       629**DCL      1534>>IF       1551>>IF       1656>>IF       1659>>ASSIGN   1689<<ASSIGN   1690<<ASSIGN
      1695>>IF       1740>>ASSIGN   1743>>IF       2113<<ASSIGN   2116>>ASSIGN
KV$SSN.REDRSPCNT
      1084**DCL      1085--REDEF
KV$SSN.STR$
      1078**DCL      1925>>ASSIGN
KV$STR.LNK$
      1155**DCL      1928>>ASSIGN
KV$STR.MVD$
      1155**DCL      1927>>IF
KV@USR_ERS
      1451**DCL      1584<<ASSIGN   1714<>CALL
KV@USR_ERS.BGNPHSCLM
      1526**DCL      1705<<ASSIGN
KV@USR_ERS.BTMRHT
      1518**DCL      1523--REDEF    1586<<ASSIGN
KV@USR_ERS.BTMRHT.CLM
      1520**DCL      1669<<ASSIGN   1681<<ASSIGN   1681>>ASSIGN   1683>>ASSIGN   1706>>ASSIGN
KV@USR_ERS.BTMRHT.LIN
      1520**DCL      1608<<ASSIGN   1635<<ASSIGN   1635>>ASSIGN   1637>>ASSIGN
KV@USR_ERS.ENDPHSCLM
      1526**DCL      1706<<ASSIGN
KV@USR_ERS.TOPLFT
      1484**DCL      1489--REDEF
KV@USR_ERS.TOPLFT.CLM
      1486**DCL      1669>>ASSIGN   1670<<ASSIGN   1670>>ASSIGN   1671>>ASSIGN   1673>>IF       1673>>IF
      1680<<ASSIGN   1705>>ASSIGN
KV@USR_ERS.TOPLFT.LIN
      1486**DCL      1609<<ASSIGN   1609>>ASSIGN   1610>>ASSIGN   1611>>ASSIGN   1634<<ASSIGN
KV@USR_ERS.TOPLFT_PST
      1489**DCL      1585<<ASSIGN
KVC$ADJWND
         7**PROC     2061--CALL     2119--CALL     2122--CALL
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:254  
KVC$DRWBRD
      1325**DCL-ENT  1726--CALL
KVV$CALUSR
      1326**DCL-ENT  1714--CALL
KV_USR_ERS
      1248**DCL      1584>>ASSIGN
KV_USR_ERS.BTMRHT
      1315**DCL      1320--REDEF
KV_USR_ERS.TOPLFT
      1281**DCL      1286--REDEF
NO_ERASE
      1715**LABEL    1649--GOTO     1695--GOTO
PRM_WINDOW
      1346**DCL         7--PROC     1791--ENTRY    1792--ASSIGN   1797--ENTRY    1798--ASSIGN
PRM_WINDOW.FWINDOW
      1346**DCL      1346--REDEF    1347--REDEF
PRM_WINDOW.FWINDOW$
      1347**DCL      1543>>ASSIGN   1562>>ASSIGN
PRM_WINDOW.LENGTH
      1360**DCL      1547>>IF       1547>>IF       1549<<ASSIGN   1564>>IF       1588>>IF       1592>>ASSIGN
      1645<<ASSIGN   1649>>IF       1722>>IF
PRM_WINDOW.POSITION
      1360**DCL      1539>>IF       1544>>ASSIGN   1580>>ASSIGN
PRM_WINDOW.WIDTH
      1360**DCL      1551>>IF       1551>>IF       1553<<ASSIGN   1650>>IF       1654>>ASSIGN   1693<<ASSIGN
      1695>>IF       1722>>IF
SKIP_IT IN PROCEDURE Y$FNDSPCLNG
      1949**LABEL    1907--GOTO
T$
      1375**DCL      1848<<ASSIGN   1849>>ASSIGN   1850>>ASSIGN   1852<<ASSIGN   1853>>ASSIGN   1854>>ASSIGN
      1870<<ASSIGN   1871>>DOUNTIL  1872>>ASSIGN   1873>>IF       1885>>ASSIGN   1896>>IF       1913>>IF
      1914>>ASSIGN   1914>>ASSIGN   1915>>ASSIGN   1915>>ASSIGN   1919>>IF       1927>>IF       1931>>IF
      1932>>ASSIGN   1937>>IF       1942>>IF       1952<<ASSIGN   1952>>ASSIGN   2003<<ASSIGN   2005>>ASSIGN
      2009<<ASSIGN   2010>>IF       2010>>IF       2036<<ASSIGN   2037>>IF       2040>>ASSIGN   2041>>ASSIGN
      2041>>ASSIGN
U$
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:255  
      1374**DCL      1998<<ASSIGN   2001>>IF       2003>>ASSIGN   2004<<ASSIGN   2008>>ASSIGN   2012>>IF
      2015>>IF       2015>>IF       2018>>IF       2020>>IF       2020>>ASSIGN
VLP@WINDOW
      1395**DCL      2061<>CALL     2119<>CALL     2122<>CALL
VLP@WINDOW.FWINDOW
      1395**DCL      1395--REDEF    1396--REDEF
VLP@WINDOW.FWINDOW$
      1396**DCL       801--IMP-PTR  1543<<ASSIGN   1547>>IF       1549>>ASSIGN   1551>>IF       1553>>ASSIGN
      1553>>ASSIGN   1562<<ASSIGN   1563>>IF       1563>>IF       1565>>IF       1565>>IF       1570>>IF
      1570>>IF       1581<<ASSIGN   1865>>ASSIGN   1872<<ASSIGN   1873>>IF       1873>>IF       1880>>IF
      1880>>IF       1885<<ASSIGN   1886>>ASSIGN   1887>>ASSIGN   1900>>IF       1900>>IF       1903>>ASSIGN
      1903>>ASSIGN   1925<<ASSIGN   1926>>DOWHILE  1927>>IF       1928<<ASSIGN   1928>>ASSIGN   1930>>IF
      2075<<ASSIGN
VLP@WINDOW.LENGTH
      1409**DCL      1592<<ASSIGN   1594>>IF       1596<<ASSIGN   1597<<ASSIGN   1607<<ASSIGN   1609>>ASSIGN
      1635>>ASSIGN   1636>>ASSIGN   1645>>ASSIGN   1646>>IF       1655<<ASSIGN   1832>>ASSIGN   2057<<ASSIGN
      2115<<ASSIGN   2121<<ASSIGN
VLP@WINDOW.POSITION
      1409**DCL      1544<<ASSIGN   1545>>IF       1545>>IF       1561<<ASSIGN   1568<<ASSIGN   1573<<ASSIGN
      1580<<ASSIGN   1603>>IF       1665>>IF       1863>>IF       1974>>IF       1974>>IF       1981<<ASSIGN
      1984<<ASSIGN   2117<<ASSIGN
VLP@WINDOW.WIDTH
      1409**DCL      1593<<ASSIGN   1654<<ASSIGN   1656>>IF       1658<<ASSIGN   1659<<ASSIGN   1670>>ASSIGN
      1672>>ASSIGN   1681>>ASSIGN   1682>>ASSIGN   1693>>ASSIGN   1694>>IF       1843>>ASSIGN   2056<<ASSIGN
      2116<<ASSIGN
Y$FIXPST IN PROCEDURE Y$FIXWDT
      1764**ENTRY    1720--CALL     1800--CALL
Y$FIXWDT
      1732**PROC     1644--CALL     1692--CALL     1794--CALL
Y$FNDSPCLNG
      1804**PROC     1599--CALL
Y$FNDSPCWDT IN PROCEDURE Y$FNDSPCLNG
      1834**ENTRY    1661--CALL
Y@AVL IN PROCEDURE Y$FNDSPCLNG
      1816**DCL      1817--REDEF    1858<<ASSIGN   1860<<ASSIGN   1860>>ASSIGN   1861<<ASSIGN   1948>>IF
      1948<<ASSIGN   1949>>IF       1949<<ASSIGN   1962>>IF       1962>>IF       1963>>IF       1964>>IF
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:256  
      1965>>IF       1965>>IF       1966>>IF       1966>>IF       1976>>IF       1976>>ASSIGN   1983>>IF
      1983>>ASSIGN
Y@CRT IN PROCEDURE Y$FNDSPCLNG
      1814**DCL      1815--REDEF    1908<<ASSIGN   1908>>ASSIGN   1909<<ASSIGN   1909>>ASSIGN   1969>>IF
      1970>>IF       1970>>IF       1972>>IF       1985<<ASSIGN   1985>>ASSIGN   1991>>IF
Y@CRTU IN PROCEDURE Y$FNDSPCLNG
      1815**DCL      1862<<ASSIGN
Y@DLT IN PROCEDURE Y$FNDSPCLNG
      1812**DCL      1813--REDEF    1886<<ASSIGN   1887>>IF       1887<<ASSIGN   1896>>IF       1908>>IF
      1930>>ASSIGN   1930>>ASSIGN   1935>>IF       1936<<ASSIGN   1936>>ASSIGN   1940<<ASSIGN   1945<<ASSIGN
      1945>>ASSIGN   1946>>IF       1947<<ASSIGN   1947>>ASSIGN   1948>>IF       1948>>ASSIGN   1949>>IF
      1949>>ASSIGN   1957<<ASSIGN   1958<<ASSIGN   1958>>ASSIGN   1960<<ASSIGN   1961<<ASSIGN   1961>>ASSIGN
      1963<<ASSIGN   1964<<ASSIGN   1964>>ASSIGN   1966<<ASSIGN   1967<<ASSIGN   1967>>ASSIGN   1971<<ASSIGN
      1971>>ASSIGN   1972<<ASSIGN   1974>>IF       1999<<DOINDEX  2000>>IF       2001>>IF       2004>>ASSIGN
      2005>>ASSIGN   2031<<ASSIGN   2041<<ASSIGN   2041>>ASSIGN   2046>>IF       2047>>ASSIGN
Y@DLTU IN PROCEDURE Y$FNDSPCLNG
      1813**DCL      1892>>IF
Y@ENDCLM IN PROCEDURE Y$FNDSPCLNG
      1826**DCL      1854<<ASSIGN   1873>>IF       1880>>IF       2015>>IF
Y@ENDLIN IN PROCEDURE Y$FNDSPCLNG
      1828**DCL      1850<<ASSIGN   1861>>ASSIGN   1886>>ASSIGN   1907>>IF
Y@MVD.LINLST$
       326**DCL      1601>>IF       1602>>ASSIGN   1602>>ASSIGN   1663>>IF       1664>>ASSIGN   1664>>ASSIGN
Y@MVD.LNK$
       323**DCL      1578>>ASSIGN   1952>>ASSIGN
Y@MVD.ORG
       328**DCL      1601>>IF       1607>>IF       1663>>IF       1768>>IF       1775>>IF       1896>>IF
Y@MVD.SRD$
       323**DCL      1535>>IF       1577>>DOWHILE  1793>>ASSIGN   1799>>ASSIGN   1872>>ASSIGN   1885>>ASSIGN
      1913>>IF       1914>>ASSIGN   1914>>ASSIGN   1915>>ASSIGN   1915>>ASSIGN   1919>>IF       1931>>IF
      1932>>ASSIGN   1937>>IF       1942>>IF
Y@MVD.VRTCLM
       340**DCL      1786<<ASSIGN
Y@MVD.VRTLIN
       340**DCL      1779<<ASSIGN
Y@MVD.WDT
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:257  
       327**DCL      1740<<ASSIGN
Y@MVD$
      1372**DCL       323--IMP-PTR  1529<<ASSIGN   1535>>IF       1576<<ASSIGN   1577>>DOWHILE  1578<<ASSIGN
      1578>>ASSIGN   1599>>IF       1601>>IF       1601>>IF       1602>>ASSIGN   1602>>ASSIGN   1607>>IF
      1661>>IF       1663>>IF       1663>>IF       1664>>ASSIGN   1664>>ASSIGN   1723>>IF       1725>>ASSIGN
      1740>>ASSIGN   1768>>IF       1775>>IF       1779>>ASSIGN   1784>>IF       1786>>ASSIGN   1792<<ASSIGN
      1793>>ASSIGN   1798<<ASSIGN   1799>>ASSIGN   1873>>IF       2081<<ASSIGN   2082<<ASSIGN   2083>>IF
      2083>>IF       2083>>IF       2083>>IF       2083>>IF       2083>>IF       2089>>IF       2089>>IF
      2089>>IF       2089>>IF       2089>>IF       2089>>IF       2089>>IF       2089>>IF       2099>>ASSIGN
      2100>>ASSIGN   2101>>ASSIGN   2101>>ASSIGN   2101>>ASSIGN   2102>>ASSIGN   2103>>ASSIGN   2104>>ASSIGN
      2104>>ASSIGN   2106>>ASSIGN   2106>>ASSIGN   2107>>ASSIGN   2108>>ASSIGN   2108>>ASSIGN   2109>>ASSIGN
Y@NSS IN PROCEDURE Y$FNDSPCLNG
      1820**DCL      1821--REDEF    1856<<ASSIGN   1930<<ASSIGN   1930>>ASSIGN   1959>>IF       1959>>IF
      1960>>IF       1961>>IF
Y@ORG
      1422**DCL      1855<<ASSIGN   1938<<ASSIGN   1939<<ASSIGN   1974>>IF       1980<<ASSIGN   1980>>ASSIGN
      1997>>IF       2000>>IF       2014<<ASSIGN   2016<<ASSIGN   2019<<ASSIGN   2023>>IF       2024>>IF
      2026>>ASSIGN   2028<<ASSIGN   2048<<ASSIGN   2061>>IF
Y@ORGCLM IN PROCEDURE Y$FNDSPCLNG
      1825**DCL      1853<<ASSIGN   1873>>IF       1880>>IF       2015>>IF
Y@ORGLIN IN PROCEDURE Y$FNDSPCLNG
      1827**DCL      1849<<ASSIGN   1858>>ASSIGN   1887>>ASSIGN   1907>>IF
Y@RCRLST.FRSRCR
       376**DCL      1602>>ASSIGN   1664>>ASSIGN
Y@RCRLST.LSTRCR
       377**DCL      1601>>IF       1602<<ASSIGN   1663>>IF       1664<<ASSIGN
Y@RQS IN PROCEDURE Y$FNDSPCLNG
      1811**DCL      1832<<ASSIGN   1843<<ASSIGN   1919>>IF       1944<<ASSIGN   1962>>IF       1965>>IF
      1970<<ASSIGN   1976>>IF       1976<<ASSIGN   1983>>IF       1983<<ASSIGN   2023<<ASSIGN   2056>>ASSIGN
      2057>>ASSIGN   2058>>IF
Y@S$
      1421**DCL      1865<<ASSIGN   1919--IF       1919>>IF       1931>>IF       1932<<ASSIGN   1937>>IF
      1942>>IF       1998>>ASSIGN   2001>>IF       2004>>ASSIGN   2005<<ASSIGN   2008<<ASSIGN   2009>>ASSIGN
      2036>>ASSIGN   2060>>ASSIGN
Y@SRD.BTMRHT
       897**DCL       902--REDEF
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:258  
Y@SRD.BTMRHT_PST
       902**DCL      2106<<ASSIGN
Y@SRD.CRT
       973**DCL       978--REDEF
Y@SRD.FLDEND
       937**DCL       942--REDEF
Y@SRD.HI_NONBLN
      1007**DCL      1012--REDEF
Y@SRD.LNG
       905**DCL      1915>>ASSIGN   2099<<ASSIGN   2101>>ASSIGN
Y@SRD.MINLNG
      1053**DCL      1915>>ASSIGN
Y@SRD.MINWDT
      1053**DCL      1914>>ASSIGN
Y@SRD.OPT
      1050**DCL      1913>>IF
Y@SRD.ORG
       829**DCL       834--REDEF
Y@SRD.ORG.CLM
       831**DCL      1565>>IF       1853>>ASSIGN   1873>>IF       1880>>IF       2001>>IF       2001>>IF
      2012>>IF       2015>>IF       2018>>IF       2040>>ASSIGN   2041>>ASSIGN   2083>>IF       2089>>IF
      2089>>IF       2104<<ASSIGN
Y@SRD.ORG.LIN
       831**DCL      1570>>IF       1849>>ASSIGN   1886>>ASSIGN   1900>>IF       1903>>ASSIGN   2010>>IF
      2083>>IF       2083>>IF       2089>>IF       2089>>IF       2101<<ASSIGN   2102>>ASSIGN
Y@SRD.ORG_PST
       834**DCL      2108>>ASSIGN
Y@SRD.SRDEND
      1042**DCL      1047--REDEF
Y@SRD.SRDEND.CLM
      1044**DCL      1565>>IF       1854>>ASSIGN   1873>>IF       1880>>IF       2015>>IF       2020>>IF
      2020>>ASSIGN   2037>>IF       2041>>ASSIGN   2083>>IF       2089>>IF       2089>>IF       2103<<ASSIGN
      2104>>ASSIGN
Y@SRD.SRDEND.LIN
      1044**DCL      1570>>IF       1850>>ASSIGN   1887>>ASSIGN   1900>>IF       1903>>ASSIGN   2010>>IF
      2083>>IF       2083>>IF       2089>>IF       2089>>IF       2100<<ASSIGN   2101>>ASSIGN
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:259  
Y@SRD.SRDEND_PST
      1047**DCL      2106>>ASSIGN   2107>>ASSIGN
Y@SRD.TOPLFT
       863**DCL       868--REDEF
Y@SRD.TOPLFT_PST
       868**DCL      2108<<ASSIGN
Y@SRD.WDT
       905**DCL      1914>>ASSIGN   2109<<ASSIGN
Y@SRD$
      1373**DCL       525--IMP-PTR  1530<<ASSIGN   1534>>IF       1534>>IF       1534>>ASSIGN   1535>>IF
      1555>>ASSIGN   1563>>IF       1565>>IF       1565>>IF       1570>>IF       1570>>IF       1577>>DOWHILE
      1585>>ASSIGN   1586>>ASSIGN   1594>>IF       1594>>IF       1595>>IF       1596>>ASSIGN   1596>>ASSIGN
      1597>>ASSIGN   1597>>ASSIGN   1608>>ASSIGN   1610>>ASSIGN   1611>>ASSIGN   1612>>IF       1613>>ASSIGN
      1613>>ASSIGN   1613>>ASSIGN   1614>>ASSIGN   1614>>ASSIGN   1615>>IF       1615>>IF       1615>>IF
      1618>>ASSIGN   1619>>IF       1619>>IF       1619>>IF       1619>>IF       1619>>IF       1623>>ASSIGN
      1623>>ASSIGN   1623>>ASSIGN   1625>>ASSIGN   1625>>ASSIGN   1626>>ASSIGN   1626>>ASSIGN   1627>>ASSIGN
      1627>>ASSIGN   1628>>ASSIGN   1628>>ASSIGN   1634>>ASSIGN   1636>>ASSIGN   1636>>ASSIGN   1637>>ASSIGN
      1638>>ASSIGN   1638>>ASSIGN   1639>>IF       1639>>IF       1639>>IF       1642>>ASSIGN   1647>>IF
      1647>>IF       1647>>ASSIGN   1648>>ASSIGN   1648>>ASSIGN   1648>>ASSIGN   1649>>IF       1656>>IF
      1656>>IF       1657>>IF       1657>>IF       1658>>ASSIGN   1658>>ASSIGN   1659>>ASSIGN   1659>>ASSIGN
      1671>>ASSIGN   1672>>ASSIGN   1672>>ASSIGN   1673>>IF       1673>>IF       1675>>ASSIGN   1680>>ASSIGN
      1682>>ASSIGN   1682>>ASSIGN   1683>>ASSIGN   1684>>IF       1684>>IF       1684>>IF       1684>>IF
      1686>>ASSIGN   1688>>IF       1688>>IF       1689>>ASSIGN   1689>>ASSIGN   1689>>ASSIGN   1690>>ASSIGN
      1695>>IF       1696>>IF       1700>>ASSIGN   1700>>ASSIGN   1707>>ASSIGN   1707>>ASSIGN   1708>>IF
      1710>>ASSIGN   1710>>ASSIGN   1711>>ASSIGN   1711>>ASSIGN   1715>>ASSIGN   1715>>ASSIGN   1717>>IF
      1723>>IF       1724<<ASSIGN   1727>>ASSIGN   1729>>IF       1729>>ASSIGN   1739>>ASSIGN   1740>>ASSIGN
      1741>>IF       1741>>IF       1742>>ASSIGN   1742>>ASSIGN   1743>>IF       1743>>IF       1743>>ASSIGN
      1744>>ASSIGN   1746>>ASSIGN   1747>>ASSIGN   1749>>IF       1749>>IF       1749>>IF       1749>>IF
      1749>>IF       1751>>ASSIGN   1752>>ASSIGN   1753>>ASSIGN   1754>>ASSIGN   1755>>IF       1755>>IF
      1757>>ASSIGN   1757>>ASSIGN   1758>>IF       1758>>IF       1758>>IF       1758>>IF       1758>>IF
      1760>>ASSIGN   1761>>IF       1761>>ASSIGN   1761>>ASSIGN   1769>>ASSIGN   1772>>IF       1772>>ASSIGN
      1773>>ASSIGN   1773>>ASSIGN   1773>>ASSIGN   1774>>ASSIGN   1774>>ASSIGN   1774>>ASSIGN   1776>>ASSIGN
      1776>>ASSIGN   1778>>ASSIGN   1778>>ASSIGN   1779>>ASSIGN   1781>>ASSIGN   1781>>ASSIGN   1782>>ASSIGN
      1783>>ASSIGN   1785>>ASSIGN   1793<<ASSIGN   1799<<ASSIGN   1831>>ASSIGN   1842>>ASSIGN   1848>>ASSIGN
      1852>>ASSIGN   1860>>ASSIGN   1870>>ASSIGN   1958>>IF       2063>>ASSIGN   2074<<ASSIGN   2081>>IF
      2082>>ASSIGN   2083>>IF       2083>>IF       2083>>IF       2083>>IF       2083>>IF       2083>>IF
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:260  
      2089>>IF       2089>>IF       2089>>IF       2089>>IF       2089>>IF       2089>>IF       2102>>ASSIGN
      2105>>ASSIGN   2107>>ASSIGN   2111>>ASSIGN   2111>>ASSIGN   2112>>ASSIGN   2112>>ASSIGN   2113>>ASSIGN
      2113>>ASSIGN   2113>>ASSIGN   2114>>ASSIGN   2114>>ASSIGN   2114>>ASSIGN   2115>>ASSIGN   2116>>ASSIGN
      2118>>ASSIGN   2120>>IF
Y@T1 IN PROCEDURE Y$FNDSPCLNG
      1817**DCL      1995<<ASSIGN
Y@T1.F IN PROCEDURE Y$FNDSPCLNG
      1818**DCL      2011<<ASSIGN   2012>>IF       2024>>IF       2030<<ASSIGN   2038<<ASSIGN   2048>>ASSIGN
Y@T1.S IN PROCEDURE Y$FNDSPCLNG
      1819**DCL      2012>>IF       2018>>IF       2020>>IF       2020<<ASSIGN   2032<<ASSIGN   2037>>IF
      2040<<ASSIGN
Y@T2.F IN PROCEDURE Y$FNDSPCLNG
      1823**DCL      1978<<ASSIGN   1980>>ASSIGN   2026<<ASSIGN   2029>>DOUNTIL  2030>>ASSIGN   2035>>IF
      2042<<ASSIGN
Y@T2.S IN PROCEDURE Y$FNDSPCLNG
      1824**DCL      2027<<ASSIGN   2046>>IF       2047<<ASSIGN
Y@T2.T IN PROCEDURE Y$FNDSPCLNG
      1822**DCL      1823--REDEF    1977<<ASSIGN   1979<<ASSIGN   1979>>ASSIGN
Y@TMP IN PROCEDURE Y$FNDSPCLNG
      1810**DCL      1831<<ASSIGN   1842<<ASSIGN   1860>>ASSIGN   1861>>ASSIGN   1879<<ASSIGN   1881<<ASSIGN
      1900>>IF       1903<<ASSIGN   1907>>IF       1908>>ASSIGN   1909>>ASSIGN   1914<<ASSIGN   1915<<ASSIGN
      1919>>IF       1936>>ASSIGN   1940>>ASSIGN   1996<<DOINDEX  1997>>IF       1998>>ASSIGN   1999>>DOINDEX
      2008>>ASSIGN   2009>>ASSIGN   2011>>ASSIGN   2012>>IF       2012>>IF       2014>>ASSIGN   2016>>ASSIGN
      2019>>ASSIGN   2033>>DOUNTIL  2034<<ASSIGN   2034>>ASSIGN   2035>>IF       2036>>ASSIGN   2038>>ASSIGN
      2042>>ASSIGN   2050<<ASSIGN
Y@WDTMNS1 IN PROCEDURE Y$FNDSPCLNG
      1809**DCL      1830<<ASSIGN   1841<<ASSIGN   1852>>ASSIGN   1860>>IF       1872>>ASSIGN   1998>>ASSIGN
      2001>>IF       2004>>ASSIGN   2036>>ASSIGN
Y@WDTPLS1 IN PROCEDURE Y$FNDSPCLNG
      1808**DCL      1829<<ASSIGN   1840<<ASSIGN   1848>>ASSIGN   1885>>ASSIGN   1913>>IF       1981>>ASSIGN
      1984>>ASSIGN   2005>>ASSIGN   2008>>ASSIGN   2009>>ASSIGN   2056>>IF
Y@X
      1423**DCL      1614<<ASSIGN   1615>>IF       1615>>IF       1615>>IF       1623<<ASSIGN   1625>>ASSIGN
      1626>>ASSIGN   1627>>ASSIGN   1628>>ASSIGN   1638<<ASSIGN   1639>>IF       1639>>IF       1639>>IF
      1857<<ASSIGN   1864<<ASSIGN   1864>>ASSIGN   1919>>IF       1931>>IF       1932>>ASSIGN   1933<<ASSIGN
      1933>>ASSIGN   1938>>ASSIGN   1942>>IF       1978>>ASSIGN   1991>>IF       1996>>DOINDEX  1999>>DOINDEX
PL6.E3A0      #002=KVC$ADJWND File=KVC$CNC.:E05TSI                               WED 07/30/97 01:56 Page:261  
      2050>>ASSIGN   2058>>DOWHILE  2059<<ASSIGN   2059>>ASSIGN   2060>>ASSIGN   2061>>IF

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:262  
     1473        1        /*T***********************************************************/
     1474        2        /*T*                                                         */
     1475        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1476        4        /*T*                                                         */
     1477        5        /*T***********************************************************/
     1478        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     1479        7        /*F* NAME: KVC$DRWBRD.
     1480        8             PURPOSE: Draws the borders for the SRD pointed to by KV$PTR.SRD$.
     1481        9        */
     1482       10        KVC$DRWBRD: PROC;
     1483       11
     1484       12 S      %INCLUDE KV$GLB;
     1485       13 S      %INCLUDE KV$GLBCTX;
     1486       14 S      %INCLUDE KV$INT;
     1487       15 S      %INCLUDE KV$VDH;
     1488       16 S      %INCLUDE KV_GLBCNS_E;
     1489       17        %KV#VD_ORG_E;
     1490       25        %KV_PHSPSTMOD_E;
     1491       32        %KV$LINLST;
     1492       59        %KV$MRD;
     1493      106        %KV$MVD;
     1494      150        %KV$PTR;
     1495      193        %KV$SRD (STCLASS="BASED(Y@SRD$)");
     1496      468        %KV$VDI;
     1497      539        %EQU KV_SRD=CHARTEXT('KV$SRD');
     1498      540
     1499      541    1   DCL KVC$FIXPST ENTRY(1) ALTRET;
     1500      542    1   DCL KVC$FIXWDT ENTRY(1) ALTRET;
     1501      543    1   DCL KVO$OTPLCL ENTRY(1);
     1502      544    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
     1503      545    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
     1504      546
     1505      547    1   DCL Y@SRD$ PTR;
     1506      548        %KV$PST (NAME=Y@CRT, STCLASS=AUTO);
     1507      582        %KV$PST (NAME=Y@NONBLN, STCLASS=AUTO);
     1508      616    1   DCL Y@SCROLL BIT(1);
     1509      617    1   DCL Y@DVCLINBIS SBIN;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:263  
     1510      618    1   DCL Y@TOPLIN SBIN;
     1511      619    1   DCL Y@BTMLIN SBIN;
     1512      620    1   DCL OLDTOP SBIN;
     1513      621    1   DCL OLDLFT SBIN;
     1514      622    1   DCL OLDRHT SBIN;
     1515      623    1   DCL OLDBTM SBIN;
     1516      624    1   DCL BUFC CHAR(80);
     1517      625    1   DCL 1 BUF REDEF BUFC,
     1518      626    1          2 C(0:79) CHAR(1),
     1519      627    1          2 B(0:79) REDEF C UBIN(8) UNAL,
     1520      628    1          2 W(0:39) REDEF C UBIN,
     1521      629    1          2 D(0:19) REDEF C UBIN(32);
     1522      630        %KV$VDH_OTPLCL (NAME=Y@VDH_OTPLCL, STCLASS=AUTO);
     1523      703        %KV$VDH_OTPLCL (NAME=KV_VDH_OTPLCL, STCLASS=SYMREF);
     1524      776    1   DCL KV_USR_SETATR UBIN SYMREF;
     1525      777        %EJECT;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:264  
     1526      778    1      Y@SRD$ = KV$PTR.SRD$;
     1527      779    1      %KV_SRD.BRDUPD = '0'B;
     1528      780    2      IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN DO;
     1529      781    2         %KV_SRD.TOPBRD = '0'B;
     1530      782    2         %KV_SRD.LFTBRD = '0'B;
     1531      783    2         %KV_SRD.BTMBRD = '0'B;
     1532      784    2         %KV_SRD.RHTBRD = '0'B;
     1533      785    2         IF %KV_MVD.LINLST$->KV$LINLST.FRMDSP THEN RETURN;
     1534      786    2      END;
     1535      787    1      OLDTOP = %KV_SRD.TOPLFT.LIN-%KV_SRD.ORG.LIN-1;
     1536      788    1      OLDLFT = %KV_SRD.TOPLFT.CLM-%KV_SRD.ORG.CLM-%KV_SRD.LFTMRGCLM;
     1537      789    1      OLDRHT = %KV_SRD.SRDEND.CLM-%KV_SRD.BTMRHT.CLM;
     1538      790    1      OLDBTM = %KV_SRD.SRDEND.LIN-%KV_SRD.BTMRHT.LIN;
     1539      791    1      %KV_SRD.TOPLFT_PST = %KV_SRD.ORG_PST+%BITBIN('10001'X);
     1540      792    1      %KV_SRD.BTMRHT = %KV_SRD.SRDEND;
     1541      793    1      Y@TOPLIN = %KV_SRD.TOPLFT.LIN;
     1542      794    1      Y@BTMLIN = %KV_SRD.BTMRHT.LIN;
     1543      795    1      IF %KV_SRD.HBRDSIZ~=0 AND (%KV_SRD.TOPBRD OR %KV_SRD.BTMBRD)
     1544      796    2        OR %KV_SRD.VBRDSIZ~=0 AND (%KV_SRD.LFTBRD OR %KV_SRD.RHTBRD) THEN DO;
     1545      797    2         %KV_SRD.BRDEXS = '1'B;
     1546      798    2         %KV_SRD.UNKRGN = '1'B;
     1547      799    2         IF %KV_SRD.TOPBRD THEN Y@TOPLIN = Y@TOPLIN+%KV_SRD.HBRDSIZ;
     1548      800    2         IF %KV_SRD.BTMBRD THEN Y@BTMLIN = Y@BTMLIN-%KV_SRD.HBRDSIZ;
     1549      801    2         IF %KV_SRD.LFTBRD THEN OLDLFT = 0;
     1550      802    2         IF %KV_SRD.RHTBRD THEN OLDRHT = 0;
     1551      803    2      END; ELSE DO;
     1552      804    2         %KV_SRD.BRDEXS = '0'B;
     1553      805    2         %KV_SRD.WDT = MAXIMUM(%KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM,0);
     1554      806    2         %KV_SRD.LNG = MAXIMUM(%KV_SRD.SRDEND.LIN-%KV_SRD.ORG.LIN,0);
     1555      807    2         CALL KVC$FIXWDT (%KV_MVD);
     1556      808    2         IF %KV_SRD.CRT.LIN=0 THEN CALL KVC$FIXPST (%KV_MVD);
     1557      809    2         IF OLDTOP+OLDRHT+OLDBTM>0 OR OLDLFT>0 THEN EXIT;
     1558      810    2         RETURN;
     1559      811    2      END;
     1560      812    1      IF %KV_SRD.SRDEND.LIN<=%KV_SRD.ORG.LIN
     1561      813    1        OR %KV_SRD.SRDEND.CLM<=%KV_SRD.ORG.CLM THEN RETURN;
     1562      814    1      IF %KV_MRD.DCLATRWHNOTP AND %KV_MRD.DVCATR~='0'B
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:265  
     1563      815    1      THEN CALL KVV$CALUSR (KV_USR_SETATR);
     1564      816    1      Y@VDH_OTPLCL = KV_VDH_OTPLCL;
     1565      817    1      Y@VDH_OTPLCL.BFR_.ADR$ = ADDR(BUF);
     1566      818    1      Y@VDH_OTPLCL.NONVRT = '1'B;
     1567      819    1      Y@NONBLN = %KV_SRD.HI_NONBLN;
     1568      820    1      Y@CRT = %KV_SRD.CRT;
     1569      821    1      Y@SCROLL = %KV_SRD.SCROLL;
     1570      822    1      Y@DVCLINBIS = %KV_SRD.DVCLINBIS;
     1571      823    1      %KV_SRD.SCROLL = '0'B;
     1572      824    1      %KV_SRD.DVCLINBIS = 0;
     1573      825    1      %KV_SRD.FLDEND.CLM = 0;
     1574      826    1      %KV_SRD.HI_NONBLN = %KV_SRD.SRDEND;
     1575      827    1      CALL Y$PSTSKP;
     1576      828    1      %KV_SRD.CRT_PST = %KV_SRD.TOPLFT_PST;
     1577      829    1      %KV_SRD.BTMRHT.CLM = %KV_SRD.BTMRHT.CLM+1;
     1578      830    1      IF %KV_SRD.CRT.LIN<Y@TOPLIN THEN CALL Y$HRZBRD;
     1579      831    1      ELSE IF OLDTOP>0 THEN CALL Y$HRZBLN;
     1580      832    1      BUFC = ' ';
     1581      833    1      IF OLDLFT<=0 THEN BUF.B(0) = ASCBIN(%KV_SRD.VBRDCHR);
     1582      834    1      IF OLDRHT<=0 THEN BUF.C(79) = %KV_SRD.VBRDCHR;
     1583      835    1      Y@VDH_OTPLCL.BFR_.BYTSIZ =
     1584      836    1        MINIMUM(%KV_SRD.VBRDSIZ,%KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM);
     1585      837    2      DO WHILE %KV_SRD.CRT.LIN<=%KV_SRD.SRDEND.LIN;
     1586      838    2         Y@VDH_OTPLCL.BFR_.BYTX = 0;
     1587      839    2         IF %KV_SRD.CRT.LIN=%KV_SRD.SRDEND.LIN
     1588      840    3           AND (%KV_SRD.CRT.LIN>Y@BTMLIN OR OLDBTM>0) THEN DO;
     1589      841    3            IF %KV_SRD.CRT.LIN>Y@BTMLIN THEN CALL Y$HRZBRD;
     1590      842    3            ELSE CALL Y$HRZBLN;
     1591      843    3         END;
     1592      844    3         ELSE DO;
     1593      845    3            IF (%KV_SRD.LFTBRD OR OLDLFT>0)
     1594      846    4              AND Y@VDH_OTPLCL.BFR_.BYTSIZ~=0 THEN DO;
     1595      847    4               CALL KVO$OTPLCL (Y@VDH_OTPLCL);
     1596      848    4               CALL Y$PSTSKP;
     1597      849    4            END;
     1598      850    4            IF %KV_SRD.CRT.LIN<Y@TOPLIN OR %KV_SRD.CRT.LIN>Y@BTMLIN THEN DO;
     1599      851    4               IF %KV_SRD.CRT.CLM=%KV_SRD.TOPLFT.CLM THEN CALL KVV$CALUSR_PST;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:266  
     1600      852    4               %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_BLN;
     1601      853    4            END;
     1602      854    3            %KV_SRD.CRT.CLM = %KV_SRD.BTMRHT.CLM;
     1603      855    3            IF (%KV_SRD.RHTBRD OR OLDRHT>0)
     1604      856    4              AND Y@VDH_OTPLCL.BFR_.BYTSIZ~=0 THEN DO;
     1605      857    4               %KV_SRD.CRT.CLM = %KV_SRD.CRT.CLM-Y@VDH_OTPLCL.BFR_.BYTSIZ;
     1606      858    4               Y@VDH_OTPLCL.BFR_.BYTX = 80-Y@VDH_OTPLCL.BFR_.BYTSIZ;
     1607      859    4               IF %KV_SRD.CRT.LIN=%KV_MRD.LNG AND %KV_MRD.AUTONL
     1608      860    4                 AND %KV_MRD.DEVSCROLL AND %KV_SRD.SRDEND.CLM=%KV_MRD.WDT
     1609      861    4               THEN Y@VDH_OTPLCL.BFR_.BYTSIZ = Y@VDH_OTPLCL.BFR_.BYTSIZ-1;
     1610      862    4               CALL KVO$OTPLCL (Y@VDH_OTPLCL);
     1611      863    4            END;
     1612      864    3            CALL Y$PSTSKP;
     1613      865    3            %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;
     1614      866    3            %KV_SRD.CRT.LIN = %KV_SRD.CRT.LIN+1;
     1615      867    3         END;
     1616      868    2      END;
     1617      869    1      %KV_VDI.OTPCNDPND.PST = 0;
     1618      870    1      %KV_SRD.CRT = Y@CRT;
     1619      871    1      %KV_SRD.HI_NONBLN = Y@NONBLN;
     1620      872    1      %KV_SRD.SCROLL = Y@SCROLL;
     1621      873    1      %KV_SRD.DVCLINBIS = Y@DVCLINBIS;
     1622      874    1      IF %KV_SRD.LFTBRD
     1623      875    1      THEN %KV_SRD.TOPLFT.CLM = %KV_SRD.TOPLFT.CLM+%KV_SRD.VBRDSIZ;
     1624      876    1      IF %KV_SRD.RHTBRD
     1625      877    1      THEN %KV_SRD.BTMRHT.CLM = %KV_SRD.SRDEND.CLM-%KV_SRD.VBRDSIZ;
     1626      878    1      ELSE %KV_SRD.BTMRHT.CLM = %KV_SRD.SRDEND.CLM;
     1627      879    1      %KV_SRD.TOPLFT.LIN = Y@TOPLIN;
     1628      880    1      %KV_SRD.BTMRHT.LIN = Y@BTMLIN;
     1629      881    1      %KV_SRD.LNG = MAXIMUM(%KV_SRD.BTMRHT.LIN-%KV_SRD.TOPLFT.LIN+1,0);
     1630      882    1      IF %KV_SRD.LFTMRGCLM>1
     1631      883    1        AND %KV_SRD.TOPLFT.CLM+%KV_SRD.LFTMRGCLM<=%KV_SRD.BTMRHT.CLM
     1632      884    1      THEN %KV_SRD.TOPLFT.CLM = %KV_SRD.TOPLFT.CLM+%KV_SRD.LFTMRGCLM-1;
     1633      885    1      %KV_SRD.WDT = MAXIMUM(%KV_SRD.BTMRHT.CLM-%KV_SRD.TOPLFT.CLM+1,0);
     1634      886    1      CALL KVC$FIXWDT (%KV_MVD);
     1635      887    1      IF %KV_SRD.CRT.LIN<%KV_SRD.TOPLFT.LIN OR Y@CRT.CLM<%KV_SRD.TOPLFT.CLM
     1636      888    1        OR %KV_SRD.CRT.LIN>%KV_SRD.BTMRHT.LIN OR Y@CRT.CLM>%KV_SRD.BTMRHT.CLM
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:267  
     1637      889    1        OR Y@NONBLN.LIN>%KV_SRD.BTMRHT.LIN OR Y@NONBLN.CLM>%KV_SRD.BTMRHT.CLM
     1638      890    1      THEN CALL KVC$FIXPST (%KV_MVD);
     1639      891
     1640      892    1      RETURN;
     1641      893        %EJECT;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:268  
     1642      894        /*I* NAME: Y$HRZBRD.
     1643      895             Draws a horizontal border line.
     1644      896        */
     1645      897    1   Y$HRZBRD: PROC;
     1646      898
     1647      899    2   DCL Y@WDT UBIN;
     1648      900
     1649      901    2      BUF.W(1) = ASCBIN(%KV_SRD.HBRDCHR);
     1650      902    2      GOTO CMN;
     1651      903    2   Y$HRZBLN: ENTRY;
     1652      904    2      BUF.W(1) = ASCBIN(' ');
     1653      905    2   CMN:;
     1654      906    2      BUF.B(2) = BUF.W(1);
     1655      907    2      BUF.W(0) = BUF.W(1);
     1656      908    2      BUF.D(1) = BUF.D(0);
     1657      909    2      SUBSTR(BUFC,8,72) = SUBSTR(BUFC,0,72);
     1658      910    2      Y@WDT = %KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM;
     1659      911    2      IF Y@WDT>80 THEN Y@VDH_OTPLCL.BFR_.BYTSIZ = 79;
     1660      912    2      ELSE Y@VDH_OTPLCL.BFR_.BYTSIZ = Y@WDT;
     1661      913    3      IF %KV_SRD.VBRDCHR~=' ' AND %KV_SRD.VBRDSIZ>0 THEN DO;
     1662      914    3         IF %KV_SRD.LFTBRD THEN BUF.C(0) = %KV_SRD.VBRDCHR;
     1663      915    3         IF %KV_SRD.RHTBRD THEN IF Y@WDT>80 THEN BUF.C(79) = %KV_SRD.VBRDCHR;
     1664      916    3         ELSE BUF.C(Y@WDT-1) = %KV_SRD.VBRDCHR;
     1665      917    3      END;
     1666      918    2      IF %KV_SRD.CRT.LIN=%KV_MRD.LNG AND %KV_MRD.AUTONL AND %KV_MRD.DEVSCROLL
     1667      919    3        AND %KV_SRD.SRDEND.CLM=%KV_MRD.WDT THEN DO;
     1668      920    3         BUF.C(79) = %KV_SRD.HBRDCHR;
     1669      921    3         Y@WDT = Y@WDT-1;
     1670      922    3         Y@VDH_OTPLCL.BFR_.BYTSIZ = Y@VDH_OTPLCL.BFR_.BYTSIZ-1;
     1671      923    3      END;
     1672      924    2      CALL KVV$CALUSR_PST;
     1673      925    2      CALL KVO$OTPLCL (Y@VDH_OTPLCL);
     1674      926    3      DO WHILE Y@WDT>Y@VDH_OTPLCL.BFR_.BYTSIZ;
     1675      927    3         Y@WDT = Y@WDT-Y@VDH_OTPLCL.BFR_.BYTSIZ;
     1676      928    4         IF Y@WDT>79 THEN DO;
     1677      929    4            Y@VDH_OTPLCL.BFR_.BYTX = 1;
     1678      930    4            Y@VDH_OTPLCL.BFR_.BYTSIZ = 78;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:269  
     1679      931    4         END; ELSE DO;
     1680      932    4            Y@VDH_OTPLCL.BFR_.BYTX = 80-Y@WDT;
     1681      933    4            Y@VDH_OTPLCL.BFR_.BYTSIZ = Y@WDT;
     1682      934    4         END;
     1683      935    3         CALL KVO$OTPLCL (Y@VDH_OTPLCL);
     1684      936    3      END;
     1685      937    2      CALL Y$PSTSKP;
     1686      938    2      %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;
     1687      939    2      %KV_SRD.CRT.LIN = %KV_SRD.CRT.LIN+1;
     1688      940    2      RETURN;
     1689      941    2   END Y$HRZBRD;
     1690      942        %EJECT;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:270  
     1691      943        /*I* NAME: Y$PSTSKP.
     1692      944             DESCRIPTION: Sets position-pending - skip-mode.  Finishes any pending
     1693      945             blanking first.
     1694      946        */
     1695      947    1   Y$PSTSKP: PROC;
     1696      948    2      IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN THEN CALL KVV$CALUSR_PST;
     1697      949    2      %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;
     1698      950    2      RETURN;
     1699      951    2   END Y$PSTSKP;
     1700      952    1   END KVC$DRWBRD;

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:271  
--  Include file information  --

   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVC$DRWBRD.

   Procedure KVC$DRWBRD requires 1000 words for executable code.
   Procedure KVC$DRWBRD requires 72 words of local(AUTO) storage.

    No errors detected in file KVC$CNC.:E05TSI    .

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:272  

 Object Unit name= KVC$DRWBRD                                 File name= KVC$CNC.:E05TOU
 UTS= JUL 30 '97 01:57:49.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none  1000    3E8  KVC$DRWBRD
    1  RoData even  none     2      2  KVC$DRWBRD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        0  KVC$DRWBRD

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KVC$FIXWDT
 yes     yes           Std       0 KVV$CALUSR_PST
 yes     yes           Std       1 KVC$FIXPST
 yes     yes           Std       1 KVV$CALUSR
         yes           Std       1 KVO$OTPLCL
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:273  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                               KV_VDH_OTPLCL                         KV_USR_SETATR
r    G$ROS$
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:274  


     1473        1        /*T***********************************************************/
     1474        2        /*T*                                                         */
     1475        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1476        4        /*T*                                                         */
     1477        5        /*T***********************************************************/
     1478        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     1479        7        /*F* NAME: KVC$DRWBRD.
     1480        8             PURPOSE: Draws the borders for the SRD pointed to by KV$PTR.SRD$.
     1481        9        */
     1482       10        KVC$DRWBRD: PROC;

     10   0 000000  D380 0000 0000  xent KVC$DRWBRD      LNJ,B5   X6A_AUTO_0
          0 000003       0048 0000                       DC       72,0

     1483       11
     1484       12 S      %INCLUDE KV$GLB;
     1485       13 S      %INCLUDE KV$GLBCTX;
     1486       14 S      %INCLUDE KV$INT;
     1487       15 S      %INCLUDE KV$VDH;
     1488       16 S      %INCLUDE KV_GLBCNS_E;
     1489       17        %KV#VD_ORG_E;
     1490       25        %KV_PHSPSTMOD_E;
     1491       32        %KV$LINLST;
     1492       59        %KV$MRD;
     1493      106        %KV$MVD;
     1494      150        %KV$PTR;
     1495      193        %KV$SRD (STCLASS="BASED(Y@SRD$)");
     1496      468        %KV$VDI;
     1497      539        %EQU KV_SRD=CHARTEXT('KV$SRD');
     1498      540
     1499      541    1   DCL KVC$FIXPST ENTRY(1) ALTRET;
     1500      542    1   DCL KVC$FIXWDT ENTRY(1) ALTRET;
     1501      543    1   DCL KVO$OTPLCL ENTRY(1);
     1502      544    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
     1503      545    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
     1504      546
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:275  
     1505      547    1   DCL Y@SRD$ PTR;
     1506      548        %KV$PST (NAME=Y@CRT, STCLASS=AUTO);
     1507      582        %KV$PST (NAME=Y@NONBLN, STCLASS=AUTO);
     1508      616    1   DCL Y@SCROLL BIT(1);
     1509      617    1   DCL Y@DVCLINBIS SBIN;
     1510      618    1   DCL Y@TOPLIN SBIN;
     1511      619    1   DCL Y@BTMLIN SBIN;
     1512      620    1   DCL OLDTOP SBIN;
     1513      621    1   DCL OLDLFT SBIN;
     1514      622    1   DCL OLDRHT SBIN;
     1515      623    1   DCL OLDBTM SBIN;
     1516      624    1   DCL BUFC CHAR(80);
     1517      625    1   DCL 1 BUF REDEF BUFC,
     1518      626    1          2 C(0:79) CHAR(1),
     1519      627    1          2 B(0:79) REDEF C UBIN(8) UNAL,
     1520      628    1          2 W(0:39) REDEF C UBIN,
     1521      629    1          2 D(0:19) REDEF C UBIN(32);
     1522      630        %KV$VDH_OTPLCL (NAME=Y@VDH_OTPLCL, STCLASS=AUTO);
     1523      703        %KV$VDH_OTPLCL (NAME=KV_VDH_OTPLCL, STCLASS=SYMREF);
     1524      776    1   DCL KV_USR_SETATR UBIN SYMREF;
     1525      777        %EJECT;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:276  
     1526      778    1      Y@SRD$ = KV$PTR.SRD$;

    778   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DCC6 000A                            LDB,B5   10,B6
          0 00000A  DFC7 0004                            STB,B5   Y@SRD$,AUTO

     1527      779    1      %KV_SRD.BRDUPD = '0'B;

    779   0 00000C  8845 000F                            LBF,'0010'X       15,B5
    779   0 00000E       0010

     1528      780    2      IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN DO;

    780   0 00000F  CCC6 0006                            LDB,B4   6,B6
          0 000011  E2C4 0015                            LLH,R6   21,B4
          0 000013  6D04                                 CMV,R6   4
          0 000014  0981 0019                            BNE      s:787,PREL

     1529      781    2         %KV_SRD.TOPBRD = '0'B;

    781   0 000016  8845 001C                            LBF,'2000'X       28,B5
    781   0 000018       2000

     1530      782    2         %KV_SRD.LFTBRD = '0'B;

    782   0 000019  8845 001D                            LBF,'2000'X       29,B5
    782   0 00001B       2000

     1531      783    2         %KV_SRD.BTMBRD = '0'B;

    783   0 00001C  8845 001C                            LBF,'1000'X       28,B5
    783   0 00001E       1000

     1532      784    2         %KV_SRD.RHTBRD = '0'B;

    784   0 00001F  8845 001D                            LBF,'1000'X       29,B5
    784   0 000021       1000
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:277  

     1533      785    2         IF %KV_MVD.LINLST$->KV$LINLST.FRMDSP THEN RETURN;

    785   0 000022  CCC6 0006                            LDB,B4   6,B6
          0 000024  BCC4 0010                            LDB,B3   16,B4
          0 000026  82C3 0005                            LB,'0040'X        5,B3
          0 000028       0040
          0 000029  0581 0004                            BBF      s:787,PREL

    785   0 00002B  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1534      786    2      END;
     1535      787    1      OLDTOP = %KV_SRD.TOPLFT.LIN-%KV_SRD.ORG.LIN-1;

    787   0 00002E  E845 0009                            LDR,R6   9,B5
          0 000030  E245 0007                            SUB,R6   7,B5
          0 000032  6EFF                                 ADV,R6   -1
          0 000033  EF47 000E                            STR,R6   OLDTOP,AUTO

     1536      788    1      OLDLFT = %KV_SRD.TOPLFT.CLM-%KV_SRD.ORG.CLM-%KV_SRD.LFTMRGCLM;

    788   0 000035  D845 000A                            LDR,R5   10,B5
          0 000037  D245 0008                            SUB,R5   8,B5
          0 000039  C2C5 000F                            LLH,R4   15,B5
          0 00003B  C255                                 SUB,R4   R5
          0 00003C  8254                                 NEG      R4
          0 00003D  CF47 000F                            STR,R4   OLDLFT,AUTO

     1537      789    1      OLDRHT = %KV_SRD.SRDEND.CLM-%KV_SRD.BTMRHT.CLM;

    789   0 00003F  D845 001B                            LDR,R5   27,B5
          0 000041  D245 000C                            SUB,R5   12,B5
          0 000043  DF47 0010                            STR,R5   OLDRHT,AUTO

     1538      790    1      OLDBTM = %KV_SRD.SRDEND.LIN-%KV_SRD.BTMRHT.LIN;

    790   0 000045  B845 001A                            LDR,R3   26,B5
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:278  
          0 000047  B245 000B                            SUB,R3   11,B5
          0 000049  BF47 0011                            STR,R3   OLDBTM,AUTO

     1539      791    1      %KV_SRD.TOPLFT_PST = %KV_SRD.ORG_PST+%BITBIN('10001'X);

    791   0 00004B  8CC5 0007                            LDI      7,B5
          0 00004D  8470 0001 0001                       AID      65537,IMO
          0 000050  8D45 0009                            SDI      9,B5

     1540      792    1      %KV_SRD.BTMRHT = %KV_SRD.SRDEND;

    792   0 000052  8CC5 001A                            LDI      26,B5
          0 000054  8D45 000B                            SDI      11,B5

     1541      793    1      Y@TOPLIN = %KV_SRD.TOPLFT.LIN;

    793   0 000056  A845 0009                            LDR,R2   9,B5
          0 000058  AF47 000C                            STR,R2   Y@TOPLIN,AUTO

     1542      794    1      Y@BTMLIN = %KV_SRD.BTMRHT.LIN;

    794   0 00005A  9845 000B                            LDR,R1   11,B5
          0 00005C  9F47 000D                            STR,R1   Y@BTMLIN,AUTO

     1543      795    1      IF %KV_SRD.HBRDSIZ~=0 AND (%KV_SRD.TOPBRD OR %KV_SRD.BTMBRD)

    795   0 00005E  82C5 001C                            LB,'0F00'X        28,B5
    795   0 000060       0F00
          0 000061  0581 000B                            BBF      s:795+15,PREL
          0 000063  82C5 001C                            LB,'2000'X        28,B5
          0 000065       2000
          0 000066  0501 0015                            BBT      s:797,PREL
          0 000068  82C5 001C                            LB,'1000'X        28,B5
          0 00006A       1000
          0 00006B  0501 0010                            BBT      s:797,PREL
          0 00006D  82C5 001D                            LB,'0F00'X        29,B5
          0 00006F       0F00
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:279  
          0 000070  0581 003E                            BBF      s:804,PREL
          0 000072  82C5 001D                            LB,'2000'X        29,B5
          0 000074       2000
          0 000075  0501 0006                            BBT      s:797,PREL
          0 000077  82C5 001D                            LB,'1000'X        29,B5
          0 000079       1000
          0 00007A  0581 0034                            BBF      s:804,PREL

     1544      796    2        OR %KV_SRD.VBRDSIZ~=0 AND (%KV_SRD.LFTBRD OR %KV_SRD.RHTBRD) THEN DO;

     1545      797    2         %KV_SRD.BRDEXS = '1'B;

    797   0 00007C  8945 000F                            LBT,'0020'X       15,B5
    797   0 00007E       0020

     1546      798    2         %KV_SRD.UNKRGN = '1'B;

    798   0 00007F  8945 000F                            LBT,'0002'X       15,B5
    798   0 000081       0002

     1547      799    2         IF %KV_SRD.TOPBRD THEN Y@TOPLIN = Y@TOPLIN+%KV_SRD.HBRDSIZ;

    799   0 000082  82C5 001C                            LB,'2000'X        28,B5
    799   0 000084       2000
          0 000085  0581 000A                            BBF      s:800,PREL

    799   0 000087  E845 001C                            LDR,R6   28,B5
          0 000089  6048                                 SOR,R6   8
          0 00008A  E570 000F                            AND,R6   15,IMO
          0 00008C  EA52                                 ADD,R6   R2
          0 00008D  A856                                 LDR,R2   R6
          0 00008E  AF47 000C                            STR,R2   Y@TOPLIN,AUTO

     1548      800    2         IF %KV_SRD.BTMBRD THEN Y@BTMLIN = Y@BTMLIN-%KV_SRD.HBRDSIZ;

    800   0 000090  82C5 001C                            LB,'1000'X        28,B5
    800   0 000092       1000
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:280  
          0 000093  0581 000B                            BBF      s:801,PREL

    800   0 000095  E845 001C                            LDR,R6   28,B5
          0 000097  6048                                 SOR,R6   8
          0 000098  E570 000F                            AND,R6   15,IMO
          0 00009A  E251                                 SUB,R6   R1
          0 00009B  9856                                 LDR,R1   R6
          0 00009C  8251                                 NEG      R1
          0 00009D  9F47 000D                            STR,R1   Y@BTMLIN,AUTO

     1549      801    2         IF %KV_SRD.LFTBRD THEN OLDLFT = 0;

    801   0 00009F  82C5 001D                            LB,'2000'X        29,B5
    801   0 0000A1       2000
          0 0000A2  0581 0003                            BBF      s:802,PREL

    801   0 0000A4  8747 000F                            CL       OLDLFT,AUTO

     1550      802    2         IF %KV_SRD.RHTBRD THEN OLDRHT = 0;

    802   0 0000A6  82C5 001D                            LB,'1000'X        29,B5
    802   0 0000A8       1000
          0 0000A9  0581 004E                            BBF      s:812,PREL

    802   0 0000AB  8747 0010                            CL       OLDRHT,AUTO

     1551      803    2      END; ELSE DO;

    803   0 0000AD  0F81 004A                            B        s:812,PREL

     1552      804    2         %KV_SRD.BRDEXS = '0'B;

    804   0 0000AF  8845 000F                            LBF,'0020'X       15,B5
    804   0 0000B1       0020

     1553      805    2         %KV_SRD.WDT = MAXIMUM(%KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM,0);

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:281  
    805   0 0000B2  E845 001B                            LDR,R6   27,B5
          0 0000B4  E245 0008                            SUB,R6   8,B5
          0 0000B6  E970 0000                            CMR,R6   0,IMO
          0 0000B8  0881 0002                            BAGE     s:805+9,PREL
          0 0000BA  6C00                                 LDV,R6   0
          0 0000BB  EF45 000D                            STR,R6   13,B5

     1554      806    2         %KV_SRD.LNG = MAXIMUM(%KV_SRD.SRDEND.LIN-%KV_SRD.ORG.LIN,0);

    806   0 0000BD  E845 001A                            LDR,R6   26,B5
          0 0000BF  E245 0007                            SUB,R6   7,B5
          0 0000C1  E970 0000                            CMR,R6   0,IMO
          0 0000C3  0881 0002                            BAGE     s:806+9,PREL
          0 0000C5  6C00                                 LDV,R6   0
          0 0000C6  E7C5 000E                            STH,R6   14,B5

     1555      807    2         CALL KVC$FIXWDT (%KV_MVD);

    807   0 0000C8  CCC6 0006                            LDB,B4   6,B6
          0 0000CA  CFC7 0046                            STB,B4   Y@WDT+4,AUTO
          0 0000CC  BBC7 0046                            LAB,B3   Y@WDT+4,AUTO
          0 0000CE  CBF0 0100                            LAB,B4   256,IMO
          0 0000D0  E380 0000 0000  xent                 LNJ,B6   KVC$FIXWDT
          0 0000D3       0001                            DC       s:808,PREL

     1556      808    2         IF %KV_SRD.CRT.LIN=0 THEN CALL KVC$FIXPST (%KV_MVD);

    808   0 0000D4  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 0000D6  E846 0015                            LDR,R6   21,B6
          0 0000D8  6981 0010                            BNEZ,R6  s:809,PREL

    808   0 0000DA  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 0000DD  CCC5 0006                            LDB,B4   6,B5
          0 0000DF  CFC7 0046                            STB,B4   Y@WDT+4,AUTO
          0 0000E1  BBC7 0046                            LAB,B3   Y@WDT+4,AUTO
          0 0000E3  CBF0 0100                            LAB,B4   256,IMO
          0 0000E5  E380 0000 0000  xent                 LNJ,B6   KVC$FIXPST
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:282  
          0 0000E8       0001                            DC       s:809,PREL

     1557      809    2         IF OLDTOP+OLDRHT+OLDBTM>0 OR OLDLFT>0 THEN EXIT;

    809   0 0000E9  E847 000E                            LDR,R6   OLDTOP,AUTO
          0 0000EB  EA47 0010                            ADD,R6   OLDRHT,AUTO
          0 0000ED  EA47 0011                            ADD,R6   OLDBTM,AUTO
          0 0000EF  6A01 0008                            BGZ,R6   s:812,PREL
          0 0000F1  E847 000F                            LDR,R6   OLDLFT,AUTO
          0 0000F3  6A01 0004                            BGZ,R6   s:812,PREL

     1558      810    2         RETURN;

    810   0 0000F5  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1559      811    2      END;
     1560      812    1      IF %KV_SRD.SRDEND.LIN<=%KV_SRD.ORG.LIN

    812   0 0000F8  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 0000FA  E846 001A                            LDR,R6   26,B6
          0 0000FC  E946 0007                            CMR,R6   7,B6
          0 0000FE  0A81 0007                            BALE     s:813,PREL
          0 000100  D846 001B                            LDR,R5   27,B6
          0 000102  D946 0008                            CMR,R5   8,B6
          0 000104  0A01 0004                            BAG      s:814,PREL

     1561      813    1        OR %KV_SRD.SRDEND.CLM<=%KV_SRD.ORG.CLM THEN RETURN;

    813   0 000106  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1562      814    1      IF %KV_MRD.DCLATRWHNOTP AND %KV_MRD.DVCATR~='0'B

    814   0 000109  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 00010C  CCC5 0008                            LDB,B4   8,B5
          0 00010E  82C4 0018                            LB,'0200'X        24,B4
          0 000110       0200
          0 000111  0581 000F                            BBF      s:816,PREL
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:283  
          0 000113  C2C4 001F                            LLH,R4   31,B4
          0 000115  4008                                 SOL,R4   8
          0 000116  4901 000A                            BEZ,R4   s:816,PREL

     1563      815    1      THEN CALL KVV$CALUSR (KV_USR_SETATR);

    815   0 000118  BB80 0000 0000  01                   LAB,B3   0
          0 00011B  CBF0 0100                            LAB,B4   256,IMO
          0 00011D  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          0 000120       0001                            DC       s:816,PREL

     1564      816    1      Y@VDH_OTPLCL = KV_VDH_OTPLCL;

    816   0 000121  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_OTPLCL
          0 000124  2C00                                 LDV,R2   0
          0 000125  6C0A                                 LDV,R6   10
          0 000126  BB87                                 LAB,B3   ,AUTO
          0 000127  3C74                                 LDV,R3   116
          0 000128  0008                                 MMM

     1565      817    1      Y@VDH_OTPLCL.BFR_.ADR$ = ADDR(BUF);

    817   0 000129  EBC7 0012                            LAB,B6   BUFC,AUTO
          0 00012B  EFC7 003B                            STB,B6   Y@VDH_OTPLCL+1,AUTO

     1566      818    1      Y@VDH_OTPLCL.NONVRT = '1'B;

    818   0 00012D  8947 003A                            LBT,'0080'X       Y@VDH_OTPLCL,AUTO
    818   0 00012F       0080

     1567      819    1      Y@NONBLN = %KV_SRD.HI_NONBLN;

    819   0 000130  DCC7 0004                            LDB,B5   Y@SRD$,AUTO
          0 000132  8CC5 0017                            LDI      23,B5
          0 000134  8D47 0008                            SDI      Y@NONBLN,AUTO

     1568      820    1      Y@CRT = %KV_SRD.CRT;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:284  

    820   0 000136  8CC5 0015                            LDI      21,B5
          0 000138  8D47 0006                            SDI      Y@CRT,AUTO

     1569      821    1      Y@SCROLL = %KV_SRD.SCROLL;

    821   0 00013A  D845 000E                            LDR,R5   14,B5
          0 00013C  500C                                 SOL,R5   12
          0 00013D  D570 8000                            AND,R5   -32768,IMO
          0 00013F  DF47 000A                            STR,R5   Y@SCROLL,AUTO

     1570      822    1      Y@DVCLINBIS = %KV_SRD.DVCLINBIS;

    822   0 000141  C845 0019                            LDR,R4   25,B5
          0 000143  CF47 000B                            STR,R4   Y@DVCLINBIS,AUTO

     1571      823    1      %KV_SRD.SCROLL = '0'B;

    823   0 000145  8845 000E                            LBF,'0008'X       14,B5
    823   0 000147       0008

     1572      824    1      %KV_SRD.DVCLINBIS = 0;

    824   0 000148  8745 0019                            CL       25,B5

     1573      825    1      %KV_SRD.FLDEND.CLM = 0;

    825   0 00014A  8745 0011                            CL       17,B5

     1574      826    1      %KV_SRD.HI_NONBLN = %KV_SRD.SRDEND;

    826   0 00014C  8CC5 001A                            LDI      26,B5
          0 00014E  8D45 0017                            SDI      23,B5

     1575      827    1      CALL Y$PSTSKP;

    827   0 000150  E3C0 027B                            LNJ,B6   s:0,PREL
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:285  
          0 000152       0001                            DC       s:828,PREL

     1576      828    1      %KV_SRD.CRT_PST = %KV_SRD.TOPLFT_PST;

    828   0 000153  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 000155  8CC6 0009                            LDI      9,B6
          0 000157  8D46 0015                            SDI      21,B6

     1577      829    1      %KV_SRD.BTMRHT.CLM = %KV_SRD.BTMRHT.CLM+1;

    829   0 000159  8AC6 000C                            INC      12,B6

     1578      830    1      IF %KV_SRD.CRT.LIN<Y@TOPLIN THEN CALL Y$HRZBRD;

    830   0 00015B  D846 0015                            LDR,R5   21,B6
          0 00015D  D947 000C                            CMR,R5   Y@TOPLIN,AUTO
          0 00015F  0881 0006                            BAGE     s:831,PREL

    830   0 000161  E3C0 019B                            LNJ,B6   s:0,PREL
          0 000163       0001                            DC       s:830+9,PREL
          0 000164  0F81 0008                            B        s:832,PREL

     1579      831    1      ELSE IF OLDTOP>0 THEN CALL Y$HRZBLN;

    831   0 000166  C847 000E                            LDR,R4   OLDTOP,AUTO
          0 000168  4A81 0004                            BLEZ,R4  s:832,PREL

    831   0 00016A  E3C0 019E                            LNJ,B6   s:0,PREL
          0 00016C       0001                            DC       s:832,PREL

     1580      832    1      BUFC = ' ';

    832   0 00016D  D870 2050                            LDR,R5   8272,IMO
          0 00016F  0021                                 ALR      ;
          0 000170       4178 2000                                ALPHANUM('2000'X,IMO,,1),;
          0 000172       4007 0012                                ALPHANUM(BUFC,AUTO,,R5,FILL)

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:286  
     1581      833    1      IF OLDLFT<=0 THEN BUF.B(0) = ASCBIN(%KV_SRD.VBRDCHR);

    833   0 000174  E847 000F                            LDR,R6   OLDLFT,AUTO
          0 000176  437F                                 CSYNC    s:833+1,SPREL
          0 000177  6A01 0009                            BGZ,R6   s:834,PREL

    833   0 000179  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 00017B  C846 001D                            LDR,R4   29,B6
          0 00017D  C570 00FF                            AND,R4   255,IMO
          0 00017F  C7C7 0012                            STH,R4   BUFC,AUTO

     1582      834    1      IF OLDRHT<=0 THEN BUF.C(79) = %KV_SRD.VBRDCHR;

    834   0 000181  C847 0010                            LDR,R4   OLDRHT,AUTO
          0 000183  4A01 0008                            BGZ,R4   s:835,PREL

    834   0 000185  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 000187  B846 001D                            LDR,R3   29,B6
          0 000189  BAC7 0039                            SRM,R3,'00FF'X    BUFC+39,AUTO
          0 00018B       00FF

     1583      835    1      Y@VDH_OTPLCL.BFR_.BYTSIZ =

    835   0 00018C  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 00018E  B846 001B                            LDR,R3   27,B6
          0 000190  B246 0008                            SUB,R3   8,B6
          0 000192  A846 001D                            LDR,R2   29,B6
          0 000194  2048                                 SOR,R2   8
          0 000195  A570 000F                            AND,R2   15,IMO
          0 000197  A953                                 CMR,R2   R3
          0 000198  0881 0002                            BAGE     s:835+15,PREL
          0 00019A  B852                                 LDR,R3   R2
          0 00019B  BF47 003E                            STR,R3   Y@VDH_OTPLCL+4,AUTO

     1584      836    1        MINIMUM(%KV_SRD.VBRDSIZ,%KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM);
     1585      837    2      DO WHILE %KV_SRD.CRT.LIN<=%KV_SRD.SRDEND.LIN;

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:287  
    837   0 00019D  A846 0015                            LDR,R2   21,B6
          0 00019F  A946 001A                            CMR,R2   26,B6
          0 0001A1  0A01 00B4                            BAG      s:869,PREL

     1586      838    2         Y@VDH_OTPLCL.BFR_.BYTX = 0;

    838   0 0001A3  8747 003D                            CL       Y@VDH_OTPLCL+3,AUTO

     1587      839    2         IF %KV_SRD.CRT.LIN=%KV_SRD.SRDEND.LIN

    839   0 0001A5  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 0001A7  E846 0015                            LDR,R6   21,B6
          0 0001A9  E946 001A                            CMR,R6   26,B6
          0 0001AB  0981 0015                            BNE      s:845,PREL
          0 0001AD  E947 000D                            CMR,R6   Y@BTMLIN,AUTO
          0 0001AF  0A01 0005                            BAG      s:841,PREL
          0 0001B1  D847 0011                            LDR,R5   OLDBTM,AUTO
          0 0001B3  5A81 000D                            BLEZ,R5  s:845,PREL

     1588      840    3           AND (%KV_SRD.CRT.LIN>Y@BTMLIN OR OLDBTM>0) THEN DO;

     1589      841    3            IF %KV_SRD.CRT.LIN>Y@BTMLIN THEN CALL Y$HRZBRD;

    841   0 0001B5  0A81 0006                            BALE     s:842,PREL

    841   0 0001B7  E3C0 0145                            LNJ,B6   s:0,PREL
          0 0001B9       0001                            DC       s:841+5,PREL
          0 0001BA  0F81 0093                            B        s:868,PREL

     1590      842    3            ELSE CALL Y$HRZBLN;

    842   0 0001BC  E3C0 014C                            LNJ,B6   s:0,PREL
          0 0001BE       0001                            DC       s:843,PREL

     1591      843    3         END;

    843   0 0001BF  0F81 008E                            B        s:868,PREL
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:288  

     1592      844    3         ELSE DO;

     1593      845    3            IF (%KV_SRD.LFTBRD OR OLDLFT>0)

    845   0 0001C1  82C6 001D                            LB,'2000'X        29,B6
    845   0 0001C3       2000
          0 0001C4  0501 0005                            BBT      s:845+9,PREL
          0 0001C6  D847 000F                            LDR,R5   OLDLFT,AUTO
          0 0001C8  5A81 0014                            BLEZ,R5  s:850,PREL
          0 0001CA  D847 003E                            LDR,R5   Y@VDH_OTPLCL+4,AUTO
          0 0001CC  5901 0010                            BEZ,R5   s:850,PREL

     1594      846    4              AND Y@VDH_OTPLCL.BFR_.BYTSIZ~=0 THEN DO;

     1595      847    4               CALL KVO$OTPLCL (Y@VDH_OTPLCL);

    847   0 0001CE  DBC7 003A                            LAB,B5   Y@VDH_OTPLCL,AUTO
          0 0001D0  DFC7 0046                            STB,B5   Y@WDT+4,AUTO
          0 0001D2  BBC7 0046                            LAB,B3   Y@WDT+4,AUTO
          0 0001D4  CBF0 0100                            LAB,B4   256,IMO
          0 0001D6  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          0 0001D9       0001                            DC       s:848,PREL

     1596      848    4               CALL Y$PSTSKP;

    848   0 0001DA  E3C0 01F1                            LNJ,B6   s:0,PREL
          0 0001DC       0001                            DC       s:850,PREL

     1597      849    4            END;

     1598      850    4            IF %KV_SRD.CRT.LIN<Y@TOPLIN OR %KV_SRD.CRT.LIN>Y@BTMLIN THEN DO;

    850   0 0001DD  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 0001DF  E846 0015                            LDR,R6   21,B6
          0 0001E1  E947 000C                            CMR,R6   Y@TOPLIN,AUTO
          0 0001E3  0801 0005                            BAL      s:851,PREL
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:289  
          0 0001E5  E947 000D                            CMR,R6   Y@BTMLIN,AUTO
          0 0001E7  0A81 0014                            BALE     s:854,PREL

     1599      851    4               IF %KV_SRD.CRT.CLM=%KV_SRD.TOPLFT.CLM THEN CALL KVV$CALUSR_PST;

    851   0 0001E9  D846 0016                            LDR,R5   22,B6
          0 0001EB  D946 000A                            CMR,R5   10,B6
          0 0001ED  0981 0007                            BNE      s:852,PREL

    851   0 0001EF  CBF0 0000                            LAB,B4   0,IMO
          0 0001F1  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          0 0001F4       0001                            DC       s:852,PREL

     1600      852    4               %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_BLN;

    852   0 0001F5  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0001F8  DC86                                 LDB,B5   ,B6
          0 0001F9  6C02                                 LDV,R6   2
          0 0001FA  EF45 001A                            STR,R6   26,B5

     1601      853    4            END;

     1602      854    3            %KV_SRD.CRT.CLM = %KV_SRD.BTMRHT.CLM;

    854   0 0001FC  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 0001FE  E846 000C                            LDR,R6   12,B6
          0 000200  EF46 0016                            STR,R6   22,B6

     1603      855    3            IF (%KV_SRD.RHTBRD OR OLDRHT>0)

    855   0 000202  82C6 001D                            LB,'1000'X        29,B6
    855   0 000204       1000
          0 000205  0501 0005                            BBT      s:855+9,PREL
          0 000207  D847 0010                            LDR,R5   OLDRHT,AUTO
          0 000209  5A81 0039                            BLEZ,R5  s:864,PREL
          0 00020B  D847 003E                            LDR,R5   Y@VDH_OTPLCL+4,AUTO
          0 00020D  5901 0035                            BEZ,R5   s:864,PREL
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:290  

     1604      856    4              AND Y@VDH_OTPLCL.BFR_.BYTSIZ~=0 THEN DO;

     1605      857    4               %KV_SRD.CRT.CLM = %KV_SRD.CRT.CLM-Y@VDH_OTPLCL.BFR_.BYTSIZ;

    857   0 00020F  E255                                 SUB,R6   R5
          0 000210  EF46 0016                            STR,R6   22,B6

     1606      858    4               Y@VDH_OTPLCL.BFR_.BYTX = 80-Y@VDH_OTPLCL.BFR_.BYTSIZ;

    858   0 000212  D847 003E                            LDR,R5   Y@VDH_OTPLCL+4,AUTO
          0 000214  8255                                 NEG      R5
          0 000215  5E50                                 ADV,R5   80
          0 000216  DF47 003D                            STR,R5   Y@VDH_OTPLCL+3,AUTO

     1607      859    4               IF %KV_SRD.CRT.LIN=%KV_MRD.LNG AND %KV_MRD.AUTONL

    859   0 000218  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 00021B  CCC5 0008                            LDB,B4   8,B5
          0 00021D  E2C4 0015                            LLH,R6   21,B4
          0 00021F  E946 0015                            CMR,R6   21,B6
          0 000221  0981 0015                            BNE      s:862,PREL
          0 000223  82C4 0017                            LB,'1000'X        23,B4
          0 000225       1000
          0 000226  0581 0010                            BBF      s:862,PREL
          0 000228  82C4 0017                            LB,'0200'X        23,B4
          0 00022A       0200
          0 00022B  0581 000B                            BBF      s:862,PREL
          0 00022D  C846 001B                            LDR,R4   27,B6
          0 00022F  4801 0007                            BLZ,R4   s:862,PREL
          0 000231  C944 000B                            CMR,R4   11,B4
          0 000233  0981 0003                            BNE      s:862,PREL

     1608      860    4                 AND %KV_MRD.DEVSCROLL AND %KV_SRD.SRDEND.CLM=%KV_MRD.WDT
     1609      861    4               THEN Y@VDH_OTPLCL.BFR_.BYTSIZ = Y@VDH_OTPLCL.BFR_.BYTSIZ-1;

    861   0 000235  88C7 003E                            DEC      Y@VDH_OTPLCL+4,AUTO
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:291  

     1610      862    4               CALL KVO$OTPLCL (Y@VDH_OTPLCL);

    862   0 000237  CBC7 003A                            LAB,B4   Y@VDH_OTPLCL,AUTO
          0 000239  CFC7 0046                            STB,B4   Y@WDT+4,AUTO
          0 00023B  BBC7 0046                            LAB,B3   Y@WDT+4,AUTO
          0 00023D  CBF0 0100                            LAB,B4   256,IMO
          0 00023F  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          0 000242       0001                            DC       s:864,PREL

     1611      863    4            END;

     1612      864    3            CALL Y$PSTSKP;

    864   0 000243  E3C0 0188                            LNJ,B6   s:0,PREL
          0 000245       0001                            DC       s:865,PREL

     1613      865    3            %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;

    865   0 000246  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 000248  E846 000A                            LDR,R6   10,B6
          0 00024A  EF46 0016                            STR,R6   22,B6

     1614      866    3            %KV_SRD.CRT.LIN = %KV_SRD.CRT.LIN+1;

    866   0 00024C  8AC6 0015                            INC      21,B6

     1615      867    3         END;

     1616      868    2      END;

    868   0 00024E  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 000250  E846 0015                            LDR,R6   21,B6
          0 000252  E946 001A                            CMR,R6   26,B6
          0 000254  0A81 FF4E                            BALE     s:838,PREL

     1617      869    1      %KV_VDI.OTPCNDPND.PST = 0;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:292  

    869   0 000256  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 000259  CC85                                 LDB,B4   ,B5
          0 00025A  8744 001A                            CL       26,B4

     1618      870    1      %KV_SRD.CRT = Y@CRT;

    870   0 00025C  8CC7 0006                            LDI      Y@CRT,AUTO
          0 00025E  8D46 0015                            SDI      21,B6

     1619      871    1      %KV_SRD.HI_NONBLN = Y@NONBLN;

    871   0 000260  8CC7 0008                            LDI      Y@NONBLN,AUTO
          0 000262  8D46 0017                            SDI      23,B6

     1620      872    1      %KV_SRD.SCROLL = Y@SCROLL;

    872   0 000264  D847 000A                            LDR,R5   Y@SCROLL,AUTO
          0 000266  504C                                 SOR,R5   12
          0 000267  DAC6 000E                            SRM,R5,'0008'X    14,B6
          0 000269       0008

     1621      873    1      %KV_SRD.DVCLINBIS = Y@DVCLINBIS;

    873   0 00026A  D847 000B                            LDR,R5   Y@DVCLINBIS,AUTO
          0 00026C  DF46 0019                            STR,R5   25,B6

     1622      874    1      IF %KV_SRD.LFTBRD

    874   0 00026E  82C6 001D                            LB,'2000'X        29,B6
    874   0 000270       2000
          0 000271  0581 000A                            BBF      s:876,PREL

     1623      875    1      THEN %KV_SRD.TOPLFT.CLM = %KV_SRD.TOPLFT.CLM+%KV_SRD.VBRDSIZ;

    875   0 000273  C846 001D                            LDR,R4   29,B6
          0 000275  4048                                 SOR,R4   8
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:293  
          0 000276  C570 000F                            AND,R4   15,IMO
          0 000278  CA46 000A                            ADD,R4   10,B6
          0 00027A  CF46 000A                            STR,R4   10,B6

     1624      876    1      IF %KV_SRD.RHTBRD

    876   0 00027C  82C6 001D                            LB,'1000'X        29,B6
    876   0 00027E       1000
          0 00027F  0581 000D                            BBF      s:878,PREL

     1625      877    1      THEN %KV_SRD.BTMRHT.CLM = %KV_SRD.SRDEND.CLM-%KV_SRD.VBRDSIZ;

    877   0 000281  C846 001D                            LDR,R4   29,B6
          0 000283  4048                                 SOR,R4   8
          0 000284  C570 000F                            AND,R4   15,IMO
          0 000286  C246 001B                            SUB,R4   27,B6
          0 000288  8254                                 NEG      R4
          0 000289  CF46 000C                            STR,R4   12,B6
          0 00028B  0F81 0005                            B        s:879,PREL

     1626      878    1      ELSE %KV_SRD.BTMRHT.CLM = %KV_SRD.SRDEND.CLM;

    878   0 00028D  C846 001B                            LDR,R4   27,B6
          0 00028F  CF46 000C                            STR,R4   12,B6

     1627      879    1      %KV_SRD.TOPLFT.LIN = Y@TOPLIN;

    879   0 000291  B847 000C                            LDR,R3   Y@TOPLIN,AUTO
          0 000293  BF46 0009                            STR,R3   9,B6

     1628      880    1      %KV_SRD.BTMRHT.LIN = Y@BTMLIN;

    880   0 000295  A847 000D                            LDR,R2   Y@BTMLIN,AUTO
          0 000297  AF46 000B                            STR,R2   11,B6

     1629      881    1      %KV_SRD.LNG = MAXIMUM(%KV_SRD.BTMRHT.LIN-%KV_SRD.TOPLFT.LIN+1,0);

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:294  
    881   0 000299  A253                                 SUB,R2   R3
          0 00029A  2E01                                 ADV,R2   1
          0 00029B  A970 0000                            CMR,R2   0,IMO
          0 00029D  0881 0002                            BAGE     s:881+7,PREL
          0 00029F  2C00                                 LDV,R2   0
          0 0002A0  A7C6 000E                            STH,R2   14,B6

     1630      882    1      IF %KV_SRD.LFTMRGCLM>1

    882   0 0002A2  A2C6 000F                            LLH,R2   15,B6
          0 0002A4  2D01                                 CMV,R2   1
          0 0002A5  0381 000D                            BLE      s:885,PREL
          0 0002A7  AA46 000A                            ADD,R2   10,B6
          0 0002A9  A954                                 CMR,R2   R4
          0 0002AA  0A01 0008                            BAG      s:885,PREL

     1631      883    1        AND %KV_SRD.TOPLFT.CLM+%KV_SRD.LFTMRGCLM<=%KV_SRD.BTMRHT.CLM
     1632      884    1      THEN %KV_SRD.TOPLFT.CLM = %KV_SRD.TOPLFT.CLM+%KV_SRD.LFTMRGCLM-1;

    884   0 0002AC  A2C6 000F                            LLH,R2   15,B6
          0 0002AE  AA46 000A                            ADD,R2   10,B6
          0 0002B0  2EFF                                 ADV,R2   -1
          0 0002B1  AF46 000A                            STR,R2   10,B6

     1633      885    1      %KV_SRD.WDT = MAXIMUM(%KV_SRD.BTMRHT.CLM-%KV_SRD.TOPLFT.CLM+1,0);

    885   0 0002B3  C246 000A                            SUB,R4   10,B6
          0 0002B5  4E01                                 ADV,R4   1
          0 0002B6  C970 0000                            CMR,R4   0,IMO
          0 0002B8  0881 0002                            BAGE     s:885+8,PREL
          0 0002BA  4C00                                 LDV,R4   0
          0 0002BB  CF46 000D                            STR,R4   13,B6

     1634      886    1      CALL KVC$FIXWDT (%KV_MVD);

    886   0 0002BD  CCC5 0006                            LDB,B4   6,B5
          0 0002BF  CFC7 0046                            STB,B4   Y@WDT+4,AUTO
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:295  
          0 0002C1  BBC7 0046                            LAB,B3   Y@WDT+4,AUTO
          0 0002C3  CBF0 0100                            LAB,B4   256,IMO
          0 0002C5  E380 0000 0000  xent                 LNJ,B6   KVC$FIXWDT
          0 0002C8       0001                            DC       s:887,PREL

     1635      887    1      IF %KV_SRD.CRT.LIN<%KV_SRD.TOPLFT.LIN OR Y@CRT.CLM<%KV_SRD.TOPLFT.CLM

    887   0 0002C9  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 0002CB  E846 0015                            LDR,R6   21,B6
          0 0002CD  E946 0009                            CMR,R6   9,B6
          0 0002CF  0801 001B                            BAL      s:890,PREL
          0 0002D1  D847 0007                            LDR,R5   Y@CRT+1,AUTO
          0 0002D3  D946 000A                            CMR,R5   10,B6
          0 0002D5  0801 0015                            BAL      s:890,PREL
          0 0002D7  E946 000B                            CMR,R6   11,B6
          0 0002D9  0A01 0011                            BAG      s:890,PREL
          0 0002DB  D946 000C                            CMR,R5   12,B6
          0 0002DD  0A01 000D                            BAG      s:890,PREL
          0 0002DF  C847 0008                            LDR,R4   Y@NONBLN,AUTO
          0 0002E1  C946 000B                            CMR,R4   11,B6
          0 0002E3  0A01 0007                            BAG      s:890,PREL
          0 0002E5  B847 0009                            LDR,R3   Y@NONBLN+1,AUTO
          0 0002E7  B946 000C                            CMR,R3   12,B6
          0 0002E9  0A81 0010                            BALE     s:892,PREL

     1636      888    1        OR %KV_SRD.CRT.LIN>%KV_SRD.BTMRHT.LIN OR Y@CRT.CLM>%KV_SRD.BTMRHT.CLM
     1637      889    1        OR Y@NONBLN.LIN>%KV_SRD.BTMRHT.LIN OR Y@NONBLN.CLM>%KV_SRD.BTMRHT.CLM
     1638      890    1      THEN CALL KVC$FIXPST (%KV_MVD);

    890   0 0002EB  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 0002EE  CCC5 0006                            LDB,B4   6,B5
          0 0002F0  CFC7 0046                            STB,B4   Y@WDT+4,AUTO
          0 0002F2  BBC7 0046                            LAB,B3   Y@WDT+4,AUTO
          0 0002F4  CBF0 0100                            LAB,B4   256,IMO
          0 0002F6  E380 0000 0000  xent                 LNJ,B6   KVC$FIXPST
          0 0002F9       0001                            DC       s:892,PREL

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:296  
     1639      891
     1640      892    1      RETURN;

    892   0 0002FA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1641      893        %EJECT;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:297  
     1642      894        /*I* NAME: Y$HRZBRD.
     1643      895             Draws a horizontal border line.
     1644      896        */
     1645      897    1   Y$HRZBRD: PROC;

    897   0 0002FD  EFC7 0040            Y$HRZBRD        STB,B6   Y@VDH_OTPLCL+6,AUTO

     1646      898
     1647      899    2   DCL Y@WDT UBIN;
     1648      900
     1649      901    2      BUF.W(1) = ASCBIN(%KV_SRD.HBRDCHR);

    901   0 0002FF  DCC7 0004                            LDB,B5   Y@SRD$,AUTO
          0 000301  E845 001C                            LDR,R6   28,B5
          0 000303  E570 00FF                            AND,R6   255,IMO
          0 000305  EF47 0013                            STR,R6   BUFC+1,AUTO

     1650      902    2      GOTO CMN;

    902   0 000307  0F81 0006                            B        s:904,PREL

     1651      903    2   Y$HRZBLN: ENTRY;

    903   0 000309  EFC7 0040            Y$HRZBLN        STB,B6   Y@VDH_OTPLCL+6,AUTO

     1652      904    2      BUF.W(1) = ASCBIN(' ');

    904   0 00030B  6C20                                 LDV,R6   32
          0 00030C  EF47 0013                            STR,R6   BUFC+1,AUTO

    904   0                              CMN             null
     1653      905    2   CMN:;
     1654      906    2      BUF.B(2) = BUF.W(1);

    906   0 00030E  E7C7 0013            CMN             STH,R6   BUFC+1,AUTO

     1655      907    2      BUF.W(0) = BUF.W(1);
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:298  

    907   0 000310  E847 0013                            LDR,R6   BUFC+1,AUTO
          0 000312  EF47 0012                            STR,R6   BUFC,AUTO

     1656      908    2      BUF.D(1) = BUF.D(0);

    908   0 000314  8CC7 0012                            LDI      BUFC,AUTO
          0 000316  8D47 0014                            SDI      BUFC+2,AUTO

     1657      909    2      SUBSTR(BUFC,8,72) = SUBSTR(BUFC,0,72);

    909   0 000318  AB87                                 LAB,B2   ,AUTO
          0 000319  2C24                                 LDV,R2   36
          0 00031A  6C48                                 LDV,R6   72
          0 00031B  BB87                                 LAB,B3   ,AUTO
          0 00031C  3C2C                                 LDV,R3   44
          0 00031D  0008                                 MMM

     1658      910    2      Y@WDT = %KV_SRD.SRDEND.CLM-%KV_SRD.ORG.CLM;

    910   0 00031E  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 000320  E846 001B                            LDR,R6   27,B6
          0 000322  E246 0008                            SUB,R6   8,B6
          0 000324  EF47 0042                            STR,R6   Y@WDT,AUTO

     1659      911    2      IF Y@WDT>80 THEN Y@VDH_OTPLCL.BFR_.BYTSIZ = 79;

    911   0 000326  6D50                                 CMV,R6   80
          0 000327  0381 0006                            BLE      s:912,PREL

    911   0 000329  5C4F                                 LDV,R5   79
          0 00032A  DF47 003E                            STR,R5   Y@VDH_OTPLCL+4,AUTO
          0 00032C  0F81 0003                            B        s:913,PREL

     1660      912    2      ELSE Y@VDH_OTPLCL.BFR_.BYTSIZ = Y@WDT;

    912   0 00032E  EF47 003E                            STR,R6   Y@VDH_OTPLCL+4,AUTO
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:299  

     1661      913    3      IF %KV_SRD.VBRDCHR~=' ' AND %KV_SRD.VBRDSIZ>0 THEN DO;

    913   0 000330  D846 001D                            LDR,R5   29,B6
          0 000332  5008                                 SOL,R5   8
          0 000333  5068                                 SAR,R5   8
          0 000334  5D20                                 CMV,R5   32
          0 000335  0901 001F                            BE       s:918,PREL
          0 000337  82C6 001D                            LB,'0F00'X        29,B6
          0 000339       0F00
          0 00033A  0581 001A                            BBF      s:918,PREL

     1662      914    3         IF %KV_SRD.LFTBRD THEN BUF.C(0) = %KV_SRD.VBRDCHR;

    914   0 00033C  82C6 001D                            LB,'2000'X        29,B6
    914   0 00033E       2000
          0 00033F  0581 0003                            BBF      s:915,PREL

    914   0 000341  D7C7 0012                            STH,R5   BUFC,AUTO

     1663      915    3         IF %KV_SRD.RHTBRD THEN IF Y@WDT>80 THEN BUF.C(79) = %KV_SRD.VBRDCHR;

    915   0 000343  82C6 001D                            LB,'1000'X        29,B6
    915   0 000345       1000
          0 000346  0581 000E                            BBF      s:918,PREL

    915   0 000348  6D50                                 CMV,R6   80
          0 000349  0381 0008                            BLE      s:916,PREL

    915   0 00034B  C846 001D                            LDR,R4   29,B6
          0 00034D  CAC7 0039                            SRM,R4,'00FF'X    BUFC+39,AUTO
          0 00034F       00FF
          0 000350  0F81 0004                            B        s:918,PREL

     1664      916    3         ELSE BUF.C(Y@WDT-1) = %KV_SRD.VBRDCHR;

    916   0 000352  B856                                 LDR,R3   R6
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:300  
          0 000353  3E23                                 ADV,R3   35
          0 000354  D7B7                                 STH,R5   ,AUTO,R3

     1665      917    3      END;

     1666      918    2      IF %KV_SRD.CRT.LIN=%KV_MRD.LNG AND %KV_MRD.AUTONL AND %KV_MRD.DEVSCROLL

    918   0 000355  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 000358  CCC5 0008                            LDB,B4   8,B5
          0 00035A  D2C4 0015                            LLH,R5   21,B4
          0 00035C  D946 0015                            CMR,R5   21,B6
          0 00035E  0981 001C                            BNE      s:924,PREL
          0 000360  82C4 0017                            LB,'1000'X        23,B4
          0 000362       1000
          0 000363  0581 0017                            BBF      s:924,PREL
          0 000365  82C4 0017                            LB,'0200'X        23,B4
          0 000367       0200
          0 000368  0581 0012                            BBF      s:924,PREL
          0 00036A  C846 001B                            LDR,R4   27,B6
          0 00036C  4801 000E                            BLZ,R4   s:924,PREL
          0 00036E  C944 000B                            CMR,R4   11,B4
          0 000370  0981 000A                            BNE      s:924,PREL

     1667      919    3        AND %KV_SRD.SRDEND.CLM=%KV_MRD.WDT THEN DO;

     1668      920    3         BUF.C(79) = %KV_SRD.HBRDCHR;

    920   0 000372  B846 001C                            LDR,R3   28,B6
          0 000374  BAC7 0039                            SRM,R3,'00FF'X    BUFC+39,AUTO
          0 000376       00FF

     1669      921    3         Y@WDT = Y@WDT-1;

    921   0 000377  88C7 0042                            DEC      Y@WDT,AUTO

     1670      922    3         Y@VDH_OTPLCL.BFR_.BYTSIZ = Y@VDH_OTPLCL.BFR_.BYTSIZ-1;

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:301  
    922   0 000379  88C7 003E                            DEC      Y@VDH_OTPLCL+4,AUTO

     1671      923    3      END;

     1672      924    2      CALL KVV$CALUSR_PST;

    924   0 00037B  CBF0 0000                            LAB,B4   0,IMO
          0 00037D  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          0 000380       0001                            DC       s:925,PREL

     1673      925    2      CALL KVO$OTPLCL (Y@VDH_OTPLCL);

    925   0 000381  EBC7 003A                            LAB,B6   Y@VDH_OTPLCL,AUTO
          0 000383  EFC7 0046                            STB,B6   Y@WDT+4,AUTO
          0 000385  BBC7 0046                            LAB,B3   Y@WDT+4,AUTO
          0 000387  CBF0 0100                            LAB,B4   256,IMO
          0 000389  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          0 00038C       0001                            DC       s:926,PREL

     1674      926    3      DO WHILE Y@WDT>Y@VDH_OTPLCL.BFR_.BYTSIZ;

    926   0 00038D  E847 0042                            LDR,R6   Y@WDT,AUTO
          0 00038F  E947 003E                            CMR,R6   Y@VDH_OTPLCL+4,AUTO
          0 000391  0381 002B                            BLE      s:937,PREL

     1675      927    3         Y@WDT = Y@WDT-Y@VDH_OTPLCL.BFR_.BYTSIZ;

    927   0 000393  E847 0042                            LDR,R6   Y@WDT,AUTO
          0 000395  E247 003E                            SUB,R6   Y@VDH_OTPLCL+4,AUTO
          0 000397  EF47 0042                            STR,R6   Y@WDT,AUTO

     1676      928    4         IF Y@WDT>79 THEN DO;

    928   0 000399  6D4F                                 CMV,R6   79
          0 00039A  0381 0009                            BLE      s:932,PREL

     1677      929    4            Y@VDH_OTPLCL.BFR_.BYTX = 1;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:302  

    929   0 00039C  5C01                                 LDV,R5   1
          0 00039D  DF47 003D                            STR,R5   Y@VDH_OTPLCL+3,AUTO

     1678      930    4            Y@VDH_OTPLCL.BFR_.BYTSIZ = 78;

    930   0 00039F  4C4E                                 LDV,R4   78
          0 0003A0  CF47 003E                            STR,R4   Y@VDH_OTPLCL+4,AUTO

     1679      931    4         END; ELSE DO;

    931   0 0003A2  0F81 0009                            B        s:935,PREL

     1680      932    4            Y@VDH_OTPLCL.BFR_.BYTX = 80-Y@WDT;

    932   0 0003A4  8256                                 NEG      R6
          0 0003A5  6E50                                 ADV,R6   80
          0 0003A6  EF47 003D                            STR,R6   Y@VDH_OTPLCL+3,AUTO

     1681      933    4            Y@VDH_OTPLCL.BFR_.BYTSIZ = Y@WDT;

    933   0 0003A8  D847 0042                            LDR,R5   Y@WDT,AUTO
          0 0003AA  DF47 003E                            STR,R5   Y@VDH_OTPLCL+4,AUTO

     1682      934    4         END;

     1683      935    3         CALL KVO$OTPLCL (Y@VDH_OTPLCL);

    935   0 0003AC  EBC7 003A                            LAB,B6   Y@VDH_OTPLCL,AUTO
          0 0003AE  EFC7 0046                            STB,B6   Y@WDT+4,AUTO
          0 0003B0  BBC7 0046                            LAB,B3   Y@WDT+4,AUTO
          0 0003B2  CBF0 0100                            LAB,B4   256,IMO
          0 0003B4  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          0 0003B7       0001                            DC       s:936,PREL

     1684      936    3      END;

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:303  
    936   0 0003B8  E847 0042                            LDR,R6   Y@WDT,AUTO
          0 0003BA  E947 003E                            CMR,R6   Y@VDH_OTPLCL+4,AUTO
          0 0003BC  0357                                 BG       s:927,SPREL

     1685      937    2      CALL Y$PSTSKP;

    937   0 0003BD  E3C0 000E                            LNJ,B6   s:0,PREL
          0 0003BF       0001                            DC       s:938,PREL

     1686      938    2      %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;

    938   0 0003C0  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 0003C2  E846 000A                            LDR,R6   10,B6
          0 0003C4  EF46 0016                            STR,R6   22,B6

     1687      939    2      %KV_SRD.CRT.LIN = %KV_SRD.CRT.LIN+1;

    939   0 0003C6  8AC6 0015                            INC      21,B6

     1688      940    2      RETURN;

    940   0 0003C8  ECC7 0040                            LDB,B6   Y@VDH_OTPLCL+6,AUTO
          0 0003CA  C3C6 0001                            LNJ,B4   1,B6

     1689      941    2   END Y$HRZBRD;
     1690      942        %EJECT;
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:304  
     1691      943        /*I* NAME: Y$PSTSKP.
     1692      944             DESCRIPTION: Sets position-pending - skip-mode.  Finishes any pending
     1693      945             blanking first.
     1694      946        */
     1695      947    1   Y$PSTSKP: PROC;

    947   0 0003CC  EFC7 0044            Y$PSTSKP        STB,B6   Y@WDT+2,AUTO

     1696      948    2      IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN THEN CALL KVV$CALUSR_PST;

    948   0 0003CE  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 0003D1  CC85                                 LDB,B4   ,B5
          0 0003D2  E844 001A                            LDR,R6   26,B4
          0 0003D4  6D02                                 CMV,R6   2
          0 0003D5  0981 0007                            BNE      s:949,PREL

    948   0 0003D7  CBF0 0000                            LAB,B4   0,IMO
          0 0003D9  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          0 0003DC       0001                            DC       s:949,PREL

     1697      949    2      %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;

    949   0 0003DD  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0003E0  DC86                                 LDB,B5   ,B6
          0 0003E1  6C01                                 LDV,R6   1
          0 0003E2  EF45 001A                            STR,R6   26,B5

     1698      950    2      RETURN;

    950   0 0003E4  ECC7 0044                            LDB,B6   Y@WDT+2,AUTO
          0 0003E6  C3C6 0001                            LNJ,B4   1,B6
     1699      951    2   END Y$PSTSKP;
     1700      952    1   END KVC$DRWBRD;

PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:305  
--  Include file information  --

   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVC$DRWBRD.
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:306  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    12-0-0/w STRC(640)   r     1 BUF                       12-0-0/w CHAR(80)    r     1 BUFC
    11-0-0/w SBIN(16)    r     1 OLDBTM                     F-0-0/w SBIN(16)    r     1 OLDLFT
    10-0-0/w SBIN(16)    r     1 OLDRHT                     E-0-0/w SBIN(16)    r     1 OLDTOP
     D-0-0/w SBIN(16)    r     1 Y@BTMLIN                   6-0-0/w STRC(32)    r     1 Y@CRT
     B-0-0/w SBIN(16)    r     1 Y@DVCLINBIS                8-0-0/w STRC(32)    r     1 Y@NONBLN
     A-0-0/b BIT         r     1 Y@SCROLL                   4-0-0/w PTR         r     1 Y@SRD$
     C-0-0/w SBIN(16)    r     1 Y@TOPLIN                  3A-0-0/w STRC(80)    r     1 Y@VDH_OTPLCL
    42-0-0/w UBIN(16)    r     1 Y@WDT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w UBIN(16)    r     1 KV_USR_SETATR
     0-0-0/w STRC(80)    r     1 KV_VDH_OTPLCL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(128)   r     1 KV$LINLST                  0-0-0/w STRC(512)   r     1 KV$MRD
     0-0-0/w STRC(512)   r     1 KV$MVD                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(496)   r     1 KV$SRD                     0-0-0/w STRC(512)   r     1 KV$VDI


   Procedure KVC$DRWBRD requires 1000 words for executable code.
   Procedure KVC$DRWBRD requires 72 words of local(AUTO) storage.
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:307  

    No errors detected in file KVC$CNC.:E05TSI    .
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:308  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:309  
          MINI XREF LISTING

BUF
       625**DCL       817--ASSIGN
BUF.B
       627**DCL       833<<ASSIGN    906<<ASSIGN
BUF.C
       626**DCL       627--REDEF     628--REDEF     629--REDEF     834<<ASSIGN    914<<ASSIGN    915<<ASSIGN
       916<<ASSIGN    920<<ASSIGN
BUF.D
       629**DCL       908<<ASSIGN    908>>ASSIGN
BUF.W
       628**DCL       901<<ASSIGN    904<<ASSIGN    906>>ASSIGN    907<<ASSIGN    907>>ASSIGN
BUFC
       624**DCL       625--REDEF     832<<ASSIGN    909<<ASSIGN    909>>ASSIGN
CMN IN PROCEDURE Y$HRZBRD
       904**LABEL     902--GOTO
KV$LINLST.FRMDSP
        55**DCL       785>>IF
KV$MRD.AUTONL
        89**DCL       859>>IF        918>>IF
KV$MRD.DCLATRWHNOTP
        94**DCL       814>>IF
KV$MRD.DEVSCROLL
        90**DCL       859>>IF        918>>IF
KV$MRD.DVCATR
       103**DCL       814>>IF
KV$MRD.LNG
        85**DCL       859>>IF        918>>IF
KV$MRD.WDT
        82**DCL       859>>IF        918>>IF
KV$MVD
       128**DCL       807<>CALL      808<>CALL      886<>CALL      890<>CALL
KV$MVD.LINLST$
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:310  
       131**DCL       785>>IF
KV$MVD.ORG
       133**DCL       780>>IF
KV$PTR.INPCNDPND
       177**DCL       186--REDEF     190--REDEF
KV$PTR.LINLST$
       173**DCL       174--REDEF
KV$PTR.MRD$
       172**DCL       814>>IF        814>>IF        859>>IF        859>>IF        859>>IF        859>>IF
       918>>IF        918>>IF        918>>IF        918>>IF
KV$PTR.MVD$
       172**DCL       780>>IF        785>>IF        807>>CALL      808>>CALL      886>>CALL      890>>CALL
KV$PTR.SRD$
       173**DCL       778>>ASSIGN
KV$PTR.VDI$
       171**DCL       852>>ASSIGN    869>>ASSIGN    948>>IF        949>>ASSIGN
KV$PTR$
       165**DCL       171--IMP-PTR   778>>ASSIGN    780>>IF        785>>IF        807>>CALL      808>>CALL
       814>>IF        814>>IF        852>>ASSIGN    859>>IF        859>>IF        859>>IF        859>>IF
       869>>ASSIGN    886>>CALL      890>>CALL      918>>IF        918>>IF        918>>IF        918>>IF
       948>>IF        949>>ASSIGN
KV$SRD.BRDEXS
       321**DCL       797<<ASSIGN    804<<ASSIGN
KV$SRD.BRDUPD
       322**DCL       779<<ASSIGN
KV$SRD.BTMBRD
       463**DCL       783<<ASSIGN    795>>IF        800>>IF
KV$SRD.BTMRHT
       310**DCL       315--REDEF     792<<ASSIGN
KV$SRD.BTMRHT.CLM
       312**DCL       789>>ASSIGN    829<<ASSIGN    829>>ASSIGN    854>>ASSIGN    877<<ASSIGN    878<<ASSIGN
       882>>IF        885>>ASSIGN    887>>IF        887>>IF
KV$SRD.BTMRHT.LIN
       312**DCL       790>>ASSIGN    794>>ASSIGN    880<<ASSIGN    881>>ASSIGN    887>>IF        887>>IF
KV$SRD.CRT
       386**DCL       391--REDEF     820>>ASSIGN    870<<ASSIGN
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:311  
KV$SRD.CRT.CLM
       388**DCL       851>>IF        854<<ASSIGN    857<<ASSIGN    857>>ASSIGN    865<<ASSIGN    938<<ASSIGN
KV$SRD.CRT.LIN
       388**DCL       808>>IF        830>>IF        837>>DOWHILE   839>>IF        839>>IF        841>>IF
       850>>IF        850>>IF        859>>IF        866<<ASSIGN    866>>ASSIGN    887>>IF        887>>IF
       918>>IF        939<<ASSIGN    939>>ASSIGN
KV$SRD.CRT_PST
       391**DCL       828<<ASSIGN
KV$SRD.DVCLINBIS
       428**DCL       822>>ASSIGN    824<<ASSIGN    873<<ASSIGN
KV$SRD.FLDEND
       350**DCL       355--REDEF
KV$SRD.FLDEND.CLM
       352**DCL       825<<ASSIGN
KV$SRD.HBRDCHR
       464**DCL       901>>ASSIGN    920>>ASSIGN
KV$SRD.HBRDSIZ
       464**DCL       795>>IF        799>>ASSIGN    800>>ASSIGN
KV$SRD.HI_NONBLN
       420**DCL       425--REDEF     819>>ASSIGN    826<<ASSIGN    871<<ASSIGN
KV$SRD.LFTBRD
       465**DCL       782<<ASSIGN    795>>IF        801>>IF        845>>IF        874>>IF        914>>IF
KV$SRD.LFTMRGCLM
       320**DCL       788>>ASSIGN    882>>IF        882>>IF        884>>ASSIGN
KV$SRD.LNG
       318**DCL       806<<ASSIGN    881<<ASSIGN
KV$SRD.ORG
       242**DCL       247--REDEF
KV$SRD.ORG.CLM
       244**DCL       788>>ASSIGN    805>>ASSIGN    812>>IF        835>>ASSIGN    910>>ASSIGN
KV$SRD.ORG.LIN
       244**DCL       787>>ASSIGN    806>>ASSIGN    812>>IF
KV$SRD.ORG_PST
       247**DCL       791>>ASSIGN
KV$SRD.RHTBRD
       465**DCL       784<<ASSIGN    795>>IF        802>>IF        855>>IF        876>>IF        915>>IF
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:312  
KV$SRD.SCROLL
       319**DCL       821>>ASSIGN    823<<ASSIGN    872<<ASSIGN
KV$SRD.SRDEND
       455**DCL       460--REDEF     792>>ASSIGN    826>>ASSIGN
KV$SRD.SRDEND.CLM
       457**DCL       789>>ASSIGN    805>>ASSIGN    812>>IF        835>>ASSIGN    859>>IF        877>>ASSIGN
       878>>ASSIGN    910>>ASSIGN    918>>IF
KV$SRD.SRDEND.LIN
       457**DCL       790>>ASSIGN    806>>ASSIGN    812>>IF        837>>DOWHILE   839>>IF
KV$SRD.TOPBRD
       463**DCL       781<<ASSIGN    795>>IF        799>>IF
KV$SRD.TOPLFT
       276**DCL       281--REDEF
KV$SRD.TOPLFT.CLM
       278**DCL       788>>ASSIGN    851>>IF        865>>ASSIGN    875<<ASSIGN    875>>ASSIGN    882>>IF
       884<<ASSIGN    884>>ASSIGN    885>>ASSIGN    887>>IF        938>>ASSIGN
KV$SRD.TOPLFT.LIN
       278**DCL       787>>ASSIGN    793>>ASSIGN    879<<ASSIGN    881>>ASSIGN    887>>IF
KV$SRD.TOPLFT_PST
       281**DCL       791<<ASSIGN    828>>ASSIGN
KV$SRD.UNKRGN
       322**DCL       798<<ASSIGN
KV$SRD.VBRDCHR
       465**DCL       833>>ASSIGN    834>>ASSIGN    913>>IF        914>>ASSIGN    915>>ASSIGN    916>>ASSIGN
KV$SRD.VBRDSIZ
       465**DCL       795>>IF        835>>ASSIGN    875>>ASSIGN    877>>ASSIGN    913>>IF
KV$SRD.WDT
       318**DCL       805<<ASSIGN    885<<ASSIGN
KV$VDI.OTPCNDPND.PST
       526**DCL       852<<ASSIGN    869<<ASSIGN    948>>IF        949<<ASSIGN
KVC$FIXPST
       541**DCL-ENT   808--CALL      890--CALL
KVC$FIXWDT
       542**DCL-ENT   807--CALL      886--CALL
KVO$OTPLCL
       543**DCL-ENT   847--CALL      862--CALL      925--CALL      935--CALL
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:313  
KVV$CALUSR
       544**DCL-ENT   815--CALL
KVV$CALUSR_PST
       545**DCL-ENT   851--CALL      924--CALL      948--CALL
KV_USR_SETATR
       776**DCL       815<>CALL
KV_VDH_OTPLCL
       739**DCL       816>>ASSIGN
OLDBTM
       623**DCL       790<<ASSIGN    809>>IF        839>>IF
OLDLFT
       621**DCL       788<<ASSIGN    801<<ASSIGN    809>>IF        833>>IF        845>>IF
OLDRHT
       622**DCL       789<<ASSIGN    802<<ASSIGN    809>>IF        834>>IF        855>>IF
OLDTOP
       620**DCL       787<<ASSIGN    809>>IF        831>>IF
Y$HRZBLN IN PROCEDURE Y$HRZBRD
       903**ENTRY     831--CALL      842--CALL
Y$HRZBRD
       897**PROC      830--CALL      841--CALL
Y$PSTSKP
       947**PROC      827--CALL      848--CALL      864--CALL      937--CALL
Y@BTMLIN
       619**DCL       794<<ASSIGN    800<<ASSIGN    800>>ASSIGN    839>>IF        841>>IF        850>>IF
       880>>ASSIGN
Y@CRT
       572**DCL       820<<ASSIGN    870>>ASSIGN
Y@CRT.CLM
       576**DCL       887>>IF        887>>IF
Y@DVCLINBIS
       617**DCL       822<<ASSIGN    873>>ASSIGN
Y@NONBLN
       606**DCL       819<<ASSIGN    871>>ASSIGN
Y@NONBLN.CLM
       610**DCL       887>>IF
Y@NONBLN.LIN
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:314  
       610**DCL       887>>IF
Y@SCROLL
       616**DCL       821<<ASSIGN    872>>ASSIGN
Y@SRD$
       547**DCL       214--IMP-PTR   778<<ASSIGN    779>>ASSIGN    781>>ASSIGN    782>>ASSIGN    783>>ASSIGN
       784>>ASSIGN    787>>ASSIGN    787>>ASSIGN    788>>ASSIGN    788>>ASSIGN    788>>ASSIGN    789>>ASSIGN
       789>>ASSIGN    790>>ASSIGN    790>>ASSIGN    791>>ASSIGN    791>>ASSIGN    792>>ASSIGN    792>>ASSIGN
       793>>ASSIGN    794>>ASSIGN    795>>IF        795>>IF        795>>IF        795>>IF        795>>IF
       795>>IF        797>>ASSIGN    798>>ASSIGN    799>>IF        799>>ASSIGN    800>>IF        800>>ASSIGN
       801>>IF        802>>IF        804>>ASSIGN    805>>ASSIGN    805>>ASSIGN    805>>ASSIGN    806>>ASSIGN
       806>>ASSIGN    806>>ASSIGN    808>>IF        812>>IF        812>>IF        812>>IF        812>>IF
       819>>ASSIGN    820>>ASSIGN    821>>ASSIGN    822>>ASSIGN    823>>ASSIGN    824>>ASSIGN    825>>ASSIGN
       826>>ASSIGN    826>>ASSIGN    828>>ASSIGN    828>>ASSIGN    829>>ASSIGN    829>>ASSIGN    830>>IF
       833>>ASSIGN    834>>ASSIGN    835>>ASSIGN    835>>ASSIGN    835>>ASSIGN    837>>DOWHILE   837>>DOWHILE
       839>>IF        839>>IF        839>>IF        841>>IF        845>>IF        850>>IF        850>>IF
       851>>IF        851>>IF        854>>ASSIGN    854>>ASSIGN    855>>IF        857>>ASSIGN    857>>ASSIGN
       859>>IF        859>>IF        865>>ASSIGN    865>>ASSIGN    866>>ASSIGN    866>>ASSIGN    870>>ASSIGN
       871>>ASSIGN    872>>ASSIGN    873>>ASSIGN    874>>IF        875>>ASSIGN    875>>ASSIGN    875>>ASSIGN
       876>>IF        877>>ASSIGN    877>>ASSIGN    877>>ASSIGN    878>>ASSIGN    878>>ASSIGN    879>>ASSIGN
       880>>ASSIGN    881>>ASSIGN    881>>ASSIGN    881>>ASSIGN    882>>IF        882>>IF        882>>IF
       882>>IF        884>>ASSIGN    884>>ASSIGN    884>>ASSIGN    885>>ASSIGN    885>>ASSIGN    885>>ASSIGN
       887>>IF        887>>IF        887>>IF        887>>IF        887>>IF        887>>IF        887>>IF
       887>>IF        901>>ASSIGN    910>>ASSIGN    910>>ASSIGN    913>>IF        913>>IF        914>>IF
       914>>ASSIGN    915>>IF        915>>ASSIGN    916>>ASSIGN    918>>IF        918>>IF        920>>ASSIGN
       938>>ASSIGN    938>>ASSIGN    939>>ASSIGN    939>>ASSIGN
Y@TOPLIN
       618**DCL       793<<ASSIGN    799<<ASSIGN    799>>ASSIGN    830>>IF        850>>IF        879>>ASSIGN
Y@VDH_OTPLCL
       666**DCL       816<<ASSIGN    847<>CALL      862<>CALL      925<>CALL      935<>CALL
Y@VDH_OTPLCL.BFR_.ADR$
       699**DCL       817<<ASSIGN
Y@VDH_OTPLCL.BFR_.BYTSIZ
       699**DCL       835<<ASSIGN    845>>IF        855>>IF        857>>ASSIGN    858>>ASSIGN    861<<ASSIGN
       861>>ASSIGN    911<<ASSIGN    912<<ASSIGN    922<<ASSIGN    922>>ASSIGN    926>>DOWHILE   927>>ASSIGN
       930<<ASSIGN    933<<ASSIGN
Y@VDH_OTPLCL.BFR_.BYTX
PL6.E3A0      #003=KVC$DRWBRD File=KVC$CNC.:E05TSI                               WED 07/30/97 01:57 Page:315  
       699**DCL       838<<ASSIGN    858<<ASSIGN    929<<ASSIGN    932<<ASSIGN
Y@VDH_OTPLCL.NONVRT
       672**DCL       818<<ASSIGN
Y@WDT IN PROCEDURE Y$HRZBRD
       899**DCL       910<<ASSIGN    911>>IF        912>>ASSIGN    915>>IF        916>>ASSIGN    921<<ASSIGN
       921>>ASSIGN    926>>DOWHILE   927<<ASSIGN    927>>ASSIGN    928>>IF        932>>ASSIGN    933>>ASSIGN
