$COM*T***********************************************************************
$COM*T*                                                                     *
$COM*T*                Copyright (c) Bull HN Information Systems Inc., 1989 *
$COM*T*                                                                     *
$COM*T***********************************************************************
)TERM INPUT 4
 
 
 
;'        Function: AND        '
 
 
    " R_A AND B;I;J
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   (1 2$R le 6)$QSM 'AND'
[3]   R_A,[1]B
[4]   $GO 0
[5]  le:I_($R A)[2]$MAX($R B)[2]
[6]   R_((($TAK$R A),I)$TAKA),[1](($TAK$R B),I)$TAKB
    "
 
$COM  $QSM   2
$COM  A      0     3     5     6     6
$COM  B      0     3     5     6     6
$COM  I      0     5_    6     6
$COM  J      0
$COM  R      0_    3_    6_
$COM  le     2     5:
 
 
 
;'        Function: DISPDS     '
 
 
    " R_DISPDS N
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   $GO (((N>3075)&N<3083),(N>2047)&N<2060)/is as
[3]   R_$FMT10$DCD8 8 8 8$ECDN $DMD $GO 0
[4]  is:R_'DS',$FMTN$-3075 $DMD $GO 0
[5]  as:R_'AS',$FMTN$-2048 $DMD $GO 0
    "
 
$COM  N      0     2     2     2     2     3     4     5
$COM  R      0_    3_    4_    5_
$COM  as     2     5:
$COM  is     2     4:
 
 
 
;'        Function: DSRECORD   '
 
 
    " R_DSRECORD N;Z
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   Z_($R N)$R 1,1023$R 0
[3]   R_(1023$TAKZ/N),(~Z)/N
    "
 
$COM  N      0     2     3     3
$COM  R      0_    3_
$COM  Z      0     2_    3     3
 
 
 
;'        Function: FINDNAMES  '
 
 
    " R_A FINDNAMES B;M;I;MYNAME
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   (1 2$R le 6)$QSM MYNAME_'FINDNAMES'
[3]  go:R_A&.=$TPSB
[4]   $GO 0
[5]  le:$GO (I=M_($R A)[2]$MAXI_2$DSC$R B)/xrn
[6]   B_(($TAK$R B),M)$TAKB $DMD $GO go
[7]  xrn:A_(($TAK$R A),M)$TAKA $DMD $GO go
    "
 
$COM  $QSM      2
$COM  A         0     3     5     7_    7     7
$COM  B         0     3     5     6_    6     6
$COM  I         0     5     5_
$COM  M         0     5_    6     7
$COM  MYNAME    0     2_
$COM  R         0_    3_
$COM  go        3:    6     7
$COM  le        2     5:
$COM  xrn       5     7:
 
 
 
;'        Function: FOLD       '
 
 
    " R_N FOLD R;W;Z
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   $GO (0$NE$QNC 'N')/ok $DMD N_$QPW
[3]  ok:$GO (1$GEW_$MIN$QPW%6+Z_-1$TAK$R R)/x
[4]   R_(($TAK$R R),Z+6)$TAKR
[5]   W_($MAX($TAK$R R)%W),W#Z+6
[6]   R_W$R (#/W)$TAK,R
[7]  x:W_$QAV $DMD W[$QAV$I '$_$-$NE$"']_-4$TAK'$_$-$NE$"',(1$NE$QTT)/'_-#"'
[8]   R_W $QXL R
    "
 
$COM  $QAV   7     7
$COM  $QNC   2
$COM  $QPW   2     3
$COM  $QTT   7
$COM  $QXL   8
$COM  N      0     2_
$COM  R      0_    0     3     4_    4     4     5     6_    6     8_    8
$COM  W      0     3_    5_    5     5     6     6     7_    7]_   8
$COM  Z      0     3_    4     5
$COM  ok     2     3:
$COM  x      3     7:
 
 
 
;'        Function: GETDEBUG   '
 
 
    " R_GETDEBUG Z;I;J
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   $GO (1 2 3=I_Z[2]$-5)/set set stop
[3]  set:DEBUG_1 0 0[I] $DMD $GO 0
[4]  stop:(stop+1)$QSTOP 'GETDEBUG' $DMD 'Enter: )GO to continue' $DMD _$XEC')TERM 4'
[5]   _$XEC')TERM INPUT 1' $DMD $GO 0
    "
 
$COM  $QSTOP   4
$COM  DEBUG    3_
$COM  I        0     2_    3
$COM  J        0
$COM  R        0_
$COM  Z        0     2]
$COM  set      2     2     3:
$COM  stop     2     4:    4
 
 
 
;'        Function: GETHEAD    '
 
 
    " R_GETHEAD N
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]  nc:(1 2$R io 79)$QSM 'GETHEAD' $DMD R_''
[3]  ok:R_$QFREAD N '' 0 3 $DMD HKEY_2 9 $QCVT $QFRKEY N,2
[4]   $GO (0$NE$R R_('$"'=$TAKHKEY)/R)/0
[5]   (1 2$R nc 79)$QSM 'GETHEAD'
[6]   $GO ((3 9 $QCVT '$"')<3 9 $QCVT HKEY[1])/0
[7]   R_$QFREAD N(HKEY_,'$"')0 3 $DMD $GO 0
[8]  io:R_'' $DMD $GO 0
    "
 
$COM  $QCVT     3     6     6
$COM  $QFREAD   3     7
$COM  $QFRKEY   3
$COM  $QSM      2     5
$COM  HKEY      3_    4     6]    7_
$COM  N         0     3     3     7
$COM  R         0_    2_    3_    4_    4     7_    8_
$COM  io        2     8:
$COM  nc        2:    5
$COM  ok        3:
 
 
 
;'        Function: GETINIT    '
 
 
    " R_GETINIT;Z;SILIST;OUT;MYNAME;SEV;K;VERB;IN
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   R_1 $DMD VERB_2
[3]   $GO ((0=$R $QSP)$OR~' '$EQV$TAK0$R $QSP)/0
[4]   $GO (0$NE$TAKZ_NODES(,NodeI[2])$QPARSE $QSP)/pe
[5]   $QSP_SILIST_OUT_'' $DMD $GO (4>$EQVZ_3$DRPZ)/p $DMD Z_4$DRP$TAKZ
[6]  p:GETPARSE Z
[7]   $GO ((0=$R SILIST)&0=$R OUT)/0 $DMD SILIST_SILIST,(0=$R SILIST)/$ENC'*G'
[8]   R_0 $DMD $GO (0$E TESTID$"SILIST)/0 $DMD R_1
[9]   $GO ((1$NE$R SILIST)$OR0$NE$R OUT)/lnk
[10]  (($TAKSILIST),',IN')$QFOPEN 1 $DMD (1 2$R io 79)$QSM MYNAME_'GETINIT'
[11]  _$QFREAD 1 '$"' 0 3
[12] io:(1 2$R iok 79)$QSM MYNAME $DMD _$QFREAD 1 '' 0 3 $DMD K_$QFRKEY 1 2
[13]  $GO ('$"'$NE(2 9 $QCVT K)[1+0=$TAK0/K])/iok $DMD $QFCLOSE 1 $DMD $GO lnk
[14] iok:$QFCLOSE 1 $DMD $XEC')SET INPUT ',$TAKSILIST
[15]  $GO 0
[16] lnk:OUT_(1+0=$R OUT)$DSCOUT '*L'
[17]  $GO (SHARE&VERB=3)/esv
[18]  Z_DEBUG LINK,' ',$DSCSILIST
[19]  $GO (SEV>Severity)/es
[20]  Z WRITENODES VERB
[21]  $GO R_0
[22] es:'**** SEVERITY Exceeded! Link Aborted!' $DMD $GO R_0
[23] esv:'SHARE=YES and INTO conflict, use OVER or ON or SHARE=NO' $DMD $GO R_0
[24] pe:'Illegal LINKNODE option!' $DMD $QSP $DMD (Z[2]$R' '),'$TAK'
[25]  'Legal options at this point are:' $DMD 3$DSC Z $DMD $GO R_0
    "
 
$COM  $QCVT        13
$COM  $QFCLOSE     13    14
$COM  $QFOPEN      10
$COM  $QFREAD      11    12
$COM  $QFRKEY      12
$COM  $QPARSE       4
$COM  $QSM         10    12
$COM  $QSP          3     3     4     5_
$COM  DEBUG        18
$COM  GETPARSE      6
$COM  IN            0
$COM  K             0     7     7_   12_   13    13
$COM  LINK         18
$COM  MYNAME        0    10_   12
$COM  NODES         4
$COM  NodeI         4]
$COM  OUT           0     5_    7     9    16_   16    16
$COM  R             0_    2_    8_    8_   21_   22_   23_   24_
$COM  SEV           0    19
$COM  SHARE        17
$COM  SILIST        0     5_    7     8     9    10    14    18
$COM  Severity     19
$COM  TESTID        8
$COM  VERB          0     2_   17    20
$COM  WRITENODES   20
$COM  Z             0     4_    5_    5     5_    5     6    18_   20    24
$COM  er            7
$COM  es           19    22:
$COM  esv          17    23:
$COM  io           10    12:
$COM  iok          12    13    14:
$COM  lnk           9    13    16:
$COM  p             5     6:
$COM  pe            4    24:
 
 
 
;'        Function: GETKEY     '
 
 
    " GETKEY Z
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   Key_4$DSCZ
    "
 
$COM  Key   2_
$COM  Z     0     2
 
 
 
;'        Function: GETLINK    '
 
 
    " GETLINK Z;SILIST;OUT;STATE;SEV
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   STATE_STATUS SILIST_OUT_0/SEV_0 $DMD VERB_2
[3]   GETPARSE 4$DRPZ
[4]   $GO (0=TESTID$"SILIST)/0
[5]   $GO (SHARE&VERB=3)/er
[6]   Z_DEBUG LINK,' ',$DSCSILIST
[7]   $GO (SEV>Severity)/es
[8]   Z WRITENODES VERB
[9]  x:_STATUS STATE
[10]  $QSTEPCC SEV $DMD $GO 0
[11]  $GO 0
[12] er:'SHARE and INTO conflict -- Use OVER or ON or SHARE=NO' $DMD SEV_8
[13]  $GO x
[14] es:'*** Severity Limit Exceeded -- Link Aborted!' $DMD $GO x
    "
 
$COM  $QSTEPCC     10
$COM  DEBUG         6
$COM  GETPARSE      3
$COM  LINK          6
$COM  OUT           0     2_
$COM  SEV           0     2_    7    10    12_
$COM  SHARE         5
$COM  SILIST        0     2_    4     6
$COM  STATE         0     2_    9
$COM  STATUS        2     9
$COM  Severity      7
$COM  TESTID        4
$COM  VERB          2_    5     8
$COM  WRITENODES    8
$COM  Z             0     3     6_    8
$COM  er            5    12:
$COM  es            7    14:
$COM  x             9:   13    14
 
 
 
;'        Function: GETNODE    '
 
 
    " R_GETNODE F;Z;C
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   (1 2$R e 0)$QSM 'GETNODE'
[3]   $XEC')SET $Q2 ',F,',FUN=IN,SHARE=ALL'
[4]   C_$QBSIZE 2 $DMD $GO (0$NE$R $QSSS($QUNSET 2)',ORG=KEYED')/k
[5]   R_0$R $QBSIZE 2,1023#4
[6]   $GO (0=$R $QSSS($QUNSET 2)',ORG=RANDOM')/e
[7]  lp:$GO (0=$R IN_$Q2)/done $DMD R_R,3 36 $QCVT IN $DMD $GO lp
[8]  done:$XEC')SET $Q2 ME' $DMD $XEC')!R F$','Q2'
[9]   IN_1023$TAKR $DMD R_1023$DRPR
[10]  C_$MAX($R R)%1023
[11]  Z_(C+$R R)$R 0,1023$R 1
[12]  R_Z\R $DMD ((~Z)/R)_C$TAKIN
[13]  $GO 0
[14] k:$XEC')SET $Q2 ME' $DMD (F,',IN')$QFOPEN 2
[15]  R_3 36 $QCVT $QFREAD 2 'NODES' 0 3 $DMD $QFCLOSE 2
[16]  $GO 0
[17] e:'File: ',F,'  does not contain legal nodes' $DMD R_0/0
[18]  $QFCLOSE(2$E $QFNUMS)/2 $DMD $XEC')SET $Q2 ME'
    "
 
$COM  $QBSIZE    4     5
$COM  $QCVT      7    15
$COM  $QFCLOSE  15    18
$COM  $QFNUMS   18
$COM  $QFOPEN   14
$COM  $QFREAD   15
$COM  $QSM       2
$COM  $QSSS      4     6
$COM  $QUNSET    4     6
$COM  C          0     4_   10_   11    12
$COM  F          0     3    14    17
$COM  IN         7_    7     9_   12
$COM  R          0_    5_    7_    7     9     9_    9    10    11    12_
$COM            12    12    15_   17_
$COM  Z          0    11_   12    12
$COM  done       7     8:
$COM  e          2     6    17:
$COM  k          4    14:
$COM  lp         7:    7
 
 
 
;'        Function: GETNODEINFO'
 
 
    " GETNODEINFO F
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   R_((25$MAX$R F)$TAKF_(F$I ' ')$TAKF),' '
[3]   $GO (0=$R Z_GETNODE F)/0
[4]   R_MAPNODES 3$DRPZ
[5]   ' '
[6]   F_F,,'G< Created: 99/99/99>,G< 99:99:99>' $QFMT 1 2$R Z[1 2+Z[3]]
[7]   F,',  Segid = ',(DISPDS Z[3+Z[3]]),',  Severity = ',$FMTZ[4+Z[3]]
[8]   R
    "
 
$COM  $QFMT       6
$COM  DISPDS      7
$COM  F           0     2     2_    2     2     3     6_    6     7
$COM  GETNODE     3
$COM  MAPNODES    4
$COM  R           2_    4_    8
$COM  Z           3_    4     6]    6]    7]    7]    7]    7]
 
 
 
;'        Function: GETPARSE   '
 
 
    " GETPARSE P;Z;I;CDS
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   CDS_2+$I 18 $DMD $GO (0$NE$R P)/go
[3]  lp:$GO (0=$R P_1$DRPP)/0
[4]  go:$GO (CDS=I_2$DSCZ_$TAKP)/a m er d d d sv k w sh sh sg si er ou v v v
[5]  er:'System Error! This should not happen!' $DMD $GO 0
[6]  d:GETDEBUG Z $DMD $GO lp
[7]  sg:GETSEG Z $DMD $GO lp
[8]  sh:GETSHARE Z $DMD $GO lp
[9]  sv:GETSEV Z $DMD $GO lp
[10] k:GETKEY Z $DMD $GO lp
[11] w:GETWSID Z $DMD $GO lp
[12] si:SILIST_SILIST,Z[4] $DMD $GO lp
[13] ou:OUT_,4$DSCZ $DMD $GO lp
[14] v:VERB_I$-17 $DMD $GO lp
[15] a:SHARE_0 $DMD ISSID_2048 $DMD $GO lp
[16] m:SHARE_1 $DMD ISSID_3081 $DMD $GO lp
    "
 
$COM  CDS        0     2_    4
$COM  GETDEBUG   6
$COM  GETKEY    10
$COM  GETSEG     7
$COM  GETSEV     9
$COM  GETSHARE   8
$COM  GETWSID   11
$COM  I          0     4_   14
$COM  ISSID     15_   16_
$COM  OUT       13_
$COM  P          0     2     3_    3     4
$COM  SHARE     15_   16_
$COM  SILIST    12_   12
$COM  VERB      14_
$COM  Z          0     4_    6     7     8     9    10    11    12]   13
$COM  a          4    15:
$COM  d          4     4     4     6:
$COM  er         4     4     5:
$COM  go         2     4:
$COM  k          4    10:
$COM  lp         3:    6     7     8     9    10    11    12    13    14
$COM            15    16
$COM  m          4    16:
$COM  ou         4    13:
$COM  sg         4     7:
$COM  sh         4     4     8:
$COM  si         4    12:
$COM  sv         4     9:
$COM  v          4     4     4    14:
$COM  w          4    11:
 
 
 
;'        Function: GETSEG     '
 
 
    " GETSEG Z;I;J;D
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   D_ISSID $DMD J_4$DSCZ
[3]   $GO ((0>D),(7777<D_$QFI J),(1=$QVI J),3$NE$R J)/bad bad dec bad
[4]   $GO (I_(12 3$R 'DS1DS2DS3DS4DS5DS6DS7DS8AS0AS1AS2AS3')&.=J)/sds
[5]  bad:'Illegal SEGID option! Legal options are: DS1 through DS8 and AS0'
[6]   $GO 0
[7]  sds:ISSID_$TAKI/((3075+$I 8),2047+$I 4) $DMD $GO 0
[8]  dec:ISSID_((D<9)#3075)+8$DCD10 10 10 10$ECDD $DMD $GO 0
[9]  dsp:'Segid = ',DISPDS D
    "
 
$COM  $QFI      3
$COM  $QVI      3
$COM  D         0     2_    3     3_    8     8     9
$COM  DISPDS    9
$COM  I         0     4_    7
$COM  ISSID     2     7_    8_
$COM  J         0     2_    3     3     3     4
$COM  Z         0     2
$COM  bad       3     3     3     5:
$COM  dec       3     8:
$COM  dsp       9:
$COM  sds       4     7:
 
 
 
;'        Function: GETSEV     '
 
 
    " GETSEV Z
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   Severity_$QFI 4$DSCZ
    "
 
$COM  $QFI        2
$COM  Severity    2_
$COM  Z           0     2
 
 
 
;'        Function: GETSHARE   '
 
 
    " GETSHARE Z;I;J
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   SHARE_(12 13=2$DSCZ)/1 0 $DMD $GO 0
    "
 
$COM  I       0
$COM  J       0
$COM  SHARE   2_
$COM  Z       0     2
 
 
 
;'        Function: GETSTATUS  '
 
 
    " GETSTATUS N
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   (0$NEDEBUG)/'Debug = Yes'
[3]   'Segid = ',DISPDS ISSID
[4]   (0$NE$R Key)/'Key = ''',Key,''''
[5]   (0$NE$R XWSID)/'WSID  = ',XWSID
[6]   'Severity = ',$FMTSeverity
[7]   'Share = ',(1+SHARE)$DSC'No' 'Yes'
    "
 
$COM  DEBUG      2
$COM  DISPDS     3
$COM  ISSID      3
$COM  Key        4     4
$COM  N          0
$COM  SHARE      7
$COM  Severity   6
$COM  XWSID      5     5
 
 
 
;'        Function: GETWSID    '
 
 
    " GETWSID Z
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   $GO (0=$R XWSID_4$DSCZ)/0
[3]   _TESTID XWSID
    "
 
$COM  TESTID   3
$COM  XWSID    2_    3
$COM  Z        0     2
 
 
 
;'        Function: GETXIT     '
 
 
    " R_GETXIT Z
[.001] $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[1]   _$XEC')TERM ',$FMT$QTT $DMD R_1
[2]   $GO ((0=$TAKXWSID),0=$R XWSID)/end clear
[3]   (e,[1.5]43 44)$QSM 'GETXIT'
[4]   $XEC')LOAD ',XWSID
[5]  e:'''',XWSID,''' is not a legal workspace!'
[6]  clear:$XEC')CLEAR'
[7]  end: $COM     $GO ('BJFAPL  '$EQV $QUA)/R_0
[8]   $XEC')END'
    "
 
$COM  $QSM     3
$COM  $QTT     1
$COM  R        0_    1_
$COM  XWSID    2     2     4     5
$COM  Z        0
$COM  clear    2     6:
$COM  e        3     5:
$COM  end      2     7:
 
 
 
;'        Function: GO         '
 
 
    " GO;VERB;Z;C;ISSID;DEBUG;SHARE;TERM;I;NodeI;Key;XWSID;SINAMES;Severity
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   TERM_$QTT $DMD _$XEC')TERM INPU 1' $DMD _$XEC')TERM OUTP 1' $DMD _$XEC')CONT OFF'
[3]   (brk io,[1.5]100 30)$QSM 'GO' $DMD _$XEC')CONT OFF' $DMD DEBUG_0
[4]   Key_XWSID_0/Severity_0 $DMD I_MAPNODE NODES $DMD ISSID_3081 $DMD SHARE_1
[5]   NodeI_I['COMMAND' 'CMDLINE'$I I[;2];1]
[6]   $QWSID $QGETINIT Z_1 0 1 1 1 1 1 1 $DMD $XEC')SET INPUT CR'
[7]   $GO (0=GETINIT)/x
[8]  com:$GO (0$NE$TAKZ_NODES(,NodeI[1])$QGETCMD(-1 -1 1 1 0 1)':')/er
[9]   $GO (($I 16)=I_2$DSCZ_4$DSCZ)/link l a m x db db db sv key ws sh sh sg er st
[10] er:'System Error! Should Not happen!' $DMD $GO 0
[11] link:GETLINK Z $DMD $GO com
[12] l:LISTNODE Z $DMD $GO com
[13] db:GETDEBUG Z $DMD $GO com
[14] sg:GETSEG Z $DMD $GO com
[15] sh:GETSHARE Z $DMD $GO com
[16] x:$GO com#GETXIT Z
[17] sv:GETSEV Z $DMD $GO com
[18] key:GETKEY Z $DMD $GO com
[19] ws:GETWSID Z $DMD $GO com
[20] st:GETSTATUS Z $DMD $GO com
[21] a:SHARE_0 $DMD ISSID_2048 $DMD $GO com
[22] m:SHARE_1 $DMD ISSID_3081 $DMD $GO com
[23] brk:' ' $DMD 'Break @ ',$QERF,DEBUG/'[',($FMT-1$TAK$QERN),']'
[24]  _$XEC')TERM INPUT 1' $DMD _$XEC')TERM OUTP 1' $DMD $GO com
[25] io:C_$QERX $DMD $GO ($QERN[2]$NEcom)/iox
[26]  $XEC(1+6=$QFI C[5+$I 5])$DSC')?' '''End of Input File: '',(-1+I$I'','')$TAKI_$QUNSET''I'''
[27]  $XEC')SET INPUT CR'
[28]  $GO (('FSD'&.=3$TAKC)$OR0 1=$QONL)/x com
[29] iox:$XEC')?' $DMD $GO (0 1=$QONL)/x com
    "
 
$COM  $QERF       23
$COM  $QERN       23    25]
$COM  $QERX       25
$COM  $QFI        26
$COM  $QGETCMD     8
$COM  $QGETINIT    6
$COM  $QONL       28    29
$COM  $QSM         3
$COM  $QTT         2
$COM  $QWSID       6
$COM  C            0    25_   26]   28
$COM  DEBUG        0     3_   23
$COM  GETDEBUG    13
$COM  GETINIT      7
$COM  GETKEY      18
$COM  GETLINK     11
$COM  GETSEG      14
$COM  GETSEV      17
$COM  GETSHARE    15
$COM  GETSTATUS   20
$COM  GETWSID     19
$COM  GETXIT      16
$COM  I            0     4_    5]    5]    9_
$COM  ISSID        0     4_   21_   22_
$COM  Key          0     4_
$COM  LISTNODE    12
$COM  MAPNODE      4
$COM  NODES        4     8
$COM  NodeI        0     5_    8]
$COM  SHARE        0     4_   21_   22_
$COM  SINAMES      0
$COM  Severity     0     4_
$COM  TERM         0     2_
$COM  VERB         0
$COM  XWSID        0     4_
$COM  Z            0     6_    8_    9_    9    11    12    13    14    15
$COM              16    17    18    19    20
$COM  a            9    21:
$COM  brk          3    23:
$COM  com          8:   11    12    13    14    15    16    17    18    19
$COM              20    21    22    24    25    28    29
$COM  db           9     9     9    13:
$COM  er           8     9    10:
$COM  io           3    25:
$COM  iox         25    29:
$COM  key          9    18:
$COM  l            9    12:
$COM  link         9    11:
$COM  m            9    22:
$COM  sg           9    14:
$COM  sh           9     9    15:
$COM  st           9    20:
$COM  sv           9    17:
$COM  ws           9    19:
$COM  x            7     9    16:   28    29
 
 
 
;'        Function: LINK       '
 
 
    " PROG_Debug LINK FID;DEBUG;DNAMES;RNAMES;SNAMES;DREFS;DDEFS;SECTS;SECTKNT;REL;NL;F;OP;O;J
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   $GO (0=DEBUG_$QNC 'Debug')/db $DMD DEBUG_1$EQV$TAKDebug
[3]  db:RNAMES_' ',[1]DNAMES_SNAMES_0 1$R ' '
[4]   DREFS_1,[1]DDEFS_SECTS_0 3$R SECTKNT_SEV_0
[5]   PROG_2 9 $QCVT 0+0 0 0 0 $DMD REL_0 5$R 0
[6]  $COM
[7]  $COM    DNAMES, RNAMES, SNAMES .... are character matrices containing
[8]  $COM                                Symdefs, Symrefs and Section names.
[9]  $COM
[10] $COM    DDEFS  ....     is an integer matrix containing the section number,
[11] $COM                    offset and index in DNAMES of a symdef.
[12] $COM
[13] $COM    DREFS  ....     is an integer matrix containing a found flag,
[14] $COM                    the definition offset, and the index in Rnames
[15] $COM                    of a Symref.
[16] $COM
[17] $COM    SECTS  ....     is an integer matrix containing the section size,
[18] $COM                    name index and offset in PROG.
[19] $COM
[20] $COM    PROG   ....     the load image.
[21] $COM
[22] $COM    REL    ....     relocation directives containing the relocation:
[23] $COM                    type, field, op, operand, and displacement in PROG.
[24] $COM
[25]  J_$QTLEX FID ' ,'
[26] lp:SETUPOU$TAKJ
[27]  $GO (0$NE$R J_1$DRPJ)/lp
[28]  $GO (0=$R J_(NL_(REL[;1]=3)&0=REL[;2])/$I $TAK$R REL)/nsr
[29]  '******************************************'
[30]  '****      Unresolved references:      ****'
[31]  '******************************************'
[32]  ' ' $DMD SEV_SEV$MAX11
[33]  ' ',' ',' ',' ',' ',(~($I $TAK$R RNAMES)$E 1+REL[J;3])$RD1RNAMES
[34] nsr:$GO (0=$TAK$R REL_(~NL)$RD1REL)/x
[35]  ' '
[36]  '***********************************************************************'
[37]  '***  Unable to apply the following types of relocation directives   ***'
[38]  '***********************************************************************'
[39]  ' '
[40]  J_(~&/J=1$RV1J)$RD1J_REL[$GUREL[;1 2];1 2]
[41]  F_6 9$R 'LeftHalf RightHalfSegID    Yfield   word     *unknown*'
[42]  O_8 9$R 'Reloc2   Section  Entref   Symref   Constant Segdef   Segref   *unknown*'
[43]  O[1+7$MAXJ[;1];],' ','a','n','d',' ',F[1+5$MAXJ[;2];]
[44]  ' '
[45] x:' ' $DMD MAP
[46]  PROG[12+$I 4]_2 9 $QCVT($R PROG)%4
[47]  J_(DNAMES$NE' ')$MAX.#$I -1$TAK$R DNAMES
[48]  F_0 2$DRP2 9 $QCVT DDEFS[;,2]+SECTS[1+DDEFS[;1];,3]
[49]  PROG_PROG,2$DRP2 9 $QCVT$TAK$R DNAMES
[50]  PROG_PROG,(,(J+3)$SC.$GE$I 3+$MAX/0,J)/,F,$QAV[J+1],DNAMES
[51]  PROG_3$DRP3 36 $QCVT(4#$MAX($R PROG)%4)$TAKPROG
    "
 
$COM  $QAV      50]
$COM  $QCVT      5    46    48    49    51
$COM  $QNC       2
$COM  $QTLEX    25
$COM  DDEFS      0     4_   48]   48]
$COM  DEBUG      0     2_    2_
$COM  DNAMES     0     3_   47    47    49    50
$COM  DREFS      0     4_
$COM  Debug      0     2
$COM  F          0    41_   43]   48_   50
$COM  FID        0    25
$COM  J          0    25_   26    27_   27    28_   33    40_   40    40
$COM            40_   43]   43]   47_   50    50    50
$COM  MAP       45
$COM  NL         0    28_   34
$COM  O          0    42_   43]
$COM  OP         0
$COM  PROG       0_    5_   46]_  46    49_   49    50_   50    51_   51
$COM            51
$COM  REL        0     5_   28]   28]   28    33]   34_   34    40]   40]
$COM  RNAMES     0     3_   33    33
$COM  SECTKNT    0     4_
$COM  SECTS      0     4_   48]
$COM  SETUPOU   26
$COM  SEV        4_   32_   32
$COM  SNAMES     0     3_
$COM  db         2     3:
$COM  lp        26:   27
$COM  nsr       28    34:
$COM  x         34    45:
 
 
 
;'        Function: LISTFIDS   '
 
 
    " R_LISTFIDS IN;Z;I
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   $GO (~1$E Z_'?'$E $"R_IN)/ce $DMD I_Z/IN
[3]   R_((~Z)/IN),$ENC[2]$DSC(,[1])/($ENC'Pn')$QFLIB$"I,$"(~'.'$E $"I)\'.'
[4]  ce:$GO (0$E TESTID$"R)/er
[5]   $GO 0
[6]  er:R_0$R $ENC''
    "
 
$COM  $QFLIB    3
$COM  I         0     2_    3     3
$COM  IN        0     2     2     3
$COM  R         0_    2_    3_    4     6_
$COM  TESTID    4
$COM  Z         0     2_    2     3
$COM  ce        2     4:
$COM  er        4     6:
 
 
 
;'        Function: LISTNODE   '
 
 
    " LISTNODE Z;R
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   $GO (0=$R Z_LISTFIDS((4+$I ($R Z)$-4),$"4)$DSC$"$ENCZ)/0
[3]   GETNODEINFO$"Z
    "
 
$COM  GETNODEINFO   3
$COM  LISTFIDS      2
$COM  R             0
$COM  Z             0     2_    2     2     3
 
 
 
;'        Function: MAKEMAT    '
 
 
    " R_A MAKEMAT B
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   R_((($R B)%A),A)$R B
    "
 
$COM  A   0     2     2
$COM  B   0     2     2
$COM  R   0_    2_
 
 
 
;'        Function: MAP        '
 
 
    " R_MAP;W;Z
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   R_DNAMES,' ',$FMTDDEFS[;,2]+SECTS[1+DDEFS[;1];,3]
[3]   R_FOLD R[$GUR;]
    "
 
$COM  DDEFS    2]    2]
$COM  DNAMES   2
$COM  FOLD     3
$COM  R        0_    2_    3_    3]    3
$COM  SECTS    2]
$COM  W        0
$COM  Z        0
 
 
 
;'        Function: MAPNODE    '
 
 
    " R_MAPNODE N;E;I;J;M;T
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   N_2 9 $QCVT(N[1]$-3)$DRPN
[3]   E_R_0/I_J_0
[4]   $GO (0=M_3 18 $QCVT N[1 2])/e $DMD N_2$DRPN
[5]  lp:R_R,3 18 $QCVT N[$I 2]
[6]   E_E,$ENCN[3+$I T_3 9 $QCVT N[3]]
[7]   $GO ((0$NE$R N_(3+T)$DRPN)&M>J_J+1)/lp
[8]  e:R_R,[1.5]E
    "
 
$COM  $QCVT   2     4     5     6
$COM  E       0     3_    6_    6     8
$COM  I       0     3_
$COM  J       0     3_    7_    7
$COM  M       0     4_    7
$COM  N       0     2_    2]    2     4]    4_    4     5]    6]    6]    7_
$COM          7
$COM  R       0_    3_    5_    5     8_    8
$COM  T       0     6_    7
$COM  e       4     8:
$COM  lp      5:    7
 
 
 
;'        Function: MAPNODES   '
 
 
    " R_MAPNODES T;I;J;LOC;N
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   (R LOC)_NODEINFO T
[3]   R_R[I_$GUR;] $DMD LOC_LOC[I]
[4]   R_FOLD R,' ',$FMT(($R LOC),1)$R LOC
    "
 
$COM  FOLD       4
$COM  I          0     3_    3
$COM  J          0
$COM  LOC        0     2     3_    3]    4     4
$COM  N          0
$COM  NODEINFO   2
$COM  R          0_    2     3_    3]    3     4_    4
$COM  T          0     2
 
 
 
;'        Function: NODEINFO   '
 
 
    " R_NODEINFO N;I;J;LOC;T
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   N_2 9 $QCVT(-3+N[1])$DRPN
[3]   R_0 5$R ' ' $DMD LOC_0/J_0 $DMD $GO (0=T_3 18 $QCVT N[1 2])/e
[4]   N_2$DRPN
[5]  lp:LOC_LOC,3 18 $QCVT N[1 2]
[6]   R_R AND(1,I)$R N[3+$I I_3 9 $QCVT N[3]]
[7]   $GO ((0$NE$R N_(3+I)$DRPN)&T>J_J+1)/lp
[8]  e:R_R LOC
    "
 
$COM  $QCVT   2     3     5     6
$COM  AND     6
$COM  I       0     6     6_    7
$COM  J       0     3_    7_    7
$COM  LOC     0     3_    5_    5     8
$COM  N       0     2_    2]    2     3]    4_    4     5]    6]    6]    7_
$COM          7
$COM  R       0_    3_    6_    6     8_    8
$COM  T       0     3_    7
$COM  e       3     8:
$COM  lp      5:    7
 
 
 
;'        Function: OPENFID    '
 
 
    " {R}_F OPENFID N
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   (io,[1.5]71 73 75 76 77 78)$QSM 'OPENFID'
[3]   $QFCLOSE(N$E $QFNUMS)/N
[4]   (F,',IN')$QFOPEN N
[5]   $GO 0,R_''
[6]  io:R_$XEC')?'
    "
 
$COM  $QFCLOSE   3
$COM  $QFNUMS    3
$COM  $QFOPEN    4
$COM  $QSM       2
$COM  F          0     4
$COM  N          0     3     3     4
$COM  R          0     5_    6_
$COM  io         2     6:
 
 
 
;'        Function: OUDEFN     '
 
 
    " OUDEFN N;M;Z;I;J;K;NEWDEFS
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   M_$TAK$R Z_8 MAKEMAT OUREAD N,6 $DMD DEFBASE_$TAK$R DNAMES
[3]  $COM      sect#, offset, name#
[4]   J_(SECTBASE+3 9 $QCVT Z[;2]),(3 18 $QCVT Z[;3 4]),DEFBASE+$I M
[5]   DDEFS_DDEFS,[1]J
[6]  $COM    names
[7]   DNAMES_DNAMES AND NEWDEFS_(3 18 $QCVT,Z[;4+$I 2])OUNAME N,1
[8]   $GO (0=DEBUG)/nodebug
[9]   '  * Definitions'
[10]  '  .. Def .. Section ... Offset ... Name ...................'
[11]  (8 0 11 0 11 0$FMTJ[;3 1 2]),' ',' ',' ',' ',' ',NEWDEFS
[12]  ' '
[13] nodebug:
[14]  $GO (0$E $R RNAMES)/add
[15]  K_($I $TAK$R RNAMES)$MAX.#RNAMES FINDNAMES NEWDEFS
[16]  $GO (0=$R J_DEFBASE+(K$NE0)/$I $R K)/add $DMD I_(K$NE0)/K
[17]  DREFS[I;$I 2]_1,DDEFS[J;,2]+SECTS[,1+DDEFS[J;1];,3]
[18] add:$GO (0=$R J_(K=0)/$I $R K)/0
[19]  I_1,(DDEFS[J;,2]+SECTS[,1+DDEFS[J;1];,3]),($TAK$R RNAMES)+$I $R J
[20]  DREFS_DREFS,[1]I
[21]  RNAMES_RNAMES AND NEWDEFS[J;]
    "
 
$COM  $QCVT        4     4     7
$COM  AND          7    21
$COM  DDEFS        5_    5    17]   17]   19]   19]
$COM  DEBUG        8
$COM  DEFBASE      2_    4    16
$COM  DNAMES       2     7_    7
$COM  DREFS       17]_  20_   20
$COM  FINDNAMES   15
$COM  I            0    16_   17    19_   20
$COM  J            0     4_    5    11]   16_   17    17    18_   19    19
$COM              19    21
$COM  K            0    15_   16    16    16    16    18    18
$COM  M            0     2_    4
$COM  MAKEMAT      2
$COM  N            0     2     7
$COM  NEWDEFS      0     7_   11    15    21]
$COM  OUNAME       7
$COM  OUREAD       2
$COM  RNAMES      14    15    15    19    21_   21
$COM  SECTBASE     4
$COM  SECTS       17]   19]
$COM  Z            0     2_    4]    4]    7]
$COM  add         14    16    18:
$COM  nodebug      8    13:
 
 
 
;'        Function: OUNAME     '
 
 
    " R_I OUNAME N;K;L;M;Z;$QIO
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   $QIO_1
[3]   Z_OUREAD N
[4]   M_$MAX/0,L_3 9 $QCVT Z[(-2+4#$I ($R Z)%4)[1+I]]
[5]   K_2+I#4
[6]   Z_(($I $R Z)$E (,L$SC.$GE$I M)/,K$SC.+$I M)/Z
[7]   R_(($R I),M)$R (,L$SC.$GE$I M)\Z
    "
 
$COM  $QCVT     4
$COM  $QIO      0     2_
$COM  I         0     4     5     7
$COM  K         0     5_    6
$COM  L         0     4_    6     7
$COM  M         0     4_    6     6     7     7
$COM  N         0     3
$COM  OUREAD    3
$COM  R         0_    7_
$COM  Z         0     3_    4]    4     6_    6     6     7
 
 
 
;'        Function: OUPROG     '
 
 
    " OUPROG N;BASE;J;K;KEY;R;S;TYPE;Z;PROGBASE
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   (1 2$R nk 79)$QSM 'OUPROG'
[3]   Z_'' $DMD Z_$QFREAD N,($ENCXX,TYPE_$QAV[10+$QIO]),0 3
[4]  nk:(1 2$R 0 79)$QSM 'OUPROG' $DMD BASE_$R PROG
[5]  lp:Z_$QFREAD N,'' 0 3 $DMD KEY_$QFRKEY N,2
[6]   $GO ((KEY[6]$NETYPE)$ORXX$OR.$NE5$TAKKEY)/0
[7]   $GO (0$NE3 9 $QCVT KEY[11])/reloc
[8]   PROG_PROG,((PROGBASE_BASE+4#3 18 $QCVT KEY[8+$I 2])$-$R PROG)$R $TAK$QAV
[9]   PROG_PROG,Z
[10]  $GO lp
[11] reloc:Z_36 MAKEMAT 1 1 $QCVT Z
[12]  J_(3 4 $QCVT Z[;$I 8]),Z[;5],(3 9 $QCVT Z[;9+$I 9]),3 18 $QCVT Z[;18+$I 18]
[13]  $GO (0$E K_J[;1])/norel
[14]  S_(K=1)/$I $R K
[15]  J[S;4]_J[S;4]+SECTBASE
[16]  S_(K=3)/$I $R K
[17]  J[S;4]_REFMAP[1+J[S;4]]
[18]  J[;5]_J[;5]+PROGBASE%4
[19]  REL_REL,[1]J
[20]  $GO lp
[21] norel:'******* Cannot handle a relocation directive ********' $QERS 999
    "
(1 2$R -1 900)$QSM 'OUPROG     '
 
$COM  $QAV        3]    8
$COM  $QCVT       7     8    11    12    12    12
$COM  $QERS      21
$COM  $QFREAD     3     5
$COM  $QFRKEY     5
$COM  $QIO        3
$COM  $QSM        2     4
$COM  BASE        0     4_    8
$COM  J           0    12_   13]   15]_  15]   17]_  17]   18]_  18]   19
$COM  K           0    13_   14    14    16    16
$COM  KEY         0     5_    6]    6     7]    8]
$COM  MAKEMAT    11
$COM  N           0     3     5     5
$COM  PROG        4     8_    8     8     9_    9
$COM  PROGBASE    0     8_   18
$COM  R           0
$COM  REFMAP     17]
$COM  REL        19_   19
$COM  S           0    14_   15    15    16_   17    17
$COM  SECTBASE   15
$COM  TYPE        0     3_    6
$COM  XX          3     6
$COM  Z           0     3_    3_    5_    9    11_   11    12]   12]   12]
$COM             12]
$COM  lp          5:   10    20
$COM  nk          2     4:
$COM  norel      13    21:
$COM  reloc       7    11:
 
 
 
;'        Function: OUREAD     '
 
 
    " R_OUREAD N;KEY;TYPE;Z
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   (1 2$R nk 79)$QSM 'OUREAD'
[3]   R_'' $DMD R_$QFREAD N[1],($ENCXX,TYPE_$QAV[N[2]+$QIO]),0 3
[4]  nk:(1 2$R 0 79)$QSM 'OUREAD'
[5]  lp:Z_$QFREAD N[1],'' 0 3 $DMD KEY_6$TAK$QFRKEY N[1],2
[6]   $GO ((KEY[6]$NETYPE)$ORXX$OR.$NE5$TAKKEY)/0
[7]   R_R,Z
[8]   $GO lp
    "
 
$COM  $QAV      3]
$COM  $QFREAD   3     5
$COM  $QFRKEY   5
$COM  $QIO      3
$COM  $QSM      2     4
$COM  KEY       0     5_    6]    6
$COM  N         0     3]    3]    5]    5]
$COM  R         0_    3_    3_    7_    7
$COM  TYPE      0     3_    6
$COM  XX        3     6
$COM  Z         0     5_    7
$COM  lp        5:    8
$COM  nk        2     4:
 
 
 
;'        Function: OUREF      '
 
 
    " OUREF N;Z;M;I;NEWREFS;J;NR;NEW
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   M_$TAK$R Z_4 MAKEMAT OUREAD N,7 $DMD NR_$TAK$R RNAMES
[3]   NEWREFS_(3 18 $QCVT,Z[;$I 2])OUNAME N,2
[4]   NEW_0=I_($I NR)$MAX.#RNAMES FINDNAMES NEWREFS
[5]   REFMAP_-1+I+NEW#NR++\NEW
[6]  $COM     found, offset, name#
[7]   J_0,0,[1.5]NR+$I +/NEW
[8]   DREFS_DREFS,[1]J
[9]  $COM
[10]  RNAMES_RNAMES AND NEW$RD1NEWREFS
[11]  $GO ((0$E $R REFMAP)$OR0=DEBUG)/0
[12]  '  * REFs'
[13]  '  .. Ref .. Ok ... Offset ... Name .....................'
[14]  (8 0 6 0 11 0$FMTDREFS[1+REFMAP;3 1 2]),' ',' ',' ',' ',' ',RNAMES[DREFS[1+REFMAP;3];]
[15]  ' '
    "
 
$COM  $QCVT        3
$COM  AND         10
$COM  DEBUG       11
$COM  DREFS        8_    8    14]   14]
$COM  FINDNAMES    4
$COM  I            0     4_    5
$COM  J            0     7_    8
$COM  M            0     2_
$COM  MAKEMAT      2
$COM  N            0     2     3
$COM  NEW          0     4_    5     5     7    10
$COM  NEWREFS      0     3_    4    10
$COM  NR           0     2_    4     5     7
$COM  OUNAME       3
$COM  OUREAD       2
$COM  REFMAP       5_   11    14    14
$COM  RNAMES       2     4    10_   10    14]
$COM  Z            0     2_    3]
 
 
 
;'        Function: OUSECTION  '
 
 
    " OUSECTION N;I;J;Z
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   I_$TAK$R Z_8 MAKEMAT OUREAD N,3
[3]   J_(3 18 $QCVT Z[;2+$I 2]),(SECTKNT+$I I)
[4]   J_J,(0,-1$DRP+\J[;1])+($R PROG)%4
[5]   SECTS_SECTS,[1]J
[6]   SNAMES_SNAMES AND(3 18 $QCVT,Z[;4+$I 2])OUNAME N,1
[7]   SECTBASE_SECTKNT $DMD SECTKNT_SECTKNT+I
[8]   $GO (0=DEBUG)/0
[9]   '* OUSECTION'
[10]  '.. Num ... Size .. Base .. Name ..............'
[11]  (6 0 9 0 8 0$FMT(1$-($I I)$-SECTKNT),J[;1 3]),' ',' ',' ',' ',SNAMES[J[;2];]
[12]  ' '
    "
 
$COM  $QCVT       3     6
$COM  AND         6
$COM  DEBUG       8
$COM  I           0     2_    3     7    11
$COM  J           0     3_    4_    4     4]    5    11]   11]
$COM  MAKEMAT     2
$COM  N           0     2     6
$COM  OUNAME      6
$COM  OUREAD      2
$COM  PROG        4
$COM  SECTBASE    7_
$COM  SECTKNT     3     7     7_    7    11
$COM  SECTS       5_    5
$COM  SNAMES      6_    6    11]
$COM  Z           0     2_    3]    6]
 
 
 
;'        Function: OUSEG      '
 
 
    " OUSEG N;Z;J;M
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   M_$TAK$R Z_4 MAKEMAT OUREAD N,9
[3]   J_(3 18 $QCVT,Z[;$I 2])OUNAME N,2
[4]   $GO ('ISSID'$EQV,J)/0
[5]   'Reference to non$-instruction segment!'
[6]   SEV_SEV$MAX11
    "
 
$COM  $QCVT      3
$COM  J          0     3_    4
$COM  M          0     2_
$COM  MAKEMAT    2
$COM  N          0     2     3
$COM  OUNAME     3
$COM  OUREAD     2
$COM  SEV        6_    6
$COM  Z          0     2_    3]
 
 
 
;'        Function: PROGRELSECT'
 
 
    " PROGRELSECT;Z;J;T;NREL;I;LOOSE;NL
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   Z_PROG
[3]  $COM  First relocate by section with half words
[4]   J_(LOOSE_(REL[;1]=1)&2>REL[;2])/NREL_$I $TAK$R REL
[5]   I_((2#REL[J;2])+4#REL[J;5])$SC.+$I 2
[6]   Z[I]_0 2$DRP2 9 $QCVT(SECTS[1+REL[J;4];,3]#1 -1[1+REL[J;,3]])+3 18 $QCVT Z[I]
[7]  $COM  Now relocate by section with full words
[8]  $COM  J_(NL_(REL[;1]=1)&4=REL[;2])/NREL $DMD LOOSE_LOOSE$ORNL
[9]  $COM  I_(4#REL[J;5])$SC.+$I    4
[10] $COM Z[I]_2 9 $QCVT(SECTS[REL[J;4];,3]#1 -1[1+REL[J;,3]])+3 36 $QCVT Z[I]
[11] $COM  Now for every section being relocated by segref and field RightHalf
[12]  J_(NL_(REL[;1]=6)&1=REL[;2])/NREL $DMD LOOSE_LOOSE$ORNL
[13]  I_(2+4#REL[J;5])$SC.+$I 2                    $COM ISSID ==>  DS?SID
[14]  Z[I]_0 2$DRP2 9 $QCVT ISSID+3 18 $QCVT Z[I]
[15] $COM Z[I]_2 9 $QCVT(0 -12$DRPT),0 24$DRP1 1 $QCVT ISSID+3 12 $QCVT 0 6$DRPT_1 1 $QCVT Z[I]
[16] $COM  Now for the resolved refs
[17]  $GO (0=$R J_(NL_(3=REL[;1])&(0=REL[;2])&0$NEDREFS[1+REL[;4];1])/NREL)/nr
[18]  I_((2#REL[J;2])+4#REL[J;5])$SC.+$I 2 $DMD LOOSE_LOOSE$ORNL
[19]  Z[I]_0 2$DRP2 9 $QCVT(DREFS[1+REL[J;4];,2]#1 -1[1+REL[J;,3]])+3 18 $QCVT Z[I]
[20] nr:REL_(~LOOSE)$RD1REL
[21]  PROG_Z
    "
 
$COM  $QCVT    6     6    14    14    19    19
$COM  DREFS   17]   19]
$COM  I        0     5_    6     6    13_   14    14    18_   19    19
$COM  ISSID   14
$COM  J        0     4_    5     5     6     6    12_   13    17_   18    18
$COM          19    19
$COM  LOOSE    0     4_   12_   12    18_   18    20
$COM  NL       0    12_   12    17_   18
$COM  NREL     0     4_   12    17
$COM  PROG     2    21_
$COM  REL      4]    4]    4     5]    5]    6]    6]   12]   12]   13]   17]
$COM          17]   17]   18]   18]   19]   19]   20_   20
$COM  SECTS    6]
$COM  T        0
$COM  Z        0     2_    6]_   6]   14]_  14]   19]_  19]   21
$COM  nr      17    20:
 
 
 
;'        Function: SETUPOU    '
 
 
    " SETUPOU F;N;HEAD;UTS;XX;DEFBASE;REFMAP;HKEY;NEWDEFS;NEWREFS;PROGBASE;REFBASE;SECTBASE;Sev
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]  $COM   Input:   File Identifier
[3]  $COM
[4]  $COM   Output:  HEAD  ...   Text of head record
[5]  $COM            XX    ...   O'777',UTS
[6]  $COM            DNAMES...   Symdef names
[7]  $COM            RNAMES...   Symref names
[8]  $COM            SNAMES...   Section names
[9]  $COM            DDEFS ...   Section_num,Offset,Name_num
[10] $COM            SECTS ...   Size,Name_num
[11] $COM            PROG  ...   Program memory image
[12] $COM            REL   ...   Relocation directives: optyp,field,op,oprnd,dsp
[13] $COM
[14]  $GO (0=$R XX_F OPENFID N_1)/gh $DMD XX $DMD $GO 0
[15] gh:DEBUG/'File: ',F $DMD DEBUG/' '
[16]  $GO (0$NE$R HEAD_GETHEAD N)/next
[17]  ('''',($QFID 1),''' is not an object unit!') $DMD $GO 0
[18] next:XX_(-1$TAK$QAV),UTS_4$TAKHEAD
[19]  $GO (36 9&.=3 9 $QCVT HEAD[5 6])/tok
[20]  $GO (36=3 9 $QCVT HEAD[5])/np
[21]  '''',($QFID N),''' is not a host object unit!' $DMD $GO 0
[22] tok:$GO (0=Sev_3 18 $QCVT HEAD[12 13])/sok
[23]  '''',($QFID N),''' has severity: ',$FMTSev $DMD SEV_SEV$MAXSev
[24] sok:OUSECTION N
[25]  OUDEFN N
[26]  OUREF N
[27]  OUSEG N
[28]  OUPROG N
[29]  PROGRELSECT
[30]  PROG_(8#$MAX($R PROG)%8)$TAKPROG
[31]  $GO nxt
[32] np:' Skipping: ',1$DRPHKEY
[33] nxt:XX_$QFREAD N HKEY 0 3          $COM Reposition to head rec
[34]  $GO (0=$R HEAD_GETHEAD N)/0 $DMD HKEY_$QFRKEY N,2
[35]  $GO next
    "
 
$COM  $QAV          18
$COM  $QCVT         19    20    22
$COM  $QFID         17    21    23
$COM  $QFREAD       33
$COM  $QFRKEY       34
$COM  DEBUG         15    15
$COM  DEFBASE        0
$COM  F              0    14    15
$COM  GETHEAD       16    34
$COM  HEAD           0    16_   18    19]   20]   22]   34_
$COM  HKEY           0    32    33    34_
$COM  N              0    14_   16    21    23    24    25    26    27    28
$COM                33    34    34
$COM  NEWDEFS        0
$COM  NEWREFS        0
$COM  OPENFID       14
$COM  OUDEFN        25
$COM  OUPROG        28
$COM  OUREF         26
$COM  OUSECTION     24
$COM  OUSEG         27
$COM  PROG          30_   30    30
$COM  PROGBASE       0
$COM  PROGRELSECT   29
$COM  REFBASE        0
$COM  REFMAP         0
$COM  SECTBASE       0
$COM  SEV           23_   23
$COM  Sev            0    22_   23    23
$COM  UTS            0    18_
$COM  XX             0    14_   14    18_   33_
$COM  gh            14    15:
$COM  next          16    18:   35
$COM  np            20    32:
$COM  nxt           31    33:
$COM  sok           22    24:
$COM  tok           19    22:
 
 
 
;'        Function: STATUS     '
 
 
    " R_STATUS R
[.001] $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[1]   $GO (0=$R R)/save
[2]   (SHARE DEBUG XWSID ISSID Severity Key)_R
[3]   $GO 0
[4]  save:R_(SHARE DEBUG XWSID ISSID Severity Key)
    "
 
$COM  DEBUG      2     4
$COM  ISSID      2     4
$COM  Key        2     4
$COM  R          0_    0     1     2     4_
$COM  SHARE      2     4
$COM  Severity   2     4
$COM  XWSID      2     4
$COM  save       1     4:
 
 
 
;'        Function: TESTID     '
 
 
    " R_TESTID N
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   (1 2$R e R_0)$QSM 'TESTID'
[3]   (N,',IN')$QFOPEN 1 $DMD R_1 $DMD $QFCLOSE 1
[4]   $GO 0
[5]  e:$XEC')?' $DMD $QFCLOSE(1$E $QFNUMS)/1
    "
 
$COM  $QFCLOSE   3     5
$COM  $QFNUMS    5
$COM  $QFOPEN    3
$COM  $QSM       2
$COM  N          0     3
$COM  R          0_    2_    3_
$COM  e          2     5:
 
 
 
;'        Function: WRITENODES '
 
 
    " NODES WRITENODES VERB;V;Z
[1]  $COM*T* Copyright (c) Bull HN Information Systems Inc., 1989
[2]   (1 2$R e 0)$QSM 'WRITENODES'
[3]   V_VERB$DSC',ERROR' ',NEWFILE' ',OLDFILE'
[4]   Z_(4+Z),0,(Z_3+$R NODES),NODES,($IB25),(100$DCD-1$DRP60 60 60 60$ECD$IB20),ISSID,SEV,0 0
[5]   $GO (SHARE=0)/keyed
[6]   $XEC')SET F$2 *L,ORG=RANDOM,IXTNSIZE=',$FMT1+$MIN(1023+$R Z)%1024
[7]   (OUT,',RANDOM,REASSIGN,Pn,CREATE',V)$QFOPEN 2
[8]   (DSRECORD Z)$QFWRITE 2 0 0 3
[9]   $QFCLEAR $DMD $XEC')!R F$2'
[10]  $GO 0
[11] keyed:(OUT,',KEYED,Pn,CREATE',V)$QFOPEN 2
[12]  $GO (0=$R $QSSS($QUNSET 'F$2')'ORG=KEYED')/er
[13]  Z $QFWRITE 2(Key,(0=$R Key)/'NODES')0 3
[14]  $QFCLEAR $DMD $GO 0
[15] e:$XEC')?' $DMD $GO 0
[16] er:'''',OUT,''' must be a keyed file!' $DMD $GO 0
    "
 
$COM  $QFCLEAR    9    14
$COM  $QFOPEN     7    11
$COM  $QFWRITE    8    13
$COM  $QSM        2
$COM  $QSSS      12
$COM  $QUNSET    12
$COM  DSRECORD    8
$COM  ISSID       4
$COM  Key        13    13
$COM  NODES       0     4     4
$COM  OUT         7    11    16
$COM  SEV         4
$COM  SHARE       5
$COM  V           0     3_    7    11
$COM  VERB        0     3
$COM  Z           0     4_    4     4_    6     8    13
$COM  e           2    15:
$COM  er         12    16:
$COM  keyed       5    11:
 
 
 
$QPP_10
$QCT_1E-13
$QLX_' ''LinkNodes B00'' $DMD GO'
$QPW_80
$XEC ')TERM INPUT ',$FMT $QTT
)SET INPUT ME
