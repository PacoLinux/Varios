VERSION E05

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:1    
        1        1        /*M*     FAG - Manipulate data in a packset's free extent pool.*/
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NSO,MCL=0,MOC,MEC,CLM=12,EXM=12,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9        FAG$: PROC(PARM) ALTRET;
       10       10        %INCLUDE B$JIT_C;
       11      324        %B$JIT0;
       12      413        %U$JIT1X;
       13      416        %M$JIT2X;
       14      419        %F$JIT3;
       15      424        %S$JIT4;
       16      430        %J$JIT5X;
       17      433        %A$JIT6X;
       18      436        %INCLUDE FM$MACROS;
       19      811        %FM$GRAN(BASED="BASED(BUF$)");
       20      815        %FM$CFU(BASED="BASED(CFU$)");
       21      821        %FM$CFUF(BASED="BASED(CFU$)");
       22      824        %FM$FIT(BASED="BASED(FIT$)");
       23      827        %INCLUDE FM_CACHE_R;
       24      839        %INCLUDE FM_CACHE_C;
       25      905        %FMC$CACHE;
       26      928        %INCLUDE CP_6_SUBS;
       27     1468        %INCLUDE EL_SUBS_C;
       28     1552        %INCLUDE AZ_SUBS_C;
       29     1621        %INCLUDE AZ_MACRO_C;
       30     4208        %PGRANS(STCLASS="BASED(XTN$)");
       31     4274        %CODE04(BASED="BASED(CFU$)");
       32     4282        %CODE03(BASED="BASED(SDCT$)");
       33     4289        %INCLUDE NI$TABLES;
       34     4505        %FM$SET(BASED="BASED(FM$SET$)");
       35     4510        %FM$VOL(ARY=,BASED="BASED(SDCT$)");
       36     4516        %FM$CFUA(BASED="BASED(CFU$)");
       37     4522        %MACRO F$DCB#(BASED=BASED);
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:2    
       38     4523        %INCLUDE F$DCB;
       39     4572        %MEND;
       40     4573        %INCLUDE F_ERRORS_C;
       41     4813        %SUB FCG#='0601'O;
       42     4814        %SUB MID#='07'O;
       43     4815        %F$DCB#(BASED="BASED(DCB$)");
       44     4865                    /* SYMREFS */
       45     4866    1   DCL B$JIT$ PTR SYMREF;
       46     4867    1   DCL F$CFU$ PTR SYMREF;
       47     4868    1   DCL FM_SRZERO SBIN SYMREF;
       48     4869    1   DCL FM_GPSDA SBIN SYMREF;
       49     4870    1   DCL FM_SYSACCTX SBIN SYMREF;
       50     4871    1   DCL FM$BUF$(0:0)SYMREF PTR;
       51     4872    1   DCL FA_SCATTER STATIC SYMDEF BIT(36)INIT('0'B);
       52     4873    1   DCL FM$SET$ PTR SYMREF;
       53     4874                    /* ENTREFS */
       54     4875    1   DCL FMB$LOGERR ENTRY(11); /* Log dual allocation */
       55     4876    1   DCL FMR$L8 ENTRY;
       56     4877    1   DCL FMR$U8 ENTRY;
       57     4878    1   DCL FMR$SLIDE ENTRY(3);
       58     4879    1   DCL FMN$READFIT ENTRY(2)ALTRET;
       59     4880    1   DCL FMD$WRTSV ENTRY(1);
       60     4881    1   DCL FMD$FLSHBUF ENTRY(1);
       61     4882    1   DCL FMD$GETBUF ENTRY(3);
       62     4883    1   DCL FMO$XTNTOFIT ENTRY(1) ALTRET;
       63     4884    1   DCL FMO$LOCCODX ENTRY(2)ALTRET;
       64     4885    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
       65     4886    1   DCL FMD$REDBUF ENTRY(6) ALTRET;
       66     4887    1   DCL UQB$MENQX ENTRY(1) ALTRET;
       67     4888    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
       68     4889        %SUB ENQUEUE="UQB$MENQX(PINCRW(ADDR(FM$SET(F$DCB.SETX)),6))";
       69     4890        %SUB DEQUEUE="UQB$MDEQ(PINCRW(ADDR(FM$SET(F$DCB.SETX)),6))";
       70     4891    1   DCL FMD$WRTBUF ENTRY(1);
       71     4892    1   DCL FMD$RELBUF ENTRY(1);
       72     4893    1   DCL FMR$ADDGAC ENTRY(2);
       73     4894    1   DCL FMR$UPDGAC ENTRY(2);
       74     4895    1   DCL ELA$SYSLOG ENTRY(6)ALTRET;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:3    
       75     4896    1   DCL FMC$CLRFILE ENTRY(1);
       76     4897    1   DCL FMC$CLR1EXT ENTRY(1);
       77     4898    1   DCL SC_GPERR ENTRY CONV(2,0);
       78     4899        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:4    
       79     4900                    /* BASED CONSTRUCTS */
       80     4901    1   DCL 1 ABUF BASED(XTN$) ALIGNED,
       81     4902    1         2 SIZ UBIN(9) UNAL,
       82     4903    1         2 ADR UBIN(27) UNAL;
       83     4904    1   DCL 1 BBUF BASED(XTN$) ALIGNED,
       84     4905    1         2 ADR SBIN,
       85     4906    1         2 SIZ SBIN;
       86     4907    1   DCL 1 XBUF BASED(XTN$) ALIGNED,
       87     4908    1         2 ADR UBIN(18) UNAL,
       88     4909    1         2 EADR UBIN(18) UNAL,
       89     4910    1         2 ADR1 UBIN(18) UNAL,
       90     4911    1         2 EADR1 UBIN(18) UNAL;
       91     4912    1   DCL 1 VXH BASED(VXH$) ALIGNED,
       92     4913    1         2 VOL UBIN(9) UNAL,
       93     4914    1         2 N BIT(1),
       94     4915                    /* IF SET, NEXT GRAN HAS MORE FOR THIS VOL */
       95     4916    1         2 P BIT(1),
       96     4917                    /* IF SET, PREV GRAN HAS MORE FOR THIS GRANULE */
       97     4918    1         2 * BIT(7),
       98     4919    1         2 XTNS UBIN(18) UNAL ;
       99     4920    1   DCL GRANULE BASED CHAR(4096);
      100     4921        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:5    
      101     4922                    /* AUTO STORAGE */
      102     4923    1   DCL T$ PTR; /* TEMP POINTER FOR CALLS - TO IMPROVE PL6'S MEMORY */
      103     4924    1   DCL XTN$ PTR;
      104     4925    1   DCL VXH$ PTR;
      105     4926    1   DCL VXH$N REDEF VXH$ UBIN;
      106     4927    1   DCL SDCT$ PTR;
      107     4928    1   DCL SIZE SBIN;
      108     4929    1   DCL 1 RXTN REDEF SIZE,
      109     4930    1         2 ADR UBIN(18) UNAL,
      110     4931    1         2 EADR UBIN(18) UNAL;
      111     4932    1   DCL 1 O,
      112     4933    1         2 ADR SBIN,
      113     4934    1         2 SIZ UBIN;
      114     4935    1   DCL 1 OS REDEF O,
      115     4936    1         2 SIZ UBIN(9) UNAL,
      116     4937    1         2 * BIT(27),
      117     4938    1         2 SIZ2 SBIN;
      118     4939    1   DCL BUF# SBIN;
      119     4940    1   DCL ENT# SBIN;
      120     4941    1   DCL VOL# SBIN; /* CURRENT VOLUME NUMBER IN SET */
      121     4942    1   DCL OVOL UBIN; /* SRDZERO OF VOL WITH MOST SPACE */
      122     4943    1   DCL SRDZERO SBIN; /* SETREL DEVICE ZERO */
      123     4944    1   DCL X SBIN;
      124     4945    1   DCL XU REDEF X UBIN;
      125     4946    1   DCL Y SBIN;
      126     4947    1   DCL CDA SBIN;
      127     4948    1   DCL BUF$ PTR;
      128     4949    1   DCL DCB$ PTR;
      129     4950    1   DCL CFU$ PTR;
      130     4951    1   DCL FIT$ PTR;
      131     4952                    /* PARMETER(S) */
      132     4953    1   DCL 1 PARM,
      133     4954    1         2 P1 SBIN,
      134     4955    1         2 P2 SBIN;
      135     4956    1   DCL 1 INXTN REDEF PARM,
      136     4957    1         2 SIZ UBIN(9) UNAL,
      137     4958    1         2 ADR UBIN(27) UNAL,
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:6    
      138     4959    1         2 SIZ2 SBIN;
      139     4960        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:7    
      140     4961                    /* STATIC/CONSTANT DATA */
      141     4962        %ERRCODE(NAME=FAG$E$ACGRANS,COD#=%E$ACGRANS);
      142     4966        %ERRCODE(NAME=FAG$E$USGRANS,COD#=%E$USGRANS);
      143     4970        %ERRCODE(NAME=FAG$E$PSGRANS,COD#=%E$PSGRANS);
      144     4974        %ERRCODE(NAME=FAG$E$GP,COD#=%E$GP);
      145     4978        %ERRCODE(NAME=FAG$E$NOCODE,COD#=0);
      146     4982        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:8    
      147     4983    1   FAG$GAFIT: ENTRY(PARM) ALTRET;
      148     4984                    /*F*     NAME: FAG$GAFIT
      149     4985                    *        PURPOSE: Allocate an AFIT granule.
      150     4986                    *        DESCRIPTION: Uses FAG$GEXT logic as in G1DIR, but ensures
      151     4987                    *        that the granule is on the same volume as the file.
      152     4988                    */
      153     4989    1      CFU$=B$JIT.DCB$->F$DCB.CFU$;
      154     4990    1      GOTO G1COMMON;
      155     4991                    /**/
      156     4992    1   FAG$G1DIR: ENTRY(PARM) ALTRET;
      157     4993                    /*F*     NAME: FAG$G1DIR
      158     4994                         PURPOSE: Allocates a single granule for directory purposes.
      159     4995                     DESCRIPTION: Uses FAG$GEXT logic with a one-granule request,
      160     4996                     storing the result in the single parameter.*/
      161     4997    1      CFU$=ADDR(FA_SCATTER);
      162     4998    1   G1COMMON:;
      163     4999    1      ENT#=1;
      164     5000    1      DCB$=B$JIT.DCB$;
      165     5001    1      O.SIZ=1;
      166     5002    1      GOTO GEXT0;
      167     5003        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:9    
      168     5004    1   FAG$CGRANS: ENTRY ALTRET;
      169     5005                    /*F*     NAME: FAG$CGRANS
      170     5006                              PURPOSE: Inspects the free extent pool of the newly
      171     5007                        mounted packset and sets up FM$SET entries for its volumes.
      172     5008                        DESCRIPTION: Altrets if a reconstruct is required.
      173     5009                    */
      174     5010    1      ENT#=2;
      175     5011    1      SIZE=FM_SRZERO;
      176     5012    1      DCB$=B$JIT.DCB$;
      177     5013    1      BUF#=0;
      178     5014    1      CALL GETVOL;
      179     5015    1      CDA=FM_GPSDA;
      180     5016    1   CGRANS0: FM$VOL.GPSDA=CDA;
      181     5017    1      O.SIZ=1;
      182     5018    1      GOTO GNEXT;
      183     5019
      184     5020    1   FAG$COUNT: ENTRY(PARM) ALTRET;
      185     5021                    /*F*     NAME: FAG$COUNT
      186     5022                    *        PURPOSE: Adds up the remaining granules on the volumes
      187     5023                    *        of the set pointed to by B$JIT.DCB$->F$DCB.SETX,
      188     5024                    *        returning the total in the parameter.
      189     5025                    */
      190     5026    1      PARM.P1=0;
      191     5027    1      DCB$=B$JIT.DCB$;
      192     5028    1      SDCT$=ADDR(FM$SET(FM$SET.DCTX(F$DCB.SETX)));
      193     5029    2      DO WHILE(SDCT$~=FM$SET$);
      194     5030    2         PARM.P1=PARM.P1+FM$VOL.RGRANS;
      195     5031    2         SDCT$=ADDR(FM$SET(FM$VOL.VOLL));
      196     5032    2         END;
      197     5033    1      RETURN;  /* Pretty dumb, really */
      198     5034        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:10   
      199     5035    1   FAG$REXT: ENTRY (PARM) ALTRET;
      200     5036                    /*F*     NAME:FAG$REXT
      201     5037                              PURPOSE: Returns an extent to the free extent pool.
      202     5038                        DESCRIPTION: The single parameter is a one-or-two-word extent
      203     5039                        which is merged into the free extent pool. */
      204     5040    1      ENT#=4;
      205     5041    1      CALL FMC$CLR1EXT(PARM);
      206     5042    1      DCB$=B$JIT.DCB$;
      207     5043    1      SIZE=INXTN.ADR;
      208     5044    1      BUF#=0;
      209     5045    1      CALL GETVOL ALTRET(BADXTN);
      210     5046    1      IF INXTN.SIZ~=0 THEN RXTN.EADR=RXTN.ADR+INXTN.SIZ;
      211     5047    1      ELSE RXTN.EADR=RXTN.ADR+INXTN.SIZ2;
      212     5048    1      GOTO R1EXT;
      213     5049        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:11   
      214     5050    1   FAG$RFILE: ENTRY(PARM) ALTRET;
      215     5051                    /*F*     NAME: FAG$RFILE
      216     5052                        PURPOSE: Releases the extents occupied by a file by reading its
      217     5053                        FIT (whose SDA is the single parameter).
      218     5054                    */
      219     5055    1      ENT#=5;
      220     5056    1      BUF#=0;
      221     5057    1      DCB$=B$JIT.DCB$;
      222     5058    1      CALL FMN$READFIT(T$,PARM)ALTRET(ALTFIT);
      223     5059    1      BUF$=T$;
      224     5060    1      FIT$=PINCRW(BUF$,SIZEW(FM$GRAN));
      225     5061    1      FM$FIT.CODES.CODE(1)=0; /* CLOBBER THE FIT */
      226     5062    1      IF F$DCB.BFR.BUFX(0) ~= 0 THEN CALL FMD$FLSHBUF(0);
      227     5063    1      IF F$DCB.BFR.BUFX(2)~=0 THEN CALL FMD$FLSHBUF(2);
      228     5064    1      IF F$DCB.BFR.BUFX(3)~=0 THEN CALL FMD$FLSHBUF(3);
      229     5065    1      IF F$DCB.BFR.BUFX(4) ~= 0 THEN CALL FMD$FLSHBUF(4);
      230     5066    1      CALL FMD$WRTSV(1);
      231     5067    1      IF F$DCB.BFR1.CX(1) > 0 THEN
      232     5068    1         FMC$CACHETBL.FLAGS.ERR(F$DCB.BFR1.CX(1))='1'B;
      233     5069                    /* Set the error flag so we don't save the FIT in the cache */
      234     5070    1      F$DCB.BFR.DA(1)=0; /* Zap diskaddr so we don't pick it up again */
      235     5071    2      IF F$DCB.WSR~=1 AND NOT B$JIT.PRIV.ACTIVE.FMEFT THEN DO;
      236     5072    2         T$=FIT$;
      237     5073    2         CALL FMO$LOCCODP(T$,4)ALTRET(NOGAC);
      238     5074    2         CFU$=T$;
      239     5075                    /* DO THE FINAL GRANULE ACCOUNTING FOR PERMANENT FILES */
      240     5076    2         T$=FIT$;
      241     5077    2         CALL FMO$LOCCODP(T$,3)ALTRET(NOGAC);
      242     5078    2         SDCT$=T$;
      243     5079    2         X=CODE03.UGRANS+CODE03.NGAVAL;
      244     5080    3         IF CODE04.GAC.TIME<FM$SET.GACTIME(F$DCB.SETX) THEN DO;
      245     5081    3            CODE04.GAC.TIME=FM$SET.GACTIME(F$DCB.SETX);
      246     5082    3            CODE04.GAC.N=0;
      247     5083    3            END;
      248     5084    2         CALL FMR$UPDGAC(CODE04.GAC,X);
      249     5085    2         OVOL=6;
      250     5086    2         T$=FIT$;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:12   
      251     5087    2         CALL FMO$LOCCODX(T$,OVOL);
      252     5088    2         IF FM$FIT.CODES.NDW(OVOL)~=0 THEN X=%AZ$GACSTOWACT;
      253     5089    2         ELSE IF F$DCB.BUPF AND CODE03.DESC.BUPM THEN X=%AZ$GACBACKUP;
      254     5090    2            ELSE X=%AZ$GACNOBACKUP;
      255     5091    2         IF CODE04.CREATOR.NAME=B$JIT.UNAME
      256     5092    2           AND CODE04.CREATOR.ACCT=B$JIT.ACCN
      257     5093    2           AND NOT FM$SET.XCL(F$DCB.SETX)
      258     5094    3           AND F$DCB.ACCT=B$JIT.ACCN THEN DO;
      259     5095    3            CALL FMR$ADDGAC(B$JIT.GAC(X),CODE04.GAC.N);
      260     5096    3            END;
      261     5097    3         ELSE DO;
      262     5098    3            XTN$=PINCRW(FIT$,2);
      263     5099    3            PGRANS='0'B;
      264     5100    3            PGRANS.CREATOR=CODE04.CREATOR;
      265     5101    3            PGRANS.PSN=FM$SET.PSN(F$DCB.SETX);
      266     5102    3            IF FM$SET.XCL(F$DCB.SETX) THEN PGRANS.SHELF(X)=CODE04.GAC.N;
      267     5103    3            ELSE PGRANS.ONLINE(X)=CODE04.GAC.N;
      268     5104    3            PGRANS.CODE=%AZ$PGRANS;
      269     5105    3            PGRANS.FMACCT=F$DCB.ACCT;
      270     5106    3            CALL ELA$SYSLOG(EL_ACCTLG,PGRANS,SIZEW(PGRANS),0,2,X);
      271     5107    3            END;
      272     5108    2         END;
      273     5109    1   NOGAC:;
      274     5110    1      O.ADR=FM$FIT.CODES.ITEMX(1); /* DISPL OF EXTENT POOL */
      275     5111    1      O.SIZ=FM$FIT.CODES.NDW(1)+O.ADR; /* END DISP OF EXTENT POOL */
      276     5112    1      O.ADR=O.ADR+1;
      277     5113    1      T$=FIT$;
      278     5114    1      CALL FMC$CLRFILE(T$);
      279     5115    2      IF FM$GRAN.LVL=6 THEN DO; /* AFIT..RELEASE IT FIRST */
      280     5116    2         SIZE=PARM.P1;
      281     5117    2         CALL GETVOL ALTRET(BADXTN);
      282     5118    2         RXTN.EADR=RXTN.ADR+1;
      283     5119    2         END;
      284     5120    2      ELSE DO;
      285     5121    2   RELNEXT:;
      286     5122    2         XTN$=PINCRW(FIT$,O.ADR);
      287     5123    2         SIZE=ABUF.ADR;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:13   
      288     5124    2         CALL GETVOL ALTRET(BADXTN);
      289     5125    3         IF ABUF.SIZ=0 THEN DO;
      290     5126    3            RXTN.EADR=RXTN.ADR+BBUF.SIZ;
      291     5127    3            O.ADR=O.ADR+1;
      292     5128    3            END;
      293     5129    2         ELSE RXTN.EADR=RXTN.ADR+ABUF.SIZ;
      294     5130    2         O.ADR=O.ADR+1;
      295     5131    2         END;
      296     5132    1      IF O.ADR=O.SIZ THEN ENT#=4; /* EXIT AFTER THIS ONE */
      297     5133    1   R1EXT: IF RXTN.EADR>RXTN.ADR THEN GOTO GNEXT;
      298     5134    1   BADXTN:;
      299     5135    1      CALL FMB$LOGERR(%E$GP,21,0,PARM.P1,,,,,RXTN);
      300     5136    1      GOTO RETALT1;
      301     5137        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:14   
      302     5138    1   FAG$GEXT: ENTRY ALTRET;
      303     5139                    /*F*     NAME: FAG$GEXT
      304     5140                              PURPOSE: Allocate the next extent for a file purpose.
      305     5141                    DESCRIPTION: An extent of size DCB.IXTNGRAN is extracted from the
      306     5142                    free pool and the result placed in the CFU extent table for the
      307     5143                    file and in the file's FIT.*/
      308     5144    1      DCB$=B$JIT.DCB$;
      309     5145    1      ENT#=3;
      310     5146    1      IF F$DCB.IORG~=%RANDOM# AND F$DCB.IORG~=%IDS# AND F$DCB.IORG~=%RELATIVE#
      311     5147    1      THEN ENT#=0;
      312     5148    1      CFU$=F$DCB.CFU$;
      313     5149    1      OS.SIZ2=F$DCB.IXTNSIZE-FM$CFU.UGRANS;
      314     5150    1      IF OS.SIZ2~=F$DCB.IXTNSIZE AND OS.SIZ2<F$DCB.XTNSIZE
      315     5151    1      THEN OS.SIZ2=F$DCB.XTNSIZE;
      316     5152    1      IF FM$CFUF.ACCNAM=0 AND O.SIZ<=2 AND ENT#=0 THEN O.SIZ=20;
      317     5153    1   GEXT0:;
      318     5154    1      SIZE=FM_SRZERO;
      319     5155    1      BUF#=0;
      320     5156    1      CALL GETVOL;
      321     5157    1      X=0;
      322     5158    2      DO WHILE(SDCT$~=FM$SET$);
      323     5159    3         IF X<FM$VOL.RGRANS THEN DO;
      324     5160    3            X=FM$VOL.RGRANS;
      325     5161    3            SIZE=SRDZERO;
      326     5162    3            END;
      327     5163    2         SRDZERO=SRDZERO+FM$VOL.NXTSDA-FM_SRZERO;
      328     5164    2         SDCT$=ADDR(FM$SET(FM$VOL.VOLL));
      329     5165    2         END;
      330     5166    1      CALL GETVOL ALTRET(FAGE$PSGRANS);
      331     5167    2      IF FM$CFU.FITSDA~=0 THEN DO;
      332     5168    2         X=OVOL;/* SAVE OTHER CHOPICE */
      333     5169    2         SIZE=FM$CFU.FITSDA;
      334     5170    3         IF FA_SCATTER THEN DO;
      335     5171    3            SIZE=(FM$SET.NXTSDA(F$DCB.SETX)-FM_SRZERO)*MOD(B$JIT.STIME,1024)/1024;
      336     5172    3            SIZE=SIZE+FM_SRZERO;
      337     5173    3            END;
      338     5174    2         CALL GETVOL ALTRET(FAGE$PSGRANS);
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:15   
      339     5175    2         OVOL=X;
      340     5176    2         END;
      341     5177    1      IF ENT#=1 THEN GOTO GNEXT;
      342     5178    1      IF O.SIZ=0 THEN O.SIZ=8;
      343     5179    1      X=O.SIZ;
      344     5180    1      IF F$DCB.BORROW>0 THEN IF F$DCB.BORROW<XU THEN X=O.SIZ-F$DCB.BORROW;
      345     5181    1         ELSE GOTO GNEXT;
      346     5182    2      IF F$DCB.STARF OR FM$CFU.NAMEX=0 THEN DO; /* STAR OR SCRATCH */
      347     5183    2         CFU$=ADDR(NIL);
      348     5184    2         IF F$DCB.STARX=4 OR F$DCB.WSR=1 OR F$DCB.STARX=3 AND F$DCB.NRECS=0
      349     5185    2         THEN EXIT; /* some things in life are free */
      350     5186    3         DO WHILE XU+B$JIT.CURTMPDP>B$JIT.MAXTMPDP;
      351     5187    3            CALL ADJ_REQ ALTRET(FAGE$USGRANS);
      352     5188    3            END;
      353     5189                    /*E*     ERROR: FAG-E$USGRANS-E
      354     5190                    *        MESSAGE: !LIMIT for disk space exceeded% for %UF%
      355     5191                    */
      356     5192    2         END;
      357     5193    2      ELSE DO;
      358     5194    2         IF F$DCB.WSR~=1 AND NOT B$JIT.PRIV.ACTIVE.FMEFT
      359     5195    2           AND FM$CFU.ACCTX~=FM_SYSACCTX
      360     5196    3         THEN DO WHILE XU>B$JIT.PRDPRM;
      361     5197    3            CALL ADJ_REQ ALTRET(FAGE$USGRANS);
      362     5198    3            END;
      363     5199    2         CALL FMR$L8;
      364     5200    2         IF FM$CFU.ACCTX=0 THEN CFU$=PINCRW(F$CFU$,FM$CFU.NAMEX);
      365     5201    2         CFU$=PINCRW(F$CFU$,FM$CFU.ACCTX);
      366     5202    2         IF F$DCB.WSR~=1 AND NOT B$JIT.PRIV.ACTIVE.FMEFT
      367     5203    3         THEN DO WHILE XU>FM$CFUA.GRANS;
      368     5204    3            CALL ADJ_REQ ALTRET(FAGE$ACGRANS);
      369     5205    3            END;
      370     5206                    /*E*     ERROR: FAG-E$ACGRANS-E
      371     5207                    *        MESSAGE: Account% %AC% disk space exceeded% for %UF%
      372     5208                    */
      373     5209    2         CALL FMR$U8;
      374     5210    2         END;
      375     5211    1   GNEXT: Y=-O.SIZ;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:16   
      376     5212    1      BUF#=4;
      377     5213    1      IF ENT#<4 THEN IF F$DCB.BFR.BUFX(3)=0 THEN BUF#=3;
      378     5214    1         ELSE IF F$DCB.TDA=0 AND F$DCB.BFR.BUFX(2)=0 THEN BUF#=2;
      379     5215    1      CALL ENQUEUE ALTRET(ENQERR);
      380     5216    1   RD1ST: X=-1; /* NO LINK CHECK THE FIRST TIME */
      381     5217    1      CDA=FM$VOL.GPSDA;
      382     5218    1   RDNXT: ;
      383     5219    1      VXH$N=F$DCB.GTYP;
      384     5220    1      F$DCB.GTYP=FMGTGP;
      385     5221    1      CALL FMD$REDBUF(T$,BUF#,CDA,0,X)ALTRET(RETALT1);
      386     5222    1      BUF$=T$;
      387     5223    1      F$DCB.GTYP=VXH$N;
      388     5224    1      VXH$=PINCRW(BUF$,FM$GRAN.FCEX);
      389     5225    2      DO WHILE (VXH.VOL<VOL#);
      390     5226    2         IF VXH.N THEN GOTO RDNXT0; /* MORE FOR VXH.VOL ON NEXT GRAN */
      391     5227    2         VXH$=PINCRW(VXH$,VXH.XTNS+1); /* GET TO NEXT VOL HERE */
      392     5228    2         IF POFFW(VXH$,BUF$)>=FM$GRAN.NAVX THEN GOTO RDNXT0;
      393     5229    2         END;
      394     5230    1      IF VXH.XTNS+POFFW(VXH$,BUF$)>1023
      395     5231    1        OR VXH.VOL~=VOL# OR VXH.XTNS=0 THEN GOTO BUFERR;
      396     5232    1      IF ENT#>3 THEN GOTO REXT;
      397     5233    2      IF ENT#=2 THEN DO;
      398     5234    3         IF NOT VXH.P THEN DO;
      399     5235    3            FM$VOL.GPSDA=CDA;
      400     5236    3            SIZE=0;
      401     5237    3            END;
      402     5238    3         DO X=1 TO VXH.XTNS-1;
      403     5239    3            XTN$=PINCRW(VXH$,X);
      404     5240    3            IF XBUF.EADR>PINCRW(XTN$,1)->XBUF.ADR
      405     5241    3              OR XBUF.EADR<=XBUF.ADR THEN GOTO FAGE$PSGRANS;
      406     5242    3            SIZE=SIZE+XBUF.EADR-XBUF.ADR;
      407     5243    3            END;
      408     5244    2         IF VXH.N THEN GOTO RDNXT0;
      409     5245    2         FM$VOL.RGRANS=SIZE;
      410     5246    2         VOL#=VOL#+1;
      411     5247    2         SDCT$=ADDR(FM$SET(FM$VOL.VOLL));
      412     5248    2         IF SDCT$~=FM$SET$ THEN GOTO CGRANS0;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:17   
      413     5249    2         X=-1;
      414     5250    2         F$DCB.GTYP=FMGTGP;
      415     5251    2         CDA=FM_GPSDA;
      416     5252    2         CALL FMD$REDBUF(T$,BUF#,CDA,0,X)ALTRET(RETALT1);
      417     5253    2         BUF$=T$;
      418     5254                    /* RELEASE FILES OPEN AT RECOVERY IF THERE ARE ANY */
      419     5255    2         X=FM$GRAN.BLINK;
      420     5256    3         IF X~=0 THEN DO;
      421     5257    3            FM$GRAN.BLINK=0;
      422     5258    3            CALL FMD$WRTBUF(BUF#);
      423     5259    3            CALL DEQUEUE;
      424     5260    3            RXTN=F$DCB.NAME; /* SAVE THE NAME WE HAVE */
      425     5261    3            ADDR(F$DCB.NAME)->VXH='001'O;
      426     5262    4            DO WHILE(X>FM_SRZERO);
      427     5263    4               CALL FAG$RFILE(X);
      428     5264    4               FIT$=FM$BUF$(F$DCB.BFR.BUFX(1));
      429     5265    4               IF FIT$=ADDR(NIL) THEN EXIT;
      430     5266    4               X=BITBIN(FM$FIT.CODES(1023));
      431     5267    4               CALL FMD$RELBUF(1);
      432     5268    4               END;
      433     5269    3            ADDR(F$DCB.NAME)->VXH=RXTN;
      434     5270    3            END;
      435     5271    3         ELSE DO;
      436     5272    3            CALL FMD$FLSHBUF(BUF#);
      437     5273    3            CALL DEQUEUE;
      438     5274    3            END;
      439     5275    2         RETURN;
      440     5276    2         END;
      441     5277        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:18   
      442     5278    2   GEXT: DO X=1 TO VXH.XTNS-1;
      443     5279    2         XTN$=PINCRW(VXH$,X);
      444     5280    2         IF XBUF.EADR>PINCRW(XTN$,1)->XBUF.ADR
      445     5281    2           OR XBUF.EADR<=XBUF.ADR THEN GOTO BUFERR;
      446     5282    2         SIZE=XBUF.EADR-XBUF.ADR-O.SIZ;
      447     5283    2         IF SIZE>=0 THEN GOTO GOTONE;
      448     5284    2         IF Y<SIZE THEN Y=SIZE;
      449     5285    2         END;
      450     5286    2      IF VXH.N THEN DO;
      451     5287    2   RDNXT0: X=CDA; /* FLINK MERRILY ALONG */
      452     5288    2         CDA=FM$GRAN.FLINK;
      453     5289    2         IF CDA~=0 THEN GOTO RDNXT;
      454     5290    2         END;
      455     5291    1      IF ENT#>3 THEN ALTRETURN;
      456     5292                    /* SWITCH TO ANOTHER VOLUME IF THIS ONE IS EMPTY (OR NEARLY SO) */
      457     5293    1      IF Y<=-O.SIZ/2 AND OVOL~=SRDZERO
      458     5294                    /* OR RGRANS SAYS THERE'S MORE WHEN THERE ISN'T */
      459     5295    2        OR Y=-O.SIZ AND FM$VOL.RGRANS~=0 THEN DO;
      460     5296    2         SIZE=OVOL;
      461     5297    2         IF SIZE=SRDZERO THEN SIZE=FM_SRZERO;
      462     5298    2         IF Y=-O.SIZ THEN FM$VOL.RGRANS=0;
      463     5299    2   TRYANOTHER:;
      464     5300    2         CALL GETVOL ALTRET(FAGE$PSGRANS);
      465     5301    2         IF FM$VOL.RGRANS~=0 THEN GOTO GNEXT;
      466     5302    2         SIZE=SRDZERO+Y;
      467     5303                    /* FIND ONE WITH SOMETHING THERE */
      468     5304    2         GOTO TRYANOTHER;
      469     5305    2         END;
      470     5306    1      ELSE IF Y=-O.SIZ THEN GOTO FAGE$PSGRANS;
      471     5307                    /*E* ERROR: FAG-E$PSGRANS-E
      472     5308                    *        MESSAGE: Packset% #%SN% disk space exhausted% for %UF%
      473     5309                    */
      474     5310    1      O.SIZ=Y+O.SIZ;
      475     5311    1      IF ENT#=3 THEN Y=-Y;
      476     5312    1      IF CDA=FM_GPSDA THEN GOTO GEXT;
      477     5313    1      GOTO RD1ST;
      478     5314        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:19   
      479     5315    1   REXT: X=0;Y=0;
      480     5316    2      IF VXH.N AND RXTN.EADR>PINCRW(VXH$,VXH.XTNS)->XBUF.ADR THEN DO;
      481     5317    2         XTN$=PINCRW(VXH$,VXH.XTNS-1);
      482     5318    3         IF RXTN.ADR<PINCRW(XTN$,1)->XBUF.ADR THEN DO;
      483     5319    3            IF RXTN.ADR<XBUF.EADR AND XTN$~=VXH$ THEN GOTO BUFERR;
      484     5320    3            PINCRW(XTN$,1)->XBUF.ADR=RXTN.ADR;
      485     5321    3            PINCRW(XTN$,1)->XBUF.EADR=RXTN.ADR;
      486     5322                    /* CHOP THIS BUFFER SHORTER - CHECK FOR DUAL RELEASE IN NEXT ONE */
      487     5323    3            F$DCB.BFR.BUFUP(BUF#)='1'B;
      488     5324    3            END;
      489     5325    2         GOTO RDNXT0;
      490     5326    2         END;
      491     5327    2      DO WHILE (X=0); /* FIND WHERE THIS EXTENT GOES */
      492     5328    2         XTN$=PINCRW(VXH$,Y);
      493     5329    3         IF Y<VXH.XTNS-1 THEN DO;
      494     5330    3            IF Y>0 AND XBUF.EADR>=XBUF.ADR1 THEN GOTO BUFERR;
      495     5331    3            IF XBUF.ADR1>=XBUF.EADR1 THEN GOTO BUFERR;
      496     5332    3            IF RXTN.EADR=XBUF.ADR1 THEN X=2; /* FOUND ADJACENT EXTENT */
      497     5333    3            IF RXTN.EADR<XBUF.ADR1 THEN X=4; /* MUST GO HERE */
      498     5334    3            END;
      499     5335    2         ELSE X=4;
      500     5336    2         IF Y>0 AND RXTN.ADR=XBUF.EADR THEN X=X+1; /* ADJACENT EXTENT */
      501     5337    2         Y=Y+1;
      502     5338    2         END;
      503     5339    1      IF Y>1 AND RXTN.ADR<XBUF.EADR THEN GOTO BUFERR; /* OVERLAP */
      504     5340    2      DO CASE(X); /* COALESCE IF POSSIBLE */
      505     5341    2      CASE(1); /* ADR=EADR0, EADR>ADR1 ..OVERLAP */
      506     5342    2         GOTO BUFERR;
      507     5343    2      CASE(2); /* EADR=ADR1 .. COALESCE */
      508     5344    2         XBUF.ADR1=RXTN.ADR;
      509     5345    2      CASE(3); /* ADR=EADR0, EADR=ADR1 .. DOUBLE MATCH */
      510     5346    2         XBUF.ADR1=XBUF.ADR;
      511     5347    2         CALL SQZ;
      512     5348    2      CASE(4); /* NO MATCH */
      513     5349    3         IF FM$GRAN.NAVX<1024 THEN DO;
      514     5350    3            X=FM$GRAN.NAVX-POFFW(XTN$,BUF$);
      515     5351    3            T$=XTN$;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:20   
      516     5352    3            CALL FMR$SLIDE(T$,1,X);
      517     5353    3            FM$GRAN.NAVX=FM$GRAN.NAVX+1;
      518     5354    3            FM$GRAN.AVAIL=1024-FM$GRAN.NAVX;
      519     5355    3            VXH.XTNS=VXH.XTNS+1;
      520     5356    3            XBUF.ADR1=RXTN.ADR;
      521     5357    3            XBUF.EADR1=RXTN.EADR;
      522     5358    3            END;
      523     5359    3         ELSE DO;
      524     5360    3            CALL FMD$GETBUF(3,1,T$);
      525     5361    3            XTN$=T$;
      526     5362    3            XTN$->GRANULE=BUF$->GRANULE; /* COPY THE GRANULE */
      527     5363    3            X=POFFW(VXH$,BUF$); /* WHERE ARE WE IN THIS GRANULE */
      528     5364    3            Y=1023-X-VXH.XTNS; /* SPACE AT END OF GRAN */
      529     5365    4            IF X<512 THEN DO; /* SPLIT MAY NOT BE BEFORE THIS VOL */
      530     5366    5               IF X=FM$GRAN.FCEX AND Y=0 THEN DO; /* ALL ONE VOLUME, SPLIT IT */
      531     5367    5                  CFU$=PINCRW(XTN$,X);
      532     5368    5                  X=VXH.XTNS/2; /* DECIDE HOW MUCH TO SPLIT OFF */
      533     5369    5                  Y=VXH.XTNS-X; /* AND HOW MUCH TO LEAVE */
      534     5370    5                  CFU$->VXH.XTNS=Y;
      535     5371    5                  CFU$->VXH.P='1'B;
      536     5372    5                  VXH.XTNS=X+1;
      537     5373    5                  VXH.N='1'B;
      538     5374    5                  CALL FMR$SLIDE(PINCRW(CFU$,1),-X,Y);
      539     5375    5                  CFU$=PINCRW(VXH$,X+1); /* TERMINATE VOLUME LIST */
      540     5376    5                  CFU$->XBUF.EADR=CFU$->XBUF.ADR;
      541     5377    5                  IF RXTN.ADR>CFU$->XBUF.ADR THEN VXH$=PINCRW(XTN$,FM$GRAN.FCEX);
      542     5378    5                  FM$GRAN.NAVX=POFFW(CFU$,BUF$)+1;
      543     5379    5                  XTN$->FM$GRAN.NAVX=XTN$->FM$GRAN.NAVX-X;
      544     5380    5                  GOTO REXT10;
      545     5381    5                  END;
      546     5382    5               ELSE IF Y>X-FM$GRAN.FCEX THEN DO;
      547     5383    5                     FM$GRAN.NAVX=FM$GRAN.NAVX-Y;
      548     5384    5                     END;
      549     5385    4                  ELSE GOTO REXT5;
      550     5386    4               END;
      551     5387    4            ELSE DO;
      552     5388    4   REXT5:      ;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:21   
      553     5389    4               FM$GRAN.NAVX=X; /* MOVE THIS VOL TO NEXT GRAN */
      554     5390    4               VXH$=PINCRW(XTN$,FM$GRAN.FCEX);
      555     5391    4               END;
      556     5392    3            Y=1024-FM$GRAN.NAVX;
      557     5393    3            X=FM$GRAN.FCEX-FM$GRAN.NAVX;
      558     5394    3            CALL FMR$SLIDE(PINCRW(XTN$,FM$GRAN.FCEX),X,Y);
      559     5395    3            XTN$->FM$GRAN.NAVX=FM$GRAN.FCEX+Y;
      560     5396    3   REXT10:  ;
      561     5397                    /* SET UP THE NEW GRANULE */
      562     5398    3            XTN$->FM$GRAN.BLINK=CDA;
      563     5399    3            XTN$->FM$GRAN.AVAIL=1024-XTN$->FM$GRAN.NAVX;
      564     5400    3            F$DCB.BFR.DA(3)=RXTN.ADR+SRDZERO;
      565     5401    3            XTN$->FM$GRAN.STAMP.GMOD=F$DCB.BFR.DA(3);
      566     5402    3            RXTN.ADR=RXTN.ADR+1;
      567     5403                    /* NOW THE OLD GRANULE */
      568     5404    3            FM$GRAN.AVAIL=1024-FM$GRAN.NAVX;
      569     5405    3            X=FM$GRAN.FLINK;
      570     5406    3            FM$GRAN.FLINK=F$DCB.BFR.DA(3);
      571     5407    4            IF X~=0 THEN DO;
      572     5408    4               F$DCB.GTYP=FMGTGP;
      573     5409    4               CALL FMD$REDBUF(T$,2,X,0,CDA)ALTRET(RETALT0);
      574     5410    4               CFU$=T$;
      575     5411    4               CFU$->FM$GRAN.BLINK=F$DCB.BFR.DA(3);
      576     5412    4               END;
      577     5413    4            IF RXTN.EADR>RXTN.ADR THEN DO;
      578     5414    4               IF VXH$=PINCRW(XTN$,FM$GRAN.FCEX) THEN BUF$=XTN$;
      579     5415    4               GOTO REXT;
      580     5416    4               END;
      581     5417    3            END;
      582     5418    2      CASE(5); /* ADR=EADR0 .. COALESCE */
      583     5419    2         XBUF.EADR=RXTN.EADR;
      584     5420    2      END;
      585     5421    1      IF PINCRW(VXH$,VXH.XTNS-1)->ABUF='0'B THEN CALL SC_GPERR;
      586     5422    1      IF F$DCB.BFR.BUFX(2)~=0 THEN CALL FMD$WRTBUF(2);
      587     5423    1      IF F$DCB.BFR.BUFX(3)~=0 THEN CALL FMD$WRTBUF(3);
      588     5424    1      FM$VOL.RGRANS=FM$VOL.RGRANS+RXTN.EADR-RXTN.ADR;
      589     5425    2      IF ENT#=5 THEN DO; /* CONTINUE IF DOING A WHOLE FILE */
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:22   
      590     5426    2         F$DCB.BFR.BUFUP(BUF#)='1'B;
      591     5427    2         GOTO RELNEXT;
      592     5428    2         END;
      593     5429    1      CALL FMD$WRTBUF(BUF#);
      594     5430    1      CALL DEQUEUE;
      595     5431    1   RETRET:;
      596     5432    1      B$JIT.ERR='0'B;
      597     5433    1      RETURN;
      598     5434    1   ENQERR:B$JIT.ERR=FAG$E$NOCODE|BINBIT(B$JIT.ERR.CODE*8,36);
      599     5435    1      ALTRETURN;
      600     5436    1   BUFERR:;
      601     5437    1      T$=BUF$;
      602     5438    1      O.ADR=POFFW(XTN$,BUF$);
      603     5439    1      O.SIZ=O.ADR+1;
      604     5440    1      X=POFFW(VXH$,BUF$);
      605     5441    1      CALL FMB$LOGERR(%E$GP,20,0,CDA,T$,O.ADR,O.SIZ,X,RXTN);
      606     5442    1      B$JIT.ERR=FAG$E$GP;
      607     5443    1      GOTO RETALT1;
      608     5444    1   FAGSCR:;
      609     5445    1      PINCRW(BUF$,FM$GRAN.FCEX)->VXH='0'B;
      610     5446    1      FM$GRAN.NAVX=FM$GRAN.FCEX;
      611     5447    1      CALL FMD$WRTSV(BUF#);
      612     5448    1      CALL SC_GPERR;
      613     5449                    /*S*     SCREECH_CODE: FAG-S$GPERR
      614     5450                    *        TYPE: SCREECH
      615     5451                    *        MESSAGE: Inconsistency in a free-extent list.
      616     5452                    */
      617     5453    1   RETALT0:;
      618     5454    1      CALL FMD$RELBUF(2);
      619     5455    1      CALL FMD$RELBUF(3);
      620     5456    1      GOTO RETALT1;
      621     5457    1   RELALT: RXTN=B$JIT.ERR; /* SAVE ERROR CODE */
      622     5458    1      CALL FAG$REXT(O); /* RETURN THE UNUSABLE EXTENT */
      623     5459    1      B$JIT.ERR=RXTN;
      624     5460    1   ALTFIT:;
      625     5461    1      BUF#=0;
      626     5462    1      B$JIT.ERR=FAG$E$NOCODE|BINBIT(B$JIT.ERR.CODE*8,36);
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:23   
      627     5463    1   RETALT1:;
      628     5464    1      IF ENT#>3 AND B$JIT.ERR.FCG='0601'O THEN B$JIT.ERR='0'B;
      629     5465    1      IF ENT#=2 THEN B$JIT.ERR=FAG$E$PSGRANS;
      630     5466    1      IF BUF#=0 THEN ALTRETURN; /* NO BUF OR ENQ CLEANUP */
      631     5467    1      CALL FMD$RELBUF(BUF#);
      632     5468    1      CALL DEQUEUE;
      633     5469    1      ALTRETURN;
      634     5470    1   FAGE$PSGRANS: B$JIT.ERR=FAG$E$PSGRANS;
      635     5471    1      GOTO RETALT1;
      636     5472    1   FAGE$USGRANS: B$JIT.ERR=FAG$E$USGRANS;
      637     5473    1      ALTRETURN;
      638     5474    1   FAGE$ACGRANS: B$JIT.ERR=FAG$E$ACGRANS;
      639     5475    1      CALL FMR$U8;
      640     5476    1      ALTRETURN;
      641     5477        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:24   
      642     5478    1   GOTONE: O.ADR=XBUF.ADR+SRDZERO;
      643     5479    1      IF XBUF.ADR>=XBUF.EADR THEN GOTO FAGSCR;
      644     5480    1      IF SIZE=0 THEN CALL SQZ;
      645     5481    1      ELSE XBUF.ADR=XBUF.ADR+O.SIZ;
      646     5482    1      FM$VOL.RGRANS=FM$VOL.RGRANS-O.SIZ;
      647     5483    1      IF PINCRW(VXH$,VXH.XTNS-1)->ABUF='0'B THEN CALL SC_GPERR;
      648     5484    1      CALL FMD$WRTBUF(BUF#);
      649     5485    1      CALL DEQUEUE;
      650     5486    2      IF ENT#=1 THEN DO;
      651     5487    2         PARM.P1=O.ADR;
      652     5488    2         RETURN;
      653     5489    2         END;
      654     5490    1      VXH$N=F$DCB.GTYP;
      655     5491    1      CALL FMO$XTNTOFIT(O) ALTRET(RELALT);
      656     5492    1      F$DCB.GTYP=VXH$N;
      657     5493    1      F$DCB.BORROW=F$DCB.BORROW-O.SIZ;
      658     5494    2      IF F$DCB.BORROW<0 THEN DO;
      659     5495    2         IF -O.SIZ<F$DCB.BORROW THEN O.SIZ=-F$DCB.BORROW;
      660     5496    3         IF CFU$=ADDR(NIL) THEN DO;
      661     5497    4            IF NOT F$DCB.STARX=4 AND NOT (F$DCB.STARX=3 AND F$DCB.NRECS=0) THEN DO;
      662     5498    4               CALL FMR$UPDGAC(B$JIT.TMPGAC,B$JIT.CURTMPDP);
      663     5499    4               B$JIT.CURTMPDP=B$JIT.CURTMPDP+O.SIZ;
      664     5500    4               IF B$JIT.CURTMPDP>B$JIT.STMPDPPK THEN B$JIT.STMPDPPK=B$JIT.CURTMPDP;
      665     5501    4               END;
      666     5502    3            END;
      667     5503    3         ELSE DO;
      668     5504    3            CALL FMR$L8;
      669     5505    3            FM$CFUA.GRANS=FM$CFUA.GRANS-O.SIZ;
      670     5506    3            FM$CFUA.GMOD=1;
      671     5507    3            IF F$DCB.WSR~=1 AND NOT B$JIT.PRIV.ACTIVE.FMEFT
      672     5508    3              AND ADDR(CFU$)->XBUF.ADR~=FM_SYSACCTX
      673     5509    3            THEN B$JIT.PRDPRM=B$JIT.PRDPRM-O.SIZ;
      674     5510    3            CALL FMR$U8;
      675     5511    3            END;
      676     5512    2         END;
      677     5513    2      IF Y>0 THEN DO;
      678     5514    2         O.SIZ=Y;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:25   
      679     5515    2         CFU$=F$DCB.CFU$;
      680     5516    2         IF FM$CFU.FITSDA=0 THEN FM$CFU.FITSDA=O.ADR;
      681     5517    2         GOTO GEXT0;
      682     5518    2         END;
      683     5519    1      IF CFU$~=ADDR(NIL) THEN /* NO WRITE IF STAR, SCRATCH, OR CREATE */
      684     5520    1         IF MOD(F$DCB.CFU$->FM$CFU.FUN,4)~=%CREATE# THEN
      685     5521    1            IF F$DCB.BFR.BUFX(4)~=0 THEN CALL FMD$WRTSV(4);
      686     5522    1            ELSE CALL FMD$WRTSV(1);
      687     5523    1      RETURN;
      688     5524        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:26   
      689     5525    1   ADJ_REQ: PROC ALTRET;
      690     5526                    /*I*      NAME: ADJ_REQ
      691     5527                    *         PURPOSE: Adjust the user request if it exceeds his limits.
      692     5528                    *         DESCRIPTION: If the request would exceed his limit and it is
      693     5529                    *         for more than 2 granules and it is not a "random" type,
      694     5530                    *         cut the request by a factor of 2. This subroutine altreturns
      695     5531                    *         if any of the above requirements is not met (except the first,
      696     5532                    *         which is to be tested externally).
      697     5533                    *         CALL: DO WHILE(user request would exceed limit);
      698     5534                    *                  CALL ADJ_REQ ALTRET(place to report error);
      699     5535                    *                  END;
      700     5536                    *         O.SIZ is the user request, X is same, modified for DCB.BORROW
      701     5537                    */
      702     5538    2      IF O.SIZ<2 OR ENT#=3 THEN ALTRETURN;
      703     5539    2      X=X-O.SIZ+O.SIZ/2;
      704     5540    2      O.SIZ=O.SIZ/2;
      705     5541    2      RETURN;
      706     5542    2   END ADJ_REQ;
      707     5543        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:27   
      708     5544    1   SQZ: PROC ALTRET;
      709     5545                    /*I*     NAME: SQZ
      710     5546                              PURPOSE: Removes a word from the free extent pool.
      711     5547                              DESCRIPTION: Uses FMR$SLIDE to pack remaining active
      712     5548                     buffer space from XTN$ to NAVX. Updates NAVX, AVAIL, and VXH.XTNS.
      713     5549                    */
      714     5550    2      FM$GRAN.NAVX=FM$GRAN.NAVX-1;
      715     5551    2      X=FM$GRAN.NAVX-POFFW(XTN$,BUF$);
      716     5552    2      T$=XTN$;
      717     5553    2      CALL FMR$SLIDE(T$,-1,X);
      718     5554    2      FM$GRAN.AVAIL=FM$GRAN.AVAIL+1;
      719     5555    2      VXH.XTNS=VXH.XTNS-1;
      720     5556    2      RETURN;
      721     5557        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:28   
      722     5558    2   GETVOL: ENTRY ALTRET;
      723     5559                    /*I*     NAME: GETVOL
      724     5560                    *        PURPOSE: PRODUCES A VOLUME# IN VOL# (AUTO VAR) CORRESPONDING TO
      725     5561                    *        THE SET-RELATIVE DISCCADDRESS IN SIZE (AUTO VAR). SETS RXTN.ADR
      726     5562                    *        (REDEF OF SIZE) TO DEVICE RELATIVE ADDRESS OF SIZE.
      727     5563                    */
      728     5564    2      IF SIZE<FM_SRZERO THEN ALTRETURN; /* BAD INPUT */
      729     5565    2      Y=FM_SRZERO;
      730     5566    2      VOL#=0;
      731     5567    2      SRDZERO=FM_SRZERO;
      732     5568    2      SDCT$=ADDR(FM$SET(FM$SET.DCTX(F$DCB.SETX)));
      733     5569    3      DO WHILE(SDCT$~=FM$SET$);
      734     5570    3         VOL#=VOL#+1;
      735     5571    3         SIZE=SIZE-Y;
      736     5572    3         Y=FM$VOL.NXTSDA-FM_SRZERO;
      737     5573    4         IF SIZE<Y THEN DO;
      738     5574    4            OVOL=SRDZERO;
      739     5575    4            RXTN.ADR=SIZE;
      740     5576    4            RETURN;
      741     5577    4            END;
      742     5578    3         SRDZERO=SRDZERO+Y;
      743     5579    3         SDCT$=ADDR(FM$SET(FM$VOL.VOLL));
      744     5580    3         END;
      745     5581    2      ALTRETURN;
      746     5582    2   END SQZ;
      747     5583    1   END FAG$;

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:29   
--  Include file information  --

   F_ERRORS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   AZ_MACRO_C.:E05TOU  is referenced.
   AZ_SUBS_C.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM_CACHE_C.:E05TOU  is referenced.
   FM_CACHE_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FAG$.

   Procedure FAG$ requires 1944 words for executable code.
   Procedure FAG$ requires 36 words of local(AUTO) storage.

    No errors detected in file FAG$GEXT.:E05TSI    .

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:30   

 Object Unit name= FAG$                                       File name= FAG$GEXT.:E05TOU
 UTS= JUL 29 '97 15:23:38.24 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     1      1  FAG$
    1  RoData even  UTS      5      5  FAG$
    2   Proc  even  none  1944   3630  FAG$
    3  RoData even  none    25     31  FAG$

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  FAG$
     2      3          yes     yes      Std        1  FAG$GAFIT
     2     12          yes     yes      Std        1  FAG$G1DIR
     2     25          yes     yes      Std        0  FAG$CGRANS
     2     51          yes     yes      Std        1  FAG$COUNT
     2    113          yes     yes      Std        1  FAG$REXT
     2    160          yes     yes      Std        1  FAG$RFILE
     2    704          yes     yes      Std        0  FAG$GEXT

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  FA_SCATTER
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:31   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMC$CLR1EXT
 yes     yes           Std       2 FMN$READFIT
         yes           Std       1 FMD$FLSHBUF
         yes           Std       1 FMD$WRTSV
         yes           Std       2 FMR$UPDGAC
         yes           Std       2 FMR$ADDGAC
         yes           Std       1 FMD$RELBUF
 yes     yes           Std       2 FMO$LOCCODP
 yes     yes           Std       2 FMO$LOCCODX
 yes     yes           Std       6 ELA$SYSLOG
         yes           Std      11 FMB$LOGERR
         yes           Std       1 FMD$WRTBUF
 yes     yes           Std       1 UQB$MDEQ
         yes           Std       3 FMD$GETBUF
         yes           Std       1 FMC$CLRFILE
         yes           Std       0 FMR$L8
         yes           Std       3 FMR$SLIDE
 yes     yes           Std       1 UQB$MENQX
 yes     yes           Std       1 FMO$XTNTOFIT
         yes           Std       0 FMR$U8
 yes     yes           Std       6 FMD$REDBUF
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:32   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_GPERR                              FMC_CACHE$                            FMC_CACHEPGCNT$
     B$JIT$                                F$CFU$                                FM_SRZERO
     FM_GPSDA                              FM_SYSACCTX                           FM$BUF$
     FM$SET$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:33   


        1        1        /*M*     FAG - Manipulate data in a packset's free extent pool.*/
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NSO,MCL=0,MOC,MEC,CLM=12,EXM=12,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9        FAG$: PROC(PARM) ALTRET;

      9  2 000000   000000 700200 xent  FAG$         TSX0  ! X66_AUTO_1
         2 000001   000044 000001                    ZERO    36,1
         2 000002   000005 710000 2                  TRA     s:4989

       10       10        %INCLUDE B$JIT_C;
       11      324        %B$JIT0;
       12      413        %U$JIT1X;
       13      416        %M$JIT2X;
       14      419        %F$JIT3;
       15      424        %S$JIT4;
       16      430        %J$JIT5X;
       17      433        %A$JIT6X;
       18      436        %INCLUDE FM$MACROS;
       19      811        %FM$GRAN(BASED="BASED(BUF$)");
       20      815        %FM$CFU(BASED="BASED(CFU$)");
       21      821        %FM$CFUF(BASED="BASED(CFU$)");
       22      824        %FM$FIT(BASED="BASED(FIT$)");
       23      827        %INCLUDE FM_CACHE_R;
       24      839        %INCLUDE FM_CACHE_C;
       25      905        %FMC$CACHE;
       26      928        %INCLUDE CP_6_SUBS;
       27     1468        %INCLUDE EL_SUBS_C;
       28     1552        %INCLUDE AZ_SUBS_C;
       29     1621        %INCLUDE AZ_MACRO_C;
       30     4208        %PGRANS(STCLASS="BASED(XTN$)");
       31     4274        %CODE04(BASED="BASED(CFU$)");
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:34   
       32     4282        %CODE03(BASED="BASED(SDCT$)");
       33     4289        %INCLUDE NI$TABLES;
       34     4505        %FM$SET(BASED="BASED(FM$SET$)");
       35     4510        %FM$VOL(ARY=,BASED="BASED(SDCT$)");
       36     4516        %FM$CFUA(BASED="BASED(CFU$)");
       37     4522        %MACRO F$DCB#(BASED=BASED);
       38     4523        %INCLUDE F$DCB;
       39     4572        %MEND;
       40     4573        %INCLUDE F_ERRORS_C;
       41     4813        %SUB FCG#='0601'O;
       42     4814        %SUB MID#='07'O;
       43     4815        %F$DCB#(BASED="BASED(DCB$)");
       44     4865                    /* SYMREFS */
       45     4866    1   DCL B$JIT$ PTR SYMREF;
       46     4867    1   DCL F$CFU$ PTR SYMREF;
       47     4868    1   DCL FM_SRZERO SBIN SYMREF;
       48     4869    1   DCL FM_GPSDA SBIN SYMREF;
       49     4870    1   DCL FM_SYSACCTX SBIN SYMREF;
       50     4871    1   DCL FM$BUF$(0:0)SYMREF PTR;
       51     4872    1   DCL FA_SCATTER STATIC SYMDEF BIT(36)INIT('0'B);
       52     4873    1   DCL FM$SET$ PTR SYMREF;
       53     4874                    /* ENTREFS */
       54     4875    1   DCL FMB$LOGERR ENTRY(11); /* Log dual allocation */
       55     4876    1   DCL FMR$L8 ENTRY;
       56     4877    1   DCL FMR$U8 ENTRY;
       57     4878    1   DCL FMR$SLIDE ENTRY(3);
       58     4879    1   DCL FMN$READFIT ENTRY(2)ALTRET;
       59     4880    1   DCL FMD$WRTSV ENTRY(1);
       60     4881    1   DCL FMD$FLSHBUF ENTRY(1);
       61     4882    1   DCL FMD$GETBUF ENTRY(3);
       62     4883    1   DCL FMO$XTNTOFIT ENTRY(1) ALTRET;
       63     4884    1   DCL FMO$LOCCODX ENTRY(2)ALTRET;
       64     4885    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
       65     4886    1   DCL FMD$REDBUF ENTRY(6) ALTRET;
       66     4887    1   DCL UQB$MENQX ENTRY(1) ALTRET;
       67     4888    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
       68     4889        %SUB ENQUEUE="UQB$MENQX(PINCRW(ADDR(FM$SET(F$DCB.SETX)),6))";
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:35   
       69     4890        %SUB DEQUEUE="UQB$MDEQ(PINCRW(ADDR(FM$SET(F$DCB.SETX)),6))";
       70     4891    1   DCL FMD$WRTBUF ENTRY(1);
       71     4892    1   DCL FMD$RELBUF ENTRY(1);
       72     4893    1   DCL FMR$ADDGAC ENTRY(2);
       73     4894    1   DCL FMR$UPDGAC ENTRY(2);
       74     4895    1   DCL ELA$SYSLOG ENTRY(6)ALTRET;
       75     4896    1   DCL FMC$CLRFILE ENTRY(1);
       76     4897    1   DCL FMC$CLR1EXT ENTRY(1);
       77     4898    1   DCL SC_GPERR ENTRY CONV(2,0);
       78     4899        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:36   
       79     4900                    /* BASED CONSTRUCTS */
       80     4901    1   DCL 1 ABUF BASED(XTN$) ALIGNED,
       81     4902    1         2 SIZ UBIN(9) UNAL,
       82     4903    1         2 ADR UBIN(27) UNAL;
       83     4904    1   DCL 1 BBUF BASED(XTN$) ALIGNED,
       84     4905    1         2 ADR SBIN,
       85     4906    1         2 SIZ SBIN;
       86     4907    1   DCL 1 XBUF BASED(XTN$) ALIGNED,
       87     4908    1         2 ADR UBIN(18) UNAL,
       88     4909    1         2 EADR UBIN(18) UNAL,
       89     4910    1         2 ADR1 UBIN(18) UNAL,
       90     4911    1         2 EADR1 UBIN(18) UNAL;
       91     4912    1   DCL 1 VXH BASED(VXH$) ALIGNED,
       92     4913    1         2 VOL UBIN(9) UNAL,
       93     4914    1         2 N BIT(1),
       94     4915                    /* IF SET, NEXT GRAN HAS MORE FOR THIS VOL */
       95     4916    1         2 P BIT(1),
       96     4917                    /* IF SET, PREV GRAN HAS MORE FOR THIS GRANULE */
       97     4918    1         2 * BIT(7),
       98     4919    1         2 XTNS UBIN(18) UNAL ;
       99     4920    1   DCL GRANULE BASED CHAR(4096);
      100     4921        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:37   
      101     4922                    /* AUTO STORAGE */
      102     4923    1   DCL T$ PTR; /* TEMP POINTER FOR CALLS - TO IMPROVE PL6'S MEMORY */
      103     4924    1   DCL XTN$ PTR;
      104     4925    1   DCL VXH$ PTR;
      105     4926    1   DCL VXH$N REDEF VXH$ UBIN;
      106     4927    1   DCL SDCT$ PTR;
      107     4928    1   DCL SIZE SBIN;
      108     4929    1   DCL 1 RXTN REDEF SIZE,
      109     4930    1         2 ADR UBIN(18) UNAL,
      110     4931    1         2 EADR UBIN(18) UNAL;
      111     4932    1   DCL 1 O,
      112     4933    1         2 ADR SBIN,
      113     4934    1         2 SIZ UBIN;
      114     4935    1   DCL 1 OS REDEF O,
      115     4936    1         2 SIZ UBIN(9) UNAL,
      116     4937    1         2 * BIT(27),
      117     4938    1         2 SIZ2 SBIN;
      118     4939    1   DCL BUF# SBIN;
      119     4940    1   DCL ENT# SBIN;
      120     4941    1   DCL VOL# SBIN; /* CURRENT VOLUME NUMBER IN SET */
      121     4942    1   DCL OVOL UBIN; /* SRDZERO OF VOL WITH MOST SPACE */
      122     4943    1   DCL SRDZERO SBIN; /* SETREL DEVICE ZERO */
      123     4944    1   DCL X SBIN;
      124     4945    1   DCL XU REDEF X UBIN;
      125     4946    1   DCL Y SBIN;
      126     4947    1   DCL CDA SBIN;
      127     4948    1   DCL BUF$ PTR;
      128     4949    1   DCL DCB$ PTR;
      129     4950    1   DCL CFU$ PTR;
      130     4951    1   DCL FIT$ PTR;
      131     4952                    /* PARMETER(S) */
      132     4953    1   DCL 1 PARM,
      133     4954    1         2 P1 SBIN,
      134     4955    1         2 P2 SBIN;
      135     4956    1   DCL 1 INXTN REDEF PARM,
      136     4957    1         2 SIZ UBIN(9) UNAL,
      137     4958    1         2 ADR UBIN(27) UNAL,
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:38   
      138     4959    1         2 SIZ2 SBIN;
      139     4960        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:39   
      140     4961                    /* STATIC/CONSTANT DATA */
      141     4962        %ERRCODE(NAME=FAG$E$ACGRANS,COD#=%E$ACGRANS);
      142     4966        %ERRCODE(NAME=FAG$E$USGRANS,COD#=%E$USGRANS);
      143     4970        %ERRCODE(NAME=FAG$E$PSGRANS,COD#=%E$PSGRANS);
      144     4974        %ERRCODE(NAME=FAG$E$GP,COD#=%E$GP);
      145     4978        %ERRCODE(NAME=FAG$E$NOCODE,COD#=0);
      146     4982        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:40   
      147     4983    1   FAG$GAFIT: ENTRY(PARM) ALTRET;

   4983  2 000003   000000 700200 xent  FAG$GAFIT    TSX0  ! X66_AUTO_1
         2 000004   000044 000001                    ZERO    36,1

      148     4984                    /*F*     NAME: FAG$GAFIT
      149     4985                    *        PURPOSE: Allocate an AFIT granule.
      150     4986                    *        DESCRIPTION: Uses FAG$GEXT logic as in G1DIR, but ensures
      151     4987                    *        that the granule is on the same volume as the file.
      152     4988                    */
      153     4989    1      CFU$=B$JIT.DCB$->F$DCB.CFU$;

   4989  2 000005   000000 470400 xsym               LDP0    B$JIT$
         2 000006   000232 471500                    LDP1    154,,PR0
         2 000007   100066 236100                    LDQ     54,,PR1
         2 000010   200025 756100                    STQ     CFU$,,AUTO

      154     4990    1      GOTO G1COMMON;

   4990  2 000011   000016 710000 2                  TRA     G1COMMON

      155     4991                    /**/
      156     4992    1   FAG$G1DIR: ENTRY(PARM) ALTRET;

   4992  2 000012   000000 700200 xent  FAG$G1DIR    TSX0  ! X66_AUTO_1
         2 000013   000044 000001                    ZERO    36,1

      157     4993                    /*F*     NAME: FAG$G1DIR
      158     4994                         PURPOSE: Allocates a single granule for directory purposes.
      159     4995                     DESCRIPTION: Uses FAG$GEXT logic with a one-granule request,
      160     4996                     storing the result in the single parameter.*/
      161     4997    1      CFU$=ADDR(FA_SCATTER);

   4997  2 000014   000000 236000 3                  LDQ     0
         2 000015   200025 756100                    STQ     CFU$,,AUTO

   4997  2 000016                       G1COMMON     null
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:41   
      162     4998    1   G1COMMON:;
      163     4999    1      ENT#=1;

   4999  2 000016   000001 235007                    LDA     1,DL
         2 000017   200014 755100                    STA     ENT#,,AUTO

      164     5000    1      DCB$=B$JIT.DCB$;

   5000  2 000020   000000 470400 xsym               LDP0    B$JIT$
         2 000021   000232 236100                    LDQ     154,,PR0
         2 000022   200024 756100                    STQ     DCB$,,AUTO

      165     5001    1      O.SIZ=1;

   5001  2 000023   200012 755100                    STA     O+1,,AUTO

      166     5002    1      GOTO GEXT0;

   5002  2 000024   000756 710000 2                  TRA     GEXT0

      167     5003        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:42   
      168     5004    1   FAG$CGRANS: ENTRY ALTRET;

   5004  2 000025   000000 700200 xent  FAG$CGRANS   TSX0  ! X66_AUTO_1
         2 000026   000044 000001                    ZERO    36,1

      169     5005                    /*F*     NAME: FAG$CGRANS
      170     5006                              PURPOSE: Inspects the free extent pool of the newly
      171     5007                        mounted packset and sets up FM$SET entries for its volumes.
      172     5008                        DESCRIPTION: Altrets if a reconstruct is required.
      173     5009                    */
      174     5010    1      ENT#=2;

   5010  2 000027   000002 235007                    LDA     2,DL
         2 000030   200014 755100                    STA     ENT#,,AUTO

      175     5011    1      SIZE=FM_SRZERO;

   5011  2 000031   000000 236000 xsym               LDQ     FM_SRZERO
         2 000032   200010 756100                    STQ     SIZE,,AUTO

      176     5012    1      DCB$=B$JIT.DCB$;

   5012  2 000033   000000 470400 xsym               LDP0    B$JIT$
         2 000034   000232 236100                    LDQ     154,,PR0
         2 000035   200024 756100                    STQ     DCB$,,AUTO

      177     5013    1      BUF#=0;

   5013  2 000036   200013 450100                    STZ     BUF#,,AUTO

      178     5014    1      CALL GETVOL;

   5014  2 000037   003545 701000 2                  TSX1    GETVOL
         2 000040   000000 011000                    NOP     0

      179     5015    1      CDA=FM_GPSDA;

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:43   
   5015  2 000041   000000 235000 xsym               LDA     FM_GPSDA
         2 000042   200022 755100                    STA     CDA,,AUTO

      180     5016    1   CGRANS0: FM$VOL.GPSDA=CDA;

   5016  2 000043   200022 235100       CGRANS0      LDA     CDA,,AUTO
         2 000044   200007 470500                    LDP0    SDCT$,,AUTO
         2 000045   000007 755100                    STA     7,,PR0

      181     5017    1      O.SIZ=1;

   5017  2 000046   000001 236007                    LDQ     1,DL
         2 000047   200012 756100                    STQ     O+1,,AUTO

      182     5018    1      GOTO GNEXT;

   5018  2 000050   001237 710000 2                  TRA     GNEXT

      183     5019
      184     5020    1   FAG$COUNT: ENTRY(PARM) ALTRET;

   5020  2 000051   000000 700200 xent  FAG$COUNT    TSX0  ! X66_AUTO_1
         2 000052   000044 000001                    ZERO    36,1

      185     5021                    /*F*     NAME: FAG$COUNT
      186     5022                    *        PURPOSE: Adds up the remaining granules on the volumes
      187     5023                    *        of the set pointed to by B$JIT.DCB$->F$DCB.SETX,
      188     5024                    *        returning the total in the parameter.
      189     5025                    */
      190     5026    1      PARM.P1=0;

   5026  2 000053   200003 470500                    LDP0    @PARM,,AUTO
         2 000054   000000 450100                    STZ     0,,PR0

      191     5027    1      DCB$=B$JIT.DCB$;

   5027  2 000055   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:44   
         2 000056   100232 236100                    LDQ     154,,PR1
         2 000057   200024 756100                    STQ     DCB$,,AUTO

      192     5028    1      SDCT$=ADDR(FM$SET(FM$SET.DCTX(F$DCB.SETX)));

   5028  2 000060   200024 473500                    LDP3    DCB$,,AUTO
         2 000061   300051 236100                    LDQ     41,,PR3
         2 000062   000003 736000                    QLS     3
         2 000063   000001 376000 3                  ANQ     1
         2 000064   000000 474400 xsym               LDP4    FM$SET$
         2 000065   400000 236106                    LDQ     0,QL,PR4
         2 000066   000017 772000                    QRL     15
         2 000067   000001 376000 3                  ANQ     1
         2 000070   000022 736000                    QLS     18
         2 000071   000000 036000 xsym               ADLQ    FM$SET$
         2 000072   200007 756100                    STQ     SDCT$,,AUTO

      193     5029    2      DO WHILE(SDCT$~=FM$SET$);

   5029  2 000073   000000 116000 xsym               CMPQ    FM$SET$
         2 000074   000112 600000 2                  TZE     s:5033

      194     5030    2         PARM.P1=PARM.P1+FM$VOL.RGRANS;

   5030  2 000075   200003 470500                    LDP0    @PARM,,AUTO
         2 000076   200007 471500                    LDP1    SDCT$,,AUTO
         2 000077   000000 236100                    LDQ     0,,PR0
         2 000100   100006 036100                    ADLQ    6,,PR1
         2 000101   000000 756100                    STQ     0,,PR0

      195     5031    2         SDCT$=ADDR(FM$SET(FM$VOL.VOLL));

   5031  2 000102   100005 236100                    LDQ     5,,PR1
         2 000103   000017 772000                    QRL     15
         2 000104   000001 376000 3                  ANQ     1
         2 000105   000022 736000                    QLS     18
         2 000106   000000 036000 xsym               ADLQ    FM$SET$
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:45   
         2 000107   200007 756100                    STQ     SDCT$,,AUTO

      196     5032    2         END;

   5032  2 000110   000000 116000 xsym               CMPQ    FM$SET$
         2 000111   000075 601000 2                  TNZ     s:5030

      197     5033    1      RETURN;  /* Pretty dumb, really */

   5033  2 000112   000000 702200 xent               TSX2  ! X66_ARET

      198     5034        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:46   
      199     5035    1   FAG$REXT: ENTRY (PARM) ALTRET;

   5035  2 000113   000000 700200 xent  FAG$REXT     TSX0  ! X66_AUTO_1
         2 000114   000044 000001                    ZERO    36,1

      200     5036                    /*F*     NAME:FAG$REXT
      201     5037                              PURPOSE: Returns an extent to the free extent pool.
      202     5038                        DESCRIPTION: The single parameter is a one-or-two-word extent
      203     5039                        which is merged into the free extent pool. */
      204     5040    1      ENT#=4;

   5040  2 000115   000004 235007                    LDA     4,DL
         2 000116   200014 755100                    STA     ENT#,,AUTO

      205     5041    1      CALL FMC$CLR1EXT(PARM);

   5041  2 000117   200003 630500                    EPPR0   @PARM,,AUTO
         2 000120   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000121   000000 701000 xent               TSX1    FMC$CLR1EXT
         2 000122   000000 011000                    NOP     0

      206     5042    1      DCB$=B$JIT.DCB$;

   5042  2 000123   000000 470400 xsym               LDP0    B$JIT$
         2 000124   000232 236100                    LDQ     154,,PR0
         2 000125   200024 756100                    STQ     DCB$,,AUTO

      207     5043    1      SIZE=INXTN.ADR;

   5043  2 000126   200003 471500                    LDP1    @PARM,,AUTO
         2 000127   100000 236100                    LDQ     0,,PR1
         2 000130   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000131   200010 756100                    STQ     SIZE,,AUTO

      208     5044    1      BUF#=0;

   5044  2 000132   200013 450100                    STZ     BUF#,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:47   

      209     5045    1      CALL GETVOL ALTRET(BADXTN);

   5045  2 000133   003545 701000 2                  TSX1    GETVOL
         2 000134   000662 702000 2                  TSX2    BADXTN

      210     5046    1      IF INXTN.SIZ~=0 THEN RXTN.EADR=RXTN.ADR+INXTN.SIZ;

   5046  2 000135   200003 470500                    LDP0    @PARM,,AUTO
         2 000136   000000 236100                    LDQ     0,,PR0
         2 000137   777000 316003                    CANQ    -512,DU
         2 000140   000152 600000 2                  TZE     s:5047

   5046  2 000141   000000 236100                    LDQ     0,,PR0
         2 000142   000033 772000                    QRL     27
         2 000143   200032 756100                    STQ     FIT$+4,,AUTO
         2 000144   200010 236100                    LDQ     SIZE,,AUTO
         2 000145   000022 772000                    QRL     18
         2 000146   200032 036100                    ADLQ    FIT$+4,,AUTO
         2 000147   000000 620006                    EAX0    0,QL
         2 000150   200010 440100                    SXL0    SIZE,,AUTO
         2 000151   000157 710000 2                  TRA     s:5048

      211     5047    1      ELSE RXTN.EADR=RXTN.ADR+INXTN.SIZ2;

   5047  2 000152   200010 236100                    LDQ     SIZE,,AUTO
         2 000153   000022 772000                    QRL     18
         2 000154   000001 036100                    ADLQ    1,,PR0
         2 000155   000000 620006                    EAX0    0,QL
         2 000156   200010 440100                    SXL0    SIZE,,AUTO

      212     5048    1      GOTO R1EXT;

   5048  2 000157   000656 710000 2                  TRA     R1EXT

      213     5049        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:48   
      214     5050    1   FAG$RFILE: ENTRY(PARM) ALTRET;

   5050  2 000160   000000 700200 xent  FAG$RFILE    TSX0  ! X66_AUTO_1
         2 000161   000044 000001                    ZERO    36,1

      215     5051                    /*F*     NAME: FAG$RFILE
      216     5052                        PURPOSE: Releases the extents occupied by a file by reading its
      217     5053                        FIT (whose SDA is the single parameter).
      218     5054                    */
      219     5055    1      ENT#=5;

   5055  2 000162   000005 235007                    LDA     5,DL
         2 000163   200014 755100                    STA     ENT#,,AUTO

      220     5056    1      BUF#=0;

   5056  2 000164   200013 450100                    STZ     BUF#,,AUTO

      221     5057    1      DCB$=B$JIT.DCB$;

   5057  2 000165   000000 470400 xsym               LDP0    B$JIT$
         2 000166   000232 236100                    LDQ     154,,PR0
         2 000167   200024 756100                    STQ     DCB$,,AUTO

      222     5058    1      CALL FMN$READFIT(T$,PARM)ALTRET(ALTFIT);

   5058  2 000170   200003 236100                    LDQ     @PARM,,AUTO
         2 000171   200033 756100                    STQ     FIT$+5,,AUTO
         2 000172   200004 631500                    EPPR1   T$,,AUTO
         2 000173   200032 451500                    STP1    FIT$+4,,AUTO
         2 000174   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 000175   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000176   000000 701000 xent               TSX1    FMN$READFIT
         2 000177   003076 702000 2                  TSX2    ALTFIT

      223     5059    1      BUF$=T$;

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:49   
   5059  2 000200   200004 236100                    LDQ     T$,,AUTO
         2 000201   200023 756100                    STQ     BUF$,,AUTO

      224     5060    1      FIT$=PINCRW(BUF$,SIZEW(FM$GRAN));

   5060  2 000202   000005 036003                    ADLQ    5,DU
         2 000203   200026 756100                    STQ     FIT$,,AUTO

      225     5061    1      FM$FIT.CODES.CODE(1)=0; /* CLOBBER THE FIT */

   5061  2 000204   200026 470500                    LDP0    FIT$,,AUTO
         2 000205   000002 236000 3                  LDQ     2
         2 000206   000001 356100                    ANSQ    1,,PR0

      226     5062    1      IF F$DCB.BFR.BUFX(0) ~= 0 THEN CALL FMD$FLSHBUF(0);

   5062  2 000207   200024 471500                    LDP1    DCB$,,AUTO
         2 000210   100115 236100                    LDQ     77,,PR1
         2 000211   037000 316003                    CANQ    15872,DU
         2 000212   000217 600000 2                  TZE     s:5063

   5062  2 000213   000003 630400 3                  EPPR0   3
         2 000214   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000215   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 000216   000000 011000                    NOP     0

      227     5063    1      IF F$DCB.BFR.BUFX(2)~=0 THEN CALL FMD$FLSHBUF(2);

   5063  2 000217   200024 470500                    LDP0    DCB$,,AUTO
         2 000220   000117 236100                    LDQ     79,,PR0
         2 000221   037000 316003                    CANQ    15872,DU
         2 000222   000227 600000 2                  TZE     s:5064

   5063  2 000223   000004 630400 3                  EPPR0   4
         2 000224   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000225   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 000226   000000 011000                    NOP     0
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:50   

      228     5064    1      IF F$DCB.BFR.BUFX(3)~=0 THEN CALL FMD$FLSHBUF(3);

   5064  2 000227   200024 470500                    LDP0    DCB$,,AUTO
         2 000230   000120 236100                    LDQ     80,,PR0
         2 000231   037000 316003                    CANQ    15872,DU
         2 000232   000237 600000 2                  TZE     s:5065

   5064  2 000233   000005 630400 3                  EPPR0   5
         2 000234   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000235   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 000236   000000 011000                    NOP     0

      229     5065    1      IF F$DCB.BFR.BUFX(4) ~= 0 THEN CALL FMD$FLSHBUF(4);

   5065  2 000237   200024 470500                    LDP0    DCB$,,AUTO
         2 000240   000121 236100                    LDQ     81,,PR0
         2 000241   037000 316003                    CANQ    15872,DU
         2 000242   000247 600000 2                  TZE     s:5066

   5065  2 000243   000006 630400 3                  EPPR0   6
         2 000244   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000245   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 000246   000000 011000                    NOP     0

      230     5066    1      CALL FMD$WRTSV(1);

   5066  2 000247   000007 630400 3                  EPPR0   7
         2 000250   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000251   000000 701000 xent               TSX1    FMD$WRTSV
         2 000252   000000 011000                    NOP     0

      231     5067    1      IF F$DCB.BFR1.CX(1) > 0 THEN

   5067  2 000253   200024 470500                    LDP0    DCB$,,AUTO
         2 000254   000123 720100                    LXL0    83,,PR0
         2 000255   000265 600000 2                  TZE     s:5070
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:51   

      232     5068    1         FMC$CACHETBL.FLAGS.ERR(F$DCB.BFR1.CX(1))='1'B;

   5068  2 000256   000123 236100                    LDQ     83,,PR0
         2 000257   777777 376007                    ANQ     -1,DL
         2 000260   000006 402007                    MPY     6,DL
         2 000261   000000 471400 xsym               LDP1    FMC_CACHE$
         2 000262   000000 621006                    EAX1    0,QL
         2 000263   000002 236007                    LDQ     2,DL
         2 000264   100004 256111                    ORSQ    4,X1,PR1

      233     5069                    /* Set the error flag so we don't save the FIT in the cache */
      234     5070    1      F$DCB.BFR.DA(1)=0; /* Zap diskaddr so we don't pick it up again */

   5070  2 000265   000000 236003                    LDQ     0,DU
         2 000266   000116 552134                    STBQ    78,'34'O,PR0

      235     5071    2      IF F$DCB.WSR~=1 AND NOT B$JIT.PRIV.ACTIVE.FMEFT THEN DO;

   5071  2 000267   000040 236100                    LDQ     32,,PR0
         2 000270   000777 376003                    ANQ     511,DU
         2 000271   000001 116003                    CMPQ    1,DU
         2 000272   000552 600000 2                  TZE     NOGAC
         2 000273   000000 471400 xsym               LDP1    B$JIT$
         2 000274   100013 234100                    SZN     11,,PR1
         2 000275   000552 604000 2                  TMI     NOGAC

      236     5072    2         T$=FIT$;

   5072  2 000276   200026 236100                    LDQ     FIT$,,AUTO
         2 000277   200004 756100                    STQ     T$,,AUTO

      237     5073    2         CALL FMO$LOCCODP(T$,4)ALTRET(NOGAC);

   5073  2 000300   000006 236000 3                  LDQ     6
         2 000301   200033 756100                    STQ     FIT$+5,,AUTO
         2 000302   200004 633500                    EPPR3   T$,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:52   
         2 000303   200032 453500                    STP3    FIT$+4,,AUTO
         2 000304   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 000305   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000306   000000 701000 xent               TSX1    FMO$LOCCODP
         2 000307   000552 702000 2                  TSX2    NOGAC

      238     5074    2         CFU$=T$;

   5074  2 000310   200004 236100                    LDQ     T$,,AUTO
         2 000311   200025 756100                    STQ     CFU$,,AUTO

      239     5075                    /* DO THE FINAL GRANULE ACCOUNTING FOR PERMANENT FILES */
      240     5076    2         T$=FIT$;

   5076  2 000312   200026 236100                    LDQ     FIT$,,AUTO
         2 000313   200004 756100                    STQ     T$,,AUTO

      241     5077    2         CALL FMO$LOCCODP(T$,3)ALTRET(NOGAC);

   5077  2 000314   000005 236000 3                  LDQ     5
         2 000315   200033 756100                    STQ     FIT$+5,,AUTO
         2 000316   200004 630500                    EPPR0   T$,,AUTO
         2 000317   200032 450500                    STP0    FIT$+4,,AUTO
         2 000320   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 000321   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000322   000000 701000 xent               TSX1    FMO$LOCCODP
         2 000323   000552 702000 2                  TSX2    NOGAC

      242     5078    2         SDCT$=T$;

   5078  2 000324   200004 236100                    LDQ     T$,,AUTO
         2 000325   200007 756100                    STQ     SDCT$,,AUTO

      243     5079    2         X=CODE03.UGRANS+CODE03.NGAVAL;

   5079  2 000326   200007 470500                    LDP0    SDCT$,,AUTO
         2 000327   000003 236100                    LDQ     3,,PR0
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:53   
         2 000330   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000331   200032 756100                    STQ     FIT$+4,,AUTO
         2 000332   000000 236100                    LDQ     0,,PR0
         2 000333   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000334   200032 036100                    ADLQ    FIT$+4,,AUTO
         2 000335   200020 756100                    STQ     X,,AUTO

      244     5080    3         IF CODE04.GAC.TIME<FM$SET.GACTIME(F$DCB.SETX) THEN DO;

   5080  2 000336   200024 471500                    LDP1    DCB$,,AUTO
         2 000337   100051 236100                    LDQ     41,,PR1
         2 000340   000003 736000                    QLS     3
         2 000341   000001 376000 3                  ANQ     1
         2 000342   200025 473500                    LDP3    CFU$,,AUTO
         2 000343   000000 474400 xsym               LDP4    FM$SET$
         2 000344   000000 620006                    EAX0    0,QL
         2 000345   300012 236100                    LDQ     10,,PR3
         2 000346   400004 116110                    CMPQ    4,X0,PR4
         2 000347   000354 603000 2                  TRC     s:5084

      245     5081    3            CODE04.GAC.TIME=FM$SET.GACTIME(F$DCB.SETX);

   5081  2 000350   400004 235110                    LDA     4,X0,PR4
         2 000351   300012 755100                    STA     10,,PR3

      246     5082    3            CODE04.GAC.N=0;

   5082  2 000352   200025 473500                    LDP3    CFU$,,AUTO
         2 000353   300011 450100                    STZ     9,,PR3

      247     5083    3            END;

      248     5084    2         CALL FMR$UPDGAC(CODE04.GAC,X);

   5084  2 000354   200020 633500                    EPPR3   X,,AUTO
         2 000355   200033 453500                    STP3    FIT$+5,,AUTO
         2 000356   200025 236100                    LDQ     CFU$,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:54   
         2 000357   000011 036003                    ADLQ    9,DU
         2 000360   200032 756100                    STQ     FIT$+4,,AUTO
         2 000361   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 000362   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000363   000000 701000 xent               TSX1    FMR$UPDGAC
         2 000364   000000 011000                    NOP     0

      249     5085    2         OVOL=6;

   5085  2 000365   000006 235007                    LDA     6,DL
         2 000366   200016 755100                    STA     OVOL,,AUTO

      250     5086    2         T$=FIT$;

   5086  2 000367   200026 236100                    LDQ     FIT$,,AUTO
         2 000370   200004 756100                    STQ     T$,,AUTO

      251     5087    2         CALL FMO$LOCCODX(T$,OVOL);

   5087  2 000371   200016 630500                    EPPR0   OVOL,,AUTO
         2 000372   200033 450500                    STP0    FIT$+5,,AUTO
         2 000373   200004 631500                    EPPR1   T$,,AUTO
         2 000374   200032 451500                    STP1    FIT$+4,,AUTO
         2 000375   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 000376   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000377   000000 701000 xent               TSX1    FMO$LOCCODX
         2 000400   000000 011000                    NOP     0

      252     5088    2         IF FM$FIT.CODES.NDW(OVOL)~=0 THEN X=%AZ$GACSTOWACT;

   5088  2 000401   200026 470500                    LDP0    FIT$,,AUTO
         2 000402   200016 720100                    LXL0    OVOL,,AUTO
         2 000403   000000 236110                    LDQ     0,X0,PR0
         2 000404   000010 316000 3                  CANQ    8
         2 000405   000411 600000 2                  TZE     s:5089

   5088  2 000406   000002 235007                    LDA     2,DL
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:55   
         2 000407   200020 755100                    STA     X,,AUTO
         2 000410   000424 710000 2                  TRA     s:5091

      253     5089    2         ELSE IF F$DCB.BUPF AND CODE03.DESC.BUPM THEN X=%AZ$GACBACKUP;

   5089  2 000411   200024 471500                    LDP1    DCB$,,AUTO
         2 000412   100003 430100                    FSZN    3,,PR1
         2 000413   000422 605000 2                  TPL     s:5090
         2 000414   200007 473500                    LDP3    SDCT$,,AUTO
         2 000415   300001 236100                    LDQ     1,,PR3
         2 000416   000400 316003                    CANQ    256,DU
         2 000417   000422 600000 2                  TZE     s:5090

   5089  2 000420   200020 450100                    STZ     X,,AUTO
         2 000421   000424 710000 2                  TRA     s:5091

      254     5090    2            ELSE X=%AZ$GACNOBACKUP;

   5090  2 000422   000001 235007                    LDA     1,DL
         2 000423   200020 755100                    STA     X,,AUTO

      255     5091    2         IF CODE04.CREATOR.NAME=B$JIT.UNAME

   5091  2 000424   200025 471500                    LDP1    CFU$,,AUTO
         2 000425   000000 473400 xsym               LDP3    B$JIT$
         2 000426   040100 106500                    CMPC    fill='040'O
         2 000427   100005 000014                    ADSC9   5,,PR1                   cn=0,n=12
         2 000430   300003 000014                    ADSC9   3,,PR3                   cn=0,n=12
         2 000431   000466 601000 2                  TNZ     s:5098
         2 000432   040100 106500                    CMPC    fill='040'O
         2 000433   100003 000010                    ADSC9   3,,PR1                   cn=0,n=8
         2 000434   300001 000010                    ADSC9   1,,PR3                   cn=0,n=8
         2 000435   000466 601000 2                  TNZ     s:5098
         2 000436   200024 474500                    LDP4    DCB$,,AUTO
         2 000437   400051 236100                    LDQ     41,,PR4
         2 000440   000003 736000                    QLS     3
         2 000441   000001 376000 3                  ANQ     1
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:56   
         2 000442   000000 475400 xsym               LDP5    FM$SET$
         2 000443   500002 234106                    SZN     2,QL,PR5
         2 000444   000466 604000 2                  TMI     s:5098
         2 000445   040100 106500                    CMPC    fill='040'O
         2 000446   400020 000010                    ADSC9   16,,PR4                  cn=0,n=8
         2 000447   300001 000010                    ADSC9   1,,PR3                   cn=0,n=8
         2 000450   000466 601000 2                  TNZ     s:5098

      256     5092    2           AND CODE04.CREATOR.ACCT=B$JIT.ACCN
      257     5093    2           AND NOT FM$SET.XCL(F$DCB.SETX)
      258     5094    3           AND F$DCB.ACCT=B$JIT.ACCN THEN DO;

      259     5095    3            CALL FMR$ADDGAC(B$JIT.GAC(X),CODE04.GAC.N);

   5095  2 000451   200025 236100                    LDQ     CFU$,,AUTO
         2 000452   000011 036003                    ADLQ    9,DU
         2 000453   200033 756100                    STQ     FIT$+5,,AUTO
         2 000454   200020 236100                    LDQ     X,,AUTO
         2 000455   000022 736000                    QLS     18
         2 000456   000243 036003                    ADLQ    163,DU
         2 000457   000000 036000 xsym               ADLQ    B$JIT$
         2 000460   200032 756100                    STQ     FIT$+4,,AUTO
         2 000461   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 000462   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000463   000000 701000 xent               TSX1    FMR$ADDGAC
         2 000464   000000 011000                    NOP     0

      260     5096    3            END;

   5096  2 000465   000552 710000 2                  TRA     NOGAC

      261     5097    3         ELSE DO;

      262     5098    3            XTN$=PINCRW(FIT$,2);

   5098  2 000466   200026 236100                    LDQ     FIT$,,AUTO
         2 000467   000002 036003                    ADLQ    2,DU
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:57   
         2 000470   200005 756100                    STQ     XTN$,,AUTO

      263     5099    3            PGRANS='0'B;

   5099  2 000471   200005 474500                    LDP4    XTN$,,AUTO
         2 000472   000100 100400                    MLR     fill='000'O
         2 000473   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000474   400000 000100                    ADSC9   0,,PR4                   cn=0,n=64

      264     5100    3            PGRANS.CREATOR=CODE04.CREATOR;

   5100  2 000475   200025 471500                    LDP1    CFU$,,AUTO
         2 000476   000100 100500                    MLR     fill='000'O
         2 000477   100003 000024                    ADSC9   3,,PR1                   cn=0,n=20
         2 000500   400001 000024                    ADSC9   1,,PR4                   cn=0,n=20

      265     5101    3            PGRANS.PSN=FM$SET.PSN(F$DCB.SETX);

   5101  2 000501   200024 471500                    LDP1    DCB$,,AUTO
         2 000502   100051 236100                    LDQ     41,,PR1
         2 000503   000003 736000                    QLS     3
         2 000504   000001 376000 3                  ANQ     1
         2 000505   000002 736000                    QLS     2
         2 000506   000000 473400 xsym               LDP3    FM$SET$
         2 000507   040100 100506                    MLR     fill='040'O
         2 000510   300000 400006                    ADSC9   0,Q,PR3                  cn=2,n=6
         2 000511   400010 000006                    ADSC9   8,,PR4                   cn=0,n=6

      266     5102    3            IF FM$SET.XCL(F$DCB.SETX) THEN PGRANS.SHELF(X)=CODE04.GAC.N;

   5102  2 000512   100051 236100                    LDQ     41,,PR1
         2 000513   000003 736000                    QLS     3
         2 000514   000001 376000 3                  ANQ     1
         2 000515   300002 234106                    SZN     2,QL,PR3
         2 000516   000524 605000 2                  TPL     s:5103

   5102  2 000517   200025 475500                    LDP5    CFU$,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:58   
         2 000520   200020 720100                    LXL0    X,,AUTO
         2 000521   500011 235100                    LDA     9,,PR5
         2 000522   400012 755110                    STA     10,X0,PR4
         2 000523   000530 710000 2                  TRA     s:5104

      267     5103    3            ELSE PGRANS.ONLINE(X)=CODE04.GAC.N;

   5103  2 000524   200025 475500                    LDP5    CFU$,,AUTO
         2 000525   200020 720100                    LXL0    X,,AUTO
         2 000526   500011 235100                    LDA     9,,PR5
         2 000527   400015 755110                    STA     13,X0,PR4

      268     5104    3            PGRANS.CODE=%AZ$PGRANS;

   5104  2 000530   002000 236003                    LDQ     1024,DU
         2 000531   400000 552140                    STBQ    0,'40'O,PR4

      269     5105    3            PGRANS.FMACCT=F$DCB.ACCT;

   5105  2 000532   100020 237100                    LDAQ    16,,PR1
         2 000533   400006 755100                    STA     6,,PR4
         2 000534   400007 756100                    STQ     7,,PR4

      270     5106    3            CALL ELA$SYSLOG(EL_ACCTLG,PGRANS,SIZEW(PGRANS),0,2,X);

   5106  2 000535   200020 633500                    EPPR3   X,,AUTO
         2 000536   200037 453500                    STP3    FIT$+9,,AUTO
         2 000537   000004 236000 3                  LDQ     4
         2 000540   200036 756100                    STQ     FIT$+8,,AUTO
         2 000541   000012 237000 3                  LDAQ    10
         2 000542   200034 757100                    STAQ    FIT$+6,,AUTO
         2 000543   200005 236100                    LDQ     XTN$,,AUTO
         2 000544   000014 235000 3                  LDA     12
         2 000545   200032 757100                    STAQ    FIT$+4,,AUTO
         2 000546   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 000547   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 000550   000000 701000 xent               TSX1    ELA$SYSLOG
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:59   
         2 000551   000000 011000                    NOP     0

      271     5107    3            END;

      272     5108    2         END;

   5103  2 000552                       NOGAC        null
      273     5109    1   NOGAC:;
      274     5110    1      O.ADR=FM$FIT.CODES.ITEMX(1); /* DISPL OF EXTENT POOL */

   5110  2 000552   200026 470500                    LDP0    FIT$,,AUTO
         2 000553   000001 236100                    LDQ     1,,PR0
         2 000554   001777 376007                    ANQ     1023,DL
         2 000555   200011 756100                    STQ     O,,AUTO

      275     5111    1      O.SIZ=FM$FIT.CODES.NDW(1)+O.ADR; /* END DISP OF EXTENT POOL */

   5111  2 000556   000001 236100                    LDQ     1,,PR0
         2 000557   000012 772000                    QRL     10
         2 000560   001777 376007                    ANQ     1023,DL
         2 000561   200011 036100                    ADLQ    O,,AUTO
         2 000562   200012 756100                    STQ     O+1,,AUTO

      276     5112    1      O.ADR=O.ADR+1;

   5112  2 000563   200011 054100                    AOS     O,,AUTO

      277     5113    1      T$=FIT$;

   5113  2 000564   200026 236100                    LDQ     FIT$,,AUTO
         2 000565   200004 756100                    STQ     T$,,AUTO

      278     5114    1      CALL FMC$CLRFILE(T$);

   5114  2 000566   200004 631500                    EPPR1   T$,,AUTO
         2 000567   200032 451500                    STP1    FIT$+4,,AUTO
         2 000570   200032 630500                    EPPR0   FIT$+4,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:60   
         2 000571   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000572   000000 701000 xent               TSX1    FMC$CLRFILE
         2 000573   000000 011000                    NOP     0

      279     5115    2      IF FM$GRAN.LVL=6 THEN DO; /* AFIT..RELEASE IT FIRST */

   5115  2 000574   200023 470500                    LDP0    BUF$,,AUTO
         2 000575   000001 236100                    LDQ     1,,PR0
         2 000576   340000 376007                    ANQ     114688,DL
         2 000577   300000 116007                    CMPQ    98304,DL
         2 000600   000612 601000 2                  TNZ     RELNEXT

      280     5116    2         SIZE=PARM.P1;

   5116  2 000601   200003 471500                    LDP1    @PARM,,AUTO
         2 000602   100000 235100                    LDA     0,,PR1
         2 000603   200010 755100                    STA     SIZE,,AUTO

      281     5117    2         CALL GETVOL ALTRET(BADXTN);

   5117  2 000604   003545 701000 2                  TSX1    GETVOL
         2 000605   000662 702000 2                  TSX2    BADXTN

      282     5118    2         RXTN.EADR=RXTN.ADR+1;

   5118  2 000606   200010 220100                    LDX0    SIZE,,AUTO
         2 000607   000001 621010                    EAX1    1,X0
         2 000610   200010 441100                    SXL1    SIZE,,AUTO

      283     5119    2         END;

   5119  2 000611   000650 710000 2                  TRA     s:5132

      284     5120    2      ELSE DO;

   5118  2 000612                       RELNEXT      null
      285     5121    2   RELNEXT:;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:61   
      286     5122    2         XTN$=PINCRW(FIT$,O.ADR);

   5122  2 000612   200011 236100                    LDQ     O,,AUTO
         2 000613   000022 736000                    QLS     18
         2 000614   200026 036100                    ADLQ    FIT$,,AUTO
         2 000615   200005 756100                    STQ     XTN$,,AUTO

      287     5123    2         SIZE=ABUF.ADR;

   5123  2 000616   200005 470500                    LDP0    XTN$,,AUTO
         2 000617   000000 236100                    LDQ     0,,PR0
         2 000620   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000621   200010 756100                    STQ     SIZE,,AUTO

      288     5124    2         CALL GETVOL ALTRET(BADXTN);

   5124  2 000622   003545 701000 2                  TSX1    GETVOL
         2 000623   000662 702000 2                  TSX2    BADXTN

      289     5125    3         IF ABUF.SIZ=0 THEN DO;

   5125  2 000624   200005 470500                    LDP0    XTN$,,AUTO
         2 000625   000000 236100                    LDQ     0,,PR0
         2 000626   777000 316003                    CANQ    -512,DU
         2 000627   000637 601000 2                  TNZ     s:5129

      290     5126    3            RXTN.EADR=RXTN.ADR+BBUF.SIZ;

   5126  2 000630   200010 236100                    LDQ     SIZE,,AUTO
         2 000631   000022 772000                    QRL     18
         2 000632   000001 036100                    ADLQ    1,,PR0
         2 000633   000000 620006                    EAX0    0,QL
         2 000634   200010 440100                    SXL0    SIZE,,AUTO

      291     5127    3            O.ADR=O.ADR+1;

   5127  2 000635   200011 054100                    AOS     O,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:62   

      292     5128    3            END;

   5128  2 000636   000647 710000 2                  TRA     s:5130

      293     5129    2         ELSE RXTN.EADR=RXTN.ADR+ABUF.SIZ;

   5129  2 000637   000000 236100                    LDQ     0,,PR0
         2 000640   000033 772000                    QRL     27
         2 000641   200032 756100                    STQ     FIT$+4,,AUTO
         2 000642   200010 236100                    LDQ     SIZE,,AUTO
         2 000643   000022 772000                    QRL     18
         2 000644   200032 036100                    ADLQ    FIT$+4,,AUTO
         2 000645   000000 620006                    EAX0    0,QL
         2 000646   200010 440100                    SXL0    SIZE,,AUTO

      294     5130    2         O.ADR=O.ADR+1;

   5130  2 000647   200011 054100                    AOS     O,,AUTO

      295     5131    2         END;

      296     5132    1      IF O.ADR=O.SIZ THEN ENT#=4; /* EXIT AFTER THIS ONE */

   5132  2 000650   200011 236100                    LDQ     O,,AUTO
         2 000651   000656 604000 2                  TMI     R1EXT
         2 000652   200012 116100                    CMPQ    O+1,,AUTO
         2 000653   000656 601000 2                  TNZ     R1EXT

   5132  2 000654   000004 235007                    LDA     4,DL
         2 000655   200014 755100                    STA     ENT#,,AUTO

      297     5133    1   R1EXT: IF RXTN.EADR>RXTN.ADR THEN GOTO GNEXT;

   5133  2 000656   200010 720100       R1EXT        LXL0    SIZE,,AUTO
         2 000657   200010 100100                    CMPX0   SIZE,,AUTO
         2 000660   000662 600000 2                  TZE     BADXTN
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:63   
         2 000661   001237 603000 2                  TRC     GNEXT

   5133  2 000662                       BADXTN       null
      298     5134    1   BADXTN:;
      299     5135    1      CALL FMB$LOGERR(%E$GP,21,0,PARM.P1,,,,,RXTN);

   5135  2 000662   200010 630500                    EPPR0   SIZE,,AUTO
         2 000663   200042 450500                    STP0    FIT$+12,,AUTO
         2 000664   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000665   000001 235000 xsym               LDA     B_VECTNIL+1
         2 000666   200040 757100                    STAQ    FIT$+10,,AUTO
         2 000667   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000670   000001 235000 xsym               LDA     B_VECTNIL+1
         2 000671   200036 757100                    STAQ    FIT$+8,,AUTO
         2 000672   200003 236100                    LDQ     @PARM,,AUTO
         2 000673   000003 235000 3                  LDA     3
         2 000674   200034 757100                    STAQ    FIT$+6,,AUTO
         2 000675   000020 237000 3                  LDAQ    16
         2 000676   200032 757100                    STAQ    FIT$+4,,AUTO
         2 000677   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 000700   000015 631400 3                  EPPR1   13
         2 000701   000000 701000 xent               TSX1    FMB$LOGERR
         2 000702   000000 011000                    NOP     0

      300     5136    1      GOTO RETALT1;

   5136  2 000703   003104 710000 2                  TRA     RETALT1

      301     5137        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:64   
      302     5138    1   FAG$GEXT: ENTRY ALTRET;

   5138  2 000704   000000 700200 xent  FAG$GEXT     TSX0  ! X66_AUTO_1
         2 000705   000044 000001                    ZERO    36,1

      303     5139                    /*F*     NAME: FAG$GEXT
      304     5140                              PURPOSE: Allocate the next extent for a file purpose.
      305     5141                    DESCRIPTION: An extent of size DCB.IXTNGRAN is extracted from the
      306     5142                    free pool and the result placed in the CFU extent table for the
      307     5143                    file and in the file's FIT.*/
      308     5144    1      DCB$=B$JIT.DCB$;

   5144  2 000706   000000 470400 xsym               LDP0    B$JIT$
         2 000707   000232 236100                    LDQ     154,,PR0
         2 000710   200024 756100                    STQ     DCB$,,AUTO

      309     5145    1      ENT#=3;

   5145  2 000711   000003 235007                    LDA     3,DL
         2 000712   200014 755100                    STA     ENT#,,AUTO

      310     5146    1      IF F$DCB.IORG~=%RANDOM# AND F$DCB.IORG~=%IDS# AND F$DCB.IORG~=%RELATIVE#

   5146  2 000713   200024 471500                    LDP1    DCB$,,AUTO
         2 000714   100070 236100                    LDQ     56,,PR1
         2 000715   077000 376003                    ANQ     32256,DU
         2 000716   003000 116003                    CMPQ    1536,DU
         2 000717   000725 600000 2                  TZE     s:5148
         2 000720   007000 116003                    CMPQ    3584,DU
         2 000721   000725 600000 2                  TZE     s:5148
         2 000722   005000 116003                    CMPQ    2560,DU
         2 000723   000725 600000 2                  TZE     s:5148

      311     5147    1      THEN ENT#=0;

   5147  2 000724   200014 450100                    STZ     ENT#,,AUTO

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:65   
      312     5148    1      CFU$=F$DCB.CFU$;

   5148  2 000725   100066 236100                    LDQ     54,,PR1
         2 000726   200025 756100                    STQ     CFU$,,AUTO

      313     5149    1      OS.SIZ2=F$DCB.IXTNSIZE-FM$CFU.UGRANS;

   5149  2 000727   200025 473500                    LDP3    CFU$,,AUTO
         2 000730   300004 236100                    LDQ     4,,PR3
         2 000731   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000732   200032 756100                    STQ     FIT$+4,,AUTO
         2 000733   100041 236100                    LDQ     33,,PR1
         2 000734   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 000735   200012 756100                    STQ     O+1,,AUTO

      314     5150    1      IF OS.SIZ2~=F$DCB.IXTNSIZE AND OS.SIZ2<F$DCB.XTNSIZE

   5150  2 000736   100041 116100                    CMPQ    33,,PR1
         2 000737   000745 600000 2                  TZE     s:5152
         2 000740   100037 236100                    LDQ     31,,PR1
         2 000741   000022 772000                    QRL     18
         2 000742   200012 116100                    CMPQ    O+1,,AUTO
         2 000743   000745 604400 2                  TMOZ    s:5152

      315     5151    1      THEN OS.SIZ2=F$DCB.XTNSIZE;

   5151  2 000744   200012 756100                    STQ     O+1,,AUTO

      316     5152    1      IF FM$CFUF.ACCNAM=0 AND O.SIZ<=2 AND ENT#=0 THEN O.SIZ=20;

   5152  2 000745   300002 235100                    LDA     2,,PR3
         2 000746   000756 601000 2                  TNZ     GEXT0
         2 000747   200012 236100                    LDQ     O+1,,AUTO
         2 000750   000003 116007                    CMPQ    3,DL
         2 000751   000756 603000 2                  TRC     GEXT0
         2 000752   200014 235100                    LDA     ENT#,,AUTO
         2 000753   000756 601000 2                  TNZ     GEXT0
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:66   

   5152  2 000754   000024 235007                    LDA     20,DL
         2 000755   200012 755100                    STA     O+1,,AUTO

   5152  2 000756                       GEXT0        null
      317     5153    1   GEXT0:;
      318     5154    1      SIZE=FM_SRZERO;

   5154  2 000756   000000 235000 xsym               LDA     FM_SRZERO
         2 000757   200010 755100                    STA     SIZE,,AUTO

      319     5155    1      BUF#=0;

   5155  2 000760   200013 450100                    STZ     BUF#,,AUTO

      320     5156    1      CALL GETVOL;

   5156  2 000761   003545 701000 2                  TSX1    GETVOL
         2 000762   000000 011000                    NOP     0

      321     5157    1      X=0;

   5157  2 000763   200020 450100                    STZ     X,,AUTO

      322     5158    2      DO WHILE(SDCT$~=FM$SET$);

   5158  2 000764   200007 236100                    LDQ     SDCT$,,AUTO
         2 000765   000000 116000 xsym               CMPQ    FM$SET$
         2 000766   001015 600000 2                  TZE     s:5166

      323     5159    3         IF X<FM$VOL.RGRANS THEN DO;

   5159  2 000767   200007 470500                    LDP0    SDCT$,,AUTO
         2 000770   200020 236100                    LDQ     X,,AUTO
         2 000771   000774 604000 2                  TMI     s:5160
         2 000772   000006 116100                    CMPQ    6,,PR0
         2 000773   001000 603000 2                  TRC     s:5163
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:67   

      324     5160    3            X=FM$VOL.RGRANS;

   5160  2 000774   000006 235100                    LDA     6,,PR0
         2 000775   200020 755100                    STA     X,,AUTO

      325     5161    3            SIZE=SRDZERO;

   5161  2 000776   200017 236100                    LDQ     SRDZERO,,AUTO
         2 000777   200010 756100                    STQ     SIZE,,AUTO

      326     5162    3            END;

      327     5163    2         SRDZERO=SRDZERO+FM$VOL.NXTSDA-FM_SRZERO;

   5163  2 001000   000003 236100                    LDQ     3,,PR0
         2 001001   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 001002   200017 036100                    ADLQ    SRDZERO,,AUTO
         2 001003   000000 136000 xsym               SBLQ    FM_SRZERO
         2 001004   200017 756100                    STQ     SRDZERO,,AUTO

      328     5164    2         SDCT$=ADDR(FM$SET(FM$VOL.VOLL));

   5164  2 001005   000005 236100                    LDQ     5,,PR0
         2 001006   000017 772000                    QRL     15
         2 001007   000001 376000 3                  ANQ     1
         2 001010   000022 736000                    QLS     18
         2 001011   000000 036000 xsym               ADLQ    FM$SET$
         2 001012   200007 756100                    STQ     SDCT$,,AUTO

      329     5165    2         END;

   5165  2 001013   000000 116000 xsym               CMPQ    FM$SET$
         2 001014   000767 601000 2                  TNZ     s:5159

      330     5166    1      CALL GETVOL ALTRET(FAGE$PSGRANS);

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:68   
   5166  2 001015   003545 701000 2                  TSX1    GETVOL
         2 001016   003152 702000 2                  TSX2    FAGE$PSGRANS

      331     5167    2      IF FM$CFU.FITSDA~=0 THEN DO;

   5167  2 001017   200025 470500                    LDP0    CFU$,,AUTO
         2 001020   000000 236100                    LDQ     0,,PR0
         2 001021   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 001022   001060 600000 2                  TZE     s:5177

      332     5168    2         X=OVOL;/* SAVE OTHER CHOPICE */

   5168  2 001023   200016 235100                    LDA     OVOL,,AUTO
         2 001024   200020 755100                    STA     X,,AUTO

      333     5169    2         SIZE=FM$CFU.FITSDA;

   5169  2 001025   000000 236100                    LDQ     0,,PR0
         2 001026   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 001027   200010 756100                    STQ     SIZE,,AUTO

      334     5170    3         IF FA_SCATTER THEN DO;

   5170  2 001030   000000 235000 0                  LDA     FA_SCATTER
         2 001031   001054 600000 2                  TZE     s:5174

      335     5171    3            SIZE=(FM$SET.NXTSDA(F$DCB.SETX)-FM_SRZERO)*MOD(B$JIT.STIME,1024)/1024;

   5171  2 001032   200024 471500                    LDP1    DCB$,,AUTO
         2 001033   100051 236100                    LDQ     41,,PR1
         2 001034   000003 736000                    QLS     3
         2 001035   000001 376000 3                  ANQ     1
         2 001036   000000 473400 xsym               LDP3    FM$SET$
         2 001037   300003 236106                    LDQ     3,QL,PR3
         2 001040   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 001041   000000 136000 xsym               SBLQ    FM_SRZERO
         2 001042   000000 474400 xsym               LDP4    B$JIT$
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:69   
         2 001043   200032 756100                    STQ     FIT$+4,,AUTO
         2 001044   400261 236100                    LDQ     177,,PR4
         2 001045   002000 506007                    DIV     1024,DL
         2 001046   000044 733000                    LRS     36
         2 001047   200032 402100                    MPY     FIT$+4,,AUTO
         2 001050   002000 506007                    DIV     1024,DL
         2 001051   200010 756100                    STQ     SIZE,,AUTO

      336     5172    3            SIZE=SIZE+FM_SRZERO;

   5172  2 001052   000000 036000 xsym               ADLQ    FM_SRZERO
         2 001053   200010 756100                    STQ     SIZE,,AUTO

      337     5173    3            END;

      338     5174    2         CALL GETVOL ALTRET(FAGE$PSGRANS);

   5174  2 001054   003545 701000 2                  TSX1    GETVOL
         2 001055   003152 702000 2                  TSX2    FAGE$PSGRANS

      339     5175    2         OVOL=X;

   5175  2 001056   200020 235100                    LDA     X,,AUTO
         2 001057   200016 755100                    STA     OVOL,,AUTO

      340     5176    2         END;

      341     5177    1      IF ENT#=1 THEN GOTO GNEXT;

   5177  2 001060   200014 235100                    LDA     ENT#,,AUTO
         2 001061   000001 115007                    CMPA    1,DL
         2 001062   001237 600000 2                  TZE     GNEXT

      342     5178    1      IF O.SIZ=0 THEN O.SIZ=8;

   5178  2 001063   200012 236100                    LDQ     O+1,,AUTO
         2 001064   001067 601000 2                  TNZ     s:5179
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:70   

   5178  2 001065   000010 235007                    LDA     8,DL
         2 001066   200012 755100                    STA     O+1,,AUTO

      343     5179    1      X=O.SIZ;

   5179  2 001067   200012 235100                    LDA     O+1,,AUTO
         2 001070   200020 755100                    STA     X,,AUTO

      344     5180    1      IF F$DCB.BORROW>0 THEN IF F$DCB.BORROW<XU THEN X=O.SIZ-F$DCB.BORROW;

   5180  2 001071   200024 470500                    LDP0    DCB$,,AUTO
         2 001072   000065 235100                    LDA     53,,PR0
         2 001073   001104 604400 2                  TMOZ    s:5182

   5180  2 001074   000065 236100                    LDQ     53,,PR0
         2 001075   001100 604000 2                  TMI     s:5180+7
         2 001076   200020 116100                    CMPQ    X,,AUTO
         2 001077   001237 603000 2                  TRC     GNEXT

   5180  2 001100   200012 236100                    LDQ     O+1,,AUTO
         2 001101   000065 136100                    SBLQ    53,,PR0
         2 001102   200020 756100                    STQ     X,,AUTO
         2 001103   001104 710000 2                  TRA     s:5182

      345     5181    1         ELSE GOTO GNEXT;
      346     5182    2      IF F$DCB.STARF OR FM$CFU.NAMEX=0 THEN DO; /* STAR OR SCRATCH */

   5182  2 001104   000064 236100                    LDQ     52,,PR0
         2 001105   200000 316003                    CANQ    65536,DU
         2 001106   001112 601000 2                  TNZ     s:5183
         2 001107   200025 471500                    LDP1    CFU$,,AUTO
         2 001110   100002 720100                    LXL0    2,,PR1
         2 001111   001143 601000 2                  TNZ     s:5194

      347     5183    2         CFU$=ADDR(NIL);

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:71   
   5183  2 001112   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001113   200025 756100                    STQ     CFU$,,AUTO

      348     5184    2         IF F$DCB.STARX=4 OR F$DCB.WSR=1 OR F$DCB.STARX=3 AND F$DCB.NRECS=0

   5184  2 001114   000064 236100                    LDQ     52,,PR0
         2 001115   007000 376007                    ANQ     3584,DL
         2 001116   004000 116007                    CMPQ    2048,DL
         2 001117   001142 600000 2                  TZE     s:5192
         2 001120   000040 236100                    LDQ     32,,PR0
         2 001121   000777 376003                    ANQ     511,DU
         2 001122   000001 116003                    CMPQ    1,DU
         2 001123   001142 600000 2                  TZE     s:5192
         2 001124   000064 236100                    LDQ     52,,PR0
         2 001125   007000 376007                    ANQ     3584,DL
         2 001126   003000 116007                    CMPQ    1536,DL
         2 001127   001132 601000 2                  TNZ     s:5186
         2 001130   000042 235100                    LDA     34,,PR0
         2 001131   001142 600000 2                  TZE     s:5192

      349     5185    2         THEN EXIT; /* some things in life are free */
      350     5186    3         DO WHILE XU+B$JIT.CURTMPDP>B$JIT.MAXTMPDP;

   5186  2 001132   001135 710000 2                  TRA     s:5188

      351     5187    3            CALL ADJ_REQ ALTRET(FAGE$USGRANS);

   5187  2 001133   003451 701000 2                  TSX1    ADJ_REQ
         2 001134   003156 702000 2                  TSX2    FAGE$USGRANS

      352     5188    3            END;

   5188  2 001135   000000 470400 xsym               LDP0    B$JIT$
         2 001136   200020 236100                    LDQ     X,,AUTO
         2 001137   000240 036100                    ADLQ    160,,PR0
         2 001140   000241 116100                    CMPQ    161,,PR0
         2 001141   001133 605400 2                  TPNZ    s:5187
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:72   

      353     5189                    /*E*     ERROR: FAG-E$USGRANS-E
      354     5190                    *        MESSAGE: !LIMIT for disk space exceeded% for %UF%
      355     5191                    */
      356     5192    2         END;

   5192  2 001142   001237 710000 2                  TRA     GNEXT

      357     5193    2      ELSE DO;

      358     5194    2         IF F$DCB.WSR~=1 AND NOT B$JIT.PRIV.ACTIVE.FMEFT

   5194  2 001143   000040 236100                    LDQ     32,,PR0
         2 001144   000777 376003                    ANQ     511,DU
         2 001145   000001 116003                    CMPQ    1,DU
         2 001146   001171 600000 2                  TZE     s:5199
         2 001147   000000 473400 xsym               LDP3    B$JIT$
         2 001150   300013 234100                    SZN     11,,PR3
         2 001151   001171 604000 2                  TMI     s:5199
         2 001152   100002 236100                    LDQ     2,,PR1
         2 001153   000022 772000                    QRL     18
         2 001154   000000 116000 xsym               CMPQ    FM_SYSACCTX
         2 001155   001171 600000 2                  TZE     s:5199

      359     5195    2           AND FM$CFU.ACCTX~=FM_SYSACCTX
      360     5196    3         THEN DO WHILE XU>B$JIT.PRDPRM;

   5196  2 001156   200020 236100                    LDQ     X,,AUTO
         2 001157   001162 604000 2                  TMI     s:5197
         2 001160   300242 116100                    CMPQ    162,,PR3
         2 001161   001171 604400 2                  TMOZ    s:5199

      361     5197    3            CALL ADJ_REQ ALTRET(FAGE$USGRANS);

   5197  2 001162   003451 701000 2                  TSX1    ADJ_REQ
         2 001163   003156 702000 2                  TSX2    FAGE$USGRANS

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:73   
      362     5198    3            END;

   5198  2 001164   000000 470400 xsym               LDP0    B$JIT$
         2 001165   200020 236100                    LDQ     X,,AUTO
         2 001166   001162 604000 2                  TMI     s:5197
         2 001167   000242 116100                    CMPQ    162,,PR0
         2 001170   001162 605400 2                  TPNZ    s:5197

      363     5199    2         CALL FMR$L8;

   5199  2 001171   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001172   000000 701000 xent               TSX1    FMR$L8
         2 001173   000000 011000                    NOP     0

      364     5200    2         IF FM$CFU.ACCTX=0 THEN CFU$=PINCRW(F$CFU$,FM$CFU.NAMEX);

   5200  2 001174   200025 470500                    LDP0    CFU$,,AUTO
         2 001175   000002 220100                    LDX0    2,,PR0
         2 001176   001203 601000 2                  TNZ     s:5201

   5200  2 001177   000002 721100                    LXL1    2,,PR0
         2 001200   000000 636011                    EAQ     0,X1
         2 001201   000000 036000 xsym               ADLQ    F$CFU$
         2 001202   200025 756100                    STQ     CFU$,,AUTO

      365     5201    2         CFU$=PINCRW(F$CFU$,FM$CFU.ACCTX);

   5201  2 001203   200025 470500                    LDP0    CFU$,,AUTO
         2 001204   000002 220100                    LDX0    2,,PR0
         2 001205   000000 636010                    EAQ     0,X0
         2 001206   000000 036000 xsym               ADLQ    F$CFU$
         2 001207   200025 756100                    STQ     CFU$,,AUTO

      366     5202    2         IF F$DCB.WSR~=1 AND NOT B$JIT.PRIV.ACTIVE.FMEFT

   5202  2 001210   200024 470500                    LDP0    DCB$,,AUTO
         2 001211   000040 236100                    LDQ     32,,PR0
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:74   
         2 001212   000777 376003                    ANQ     511,DU
         2 001213   000001 116003                    CMPQ    1,DU
         2 001214   001234 600000 2                  TZE     s:5209
         2 001215   000000 471400 xsym               LDP1    B$JIT$
         2 001216   100013 234100                    SZN     11,,PR1
         2 001217   001234 604000 2                  TMI     s:5209

      367     5203    3         THEN DO WHILE XU>FM$CFUA.GRANS;

   5203  2 001220   200025 473500                    LDP3    CFU$,,AUTO
         2 001221   200020 236100                    LDQ     X,,AUTO
         2 001222   001225 604000 2                  TMI     s:5204
         2 001223   300007 116100                    CMPQ    7,,PR3
         2 001224   001234 604400 2                  TMOZ    s:5209

      368     5204    3            CALL ADJ_REQ ALTRET(FAGE$ACGRANS);

   5204  2 001225   003451 701000 2                  TSX1    ADJ_REQ
         2 001226   003162 702000 2                  TSX2    FAGE$ACGRANS

      369     5205    3            END;

   5205  2 001227   200025 470500                    LDP0    CFU$,,AUTO
         2 001230   200020 236100                    LDQ     X,,AUTO
         2 001231   001225 604000 2                  TMI     s:5204
         2 001232   000007 116100                    CMPQ    7,,PR0
         2 001233   001225 605400 2                  TPNZ    s:5204

      370     5206                    /*E*     ERROR: FAG-E$ACGRANS-E
      371     5207                    *        MESSAGE: Account% %AC% disk space exceeded% for %UF%
      372     5208                    */
      373     5209    2         CALL FMR$U8;

   5209  2 001234   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001235   000000 701000 xent               TSX1    FMR$U8
         2 001236   000000 011000                    NOP     0

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:75   
      374     5210    2         END;

      375     5211    1   GNEXT: Y=-O.SIZ;

   5211  2 001237   000000 235003       GNEXT        LDA     0,DU
         2 001240   200012 135100                    SBLA    O+1,,AUTO
         2 001241   200021 755100                    STA     Y,,AUTO

      376     5212    1      BUF#=4;

   5212  2 001242   000004 236007                    LDQ     4,DL
         2 001243   200013 756100                    STQ     BUF#,,AUTO

      377     5213    1      IF ENT#<4 THEN IF F$DCB.BFR.BUFX(3)=0 THEN BUF#=3;

   5213  2 001244   200014 235100                    LDA     ENT#,,AUTO
         2 001245   000004 115007                    CMPA    4,DL
         2 001246   001266 605000 2                  TPL     s:5215

   5213  2 001247   200024 470500                    LDP0    DCB$,,AUTO
         2 001250   000120 236100                    LDQ     80,,PR0
         2 001251   037000 316003                    CANQ    15872,DU
         2 001252   001256 601000 2                  TNZ     s:5214

   5213  2 001253   000003 235007                    LDA     3,DL
         2 001254   200013 755100                    STA     BUF#,,AUTO
         2 001255   001266 710000 2                  TRA     s:5215

      378     5214    1         ELSE IF F$DCB.TDA=0 AND F$DCB.BFR.BUFX(2)=0 THEN BUF#=2;

   5214  2 001256   000070 236100                    LDQ     56,,PR0
         2 001257   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 001260   001266 601000 2                  TNZ     s:5215
         2 001261   000117 236100                    LDQ     79,,PR0
         2 001262   037000 316003                    CANQ    15872,DU
         2 001263   001266 601000 2                  TNZ     s:5215

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:76   
   5214  2 001264   000002 235007                    LDA     2,DL
         2 001265   200013 755100                    STA     BUF#,,AUTO

      379     5215    1      CALL ENQUEUE ALTRET(ENQERR);

   5215  2 001266   200024 470500                    LDP0    DCB$,,AUTO
         2 001267   000051 236100                    LDQ     41,,PR0
         2 001270   000003 736000                    QLS     3
         2 001271   000001 376000 3                  ANQ     1
         2 001272   000022 736000                    QLS     18
         2 001273   000006 036003                    ADLQ    6,DU
         2 001274   000000 036000 xsym               ADLQ    FM$SET$
         2 001275   200032 756100                    STQ     FIT$+4,,AUTO
         2 001276   200032 631500                    EPPR1   FIT$+4,,AUTO
         2 001277   200033 451500                    STP1    FIT$+5,,AUTO
         2 001300   200033 630500                    EPPR0   FIT$+5,,AUTO
         2 001301   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001302   000000 701000 xent               TSX1    UQB$MENQX
         2 001303   002756 702000 2                  TSX2    ENQERR

      380     5216    1   RD1ST: X=-1; /* NO LINK CHECK THE FIRST TIME */

   5216  2 001304   000001 335007       RD1ST        LCA     1,DL
         2 001305   200020 755100                    STA     X,,AUTO

      381     5217    1      CDA=FM$VOL.GPSDA;

   5217  2 001306   200007 470500                    LDP0    SDCT$,,AUTO
         2 001307   000007 235100                    LDA     7,,PR0
         2 001310   200022 755100                    STA     CDA,,AUTO

   5217  2 001311                       RDNXT        null
      382     5218    1   RDNXT: ;
      383     5219    1      VXH$N=F$DCB.GTYP;

   5219  2 001311   200024 470500                    LDP0    DCB$,,AUTO
         2 001312   000064 236100                    LDQ     52,,PR0
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:77   
         2 001313   000035 772000                    QRL     29
         2 001314   000007 376007                    ANQ     7,DL
         2 001315   200006 756100                    STQ     VXH$,,AUTO

      384     5220    1      F$DCB.GTYP=FMGTGP;

   5220  2 001316   000064 236100                    LDQ     52,,PR0
         2 001317   000022 376000 3                  ANQ     18
         2 001320   004000 276003                    ORQ     2048,DU
         2 001321   000064 756100                    STQ     52,,PR0

      385     5221    1      CALL FMD$REDBUF(T$,BUF#,CDA,0,X)ALTRET(RETALT1);

   5221  2 001322   200020 631500                    EPPR1   X,,AUTO
         2 001323   200036 451500                    STP1    FIT$+8,,AUTO
         2 001324   000003 236000 3                  LDQ     3
         2 001325   200035 756100                    STQ     FIT$+7,,AUTO
         2 001326   200022 633500                    EPPR3   CDA,,AUTO
         2 001327   200034 453500                    STP3    FIT$+6,,AUTO
         2 001330   200013 634500                    EPPR4   BUF#,,AUTO
         2 001331   200033 454500                    STP4    FIT$+5,,AUTO
         2 001332   200004 635500                    EPPR5   T$,,AUTO
         2 001333   200032 455500                    STP5    FIT$+4,,AUTO
         2 001334   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 001335   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 001336   000000 701000 xent               TSX1    FMD$REDBUF
         2 001337   003104 702000 2                  TSX2    RETALT1

      386     5222    1      BUF$=T$;

   5222  2 001340   200004 236100                    LDQ     T$,,AUTO
         2 001341   200023 756100                    STQ     BUF$,,AUTO

      387     5223    1      F$DCB.GTYP=VXH$N;

   5223  2 001342   200024 470500                    LDP0    DCB$,,AUTO
         2 001343   200006 236100                    LDQ     VXH$,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:78   
         2 001344   000035 736000                    QLS     29
         2 001345   000064 676100                    ERQ     52,,PR0
         2 001346   034000 376003                    ANQ     14336,DU
         2 001347   000064 656100                    ERSQ    52,,PR0

      388     5224    1      VXH$=PINCRW(BUF$,FM$GRAN.FCEX);

   5224  2 001350   200023 471500                    LDP1    BUF$,,AUTO
         2 001351   100002 220100                    LDX0    2,,PR1
         2 001352   000000 636010                    EAQ     0,X0
         2 001353   200023 036100                    ADLQ    BUF$,,AUTO
         2 001354   200006 756100                    STQ     VXH$,,AUTO

      389     5225    2      DO WHILE (VXH.VOL<VOL#);

   5225  2 001355   200006 473500                    LDP3    VXH$,,AUTO
         2 001356   300000 236100                    LDQ     0,,PR3
         2 001357   000033 772000                    QRL     27
         2 001360   200015 116100                    CMPQ    VOL#,,AUTO
         2 001361   001415 605000 2                  TPL     s:5230

      390     5226    2         IF VXH.N THEN GOTO RDNXT0; /* MORE FOR VXH.VOL ON NEXT GRAN */

   5226  2 001362   200006 470500                    LDP0    VXH$,,AUTO
         2 001363   000000 236100                    LDQ     0,,PR0
         2 001364   000400 316003                    CANQ    256,DU
         2 001365   001753 601000 2                  TNZ     RDNXT0

      391     5227    2         VXH$=PINCRW(VXH$,VXH.XTNS+1); /* GET TO NEXT VOL HERE */

   5227  2 001366   000000 720100                    LXL0    0,,PR0
         2 001367   000001 636010                    EAQ     1,X0
         2 001370   200006 036100                    ADLQ    VXH$,,AUTO
         2 001371   200006 756100                    STQ     VXH$,,AUTO

      392     5228    2         IF POFFW(VXH$,BUF$)>=FM$GRAN.NAVX THEN GOTO RDNXT0;

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:79   
   5228  2 001372   200023 235100                    LDA     BUF$,,AUTO
         2 001373   000022 771000                    ARL     18
         2 001374   200032 755100                    STA     FIT$+4,,AUTO
         2 001375   200006 236100                    LDQ     VXH$,,AUTO
         2 001376   000022 772000                    QRL     18
         2 001377   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 001400   200023 470500                    LDP0    BUF$,,AUTO
         2 001401   200033 756100                    STQ     FIT$+5,,AUTO
         2 001402   000001 236100                    LDQ     1,,PR0
         2 001403   000022 772000                    QRL     18
         2 001404   200034 756100                    STQ     FIT$+6,,AUTO
         2 001405   200033 236100                    LDQ     FIT$+5,,AUTO
         2 001406   200034 116100                    CMPQ    FIT$+6,,AUTO
         2 001407   001753 605000 2                  TPL     RDNXT0

      393     5229    2         END;

   5229  2 001410   200006 471500                    LDP1    VXH$,,AUTO
         2 001411   100000 236100                    LDQ     0,,PR1
         2 001412   000033 772000                    QRL     27
         2 001413   200015 116100                    CMPQ    VOL#,,AUTO
         2 001414   001362 604000 2                  TMI     s:5226

      394     5230    1      IF VXH.XTNS+POFFW(VXH$,BUF$)>1023

   5230  2 001415   200023 235100                    LDA     BUF$,,AUTO
         2 001416   000022 771000                    ARL     18
         2 001417   200032 755100                    STA     FIT$+4,,AUTO
         2 001420   200006 236100                    LDQ     VXH$,,AUTO
         2 001421   000022 772000                    QRL     18
         2 001422   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 001423   200006 470500                    LDP0    VXH$,,AUTO
         2 001424   200033 756100                    STQ     FIT$+5,,AUTO
         2 001425   000000 236100                    LDQ     0,,PR0
         2 001426   777777 376007                    ANQ     -1,DL
         2 001427   200034 756100                    STQ     FIT$+6,,AUTO
         2 001430   200033 236100                    LDQ     FIT$+5,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:80   
         2 001431   200034 036100                    ADLQ    FIT$+6,,AUTO
         2 001432   001777 116007                    CMPQ    1023,DL
         2 001433   002764 605400 2                  TPNZ    BUFERR
         2 001434   000000 236100                    LDQ     0,,PR0
         2 001435   000033 772000                    QRL     27
         2 001436   200015 116100                    CMPQ    VOL#,,AUTO
         2 001437   002764 601000 2                  TNZ     BUFERR
         2 001440   000000 720100                    LXL0    0,,PR0
         2 001441   002764 600000 2                  TZE     BUFERR

      395     5231    1        OR VXH.VOL~=VOL# OR VXH.XTNS=0 THEN GOTO BUFERR;
      396     5232    1      IF ENT#>3 THEN GOTO REXT;

   5232  2 001442   200014 235100                    LDA     ENT#,,AUTO
         2 001443   000003 115007                    CMPA    3,DL
         2 001444   002053 605400 2                  TPNZ    REXT

      397     5233    2      IF ENT#=2 THEN DO;

   5233  2 001445   000002 115007                    CMPA    2,DL
         2 001446   001707 601000 2                  TNZ     GEXT

      398     5234    3         IF NOT VXH.P THEN DO;

   5234  2 001447   000000 236100                    LDQ     0,,PR0
         2 001450   000200 316003                    CANQ    128,DU
         2 001451   001456 601000 2                  TNZ     s:5238

      399     5235    3            FM$VOL.GPSDA=CDA;

   5235  2 001452   200022 235100                    LDA     CDA,,AUTO
         2 001453   200007 471500                    LDP1    SDCT$,,AUTO
         2 001454   100007 755100                    STA     7,,PR1

      400     5236    3            SIZE=0;

   5236  2 001455   200010 450100                    STZ     SIZE,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:81   

      401     5237    3            END;

      402     5238    3         DO X=1 TO VXH.XTNS-1;

   5238  2 001456   000001 235007                    LDA     1,DL
         2 001457   200020 755100                    STA     X,,AUTO
         2 001460   001510 710000 2                  TRA     s:5243+1

      403     5239    3            XTN$=PINCRW(VXH$,X);

   5239  2 001461   200020 236100                    LDQ     X,,AUTO
         2 001462   000022 736000                    QLS     18
         2 001463   200006 036100                    ADLQ    VXH$,,AUTO
         2 001464   200005 756100                    STQ     XTN$,,AUTO

      404     5240    3            IF XBUF.EADR>PINCRW(XTN$,1)->XBUF.ADR

   5240  2 001465   200005 470500                    LDP0    XTN$,,AUTO
         2 001466   000000 720100                    LXL0    0,,PR0
         2 001467   000001 100100                    CMPX0   1,,PR0
         2 001470   001472 600000 2                  TZE     s:5240+5
         2 001471   003152 603000 2                  TRC     FAGE$PSGRANS
         2 001472   000000 100100                    CMPX0   0,,PR0
         2 001473   003152 602000 2                  TNC     FAGE$PSGRANS
         2 001474   003152 600000 2                  TZE     FAGE$PSGRANS

      405     5241    3              OR XBUF.EADR<=XBUF.ADR THEN GOTO FAGE$PSGRANS;
      406     5242    3            SIZE=SIZE+XBUF.EADR-XBUF.ADR;

   5242  2 001475   000000 236100                    LDQ     0,,PR0
         2 001476   777777 376007                    ANQ     -1,DL
         2 001477   200010 036100                    ADLQ    SIZE,,AUTO
         2 001500   200032 756100                    STQ     FIT$+4,,AUTO
         2 001501   000000 236100                    LDQ     0,,PR0
         2 001502   000022 772000                    QRL     18
         2 001503   200033 756100                    STQ     FIT$+5,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:82   
         2 001504   200032 236100                    LDQ     FIT$+4,,AUTO
         2 001505   200033 136100                    SBLQ    FIT$+5,,AUTO
         2 001506   200010 756100                    STQ     SIZE,,AUTO

      407     5243    3            END;

   5243  2 001507   200020 054100                    AOS     X,,AUTO
         2 001510   200006 470500                    LDP0    VXH$,,AUTO
         2 001511   000000 236100                    LDQ     0,,PR0
         2 001512   777777 376007                    ANQ     -1,DL
         2 001513   200020 116100                    CMPQ    X,,AUTO
         2 001514   001461 605400 2                  TPNZ    s:5239

      408     5244    2         IF VXH.N THEN GOTO RDNXT0;

   5244  2 001515   000000 236100                    LDQ     0,,PR0
         2 001516   000400 316003                    CANQ    256,DU
         2 001517   001753 601000 2                  TNZ     RDNXT0

      409     5245    2         FM$VOL.RGRANS=SIZE;

   5245  2 001520   200010 235100                    LDA     SIZE,,AUTO
         2 001521   200007 471500                    LDP1    SDCT$,,AUTO
         2 001522   100006 755100                    STA     6,,PR1

      410     5246    2         VOL#=VOL#+1;

   5246  2 001523   200015 054100                    AOS     VOL#,,AUTO

      411     5247    2         SDCT$=ADDR(FM$SET(FM$VOL.VOLL));

   5247  2 001524   100005 236100                    LDQ     5,,PR1
         2 001525   000017 772000                    QRL     15
         2 001526   000001 376000 3                  ANQ     1
         2 001527   000022 736000                    QLS     18
         2 001530   000000 036000 xsym               ADLQ    FM$SET$
         2 001531   200007 756100                    STQ     SDCT$,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:83   

      412     5248    2         IF SDCT$~=FM$SET$ THEN GOTO CGRANS0;

   5248  2 001532   000000 116000 xsym               CMPQ    FM$SET$
         2 001533   000043 601000 2                  TNZ     CGRANS0

      413     5249    2         X=-1;

   5249  2 001534   000001 335007                    LCA     1,DL
         2 001535   200020 755100                    STA     X,,AUTO

      414     5250    2         F$DCB.GTYP=FMGTGP;

   5250  2 001536   200024 471500                    LDP1    DCB$,,AUTO
         2 001537   100064 236100                    LDQ     52,,PR1
         2 001540   000022 376000 3                  ANQ     18
         2 001541   004000 276003                    ORQ     2048,DU
         2 001542   100064 756100                    STQ     52,,PR1

      415     5251    2         CDA=FM_GPSDA;

   5251  2 001543   000000 235000 xsym               LDA     FM_GPSDA
         2 001544   200022 755100                    STA     CDA,,AUTO

      416     5252    2         CALL FMD$REDBUF(T$,BUF#,CDA,0,X)ALTRET(RETALT1);

   5252  2 001545   200020 633500                    EPPR3   X,,AUTO
         2 001546   200036 453500                    STP3    FIT$+8,,AUTO
         2 001547   000003 236000 3                  LDQ     3
         2 001550   200035 756100                    STQ     FIT$+7,,AUTO
         2 001551   200022 634500                    EPPR4   CDA,,AUTO
         2 001552   200034 454500                    STP4    FIT$+6,,AUTO
         2 001553   200013 635500                    EPPR5   BUF#,,AUTO
         2 001554   200033 455500                    STP5    FIT$+5,,AUTO
         2 001555   200004 636500                    EPPR6   T$,,AUTO
         2 001556   200032 456500                    STP6    FIT$+4,,AUTO
         2 001557   200032 630500                    EPPR0   FIT$+4,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:84   
         2 001560   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 001561   000000 701000 xent               TSX1    FMD$REDBUF
         2 001562   003104 702000 2                  TSX2    RETALT1

      417     5253    2         BUF$=T$;

   5253  2 001563   200004 236100                    LDQ     T$,,AUTO
         2 001564   200023 756100                    STQ     BUF$,,AUTO

      418     5254                    /* RELEASE FILES OPEN AT RECOVERY IF THERE ARE ANY */
      419     5255    2         X=FM$GRAN.BLINK;

   5255  2 001565   200023 470500                    LDP0    BUF$,,AUTO
         2 001566   000003 235100                    LDA     3,,PR0
         2 001567   200020 755100                    STA     X,,AUTO

      420     5256    3         IF X~=0 THEN DO;

   5256  2 001570   001662 600000 2                  TZE     s:5272

      421     5257    3            FM$GRAN.BLINK=0;

   5257  2 001571   000003 450100                    STZ     3,,PR0

      422     5258    3            CALL FMD$WRTBUF(BUF#);

   5258  2 001572   200013 631500                    EPPR1   BUF#,,AUTO
         2 001573   200032 451500                    STP1    FIT$+4,,AUTO
         2 001574   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 001575   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001576   000000 701000 xent               TSX1    FMD$WRTBUF
         2 001577   000000 011000                    NOP     0

      423     5259    3            CALL DEQUEUE;

   5259  2 001600   200024 470500                    LDP0    DCB$,,AUTO
         2 001601   000051 236100                    LDQ     41,,PR0
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:85   
         2 001602   000003 736000                    QLS     3
         2 001603   000001 376000 3                  ANQ     1
         2 001604   000022 736000                    QLS     18
         2 001605   000006 036003                    ADLQ    6,DU
         2 001606   000000 036000 xsym               ADLQ    FM$SET$
         2 001607   200032 756100                    STQ     FIT$+4,,AUTO
         2 001610   200032 631500                    EPPR1   FIT$+4,,AUTO
         2 001611   200033 451500                    STP1    FIT$+5,,AUTO
         2 001612   200033 630500                    EPPR0   FIT$+5,,AUTO
         2 001613   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001614   000000 701000 xent               TSX1    UQB$MDEQ
         2 001615   000000 011000                    NOP     0

      424     5260    3            RXTN=F$DCB.NAME; /* SAVE THE NAME WE HAVE */

   5260  2 001616   200024 470500                    LDP0    DCB$,,AUTO
         2 001617   000010 236100                    LDQ     8,,PR0
         2 001620   200010 756100                    STQ     SIZE,,AUTO

      425     5261    3            ADDR(F$DCB.NAME)->VXH='001'O;

   5261  2 001621   001000 236003                    LDQ     512,DU
         2 001622   000010 756100                    STQ     8,,PR0

      426     5262    4            DO WHILE(X>FM_SRZERO);

   5262  2 001623   200020 236100                    LDQ     X,,AUTO
         2 001624   000000 116000 xsym               CMPQ    FM_SRZERO
         2 001625   001656 604400 2                  TMOZ    s:5269

      427     5263    4               CALL FAG$RFILE(X);

   5263  2 001626   200020 630500                    EPPR0   X,,AUTO
         2 001627   200032 450500                    STP0    FIT$+4,,AUTO
         2 001630   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 001631   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001632   000160 701000 2                  TSX1    s:5050
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:86   
         2 001633   000000 011000                    NOP     0

      428     5264    4               FIT$=FM$BUF$(F$DCB.BFR.BUFX(1));

   5264  2 001634   200024 470500                    LDP0    DCB$,,AUTO
         2 001635   000116 236100                    LDQ     78,,PR0
         2 001636   000033 772000                    QRL     27
         2 001637   000037 376007                    ANQ     31,DL
         2 001640   000000 236006 xsym               LDQ     FM$BUF$,QL
         2 001641   200026 756100                    STQ     FIT$,,AUTO

      429     5265    4               IF FIT$=ADDR(NIL) THEN EXIT;

   5265  2 001642   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001643   001656 600000 2                  TZE     s:5269

      430     5266    4               X=BITBIN(FM$FIT.CODES(1023));

   5266  2 001644   200026 471500                    LDP1    FIT$,,AUTO
         2 001645   101777 235100                    LDA     1023,,PR1
         2 001646   200020 755100                    STA     X,,AUTO

      431     5267    4               CALL FMD$RELBUF(1);

   5267  2 001647   000007 630400 3                  EPPR0   7
         2 001650   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001651   000000 701000 xent               TSX1    FMD$RELBUF
         2 001652   000000 011000                    NOP     0

      432     5268    4               END;

   5268  2 001653   200020 236100                    LDQ     X,,AUTO
         2 001654   000000 116000 xsym               CMPQ    FM_SRZERO
         2 001655   001626 605400 2                  TPNZ    s:5263

      433     5269    3            ADDR(F$DCB.NAME)->VXH=RXTN;

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:87   
   5269  2 001656   200010 236100                    LDQ     SIZE,,AUTO
         2 001657   200024 470500                    LDP0    DCB$,,AUTO
         2 001660   000010 756100                    STQ     8,,PR0

      434     5270    3            END;

   5270  2 001661   001706 710000 2                  TRA     s:5275

      435     5271    3         ELSE DO;

      436     5272    3            CALL FMD$FLSHBUF(BUF#);

   5272  2 001662   200013 631500                    EPPR1   BUF#,,AUTO
         2 001663   200032 451500                    STP1    FIT$+4,,AUTO
         2 001664   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 001665   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001666   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 001667   000000 011000                    NOP     0

      437     5273    3            CALL DEQUEUE;

   5273  2 001670   200024 470500                    LDP0    DCB$,,AUTO
         2 001671   000051 236100                    LDQ     41,,PR0
         2 001672   000003 736000                    QLS     3
         2 001673   000001 376000 3                  ANQ     1
         2 001674   000022 736000                    QLS     18
         2 001675   000006 036003                    ADLQ    6,DU
         2 001676   000000 036000 xsym               ADLQ    FM$SET$
         2 001677   200032 756100                    STQ     FIT$+4,,AUTO
         2 001700   200032 631500                    EPPR1   FIT$+4,,AUTO
         2 001701   200033 451500                    STP1    FIT$+5,,AUTO
         2 001702   200033 630500                    EPPR0   FIT$+5,,AUTO
         2 001703   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001704   000000 701000 xent               TSX1    UQB$MDEQ
         2 001705   000000 011000                    NOP     0

      438     5274    3            END;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:88   

      439     5275    2         RETURN;

   5275  2 001706   000000 702200 xent               TSX2  ! X66_ARET

      440     5276    2         END;
      441     5277        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:89   
      442     5278    2   GEXT: DO X=1 TO VXH.XTNS-1;

   5278  2 001707   000001 235007       GEXT         LDA     1,DL
         2 001710   200020 755100                    STA     X,,AUTO
         2 001711   001743 710000 2                  TRA     s:5285+1

      443     5279    2         XTN$=PINCRW(VXH$,X);

   5279  2 001712   200020 236100                    LDQ     X,,AUTO
         2 001713   000022 736000                    QLS     18
         2 001714   200006 036100                    ADLQ    VXH$,,AUTO
         2 001715   200005 756100                    STQ     XTN$,,AUTO

      444     5280    2         IF XBUF.EADR>PINCRW(XTN$,1)->XBUF.ADR

   5280  2 001716   200005 470500                    LDP0    XTN$,,AUTO
         2 001717   000000 720100                    LXL0    0,,PR0
         2 001720   000001 100100                    CMPX0   1,,PR0
         2 001721   001723 600000 2                  TZE     s:5280+5
         2 001722   002764 603000 2                  TRC     BUFERR
         2 001723   000000 100100                    CMPX0   0,,PR0
         2 001724   002764 602000 2                  TNC     BUFERR
         2 001725   002764 600000 2                  TZE     BUFERR

      445     5281    2           OR XBUF.EADR<=XBUF.ADR THEN GOTO BUFERR;
      446     5282    2         SIZE=XBUF.EADR-XBUF.ADR-O.SIZ;

   5282  2 001726   000000 236100                    LDQ     0,,PR0
         2 001727   000022 772000                    QRL     18
         2 001730   200032 756100                    STQ     FIT$+4,,AUTO
         2 001731   000000 236100                    LDQ     0,,PR0
         2 001732   777777 376007                    ANQ     -1,DL
         2 001733   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 001734   200012 136100                    SBLQ    O+1,,AUTO
         2 001735   200010 756100                    STQ     SIZE,,AUTO

      447     5283    2         IF SIZE>=0 THEN GOTO GOTONE;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:90   

   5283  2 001736   003171 605000 2                  TPL     GOTONE

      448     5284    2         IF Y<SIZE THEN Y=SIZE;

   5284  2 001737   200021 116100                    CMPQ    Y,,AUTO
         2 001740   001742 604400 2                  TMOZ    s:5285

   5284  2 001741   200021 756100                    STQ     Y,,AUTO

      449     5285    2         END;

   5285  2 001742   200020 054100                    AOS     X,,AUTO
         2 001743   200006 470500                    LDP0    VXH$,,AUTO
         2 001744   000000 236100                    LDQ     0,,PR0
         2 001745   777777 376007                    ANQ     -1,DL
         2 001746   200020 116100                    CMPQ    X,,AUTO
         2 001747   001712 605400 2                  TPNZ    s:5279

      450     5286    2      IF VXH.N THEN DO;

   5286  2 001750   000000 236100                    LDQ     0,,PR0
         2 001751   000400 316003                    CANQ    256,DU
         2 001752   001761 600000 2                  TZE     s:5291

      451     5287    2   RDNXT0: X=CDA; /* FLINK MERRILY ALONG */

   5287  2 001753   200022 235100       RDNXT0       LDA     CDA,,AUTO
         2 001754   200020 755100                    STA     X,,AUTO

      452     5288    2         CDA=FM$GRAN.FLINK;

   5288  2 001755   200023 470500                    LDP0    BUF$,,AUTO
         2 001756   000004 235100                    LDA     4,,PR0
         2 001757   200022 755100                    STA     CDA,,AUTO

      453     5289    2         IF CDA~=0 THEN GOTO RDNXT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:91   

   5289  2 001760   001311 601000 2                  TNZ     RDNXT

      454     5290    2         END;

      455     5291    1      IF ENT#>3 THEN ALTRETURN;

   5291  2 001761   200014 235100                    LDA     ENT#,,AUTO
         2 001762   000003 115007                    CMPA    3,DL
         2 001763   001765 604400 2                  TMOZ    s:5293

   5291  2 001764   000000 702200 xent               TSX2  ! X66_AALT

      456     5292                    /* SWITCH TO ANOTHER VOLUME IF THIS ONE IS EMPTY (OR NEARLY SO) */
      457     5293    1      IF Y<=-O.SIZ/2 AND OVOL~=SRDZERO

   5293  2 001765   000000 236003                    LDQ     0,DU
         2 001766   200012 136100                    SBLQ    O+1,,AUTO
         2 001767   000002 506007                    DIV     2,DL
         2 001770   000000 116003                    CMPQ    0,DU
         2 001771   001774 604000 2                  TMI     s:5293+7
         2 001772   200021 116100                    CMPQ    Y,,AUTO
         2 001773   002000 604000 2                  TMI     s:5293+11
         2 001774   200016 236100                    LDQ     OVOL,,AUTO
         2 001775   002007 604000 2                  TMI     s:5296
         2 001776   200017 116100                    CMPQ    SRDZERO,,AUTO
         2 001777   002007 601000 2                  TNZ     s:5296
         2 002000   000000 236003                    LDQ     0,DU
         2 002001   200012 136100                    SBLQ    O+1,,AUTO
         2 002002   200021 116100                    CMPQ    Y,,AUTO
         2 002003   002035 601000 2                  TNZ     s:5306
         2 002004   200007 470500                    LDP0    SDCT$,,AUTO
         2 002005   000006 235100                    LDA     6,,PR0
         2 002006   002035 600000 2                  TZE     s:5306

      458     5294                    /* OR RGRANS SAYS THERE'S MORE WHEN THERE ISN'T */
      459     5295    2        OR Y=-O.SIZ AND FM$VOL.RGRANS~=0 THEN DO;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:92   

      460     5296    2         SIZE=OVOL;

   5296  2 002007   200016 235100                    LDA     OVOL,,AUTO
         2 002010   200010 755100                    STA     SIZE,,AUTO

      461     5297    2         IF SIZE=SRDZERO THEN SIZE=FM_SRZERO;

   5297  2 002011   200010 236100                    LDQ     SIZE,,AUTO
         2 002012   200017 116100                    CMPQ    SRDZERO,,AUTO
         2 002013   002016 601000 2                  TNZ     s:5298

   5297  2 002014   000000 235000 xsym               LDA     FM_SRZERO
         2 002015   200010 755100                    STA     SIZE,,AUTO

      462     5298    2         IF Y=-O.SIZ THEN FM$VOL.RGRANS=0;

   5298  2 002016   000000 236003                    LDQ     0,DU
         2 002017   200012 136100                    SBLQ    O+1,,AUTO
         2 002020   200021 116100                    CMPQ    Y,,AUTO
         2 002021   002024 601000 2                  TNZ     TRYANOTHER

   5298  2 002022   200007 470500                    LDP0    SDCT$,,AUTO
         2 002023   000006 450100                    STZ     6,,PR0

   5298  2 002024                       TRYANOTHER   null
      463     5299    2   TRYANOTHER:;
      464     5300    2         CALL GETVOL ALTRET(FAGE$PSGRANS);

   5300  2 002024   003545 701000 2                  TSX1    GETVOL
         2 002025   003152 702000 2                  TSX2    FAGE$PSGRANS

      465     5301    2         IF FM$VOL.RGRANS~=0 THEN GOTO GNEXT;

   5301  2 002026   200007 470500                    LDP0    SDCT$,,AUTO
         2 002027   000006 235100                    LDA     6,,PR0
         2 002030   001237 601000 2                  TNZ     GNEXT
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:93   

      466     5302    2         SIZE=SRDZERO+Y;

   5302  2 002031   200017 236100                    LDQ     SRDZERO,,AUTO
         2 002032   200021 036100                    ADLQ    Y,,AUTO
         2 002033   200010 756100                    STQ     SIZE,,AUTO

      467     5303                    /* FIND ONE WITH SOMETHING THERE */
      468     5304    2         GOTO TRYANOTHER;

   5304  2 002034   002024 710000 2                  TRA     TRYANOTHER

      469     5305    2         END;
      470     5306    1      ELSE IF Y=-O.SIZ THEN GOTO FAGE$PSGRANS;

   5306  2 002035   200021 116100                    CMPQ    Y,,AUTO
         2 002036   003152 600000 2                  TZE     FAGE$PSGRANS

      471     5307                    /*E* ERROR: FAG-E$PSGRANS-E
      472     5308                    *        MESSAGE: Packset% #%SN% disk space exhausted% for %UF%
      473     5309                    */
      474     5310    1      O.SIZ=Y+O.SIZ;

   5310  2 002037   200021 236100                    LDQ     Y,,AUTO
         2 002040   200012 036100                    ADLQ    O+1,,AUTO
         2 002041   200012 756100                    STQ     O+1,,AUTO

      475     5311    1      IF ENT#=3 THEN Y=-Y;

   5311  2 002042   200014 235100                    LDA     ENT#,,AUTO
         2 002043   000003 115007                    CMPA    3,DL
         2 002044   002047 601000 2                  TNZ     s:5312

   5311  2 002045   200021 335100                    LCA     Y,,AUTO
         2 002046   200021 755100                    STA     Y,,AUTO

      476     5312    1      IF CDA=FM_GPSDA THEN GOTO GEXT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:94   

   5312  2 002047   200022 236100                    LDQ     CDA,,AUTO
         2 002050   000000 116000 xsym               CMPQ    FM_GPSDA
         2 002051   001707 600000 2                  TZE     GEXT

      477     5313    1      GOTO RD1ST;

   5313  2 002052   001304 710000 2                  TRA     RD1ST

      478     5314        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:95   
      479     5315    1   REXT: X=0;Y=0;

   5315  2 002053   200020 450100       REXT         STZ     X,,AUTO

   5315  2 002054   200021 450100                    STZ     Y,,AUTO

      480     5316    2      IF VXH.N AND RXTN.EADR>PINCRW(VXH$,VXH.XTNS)->XBUF.ADR THEN DO;

   5316  2 002055   200006 470500                    LDP0    VXH$,,AUTO
         2 002056   000000 236100                    LDQ     0,,PR0
         2 002057   000400 316003                    CANQ    256,DU
         2 002060   002113 600000 2                  TZE     s:5327
         2 002061   000000 720100                    LXL0    0,,PR0
         2 002062   200010 721100                    LXL1    SIZE,,AUTO
         2 002063   000000 101110                    CMPX1   0,X0,PR0
         2 002064   002113 602000 2                  TNC     s:5327
         2 002065   002113 600000 2                  TZE     s:5327

      481     5317    2         XTN$=PINCRW(VXH$,VXH.XTNS-1);

   5317  2 002066   777777 636010                    EAQ     -1,X0
         2 002067   200006 036100                    ADLQ    VXH$,,AUTO
         2 002070   200005 756100                    STQ     XTN$,,AUTO

      482     5318    3         IF RXTN.ADR<PINCRW(XTN$,1)->XBUF.ADR THEN DO;

   5318  2 002071   200010 222100                    LDX2    SIZE,,AUTO
         2 002072   200005 471500                    LDP1    XTN$,,AUTO
         2 002073   100001 102100                    CMPX2   1,,PR1
         2 002074   002112 603000 2                  TRC     s:5325

      483     5319    3            IF RXTN.ADR<XBUF.EADR AND XTN$~=VXH$ THEN GOTO BUFERR;

   5319  2 002075   100000 723100                    LXL3    0,,PR1
         2 002076   200010 103100                    CMPX3   SIZE,,AUTO
         2 002077   002103 602000 2                  TNC     s:5320
         2 002100   002103 600000 2                  TZE     s:5320
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:96   
         2 002101   200006 116100                    CMPQ    VXH$,,AUTO
         2 002102   002764 601000 2                  TNZ     BUFERR

      484     5320    3            PINCRW(XTN$,1)->XBUF.ADR=RXTN.ADR;

   5320  2 002103   100001 742100                    STX2    1,,PR1

      485     5321    3            PINCRW(XTN$,1)->XBUF.EADR=RXTN.ADR;

   5321  2 002104   200010 220100                    LDX0    SIZE,,AUTO
         2 002105   100001 440100                    SXL0    1,,PR1

      486     5322                    /* CHOP THIS BUFFER SHORTER - CHECK FOR DUAL RELEASE IN NEXT ONE */
      487     5323    3            F$DCB.BFR.BUFUP(BUF#)='1'B;

   5323  2 002106   200024 473500                    LDP3    DCB$,,AUTO
         2 002107   200013 721100                    LXL1    BUF#,,AUTO
         2 002110   400000 236003                    LDQ     -131072,DU
         2 002111   300115 256111                    ORSQ    77,X1,PR3

      488     5324    3            END;

      489     5325    2         GOTO RDNXT0;

   5325  2 002112   001753 710000 2                  TRA     RDNXT0

      490     5326    2         END;
      491     5327    2      DO WHILE (X=0); /* FIND WHERE THIS EXTENT GOES */

   5327  2 002113   200020 235100                    LDA     X,,AUTO
         2 002114   002170 601000 2                  TNZ     s:5339

      492     5328    2         XTN$=PINCRW(VXH$,Y);

   5328  2 002115   200021 236100                    LDQ     Y,,AUTO
         2 002116   000022 736000                    QLS     18
         2 002117   200006 036100                    ADLQ    VXH$,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:97   
         2 002120   200005 756100                    STQ     XTN$,,AUTO

      493     5329    3         IF Y<VXH.XTNS-1 THEN DO;

   5329  2 002121   200006 470500                    LDP0    VXH$,,AUTO
         2 002122   000000 236100                    LDQ     0,,PR0
         2 002123   777777 376007                    ANQ     -1,DL
         2 002124   000001 136007                    SBLQ    1,DL
         2 002125   200021 116100                    CMPQ    Y,,AUTO
         2 002126   002154 604400 2                  TMOZ    s:5335

      494     5330    3            IF Y>0 AND XBUF.EADR>=XBUF.ADR1 THEN GOTO BUFERR;

   5330  2 002127   200021 235100                    LDA     Y,,AUTO
         2 002130   002135 604400 2                  TMOZ    s:5331
         2 002131   200005 471500                    LDP1    XTN$,,AUTO
         2 002132   100000 720100                    LXL0    0,,PR1
         2 002133   100001 100100                    CMPX0   1,,PR1
         2 002134   002764 603000 2                  TRC     BUFERR

      495     5331    3            IF XBUF.ADR1>=XBUF.EADR1 THEN GOTO BUFERR;

   5331  2 002135   200005 471500                    LDP1    XTN$,,AUTO
         2 002136   100001 720100                    LXL0    1,,PR1
         2 002137   100001 100100                    CMPX0   1,,PR1
         2 002140   002764 602000 2                  TNC     BUFERR
         2 002141   002764 600000 2                  TZE     BUFERR

      496     5332    3            IF RXTN.EADR=XBUF.ADR1 THEN X=2; /* FOUND ADJACENT EXTENT */

   5332  2 002142   200010 721100                    LXL1    SIZE,,AUTO
         2 002143   100001 101100                    CMPX1   1,,PR1
         2 002144   002147 601000 2                  TNZ     s:5333

   5332  2 002145   000002 235007                    LDA     2,DL
         2 002146   200020 755100                    STA     X,,AUTO

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:98   
      497     5333    3            IF RXTN.EADR<XBUF.ADR1 THEN X=4; /* MUST GO HERE */

   5333  2 002147   100001 101100                    CMPX1   1,,PR1
         2 002150   002156 603000 2                  TRC     s:5336

   5333  2 002151   000004 235007                    LDA     4,DL
         2 002152   200020 755100                    STA     X,,AUTO

      498     5334    3            END;

   5334  2 002153   002156 710000 2                  TRA     s:5336

      499     5335    2         ELSE X=4;

   5335  2 002154   000004 235007                    LDA     4,DL
         2 002155   200020 755100                    STA     X,,AUTO

      500     5336    2         IF Y>0 AND RXTN.ADR=XBUF.EADR THEN X=X+1; /* ADJACENT EXTENT */

   5336  2 002156   200021 235100                    LDA     Y,,AUTO
         2 002157   002165 604400 2                  TMOZ    s:5337
         2 002160   200005 471500                    LDP1    XTN$,,AUTO
         2 002161   100000 720100                    LXL0    0,,PR1
         2 002162   200010 100100                    CMPX0   SIZE,,AUTO
         2 002163   002165 601000 2                  TNZ     s:5337

   5336  2 002164   200020 054100                    AOS     X,,AUTO

      501     5337    2         Y=Y+1;

   5337  2 002165   200021 054100                    AOS     Y,,AUTO

      502     5338    2         END;

   5338  2 002166   200020 235100                    LDA     X,,AUTO
         2 002167   002115 600000 2                  TZE     s:5328

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:99   
      503     5339    1      IF Y>1 AND RXTN.ADR<XBUF.EADR THEN GOTO BUFERR; /* OVERLAP */

   5339  2 002170   200021 236100                    LDQ     Y,,AUTO
         2 002171   000001 116007                    CMPQ    1,DL
         2 002172   002200 604400 2                  TMOZ    s:5340
         2 002173   200005 471500                    LDP1    XTN$,,AUTO
         2 002174   100000 720100                    LXL0    0,,PR1
         2 002175   200010 100100                    CMPX0   SIZE,,AUTO
         2 002176   002200 600000 2                  TZE     s:5340
         2 002177   002764 603000 2                  TRC     BUFERR

      504     5340    2      DO CASE(X); /* COALESCE IF POSSIBLE */

   5340  2 002200   000006 115007                    CMPA    6,DL
         2 002201   002203 602005 2                  TNC     s:5340+3,AL
         2 002202   002660 710000 2                  TRA     s:5421
         2 002203   002660 710000 2                  TRA     s:5421
         2 002204   002211 710000 2                  TRA     s:5342
         2 002205   002212 710000 2                  TRA     s:5344
         2 002206   002216 710000 2                  TRA     s:5346
         2 002207   002224 710000 2                  TRA     s:5349
         2 002210   002655 710000 2                  TRA     s:5419

      505     5341    2      CASE(1); /* ADR=EADR0, EADR>ADR1 ..OVERLAP */

      506     5342    2         GOTO BUFERR;

   5342  2 002211   002764 710000 2                  TRA     BUFERR

      507     5343    2      CASE(2); /* EADR=ADR1 .. COALESCE */

      508     5344    2         XBUF.ADR1=RXTN.ADR;

   5344  2 002212   200010 220100                    LDX0    SIZE,,AUTO
         2 002213   200005 471500                    LDP1    XTN$,,AUTO
         2 002214   100001 740100                    STX0    1,,PR1
         2 002215   002660 710000 2                  TRA     s:5421
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:100  

      509     5345    2      CASE(3); /* ADR=EADR0, EADR=ADR1 .. DOUBLE MATCH */

      510     5346    2         XBUF.ADR1=XBUF.ADR;

   5346  2 002216   200005 471500                    LDP1    XTN$,,AUTO
         2 002217   100000 220100                    LDX0    0,,PR1
         2 002220   100001 740100                    STX0    1,,PR1

      511     5347    2         CALL SQZ;

   5347  2 002221   003474 701000 2                  TSX1    SQZ
         2 002222   000000 011000                    NOP     0
         2 002223   002660 710000 2                  TRA     s:5421

      512     5348    2      CASE(4); /* NO MATCH */

      513     5349    3         IF FM$GRAN.NAVX<1024 THEN DO;

   5349  2 002224   200023 471500                    LDP1    BUF$,,AUTO
         2 002225   100001 220100                    LDX0    1,,PR1
         2 002226   002000 100003                    CMPX0   1024,DU
         2 002227   002304 603000 2                  TRC     s:5360

      514     5350    3            X=FM$GRAN.NAVX-POFFW(XTN$,BUF$);

   5350  2 002230   200023 235100                    LDA     BUF$,,AUTO
         2 002231   000022 771000                    ARL     18
         2 002232   200032 755100                    STA     FIT$+4,,AUTO
         2 002233   200005 236100                    LDQ     XTN$,,AUTO
         2 002234   000022 772000                    QRL     18
         2 002235   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 002236   200033 756100                    STQ     FIT$+5,,AUTO
         2 002237   100001 236100                    LDQ     1,,PR1
         2 002240   000022 772000                    QRL     18
         2 002241   200033 136100                    SBLQ    FIT$+5,,AUTO
         2 002242   200020 756100                    STQ     X,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:101  

      515     5351    3            T$=XTN$;

   5351  2 002243   200005 236100                    LDQ     XTN$,,AUTO
         2 002244   200004 756100                    STQ     T$,,AUTO

      516     5352    3            CALL FMR$SLIDE(T$,1,X);

   5352  2 002245   200020 633500                    EPPR3   X,,AUTO
         2 002246   200034 453500                    STP3    FIT$+6,,AUTO
         2 002247   000007 236000 3                  LDQ     7
         2 002250   200033 756100                    STQ     FIT$+5,,AUTO
         2 002251   200004 634500                    EPPR4   T$,,AUTO
         2 002252   200032 454500                    STP4    FIT$+4,,AUTO
         2 002253   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 002254   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002255   000000 701000 xent               TSX1    FMR$SLIDE
         2 002256   000000 011000                    NOP     0

      517     5353    3            FM$GRAN.NAVX=FM$GRAN.NAVX+1;

   5353  2 002257   200023 470500                    LDP0    BUF$,,AUTO
         2 002260   000001 220100                    LDX0    1,,PR0
         2 002261   000001 621010                    EAX1    1,X0
         2 002262   000001 741100                    STX1    1,,PR0

      518     5354    3            FM$GRAN.AVAIL=1024-FM$GRAN.NAVX;

   5354  2 002263   000001 236100                    LDQ     1,,PR0
         2 002264   000022 772000                    QRL     18
         2 002265   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 002266   002001 036007                    ADLQ    1025,DL
         2 002267   000001 676100                    ERQ     1,,PR0
         2 002270   001777 376007                    ANQ     1023,DL
         2 002271   000001 656100                    ERSQ    1,,PR0

      519     5355    3            VXH.XTNS=VXH.XTNS+1;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:102  

   5355  2 002272   200006 471500                    LDP1    VXH$,,AUTO
         2 002273   100000 720100                    LXL0    0,,PR1
         2 002274   000001 622010                    EAX2    1,X0
         2 002275   100000 442100                    SXL2    0,,PR1

      520     5356    3            XBUF.ADR1=RXTN.ADR;

   5356  2 002276   200010 220100                    LDX0    SIZE,,AUTO
         2 002277   200005 473500                    LDP3    XTN$,,AUTO
         2 002300   300001 740100                    STX0    1,,PR3

      521     5357    3            XBUF.EADR1=RXTN.EADR;

   5357  2 002301   200010 721100                    LXL1    SIZE,,AUTO
         2 002302   300001 441100                    SXL1    1,,PR3

      522     5358    3            END;

   5358  2 002303   002660 710000 2                  TRA     s:5421

      523     5359    3         ELSE DO;

      524     5360    3            CALL FMD$GETBUF(3,1,T$);

   5360  2 002304   200004 633500                    EPPR3   T$,,AUTO
         2 002305   200034 453500                    STP3    FIT$+6,,AUTO
         2 002306   000024 237000 3                  LDAQ    20
         2 002307   200032 757100                    STAQ    FIT$+4,,AUTO
         2 002310   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 002311   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002312   000000 701000 xent               TSX1    FMD$GETBUF
         2 002313   000000 011000                    NOP     0

      525     5361    3            XTN$=T$;

   5361  2 002314   200004 236100                    LDQ     T$,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:103  
         2 002315   200005 756100                    STQ     XTN$,,AUTO

      526     5362    3            XTN$->GRANULE=BUF$->GRANULE; /* COPY THE GRANULE */

   5362  2 002316   200023 470500                    LDP0    BUF$,,AUTO
         2 002317   010000 220003                    LDX0    4096,DU
         2 002320   200005 471500                    LDP1    XTN$,,AUTO
         2 002321   040140 100540                    MLR     fill='040'O
         2 002322   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 002323   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

      527     5363    3            X=POFFW(VXH$,BUF$); /* WHERE ARE WE IN THIS GRANULE */

   5363  2 002324   200023 235100                    LDA     BUF$,,AUTO
         2 002325   000022 771000                    ARL     18
         2 002326   200032 755100                    STA     FIT$+4,,AUTO
         2 002327   200006 236100                    LDQ     VXH$,,AUTO
         2 002330   000022 772000                    QRL     18
         2 002331   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 002332   200020 756100                    STQ     X,,AUTO

      528     5364    3            Y=1023-X-VXH.XTNS; /* SPACE AT END OF GRAN */

   5364  2 002333   200006 473500                    LDP3    VXH$,,AUTO
         2 002334   300000 236100                    LDQ     0,,PR3
         2 002335   777777 376007                    ANQ     -1,DL
         2 002336   200020 036100                    ADLQ    X,,AUTO
         2 002337   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 002340   002000 036007                    ADLQ    1024,DL
         2 002341   200021 756100                    STQ     Y,,AUTO

      529     5365    4            IF X<512 THEN DO; /* SPLIT MAY NOT BE BEFORE THIS VOL */

   5365  2 002342   200020 235100                    LDA     X,,AUTO
         2 002343   001000 115007                    CMPA    512,DL
         2 002344   002475 605000 2                  TPL     REXT5

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:104  
      530     5366    5               IF X=FM$GRAN.FCEX AND Y=0 THEN DO; /* ALL ONE VOLUME, SPLIT IT */

   5366  2 002345   000002 236100                    LDQ     2,,PR0
         2 002346   000022 772000                    QRL     18
         2 002347   200020 116100                    CMPQ    X,,AUTO
         2 002350   002462 601000 2                  TNZ     s:5382
         2 002351   200021 235100                    LDA     Y,,AUTO
         2 002352   002462 601000 2                  TNZ     s:5382

      531     5367    5                  CFU$=PINCRW(XTN$,X);

   5367  2 002353   200020 236100                    LDQ     X,,AUTO
         2 002354   000022 736000                    QLS     18
         2 002355   200005 036100                    ADLQ    XTN$,,AUTO
         2 002356   200025 756100                    STQ     CFU$,,AUTO

      532     5368    5                  X=VXH.XTNS/2; /* DECIDE HOW MUCH TO SPLIT OFF */

   5368  2 002357   300000 236100                    LDQ     0,,PR3
         2 002360   777777 376007                    ANQ     -1,DL
         2 002361   000001 772000                    QRL     1
         2 002362   200020 756100                    STQ     X,,AUTO

      533     5369    5                  Y=VXH.XTNS-X; /* AND HOW MUCH TO LEAVE */

   5369  2 002363   300000 236100                    LDQ     0,,PR3
         2 002364   777777 376007                    ANQ     -1,DL
         2 002365   200020 136100                    SBLQ    X,,AUTO
         2 002366   200021 756100                    STQ     Y,,AUTO

      534     5370    5                  CFU$->VXH.XTNS=Y;

   5370  2 002367   000000 621006                    EAX1    0,QL
         2 002370   200025 474500                    LDP4    CFU$,,AUTO
         2 002371   400000 441100                    SXL1    0,,PR4

      535     5371    5                  CFU$->VXH.P='1'B;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:105  

   5371  2 002372   200025 474500                    LDP4    CFU$,,AUTO
         2 002373   000200 236003                    LDQ     128,DU
         2 002374   400000 256100                    ORSQ    0,,PR4

      536     5372    5                  VXH.XTNS=X+1;

   5372  2 002375   200020 721100                    LXL1    X,,AUTO
         2 002376   000001 622011                    EAX2    1,X1
         2 002377   300000 442100                    SXL2    0,,PR3

      537     5373    5                  VXH.N='1'B;

   5373  2 002400   000400 236003                    LDQ     256,DU
         2 002401   300000 256100                    ORSQ    0,,PR3

      538     5374    5                  CALL FMR$SLIDE(PINCRW(CFU$,1),-X,Y);

   5374  2 002402   200025 236100                    LDQ     CFU$,,AUTO
         2 002403   000001 036003                    ADLQ    1,DU
         2 002404   200032 756100                    STQ     FIT$+4,,AUTO
         2 002405   200020 335100                    LCA     X,,AUTO
         2 002406   200033 755100                    STA     FIT$+5,,AUTO
         2 002407   200021 634500                    EPPR4   Y,,AUTO
         2 002410   200036 454500                    STP4    FIT$+8,,AUTO
         2 002411   200033 635500                    EPPR5   FIT$+5,,AUTO
         2 002412   200035 455500                    STP5    FIT$+7,,AUTO
         2 002413   200032 636500                    EPPR6   FIT$+4,,AUTO
         2 002414   200034 456500                    STP6    FIT$+6,,AUTO
         2 002415   200034 630500                    EPPR0   FIT$+6,,AUTO
         2 002416   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002417   000000 701000 xent               TSX1    FMR$SLIDE
         2 002420   000000 011000                    NOP     0

      539     5375    5                  CFU$=PINCRW(VXH$,X+1); /* TERMINATE VOLUME LIST */

   5375  2 002421   200020 236100                    LDQ     X,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:106  
         2 002422   000022 736000                    QLS     18
         2 002423   000001 036003                    ADLQ    1,DU
         2 002424   200006 036100                    ADLQ    VXH$,,AUTO
         2 002425   200025 756100                    STQ     CFU$,,AUTO

      540     5376    5                  CFU$->XBUF.EADR=CFU$->XBUF.ADR;

   5376  2 002426   200025 470500                    LDP0    CFU$,,AUTO
         2 002427   000000 220100                    LDX0    0,,PR0
         2 002430   000000 440100                    SXL0    0,,PR0

      541     5377    5                  IF RXTN.ADR>CFU$->XBUF.ADR THEN VXH$=PINCRW(XTN$,FM$GRAN.FCEX);

   5377  2 002431   200025 470500                    LDP0    CFU$,,AUTO
         2 002432   000000 220100                    LDX0    0,,PR0
         2 002433   200010 100100                    CMPX0   SIZE,,AUTO
         2 002434   002442 603000 2                  TRC     s:5378

   5377  2 002435   200023 471500                    LDP1    BUF$,,AUTO
         2 002436   100002 221100                    LDX1    2,,PR1
         2 002437   000000 636011                    EAQ     0,X1
         2 002440   200005 036100                    ADLQ    XTN$,,AUTO
         2 002441   200006 756100                    STQ     VXH$,,AUTO

      542     5378    5                  FM$GRAN.NAVX=POFFW(CFU$,BUF$)+1;

   5378  2 002442   200023 235100                    LDA     BUF$,,AUTO
         2 002443   000022 771000                    ARL     18
         2 002444   200032 755100                    STA     FIT$+4,,AUTO
         2 002445   200025 236100                    LDQ     CFU$,,AUTO
         2 002446   000022 772000                    QRL     18
         2 002447   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 002450   000001 620006                    EAX0    1,QL
         2 002451   200023 471500                    LDP1    BUF$,,AUTO
         2 002452   100001 740100                    STX0    1,,PR1

      543     5379    5                  XTN$->FM$GRAN.NAVX=XTN$->FM$GRAN.NAVX-X;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:107  

   5379  2 002453   200005 470500                    LDP0    XTN$,,AUTO
         2 002454   000001 236100                    LDQ     1,,PR0
         2 002455   000022 772000                    QRL     18
         2 002456   200020 136100                    SBLQ    X,,AUTO
         2 002457   000000 621006                    EAX1    0,QL
         2 002460   000001 741100                    STX1    1,,PR0

      544     5380    5                  GOTO REXT10;

   5380  2 002461   002544 710000 2                  TRA     REXT10

      545     5381    5                  END;
      546     5382    5               ELSE IF Y>X-FM$GRAN.FCEX THEN DO;

   5382  2 002462   200032 756100                    STQ     FIT$+4,,AUTO
         2 002463   200020 236100                    LDQ     X,,AUTO
         2 002464   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 002465   200021 116100                    CMPQ    Y,,AUTO
         2 002466   002475 605000 2                  TPL     REXT5

      547     5383    5                     FM$GRAN.NAVX=FM$GRAN.NAVX-Y;

   5383  2 002467   000001 236100                    LDQ     1,,PR0
         2 002470   000022 772000                    QRL     18
         2 002471   200021 136100                    SBLQ    Y,,AUTO
         2 002472   000000 621006                    EAX1    0,QL
         2 002473   000001 741100                    STX1    1,,PR0

      548     5384    5                     END;

   5384  2 002474   002503 710000 2                  TRA     s:5392

      549     5385    4                  ELSE GOTO REXT5;
      550     5386    4               END;
      551     5387    4            ELSE DO;

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:108  
   5382  2 002475                       REXT5        null
      552     5388    4   REXT5:      ;
      553     5389    4               FM$GRAN.NAVX=X; /* MOVE THIS VOL TO NEXT GRAN */

   5389  2 002475   200020 721100                    LXL1    X,,AUTO
         2 002476   000001 741100                    STX1    1,,PR0

      554     5390    4               VXH$=PINCRW(XTN$,FM$GRAN.FCEX);

   5390  2 002477   000002 222100                    LDX2    2,,PR0
         2 002500   000000 636012                    EAQ     0,X2
         2 002501   200005 036100                    ADLQ    XTN$,,AUTO
         2 002502   200006 756100                    STQ     VXH$,,AUTO

      555     5391    4               END;

      556     5392    3            Y=1024-FM$GRAN.NAVX;

   5392  2 002503   000001 236100                    LDQ     1,,PR0
         2 002504   000022 772000                    QRL     18
         2 002505   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 002506   002001 036007                    ADLQ    1025,DL
         2 002507   200021 756100                    STQ     Y,,AUTO

      557     5393    3            X=FM$GRAN.FCEX-FM$GRAN.NAVX;

   5393  2 002510   000001 236100                    LDQ     1,,PR0
         2 002511   000022 772000                    QRL     18
         2 002512   200032 756100                    STQ     FIT$+4,,AUTO
         2 002513   000002 236100                    LDQ     2,,PR0
         2 002514   000022 772000                    QRL     18
         2 002515   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 002516   200020 756100                    STQ     X,,AUTO

      558     5394    3            CALL FMR$SLIDE(PINCRW(XTN$,FM$GRAN.FCEX),X,Y);

   5394  2 002517   000002 221100                    LDX1    2,,PR0
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:109  
         2 002520   000000 636011                    EAQ     0,X1
         2 002521   200005 036100                    ADLQ    XTN$,,AUTO
         2 002522   200032 756100                    STQ     FIT$+4,,AUTO
         2 002523   200021 633500                    EPPR3   Y,,AUTO
         2 002524   200035 453500                    STP3    FIT$+7,,AUTO
         2 002525   200020 634500                    EPPR4   X,,AUTO
         2 002526   200034 454500                    STP4    FIT$+6,,AUTO
         2 002527   200032 635500                    EPPR5   FIT$+4,,AUTO
         2 002530   200033 455500                    STP5    FIT$+5,,AUTO
         2 002531   200033 630500                    EPPR0   FIT$+5,,AUTO
         2 002532   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002533   000000 701000 xent               TSX1    FMR$SLIDE
         2 002534   000000 011000                    NOP     0

      559     5395    3            XTN$->FM$GRAN.NAVX=FM$GRAN.FCEX+Y;

   5395  2 002535   200023 470500                    LDP0    BUF$,,AUTO
         2 002536   000002 236100                    LDQ     2,,PR0
         2 002537   000022 772000                    QRL     18
         2 002540   200021 036100                    ADLQ    Y,,AUTO
         2 002541   000000 620006                    EAX0    0,QL
         2 002542   200005 471500                    LDP1    XTN$,,AUTO
         2 002543   100001 740100                    STX0    1,,PR1

   5395  2 002544                       REXT10       null
      560     5396    3   REXT10:  ;
      561     5397                    /* SET UP THE NEW GRANULE */
      562     5398    3            XTN$->FM$GRAN.BLINK=CDA;

   5398  2 002544   200005 470500                    LDP0    XTN$,,AUTO
         2 002545   200022 235100                    LDA     CDA,,AUTO
         2 002546   000003 755100                    STA     3,,PR0

      563     5399    3            XTN$->FM$GRAN.AVAIL=1024-XTN$->FM$GRAN.NAVX;

   5399  2 002547   000001 236100                    LDQ     1,,PR0
         2 002550   000022 772000                    QRL     18
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:110  
         2 002551   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 002552   002001 036007                    ADLQ    1025,DL
         2 002553   000001 676100                    ERQ     1,,PR0
         2 002554   001777 376007                    ANQ     1023,DL
         2 002555   000001 656100                    ERSQ    1,,PR0

      564     5400    3            F$DCB.BFR.DA(3)=RXTN.ADR+SRDZERO;

   5400  2 002556   200010 236100                    LDQ     SIZE,,AUTO
         2 002557   000022 772000                    QRL     18
         2 002560   200017 036100                    ADLQ    SRDZERO,,AUTO
         2 002561   200024 471500                    LDP1    DCB$,,AUTO
         2 002562   100120 552134                    STBQ    80,'34'O,PR1

      565     5401    3            XTN$->FM$GRAN.STAMP.GMOD=F$DCB.BFR.DA(3);

   5401  2 002563   100120 236100                    LDQ     80,,PR1
         2 002564   000000 552104                    STBQ    0,'04'O,PR0

      566     5402    3            RXTN.ADR=RXTN.ADR+1;

   5402  2 002565   200010 220100                    LDX0    SIZE,,AUTO
         2 002566   000001 621010                    EAX1    1,X0
         2 002567   200010 741100                    STX1    SIZE,,AUTO

      567     5403                    /* NOW THE OLD GRANULE */
      568     5404    3            FM$GRAN.AVAIL=1024-FM$GRAN.NAVX;

   5404  2 002570   200023 473500                    LDP3    BUF$,,AUTO
         2 002571   300001 236100                    LDQ     1,,PR3
         2 002572   000022 772000                    QRL     18
         2 002573   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 002574   002001 036007                    ADLQ    1025,DL
         2 002575   300001 676100                    ERQ     1,,PR3
         2 002576   001777 376007                    ANQ     1023,DL
         2 002577   300001 656100                    ERSQ    1,,PR3

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:111  
      569     5405    3            X=FM$GRAN.FLINK;

   5405  2 002600   300004 235100                    LDA     4,,PR3
         2 002601   200020 755100                    STA     X,,AUTO

      570     5406    3            FM$GRAN.FLINK=F$DCB.BFR.DA(3);

   5406  2 002602   100120 236100                    LDQ     80,,PR1
         2 002603   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002604   300004 756100                    STQ     4,,PR3

      571     5407    4            IF X~=0 THEN DO;

   5407  2 002605   200020 235100                    LDA     X,,AUTO
         2 002606   002640 600000 2                  TZE     s:5413

      572     5408    4               F$DCB.GTYP=FMGTGP;

   5408  2 002607   100064 236100                    LDQ     52,,PR1
         2 002610   000022 376000 3                  ANQ     18
         2 002611   004000 276003                    ORQ     2048,DU
         2 002612   100064 756100                    STQ     52,,PR1

      573     5409    4               CALL FMD$REDBUF(T$,2,X,0,CDA)ALTRET(RETALT0);

   5409  2 002613   200022 634500                    EPPR4   CDA,,AUTO
         2 002614   200036 454500                    STP4    FIT$+8,,AUTO
         2 002615   000003 236000 3                  LDQ     3
         2 002616   200035 756100                    STQ     FIT$+7,,AUTO
         2 002617   200020 635500                    EPPR5   X,,AUTO
         2 002620   200034 455500                    STP5    FIT$+6,,AUTO
         2 002621   000004 236000 3                  LDQ     4
         2 002622   200033 756100                    STQ     FIT$+5,,AUTO
         2 002623   200004 636500                    EPPR6   T$,,AUTO
         2 002624   200032 456500                    STP6    FIT$+4,,AUTO
         2 002625   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 002626   000023 631400 xsym               EPPR1   B_VECTNIL+19
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:112  
         2 002627   000000 701000 xent               TSX1    FMD$REDBUF
         2 002630   003051 702000 2                  TSX2    RETALT0

      574     5410    4               CFU$=T$;

   5410  2 002631   200004 236100                    LDQ     T$,,AUTO
         2 002632   200025 756100                    STQ     CFU$,,AUTO

      575     5411    4               CFU$->FM$GRAN.BLINK=F$DCB.BFR.DA(3);

   5411  2 002633   200024 470500                    LDP0    DCB$,,AUTO
         2 002634   000120 236100                    LDQ     80,,PR0
         2 002635   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002636   200025 471500                    LDP1    CFU$,,AUTO
         2 002637   100003 756100                    STQ     3,,PR1

      576     5412    4               END;

      577     5413    4            IF RXTN.EADR>RXTN.ADR THEN DO;

   5413  2 002640   200010 720100                    LXL0    SIZE,,AUTO
         2 002641   200010 100100                    CMPX0   SIZE,,AUTO
         2 002642   002660 602000 2                  TNC     s:5421
         2 002643   002660 600000 2                  TZE     s:5421

      578     5414    4               IF VXH$=PINCRW(XTN$,FM$GRAN.FCEX) THEN BUF$=XTN$;

   5414  2 002644   200023 470500                    LDP0    BUF$,,AUTO
         2 002645   000002 221100                    LDX1    2,,PR0
         2 002646   000000 636011                    EAQ     0,X1
         2 002647   200005 036100                    ADLQ    XTN$,,AUTO
         2 002650   200006 116100                    CMPQ    VXH$,,AUTO
         2 002651   002654 601000 2                  TNZ     s:5415

   5414  2 002652   200005 236100                    LDQ     XTN$,,AUTO
         2 002653   200023 756100                    STQ     BUF$,,AUTO

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:113  
      579     5415    4               GOTO REXT;

   5415  2 002654   002053 710000 2                  TRA     REXT

      580     5416    4               END;
      581     5417    3            END;
      582     5418    2      CASE(5); /* ADR=EADR0 .. COALESCE */

      583     5419    2         XBUF.EADR=RXTN.EADR;

   5419  2 002655   200010 720100                    LXL0    SIZE,,AUTO
         2 002656   200005 471500                    LDP1    XTN$,,AUTO
         2 002657   100000 440100                    SXL0    0,,PR1

      584     5420    2      END;

      585     5421    1      IF PINCRW(VXH$,VXH.XTNS-1)->ABUF='0'B THEN CALL SC_GPERR;

   5421  2 002660   200006 470500                    LDP0    VXH$,,AUTO
         2 002661   000000 720100                    LXL0    0,,PR0
         2 002662   077777 235110                    LDA     -1,X0,PR0
         2 002663   002666 601000 2                  TNZ     s:5422

   5421  2 002664   000000 713400 xsym               CLIMB   SC_GPERR
         2 002665   000000 600000 xsid               climb   nvectors=         0

      586     5422    1      IF F$DCB.BFR.BUFX(2)~=0 THEN CALL FMD$WRTBUF(2);

   5422  2 002666   200024 470500                    LDP0    DCB$,,AUTO
         2 002667   000117 236100                    LDQ     79,,PR0
         2 002670   037000 316003                    CANQ    15872,DU
         2 002671   002676 600000 2                  TZE     s:5423

   5422  2 002672   000004 630400 3                  EPPR0   4
         2 002673   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002674   000000 701000 xent               TSX1    FMD$WRTBUF
         2 002675   000000 011000                    NOP     0
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:114  

      587     5423    1      IF F$DCB.BFR.BUFX(3)~=0 THEN CALL FMD$WRTBUF(3);

   5423  2 002676   200024 470500                    LDP0    DCB$,,AUTO
         2 002677   000120 236100                    LDQ     80,,PR0
         2 002700   037000 316003                    CANQ    15872,DU
         2 002701   002706 600000 2                  TZE     s:5424

   5423  2 002702   000005 630400 3                  EPPR0   5
         2 002703   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002704   000000 701000 xent               TSX1    FMD$WRTBUF
         2 002705   000000 011000                    NOP     0

      588     5424    1      FM$VOL.RGRANS=FM$VOL.RGRANS+RXTN.EADR-RXTN.ADR;

   5424  2 002706   200007 470500                    LDP0    SDCT$,,AUTO
         2 002707   200010 236100                    LDQ     SIZE,,AUTO
         2 002710   777777 376007                    ANQ     -1,DL
         2 002711   000006 036100                    ADLQ    6,,PR0
         2 002712   200010 235100                    LDA     SIZE,,AUTO
         2 002713   000022 771000                    ARL     18
         2 002714   200032 755100                    STA     FIT$+4,,AUTO
         2 002715   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 002716   000006 756100                    STQ     6,,PR0

      589     5425    2      IF ENT#=5 THEN DO; /* CONTINUE IF DOING A WHOLE FILE */

   5425  2 002717   200014 235100                    LDA     ENT#,,AUTO
         2 002720   000005 115007                    CMPA    5,DL
         2 002721   002727 601000 2                  TNZ     s:5429

      590     5426    2         F$DCB.BFR.BUFUP(BUF#)='1'B;

   5426  2 002722   200024 471500                    LDP1    DCB$,,AUTO
         2 002723   200013 720100                    LXL0    BUF#,,AUTO
         2 002724   400000 236003                    LDQ     -131072,DU
         2 002725   100115 256110                    ORSQ    77,X0,PR1
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:115  

      591     5427    2         GOTO RELNEXT;

   5427  2 002726   000612 710000 2                  TRA     RELNEXT

      592     5428    2         END;
      593     5429    1      CALL FMD$WRTBUF(BUF#);

   5429  2 002727   200013 631500                    EPPR1   BUF#,,AUTO
         2 002730   200032 451500                    STP1    FIT$+4,,AUTO
         2 002731   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 002732   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002733   000000 701000 xent               TSX1    FMD$WRTBUF
         2 002734   000000 011000                    NOP     0

      594     5430    1      CALL DEQUEUE;

   5430  2 002735   200024 470500                    LDP0    DCB$,,AUTO
         2 002736   000051 236100                    LDQ     41,,PR0
         2 002737   000003 736000                    QLS     3
         2 002740   000001 376000 3                  ANQ     1
         2 002741   000022 736000                    QLS     18
         2 002742   000006 036003                    ADLQ    6,DU
         2 002743   000000 036000 xsym               ADLQ    FM$SET$
         2 002744   200032 756100                    STQ     FIT$+4,,AUTO
         2 002745   200032 631500                    EPPR1   FIT$+4,,AUTO
         2 002746   200033 451500                    STP1    FIT$+5,,AUTO
         2 002747   200033 630500                    EPPR0   FIT$+5,,AUTO
         2 002750   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002751   000000 701000 xent               TSX1    UQB$MDEQ
         2 002752   000000 011000                    NOP     0

   5425  2 002753                       RETRET       null
      595     5431    1   RETRET:;
      596     5432    1      B$JIT.ERR='0'B;

   5432  2 002753   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:116  
         2 002754   000012 450100                    STZ     10,,PR0

      597     5433    1      RETURN;

   5433  2 002755   000000 702200 xent               TSX2  ! X66_ARET

      598     5434    1   ENQERR:B$JIT.ERR=FAG$E$NOCODE|BINBIT(B$JIT.ERR.CODE*8,36);

   5434  2 002756   000000 470400 xsym  ENQERR       LDP0    B$JIT$
         2 002757   000012 236100                    LDQ     10,,PR0
         2 002760   377770 376007                    ANQ     131064,DL
         2 002761   000004 276000 1                  ORQ     FAG$E$NOCODE
         2 002762   000012 756100                    STQ     10,,PR0

      599     5435    1      ALTRETURN;

   5435  2 002763   000000 702200 xent               TSX2  ! X66_AALT

   5432  2 002764                       BUFERR       null
      600     5436    1   BUFERR:;
      601     5437    1      T$=BUF$;

   5437  2 002764   200023 236100                    LDQ     BUF$,,AUTO
         2 002765   200004 756100                    STQ     T$,,AUTO

      602     5438    1      O.ADR=POFFW(XTN$,BUF$);

   5438  2 002766   200023 235100                    LDA     BUF$,,AUTO
         2 002767   000022 771000                    ARL     18
         2 002770   200032 755100                    STA     FIT$+4,,AUTO
         2 002771   200005 236100                    LDQ     XTN$,,AUTO
         2 002772   000022 772000                    QRL     18
         2 002773   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 002774   200011 756100                    STQ     O,,AUTO

      603     5439    1      O.SIZ=O.ADR+1;

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:117  
   5439  2 002775   000001 036007                    ADLQ    1,DL
         2 002776   200012 756100                    STQ     O+1,,AUTO

      604     5440    1      X=POFFW(VXH$,BUF$);

   5440  2 002777   200032 755100                    STA     FIT$+4,,AUTO
         2 003000   200006 236100                    LDQ     VXH$,,AUTO
         2 003001   000022 772000                    QRL     18
         2 003002   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 003003   200020 756100                    STQ     X,,AUTO

      605     5441    1      CALL FMB$LOGERR(%E$GP,20,0,CDA,T$,O.ADR,O.SIZ,X,RXTN);

   5441  2 003004   200010 630500                    EPPR0   SIZE,,AUTO
         2 003005   200042 450500                    STP0    FIT$+12,,AUTO
         2 003006   200020 631500                    EPPR1   X,,AUTO
         2 003007   200041 451500                    STP1    FIT$+11,,AUTO
         2 003010   200012 633500                    EPPR3   O+1,,AUTO
         2 003011   200040 453500                    STP3    FIT$+10,,AUTO
         2 003012   200011 634500                    EPPR4   O,,AUTO
         2 003013   200037 454500                    STP4    FIT$+9,,AUTO
         2 003014   200004 635500                    EPPR5   T$,,AUTO
         2 003015   200036 455500                    STP5    FIT$+8,,AUTO
         2 003016   200022 636500                    EPPR6   CDA,,AUTO
         2 003017   200035 456500                    STP6    FIT$+7,,AUTO
         2 003020   000003 236000 3                  LDQ     3
         2 003021   200034 756100                    STQ     FIT$+6,,AUTO
         2 003022   000026 237000 3                  LDAQ    22
         2 003023   200032 757100                    STAQ    FIT$+4,,AUTO
         2 003024   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 003025   000015 631400 3                  EPPR1   13
         2 003026   000000 701000 xent               TSX1    FMB$LOGERR
         2 003027   000000 011000                    NOP     0

      606     5442    1      B$JIT.ERR=FAG$E$GP;

   5442  2 003030   000003 236000 1                  LDQ     FAG$E$GP
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:118  
         2 003031   000000 470400 xsym               LDP0    B$JIT$
         2 003032   000012 756100                    STQ     10,,PR0

      607     5443    1      GOTO RETALT1;

   5443  2 003033   003104 710000 2                  TRA     RETALT1

   5442  2 003034                       FAGSCR       null
      608     5444    1   FAGSCR:;
      609     5445    1      PINCRW(BUF$,FM$GRAN.FCEX)->VXH='0'B;

   5445  2 003034   200023 470500                    LDP0    BUF$,,AUTO
         2 003035   000002 220100                    LDX0    2,,PR0
         2 003036   000000 450110                    STZ     0,X0,PR0

      610     5446    1      FM$GRAN.NAVX=FM$GRAN.FCEX;

   5446  2 003037   000002 220100                    LDX0    2,,PR0
         2 003040   000001 740100                    STX0    1,,PR0

      611     5447    1      CALL FMD$WRTSV(BUF#);

   5447  2 003041   200013 631500                    EPPR1   BUF#,,AUTO
         2 003042   200032 451500                    STP1    FIT$+4,,AUTO
         2 003043   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 003044   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003045   000000 701000 xent               TSX1    FMD$WRTSV
         2 003046   000000 011000                    NOP     0

      612     5448    1      CALL SC_GPERR;

   5448  2 003047   000000 713400 xsym               CLIMB   SC_GPERR
         2 003050   000000 600000 xsid               climb   nvectors=         0

   5446  2 003051                       RETALT0      null
      613     5449                    /*S*     SCREECH_CODE: FAG-S$GPERR
      614     5450                    *        TYPE: SCREECH
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:119  
      615     5451                    *        MESSAGE: Inconsistency in a free-extent list.
      616     5452                    */
      617     5453    1   RETALT0:;
      618     5454    1      CALL FMD$RELBUF(2);

   5454  2 003051   000004 630400 3                  EPPR0   4
         2 003052   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003053   000000 701000 xent               TSX1    FMD$RELBUF
         2 003054   000000 011000                    NOP     0

      619     5455    1      CALL FMD$RELBUF(3);

   5455  2 003055   000005 630400 3                  EPPR0   5
         2 003056   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003057   000000 701000 xent               TSX1    FMD$RELBUF
         2 003060   000000 011000                    NOP     0

      620     5456    1      GOTO RETALT1;

   5456  2 003061   003104 710000 2                  TRA     RETALT1

      621     5457    1   RELALT: RXTN=B$JIT.ERR; /* SAVE ERROR CODE */

   5457  2 003062   000000 470400 xsym  RELALT       LDP0    B$JIT$
         2 003063   000012 236100                    LDQ     10,,PR0
         2 003064   200010 756100                    STQ     SIZE,,AUTO

      622     5458    1      CALL FAG$REXT(O); /* RETURN THE UNUSABLE EXTENT */

   5458  2 003065   200011 631500                    EPPR1   O,,AUTO
         2 003066   200032 451500                    STP1    FIT$+4,,AUTO
         2 003067   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 003070   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003071   000113 701000 2                  TSX1    s:5035
         2 003072   000000 011000                    NOP     0

      623     5459    1      B$JIT.ERR=RXTN;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:120  

   5459  2 003073   200010 236100                    LDQ     SIZE,,AUTO
         2 003074   000000 470400 xsym               LDP0    B$JIT$
         2 003075   000012 756100                    STQ     10,,PR0

   5459  2 003076                       ALTFIT       null
      624     5460    1   ALTFIT:;
      625     5461    1      BUF#=0;

   5461  2 003076   200013 450100                    STZ     BUF#,,AUTO

      626     5462    1      B$JIT.ERR=FAG$E$NOCODE|BINBIT(B$JIT.ERR.CODE*8,36);

   5462  2 003077   000000 470400 xsym               LDP0    B$JIT$
         2 003100   000012 236100                    LDQ     10,,PR0
         2 003101   377770 376007                    ANQ     131064,DL
         2 003102   000004 276000 1                  ORQ     FAG$E$NOCODE
         2 003103   000012 756100                    STQ     10,,PR0

   5462  2 003104                       RETALT1      null
      627     5463    1   RETALT1:;
      628     5464    1      IF ENT#>3 AND B$JIT.ERR.FCG='0601'O THEN B$JIT.ERR='0'B;

   5464  2 003104   200014 235100                    LDA     ENT#,,AUTO
         2 003105   000003 115007                    CMPA    3,DL
         2 003106   003115 604400 2                  TMOZ    s:5465
         2 003107   000000 470400 xsym               LDP0    B$JIT$
         2 003110   000012 236100                    LDQ     10,,PR0
         2 003111   777700 376003                    ANQ     -64,DU
         2 003112   060100 116003                    CMPQ    24640,DU
         2 003113   003115 601000 2                  TNZ     s:5465

   5464  2 003114   000012 450100                    STZ     10,,PR0

      629     5465    1      IF ENT#=2 THEN B$JIT.ERR=FAG$E$PSGRANS;

   5465  2 003115   000002 115007                    CMPA    2,DL
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:121  
         2 003116   003122 601000 2                  TNZ     s:5466

   5465  2 003117   000002 236000 1                  LDQ     FAG$E$PSGRANS
         2 003120   000000 470400 xsym               LDP0    B$JIT$
         2 003121   000012 756100                    STQ     10,,PR0

      630     5466    1      IF BUF#=0 THEN ALTRETURN; /* NO BUF OR ENQ CLEANUP */

   5466  2 003122   200013 236100                    LDQ     BUF#,,AUTO
         2 003123   003125 601000 2                  TNZ     s:5467

   5466  2 003124   000000 702200 xent               TSX2  ! X66_AALT

      631     5467    1      CALL FMD$RELBUF(BUF#);

   5467  2 003125   200013 630500                    EPPR0   BUF#,,AUTO
         2 003126   200032 450500                    STP0    FIT$+4,,AUTO
         2 003127   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 003130   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003131   000000 701000 xent               TSX1    FMD$RELBUF
         2 003132   000000 011000                    NOP     0

      632     5468    1      CALL DEQUEUE;

   5468  2 003133   200024 470500                    LDP0    DCB$,,AUTO
         2 003134   000051 236100                    LDQ     41,,PR0
         2 003135   000003 736000                    QLS     3
         2 003136   000001 376000 3                  ANQ     1
         2 003137   000022 736000                    QLS     18
         2 003140   000006 036003                    ADLQ    6,DU
         2 003141   000000 036000 xsym               ADLQ    FM$SET$
         2 003142   200032 756100                    STQ     FIT$+4,,AUTO
         2 003143   200032 631500                    EPPR1   FIT$+4,,AUTO
         2 003144   200033 451500                    STP1    FIT$+5,,AUTO
         2 003145   200033 630500                    EPPR0   FIT$+5,,AUTO
         2 003146   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003147   000000 701000 xent               TSX1    UQB$MDEQ
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:122  
         2 003150   000000 011000                    NOP     0

      633     5469    1      ALTRETURN;

   5469  2 003151   000000 702200 xent               TSX2  ! X66_AALT

      634     5470    1   FAGE$PSGRANS: B$JIT.ERR=FAG$E$PSGRANS;

   5470  2 003152   000002 236000 1     FAGE$PSGRANS LDQ     FAG$E$PSGRANS
         2 003153   000000 470400 xsym               LDP0    B$JIT$
         2 003154   000012 756100                    STQ     10,,PR0

      635     5471    1      GOTO RETALT1;

   5471  2 003155   003104 710000 2                  TRA     RETALT1

      636     5472    1   FAGE$USGRANS: B$JIT.ERR=FAG$E$USGRANS;

   5472  2 003156   000001 236000 1     FAGE$USGRANS LDQ     FAG$E$USGRANS
         2 003157   000000 470400 xsym               LDP0    B$JIT$
         2 003160   000012 756100                    STQ     10,,PR0

      637     5473    1      ALTRETURN;

   5473  2 003161   000000 702200 xent               TSX2  ! X66_AALT

      638     5474    1   FAGE$ACGRANS: B$JIT.ERR=FAG$E$ACGRANS;

   5474  2 003162   000000 236000 1     FAGE$ACGRANS LDQ     FAG$E$ACGRANS
         2 003163   000000 470400 xsym               LDP0    B$JIT$
         2 003164   000012 756100                    STQ     10,,PR0

      639     5475    1      CALL FMR$U8;

   5475  2 003165   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003166   000000 701000 xent               TSX1    FMR$U8
         2 003167   000000 011000                    NOP     0
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:123  

      640     5476    1      ALTRETURN;

   5476  2 003170   000000 702200 xent               TSX2  ! X66_AALT

      641     5477        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:124  
      642     5478    1   GOTONE: O.ADR=XBUF.ADR+SRDZERO;

   5478  2 003171   000000 236100       GOTONE       LDQ     0,,PR0
         2 003172   000022 772000                    QRL     18
         2 003173   200017 036100                    ADLQ    SRDZERO,,AUTO
         2 003174   200011 756100                    STQ     O,,AUTO

      643     5479    1      IF XBUF.ADR>=XBUF.EADR THEN GOTO FAGSCR;

   5479  2 003175   000000 720100                    LXL0    0,,PR0
         2 003176   000000 100100                    CMPX0   0,,PR0
         2 003177   003034 602000 2                  TNC     FAGSCR
         2 003200   003034 600000 2                  TZE     FAGSCR

      644     5480    1      IF SIZE=0 THEN CALL SQZ;

   5480  2 003201   200010 235100                    LDA     SIZE,,AUTO
         2 003202   003206 601000 2                  TNZ     s:5481

   5480  2 003203   003474 701000 2                  TSX1    SQZ
         2 003204   000000 011000                    NOP     0
         2 003205   003213 710000 2                  TRA     s:5482

      645     5481    1      ELSE XBUF.ADR=XBUF.ADR+O.SIZ;

   5481  2 003206   000000 236100                    LDQ     0,,PR0
         2 003207   000022 772000                    QRL     18
         2 003210   200012 036100                    ADLQ    O+1,,AUTO
         2 003211   000000 621006                    EAX1    0,QL
         2 003212   000000 741100                    STX1    0,,PR0

      646     5482    1      FM$VOL.RGRANS=FM$VOL.RGRANS-O.SIZ;

   5482  2 003213   200007 470500                    LDP0    SDCT$,,AUTO
         2 003214   000006 236100                    LDQ     6,,PR0
         2 003215   200012 136100                    SBLQ    O+1,,AUTO
         2 003216   000006 756100                    STQ     6,,PR0
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:125  

      647     5483    1      IF PINCRW(VXH$,VXH.XTNS-1)->ABUF='0'B THEN CALL SC_GPERR;

   5483  2 003217   200006 471500                    LDP1    VXH$,,AUTO
         2 003220   100000 720100                    LXL0    0,,PR1
         2 003221   177777 235110                    LDA     -1,X0,PR1
         2 003222   003225 601000 2                  TNZ     s:5484

   5483  2 003223   000000 713400 xsym               CLIMB   SC_GPERR
         2 003224   000000 600000 xsid               climb   nvectors=         0

      648     5484    1      CALL FMD$WRTBUF(BUF#);

   5484  2 003225   200013 630500                    EPPR0   BUF#,,AUTO
         2 003226   200032 450500                    STP0    FIT$+4,,AUTO
         2 003227   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 003230   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003231   000000 701000 xent               TSX1    FMD$WRTBUF
         2 003232   000000 011000                    NOP     0

      649     5485    1      CALL DEQUEUE;

   5485  2 003233   200024 470500                    LDP0    DCB$,,AUTO
         2 003234   000051 236100                    LDQ     41,,PR0
         2 003235   000003 736000                    QLS     3
         2 003236   000001 376000 3                  ANQ     1
         2 003237   000022 736000                    QLS     18
         2 003240   000006 036003                    ADLQ    6,DU
         2 003241   000000 036000 xsym               ADLQ    FM$SET$
         2 003242   200032 756100                    STQ     FIT$+4,,AUTO
         2 003243   200032 631500                    EPPR1   FIT$+4,,AUTO
         2 003244   200033 451500                    STP1    FIT$+5,,AUTO
         2 003245   200033 630500                    EPPR0   FIT$+5,,AUTO
         2 003246   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003247   000000 701000 xent               TSX1    UQB$MDEQ
         2 003250   000000 011000                    NOP     0

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:126  
      650     5486    2      IF ENT#=1 THEN DO;

   5486  2 003251   200014 235100                    LDA     ENT#,,AUTO
         2 003252   000001 115007                    CMPA    1,DL
         2 003253   003260 601000 2                  TNZ     s:5490

      651     5487    2         PARM.P1=O.ADR;

   5487  2 003254   200003 470500                    LDP0    @PARM,,AUTO
         2 003255   200011 236100                    LDQ     O,,AUTO
         2 003256   000000 756100                    STQ     0,,PR0

      652     5488    2         RETURN;

   5488  2 003257   000000 702200 xent               TSX2  ! X66_ARET

      653     5489    2         END;
      654     5490    1      VXH$N=F$DCB.GTYP;

   5490  2 003260   200024 470500                    LDP0    DCB$,,AUTO
         2 003261   000064 236100                    LDQ     52,,PR0
         2 003262   000035 772000                    QRL     29
         2 003263   000007 376007                    ANQ     7,DL
         2 003264   200006 756100                    STQ     VXH$,,AUTO

      655     5491    1      CALL FMO$XTNTOFIT(O) ALTRET(RELALT);

   5491  2 003265   200011 631500                    EPPR1   O,,AUTO
         2 003266   200032 451500                    STP1    FIT$+4,,AUTO
         2 003267   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 003270   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003271   000000 701000 xent               TSX1    FMO$XTNTOFIT
         2 003272   003062 702000 2                  TSX2    RELALT

      656     5492    1      F$DCB.GTYP=VXH$N;

   5492  2 003273   200024 470500                    LDP0    DCB$,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:127  
         2 003274   200006 236100                    LDQ     VXH$,,AUTO
         2 003275   000035 736000                    QLS     29
         2 003276   000064 676100                    ERQ     52,,PR0
         2 003277   034000 376003                    ANQ     14336,DU
         2 003300   000064 656100                    ERSQ    52,,PR0

      657     5493    1      F$DCB.BORROW=F$DCB.BORROW-O.SIZ;

   5493  2 003301   000065 236100                    LDQ     53,,PR0
         2 003302   200012 136100                    SBLQ    O+1,,AUTO
         2 003303   000065 756100                    STQ     53,,PR0

      658     5494    2      IF F$DCB.BORROW<0 THEN DO;

   5494  2 003304   003405 605000 2                  TPL     s:5513

      659     5495    2         IF -O.SIZ<F$DCB.BORROW THEN O.SIZ=-F$DCB.BORROW;

   5495  2 003305   000000 236003                    LDQ     0,DU
         2 003306   200012 136100                    SBLQ    O+1,,AUTO
         2 003307   000065 116100                    CMPQ    53,,PR0
         2 003310   003314 605000 2                  TPL     s:5496

   5495  2 003311   000065 235100                    LDA     53,,PR0
         2 003312   000000 531000                    NEG     0
         2 003313   200012 755100                    STA     O+1,,AUTO

      660     5496    3         IF CFU$=ADDR(NIL) THEN DO;

   5496  2 003314   200025 236100                    LDQ     CFU$,,AUTO
         2 003315   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003316   003351 601000 2                  TNZ     s:5504

      661     5497    4            IF NOT F$DCB.STARX=4 AND NOT (F$DCB.STARX=3 AND F$DCB.NRECS=0) THEN DO;

   5497  2 003317   000064 236100                    LDQ     52,,PR0
         2 003320   007000 376007                    ANQ     3584,DL
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:128  
         2 003321   004000 116007                    CMPQ    2048,DL
         2 003322   003405 600000 2                  TZE     s:5513
         2 003323   003000 116007                    CMPQ    1536,DL
         2 003324   003327 601000 2                  TNZ     s:5498
         2 003325   000042 235100                    LDA     34,,PR0
         2 003326   003405 600000 2                  TZE     s:5513

      662     5498    4               CALL FMR$UPDGAC(B$JIT.TMPGAC,B$JIT.CURTMPDP);

   5498  2 003327   000000 236000 xsym               LDQ     B$JIT$
         2 003330   000240 036003                    ADLQ    160,DU
         2 003331   200033 756100                    STQ     FIT$+5,,AUTO
         2 003332   000000 236000 xsym               LDQ     B$JIT$
         2 003333   000246 036003                    ADLQ    166,DU
         2 003334   200032 756100                    STQ     FIT$+4,,AUTO
         2 003335   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 003336   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003337   000000 701000 xent               TSX1    FMR$UPDGAC
         2 003340   000000 011000                    NOP     0

      663     5499    4               B$JIT.CURTMPDP=B$JIT.CURTMPDP+O.SIZ;

   5499  2 003341   000000 470400 xsym               LDP0    B$JIT$
         2 003342   000240 236100                    LDQ     160,,PR0
         2 003343   200012 036100                    ADLQ    O+1,,AUTO
         2 003344   000240 756100                    STQ     160,,PR0

      664     5500    4               IF B$JIT.CURTMPDP>B$JIT.STMPDPPK THEN B$JIT.STMPDPPK=B$JIT.CURTMPDP;

   5500  2 003345   000236 116100                    CMPQ    158,,PR0
         2 003346   003405 604400 2                  TMOZ    s:5513

   5500  2 003347   000236 756100                    STQ     158,,PR0

      665     5501    4               END;

      666     5502    3            END;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:129  

   5502  2 003350   003405 710000 2                  TRA     s:5513

      667     5503    3         ELSE DO;

      668     5504    3            CALL FMR$L8;

   5504  2 003351   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003352   000000 701000 xent               TSX1    FMR$L8
         2 003353   000000 011000                    NOP     0

      669     5505    3            FM$CFUA.GRANS=FM$CFUA.GRANS-O.SIZ;

   5505  2 003354   200025 470500                    LDP0    CFU$,,AUTO
         2 003355   000007 236100                    LDQ     7,,PR0
         2 003356   200012 136100                    SBLQ    O+1,,AUTO
         2 003357   000007 756100                    STQ     7,,PR0

      670     5506    3            FM$CFUA.GMOD=1;

   5506  2 003360   200025 470500                    LDP0    CFU$,,AUTO
         2 003361   100000 236003                    LDQ     32768,DU
         2 003362   000005 256100                    ORSQ    5,,PR0

      671     5507    3            IF F$DCB.WSR~=1 AND NOT B$JIT.PRIV.ACTIVE.FMEFT

   5507  2 003363   200024 470500                    LDP0    DCB$,,AUTO
         2 003364   000040 236100                    LDQ     32,,PR0
         2 003365   000777 376003                    ANQ     511,DU
         2 003366   000001 116003                    CMPQ    1,DU
         2 003367   003402 600000 2                  TZE     s:5510
         2 003370   000000 471400 xsym               LDP1    B$JIT$
         2 003371   100013 234100                    SZN     11,,PR1
         2 003372   003402 604000 2                  TMI     s:5510
         2 003373   200025 236100                    LDQ     CFU$,,AUTO
         2 003374   000022 772000                    QRL     18
         2 003375   000000 116000 xsym               CMPQ    FM_SYSACCTX
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:130  
         2 003376   003402 600000 2                  TZE     s:5510

      672     5508    3              AND ADDR(CFU$)->XBUF.ADR~=FM_SYSACCTX
      673     5509    3            THEN B$JIT.PRDPRM=B$JIT.PRDPRM-O.SIZ;

   5509  2 003377   100242 236100                    LDQ     162,,PR1
         2 003400   200012 136100                    SBLQ    O+1,,AUTO
         2 003401   100242 756100                    STQ     162,,PR1

      674     5510    3            CALL FMR$U8;

   5510  2 003402   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003403   000000 701000 xent               TSX1    FMR$U8
         2 003404   000000 011000                    NOP     0

      675     5511    3            END;

      676     5512    2         END;

      677     5513    2      IF Y>0 THEN DO;

   5513  2 003405   200021 235100                    LDA     Y,,AUTO
         2 003406   003422 604400 2                  TMOZ    s:5519

      678     5514    2         O.SIZ=Y;

   5514  2 003407   200012 755100                    STA     O+1,,AUTO

      679     5515    2         CFU$=F$DCB.CFU$;

   5515  2 003410   200024 470500                    LDP0    DCB$,,AUTO
         2 003411   000066 236100                    LDQ     54,,PR0
         2 003412   200025 756100                    STQ     CFU$,,AUTO

      680     5516    2         IF FM$CFU.FITSDA=0 THEN FM$CFU.FITSDA=O.ADR;

   5516  2 003413   200025 471500                    LDP1    CFU$,,AUTO
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:131  
         2 003414   100000 236100                    LDQ     0,,PR1
         2 003415   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 003416   003421 601000 2                  TNZ     s:5517

   5516  2 003417   200011 236100                    LDQ     O,,AUTO
         2 003420   100000 552134                    STBQ    0,'34'O,PR1

      681     5517    2         GOTO GEXT0;

   5517  2 003421   000756 710000 2                  TRA     GEXT0

      682     5518    2         END;
      683     5519    1      IF CFU$~=ADDR(NIL) THEN /* NO WRITE IF STAR, SCRATCH, OR CREATE */

   5519  2 003422   200025 236100                    LDQ     CFU$,,AUTO
         2 003423   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003424   003450 600000 2                  TZE     s:5523

      684     5520    1         IF MOD(F$DCB.CFU$->FM$CFU.FUN,4)~=%CREATE# THEN

   5520  2 003425   200024 470500                    LDP0    DCB$,,AUTO
         2 003426   000066 471500                    LDP1    54,,PR0
         2 003427   100000 236100                    LDQ     0,,PR1
         2 003430   000041 772000                    QRL     33
         2 003431   000003 376007                    ANQ     3,DL
         2 003432   000003 116007                    CMPQ    3,DL
         2 003433   003450 600000 2                  TZE     s:5523

      685     5521    1            IF F$DCB.BFR.BUFX(4)~=0 THEN CALL FMD$WRTSV(4);

   5521  2 003434   000121 236100                    LDQ     81,,PR0
         2 003435   037000 316003                    CANQ    15872,DU
         2 003436   003444 600000 2                  TZE     s:5522

   5521  2 003437   000006 630400 3                  EPPR0   6
         2 003440   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003441   000000 701000 xent               TSX1    FMD$WRTSV
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:132  
         2 003442   000000 011000                    NOP     0
         2 003443   003450 710000 2                  TRA     s:5523

      686     5522    1            ELSE CALL FMD$WRTSV(1);

   5522  2 003444   000007 630400 3                  EPPR0   7
         2 003445   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003446   000000 701000 xent               TSX1    FMD$WRTSV
         2 003447   000000 011000                    NOP     0

      687     5523    1      RETURN;

   5523  2 003450   000000 702200 xent               TSX2  ! X66_ARET

      688     5524        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:133  
      689     5525    1   ADJ_REQ: PROC ALTRET;

   5525  2 003451   200030 741300       ADJ_REQ      STX1  ! FIT$+2,,AUTO

      690     5526                    /*I*      NAME: ADJ_REQ
      691     5527                    *         PURPOSE: Adjust the user request if it exceeds his limits.
      692     5528                    *         DESCRIPTION: If the request would exceed his limit and it is
      693     5529                    *         for more than 2 granules and it is not a "random" type,
      694     5530                    *         cut the request by a factor of 2. This subroutine altreturns
      695     5531                    *        if any of the above requirements is not met (except the first,
      696     5532                    *         which is to be tested externally).
      697     5533                    *         CALL: DO WHILE(user request would exceed limit);
      698     5534                    *                  CALL ADJ_REQ ALTRET(place to report error);
      699     5535                    *                  END;
      700     5536                    *         O.SIZ is the user request, X is same, modified for DCB.BORROW
      701     5537                    */
      702     5538    2      IF O.SIZ<2 OR ENT#=3 THEN ALTRETURN;

   5538  2 003452   200012 235100                    LDA     O+1,,AUTO
         2 003453   000002 115007                    CMPA    2,DL
         2 003454   003460 602000 2                  TNC     s:5538+6
         2 003455   200014 236100                    LDQ     ENT#,,AUTO
         2 003456   000003 116007                    CMPQ    3,DL
         2 003457   003461 601000 2                  TNZ     s:5539

   5538  2 003460   000000 702211                    TSX2  ! 0,X1

      703     5539    2      X=X-O.SIZ+O.SIZ/2;

   5539  2 003461   200020 236100                    LDQ     X,,AUTO
         2 003462   200012 136100                    SBLQ    O+1,,AUTO
         2 003463   200032 756100                    STQ     FIT$+4,,AUTO
         2 003464   200012 236100                    LDQ     O+1,,AUTO
         2 003465   000001 772000                    QRL     1
         2 003466   200032 036100                    ADLQ    FIT$+4,,AUTO
         2 003467   200020 756100                    STQ     X,,AUTO

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:134  
      704     5540    2      O.SIZ=O.SIZ/2;

   5540  2 003470   200012 236100                    LDQ     O+1,,AUTO
         2 003471   000001 772000                    QRL     1
         2 003472   200012 756100                    STQ     O+1,,AUTO

      705     5541    2      RETURN;

   5541  2 003473   000001 702211                    TSX2  ! 1,X1

      706     5542    2   END ADJ_REQ;
      707     5543        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:135  
      708     5544    1   SQZ: PROC ALTRET;

   5544  2 003474   200030 741300       SQZ          STX1  ! FIT$+2,,AUTO

      709     5545                    /*I*     NAME: SQZ
      710     5546                              PURPOSE: Removes a word from the free extent pool.
      711     5547                              DESCRIPTION: Uses FMR$SLIDE to pack remaining active
      712     5548                     buffer space from XTN$ to NAVX. Updates NAVX, AVAIL, and VXH.XTNS.
      713     5549                    */
      714     5550    2      FM$GRAN.NAVX=FM$GRAN.NAVX-1;

   5550  2 003475   200023 470500                    LDP0    BUF$,,AUTO
         2 003476   000001 220100                    LDX0    1,,PR0
         2 003477   777777 622010                    EAX2    -1,X0
         2 003500   000001 742100                    STX2    1,,PR0

      715     5551    2      X=FM$GRAN.NAVX-POFFW(XTN$,BUF$);

   5551  2 003501   200023 235100                    LDA     BUF$,,AUTO
         2 003502   000022 771000                    ARL     18
         2 003503   200032 755100                    STA     FIT$+4,,AUTO
         2 003504   200005 236100                    LDQ     XTN$,,AUTO
         2 003505   000022 772000                    QRL     18
         2 003506   200032 136100                    SBLQ    FIT$+4,,AUTO
         2 003507   200033 756100                    STQ     FIT$+5,,AUTO
         2 003510   000001 236100                    LDQ     1,,PR0
         2 003511   000022 772000                    QRL     18
         2 003512   200033 136100                    SBLQ    FIT$+5,,AUTO
         2 003513   200020 756100                    STQ     X,,AUTO

      716     5552    2      T$=XTN$;

   5552  2 003514   200005 236100                    LDQ     XTN$,,AUTO
         2 003515   200004 756100                    STQ     T$,,AUTO

      717     5553    2      CALL FMR$SLIDE(T$,-1,X);

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:136  
   5553  2 003516   200020 631500                    EPPR1   X,,AUTO
         2 003517   200034 451500                    STP1    FIT$+6,,AUTO
         2 003520   000030 236000 3                  LDQ     24
         2 003521   200033 756100                    STQ     FIT$+5,,AUTO
         2 003522   200004 633500                    EPPR3   T$,,AUTO
         2 003523   200032 453500                    STP3    FIT$+4,,AUTO
         2 003524   200032 630500                    EPPR0   FIT$+4,,AUTO
         2 003525   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 003526   000000 701000 xent               TSX1    FMR$SLIDE
         2 003527   000000 011000                    NOP     0

      718     5554    2      FM$GRAN.AVAIL=FM$GRAN.AVAIL+1;

   5554  2 003530   200023 470500                    LDP0    BUF$,,AUTO
         2 003531   000001 236100                    LDQ     1,,PR0
         2 003532   001777 376007                    ANQ     1023,DL
         2 003533   000001 036007                    ADLQ    1,DL
         2 003534   000001 676100                    ERQ     1,,PR0
         2 003535   001777 376007                    ANQ     1023,DL
         2 003536   000001 656100                    ERSQ    1,,PR0

      719     5555    2      VXH.XTNS=VXH.XTNS-1;

   5555  2 003537   200006 471500                    LDP1    VXH$,,AUTO
         2 003540   100000 720100                    LXL0    0,,PR1
         2 003541   777777 621010                    EAX1    -1,X0
         2 003542   100000 441100                    SXL1    0,,PR1

      720     5556    2      RETURN;

   5556  2 003543   200030 221300                    LDX1  ! FIT$+2,,AUTO
         2 003544   000001 702211                    TSX2  ! 1,X1

      721     5557        %EJECT;
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:137  
      722     5558    2   GETVOL: ENTRY ALTRET;

   5558  2 003545   200030 741300       GETVOL       STX1  ! FIT$+2,,AUTO

      723     5559                    /*I*     NAME: GETVOL
      724     5560                    *       PURPOSE: PRODUCES A VOLUME# IN VOL# (AUTO VAR) CORRESPONDING TO
      725     5561                    *       THE SET-RELATIVE DISCCADDRESS IN SIZE (AUTO VAR). SETS RXTN.ADR
      726     5562                    *        (REDEF OF SIZE) TO DEVICE RELATIVE ADDRESS OF SIZE.
      727     5563                    */
      728     5564    2      IF SIZE<FM_SRZERO THEN ALTRETURN; /* BAD INPUT */

   5564  2 003546   200010 236100                    LDQ     SIZE,,AUTO
         2 003547   000000 116000 xsym               CMPQ    FM_SRZERO
         2 003550   003552 605000 2                  TPL     s:5565

   5564  2 003551   000000 702211                    TSX2  ! 0,X1

      729     5565    2      Y=FM_SRZERO;

   5565  2 003552   000000 235000 xsym               LDA     FM_SRZERO
         2 003553   200021 755100                    STA     Y,,AUTO

      730     5566    2      VOL#=0;

   5566  2 003554   200015 450100                    STZ     VOL#,,AUTO

      731     5567    2      SRDZERO=FM_SRZERO;

   5567  2 003555   200017 755100                    STA     SRDZERO,,AUTO

      732     5568    2      SDCT$=ADDR(FM$SET(FM$SET.DCTX(F$DCB.SETX)));

   5568  2 003556   200024 470500                    LDP0    DCB$,,AUTO
         2 003557   000051 236100                    LDQ     41,,PR0
         2 003560   000003 736000                    QLS     3
         2 003561   000001 376000 3                  ANQ     1
         2 003562   000000 471400 xsym               LDP1    FM$SET$
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:138  
         2 003563   100000 236106                    LDQ     0,QL,PR1
         2 003564   000017 772000                    QRL     15
         2 003565   000001 376000 3                  ANQ     1
         2 003566   000022 736000                    QLS     18
         2 003567   000000 036000 xsym               ADLQ    FM$SET$
         2 003570   200007 756100                    STQ     SDCT$,,AUTO

      733     5569    3      DO WHILE(SDCT$~=FM$SET$);

   5569  2 003571   000000 116000 xsym               CMPQ    FM$SET$
         2 003572   003626 600000 2                  TZE     s:5581

      734     5570    3         VOL#=VOL#+1;

   5570  2 003573   200015 054100                    AOS     VOL#,,AUTO

      735     5571    3         SIZE=SIZE-Y;

   5571  2 003574   200010 236100                    LDQ     SIZE,,AUTO
         2 003575   200021 136100                    SBLQ    Y,,AUTO
         2 003576   200010 756100                    STQ     SIZE,,AUTO

      736     5572    3         Y=FM$VOL.NXTSDA-FM_SRZERO;

   5572  2 003577   200007 470500                    LDP0    SDCT$,,AUTO
         2 003600   000003 236100                    LDQ     3,,PR0
         2 003601   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003602   000000 136000 xsym               SBLQ    FM_SRZERO
         2 003603   200021 756100                    STQ     Y,,AUTO

      737     5573    4         IF SIZE<Y THEN DO;

   5573  2 003604   200010 116100                    CMPQ    SIZE,,AUTO
         2 003605   003614 604400 2                  TMOZ    s:5578

      738     5574    4            OVOL=SRDZERO;

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:139  
   5574  2 003606   200017 235100                    LDA     SRDZERO,,AUTO
         2 003607   200016 755100                    STA     OVOL,,AUTO

      739     5575    4            RXTN.ADR=SIZE;

   5575  2 003610   200010 720100                    LXL0    SIZE,,AUTO
         2 003611   200010 740100                    STX0    SIZE,,AUTO

      740     5576    4            RETURN;

   5576  2 003612   200030 221300                    LDX1  ! FIT$+2,,AUTO
         2 003613   000001 702211                    TSX2  ! 1,X1

      741     5577    4            END;
      742     5578    3         SRDZERO=SRDZERO+Y;

   5578  2 003614   200017 036100                    ADLQ    SRDZERO,,AUTO
         2 003615   200017 756100                    STQ     SRDZERO,,AUTO

      743     5579    3         SDCT$=ADDR(FM$SET(FM$VOL.VOLL));

   5579  2 003616   000005 236100                    LDQ     5,,PR0
         2 003617   000017 772000                    QRL     15
         2 003620   000001 376000 3                  ANQ     1
         2 003621   000022 736000                    QLS     18
         2 003622   000000 036000 xsym               ADLQ    FM$SET$
         2 003623   200007 756100                    STQ     SDCT$,,AUTO

      744     5580    3         END;

   5580  2 003624   000000 116000 xsym               CMPQ    FM$SET$
         2 003625   003573 601000 2                  TNZ     s:5570

      745     5581    2      ALTRETURN;

   5581  2 003626   200030 221300                    LDX1  ! FIT$+2,,AUTO
         2 003627   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:140  

FA_SCATTER
 Sect OctLoc
   0     000   000000 000000                                                    ....

FAG$E$ACGRANS
 Sect OctLoc
   1     000   060107 002162                                                    0G.r

FAG$E$USGRANS
 Sect OctLoc
   1     001   060107 002152                                                    0G.j

FAG$E$PSGRANS
 Sect OctLoc
   1     002   060107 002142                                                    0G.b

FAG$E$GP
 Sect OctLoc
   1     003   060107 000552                                                    0G..

FAG$E$NOCODE
 Sect OctLoc
   1     004   060107 000002                                                    0G..

(unnamed)
 Sect OctLoc
   3     000   000000 006000   000007 777770   017777 777777   000002 006000    ................
   3     004   000004 006000   000005 006000   000006 006000   000003 006000    ................
   3     010   000003 776000   000000 000020   000011 006000   000002 006000    ................
   3     014   000007 006000   000011 000000   000000 000055   000000 000025    ...........-....
   3     020   000016 006000   000017 006000   743777 777777   000000 000024    ................
   3     024   000005 006000   000003 006000   000016 006000   000023 006000    ................
   3     030   000027 006000                                                    ....
      746     5582    2   END SQZ;
      747     5583    1   END FAG$;

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:141  
--  Include file information  --

   F_ERRORS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   AZ_MACRO_C.:E05TOU  is referenced.
   AZ_SUBS_C.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM_CACHE_C.:E05TOU  is referenced.
   FM_CACHE_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FAG$.
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:142  

 **** Variables and constants ****

  ****  Section 000  Data  FAG$

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT         r     1 FA_SCATTER

  ****  Section 001 RoData FAG$

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 FAG$E$ACGRANS              3-0-0/b STRC        r     1 FAG$E$GP
     4-0-0/b STRC        r     1 FAG$E$NOCODE               2-0-0/b STRC        r     1 FAG$E$PSGRANS
     1-0-0/b STRC        r     1 FAG$E$USGRANS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @PARM                     13-0-0/w SBIN        r     1 BUF#
    23-0-0/w PTR         r     1 BUF$                      22-0-0/w SBIN        r     1 CDA
    25-0-0/w PTR         r     1 CFU$                      24-0-0/w PTR         r     1 DCB$
    14-0-0/w SBIN        r     1 ENT#                      26-0-0/w PTR         r     1 FIT$
    *0-0-0/w STRC(72)    r     1 INXTN                     11-0-0/w STRC(72)    r     1 O
    11-0-0/w STRC(72)    r     1 OS                        16-0-0/w UBIN        r     1 OVOL
    *0-0-0/w STRC(72)    r     1 PARM                      10-0-0/w STRC        r     1 RXTN
     7-0-0/w PTR         r     1 SDCT$                     10-0-0/w SBIN        r     1 SIZE
    17-0-0/w SBIN        r     1 SRDZERO                    4-0-0/w PTR         r     1 T$
    15-0-0/w SBIN        r     1 VOL#                       6-0-0/w PTR         r     1 VXH$
     6-0-0/w UBIN        r     1 VXH$N                     20-0-0/w SBIN        r     1 X
     5-0-0/w PTR         r     1 XTN$                      20-0-0/w UBIN        r     1 XU
    21-0-0/w SBIN        r     1 Y

PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:143  
  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w PTR         r     1 FM$BUF$(0:0)
     0-0-0/w PTR         r     1 FM$SET$                    0-0-0/w PTR         r     1 FMC_CACHE$
     0-0-0/w PTR         r     1 FMC_CACHEPGCNT$            0-0-0/w SBIN        r     1 FM_GPSDA
     0-0-0/w SBIN        r     1 FM_SRZERO                  0-0-0/w SBIN        r     1 FM_SYSACCTX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 ABUF                       0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(72)    r     1 BBUF                       0-0-0/w STRC(324)   r     1 CODE03
     0-0-0/w STRC(396)   r     1 CODE04                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU                     0-0-0/w STRC(288)   r     1 FM$CFUA
     0-0-0/w STRC(288)   r     1 FM$CFUF                    0-0-0/w STRC(1116)  r     1 FM$FIT
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/w STRC(288)   r     1 FM$SET(0:0)
     0-0-0/w STRC(288)   r     1 FM$VOL
     0-0-0/w STRC(216)   r     1 FMC$CACHETBL(0:0)
     0-0-0/c CHAR(4096)  r     1 GRANULE                    0-0-0/w STRC(576)   r     1 PGRANS
     0-0-0/w STRC        r     1 VXH                        0-0-0/w STRC(72)    r     1 XBUF


   Procedure FAG$ requires 1944 words for executable code.
   Procedure FAG$ requires 36 words of local(AUTO) storage.

    No errors detected in file FAG$GEXT.:E05TSI    .
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:144  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:145  
          MINI XREF LISTING

ABUF
      4901**DCL      5421>>IF       5483>>IF
ABUF.ADR
      4903**DCL      5123>>ASSIGN
ABUF.SIZ
      4902**DCL      5125>>IF       5129>>ASSIGN
ADJ_REQ
      5525**PROC     5187--CALL     5197--CALL     5204--CALL
ALTFIT
      5459**LABEL    5058--CALLALT
B$JIT.ACCN
       330**DCL      5091>>IF       5091>>IF
B$JIT.CURTMPDP
       421**DCL      5186>>DOWHILE  5498<>CALL     5499<<ASSIGN   5499>>ASSIGN   5500>>IF       5500>>ASSIGN
B$JIT.DCB$
       420**DCL      4989>>ASSIGN   5000>>ASSIGN   5012>>ASSIGN   5027>>ASSIGN   5042>>ASSIGN   5057>>ASSIGN
      5144>>ASSIGN
B$JIT.ERR
       330**DCL      5432<<ASSIGN   5434<<ASSIGN   5442<<ASSIGN   5457>>ASSIGN   5459<<ASSIGN   5462<<ASSIGN
      5464<<ASSIGN   5465<<ASSIGN   5470<<ASSIGN   5472<<ASSIGN   5474<<ASSIGN
B$JIT.ERR.CODE
       331**DCL      5434>>ASSIGN   5462>>ASSIGN
B$JIT.ERR.FCG
       330**DCL      5464>>IF
B$JIT.ERR.MID
       331**DCL       331--REDEF
B$JIT.GAC
       421**DCL      5095<>CALL
B$JIT.MAXTMPDP
       421**DCL      5186>>DOWHILE
B$JIT.PNR
       427**DCL       427--REDEF
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:146  
B$JIT.PRDPRM
       421**DCL      5196>>DOWHILE  5509<<ASSIGN   5509>>ASSIGN
B$JIT.PRIV.ACTIVE.FMEFT
       331**DCL      5071>>IF       5194>>IF       5202>>IF       5507>>IF
B$JIT.STIME
       425**DCL      5171>>ASSIGN
B$JIT.STMPDPPK
       421**DCL      5500>>IF       5500<<ASSIGN
B$JIT.TMPGAC
       421**DCL      5498<>CALL
B$JIT.UNAME
       330**DCL      5091>>IF
B$JIT$
      4866**DCL       325--IMP-PTR  4989>>ASSIGN   5000>>ASSIGN   5012>>ASSIGN   5027>>ASSIGN   5042>>ASSIGN
      5057>>ASSIGN   5071>>IF       5091>>IF       5091>>IF       5091>>IF       5095>>CALL     5144>>ASSIGN
      5171>>ASSIGN   5186>>DOWHILE  5186>>DOWHILE  5194>>IF       5196>>DOWHILE  5202>>IF       5432>>ASSIGN
      5434>>ASSIGN   5434>>ASSIGN   5442>>ASSIGN   5457>>ASSIGN   5459>>ASSIGN   5462>>ASSIGN   5462>>ASSIGN
      5464>>IF       5464>>ASSIGN   5465>>ASSIGN   5470>>ASSIGN   5472>>ASSIGN   5474>>ASSIGN   5498>>CALL
      5498>>CALL     5499>>ASSIGN   5499>>ASSIGN   5500>>IF       5500>>IF       5500>>ASSIGN   5500>>ASSIGN
      5507>>IF       5509>>ASSIGN   5509>>ASSIGN
BADXTN
      5133**LABEL    5045--CALLALT  5117--CALLALT  5124--CALLALT
BBUF.SIZ
      4906**DCL      5126>>ASSIGN
BUF#
      4939**DCL      5013<<ASSIGN   5044<<ASSIGN   5056<<ASSIGN   5155<<ASSIGN   5212<<ASSIGN   5213<<ASSIGN
      5214<<ASSIGN   5221<>CALL     5252<>CALL     5258<>CALL     5272<>CALL     5323>>ASSIGN   5426>>ASSIGN
      5429<>CALL     5447<>CALL     5461<<ASSIGN   5466>>IF       5467<>CALL     5484<>CALL
BUF$
      4948**DCL       812--IMP-PTR  5059<<ASSIGN   5060>>ASSIGN   5115>>IF       5222<<ASSIGN   5224>>ASSIGN
      5224>>ASSIGN   5228>>IF       5228>>IF       5230>>IF       5253<<ASSIGN   5255>>ASSIGN   5257>>ASSIGN
      5288>>ASSIGN   5349>>IF       5350>>ASSIGN   5350>>ASSIGN   5353>>ASSIGN   5353>>ASSIGN   5354>>ASSIGN
      5354>>ASSIGN   5362>>ASSIGN   5363>>ASSIGN   5366>>IF       5377>>ASSIGN   5378>>ASSIGN   5378>>ASSIGN
      5382>>IF       5383>>ASSIGN   5383>>ASSIGN   5389>>ASSIGN   5390>>ASSIGN   5392>>ASSIGN   5393>>ASSIGN
      5393>>ASSIGN   5394>>CALL     5395>>ASSIGN   5404>>ASSIGN   5404>>ASSIGN   5405>>ASSIGN   5406>>ASSIGN
      5414>>IF       5414<<ASSIGN   5437>>ASSIGN   5438>>ASSIGN   5440>>ASSIGN   5445>>ASSIGN   5445>>ASSIGN
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:147  
      5446>>ASSIGN   5446>>ASSIGN   5550>>ASSIGN   5550>>ASSIGN   5551>>ASSIGN   5551>>ASSIGN   5554>>ASSIGN
      5554>>ASSIGN
BUFERR
      5432**LABEL    5231--GOTO     5281--GOTO     5319--GOTO     5330--GOTO     5331--GOTO     5339--GOTO
      5342--GOTO
CDA
      4947**DCL      5015<<ASSIGN   5016>>ASSIGN   5217<<ASSIGN   5221<>CALL     5235>>ASSIGN   5251<<ASSIGN
      5252<>CALL     5287>>ASSIGN   5288<<ASSIGN   5289>>IF       5312>>IF       5398>>ASSIGN   5409<>CALL
      5441<>CALL
CFU$
      4950**DCL       816--IMP-PTR   822--IMP-PTR  4277--IMP-PTR  4517--IMP-PTR  4989<<ASSIGN   4997<<ASSIGN
      5074<<ASSIGN   5080>>IF       5081>>ASSIGN   5082>>ASSIGN   5084>>CALL     5091>>IF       5091>>IF
      5095>>CALL     5100>>ASSIGN   5102>>ASSIGN   5103>>ASSIGN   5148<<ASSIGN   5149>>ASSIGN   5152>>IF
      5167>>IF       5169>>ASSIGN   5182>>IF       5183<<ASSIGN   5194>>IF       5200>>IF       5200<<ASSIGN
      5200>>ASSIGN   5201<<ASSIGN   5201>>ASSIGN   5203>>DOWHILE  5367<<ASSIGN   5370>>ASSIGN   5371>>ASSIGN
      5374>>CALL     5375<<ASSIGN   5376>>ASSIGN   5376>>ASSIGN   5377>>IF       5378>>ASSIGN   5410<<ASSIGN
      5411>>ASSIGN   5496>>IF       5505>>ASSIGN   5505>>ASSIGN   5506>>ASSIGN   5507--IF       5515<<ASSIGN
      5516>>IF       5516>>ASSIGN   5519>>IF
CGRANS0
      5016**LABEL    5248--GOTO
CODE03.DESC.BUPM
      4284**DCL      5089>>IF
CODE03.NGAVAL
      4285**DCL      5079>>ASSIGN
CODE03.UGRANS
      4283**DCL      5079>>ASSIGN
CODE04.CREATOR
      4279**DCL      5100>>ASSIGN
CODE04.CREATOR.ACCT
      4279**DCL      5091>>IF
CODE04.CREATOR.NAME
      4279**DCL      5091>>IF
CODE04.GAC
      4280**DCL      5084<>CALL
CODE04.GAC.N
      4280**DCL      5082<<ASSIGN   5095<>CALL     5102>>ASSIGN   5103>>ASSIGN
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:148  
CODE04.GAC.TIME
      4280**DCL      5080>>IF       5081<<ASSIGN
DCB$
      4949**DCL      4816--IMP-PTR  5000<<ASSIGN   5012<<ASSIGN   5027<<ASSIGN   5028>>ASSIGN   5042<<ASSIGN
      5057<<ASSIGN   5062>>IF       5063>>IF       5064>>IF       5065>>IF       5067>>IF       5068>>ASSIGN
      5070>>ASSIGN   5071>>IF       5080>>IF       5081>>ASSIGN   5089>>IF       5091>>IF       5091>>IF
      5101>>ASSIGN   5102>>IF       5105>>ASSIGN   5144<<ASSIGN   5146>>IF       5146>>IF       5146>>IF
      5148>>ASSIGN   5149>>ASSIGN   5150>>IF       5150>>IF       5151>>ASSIGN   5171>>ASSIGN   5180>>IF
      5180>>IF       5180>>ASSIGN   5182>>IF       5184>>IF       5184>>IF       5184>>IF       5184>>IF
      5194>>IF       5202>>IF       5213>>IF       5214>>IF       5214>>IF       5215>>CALL     5219>>ASSIGN
      5220>>ASSIGN   5223>>ASSIGN   5250>>ASSIGN   5259>>CALL     5260>>ASSIGN   5261>>ASSIGN   5264>>ASSIGN
      5269>>ASSIGN   5273>>CALL     5323>>ASSIGN   5400>>ASSIGN   5401>>ASSIGN   5406>>ASSIGN   5408>>ASSIGN
      5411>>ASSIGN   5422>>IF       5423>>IF       5426>>ASSIGN   5430>>CALL     5468>>CALL     5485>>CALL
      5490>>ASSIGN   5492>>ASSIGN   5493>>ASSIGN   5493>>ASSIGN   5494>>IF       5495>>IF       5495>>ASSIGN
      5497>>IF       5497>>IF       5497>>IF       5507>>IF       5515>>ASSIGN   5520>>IF       5521>>IF
      5568>>ASSIGN
ELA$SYSLOG
      4895**DCL-ENT  5106--CALL
ENQERR
      5434**LABEL    5215--CALLALT
ENT#
      4940**DCL      4999<<ASSIGN   5010<<ASSIGN   5040<<ASSIGN   5055<<ASSIGN   5132<<ASSIGN   5145<<ASSIGN
      5147<<ASSIGN   5152>>IF       5177>>IF       5213>>IF       5232>>IF       5233>>IF       5291>>IF
      5311>>IF       5425>>IF       5464>>IF       5465>>IF       5486>>IF       5538>>IF
F$CFU$
      4867**DCL      5200>>ASSIGN   5201>>ASSIGN
F$DCB.ACCT
      4826**DCL      5091>>IF       5105>>ASSIGN
F$DCB.ACTPOS
      4841**DCL      4841--REDEF
F$DCB.ARS
      4816**DCL      4816--REDEF
F$DCB.ATTR
      4834**DCL      4835--REDEF
F$DCB.BFR.BUFUP
      4860**DCL      5323<<ASSIGN   5426<<ASSIGN
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:149  
F$DCB.BFR.BUFX
      4861**DCL      5062>>IF       5063>>IF       5064>>IF       5065>>IF       5213>>IF       5214>>IF
      5264>>ASSIGN   5422>>IF       5423>>IF       5521>>IF
F$DCB.BFR.DA
      4861**DCL      5070<<ASSIGN   5400<<ASSIGN   5401>>ASSIGN   5406>>ASSIGN   5411>>ASSIGN
F$DCB.BFR1.CX
      4862**DCL      5067>>IF       5068>>ASSIGN
F$DCB.BORROW
      4849**DCL      4849--REDEF    4849--REDEF    4849--REDEF    5180>>IF       5180>>IF       5180>>ASSIGN
      5493<<ASSIGN   5493>>ASSIGN   5494>>IF       5495>>IF       5495>>ASSIGN
F$DCB.BUPF
      4819**DCL      5089>>IF
F$DCB.CFU$
      4850**DCL      4989>>ASSIGN   5148>>ASSIGN   5515>>ASSIGN   5520>>IF
F$DCB.DCBNAME.L
      4863**DCL      4863--IMP-SIZ
F$DCB.EOMCHAR
      4820**DCL      4820--REDEF
F$DCB.FLDID
      4844**DCL      4844--REDEF
F$DCB.FORM$
      4838**DCL      4838--REDEF
F$DCB.FSECT
      4854**DCL      4854--REDEF
F$DCB.FSN
      4831**DCL      4831--REDEF    4831--REDEF    4832--REDEF
F$DCB.GTYP
      4845**DCL      5219>>ASSIGN   5220<<ASSIGN   5223<<ASSIGN   5250<<ASSIGN   5408<<ASSIGN   5490>>ASSIGN
      5492<<ASSIGN
F$DCB.HEADER$
      4837**DCL      4837--REDEF
F$DCB.IORG
      4852**DCL      5146>>IF       5146>>IF       5146>>IF
F$DCB.IXTNSIZE
      4835**DCL      4835--REDEF    5149>>ASSIGN   5150>>IF
F$DCB.LASTSTA$
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:150  
      4825**DCL      4825--REDEF
F$DCB.LVL
      4850**DCL      4850--REDEF
F$DCB.NAME
      4825**DCL      5260>>ASSIGN   5261--ASSIGN   5269--ASSIGN
F$DCB.NAME.C
      4825**DCL      4825--REDEF
F$DCB.NOEOF
      4846**DCL      4846--REDEF
F$DCB.NRECS
      4836**DCL      4836--REDEF    5184>>IF       5497>>IF
F$DCB.NRECX
      4855**DCL      4855--REDEF
F$DCB.OHDR
      4847**DCL      4847--REDEF
F$DCB.ORG
      4830**DCL      4830--REDEF
F$DCB.PRECNO
      4853**DCL      4853--REDEF
F$DCB.RCSZ
      4858**DCL      4858--REDEF
F$DCB.RES
      4826**DCL      4826--REDEF
F$DCB.SETX
      4838**DCL      4838--REDEF    5028>>ASSIGN   5080>>IF       5081>>ASSIGN   5091>>IF       5101>>ASSIGN
      5102>>IF       5171>>ASSIGN   5215>>CALL     5259>>CALL     5273>>CALL     5430>>CALL     5468>>CALL
      5485>>CALL     5568>>ASSIGN
F$DCB.STARF
      4845**DCL      5182>>IF
F$DCB.STARX
      4847**DCL      5184>>IF       5184>>IF       5497>>IF       5497>>IF
F$DCB.TAB$
      4837**DCL      4838--REDEF
F$DCB.TDA
      4852**DCL      4852--REDEF    5214>>IF
F$DCB.WSN
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:151  
      4827**DCL      4827--REDEF
F$DCB.WSR
      4833**DCL      5071>>IF       5184>>IF       5194>>IF       5202>>IF       5507>>IF
F$DCB.XTNSIZE
      4833**DCL      5150>>IF       5151>>ASSIGN
FAG$E$ACGRANS
      4963**DCL      5474>>ASSIGN
FAG$E$GP
      4975**DCL      5442>>ASSIGN
FAG$E$NOCODE
      4979**DCL      5434>>ASSIGN   5462>>ASSIGN
FAG$E$PSGRANS
      4971**DCL      5465>>ASSIGN   5470>>ASSIGN
FAG$E$USGRANS
      4967**DCL      5472>>ASSIGN
FAG$REXT
      5035**ENTRY    5458--CALL
FAG$RFILE
      5050**ENTRY    5263--CALL
FAGE$ACGRANS
      5474**LABEL    5204--CALLALT
FAGE$PSGRANS
      5470**LABEL    5166--CALLALT  5174--CALLALT  5241--GOTO     5300--CALLALT  5306--GOTO
FAGE$USGRANS
      5472**LABEL    5187--CALLALT  5197--CALLALT
FAGSCR
      5442**LABEL    5479--GOTO
FA_SCATTER
      4872**DCL      4997--ASSIGN   5170>>IF
FIT$
      4951**DCL       825--IMP-PTR  5060<<ASSIGN   5061>>ASSIGN   5072>>ASSIGN   5076>>ASSIGN   5086>>ASSIGN
      5088>>IF       5098>>ASSIGN   5110>>ASSIGN   5111>>ASSIGN   5113>>ASSIGN   5122>>ASSIGN   5264<<ASSIGN
      5265>>IF       5266>>ASSIGN
FM$BUF$
      4871**DCL      5264>>ASSIGN
FM$CFU.ACCTX
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:152  
       817**DCL       817--REDEF    5194>>IF       5200>>IF       5201>>ASSIGN
FM$CFU.FITSDA
       817**DCL      5167>>IF       5169>>ASSIGN   5516>>IF       5516<<ASSIGN
FM$CFU.FUN
       816**DCL      5520>>IF
FM$CFU.NAMEX
       817**DCL      5182>>IF       5200>>ASSIGN
FM$CFU.UGRANS
       818**DCL      5149>>ASSIGN
FM$CFUA.GMOD
      4518**DCL      5506<<ASSIGN
FM$CFUA.GRANS
      4520**DCL      5203>>DOWHILE  5505<<ASSIGN   5505>>ASSIGN
FM$CFUF.ACCNAM
       822**DCL      5152>>IF
FM$FIT.CODES
       825**DCL      5266>>ASSIGN
FM$FIT.CODES.CODE
       825**DCL      5061<<ASSIGN
FM$FIT.CODES.ITEMX
       825**DCL      5110>>ASSIGN
FM$FIT.CODES.NDW
       825**DCL      5088>>IF       5111>>ASSIGN
FM$GRAN
       812**DCL      5060--ASSIGN
FM$GRAN.AVAIL
       813**DCL      5354<<ASSIGN   5399<<ASSIGN   5404<<ASSIGN   5554<<ASSIGN   5554>>ASSIGN
FM$GRAN.BLINK
       813**DCL      5255>>ASSIGN   5257<<ASSIGN   5398<<ASSIGN   5411<<ASSIGN
FM$GRAN.FCEX
       813**DCL      5224>>ASSIGN   5366>>IF       5377>>ASSIGN   5382>>IF       5390>>ASSIGN   5393>>ASSIGN
      5394>>CALL     5395>>ASSIGN   5414>>IF       5445>>ASSIGN   5446>>ASSIGN
FM$GRAN.FLINK
       813**DCL      5288>>ASSIGN   5405>>ASSIGN   5406<<ASSIGN
FM$GRAN.LVL
       812**DCL      5115>>IF
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:153  
FM$GRAN.NAVX
       812**DCL      5228>>IF       5349>>IF       5350>>ASSIGN   5353<<ASSIGN   5353>>ASSIGN   5354>>ASSIGN
      5378<<ASSIGN   5379<<ASSIGN   5379>>ASSIGN   5383<<ASSIGN   5383>>ASSIGN   5389<<ASSIGN   5392>>ASSIGN
      5393>>ASSIGN   5395<<ASSIGN   5399>>ASSIGN   5404>>ASSIGN   5446<<ASSIGN   5550<<ASSIGN   5550>>ASSIGN
      5551>>ASSIGN
FM$GRAN.STAMP.GMOD
       812**DCL      5401<<ASSIGN
FM$SET
      4506**DCL      5028--ASSIGN   5031--ASSIGN   5164--ASSIGN   5215--CALL     5247--ASSIGN   5259--CALL
      5273--CALL     5430--CALL     5468--CALL     5485--CALL     5568--ASSIGN   5579--ASSIGN
FM$SET.DCTX
      4506**DCL      5028>>ASSIGN   5568>>ASSIGN
FM$SET.GACTIME
      4508**DCL      5080>>IF       5081>>ASSIGN
FM$SET.NXTSDA
      4508**DCL      5171>>ASSIGN
FM$SET.PSN
      4506**DCL      5101>>ASSIGN
FM$SET.USERLIST
      4507**DCL      4507--REDEF
FM$SET.XCL
      4506**DCL      5091>>IF       5102>>IF
FM$SET$
      4873**DCL      4506--IMP-PTR  5028>>ASSIGN   5028>>ASSIGN   5029>>DOWHILE  5031>>ASSIGN   5080>>IF
      5081>>ASSIGN   5091>>IF       5101>>ASSIGN   5102>>IF       5158>>DOWHILE  5164>>ASSIGN   5171>>ASSIGN
      5215>>CALL     5247>>ASSIGN   5248>>IF       5259>>CALL     5273>>CALL     5430>>CALL     5468>>CALL
      5485>>CALL     5568>>ASSIGN   5568>>ASSIGN   5569>>DOWHILE  5579>>ASSIGN
FM$VOL.GPSDA
      4514**DCL      5016<<ASSIGN   5217>>ASSIGN   5235<<ASSIGN
FM$VOL.NXTSDA
      4513**DCL      5163>>ASSIGN   5572>>ASSIGN
FM$VOL.RGRANS
      4514**DCL      5030>>ASSIGN   5159>>IF       5160>>ASSIGN   5245<<ASSIGN   5293>>IF       5298<<ASSIGN
      5301>>IF       5424<<ASSIGN   5424>>ASSIGN   5482<<ASSIGN   5482>>ASSIGN
FM$VOL.USERLIST
      4512**DCL      4513--REDEF
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:154  
FM$VOL.VOLL
      4513**DCL      5031>>ASSIGN   5164>>ASSIGN   5247>>ASSIGN   5579>>ASSIGN
FMB$LOGERR
      4875**DCL-ENT  5135--CALL     5441--CALL
FMC$CACHETBL.FLAGS.ERR
       924**DCL      5068<<ASSIGN
FMC$CLR1EXT
      4897**DCL-ENT  5041--CALL
FMC$CLRFILE
      4896**DCL-ENT  5114--CALL
FMC_CACHE$
       835**DCL       907--IMP-PTR  5068>>ASSIGN
FMC_CACHEPGCNT$
       836**DCL       836--IMP-PTR   836--REDEF
FMD$FLSHBUF
      4881**DCL-ENT  5062--CALL     5063--CALL     5064--CALL     5065--CALL     5272--CALL
FMD$GETBUF
      4882**DCL-ENT  5360--CALL
FMD$REDBUF
      4886**DCL-ENT  5221--CALL     5252--CALL     5409--CALL
FMD$RELBUF
      4892**DCL-ENT  5267--CALL     5454--CALL     5455--CALL     5467--CALL
FMD$WRTBUF
      4891**DCL-ENT  5258--CALL     5422--CALL     5423--CALL     5429--CALL     5484--CALL
FMD$WRTSV
      4880**DCL-ENT  5066--CALL     5447--CALL     5521--CALL     5522--CALL
FMN$READFIT
      4879**DCL-ENT  5058--CALL
FMO$LOCCODP
      4885**DCL-ENT  5073--CALL     5077--CALL
FMO$LOCCODX
      4884**DCL-ENT  5087--CALL
FMO$XTNTOFIT
      4883**DCL-ENT  5491--CALL
FMR$ADDGAC
      4893**DCL-ENT  5095--CALL
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:155  
FMR$L8
      4876**DCL-ENT  5199--CALL     5504--CALL
FMR$SLIDE
      4878**DCL-ENT  5352--CALL     5374--CALL     5394--CALL     5553--CALL
FMR$U8
      4877**DCL-ENT  5209--CALL     5475--CALL     5510--CALL
FMR$UPDGAC
      4894**DCL-ENT  5084--CALL     5498--CALL
FM_GPSDA
      4869**DCL      5015>>ASSIGN   5251>>ASSIGN   5312>>IF
FM_SRZERO
      4868**DCL      5011>>ASSIGN   5154>>ASSIGN   5163>>ASSIGN   5171>>ASSIGN   5172>>ASSIGN   5262>>DOWHILE
      5297>>ASSIGN   5564>>IF       5565>>ASSIGN   5567>>ASSIGN   5572>>ASSIGN
FM_SYSACCTX
      4870**DCL      5194>>IF       5507>>IF
G1COMMON
      4997**LABEL    4990--GOTO
GETVOL IN PROCEDURE SQZ
      5558**ENTRY    5014--CALL     5045--CALL     5117--CALL     5124--CALL     5156--CALL     5166--CALL
      5174--CALL     5300--CALL
GEXT
      5278**LABEL    5312--GOTO
GEXT0
      5152**LABEL    5002--GOTO     5517--GOTO
GNEXT
      5211**LABEL    5018--GOTO     5133--GOTO     5177--GOTO     5181--GOTO     5301--GOTO
GOTONE
      5478**LABEL    5283--GOTO
GRANULE
      4920**DCL      5362<<ASSIGN   5362>>ASSIGN
INXTN.ADR
      4958**DCL      5043>>ASSIGN
INXTN.SIZ
      4957**DCL      5046>>IF       5046>>ASSIGN
INXTN.SIZ2
      4959**DCL      5047>>ASSIGN
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:156  
NOGAC
      5103**LABEL    5073--CALLALT  5077--CALLALT
O
      4932**DCL      4935--REDEF    5458<>CALL     5491<>CALL
O.ADR
      4933**DCL      5110<<ASSIGN   5111>>ASSIGN   5112<<ASSIGN   5112>>ASSIGN   5122>>ASSIGN   5127<<ASSIGN
      5127>>ASSIGN   5130<<ASSIGN   5130>>ASSIGN   5132>>IF       5438<<ASSIGN   5439>>ASSIGN   5441<>CALL
      5478<<ASSIGN   5487>>ASSIGN   5516>>ASSIGN
O.SIZ
      4934**DCL      5001<<ASSIGN   5017<<ASSIGN   5111<<ASSIGN   5132>>IF       5152>>IF       5152<<ASSIGN
      5178>>IF       5178<<ASSIGN   5179>>ASSIGN   5180>>ASSIGN   5211>>ASSIGN   5282>>ASSIGN   5293>>IF
      5293>>IF       5298>>IF       5306>>IF       5310<<ASSIGN   5310>>ASSIGN   5439<<ASSIGN   5441<>CALL
      5481>>ASSIGN   5482>>ASSIGN   5493>>ASSIGN   5495>>IF       5495<<ASSIGN   5499>>ASSIGN   5505>>ASSIGN
      5509>>ASSIGN   5514<<ASSIGN   5538>>IF       5539>>ASSIGN   5539>>ASSIGN   5540<<ASSIGN   5540>>ASSIGN
OS.SIZ2
      4938**DCL      5149<<ASSIGN   5150>>IF       5150>>IF       5151<<ASSIGN
OVOL
      4942**DCL      5085<<ASSIGN   5087<>CALL     5088>>IF       5168>>ASSIGN   5175<<ASSIGN   5293>>IF
      5296>>ASSIGN   5574<<ASSIGN
PARM
      4953**DCL         9--PROC     4956--REDEF    4983--ENTRY    4992--ENTRY    5020--ENTRY    5035--ENTRY
      5041<>CALL     5050--ENTRY    5058<>CALL
PARM.P1
      4954**DCL      5026<<ASSIGN   5030<<ASSIGN   5030>>ASSIGN   5116>>ASSIGN   5135<>CALL     5487<<ASSIGN
PGRANS
      4214**DCL      5099<<ASSIGN   5106<>CALL     5106--CALL
PGRANS.CODE
      4215**DCL      5104<<ASSIGN
PGRANS.CREATOR
      4231**DCL      5100<<ASSIGN
PGRANS.FMACCT
      4240**DCL      5105<<ASSIGN
PGRANS.ONLINE
      4268**DCL      5103<<ASSIGN
PGRANS.PSN
      4245**DCL      5101<<ASSIGN
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:157  
PGRANS.SHELF
      4256**DCL      5102<<ASSIGN
R1EXT
      5133**LABEL    5048--GOTO
RD1ST
      5216**LABEL    5313--GOTO
RDNXT
      5217**LABEL    5289--GOTO
RDNXT0
      5287**LABEL    5226--GOTO     5228--GOTO     5244--GOTO     5325--GOTO
RELALT
      5457**LABEL    5491--CALLALT
RELNEXT
      5118**LABEL    5427--GOTO
RETALT0
      5446**LABEL    5409--CALLALT
RETALT1
      5462**LABEL    5136--GOTO     5221--CALLALT  5252--CALLALT  5443--GOTO     5456--GOTO     5471--GOTO
REXT
      5315**LABEL    5232--GOTO     5415--GOTO
REXT10
      5395**LABEL    5380--GOTO
REXT5
      5382**LABEL    5385--GOTO
RXTN
      4929**DCL      5135<>CALL     5260<<ASSIGN   5269>>ASSIGN   5441<>CALL     5457<<ASSIGN   5459>>ASSIGN
RXTN.ADR
      4930**DCL      5046>>ASSIGN   5047>>ASSIGN   5118>>ASSIGN   5126>>ASSIGN   5129>>ASSIGN   5133>>IF
      5318>>IF       5319>>IF       5320>>ASSIGN   5321>>ASSIGN   5336>>IF       5339>>IF       5344>>ASSIGN
      5356>>ASSIGN   5377>>IF       5400>>ASSIGN   5402<<ASSIGN   5402>>ASSIGN   5413>>IF       5424>>ASSIGN
      5575<<ASSIGN
RXTN.EADR
      4931**DCL      5046<<ASSIGN   5047<<ASSIGN   5118<<ASSIGN   5126<<ASSIGN   5129<<ASSIGN   5133>>IF
      5316>>IF       5332>>IF       5333>>IF       5357>>ASSIGN   5413>>IF       5419>>ASSIGN   5424>>ASSIGN
SC_GPERR
      4898**DCL-ENT  5421--CALL     5448--CALL     5483--CALL
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:158  
SDCT$
      4927**DCL      4283--IMP-PTR  4511--IMP-PTR  5016>>ASSIGN   5028<<ASSIGN   5029>>DOWHILE  5030>>ASSIGN
      5031<<ASSIGN   5031>>ASSIGN   5078<<ASSIGN   5079>>ASSIGN   5079>>ASSIGN   5089>>IF       5158>>DOWHILE
      5159>>IF       5160>>ASSIGN   5163>>ASSIGN   5164<<ASSIGN   5164>>ASSIGN   5217>>ASSIGN   5235>>ASSIGN
      5245>>ASSIGN   5247<<ASSIGN   5247>>ASSIGN   5248>>IF       5293>>IF       5298>>ASSIGN   5301>>IF
      5424>>ASSIGN   5424>>ASSIGN   5482>>ASSIGN   5482>>ASSIGN   5568<<ASSIGN   5569>>DOWHILE  5572>>ASSIGN
      5579<<ASSIGN   5579>>ASSIGN
SIZE
      4928**DCL      4929--REDEF    5011<<ASSIGN   5043<<ASSIGN   5116<<ASSIGN   5123<<ASSIGN   5154<<ASSIGN
      5161<<ASSIGN   5169<<ASSIGN   5171<<ASSIGN   5172<<ASSIGN   5172>>ASSIGN   5236<<ASSIGN   5242<<ASSIGN
      5242>>ASSIGN   5245>>ASSIGN   5282<<ASSIGN   5283>>IF       5284>>IF       5284>>ASSIGN   5296<<ASSIGN
      5297>>IF       5297<<ASSIGN   5302<<ASSIGN   5480>>IF       5564>>IF       5571<<ASSIGN   5571>>ASSIGN
      5573>>IF       5575>>ASSIGN
SQZ
      5544**PROC     5347--CALL     5480--CALL
SRDZERO
      4943**DCL      5161>>ASSIGN   5163<<ASSIGN   5163>>ASSIGN   5293>>IF       5297>>IF       5302>>ASSIGN
      5400>>ASSIGN   5478>>ASSIGN   5567<<ASSIGN   5574>>ASSIGN   5578<<ASSIGN   5578>>ASSIGN
T$
      4923**DCL      5058<>CALL     5059>>ASSIGN   5072<<ASSIGN   5073<>CALL     5074>>ASSIGN   5076<<ASSIGN
      5077<>CALL     5078>>ASSIGN   5086<<ASSIGN   5087<>CALL     5113<<ASSIGN   5114<>CALL     5221<>CALL
      5222>>ASSIGN   5252<>CALL     5253>>ASSIGN   5351<<ASSIGN   5352<>CALL     5360<>CALL     5361>>ASSIGN
      5409<>CALL     5410>>ASSIGN   5437<<ASSIGN   5441<>CALL     5552<<ASSIGN   5553<>CALL
TRYANOTHER
      5298**LABEL    5304--GOTO
UQB$MDEQ
      4888**DCL-ENT  5259--CALL     5273--CALL     5430--CALL     5468--CALL     5485--CALL
UQB$MENQX
      4887**DCL-ENT  5215--CALL
VOL#
      4941**DCL      5225>>DOWHILE  5230>>IF       5246<<ASSIGN   5246>>ASSIGN   5566<<ASSIGN   5570<<ASSIGN
      5570>>ASSIGN
VXH
      4912**DCL      5261<<ASSIGN   5269<<ASSIGN   5445<<ASSIGN
VXH.N
      4914**DCL      5226>>IF       5244>>IF       5286>>IF       5316>>IF       5373<<ASSIGN
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:159  
VXH.P
      4916**DCL      5234>>IF       5371<<ASSIGN
VXH.VOL
      4913**DCL      5225>>DOWHILE  5230>>IF
VXH.XTNS
      4919**DCL      5227>>ASSIGN   5230>>IF       5230>>IF       5238>>DOINDEX  5278>>DOINDEX  5316>>IF
      5317>>ASSIGN   5329>>IF       5355<<ASSIGN   5355>>ASSIGN   5364>>ASSIGN   5368>>ASSIGN   5369>>ASSIGN
      5370<<ASSIGN   5372<<ASSIGN   5421>>IF       5483>>IF       5555<<ASSIGN   5555>>ASSIGN
VXH$
      4925**DCL      4912--IMP-PTR  4926--REDEF    5224<<ASSIGN   5225>>DOWHILE  5226>>IF       5227<<ASSIGN
      5227>>ASSIGN   5227>>ASSIGN   5228>>IF       5230>>IF       5230>>IF       5230>>IF       5230>>IF
      5234>>IF       5238>>DOINDEX  5239>>ASSIGN   5244>>IF       5278>>DOINDEX  5279>>ASSIGN   5286>>IF
      5316>>IF       5316>>IF       5316>>IF       5317>>ASSIGN   5317>>ASSIGN   5319>>IF       5328>>ASSIGN
      5329>>IF       5355>>ASSIGN   5355>>ASSIGN   5363>>ASSIGN   5364>>ASSIGN   5368>>ASSIGN   5369>>ASSIGN
      5372>>ASSIGN   5373>>ASSIGN   5375>>ASSIGN   5377<<ASSIGN   5390<<ASSIGN   5414>>IF       5421>>IF
      5421>>IF       5440>>ASSIGN   5483>>IF       5483>>IF       5555>>ASSIGN   5555>>ASSIGN
VXH$N
      4926**DCL      5219<<ASSIGN   5223>>ASSIGN   5490<<ASSIGN   5492>>ASSIGN
X
      4944**DCL      4945--REDEF    5079<<ASSIGN   5084<>CALL     5088<<ASSIGN   5089<<ASSIGN   5090<<ASSIGN
      5095>>CALL     5102>>ASSIGN   5103>>ASSIGN   5106<>CALL     5157<<ASSIGN   5159>>IF       5160<<ASSIGN
      5168<<ASSIGN   5175>>ASSIGN   5179<<ASSIGN   5180<<ASSIGN   5216<<ASSIGN   5221<>CALL     5238<<DOINDEX
      5239>>ASSIGN   5249<<ASSIGN   5252<>CALL     5255<<ASSIGN   5256>>IF       5262>>DOWHILE  5263<>CALL
      5266<<ASSIGN   5278<<DOINDEX  5279>>ASSIGN   5287<<ASSIGN   5315<<ASSIGN   5327>>DOWHILE  5332<<ASSIGN
      5333<<ASSIGN   5335<<ASSIGN   5336<<ASSIGN   5336>>ASSIGN   5340>>DOCASE   5350<<ASSIGN   5352<>CALL
      5363<<ASSIGN   5364>>ASSIGN   5365>>IF       5366>>IF       5367>>ASSIGN   5368<<ASSIGN   5369>>ASSIGN
      5372>>ASSIGN   5374<>CALL     5375>>ASSIGN   5379>>ASSIGN   5382>>IF       5389>>ASSIGN   5393<<ASSIGN
      5394<>CALL     5405<<ASSIGN   5407>>IF       5409<>CALL     5440<<ASSIGN   5441<>CALL     5539<<ASSIGN
      5539>>ASSIGN   5551<<ASSIGN   5553<>CALL
XBUF.ADR
      4908**DCL      5240>>IF       5240>>IF       5242>>ASSIGN   5280>>IF       5280>>IF       5282>>ASSIGN
      5316>>IF       5318>>IF       5320<<ASSIGN   5346>>ASSIGN   5376>>ASSIGN   5377>>IF       5478>>ASSIGN
      5479>>IF       5481<<ASSIGN   5481>>ASSIGN   5507>>IF
XBUF.ADR1
      4910**DCL      5330>>IF       5331>>IF       5332>>IF       5333>>IF       5344<<ASSIGN   5346<<ASSIGN
      5356<<ASSIGN
PL6.E3A0      #001=FAG$ File=FAG$GEXT.:E05TSI                                    TUE 07/29/97 15:23 Page:160  
XBUF.EADR
      4909**DCL      5240>>IF       5240>>IF       5242>>ASSIGN   5280>>IF       5280>>IF       5282>>ASSIGN
      5319>>IF       5321<<ASSIGN   5330>>IF       5336>>IF       5339>>IF       5376<<ASSIGN   5419<<ASSIGN
      5479>>IF
XBUF.EADR1
      4911**DCL      5331>>IF       5357<<ASSIGN
XTN$
      4924**DCL      4214--IMP-PTR  4901--IMP-PTR  4904--IMP-PTR  4907--IMP-PTR  5098<<ASSIGN   5099>>ASSIGN
      5100>>ASSIGN   5101>>ASSIGN   5102>>ASSIGN   5103>>ASSIGN   5104>>ASSIGN   5105>>ASSIGN   5106>>CALL
      5122<<ASSIGN   5123>>ASSIGN   5125>>IF       5126>>ASSIGN   5129>>ASSIGN   5239<<ASSIGN   5240>>IF
      5240>>IF       5240>>IF       5240>>IF       5242>>ASSIGN   5242>>ASSIGN   5279<<ASSIGN   5280>>IF
      5280>>IF       5280>>IF       5280>>IF       5282>>ASSIGN   5282>>ASSIGN   5317<<ASSIGN   5318>>IF
      5319>>IF       5319>>IF       5320>>ASSIGN   5321>>ASSIGN   5328<<ASSIGN   5330>>IF       5330>>IF
      5331>>IF       5331>>IF       5332>>IF       5333>>IF       5336>>IF       5339>>IF       5344>>ASSIGN
      5346>>ASSIGN   5346>>ASSIGN   5350>>ASSIGN   5351>>ASSIGN   5356>>ASSIGN   5357>>ASSIGN   5361<<ASSIGN
      5362>>ASSIGN   5367>>ASSIGN   5377>>ASSIGN   5379>>ASSIGN   5379>>ASSIGN   5390>>ASSIGN   5394>>CALL
      5395>>ASSIGN   5398>>ASSIGN   5399>>ASSIGN   5399>>ASSIGN   5401>>ASSIGN   5414>>IF       5414>>ASSIGN
      5419>>ASSIGN   5438>>ASSIGN   5478>>ASSIGN   5479>>IF       5479>>IF       5481>>ASSIGN   5481>>ASSIGN
      5551>>ASSIGN   5552>>ASSIGN
XU
      4945**DCL      5180>>IF       5186>>DOWHILE  5196>>DOWHILE  5203>>DOWHILE
Y
      4946**DCL      5211<<ASSIGN   5284>>IF       5284<<ASSIGN   5293>>IF       5293>>IF       5298>>IF
      5302>>ASSIGN   5306>>IF       5310>>ASSIGN   5311<<ASSIGN   5311>>ASSIGN   5315<<ASSIGN   5328>>ASSIGN
      5329>>IF       5330>>IF       5336>>IF       5337<<ASSIGN   5337>>ASSIGN   5339>>IF       5364<<ASSIGN
      5366>>IF       5369<<ASSIGN   5370>>ASSIGN   5374<>CALL     5382>>IF       5383>>ASSIGN   5392<<ASSIGN
      5394<>CALL     5395>>ASSIGN   5513>>IF       5514>>ASSIGN   5565<<ASSIGN   5571>>ASSIGN   5572<<ASSIGN
      5573>>IF       5578>>ASSIGN
