VERSION E05

PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:1    
        1        1        /*M* FPK$KEYIN - Optical Disc Keyin Receiver                       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        FPK$KEYIN: PROC(KEYIN) ALTRET;
        9        9
       10       10        /*F*  NAME: FPK$KEYIN
       11       11              PURPOSE: Receiver for optical disc keyins.
       12       12              DESCRIPTION:
       13       13         */
       14       14
       15       15
       16       16         /*
       17       17          *** INCLUDE files:
       18       18          */
       19       19
       20       20        %INCLUDE FR$RAT;
       21       73           %FR$RAT;
       22      113        %INCLUDE FR_SUBS;
       23      181        %INCLUDE K$RWPARM;
       24      567        %INCLUDE NK$LDCT;
       25      669           %NK$LDCT;
       26      715        %INCLUDE FP_MACRO_C;
       27      987        %INCLUDE HF_LOCK_C;
       28     1001        %INCLUDE NI_DATA_R;
       29     1438           %NI$DCT (NAME=DCT,STCLASS=BASED);
       30     1486           %NI$DQH;
       31     1509        %INCLUDE OC_SUBS_C;
       32     2240        %INCLUDE KI_MACROS_C;
       33     2848        %INCLUDE KV$VDO;
       34     3863           %KV_VDO_E;
       35     3899        %KI$ROUTE (STCLASS = BASED);
       36     3953    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
       37     3954
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:2    
       38     3955        /*    External                   */
       39     3956
       40     3957    1   DCL KIA$FCNOU ENTRY(3) ALTRET;       /* Write message to OD    */
       41     3958    1   DCL KIN$CONV_NODENAME ENTRY(3) ALTRET;  /* convert node name to fei#*/
       42     3959    1   DCL KIN$CONV_NODE ENTRY(3) ALTRET;
       43     3960    1   DCL OCI$MK_WR ENTRY(7);                 /* Tell operator                      */
       44     3961    1   DCL FR$HD$(0:0) PTR SYMREF;
       45     3962    1   DCL KI_ROUTE$$ PTR SYMREF;
       46     3963        %K$RWPARM (NAME=K_RWPARM_CON, STCLASS=SYMREF);
       47     4279
       48     4280        /*    Parameters:   */
       49     4281
       50     4282    1   DCL 1 KEYIN,                            /* Keyin packet                       */
       51     4283    1         2 KIN UBIN HALF UNAL,             /* Keyin number                       */
       52     4284    1         2 CADDR BIT(18) UNAL,             /* Originating console's address      */
       53     4285    1         2 FEX UBIN WORD UNAL,             /* fep node number     */
       54     4286    1         2 NAME CHAR(8) UNAL,             /* fep name  */
       55     4287    1         2 SN CHAR(6) UNAL;                /* Serial number          */
       56     4288
       57     4289        /*    AUTO data:      */
       58     4290
       59     4291    1   DCL O$ PTR;
       60     4292    1   DCL DCT$ PTR;
       61     4293    1   DCL HOST BIT(1);
       62     4294    1   DCL DCTX UBIN;
       63     4295    1   DCL I UBIN;
       64     4296        %K$RWPARM (NAME = K$RWPARM, STCLASS = "");
       65     4612    1   DCL LDCT$ PTR;
       66     4613        %FPP$OCKEYNREQ (STCLASS = AUTO);
       67     4631    1   DCL FEI UBIN WORD;
       68     4632
       69     4633        /*    Static data                  */
       70     4634
       71     4635    1   DCL MSGL BIT(36) STATIC INIT('006001001000'O);
       72     4636    1   DCL 1 MSGTBL STATIC,
       73     4637    1         2 SN CHAR(6) CALIGNED INIT('      '),
       74     4638    1         2 TYP UBIN BYTE UNAL INIT(0),
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:3    
       75     4639    1         2 MSG UBIN BYTE UNAL INIT(2); /* select error message  */
       76     4640
       77     4641        %EJECT;
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:4    
       78     4642    1         IF KEYIN.FEX = 0 AND KEYIN.NAME = ' ' THEN
       79     4643    1            RETURN;
       80     4644    1         IF KEYIN.FEX = 0 THEN
       81     4645    1            CALL KIN$CONV_NODENAME (KEYIN.NAME,KEYIN.FEX,HOST) ALTRET(BADFEP);
       82     4646    1         ELSE
       83     4647    1            CALL KIN$CONV_NODE(KEYIN.NAME,KEYIN.FEX,HOST) ALTRET(BADFEP);
       84     4648    1         O$ = FR$HD$(FR_NPOOL);
       85     4649    2         DO WHILE (O$ ~= ADDR(NIL));
       86     4650    2            DCT$ = N$DCT$(O$->FR$RAT.DCTX);
       87     4651    2            IF O$->FR$RAT.TYP = 'OD' AND
       88     4652    2               DCT$->DCT.DQH$->NI$DQH.FEX =
       89     4653    2                  KI$ROUTE$(KEYIN.FEX)->KI$ROUTE.FEI# THEN
       90     4654    2               GOTO GOTFEP;
       91     4655    2            O$ = O$->FR$RAT.LNK$;
       92     4656    2            END;
       93     4657    1   BADFEP:
       94     4658    1         CALL OCI$MK_WR(KEYIN.CADDR,FP_OSAR_MSG#,3,MSGL,MSGTBL,,);
       95     4659    1         RETURN;
       96     4660
       97     4661        /*    Determine what to do from keyin.           */
       98     4662
       99     4663    1   GOTFEP:
      100     4664    1         FPP$OCKEYNREQ = '0'B;
      101     4665    1         FPP$OCKEYNREQ.DEV# = 0;      /* Message for admin path       */
      102     4666    1         FPP$OCKEYNREQ.DCTX = '0'B;   /* not req'd- no response expected*/
      103     4667    1         FPP$OCKEYNREQ.SER = KEYIN.SN;
      104     4668    1         K$RWPARM = K_RWPARM_CON;
      105     4669    1         K$RWPARM.MSG$ = ADDR(FPP$OCKEYNREQ);
      106     4670    1         K$RWPARM.MSGSZ = SIZEC(FPP$OCKEYNREQ);
      107     4671    1         CALL INDEX (I,' ',KEYIN.SN);
      108     4672    2         DO CASE(KEYIN.KIN);
      109     4673    2         CASE (KEY_ODUNLOAD#);
      110     4674    2            FPP$OCKEYNREQ.FNC = %FP_FNC_UNLOADSN;
      111     4675    2         CASE (KEY_ODVOLINIT#);
      112     4676    2            IF I = 0 OR I > 5 THEN
      113     4677    2               GOTO BADFEP;
      114     4678    2            FPP$OCKEYNREQ.FNC = %FP_FNC_VOLINIT;
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:5    
      115     4679    2         CASE (KEY_ODUNLOAD2#);
      116     4680    2            FPP$OCKEYNREQ.FNC = %FP_FNC_UNLOADID;
      117     4681    2         END;
      118     4682    1         LDCT$ = DCT$->DCT.OD.LDCT$;
      119     4683              %LOCK (G=LDCT$->NK$LDCT.LOCK);
      120     4686    1         CALL KIA$FCNOU(LDCT$->NK$LDCT,%KV_VDO_FNC_DAT,K$RWPARM) ALTRET(BADFEP);
      121     4687              %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      122     4690    1         RETURN;
      123     4691    1   END;

PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:6    
--  Include file information  --

   KV$VDO.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FP_MACRO_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
      No diagnostics issued in procedure FPK$KEYIN.

   Procedure FPK$KEYIN requires 160 words for executable code.
   Procedure FPK$KEYIN requires 62 words of local(AUTO) storage.

    No errors detected in file FPK$KEYIN.:E05TSI    .

PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:7    

 Object Unit name= FPK$KEYIN                                  File name= FPK$KEYIN.:E05TOU
 UTS= JUL 29 '97 17:18:09.88 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     3      3  FPK$KEYIN
    1  RoData even  UTS      1      1  FPK$KEYIN
    2   Proc  even  none   160    240  FPK$KEYIN
    3  RoData even  none     6      6  FPK$KEYIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  FPK$KEYIN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KIN$CONV_NODENAME
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 KIN$CONV_NODE
         yes           Std       7 OCI$MK_WR
         yes           Std       1 HFC$LOCK
 yes     yes           Std       3 KIA$FCNOU
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:8    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                              NI$RP$                                FR$HD$
     KI_ROUTE$$                            K_RWPARM_CON                          B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:9    


        1        1        /*M* FPK$KEYIN - Optical Disc Keyin Receiver                       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        FPK$KEYIN: PROC(KEYIN) ALTRET;

      8  2 000000   000000 700200 xent  FPK$KEYIN    TSX0  ! X66_AUTO_1
         2 000001   000076 000001                    ZERO    62,1

        9        9
       10       10        /*F*  NAME: FPK$KEYIN
       11       11              PURPOSE: Receiver for optical disc keyins.
       12       12              DESCRIPTION:
       13       13         */
       14       14
       15       15
       16       16         /*
       17       17          *** INCLUDE files:
       18       18          */
       19       19
       20       20        %INCLUDE FR$RAT;
       21       73           %FR$RAT;
       22      113        %INCLUDE FR_SUBS;
       23      181        %INCLUDE K$RWPARM;
       24      567        %INCLUDE NK$LDCT;
       25      669           %NK$LDCT;
       26      715        %INCLUDE FP_MACRO_C;
       27      987        %INCLUDE HF_LOCK_C;
       28     1001        %INCLUDE NI_DATA_R;
       29     1438           %NI$DCT (NAME=DCT,STCLASS=BASED);
       30     1486           %NI$DQH;
       31     1509        %INCLUDE OC_SUBS_C;
       32     2240        %INCLUDE KI_MACROS_C;
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:10   
       33     2848        %INCLUDE KV$VDO;
       34     3863           %KV_VDO_E;
       35     3899        %KI$ROUTE (STCLASS = BASED);
       36     3953    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
       37     3954
       38     3955        /*    External                   */
       39     3956
       40     3957    1   DCL KIA$FCNOU ENTRY(3) ALTRET;       /* Write message to OD    */
       41     3958    1   DCL KIN$CONV_NODENAME ENTRY(3) ALTRET;  /* convert node name to fei#*/
       42     3959    1   DCL KIN$CONV_NODE ENTRY(3) ALTRET;
       43     3960    1   DCL OCI$MK_WR ENTRY(7);                 /* Tell operator                      */
       44     3961    1   DCL FR$HD$(0:0) PTR SYMREF;
       45     3962    1   DCL KI_ROUTE$$ PTR SYMREF;
       46     3963        %K$RWPARM (NAME=K_RWPARM_CON, STCLASS=SYMREF);
       47     4279
       48     4280        /*    Parameters:   */
       49     4281
       50     4282    1   DCL 1 KEYIN,                            /* Keyin packet                       */
       51     4283    1         2 KIN UBIN HALF UNAL,             /* Keyin number                       */
       52     4284    1         2 CADDR BIT(18) UNAL,             /* Originating console's address      */
       53     4285    1         2 FEX UBIN WORD UNAL,             /* fep node number     */
       54     4286    1         2 NAME CHAR(8) UNAL,             /* fep name  */
       55     4287    1         2 SN CHAR(6) UNAL;                /* Serial number          */
       56     4288
       57     4289        /*    AUTO data:      */
       58     4290
       59     4291    1   DCL O$ PTR;
       60     4292    1   DCL DCT$ PTR;
       61     4293    1   DCL HOST BIT(1);
       62     4294    1   DCL DCTX UBIN;
       63     4295    1   DCL I UBIN;
       64     4296        %K$RWPARM (NAME = K$RWPARM, STCLASS = "");
       65     4612    1   DCL LDCT$ PTR;
       66     4613        %FPP$OCKEYNREQ (STCLASS = AUTO);
       67     4631    1   DCL FEI UBIN WORD;
       68     4632
       69     4633        /*    Static data                  */
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:11   
       70     4634
       71     4635    1   DCL MSGL BIT(36) STATIC INIT('006001001000'O);
       72     4636    1   DCL 1 MSGTBL STATIC,
       73     4637    1         2 SN CHAR(6) CALIGNED INIT('      '),
       74     4638    1         2 TYP UBIN BYTE UNAL INIT(0),
       75     4639    1         2 MSG UBIN BYTE UNAL INIT(2); /* select error message  */
       76     4640
       77     4641        %EJECT;
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:12   
       78     4642    1         IF KEYIN.FEX = 0 AND KEYIN.NAME = ' ' THEN

   4642  2 000002   200003 470500                    LDP0    @KEYIN,,AUTO
         2 000003   000100 100500                    MLR     fill='000'O
         2 000004   000001 000004                    ADSC9   1,,PR0                   cn=0,n=4
         2 000005   200070 000004                    ADSC9   FPP$OCKEYNREQ+5,,AUTO    cn=0,n=4
         2 000006   200070 236100                    LDQ     FPP$OCKEYNREQ+5,,AUTO
         2 000007   000000 116003                    CMPQ    0,DU
         2 000010   000016 601000 2                  TNZ     s:4644
         2 000011   040000 106500                    CMPC    fill='040'O
         2 000012   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         2 000013   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000014   000016 601000 2                  TNZ     s:4644

       79     4643    1            RETURN;

   4643  2 000015   000000 702200 xent               TSX2  ! X66_ARET

       80     4644    1         IF KEYIN.FEX = 0 THEN

   4644  2 000016   000100 100500                    MLR     fill='000'O
         2 000017   000001 000004                    ADSC9   1,,PR0                   cn=0,n=4
         2 000020   200070 000004                    ADSC9   FPP$OCKEYNREQ+5,,AUTO    cn=0,n=4
         2 000021   200070 236100                    LDQ     FPP$OCKEYNREQ+5,,AUTO
         2 000022   000000 116003                    CMPQ    0,DU
         2 000023   000041 601000 2                  TNZ     s:4647

       81     4645    1            CALL KIN$CONV_NODENAME (KEYIN.NAME,KEYIN.FEX,HOST) ALTRET(BADFEP);

   4645  2 000024   200006 631500                    EPPR1   HOST,,AUTO
         2 000025   200072 451500                    STP1    FPP$OCKEYNREQ+7,,AUTO
         2 000026   200003 236100                    LDQ     @KEYIN,,AUTO
         2 000027   000001 036003                    ADLQ    1,DU
         2 000030   200071 756100                    STQ     FPP$OCKEYNREQ+6,,AUTO
         2 000031   200003 236100                    LDQ     @KEYIN,,AUTO
         2 000032   000002 036003                    ADLQ    2,DU
         2 000033   200070 756100                    STQ     FPP$OCKEYNREQ+5,,AUTO
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:13   
         2 000034   200070 630500                    EPPR0   FPP$OCKEYNREQ+5,,AUTO
         2 000035   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000036   000000 701000 xent               TSX1    KIN$CONV_NODENAME
         2 000037   000115 702000 2                  TSX2    BADFEP
         2 000040   000055 710000 2                  TRA     s:4648

       82     4646    1         ELSE
       83     4647    1            CALL KIN$CONV_NODE(KEYIN.NAME,KEYIN.FEX,HOST) ALTRET(BADFEP);

   4647  2 000041   200006 631500                    EPPR1   HOST,,AUTO
         2 000042   200072 451500                    STP1    FPP$OCKEYNREQ+7,,AUTO
         2 000043   200003 236100                    LDQ     @KEYIN,,AUTO
         2 000044   000001 036003                    ADLQ    1,DU
         2 000045   200071 756100                    STQ     FPP$OCKEYNREQ+6,,AUTO
         2 000046   200003 236100                    LDQ     @KEYIN,,AUTO
         2 000047   000002 036003                    ADLQ    2,DU
         2 000050   200070 756100                    STQ     FPP$OCKEYNREQ+5,,AUTO
         2 000051   200070 630500                    EPPR0   FPP$OCKEYNREQ+5,,AUTO
         2 000052   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000053   000000 701000 xent               TSX1    KIN$CONV_NODE
         2 000054   000115 702000 2                  TSX2    BADFEP

       84     4648    1         O$ = FR$HD$(FR_NPOOL);

   4648  2 000055   000002 236000 xsym               LDQ     FR$HD$+2
         2 000056   200004 756100                    STQ     O$,,AUTO

       85     4649    2         DO WHILE (O$ ~= ADDR(NIL));

   4649  2 000057   000113 710000 2                  TRA     s:4656

       86     4650    2            DCT$ = N$DCT$(O$->FR$RAT.DCTX);

   4650  2 000060   200004 470500                    LDP0    O$,,AUTO
         2 000061   000003 720100                    LXL0    3,,PR0
         2 000062   000000 471400 xsym               LDP1    N$DCT$$
         2 000063   100000 236110                    LDQ     0,X0,PR1
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:14   
         2 000064   200005 756100                    STQ     DCT$,,AUTO

       87     4651    2            IF O$->FR$RAT.TYP = 'OD' AND

   4651  2 000065   000010 221100                    LDX1    8,,PR0
         2 000066   000000 101000 1                  CMPX1   0
         2 000067   000111 601000 2                  TNZ     s:4655
         2 000070   200005 473500                    LDP3    DCT$,,AUTO
         2 000071   300023 474500                    LDP4    19,,PR3
         2 000072   200003 475500                    LDP5    @KEYIN,,AUTO
         2 000073   000100 101500                    MRL     fill='000'O
         2 000074   500001 000004                    ADSC9   1,,PR5                   cn=0,n=4
         2 000075   200070 000002                    ADSC9   FPP$OCKEYNREQ+5,,AUTO    cn=0,n=2
         2 000076   200070 220100                    LDX0    FPP$OCKEYNREQ+5,,AUTO
         2 000077   000000 476400 xsym               LDP6    KI_ROUTE$$
         2 000100   600000 477510                    LDP7    0,X0,PR6
         2 000101   700002 236100                    LDQ     2,,PR7
         2 000102   000033 772000                    QRL     27
         2 000103   200071 756100                    STQ     FPP$OCKEYNREQ+6,,AUTO
         2 000104   400001 236100                    LDQ     1,,PR4
         2 000105   000006 772000                    QRL     6
         2 000106   000077 376007                    ANQ     63,DL
         2 000107   200071 116100                    CMPQ    FPP$OCKEYNREQ+6,,AUTO
         2 000110   000133 600000 2                  TZE     GOTFEP

       88     4652    2               DCT$->DCT.DQH$->NI$DQH.FEX =
       89     4653    2                  KI$ROUTE$(KEYIN.FEX)->KI$ROUTE.FEI# THEN
       90     4654    2               GOTO GOTFEP;
       91     4655    2            O$ = O$->FR$RAT.LNK$;

   4655  2 000111   000000 236100                    LDQ     0,,PR0
         2 000112   200004 756100                    STQ     O$,,AUTO

       92     4656    2            END;

   4656  2 000113   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000114   000060 601000 2                  TNZ     s:4650
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:15   

       93     4657    1   BADFEP:
       94     4658    1         CALL OCI$MK_WR(KEYIN.CADDR,FP_OSAR_MSG#,3,MSGL,MSGTBL,,);

   4658  2 000115   000001 236000 3     BADFEP       LDQ     1
         2 000116   200074 756100                    STQ     FPP$OCKEYNREQ+9,,AUTO
         2 000117   000002 237000 3                  LDAQ    2
         2 000120   200072 757100                    STAQ    FPP$OCKEYNREQ+7,,AUTO
         2 000121   000004 236000 3                  LDQ     4
         2 000122   200071 756100                    STQ     FPP$OCKEYNREQ+6,,AUTO
         2 000123   200003 236100                    LDQ     @KEYIN,,AUTO
         2 000124   400000 036007                    ADLQ    -131072,DL
         2 000125   200070 756100                    STQ     FPP$OCKEYNREQ+5,,AUTO
         2 000126   200070 630500                    EPPR0   FPP$OCKEYNREQ+5,,AUTO
         2 000127   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000130   000000 701000 xent               TSX1    OCI$MK_WR
         2 000131   000000 011000                    NOP     0

       95     4659    1         RETURN;

   4659  2 000132   000000 702200 xent               TSX2  ! X66_ARET

       96     4660
       97     4661        /*    Determine what to do from keyin.           */
       98     4662
       99     4663    1   GOTFEP:
      100     4664    1         FPP$OCKEYNREQ = '0'B;

   4664  2 000133   000100 100400       GOTFEP       MLR     fill='000'O
         2 000134   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000135   200063 000015                    ADSC9   FPP$OCKEYNREQ,,AUTO      cn=0,n=13

      101     4665    1         FPP$OCKEYNREQ.DEV# = 0;      /* Message for admin path       */

   4665  2 000136   000000 236003                    LDQ     0,DU
         2 000137   200063 552110                    STBQ    FPP$OCKEYNREQ,'10'O,AUTO

PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:16   
      102     4666    1         FPP$OCKEYNREQ.DCTX = '0'B;   /* not req'd- no response expected*/

   4666  2 000140   000000 221003                    LDX1    0,DU
         2 000141   200064 741100                    STX1    FPP$OCKEYNREQ+1,,AUTO

      103     4667    1         FPP$OCKEYNREQ.SER = KEYIN.SN;

   4667  2 000142   040100 100500                    MLR     fill='040'O
         2 000143   500004 000006                    ADSC9   4,,PR5                   cn=0,n=6
         2 000144   200064 400006                    ADSC9   FPP$OCKEYNREQ+1,,AUTO    cn=2,n=6

      104     4668    1         K$RWPARM = K_RWPARM_CON;

   4668  2 000145   000100 100400                    MLR     fill='000'O
         2 000146   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 000147   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      105     4669    1         K$RWPARM.MSG$ = ADDR(FPP$OCKEYNREQ);

   4669  2 000150   200063 634500                    EPPR4   FPP$OCKEYNREQ,,AUTO
         2 000151   200012 454500                    STP4    K$RWPARM,,AUTO

      106     4670    1         K$RWPARM.MSGSZ = SIZEC(FPP$OCKEYNREQ);

   4670  2 000152   000015 235007                    LDA     13,DL
         2 000153   200013 755100                    STA     K$RWPARM+1,,AUTO

      107     4671    1         CALL INDEX (I,' ',KEYIN.SN);

   4671  2 000154   000000 124500                    SCM     mask='000'O
         2 000155   500004 000006                    ADSC9   4,,PR5                   cn=0,n=6
         2 000156   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000157   200010 000100                    ARG     I,,AUTO

      108     4672    2         DO CASE(KEYIN.KIN);

   4672  2 000160   000100 100500                    MLR     fill='000'O
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:17   
         2 000161   500000 000002                    ADSC9   0,,PR5                   cn=0,n=2
         2 000162   200070 000004                    ADSC9   FPP$OCKEYNREQ+5,,AUTO    cn=0,n=4
         2 000163   200070 220100                    LDX0    FPP$OCKEYNREQ+5,,AUTO
         2 000164   000004 100003                    CMPX0   4,DU
         2 000165   000167 602010 2                  TNC     s:4672+7,X0
         2 000166   000207 710000 2                  TRA     s:4682
         2 000167   000207 710000 2                  TRA     s:4682
         2 000170   000173 710000 2                  TRA     s:4674
         2 000171   000205 710000 2                  TRA     s:4680
         2 000172   000176 710000 2                  TRA     s:4676

      109     4673    2         CASE (KEY_ODUNLOAD#);

      110     4674    2            FPP$OCKEYNREQ.FNC = %FP_FNC_UNLOADSN;

   4674  2 000173   031000 236003                    LDQ     12800,DU
         2 000174   200063 552140                    STBQ    FPP$OCKEYNREQ,'40'O,AUTO
         2 000175   000207 710000 2                  TRA     s:4682

      111     4675    2         CASE (KEY_ODVOLINIT#);

      112     4676    2            IF I = 0 OR I > 5 THEN

   4676  2 000176   200010 235100                    LDA     I,,AUTO
         2 000177   000115 600000 2                  TZE     BADFEP
         2 000200   000006 115007                    CMPA    6,DL
         2 000201   000115 603000 2                  TRC     BADFEP

      113     4677    2               GOTO BADFEP;
      114     4678    2            FPP$OCKEYNREQ.FNC = %FP_FNC_VOLINIT;

   4678  2 000202   043000 236003                    LDQ     17920,DU
         2 000203   200063 552140                    STBQ    FPP$OCKEYNREQ,'40'O,AUTO
         2 000204   000207 710000 2                  TRA     s:4682

      115     4679    2         CASE (KEY_ODUNLOAD2#);

PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:18   
      116     4680    2            FPP$OCKEYNREQ.FNC = %FP_FNC_UNLOADID;

   4680  2 000205   032000 236003                    LDQ     13312,DU
         2 000206   200063 552140                    STBQ    FPP$OCKEYNREQ,'40'O,AUTO

      117     4681    2         END;

      118     4682    1         LDCT$ = DCT$->DCT.OD.LDCT$;

   4682  2 000207   300030 236100                    LDQ     24,,PR3
         2 000210   200062 756100                    STQ     LDCT$,,AUTO

      119     4683              %LOCK (G=LDCT$->NK$LDCT.LOCK);

   4684  2 000211   000020 036003                    ADLQ    16,DU
         2 000212   200070 756100                    STQ     FPP$OCKEYNREQ+5,,AUTO
         2 000213   200070 630500                    EPPR0   FPP$OCKEYNREQ+5,,AUTO
         2 000214   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000215   000000 701000 xent               TSX1    HFC$LOCK
         2 000216   000000 011000                    NOP     0

      120     4686    1         CALL KIA$FCNOU(LDCT$->NK$LDCT,%KV_VDO_FNC_DAT,K$RWPARM) ALTRET(BADFEP);

   4686  2 000217   200012 630500                    EPPR0   K$RWPARM,,AUTO
         2 000220   200072 450500                    STP0    FPP$OCKEYNREQ+7,,AUTO
         2 000221   000005 236000 3                  LDQ     5
         2 000222   200062 235100                    LDA     LDCT$,,AUTO
         2 000223   200070 757100                    STAQ    FPP$OCKEYNREQ+5,,AUTO
         2 000224   200070 630500                    EPPR0   FPP$OCKEYNREQ+5,,AUTO
         2 000225   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000226   000000 701000 xent               TSX1    KIA$FCNOU
         2 000227   000115 702000 2                  TSX2    BADFEP

      121     4687              %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

   4688  2 000230   200062 236100                    LDQ     LDCT$,,AUTO
         2 000231   000020 036003                    ADLQ    16,DU
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:19   
         2 000232   200070 756100                    STQ     FPP$OCKEYNREQ+5,,AUTO
         2 000233   200070 630500                    EPPR0   FPP$OCKEYNREQ+5,,AUTO
         2 000234   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000235   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000236   000000 011000                    NOP     0

      122     4690    1         RETURN;

   4690  2 000237   000000 702200 xent               TSX2  ! X66_ARET

MSGL
 Sect OctLoc
   0     000   006001 001000                                                    ....

MSGTBL
 Sect OctLoc
   0     001   040040 040040   040040 000002                                          ..

(unnamed)
 Sect OctLoc
   1     000   117104 040040                                                    OD

(unnamed)
 Sect OctLoc
   3     000   000000 000506   000001 006000   000005 006000   000000 006000    ................
   3     004   000000 006000   000007 006000                                    ........
      123     4691    1   END;

PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:20   
--  Include file information  --

   KV$VDO.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FP_MACRO_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
      No diagnostics issued in procedure FPK$KEYIN.
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:21   

 **** Variables and constants ****

  ****  Section 000  Data  FPK$KEYIN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT         r     1 MSGL                       1-0-0/c STRC(72)    r     1 MSGTBL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @KEYIN                     5-0-0/w PTR         r     1 DCT$
    63-0-0/c STRC(117)   r     1 FPP$OCKEYNREQ              6-0-0/b BIT         r     1 HOST
    10-0-0/w UBIN        r     1 I                         12-0-0/d STRC(1404)  r     1 K$RWPARM
    *0-0-0/c STRC(198)   r     1 KEYIN                     62-0-0/w PTR         r     1 LDCT$
     4-0-0/w PTR         r     1 O$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 FR$HD$(0:0)                0-0-0/w PTR         r     1 KI_ROUTE$$
     0-0-0/d STRC(1404)  r     1 K_RWPARM_CON               0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w PTR         r     1 N$FQ$                      0-0-0/w PTR         r     1 NI$FQ$
     0-0-0/w PTR         r     1 NI$IBUF$                   0-0-0/w PTR         r     1 NI$RP$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w STRC(324)   r     1 FR$RAT
     0-0-0/w STRC(216)   r     1 KI$ROUTE
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:22   
     0-0-0/w PTR         r     1 KI$ROUTE$(0:0)
     0-0-0/w PTR         r     1 N$DCT$(0:0)                0-0-0/w STRC(648)   r     1 NI$DQH
     0-0-0/d STRC(864)   r     1 NK$LDCT


   Procedure FPK$KEYIN requires 160 words for executable code.
   Procedure FPK$KEYIN requires 62 words of local(AUTO) storage.

    No errors detected in file FPK$KEYIN.:E05TSI    .
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:23   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:24   
          MINI XREF LISTING

BADFEP
      4658**LABEL    4645--CALLALT  4647--CALLALT  4677--GOTO     4686--CALLALT
DCT.DP
      1467**DCL      1474--REDEF    1477--REDEF    1478--REDEF    1480--REDEF    1480--REDEF    1481--REDEF
      1482--REDEF    1482--REDEF
DCT.DQH$
      1463**DCL      4651>>IF
DCT.MPC.IOCHANX
      1475**DCL      1475--REDEF
DCT.OD.LDCT$
      1482**DCL      4682>>ASSIGN
DCT$
      4292**DCL      4650<<ASSIGN   4651>>IF       4682>>ASSIGN
FPP$OCKEYNREQ
      4619**DCL      4664<<ASSIGN   4669--ASSIGN   4670--ASSIGN
FPP$OCKEYNREQ.DCTX
      4624**DCL      4666<<ASSIGN
FPP$OCKEYNREQ.DEV#
      4622**DCL      4665<<ASSIGN
FPP$OCKEYNREQ.FNC
      4620**DCL      4674<<ASSIGN   4678<<ASSIGN   4680<<ASSIGN
FPP$OCKEYNREQ.SER
      4628**DCL      4667<<ASSIGN
FR$HD$
      3961**DCL      4648>>ASSIGN
FR$RAT.DCTX
        93**DCL      4650>>ASSIGN
FR$RAT.LNK$
        76**DCL      4655>>ASSIGN
FR$RAT.TYP
        99**DCL      4651>>IF
GOTFEP
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:25   
      4664**LABEL    4654--GOTO
HFC$LOCK
      1000**DCL-ENT  4684--CALL
HFC$UNLOCK
      1000**DCL-ENT  4688--CALL
HOST
      4293**DCL      4645<>CALL     4647<>CALL
I
      4295**DCL      4671<<CALLBLT  4676>>IF       4676>>IF
K$RWPARM
      4317**DCL      4668<<ASSIGN   4686<>CALL
K$RWPARM.BLKREC
      4343**DCL      4368--REDEF
K$RWPARM.BLKREC.BLKU#
      4344**DCL      4346--REDEF
K$RWPARM.BLKREC.RECU#
      4356**DCL      4358--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      4383**DCL      4384--REDEF
K$RWPARM.DVE.EOMCHAR
      4391**DCL      4395--REDEF
K$RWPARM.ERR
      4455**DCL      4460--REDEF
K$RWPARM.FC
      4419**DCL      4420--REDEF
K$RWPARM.FLDID
      4601**DCL      4602--REDEF
K$RWPARM.FPT$
      4482**DCL      4489--REDEF
K$RWPARM.KEYTYPE
      4608**DCL      4609--REDEF
K$RWPARM.MSG$
      4318**DCL      4324--REDEF    4669<<ASSIGN
K$RWPARM.MSGID
      4430**DCL      4435--REDEF
K$RWPARM.MSGIDXT
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:26   
      4443**DCL      4447--REDEF
K$RWPARM.MSGSZ
      4325**DCL      4670<<ASSIGN
K$RWPARM.ORG
      4579**DCL      4580--REDEF
K$RWPARM.THDRSZ
      4523**DCL      4527--REDEF
K$RWPARM.VDOFLGS
      4581**DCL      4592--REDEF
KEYIN
      4282**DCL         8--PROC
KEYIN.CADDR
      4284**DCL      4658<>CALL
KEYIN.FEX
      4285**DCL      4642>>IF       4644>>IF       4645<>CALL     4647<>CALL     4651>>IF
KEYIN.KIN
      4283**DCL      4672>>DOCASE
KEYIN.NAME
      4286**DCL      4642>>IF       4645<>CALL     4647<>CALL
KEYIN.SN
      4287**DCL      4667>>ASSIGN   4671>>CALLBLT
KI$ROUTE.FEI#
      3911**DCL      4651>>IF
KI$ROUTE$
      3953**DCL      4651>>IF
KIA$FCNOU
      3957**DCL-ENT  4686--CALL
KIN$CONV_NODE
      3959**DCL-ENT  4647--CALL
KIN$CONV_NODENAME
      3958**DCL-ENT  4645--CALL
KI_ROUTE$$
      3962**DCL      3953--IMP-PTR  4651>>IF
K_RWPARM_CON
      3984**DCL      4668>>ASSIGN
K_RWPARM_CON.BLKREC
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:27   
      4010**DCL      4035--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      4011**DCL      4013--REDEF
K_RWPARM_CON.BLKREC.RECU#
      4023**DCL      4025--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      4050**DCL      4051--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      4058**DCL      4062--REDEF
K_RWPARM_CON.ERR
      4122**DCL      4127--REDEF
K_RWPARM_CON.FC
      4086**DCL      4087--REDEF
K_RWPARM_CON.FLDID
      4268**DCL      4269--REDEF
K_RWPARM_CON.FPT$
      4149**DCL      4156--REDEF
K_RWPARM_CON.KEYTYPE
      4275**DCL      4276--REDEF
K_RWPARM_CON.MSG$
      3985**DCL      3991--REDEF
K_RWPARM_CON.MSGID
      4097**DCL      4102--REDEF
K_RWPARM_CON.MSGIDXT
      4110**DCL      4114--REDEF
K_RWPARM_CON.ORG
      4246**DCL      4247--REDEF
K_RWPARM_CON.THDRSZ
      4190**DCL      4194--REDEF
K_RWPARM_CON.VDOFLGS
      4248**DCL      4259--REDEF
LDCT$
      4612**DCL      4682<<ASSIGN   4684>>CALL     4686>>CALL     4688>>CALL
MSGL
      4635**DCL      4658<>CALL
MSGTBL
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:28   
      4636**DCL      4658<>CALL
N$DCT$
      1433**DCL      4650>>ASSIGN
N$DCT$$
      1299**DCL      1433--IMP-PTR  4650>>ASSIGN
N$FQ$
      1299**DCL      1434--IMP-PTR
N$REQ_INIT.BUFADDR
      1318**DCL      1319--REDEF    1319--REDEF
N$REQ_INIT.DLA.DRELADDR
      1310**DCL      1310--REDEF
N$REQ_INIT.DVE.EOMCHAR
      1347**DCL      1348--REDEF
N$REQ_INIT.EAINFO
      1341**DCL      1341--REDEF
N$REQ_INIT.EAINFOX
      1341**DCL      1342--REDEF
N$REQ_INIT.EVNTINFO
      1342**DCL      1342--REDEF
N$REQ_INIT.STATUS
      1323**DCL      1329--REDEF
NI$DQH.FEX
      1498**DCL      4651>>IF
NI$DQH.IOCHANX
      1497**DCL      1498--REDEF
NI$DQH.MBX$
      1506**DCL      1507--REDEF
NI$FQ$
      1359**DCL      1435--IMP-PTR
NI$IBUF$
      1359**DCL      1435--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
      1369**DCL      1370--REDEF    1370--REDEF
NI$IMXMBX_INIT.SIZE
      1371**DCL      1371--REDEF
NI$REQ_INIT.DCW
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:29   
      1393**DCL      1396--REDEF
NI$REQ_INIT.DCW.TALLY
      1394**DCL      1394--REDEF
NI$REQ_INIT.IDCW.EXTA
      1396**DCL      1396--REDEF
NI$REQ_INIT.PCW
      1398**DCL      1402--REDEF
NI$REQ_INIT.SEEK
      1403**DCL      1404--REDEF    1405--REDEF
NI$RP$
      1407**DCL      1437--IMP-PTR
NI_MBX_INIT.DCW.CONTROL.AE
      1429**DCL      1429--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      1425**DCL      1425--REDEF
NK$LDCT
       682**DCL      4686<>CALL
NK$LDCT.DDT$
       684**DCL       684--REDEF
NK$LDCT.IOQ$
       683**DCL       684--REDEF
NK$LDCT.LDCTX
       685**DCL       685--REDEF
NK$LDCT.LKFLG.ABORTED
       697**DCL       698--REDEF
NK$LDCT.LOCK
       710**DCL      4684<>CALL     4688<>CALL
NK$LDCT.RLCID.LDCTX
       707**DCL       707--REDEF
NK$LDCT.STA$
       703**DCL       704--REDEF
NK$LDCT.SYMB$
       682**DCL       682--REDEF     682--REDEF     683--REDEF
O$
      4291**DCL      4648<<ASSIGN   4649>>DOWHILE  4650>>ASSIGN   4651>>IF       4655<<ASSIGN   4655>>ASSIGN
OCI$MK_WR
PL6.E3A0      #001=FPK$KEYIN File=FPK$KEYIN.:E05TSI                              TUE 07/29/97 17:18 Page:30   
      3960**DCL-ENT  4658--CALL
