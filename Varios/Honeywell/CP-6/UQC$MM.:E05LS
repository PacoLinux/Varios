VERSION E05

PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:1    
        1        1        /*M* UQC$MM Memory manager for the ENQ/DEQ tables    */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NSO,PLM=8,IND=2,THI=2,ENU=2,CSU=2,DTI=4,AND                       */
        8        8        UQC$MM: PROC ALTRET;
        9        9        /**/
       10       10        %INCLUDE U$JIT_C;
       11      509    1   DCL B$JIT$ PTR SYMREF;
       12      510    1   DCL S_CUN UBIN SYMREF;
       13      511        %INCLUDE HF_LOCK_C;
       14      525        %INCLUDE M_ERRORS_C;
       15      589        %INCLUDE SS_SCHED_C;
       16      822        %INCLUDE UQ$NODES;
       17      953        %INCLUDE UQ_DATA_R;
       18      966        %INCLUDE UQ_ERRORS_C;
       19      988        /**/
       20      989    1   DCL ERR UBIN;
       21      990    1   DCL 1 BLOCK,
       22      991    1         2 *(0:2)UBIN,
       23      992    1         2 N@ UBIN;
       24      993    1   DCL BLOCK@ UBIN;
       25      994        %SUB BLOCK$="PINCRW(U_BASE$,BLOCK@)";
       26      995    1   DCL 1 UQC$E$DSFULL CONSTANT,
       27      996    1         2 FCG BIT(12) UNAL INIT('2521'O),
       28      997    1         2 MID BIT(6) UNAL INIT('03'O),
       29      998    1         2 CODE UBIN(15)UNAL INIT(%E$DSFULL),
       30      999    1         2 SEV UBIN(3) UNAL INIT(2);
       31     1000        /**/
       32     1001    1   DCL FMR$L8 ENTRY;
       33     1002    1   DCL FMR$U8 ENTRY;
       34     1003    1   DCL FMS$GARBCOL ENTRY ALTRET;
       35     1004    1   DCL MMH$GDS ENTRY(5) ALTRET;
       36     1005    1   DCL MMH$FDS ENTRY(4) ALTRET;
       37     1006    1   DCL SSR$REG ENTRY(3) ALTRET;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:2    
       38     1007    1   DCL SC_MMERR ENTRY CONV(2,0);
       39     1008    1   DCL SC_LKERR_C ENTRY CONV(2,0);
       40     1009        %EJECT;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:3    
       41     1010        /*F*   NAME:   UQC$CHK                                             */
       42     1011        /*F*   PURPOSE: Allocates another page of ENQ/DEQ monitor data segment */
       43     1012        /*,*           in response to a determination that not enough free nodes*/
       44     1013        /*,*           are available to perform the requested ENQ.        */
       45     1014    1   UQC$CHK: ENTRY ALTRET;
       46     1015        /**/
       47     1016    1   GET_NODE:
       48     1017    1           IF UQ_.GDS_LOCK~=0
       49     1018    2             THEN DO;
       50     1019    2                 CALL UNLOCK;
       51     1020    2                 CALL SSR$REG(%SS_SL, ADDR(NIL), 1); /* SLEEP                    */
       52     1021    2                 CALL LOCK;
       53     1022    2                 RETURN;
       54     1023    2               END;
       55     1024    1           UQ_.GDS_LOCK=S_CUN;
       56     1025    1           CALL UNLOCK;                    /* In case GDS reg's for master cpu   */
       57     1026        /* Get and initialize one page of memory */
       58     1027    1           CALL MMH$GDS(MONWSQ,U_BASE$,PAGESZE,ERR)ALTRET(GDSERR);
       59     1028    1           CALL LOCK;
       60     1029    1           UQ_.GDS_LOCK=0;
       61     1030    1           ERR=PAGESZE;
       62     1031    1   ADDPAGE:;
       63     1032    1           BLOCK@=POFFW(ADDR(UQ_.NEXT_BLOCK@),U_BASE$)
       64     1033    1             +POFFW(ADDR(BLOCK),ADDR(BLOCK.N@));
       65     1034    2           DO WHILE(BLOCK$->AVAIL.NEXT_BLOCK@~=0);
       66     1035    2             BLOCK@=BLOCK$->AVAIL.NEXT_BLOCK@;
       67     1036    2           END;
       68     1037    1           BLOCK$->AVAIL.NEXT_BLOCK@=UQ_.NEXT_PAGE@;
       69     1038    1           BLOCK=U_AVAIL_INIT;
       70     1039    1           BLOCK.N@=UQ_.NEXT_PAGE@;
       71     1040    1           UQ_.NEXT_PAGE@=UQ_.NEXT_PAGE@+ERR;
       72     1041    1           UQ_.FREE_BLOCKS=UQ_.FREE_BLOCKS+ERR/BLKSZE;
       73     1042    1   LOOP:   BLOCK@=BLOCK.N@;
       74     1043    1           BLOCK.N@=BLOCK@+BLKSZE;
       75     1044    1           BLOCK$->AVAIL=BLOCK;
       76     1045    1           IF BLOCK.N@<UQ_.NEXT_PAGE@ THEN GOTO LOOP;
       77     1046    1           BLOCK$->AVAIL.NEXT_BLOCK@=0;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:4    
       78     1047    1           RETURN;
       79     1048        %EJECT;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:5    
       80     1049        /*F*   NAME:   UQC$INIT                                               */
       81     1050        /*,*   PURPOSE: To get the first ENQ/DEQ data segment page and        */
       82     1051        /*,*           initialize it.                                         */
       83     1052    1   UQC$INIT: ENTRY ALTRET;
       84     1053        /**/
       85     1054    1           CALL MMH$GDS(MONWSQ,U_BASE$,PAGESZE,ERR)ALTRET(FDSERR);
       86     1055    1           UQ_='0'B;
       87     1056    1           UQ_.NEXT_PAGE@=SIZEW(UQ_);
       88     1057    1           ERR=PAGESZE-SIZEW(UQ_);
       89     1058    1           GOTO ADDPAGE;
       90     1059        %EJECT;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:6    
       91     1060        /* Error conditions */
       92     1061        /**/
       93     1062    1   GDSERR: ;
       94     1063    1           IF ERR = %E$MONDSFULL
       95     1064    2             THEN DO;
       96     1065    2                 CALL FMR$L8;
       97     1066        /* TRY FM GARBAGE COLLECTION, IT MIGHT FREE UP SOME SPACE */
       98     1067    2                 BLOCK@=UQ_.FREE_BLOCKS;
       99     1068    2                 CALL FMS$GARBCOL;
      100     1069    2                 CALL FMR$U8;
      101     1070    2                 CALL LOCK;
      102     1071    2                 UQ_.GDS_LOCK=0;
      103     1072    2                 IF BLOCK@<UQ_.FREE_BLOCKS THEN RETURN; /* GOT SOME BACK         */
      104     1073    2                 B$JIT.ERR=UQC$E$DSFULL;
      105     1074        /*E*   ERROR:  UQC-E$DSFULL-2                                    */
      106     1075        /*E*   MESSAGE: ENQ/DEQ table space exhausted.                     */
      107     1076    2                 ALTRETURN;
      108     1077    2               END;
      109     1078    1             ELSE
      110     1079    1             IF ERR = %E$MONPP             /* No physical page available         */
      111     1080    2               THEN DO;
      112     1081    2                   CALL SSR$REG(%SS_NC);   /* REG for no mem. avail.             */
      113     1082    2                   CALL LOCK;              /* Re-establish ownership             */
      114     1083    2                   UQ_.GDS_LOCK=0;
      115     1084    2                   GOTO GET_NODE;          /* Try it again now that core exists  */
      116     1085    2                 END;
      117     1086    2               ELSE DO;
      118     1087    2   FDSERR:         ;
      119     1088        /*S*   SCREECH_CODE: UQC-S$MMERR                                   */
      120     1089        /*S*   TYPE:   SCREECH                                             */
      121     1090        /*S*   MESSAGE: Unexpected memory menagement error in ENQ/DEQ.     */
      122     1091    2                   CALL SC_MMERR;
      123     1092    2                 END;
      124     1093        %EJECT;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:7    
      125     1094    1   LOCK:   PROC;
      126     1095                %LOCK(G=U_LOCK);
      127     1098    2           RETURN;
      128     1099        /**/
      129     1100    2   UNLOCK: ENTRY;
      130     1101                %UNLOCK(G=U_LOCK);
      131     1104    2           RETURN;
      132     1105        /**/
      133     1106    2   END LOCK;
      134     1107        /**/
      135     1108    1   END UQC$MM;

PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:8    
--  Include file information  --

   UQ_ERRORS_C.:E05TOU  is referenced.
   UQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   UQ$NODES.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   M_ERRORS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   U$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure UQC$MM.

   Procedure UQC$MM requires 185 words for executable code.
   Procedure UQC$MM requires 18 words of local(AUTO) storage.

    No errors detected in file UQC$MM.:E05TSI    .

PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:9    

 Object Unit name= UQC$MM                                     File name= UQC$MM.:E05TOU
 UTS= JUL 30 '97 07:02:54.92 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  UQC$MM
    1   Proc  even  none   185    271  UQC$MM
    2  RoData even  none    12     14  UQC$MM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        0  UQC$MM
     1      3          yes     yes      Std        0  UQC$CHK
     1    153          yes     yes      Std        0  UQC$INIT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 SSR$REG
 yes     yes           Std       0 FMS$GARBCOL
 yes     yes           Std       5 MMH$GDS
         yes           Std       0 FMR$L8
         yes           Std       0 FMR$U8
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:10   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_MMERR                              B$JIT$                                S_CUN
r    U_AVAIL_INIT                     r    U_BASE                                U_LOCK
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:11   


        1        1        /*M* UQC$MM Memory manager for the ENQ/DEQ tables    */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NSO,PLM=8,IND=2,THI=2,ENU=2,CSU=2,DTI=4,AND                       */
        8        8        UQC$MM: PROC ALTRET;

      8  1 000000   000000 700200 xent  UQC$MM       TSX0  ! X66_AUTO_0
         1 000001   000022 000000                    ZERO    18,0
         1 000002   000005 710000 1                  TRA     GET_NODE

        9        9        /**/
       10       10        %INCLUDE U$JIT_C;
       11      509    1   DCL B$JIT$ PTR SYMREF;
       12      510    1   DCL S_CUN UBIN SYMREF;
       13      511        %INCLUDE HF_LOCK_C;
       14      525        %INCLUDE M_ERRORS_C;
       15      589        %INCLUDE SS_SCHED_C;
       16      822        %INCLUDE UQ$NODES;
       17      953        %INCLUDE UQ_DATA_R;
       18      966        %INCLUDE UQ_ERRORS_C;
       19      988        /**/
       20      989    1   DCL ERR UBIN;
       21      990    1   DCL 1 BLOCK,
       22      991    1         2 *(0:2)UBIN,
       23      992    1         2 N@ UBIN;
       24      993    1   DCL BLOCK@ UBIN;
       25      994        %SUB BLOCK$="PINCRW(U_BASE$,BLOCK@)";
       26      995    1   DCL 1 UQC$E$DSFULL CONSTANT,
       27      996    1         2 FCG BIT(12) UNAL INIT('2521'O),
       28      997    1         2 MID BIT(6) UNAL INIT('03'O),
       29      998    1         2 CODE UBIN(15)UNAL INIT(%E$DSFULL),
       30      999    1         2 SEV UBIN(3) UNAL INIT(2);
       31     1000        /**/
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:12   
       32     1001    1   DCL FMR$L8 ENTRY;
       33     1002    1   DCL FMR$U8 ENTRY;
       34     1003    1   DCL FMS$GARBCOL ENTRY ALTRET;
       35     1004    1   DCL MMH$GDS ENTRY(5) ALTRET;
       36     1005    1   DCL MMH$FDS ENTRY(4) ALTRET;
       37     1006    1   DCL SSR$REG ENTRY(3) ALTRET;
       38     1007    1   DCL SC_MMERR ENTRY CONV(2,0);
       39     1008    1   DCL SC_LKERR_C ENTRY CONV(2,0);
       40     1009        %EJECT;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:13   
       41     1010        /*F*   NAME:   UQC$CHK                                             */
       42     1011        /*F*   PURPOSE: Allocates another page of ENQ/DEQ monitor data segment */
       43     1012        /*,*           in response to a determination that not enough free nodes*/
       44     1013        /*,*           are available to perform the requested ENQ.        */
       45     1014    1   UQC$CHK: ENTRY ALTRET;

   1014  1 000003   000000 700200 xent  UQC$CHK      TSX0  ! X66_AUTO_0
         1 000004   000022 000000                    ZERO    18,0

       46     1015        /**/
       47     1016    1   GET_NODE:
       48     1017    1           IF UQ_.GDS_LOCK~=0

   1017  1 000005   000000 470400 xsym  GET_NODE     LDP0    U_BASE
         1 000006   000040 235100                    LDA     32,,PR0
         1 000007   000031 600000 1                  TZE     s:1024

       49     1018    2             THEN DO;

       50     1019    2                 CALL UNLOCK;

   1019  1 000010   000261 701000 1                  TSX1    UNLOCK
         1 000011   000000 011000                    NOP     0

       51     1020    2                 CALL SSR$REG(%SS_SL, ADDR(NIL), 1); /* SLEEP                    */

   1020  1 000012   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000013   200014 756100                    STQ     BLOCK@+4,,AUTO
         1 000014   000001 236000 2                  LDQ     1
         1 000015   200017 756100                    STQ     BLOCK@+7,,AUTO
         1 000016   200014 630500                    EPPR0   BLOCK@+4,,AUTO
         1 000017   200016 450500                    STP0    BLOCK@+6,,AUTO
         1 000020   000002 236000 2                  LDQ     2
         1 000021   200015 756100                    STQ     BLOCK@+5,,AUTO
         1 000022   200015 630500                    EPPR0   BLOCK@+5,,AUTO
         1 000023   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000024   000000 701000 xent               TSX1    SSR$REG
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:14   
         1 000025   000000 011000                    NOP     0

       52     1021    2                 CALL LOCK;

   1021  1 000026   000252 701000 1                  TSX1    LOCK
         1 000027   000000 011000                    NOP     0

       53     1022    2                 RETURN;

   1022  1 000030   000000 702200 xent               TSX2  ! X66_ARET

       54     1023    2               END;
       55     1024    1           UQ_.GDS_LOCK=S_CUN;

   1024  1 000031   000000 236000 xsym               LDQ     S_CUN
         1 000032   000040 756100                    STQ     32,,PR0

       56     1025    1           CALL UNLOCK;                    /* In case GDS reg's for master cpu   */

   1025  1 000033   000261 701000 1                  TSX1    UNLOCK
         1 000034   000000 011000                    NOP     0

       57     1026        /* Get and initialize one page of memory */
       58     1027    1           CALL MMH$GDS(MONWSQ,U_BASE$,PAGESZE,ERR)ALTRET(GDSERR);

   1027  1 000035   200003 630500                    EPPR0   ERR,,AUTO
         1 000036   200017 450500                    STP0    BLOCK@+7,,AUTO
         1 000037   000004 236000 2                  LDQ     4
         1 000040   200016 756100                    STQ     BLOCK@+6,,AUTO
         1 000041   000006 237000 2                  LDAQ    6
         1 000042   200014 757100                    STAQ    BLOCK@+4,,AUTO
         1 000043   200014 630500                    EPPR0   BLOCK@+4,,AUTO
         1 000044   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000045   000000 701000 xent               TSX1    MMH$GDS
         1 000046   000200 702000 1                  TSX2    GDSERR

       59     1028    1           CALL LOCK;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:15   

   1028  1 000047   000252 701000 1                  TSX1    LOCK
         1 000050   000000 011000                    NOP     0

       60     1029    1           UQ_.GDS_LOCK=0;

   1029  1 000051   000000 470400 xsym               LDP0    U_BASE
         1 000052   000040 450100                    STZ     32,,PR0

       61     1030    1           ERR=PAGESZE;

   1030  1 000053   002000 235007                    LDA     1024,DL
         1 000054   200003 755100                    STA     ERR,,AUTO

   1030  1 000055                       ADDPAGE      null
       62     1031    1   ADDPAGE:;
       63     1032    1           BLOCK@=POFFW(ADDR(UQ_.NEXT_BLOCK@),U_BASE$)

   1032  1 000055   200014 452500                    STP2    BLOCK@+4,,AUTO
         1 000056   200014 236100                    LDQ     BLOCK@+4,,AUTO
         1 000057   000007 036003                    ADLQ    7,DU
         1 000060   000022 772000                    QRL     18
         1 000061   200015 452500                    STP2    BLOCK@+5,,AUTO
         1 000062   200016 756100                    STQ     BLOCK@+6,,AUTO
         1 000063   200015 236100                    LDQ     BLOCK@+5,,AUTO
         1 000064   000004 036003                    ADLQ    4,DU
         1 000065   000022 772000                    QRL     18
         1 000066   200016 136100                    SBLQ    BLOCK@+6,,AUTO
         1 000067   200017 756100                    STQ     BLOCK@+7,,AUTO
         1 000070   000000 236000 xsym               LDQ     U_BASE
         1 000071   000010 036000 2                  ADLQ    8
         1 000072   000022 772000                    QRL     18
         1 000073   000000 235000 xsym               LDA     U_BASE
         1 000074   000022 771000                    ARL     18
         1 000075   200020 755100                    STA     BLOCK@+8,,AUTO
         1 000076   200020 136100                    SBLQ    BLOCK@+8,,AUTO
         1 000077   200017 036100                    ADLQ    BLOCK@+7,,AUTO
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:16   
         1 000100   200010 756100                    STQ     BLOCK@,,AUTO

       64     1033    1             +POFFW(ADDR(BLOCK),ADDR(BLOCK.N@));
       65     1034    2           DO WHILE(BLOCK$->AVAIL.NEXT_BLOCK@~=0);

   1034  1 000101   000000 470400 xsym               LDP0    U_BASE
         1 000102   000003 720106                    LXL0    3,QL,PR0
         1 000103   000113 600000 1                  TZE     s:1037

       66     1035    2             BLOCK@=BLOCK$->AVAIL.NEXT_BLOCK@;

   1035  1 000104   000000 470400 xsym               LDP0    U_BASE
         1 000105   200010 720100                    LXL0    BLOCK@,,AUTO
         1 000106   000003 236110                    LDQ     3,X0,PR0
         1 000107   777777 376007                    ANQ     -1,DL
         1 000110   200010 756100                    STQ     BLOCK@,,AUTO

       67     1036    2           END;

   1036  1 000111   000003 720106                    LXL0    3,QL,PR0
         1 000112   000104 601000 1                  TNZ     s:1035

       68     1037    1           BLOCK$->AVAIL.NEXT_BLOCK@=UQ_.NEXT_PAGE@;

   1037  1 000113   000041 720100                    LXL0    33,,PR0
         1 000114   200010 721100                    LXL1    BLOCK@,,AUTO
         1 000115   000003 440111                    SXL0    3,X1,PR0

       69     1038    1           BLOCK=U_AVAIL_INIT;

   1038  1 000116   000100 100400                    MLR     fill='000'O
         1 000117   000000 000004 xsym               ADSC9   U_AVAIL_INIT             cn=0,n=4
         1 000120   200004 000020                    ADSC9   BLOCK,,AUTO              cn=0,n=16

       70     1039    1           BLOCK.N@=UQ_.NEXT_PAGE@;

   1039  1 000121   000041 235100                    LDA     33,,PR0
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:17   
         1 000122   200007 755100                    STA     BLOCK+3,,AUTO

       71     1040    1           UQ_.NEXT_PAGE@=UQ_.NEXT_PAGE@+ERR;

   1040  1 000123   000041 236100                    LDQ     33,,PR0
         1 000124   200003 036100                    ADLQ    ERR,,AUTO
         1 000125   000041 756100                    STQ     33,,PR0

       72     1041    1           UQ_.FREE_BLOCKS=UQ_.FREE_BLOCKS+ERR/BLKSZE;

   1041  1 000126   200003 236100                    LDQ     ERR,,AUTO
         1 000127   000002 772000                    QRL     2
         1 000130   000042 036100                    ADLQ    34,,PR0
         1 000131   000042 756100                    STQ     34,,PR0

       73     1042    1   LOOP:   BLOCK@=BLOCK.N@;

   1042  1 000132   200007 235100       LOOP         LDA     BLOCK+3,,AUTO
         1 000133   200010 755100                    STA     BLOCK@,,AUTO

       74     1043    1           BLOCK.N@=BLOCK@+BLKSZE;

   1043  1 000134   000004 035007                    ADLA    4,DL
         1 000135   200007 755100                    STA     BLOCK+3,,AUTO

       75     1044    1           BLOCK$->AVAIL=BLOCK;

   1044  1 000136   200010 236100                    LDQ     BLOCK@,,AUTO
         1 000137   000002 736000                    QLS     2
         1 000140   000000 470400 xsym               LDP0    U_BASE
         1 000141   000106 100500                    MLR     fill='000'O
         1 000142   200004 000020                    ADSC9   BLOCK,,AUTO              cn=0,n=16
         1 000143   000000 000020                    ADSC9   0,Q,PR0                  cn=0,n=16

       76     1045    1           IF BLOCK.N@<UQ_.NEXT_PAGE@ THEN GOTO LOOP;

   1045  1 000144   200007 236100                    LDQ     BLOCK+3,,AUTO
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:18   
         1 000145   000041 116100                    CMPQ    33,,PR0
         1 000146   000132 602000 1                  TNC     LOOP

       77     1046    1           BLOCK$->AVAIL.NEXT_BLOCK@=0;

   1046  1 000147   000000 220003                    LDX0    0,DU
         1 000150   200010 721100                    LXL1    BLOCK@,,AUTO
         1 000151   000003 440111                    SXL0    3,X1,PR0

       78     1047    1           RETURN;

   1047  1 000152   000000 702200 xent               TSX2  ! X66_ARET

       79     1048        %EJECT;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:19   
       80     1049        /*F*   NAME:   UQC$INIT                                               */
       81     1050        /*,*   PURPOSE: To get the first ENQ/DEQ data segment page and        */
       82     1051        /*,*           initialize it.                                         */
       83     1052    1   UQC$INIT: ENTRY ALTRET;

   1052  1 000153   000000 700200 xent  UQC$INIT     TSX0  ! X66_AUTO_0
         1 000154   000022 000000                    ZERO    18,0

       84     1053        /**/
       85     1054    1           CALL MMH$GDS(MONWSQ,U_BASE$,PAGESZE,ERR)ALTRET(FDSERR);

   1054  1 000155   200003 630500                    EPPR0   ERR,,AUTO
         1 000156   200017 450500                    STP0    BLOCK@+7,,AUTO
         1 000157   000004 236000 2                  LDQ     4
         1 000160   200016 756100                    STQ     BLOCK@+6,,AUTO
         1 000161   000006 237000 2                  LDAQ    6
         1 000162   200014 757100                    STAQ    BLOCK@+4,,AUTO
         1 000163   200014 630500                    EPPR0   BLOCK@+4,,AUTO
         1 000164   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000165   000000 701000 xent               TSX1    MMH$GDS
         1 000166   000247 702000 1                  TSX2    FDSERR

       86     1055    1           UQ_='0'B;

   1055  1 000167   000000 470400 xsym               LDP0    U_BASE
         1 000170   000100 100400                    MLR     fill='000'O
         1 000171   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000172   000000 000220                    ADSC9   0,,PR0                   cn=0,n=144

       87     1056    1           UQ_.NEXT_PAGE@=SIZEW(UQ_);

   1056  1 000173   000044 235007                    LDA     36,DL
         1 000174   000041 755100                    STA     33,,PR0

       88     1057    1           ERR=PAGESZE-SIZEW(UQ_);

   1057  1 000175   001734 236007                    LDQ     988,DL
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:20   
         1 000176   200003 756100                    STQ     ERR,,AUTO

       89     1058    1           GOTO ADDPAGE;

   1058  1 000177   000055 710000 1                  TRA     ADDPAGE

   1057  1 000200                       GDSERR       null
       90     1059        %EJECT;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:21   
       91     1060        /* Error conditions */
       92     1061        /**/
       93     1062    1   GDSERR: ;
       94     1063    1           IF ERR = %E$MONDSFULL

   1063  1 000200   200003 235100                    LDA     ERR,,AUTO
         1 000201   001162 115007                    CMPA    626,DL
         1 000202   000234 601000 1                  TNZ     s:1079

       95     1064    2             THEN DO;

       96     1065    2                 CALL FMR$L8;

   1065  1 000203   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000204   000000 701000 xent               TSX1    FMR$L8
         1 000205   000000 011000                    NOP     0

       97     1066        /* TRY FM GARBAGE COLLECTION, IT MIGHT FREE UP SOME SPACE */
       98     1067    2                 BLOCK@=UQ_.FREE_BLOCKS;

   1067  1 000206   000000 470400 xsym               LDP0    U_BASE
         1 000207   000042 235100                    LDA     34,,PR0
         1 000210   200010 755100                    STA     BLOCK@,,AUTO

       99     1068    2                 CALL FMS$GARBCOL;

   1068  1 000211   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000212   000000 701000 xent               TSX1    FMS$GARBCOL
         1 000213   000000 011000                    NOP     0

      100     1069    2                 CALL FMR$U8;

   1069  1 000214   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000215   000000 701000 xent               TSX1    FMR$U8
         1 000216   000000 011000                    NOP     0

      101     1070    2                 CALL LOCK;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:22   

   1070  1 000217   000252 701000 1                  TSX1    LOCK
         1 000220   000000 011000                    NOP     0

      102     1071    2                 UQ_.GDS_LOCK=0;

   1071  1 000221   000000 470400 xsym               LDP0    U_BASE
         1 000222   000040 450100                    STZ     32,,PR0

      103     1072    2                 IF BLOCK@<UQ_.FREE_BLOCKS THEN RETURN; /* GOT SOME BACK         */

   1072  1 000223   200010 236100                    LDQ     BLOCK@,,AUTO
         1 000224   000230 604000 1                  TMI     s:1073
         1 000225   000042 116100                    CMPQ    34,,PR0
         1 000226   000230 605000 1                  TPL     s:1073

   1072  1 000227   000000 702200 xent               TSX2  ! X66_ARET

      104     1073    2                 B$JIT.ERR=UQC$E$DSFULL;

   1073  1 000230   000000 236000 0                  LDQ     UQC$E$DSFULL
         1 000231   000000 471400 xsym               LDP1    B$JIT$
         1 000232   100012 756100                    STQ     10,,PR1

      105     1074        /*E*   ERROR:  UQC-E$DSFULL-2                                    */
      106     1075        /*E*   MESSAGE: ENQ/DEQ table space exhausted.                     */
      107     1076    2                 ALTRETURN;

   1076  1 000233   000000 702200 xent               TSX2  ! X66_AALT

      108     1077    2               END;
      109     1078    1             ELSE
      110     1079    1             IF ERR = %E$MONPP             /* No physical page available         */

   1079  1 000234   001161 115007                    CMPA    625,DL
         1 000235   000247 601000 1                  TNZ     FDSERR

PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:23   
      111     1080    2               THEN DO;

      112     1081    2                   CALL SSR$REG(%SS_NC);   /* REG for no mem. avail.             */

   1081  1 000236   000012 630400 2                  EPPR0   10
         1 000237   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000240   000000 701000 xent               TSX1    SSR$REG
         1 000241   000000 011000                    NOP     0

      113     1082    2                   CALL LOCK;              /* Re-establish ownership             */

   1082  1 000242   000252 701000 1                  TSX1    LOCK
         1 000243   000000 011000                    NOP     0

      114     1083    2                   UQ_.GDS_LOCK=0;

   1083  1 000244   000000 470400 xsym               LDP0    U_BASE
         1 000245   000040 450100                    STZ     32,,PR0

      115     1084    2                   GOTO GET_NODE;          /* Try it again now that core exists  */

   1084  1 000246   000005 710000 1                  TRA     GET_NODE

      116     1085    2                 END;
      117     1086    2               ELSE DO;

   1084  1 000247                       FDSERR       null
      118     1087    2   FDSERR:         ;
      119     1088        /*S*   SCREECH_CODE: UQC-S$MMERR                                   */
      120     1089        /*S*   TYPE:   SCREECH                                             */
      121     1090        /*S*   MESSAGE: Unexpected memory menagement error in ENQ/DEQ.     */
      122     1091    2                   CALL SC_MMERR;

   1091  1 000247   000000 713400 xsym               CLIMB   SC_MMERR
         1 000250   000000 600000 xsid               climb   nvectors=         0

      123     1092    2                 END;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:24   

   1092  1 000251   000270 710000 1                  TRA     s:1108

      124     1093        %EJECT;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:25   
      125     1094    1   LOCK:   PROC;

   1094  1 000252   200012 741300       LOCK         STX1  ! BLOCK@+2,,AUTO

      126     1095                %LOCK(G=U_LOCK);

   1096  1 000253   000013 630400 2                  EPPR0   11
         1 000254   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000255   000000 701000 xent               TSX1    HFC$LOCK
         1 000256   000000 011000                    NOP     0

      127     1098    2           RETURN;

   1098  1 000257   200012 221300                    LDX1  ! BLOCK@+2,,AUTO
         1 000260   000001 702211                    TSX2  ! 1,X1

      128     1099        /**/
      129     1100    2   UNLOCK: ENTRY;

   1100  1 000261   200012 741300       UNLOCK       STX1  ! BLOCK@+2,,AUTO

      130     1101                %UNLOCK(G=U_LOCK);

   1102  1 000262   000013 630400 2                  EPPR0   11
         1 000263   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000264   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000265   000000 011000                    NOP     0

      131     1104    2           RETURN;

   1104  1 000266   200012 221300                    LDX1  ! BLOCK@+2,,AUTO
         1 000267   000001 702211                    TSX2  ! 1,X1

      132     1105        /**/
      133     1106    2   END LOCK;
      134     1107        /**/
      135     1108    1   END UQC$MM;
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:26   

   1108  1 000270   000000 702200 xent               TSX2  ! X66_ARET

UQC$E$DSFULL
 Sect OctLoc
   0     000   252103 014402                                                    .C..

(unnamed)
 Sect OctLoc
   2     000   000000 000031   000003 006000   000000 006000   000000 002000    ................
   2     004   000003 006000   000000 000000   000003 006000   000000 006000    ................
   2     010   000043 400000   000000 000100   000011 006000   000000 006000    .#.....@........

PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:27   
--  Include file information  --

   UQ_ERRORS_C.:E05TOU  is referenced.
   UQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   UQ$NODES.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   M_ERRORS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   U$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure UQC$MM.
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:28   

 **** Variables and constants ****

  ****  Section 000 RoData UQC$MM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 UQC$E$DSFULL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w STRC(144)   r     1 BLOCK                     10-0-0/w UBIN        r     1 BLOCK@
     3-0-0/w UBIN        r     1 ERR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w UBIN        r     1 S_CUN
     0-0-0/b STRC        r     1 U_AVAIL_INIT               0-0-0/b STRC        r     1 U_BASE
     0-0-0/w PTR         r     1 U_BASE$                    0-0-0/d BIT (72)    r     1 U_LOCK

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(144)   r     1 AVAIL                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(1296)  r     1 UQ_


   Procedure UQC$MM requires 185 words for executable code.
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:29   
   Procedure UQC$MM requires 18 words of local(AUTO) storage.

    No errors detected in file UQC$MM.:E05TSI    .
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:30   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:31   
          MINI XREF LISTING

ADDPAGE
      1030**LABEL    1058--GOTO
AVAIL
       857**DCL      1044<<ASSIGN
AVAIL.NEXT_BLOCK@
       861**DCL      1034>>DOWHILE  1035>>ASSIGN   1037<<ASSIGN   1046<<ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       431**DCL       431--REDEF
B$JIT.ERR
       337**DCL      1073<<ASSIGN
B$JIT.ERR.MID
       338**DCL       338--REDEF
B$JIT$
       509**DCL       332--IMP-PTR  1073>>ASSIGN
BLOCK
       990**DCL      1032--ASSIGN   1038<<ASSIGN   1044>>ASSIGN
BLOCK.N@
       992**DCL      1032--ASSIGN   1039<<ASSIGN   1042>>ASSIGN   1043<<ASSIGN   1045>>IF
BLOCK@
       993**DCL      1032<<ASSIGN   1034>>DOWHILE  1035<<ASSIGN   1035>>ASSIGN   1037>>ASSIGN   1042<<ASSIGN
      1043>>ASSIGN   1044>>ASSIGN   1046>>ASSIGN   1067<<ASSIGN   1072>>IF
ERR
       989**DCL      1027<>CALL     1030<<ASSIGN   1040>>ASSIGN   1041>>ASSIGN   1054<>CALL     1057<<ASSIGN
      1063>>IF       1079>>IF
FDSERR
      1084**LABEL    1054--CALLALT
FMR$L8
      1001**DCL-ENT  1065--CALL
FMR$U8
      1002**DCL-ENT  1069--CALL
FMS$GARBCOL
      1003**DCL-ENT  1068--CALL
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:32   
GDSERR
      1057**LABEL    1027--CALLALT
GET_NODE
      1017**LABEL    1084--GOTO
HFC$LOCK
       524**DCL-ENT  1096--CALL
HFC$UNLOCK
       524**DCL-ENT  1102--CALL
LOCK
      1094**PROC     1021--CALL     1028--CALL     1070--CALL     1082--CALL
LOOP
      1042**LABEL    1045--GOTO
MMH$GDS
      1004**DCL-ENT  1027--CALL     1054--CALL
QENTRY.DOM_USER
       924**DCL       927--REDEF
QENTRY.REQUEST
       911**DCL       914--REDEF
QENTRY.UPGRADE
       915**DCL       918--REDEF
SC_MMERR
      1007**DCL-ENT  1091--CALL
SSR$REG
      1006**DCL-ENT  1020--CALL     1081--CALL
S_CUN
       510**DCL      1024>>ASSIGN
UNLOCK IN PROCEDURE LOCK
      1100**ENTRY    1019--CALL     1025--CALL
UQC$E$DSFULL
       995**DCL      1073>>ASSIGN
UQ_
       936**DCL      1055<<ASSIGN   1056--ASSIGN   1057--ASSIGN
UQ_.FREE_BLOCKS
       943**DCL      1041<<ASSIGN   1041>>ASSIGN   1067>>ASSIGN   1072>>IF
UQ_.GDS_LOCK
       938**DCL      1017>>IF       1024<<ASSIGN   1029<<ASSIGN   1071<<ASSIGN   1083<<ASSIGN
PL6.E3A0      #001=UQC$MM File=UQC$MM.:E05TSI                                    WED 07/30/97 07:02 Page:33   
UQ_.NEXT_BLOCK@
       945**DCL      1032--ASSIGN
UQ_.NEXT_PAGE@
       939**DCL       940--REDEF    1037>>ASSIGN   1039>>ASSIGN   1040<<ASSIGN   1040>>ASSIGN   1045>>IF
      1056<<ASSIGN
U_AVAIL_INIT
       961**DCL      1038>>ASSIGN
U_BASE
       964**DCL       965--REDEF
U_BASE$
       965**DCL       936--IMP-PTR  1017>>IF       1024>>ASSIGN   1027<>CALL     1029>>ASSIGN   1032>>ASSIGN
      1032>>ASSIGN   1034>>DOWHILE  1035>>ASSIGN   1037>>ASSIGN   1037>>ASSIGN   1039>>ASSIGN   1040>>ASSIGN
      1040>>ASSIGN   1041>>ASSIGN   1041>>ASSIGN   1044>>ASSIGN   1045>>IF       1046>>ASSIGN   1054<>CALL
      1055>>ASSIGN   1056>>ASSIGN   1067>>ASSIGN   1071>>ASSIGN   1072>>IF       1083>>ASSIGN
U_LOCK
       965**DCL      1096<>CALL     1102<>CALL
