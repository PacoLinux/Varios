VERSION E05

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:1    
        1        1        /*M* NIO$QUE - I/O system interface module */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR */
        8        8        NIO$QUE: PROC(N$REQ) ALTRET;
        9        9        /*
       10       10                Includes
       11       11        */
       12       12        %INCLUDE                B$JIT ;
       13      615        %INCLUDE                B$MAP ;
       14      714        %INCLUDE                B$USER ;
       15      930        %INCLUDE                B_MLSMAC_C ;
       16     1872        %INCLUDE                B_SEGIDS_C ;
       17     2411        %INCLUDE                CP_6_SUBS ;
       18     2951        %INCLUDE                F$DCB ;
       19     3000        %INCLUDE                HF_DATA_R ;
       20     3043        %INCLUDE                HF_LOCK_C ;
       21     3057        %INCLUDE                M_INFO_C ;
       22     3197        %INCLUDE                NI_DATA_C ;
       23     3310        %INCLUDE                NI_DATA_R ;
       24     3747        %INCLUDE                NI_DEVCMD_C ;
       25     3930        %INCLUDE                NI_MACROS_C ;
       26     4197        %INCLUDE                NK_SUBS ;
       27     4222        %INCLUDE                N_FC_C ;
       28     4259        %INCLUDE                SS_SCHED_C ;
       29     4492        /*
       30     4493                Parameters
       31     4494        */
       32     4495        %N$REQ                  ( NAME=N$REQ, STCLASS=PARAM ) ;
       33     4553        /*
       34     4554                Entries
       35     4555        */
       36     4556    1   DCL 1 KQR$READ          ENTRY(1) ALTRET ;
       37     4557    1   DCL 1 KQW$WRITE         ENTRY(1) ALTRET ;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:2    
       38     4558    1   DCL 1 NIM$CVTPTR        ENTRY(3) ;
       39     4559    1   DCL 1 NIO$COMP          ENTRY(2) ;
       40     4560    1   DCL 1 NIQ$GETS          ENTRY(1) ALTRET ;
       41     4561    1   DCL 1 NIQ$RELS          ENTRY(1) ALTRET ;
       42     4562    1   DCL 1 NIU$CRPEXTST      ENTRY(1) ALTRET ;
       43     4563    1   DCL 1 NIU$SYMBLOCK      ENTRY(2) ALTRET ;
       44     4564    1   DCL 1 SC_NIOBADFC       ENTRY CONV(2,0) ;
       45     4565    1   DCL 1 SC_NIOBADIOQ      ENTRY CONV(2,0) ;
       46     4566    1   DCL 1 SC_NIOINVDLA      ENTRY CONV(2,0) ;
       47     4567    1   DCL 1 SC_NIONRD         ENTRY CONV(2,0) ;
       48     4568    1   DCL 1 SSR$REG           ENTRY(3) ALTRET ;
       49     4569        /*
       50     4570                Symrefs
       51     4571        */
       52     4572    1   DCL 1 B$JIT$            PTR SYMREF ;
       53     4573    1   DCL 1 B$LS$             PTR SYMREF READONLY ;
       54     4574    1   DCL 1 B$MPT$            PTR SYMREF ;
       55     4575        %B$USERREFS ;
       56     4579    1   DCL 1 B$WSQ0PT$         PTR SYMREF READONLY ;
       57     4580    1   DCL 1 F_DCBLOCK         BIT(72) SYMREF ;
       58     4581    1   DCL 1 NK_MXTOTAL        UBIN(36) SYMREF ;
       59     4582    1   DCL 1 S_CUN             SBIN SYMREF;
       60     4583    1   DCL 1 SL_IOTA(0:4)      SBIN SYMREF ;   /* QUANTUM PENALTY FOR I/O            */
       61     4584    1   DCL 1 SL_MF(0:4)        SBIN SYMREF ;   /* MASTER FUNCTION LIMIT BY CLASS     */
       62     4585        /*
       63     4586                Auto
       64     4587        */
       65     4588    1   DCL 1 BUFADDR           SBIN ALIGNED AUTO ;
       66     4589    1   DCL 1 BUFREAL           REDEF BUFADDR,
       67     4590    1         2 EXTA            UBIN(16) UNAL,
       68     4591    1         2 ADR             UBIN(18) UNAL,
       69     4592    1         2 BYT             UBIN(2) UNAL;
       70     4593    1   DCL 1 BUFREALB          REDEF BUFADDR,
       71     4594    1         2 EXTA            UBIN(16) UNAL,
       72     4595    1         2 BYTADR          UBIN(20) UNAL;
       73     4596    1   DCL 1 BUFVIRT           REDEF BUFADDR,
       74     4597    1         2 BASE            UBIN(33) UNAL,
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:3    
       75     4598    1         2 BYT             UBIN(3) UNAL;
       76     4599    1   DCL 1 BUFOFFSET         UBIN ALIGNED AUTO ;
       77     4600    1   DCL 1 BUFSIZE           SBIN ALIGNED AUTO ;
       78     4601    1   DCL 1 BUF_BASE          SBIN ALIGNED AUTO ;
       79     4602    1   DCL 1 CONT              BIT(1) ALIGNED AUTO ;
       80     4603    1   DCL 1 CSIZE             SBIN ALIGNED AUTO ;
       81     4604    1   DCL 1 DCB$              PTR ALIGNED AUTO ;
       82     4605    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
       83     4606    1   DCL 1 DCWX              SBIN ALIGNED AUTO ;
       84     4607    1   DCL 1 DVT$              PTR ALIGNED AUTO ;
       85     4608    1   DCL 1 FUNC              ALIGNED AUTO,
       86     4609    1         2 DC              UBIN(6) UNAL,
       87     4610    1         2 RTN             UBIN(6) UNAL,
       88     4611    1         2 DVN             REDEF RTN
       89     4612    1                           UBIN(6) UNAL,
       90     4613    1         2 DC2             UBIN(6) UNAL,
       91     4614    1         2 TIMO            UBIN(6) UNAL,
       92     4615    1         2 CC              UBIN(6) UNAL,
       93     4616    1         2 CCB             REDEF CC
       94     4617    1                           BIT(6) UNAL,
       95     4618    1         2 RCNT            UBIN(6) UNAL;
       96     4619    1   DCL 1 IOS$              PTR ALIGNED AUTO ;
       97     4620    1   DCL 1 MBX$              PTR ALIGNED AUTO ;
       98     4621    1   DCL 1 NOBUF             BIT(1) ALIGNED AUTO ;
       99     4622    1   DCL 1 PNTR$             PTR ALIGNED AUTO ;
      100     4623    1   DCL 1 PNTR              REDEF PNTR$,
      101     4624    1         2 WA              UBIN(18) HALIGNED,
      102     4625    1         2 *               UBIN(18) HALIGNED ;
      103     4626    1   DCL 1 PSIA              BIT(1) ALIGNED AUTO ;
      104     4627    1   DCL 1 PTP               SBIN ALIGNED AUTO ;
      105     4628    1   DCL 1 QUE               SBIN ALIGNED AUTO ;
      106     4629    1   DCL 1 RCTTEMP           SBIN ALIGNED AUTO ;
      107     4630    1   DCL 1 RTN               UBIN ALIGNED AUTO ;
      108     4631    1   DCL 1 SCHED             EPTR ALIGNED AUTO ;
      109     4632    1   DCL 1 SEEK$             PTR ALIGNED AUTO ;
      110     4633    1   DCL 1 SEEK              REDEF SEEK$,
      111     4634    1         2 WA              UBIN(18) HALIGNED,
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:4    
      112     4635    1         2 *               UBIN(18) HALIGNED ;
      113     4636    1   DCL 1 SIZE              UBIN ALIGNED AUTO ;
      114     4637    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      115     4638    1   DCL 1 X                 SBIN ALIGNED AUTO ;
      116     4639        /*
      117     4640                Based
      118     4641        */
      119     4642        %B_MLS                  ( FPTN=B$MLNK,    STCLASS=BASED ) ;
      120     5457    1   DCL 1 CHARBASE          CHAR(CSIZE) BASED ;
      121     5458    1   DCL 1 CHAR3             CHAR(3) BASED UNAL ;
      122     5459        %NI$DCT                 ( NAME=DCT,       STCLASS="BASED(DCT$)" ) ;
      123     5507        %DCW                    ( NAME=DCW,       STCLASS=BASED ) ;
      124     5537        %NI$DVT                 ( NAME=DVT,       STCLASS="BASED(DVT$)" ) ;
      125     5544        %IDCW                   ( NAME=IDCW,      STCLASS=BASED ) ;
      126     5576        %NI$IMXMBX              ( NAME=NI$IMXMBX, STCLASS="BASED(MBX$)" ) ;
      127     5597        %NI$REQ                 ( NAME=NI$REQ,    STCLASS="BASED(IOS$)" ) ;
      128     5622    1   DCL 1 ONECHAR(0:0)      CHAR(1) BASED ;
      129     5623    1   DCL 1 POINTER           BASED ALIGNED,
      130     5624    1         2 W               UBIN(18) UNAL,
      131     5625    1         2 C               UBIN(2) UNAL,
      132     5626    1         2 B               UBIN(4) UNAL,
      133     5627    1         2 SEGID           UBIN(12) UNAL ;
      134     5628        %NI$SQH                 ( NAME=SQH, STCLASS="BASED(SQH$)" ) ;
      135     5641    1   DCL 1 VFC               BASED ALIGNED,
      136     5642    1         2 VFCCHAR         CHAR(1),
      137     5643    1         2 BUFCHARS        CHAR(3) ;
      138     5644        /*
      139     5645                Constant
      140     5646        */
      141     5647        %SUB B$U="S$CU$->B$U";
      142     5648        %EJECT;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:5    
      143     5649    1           QUE=%QUE_STD;
      144     5650    1           GOTO QUECMN;
      145     5651
      146     5652
      147     5653
      148     5654    1   NIO$REQUE: ENTRY(N$REQ) ALTRET;
      149     5655    1           QUE=%QUE_QUE_AGAIN;
      150     5656    1           GOTO QUECMN;
      151     5657
      152     5658
      153     5659
      154     5660    1   NIO$DCWBLD: ENTRY(N$REQ) ALTRET;
      155     5661    1           QUE=%QUE_DCWBLD;
      156     5662    1           N$REQ.IOQFLG.IOQUED = '0'B ;
      157     5663
      158     5664
      159     5665
      160     5666    1   QUECMN: ;
      161     5667    1           IF  NOT N$REQ.IOQFLG.INUSE
      162     5668    1             OR N$REQ.IOQFLG.IOQUED
      163     5669    1           THEN
      164     5670        /*S* SCREECH_CODE:  NIO-S$BADIOQ-7
      165     5671             TYPE:          SCREECH
      166     5672             MESSAGE:       Incorrect IOQ processing within IO system.
      167     5673             DESCRIPTION:   The IO system detected an incorrect processing
      168     5674                            sequence on an IOQ packet.  To be scheduled
      169     5675                            for an IO, an IOQ packet must be in use and
      170     5676                            must not have been previously scheduled for
      171     5677                            an IO.  To have an IO completed, an IOQ packet
      172     5678                            must be in use and must have been previously
      173     5679                            been scheduled for an IO.
      174     5680        */
      175     5681    1              CALL SC_NIOBADIOQ ;
      176     5682
      177     5683    1           N$REQ.IOQFLG.IOQUED = '1'B ;
      178     5684    1           IF ADDR(N$REQ.DCB$)->POINTER.SEGID=BITBIN(%ROSID) THEN
      179     5685    1              ADDR(N$REQ.DCB$)->POINTER.SEGID=BITBIN(%RONCSID);
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:6    
      180     5686    1           DCB$=N$REQ.DCB$;
      181     5687    1           IF N$REQ.DLA.DCTX>NK_MXTOTAL OR N$REQ.DLA.DCTX=0 THEN
      182     5688    1              CALL SC_NIOINVDLA;
      183     5689        /*S* SCREECH_CODE: NIO-S$INVDLA-7
      184     5690             TYPE: SCREECH
      185     5691             MESSAGE: BAD DCT INDEX
      186     5692        */
      187     5693    1           DCT$=N$DCT$(N$REQ.DLA.DCTX);
      188     5694    1           N$REQ.DCT$=DCT$;
      189     5695                                                /* BUF_BASE IS USED ONLY FOR THE IMX */
      190     5696    1           IF DCT.DFLG.RELOAD THEN
      191     5697    1              BUF_BASE=%IMX_FWBUF_BASE;
      192     5698    1           ELSE
      193     5699    1              BUF_BASE=%IMX_BUF_BASE;
      194     5700    2           IF DCT.RESCOD=NK_NCOM THEN DO;
      195     5701    3              IF N$REQ.OPFLG.BPF THEN DO;
      196     5702    3                 CALL NIM$CVTPTR(N$REQ.BUF$,BUFADDR,PTP);
      197     5703    3                 N$REQ.OPFLG.BPF='0'B;
      198     5704    3                 N$REQ.BUFADDR=BUFADDR;
      199     5705    3                 N$REQ.PTP=PTP;
      200     5706    3                 END;
      201     5707    3              ELSE DO;
      202     5708    4                 IF HW_IOP AND N$REQ.PTP=0 AND N$REQ.BUFADDR~=0 THEN DO;
      203     5709                       /* IOP CAN'T DO NON-PAGED IO ADDR>16MW, SO CONVERT TO PAGED */
      204     5710    4                    N$REQ.BUFREAL_SV=BINBIT(N$REQ.BUFADDR,36);
      205     5711    4                    N$REQ.PTP=B$LS$->B$MLNK.WSQ0PT.BASE/256 + /* HW_IOPTP_UNITS*4 */
      206     5712    4                      N$REQ.BUFREAL_SV.DIV64PG;
      207     5713                       /* NOW RUN PTP THROUGH WSQ0PT TO FIND PHYSICAL ADDR OF PT WORD */
      208     5714    4                    N$REQ.PTP=B$WSQ0PT$->B$MAP.RPN(N$REQ.PTP/16)*16 +
              5714                             /* 1024/HW_IOPTP_UNITS */
      209     5715    4                      MOD(N$REQ.PTP,16);
      210     5716    4                    N$REQ.BUFADDR=N$REQ.BUFREAL_SV.MOD64PG;
      211     5717    4                    N$REQ.IOP_BUFREAL_CVRT='1'B;
      212     5718    4                    END;
      213     5719    3                 BUFADDR=N$REQ.BUFADDR;
      214     5720    3                 PTP=N$REQ.PTP;
      215     5721    3                 END;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:7    
      216     5722    2              BUFSIZE=N$REQ.BUFSIZE;
      217     5723    2              DVT$=DCT.DVT$;
      218     5724    2              END;
      219     5725    2           IF QUE=%QUE_STD THEN DO;
      220     5726    2              N$REQ.TYC='0'B;
      221     5727    2              N$REQ.ARCT=0;
      222     5728    2              N$REQ.ARSIZE=0;
      223     5729    3              IF N$REQ.OPFLG.USER THEN DO INHIBIT;
      224     5730    3                 N$REQ.USER# = S_CUN;
      225     5731    3                 B$JIT.CTIME=B$JIT.CTIME+SL_IOTA(B$JIT.MODE);
      226     5732    3                 IF B$U.MF - B$U.CMF >= SL_MF(B$JIT.MODE) THEN
      227     5733    3                    CALL SSR$REG(%SS_QMF);
      228     5734                      %LOCK (G#=NI_MFGATE);
      229     5737    3                 B$U.MF=B$U.MF+1;
      230     5738    3                 IF DCT.DFLG.CM THEN B$U.CMF=B$U.CMF+1;
      231     5739                      %UNLOCK (G#=NI_MFGATE);
      232     5742    4                 IF DCB$ ~= ADDR(NIL) THEN DO;
      233     5743                         %LOCK (G#=F_DCBLOCK);
      234     5746    4                    IF N$REQ.NWIO=0 THEN
      235     5747    4                       DCB$->F$DCB.FCN.CNT(0)=DCB$->F$DCB.FCN.CNT(0)+1;
      236     5748    4                    ELSE
      237     5749    4                       DCB$->F$DCB.FCN.CNT(1)=DCB$->F$DCB.FCN.CNT(1)+1;
      238     5750                         %UNLOCK (G#=F_DCBLOCK);
      239     5753    4                    END;
      240     5754    3                 END;
      241     5755    2              END;
      242     5756    2           DO CASE(DCT.RESCOD);
      243     5757    2            CASE(NK_NCOM);
      244     5758    3              IF DCT.CTYP ~= %C_APC THEN DO;
      245     5759    4                 IF NOT N$REQ.IOFLG.IOS THEN DO;
      246     5760    4                    CALL NIQ$GETS(N$REQ.IOS$) ALTRET(NQPKTS);
      247     5761    4                    IOS$=N$REQ.IOS$;
      248     5762    4                    MBX$=PINCRW(IOS$,%IMX_MBX_OFFSET);
      249     5763    4                    N$REQ.IOFLG.IOS='1'B;
      250     5764    4                    END;
      251     5765    4                 ELSE DO;
      252     5766    4                    IOS$=N$REQ.IOS$;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:8    
      253     5767    4                    PNTR$=NI$REQ.FL$;
      254     5768    4                    NI$REQ=NI$REQ_INIT;
      255     5769    4                    MBX$=PINCRW(IOS$,%IMX_MBX_OFFSET);
      256     5770    4                    IF HW_IMX THEN
      257     5771    4                       NI$IMXMBX=NI$IMXMBX_INIT;
      258     5772    4                    NI$REQ.FL$=PNTR$;
      259     5773    4                    END;
      260     5774    3                 END;
      261     5775    2              N$REQ.ERRCT=0;
      262     5776    2              IF N$REQ.FC=%N_WRBIN AND DCT.DFLG.CHECKWRITE THEN N$REQ.FC=%N_WRCMP;
      263     5777    2              IF N$REQ.FC>%N_MLFC THEN
      264     5778    2                 FUNC='0'B;
      265     5779    2              ELSE
      266     5780    2                 FUNC=DVT.IDCW(N$REQ.FC);
      267     5781    2              DCWX=0;
      268     5782    2              RTN=FUNC.RTN;
      269     5783    2              FUNC.DVN=DCT.DVN;
      270     5784    2              IF FUNC.TIMO~=0 THEN N$REQ.TIMOUT=FUNC.TIMO;
      271     5785    2              SEEK$=ADDR(NI$REQ.SEEK);
      272     5786    2              PSIA=DCT.DFLG.PSIA;
      273     5787    2              NOBUF=(FUNC.CCB & %CC_NOBUF) ~= '0'B;
      274     5788    3              DO CASE(RTN);
      275     5789    3               CASE(%BITBIN(RTN_BADFC));
      276     5790    3                 CALL SC_NIOBADFC;
      277     5791        /*S* SCREECH_CODE: NIO-S$BADFC-7
      278     5792             TYPE: SCREECH
      279     5793             MESSAGE: THE SUPPLIED FUNCTION CODE IS NOT LEGAL FOR THIS DEVICE
      280     5794        */
      281     5795    3                 N$REQ.TYC.IOERR='1'B;
      282     5796    3                 CALL NIO$COMP(N$REQ);
      283     5797    3                 RETURN;
      284     5798    3               CASE(%BITBIN(RTN_BADFC_IOERR));
      285     5799    3                 N$REQ.TYC.IOERR='1'B;
      286     5800    3                 CALL NIO$COMP(N$REQ);
      287     5801    3                 RETURN;
      288     5802    3               CASE(%BITBIN(RTN_BADFC_IGNORE));
      289     5803    3                 CALL NIO$COMP(N$REQ);
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:9    
      290     5804    3                 RETURN;
      291     5805    3               CASE(%BITBIN(RTN_DCWLIST));
      292     5806        /**/
      293     5807        /**/
      294     5808        /*  The DCWLIST function code requires that the buffer begin on a
      295     5809            doubleword bound and that word 0 of the buffer be an IDCW.  The
      296     5810            device number of this IDCW will be filled in from the DCT.  All
      297     5811            other IDCWs in the DCW list should have a device number of 0.
      298     5812            If the required conditions are not met an IOERR is returned without
      299     5813            attempting to execute the request.  No changes to user programs
      300     5814            supplying DCW lists are required to support the IMX.  This code
      301     5815            modifies IDCWs and TDCWs to include the IMX base word references.
      302     5816            However, because TDCWs must be modified for the IMX, the following
      303     5817            restriction must be applied:  no TDCWs can follow the last IDCW.
      304     5818            (This is because DCWs may or may not follow the last IDCW, so it
      305     5819            is impossible to find the end of the DCW list unless tables of all
      306     5820            possible instructions exist which show whether or not a DCW is
      307     5821            required.)                                                        */
      308     5822        /**/
      309     5823        /**/
      310     5824    4                 IF BUFVIRT.BYT~=0 OR N$REQ.BUF$->IDCW.SVN~=7 THEN DO;
      311     5825    4                    N$REQ.TYC.IOERR='1'B;
      312     5826    4                    CALL NIO$COMP(N$REQ);
      313     5827    4                    RETURN;
      314     5828    4                    END;
      315     5829    3                 X=0;
      316     5830    3                 CONT='1'B;
      317     5831    4                 DO WHILE(CONT);
      318     5832    4                    PNTR$=PINCRW(N$REQ.BUF$,X);
      319     5833    5                    IF PNTR$->IDCW.SVN=7 THEN DO;
      320     5834    5                       PNTR$->IDCW.DVN=DCT.DVN;
      321     5835    5                       IF HW_IMX THEN
      322     5836    5                          PNTR$->IDCW.DATA.BASE=BUF_BASE;
      323     5837    5                       CONT=PNTR$->IDCW.CONT;
      324     5838    5                       X=X+1;
      325     5839    5                       END;
      326     5840    5                    ELSE DO CASE(PNTR$->DCW.TYPE);
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:10   
      327     5841    5                     CASE(%DCW_TDCW);
      328     5842    5                       X=PNTR$->DCW.FWA; /*N* IOM bug? how about X=FWA-BUFVIRT.BASE? */
      329     5843    5                       IF HW_IMX THEN
      330     5844    5                          PNTR$->DCW.T.DCWLIST.BASE=BUF_BASE;
      331     5845    5                     CASE(ELSE);
      332     5846    5                       X=X+1;
      333     5847    5                     END;
      334     5848    4                    IF X>=BUFSIZE/4 THEN CONT='0'B;
      335     5849    4                    END;
      336     5850    4                 IF NOT PSIA THEN DO;
      337     5851    4                    NI$REQ.PCW=N$REQ.BUF$->IDCW;
      338     5852    4                    NI$REQ.PCW.FLAGS='600'O;
      339     5853    4                    END;
      340     5854    3                 N$REQ.IOFLG.LPW23='0'B;   /* REAL DCW, REAL LPW */
      341     5855    3                 IF HW_IOP THEN
      342     5856    3                    NI$REQ.IOP_PTAW=BINBIT(PTP,27)|%IOP_PTA1_INIT; /* PHYSADDR */
      343     5857    3                 ELSE IF NOT HW_IMX THEN
      344     5858    3                       NI$REQ.PCW.PTP=PTP;
      345     5859    3                 N$REQ.LPWX.BASE=BUFVIRT.BASE;
      346     5860    3                 N$REQ.LPWX.BOUND=(BUFSIZE+3)/4;
      347     5861    4                 IF HW_IMX THEN DO;
      348     5862    4                    NI$REQ.DCW(0)=%TDCWM1;
      349     5863    4                    NI$REQ.DCW.T.DCWLIST.BASE(0)=BUF_BASE;
      350     5864    4                    END;
      351     5865    4                 ELSE DO;
      352     5866    4                    NI$REQ.DCW(0)=%TDCWM4;
      353     5867                         /*N* IOM EVIDENTLY DOESN'T USE LPWX FOR DCWLIST */
      354     5868    4                    NI$REQ.DCW.FWA(0)=BUFREAL.ADR+BITBIN(~PSIA);
      355     5869    4                    END;
      356     5870    3               CASE(%BITBIN(RTN_WRSYMB));
      357     5871    3                 N$REQ.ARCT = N$REQ.RCT;
      358     5872    3                 CALL NIU$SYMBLOCK(N$REQ,FUNC) ALTRET(COMP);
      359     5873    4                 DO WHILE('0'B);           /* DO NEVER */
      360     5874    4   COMP:            CALL NIO$COMP(N$REQ);
      361     5875    4                    RETURN;
      362     5876    4                    END;                   /* DO NEVER */
      363     5877    3               CASE(%BITBIN(RTN_SC_RDPRMPT));
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:11   
      364     5878    3                 NI$REQ.SEEK='000015012000'O;
      365     5879    3                 SEEK$->ONECHAR(3)=N$REQ.BUF$->ONECHAR(0);
      366     5880    3                 GOTO RTN_DP_SEEK;
      367     5881    3               CASE(%BITBIN(RTN_SC_WRCRLF));
      368     5882    3                 NI$REQ.SEEK='000000015012'O;
      369     5883    3                 GOTO RTN_DP_SEEK;
      370     5884    3               CASE(%BITBIN(RTN_CR_EXTST),%BITBIN(RTN_CP_EXTST));
      371     5885    3                 CALL NIU$CRPEXTST(N$REQ) ALTRET(NQPKTS);
      372     5886    3               CASE(%BITBIN(RTN_CP_WRFM));
      373     5887    3                 NI$REQ.SEEK='041105117104'O; /* !EOD */
      374     5888    3                 NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWBITS;
      375     5889    3                 IF HW_IMX THEN
      376     5890    3                    NI$REQ.IDCW.DATA.BASE(0)=%IMX_IOS_BASE;
      377     5891    3                 NI$REQ.DCW(1)=BINBIT((SEEK.WA*%BITBIN('1000000'O))+1,36);
      378     5892    3               CASE(%BITBIN(RTN_CP_WRITE));
      379     5893    3                 IF N$REQ.DVE.DVBYTE & %DVBYTE_BIN# THEN FUNC.DC=FUNC.DC2;
      380     5894    3                 GOTO RTN_STD0;
      381     5895    3               CASE(%BITBIN(RTN_LP_LDCHAIN));
      382     5896    3                 CSIZE=60*4;
      383     5897    3                 DCT.LP.CHAIN$->CHARBASE=N$REQ.BUF$->CHARBASE;
      384     5898    3                 GOTO RTN_STD0;
      385     5899    3               CASE(%BITBIN(RTN_LP_LDVFC));
      386     5900    3                 CSIZE=N$REQ.BUFSIZE;
      387     5901    3                 DCT.LP.VFCL=N$REQ.BUFSIZE/4;
      388     5902    3                 DCT.LP.VFC$->CHARBASE=N$REQ.BUF$->CHARBASE;
      389     5903    3                 GOTO RTN_STD0;
      390     5904    3               CASE(%BITBIN(RTN_LP_WRITE));
      391     5905    3                 IF N$REQ.DVE.DVBYTE & %DVBYTE_BP# THEN FUNC.DC=FUNC.DC2;
      392     5906    3                 GOTO RTN_STD0;
      393     5907    3               CASE(%BITBIN(RTN_MT_SPR));
      394     5908    4                 IF N$REQ.RCT<0 THEN DO;
      395     5909    4                    RCTTEMP=-N$REQ.RCT;
      396     5910    4                    FUNC.DC=FUNC.DC2;
      397     5911    4                    END;
      398     5912    4                 ELSE DO;
      399     5913    4                    RCTTEMP=N$REQ.RCT;
      400     5914    4                    END;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:12   
      401     5915    3                 IF RCTTEMP>63 THEN
      402     5916    3                    FUNC.RCNT=63;
      403     5917    3                 ELSE
      404     5918    3                    FUNC.RCNT=RCTTEMP;
      405     5919    3                 NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWBITS;
      406     5920    3                 IF HW_IMX THEN            /* NO DATA ACTUALLY TRANSFERRED */
      407     5921    3                    NI$REQ.IDCW.DATA.BASE(0)=%IMX_IOS_BASE;
      408     5922    3                 N$REQ.IOFLG.MREC='1'B;
      409     5923    3                 N$REQ.ARCT=0;
      410     5924    3               CASE(%BITBIN(RTN_MT_SPF));
      411     5925    3                 IF N$REQ.RCT<0 THEN FUNC.DC=FUNC.DC2;
      412     5926    3                 NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWBITS;
      413     5927    3                 IF HW_IMX THEN            /* NO DATA ACTUALLY TRANSFERRED */
      414     5928    3                    NI$REQ.IDCW.DATA.BASE(0)=%IMX_IOS_BASE;
      415     5929    3                 N$REQ.IOFLG.MREC='1'B;
      416     5930    3                 N$REQ.ARCT=0;
      417     5931    3               CASE(%BITBIN(RTN_MT_READ),%BITBIN(RTN_MT_WRITE));
      418     5932    3                 IF N$REQ.DVE.DVBYTE & %DVBYTE_BIN# THEN FUNC.DC=FUNC.DC2;
      419     5933    3                 GOTO RTN_STD0;
      420     5934    3               CASE(%BITBIN(RTN_MT_WRBYTE));
      421     5935    3                 FUNC.RCNT=MOD(BUFADDR+BUFSIZE,4)*8;
      422     5936    3                 GOTO RTN_STD0;
      423     5937    3               CASE(%BITBIN(RTN_MPC_READ),%BITBIN(RTN_MPC_WRITE));
      424     5938    3                 NI$REQ.MPCSEEK.MEMADDR = N$REQ.DLA.MPC.MEMADDR;
      425     5939    3                 NI$REQ.MPCSEEK.COUNT = (N$REQ.BUFSIZE + 1)/2;
      426     5940    3                 GOTO RTN_DP_SEEK;
      427     5941    3               CASE(%BITBIN(RTN_AP_IO));
      428     5942                                           /* Do nothing.  DCW list is already built. */
      429     5943                                           /* AP NOT CURRENTLY SUPPORTED ON IMX       */
      430     5944    3               CASE(%BITBIN(RTN_DP_SEEK),%BITBIN(RTN_DP_WRZERO));
      431     5945    3                 NI$REQ.SEEK=BINBIT(N$REQ.DLA.DRELADDR*DVT.GRANSIZE,36);
      432     5946    3   RTN_DP_SEEK:  N$REQ.IOFLG.LPW23='0'B;   /* REAL DCW, REAL LPW */
      433     5947    4                 IF PSIA THEN DO;
      434     5948    4                    NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWCONT;
      435     5949    4                    IF HW_IMX THEN
      436     5950    4                       NI$REQ.IDCW.DATA.BASE(0)=%IMX_IOS_BASE;
      437     5951    4                    DCWX=1;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:13   
      438     5952    4                    END;
      439     5953    4                 ELSE DO;
      440     5954    4                    NI$REQ.PCW=(FUNC & %IDCWMASK) | %CONCAT(IDCWCONT,'000000000600'O);
      441     5955    4                    END;
      442     5956    3                 NI$REQ.DCW(DCWX)=BINBIT(SEEK.WA*%BITBIN('1000000'O)+1,36);
      443     5957    3                 DCWX=DCWX+1;
      444     5958    3                 FUNC.DC=FUNC.DC2;
      445     5959    4                 IF RTN~=%BITBIN(RTN_DP_WRZERO) THEN DO;
      446     5960    5                    IF PTP~=0 AND NOT HW_IMX THEN DO; /* DATA: REAL->PAGED */
      447     5961    5                       PNTR$=ADDR(NI$REQ.DCW(DCWX+1));
      448     5962    5                       NI$REQ.DCW(DCWX)=BINBIT(PNTR.WA,18) | %TDCWM3A;
      449     5963    5                       DCWX=DCWX+1;
      450     5964    5                       END;
      451     5965    4                    GOTO RTN_STD;
      452     5966    4                    END;
      453     5967    4                 ELSE DO;
      454     5968    4                    NI$REQ.IDCW(DCWX)=(FUNC & %IDCWMASK) | %IDCWBITS;
      455     5969    4                    IF HW_IMX THEN
      456     5970    4                       NI$REQ.IDCW.DATA.BASE(DCWX)=%IMX_IOS_BASE;
      457     5971    4                    DCWX=DCWX+1;
      458     5972    5                    DO WHILE(BUFSIZE>%(%DCWTALLYMAX*4+4));
      459     5973    5                       NI$REQ.DCW(DCWX)=%IONTPDCW;
      460     5974    5                       DCWX=DCWX+1;
      461     5975    5                       BUFSIZE=BUFSIZE-%(%DCWTALLYMAX*4);
      462     5976    5                       IF DCWX=%DCWXMAX THEN CALL CHAINIOS ALTRET(NQPKTS);
      463     5977    5                       END;
      464     5978    5                    IF BUFSIZE>4 THEN DO;
      465     5979    5                       NI$REQ.DCW(DCWX)=%IONTPDCW | BINBIT(BUFSIZE/4-1,36);
      466     5980    5                       DCWX=DCWX+1;
      467     5981    5                       IF DCWX=%DCWXMAX THEN CALL CHAINIOS ALTRET(NQPKTS);
      468     5982    5                       END;
      469     5983    4                    PNTR$=ADDR(NI$REQ.DCW(%DCWXMAX));
      470     5984    4                    NI$REQ.DCW(DCWX)=BINBIT(PNTR.WA*%BITBIN('1000000'O)+1,36);
      471     5985    4                    END;
      472     5986    3               CASE(%BITBIN(RTN_STD));
      473     5987    3   RTN_STD0:     N$REQ.IOFLG.LPW23='1'B;
      474     5988    4   RTN_STD:      IF PSIA OR DCWX>0 THEN DO;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:14   
      475     5989    4                    NI$REQ.IDCW(DCWX)=(FUNC & %IDCWMASK) | %IDCWBITS;
      476     5990    4                    IF HW_IMX THEN
      477     5991    4                       NI$REQ.IDCW.DATA.BASE(DCWX)=BUF_BASE;
      478     5992    5                    ELSE IF PTP=0 AND NOT NOBUF THEN DO;
      479     5993    5                          NI$REQ.IDCW.EXTA(DCWX)=BUFREAL.EXTA;
      480     5994    5                          NI$REQ.IDCW.EC(DCWX)='1'B;
      481     5995    5                          END;
      482     5996    4                    DCWX=DCWX+1;
      483     5997    4                    END;
      484     5998    4                 ELSE DO;
      485     5999    4                    NI$REQ.PCW=(FUNC & %IDCWMASK) | %IDCWBITS;
      486     6000    5                    IF PTP=0 AND NOT NOBUF THEN DO;
      487     6001    5                       NI$REQ.PCW.AEX=BUFREAL.EXTA;
      488     6002    5                       END;
      489     6003    5                    ELSE DO;
      490     6004    5                       NI$REQ.PCW.FLAGS='600'O;
      491     6005    5                       END;
      492     6006    4                    END;
      493     6007    4                 IF NOT NOBUF THEN DO;
      494     6008    5                    IF PTP=0 THEN DO;
      495     6009    5                       N$REQ.IOFLG.LPW23='0'B;
      496     6010    5                       IF NOT HW_IMX THEN
      497     6011    5                          NI$REQ.PCW.FLAGS='0'B;
      498     6012    5                       END;
      499     6013    5                    ELSE DO;
      500     6014    5                       IF HW_IOP THEN
      501     6015    5                          NI$REQ.IOP_PTAW=BINBIT(PTP,27)|%IOP_PTA1_INIT; /* PHYSADDR */
      502     6016    5                       ELSE IF NOT HW_IMX THEN
      503     6017    5                             NI$REQ.PCW.PTP=PTP;
      504     6018    5                       N$REQ.LPWX.BASE=BUFVIRT.BASE;
      505     6019    5                       N$REQ.LPWX.BOUND=(BUFSIZE + BUFVIRT.BYT + 3) / 4;
      506     6020    5                       BUFVIRT.BASE=0;
      507     6021    5                       END;
      508     6022    4                    NI$REQ.DCW.ICP(DCWX)=BUFREAL.BYT;
      509     6023    4                    BUFOFFSET=BUFREAL.ADR;
      510     6024    4                    SIZE=(BUFSIZE + BUFREAL.BYT + 3) / 4;
      511     6025    5                    DO WHILE(SIZE>%DCWTALLYMAX);
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:15   
      512     6026    5                       NI$REQ.DCW.FWA(DCWX)=BUFOFFSET;
      513     6027    5                       NI$REQ.DCW.TYPE(DCWX)=%DCW_IOTP;
      514     6028    5                       DCWX=DCWX+1;
      515     6029    5                       SIZE=SIZE-%DCWTALLYMAX;
      516     6030    5                       BUFOFFSET=BUFOFFSET+%DCWTALLYMAX;
      517     6031    5                       IF DCWX=%DCWXMAX THEN CALL CHAINIOS ALTRET(NQPKTS);
      518     6032    5                       END;
      519     6033    4                    NI$REQ.DCW.FWA(DCWX)=BUFOFFSET;
      520     6034    4                    NI$REQ.DCW.TALLY(DCWX)=SIZE;
      521     6035    4                    NI$REQ.DCW.TYPE(DCWX)=%DCW_IOTD;
      522     6036    4                    END;
      523     6037    3               CASE(%BITBIN(RTN_MSOS_DUAL)); /* HW_IOP */
      524     6038    3                 PNTR$=N$REQ.BUF$; /* BUF$-> an IOS packet being used as a buffer */
      525     6039    3                 NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWCONT;
      526     6040    3                 NI$REQ.DCW.FWA(1)=PNTR.WA+2;
      527     6041    3                 NI$REQ.DCW.TYPE(1)=%DCW_IOTD;
      528     6042    3                 NI$REQ.DCW.TALLY(1)=4;
      529     6043    3                 NI$REQ.IDCW(2)=(FUNC & %IDCWMASK) | %IDCWBITS;
      530     6044    3                 NI$REQ.IDCW.DC(2)=FUNC.DC2;
      531     6045    3                 NI$REQ.DCW.FWA(3)=PNTR.WA+6;
      532     6046    3                 NI$REQ.DCW.TYPE(3)=%DCW_IOTD;
      533     6047    3                 NI$REQ.DCW.TALLY(3)=4;
      534     6048    3               CASE(%BITBIN(RTN_MCA_DUAL)); /* HW_IMX */
      535     6049    3                 N$REQ.LPWX.BASE=BUFVIRT.BASE;
      536     6050    3                 N$REQ.LPWX.BOUND=4096;
      537     6051    3                 BUFVIRT.BASE=0;
      538     6052    3                 NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWCONT;
      539     6053    3                 NI$REQ.IDCW.DATA.BASE(0)=BUF_BASE;
      540     6054    3                 NI$REQ.DCW.FWA(1)=BUFREAL.ADR;
      541     6055    3                 NI$REQ.DCW.TALLY(1)=(BUFSIZE+BUFREAL.BYT+3) / 4;
      542     6056    3                 NI$REQ.DCW.TYPE(1)=%DCW_IOTD;
      543     6057    3                 NI$REQ.IDCW(2)=(FUNC & %IDCWMASK) | %IDCWBITS;
      544     6058    3                 NI$REQ.IDCW.DC(2)=FUNC.DC2;
      545     6059    3                 NI$REQ.IDCW.DATA.BASE(2)=BUF_BASE;
      546     6060    3                 NI$REQ.DCW.FWA(3)=BUFREAL.ADR;
      547     6061    3                 NI$REQ.DCW.TYPE(3)=%DCW_IOTD;
      548     6062                                                /* DCW.TALLY(3) is 4096 */
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:16   
      549     6063    3               END;                        /* CASE RTN */
      550     6064    3              IF HW_IMX THEN DO;           /* PREPARE IMX MAILBOX */
      551     6065    4                 IF PTP~=0 THEN DO;
      552     6066    4                    NI$IMXMBX.PAGED_BASE(%IMX_IOS_BASE)=BINBIT(NI_IMXLO_PBASE,36);
      553     6067    4                    NI$IMXMBX.SIZE(%IMX_IOS_BASE)=(%IMXHI-%IMXLO+1)*1024 - 1;
      554     6068    4                    NI$IMXMBX.PAGED_BASE.PTWADDR(BUF_BASE)=PTP;
      555     6069    4                    NI$IMXMBX.PAGED_BASE.OFFSET(BUF_BASE)=N$REQ.LPWX.BASE*2;
      556     6070    4                    NI$IMXMBX.SIZE(BUF_BASE)=N$REQ.LPWX.BOUND-1;
      557     6071    4                    END;
      558     6072    4                 ELSE DO;
      559     6073    4                    NI$IMXMBX.NPAGED_IND.PHYS(%IMX_IOS_BASE)=B$MPT$->B$MAP.RPN(%IMXLO)*
              6073                             1024;
      560     6074    4                    NI$IMXMBX.SIZE(%IMX_IOS_BASE)=(%IMXHI-%IMXLO+1)*1024 - 1;
      561     6075    4                    NI$IMXMBX.NPAGED_IND.PHYS(BUF_BASE)=BUFREAL.EXTA*%BITBIN('1000000'O
              6075                             );
      562     6076    4                    NI$IMXMBX.SIZE(BUF_BASE)=(BUFSIZE+BUFREALB.BYTADR+3)/4 - 1;
      563     6077    4                    END;
      564     6078    3                 PNTR$=ADDR(N$REQ.IOS$->NI$REQ.DCW(0));
      565     6079    3                 NI$IMXMBX.LPW.DCW_ADDR=PNTR.WA;
      566     6080    3                 END;
      567     6081    2              IF QUE=%QUE_DCWBLD THEN RETURN;
      568     6082    2              SCHED=DVT.SCHED;
      569     6083    2              CALL SCHED(N$REQ);
      570     6084
      571     6085    2            CASE(NK_QTRM);
      572     6086    2              N$REQ.COMP=%COMP_COM;
      573     6087                   %ENQUEUE(P#=N$REQ,Q#=DCT.SQ$);
      574     6090    2              CALL SC_NIONRD;
      575     6091        /*S* SCREECH_CODE: NIO-S$NRD-7
      576     6092             TYPE: SCREECH
      577     6093             MESSAGE: I/O TO REMOTE DEVICES IS NOT IMPLEMENTED
      578     6094        */
      579     6095
      580     6096    2            CASE(NK_CGDCB);
      581     6097    2              N$REQ.IOQFLG.IOQUED = '0'B ;
      582     6098    2              N$REQ.COMP=%COMP_COM;
      583     6099    3              DO CASE (N$REQ.FC);
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:17   
      584     6100    3               CASE (%N_WRITE,%N_WRASC,%N_WRBIN);
      585     6101    3                 CALL KQW$WRITE (N$REQ);
      586     6102    3               CASE (ELSE);
      587     6103    3                 CALL KQR$READ (N$REQ);
      588     6104    3               END;
      589     6105    2              RETURN;
      590     6106
      591     6107    2            CASE(ELSE);
      592     6108    2              CALL SC_NIONRD;
      593     6109    2            END /* CASE DCT.RESCOD */;
      594     6110
      595     6111    1           IF N$REQ.OPFLG.WAIT AND N$REQ.OPFLG.USER AND QUE=%QUE_STD THEN
      596     6112    1              IF N$REQ.DCB$ ~= ADDR(NIL) THEN
      597     6113    1                 CALL SSR$REG(%SS_IIP,N$REQ.DCB$->F$DCB.FCN(N$REQ.NWIO));
      598     6114    1              ELSE
      599     6115    1                 CALL SSR$REG(%SS_IIP);
      600     6116    1           RETURN;
      601     6117        /**/
      602     6118        /* BACK OUT AND ALTRETURN IF NO IOS PACKETS AVAILABLE */
      603     6119        /**/
      604     6120    1   NQPKTS:
      605     6121    1           N$REQ.IOQFLG.IOQUED = '0'B ;
      606     6122    2           IF N$REQ.IOFLG.IOS THEN DO;
      607     6123    2              CALL NIQ$RELS(N$REQ.IOS$);
      608     6124    2              N$REQ.IOS$=ADDR(NIL);
      609     6125    2              N$REQ.IOFLG.IOS='0'B;
      610     6126    2              END;
      611     6127    1           IF NOT N$REQ.NOALT THEN ALTRETURN;
      612     6128                %LOCK(G#=NI$RP.GATE);
      613     6131                %ENQUEUE(P#=N$REQ,Q#=NI$RP.RQ$);
      614     6134                %UNLOCK(G#=NI$RP.GATE);
      615     6137    1           RETURN;
      616     6138        %EJECT;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:18   
      617     6139    1   CHAINIOS: PROC ALTRET;
      618     6140    2   DCL TDCW$ PTR;
      619     6141    2   DCL TDCW REDEF TDCW$ BIT(36);
      620     6142    3           IF NI$REQ.FL$=ADDR(NIL) THEN DO;
      621     6143    3              CALL NIQ$GETS(NI$REQ.FL$) ALTRET(ALT);
      622     6144    3              END;
      623     6145    3           ELSE DO;
      624     6146    3              TDCW$=NI$REQ.FL$->NI$REQ.FL$;
      625     6147    3              NI$REQ.FL$->NI$REQ=NI$REQ_INIT;
      626     6148    3              NI$REQ.FL$->NI$REQ.FL$=TDCW$;
      627     6149    3              END;
      628     6150    2           TDCW$=ADDR(NI$REQ.FL$->NI$REQ.DCW(0));
      629     6151    2           NI$REQ.DCW(DCWX)=(TDCW & %TDCWMASK) | %TDCWM1;
      630     6152    2           IF HW_IMX THEN
      631     6153    2              NI$REQ.DCW.T.DCWLIST.BASE(DCWX)=%IMX_IOS_BASE;
      632     6154    2           DCWX=0;
      633     6155    2           IOS$=NI$REQ.FL$;
      634     6156    2           RETURN;
      635     6157    2   ALT:    ALTRETURN;
      636     6158    2   END CHAINIOS;
      637     6159        /**/
      638     6160    1   END NIO$QUE;
      639     6161        %EOD;

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:19   
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI_DEVCMD_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_MLSMAC_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIO$QUE.

   Procedure NIO$QUE requires 1262 words for executable code.
   Procedure NIO$QUE requires 36 words of local(AUTO) storage.

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:20   

 Object Unit name= NIO$QUE                                    File name= NIO$QUE.:E05TOU
 UTS= JUL 30 '97 03:34:21.04 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     15     17  NIO$QUE
    1   Proc  even  none  1262   2356  NIO$QUE
    2  RoData even  none    20     24  NIO$QUE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  NIO$QUE
     1      4          yes     yes      Std        1  NIO$REQUE
     1     11          yes     yes      Std        1  NIO$DCWBLD
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:21   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 SSR$REG
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       1 NIU$CRPEXTST
 yes     yes           Std       1 NIQ$RELS
 yes     yes           Std       1 KQR$READ
         yes           Std       3 NIM$CVTPTR
         yes           Std       2 NIO$COMP
 yes     yes           Std       2 NIU$SYMBLOCK
         yes           Std       1 HFC$LOCK
 yes     yes           Std       1 NIQ$GETS
 yes     yes           Std       1 KQW$WRITE
         yes           Std       2 NIM$ENQUEUE
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_NIOBADIOQ                          SC_NIOINVDLA                          SC_NIOBADFC
     SC_NIONRD                             HW_IOP                                HW_IMX
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                         r    NI$IMXMBX_INIT                   r    NI$REQ_INIT
     NI$RP$                                NI_IMXLO_PBASE                        NI_MFGATE
     B$JIT$                           r    B$LS$                                 B$MPT$
     S$CU$                            r    B$WSQ0PT$                             F_DCBLOCK
     NK_MXTOTAL                            S_CUN                                 SL_IOTA
     SL_MF                                 B_VECTNIL
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:22   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:23   


        1        1        /*M* NIO$QUE - I/O system interface module */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR */
        8        8        NIO$QUE: PROC(N$REQ) ALTRET;

      8  1 000000   000000 700200 xent  NIO$QUE      TSX0  ! X66_AUTO_1
         1 000001   000044 000001                    ZERO    36,1

        9        9        /*
       10       10                Includes
       11       11        */
       12       12        %INCLUDE                B$JIT ;
       13      615        %INCLUDE                B$MAP ;
       14      714        %INCLUDE                B$USER ;
       15      930        %INCLUDE                B_MLSMAC_C ;
       16     1872        %INCLUDE                B_SEGIDS_C ;
       17     2411        %INCLUDE                CP_6_SUBS ;
       18     2951        %INCLUDE                F$DCB ;
       19     3000        %INCLUDE                HF_DATA_R ;
       20     3043        %INCLUDE                HF_LOCK_C ;
       21     3057        %INCLUDE                M_INFO_C ;
       22     3197        %INCLUDE                NI_DATA_C ;
       23     3310        %INCLUDE                NI_DATA_R ;
       24     3747        %INCLUDE                NI_DEVCMD_C ;
       25     3930        %INCLUDE                NI_MACROS_C ;
       26     4197        %INCLUDE                NK_SUBS ;
       27     4222        %INCLUDE                N_FC_C ;
       28     4259        %INCLUDE                SS_SCHED_C ;
       29     4492        /*
       30     4493                Parameters
       31     4494        */
       32     4495        %N$REQ                  ( NAME=N$REQ, STCLASS=PARAM ) ;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:24   
       33     4553        /*
       34     4554                Entries
       35     4555        */
       36     4556    1   DCL 1 KQR$READ          ENTRY(1) ALTRET ;
       37     4557    1   DCL 1 KQW$WRITE         ENTRY(1) ALTRET ;
       38     4558    1   DCL 1 NIM$CVTPTR        ENTRY(3) ;
       39     4559    1   DCL 1 NIO$COMP          ENTRY(2) ;
       40     4560    1   DCL 1 NIQ$GETS          ENTRY(1) ALTRET ;
       41     4561    1   DCL 1 NIQ$RELS          ENTRY(1) ALTRET ;
       42     4562    1   DCL 1 NIU$CRPEXTST      ENTRY(1) ALTRET ;
       43     4563    1   DCL 1 NIU$SYMBLOCK      ENTRY(2) ALTRET ;
       44     4564    1   DCL 1 SC_NIOBADFC       ENTRY CONV(2,0) ;
       45     4565    1   DCL 1 SC_NIOBADIOQ      ENTRY CONV(2,0) ;
       46     4566    1   DCL 1 SC_NIOINVDLA      ENTRY CONV(2,0) ;
       47     4567    1   DCL 1 SC_NIONRD         ENTRY CONV(2,0) ;
       48     4568    1   DCL 1 SSR$REG           ENTRY(3) ALTRET ;
       49     4569        /*
       50     4570                Symrefs
       51     4571        */
       52     4572    1   DCL 1 B$JIT$            PTR SYMREF ;
       53     4573    1   DCL 1 B$LS$             PTR SYMREF READONLY ;
       54     4574    1   DCL 1 B$MPT$            PTR SYMREF ;
       55     4575        %B$USERREFS ;
       56     4579    1   DCL 1 B$WSQ0PT$         PTR SYMREF READONLY ;
       57     4580    1   DCL 1 F_DCBLOCK         BIT(72) SYMREF ;
       58     4581    1   DCL 1 NK_MXTOTAL        UBIN(36) SYMREF ;
       59     4582    1   DCL 1 S_CUN             SBIN SYMREF;
       60     4583    1   DCL 1 SL_IOTA(0:4)      SBIN SYMREF ;   /* QUANTUM PENALTY FOR I/O            */
       61     4584    1   DCL 1 SL_MF(0:4)        SBIN SYMREF ;   /* MASTER FUNCTION LIMIT BY CLASS     */
       62     4585        /*
       63     4586                Auto
       64     4587        */
       65     4588    1   DCL 1 BUFADDR           SBIN ALIGNED AUTO ;
       66     4589    1   DCL 1 BUFREAL           REDEF BUFADDR,
       67     4590    1         2 EXTA            UBIN(16) UNAL,
       68     4591    1         2 ADR             UBIN(18) UNAL,
       69     4592    1         2 BYT             UBIN(2) UNAL;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:25   
       70     4593    1   DCL 1 BUFREALB          REDEF BUFADDR,
       71     4594    1         2 EXTA            UBIN(16) UNAL,
       72     4595    1         2 BYTADR          UBIN(20) UNAL;
       73     4596    1   DCL 1 BUFVIRT           REDEF BUFADDR,
       74     4597    1         2 BASE            UBIN(33) UNAL,
       75     4598    1         2 BYT             UBIN(3) UNAL;
       76     4599    1   DCL 1 BUFOFFSET         UBIN ALIGNED AUTO ;
       77     4600    1   DCL 1 BUFSIZE           SBIN ALIGNED AUTO ;
       78     4601    1   DCL 1 BUF_BASE          SBIN ALIGNED AUTO ;
       79     4602    1   DCL 1 CONT              BIT(1) ALIGNED AUTO ;
       80     4603    1   DCL 1 CSIZE             SBIN ALIGNED AUTO ;
       81     4604    1   DCL 1 DCB$              PTR ALIGNED AUTO ;
       82     4605    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
       83     4606    1   DCL 1 DCWX              SBIN ALIGNED AUTO ;
       84     4607    1   DCL 1 DVT$              PTR ALIGNED AUTO ;
       85     4608    1   DCL 1 FUNC              ALIGNED AUTO,
       86     4609    1         2 DC              UBIN(6) UNAL,
       87     4610    1         2 RTN             UBIN(6) UNAL,
       88     4611    1         2 DVN             REDEF RTN
       89     4612    1                           UBIN(6) UNAL,
       90     4613    1         2 DC2             UBIN(6) UNAL,
       91     4614    1         2 TIMO            UBIN(6) UNAL,
       92     4615    1         2 CC              UBIN(6) UNAL,
       93     4616    1         2 CCB             REDEF CC
       94     4617    1                           BIT(6) UNAL,
       95     4618    1         2 RCNT            UBIN(6) UNAL;
       96     4619    1   DCL 1 IOS$              PTR ALIGNED AUTO ;
       97     4620    1   DCL 1 MBX$              PTR ALIGNED AUTO ;
       98     4621    1   DCL 1 NOBUF             BIT(1) ALIGNED AUTO ;
       99     4622    1   DCL 1 PNTR$             PTR ALIGNED AUTO ;
      100     4623    1   DCL 1 PNTR              REDEF PNTR$,
      101     4624    1         2 WA              UBIN(18) HALIGNED,
      102     4625    1         2 *               UBIN(18) HALIGNED ;
      103     4626    1   DCL 1 PSIA              BIT(1) ALIGNED AUTO ;
      104     4627    1   DCL 1 PTP               SBIN ALIGNED AUTO ;
      105     4628    1   DCL 1 QUE               SBIN ALIGNED AUTO ;
      106     4629    1   DCL 1 RCTTEMP           SBIN ALIGNED AUTO ;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:26   
      107     4630    1   DCL 1 RTN               UBIN ALIGNED AUTO ;
      108     4631    1   DCL 1 SCHED             EPTR ALIGNED AUTO ;
      109     4632    1   DCL 1 SEEK$             PTR ALIGNED AUTO ;
      110     4633    1   DCL 1 SEEK              REDEF SEEK$,
      111     4634    1         2 WA              UBIN(18) HALIGNED,
      112     4635    1         2 *               UBIN(18) HALIGNED ;
      113     4636    1   DCL 1 SIZE              UBIN ALIGNED AUTO ;
      114     4637    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      115     4638    1   DCL 1 X                 SBIN ALIGNED AUTO ;
      116     4639        /*
      117     4640                Based
      118     4641        */
      119     4642        %B_MLS                  ( FPTN=B$MLNK,    STCLASS=BASED ) ;
      120     5457    1   DCL 1 CHARBASE          CHAR(CSIZE) BASED ;
      121     5458    1   DCL 1 CHAR3             CHAR(3) BASED UNAL ;
      122     5459        %NI$DCT                 ( NAME=DCT,       STCLASS="BASED(DCT$)" ) ;
      123     5507        %DCW                    ( NAME=DCW,       STCLASS=BASED ) ;
      124     5537        %NI$DVT                 ( NAME=DVT,       STCLASS="BASED(DVT$)" ) ;
      125     5544        %IDCW                   ( NAME=IDCW,      STCLASS=BASED ) ;
      126     5576        %NI$IMXMBX              ( NAME=NI$IMXMBX, STCLASS="BASED(MBX$)" ) ;
      127     5597        %NI$REQ                 ( NAME=NI$REQ,    STCLASS="BASED(IOS$)" ) ;
      128     5622    1   DCL 1 ONECHAR(0:0)      CHAR(1) BASED ;
      129     5623    1   DCL 1 POINTER           BASED ALIGNED,
      130     5624    1         2 W               UBIN(18) UNAL,
      131     5625    1         2 C               UBIN(2) UNAL,
      132     5626    1         2 B               UBIN(4) UNAL,
      133     5627    1         2 SEGID           UBIN(12) UNAL ;
      134     5628        %NI$SQH                 ( NAME=SQH, STCLASS="BASED(SQH$)" ) ;
      135     5641    1   DCL 1 VFC               BASED ALIGNED,
      136     5642    1         2 VFCCHAR         CHAR(1),
      137     5643    1         2 BUFCHARS        CHAR(3) ;
      138     5644        /*
      139     5645                Constant
      140     5646        */
      141     5647        %SUB B$U="S$CU$->B$U";
      142     5648        %EJECT;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:27   
      143     5649    1           QUE=%QUE_STD;

   5649  1 000002   200025 450100                    STZ     QUE,,AUTO

      144     5650    1           GOTO QUECMN;

   5650  1 000003   000020 710000 1                  TRA     QUECMN

      145     5651
      146     5652
      147     5653
      148     5654    1   NIO$REQUE: ENTRY(N$REQ) ALTRET;

   5654  1 000004   000000 700200 xent  NIO$REQUE    TSX0  ! X66_AUTO_1
         1 000005   000044 000001                    ZERO    36,1

      149     5655    1           QUE=%QUE_QUE_AGAIN;

   5655  1 000006   000002 235007                    LDA     2,DL
         1 000007   200025 755100                    STA     QUE,,AUTO

      150     5656    1           GOTO QUECMN;

   5656  1 000010   000020 710000 1                  TRA     QUECMN

      151     5657
      152     5658
      153     5659
      154     5660    1   NIO$DCWBLD: ENTRY(N$REQ) ALTRET;

   5660  1 000011   000000 700200 xent  NIO$DCWBLD   TSX0  ! X66_AUTO_1
         1 000012   000044 000001                    ZERO    36,1

      155     5661    1           QUE=%QUE_DCWBLD;

   5661  1 000013   000001 235007                    LDA     1,DL
         1 000014   200025 755100                    STA     QUE,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:28   

      156     5662    1           N$REQ.IOQFLG.IOQUED = '0'B ;

   5662  1 000015   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000016   000000 236000 2                  LDQ     0
         1 000017   000033 356100                    ANSQ    27,,PR0

   5662  1 000020                       QUECMN       null
      157     5663
      158     5664
      159     5665
      160     5666    1   QUECMN: ;
      161     5667    1           IF  NOT N$REQ.IOQFLG.INUSE

   5667  1 000020   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000021   000033 234100                    SZN     27,,PR0
         1 000022   000026 605000 1                  TPL     s:5681
         1 000023   000033 236100                    LDQ     27,,PR0
         1 000024   200000 316003                    CANQ    65536,DU
         1 000025   000030 600000 1                  TZE     s:5683

      162     5668    1             OR N$REQ.IOQFLG.IOQUED
      163     5669    1           THEN
      164     5670        /*S* SCREECH_CODE:  NIO-S$BADIOQ-7
      165     5671             TYPE:          SCREECH
      166     5672             MESSAGE:       Incorrect IOQ processing within IO system.
      167     5673             DESCRIPTION:   The IO system detected an incorrect processing
      168     5674                            sequence on an IOQ packet.  To be scheduled
      169     5675                            for an IO, an IOQ packet must be in use and
      170     5676                            must not have been previously scheduled for
      171     5677                            an IO.  To have an IO completed, an IOQ packet
      172     5678                            must be in use and must have been previously
      173     5679                            been scheduled for an IO.
      174     5680        */
      175     5681    1              CALL SC_NIOBADIOQ ;

   5681  1 000026   000000 713400 xsym               CLIMB   SC_NIOBADIOQ
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:29   
         1 000027   000000 600000 xsid               climb   nvectors=         0

      176     5682
      177     5683    1           N$REQ.IOQFLG.IOQUED = '1'B ;

   5683  1 000030   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000031   200000 236003                    LDQ     65536,DU
         1 000032   000033 256100                    ORSQ    27,,PR0

      178     5684    1           IF ADDR(N$REQ.DCB$)->POINTER.SEGID=BITBIN(%ROSID) THEN

   5684  1 000033   000022 236100                    LDQ     18,,PR0
         1 000034   007777 376007                    ANQ     4095,DL
         1 000035   006003 116007                    CMPQ    3075,DL
         1 000036   000041 601000 1                  TNZ     s:5686

      179     5685    1              ADDR(N$REQ.DCB$)->POINTER.SEGID=BITBIN(%RONCSID);

   5685  1 000037   006124 236007                    LDQ     3156,DL
         1 000040   000022 752103                    STCQ    18,'03'O,PR0

      180     5686    1           DCB$=N$REQ.DCB$;

   5686  1 000041   000022 236100                    LDQ     18,,PR0
         1 000042   200012 756100                    STQ     DCB$,,AUTO

      181     5687    1           IF N$REQ.DLA.DCTX>NK_MXTOTAL OR N$REQ.DLA.DCTX=0 THEN

   5687  1 000043   000001 236100                    LDQ     1,,PR0
         1 000044   000025 772000                    QRL     21
         1 000045   000000 116000 xsym               CMPQ    NK_MXTOTAL
         1 000046   000050 600000 1                  TZE     s:5687+5
         1 000047   000053 603000 1                  TRC     s:5688
         1 000050   000001 236100                    LDQ     1,,PR0
         1 000051   777770 316003                    CANQ    -8,DU
         1 000052   000055 601000 1                  TNZ     s:5693

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:30   
      182     5688    1              CALL SC_NIOINVDLA;

   5688  1 000053   000000 713400 xsym               CLIMB   SC_NIOINVDLA
         1 000054   000000 600000 xsid               climb   nvectors=         0

      183     5689        /*S* SCREECH_CODE: NIO-S$INVDLA-7
      184     5690             TYPE: SCREECH
      185     5691             MESSAGE: BAD DCT INDEX
      186     5692        */
      187     5693    1           DCT$=N$DCT$(N$REQ.DLA.DCTX);

   5693  1 000055   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000056   000001 236100                    LDQ     1,,PR0
         1 000057   000025 772000                    QRL     21
         1 000060   000000 471400 xsym               LDP1    N$DCT$$
         1 000061   100000 236106                    LDQ     0,QL,PR1
         1 000062   200013 756100                    STQ     DCT$,,AUTO

      188     5694    1           N$REQ.DCT$=DCT$;

   5694  1 000063   000002 756100                    STQ     2,,PR0

      189     5695                                                /* BUF_BASE IS USED ONLY FOR THE IMX */
      190     5696    1           IF DCT.DFLG.RELOAD THEN

   5696  1 000064   200013 473500                    LDP3    DCT$,,AUTO
         1 000065   300006 236100                    LDQ     6,,PR3
         1 000066   004000 316007                    CANQ    2048,DL
         1 000067   000072 600000 1                  TZE     s:5699

      191     5697    1              BUF_BASE=%IMX_FWBUF_BASE;

   5697  1 000070   200007 450100                    STZ     BUF_BASE,,AUTO
         1 000071   000074 710000 1                  TRA     s:5700

      192     5698    1           ELSE
      193     5699    1              BUF_BASE=%IMX_BUF_BASE;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:31   

   5699  1 000072   000003 235007                    LDA     3,DL
         1 000073   200007 755100                    STA     BUF_BASE,,AUTO

      194     5700    2           IF DCT.RESCOD=NK_NCOM THEN DO;

   5700  1 000074   000017 316007                    CANQ    15,DL
         1 000075   000177 601000 1                  TNZ     s:5725

      195     5701    3              IF N$REQ.OPFLG.BPF THEN DO;

   5701  1 000076   000004 236100                    LDQ     4,,PR0
         1 000077   000010 316007                    CANQ    8,DL
         1 000100   000124 600000 1                  TZE     s:5708

      196     5702    3                 CALL NIM$CVTPTR(N$REQ.BUF$,BUFADDR,PTP);

   5702  1 000101   200024 634500                    EPPR4   PTP,,AUTO
         1 000102   200042 454500                    STP4    TDCW$+3,,AUTO
         1 000103   200004 635500                    EPPR5   BUFADDR,,AUTO
         1 000104   200041 455500                    STP5    TDCW$+2,,AUTO
         1 000105   200003 236100                    LDQ     @N$REQ,,AUTO
         1 000106   000005 036003                    ADLQ    5,DU
         1 000107   200040 756100                    STQ     TDCW$+1,,AUTO
         1 000110   200040 630500                    EPPR0   TDCW$+1,,AUTO
         1 000111   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000112   000000 701000 xent               TSX1    NIM$CVTPTR
         1 000113   000000 011000                    NOP     0

      197     5703    3                 N$REQ.OPFLG.BPF='0'B;

   5703  1 000114   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000115   000001 236000 2                  LDQ     1
         1 000116   000004 356100                    ANSQ    4,,PR0

      198     5704    3                 N$REQ.BUFADDR=BUFADDR;

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:32   
   5704  1 000117   200004 235100                    LDA     BUFADDR,,AUTO
         1 000120   000006 755100                    STA     6,,PR0

      199     5705    3                 N$REQ.PTP=PTP;

   5705  1 000121   200024 235100                    LDA     PTP,,AUTO
         1 000122   000007 755100                    STA     7,,PR0

      200     5706    3                 END;

   5706  1 000123   000171 710000 1                  TRA     s:5722

      201     5707    3              ELSE DO;

      202     5708    4                 IF HW_IOP AND N$REQ.PTP=0 AND N$REQ.BUFADDR~=0 THEN DO;

   5708  1 000124   000000 234000 xsym               SZN     HW_IOP
         1 000125   000165 605000 1                  TPL     s:5719
         1 000126   000007 235100                    LDA     7,,PR0
         1 000127   000165 601000 1                  TNZ     s:5719
         1 000130   000006 235100                    LDA     6,,PR0
         1 000131   000165 600000 1                  TZE     s:5719

      203     5709                       /* IOP CAN'T DO NON-PAGED IO ADDR>16MW, SO CONVERT TO PAGED */
      204     5710    4                    N$REQ.BUFREAL_SV=BINBIT(N$REQ.BUFADDR,36);

   5710  1 000132   000006 236100                    LDQ     6,,PR0
         1 000133   000032 756100                    STQ     26,,PR0

      205     5711    4                    N$REQ.PTP=B$LS$->B$MLNK.WSQ0PT.BASE/256 + /* HW_IOPTP_UNITS*4 */

   5711  1 000134   000000 474400 xsym               LDP4    B$LS$
         1 000135   400373 236100                    LDQ     251,,PR4
         1 000136   000010 772000                    QRL     8
         1 000137   200040 756100                    STQ     TDCW$+1,,AUTO
         1 000140   000032 236100                    LDQ     26,,PR0
         1 000141   000022 732000                    QRS     18
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:33   
         1 000142   200041 756100                    STQ     TDCW$+2,,AUTO
         1 000143   200040 236100                    LDQ     TDCW$+1,,AUTO
         1 000144   200041 036100                    ADLQ    TDCW$+2,,AUTO
         1 000145   000007 756100                    STQ     7,,PR0

      206     5712    4                      N$REQ.BUFREAL_SV.DIV64PG;
      207     5713                       /* NOW RUN PTP THROUGH WSQ0PT TO FIND PHYSICAL ADDR OF PT WORD */
      208     5714    4                    N$REQ.PTP=B$WSQ0PT$->B$MAP.RPN(N$REQ.PTP/16)*16 +
              5714                             /* 1024/HW_IOPTP_UNITS */

   5714  1 000146   000020 506007                    DIV     16,DL
         1 000147   000007 236100                    LDQ     7,,PR0
         1 000150   200040 755100                    STA     TDCW$+1,,AUTO
         1 000151   000020 506007                    DIV     16,DL
         1 000152   000000 475400 xsym               LDP5    B$WSQ0PT$
         1 000153   500000 236106                    LDQ     0,QL,PR5
         1 000154   000016 772000                    QRL     14
         1 000155   000002 376000 2                  ANQ     2
         1 000156   200040 036100                    ADLQ    TDCW$+1,,AUTO
         1 000157   000007 756100                    STQ     7,,PR0

      209     5715    4                      MOD(N$REQ.PTP,16);
      210     5716    4                    N$REQ.BUFADDR=N$REQ.BUFREAL_SV.MOD64PG;

   5716  1 000160   000032 236100                    LDQ     26,,PR0
         1 000161   777777 376007                    ANQ     -1,DL
         1 000162   000006 756100                    STQ     6,,PR0

      211     5717    4                    N$REQ.IOP_BUFREAL_CVRT='1'B;

   5717  1 000163   040000 236007                    LDQ     16384,DL
         1 000164   000031 256100                    ORSQ    25,,PR0

      212     5718    4                    END;

      213     5719    3                 BUFADDR=N$REQ.BUFADDR;

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:34   
   5719  1 000165   000006 235100                    LDA     6,,PR0
         1 000166   200004 755100                    STA     BUFADDR,,AUTO

      214     5720    3                 PTP=N$REQ.PTP;

   5720  1 000167   000007 235100                    LDA     7,,PR0
         1 000170   200024 755100                    STA     PTP,,AUTO

      215     5721    3                 END;

      216     5722    2              BUFSIZE=N$REQ.BUFSIZE;

   5722  1 000171   000004 236100                    LDQ     4,,PR0
         1 000172   000020 772000                    QRL     16
         1 000173   200006 756100                    STQ     BUFSIZE,,AUTO

      217     5723    2              DVT$=DCT.DVT$;

   5723  1 000174   200013 471500                    LDP1    DCT$,,AUTO
         1 000175   100024 236100                    LDQ     20,,PR1
         1 000176   200015 756100                    STQ     DVT$,,AUTO

      218     5724    2              END;

      219     5725    2           IF QUE=%QUE_STD THEN DO;

   5725  1 000177   200025 235100                    LDA     QUE,,AUTO
         1 000200   000331 601000 1                  TNZ     s:5756

      220     5726    2              N$REQ.TYC='0'B;

   5726  1 000201   000021 450100                    STZ     17,,PR0

      221     5727    2              N$REQ.ARCT=0;

   5727  1 000202   000000 220003                    LDX0    0,DU
         1 000203   000030 740100                    STX0    24,,PR0
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:35   

      222     5728    2              N$REQ.ARSIZE=0;

   5728  1 000204   177777 236007                    LDQ     65535,DL
         1 000205   000027 356100                    ANSQ    23,,PR0

      223     5729    3              IF N$REQ.OPFLG.USER THEN DO INHIBIT;

   5729  1 000206   000004 236100                    LDQ     4,,PR0
         1 000207   000400 316007                    CANQ    256,DL
         1 000210   000331 600000 1                  TZE     s:5756

      224     5730    3                 N$REQ.USER# = S_CUN;

   5730  1 000211   000000 236200 xsym               LDQ   ! S_CUN
         1 000212   000027 552304                    STBQ  ! 23,'04'O,PR0

      225     5731    3                 B$JIT.CTIME=B$JIT.CTIME+SL_IOTA(B$JIT.MODE);

   5731  1 000213   000000 471600 xsym               LDP1  ! B$JIT$
         1 000214   100000 236300                    LDQ   ! 0,,PR1
         1 000215   000040 772200                    QRL   ! 32
         1 000216   000000 621206                    EAX1  ! 0,QL
         1 000217   100263 236300                    LDQ   ! 179,,PR1
         1 000220   000000 036211 xsym               ADLQ  ! SL_IOTA,X1
         1 000221   100263 756300                    STQ   ! 179,,PR1

      226     5732    3                 IF B$U.MF - B$U.CMF >= SL_MF(B$JIT.MODE) THEN

   5732  1 000222   000000 473600 xsym               LDP3  ! S$CU$
         1 000223   300007 236300                    LDQ   ! 7,,PR3
         1 000224   000077 376207                    ANQ   ! 63,DL
         1 000225   200040 756300                    STQ   ! TDCW$+1,,AUTO
         1 000226   300006 236300                    LDQ   ! 6,,PR3
         1 000227   000033 772200                    QRL   ! 27
         1 000230   200040 136300                    SBLQ  ! TDCW$+1,,AUTO
         1 000231   200041 756300                    STQ   ! TDCW$+2,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:36   
         1 000232   100000 236300                    LDQ   ! 0,,PR1
         1 000233   000040 772200                    QRL   ! 32
         1 000234   000000 621206                    EAX1  ! 0,QL
         1 000235   200041 236300                    LDQ   ! TDCW$+2,,AUTO
         1 000236   000000 116211 xsym               CMPQ  ! SL_MF,X1
         1 000237   000244 604200 1                  TMI   ! s:5735

      227     5733    3                    CALL SSR$REG(%SS_QMF);

   5733  1 000240   000003 630600 2                  EPPR0 ! 3
         1 000241   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000242   000000 701200 xent               TSX1  ! SSR$REG
         1 000243   000000 011200                    NOP   ! 0

      228     5734                      %LOCK (G#=NI_MFGATE);

   5735  1 000244   000004 630600 2                  EPPR0 ! 4
         1 000245   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000246   000000 701200 xent               TSX1  ! HFC$LOCK
         1 000247   000000 011200                    NOP   ! 0

      229     5737    3                 B$U.MF=B$U.MF+1;

   5737  1 000250   000000 470600 xsym               LDP0  ! S$CU$
         1 000251   000006 236300                    LDQ   ! 6,,PR0
         1 000252   001000 036203                    ADLQ  ! 512,DU
         1 000253   000006 552340                    STBQ  ! 6,'40'O,PR0

      230     5738    3                 IF DCT.DFLG.CM THEN B$U.CMF=B$U.CMF+1;

   5738  1 000254   200013 471700                    LDP1  ! DCT$,,AUTO
         1 000255   100006 236300                    LDQ   ! 6,,PR1
         1 000256   100000 316207                    CANQ  ! 32768,DL
         1 000257   000263 600200 1                  TZE   ! s:5740

   5738  1 000260   000007 236300                    LDQ   ! 7,,PR0
         1 000261   000001 036207                    ADLQ  ! 1,DL
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:37   
         1 000262   000007 752301                    STCQ  ! 7,'01'O,PR0

      231     5739                      %UNLOCK (G#=NI_MFGATE);

   5740  1 000263   000004 630600 2                  EPPR0 ! 4
         1 000264   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000265   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 000266   000000 011200                    NOP   ! 0

      232     5742    4                 IF DCB$ ~= ADDR(NIL) THEN DO;

   5742  1 000267   200012 236300                    LDQ   ! DCB$,,AUTO
         1 000270   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 000271   000331 600200 1                  TZE   ! s:5756

      233     5743                         %LOCK (G#=F_DCBLOCK);

   5744  1 000272   000005 630600 2                  EPPR0 ! 5
         1 000273   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000274   000000 701200 xent               TSX1  ! HFC$LOCK
         1 000275   000000 011200                    NOP   ! 0

      234     5746    4                    IF N$REQ.NWIO=0 THEN

   5746  1 000276   200003 470700                    LDP0  ! @N$REQ,,AUTO
         1 000277   000031 236300                    LDQ   ! 25,,PR0
         1 000300   400000 316207                    CANQ  ! -131072,DL
         1 000301   000314 601200 1                  TNZ   ! s:5749

      235     5747    4                       DCB$->F$DCB.FCN.CNT(0)=DCB$->F$DCB.FCN.CNT(0)+1;

   5747  1 000302   200012 471700                    LDP1  ! DCB$,,AUTO
         1 000303   100074 236300                    LDQ   ! 60,,PR1
         1 000304   000033 772200                    QRL   ! 27
         1 000305   000377 376207                    ANQ   ! 255,DL
         1 000306   000001 036207                    ADLQ  ! 1,DL
         1 000307   000033 736200                    QLS   ! 27
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:38   
         1 000310   100074 676300                    ERQ   ! 60,,PR1
         1 000311   377000 376203                    ANQ   ! 130560,DU
         1 000312   100074 656300                    ERSQ  ! 60,,PR1
         1 000313   000325 710200 1                  TRA   ! s:5751

      236     5748    4                    ELSE
      237     5749    4                       DCB$->F$DCB.FCN.CNT(1)=DCB$->F$DCB.FCN.CNT(1)+1;

   5749  1 000314   200012 471700                    LDP1  ! DCB$,,AUTO
         1 000315   100074 236300                    LDQ   ! 60,,PR1
         1 000316   000022 772200                    QRL   ! 18
         1 000317   000377 376207                    ANQ   ! 255,DL
         1 000320   000001 036207                    ADLQ  ! 1,DL
         1 000321   000022 736200                    QLS   ! 18
         1 000322   100074 676300                    ERQ   ! 60,,PR1
         1 000323   000377 376203                    ANQ   ! 255,DU
         1 000324   100074 656300                    ERSQ  ! 60,,PR1

      238     5750                         %UNLOCK (G#=F_DCBLOCK);

   5751  1 000325   000005 630600 2                  EPPR0 ! 5
         1 000326   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000327   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 000330   000000 011200                    NOP   ! 0

      239     5753    4                    END;

      240     5754    3                 END;

      241     5755    2              END;

      242     5756    2           DO CASE(DCT.RESCOD);

   5756  1 000331   200013 470500                    LDP0    DCT$,,AUTO
         1 000332   000006 720100                    LXL0    6,,PR0
         1 000333   000017 360003                    ANX0    15,DU
         1 000334   000005 100003                    CMPX0   5,DU
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:39   
         1 000335   000337 602010 1                  TNC     s:5756+6,X0
         1 000336   002201 710000 1                  TRA     s:6108
         1 000337   000344 710000 1                  TRA     s:5758
         1 000340   002201 710000 1                  TRA     s:6108
         1 000341   002201 710000 1                  TRA     s:6108
         1 000342   002115 710000 1                  TRA     s:6086
         1 000343   002135 710000 1                  TRA     s:6097

      243     5757    2            CASE(NK_NCOM);

      244     5758    3              IF DCT.CTYP ~= %C_APC THEN DO;

   5758  1 000344   000007 236100                    LDQ     7,,PR0
         1 000345   070000 376003                    ANQ     28672,DU
         1 000346   030000 116003                    CMPQ    12288,DU
         1 000347   000416 600000 1                  TZE     s:5775

      245     5759    4                 IF NOT N$REQ.IOFLG.IOS THEN DO;

   5759  1 000350   200003 471500                    LDP1    @N$REQ,,AUTO
         1 000351   100004 236100                    LDQ     4,,PR1
         1 000352   040000 316007                    CANQ    16384,DL
         1 000353   000373 601000 1                  TNZ     s:5766

      246     5760    4                    CALL NIQ$GETS(N$REQ.IOS$) ALTRET(NQPKTS);

   5760  1 000354   200003 236100                    LDQ     @N$REQ,,AUTO
         1 000355   000012 036003                    ADLQ    10,DU
         1 000356   200040 756100                    STQ     TDCW$+1,,AUTO
         1 000357   200040 630500                    EPPR0   TDCW$+1,,AUTO
         1 000360   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000361   000000 701000 xent               TSX1    NIQ$GETS
         1 000362   002240 702000 1                  TSX2    NQPKTS

      247     5761    4                    IOS$=N$REQ.IOS$;

   5761  1 000363   200003 470500                    LDP0    @N$REQ,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:40   
         1 000364   000012 236100                    LDQ     10,,PR0
         1 000365   200017 756100                    STQ     IOS$,,AUTO

      248     5762    4                    MBX$=PINCRW(IOS$,%IMX_MBX_OFFSET);

   5762  1 000366   000010 036003                    ADLQ    8,DU
         1 000367   200020 756100                    STQ     MBX$,,AUTO

      249     5763    4                    N$REQ.IOFLG.IOS='1'B;

   5763  1 000370   040000 236007                    LDQ     16384,DL
         1 000371   000004 256100                    ORSQ    4,,PR0

      250     5764    4                    END;

   5764  1 000372   000416 710000 1                  TRA     s:5775

      251     5765    4                 ELSE DO;

      252     5766    4                    IOS$=N$REQ.IOS$;

   5766  1 000373   100012 236100                    LDQ     10,,PR1
         1 000374   200017 756100                    STQ     IOS$,,AUTO

      253     5767    4                    PNTR$=NI$REQ.FL$;

   5767  1 000375   200017 473500                    LDP3    IOS$,,AUTO
         1 000376   300000 236100                    LDQ     0,,PR3
         1 000377   200022 756100                    STQ     PNTR$,,AUTO

      254     5768    4                    NI$REQ=NI$REQ_INIT;

   5768  1 000400   000100 100400                    MLR     fill='000'O
         1 000401   000000 000070 xsym               ADSC9   NI$REQ_INIT              cn=0,n=56
         1 000402   300000 000070                    ADSC9   0,,PR3                   cn=0,n=56

      255     5769    4                    MBX$=PINCRW(IOS$,%IMX_MBX_OFFSET);
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:41   

   5769  1 000403   200017 236100                    LDQ     IOS$,,AUTO
         1 000404   000010 036003                    ADLQ    8,DU
         1 000405   200020 756100                    STQ     MBX$,,AUTO

      256     5770    4                    IF HW_IMX THEN

   5770  1 000406   000000 234000 xsym               SZN     HW_IMX
         1 000407   000414 605000 1                  TPL     s:5772

      257     5771    4                       NI$IMXMBX=NI$IMXMBX_INIT;

   5771  1 000410   200020 474500                    LDP4    MBX$,,AUTO
         1 000411   000100 100400                    MLR     fill='000'O
         1 000412   000000 000140 xsym               ADSC9   NI$IMXMBX_INIT           cn=0,n=96
         1 000413   400000 000140                    ADSC9   0,,PR4                   cn=0,n=96

      258     5772    4                    NI$REQ.FL$=PNTR$;

   5772  1 000414   200022 236100                    LDQ     PNTR$,,AUTO
         1 000415   300000 756100                    STQ     0,,PR3

      259     5773    4                    END;

      260     5774    3                 END;

      261     5775    2              N$REQ.ERRCT=0;

   5775  1 000416   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000417   000000 236003                    LDQ     0,DU
         1 000420   000003 552140                    STBQ    3,'40'O,PR0

      262     5776    2              IF N$REQ.FC=%N_WRBIN AND DCT.DFLG.CHECKWRITE THEN N$REQ.FC=%N_WRCMP;

   5776  1 000421   000003 236100                    LDQ     3,,PR0
         1 000422   000777 376007                    ANQ     511,DL
         1 000423   000003 116007                    CMPQ    3,DL
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:42   
         1 000424   000433 601000 1                  TNZ     s:5777
         1 000425   200013 471500                    LDP1    DCT$,,AUTO
         1 000426   100006 236100                    LDQ     6,,PR1
         1 000427   000040 316007                    CANQ    32,DL
         1 000430   000433 600000 1                  TZE     s:5777

   5776  1 000431   000007 236007                    LDQ     7,DL
         1 000432   000003 552104                    STBQ    3,'04'O,PR0

      263     5777    2              IF N$REQ.FC>%N_MLFC THEN

   5777  1 000433   000003 236100                    LDQ     3,,PR0
         1 000434   000777 376007                    ANQ     511,DL
         1 000435   000035 116007                    CMPQ    29,DL
         1 000436   000441 602000 1                  TNC     s:5780

      264     5778    2                 FUNC='0'B;

   5778  1 000437   200016 450100                    STZ     FUNC,,AUTO
         1 000440   000446 710000 1                  TRA     s:5781

      265     5779    2              ELSE
      266     5780    2                 FUNC=DVT.IDCW(N$REQ.FC);

   5780  1 000441   000003 720100                    LXL0    3,,PR0
         1 000442   000777 360003                    ANX0    511,DU
         1 000443   200015 471500                    LDP1    DVT$,,AUTO
         1 000444   100062 236110                    LDQ     50,X0,PR1
         1 000445   200016 756100                    STQ     FUNC,,AUTO

      267     5781    2              DCWX=0;

   5781  1 000446   200014 450100                    STZ     DCWX,,AUTO

      268     5782    2              RTN=FUNC.RTN;

   5782  1 000447   200016 236100                    LDQ     FUNC,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:43   
         1 000450   000030 772000                    QRL     24
         1 000451   000077 376007                    ANQ     63,DL
         1 000452   200027 756100                    STQ     RTN,,AUTO

      269     5783    2              FUNC.DVN=DCT.DVN;

   5783  1 000453   200013 471500                    LDP1    DCT$,,AUTO
         1 000454   100007 236100                    LDQ     7,,PR1
         1 000455   200016 752120                    STCQ    FUNC,'20'O,AUTO

      270     5784    2              IF FUNC.TIMO~=0 THEN N$REQ.TIMOUT=FUNC.TIMO;

   5784  1 000456   200016 236100                    LDQ     FUNC,,AUTO
         1 000457   770000 316007                    CANQ    -4096,DL
         1 000460   000464 600000 1                  TZE     s:5785

   5784  1 000461   770000 376007                    ANQ     -4096,DL
         1 000462   000006 736000                    QLS     6
         1 000463   000003 552120                    STBQ    3,'20'O,PR0

      271     5785    2              SEEK$=ADDR(NI$REQ.SEEK);

   5785  1 000464   200017 236100                    LDQ     IOS$,,AUTO
         1 000465   000014 036003                    ADLQ    12,DU
         1 000466   200031 756100                    STQ     SEEK$,,AUTO

      272     5786    2              PSIA=DCT.DFLG.PSIA;

   5786  1 000467   100006 236100                    LDQ     6,,PR1
         1 000470   000027 736000                    QLS     23
         1 000471   400000 376003                    ANQ     -131072,DU
         1 000472   200023 756100                    STQ     PSIA,,AUTO

      273     5787    2              NOBUF=(FUNC.CCB & %CC_NOBUF) ~= '0'B;

   5787  1 000473   200016 236100                    LDQ     FUNC,,AUTO
         1 000474   000030 736000                    QLS     24
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:44   
         1 000475   770000 376003                    ANQ     -4096,DU
         1 000476   020000 376003                    ANQ     8192,DU
         1 000477   400000 220003                    LDX0    -131072,DU
         1 000500   000000 116003                    CMPQ    0,DU
         1 000501   000503 601000 1                  TNZ     s:5787+8
         1 000502   000000 220003                    LDX0    0,DU
         1 000503   000000 636010                    EAQ     0,X0
         1 000504   200021 756100                    STQ     NOBUF,,AUTO

      274     5788    3              DO CASE(RTN);

   5788  1 000505   200027 235100                    LDA     RTN,,AUTO
         1 000506   000033 115007                    CMPA    27,DL
         1 000507   000511 602005 1                  TNC     s:5788+4,AL
         1 000510   001775 710000 1                  TRA     s:6064
         1 000511   000544 710000 1                  TRA     s:5790
         1 000512   000556 710000 1                  TRA     s:5799
         1 000513   001444 710000 1                  TRA     RTN_STD0
         1 000514   000572 710000 1                  TRA     s:5824
         1 000515   000777 710000 1                  TRA     s:5871
         1 000516   001017 710000 1                  TRA     s:5878
         1 000517   001030 710000 1                  TRA     s:5882
         1 000520   001034 710000 1                  TRA     s:5885
         1 000521   001034 710000 1                  TRA     s:5885
         1 000522   001041 710000 1                  TRA     s:5887
         1 000523   001062 710000 1                  TRA     s:5893
         1 000524   001072 710000 1                  TRA     s:5896
         1 000525   001104 710000 1                  TRA     s:5900
         1 000526   001120 710000 1                  TRA     s:5905
         1 000527   001130 710000 1                  TRA     s:5908
         1 000530   001176 710000 1                  TRA     s:5925
         1 000531   001222 710000 1                  TRA     s:5932
         1 000532   001222 710000 1                  TRA     s:5932
         1 000533   001232 710000 1                  TRA     s:5935
         1 000534   001260 710000 1                  TRA     s:5945
         1 000535   001260 710000 1                  TRA     s:5945
         1 000536   001241 710000 1                  TRA     s:5938
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:45   
         1 000537   001241 710000 1                  TRA     s:5938
         1 000540   001775 710000 1                  TRA     s:6064
         1 000541   001657 710000 1                  TRA     s:6038
         1 000542   000565 710000 1                  TRA     s:5803
         1 000543   001713 710000 1                  TRA     s:6049

      275     5789    3               CASE(%BITBIN(RTN_BADFC));

      276     5790    3                 CALL SC_NIOBADFC;

   5790  1 000544   000000 713400 xsym               CLIMB   SC_NIOBADFC
         1 000545   000000 600000 xsid               climb   nvectors=         0

      277     5791        /*S* SCREECH_CODE: NIO-S$BADFC-7
      278     5792             TYPE: SCREECH
      279     5793             MESSAGE: THE SUPPLIED FUNCTION CODE IS NOT LEGAL FOR THIS DEVICE
      280     5794        */
      281     5795    3                 N$REQ.TYC.IOERR='1'B;

   5795  1 000546   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000547   001000 236003                    LDQ     512,DU
         1 000550   000021 256100                    ORSQ    17,,PR0

      282     5796    3                 CALL NIO$COMP(N$REQ);

   5796  1 000551   200003 630500                    EPPR0   @N$REQ,,AUTO
         1 000552   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000553   000000 701000 xent               TSX1    NIO$COMP
         1 000554   000000 011000                    NOP     0

      283     5797    3                 RETURN;

   5797  1 000555   000000 702200 xent               TSX2  ! X66_ARET

      284     5798    3               CASE(%BITBIN(RTN_BADFC_IOERR));

      285     5799    3                 N$REQ.TYC.IOERR='1'B;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:46   

   5799  1 000556   001000 236003                    LDQ     512,DU
         1 000557   000021 256100                    ORSQ    17,,PR0

      286     5800    3                 CALL NIO$COMP(N$REQ);

   5800  1 000560   200003 630500                    EPPR0   @N$REQ,,AUTO
         1 000561   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000562   000000 701000 xent               TSX1    NIO$COMP
         1 000563   000000 011000                    NOP     0

      287     5801    3                 RETURN;

   5801  1 000564   000000 702200 xent               TSX2  ! X66_ARET

      288     5802    3               CASE(%BITBIN(RTN_BADFC_IGNORE));

      289     5803    3                 CALL NIO$COMP(N$REQ);

   5803  1 000565   200003 630500                    EPPR0   @N$REQ,,AUTO
         1 000566   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000567   000000 701000 xent               TSX1    NIO$COMP
         1 000570   000000 011000                    NOP     0

      290     5804    3                 RETURN;

   5804  1 000571   000000 702200 xent               TSX2  ! X66_ARET

      291     5805    3               CASE(%BITBIN(RTN_DCWLIST));

      292     5806        /**/
      293     5807        /**/
      294     5808        /*  The DCWLIST function code requires that the buffer begin on a
      295     5809            doubleword bound and that word 0 of the buffer be an IDCW.  The
      296     5810            device number of this IDCW will be filled in from the DCT.  All
      297     5811            other IDCWs in the DCW list should have a device number of 0.
      298     5812            If the required conditions are not met an IOERR is returned without
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:47   
      299     5813            attempting to execute the request.  No changes to user programs
      300     5814            supplying DCW lists are required to support the IMX.  This code
      301     5815            modifies IDCWs and TDCWs to include the IMX base word references.
      302     5816            However, because TDCWs must be modified for the IMX, the following
      303     5817            restriction must be applied:  no TDCWs can follow the last IDCW.
      304     5818            (This is because DCWs may or may not follow the last IDCW, so it
      305     5819            is impossible to find the end of the DCW list unless tables of all
      306     5820            possible instructions exist which show whether or not a DCW is
      307     5821            required.)                                                        */
      308     5822        /**/
      309     5823        /**/
      310     5824    4                 IF BUFVIRT.BYT~=0 OR N$REQ.BUF$->IDCW.SVN~=7 THEN DO;

   5824  1 000572   200004 236100                    LDQ     BUFADDR,,AUTO
         1 000573   000007 316007                    CANQ    7,DL
         1 000574   000602 601000 1                  TNZ     s:5825
         1 000575   000005 473500                    LDP3    5,,PR0
         1 000576   300000 236100                    LDQ     0,,PR3
         1 000577   700000 376007                    ANQ     -32768,DL
         1 000600   700000 116007                    CMPQ    -32768,DL
         1 000601   000611 600000 1                  TZE     s:5829

      311     5825    4                    N$REQ.TYC.IOERR='1'B;

   5825  1 000602   001000 236003                    LDQ     512,DU
         1 000603   000021 256100                    ORSQ    17,,PR0

      312     5826    4                    CALL NIO$COMP(N$REQ);

   5826  1 000604   200003 630500                    EPPR0   @N$REQ,,AUTO
         1 000605   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000606   000000 701000 xent               TSX1    NIO$COMP
         1 000607   000000 011000                    NOP     0

      313     5827    4                    RETURN;

   5827  1 000610   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:48   

      314     5828    4                    END;
      315     5829    3                 X=0;

   5829  1 000611   200034 450100                    STZ     X,,AUTO

      316     5830    3                 CONT='1'B;

   5830  1 000612   400000 236003                    LDQ     -131072,DU
         1 000613   200010 756100                    STQ     CONT,,AUTO

      317     5831    4                 DO WHILE(CONT);

   5831  1 000614   200010 234100                    SZN     CONT,,AUTO
         1 000615   000703 605000 1                  TPL     s:5850

      318     5832    4                    PNTR$=PINCRW(N$REQ.BUF$,X);

   5832  1 000616   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000617   000005 471500                    LDP1    5,,PR0
         1 000620   200034 720100                    LXL0    X,,AUTO
         1 000621   100000 633510                    EPPR3   0,X0,PR1
         1 000622   200022 453500                    STP3    PNTR$,,AUTO

      319     5833    5                    IF PNTR$->IDCW.SVN=7 THEN DO;

   5833  1 000623   300000 236100                    LDQ     0,,PR3
         1 000624   700000 376007                    ANQ     -32768,DL
         1 000625   700000 116007                    CMPQ    -32768,DL
         1 000626   000647 601000 1                  TNZ     s:5840

      320     5834    5                       PNTR$->IDCW.DVN=DCT.DVN;

   5834  1 000627   200013 474500                    LDP4    DCT$,,AUTO
         1 000630   400007 236100                    LDQ     7,,PR4
         1 000631   300000 752120                    STCQ    0,'20'O,PR3

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:49   
      321     5835    5                       IF HW_IMX THEN

   5835  1 000632   000000 234000 xsym               SZN     HW_IMX
         1 000633   000641 605000 1                  TPL     s:5837

      322     5836    5                          PNTR$->IDCW.DATA.BASE=BUF_BASE;

   5836  1 000634   200007 236100                    LDQ     BUF_BASE,,AUTO
         1 000635   000025 736000                    QLS     21
         1 000636   300000 676100                    ERQ     0,,PR3
         1 000637   000030 376003                    ANQ     24,DU
         1 000640   300000 656100                    ERSQ    0,,PR3

      323     5837    5                       CONT=PNTR$->IDCW.CONT;

   5837  1 000641   300000 236100                    LDQ     0,,PR3
         1 000642   000026 736000                    QLS     22
         1 000643   400000 376003                    ANQ     -131072,DU
         1 000644   200010 756100                    STQ     CONT,,AUTO

      324     5838    5                       X=X+1;

   5838  1 000645   200034 054100                    AOS     X,,AUTO

      325     5839    5                       END;

   5839  1 000646   000674 710000 1                  TRA     s:5848

      326     5840    5                    ELSE DO CASE(PNTR$->DCW.TYPE);

   5840  1 000647   300000 236100                    LDQ     0,,PR3
         1 000650   000014 772000                    QRL     12
         1 000651   000007 376007                    ANQ     7,DL
         1 000652   000003 116007                    CMPQ    3,DL
         1 000653   000655 602006 1                  TNC     s:5840+6,QL
         1 000654   000673 710000 1                  TRA     s:5846
         1 000655   000673 710000 1                  TRA     s:5846
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:50   
         1 000656   000673 710000 1                  TRA     s:5846
         1 000657   000660 710000 1                  TRA     s:5842

      327     5841    5                     CASE(%DCW_TDCW);

      328     5842    5                      X=PNTR$->DCW.FWA; /*N* IOM bug? how about X=FWA-BUFVIRT.BASE? */

   5842  1 000660   300000 236100                    LDQ     0,,PR3
         1 000661   000022 772000                    QRL     18
         1 000662   200034 756100                    STQ     X,,AUTO

      329     5843    5                       IF HW_IMX THEN

   5843  1 000663   000000 234000 xsym               SZN     HW_IMX
         1 000664   000674 605000 1                  TPL     s:5848

      330     5844    5                          PNTR$->DCW.T.DCWLIST.BASE=BUF_BASE;

   5844  1 000665   200007 236100                    LDQ     BUF_BASE,,AUTO
         1 000666   000006 736000                    QLS     6
         1 000667   300000 676100                    ERQ     0,,PR3
         1 000670   000300 376007                    ANQ     192,DL
         1 000671   300000 656100                    ERSQ    0,,PR3
         1 000672   000674 710000 1                  TRA     s:5848

      331     5845    5                     CASE(ELSE);

      332     5846    5                       X=X+1;

   5846  1 000673   200034 054100                    AOS     X,,AUTO

      333     5847    5                     END;

      334     5848    4                    IF X>=BUFSIZE/4 THEN CONT='0'B;

   5848  1 000674   200006 236100                    LDQ     BUFSIZE,,AUTO
         1 000675   000004 506007                    DIV     4,DL
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:51   
         1 000676   200034 116100                    CMPQ    X,,AUTO
         1 000677   000701 605400 1                  TPNZ    s:5849

   5848  1 000700   200010 450100                    STZ     CONT,,AUTO

      335     5849    4                    END;

   5849  1 000701   200010 234100                    SZN     CONT,,AUTO
         1 000702   000616 604000 1                  TMI     s:5832

      336     5850    4                 IF NOT PSIA THEN DO;

   5850  1 000703   200023 234100                    SZN     PSIA,,AUTO
         1 000704   000714 604000 1                  TMI     s:5854

      337     5851    4                    NI$REQ.PCW=N$REQ.BUF$->IDCW;

   5851  1 000705   000005 471500                    LDP1    5,,PR0
         1 000706   100000 235100                    LDA     0,,PR1
         1 000707   000000 236003                    LDQ     0,DU
         1 000710   200017 473500                    LDP3    IOS$,,AUTO
         1 000711   300012 757100                    STAQ    10,,PR3

      338     5852    4                    NI$REQ.PCW.FLAGS='600'O;

   5852  1 000712   000600 236007                    LDQ     384,DL
         1 000713   300013 552104                    STBQ    11,'04'O,PR3

      339     5853    4                    END;

      340     5854    3                 N$REQ.IOFLG.LPW23='0'B;   /* REAL DCW, REAL LPW */

   5854  1 000714   000006 236000 2                  LDQ     6
         1 000715   000004 356100                    ANSQ    4,,PR0

      341     5855    3                 IF HW_IOP THEN

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:52   
   5855  1 000716   000000 234000 xsym               SZN     HW_IOP
         1 000717   000726 605000 1                  TPL     s:5857

      342     5856    3                    NI$REQ.IOP_PTAW=BINBIT(PTP,27)|%IOP_PTA1_INIT; /* PHYSADDR */

   5856  1 000720   200024 236100                    LDQ     PTP,,AUTO
         1 000721   000011 736000                    QLS     9
         1 000722   000000 276000 0                  ORQ     0
         1 000723   200017 471500                    LDP1    IOS$,,AUTO
         1 000724   100001 756100                    STQ     1,,PR1
         1 000725   000734 710000 1                  TRA     s:5859

      343     5857    3                 ELSE IF NOT HW_IMX THEN

   5857  1 000726   000000 234000 xsym               SZN     HW_IMX
         1 000727   000734 604000 1                  TMI     s:5859

      344     5858    3                       NI$REQ.PCW.PTP=PTP;

   5858  1 000730   200017 471500                    LDP1    IOS$,,AUTO
         1 000731   200024 236100                    LDQ     PTP,,AUTO
         1 000732   000011 736000                    QLS     9
         1 000733   100013 552130                    STBQ    11,'30'O,PR1

      345     5859    3                 N$REQ.LPWX.BASE=BUFVIRT.BASE;

   5859  1 000734   200004 236100                    LDQ     BUFADDR,,AUTO
         1 000735   000003 772000                    QRL     3
         1 000736   000000 620006                    EAX0    0,QL
         1 000737   000011 740100                    STX0    9,,PR0

      346     5860    3                 N$REQ.LPWX.BOUND=(BUFSIZE+3)/4;

   5860  1 000740   200006 236100                    LDQ     BUFSIZE,,AUTO
         1 000741   000003 036007                    ADLQ    3,DL
         1 000742   000004 506007                    DIV     4,DL
         1 000743   000000 621006                    EAX1    0,QL
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:53   
         1 000744   000011 441100                    SXL1    9,,PR0

      347     5861    4                 IF HW_IMX THEN DO;

   5861  1 000745   000000 234000 xsym               SZN     HW_IMX
         1 000746   000760 605000 1                  TPL     s:5866

      348     5862    4                    NI$REQ.DCW(0)=%TDCWM1;

   5862  1 000747   000001 236000 0                  LDQ     1
         1 000750   200017 471500                    LDP1    IOS$,,AUTO
         1 000751   100002 756100                    STQ     2,,PR1

      349     5863    4                    NI$REQ.DCW.T.DCWLIST.BASE(0)=BUF_BASE;

   5863  1 000752   200007 236100                    LDQ     BUF_BASE,,AUTO
         1 000753   000006 736000                    QLS     6
         1 000754   100002 676100                    ERQ     2,,PR1
         1 000755   000300 376007                    ANQ     192,DL
         1 000756   100002 656100                    ERSQ    2,,PR1

      350     5864    4                    END;

   5864  1 000757   001775 710000 1                  TRA     s:6064

      351     5865    4                 ELSE DO;

      352     5866    4                    NI$REQ.DCW(0)=%TDCWM4;

   5866  1 000760   000002 236000 0                  LDQ     2
         1 000761   200017 471500                    LDP1    IOS$,,AUTO
         1 000762   100002 756100                    STQ     2,,PR1

      353     5867                         /*N* IOM EVIDENTLY DOESN'T USE LPWX FOR DCWLIST */
      354     5868    4                    NI$REQ.DCW.FWA(0)=BUFREAL.ADR+BITBIN(~PSIA);

   5868  1 000763   200023 236100                    LDQ     PSIA,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:54   
         1 000764   400000 376003                    ANQ     -131072,DU
         1 000765   400000 676003                    ERQ     -131072,DU
         1 000766   000043 772000                    QRL     35
         1 000767   200040 756100                    STQ     TDCW$+1,,AUTO
         1 000770   200004 236100                    LDQ     BUFADDR,,AUTO
         1 000771   000002 772000                    QRL     2
         1 000772   777777 376007                    ANQ     -1,DL
         1 000773   200040 036100                    ADLQ    TDCW$+1,,AUTO
         1 000774   000000 620006                    EAX0    0,QL
         1 000775   100002 740100                    STX0    2,,PR1

      355     5869    4                    END;

   5869  1 000776   001775 710000 1                  TRA     s:6064

      356     5870    3               CASE(%BITBIN(RTN_WRSYMB));

      357     5871    3                 N$REQ.ARCT = N$REQ.RCT;

   5871  1 000777   000030 720100                    LXL0    24,,PR0
         1 001000   000030 740100                    STX0    24,,PR0

      358     5872    3                 CALL NIU$SYMBLOCK(N$REQ,FUNC) ALTRET(COMP);

   5872  1 001001   200016 633500                    EPPR3   FUNC,,AUTO
         1 001002   200041 453500                    STP3    TDCW$+2,,AUTO
         1 001003   200003 236100                    LDQ     @N$REQ,,AUTO
         1 001004   200040 756100                    STQ     TDCW$+1,,AUTO
         1 001005   200040 630500                    EPPR0   TDCW$+1,,AUTO
         1 001006   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001007   000000 701000 xent               TSX1    NIU$SYMBLOCK
         1 001010   001012 702000 1                  TSX2    COMP

      359     5873    4                 DO WHILE('0'B);           /* DO NEVER */

   5873  1 001011   001775 710000 1                  TRA     s:6064

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:55   
      360     5874    4   COMP:            CALL NIO$COMP(N$REQ);

   5874  1 001012   200003 630500       COMP         EPPR0   @N$REQ,,AUTO
         1 001013   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001014   000000 701000 xent               TSX1    NIO$COMP
         1 001015   000000 011000                    NOP     0

      361     5875    4                    RETURN;

   5875  1 001016   000000 702200 xent               TSX2  ! X66_ARET

      362     5876    4                    END;                   /* DO NEVER */

      363     5877    3               CASE(%BITBIN(RTN_SC_RDPRMPT));

      364     5878    3                 NI$REQ.SEEK='000015012000'O;

   5878  1 001017   000003 236000 0                  LDQ     3
         1 001020   200017 473500                    LDP3    IOS$,,AUTO
         1 001021   300014 756100                    STQ     12,,PR3

      365     5879    3                 SEEK$->ONECHAR(3)=N$REQ.BUF$->ONECHAR(0);

   5879  1 001022   000005 474500                    LDP4    5,,PR0
         1 001023   200031 475500                    LDP5    SEEK$,,AUTO
         1 001024   040100 100500                    MLR     fill='040'O
         1 001025   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
         1 001026   500000 600001                    ADSC9   0,,PR5                   cn=3,n=1

      366     5880    3                 GOTO RTN_DP_SEEK;

   5880  1 001027   001271 710000 1                  TRA     RTN_DP_SEEK

      367     5881    3               CASE(%BITBIN(RTN_SC_WRCRLF));

      368     5882    3                 NI$REQ.SEEK='000000015012'O;

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:56   
   5882  1 001030   000004 236000 0                  LDQ     4
         1 001031   200017 473500                    LDP3    IOS$,,AUTO
         1 001032   300014 756100                    STQ     12,,PR3

      369     5883    3                 GOTO RTN_DP_SEEK;

   5883  1 001033   001271 710000 1                  TRA     RTN_DP_SEEK

      370     5884    3               CASE(%BITBIN(RTN_CR_EXTST),%BITBIN(RTN_CP_EXTST));

      371     5885    3                 CALL NIU$CRPEXTST(N$REQ) ALTRET(NQPKTS);

   5885  1 001034   200003 630500                    EPPR0   @N$REQ,,AUTO
         1 001035   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001036   000000 701000 xent               TSX1    NIU$CRPEXTST
         1 001037   002240 702000 1                  TSX2    NQPKTS
         1 001040   001775 710000 1                  TRA     s:6064

      372     5886    3               CASE(%BITBIN(RTN_CP_WRFM));

      373     5887    3                 NI$REQ.SEEK='041105117104'O; /* !EOD */

   5887  1 001041   000005 236000 0                  LDQ     5
         1 001042   200017 473500                    LDP3    IOS$,,AUTO
         1 001043   300014 756100                    STQ     12,,PR3

      374     5888    3                 NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWBITS;

   5888  1 001044   200016 236100                    LDQ     FUNC,,AUTO
         1 001045   000006 376000 0                  ANQ     6
         1 001046   000007 276000 0                  ORQ     7
         1 001047   300002 756100                    STQ     2,,PR3

      375     5889    3                 IF HW_IMX THEN

   5889  1 001050   000000 234000 xsym               SZN     HW_IMX
         1 001051   001055 605000 1                  TPL     s:5891
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:57   

      376     5890    3                    NI$REQ.IDCW.DATA.BASE(0)=%IMX_IOS_BASE;

   5890  1 001052   000007 376000 2                  ANQ     7
         1 001053   000020 276003                    ORQ     16,DU
         1 001054   300002 756100                    STQ     2,,PR3

      377     5891    3                 NI$REQ.DCW(1)=BINBIT((SEEK.WA*%BITBIN('1000000'O))+1,36);

   5891  1 001055   200031 236100                    LDQ     SEEK$,,AUTO
         1 001056   777777 376003                    ANQ     -1,DU
         1 001057   000001 036007                    ADLQ    1,DL
         1 001060   300003 756100                    STQ     3,,PR3
         1 001061   001775 710000 1                  TRA     s:6064

      378     5892    3               CASE(%BITBIN(RTN_CP_WRITE));

      379     5893    3                 IF N$REQ.DVE.DVBYTE & %DVBYTE_BIN# THEN FUNC.DC=FUNC.DC2;

   5893  1 001062   000031 236100                    LDQ     25,,PR0
         1 001063   777000 376003                    ANQ     -512,DU
         1 001064   040000 376003                    ANQ     16384,DU
         1 001065   001071 600000 1                  TZE     s:5894

   5893  1 001066   200016 236100                    LDQ     FUNC,,AUTO
         1 001067   000014 736000                    QLS     12
         1 001070   200016 752140                    STCQ    FUNC,'40'O,AUTO

      380     5894    3                 GOTO RTN_STD0;

   5894  1 001071   001444 710000 1                  TRA     RTN_STD0

      381     5895    3               CASE(%BITBIN(RTN_LP_LDCHAIN));

      382     5896    3                 CSIZE=60*4;

   5896  1 001072   000360 235007                    LDA     240,DL
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:58   
         1 001073   200011 755100                    STA     CSIZE,,AUTO

      383     5897    3                 DCT.LP.CHAIN$->CHARBASE=N$REQ.BUF$->CHARBASE;

   5897  1 001074   100032 473500                    LDP3    26,,PR1
         1 001075   000005 474500                    LDP4    5,,PR0
         1 001076   000000 620005                    EAX0    0,AL
         1 001077   200011 721100                    LXL1    CSIZE,,AUTO
         1 001100   040140 100540                    MLR     fill='040'O
         1 001101   400000 000010                    ADSC9   0,,PR4                   cn=0,n=*X0
         1 001102   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1

      384     5898    3                 GOTO RTN_STD0;

   5898  1 001103   001444 710000 1                  TRA     RTN_STD0

      385     5899    3               CASE(%BITBIN(RTN_LP_LDVFC));

      386     5900    3                 CSIZE=N$REQ.BUFSIZE;

   5900  1 001104   000004 236100                    LDQ     4,,PR0
         1 001105   000020 772000                    QRL     16
         1 001106   200011 756100                    STQ     CSIZE,,AUTO

      387     5901    3                 DCT.LP.VFCL=N$REQ.BUFSIZE/4;

   5901  1 001107   000002 772000                    QRL     2
         1 001110   100031 756100                    STQ     25,,PR1

      388     5902    3                 DCT.LP.VFC$->CHARBASE=N$REQ.BUF$->CHARBASE;

   5902  1 001111   100030 473500                    LDP3    24,,PR1
         1 001112   000005 474500                    LDP4    5,,PR0
         1 001113   200011 720100                    LXL0    CSIZE,,AUTO
         1 001114   040140 100540                    MLR     fill='040'O
         1 001115   400000 000010                    ADSC9   0,,PR4                   cn=0,n=*X0
         1 001116   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:59   

      389     5903    3                 GOTO RTN_STD0;

   5903  1 001117   001444 710000 1                  TRA     RTN_STD0

      390     5904    3               CASE(%BITBIN(RTN_LP_WRITE));

      391     5905    3                 IF N$REQ.DVE.DVBYTE & %DVBYTE_BP# THEN FUNC.DC=FUNC.DC2;

   5905  1 001120   000031 236100                    LDQ     25,,PR0
         1 001121   777000 376003                    ANQ     -512,DU
         1 001122   200000 376003                    ANQ     65536,DU
         1 001123   001127 600000 1                  TZE     s:5906

   5905  1 001124   200016 236100                    LDQ     FUNC,,AUTO
         1 001125   000014 736000                    QLS     12
         1 001126   200016 752140                    STCQ    FUNC,'40'O,AUTO

      392     5906    3                 GOTO RTN_STD0;

   5906  1 001127   001444 710000 1                  TRA     RTN_STD0

      393     5907    3               CASE(%BITBIN(RTN_MT_SPR));

      394     5908    4                 IF N$REQ.RCT<0 THEN DO;

   5908  1 001130   000030 720100                    LXL0    24,,PR0
         1 001131   001144 605000 1                  TPL     s:5913

      395     5909    4                    RCTTEMP=-N$REQ.RCT;

   5909  1 001132   000030 236100                    LDQ     24,,PR0
         1 001133   000022 736000                    QLS     18
         1 001134   000022 732000                    QRS     18
         1 001135   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 001136   000001 036007                    ADLQ    1,DL
         1 001137   200026 756100                    STQ     RCTTEMP,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:60   

      396     5910    4                    FUNC.DC=FUNC.DC2;

   5910  1 001140   200016 236100                    LDQ     FUNC,,AUTO
         1 001141   000014 736000                    QLS     12
         1 001142   200016 752140                    STCQ    FUNC,'40'O,AUTO

      397     5911    4                    END;

   5911  1 001143   001150 710000 1                  TRA     s:5915

      398     5912    4                 ELSE DO;

      399     5913    4                    RCTTEMP=N$REQ.RCT;

   5913  1 001144   000030 236100                    LDQ     24,,PR0
         1 001145   000022 736000                    QLS     18
         1 001146   000022 732000                    QRS     18
         1 001147   200026 756100                    STQ     RCTTEMP,,AUTO

      400     5914    4                    END;

      401     5915    3                 IF RCTTEMP>63 THEN

   5915  1 001150   200026 236100                    LDQ     RCTTEMP,,AUTO
         1 001151   000077 116007                    CMPQ    63,DL
         1 001152   001156 604400 1                  TMOZ    s:5918

      402     5916    3                    FUNC.RCNT=63;

   5916  1 001153   000077 236007                    LDQ     63,DL
         1 001154   200016 752101                    STCQ    FUNC,'01'O,AUTO
         1 001155   001157 710000 1                  TRA     s:5919

      403     5917    3                 ELSE
      404     5918    3                    FUNC.RCNT=RCTTEMP;

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:61   
   5918  1 001156   200016 752101                    STCQ    FUNC,'01'O,AUTO

      405     5919    3                 NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWBITS;

   5919  1 001157   200016 236100                    LDQ     FUNC,,AUTO
         1 001160   000006 376000 0                  ANQ     6
         1 001161   000007 276000 0                  ORQ     7
         1 001162   200017 473500                    LDP3    IOS$,,AUTO
         1 001163   300002 756100                    STQ     2,,PR3

      406     5920    3                 IF HW_IMX THEN            /* NO DATA ACTUALLY TRANSFERRED */

   5920  1 001164   000000 234000 xsym               SZN     HW_IMX
         1 001165   001171 605000 1                  TPL     s:5922

      407     5921    3                    NI$REQ.IDCW.DATA.BASE(0)=%IMX_IOS_BASE;

   5921  1 001166   000007 376000 2                  ANQ     7
         1 001167   000020 276003                    ORQ     16,DU
         1 001170   300002 756100                    STQ     2,,PR3

      408     5922    3                 N$REQ.IOFLG.MREC='1'B;

   5922  1 001171   010000 236007                    LDQ     4096,DL
         1 001172   000004 256100                    ORSQ    4,,PR0

      409     5923    3                 N$REQ.ARCT=0;

   5923  1 001173   000000 220003                    LDX0    0,DU
         1 001174   000030 740100                    STX0    24,,PR0
         1 001175   001775 710000 1                  TRA     s:6064

      410     5924    3               CASE(%BITBIN(RTN_MT_SPF));

      411     5925    3                 IF N$REQ.RCT<0 THEN FUNC.DC=FUNC.DC2;

   5925  1 001176   000030 720100                    LXL0    24,,PR0
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:62   
         1 001177   001203 605000 1                  TPL     s:5926

   5925  1 001200   200016 236100                    LDQ     FUNC,,AUTO
         1 001201   000014 736000                    QLS     12
         1 001202   200016 752140                    STCQ    FUNC,'40'O,AUTO

      412     5926    3                 NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWBITS;

   5926  1 001203   200016 236100                    LDQ     FUNC,,AUTO
         1 001204   000006 376000 0                  ANQ     6
         1 001205   000007 276000 0                  ORQ     7
         1 001206   200017 473500                    LDP3    IOS$,,AUTO
         1 001207   300002 756100                    STQ     2,,PR3

      413     5927    3                 IF HW_IMX THEN            /* NO DATA ACTUALLY TRANSFERRED */

   5927  1 001210   000000 234000 xsym               SZN     HW_IMX
         1 001211   001215 605000 1                  TPL     s:5929

      414     5928    3                    NI$REQ.IDCW.DATA.BASE(0)=%IMX_IOS_BASE;

   5928  1 001212   000007 376000 2                  ANQ     7
         1 001213   000020 276003                    ORQ     16,DU
         1 001214   300002 756100                    STQ     2,,PR3

      415     5929    3                 N$REQ.IOFLG.MREC='1'B;

   5929  1 001215   010000 236007                    LDQ     4096,DL
         1 001216   000004 256100                    ORSQ    4,,PR0

      416     5930    3                 N$REQ.ARCT=0;

   5930  1 001217   000000 220003                    LDX0    0,DU
         1 001220   000030 740100                    STX0    24,,PR0
         1 001221   001775 710000 1                  TRA     s:6064

      417     5931    3               CASE(%BITBIN(RTN_MT_READ),%BITBIN(RTN_MT_WRITE));
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:63   

      418     5932    3                 IF N$REQ.DVE.DVBYTE & %DVBYTE_BIN# THEN FUNC.DC=FUNC.DC2;

   5932  1 001222   000031 236100                    LDQ     25,,PR0
         1 001223   777000 376003                    ANQ     -512,DU
         1 001224   040000 376003                    ANQ     16384,DU
         1 001225   001231 600000 1                  TZE     s:5933

   5932  1 001226   200016 236100                    LDQ     FUNC,,AUTO
         1 001227   000014 736000                    QLS     12
         1 001230   200016 752140                    STCQ    FUNC,'40'O,AUTO

      419     5933    3                 GOTO RTN_STD0;

   5933  1 001231   001444 710000 1                  TRA     RTN_STD0

      420     5934    3               CASE(%BITBIN(RTN_MT_WRBYTE));

      421     5935    3                 FUNC.RCNT=MOD(BUFADDR+BUFSIZE,4)*8;

   5935  1 001232   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001233   200006 036100                    ADLQ    BUFSIZE,,AUTO
         1 001234   000004 506007                    DIV     4,DL
         1 001235   000044 733000                    LRS     36
         1 001236   000003 736000                    QLS     3
         1 001237   200016 752101                    STCQ    FUNC,'01'O,AUTO

      422     5936    3                 GOTO RTN_STD0;

   5936  1 001240   001444 710000 1                  TRA     RTN_STD0

      423     5937    3               CASE(%BITBIN(RTN_MPC_READ),%BITBIN(RTN_MPC_WRITE));

      424     5938    3                 NI$REQ.MPCSEEK.MEMADDR = N$REQ.DLA.MPC.MEMADDR;

   5938  1 001241   200017 473500                    LDP3    IOS$,,AUTO
         1 001242   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:64   
         1 001243   000024 736000                    QLS     20
         1 001244   300014 676100                    ERQ     12,,PR3
         1 001245   777774 376003                    ANQ     -4,DU
         1 001246   300014 656100                    ERSQ    12,,PR3

      425     5939    3                 NI$REQ.MPCSEEK.COUNT = (N$REQ.BUFSIZE + 1)/2;

   5939  1 001247   000004 236100                    LDQ     4,,PR0
         1 001250   000020 772000                    QRL     16
         1 001251   000001 036007                    ADLQ    1,DL
         1 001252   000001 772000                    QRL     1
         1 001253   000004 736000                    QLS     4
         1 001254   300014 676100                    ERQ     12,,PR3
         1 001255   000010 376000 2                  ANQ     8
         1 001256   300014 656100                    ERSQ    12,,PR3

      426     5940    3                 GOTO RTN_DP_SEEK;

   5940  1 001257   001271 710000 1                  TRA     RTN_DP_SEEK

      427     5941    3               CASE(%BITBIN(RTN_AP_IO));

      428     5942                                           /* Do nothing.  DCW list is already built. */
      429     5943                                           /* AP NOT CURRENTLY SUPPORTED ON IMX       */
      430     5944    3               CASE(%BITBIN(RTN_DP_SEEK),%BITBIN(RTN_DP_WRZERO));

      431     5945    3                 NI$REQ.SEEK=BINBIT(N$REQ.DLA.DRELADDR*DVT.GRANSIZE,36);

   5945  1 001260   200015 473500                    LDP3    DVT$,,AUTO
         1 001261   300053 236100                    LDQ     43,,PR3
         1 001262   000777 376007                    ANQ     511,DL
         1 001263   200040 756100                    STQ     TDCW$+1,,AUTO
         1 001264   000001 236100                    LDQ     1,,PR0
         1 001265   000011 376000 2                  ANQ     9
         1 001266   200040 402100                    MPY     TDCW$+1,,AUTO
         1 001267   200017 474500                    LDP4    IOS$,,AUTO
         1 001270   400014 756100                    STQ     12,,PR4
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:65   

      432     5946    3   RTN_DP_SEEK:  N$REQ.IOFLG.LPW23='0'B;   /* REAL DCW, REAL LPW */

   5946  1 001271   000006 236000 2     RTN_DP_SEEK  LDQ     6
         1 001272   000004 356100                    ANSQ    4,,PR0

      433     5947    4                 IF PSIA THEN DO;

   5947  1 001273   200023 234100                    SZN     PSIA,,AUTO
         1 001274   001312 605000 1                  TPL     s:5954

      434     5948    4                    NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWCONT;

   5948  1 001275   200016 236100                    LDQ     FUNC,,AUTO
         1 001276   000006 376000 0                  ANQ     6
         1 001277   000010 276000 0                  ORQ     8
         1 001300   200017 473500                    LDP3    IOS$,,AUTO
         1 001301   300002 756100                    STQ     2,,PR3

      435     5949    4                    IF HW_IMX THEN

   5949  1 001302   000000 234000 xsym               SZN     HW_IMX
         1 001303   001307 605000 1                  TPL     s:5951

      436     5950    4                       NI$REQ.IDCW.DATA.BASE(0)=%IMX_IOS_BASE;

   5950  1 001304   000007 376000 2                  ANQ     7
         1 001305   000020 276003                    ORQ     16,DU
         1 001306   300002 756100                    STQ     2,,PR3

      437     5951    4                    DCWX=1;

   5951  1 001307   000001 235007                    LDA     1,DL
         1 001310   200014 755100                    STA     DCWX,,AUTO

      438     5952    4                    END;

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:66   
   5952  1 001311   001321 710000 1                  TRA     s:5956

      439     5953    4                 ELSE DO;

      440     5954    4                    NI$REQ.PCW=(FUNC & %IDCWMASK) | %CONCAT(IDCWCONT,'000000000600'O);

   5954  1 001312   200016 236100                    LDQ     FUNC,,AUTO
         1 001313   000006 376000 0                  ANQ     6
         1 001314   000044 737000                    LLS     36
         1 001315   000000 236003                    LDQ     0,DU
         1 001316   000012 277000 0                  ORAQ    10
         1 001317   200017 473500                    LDP3    IOS$,,AUTO
         1 001320   300012 757100                    STAQ    10,,PR3

      441     5955    4                    END;

      442     5956    3                 NI$REQ.DCW(DCWX)=BINBIT(SEEK.WA*%BITBIN('1000000'O)+1,36);

   5956  1 001321   200031 236100                    LDQ     SEEK$,,AUTO
         1 001322   777777 376003                    ANQ     -1,DU
         1 001323   000001 036007                    ADLQ    1,DL
         1 001324   200014 720100                    LXL0    DCWX,,AUTO
         1 001325   300002 756110                    STQ     2,X0,PR3

      443     5957    3                 DCWX=DCWX+1;

   5957  1 001326   200014 054100                    AOS     DCWX,,AUTO

      444     5958    3                 FUNC.DC=FUNC.DC2;

   5958  1 001327   200016 236100                    LDQ     FUNC,,AUTO
         1 001330   000014 736000                    QLS     12
         1 001331   200016 752140                    STCQ    FUNC,'40'O,AUTO

      445     5959    4                 IF RTN~=%BITBIN(RTN_DP_WRZERO) THEN DO;

   5959  1 001332   200027 235100                    LDA     RTN,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:67   
         1 001333   000024 115007                    CMPA    20,DL
         1 001334   001355 600000 1                  TZE     s:5968

      446     5960    5                    IF PTP~=0 AND NOT HW_IMX THEN DO; /* DATA: REAL->PAGED */

   5960  1 001335   200024 236100                    LDQ     PTP,,AUTO
         1 001336   001354 600000 1                  TZE     s:5965
         1 001337   000000 234000 xsym               SZN     HW_IMX
         1 001340   001354 604000 1                  TMI     s:5965

      447     5961    5                       PNTR$=ADDR(NI$REQ.DCW(DCWX+1));

   5961  1 001341   200014 236100                    LDQ     DCWX,,AUTO
         1 001342   000022 736000                    QLS     18
         1 001343   000003 036003                    ADLQ    3,DU
         1 001344   200017 036100                    ADLQ    IOS$,,AUTO
         1 001345   200022 756100                    STQ     PNTR$,,AUTO

      448     5962    5                       NI$REQ.DCW(DCWX)=BINBIT(PNTR.WA,18) | %TDCWM3A;

   5962  1 001346   200022 236100                    LDQ     PNTR$,,AUTO
         1 001347   777777 376003                    ANQ     -1,DU
         1 001350   000014 276000 0                  ORQ     12
         1 001351   200014 720100                    LXL0    DCWX,,AUTO
         1 001352   300002 756110                    STQ     2,X0,PR3

      449     5963    5                       DCWX=DCWX+1;

   5963  1 001353   200014 054100                    AOS     DCWX,,AUTO

      450     5964    5                       END;

      451     5965    4                    GOTO RTN_STD;

   5965  1 001354   001446 710000 1                  TRA     RTN_STD

      452     5966    4                    END;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:68   
      453     5967    4                 ELSE DO;

      454     5968    4                    NI$REQ.IDCW(DCWX)=(FUNC & %IDCWMASK) | %IDCWBITS;

   5968  1 001355   200016 236100                    LDQ     FUNC,,AUTO
         1 001356   000006 376000 0                  ANQ     6
         1 001357   000007 276000 0                  ORQ     7
         1 001360   200014 720100                    LXL0    DCWX,,AUTO
         1 001361   300002 756110                    STQ     2,X0,PR3

      455     5969    4                    IF HW_IMX THEN

   5969  1 001362   000000 234000 xsym               SZN     HW_IMX
         1 001363   001367 605000 1                  TPL     s:5971

      456     5970    4                       NI$REQ.IDCW.DATA.BASE(DCWX)=%IMX_IOS_BASE;

   5970  1 001364   000007 376000 2                  ANQ     7
         1 001365   000020 276003                    ORQ     16,DU
         1 001366   300002 756110                    STQ     2,X0,PR3

      457     5971    4                    DCWX=DCWX+1;

   5971  1 001367   200014 054100                    AOS     DCWX,,AUTO

      458     5972    5                    DO WHILE(BUFSIZE>%(%DCWTALLYMAX*4+4));

   5972  1 001370   200006 236100                    LDQ     BUFSIZE,,AUTO
         1 001371   040004 116007                    CMPQ    16388,DL
         1 001372   001412 604400 1                  TMOZ    s:5978

      459     5973    5                       NI$REQ.DCW(DCWX)=%IONTPDCW;

   5973  1 001373   000015 236000 0                  LDQ     13
         1 001374   200017 470500                    LDP0    IOS$,,AUTO
         1 001375   200014 720100                    LXL0    DCWX,,AUTO
         1 001376   000002 756110                    STQ     2,X0,PR0
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:69   

      460     5974    5                       DCWX=DCWX+1;

   5974  1 001377   200014 054100                    AOS     DCWX,,AUTO

      461     5975    5                       BUFSIZE=BUFSIZE-%(%DCWTALLYMAX*4);

   5975  1 001400   040000 336007                    LCQ     16384,DL
         1 001401   200006 056100                    ASQ     BUFSIZE,,AUTO

      462     5976    5                       IF DCWX=%DCWXMAX THEN CALL CHAINIOS ALTRET(NQPKTS);

   5976  1 001402   200014 235100                    LDA     DCWX,,AUTO
         1 001403   000007 115007                    CMPA    7,DL
         1 001404   001407 601000 1                  TNZ     s:5977

   5976  1 001405   002307 701000 1                  TSX1    CHAINIOS
         1 001406   002240 702000 1                  TSX2    NQPKTS

      463     5977    5                       END;

   5977  1 001407   200006 235100                    LDA     BUFSIZE,,AUTO
         1 001410   040004 115007                    CMPA    16388,DL
         1 001411   001373 605400 1                  TPNZ    s:5973

      464     5978    5                    IF BUFSIZE>4 THEN DO;

   5978  1 001412   200006 235100                    LDA     BUFSIZE,,AUTO
         1 001413   000004 115007                    CMPA    4,DL
         1 001414   001432 604400 1                  TMOZ    s:5983

      465     5979    5                       NI$REQ.DCW(DCWX)=%IONTPDCW | BINBIT(BUFSIZE/4-1,36);

   5979  1 001415   200006 236100                    LDQ     BUFSIZE,,AUTO
         1 001416   000004 506007                    DIV     4,DL
         1 001417   000001 136007                    SBLQ    1,DL
         1 001420   000015 276000 0                  ORQ     13
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:70   
         1 001421   200017 470500                    LDP0    IOS$,,AUTO
         1 001422   200014 720100                    LXL0    DCWX,,AUTO
         1 001423   000002 756110                    STQ     2,X0,PR0

      466     5980    5                       DCWX=DCWX+1;

   5980  1 001424   200014 054100                    AOS     DCWX,,AUTO

      467     5981    5                       IF DCWX=%DCWXMAX THEN CALL CHAINIOS ALTRET(NQPKTS);

   5981  1 001425   200014 235100                    LDA     DCWX,,AUTO
         1 001426   000007 115007                    CMPA    7,DL
         1 001427   001432 601000 1                  TNZ     s:5983

   5981  1 001430   002307 701000 1                  TSX1    CHAINIOS
         1 001431   002240 702000 1                  TSX2    NQPKTS

      468     5982    5                       END;

      469     5983    4                    PNTR$=ADDR(NI$REQ.DCW(%DCWXMAX));

   5983  1 001432   200017 236100                    LDQ     IOS$,,AUTO
         1 001433   000011 036003                    ADLQ    9,DU
         1 001434   200022 756100                    STQ     PNTR$,,AUTO

      470     5984    4                    NI$REQ.DCW(DCWX)=BINBIT(PNTR.WA*%BITBIN('1000000'O)+1,36);

   5984  1 001435   200022 236100                    LDQ     PNTR$,,AUTO
         1 001436   777777 376003                    ANQ     -1,DU
         1 001437   000001 036007                    ADLQ    1,DL
         1 001440   200017 470500                    LDP0    IOS$,,AUTO
         1 001441   200014 720100                    LXL0    DCWX,,AUTO
         1 001442   000002 756110                    STQ     2,X0,PR0

      471     5985    4                    END;

   5985  1 001443   001775 710000 1                  TRA     s:6064
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:71   

      472     5986    3               CASE(%BITBIN(RTN_STD));

      473     5987    3   RTN_STD0:     N$REQ.IOFLG.LPW23='1'B;

   5987  1 001444   020000 236007       RTN_STD0     LDQ     8192,DL
         1 001445   000004 256100                    ORSQ    4,,PR0

      474     5988    4   RTN_STD:      IF PSIA OR DCWX>0 THEN DO;

   5988  1 001446   200023 234100       RTN_STD      SZN     PSIA,,AUTO
         1 001447   001452 604000 1                  TMI     s:5989
         1 001450   200014 235100                    LDA     DCWX,,AUTO
         1 001451   001505 604400 1                  TMOZ    s:5999

      475     5989    4                    NI$REQ.IDCW(DCWX)=(FUNC & %IDCWMASK) | %IDCWBITS;

   5989  1 001452   200016 236100                    LDQ     FUNC,,AUTO
         1 001453   000006 376000 0                  ANQ     6
         1 001454   000007 276000 0                  ORQ     7
         1 001455   200017 473500                    LDP3    IOS$,,AUTO
         1 001456   200014 720100                    LXL0    DCWX,,AUTO
         1 001457   300002 756110                    STQ     2,X0,PR3

      476     5990    4                    IF HW_IMX THEN

   5990  1 001460   000000 234000 xsym               SZN     HW_IMX
         1 001461   001470 605000 1                  TPL     s:5992

      477     5991    4                       NI$REQ.IDCW.DATA.BASE(DCWX)=BUF_BASE;

   5991  1 001462   200007 236100                    LDQ     BUF_BASE,,AUTO
         1 001463   000025 736000                    QLS     21
         1 001464   300002 676110                    ERQ     2,X0,PR3
         1 001465   000030 376003                    ANQ     24,DU
         1 001466   300002 656110                    ERSQ    2,X0,PR3
         1 001467   001503 710000 1                  TRA     s:5996
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:72   

      478     5992    5                    ELSE IF PTP=0 AND NOT NOBUF THEN DO;

   5992  1 001470   200024 235100                    LDA     PTP,,AUTO
         1 001471   001503 601000 1                  TNZ     s:5996
         1 001472   200021 234100                    SZN     NOBUF,,AUTO
         1 001473   001503 604000 1                  TMI     s:5996

      479     5993    5                          NI$REQ.IDCW.EXTA(DCWX)=BUFREAL.EXTA;

   5993  1 001474   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001475   000002 772000                    QRL     2
         1 001476   300002 676110                    ERQ     2,X0,PR3
         1 001477   000077 376003                    ANQ     63,DU
         1 001500   300002 656110                    ERSQ    2,X0,PR3

      480     5994    5                          NI$REQ.IDCW.EC(DCWX)='1'B;

   5994  1 001501   040000 236007                    LDQ     16384,DL
         1 001502   300002 256110                    ORSQ    2,X0,PR3

      481     5995    5                          END;

      482     5996    4                    DCWX=DCWX+1;

   5996  1 001503   200014 054100                    AOS     DCWX,,AUTO

      483     5997    4                    END;

   5997  1 001504   001526 710000 1                  TRA     s:6007

      484     5998    4                 ELSE DO;

      485     5999    4                    NI$REQ.PCW=(FUNC & %IDCWMASK) | %IDCWBITS;

   5999  1 001505   200016 236100                    LDQ     FUNC,,AUTO
         1 001506   000006 376000 0                  ANQ     6
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:73   
         1 001507   000007 276000 0                  ORQ     7
         1 001510   000044 737000                    LLS     36
         1 001511   000000 236003                    LDQ     0,DU
         1 001512   200017 473500                    LDP3    IOS$,,AUTO
         1 001513   300012 757100                    STAQ    10,,PR3

      486     6000    5                    IF PTP=0 AND NOT NOBUF THEN DO;

   6000  1 001514   200024 235100                    LDA     PTP,,AUTO
         1 001515   001524 601000 1                  TNZ     s:6004
         1 001516   200021 234100                    SZN     NOBUF,,AUTO
         1 001517   001524 604000 1                  TMI     s:6004

      487     6001    5                       NI$REQ.PCW.AEX=BUFREAL.EXTA;

   6001  1 001520   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001521   000002 772000                    QRL     2
         1 001522   300012 752110                    STCQ    10,'10'O,PR3

      488     6002    5                       END;

   6002  1 001523   001526 710000 1                  TRA     s:6007

      489     6003    5                    ELSE DO;

      490     6004    5                       NI$REQ.PCW.FLAGS='600'O;

   6004  1 001524   000600 236007                    LDQ     384,DL
         1 001525   300013 552104                    STBQ    11,'04'O,PR3

      491     6005    5                       END;

      492     6006    4                    END;

      493     6007    4                 IF NOT NOBUF THEN DO;

   6007  1 001526   200021 234100                    SZN     NOBUF,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:74   
         1 001527   001775 604000 1                  TMI     s:6064

      494     6008    5                    IF PTP=0 THEN DO;

   6008  1 001530   200024 235100                    LDA     PTP,,AUTO
         1 001531   001541 601000 1                  TNZ     s:6014

      495     6009    5                       N$REQ.IOFLG.LPW23='0'B;

   6009  1 001532   000006 236000 2                  LDQ     6
         1 001533   000004 356100                    ANSQ    4,,PR0

      496     6010    5                       IF NOT HW_IMX THEN

   6010  1 001534   000000 234000 xsym               SZN     HW_IMX
         1 001535   001572 604000 1                  TMI     s:6022

      497     6011    5                          NI$REQ.PCW.FLAGS='0'B;

   6011  1 001536   000000 236003                    LDQ     0,DU
         1 001537   300013 552104                    STBQ    11,'04'O,PR3

      498     6012    5                       END;

   6012  1 001540   001572 710000 1                  TRA     s:6022

      499     6013    5                    ELSE DO;

      500     6014    5                       IF HW_IOP THEN

   6014  1 001541   000000 234000 xsym               SZN     HW_IOP
         1 001542   001550 605000 1                  TPL     s:6016

      501     6015    5                         NI$REQ.IOP_PTAW=BINBIT(PTP,27)|%IOP_PTA1_INIT; /* PHYSADDR */

   6015  1 001543   200024 236100                    LDQ     PTP,,AUTO
         1 001544   000011 736000                    QLS     9
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:75   
         1 001545   000000 276000 0                  ORQ     0
         1 001546   300001 756100                    STQ     1,,PR3
         1 001547   001555 710000 1                  TRA     s:6018

      502     6016    5                       ELSE IF NOT HW_IMX THEN

   6016  1 001550   000000 234000 xsym               SZN     HW_IMX
         1 001551   001555 604000 1                  TMI     s:6018

      503     6017    5                             NI$REQ.PCW.PTP=PTP;

   6017  1 001552   200024 236100                    LDQ     PTP,,AUTO
         1 001553   000011 736000                    QLS     9
         1 001554   300013 552130                    STBQ    11,'30'O,PR3

      504     6018    5                       N$REQ.LPWX.BASE=BUFVIRT.BASE;

   6018  1 001555   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001556   000003 772000                    QRL     3
         1 001557   000000 620006                    EAX0    0,QL
         1 001560   000011 740100                    STX0    9,,PR0

      505     6019    5                       N$REQ.LPWX.BOUND=(BUFSIZE + BUFVIRT.BYT + 3) / 4;

   6019  1 001561   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001562   000007 376007                    ANQ     7,DL
         1 001563   200006 036100                    ADLQ    BUFSIZE,,AUTO
         1 001564   000003 036007                    ADLQ    3,DL
         1 001565   000004 506007                    DIV     4,DL
         1 001566   000000 621006                    EAX1    0,QL
         1 001567   000011 441100                    SXL1    9,,PR0

      506     6020    5                       BUFVIRT.BASE=0;

   6020  1 001570   000007 236007                    LDQ     7,DL
         1 001571   200004 356100                    ANSQ    BUFADDR,,AUTO

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:76   
      507     6021    5                       END;

      508     6022    4                    NI$REQ.DCW.ICP(DCWX)=BUFREAL.BYT;

   6022  1 001572   200014 720100                    LXL0    DCWX,,AUTO
         1 001573   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001574   000003 376007                    ANQ     3,DL
         1 001575   000017 736000                    QLS     15
         1 001576   300002 676110                    ERQ     2,X0,PR3
         1 001577   700000 376007                    ANQ     -32768,DL
         1 001600   300002 656110                    ERSQ    2,X0,PR3

      509     6023    4                    BUFOFFSET=BUFREAL.ADR;

   6023  1 001601   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001602   000002 772000                    QRL     2
         1 001603   777777 376007                    ANQ     -1,DL
         1 001604   200005 756100                    STQ     BUFOFFSET,,AUTO

      510     6024    4                    SIZE=(BUFSIZE + BUFREAL.BYT + 3) / 4;

   6024  1 001605   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001606   000003 376007                    ANQ     3,DL
         1 001607   200006 036100                    ADLQ    BUFSIZE,,AUTO
         1 001610   000003 036007                    ADLQ    3,DL
         1 001611   000004 506007                    DIV     4,DL
         1 001612   200032 756100                    STQ     SIZE,,AUTO

      511     6025    5                    DO WHILE(SIZE>%DCWTALLYMAX);

   6025  1 001613   010001 116007                    CMPQ    4097,DL
         1 001614   001644 602000 1                  TNC     s:6033

      512     6026    5                       NI$REQ.DCW.FWA(DCWX)=BUFOFFSET;

   6026  1 001615   200005 720100                    LXL0    BUFOFFSET,,AUTO
         1 001616   200017 470500                    LDP0    IOS$,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:77   
         1 001617   200014 721100                    LXL1    DCWX,,AUTO
         1 001620   000002 740111                    STX0    2,X1,PR0

      513     6027    5                       NI$REQ.DCW.TYPE(DCWX)=%DCW_IOTP;

   6027  1 001621   000002 236111                    LDQ     2,X1,PR0
         1 001622   000012 376000 2                  ANQ     10
         1 001623   010000 276007                    ORQ     4096,DL
         1 001624   000002 756111                    STQ     2,X1,PR0

      514     6028    5                       DCWX=DCWX+1;

   6028  1 001625   200014 054100                    AOS     DCWX,,AUTO

      515     6029    5                       SIZE=SIZE-%DCWTALLYMAX;

   6029  1 001626   200032 235100                    LDA     SIZE,,AUTO
         1 001627   010000 135007                    SBLA    4096,DL
         1 001630   200032 755100                    STA     SIZE,,AUTO

      516     6030    5                       BUFOFFSET=BUFOFFSET+%DCWTALLYMAX;

   6030  1 001631   200005 236100                    LDQ     BUFOFFSET,,AUTO
         1 001632   010000 036007                    ADLQ    4096,DL
         1 001633   200005 756100                    STQ     BUFOFFSET,,AUTO

      517     6031    5                       IF DCWX=%DCWXMAX THEN CALL CHAINIOS ALTRET(NQPKTS);

   6031  1 001634   200014 235100                    LDA     DCWX,,AUTO
         1 001635   000007 115007                    CMPA    7,DL
         1 001636   001641 601000 1                  TNZ     s:6032

   6031  1 001637   002307 701000 1                  TSX1    CHAINIOS
         1 001640   002240 702000 1                  TSX2    NQPKTS

      518     6032    5                       END;

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:78   
   6032  1 001641   200032 235100                    LDA     SIZE,,AUTO
         1 001642   010001 115007                    CMPA    4097,DL
         1 001643   001615 603000 1                  TRC     s:6026

      519     6033    4                    NI$REQ.DCW.FWA(DCWX)=BUFOFFSET;

   6033  1 001644   200005 720100                    LXL0    BUFOFFSET,,AUTO
         1 001645   200017 470500                    LDP0    IOS$,,AUTO
         1 001646   200014 721100                    LXL1    DCWX,,AUTO
         1 001647   000002 740111                    STX0    2,X1,PR0

      520     6034    4                    NI$REQ.DCW.TALLY(DCWX)=SIZE;

   6034  1 001650   200032 236100                    LDQ     SIZE,,AUTO
         1 001651   000002 676111                    ERQ     2,X1,PR0
         1 001652   007777 376007                    ANQ     4095,DL
         1 001653   000002 656111                    ERSQ    2,X1,PR0

      521     6035    4                    NI$REQ.DCW.TYPE(DCWX)=%DCW_IOTD;

   6035  1 001654   000012 236000 2                  LDQ     10
         1 001655   000002 356111                    ANSQ    2,X1,PR0

      522     6036    4                    END;

   6036  1 001656   001775 710000 1                  TRA     s:6064

      523     6037    3               CASE(%BITBIN(RTN_MSOS_DUAL)); /* HW_IOP */

      524     6038    3                 PNTR$=N$REQ.BUF$; /* BUF$-> an IOS packet being used as a buffer */

   6038  1 001657   000005 236100                    LDQ     5,,PR0
         1 001660   200022 756100                    STQ     PNTR$,,AUTO

      525     6039    3                 NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWCONT;

   6039  1 001661   200016 236100                    LDQ     FUNC,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:79   
         1 001662   000006 376000 0                  ANQ     6
         1 001663   000010 276000 0                  ORQ     8
         1 001664   200017 473500                    LDP3    IOS$,,AUTO
         1 001665   300002 756100                    STQ     2,,PR3

      526     6040    3                 NI$REQ.DCW.FWA(1)=PNTR.WA+2;

   6040  1 001666   200022 220100                    LDX0    PNTR$,,AUTO
         1 001667   000002 621010                    EAX1    2,X0
         1 001670   300003 741100                    STX1    3,,PR3

      527     6041    3                 NI$REQ.DCW.TYPE(1)=%DCW_IOTD;

   6041  1 001671   000012 236000 2                  LDQ     10
         1 001672   300003 356100                    ANSQ    3,,PR3

      528     6042    3                 NI$REQ.DCW.TALLY(1)=4;

   6042  1 001673   000004 236007                    LDQ     4,DL
         1 001674   300003 752103                    STCQ    3,'03'O,PR3

      529     6043    3                 NI$REQ.IDCW(2)=(FUNC & %IDCWMASK) | %IDCWBITS;

   6043  1 001675   200016 236100                    LDQ     FUNC,,AUTO
         1 001676   000006 376000 0                  ANQ     6
         1 001677   000007 276000 0                  ORQ     7
         1 001700   300004 756100                    STQ     4,,PR3

      530     6044    3                 NI$REQ.IDCW.DC(2)=FUNC.DC2;

   6044  1 001701   200016 236100                    LDQ     FUNC,,AUTO
         1 001702   000014 736000                    QLS     12
         1 001703   300004 752140                    STCQ    4,'40'O,PR3

      531     6045    3                 NI$REQ.DCW.FWA(3)=PNTR.WA+6;

   6045  1 001704   000006 622010                    EAX2    6,X0
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:80   
         1 001705   300005 742100                    STX2    5,,PR3

      532     6046    3                 NI$REQ.DCW.TYPE(3)=%DCW_IOTD;

   6046  1 001706   000012 236000 2                  LDQ     10
         1 001707   300005 356100                    ANSQ    5,,PR3

      533     6047    3                 NI$REQ.DCW.TALLY(3)=4;

   6047  1 001710   000004 236007                    LDQ     4,DL
         1 001711   300005 752103                    STCQ    5,'03'O,PR3
         1 001712   001775 710000 1                  TRA     s:6064

      534     6048    3               CASE(%BITBIN(RTN_MCA_DUAL)); /* HW_IMX */

      535     6049    3                 N$REQ.LPWX.BASE=BUFVIRT.BASE;

   6049  1 001713   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001714   000003 772000                    QRL     3
         1 001715   000000 620006                    EAX0    0,QL
         1 001716   000011 740100                    STX0    9,,PR0

      536     6050    3                 N$REQ.LPWX.BOUND=4096;

   6050  1 001717   010000 221003                    LDX1    4096,DU
         1 001720   000011 441100                    SXL1    9,,PR0

      537     6051    3                 BUFVIRT.BASE=0;

   6051  1 001721   000007 236007                    LDQ     7,DL
         1 001722   200004 356100                    ANSQ    BUFADDR,,AUTO

      538     6052    3                 NI$REQ.IDCW(0)=(FUNC & %IDCWMASK) | %IDCWCONT;

   6052  1 001723   200016 236100                    LDQ     FUNC,,AUTO
         1 001724   000006 376000 0                  ANQ     6
         1 001725   000010 276000 0                  ORQ     8
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:81   
         1 001726   200017 473500                    LDP3    IOS$,,AUTO
         1 001727   300002 756100                    STQ     2,,PR3

      539     6053    3                 NI$REQ.IDCW.DATA.BASE(0)=BUF_BASE;

   6053  1 001730   200007 236100                    LDQ     BUF_BASE,,AUTO
         1 001731   000025 736000                    QLS     21
         1 001732   300002 676100                    ERQ     2,,PR3
         1 001733   000030 376003                    ANQ     24,DU
         1 001734   300002 656100                    ERSQ    2,,PR3

      540     6054    3                 NI$REQ.DCW.FWA(1)=BUFREAL.ADR;

   6054  1 001735   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001736   000002 772000                    QRL     2
         1 001737   777777 376007                    ANQ     -1,DL
         1 001740   000000 620006                    EAX0    0,QL
         1 001741   300003 740100                    STX0    3,,PR3

      541     6055    3                 NI$REQ.DCW.TALLY(1)=(BUFSIZE+BUFREAL.BYT+3) / 4;

   6055  1 001742   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001743   000003 376007                    ANQ     3,DL
         1 001744   200006 036100                    ADLQ    BUFSIZE,,AUTO
         1 001745   000003 036007                    ADLQ    3,DL
         1 001746   000004 506007                    DIV     4,DL
         1 001747   300003 752103                    STCQ    3,'03'O,PR3

      542     6056    3                 NI$REQ.DCW.TYPE(1)=%DCW_IOTD;

   6056  1 001750   000012 236000 2                  LDQ     10
         1 001751   300003 356100                    ANSQ    3,,PR3

      543     6057    3                 NI$REQ.IDCW(2)=(FUNC & %IDCWMASK) | %IDCWBITS;

   6057  1 001752   200016 236100                    LDQ     FUNC,,AUTO
         1 001753   000006 376000 0                  ANQ     6
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:82   
         1 001754   000007 276000 0                  ORQ     7
         1 001755   300004 756100                    STQ     4,,PR3

      544     6058    3                 NI$REQ.IDCW.DC(2)=FUNC.DC2;

   6058  1 001756   200016 236100                    LDQ     FUNC,,AUTO
         1 001757   000014 736000                    QLS     12
         1 001760   300004 752140                    STCQ    4,'40'O,PR3

      545     6059    3                 NI$REQ.IDCW.DATA.BASE(2)=BUF_BASE;

   6059  1 001761   200007 236100                    LDQ     BUF_BASE,,AUTO
         1 001762   000025 736000                    QLS     21
         1 001763   300004 676100                    ERQ     4,,PR3
         1 001764   000030 376003                    ANQ     24,DU
         1 001765   300004 656100                    ERSQ    4,,PR3

      546     6060    3                 NI$REQ.DCW.FWA(3)=BUFREAL.ADR;

   6060  1 001766   200004 236100                    LDQ     BUFADDR,,AUTO
         1 001767   000002 772000                    QRL     2
         1 001770   777777 376007                    ANQ     -1,DL
         1 001771   000000 620006                    EAX0    0,QL
         1 001772   300005 740100                    STX0    5,,PR3

      547     6061    3                 NI$REQ.DCW.TYPE(3)=%DCW_IOTD;

   6061  1 001773   000012 236000 2                  LDQ     10
         1 001774   300005 356100                    ANSQ    5,,PR3

      548     6062                                                /* DCW.TALLY(3) is 4096 */
      549     6063    3               END;                        /* CASE RTN */

      550     6064    3              IF HW_IMX THEN DO;           /* PREPARE IMX MAILBOX */

   6064  1 001775   000000 234000 xsym               SZN     HW_IMX
         1 001776   002100 605000 1                  TPL     s:6081
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:83   

      551     6065    4                 IF PTP~=0 THEN DO;

   6065  1 001777   200024 235100                    LDA     PTP,,AUTO
         1 002000   002035 600000 1                  TZE     s:6073

      552     6066    4                    NI$IMXMBX.PAGED_BASE(%IMX_IOS_BASE)=BINBIT(NI_IMXLO_PBASE,36);

   6066  1 002001   000000 236000 xsym               LDQ     NI_IMXLO_PBASE
         1 002002   200020 470500                    LDP0    MBX$,,AUTO
         1 002003   000002 756100                    STQ     2,,PR0

      553     6067    4                    NI$IMXMBX.SIZE(%IMX_IOS_BASE)=(%IMXHI-%IMXLO+1)*1024 - 1;

   6067  1 002004   037777 220003                    LDX0    16383,DU
         1 002005   000005 740100                    STX0    5,,PR0

      554     6068    4                    NI$IMXMBX.PAGED_BASE.PTWADDR(BUF_BASE)=PTP;

   6068  1 002006   200007 721100                    LXL1    BUF_BASE,,AUTO
         1 002007   200024 236100                    LDQ     PTP,,AUTO
         1 002010   000012 736000                    QLS     10
         1 002011   000000 676111                    ERQ     0,X1,PR0
         1 002012   000013 376000 2                  ANQ     11
         1 002013   000000 656111                    ERSQ    0,X1,PR0

      555     6069    4                    NI$IMXMBX.PAGED_BASE.OFFSET(BUF_BASE)=N$REQ.LPWX.BASE*2;

   6069  1 002014   200003 471500                    LDP1    @N$REQ,,AUTO
         1 002015   100011 236100                    LDQ     9,,PR1
         1 002016   000021 772000                    QRL     17
         1 002017   000014 376000 2                  ANQ     12
         1 002020   000000 676111                    ERQ     0,X1,PR0
         1 002021   001777 376007                    ANQ     1023,DL
         1 002022   000000 656111                    ERSQ    0,X1,PR0

      556     6070    4                    NI$IMXMBX.SIZE(BUF_BASE)=N$REQ.LPWX.BOUND-1;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:84   

   6070  1 002023   100011 236100                    LDQ     9,,PR1
         1 002024   777777 376007                    ANQ     -1,DL
         1 002025   000001 136007                    SBLQ    1,DL
         1 002026   200040 756100                    STQ     TDCW$+1,,AUTO
         1 002027   200007 235100                    LDA     BUF_BASE,,AUTO
         1 002030   000001 735000                    ALS     1
         1 002031   000105 101500                    MRL     fill='000'O
         1 002032   200040 000004                    ADSC9   TDCW$+1,,AUTO            cn=0,n=4
         1 002033   000004 000002                    ADSC9   4,A,PR0                  cn=0,n=2

      557     6071    4                    END;

   6071  1 002034   002072 710000 1                  TRA     s:6078

      558     6072    4                 ELSE DO;

      559     6073    4                   NI$IMXMBX.NPAGED_IND.PHYS(%IMX_IOS_BASE)=B$MPT$->B$MAP.RPN(%IMXLO)*
              6073                             1024;

   6073  1 002035   200020 470500                    LDP0    MBX$,,AUTO
         1 002036   000000 471400 xsym               LDP1    B$MPT$
         1 002037   100510 236100                    LDQ     328,,PR1
         1 002040   000010 772000                    QRL     8
         1 002041   000015 376000 2                  ANQ     13
         1 002042   000002 676100                    ERQ     2,,PR0
         1 002043   000016 376000 2                  ANQ     14
         1 002044   000002 656100                    ERSQ    2,,PR0

      560     6074    4                    NI$IMXMBX.SIZE(%IMX_IOS_BASE)=(%IMXHI-%IMXLO+1)*1024 - 1;

   6074  1 002045   037777 220003                    LDX0    16383,DU
         1 002046   000005 740100                    STX0    5,,PR0

      561     6075    4                   NI$IMXMBX.NPAGED_IND.PHYS(BUF_BASE)=BUFREAL.EXTA*%BITBIN('1000000'O
              6075                             );

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:85   
   6075  1 002047   200007 721100                    LXL1    BUF_BASE,,AUTO
         1 002050   200004 236100                    LDQ     BUFADDR,,AUTO
         1 002051   000002 772000                    QRL     2
         1 002052   177777 376003                    ANQ     65535,DU
         1 002053   000000 676111                    ERQ     0,X1,PR0
         1 002054   000016 376000 2                  ANQ     14
         1 002055   000000 656111                    ERSQ    0,X1,PR0

      562     6076    4                    NI$IMXMBX.SIZE(BUF_BASE)=(BUFSIZE+BUFREALB.BYTADR+3)/4 - 1;

   6076  1 002056   200004 236100                    LDQ     BUFADDR,,AUTO
         1 002057   000017 376000 2                  ANQ     15
         1 002060   200006 036100                    ADLQ    BUFSIZE,,AUTO
         1 002061   000003 036007                    ADLQ    3,DL
         1 002062   000004 506007                    DIV     4,DL
         1 002063   000001 136007                    SBLQ    1,DL
         1 002064   200040 756100                    STQ     TDCW$+1,,AUTO
         1 002065   200007 235100                    LDA     BUF_BASE,,AUTO
         1 002066   000001 735000                    ALS     1
         1 002067   000105 101500                    MRL     fill='000'O
         1 002070   200040 000004                    ADSC9   TDCW$+1,,AUTO            cn=0,n=4
         1 002071   000004 000002                    ADSC9   4,A,PR0                  cn=0,n=2

      563     6077    4                    END;

      564     6078    3                 PNTR$=ADDR(N$REQ.IOS$->NI$REQ.DCW(0));

   6078  1 002072   200003 471500                    LDP1    @N$REQ,,AUTO
         1 002073   100012 473500                    LDP3    10,,PR1
         1 002074   300002 634500                    EPPR4   2,,PR3
         1 002075   200022 454500                    STP4    PNTR$,,AUTO

      565     6079    3                 NI$IMXMBX.LPW.DCW_ADDR=PNTR.WA;

   6079  1 002076   200022 222100                    LDX2    PNTR$,,AUTO
         1 002077   000007 742100                    STX2    7,,PR0

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:86   
      566     6080    3                 END;

      567     6081    2              IF QUE=%QUE_DCWBLD THEN RETURN;

   6081  1 002100   200025 235100                    LDA     QUE,,AUTO
         1 002101   000001 115007                    CMPA    1,DL
         1 002102   002104 601000 1                  TNZ     s:6082

   6081  1 002103   000000 702200 xent               TSX2  ! X66_ARET

      568     6082    2              SCHED=DVT.SCHED;

   6082  1 002104   200015 470500                    LDP0    DVT$,,AUTO
         1 002105   000000 236100                    LDQ     0,,PR0
         1 002106   200030 756100                    STQ     SCHED,,AUTO

      569     6083    2              CALL SCHED(N$REQ);

   6083  1 002107   200003 630500                    EPPR0   @N$REQ,,AUTO
         1 002110   200030 220100                    LDX0    SCHED,,AUTO
         1 002111   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002112   000000 701010                    TSX1    0,X0
         1 002113   000000 011000                    NOP     0
         1 002114   002203 710000 1                  TRA     s:6111

      570     6084
      571     6085    2            CASE(NK_QTRM);

      572     6086    2              N$REQ.COMP=%COMP_COM;

   6086  1 002115   200003 471500                    LDP1    @N$REQ,,AUTO
         1 002116   100027 236100                    LDQ     23,,PR1
         1 002117   000020 376000 2                  ANQ     16
         1 002120   001000 276007                    ORQ     512,DL
         1 002121   100027 756100                    STQ     23,,PR1

      573     6087                   %ENQUEUE(P#=N$REQ,Q#=DCT.SQ$);
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:87   

   6088  1 002122   200013 236100                    LDQ     DCT$,,AUTO
         1 002123   000001 036003                    ADLQ    1,DU
         1 002124   200003 235100                    LDA     @N$REQ,,AUTO
         1 002125   200040 757100                    STAQ    TDCW$+1,,AUTO
         1 002126   200040 630500                    EPPR0   TDCW$+1,,AUTO
         1 002127   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002130   000000 701000 xent               TSX1    NIM$ENQUEUE
         1 002131   000000 011000                    NOP     0

      574     6090    2              CALL SC_NIONRD;

   6090  1 002132   000000 713400 xsym               CLIMB   SC_NIONRD
         1 002133   000000 600000 xsid               climb   nvectors=         0
         1 002134   002203 710000 1                  TRA     s:6111

      575     6091        /*S* SCREECH_CODE: NIO-S$NRD-7
      576     6092             TYPE: SCREECH
      577     6093             MESSAGE: I/O TO REMOTE DEVICES IS NOT IMPLEMENTED
      578     6094        */
      579     6095
      580     6096    2            CASE(NK_CGDCB);

      581     6097    2              N$REQ.IOQFLG.IOQUED = '0'B ;

   6097  1 002135   200003 471500                    LDP1    @N$REQ,,AUTO
         1 002136   000000 236000 2                  LDQ     0
         1 002137   100033 356100                    ANSQ    27,,PR1

      582     6098    2              N$REQ.COMP=%COMP_COM;

   6098  1 002140   100027 236100                    LDQ     23,,PR1
         1 002141   000020 376000 2                  ANQ     16
         1 002142   001000 276007                    ORQ     512,DL
         1 002143   100027 756100                    STQ     23,,PR1

      583     6099    3              DO CASE (N$REQ.FC);
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:88   

   6099  1 002144   100003 720100                    LXL0    3,,PR1
         1 002145   000777 360003                    ANX0    511,DU
         1 002146   000016 100003                    CMPX0   14,DU
         1 002147   002151 602010 1                  TNC     s:6099+5,X0
         1 002150   002174 710000 1                  TRA     s:6103
         1 002151   002174 710000 1                  TRA     s:6103
         1 002152   002174 710000 1                  TRA     s:6103
         1 002153   002174 710000 1                  TRA     s:6103
         1 002154   002167 710000 1                  TRA     s:6101
         1 002155   002174 710000 1                  TRA     s:6103
         1 002156   002167 710000 1                  TRA     s:6101
         1 002157   002174 710000 1                  TRA     s:6103
         1 002160   002174 710000 1                  TRA     s:6103
         1 002161   002174 710000 1                  TRA     s:6103
         1 002162   002174 710000 1                  TRA     s:6103
         1 002163   002174 710000 1                  TRA     s:6103
         1 002164   002174 710000 1                  TRA     s:6103
         1 002165   002174 710000 1                  TRA     s:6103
         1 002166   002167 710000 1                  TRA     s:6101

      584     6100    3               CASE (%N_WRITE,%N_WRASC,%N_WRBIN);

      585     6101    3                 CALL KQW$WRITE (N$REQ);

   6101  1 002167   200003 630500                    EPPR0   @N$REQ,,AUTO
         1 002170   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002171   000000 701000 xent               TSX1    KQW$WRITE
         1 002172   000000 011000                    NOP     0
         1 002173   002200 710000 1                  TRA     s:6105

      586     6102    3               CASE (ELSE);

      587     6103    3                 CALL KQR$READ (N$REQ);

   6103  1 002174   200003 630500                    EPPR0   @N$REQ,,AUTO
         1 002175   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:89   
         1 002176   000000 701000 xent               TSX1    KQR$READ
         1 002177   000000 011000                    NOP     0

      588     6104    3               END;

      589     6105    2              RETURN;

   6105  1 002200   000000 702200 xent               TSX2  ! X66_ARET

      590     6106
      591     6107    2            CASE(ELSE);

      592     6108    2              CALL SC_NIONRD;

   6108  1 002201   000000 713400 xsym               CLIMB   SC_NIONRD
         1 002202   000000 600000 xsid               climb   nvectors=         0

      593     6109    2            END /* CASE DCT.RESCOD */;

      594     6110
      595     6111    1           IF N$REQ.OPFLG.WAIT AND N$REQ.OPFLG.USER AND QUE=%QUE_STD THEN

   6111  1 002203   200003 470500                    LDP0    @N$REQ,,AUTO
         1 002204   000004 236100                    LDQ     4,,PR0
         1 002205   000020 316007                    CANQ    16,DL
         1 002206   002237 600000 1                  TZE     s:6116
         1 002207   000400 316007                    CANQ    256,DL
         1 002210   002237 600000 1                  TZE     s:6116
         1 002211   200025 235100                    LDA     QUE,,AUTO
         1 002212   002237 601000 1                  TNZ     s:6116

      596     6112    1              IF N$REQ.DCB$ ~= ADDR(NIL) THEN

   6112  1 002213   000022 236100                    LDQ     18,,PR0
         1 002214   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002215   002233 600000 1                  TZE     s:6115

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:90   
      597     6113    1                 CALL SSR$REG(%SS_IIP,N$REQ.DCB$->F$DCB.FCN(N$REQ.NWIO));

   6113  1 002216   000022 471500                    LDP1    18,,PR0
         1 002217   000031 236100                    LDQ     25,,PR0
         1 002220   000021 772000                    QRL     17
         1 002221   000001 376007                    ANQ     1,DL
         1 002222   100074 500506                    A9BD    60,QL,PR1
         1 002223   200041 451500                    STP1    TDCW$+2,,AUTO
         1 002224   000021 236000 2                  LDQ     17
         1 002225   200040 756100                    STQ     TDCW$+1,,AUTO
         1 002226   200040 630500                    EPPR0   TDCW$+1,,AUTO
         1 002227   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002230   000000 701000 xent               TSX1    SSR$REG
         1 002231   000000 011000                    NOP     0
         1 002232   002237 710000 1                  TRA     s:6116

      598     6114    1              ELSE
      599     6115    1                 CALL SSR$REG(%SS_IIP);

   6115  1 002233   000021 630400 2                  EPPR0   17
         1 002234   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002235   000000 701000 xent               TSX1    SSR$REG
         1 002236   000000 011000                    NOP     0

      600     6116    1           RETURN;

   6116  1 002237   000000 702200 xent               TSX2  ! X66_ARET

      601     6117        /**/
      602     6118        /* BACK OUT AND ALTRETURN IF NO IOS PACKETS AVAILABLE */
      603     6119        /**/
      604     6120    1   NQPKTS:
      605     6121    1           N$REQ.IOQFLG.IOQUED = '0'B ;

   6121  1 002240   200003 470500       NQPKTS       LDP0    @N$REQ,,AUTO
         1 002241   000000 236000 2                  LDQ     0
         1 002242   000033 356100                    ANSQ    27,,PR0
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:91   

      606     6122    2           IF N$REQ.IOFLG.IOS THEN DO;

   6122  1 002243   000004 236100                    LDQ     4,,PR0
         1 002244   040000 316007                    CANQ    16384,DL
         1 002245   002262 600000 1                  TZE     s:6127

      607     6123    2              CALL NIQ$RELS(N$REQ.IOS$);

   6123  1 002246   200003 236100                    LDQ     @N$REQ,,AUTO
         1 002247   000012 036003                    ADLQ    10,DU
         1 002250   200040 756100                    STQ     TDCW$+1,,AUTO
         1 002251   200040 630500                    EPPR0   TDCW$+1,,AUTO
         1 002252   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002253   000000 701000 xent               TSX1    NIQ$RELS
         1 002254   000000 011000                    NOP     0

      608     6124    2              N$REQ.IOS$=ADDR(NIL);

   6124  1 002255   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002256   200003 470500                    LDP0    @N$REQ,,AUTO
         1 002257   000012 756100                    STQ     10,,PR0

      609     6125    2              N$REQ.IOFLG.IOS='0'B;

   6125  1 002260   000022 236000 2                  LDQ     18
         1 002261   000004 356100                    ANSQ    4,,PR0

      610     6126    2              END;

      611     6127    1           IF NOT N$REQ.NOALT THEN ALTRETURN;

   6127  1 002262   000004 236100                    LDQ     4,,PR0
         1 002263   100000 316007                    CANQ    32768,DL
         1 002264   002266 601000 1                  TNZ     s:6129

   6127  1 002265   000000 702200 xent               TSX2  ! X66_AALT
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:92   

      612     6128                %LOCK(G#=NI$RP.GATE);

   6129  1 002266   000000 630400 xsym               EPPR0   NI$RP$
         1 002267   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002270   000000 701000 xent               TSX1    HFC$LOCK
         1 002271   000000 011000                    NOP     0

      613     6131                %ENQUEUE(P#=N$REQ,Q#=NI$RP.RQ$);

   6132  1 002272   000000 236000 xsym               LDQ     NI$RP$
         1 002273   000004 036003                    ADLQ    4,DU
         1 002274   200003 235100                    LDA     @N$REQ,,AUTO
         1 002275   200040 757100                    STAQ    TDCW$+1,,AUTO
         1 002276   200040 630500                    EPPR0   TDCW$+1,,AUTO
         1 002277   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002300   000000 701000 xent               TSX1    NIM$ENQUEUE
         1 002301   000000 011000                    NOP     0

      614     6134                %UNLOCK(G#=NI$RP.GATE);

   6135  1 002302   000000 630400 xsym               EPPR0   NI$RP$
         1 002303   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002304   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002305   000000 011000                    NOP     0

      615     6137    1           RETURN;

   6137  1 002306   000000 702200 xent               TSX2  ! X66_ARET

      616     6138        %EJECT;
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:93   
      617     6139    1   CHAINIOS: PROC ALTRET;

   6139  1 002307   200036 741300       CHAINIOS     STX1  ! X+2,,AUTO

      618     6140    2   DCL TDCW$ PTR;
      619     6141    2   DCL TDCW REDEF TDCW$ BIT(36);
      620     6142    3           IF NI$REQ.FL$=ADDR(NIL) THEN DO;

   6142  1 002310   200017 470500                    LDP0    IOS$,,AUTO
         1 002311   000000 236100                    LDQ     0,,PR0
         1 002312   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002313   002321 601000 1                  TNZ     s:6146

      621     6143    3              CALL NIQ$GETS(NI$REQ.FL$) ALTRET(ALT);

   6143  1 002314   200017 630500                    EPPR0   IOS$,,AUTO
         1 002315   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002316   000000 701000 xent               TSX1    NIQ$GETS
         1 002317   002354 702000 1                  TSX2    ALT

      622     6144    3              END;

   6144  1 002320   002331 710000 1                  TRA     s:6150

      623     6145    3           ELSE DO;

      624     6146    3              TDCW$=NI$REQ.FL$->NI$REQ.FL$;

   6146  1 002321   000000 471500                    LDP1    0,,PR0
         1 002322   100000 236100                    LDQ     0,,PR1
         1 002323   200037 756100                    STQ     TDCW$,,AUTO

      625     6147    3              NI$REQ.FL$->NI$REQ=NI$REQ_INIT;

   6147  1 002324   000100 100400                    MLR     fill='000'O
         1 002325   000000 000070 xsym               ADSC9   NI$REQ_INIT              cn=0,n=56
         1 002326   100000 000070                    ADSC9   0,,PR1                   cn=0,n=56
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:94   

      626     6148    3              NI$REQ.FL$->NI$REQ.FL$=TDCW$;

   6148  1 002327   000000 471500                    LDP1    0,,PR0
         1 002330   100000 756100                    STQ     0,,PR1

      627     6149    3              END;

      628     6150    2           TDCW$=ADDR(NI$REQ.FL$->NI$REQ.DCW(0));

   6150  1 002331   200017 470500                    LDP0    IOS$,,AUTO
         1 002332   000000 471500                    LDP1    0,,PR0
         1 002333   100002 633500                    EPPR3   2,,PR1
         1 002334   200037 453500                    STP3    TDCW$,,AUTO

      629     6151    2           NI$REQ.DCW(DCWX)=(TDCW & %TDCWMASK) | %TDCWM1;

   6151  1 002335   200037 236100                    LDQ     TDCW$,,AUTO
         1 002336   000016 376000 0                  ANQ     14
         1 002337   000001 276000 0                  ORQ     1
         1 002340   200014 720100                    LXL0    DCWX,,AUTO
         1 002341   000002 756110                    STQ     2,X0,PR0

      630     6152    2           IF HW_IMX THEN

   6152  1 002342   000000 234000 xsym               SZN     HW_IMX
         1 002343   002347 605000 1                  TPL     s:6154

      631     6153    2              NI$REQ.DCW.T.DCWLIST.BASE(DCWX)=%IMX_IOS_BASE;

   6153  1 002344   000023 376000 2                  ANQ     19
         1 002345   000200 276007                    ORQ     128,DL
         1 002346   000002 756110                    STQ     2,X0,PR0

      632     6154    2           DCWX=0;

   6154  1 002347   200014 450100                    STZ     DCWX,,AUTO
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:95   

      633     6155    2           IOS$=NI$REQ.FL$;

   6155  1 002350   000000 236100                    LDQ     0,,PR0
         1 002351   200017 756100                    STQ     IOS$,,AUTO

      634     6156    2           RETURN;

   6156  1 002352   200036 221300                    LDX1  ! X+2,,AUTO
         1 002353   000001 702211                    TSX2  ! 1,X1

      635     6157    2   ALT:    ALTRETURN;

   6157  1 002354   200036 221300       ALT          LDX1  ! X+2,,AUTO
         1 002355   000000 702211                    TSX2  ! 0,X1

(unnamed)
 Sect OctLoc
   0     000   000000 000100   000000 020000   000000 020005   000015 012000    ...@............
   0     004   000000 015012   041105 117104   777700 007777   000000 700000    ....!EOD........
   0     010   000000 720000   000000 000000   000000 720000   000000 000600    ................
   0     014   000000 020001   000000 030000   777777 000000                    ............

(unnamed)
 Sect OctLoc
   2     000   577777 777777   777777 777767   000017 777760   000005 006000    ................
   2     004   000000 006000   000000 006000   777777 757777   777747 777777    ................
   2     010   000003 777760   000007 777777   777777 707777   777777 776000    ................
   2     014   000001 777776   001777 776000   001777 777777   000003 777777    ................
   2     020   777777 600777   000003 006000   777777 737777   777777 777477    ................
      636     6158    2   END CHAINIOS;
      637     6159        /**/
      638     6160    1   END NIO$QUE;
      639     6161        %EOD;

PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:96   
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI_DEVCMD_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_MLSMAC_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIO$QUE.
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:97   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @N$REQ                     4-0-0/w SBIN        r     1 BUFADDR
     5-0-0/w UBIN        r     1 BUFOFFSET                  4-0-0/w STRC        r     1 BUFREAL
     4-0-0/w STRC        r     1 BUFREALB                   6-0-0/w SBIN        r     1 BUFSIZE
     4-0-0/w STRC        r     1 BUFVIRT                    7-0-0/w SBIN        r     1 BUF_BASE
    10-0-0/w BIT         r     1 CONT                      11-0-0/w SBIN        r     1 CSIZE
    12-0-0/w PTR         r     1 DCB$                      13-0-0/w PTR         r     1 DCT$
    14-0-0/w SBIN        r     1 DCWX                      15-0-0/w PTR         r     1 DVT$
    16-0-0/w STRC        r     1 FUNC                      17-0-0/w PTR         r     1 IOS$
    20-0-0/w PTR         r     1 MBX$                      *0-0-0/d STRC(1080)  r     1 N$REQ
    21-0-0/w BIT         r     1 NOBUF                     22-0-0/w STRC        r     1 PNTR
    22-0-0/w PTR         r     1 PNTR$                     23-0-0/w BIT         r     1 PSIA
    24-0-0/w SBIN        r     1 PTP                       25-0-0/w SBIN        r     1 QUE
    26-0-0/w SBIN        r     1 RCTTEMP                   27-0-0/w UBIN        r     1 RTN
    30-0-0/w EPTR        r     1 SCHED                     31-0-0/w STRC        r     1 SEEK
    31-0-0/w PTR         r     1 SEEK$                     32-0-0/w UBIN        r     1 SIZE
    33-0-0/w PTR         r     1 SQH$                      37-0-0/w BIT         r     1 TDCW
    37-0-0/w PTR         r     1 TDCW$                     34-0-0/w SBIN        r     1 X

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$LS$
     0-0-0/w PTR         r     1 B$MPT$                     0-0-0/w PTR         r     1 B$WSQ0PT$
     0-0-0/b BIT (72)    r     1 F_DCBLOCK                  0-0-0/w BIT         r     1 HW_IMX
     0-0-0/w BIT         r     1 HW_IOP                     0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w PTR         r     1 N$FQ$                      0-0-0/w PTR         r     1 NI$FQ$
     0-0-0/w PTR         r     1 NI$IBUF$                   0-0-0/d STRC(864)   r     1 NI$IMXMBX_INIT
     0-0-0/d STRC(504)   r     1 NI$REQ_INIT                0-0-0/w PTR         r     1 NI$RP$
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:98   
     0-0-0/w UBIN        r     1 NI_IMXLO_PBASE             0-0-0/w BIT (72)    r     1 NI_MFGATE
     0-0-0/w UBIN        r     1 NK_MXTOTAL                 0-0-0/w PTR         r     1 S$CU$
     0-0-0/w SBIN        r     1 SL_IOTA(0:4)
     0-0-0/w SBIN        r     1 SL_MF(0:4)                 0-0-0/w SBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC        r     1 B$MAP(0:1023)
     0-0-0/d STRC(10368) r     1 B$MLNK                     0-0-0/d STRC(576)   r     1 B$U
     0-0-0/c ACHR        r     1 CHARBASE                   0-0-0/w STRC(1332)  r     1 DCT
     0-0-0/w STRC        r     1 DCW                        0-0-0/w STRC(2844)  r     1 DVT
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC        r     1 IDCW
     0-0-0/w PTR         r     1 N$DCT$(0:0)                0-0-0/d STRC(864)   r     1 NI$IMXMBX
     0-0-0/d STRC(504)   r     1 NI$REQ                     0-0-0/w STRC(180)   r     1 NI$RP
     0-0-0/c CHAR        r     1 ONECHAR(0:0)
     0-0-0/w STRC        r     1 POINTER


   Procedure NIO$QUE requires 1262 words for executable code.
   Procedure NIO$QUE requires 36 words of local(AUTO) storage.
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:99   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:100  
          MINI XREF LISTING

ALT IN PROCEDURE CHAINIOS
      6157**LABEL    6143--CALLALT
B$DO.ECCINFO
       865**DCL       866--REDEF
B$JIT.CPFLAGS1.SLEAZE
       433**DCL       433--REDEF
B$JIT.CTIME
       512**DCL      5731<<ASSIGN   5731>>ASSIGN
B$JIT.ERR.MID
       340**DCL       340--REDEF
B$JIT.JRESPEAK
       501**DCL       502--REDEF
B$JIT.MODE
       334**DCL      5731>>ASSIGN   5732>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
       610**DCL       610--REDEF     611--REDEF
B$JIT.PNR
       514**DCL       514--REDEF
B$JIT.TSLINE
       608**DCL       609--REDEF
B$JIT$
      4572**DCL       334--IMP-PTR  5731>>ASSIGN   5731>>ASSIGN   5731>>ASSIGN   5732>>IF
B$LS$
      4573**DCL      5711>>ASSIGN
B$MAP.RPN
       657**DCL      5714>>ASSIGN   6073>>ASSIGN
B$MAP.SCTRL
       658**DCL       659--REDEF
B$MLNK.WSQ0PT.BASE
      5424**DCL      5711>>ASSIGN
B$MPT$
      4574**DCL      6073>>ASSIGN
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:101  
B$U.CMF
       827**DCL      5732>>IF       5738<<ASSIGN   5738>>ASSIGN
B$U.MF
       820**DCL      5732>>IF       5737<<ASSIGN   5737>>ASSIGN
B$U.MISC
       844**DCL       845--REDEF
B$USER.MISC
       920**DCL       921--REDEF
B$WSQ0PT$
      4579**DCL      5714>>ASSIGN
BUFADDR
      4588**DCL      4589--REDEF    4593--REDEF    4596--REDEF    5702<>CALL     5704>>ASSIGN   5719<<ASSIGN
      5935>>ASSIGN
BUFOFFSET
      4599**DCL      6023<<ASSIGN   6026>>ASSIGN   6030<<ASSIGN   6030>>ASSIGN   6033>>ASSIGN
BUFREAL.ADR
      4591**DCL      5868>>ASSIGN   6023>>ASSIGN   6054>>ASSIGN   6060>>ASSIGN
BUFREAL.BYT
      4592**DCL      6022>>ASSIGN   6024>>ASSIGN   6055>>ASSIGN
BUFREAL.EXTA
      4590**DCL      5993>>ASSIGN   6001>>ASSIGN   6075>>ASSIGN
BUFREALB.BYTADR
      4595**DCL      6076>>ASSIGN
BUFSIZE
      4600**DCL      5722<<ASSIGN   5848>>IF       5860>>ASSIGN   5935>>ASSIGN   5972>>DOWHILE  5975<<ASSIGN
      5975>>ASSIGN   5978>>IF       5979>>ASSIGN   6019>>ASSIGN   6024>>ASSIGN   6055>>ASSIGN   6076>>ASSIGN
BUFVIRT.BASE
      4597**DCL      5859>>ASSIGN   6018>>ASSIGN   6020<<ASSIGN   6049>>ASSIGN   6051<<ASSIGN
BUFVIRT.BYT
      4598**DCL      5824>>IF       6019>>ASSIGN
BUF_BASE
      4601**DCL      5697<<ASSIGN   5699<<ASSIGN   5836>>ASSIGN   5844>>ASSIGN   5863>>ASSIGN   5991>>ASSIGN
      6053>>ASSIGN   6059>>ASSIGN   6068>>ASSIGN   6069>>ASSIGN   6070>>ASSIGN   6075>>ASSIGN   6076>>ASSIGN
CHAINIOS
      6139**PROC     5976--CALL     5981--CALL     6031--CALL
CHARBASE
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:102  
      5457**DCL      5897<<ASSIGN   5897>>ASSIGN   5902<<ASSIGN   5902>>ASSIGN
COMP
      5874**LABEL    5872--CALLALT
CONT
      4602**DCL      5830<<ASSIGN   5831>>DOWHILE  5837<<ASSIGN   5848<<ASSIGN
CSIZE
      4603**DCL      5457--IMP-SIZ  5896<<ASSIGN   5897>>ASSIGN   5897>>ASSIGN   5900<<ASSIGN   5902>>ASSIGN
      5902>>ASSIGN
DCB$
      4604**DCL      5686<<ASSIGN   5742>>IF       5747>>ASSIGN   5747>>ASSIGN   5749>>ASSIGN   5749>>ASSIGN
DCT.CTYP
      5476**DCL      5758>>IF
DCT.DFLG.CHECKWRITE
      5474**DCL      5776>>IF
DCT.DFLG.CM
      5471**DCL      5738>>IF
DCT.DFLG.PSIA
      5472**DCL      5786>>ASSIGN
DCT.DFLG.RELOAD
      5472**DCL      5696>>IF
DCT.DP
      5488**DCL      5495--REDEF    5498--REDEF    5499--REDEF    5501--REDEF    5501--REDEF    5502--REDEF
      5503--REDEF    5503--REDEF
DCT.DVN
      5477**DCL      5783>>ASSIGN   5834>>ASSIGN
DCT.DVT$
      5484**DCL      5723>>ASSIGN
DCT.LP.CHAIN$
      5498**DCL      5897>>ASSIGN
DCT.LP.VFC$
      5498**DCL      5902>>ASSIGN
DCT.LP.VFCL
      5498**DCL      5901<<ASSIGN
DCT.MPC.IOCHANX
      5496**DCL      5496--REDEF
DCT.RESCOD
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:103  
      5475**DCL      5700>>IF       5756>>DOCASE
DCT.SQ$
      5468**DCL      6088<>CALL
DCT$
      4605**DCL      5468--IMP-PTR  5693<<ASSIGN   5694>>ASSIGN   5696>>IF       5700>>IF       5723>>ASSIGN
      5738>>IF       5756>>DOCASE   5758>>IF       5776>>IF       5783>>ASSIGN   5786>>ASSIGN   5834>>ASSIGN
      5897>>ASSIGN   5901>>ASSIGN   5902>>ASSIGN   6088>>CALL
DCW.FWA
      5516**DCL      5842>>ASSIGN
DCW.T.DCWLIST.BASE
      5524**DCL      5844<<ASSIGN
DCW.TALLY
      5519**DCL      5520--REDEF
DCW.TYPE
      5518**DCL      5840>>DOCASE
DCWX
      4606**DCL      5781<<ASSIGN   5951<<ASSIGN   5956>>ASSIGN   5957<<ASSIGN   5957>>ASSIGN   5961>>ASSIGN
      5962>>ASSIGN   5963<<ASSIGN   5963>>ASSIGN   5968>>ASSIGN   5970>>ASSIGN   5971<<ASSIGN   5971>>ASSIGN
      5973>>ASSIGN   5974<<ASSIGN   5974>>ASSIGN   5976>>IF       5979>>ASSIGN   5980<<ASSIGN   5980>>ASSIGN
      5981>>IF       5984>>ASSIGN   5988>>IF       5989>>ASSIGN   5991>>ASSIGN   5993>>ASSIGN   5994>>ASSIGN
      5996<<ASSIGN   5996>>ASSIGN   6022>>ASSIGN   6026>>ASSIGN   6027>>ASSIGN   6028<<ASSIGN   6028>>ASSIGN
      6031>>IF       6033>>ASSIGN   6034>>ASSIGN   6035>>ASSIGN   6151>>ASSIGN   6153>>ASSIGN   6154<<ASSIGN
DVT.GRANSIZE
      5539**DCL      5945>>ASSIGN
DVT.IDCW
      5541**DCL      5780>>ASSIGN
DVT.MPC
      5540**DCL      5541--REDEF
DVT.SCHED
      5538**DCL      6082>>ASSIGN
DVT$
      4607**DCL      5538--IMP-PTR  5723<<ASSIGN   5780>>ASSIGN   5945>>ASSIGN   6082>>ASSIGN
F$DCB.ACTPOS
      2977**DCL      2977--REDEF
F$DCB.ARS
      2952**DCL      2952--REDEF
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:104  
F$DCB.ATTR
      2970**DCL      2971--REDEF
F$DCB.BORROW
      2985**DCL      2985--REDEF    2985--REDEF    2985--REDEF
F$DCB.DCBNAME.L
      2999**DCL      2999--IMP-SIZ
F$DCB.EOMCHAR
      2956**DCL      2956--REDEF
F$DCB.FCN
      2989**DCL      6113<>CALL
F$DCB.FCN.CNT
      2989**DCL      5747<<ASSIGN   5747>>ASSIGN   5749<<ASSIGN   5749>>ASSIGN
F$DCB.FLDID
      2980**DCL      2980--REDEF
F$DCB.FORM$
      2974**DCL      2974--REDEF
F$DCB.FSECT
      2990**DCL      2990--REDEF
F$DCB.FSN
      2967**DCL      2967--REDEF    2967--REDEF    2968--REDEF
F$DCB.HEADER$
      2973**DCL      2973--REDEF
F$DCB.IXTNSIZE
      2971**DCL      2971--REDEF
F$DCB.LASTSTA$
      2961**DCL      2961--REDEF
F$DCB.LVL
      2986**DCL      2986--REDEF
F$DCB.NAME.C
      2961**DCL      2961--REDEF
F$DCB.NOEOF
      2982**DCL      2982--REDEF
F$DCB.NRECS
      2972**DCL      2972--REDEF
F$DCB.NRECX
      2991**DCL      2991--REDEF
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:105  
F$DCB.OHDR
      2983**DCL      2983--REDEF
F$DCB.ORG
      2966**DCL      2966--REDEF
F$DCB.PRECNO
      2989**DCL      2989--REDEF
F$DCB.RCSZ
      2994**DCL      2994--REDEF
F$DCB.RES
      2962**DCL      2962--REDEF
F$DCB.SETX
      2974**DCL      2974--REDEF
F$DCB.TAB$
      2973**DCL      2974--REDEF
F$DCB.TDA
      2988**DCL      2988--REDEF
F$DCB.WSN
      2963**DCL      2963--REDEF
FUNC
      4608**DCL      5778<<ASSIGN   5780<<ASSIGN   5872<>CALL     5888>>ASSIGN   5919>>ASSIGN   5926>>ASSIGN
      5948>>ASSIGN   5954>>ASSIGN   5968>>ASSIGN   5989>>ASSIGN   5999>>ASSIGN   6039>>ASSIGN   6043>>ASSIGN
      6052>>ASSIGN   6057>>ASSIGN
FUNC.CC
      4615**DCL      4616--REDEF
FUNC.CCB
      4616**DCL      5787>>ASSIGN
FUNC.DC
      4609**DCL      5893<<ASSIGN   5905<<ASSIGN   5910<<ASSIGN   5925<<ASSIGN   5932<<ASSIGN   5958<<ASSIGN
FUNC.DC2
      4613**DCL      5893>>ASSIGN   5905>>ASSIGN   5910>>ASSIGN   5925>>ASSIGN   5932>>ASSIGN   5958>>ASSIGN
      6044>>ASSIGN   6058>>ASSIGN
FUNC.DVN
      4611**DCL      5783<<ASSIGN
FUNC.RCNT
      4618**DCL      5916<<ASSIGN   5918<<ASSIGN   5935<<ASSIGN
FUNC.RTN
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:106  
      4610**DCL      4611--REDEF    5782>>ASSIGN
FUNC.TIMO
      4614**DCL      5784>>IF       5784>>ASSIGN
F_DCBLOCK
      4580**DCL      5744<>CALL     5751<>CALL
HFC$LOCK
      3056**DCL-ENT  5735--CALL     5744--CALL     6129--CALL
HFC$UNLOCK
      3056**DCL-ENT  5740--CALL     5751--CALL     6135--CALL
HW_IMX
      3042**DCL      5770>>IF       5835>>IF       5843>>IF       5857>>IF       5861>>IF       5889>>IF
      5920>>IF       5927>>IF       5949>>IF       5960>>IF       5969>>IF       5990>>IF       6010>>IF
      6016>>IF       6064>>IF       6152>>IF
HW_IOP
      3039**DCL      5708>>IF       5855>>IF       6014>>IF
IDCW
      5549**DCL      5851>>ASSIGN
IDCW.CC
      5564**DCL      5565--REDEF
IDCW.CONT
      5562**DCL      5837>>ASSIGN
IDCW.DATA.BASE
      5558**DCL      5836<<ASSIGN
IDCW.DVN
      5554**DCL      5834<<ASSIGN
IDCW.EXTA
      5555**DCL      5556--REDEF
IDCW.SVN
      5560**DCL      5824>>IF       5833>>IF
IOS$
      4619**DCL      5606--IMP-PTR  5761<<ASSIGN   5762>>ASSIGN   5766<<ASSIGN   5767>>ASSIGN   5768>>ASSIGN
      5769>>ASSIGN   5772>>ASSIGN   5785>>ASSIGN   5851>>ASSIGN   5852>>ASSIGN   5856>>ASSIGN   5858>>ASSIGN
      5862>>ASSIGN   5863>>ASSIGN   5866>>ASSIGN   5868>>ASSIGN   5878>>ASSIGN   5882>>ASSIGN   5887>>ASSIGN
      5888>>ASSIGN   5890>>ASSIGN   5891>>ASSIGN   5919>>ASSIGN   5921>>ASSIGN   5926>>ASSIGN   5928>>ASSIGN
      5938>>ASSIGN   5939>>ASSIGN   5945>>ASSIGN   5948>>ASSIGN   5950>>ASSIGN   5954>>ASSIGN   5956>>ASSIGN
      5961>>ASSIGN   5962>>ASSIGN   5968>>ASSIGN   5970>>ASSIGN   5973>>ASSIGN   5979>>ASSIGN   5983>>ASSIGN
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:107  
      5984>>ASSIGN   5989>>ASSIGN   5991>>ASSIGN   5993>>ASSIGN   5994>>ASSIGN   5999>>ASSIGN   6001>>ASSIGN
      6004>>ASSIGN   6011>>ASSIGN   6015>>ASSIGN   6017>>ASSIGN   6022>>ASSIGN   6026>>ASSIGN   6027>>ASSIGN
      6033>>ASSIGN   6034>>ASSIGN   6035>>ASSIGN   6039>>ASSIGN   6040>>ASSIGN   6041>>ASSIGN   6042>>ASSIGN
      6043>>ASSIGN   6044>>ASSIGN   6045>>ASSIGN   6046>>ASSIGN   6047>>ASSIGN   6052>>ASSIGN   6053>>ASSIGN
      6054>>ASSIGN   6055>>ASSIGN   6056>>ASSIGN   6057>>ASSIGN   6058>>ASSIGN   6059>>ASSIGN   6060>>ASSIGN
      6061>>ASSIGN   6142>>IF       6143>>CALL     6146>>ASSIGN   6147>>ASSIGN   6148>>ASSIGN   6150>>ASSIGN
      6151>>ASSIGN   6153>>ASSIGN   6155<<ASSIGN   6155>>ASSIGN
KQR$READ
      4556**DCL-ENT  6103--CALL
KQW$WRITE
      4557**DCL-ENT  6101--CALL
MBX$
      4620**DCL      5585--IMP-PTR  5762<<ASSIGN   5769<<ASSIGN   5771>>ASSIGN   6066>>ASSIGN   6067>>ASSIGN
      6068>>ASSIGN   6069>>ASSIGN   6070>>ASSIGN   6073>>ASSIGN   6074>>ASSIGN   6075>>ASSIGN   6076>>ASSIGN
      6079>>ASSIGN
N$DCT$
      3742**DCL      5693>>ASSIGN
N$DCT$$
      3608**DCL      3742--IMP-PTR  5693>>ASSIGN
N$FQ$
      3608**DCL      3743--IMP-PTR
N$REQ
      4504**DCL         8--PROC     5654--ENTRY    5660--ENTRY    5796<>CALL     5800<>CALL     5803<>CALL
      5826<>CALL     5872<>CALL     5874<>CALL     5885<>CALL     6083<>CALL     6088<>CALL     6101<>CALL
      6103<>CALL     6132<>CALL
N$REQ.ARCT
      4539**DCL      5727<<ASSIGN   5871<<ASSIGN   5923<<ASSIGN   5930<<ASSIGN
N$REQ.ARSIZE
      4537**DCL      5728<<ASSIGN
N$REQ.BUF$
      4513**DCL      5702<>CALL     5824>>IF       5832>>ASSIGN   5851>>ASSIGN   5879>>ASSIGN   5897>>ASSIGN
      5902>>ASSIGN   6038>>ASSIGN
N$REQ.BUFADDR
      4513**DCL      4514--REDEF    4514--REDEF    5704<<ASSIGN   5708>>IF       5710>>ASSIGN   5716<<ASSIGN
      5719>>ASSIGN
N$REQ.BUFREAL_SV
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:108  
      4546**DCL      5710<<ASSIGN
N$REQ.BUFREAL_SV.DIV64PG
      4546**DCL      5711>>ASSIGN
N$REQ.BUFREAL_SV.MOD64PG
      4546**DCL      5716>>ASSIGN
N$REQ.BUFSIZE
      4507**DCL      5722>>ASSIGN   5900>>ASSIGN   5901>>ASSIGN   5939>>ASSIGN
N$REQ.COMP
      4538**DCL      6086<<ASSIGN   6098<<ASSIGN
N$REQ.DCB$
      4535**DCL      5684--IF       5685--ASSIGN   5686>>ASSIGN   6112>>IF       6113>>CALL
N$REQ.DCT$
      4505**DCL      5694<<ASSIGN
N$REQ.DLA.DCTX
      4504**DCL      5687>>IF       5687>>IF       5693>>ASSIGN
N$REQ.DLA.DRELADDR
      4505**DCL      4505--REDEF    5945>>ASSIGN
N$REQ.DLA.MPC.MEMADDR
      4505**DCL      5938>>ASSIGN
N$REQ.DVE.DVBYTE
      4539**DCL      5893>>IF       5905>>IF       5932>>IF
N$REQ.DVE.EOMCHAR
      4542**DCL      4543--REDEF
N$REQ.EAINFO
      4536**DCL      4536--REDEF
N$REQ.EAINFOX
      4536**DCL      4537--REDEF
N$REQ.ERRCT
      4506**DCL      5775<<ASSIGN
N$REQ.EVNTINFO
      4537**DCL      4537--REDEF
N$REQ.FC
      4507**DCL      5776>>IF       5776<<ASSIGN   5777>>IF       5780>>ASSIGN   6099>>DOCASE
N$REQ.IOFLG.IOS
      4508**DCL      5759>>IF       5763<<ASSIGN   6122>>IF       6125<<ASSIGN
N$REQ.IOFLG.LPW23
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:109  
      4508**DCL      5854<<ASSIGN   5946<<ASSIGN   5987<<ASSIGN   6009<<ASSIGN
N$REQ.IOFLG.MREC
      4509**DCL      5922<<ASSIGN   5929<<ASSIGN
N$REQ.IOP_BUFREAL_CVRT
      4544**DCL      5717<<ASSIGN
N$REQ.IOQFLG.INUSE
      4547**DCL      5667>>IF
N$REQ.IOQFLG.IOQUED
      4547**DCL      5662<<ASSIGN   5667>>IF       5683<<ASSIGN   6097<<ASSIGN   6121<<ASSIGN
N$REQ.IOS$
      4517**DCL      5760<>CALL     5761>>ASSIGN   5766>>ASSIGN   6078>>ASSIGN   6123<>CALL     6124<<ASSIGN
N$REQ.LPWX.BASE
      4516**DCL      5859<<ASSIGN   6018<<ASSIGN   6049<<ASSIGN   6069>>ASSIGN
N$REQ.LPWX.BOUND
      4516**DCL      5860<<ASSIGN   6019<<ASSIGN   6050<<ASSIGN   6070>>ASSIGN
N$REQ.NOALT
      4507**DCL      6127>>IF
N$REQ.NWIO
      4543**DCL      5746>>IF       6113>>CALL
N$REQ.OPFLG.BPF
      4512**DCL      5701>>IF       5703<<ASSIGN
N$REQ.OPFLG.USER
      4510**DCL      5729>>IF       6111>>IF
N$REQ.OPFLG.WAIT
      4511**DCL      6111>>IF
N$REQ.PTP
      4515**DCL      5705<<ASSIGN   5708>>IF       5711<<ASSIGN   5714<<ASSIGN   5714>>ASSIGN   5714>>ASSIGN
      5720>>ASSIGN
N$REQ.RCT
      4539**DCL      5871>>ASSIGN   5908>>IF       5909>>ASSIGN   5913>>ASSIGN   5925>>IF
N$REQ.STATUS
      4518**DCL      4524--REDEF
N$REQ.TIMOUT
      4506**DCL      5784<<ASSIGN
N$REQ.TYC
      4526**DCL      5726<<ASSIGN
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:110  
N$REQ.TYC.IOERR
      4529**DCL      5795<<ASSIGN   5799<<ASSIGN   5825<<ASSIGN
N$REQ.USER#
      4538**DCL      5730<<ASSIGN
N$REQ_INIT.BUFADDR
      3627**DCL      3628--REDEF    3628--REDEF
N$REQ_INIT.DLA.DRELADDR
      3619**DCL      3619--REDEF
N$REQ_INIT.DVE.EOMCHAR
      3656**DCL      3657--REDEF
N$REQ_INIT.EAINFO
      3650**DCL      3650--REDEF
N$REQ_INIT.EAINFOX
      3650**DCL      3651--REDEF
N$REQ_INIT.EVNTINFO
      3651**DCL      3651--REDEF
N$REQ_INIT.STATUS
      3632**DCL      3638--REDEF
NI$FQ$
      3668**DCL      3744--IMP-PTR
NI$IBUF$
      3668**DCL      3744--IMP-PTR
NI$IMXMBX
      5585**DCL      5771<<ASSIGN
NI$IMXMBX.LPW.DCW_ADDR
      5591**DCL      6079<<ASSIGN
NI$IMXMBX.NPAGED_IND.PHYS
      5586**DCL      6073<<ASSIGN   6075<<ASSIGN
NI$IMXMBX.PAGED_BASE
      5585**DCL      5586--REDEF    5586--REDEF    6066<<ASSIGN
NI$IMXMBX.PAGED_BASE.OFFSET
      5585**DCL      6069<<ASSIGN
NI$IMXMBX.PAGED_BASE.PTWADDR
      5585**DCL      6068<<ASSIGN
NI$IMXMBX.SIZE
      5587**DCL      5587--REDEF    6067<<ASSIGN   6070<<ASSIGN   6074<<ASSIGN   6076<<ASSIGN
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:111  
NI$IMXMBX_INIT
      3678**DCL      5771>>ASSIGN
NI$IMXMBX_INIT.PAGED_BASE
      3678**DCL      3679--REDEF    3679--REDEF
NI$IMXMBX_INIT.SIZE
      3680**DCL      3680--REDEF
NI$REQ
      5606**DCL      5768<<ASSIGN   6147<<ASSIGN
NI$REQ.DCW
      5608**DCL      5611--REDEF    5862<<ASSIGN   5866<<ASSIGN   5891<<ASSIGN   5956<<ASSIGN   5961--ASSIGN
      5962<<ASSIGN   5973<<ASSIGN   5979<<ASSIGN   5983--ASSIGN   5984<<ASSIGN   6078--ASSIGN   6150--ASSIGN
      6151<<ASSIGN
NI$REQ.DCW.FWA
      5608**DCL      5868<<ASSIGN   6026<<ASSIGN   6033<<ASSIGN   6040<<ASSIGN   6045<<ASSIGN   6054<<ASSIGN
      6060<<ASSIGN
NI$REQ.DCW.ICP
      5608**DCL      6022<<ASSIGN
NI$REQ.DCW.T.DCWLIST.BASE
      5610**DCL      5863<<ASSIGN   6153<<ASSIGN
NI$REQ.DCW.TALLY
      5609**DCL      5609--REDEF    6034<<ASSIGN   6042<<ASSIGN   6047<<ASSIGN   6055<<ASSIGN
NI$REQ.DCW.TYPE
      5609**DCL      6027<<ASSIGN   6035<<ASSIGN   6041<<ASSIGN   6046<<ASSIGN   6056<<ASSIGN   6061<<ASSIGN
NI$REQ.FL$
      5606**DCL      5767>>ASSIGN   5772<<ASSIGN   6142>>IF       6143<>CALL     6146>>ASSIGN   6146>>ASSIGN
      6147>>ASSIGN   6148>>ASSIGN   6148<<ASSIGN   6150>>ASSIGN   6155>>ASSIGN
NI$REQ.IDCW
      5611**DCL      5888<<ASSIGN   5919<<ASSIGN   5926<<ASSIGN   5948<<ASSIGN   5968<<ASSIGN   5989<<ASSIGN
      6039<<ASSIGN   6043<<ASSIGN   6052<<ASSIGN   6057<<ASSIGN
NI$REQ.IDCW.DATA.BASE
      5611**DCL      5890<<ASSIGN   5921<<ASSIGN   5928<<ASSIGN   5950<<ASSIGN   5970<<ASSIGN   5991<<ASSIGN
      6053<<ASSIGN   6059<<ASSIGN
NI$REQ.IDCW.DC
      5611**DCL      6044<<ASSIGN   6058<<ASSIGN
NI$REQ.IDCW.EC
      5612**DCL      5994<<ASSIGN
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:112  
NI$REQ.IDCW.EXTA
      5611**DCL      5611--REDEF    5993<<ASSIGN
NI$REQ.IOP_PTAW
      5606**DCL      5856<<ASSIGN   6015<<ASSIGN
NI$REQ.MPCSEEK.COUNT
      5619**DCL      5939<<ASSIGN
NI$REQ.MPCSEEK.MEMADDR
      5619**DCL      5938<<ASSIGN
NI$REQ.PCW
      5613**DCL      5617--REDEF    5851<<ASSIGN   5954<<ASSIGN   5999<<ASSIGN
NI$REQ.PCW.AEX
      5613**DCL      6001<<ASSIGN
NI$REQ.PCW.FLAGS
      5617**DCL      5852<<ASSIGN   6004<<ASSIGN   6011<<ASSIGN
NI$REQ.PCW.PTP
      5617**DCL      5858<<ASSIGN   6017<<ASSIGN
NI$REQ.SEEK
      5618**DCL      5619--REDEF    5620--REDEF    5785--ASSIGN   5878<<ASSIGN   5882<<ASSIGN   5887<<ASSIGN
      5945<<ASSIGN
NI$REQ_INIT
      3700**DCL      5768>>ASSIGN   6147>>ASSIGN
NI$REQ_INIT.DCW
      3702**DCL      3705--REDEF
NI$REQ_INIT.DCW.TALLY
      3703**DCL      3703--REDEF
NI$REQ_INIT.IDCW.EXTA
      3705**DCL      3705--REDEF
NI$REQ_INIT.PCW
      3707**DCL      3711--REDEF
NI$REQ_INIT.SEEK
      3712**DCL      3713--REDEF    3714--REDEF
NI$RP.GATE
      3746**DCL      6129<>CALL     6135<>CALL
NI$RP.RQ$
      3746**DCL      6132<>CALL
NI$RP$
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:113  
      3716**DCL      3746--IMP-PTR  6129>>CALL     6132>>CALL     6135>>CALL
NIM$CVTPTR
      4558**DCL-ENT  5702--CALL
NIM$ENQUEUE
      3955**DCL-ENT  6088--CALL     6132--CALL
NIO$COMP
      4559**DCL-ENT  5796--CALL     5800--CALL     5803--CALL     5826--CALL     5874--CALL
NIQ$GETS
      4560**DCL-ENT  5760--CALL     6143--CALL
NIQ$RELS
      4561**DCL-ENT  6123--CALL
NIU$CRPEXTST
      4562**DCL-ENT  5885--CALL
NIU$SYMBLOCK
      4563**DCL-ENT  5872--CALL
NI_IMXLO_PBASE
      3718**DCL      6066>>ASSIGN
NI_MBX_INIT.DCW.CONTROL.AE
      3738**DCL      3738--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      3734**DCL      3734--REDEF
NI_MFGATE
      3741**DCL      5735<>CALL     5740<>CALL
NK_MXTOTAL
      4581**DCL      5687>>IF
NOBUF
      4621**DCL      5787<<ASSIGN   5992>>IF       6000>>IF       6007>>IF
NQPKTS
      6121**LABEL    5760--CALLALT  5885--CALLALT  5976--CALLALT  5981--CALLALT  6031--CALLALT
ONECHAR
      5622**DCL      5879<<ASSIGN   5879>>ASSIGN
PNTR.WA
      4624**DCL      5962>>ASSIGN   5984>>ASSIGN   6040>>ASSIGN   6045>>ASSIGN   6079>>ASSIGN
PNTR$
      4622**DCL      4623--REDEF    5767<<ASSIGN   5772>>ASSIGN   5832<<ASSIGN   5833>>IF       5834>>ASSIGN
      5836>>ASSIGN   5837>>ASSIGN   5840>>DOCASE   5842>>ASSIGN   5844>>ASSIGN   5961<<ASSIGN   5983<<ASSIGN
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:114  
      6038<<ASSIGN   6078<<ASSIGN
POINTER.SEGID
      5627**DCL      5684>>IF       5685<<ASSIGN
PSIA
      4626**DCL      5786<<ASSIGN   5850>>IF       5868>>ASSIGN   5947>>IF       5988>>IF
PTP
      4627**DCL      5702<>CALL     5705>>ASSIGN   5720<<ASSIGN   5856>>ASSIGN   5858>>ASSIGN   5960>>IF
      5992>>IF       6000>>IF       6008>>IF       6015>>ASSIGN   6017>>ASSIGN   6065>>IF       6068>>ASSIGN
QUE
      4628**DCL      5649<<ASSIGN   5655<<ASSIGN   5661<<ASSIGN   5725>>IF       6081>>IF       6111>>IF
QUECMN
      5662**LABEL    5650--GOTO     5656--GOTO
RCTTEMP
      4629**DCL      5909<<ASSIGN   5913<<ASSIGN   5915>>IF       5918>>ASSIGN
RTN
      4630**DCL      5782<<ASSIGN   5788>>DOCASE   5959>>IF
RTN_DP_SEEK
      5946**LABEL    5880--GOTO     5883--GOTO     5940--GOTO
RTN_STD
      5988**LABEL    5965--GOTO
RTN_STD0
      5987**LABEL    5894--GOTO     5898--GOTO     5903--GOTO     5906--GOTO     5933--GOTO     5936--GOTO
S$CU$
      4576**DCL      5732>>IF       5732>>IF       5737>>ASSIGN   5737>>ASSIGN   5738>>ASSIGN   5738>>ASSIGN
SCHED
      4631**DCL      6082<<ASSIGN   6083>>CALL
SC_NIOBADFC
      4564**DCL-ENT  5790--CALL
SC_NIOBADIOQ
      4565**DCL-ENT  5681--CALL
SC_NIOINVDLA
      4566**DCL-ENT  5688--CALL
SC_NIONRD
      4567**DCL-ENT  6090--CALL     6108--CALL
SEEK.WA
      4634**DCL      5891>>ASSIGN   5956>>ASSIGN
PL6.E3A0      #001=NIO$QUE File=NIO$QUE.:E05TSI                                  WED 07/30/97 03:34 Page:115  
SEEK$
      4632**DCL      4633--REDEF    5785<<ASSIGN   5879>>ASSIGN
SIZE
      4636**DCL      6024<<ASSIGN   6025>>DOWHILE  6029<<ASSIGN   6029>>ASSIGN   6034>>ASSIGN
SL_IOTA
      4583**DCL      5731>>ASSIGN
SL_MF
      4584**DCL      5732>>IF
SQH.DOOR
      5637**DCL      5637--REDEF
SQH$
      4637**DCL      5637--IMP-PTR
SSR$REG
      4568**DCL-ENT  5733--CALL     6113--CALL     6115--CALL
S_CUN
      4582**DCL      5730>>ASSIGN
TDCW IN PROCEDURE CHAINIOS
      6141**DCL      6151>>ASSIGN
TDCW$ IN PROCEDURE CHAINIOS
      6140**DCL      6141--REDEF    6146<<ASSIGN   6148>>ASSIGN   6150<<ASSIGN
X
      4638**DCL      5829<<ASSIGN   5832>>ASSIGN   5838<<ASSIGN   5838>>ASSIGN   5842<<ASSIGN   5846<<ASSIGN
      5846>>ASSIGN   5848>>IF

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:116  
      640        1        /*M*      NIO$COMP - I/O COMPLETION ROUTINE                                  */
      641        2        /*T***********************************************************/
      642        3        /*T*                                                         */
      643        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      644        5        /*T*                                                         */
      645        6        /*T***********************************************************/
      646        7        NIO$COMP: PROC(N$REQ,NI$EXTST);
      647        8        /*
      648        9                Includes
      649       10        */
      650       11        %INCLUDE                B$USER ;
      651      227        %INCLUDE                B_SEGIDS_C ;
      652      766        %INCLUDE                B_STRINGS_C ;
      653      895        %INCLUDE                CP_6 ;
      654     6454        %INCLUDE                CP_6_SUBS ;
      655     6994        %INCLUDE                F$DCB ;
      656     7043        %INCLUDE                HF_DATA_R ;
      657     7086        %INCLUDE                HF_LOCK_C ;
      658     7100        %INCLUDE                NI_DATA_C ;
      659     7213        %INCLUDE                NI_DATA_R ;
      660     7650        %INCLUDE                NI_MACROS_C ;
      661     7917        %INCLUDE                N_FC_C ;
      662     7954        %INCLUDE                SS_SCHED_C ;
      663     8187        %INCLUDE                S_WSPTD_R ;
      664     8203        /*
      665     8204                Parameters
      666     8205        */
      667     8206        %N$REQ                  ( NAME=N$REQ,    STCLASS=PARAM ) ;
      668     8264        %NI$EXTST               ( NAME=NI$EXTST, STCLASS=PARAM ) ;
      669     8298        /*
      670     8299                Entries
      671     8300        */
      672     8301    1   DCL 1 HFC$ASSOCCLR      ENTRY(3) ;
      673     8302    1   DCL 1 NIA$RELERR        ENTRY(1) ;
      674     8303    1   DCL 1 NIO$REQUE         ENTRY(1) ALTRET ;
      675     8304    1   DCL 1 NIQ$GETID         ENTRY(1) ALTRET ;
      676     8305    1   DCL 1 NIQ$REL         ENTRY(1) ALTRET ; /* TO SATISFY LINKER */
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:117  
      677     8306    1   DCL 1 NIQ$RELS        ENTRY(1) ALTRET ; /* TO SATISFY LINKER */
      678     8307    1   DCL 1 SC_NIOBADIOQ      ENTRY CONV(2,0) ;
      679     8308    1   DCL 1 SSR$RUE           ENTRY(4) ;
      680     8309    1   DCL 1 SSV$EVENT         ENTRY(7) ;
      681     8310    1   DCL 1 SSV$SCHDDO        ENTRY(2) ;
      682     8311    1   DCL 1 TDC$COMP          ENTRY(2) ;
      683     8312        /*
      684     8313                Symrefs
      685     8314        */
      686     8315        %B$USERREFS;
      687     8319    1   DCL 1 F_DCBLOCK         BIT(72) SYMREF ALIGNED ;
      688     8320    1   DCL 1 NI_INTLVL         SBIN SYMREF ;
      689     8321    1   DCL 1 NI_COMPHD$        PTR SYMREF ;
      690     8322    1   DCL 1 S_ASFGATE         BIT(72) SYMREF ALIGNED ;
      691     8323    1   DCL 1 S_UDLGATE         BIT(72) SYMREF ALIGNED ;
      692     8324        /*
      693     8325                Auto
      694     8326        */
      695     8327    1   DCL 1 DCB$              PTR ALIGNED AUTO ;
      696     8328    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
      697     8329        %B$NWIO                 ( NAME=EVBLK,   STCLASS=AUTO, PARONLY=1 ) ;
      698     8410    1   DCL 1 EXRTN             EPTR ALIGNED AUTO ;
      699     8411        %NI$EXTST               ( NAME=EXTSTAT, STCLASS=AUTO ) ;
      700     8445    1   DCL 1 IOSTAT$           PTR ALIGNED AUTO ;
      701     8446    1   DCL 1 LSTA$             PTR ALIGNED AUTO ;
      702     8447    1   DCL 1 MDCT$             PTR ALIGNED AUTO ;
      703     8448    1   DCL 1 MDCTX             SBIN WORD ALIGNED AUTO ;
      704     8449    1   DCL 1 REL$              PTR ALIGNED AUTO ;
      705     8450    1   DCL 1 TEMP              UBIN ALIGNED AUTO ;
      706     8451    1   DCL 1 TYC               BIT(36) ALIGNED AUTO ;
      707     8452    1   DCL 1 UFLAG             UBIN ALIGNED AUTO ;
      708     8453        /*
      709     8454                Based
      710     8455        */
      711     8456        %B$EVNT ;
      712     8469        %NI$DCT                 ( NAME=NI$DCT, STCLASS=BASED ) ;
      713     8517        %NI$DVT                 ( NAME=DVT,    STCLASS=BASED ) ;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:118  
      714     8524        %NI$EXTST               ( NAME=EXTST,  STCLASS=BASED ) ;
      715     8558        %NI$REQ                 ( NAME=IOS,    STCLASS=BASED ) ;
      716     8583        %NI$IOSTAT              ( NAME=IOSTAT, STCLASS=BASED ) ;
      717     8592    1   DCL 1 POINTER           BASED ALIGNED,
      718     8593    1         2 ADR             BIT(24),
      719     8594    1         2 SEGID           BIT(12) ;
      720     8595        %VLP_STATION            ( FPTN=VSTA,   STCLASS=BASED ) ;
      721     8622        /*
      722     8623                Constants
      723     8624        */
      724     8625    1   DCL CHECKBITS BIT(36) CONSTANT INIT('370000770000'O);
      725     8626        %SUB B$USER="B$USRT$->B$USER";
      726     8627        %EJECT;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:119  
      727     8628    2           DO INHIBIT ;
      728     8629    3              IF NI_INTLVL>1 THEN DO ;
      729     8630    3                 IF N$REQ.IOS$ ~= ADDR(NIL) THEN
              8630                          /* store extended status in IOS packet */
      730     8631    3                    IF ADDR(NI$EXTST) ~= ADDR(NIL) THEN
      731     8632    3                       ADDR(N$REQ.IOS$->IOS.DCW(0))->EXTST = NI$EXTST ;
      732     8633    3                    ELSE
      733     8634    3                       ADDR(N$REQ.IOS$->IOS.DCW(0))->EXTST.EXTST = '0'B ;
      734     8635                      %ENQUEUE (P#=N$REQ,Q#=NI_COMPHD$) ;
      735     8638    3                 RETURN ;
      736     8639    3                 END ;
      737     8640    2              END ;
      738     8641
      739     8642
      740     8643
      741     8644    1   NIO$COMPX: ENTRY(N$REQ,NI$EXTST);
      742     8645    1           IF NOT N$REQ.IOQFLG.INUSE OR NOT N$REQ.IOQFLG.IOQUED THEN
      743     8646    1              CALL SC_NIOBADIOQ ;
      744     8647    1           N$REQ.IOQFLG.IOQUED = '0'B ;
      745     8648
      746     8649
      747     8650
      748     8651    1           IF N$REQ.FLTSTAT.DCW='0'B OR N$REQ.STATUS.NCP=7 THEN GOTO COMPCMN;
      749     8652             /* DPS90 zeroes out second word of status when no data is transferred */
      750     8653    1           TEMP=N$REQ.STATUS.NCP;
      751     8654    1           IF TEMP=0 THEN TEMP=4;
      752     8655    2           IF HW_IMX THEN DO;
      753     8656    2              IOSTAT$=PINCRW(N$REQ.IOS$,%IMX_STATUS_OFFSET);
      754     8657    2              N$REQ.ARSIZE=(IOSTAT$->IOSTAT.LAST_IDCW.COUNT-1)*4+TEMP;
      755     8658    2              END;
      756     8659    1           ELSE
      757     8660    1              N$REQ.ARSIZE=(N$REQ.STATUS.NWA-1)*4+TEMP-
      758     8661    1                MOD(N$REQ.BUFADDR,%BITBIN('4000000'O));
      759     8662    1           GOTO COMPCMN;
      760     8663
      761     8664
      762     8665
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:120  
      763     8666    1   NIO$COMPC: ENTRY(N$REQ);
      764     8667    1           N$REQ.COMP=%COMP_COM;
      765     8668    1           GOTO COMPCMN;
      766     8669
      767     8670
      768     8671
      769     8672    1   NIO$COMPCNS: ENTRY(N$REQ);
      770     8673    1           N$REQ.COMP=%COMP_COMNS;
      771     8674    1           GOTO COMPCMN;
      772     8675
      773     8676
      774     8677
      775     8678    1   NIO$COMPCW: ENTRY(N$REQ);
      776     8679    1           N$REQ.COMP=%COMP_COMW;
      777     8680
      778     8681
      779     8682
      780     8683    1   COMPCMN:
      781     8684    1           IF N$REQ.ERR$~=ADDR(NIL) THEN CALL NIA$RELERR(N$REQ);
      782     8685    1           DCT$ = N$DCT$(N$REQ.DLA.DCTX);
      783     8686    1           IF DCT$->NI$DCT.TYPE = %DV_DP AND DCT$->NI$DCT.DP.MIRROR.FLAG THEN
      784     8687    2           DO;
      785     8688    2              MDCTX = DCT$->NI$DCT.DP.MIRROR.DCTX;
      786     8689    2              MDCT$ = N$DCT$(MDCTX);
      787     8690    2              IF NOT DCT$->NI$DCT.DP.MIRROR.PRI AND NOT N$REQ.BPMIR THEN
      788     8691    3              DO;
      789     8692    3                 N$REQ.DLA.DCTX = MDCTX;
      790     8693    3                 N$REQ.DCT$ = MDCT$;
      791     8694    3                 END;
      792     8695    2              N$REQ.DOMIR = '0'B;
      793     8696    2              N$REQ.MIRDONE = '0'B;
      794     8697    2              N$REQ.BPMIR = '0'B;
      795     8698    2              END;
      796     8699    2           IF N$REQ.IOP_BUFREAL_CVRT THEN DO;
      797     8700             /* IOP CAN'T DO NON-PAGED IO ADDR > 16MW, CONVERT BACK BEFORE COMPING */
      798     8701    2              N$REQ.PTP=0;
      799     8702    2              N$REQ.BUFADDR=BITBIN(N$REQ.BUFREAL_SV);
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:121  
      800     8703    2              N$REQ.IOP_BUFREAL_CVRT='0'B;
      801     8704    2              END;
      802     8705    2           DO CASE(N$REQ.COMP);
      803     8706    2            CASE(%COMP_REG,%COMP_COM,%COMP_COMNS,%COMP_COMW,%COMP_MIRROR);
      804     8707    2              N$REQ.TYC.EGV='1'B;
      805     8708    3              IF N$REQ.OPFLG.EA THEN DO;
      806     8709    3                 N$REQ.OPFLG.REQ = '0'B;
      807     8710    3                 EXRTN = N$REQ.EAENTRY;
      808     8711    3                 CALL EXRTN(N$REQ) ALTRET(RECOMP);
      809     8712    4                 IF N$REQ.OPFLG.REQ THEN DO;
      810     8713    5                    IF N$REQ.OPFLG.CLR THEN DO;
      811     8714                            %LOCK (G#=S_ASFGATE);
      812     8717    5                       REL$=ADDR(B$USER(N$REQ.USER#));
      813     8718    5                       REL$->B$U.ASYNCH=REL$->B$U.ASYNCH|%U_CACHE;
      814     8719                            %UNLOCK (G#=S_ASFGATE);
      815     8722    5                       END;
      816     8723    4                    CALL NIQ$GETID(ADDR(N$REQ));
      817     8724    4                    N$REQ.ARCT=0;
      818     8725    4                    CALL NIO$REQUE(N$REQ) ALTRET(REQUE);
      819     8726    4                    RETURN;
      820     8727    4                    END;
      821     8728    3                 END;
      822     8729    3              IF N$REQ.OPFLG.CLR THEN DO;
      823     8730                      %LOCK (G#=S_ASFGATE);
      824     8733    3                 REL$=ADDR(B$USER(N$REQ.USER#));
      825     8734    3                 REL$->B$U.ASYNCH=REL$->B$U.ASYNCH|%U_CACHE;
      826     8735                      %UNLOCK (G#=S_ASFGATE);
      827     8738    3                 END;
      828     8739    2              IF N$REQ.TYC & ~%TYC_EGV THEN TYC=N$REQ.TYC;
      829     8740    2              ELSE TYC='0'B;
      830     8741    3              IF N$REQ.OPFLG.USER THEN DO;
      831     8742    3                 UFLAG=%SS_IOC;
      832     8743    4                 IF N$REQ.DCB$~=ADDR(NIL) THEN DO;
      833     8744                         %LOCK (G#=F_DCBLOCK);
      834     8747    4                    S_WSPTD.BLKNO(%IOENDWSQ)=B$USER.PT(N$REQ.USER#);
      835     8748    4                    CALL HFC$ASSOCCLR(%IOENDWSQ,0,16384); /*MAX Dense PT*/
      836     8749    4                    DCB$=N$REQ.DCB$;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:122  
      837     8750    4                    ADDR(DCB$)->POINTER.SEGID=%ROSEG8SID;
      838     8751    5                    IF N$REQ.OPFLG.ARS THEN DO;
      839     8752    5                       DCB$->F$DCB.ARS=N$REQ.ARSIZE;
      840     8753    5                       DCB$->F$DCB.EOMCHAR=N$REQ.DVE.EOMCHAR;
      841     8754    5                       DCB$->F$DCB.DVBYTE=N$REQ.DVE.DVBYTE;
      842     8755    5                       END;
      843     8756    5                    IF N$REQ.ERRCT~=0 THEN DO;
      844     8757    5                       DCB$->F$DCB.RETRYCNT=DCB$->F$DCB.RETRYCNT+N$REQ.ERRCT;
      845     8758    5                       END;
      846     8759    4                    IF N$REQ.COMP=%COMP_COM
      847     8760    4                      OR (N$REQ.COMP=%COMP_COMW AND
      848     8761    5                      NOT DCB$->F$DCB.LSTAOR) THEN DO;
      849     8762    5                       LSTA$=DCB$->F$DCB.LASTSTA$;
      850     8763    5                       ADDR(LSTA$)->POINTER.SEGID=%ROSEG8SID;
      851     8764    5                       LSTA$->VSTA=N$REQ.STATION.LSTA$->VSTA;
      852     8765    5                       END;
      853     8766    5                    IF N$REQ.NWIO=0 THEN DO;
      854     8767    5                       DCB$->F$DCB.TYC(0)=DCB$->F$DCB.TYC(0)|TYC;
      855     8768    5                       DCB$->F$DCB.FCN.CNT(0)=DCB$->F$DCB.FCN.CNT(0)-1;
      856     8769    5                       IF DCB$->F$DCB.FCN.CNT(0)=0 OR N$REQ.OPFLG.WAIT THEN
      857     8770    6                          IF DCB$->F$DCB.FCN.F(0) THEN DO;
      858     8771    6                             DCB$->F$DCB.FCN.F(0)='0'B;
      859     8772    6                             UFLAG=%SS_IOCU;
      860     8773    6                             END;
      861     8774    5                       END;
      862     8775    5                    ELSE DO;
      863     8776    5                       DCB$->F$DCB.TYC(1)=DCB$->F$DCB.TYC(1)|TYC;
      864     8777    5                       DCB$->F$DCB.FCN.CNT(1)=DCB$->F$DCB.FCN.CNT(1)-1;
      865     8778    5                       IF DCB$->F$DCB.FCN.CNT(1)=0 OR N$REQ.OPFLG.WAIT THEN
      866     8779    6                          IF DCB$->F$DCB.FCN.F(1) THEN DO;
      867     8780    6                             DCB$->F$DCB.FCN.F(1)='0'B;
      868     8781    6                             UFLAG=%SS_IOCU;
      869     8782    6                             END;
      870     8783    5                       END;
      871     8784                         %UNLOCK (G#=F_DCBLOCK);
      872     8787    4                    END;
      873     8788    4                 ELSE IF N$REQ.OPFLG.WAIT THEN DO;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:123  
      874     8789    4                       UFLAG=%SS_IOCU;
      875     8790    4                       END;
      876     8791    4                 IF N$REQ.OPFLG.EVNT THEN DO;
      877     8792                         %LOCK (G#=S_UDLGATE);
      878     8795    4                    N$REQ.DOPTR$->B$DO.IOCOMP.CNTR=N$REQ.DOPTR$->B$DO.IOCOMP.CNTR-1;
      879     8796    4                    N$REQ.DOPTR$->B$DO.IOCOMP.TYC=N$REQ.DOPTR$->B$DO.IOCOMP.TYC | TYC;
      880     8797    4                    N$REQ.DOPTR$->B$DO.IOCOMP.DVE=N$REQ.DVE;
      881     8798    4                    IF N$REQ.OPFLG.ARS THEN
      882     8799    4                       N$REQ.DOPTR$->B$DO.IOCOMP.ARS=N$REQ.DOPTR$->B$DO.IOCOMP.ARS+
              8799                                N$REQ.ARSIZE;
      883     8800    5                    IF N$REQ.DOPTR$->B$DO.IOCOMP.CNTR=0 THEN DO;
      884     8801    5                       TEMP=N$REQ.USER#;
      885     8802                            %UNLOCK (G#=S_UDLGATE);
      886     8805    5                       CALL SSV$SCHDDO(N$REQ.DOPTR$,TEMP);
      887     8806    5                       END;
      888     8807    4                    ELSE
      889     8808                            %UNLOCK (G#=S_UDLGATE);
      890     8811    4                    END;
      891     8812    4                 ELSE IF N$REQ.EVNTINFO~=0 THEN DO;
      892     8813    4                       EVBLK.TYC=N$REQ.TYC;
      893     8814    4                       EVBLK.ARS=N$REQ.ARSIZE;
      894     8815    4                       EVBLK.DVE=N$REQ.DVE;
      895     8816    4                       IF N$REQ.COMP=%COMP_COM
      896     8817    5                         OR N$REQ.COMP=%COMP_COMW THEN DO;
      897     8818    5                          EVBLK.CGPARM=N$REQ.STATION.LSTA$->VSTA;
      898     8819    5                          EVBLK.P#=SIZEW(EVBLK)-SIZEW(EVBLK.P#);
      899     8820    5                          END;
      900     8821    4                       ELSE EVBLK.P#=SIZEW(EVBLK)-SIZEW(EVBLK.P#)-SIZEW(EVBLK.CGPARM);
      901     8822    4                       TEMP=N$REQ.WSR;
      902     8823    4                       CALL SSV$EVENT(N$REQ.USER#,TEMP,%EVSC_IO#,N$REQ.EVNTINFO,0,ADDR(
              8823                                EVBLK));
      903     8824    4                       END;
      904     8825    4                 IF N$DCT$(N$REQ.DLA.DCTX)->NI$DCT.DFLG.CM THEN DO;
      905     8826                         %LOCK (G#=NI_MFGATE);
      906     8829    4                    B$USER.CMF(N$REQ.USER#)=B$USER.CMF(N$REQ.USER#)-1;
      907     8830                         %UNLOCK (G#=NI_MFGATE);
      908     8833    4                    END;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:124  
      909     8834    3                 CALL SSR$RUE(UFLAG,N$REQ.USER#);
      910     8835    3                 END;
      911     8836    2            CASE(%COMP_TD);
      912     8837    2              IF ADDR(NI$EXTST) = ADDR(NIL) THEN
      913     8838    2                 EXTSTAT.EXTST = '0'B;
      914     8839    2              ELSE
      915     8840    2                 EXTSTAT = NI$EXTST;
      916     8841    2              CALL TDC$COMP(N$REQ,EXTSTAT);
      917     8842    2            END;
      918     8843    1           IF NOT N$REQ.OPFLG.HOLD
      919     8844    1           THEN CALL NIQ$REL(ADDR(N$REQ));
      920     8845    1           RETURN;
      921     8846        /**/
      922     8847    1   REQUE:  ;
      923     8848    1           IF NOT N$REQ.NOALT THEN GOTO RECOMP;
      924     8849    1           N$REQ.IOQFLG.IOQUED = '1'B ;
      925     8850                %LOCK (G#=NI$RP.GATE);
      926     8853                %ENQUEUE (P#=N$REQ,Q#=NI$RP.RQ$);
      927     8856                %UNLOCK (G#=NI$RP.GATE);
      928     8859    1           RETURN;
      929     8860    1   RECOMP: ;
      930     8861    1           N$REQ.IOQFLG.IOQUED = '1'B ;
      931     8862                %LOCK (G#=NI$RP.GATE);
      932     8865                %ENQUEUE (P#=N$REQ,Q#=NI$RP.RC$);
      933     8868                %UNLOCK (G#=NI$RP.GATE);
      934     8871    1           RETURN;
      935     8872        /**/
      936     8873    1   END NIO$COMP;
      937     8874        %EOD;

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:125  
--  Include file information  --

   S_WSPTD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIO$COMP.

   Procedure NIO$COMP requires 617 words for executable code.
   Procedure NIO$COMP requires 46 words of local(AUTO) storage.

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:126  

 Object Unit name= NIO$COMP                                   File name= NIO$QUE.:E05TOU
 UTS= JUL 30 '97 03:36:37.12 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS      1      1  NIO$COMP
    2   Proc  even  none   617   1151  NIO$COMP
    3  RoData even  none    19     23  NIO$COMP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        2  NIO$COMP
     2     37                  yes      Std        2  NIO$COMPX
     2    131                  yes      Std        1  NIO$COMPC
     2    141                  yes      Std        1  NIO$COMPCNS
     2    151                  yes      Std        1  NIO$COMPCW
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:127  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 NIM$ENQUEUE
         yes           Std       1 NIA$RELERR
         yes           Std       1 HFC$UNLOCK
         yes           Std       3 HFC$ASSOCCLR
 yes     yes           Std       1 NIQ$REL
 yes     yes           Std       1 NIQ$GETID
         yes           Std       7 SSV$EVENT
         yes           Std       1 HFC$LOCK
         yes           Std       2 SSV$SCHDDO
         yes           Std       4 SSR$RUE
         yes           Std       2 TDC$COMP
 yes     yes           Std       1 NIO$REQUE
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_NIOBADIOQ                          M$UC                                  HW_IMX
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                              NI$RP$                                NI_MFGATE
     S_WSPTD                               B$USRT$                               F_DCBLOCK
     NI_INTLVL                             NI_COMPHD$                            S_ASFGATE
     S_UDLGATE                             B_VECTNIL
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:128  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:129  


      640        1        /*M*      NIO$COMP - I/O COMPLETION ROUTINE                                  */
      641        2        /*T***********************************************************/
      642        3        /*T*                                                         */
      643        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      644        5        /*T*                                                         */
      645        6        /*T***********************************************************/
      646        7        NIO$COMP: PROC(N$REQ,NI$EXTST);

      7  2 000000   000000 700200 xent  NIO$COMP     TSX0  ! X66_AUTO_2
         2 000001   000056 000002                    ZERO    46,2

      647        8        /*
      648        9                Includes
      649       10        */
      650       11        %INCLUDE                B$USER ;
      651      227        %INCLUDE                B_SEGIDS_C ;
      652      766        %INCLUDE                B_STRINGS_C ;
      653      895        %INCLUDE                CP_6 ;
      654     6454        %INCLUDE                CP_6_SUBS ;
      655     6994        %INCLUDE                F$DCB ;
      656     7043        %INCLUDE                HF_DATA_R ;
      657     7086        %INCLUDE                HF_LOCK_C ;
      658     7100        %INCLUDE                NI_DATA_C ;
      659     7213        %INCLUDE                NI_DATA_R ;
      660     7650        %INCLUDE                NI_MACROS_C ;
      661     7917        %INCLUDE                N_FC_C ;
      662     7954        %INCLUDE                SS_SCHED_C ;
      663     8187        %INCLUDE                S_WSPTD_R ;
      664     8203        /*
      665     8204                Parameters
      666     8205        */
      667     8206        %N$REQ                  ( NAME=N$REQ,    STCLASS=PARAM ) ;
      668     8264        %NI$EXTST               ( NAME=NI$EXTST, STCLASS=PARAM ) ;
      669     8298        /*
      670     8299                Entries
      671     8300        */
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:130  
      672     8301    1   DCL 1 HFC$ASSOCCLR      ENTRY(3) ;
      673     8302    1   DCL 1 NIA$RELERR        ENTRY(1) ;
      674     8303    1   DCL 1 NIO$REQUE         ENTRY(1) ALTRET ;
      675     8304    1   DCL 1 NIQ$GETID         ENTRY(1) ALTRET ;
      676     8305    1   DCL 1 NIQ$REL         ENTRY(1) ALTRET ; /* TO SATISFY LINKER */
      677     8306    1   DCL 1 NIQ$RELS        ENTRY(1) ALTRET ; /* TO SATISFY LINKER */
      678     8307    1   DCL 1 SC_NIOBADIOQ      ENTRY CONV(2,0) ;
      679     8308    1   DCL 1 SSR$RUE           ENTRY(4) ;
      680     8309    1   DCL 1 SSV$EVENT         ENTRY(7) ;
      681     8310    1   DCL 1 SSV$SCHDDO        ENTRY(2) ;
      682     8311    1   DCL 1 TDC$COMP          ENTRY(2) ;
      683     8312        /*
      684     8313                Symrefs
      685     8314        */
      686     8315        %B$USERREFS;
      687     8319    1   DCL 1 F_DCBLOCK         BIT(72) SYMREF ALIGNED ;
      688     8320    1   DCL 1 NI_INTLVL         SBIN SYMREF ;
      689     8321    1   DCL 1 NI_COMPHD$        PTR SYMREF ;
      690     8322    1   DCL 1 S_ASFGATE         BIT(72) SYMREF ALIGNED ;
      691     8323    1   DCL 1 S_UDLGATE         BIT(72) SYMREF ALIGNED ;
      692     8324        /*
      693     8325                Auto
      694     8326        */
      695     8327    1   DCL 1 DCB$              PTR ALIGNED AUTO ;
      696     8328    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
      697     8329        %B$NWIO                 ( NAME=EVBLK,   STCLASS=AUTO, PARONLY=1 ) ;
      698     8410    1   DCL 1 EXRTN             EPTR ALIGNED AUTO ;
      699     8411        %NI$EXTST               ( NAME=EXTSTAT, STCLASS=AUTO ) ;
      700     8445    1   DCL 1 IOSTAT$           PTR ALIGNED AUTO ;
      701     8446    1   DCL 1 LSTA$             PTR ALIGNED AUTO ;
      702     8447    1   DCL 1 MDCT$             PTR ALIGNED AUTO ;
      703     8448    1   DCL 1 MDCTX             SBIN WORD ALIGNED AUTO ;
      704     8449    1   DCL 1 REL$              PTR ALIGNED AUTO ;
      705     8450    1   DCL 1 TEMP              UBIN ALIGNED AUTO ;
      706     8451    1   DCL 1 TYC               BIT(36) ALIGNED AUTO ;
      707     8452    1   DCL 1 UFLAG             UBIN ALIGNED AUTO ;
      708     8453        /*
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:131  
      709     8454                Based
      710     8455        */
      711     8456        %B$EVNT ;
      712     8469        %NI$DCT                 ( NAME=NI$DCT, STCLASS=BASED ) ;
      713     8517        %NI$DVT                 ( NAME=DVT,    STCLASS=BASED ) ;
      714     8524        %NI$EXTST               ( NAME=EXTST,  STCLASS=BASED ) ;
      715     8558        %NI$REQ                 ( NAME=IOS,    STCLASS=BASED ) ;
      716     8583        %NI$IOSTAT              ( NAME=IOSTAT, STCLASS=BASED ) ;
      717     8592    1   DCL 1 POINTER           BASED ALIGNED,
      718     8593    1         2 ADR             BIT(24),
      719     8594    1         2 SEGID           BIT(12) ;
      720     8595        %VLP_STATION            ( FPTN=VSTA,   STCLASS=BASED ) ;
      721     8622        /*
      722     8623                Constants
      723     8624        */
      724     8625    1   DCL CHECKBITS BIT(36) CONSTANT INIT('370000770000'O);
      725     8626        %SUB B$USER="B$USRT$->B$USER";
      726     8627        %EJECT;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:132  
      727     8628    2           DO INHIBIT ;

      728     8629    3              IF NI_INTLVL>1 THEN DO ;

   8629  2 000002   000000 235200 xsym               LDA   ! NI_INTLVL
         2 000003   000001 115207                    CMPA  ! 1,DL
         2 000004   000036 604600 2                  TMOZ  ! s:8640

      729     8630    3                 IF N$REQ.IOS$ ~= ADDR(NIL) THEN
              8630                          /* store extended status in IOS packet */

   8630  2 000005   200003 470700                    LDP0  ! @N$REQ,,AUTO
         2 000006   000012 236300                    LDQ   ! 10,,PR0
         2 000007   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         2 000010   000026 600200 2                  TZE   ! s:8636

      730     8631    3                    IF ADDR(NI$EXTST) ~= ADDR(NIL) THEN

   8631  2 000011   200004 236300                    LDQ   ! @NI$EXTST,,AUTO
         2 000012   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         2 000013   000022 600200 2                  TZE   ! s:8634

      731     8632    3                       ADDR(N$REQ.IOS$->IOS.DCW(0))->EXTST = NI$EXTST ;

   8632  2 000014   000012 471700                    LDP1  ! 10,,PR0
         2 000015   200004 473700                    LDP3  ! @NI$EXTST,,AUTO
         2 000016   000100 100700                    MLR   ! fill='000'O
         2 000017   300000 000040                    ADSC9   0,,PR3                   cn=0,n=32
         2 000020   100002 000040                    ADSC9   2,,PR1                   cn=0,n=32
         2 000021   000026 710200 2                  TRA   ! s:8636

      732     8633    3                    ELSE
      733     8634    3                       ADDR(N$REQ.IOS$->IOS.DCW(0))->EXTST.EXTST = '0'B ;

   8634  2 000022   000012 471700                    LDP1  ! 10,,PR0
         2 000023   000100 100600                    MLR   ! fill='000'O
         2 000024   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:133  
         2 000025   100002 000040                    ADSC9   2,,PR1                   cn=0,n=32

      734     8635                      %ENQUEUE (P#=N$REQ,Q#=NI_COMPHD$) ;

   8636  2 000026   000000 236200 3                  LDQ   ! 0
         2 000027   200003 235300                    LDA   ! @N$REQ,,AUTO
         2 000030   200046 757300                    STAQ  ! UFLAG+2,,AUTO
         2 000031   200046 630700                    EPPR0 ! UFLAG+2,,AUTO
         2 000032   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         2 000033   000000 701200 xent               TSX1  ! NIM$ENQUEUE
         2 000034   000000 011200                    NOP   ! 0

      735     8638    3                 RETURN ;

   8638  2 000035   000000 702200 xent               TSX2  ! X66_ARET

      736     8639    3                 END ;
      737     8640    2              END ;

   8640  2 000036   000041 710000 2                  TRA     s:8645

      738     8641
      739     8642
      740     8643
      741     8644    1   NIO$COMPX: ENTRY(N$REQ,NI$EXTST);

   8644  2 000037   000000 700200 xent  NIO$COMPX    TSX0  ! X66_AUTO_2
         2 000040   000056 000002                    ZERO    46,2

      742     8645    1           IF NOT N$REQ.IOQFLG.INUSE OR NOT N$REQ.IOQFLG.IOQUED THEN

   8645  2 000041   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000042   000033 234100                    SZN     27,,PR0
         2 000043   000047 605000 2                  TPL     s:8646
         2 000044   000033 236100                    LDQ     27,,PR0
         2 000045   200000 316003                    CANQ    65536,DU
         2 000046   000051 601000 2                  TNZ     s:8647
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:134  

      743     8646    1              CALL SC_NIOBADIOQ ;

   8646  2 000047   000000 713400 xsym               CLIMB   SC_NIOBADIOQ
         2 000050   000000 600000 xsid               climb   nvectors=         0

      744     8647    1           N$REQ.IOQFLG.IOQUED = '0'B ;

   8647  2 000051   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000052   000001 236000 3                  LDQ     1
         2 000053   000033 356100                    ANSQ    27,,PR0

      745     8648
      746     8649
      747     8650
      748     8651    1           IF N$REQ.FLTSTAT.DCW='0'B OR N$REQ.STATUS.NCP=7 THEN GOTO COMPCMN;

   8651  2 000054   000015 235100                    LDA     13,,PR0
         2 000055   000160 600000 2                  TZE     COMPCMN
         2 000056   000015 236100                    LDQ     13,,PR0
         2 000057   700000 376007                    ANQ     -32768,DL
         2 000060   700000 116007                    CMPQ    -32768,DL
         2 000061   000160 600000 2                  TZE     COMPCMN

      749     8652             /* DPS90 zeroes out second word of status when no data is transferred */
      750     8653    1           TEMP=N$REQ.STATUS.NCP;

   8653  2 000062   000015 236100                    LDQ     13,,PR0
         2 000063   000017 772000                    QRL     15
         2 000064   000007 376007                    ANQ     7,DL
         2 000065   200042 756100                    STQ     TEMP,,AUTO

      751     8654    1           IF TEMP=0 THEN TEMP=4;

   8654  2 000066   000071 601000 2                  TNZ     s:8655

   8654  2 000067   000004 235007                    LDA     4,DL
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:135  
         2 000070   200042 755100                    STA     TEMP,,AUTO

      752     8655    2           IF HW_IMX THEN DO;

   8655  2 000071   000000 234000 xsym               SZN     HW_IMX
         2 000072   000111 605000 2                  TPL     s:8660

      753     8656    2              IOSTAT$=PINCRW(N$REQ.IOS$,%IMX_STATUS_OFFSET);

   8656  2 000073   000012 236100                    LDQ     10,,PR0
         2 000074   000020 036003                    ADLQ    16,DU
         2 000075   200035 756100                    STQ     IOSTAT$,,AUTO

      754     8657    2              N$REQ.ARSIZE=(IOSTAT$->IOSTAT.LAST_IDCW.COUNT-1)*4+TEMP;

   8657  2 000076   200035 471500                    LDP1    IOSTAT$,,AUTO
         2 000077   100004 236100                    LDQ     4,,PR1
         2 000100   000010 772000                    QRL     8
         2 000101   000002 376000 3                  ANQ     2
         2 000102   200042 036100                    ADLQ    TEMP,,AUTO
         2 000103   000004 136007                    SBLQ    4,DL
         2 000104   000020 736000                    QLS     16
         2 000105   000027 676100                    ERQ     23,,PR0
         2 000106   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 000107   000027 656100                    ERSQ    23,,PR0

      755     8658    2              END;

   8658  2 000110   000130 710000 2                  TRA     s:8662

      756     8659    1           ELSE
      757     8660    1              N$REQ.ARSIZE=(N$REQ.STATUS.NWA-1)*4+TEMP-

   8660  2 000111   000015 236100                    LDQ     13,,PR0
         2 000112   000020 772000                    QRL     16
         2 000113   000003 376000 3                  ANQ     3
         2 000114   200042 036100                    ADLQ    TEMP,,AUTO
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:136  
         2 000115   200046 756100                    STQ     UFLAG+2,,AUTO
         2 000116   000006 236100                    LDQ     6,,PR0
         2 000117   000004 506003                    DIV     4,DU
         2 000120   200047 755100                    STA     UFLAG+3,,AUTO
         2 000121   200046 236100                    LDQ     UFLAG+2,,AUTO
         2 000122   200047 136100                    SBLQ    UFLAG+3,,AUTO
         2 000123   000004 136007                    SBLQ    4,DL
         2 000124   000020 736000                    QLS     16
         2 000125   000027 676100                    ERQ     23,,PR0
         2 000126   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 000127   000027 656100                    ERSQ    23,,PR0

      758     8661    1                MOD(N$REQ.BUFADDR,%BITBIN('4000000'O));
      759     8662    1           GOTO COMPCMN;

   8662  2 000130   000160 710000 2                  TRA     COMPCMN

      760     8663
      761     8664
      762     8665
      763     8666    1   NIO$COMPC: ENTRY(N$REQ);

   8666  2 000131   000000 700200 xent  NIO$COMPC    TSX0  ! X66_AUTO_2
         2 000132   000056 000002                    ZERO    46,2

      764     8667    1           N$REQ.COMP=%COMP_COM;

   8667  2 000133   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000134   000027 236100                    LDQ     23,,PR0
         2 000135   000004 376000 3                  ANQ     4
         2 000136   001000 276007                    ORQ     512,DL
         2 000137   000027 756100                    STQ     23,,PR0

      765     8668    1           GOTO COMPCMN;

   8668  2 000140   000160 710000 2                  TRA     COMPCMN

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:137  
      766     8669
      767     8670
      768     8671
      769     8672    1   NIO$COMPCNS: ENTRY(N$REQ);

   8672  2 000141   000000 700200 xent  NIO$COMPCNS  TSX0  ! X66_AUTO_2
         2 000142   000056 000002                    ZERO    46,2

      770     8673    1           N$REQ.COMP=%COMP_COMNS;

   8673  2 000143   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000144   000027 236100                    LDQ     23,,PR0
         2 000145   000004 376000 3                  ANQ     4
         2 000146   002000 276007                    ORQ     1024,DL
         2 000147   000027 756100                    STQ     23,,PR0

      771     8674    1           GOTO COMPCMN;

   8674  2 000150   000160 710000 2                  TRA     COMPCMN

      772     8675
      773     8676
      774     8677
      775     8678    1   NIO$COMPCW: ENTRY(N$REQ);

   8678  2 000151   000000 700200 xent  NIO$COMPCW   TSX0  ! X66_AUTO_2
         2 000152   000056 000002                    ZERO    46,2

      776     8679    1           N$REQ.COMP=%COMP_COMW;

   8679  2 000153   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000154   000027 236100                    LDQ     23,,PR0
         2 000155   000004 376000 3                  ANQ     4
         2 000156   006000 276007                    ORQ     3072,DL
         2 000157   000027 756100                    STQ     23,,PR0

      777     8680
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:138  
      778     8681
      779     8682
      780     8683    1   COMPCMN:
      781     8684    1           IF N$REQ.ERR$~=ADDR(NIL) THEN CALL NIA$RELERR(N$REQ);

   8684  2 000160   000017 236100       COMPCMN      LDQ     15,,PR0
         2 000161   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000162   000167 600000 2                  TZE     s:8685

   8684  2 000163   200003 630500                    EPPR0   @N$REQ,,AUTO
         2 000164   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000165   000000 701000 xent               TSX1    NIA$RELERR
         2 000166   000000 011000                    NOP     0

      782     8685    1           DCT$ = N$DCT$(N$REQ.DLA.DCTX);

   8685  2 000167   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000170   000001 236100                    LDQ     1,,PR0
         2 000171   000025 772000                    QRL     21
         2 000172   000000 471400 xsym               LDP1    N$DCT$$
         2 000173   100000 236106                    LDQ     0,QL,PR1
         2 000174   200006 756100                    STQ     DCT$,,AUTO

      783     8686    1           IF DCT$->NI$DCT.TYPE = %DV_DP AND DCT$->NI$DCT.DP.MIRROR.FLAG THEN

   8686  2 000175   200006 473500                    LDP3    DCT$,,AUTO
         2 000176   300007 236100                    LDQ     7,,PR3
         2 000177   007700 376007                    ANQ     4032,DL
         2 000200   000600 116007                    CMPQ    384,DL
         2 000201   000234 601000 2                  TNZ     s:8699
         2 000202   300036 234100                    SZN     30,,PR3
         2 000203   000234 605000 2                  TPL     s:8699

      784     8687    2           DO;

      785     8688    2              MDCTX = DCT$->NI$DCT.DP.MIRROR.DCTX;

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:139  
   8688  2 000204   300037 236100                    LDQ     31,,PR3
         2 000205   000022 772000                    QRL     18
         2 000206   200040 756100                    STQ     MDCTX,,AUTO

      786     8689    2              MDCT$ = N$DCT$(MDCTX);

   8689  2 000207   100000 236106                    LDQ     0,QL,PR1
         2 000210   200037 756100                    STQ     MDCT$,,AUTO

      787     8690    2              IF NOT DCT$->NI$DCT.DP.MIRROR.PRI AND NOT N$REQ.BPMIR THEN

   8690  2 000211   300036 236100                    LDQ     30,,PR3
         2 000212   020000 316003                    CANQ    8192,DU
         2 000213   000226 601000 2                  TNZ     s:8695
         2 000214   000034 236100                    LDQ     28,,PR0
         2 000215   200000 316003                    CANQ    65536,DU
         2 000216   000226 601000 2                  TNZ     s:8695

      788     8691    3              DO;

      789     8692    3                 N$REQ.DLA.DCTX = MDCTX;

   8692  2 000217   200040 236100                    LDQ     MDCTX,,AUTO
         2 000220   000025 736000                    QLS     21
         2 000221   000001 676100                    ERQ     1,,PR0
         2 000222   777770 376003                    ANQ     -8,DU
         2 000223   000001 656100                    ERSQ    1,,PR0

      790     8693    3                 N$REQ.DCT$ = MDCT$;

   8693  2 000224   200037 236100                    LDQ     MDCT$,,AUTO
         2 000225   000002 756100                    STQ     2,,PR0

      791     8694    3                 END;

      792     8695    2              N$REQ.DOMIR = '0'B;

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:140  
   8695  2 000226   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 000227   000034 356100                    ANSQ    28,,PR0

      793     8696    2              N$REQ.MIRDONE = '0'B;

   8696  2 000230   000005 236000 3                  LDQ     5
         2 000231   000034 356100                    ANSQ    28,,PR0

      794     8697    2              N$REQ.BPMIR = '0'B;

   8697  2 000232   000001 236000 3                  LDQ     1
         2 000233   000034 356100                    ANSQ    28,,PR0

      795     8698    2              END;

      796     8699    2           IF N$REQ.IOP_BUFREAL_CVRT THEN DO;

   8699  2 000234   000031 236100                    LDQ     25,,PR0
         2 000235   040000 316007                    CANQ    16384,DL
         2 000236   000244 600000 2                  TZE     s:8705

      797     8700             /* IOP CAN'T DO NON-PAGED IO ADDR > 16MW, CONVERT BACK BEFORE COMPING */
      798     8701    2              N$REQ.PTP=0;

   8701  2 000237   000007 450100                    STZ     7,,PR0

      799     8702    2              N$REQ.BUFADDR=BITBIN(N$REQ.BUFREAL_SV);

   8702  2 000240   000032 235100                    LDA     26,,PR0
         2 000241   000006 755100                    STA     6,,PR0

      800     8703    2              N$REQ.IOP_BUFREAL_CVRT='0'B;

   8703  2 000242   000006 236000 3                  LDQ     6
         2 000243   000031 356100                    ANSQ    25,,PR0

      801     8704    2              END;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:141  

      802     8705    2           DO CASE(N$REQ.COMP);

   8705  2 000244   000027 236100                    LDQ     23,,PR0
         2 000245   000011 772000                    QRL     9
         2 000246   000177 376007                    ANQ     127,DL
         2 000247   000011 116007                    CMPQ    9,DL
         2 000250   000252 602006 2                  TNC     s:8705+6,QL
         2 000251   001061 710000 2                  TRA     s:8843
         2 000252   000263 710000 2                  TRA     s:8707
         2 000253   000263 710000 2                  TRA     s:8707
         2 000254   000263 710000 2                  TRA     s:8707
         2 000255   001061 710000 2                  TRA     s:8843
         2 000256   001036 710000 2                  TRA     s:8837
         2 000257   001061 710000 2                  TRA     s:8843
         2 000260   000263 710000 2                  TRA     s:8707
         2 000261   001061 710000 2                  TRA     s:8843
         2 000262   000263 710000 2                  TRA     s:8707

      803     8706    2            CASE(%COMP_REG,%COMP_COM,%COMP_COMNS,%COMP_COMW,%COMP_MIRROR);

      804     8707    2              N$REQ.TYC.EGV='1'B;

   8707  2 000263   400000 236003                    LDQ     -131072,DU
         2 000264   000021 256100                    ORSQ    17,,PR0

      805     8708    3              IF N$REQ.OPFLG.EA THEN DO;

   8708  2 000265   000004 236100                    LDQ     4,,PR0
         2 000266   000040 316007                    CANQ    32,DL
         2 000267   000352 600000 2                  TZE     s:8729

      806     8709    3                 N$REQ.OPFLG.REQ = '0'B;

   8709  2 000270   000007 236000 3                  LDQ     7
         2 000271   000004 356100                    ANSQ    4,,PR0

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:142  
      807     8710    3                 EXRTN = N$REQ.EAENTRY;

   8710  2 000272   000023 236100                    LDQ     19,,PR0
         2 000273   200024 756100                    STQ     EXRTN,,AUTO

      808     8711    3                 CALL EXRTN(N$REQ) ALTRET(RECOMP);

   8711  2 000274   200003 630500                    EPPR0   @N$REQ,,AUTO
         2 000275   200024 220100                    LDX0    EXRTN,,AUTO
         2 000276   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000277   000000 701010                    TSX1    0,X0
         2 000300   001125 702000 2                  TSX2    RECOMP

      809     8712    4                 IF N$REQ.OPFLG.REQ THEN DO;

   8712  2 000301   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000302   000004 236100                    LDQ     4,,PR0
         2 000303   000002 316007                    CANQ    2,DL
         2 000304   000352 600000 2                  TZE     s:8729

      810     8713    5                    IF N$REQ.OPFLG.CLR THEN DO;

   8713  2 000305   000001 316007                    CANQ    1,DL
         2 000306   000332 600000 2                  TZE     s:8723

      811     8714                            %LOCK (G#=S_ASFGATE);

   8715  2 000307   000010 630400 3                  EPPR0   8
         2 000310   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000311   000000 701000 xent               TSX1    HFC$LOCK
         2 000312   000000 011000                    NOP     0

      812     8717    5                       REL$=ADDR(B$USER(N$REQ.USER#));

   8717  2 000313   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000314   000027 236100                    LDQ     23,,PR0
         2 000315   000004 736000                    QLS     4
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:143  
         2 000316   017760 376007                    ANQ     8176,DL
         2 000317   000022 736000                    QLS     18
         2 000320   000000 036000 xsym               ADLQ    B$USRT$
         2 000321   200041 756100                    STQ     REL$,,AUTO

      813     8718    5                       REL$->B$U.ASYNCH=REL$->B$U.ASYNCH|%U_CACHE;

   8718  2 000322   200041 471500                    LDP1    REL$,,AUTO
         2 000323   100001 236100                    LDQ     1,,PR1
         2 000324   000003 276000 xsym               ORQ     B_VECTNIL+3
         2 000325   100001 756100                    STQ     1,,PR1

      814     8719                            %UNLOCK (G#=S_ASFGATE);

   8720  2 000326   000010 630400 3                  EPPR0   8
         2 000327   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000330   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000331   000000 011000                    NOP     0

      815     8722    5                       END;

      816     8723    4                    CALL NIQ$GETID(ADDR(N$REQ));

   8723  2 000332   200003 236100                    LDQ     @N$REQ,,AUTO
         2 000333   200046 756100                    STQ     UFLAG+2,,AUTO
         2 000334   200046 630500                    EPPR0   UFLAG+2,,AUTO
         2 000335   200047 450500                    STP0    UFLAG+3,,AUTO
         2 000336   200047 630500                    EPPR0   UFLAG+3,,AUTO
         2 000337   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000340   000000 701000 xent               TSX1    NIQ$GETID
         2 000341   000000 011000                    NOP     0

      817     8724    4                    N$REQ.ARCT=0;

   8724  2 000342   000000 220003                    LDX0    0,DU
         2 000343   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000344   000030 740100                    STX0    24,,PR0
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:144  

      818     8725    4                    CALL NIO$REQUE(N$REQ) ALTRET(REQUE);

   8725  2 000345   200003 630500                    EPPR0   @N$REQ,,AUTO
         2 000346   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000347   000000 701000 xent               TSX1    NIO$REQUE
         2 000350   001076 702000 2                  TSX2    REQUE

      819     8726    4                    RETURN;

   8726  2 000351   000000 702200 xent               TSX2  ! X66_ARET

      820     8727    4                    END;
      821     8728    3                 END;
      822     8729    3              IF N$REQ.OPFLG.CLR THEN DO;

   8729  2 000352   000001 316007                    CANQ    1,DL
         2 000353   000377 600000 2                  TZE     s:8739

      823     8730                      %LOCK (G#=S_ASFGATE);

   8731  2 000354   000010 630400 3                  EPPR0   8
         2 000355   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000356   000000 701000 xent               TSX1    HFC$LOCK
         2 000357   000000 011000                    NOP     0

      824     8733    3                 REL$=ADDR(B$USER(N$REQ.USER#));

   8733  2 000360   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000361   000027 236100                    LDQ     23,,PR0
         2 000362   000004 736000                    QLS     4
         2 000363   017760 376007                    ANQ     8176,DL
         2 000364   000022 736000                    QLS     18
         2 000365   000000 036000 xsym               ADLQ    B$USRT$
         2 000366   200041 756100                    STQ     REL$,,AUTO

      825     8734    3                 REL$->B$U.ASYNCH=REL$->B$U.ASYNCH|%U_CACHE;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:145  

   8734  2 000367   200041 471500                    LDP1    REL$,,AUTO
         2 000370   100001 236100                    LDQ     1,,PR1
         2 000371   000003 276000 xsym               ORQ     B_VECTNIL+3
         2 000372   100001 756100                    STQ     1,,PR1

      826     8735                      %UNLOCK (G#=S_ASFGATE);

   8736  2 000373   000010 630400 3                  EPPR0   8
         2 000374   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000375   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000376   000000 011000                    NOP     0

      827     8738    3                 END;

      828     8739    2              IF N$REQ.TYC & ~%TYC_EGV THEN TYC=N$REQ.TYC;

   8739  2 000377   000030 236000 xsym               LDQ     B_VECTNIL+24
         2 000400   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 000401   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000402   000021 376100                    ANQ     17,,PR0
         2 000403   000407 600000 2                  TZE     s:8740

   8739  2 000404   000021 236100                    LDQ     17,,PR0
         2 000405   200043 756100                    STQ     TYC,,AUTO
         2 000406   000410 710000 2                  TRA     s:8741

      829     8740    2              ELSE TYC='0'B;

   8740  2 000407   200043 450100                    STZ     TYC,,AUTO

      830     8741    3              IF N$REQ.OPFLG.USER THEN DO;

   8741  2 000410   000004 236100                    LDQ     4,,PR0
         2 000411   000400 316007                    CANQ    256,DL
         2 000412   001061 600000 2                  TZE     s:8843

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:146  
      831     8742    3                 UFLAG=%SS_IOC;

   8742  2 000413   000036 235007                    LDA     30,DL
         2 000414   200044 755100                    STA     UFLAG,,AUTO

      832     8743    4                 IF N$REQ.DCB$~=ADDR(NIL) THEN DO;

   8743  2 000415   000022 236100                    LDQ     18,,PR0
         2 000416   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000417   000620 600000 2                  TZE     s:8788

      833     8744                         %LOCK (G#=F_DCBLOCK);

   8745  2 000420   000011 630400 3                  EPPR0   9
         2 000421   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000422   000000 701000 xent               TSX1    HFC$LOCK
         2 000423   000000 011000                    NOP     0

      834     8747    4                    S_WSPTD.BLKNO(%IOENDWSQ)=B$USER.PT(N$REQ.USER#);

   8747  2 000424   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000425   000027 236100                    LDQ     23,,PR0
         2 000426   000004 736000                    QLS     4
         2 000427   017760 376007                    ANQ     8176,DL
         2 000430   000000 471400 xsym               LDP1    B$USRT$
         2 000431   100014 220106                    LDX0    12,QL,PR1
         2 000432   000007 740000 xsym               STX0    S_WSPTD+7

      835     8748    4                    CALL HFC$ASSOCCLR(%IOENDWSQ,0,16384); /*MAX Dense PT*/

   8748  2 000433   000013 630400 3                  EPPR0   11
         2 000434   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000435   000000 701000 xent               TSX1    HFC$ASSOCCLR
         2 000436   000000 011000                    NOP     0

      836     8749    4                    DCB$=N$REQ.DCB$;

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:147  
   8749  2 000437   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000440   000022 236100                    LDQ     18,,PR0
         2 000441   200005 756100                    STQ     DCB$,,AUTO

      837     8750    4                    ADDR(DCB$)->POINTER.SEGID=%ROSEG8SID;

   8750  2 000442   006125 236007                    LDQ     3157,DL
         2 000443   200005 752103                    STCQ    DCB$,'03'O,AUTO

      838     8751    5                    IF N$REQ.OPFLG.ARS THEN DO;

   8751  2 000444   000004 236100                    LDQ     4,,PR0
         2 000445   000200 316007                    CANQ    128,DL
         2 000446   000464 600000 2                  TZE     s:8756

      839     8752    5                       DCB$->F$DCB.ARS=N$REQ.ARSIZE;

   8752  2 000447   000027 236100                    LDQ     23,,PR0
         2 000450   000020 772000                    QRL     16
         2 000451   200005 471500                    LDP1    DCB$,,AUTO
         2 000452   100000 756100                    STQ     0,,PR1

      840     8753    5                       DCB$->F$DCB.EOMCHAR=N$REQ.DVE.EOMCHAR;

   8753  2 000453   200005 471500                    LDP1    DCB$,,AUTO
         2 000454   000031 236100                    LDQ     25,,PR0
         2 000455   000022 772000                    QRL     18
         2 000456   100003 552104                    STBQ    3,'04'O,PR1

      841     8754    5                       DCB$->F$DCB.DVBYTE=N$REQ.DVE.DVBYTE;

   8754  2 000457   200005 471500                    LDP1    DCB$,,AUTO
         2 000460   000031 236100                    LDQ     25,,PR0
         2 000461   100003 676100                    ERQ     3,,PR1
         2 000462   776000 376003                    ANQ     -1024,DU
         2 000463   100003 656100                    ERSQ    3,,PR1

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:148  
      842     8755    5                       END;

      843     8756    5                    IF N$REQ.ERRCT~=0 THEN DO;

   8756  2 000464   000003 236100                    LDQ     3,,PR0
         2 000465   777000 316003                    CANQ    -512,DU
         2 000466   000500 600000 2                  TZE     s:8759

      844     8757    5                       DCB$->F$DCB.RETRYCNT=DCB$->F$DCB.RETRYCNT+N$REQ.ERRCT;

   8757  2 000467   000003 236100                    LDQ     3,,PR0
         2 000470   000033 772000                    QRL     27
         2 000471   200046 756100                    STQ     UFLAG+2,,AUTO
         2 000472   200005 471500                    LDP1    DCB$,,AUTO
         2 000473   100005 236100                    LDQ     5,,PR1
         2 000474   000022 772000                    QRL     18
         2 000475   200046 036100                    ADLQ    UFLAG+2,,AUTO
         2 000476   000000 620006                    EAX0    0,QL
         2 000477   100005 740100                    STX0    5,,PR1

      845     8758    5                       END;

      846     8759    4                    IF N$REQ.COMP=%COMP_COM

   8759  2 000500   000027 236100                    LDQ     23,,PR0
         2 000501   177000 376007                    ANQ     65024,DL
         2 000502   001000 116007                    CMPQ    512,DL
         2 000503   000512 600000 2                  TZE     s:8762
         2 000504   006000 116007                    CMPQ    3072,DL
         2 000505   000524 601000 2                  TNZ     s:8766
         2 000506   200005 471500                    LDP1    DCB$,,AUTO
         2 000507   100031 236100                    LDQ     25,,PR1
         2 000510   004000 316003                    CANQ    2048,DU
         2 000511   000524 601000 2                  TNZ     s:8766

      847     8760    4                      OR (N$REQ.COMP=%COMP_COMW AND
      848     8761    5                      NOT DCB$->F$DCB.LSTAOR) THEN DO;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:149  

      849     8762    5                       LSTA$=DCB$->F$DCB.LASTSTA$;

   8762  2 000512   200005 471500                    LDP1    DCB$,,AUTO
         2 000513   100007 236100                    LDQ     7,,PR1
         2 000514   200036 756100                    STQ     LSTA$,,AUTO

      850     8763    5                       ADDR(LSTA$)->POINTER.SEGID=%ROSEG8SID;

   8763  2 000515   006125 236007                    LDQ     3157,DL
         2 000516   200036 752103                    STCQ    LSTA$,'03'O,AUTO

      851     8764    5                       LSTA$->VSTA=N$REQ.STATION.LSTA$->VSTA;

   8764  2 000517   000013 473500                    LDP3    11,,PR0
         2 000520   200036 474500                    LDP4    LSTA$,,AUTO
         2 000521   000100 100500                    MLR     fill='000'O
         2 000522   300000 000040                    ADSC9   0,,PR3                   cn=0,n=32
         2 000523   400000 000040                    ADSC9   0,,PR4                   cn=0,n=32

      852     8765    5                       END;

      853     8766    5                    IF N$REQ.NWIO=0 THEN DO;

   8766  2 000524   000031 236100                    LDQ     25,,PR0
         2 000525   400000 316007                    CANQ    -131072,DL
         2 000526   000561 601000 2                  TNZ     s:8776

      854     8767    5                       DCB$->F$DCB.TYC(0)=DCB$->F$DCB.TYC(0)|TYC;

   8767  2 000527   200005 471500                    LDP1    DCB$,,AUTO
         2 000530   100001 236100                    LDQ     1,,PR1
         2 000531   200043 276100                    ORQ     TYC,,AUTO
         2 000532   100001 756100                    STQ     1,,PR1

      855     8768    5                       DCB$->F$DCB.FCN.CNT(0)=DCB$->F$DCB.FCN.CNT(0)-1;

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:150  
   8768  2 000533   200005 471500                    LDP1    DCB$,,AUTO
         2 000534   100074 236100                    LDQ     60,,PR1
         2 000535   000033 772000                    QRL     27
         2 000536   000377 376007                    ANQ     255,DL
         2 000537   000001 136007                    SBLQ    1,DL
         2 000540   000033 736000                    QLS     27
         2 000541   100074 676100                    ERQ     60,,PR1
         2 000542   377000 376003                    ANQ     130560,DU
         2 000543   100074 656100                    ERSQ    60,,PR1

      856     8769    5                       IF DCB$->F$DCB.FCN.CNT(0)=0 OR N$REQ.OPFLG.WAIT THEN

   8769  2 000544   100074 236100                    LDQ     60,,PR1
         2 000545   377000 316003                    CANQ    130560,DU
         2 000546   000552 600000 2                  TZE     s:8770
         2 000547   000004 236100                    LDQ     4,,PR0
         2 000550   000020 316007                    CANQ    16,DL
         2 000551   000613 600000 2                  TZE     s:8785

      857     8770    6                          IF DCB$->F$DCB.FCN.F(0) THEN DO;

   8770  2 000552   100074 234100                    SZN     60,,PR1
         2 000553   000613 605000 2                  TPL     s:8785

      858     8771    6                             DCB$->F$DCB.FCN.F(0)='0'B;

   8771  2 000554   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 000555   100074 356100                    ANSQ    60,,PR1

      859     8772    6                             UFLAG=%SS_IOCU;

   8772  2 000556   000037 235007                    LDA     31,DL
         2 000557   200044 755100                    STA     UFLAG,,AUTO

      860     8773    6                             END;

      861     8774    5                       END;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:151  

   8774  2 000560   000613 710000 2                  TRA     s:8785

      862     8775    5                    ELSE DO;

      863     8776    5                       DCB$->F$DCB.TYC(1)=DCB$->F$DCB.TYC(1)|TYC;

   8776  2 000561   200005 471500                    LDP1    DCB$,,AUTO
         2 000562   100002 236100                    LDQ     2,,PR1
         2 000563   200043 276100                    ORQ     TYC,,AUTO
         2 000564   100002 756100                    STQ     2,,PR1

      864     8777    5                       DCB$->F$DCB.FCN.CNT(1)=DCB$->F$DCB.FCN.CNT(1)-1;

   8777  2 000565   200005 471500                    LDP1    DCB$,,AUTO
         2 000566   100074 236100                    LDQ     60,,PR1
         2 000567   000022 772000                    QRL     18
         2 000570   000377 376007                    ANQ     255,DL
         2 000571   000001 136007                    SBLQ    1,DL
         2 000572   000022 736000                    QLS     18
         2 000573   100074 676100                    ERQ     60,,PR1
         2 000574   000377 376003                    ANQ     255,DU
         2 000575   100074 656100                    ERSQ    60,,PR1

      865     8778    5                       IF DCB$->F$DCB.FCN.CNT(1)=0 OR N$REQ.OPFLG.WAIT THEN

   8778  2 000576   100074 236100                    LDQ     60,,PR1
         2 000577   000377 316003                    CANQ    255,DU
         2 000600   000604 600000 2                  TZE     s:8779
         2 000601   000004 236100                    LDQ     4,,PR0
         2 000602   000020 316007                    CANQ    16,DL
         2 000603   000613 600000 2                  TZE     s:8785

      866     8779    6                          IF DCB$->F$DCB.FCN.F(1) THEN DO;

   8779  2 000604   100074 236100                    LDQ     60,,PR1
         2 000605   000400 316003                    CANQ    256,DU
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:152  
         2 000606   000613 600000 2                  TZE     s:8785

      867     8780    6                             DCB$->F$DCB.FCN.F(1)='0'B;

   8780  2 000607   000016 236000 3                  LDQ     14
         2 000610   100074 356100                    ANSQ    60,,PR1

      868     8781    6                             UFLAG=%SS_IOCU;

   8781  2 000611   000037 235007                    LDA     31,DL
         2 000612   200044 755100                    STA     UFLAG,,AUTO

      869     8782    6                             END;

      870     8783    5                       END;

      871     8784                         %UNLOCK (G#=F_DCBLOCK);

   8785  2 000613   000011 630400 3                  EPPR0   9
         2 000614   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000615   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000616   000000 011000                    NOP     0

      872     8787    4                    END;

   8787  2 000617   000625 710000 2                  TRA     s:8791

      873     8788    4                 ELSE IF N$REQ.OPFLG.WAIT THEN DO;

   8788  2 000620   000004 236100                    LDQ     4,,PR0
         2 000621   000020 316007                    CANQ    16,DL
         2 000622   000625 600000 2                  TZE     s:8791

      874     8789    4                       UFLAG=%SS_IOCU;

   8789  2 000623   000037 235007                    LDA     31,DL
         2 000624   200044 755100                    STA     UFLAG,,AUTO
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:153  

      875     8790    4                       END;

      876     8791    4                 IF N$REQ.OPFLG.EVNT THEN DO;

   8791  2 000625   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000626   000004 236100                    LDQ     4,,PR0
         2 000627   000100 316007                    CANQ    64,DL
         2 000630   000712 600000 2                  TZE     s:8812

      877     8792                         %LOCK (G#=S_UDLGATE);

   8793  2 000631   000017 630400 3                  EPPR0   15
         2 000632   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000633   000000 701000 xent               TSX1    HFC$LOCK
         2 000634   000000 011000                    NOP     0

      878     8795    4                    N$REQ.DOPTR$->B$DO.IOCOMP.CNTR=N$REQ.DOPTR$->B$DO.IOCOMP.CNTR-1;

   8795  2 000635   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000636   000026 471500                    LDP1    22,,PR0
         2 000637   100011 235100                    LDA     9,,PR1
         2 000640   000001 135007                    SBLA    1,DL
         2 000641   100011 755100                    STA     9,,PR1

      879     8796    4                    N$REQ.DOPTR$->B$DO.IOCOMP.TYC=N$REQ.DOPTR$->B$DO.IOCOMP.TYC | TYC;

   8796  2 000642   000026 471500                    LDP1    22,,PR0
         2 000643   100006 236100                    LDQ     6,,PR1
         2 000644   200043 276100                    ORQ     TYC,,AUTO
         2 000645   100006 756100                    STQ     6,,PR1

      880     8797    4                    N$REQ.DOPTR$->B$DO.IOCOMP.DVE=N$REQ.DVE;

   8797  2 000646   000026 471500                    LDP1    22,,PR0
         2 000647   000031 220100                    LDX0    25,,PR0
         2 000650   100010 740100                    STX0    8,,PR1
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:154  

      881     8798    4                    IF N$REQ.OPFLG.ARS THEN

   8798  2 000651   000004 236100                    LDQ     4,,PR0
         2 000652   000200 316007                    CANQ    128,DL
         2 000653   000661 600000 2                  TZE     s:8800

      882     8799    4                       N$REQ.DOPTR$->B$DO.IOCOMP.ARS=N$REQ.DOPTR$->B$DO.IOCOMP.ARS+
              8799                                N$REQ.ARSIZE;

   8799  2 000654   000026 471500                    LDP1    22,,PR0
         2 000655   000027 236100                    LDQ     23,,PR0
         2 000656   000020 772000                    QRL     16
         2 000657   100007 036100                    ADLQ    7,,PR1
         2 000660   100007 756100                    STQ     7,,PR1

      883     8800    5                    IF N$REQ.DOPTR$->B$DO.IOCOMP.CNTR=0 THEN DO;

   8800  2 000661   000026 471500                    LDP1    22,,PR0
         2 000662   100011 235100                    LDA     9,,PR1
         2 000663   000705 601000 2                  TNZ     s:8809

      884     8801    5                       TEMP=N$REQ.USER#;

   8801  2 000664   000027 236100                    LDQ     23,,PR0
         2 000665   000777 376007                    ANQ     511,DL
         2 000666   200042 756100                    STQ     TEMP,,AUTO

      885     8802                            %UNLOCK (G#=S_UDLGATE);

   8803  2 000667   000017 630400 3                  EPPR0   15
         2 000670   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000671   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000672   000000 011000                    NOP     0

      886     8805    5                       CALL SSV$SCHDDO(N$REQ.DOPTR$,TEMP);

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:155  
   8805  2 000673   200042 630500                    EPPR0   TEMP,,AUTO
         2 000674   200047 450500                    STP0    UFLAG+3,,AUTO
         2 000675   200003 236100                    LDQ     @N$REQ,,AUTO
         2 000676   000026 036003                    ADLQ    22,DU
         2 000677   200046 756100                    STQ     UFLAG+2,,AUTO
         2 000700   200046 630500                    EPPR0   UFLAG+2,,AUTO
         2 000701   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000702   000000 701000 xent               TSX1    SSV$SCHDDO
         2 000703   000000 011000                    NOP     0

      887     8806    5                       END;

   8806  2 000704   000770 710000 2                  TRA     s:8825

      888     8807    4                    ELSE
      889     8808                            %UNLOCK (G#=S_UDLGATE);

   8809  2 000705   000017 630400 3                  EPPR0   15
         2 000706   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000707   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000710   000000 011000                    NOP     0

      890     8811    4                    END;

   8811  2 000711   000770 710000 2                  TRA     s:8825

      891     8812    4                 ELSE IF N$REQ.EVNTINFO~=0 THEN DO;

   8812  2 000712   000026 235100                    LDA     22,,PR0
         2 000713   000770 600000 2                  TZE     s:8825

      892     8813    4                       EVBLK.TYC=N$REQ.TYC;

   8813  2 000714   000021 236100                    LDQ     17,,PR0
         2 000715   200010 756100                    STQ     EVBLK+1,,AUTO

      893     8814    4                       EVBLK.ARS=N$REQ.ARSIZE;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:156  

   8814  2 000716   000027 236100                    LDQ     23,,PR0
         2 000717   000020 772000                    QRL     16
         2 000720   200011 756100                    STQ     EVBLK+2,,AUTO

      894     8815    4                       EVBLK.DVE=N$REQ.DVE;

   8815  2 000721   000031 220100                    LDX0    25,,PR0
         2 000722   200012 740100                    STX0    EVBLK+3,,AUTO

      895     8816    4                       IF N$REQ.COMP=%COMP_COM

   8816  2 000723   000027 236100                    LDQ     23,,PR0
         2 000724   177000 376007                    ANQ     65024,DL
         2 000725   001000 116007                    CMPQ    512,DL
         2 000726   000731 600000 2                  TZE     s:8818
         2 000727   006000 116007                    CMPQ    3072,DL
         2 000730   000740 601000 2                  TNZ     s:8821

      896     8817    5                         OR N$REQ.COMP=%COMP_COMW THEN DO;

      897     8818    5                          EVBLK.CGPARM=N$REQ.STATION.LSTA$->VSTA;

   8818  2 000731   000013 471500                    LDP1    11,,PR0
         2 000732   000100 100500                    MLR     fill='000'O
         2 000733   100000 000040                    ADSC9   0,,PR1                   cn=0,n=32
         2 000734   200013 000040                    ADSC9   EVBLK+4,,AUTO            cn=0,n=32

      898     8819    5                          EVBLK.P#=SIZEW(EVBLK)-SIZEW(EVBLK.P#);

   8819  2 000735   000014 235007                    LDA     12,DL
         2 000736   200007 755100                    STA     EVBLK,,AUTO

      899     8820    5                          END;

   8820  2 000737   000742 710000 2                  TRA     s:8822

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:157  
      900     8821    4                       ELSE EVBLK.P#=SIZEW(EVBLK)-SIZEW(EVBLK.P#)-SIZEW(EVBLK.CGPARM);

   8821  2 000740   000004 235007                    LDA     4,DL
         2 000741   200007 755100                    STA     EVBLK,,AUTO

      901     8822    4                       TEMP=N$REQ.WSR;

   8822  2 000742   000031 236100                    LDQ     25,,PR0
         2 000743   000777 376007                    ANQ     511,DL
         2 000744   200042 756100                    STQ     TEMP,,AUTO

      902     8823    4                      CALL SSV$EVENT(N$REQ.USER#,TEMP,%EVSC_IO#,N$REQ.EVNTINFO,0,ADDR(
              8823                                EVBLK));

   8823  2 000745   200007 631500                    EPPR1   EVBLK,,AUTO
         2 000746   200046 451500                    STP1    UFLAG+2,,AUTO
         2 000747   200046 633500                    EPPR3   UFLAG+2,,AUTO
         2 000750   200055 453500                    STP3    UFLAG+9,,AUTO
         2 000751   000014 236000 3                  LDQ     12
         2 000752   200054 756100                    STQ     UFLAG+8,,AUTO
         2 000753   200003 236100                    LDQ     @N$REQ,,AUTO
         2 000754   000026 036003                    ADLQ    22,DU
         2 000755   000020 235000 3                  LDA     16
         2 000756   200052 757100                    STAQ    UFLAG+6,,AUTO
         2 000757   200042 634500                    EPPR4   TEMP,,AUTO
         2 000760   200051 454500                    STP4    UFLAG+5,,AUTO
         2 000761   200003 236100                    LDQ     @N$REQ,,AUTO
         2 000762   000021 036000 3                  ADLQ    17
         2 000763   200050 756100                    STQ     UFLAG+4,,AUTO
         2 000764   200050 630500                    EPPR0   UFLAG+4,,AUTO
         2 000765   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 000766   000000 701000 xent               TSX1    SSV$EVENT
         2 000767   000000 011000                    NOP     0

      903     8824    4                       END;

      904     8825    4                 IF N$DCT$(N$REQ.DLA.DCTX)->NI$DCT.DFLG.CM THEN DO;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:158  

   8825  2 000770   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000771   000001 236100                    LDQ     1,,PR0
         2 000772   000025 772000                    QRL     21
         2 000773   000000 471400 xsym               LDP1    N$DCT$$
         2 000774   100000 473506                    LDP3    0,QL,PR1
         2 000775   300006 236100                    LDQ     6,,PR3
         2 000776   100000 316007                    CANQ    32768,DL
         2 000777   001024 600000 2                  TZE     s:8834

      905     8826                         %LOCK (G#=NI_MFGATE);

   8827  2 001000   000022 630400 3                  EPPR0   18
         2 001001   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001002   000000 701000 xent               TSX1    HFC$LOCK
         2 001003   000000 011000                    NOP     0

      906     8829    4                    B$USER.CMF(N$REQ.USER#)=B$USER.CMF(N$REQ.USER#)-1;

   8829  2 001004   200003 470500                    LDP0    @N$REQ,,AUTO
         2 001005   000027 236100                    LDQ     23,,PR0
         2 001006   000004 736000                    QLS     4
         2 001007   017760 376007                    ANQ     8176,DL
         2 001010   000000 471400 xsym               LDP1    B$USRT$
         2 001011   000000 620006                    EAX0    0,QL
         2 001012   100007 236106                    LDQ     7,QL,PR1
         2 001013   000077 376007                    ANQ     63,DL
         2 001014   000001 136007                    SBLQ    1,DL
         2 001015   100007 676110                    ERQ     7,X0,PR1
         2 001016   000077 376007                    ANQ     63,DL
         2 001017   100007 656110                    ERSQ    7,X0,PR1

      907     8830                         %UNLOCK (G#=NI_MFGATE);

   8831  2 001020   000022 630400 3                  EPPR0   18
         2 001021   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001022   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:159  
         2 001023   000000 011000                    NOP     0

      908     8833    4                    END;

      909     8834    3                 CALL SSR$RUE(UFLAG,N$REQ.USER#);

   8834  2 001024   200003 236100                    LDQ     @N$REQ,,AUTO
         2 001025   000021 036000 3                  ADLQ    17
         2 001026   200047 756100                    STQ     UFLAG+3,,AUTO
         2 001027   200044 630500                    EPPR0   UFLAG,,AUTO
         2 001030   200046 450500                    STP0    UFLAG+2,,AUTO
         2 001031   200046 630500                    EPPR0   UFLAG+2,,AUTO
         2 001032   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001033   000000 701000 xent               TSX1    SSR$RUE
         2 001034   000000 011000                    NOP     0

      910     8835    3                 END;

   8835  2 001035   001061 710000 2                  TRA     s:8843

      911     8836    2            CASE(%COMP_TD);

      912     8837    2              IF ADDR(NI$EXTST) = ADDR(NIL) THEN

   8837  2 001036   200004 236100                    LDQ     @NI$EXTST,,AUTO
         2 001037   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001040   001045 601000 2                  TNZ     s:8840

      913     8838    2                 EXTSTAT.EXTST = '0'B;

   8838  2 001041   000100 100400                    MLR     fill='000'O
         2 001042   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 001043   200025 000040                    ADSC9   EXTSTAT,,AUTO            cn=0,n=32
         2 001044   001051 710000 2                  TRA     s:8841

      914     8839    2              ELSE
      915     8840    2                 EXTSTAT = NI$EXTST;
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:160  

   8840  2 001045   200004 474500                    LDP4    @NI$EXTST,,AUTO
         2 001046   000100 100500                    MLR     fill='000'O
         2 001047   400000 000040                    ADSC9   0,,PR4                   cn=0,n=32
         2 001050   200025 000040                    ADSC9   EXTSTAT,,AUTO            cn=0,n=32

      916     8841    2              CALL TDC$COMP(N$REQ,EXTSTAT);

   8841  2 001051   200025 634500                    EPPR4   EXTSTAT,,AUTO
         2 001052   200047 454500                    STP4    UFLAG+3,,AUTO
         2 001053   200003 236100                    LDQ     @N$REQ,,AUTO
         2 001054   200046 756100                    STQ     UFLAG+2,,AUTO
         2 001055   200046 630500                    EPPR0   UFLAG+2,,AUTO
         2 001056   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001057   000000 701000 xent               TSX1    TDC$COMP
         2 001060   000000 011000                    NOP     0

      917     8842    2            END;

      918     8843    1           IF NOT N$REQ.OPFLG.HOLD

   8843  2 001061   200003 470500                    LDP0    @N$REQ,,AUTO
         2 001062   000004 236100                    LDQ     4,,PR0
         2 001063   000004 316007                    CANQ    4,DL
         2 001064   001075 601000 2                  TNZ     s:8845

      919     8844    1           THEN CALL NIQ$REL(ADDR(N$REQ));

   8844  2 001065   200003 236100                    LDQ     @N$REQ,,AUTO
         2 001066   200046 756100                    STQ     UFLAG+2,,AUTO
         2 001067   200046 631500                    EPPR1   UFLAG+2,,AUTO
         2 001070   200047 451500                    STP1    UFLAG+3,,AUTO
         2 001071   200047 630500                    EPPR0   UFLAG+3,,AUTO
         2 001072   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001073   000000 701000 xent               TSX1    NIQ$REL
         2 001074   000000 011000                    NOP     0

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:161  
      920     8845    1           RETURN;

   8845  2 001075   000000 702200 xent               TSX2  ! X66_ARET

   8843  2 001076                       REQUE        null
      921     8846        /**/
      922     8847    1   REQUE:  ;
      923     8848    1           IF NOT N$REQ.NOALT THEN GOTO RECOMP;

   8848  2 001076   200003 470500                    LDP0    @N$REQ,,AUTO
         2 001077   000004 236100                    LDQ     4,,PR0
         2 001100   100000 316007                    CANQ    32768,DL
         2 001101   001125 600000 2                  TZE     RECOMP

      924     8849    1           N$REQ.IOQFLG.IOQUED = '1'B ;

   8849  2 001102   200000 236003                    LDQ     65536,DU
         2 001103   000033 256100                    ORSQ    27,,PR0

      925     8850                %LOCK (G#=NI$RP.GATE);

   8851  2 001104   000000 630400 xsym               EPPR0   NI$RP$
         2 001105   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001106   000000 701000 xent               TSX1    HFC$LOCK
         2 001107   000000 011000                    NOP     0

      926     8853                %ENQUEUE (P#=N$REQ,Q#=NI$RP.RQ$);

   8854  2 001110   000000 236000 xsym               LDQ     NI$RP$
         2 001111   000004 036003                    ADLQ    4,DU
         2 001112   200003 235100                    LDA     @N$REQ,,AUTO
         2 001113   200046 757100                    STAQ    UFLAG+2,,AUTO
         2 001114   200046 630500                    EPPR0   UFLAG+2,,AUTO
         2 001115   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001116   000000 701000 xent               TSX1    NIM$ENQUEUE
         2 001117   000000 011000                    NOP     0

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:162  
      927     8856                %UNLOCK (G#=NI$RP.GATE);

   8857  2 001120   000000 630400 xsym               EPPR0   NI$RP$
         2 001121   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001122   000000 701000 xent               TSX1    HFC$UNLOCK
         2 001123   000000 011000                    NOP     0

      928     8859    1           RETURN;

   8859  2 001124   000000 702200 xent               TSX2  ! X66_ARET

   8849  2 001125                       RECOMP       null
      929     8860    1   RECOMP: ;
      930     8861    1           N$REQ.IOQFLG.IOQUED = '1'B ;

   8861  2 001125   200003 470500                    LDP0    @N$REQ,,AUTO
         2 001126   200000 236003                    LDQ     65536,DU
         2 001127   000033 256100                    ORSQ    27,,PR0

      931     8862                %LOCK (G#=NI$RP.GATE);

   8863  2 001130   000000 630400 xsym               EPPR0   NI$RP$
         2 001131   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001132   000000 701000 xent               TSX1    HFC$LOCK
         2 001133   000000 011000                    NOP     0

      932     8865                %ENQUEUE (P#=N$REQ,Q#=NI$RP.RC$);

   8866  2 001134   000000 236000 xsym               LDQ     NI$RP$
         2 001135   000003 036003                    ADLQ    3,DU
         2 001136   200003 235100                    LDA     @N$REQ,,AUTO
         2 001137   200046 757100                    STAQ    UFLAG+2,,AUTO
         2 001140   200046 630500                    EPPR0   UFLAG+2,,AUTO
         2 001141   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001142   000000 701000 xent               TSX1    NIM$ENQUEUE
         2 001143   000000 011000                    NOP     0

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:163  
      933     8868                %UNLOCK (G#=NI$RP.GATE);

   8869  2 001144   000000 630400 xsym               EPPR0   NI$RP$
         2 001145   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001146   000000 701000 xent               TSX1    HFC$UNLOCK
         2 001147   000000 011000                    NOP     0

      934     8871    1           RETURN;

   8871  2 001150   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   370000 770000                                                    ....

(unnamed)
 Sect OctLoc
   3     000   000000 006000   577777 777777   001777 777774   000003 777774    ................
   3     004   777777 600777   677777 777777   777777 737777   777777 777775    ................
   3     010   000000 006000   000000 006000   000000 040000   000011 006000    .......... .....
   3     014   000002 006000   000012 006000   777377 777777   000000 006000    ................
   3     020   000003 006000   000027 600000   000000 006000                    ............
      935     8872        /**/
      936     8873    1   END NIO$COMP;
      937     8874        %EOD;

PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:164  
--  Include file information  --

   S_WSPTD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIO$COMP.
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:165  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @N$REQ                     4-0-0/w PTR         r     1 @NI$EXTST
     5-0-0/w PTR         r     1 DCB$                       6-0-0/w PTR         r     1 DCT$
     7-0-0/w STRC(468)   r     1 EVBLK                     24-0-0/w EPTR        r     1 EXRTN
    25-0-0/w STRC(288)   r     1 EXTSTAT                   35-0-0/w PTR         r     1 IOSTAT$
    36-0-0/w PTR         r     1 LSTA$                     37-0-0/w PTR         r     1 MDCT$
    40-0-0/w SBIN        r     1 MDCTX                     *0-0-0/d STRC(1080)  r     1 N$REQ
    *0-0-0/w STRC(288)   r     1 NI$EXTST                  41-0-0/w PTR         r     1 REL$
    42-0-0/w UBIN        r     1 TEMP                      43-0-0/w BIT         r     1 TYC
    44-0-0/w UBIN        r     1 UFLAG

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/w BIT (72)    r     1 F_DCBLOCK
     0-0-0/w BIT         r     1 HW_IMX                     0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w PTR         r     1 N$FQ$                      0-0-0/w PTR         r     1 NI$FQ$
     0-0-0/w PTR         r     1 NI$IBUF$                   0-0-0/w PTR         r     1 NI$RP$
     0-0-0/w PTR         r     1 NI_COMPHD$                 0-0-0/w SBIN        r     1 NI_INTLVL
     0-0-0/w BIT (72)    r     1 NI_MFGATE                  0-0-0/w BIT (72)    r     1 S_ASFGATE
     0-0-0/w BIT (72)    r     1 S_UDLGATE                  0-0-0/w STRC        r     1 S_WSPTD(0:28)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(396)   r     1 B$DO                       0-0-0/d STRC(576)   r     1 B$U
     0-0-0/w STRC(576)   r     1 B$USER(0:0)                0-0-0/w STRC(288)   r     1 EXTST
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:166  
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/d STRC(504)   r     1 IOS
     0-0-0/d STRC(576)   r     1 IOSTAT                     0-0-0/w PTR         r     1 N$DCT$(0:0)
     0-0-0/w STRC(1332)  r     1 NI$DCT                     0-0-0/w STRC(180)   r     1 NI$RP
     0-0-0/w STRC        r     1 POINTER                    0-0-0/w STRC(288)   r     1 VSTA


   Procedure NIO$COMP requires 617 words for executable code.
   Procedure NIO$COMP requires 46 words of local(AUTO) storage.
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:167  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:168  
          MINI XREF LISTING

B$DO.ECCINFO
       162**DCL       163--REDEF
B$DO.IOCOMP.ARS
       165**DCL      8799<<ASSIGN   8799>>ASSIGN
B$DO.IOCOMP.CNTR
       170**DCL      8795<<ASSIGN   8795>>ASSIGN   8800>>IF
B$DO.IOCOMP.DVE
       166**DCL      8797<<ASSIGN
B$DO.IOCOMP.TYC
       164**DCL      8796<<ASSIGN   8796>>ASSIGN
B$EVNT.CODE
      8458**DCL      8458--REDEF    8459--REDEF    8459--REDEF
B$EVNT.ERR.ERR#
      8460**DCL      8460--REDEF
B$EVNT.EVID
      8459**DCL      8459--REDEF    8459--REDEF
B$U.ASYNCH
        99**DCL      8718<<ASSIGN   8718>>ASSIGN   8734<<ASSIGN   8734>>ASSIGN
B$U.MISC
       141**DCL       142--REDEF
B$USER
       186**DCL      8717--ASSIGN   8733--ASSIGN
B$USER.CMF
       200**DCL      8829<<ASSIGN   8829>>ASSIGN
B$USER.MISC
       217**DCL       218--REDEF
B$USER.PT
       211**DCL      8747>>ASSIGN
B$USRT$
      8317**DCL      8717>>ASSIGN   8733>>ASSIGN   8747>>ASSIGN   8829>>ASSIGN   8829>>ASSIGN
COMPCMN
      8684**LABEL    8651--GOTO     8662--GOTO     8668--GOTO     8674--GOTO
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:169  
DCB$
      8327**DCL      8749<<ASSIGN   8750--ASSIGN   8752>>ASSIGN   8753>>ASSIGN   8754>>ASSIGN   8757>>ASSIGN
      8757>>ASSIGN   8759>>IF       8762>>ASSIGN   8767>>ASSIGN   8767>>ASSIGN   8768>>ASSIGN   8768>>ASSIGN
      8769>>IF       8770>>IF       8771>>ASSIGN   8776>>ASSIGN   8776>>ASSIGN   8777>>ASSIGN   8777>>ASSIGN
      8778>>IF       8779>>IF       8780>>ASSIGN
DCT$
      8328**DCL      8685<<ASSIGN   8686>>IF       8686>>IF       8688>>ASSIGN   8690>>IF
DVT.MPC
      8520**DCL      8521--REDEF
EVBLK
      8333**DCL      8819--ASSIGN   8821--ASSIGN   8823--CALL
EVBLK.ARS
      8335**DCL      8814<<ASSIGN
EVBLK.CGPARM
      8351**DCL      8818<<ASSIGN   8821--ASSIGN
EVBLK.CGPARM.MSGIDXT
      8359**DCL      8362--REDEF
EVBLK.DVE
      8335**DCL      8815<<ASSIGN
EVBLK.P#
      8335**DCL      8819<<ASSIGN   8819--ASSIGN   8821<<ASSIGN   8821--ASSIGN
EVBLK.TYC
      8335**DCL      8813<<ASSIGN
EXRTN
      8410**DCL      8710<<ASSIGN   8711>>CALL
EXTST
      8529**DCL      8632<<ASSIGN
EXTST.EXTST
      8533**DCL      8535--REDEF    8537--REDEF    8634<<ASSIGN
EXTSTAT
      8416**DCL      8840<<ASSIGN   8841<>CALL
EXTSTAT.EXTST
      8420**DCL      8422--REDEF    8424--REDEF    8838<<ASSIGN
F$DCB.ACTPOS
      7020**DCL      7020--REDEF
F$DCB.ARS
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:170  
      6995**DCL      6995--REDEF    8752<<ASSIGN
F$DCB.ATTR
      7013**DCL      7014--REDEF
F$DCB.BORROW
      7028**DCL      7028--REDEF    7028--REDEF    7028--REDEF
F$DCB.DCBNAME.L
      7042**DCL      7042--IMP-SIZ
F$DCB.DVBYTE
      6998**DCL      8754<<ASSIGN
F$DCB.EOMCHAR
      6999**DCL      6999--REDEF    8753<<ASSIGN
F$DCB.FCN.CNT
      7032**DCL      8768<<ASSIGN   8768>>ASSIGN   8769>>IF       8777<<ASSIGN   8777>>ASSIGN   8778>>IF
F$DCB.FCN.F
      7032**DCL      8770>>IF       8771<<ASSIGN   8779>>IF       8780<<ASSIGN
F$DCB.FLDID
      7023**DCL      7023--REDEF
F$DCB.FORM$
      7017**DCL      7017--REDEF
F$DCB.FSECT
      7033**DCL      7033--REDEF
F$DCB.FSN
      7010**DCL      7010--REDEF    7010--REDEF    7011--REDEF
F$DCB.HEADER$
      7016**DCL      7016--REDEF
F$DCB.IXTNSIZE
      7014**DCL      7014--REDEF
F$DCB.LASTSTA$
      7004**DCL      7004--REDEF    8762>>ASSIGN
F$DCB.LSTAOR
      7007**DCL      8759>>IF
F$DCB.LVL
      7029**DCL      7029--REDEF
F$DCB.NAME.C
      7004**DCL      7004--REDEF
F$DCB.NOEOF
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:171  
      7025**DCL      7025--REDEF
F$DCB.NRECS
      7015**DCL      7015--REDEF
F$DCB.NRECX
      7034**DCL      7034--REDEF
F$DCB.OHDR
      7026**DCL      7026--REDEF
F$DCB.ORG
      7009**DCL      7009--REDEF
F$DCB.PRECNO
      7032**DCL      7032--REDEF
F$DCB.RCSZ
      7037**DCL      7037--REDEF
F$DCB.RES
      7005**DCL      7005--REDEF
F$DCB.RETRYCNT
      7002**DCL      8757<<ASSIGN   8757>>ASSIGN
F$DCB.SETX
      7017**DCL      7017--REDEF
F$DCB.TAB$
      7016**DCL      7017--REDEF
F$DCB.TDA
      7031**DCL      7031--REDEF
F$DCB.TYC
      6995**DCL      8767<<ASSIGN   8767>>ASSIGN   8776<<ASSIGN   8776>>ASSIGN
F$DCB.WSN
      7006**DCL      7006--REDEF
F_DCBLOCK
      8319**DCL      8745<>CALL     8785<>CALL
HFC$ASSOCCLR
      8301**DCL-ENT  8748--CALL
HFC$LOCK
      7099**DCL-ENT  8715--CALL     8731--CALL     8745--CALL     8793--CALL     8827--CALL     8851--CALL
      8863--CALL
HFC$UNLOCK
      7099**DCL-ENT  8720--CALL     8736--CALL     8785--CALL     8803--CALL     8809--CALL     8831--CALL
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:172  
      8857--CALL     8869--CALL
HW_IMX
      7085**DCL      8655>>IF
IOS.DCW
      8569**DCL      8572--REDEF    8632--ASSIGN   8634--ASSIGN
IOS.DCW.TALLY
      8570**DCL      8570--REDEF
IOS.IDCW.EXTA
      8572**DCL      8572--REDEF
IOS.PCW
      8574**DCL      8578--REDEF
IOS.SEEK
      8579**DCL      8580--REDEF    8581--REDEF
IOSTAT.AESDCW
      8589**DCL      8589--REDEF
IOSTAT.LAST_IDCW.COUNT
      8589**DCL      8657>>ASSIGN
IOSTAT$
      8445**DCL      8656<<ASSIGN   8657>>ASSIGN
LSTA$
      8446**DCL      8762<<ASSIGN   8763--ASSIGN   8764>>ASSIGN
MDCT$
      8447**DCL      8689<<ASSIGN   8693>>ASSIGN
MDCTX
      8448**DCL      8688<<ASSIGN   8689>>ASSIGN   8692>>ASSIGN
N$DCT$
      7645**DCL      8685>>ASSIGN   8689>>ASSIGN   8825>>IF
N$DCT$$
      7511**DCL      7645--IMP-PTR  8685>>ASSIGN   8689>>ASSIGN   8825>>IF
N$FQ$
      7511**DCL      7646--IMP-PTR
N$REQ
      8215**DCL         7--PROC     8636<>CALL     8644--ENTRY    8666--ENTRY    8672--ENTRY    8678--ENTRY
      8684<>CALL     8711<>CALL     8723--CALL     8725<>CALL     8841<>CALL     8844--CALL     8854<>CALL
      8866<>CALL
N$REQ.ARCT
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:173  
      8250**DCL      8724<<ASSIGN
N$REQ.ARSIZE
      8248**DCL      8657<<ASSIGN   8660<<ASSIGN   8752>>ASSIGN   8799>>ASSIGN   8814>>ASSIGN
N$REQ.BPMIR
      8260**DCL      8690>>IF       8697<<ASSIGN
N$REQ.BUFADDR
      8224**DCL      8225--REDEF    8225--REDEF    8660>>ASSIGN   8702<<ASSIGN
N$REQ.BUFREAL_SV
      8257**DCL      8702>>ASSIGN
N$REQ.COMP
      8249**DCL      8667<<ASSIGN   8673<<ASSIGN   8679<<ASSIGN   8705>>DOCASE   8759>>IF       8759>>IF
      8816>>IF       8816>>IF
N$REQ.DCB$
      8246**DCL      8743>>IF       8749>>ASSIGN
N$REQ.DCT$
      8216**DCL      8693<<ASSIGN
N$REQ.DLA.DCTX
      8215**DCL      8685>>ASSIGN   8692<<ASSIGN   8825>>IF
N$REQ.DLA.DRELADDR
      8216**DCL      8216--REDEF
N$REQ.DOMIR
      8259**DCL      8695<<ASSIGN
N$REQ.DOPTR$
      8248**DCL      8795>>ASSIGN   8795>>ASSIGN   8796>>ASSIGN   8796>>ASSIGN   8797>>ASSIGN   8799>>ASSIGN
      8799>>ASSIGN   8800>>IF       8805<>CALL
N$REQ.DVE
      8250**DCL      8797>>ASSIGN   8815>>ASSIGN
N$REQ.DVE.DVBYTE
      8250**DCL      8754>>ASSIGN
N$REQ.DVE.EOMCHAR
      8253**DCL      8254--REDEF    8753>>ASSIGN
N$REQ.EAENTRY
      8246**DCL      8710>>ASSIGN
N$REQ.EAINFO
      8247**DCL      8247--REDEF
N$REQ.EAINFOX
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:174  
      8247**DCL      8248--REDEF
N$REQ.ERR$
      8237**DCL      8684>>IF
N$REQ.ERRCT
      8217**DCL      8756>>IF       8757>>ASSIGN
N$REQ.EVNTINFO
      8248**DCL      8248--REDEF    8812>>IF       8823<>CALL
N$REQ.FLTSTAT.DCW
      8236**DCL      8651>>IF
N$REQ.IOP_BUFREAL_CVRT
      8255**DCL      8699>>IF       8703<<ASSIGN
N$REQ.IOQFLG.INUSE
      8258**DCL      8645>>IF
N$REQ.IOQFLG.IOQUED
      8258**DCL      8645>>IF       8647<<ASSIGN   8849<<ASSIGN   8861<<ASSIGN
N$REQ.IOS$
      8228**DCL      8630>>IF       8632>>ASSIGN   8634>>ASSIGN   8656>>ASSIGN
N$REQ.MIRDONE
      8260**DCL      8696<<ASSIGN
N$REQ.NOALT
      8218**DCL      8848>>IF
N$REQ.NWIO
      8254**DCL      8766>>IF
N$REQ.OPFLG.ARS
      8221**DCL      8751>>IF       8798>>IF
N$REQ.OPFLG.CLR
      8224**DCL      8713>>IF       8729>>IF
N$REQ.OPFLG.EA
      8222**DCL      8708>>IF
N$REQ.OPFLG.EVNT
      8222**DCL      8791>>IF
N$REQ.OPFLG.HOLD
      8223**DCL      8843>>IF
N$REQ.OPFLG.REQ
      8223**DCL      8709<<ASSIGN   8712>>IF
N$REQ.OPFLG.USER
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:175  
      8221**DCL      8741>>IF
N$REQ.OPFLG.WAIT
      8222**DCL      8769>>IF       8778>>IF       8788>>IF
N$REQ.PTP
      8226**DCL      8701<<ASSIGN
N$REQ.STATION.LSTA$
      8228**DCL      8764>>ASSIGN   8818>>ASSIGN
N$REQ.STATUS
      8229**DCL      8235--REDEF
N$REQ.STATUS.NCP
      8233**DCL      8651>>IF       8653>>ASSIGN
N$REQ.STATUS.NWA
      8233**DCL      8660>>ASSIGN
N$REQ.TYC
      8237**DCL      8739>>IF       8739>>ASSIGN   8813>>ASSIGN
N$REQ.TYC.EGV
      8237**DCL      8707<<ASSIGN
N$REQ.USER#
      8249**DCL      8717>>ASSIGN   8733>>ASSIGN   8747>>ASSIGN   8801>>ASSIGN   8823<>CALL     8829>>ASSIGN
      8829>>ASSIGN   8834<>CALL
N$REQ.WSR
      8256**DCL      8822>>ASSIGN
N$REQ_INIT.BUFADDR
      7530**DCL      7531--REDEF    7531--REDEF
N$REQ_INIT.DLA.DRELADDR
      7522**DCL      7522--REDEF
N$REQ_INIT.DVE.EOMCHAR
      7559**DCL      7560--REDEF
N$REQ_INIT.EAINFO
      7553**DCL      7553--REDEF
N$REQ_INIT.EAINFOX
      7553**DCL      7554--REDEF
N$REQ_INIT.EVNTINFO
      7554**DCL      7554--REDEF
N$REQ_INIT.STATUS
      7535**DCL      7541--REDEF
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:176  
NI$DCT.DFLG.CM
      8481**DCL      8825>>IF
NI$DCT.DP
      8498**DCL      8505--REDEF    8508--REDEF    8509--REDEF    8511--REDEF    8511--REDEF    8512--REDEF
      8513--REDEF    8513--REDEF
NI$DCT.DP.MIRROR.DCTX
      8503**DCL      8688>>ASSIGN
NI$DCT.DP.MIRROR.FLAG
      8500**DCL      8686>>IF
NI$DCT.DP.MIRROR.PRI
      8502**DCL      8690>>IF
NI$DCT.MPC.IOCHANX
      8506**DCL      8506--REDEF
NI$DCT.TYPE
      8488**DCL      8686>>IF
NI$EXTST
      8269**DCL         7--PROC     8631--IF       8632>>ASSIGN   8644--ENTRY    8837--IF       8840>>ASSIGN
NI$EXTST.EXTST
      8273**DCL      8275--REDEF    8277--REDEF
NI$FQ$
      7571**DCL      7647--IMP-PTR
NI$IBUF$
      7571**DCL      7647--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
      7581**DCL      7582--REDEF    7582--REDEF
NI$IMXMBX_INIT.SIZE
      7583**DCL      7583--REDEF
NI$REQ_INIT.DCW
      7605**DCL      7608--REDEF
NI$REQ_INIT.DCW.TALLY
      7606**DCL      7606--REDEF
NI$REQ_INIT.IDCW.EXTA
      7608**DCL      7608--REDEF
NI$REQ_INIT.PCW
      7610**DCL      7614--REDEF
NI$REQ_INIT.SEEK
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:177  
      7615**DCL      7616--REDEF    7617--REDEF
NI$RP.GATE
      7649**DCL      8851<>CALL     8857<>CALL     8863<>CALL     8869<>CALL
NI$RP.RC$
      7649**DCL      8866<>CALL
NI$RP.RQ$
      7649**DCL      8854<>CALL
NI$RP$
      7619**DCL      7649--IMP-PTR  8851>>CALL     8854>>CALL     8857>>CALL     8863>>CALL     8866>>CALL
      8869>>CALL
NIA$RELERR
      8302**DCL-ENT  8684--CALL
NIM$ENQUEUE
      7675**DCL-ENT  8636--CALL     8854--CALL     8866--CALL
NIO$REQUE
      8303**DCL-ENT  8725--CALL
NIQ$GETID
      8304**DCL-ENT  8723--CALL
NIQ$REL
      8305**DCL-ENT  8844--CALL
NI_COMPHD$
      8321**DCL      8636<>CALL
NI_INTLVL
      8320**DCL      8629>>IF
NI_MBX_INIT.DCW.CONTROL.AE
      7641**DCL      7641--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      7637**DCL      7637--REDEF
NI_MFGATE
      7644**DCL      8827<>CALL     8831<>CALL
POINTER.SEGID
      8594**DCL      8750<<ASSIGN   8763<<ASSIGN
RECOMP
      8849**LABEL    8711--CALLALT  8848--GOTO
REL$
      8449**DCL      8717<<ASSIGN   8718>>ASSIGN   8718>>ASSIGN   8733<<ASSIGN   8734>>ASSIGN   8734>>ASSIGN
PL6.E3A0      #002=NIO$COMP File=NIO$QUE.:E05TSI                                 WED 07/30/97 03:36 Page:178  
REQUE
      8843**LABEL    8725--CALLALT
SC_NIOBADIOQ
      8307**DCL-ENT  8646--CALL
SSR$RUE
      8308**DCL-ENT  8834--CALL
SSV$EVENT
      8309**DCL-ENT  8823--CALL
SSV$SCHDDO
      8310**DCL-ENT  8805--CALL
S_ASFGATE
      8322**DCL      8715<>CALL     8720<>CALL     8731<>CALL     8736<>CALL
S_UDLGATE
      8323**DCL      8793<>CALL     8803<>CALL     8809<>CALL
S_WSPTD.BLKNO
      8195**DCL      8747<<ASSIGN
TDC$COMP
      8311**DCL-ENT  8841--CALL
TEMP
      8450**DCL      8653<<ASSIGN   8654>>IF       8654<<ASSIGN   8657>>ASSIGN   8660>>ASSIGN   8801<<ASSIGN
      8805<>CALL     8822<<ASSIGN   8823<>CALL
TYC
      8451**DCL      8739<<ASSIGN   8740<<ASSIGN   8767>>ASSIGN   8776>>ASSIGN   8796>>ASSIGN
UFLAG
      8452**DCL      8742<<ASSIGN   8772<<ASSIGN   8781<<ASSIGN   8789<<ASSIGN   8834<>CALL
VSTA
      8607**DCL      8764<<ASSIGN   8764>>ASSIGN   8818>>ASSIGN
VSTA.MSGIDXT
      8617**DCL      8620--REDEF

PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:179  
      938        1        /*T***********************************************************/
      939        2        /*T*                                                         */
      940        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      941        4        /*T*                                                         */
      942        5        /*T***********************************************************/
      943        6        NIO$COMPQUE: PROC;
      944        7        /*
      945        8                Includes
      946        9        */
      947       10        %INCLUDE                N$REQ ;
      948       84        %INCLUDE                NI$TABLES ;
      949      300        %INCLUDE                NI_MACROS_C ;
      950      567        /*
      951      568                Entries
      952      569        */
      953      570    1   DCL 1 NIO$COMPX         ENTRY(2) ;
      954      571        /*
      955      572                Symrefs
      956      573        */
      957      574    1   DCL 1 NI_COMPHD$        PTR SYMREF ;
      958      575        /*
      959      576                Auto
      960      577        */
      961      578    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
      962      579        /*
      963      580                Based
      964      581        */
      965      582        %NI$REQ                 ( NAME=IOS, STCLASS=BASED ) ;
      966      607        %N$REQ                  ( NAME=REQ, STCLASS="BASED(REQ$)" ) ;
      967      665        %EJECT ;
PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:180  
      968      666    2           DO INHIBIT;
      969      667    3              DO WHILE(NI_COMPHD$~=ADDR(NIL));
      970      668                      %DEQUEUE (P#=REQ$,Q#=NI_COMPHD$);
      971      675    3                 IF REQ.IOS$ ~= ADDR(NIL) THEN
      972      676    3                    CALL NIO$COMPX(REQ,REQ.IOS$->IOS.DCW(0));
               676                             /* EXTST stored in IOS packet */
      973      677    3                 ELSE
      974      678    3                    CALL NIO$COMPX(REQ);
      975      679    3                 END;
      976      680    2              END;
      977      681    1           RETURN;
      978      682    1   END NIO$COMPQUE;
      979      683        %EOD;

PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:181  
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
      No diagnostics issued in procedure NIO$COMPQUE.

   Procedure NIO$COMPQUE requires 33 words for executable code.
   Procedure NIO$COMPQUE requires 6 words of local(AUTO) storage.

PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:182  

 Object Unit name= NIO$COMPQUE                                File name= NIO$QUE.:E05TOU
 UTS= JUL 30 '97 03:38:14.60 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    33     41  NIO$COMPQUE
    1  RoData even  none     1      1  NIO$COMPQUE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        0  NIO$COMPQUE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 NIM$DEQUEUE
         yes           Std       2 NIO$COMPX
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NI_COMPHD$                            B_VECTNIL
PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:183  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:184  


      938        1        /*T***********************************************************/
      939        2        /*T*                                                         */
      940        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      941        4        /*T*                                                         */
      942        5        /*T***********************************************************/
      943        6        NIO$COMPQUE: PROC;

      6  0 000000   000000 700200 xent  NIO$COMPQUE  TSX0  ! X66_AUTO_0
         0 000001   000006 000000                    ZERO    6,0

      944        7        /*
      945        8                Includes
      946        9        */
      947       10        %INCLUDE                N$REQ ;
      948       84        %INCLUDE                NI$TABLES ;
      949      300        %INCLUDE                NI_MACROS_C ;
      950      567        /*
      951      568                Entries
      952      569        */
      953      570    1   DCL 1 NIO$COMPX         ENTRY(2) ;
      954      571        /*
      955      572                Symrefs
      956      573        */
      957      574    1   DCL 1 NI_COMPHD$        PTR SYMREF ;
      958      575        /*
      959      576                Auto
      960      577        */
      961      578    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
      962      579        /*
      963      580                Based
      964      581        */
      965      582        %NI$REQ                 ( NAME=IOS, STCLASS=BASED ) ;
      966      607        %N$REQ                  ( NAME=REQ, STCLASS="BASED(REQ$)" ) ;
      967      665        %EJECT ;
PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:185  
      968      666    2           DO INHIBIT;

      969      667    3              DO WHILE(NI_COMPHD$~=ADDR(NIL));

    667  0 000002   000035 710200 0                  TRA   ! s:679

      970      668                      %DEQUEUE (P#=REQ$,Q#=NI_COMPHD$);

    672  0 000003   000000 236200 1                  LDQ   ! 0
         0 000004   200005 756300                    STQ   ! REQ$+2,,AUTO
         0 000005   200003 630700                    EPPR0 ! REQ$,,AUTO
         0 000006   200004 450700                    STP0  ! REQ$+1,,AUTO
         0 000007   200004 630700                    EPPR0 ! REQ$+1,,AUTO
         0 000010   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         0 000011   000000 701200 xent               TSX1  ! NIM$DEQUEUE
         0 000012   000000 011200                    NOP   ! 0

      971      675    3                 IF REQ.IOS$ ~= ADDR(NIL) THEN

    675  0 000013   200003 470700                    LDP0  ! REQ$,,AUTO
         0 000014   000012 236300                    LDQ   ! 10,,PR0
         0 000015   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         0 000016   000031 600200 0                  TZE   ! s:678

      972      676    3                    CALL NIO$COMPX(REQ,REQ.IOS$->IOS.DCW(0));
               676                             /* EXTST stored in IOS packet */

    676  0 000017   000012 471700                    LDP1  ! 10,,PR0
         0 000020   100002 633700                    EPPR3 ! 2,,PR1
         0 000021   200005 453700                    STP3  ! REQ$+2,,AUTO
         0 000022   200003 236300                    LDQ   ! REQ$,,AUTO
         0 000023   200004 756300                    STQ   ! REQ$+1,,AUTO
         0 000024   200004 630700                    EPPR0 ! REQ$+1,,AUTO
         0 000025   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         0 000026   000000 701200 xent               TSX1  ! NIO$COMPX
         0 000027   000000 011200                    NOP   ! 0
         0 000030   000035 710200 0                  TRA   ! s:679
PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:186  

      973      677    3                 ELSE
      974      678    3                    CALL NIO$COMPX(REQ);

    678  0 000031   200003 630700                    EPPR0 ! REQ$,,AUTO
         0 000032   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         0 000033   000000 701200 xent               TSX1  ! NIO$COMPX
         0 000034   000000 011200                    NOP   ! 0

      975      679    3                 END;

    679  0 000035   000000 236200 xsym               LDQ   ! NI_COMPHD$
         0 000036   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         0 000037   000003 601200 0                  TNZ   ! s:672

      976      680    2              END;

      977      681    1           RETURN;

    681  0 000040   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000000 006000                                                    ....
      978      682    1   END NIO$COMPQUE;
      979      683        %EOD;

PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:187  
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
      No diagnostics issued in procedure NIO$COMPQUE.
PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:188  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 REQ$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 NI_COMPHD$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(504)   r     1 IOS                        0-0-0/d STRC(1080)  r     1 REQ


   Procedure NIO$COMPQUE requires 33 words for executable code.
   Procedure NIO$COMPQUE requires 6 words of local(AUTO) storage.
PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:189  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:190  
          MINI XREF LISTING

IOS.DCW
       593**DCL       596--REDEF     676<>CALL
IOS.DCW.TALLY
       594**DCL       594--REDEF
IOS.IDCW.EXTA
       596**DCL       596--REDEF
IOS.PCW
       598**DCL       602--REDEF
IOS.SEEK
       603**DCL       604--REDEF     605--REDEF
NIM$DEQUEUE
       324**DCL-ENT   672--CALL
NIO$COMPX
       570**DCL-ENT   676--CALL      678--CALL
NI_COMPHD$
       574**DCL       667>>DOWHILE   672<>CALL
REQ
       616**DCL       676<>CALL      678<>CALL
REQ.BUFADDR
       625**DCL       626--REDEF     626--REDEF
REQ.DLA.DRELADDR
       617**DCL       617--REDEF
REQ.DVE.EOMCHAR
       654**DCL       655--REDEF
REQ.EAINFO
       648**DCL       648--REDEF
REQ.EAINFOX
       648**DCL       649--REDEF
REQ.EVNTINFO
       649**DCL       649--REDEF
REQ.IOS$
       629**DCL       675>>IF        676>>CALL
PL6.E3A0      #003=NIO$COMPQUE File=NIO$QUE.:E05TSI                              WED 07/30/97 03:38 Page:191  
REQ.STATUS
       630**DCL       636--REDEF
REQ$
       578**DCL       616--IMP-PTR   672<>CALL      675>>IF        676>>CALL      676>>CALL      678>>CALL

PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:192  
      980        1        /*M*  NIO$SPINTCON - SPECIAL INTERRUPT CONNECTION                            */
      981        2        /*T***********************************************************/
      982        3        /*T*                                                         */
      983        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      984        5        /*T*                                                         */
      985        6        /*T***********************************************************/
      986        7        NIO$SPINTCON: PROC(DCTX,INTADDR,INTINFO) ALTRET;
      987        8        /*
      988        9                Includes
      989       10        */
      990       11        %INCLUDE                NI_DATA_C ;
      991      124        %INCLUDE                NI_DATA_R ;
      992      561        %INCLUDE                NI_MACROS_C ;
      993      828        /*
      994      829                Parameters
      995      830        */
      996      831    1   DCL 1 DCTX              UBIN(15) UNAL PARAM ;
      997      832    1   DCL 1 INTADDR           EPTR PARAM ;
      998      833    1   DCL 1 INTINFO           UBIN PARAM ;
      999      834        /*
     1000      835                Entries
     1001      836        */
     1002      837    1   DCL 1 SC_NIOINVDLA      ENTRY CONV(2,0) ;
     1003      838        /*
     1004      839                Auto
     1005      840        */
     1006      841    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
     1007      842        /*
     1008      843                Based
     1009      844        */
     1010      845        %NI$DCT                 ( NAME=DCT, STCLASS="BASED(DCT$)" ) ;
     1011      893        %EJECT ;
PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:193  
     1012      894        /**/
     1013      895    1           IF DCTX=0 OR DCTX>N_DCTXMAX
     1014      896    1           THEN CALL SC_NIOINVDLA;
     1015      897    1           DCT$=N$DCT$(DCTX);
     1016      898    1           IF DCT.SPEC~=ENTADDR(NIL) AND INTADDR~=ENTADDR(NIL) THEN ALTRETURN;
     1017      899    1           DCT.SPEC = INTADDR;
     1018      900    1           IF ADDR(INTINFO) ~= ADDR(NIL)
     1019      901    1           THEN DCT.SPECINFO = INTINFO;
     1020      902    1           ELSE DCT.SPECINFO = 0;
     1021      903    1           RETURN;
     1022      904    1   END NIO$SPINTCON;
     1023      905             %EOD;

PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:194  
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
      No diagnostics issued in procedure NIO$SPINTCON.

   Procedure NIO$SPINTCON requires 46 words for executable code.
   Procedure NIO$SPINTCON requires 10 words of local(AUTO) storage.

PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:195  

 Object Unit name= NIO$SPINTCON                               File name= NIO$QUE.:E05TOU
 UTS= JUL 30 '97 03:38:24.84 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    46     56  NIO$SPINTCON

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        3  NIO$SPINTCON

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_NIOINVDLA                          N$DCT$$                               N$FQ$
     NI$FQ$                                NI$IBUF$                              NI$RP$
     N_DCTXMAX                             B_VECTNIL
PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:196  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID
PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:197  


      980        1        /*M*  NIO$SPINTCON - SPECIAL INTERRUPT CONNECTION                            */
      981        2        /*T***********************************************************/
      982        3        /*T*                                                         */
      983        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      984        5        /*T*                                                         */
      985        6        /*T***********************************************************/
      986        7        NIO$SPINTCON: PROC(DCTX,INTADDR,INTINFO) ALTRET;

      7  0 000000   000000 700200 xent  NIO$SPINTCON TSX0  ! X66_AUTO_3
         0 000001   000012 000003                    ZERO    10,3

      987        8        /*
      988        9                Includes
      989       10        */
      990       11        %INCLUDE                NI_DATA_C ;
      991      124        %INCLUDE                NI_DATA_R ;
      992      561        %INCLUDE                NI_MACROS_C ;
      993      828        /*
      994      829                Parameters
      995      830        */
      996      831    1   DCL 1 DCTX              UBIN(15) UNAL PARAM ;
      997      832    1   DCL 1 INTADDR           EPTR PARAM ;
      998      833    1   DCL 1 INTINFO           UBIN PARAM ;
      999      834        /*
     1000      835                Entries
     1001      836        */
     1002      837    1   DCL 1 SC_NIOINVDLA      ENTRY CONV(2,0) ;
     1003      838        /*
     1004      839                Auto
     1005      840        */
     1006      841    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
     1007      842        /*
     1008      843                Based
     1009      844        */
     1010      845        %NI$DCT                 ( NAME=DCT, STCLASS="BASED(DCT$)" ) ;
     1011      893        %EJECT ;
PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:198  
     1012      894        /**/
     1013      895    1           IF DCTX=0 OR DCTX>N_DCTXMAX

    895  0 000002   200003 470500                    LDP0    @DCTX,,AUTO
         0 000003   003100 061500                    CSR     bolr='003'O
         0 000004   000000 000017                    BDSC    0,,PR0                   by=0,bit=0,n=15
         0 000005   200010 000044                    BDSC    DCT$+2,,AUTO             by=0,bit=0,n=36
         0 000006   200010 236100                    LDQ     DCT$+2,,AUTO
         0 000007   000000 116003                    CMPQ    0,DU
         0 000010   000017 600000 0                  TZE     s:896
         0 000011   003100 061500                    CSR     bolr='003'O
         0 000012   000000 000017                    BDSC    0,,PR0                   by=0,bit=0,n=15
         0 000013   200011 000044                    BDSC    DCT$+3,,AUTO             by=0,bit=0,n=36
         0 000014   200011 236100                    LDQ     DCT$+3,,AUTO
         0 000015   000000 116000 xsym               CMPQ    N_DCTXMAX
         0 000016   000021 604400 0                  TMOZ    s:897

     1014      896    1           THEN CALL SC_NIOINVDLA;

    896  0 000017   000000 713400 xsym               CLIMB   SC_NIOINVDLA
         0 000020   000000 600000 xsid               climb   nvectors=         0

     1015      897    1           DCT$=N$DCT$(DCTX);

    897  0 000021   200003 470500                    LDP0    @DCTX,,AUTO
         0 000022   003100 061500                    CSR     bolr='003'O
         0 000023   000000 000017                    BDSC    0,,PR0                   by=0,bit=0,n=15
         0 000024   200010 000022                    BDSC    DCT$+2,,AUTO             by=0,bit=0,n=18
         0 000025   200010 220100                    LDX0    DCT$+2,,AUTO
         0 000026   000000 471400 xsym               LDP1    N$DCT$$
         0 000027   100000 236110                    LDQ     0,X0,PR1
         0 000030   200006 756100                    STQ     DCT$,,AUTO

     1016      898    1           IF DCT.SPEC~=ENTADDR(NIL) AND INTADDR~=ENTADDR(NIL) THEN ALTRETURN;

    898  0 000031   200006 473500                    LDP3    DCT$,,AUTO
         0 000032   300020 236100                    LDQ     16,,PR3
PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:199  
         0 000033   000002 116000 xsym               CMPQ    B_VECTNIL+2
         0 000034   000042 600000 0                  TZE     s:899
         0 000035   200004 474500                    LDP4    @INTADDR,,AUTO
         0 000036   400000 236100                    LDQ     0,,PR4
         0 000037   000002 116000 xsym               CMPQ    B_VECTNIL+2
         0 000040   000042 600000 0                  TZE     s:899

    898  0 000041   000000 702200 xent               TSX2  ! X66_AALT

     1017      899    1           DCT.SPEC = INTADDR;

    899  0 000042   200004 474500                    LDP4    @INTADDR,,AUTO
         0 000043   400000 236100                    LDQ     0,,PR4
         0 000044   300020 756100                    STQ     16,,PR3

     1018      900    1           IF ADDR(INTINFO) ~= ADDR(NIL)

    900  0 000045   200005 236100                    LDQ     @INTINFO,,AUTO
         0 000046   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000047   000054 600000 0                  TZE     s:902

     1019      901    1           THEN DCT.SPECINFO = INTINFO;

    901  0 000050   200005 475500                    LDP5    @INTINFO,,AUTO
         0 000051   500000 235100                    LDA     0,,PR5
         0 000052   300021 755100                    STA     17,,PR3
         0 000053   000055 710000 0                  TRA     s:903

     1020      902    1           ELSE DCT.SPECINFO = 0;

    902  0 000054   300021 450100                    STZ     17,,PR3

     1021      903    1           RETURN;

    903  0 000055   000000 702200 xent               TSX2  ! X66_ARET
     1022      904    1   END NIO$SPINTCON;
     1023      905             %EOD;
PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:200  

PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:201  
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
      No diagnostics issued in procedure NIO$SPINTCON.
PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:202  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DCTX                      4-0-0/w PTR         r     1 @INTADDR
     5-0-0/w PTR         r     1 @INTINFO                   6-0-0/w PTR         r     1 DCT$
    *0-0-0/b UBIN(15)    r     1 DCTX                      *0-0-0/w EPTR        r     1 INTADDR
    *0-0-0/w UBIN        r     1 INTINFO

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/w SBIN        r     1 N_DCTXMAX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w PTR         r     1 N$DCT$(0:0)


   Procedure NIO$SPINTCON requires 46 words for executable code.
   Procedure NIO$SPINTCON requires 10 words of local(AUTO) storage.
PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:203  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:204  
          MINI XREF LISTING

DCT.DP
       874**DCL       881--REDEF     884--REDEF     885--REDEF     887--REDEF     887--REDEF     888--REDEF
       889--REDEF     889--REDEF
DCT.MPC.IOCHANX
       882**DCL       882--REDEF
DCT.SPEC
       869**DCL       898>>IF        899<<ASSIGN
DCT.SPECINFO
       869**DCL       901<<ASSIGN    902<<ASSIGN
DCT$
       841**DCL       854--IMP-PTR   897<<ASSIGN    898>>IF        899>>ASSIGN    901>>ASSIGN    902>>ASSIGN
DCTX
       831**DCL         7--PROC      895>>IF        895>>IF        897>>ASSIGN
INTADDR
       832**DCL         7--PROC      898>>IF        899>>ASSIGN
INTINFO
       833**DCL         7--PROC      900--IF        901>>ASSIGN
N$DCT$
       556**DCL       897>>ASSIGN
N$DCT$$
       422**DCL       556--IMP-PTR   897>>ASSIGN
N$FQ$
       422**DCL       557--IMP-PTR
N$REQ_INIT.BUFADDR
       441**DCL       442--REDEF     442--REDEF
N$REQ_INIT.DLA.DRELADDR
       433**DCL       433--REDEF
N$REQ_INIT.DVE.EOMCHAR
       470**DCL       471--REDEF
N$REQ_INIT.EAINFO
       464**DCL       464--REDEF
N$REQ_INIT.EAINFOX
PL6.E3A0      #004=NIO$SPINTCON File=NIO$QUE.:E05TSI                             WED 07/30/97 03:38 Page:205  
       464**DCL       465--REDEF
N$REQ_INIT.EVNTINFO
       465**DCL       465--REDEF
N$REQ_INIT.STATUS
       446**DCL       452--REDEF
NI$FQ$
       482**DCL       558--IMP-PTR
NI$IBUF$
       482**DCL       558--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       492**DCL       493--REDEF     493--REDEF
NI$IMXMBX_INIT.SIZE
       494**DCL       494--REDEF
NI$REQ_INIT.DCW
       516**DCL       519--REDEF
NI$REQ_INIT.DCW.TALLY
       517**DCL       517--REDEF
NI$REQ_INIT.IDCW.EXTA
       519**DCL       519--REDEF
NI$REQ_INIT.PCW
       521**DCL       525--REDEF
NI$REQ_INIT.SEEK
       526**DCL       527--REDEF     528--REDEF
NI$RP$
       530**DCL       560--IMP-PTR
NI_MBX_INIT.DCW.CONTROL.AE
       552**DCL       552--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       548**DCL       548--REDEF
N_DCTXMAX
       530**DCL       895>>IF
SC_NIOINVDLA
       837**DCL-ENT   896--CALL

PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:206  
     1024        1        /*M*  NIO$SPCOMP - SPECIAL INTERRUPT  COMPLETION ENTRY                       */
     1025        2        /*T***********************************************************/
     1026        3        /*T*                                                         */
     1027        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1028        5        /*T*                                                         */
     1029        6        /*T***********************************************************/
     1030        7        NIO$SPCOMP: PROC (DCT);
     1031        8        /*
     1032        9                Includes
     1033       10        */
     1034       11        %INCLUDE                NI_DATA_C ;
     1035      124        %INCLUDE                NI_DATA_R ;
     1036      561        %INCLUDE                NI_MACROS_C ;
     1037      828        %INCLUDE                UE_CP6 ;
     1038     1519        /*
     1039     1520                Parameters
     1040     1521        */
     1041     1522        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
     1042     1570        /*
     1043     1571                Entries
     1044     1572        */
     1045     1573    1   DCL 1 SSV$EVENT         ENTRY(7) ;
     1046     1574        /*
     1047     1575                Auto
     1048     1576        */
     1049     1577    1   DCL 1 EXTRN             EPTR ALIGNED AUTO ;
     1050     1578    1   DCL 1 EVBLK             ALIGNED AUTO,
     1051     1579    1         2 SIZE            UBIN,
     1052     1580    1         2 FLPW            UBIN,
     1053     1581    1         2 STATUS          BIT(72),
     1054     1582    1         2 LPWX,
     1055     1583    1           3 BASE          UBIN(18) UNAL,
     1056     1584    1           3 SIZE          UBIN(18) UNAL;
     1057     1585        /*
     1058     1586                Based
     1059     1587        */
     1060     1588        %B$EVNT;
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:207  
     1061     1601        %EJECT;
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:208  
     1062     1602        /**/
     1063     1603    2           DO  INHIBIT ;
     1064     1604    2              IF  DCT.TDUSER# > 0
     1065     1605    2                AND DCT.STATUS.TND ~= 0
     1066     1606    3              THEN DO ;
     1067     1607    3                 IF  DCT.SPEVENT > 0
     1068     1608    4                 THEN DO ;
     1069     1609    4                    EVBLK.SIZE   = SIZEW(EVBLK) - 1 ;
     1070     1610    4                    EVBLK.STATUS = DCT.SPSTAT;
     1071     1611    4                    CALL SSV$EVENT ( DCT.TDUSER#, 7, %EVSC_IO#, DCT.SPEVENT, 0, ADDR(
              1611                             EVBLK) ) ;
     1072     1612    4                    END ;
     1073     1613    3                 END ;
     1074     1614    2              ELSE IF  DCT.STATE = %IDLE
     1075     1615    3                 THEN DO ;
     1076     1616    3                    EXTRN = DCT.SPEC ;
     1077     1617    3                    IF EXTRN ~= ENTADDR(NIL)
     1078     1618    3                      AND NOT DCT.STATUS.DOWN
     1079     1619    3                    THEN
     1080     1620    3                       CALL EXTRN ( DCT.DCTX, DCT.SPSTAT, DCT.SPECINFO ) ;
     1081     1621    3                    END ;
     1082     1622    2              RETURN ;
     1083     1623    2              END ;
     1084     1624        /**/
     1085     1625        /**/
     1086     1626    1   END NIO$SPCOMP;
     1087     1627        %EOD;

PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:209  
--  Include file information  --

   UE_CP6.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
      No diagnostics issued in procedure NIO$SPCOMP.

   Procedure NIO$SPCOMP requires 60 words for executable code.
   Procedure NIO$SPCOMP requires 18 words of local(AUTO) storage.

PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:210  

 Object Unit name= NIO$SPCOMP                                 File name= NIO$QUE.:E05TOU
 UTS= JUL 30 '97 03:38:42.48 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    60     74  NIO$SPCOMP
    1  RoData even  none     4      4  NIO$SPCOMP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  NIO$SPCOMP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       7 SSV$EVENT
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                              NI$RP$                                B_VECTNIL
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:211  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:212  


     1024        1        /*M*  NIO$SPCOMP - SPECIAL INTERRUPT  COMPLETION ENTRY                       */
     1025        2        /*T***********************************************************/
     1026        3        /*T*                                                         */
     1027        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1028        5        /*T*                                                         */
     1029        6        /*T***********************************************************/
     1030        7        NIO$SPCOMP: PROC (DCT);

      7  0 000000   000000 700200 xent  NIO$SPCOMP   TSX0  ! X66_AUTO_1
         0 000001   000022 000001                    ZERO    18,1

     1031        8        /*
     1032        9                Includes
     1033       10        */
     1034       11        %INCLUDE                NI_DATA_C ;
     1035      124        %INCLUDE                NI_DATA_R ;
     1036      561        %INCLUDE                NI_MACROS_C ;
     1037      828        %INCLUDE                UE_CP6 ;
     1038     1519        /*
     1039     1520                Parameters
     1040     1521        */
     1041     1522        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
     1042     1570        /*
     1043     1571                Entries
     1044     1572        */
     1045     1573    1   DCL 1 SSV$EVENT         ENTRY(7) ;
     1046     1574        /*
     1047     1575                Auto
     1048     1576        */
     1049     1577    1   DCL 1 EXTRN             EPTR ALIGNED AUTO ;
     1050     1578    1   DCL 1 EVBLK             ALIGNED AUTO,
     1051     1579    1         2 SIZE            UBIN,
     1052     1580    1         2 FLPW            UBIN,
     1053     1581    1         2 STATUS          BIT(72),
     1054     1582    1         2 LPWX,
     1055     1583    1           3 BASE          UBIN(18) UNAL,
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:213  
     1056     1584    1           3 SIZE          UBIN(18) UNAL;
     1057     1585        /*
     1058     1586                Based
     1059     1587        */
     1060     1588        %B$EVNT;
     1061     1601        %EJECT;
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:214  
     1062     1602        /**/
     1063     1603    2           DO  INHIBIT ;

     1064     1604    2              IF  DCT.TDUSER# > 0

   1604  0 000002   200003 470700                    LDP0  ! @DCT,,AUTO
         0 000003   000027 236300                    LDQ   ! 23,,PR0
         0 000004   000777 316203                    CANQ  ! 511,DU
         0 000005   000043 600200 0                  TZE   ! s:1614
         0 000006   170000 316203                    CANQ  ! 61440,DU
         0 000007   000043 600200 0                  TZE   ! s:1614

     1065     1605    2                AND DCT.STATUS.TND ~= 0
     1066     1606    3              THEN DO ;

     1067     1607    3                 IF  DCT.SPEVENT > 0

   1607  0 000010   000025 235300                    LDA   ! 21,,PR0
         0 000011   000072 600200 0                  TZE   ! s:1622

     1068     1608    4                 THEN DO ;

     1069     1609    4                    EVBLK.SIZE   = SIZEW(EVBLK) - 1 ;

   1609  0 000012   000004 235207                    LDA   ! 4,DL
         0 000013   200005 755300                    STA   ! EVBLK,,AUTO

     1070     1610    4                    EVBLK.STATUS = DCT.SPSTAT;

   1610  0 000014   000100 100700                    MLR   ! fill='000'O
         0 000015   000017 000004                    ADSC9   15,,PR0                  cn=0,n=4
         0 000016   200007 000010                    ADSC9   EVBLK+2,,AUTO            cn=0,n=8

     1071     1611    4                    CALL SSV$EVENT ( DCT.TDUSER#, 7, %EVSC_IO#, DCT.SPEVENT, 0, ADDR(
              1611                             EVBLK) ) ;

   1611  0 000017   200005 631700                    EPPR1 ! EVBLK,,AUTO
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:215  
         0 000020   200012 451700                    STP1  ! EVBLK+5,,AUTO
         0 000021   200012 633700                    EPPR3 ! EVBLK+5,,AUTO
         0 000022   200021 453700                    STP3  ! EVBLK+12,,AUTO
         0 000023   000000 236200 1                  LDQ   ! 0
         0 000024   200020 756300                    STQ   ! EVBLK+11,,AUTO
         0 000025   200003 236300                    LDQ   ! @DCT,,AUTO
         0 000026   000025 036203                    ADLQ  ! 21,DU
         0 000027   000001 235200 1                  LDA   ! 1
         0 000030   200016 757300                    STAQ  ! EVBLK+9,,AUTO
         0 000031   000002 236200 1                  LDQ   ! 2
         0 000032   200015 756300                    STQ   ! EVBLK+8,,AUTO
         0 000033   200003 236300                    LDQ   ! @DCT,,AUTO
         0 000034   000003 036200 1                  ADLQ  ! 3
         0 000035   200014 756300                    STQ   ! EVBLK+7,,AUTO
         0 000036   200014 630700                    EPPR0 ! EVBLK+7,,AUTO
         0 000037   000024 631600 xsym               EPPR1 ! B_VECTNIL+20
         0 000040   000000 701200 xent               TSX1  ! SSV$EVENT
         0 000041   000000 011200                    NOP   ! 0

     1072     1612    4                    END ;

     1073     1613    3                 END ;

   1613  0 000042   000072 710200 0                  TRA   ! s:1622

     1074     1614    2              ELSE IF  DCT.STATE = %IDLE

   1614  0 000043   000007 236300                    LDQ   ! 7,,PR0
         0 000044   000077 316207                    CANQ  ! 63,DL
         0 000045   000072 601200 0                  TNZ   ! s:1622

     1075     1615    3                 THEN DO ;

     1076     1616    3                    EXTRN = DCT.SPEC ;

   1616  0 000046   000020 236300                    LDQ   ! 16,,PR0
         0 000047   200004 756300                    STQ   ! EXTRN,,AUTO
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:216  

     1077     1617    3                    IF EXTRN ~= ENTADDR(NIL)

   1617  0 000050   000002 116200 xsym               CMPQ  ! B_VECTNIL+2
         0 000051   000072 600200 0                  TZE   ! s:1622
         0 000052   000027 234300                    SZN   ! 23,,PR0
         0 000053   000072 604200 0                  TMI   ! s:1622

     1078     1618    3                      AND NOT DCT.STATUS.DOWN
     1079     1619    3                    THEN
     1080     1620    3                       CALL EXTRN ( DCT.DCTX, DCT.SPSTAT, DCT.SPECINFO ) ;

   1620  0 000054   200003 236300                    LDQ   ! @DCT,,AUTO
         0 000055   000021 036203                    ADLQ  ! 17,DU
         0 000056   200014 756300                    STQ   ! EVBLK+7,,AUTO
         0 000057   200003 236300                    LDQ   ! @DCT,,AUTO
         0 000060   000017 036203                    ADLQ  ! 15,DU
         0 000061   200013 756300                    STQ   ! EVBLK+6,,AUTO
         0 000062   200003 236300                    LDQ   ! @DCT,,AUTO
         0 000063   000006 036203                    ADLQ  ! 6,DU
         0 000064   200012 756300                    STQ   ! EVBLK+5,,AUTO
         0 000065   200012 630700                    EPPR0 ! EVBLK+5,,AUTO
         0 000066   200004 220300                    LDX0  ! EXTRN,,AUTO
         0 000067   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         0 000070   000000 701210                    TSX1  ! 0,X0
         0 000071   000000 011200                    NOP   ! 0

     1081     1621    3                    END ;

     1082     1622    2              RETURN ;

   1622  0 000072   000000 702200 xent               TSX2  ! X66_ARET

     1083     1623    2              END ;

     1084     1624        /**/
     1085     1625        /**/
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:217  
     1086     1626    1   END NIO$SPCOMP;

   1626  0 000073   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000002 006000   000003 006000   000011 006000   000027 200000    ................
     1087     1627        %EOD;

PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:218  
--  Include file information  --

   UE_CP6.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
      No diagnostics issued in procedure NIO$SPCOMP.
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:219  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DCT                      *0-0-0/w STRC(1332)  r     1 DCT
     5-0-0/w STRC(180)   r     1 EVBLK                      4-0-0/w EPTR        r     1 EXTRN

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$


   Procedure NIO$SPCOMP requires 60 words for executable code.
   Procedure NIO$SPCOMP requires 18 words of local(AUTO) storage.
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:220  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:221  
          MINI XREF LISTING

B$EVNT.CODE
      1590**DCL      1590--REDEF    1591--REDEF    1591--REDEF
B$EVNT.ERR.ERR#
      1592**DCL      1592--REDEF
B$EVNT.EVID
      1591**DCL      1591--REDEF    1591--REDEF
DCT
      1531**DCL         7--PROC
DCT.DCTX
      1532**DCL      1620<>CALL
DCT.DP
      1551**DCL      1558--REDEF    1561--REDEF    1562--REDEF    1564--REDEF    1564--REDEF    1565--REDEF
      1566--REDEF    1566--REDEF
DCT.MPC.IOCHANX
      1559**DCL      1559--REDEF
DCT.SPEC
      1546**DCL      1616>>ASSIGN
DCT.SPECINFO
      1546**DCL      1620<>CALL
DCT.SPEVENT
      1547**DCL      1607>>IF       1611<>CALL
DCT.SPSTAT
      1543**DCL      1610>>ASSIGN   1620<>CALL
DCT.STATE
      1541**DCL      1614>>IF
DCT.STATUS.DOWN
      1548**DCL      1617>>IF
DCT.STATUS.TND
      1549**DCL      1604>>IF
DCT.TDUSER#
      1550**DCL      1604>>IF       1611<>CALL
EVBLK
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:222  
      1578**DCL      1609--ASSIGN   1611--CALL
EVBLK.SIZE
      1579**DCL      1609<<ASSIGN
EVBLK.STATUS
      1581**DCL      1610<<ASSIGN
EXTRN
      1577**DCL      1616<<ASSIGN   1617>>IF       1620>>CALL
N$DCT$$
       422**DCL       556--IMP-PTR
N$FQ$
       422**DCL       557--IMP-PTR
N$REQ_INIT.BUFADDR
       441**DCL       442--REDEF     442--REDEF
N$REQ_INIT.DLA.DRELADDR
       433**DCL       433--REDEF
N$REQ_INIT.DVE.EOMCHAR
       470**DCL       471--REDEF
N$REQ_INIT.EAINFO
       464**DCL       464--REDEF
N$REQ_INIT.EAINFOX
       464**DCL       465--REDEF
N$REQ_INIT.EVNTINFO
       465**DCL       465--REDEF
N$REQ_INIT.STATUS
       446**DCL       452--REDEF
NI$FQ$
       482**DCL       558--IMP-PTR
NI$IBUF$
       482**DCL       558--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       492**DCL       493--REDEF     493--REDEF
NI$IMXMBX_INIT.SIZE
       494**DCL       494--REDEF
NI$REQ_INIT.DCW
       516**DCL       519--REDEF
NI$REQ_INIT.DCW.TALLY
PL6.E3A0      #005=NIO$SPCOMP File=NIO$QUE.:E05TSI                               WED 07/30/97 03:38 Page:223  
       517**DCL       517--REDEF
NI$REQ_INIT.IDCW.EXTA
       519**DCL       519--REDEF
NI$REQ_INIT.PCW
       521**DCL       525--REDEF
NI$REQ_INIT.SEEK
       526**DCL       527--REDEF     528--REDEF
NI$RP$
       530**DCL       560--IMP-PTR
NI_MBX_INIT.DCW.CONTROL.AE
       552**DCL       552--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       548**DCL       548--REDEF
SSV$EVENT
      1573**DCL-ENT  1611--CALL

PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:224  
     1088        1        /*T***********************************************************/
     1089        2        /*T*                                                         */
     1090        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1091        4        /*T*                                                         */
     1092        5        /*T***********************************************************/
     1093        6        NIO$IOSPIN: PROC(N$REQ);
     1094        7        %INCLUDE N$REQ;
     1095       81        %INCLUDE                XUD_UTS_M ;
     1096      163        %N$REQ (NAME=N$REQ,STCLASS="");
     1097      221        /**/
     1098      222    1   DCL NII$LIP ENTRY(1);
     1099      223    1   DCL SSS$SYSTIME ENTRY(1);
     1100      224    1   DCL NIO$COMPQUE ENTRY;
     1101      225        %XUD$UTS_ENTRIES ;
     1102      257        /**/
     1103      258    1   DCL NI_COMPHD$ PTR SYMREF;
     1104      259        /**/
     1105      260    1   DCL CURUTS UBIN;
     1106      261    1   DCL NXTUTS UBIN;
     1107      262        /**/
     1108      263        %XUD_UTS_EQU ;
     1109      274        %EJECT;
PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:225  
     1110      275    1           CALL SSS$SYSTIME(CURUTS);
     1111      276    1           CALL XUD$UTS_ADJUST(NXTUTS,CURUTS,5*%UTS_CSEC_SEC#); /* WAIT 5 SECONDS */
     1112      277    2           DO WHILE(NOT N$REQ.TYC.EGV);
     1113      278    2              CALL SSS$SYSTIME(CURUTS);
     1114      279    3              IF CURUTS>NXTUTS THEN DO;
     1115      280    3                 CALL NII$LIP(1);
     1116      281    3                 CALL XUD$UTS_ADJUST(NXTUTS,CURUTS,5*%UTS_CSEC_SEC#);
     1117      282    3                 END;
     1118      283    2              IF NI_COMPHD$~=ADDR(NIL) THEN CALL NIO$COMPQUE;
     1119      284    2              END;
     1120      285    1           RETURN;
     1121      286    1   END NIO$IOSPIN;

PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:226  
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
      No diagnostics issued in procedure NIO$IOSPIN.

   Procedure NIO$IOSPIN requires 52 words for executable code.
   Procedure NIO$IOSPIN requires 10 words of local(AUTO) storage.

    No errors detected in file NIO$QUE.:E05TSI    .

PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:227  

 Object Unit name= NIO$IOSPIN                                 File name= NIO$QUE.:E05TOU
 UTS= JUL 30 '97 03:39:05.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    52     64  NIO$IOSPIN
    1  RoData even  none     3      3  NIO$IOSPIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  NIO$IOSPIN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 SSS$SYSTIME
 yes     yes           Std       3 XUD$UTS_ADJUST
         yes           Std       1 NII$LIP
         yes           Std       0 NIO$COMPQUE
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NI_COMPHD$                            B_VECTNIL
PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:228  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:229  


     1088        1        /*T***********************************************************/
     1089        2        /*T*                                                         */
     1090        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1091        4        /*T*                                                         */
     1092        5        /*T***********************************************************/
     1093        6        NIO$IOSPIN: PROC(N$REQ);

      6  0 000000   000000 700200 xent  NIO$IOSPIN   TSX0  ! X66_AUTO_1
         0 000001   000012 000001                    ZERO    10,1

     1094        7        %INCLUDE N$REQ;
     1095       81        %INCLUDE                XUD_UTS_M ;
     1096      163        %N$REQ (NAME=N$REQ,STCLASS="");
     1097      221        /**/
     1098      222    1   DCL NII$LIP ENTRY(1);
     1099      223    1   DCL SSS$SYSTIME ENTRY(1);
     1100      224    1   DCL NIO$COMPQUE ENTRY;
     1101      225        %XUD$UTS_ENTRIES ;
     1102      257        /**/
     1103      258    1   DCL NI_COMPHD$ PTR SYMREF;
     1104      259        /**/
     1105      260    1   DCL CURUTS UBIN;
     1106      261    1   DCL NXTUTS UBIN;
     1107      262        /**/
     1108      263        %XUD_UTS_EQU ;
     1109      274        %EJECT;
PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:230  
     1110      275    1           CALL SSS$SYSTIME(CURUTS);

    275  0 000002   200004 630500                    EPPR0   CURUTS,,AUTO
         0 000003   200006 450500                    STP0    NXTUTS+1,,AUTO
         0 000004   200006 630500                    EPPR0   NXTUTS+1,,AUTO
         0 000005   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000006   000000 701000 xent               TSX1    SSS$SYSTIME
         0 000007   000000 011000                    NOP     0

     1111      276    1           CALL XUD$UTS_ADJUST(NXTUTS,CURUTS,5*%UTS_CSEC_SEC#); /* WAIT 5 SECONDS */

    276  0 000010   000001 236000 1                  LDQ     1
         0 000011   200010 756100                    STQ     NXTUTS+3,,AUTO
         0 000012   200004 630500                    EPPR0   CURUTS,,AUTO
         0 000013   200007 450500                    STP0    NXTUTS+2,,AUTO
         0 000014   200005 631500                    EPPR1   NXTUTS,,AUTO
         0 000015   200006 451500                    STP1    NXTUTS+1,,AUTO
         0 000016   200006 630500                    EPPR0   NXTUTS+1,,AUTO
         0 000017   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000020   000000 701000 xent               TSX1    XUD$UTS_ADJUST
         0 000021   000000 011000                    NOP     0

     1112      277    2           DO WHILE(NOT N$REQ.TYC.EGV);

    277  0 000022   000060 710000 0                  TRA     s:284

     1113      278    2              CALL SSS$SYSTIME(CURUTS);

    278  0 000023   200004 630500                    EPPR0   CURUTS,,AUTO
         0 000024   200006 450500                    STP0    NXTUTS+1,,AUTO
         0 000025   200006 630500                    EPPR0   NXTUTS+1,,AUTO
         0 000026   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000027   000000 701000 xent               TSX1    SSS$SYSTIME
         0 000030   000000 011000                    NOP     0

     1114      279    3              IF CURUTS>NXTUTS THEN DO;

PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:231  
    279  0 000031   200005 236100                    LDQ     NXTUTS,,AUTO
         0 000032   200004 116100                    CMPQ    CURUTS,,AUTO
         0 000033   000052 603000 0                  TRC     s:283

     1115      280    3                 CALL NII$LIP(1);

    280  0 000034   000002 630400 1                  EPPR0   2
         0 000035   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000036   000000 701000 xent               TSX1    NII$LIP
         0 000037   000000 011000                    NOP     0

     1116      281    3                 CALL XUD$UTS_ADJUST(NXTUTS,CURUTS,5*%UTS_CSEC_SEC#);

    281  0 000040   000001 236000 1                  LDQ     1
         0 000041   200010 756100                    STQ     NXTUTS+3,,AUTO
         0 000042   200004 630500                    EPPR0   CURUTS,,AUTO
         0 000043   200007 450500                    STP0    NXTUTS+2,,AUTO
         0 000044   200005 631500                    EPPR1   NXTUTS,,AUTO
         0 000045   200006 451500                    STP1    NXTUTS+1,,AUTO
         0 000046   200006 630500                    EPPR0   NXTUTS+1,,AUTO
         0 000047   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000050   000000 701000 xent               TSX1    XUD$UTS_ADJUST
         0 000051   000000 011000                    NOP     0

     1117      282    3                 END;

     1118      283    2              IF NI_COMPHD$~=ADDR(NIL) THEN CALL NIO$COMPQUE;

    283  0 000052   000000 236000 xsym               LDQ     NI_COMPHD$
         0 000053   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000054   000060 600000 0                  TZE     s:284

    283  0 000055   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000056   000000 701000 xent               TSX1    NIO$COMPQUE
         0 000057   000000 011000                    NOP     0

     1119      284    2              END;
PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:232  

    284  0 000060   200003 470500                    LDP0    @N$REQ,,AUTO
         0 000061   000021 234100                    SZN     17,,PR0
         0 000062   000023 605000 0                  TPL     s:278

     1120      285    1           RETURN;

    285  0 000063   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000000 000764   000000 006000   000003 006000                    ............
     1121      286    1   END NIO$IOSPIN;

PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:233  
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
      No diagnostics issued in procedure NIO$IOSPIN.
PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:234  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @N$REQ                     4-0-0/w UBIN        r     1 CURUTS
    *0-0-0/d STRC(1080)  r     1 N$REQ                      5-0-0/w UBIN        r     1 NXTUTS

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 NI_COMPHD$


   Procedure NIO$IOSPIN requires 52 words for executable code.
   Procedure NIO$IOSPIN requires 10 words of local(AUTO) storage.

    No errors detected in file NIO$QUE.:E05TSI    .
PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:235  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=NIO$IOSPIN File=NIO$QUE.:E05TSI                               WED 07/30/97 03:39 Page:236  
          MINI XREF LISTING

CURUTS
       260**DCL       275<>CALL      276<>CALL      278<>CALL      279>>IF        281<>CALL
N$REQ
       172**DCL         6--PROC
N$REQ.BUFADDR
       181**DCL       182--REDEF     182--REDEF
N$REQ.DLA.DRELADDR
       173**DCL       173--REDEF
N$REQ.DVE.EOMCHAR
       210**DCL       211--REDEF
N$REQ.EAINFO
       204**DCL       204--REDEF
N$REQ.EAINFOX
       204**DCL       205--REDEF
N$REQ.EVNTINFO
       205**DCL       205--REDEF
N$REQ.STATUS
       186**DCL       192--REDEF
N$REQ.TYC.EGV
       194**DCL       277>>DOWHILE
NII$LIP
       222**DCL-ENT   280--CALL
NIO$COMPQUE
       224**DCL-ENT   283--CALL
NI_COMPHD$
       258**DCL       283>>IF
NXTUTS
       261**DCL       276<>CALL      279>>IF        281<>CALL
SSS$SYSTIME
       223**DCL-ENT   275--CALL      278--CALL
XUD$UTS_ADJUST
       244**DCL-ENT   276--CALL      281--CALL
