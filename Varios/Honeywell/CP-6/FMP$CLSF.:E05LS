VERSION E05

PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:1    
        1        1        /*M*      FMP$CLSF      CLOSE DCB ROUTINE                 */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NSO,MCL=0,MOC,MEC,CLM=12,EXM=12,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9                    /*P*  NAME:   FMP$CLS
       10       10                    *
       11       11                    *     PURPOSE:  TO RECEIVE THE CLOSE FPT FROM THE PMME PROCESSOR,
       12       12                    *               SET UP THE POINTERS, AND CALL THE SPECIFIC CLOSE
       13       13                    *               ROUTINE BASED ON THE DCB ASSIGNMENT TYPE.
       14       14                    */
       15       15                    /*D*
       16       16                    *     NAME:   FMP$CLS
       17       17                    *
       18       18                    *     CALL:   CALL FMP$CLS;
       19       19                    *
       20       20                    *     INPUT:  PARAMETER STACK CONTAINS POINTERS TO FPT AREAS.
       21       21                    *
       22       22                    *                       $PS0 -> VARIABLE AREA
       23       23                    *
       24       24                    *             PARAMETERS 1 AND 2 ARE FOR TAPE FILES ONLY.
       25       25                    *
       26       26                    *                       $PS1 -> SERIAL NO. LIST AREA
       27       27                    *                       $PS2 -> USER TRAILER LABEL BUFFER
       28       28                    *
       29       29                    *             Other parameters are for FIT modification and RENAME of
       30       30                    *             FILE DCBs only. They correspond in position to the same
       31       31                    *             parameters of FMM$OPN.
       32       32                    *
       33       33                    *             B$JIT.DCB$ -> CURRENT DCB
       34       34                    *
       35       35                    *     OUTPUT: A CLOSED DCB.
       36       36                    *
       37       37                    *     DESCRIPTION:  FMP$CLS IS CALLED BY THE PMME PROCESSOR TO
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:2    
       38       38                    *             PROCESS AN M$CLOSE PMME.  PARAMETERS ARE PASSED IN
       39       39                    *             THE PARAMETER STACK WITH THE EXCEPTION OF THE DCB
       40       40                    *             POINTER WHICH IS PLACED IN THE JIT PRIOR TO THE CALL
       41       41                    *             TO FMP$CLS.  THE ROUTINE MAKES SURE THAT THE DCB
       42       42                    *             IS OPEN AND THEN FANS OUT TO THE PROPER CLOSE
       43       43                    *             ROUTINE BASED ON THE DCB ASSIGNMENT TYPE.
       44       44                    *
       45       45                    *
       46       46                    */
       47       47        FMP$CLS: PROC;
       48       48        %INCLUDE F$JIT_C;
       49      478        %INCLUDE F$DCB;
       50      527        %INCLUDE CP_6_SUBS;
       51     1067        %INCLUDE F_ERRORS_C;
       52     1307        %INCLUDE UD_ERRORS_C;
       53     1349        %INCLUDE F_CP6;
       54     2374        %FPT_CLOSE(FPTN=CLSSAVE,STCLASS=CONSTANT,DISP=SAVE,PFMT=PTR,VECTOR=ADDR);
       55     2416        %INCLUDE F_MACROS_C;
       56     2427        %SUB FCG#='0615'O;
       57     2428        %SUB MID#='20'O;
       58     2429        %ERRCODE(NAME=FMP$E$INVASN,COD#=%E$INVASN);
       59     2433        %ERRCODE(NAME=FMP$E$DCBCLOSED,COD#=%E$DCBCLOSED,SEV#=0);
       60     2437        %ERRCODE(NAME=FMP$E$DOMAIN,COD#=%E$DOMAIN);
       61     2441                    /* AUTOMATIC DATA */
       62     2442    1   DCL JDCB$ PTR; /* POINTER TO THE DCB */
       63     2443        %SUB TOPX="SIZEW(CLOSEP)-1";
       64     2444        %INCLUDE F$CP6P_C;
       65     2455        %FPT$CLOSE_P(FPTN=CLOSEP,STCLASS=,PFMT=PTR);
       66     2459    1   DCL FPT$(0:0) BASED PTR;
       67     2460        %SUB FPT$="ADDR(CLOSEP)->FPT$";
       68     2461    1   DCL I SBIN; /* TEMPORARY INDEX */
       69     2462                    /* DEFINE EXTERNAL ROUTINES */
       70     2463    1   DCL HFF$NILERASE ENTRY(1) ALTRET; /* QUERY PARAMETER PRESENCE */
       71     2464    1   DCL HFF$TRAPALT ENTRY ALTRET;
       72     2465    1   DCL FMO$GETDOMAIN ENTRY(1);
       73     2466    1   DCL FMP$CLSF ENTRY(1); /* CLOSE FILE ROUTINE */
       74     2467    1   DCL FTC$CLOSE ENTRY(1);
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:3    
       75     2468    1   DCL FPC$CLSOD ENTRY(1); /* Close OD file routine */
       76     2469    1   DCL FSP$CLSDEV ENTRY(1) ALTRET; /* CLOSE DEVICE ROUTINE */
       77     2470    1   DCL KCO$CLCG ENTRY(1); /* Close comgroup */
       78     2471    1   DCL TDP$CLOSE ENTRY; /* CLOSE T&D DCB */
       79     2472    1   DCL NAO$CLS ENTRY;
       80     2473                    /* SYMREF DATA */
       81     2474    1   DCL B$JIT$ PTR SYMREF; /* POINTER TO THE JIT */
       82     2475    1   DCL B$M$STAR$ PTR SYMREF READONLY;
       83     2476    1   DCL B$M$DO$ PTR SYMREF READONLY;
       84     2477    1   DCL B$PS$(0:0)PTR SYMREF;
       85     2478        %EJECT;
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:4    
       86     2479    1      CALL HFF$TRAPALT ALTRET(DFLCLS);
       87     2480    2      DO I=0 TO TOPX;
       88     2481    2         FPT$(I)=ADDR(NIL);
       89     2482    2         CALL HFF$NILERASE(I) ALTRET(NOTNIL);
       90     2483    2         FPT$(I)=B$PS$(I);
       91     2484    2   NOTNIL:;
       92     2485    2         END;
       93     2486    1      GOTO CLSCOMMON;
       94     2487                    /*F*     NAME:   FMP$CLSJ
       95     2488                   DESCRIPTION: Closes the DCB pointed to by B$JIT.DCB$ as if M$CLOSEed with
       96     2489                    no fpt. */
       97     2490    1   DFLCLS:;
       98     2491    1   FMP$CLSJ: ENTRY;
       99     2492    2      DO I=0 TO TOPX;
      100     2493    2         FPT$(I)=ADDR(NIL);
      101     2494    2         END;
      102     2495    1      IF B$JIT.DCB$=B$M$DO$ THEN FPT$(0)=CLSSAVE.V_;
      103     2496    1      B$JIT.DCB$->F$DCB.FFLG.EXEC='0'B;
      104     2497    1   CLSCOMMON:
      105     2498    1      JDCB$=B$JIT$->B$JIT.DCB$;
      106     2499    1      IF NOT JDCB$->F$DCB.FCD THEN GOTO FMPE$DCBCLOSED;
      107     2500    2      IF JDCB$->F$DCB.FFLG.EXEC THEN DO;
      108     2501    2         CALL FMO$GETDOMAIN(I);
      109     2502    2         IF I>1 AND I~=JDCB$->F$DCB.WSR THEN GOTO FMPE$DOMAIN;
      110     2503    2         END;
      111     2504    2      DO CASE(JDCB$->F$DCB.ASN);
      112     2505    2      CASE(%FILE#);
      113     2506    2         IF JDCB$->F$DCB.IASN = %OD# THEN
      114     2507    2            CALL FPC$CLSOD (FPT$);
      115     2508    2         ELSE
      116     2509    2            CALL FMP$CLSF (FPT$);
      117     2510    2      CASE(%TAPE#);
      118     2511    2         CALL FTC$CLOSE(FPT$);
      119     2512    2      CASE(%DEVICE#);
      120     2513    2         CALL FSP$CLSDEV(FPT$)ALTRET(UCNOCLOSE);
      121     2514    2      CASE(%COMGROUP#);
      122     2515    2         IF B$JIT$ -> B$JIT.MODE = %M_INT# AND JDCB$ = B$M$STAR$
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:5    
      123     2516    3         THEN DO;
      124     2517    3            CALL FMO$GETDOMAIN(I);
      125     2518    3            IF I > 1
      126     2519    3            THEN GOTO UCNOCLOSE;
      127     2520    3            END;
      128     2521    2         CALL KCO$CLCG(FPT$);
      129     2522    2      CASE(%T@D#);
      130     2523    2         CALL TDP$CLOSE;
      131     2524    2      CASE(%FPAP#);
      132     2525    2         CALL NAO$CLS;
      133     2526    2      CASE(ELSE);
      134     2527    2         GOTO FMPE$INVASN;
      135     2528    2      END;
      136     2529                    /*
      137     2530                    *  SET THE DCB CLOSED
      138     2531                    */
      139     2532    1      JDCB$->F$DCB.FCD='0'B;
      140     2533    1      JDCB$->F$DCB.FCI='1'B;
      141     2534    1   UCNOCLOSE:
      142     2535    1      RETURN;
      143     2536                    /*
      144     2537                    *  CLOSE ERRORS ARE PROCESSED HERE
      145     2538                    */
      146     2539                    /*E*     ERROR:   FMP-E$DOMAIN-E
      147     2540                    *        MESSAGE: DCB% %DC% cannot be closed from your domain.
      148     2541                    */
      149     2542    1   FMPE$DOMAIN:B$JIT.ERR=FMP$E$DOMAIN;
      150     2543    1      RETURN;
      151     2544                    /*E*     ERROR:   FMP-E$DCBCLOSED-C
      152     2545                    *        MESSAGE: DCB% %DC% is already closed.
      153     2546                    */
      154     2547    1   FMPE$DCBCLOSED: B$JIT$->B$JIT.ERR=FMP$E$DCBCLOSED;
      155     2548    1      RETURN;
      156     2549                    /*E*     ERROR:   FMP-E$INVASN-E
      157     2550                    *        MESSAGE: DCB% %DC% was not opened by CP-6.
      158     2551                    */
      159     2552    1   FMPE$INVASN: B$JIT$->B$JIT.ERR=FMP$E$INVASN;
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:6    
      160     2553    1      JDCB$->F$DCB.FCD='0'B; /* FORCE DCB CLOSED */
      161     2554    1      RETURN;
      162     2555    1   END FMP$CLS;
      163     2556        %EOD;

PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:7    
--  Include file information  --

   F$CP6P_C.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMP$CLS.

   Procedure FMP$CLS requires 171 words for executable code.
   Procedure FMP$CLS requires 22 words of local(AUTO) storage.

PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:8    

 Object Unit name= FMP$CLS                                    File name= FMP$CLSF.:E05TOU
 UTS= JUL 29 '97 16:57:48.40 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     21     25  FMP$CLS
    1   Proc  even  none   171    253  FMP$CLS
    2  RoData even  none     2      2  FMP$CLS

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  FMP$CLS
     1     31                  yes      Std        0  FMP$CLSJ
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:9    

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 HFF$TRAPALT
 yes     yes           Std       1 HFF$NILERASE
         yes           Std       1 FMO$GETDOMAIN
         yes           Std       1 FPC$CLSOD
         yes           Std       1 FMP$CLSF
         yes           Std       1 FTC$CLOSE
         yes           Std       1 KCO$CLCG
         yes           Std       0 NAO$CLS
 yes     yes           Std       1 FSP$CLSDEV
         yes           Std       0 TDP$CLOSE
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                           r    B$M$STAR$                        r    B$M$DO$
     B$PS$                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:10   


        1        1        /*M*      FMP$CLSF      CLOSE DCB ROUTINE                 */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NSO,MCL=0,MOC,MEC,CLM=12,EXM=12,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9                    /*P*  NAME:   FMP$CLS
       10       10                    *
       11       11                    *     PURPOSE:  TO RECEIVE THE CLOSE FPT FROM THE PMME PROCESSOR,
       12       12                    *               SET UP THE POINTERS, AND CALL THE SPECIFIC CLOSE
       13       13                    *               ROUTINE BASED ON THE DCB ASSIGNMENT TYPE.
       14       14                    */
       15       15                    /*D*
       16       16                    *     NAME:   FMP$CLS
       17       17                    *
       18       18                    *     CALL:   CALL FMP$CLS;
       19       19                    *
       20       20                    *     INPUT:  PARAMETER STACK CONTAINS POINTERS TO FPT AREAS.
       21       21                    *
       22       22                    *                       $PS0 -> VARIABLE AREA
       23       23                    *
       24       24                    *             PARAMETERS 1 AND 2 ARE FOR TAPE FILES ONLY.
       25       25                    *
       26       26                    *                       $PS1 -> SERIAL NO. LIST AREA
       27       27                    *                       $PS2 -> USER TRAILER LABEL BUFFER
       28       28                    *
       29       29                    *             Other parameters are for FIT modification and RENAME of
       30       30                    *             FILE DCBs only. They correspond in position to the same
       31       31                    *             parameters of FMM$OPN.
       32       32                    *
       33       33                    *             B$JIT.DCB$ -> CURRENT DCB
       34       34                    *
       35       35                    *     OUTPUT: A CLOSED DCB.
       36       36                    *
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:11   
       37       37                    *     DESCRIPTION:  FMP$CLS IS CALLED BY THE PMME PROCESSOR TO
       38       38                    *             PROCESS AN M$CLOSE PMME.  PARAMETERS ARE PASSED IN
       39       39                    *             THE PARAMETER STACK WITH THE EXCEPTION OF THE DCB
       40       40                    *             POINTER WHICH IS PLACED IN THE JIT PRIOR TO THE CALL
       41       41                    *             TO FMP$CLS.  THE ROUTINE MAKES SURE THAT THE DCB
       42       42                    *             IS OPEN AND THEN FANS OUT TO THE PROPER CLOSE
       43       43                    *             ROUTINE BASED ON THE DCB ASSIGNMENT TYPE.
       44       44                    *
       45       45                    *
       46       46                    */
       47       47        FMP$CLS: PROC;

     47  1 000000   000000 700200 xent  FMP$CLS      TSX0  ! X66_AUTO_0
         1 000001   000026 000000                    ZERO    22,0

       48       48        %INCLUDE F$JIT_C;
       49      478        %INCLUDE F$DCB;
       50      527        %INCLUDE CP_6_SUBS;
       51     1067        %INCLUDE F_ERRORS_C;
       52     1307        %INCLUDE UD_ERRORS_C;
       53     1349        %INCLUDE F_CP6;
       54     2374        %FPT_CLOSE(FPTN=CLSSAVE,STCLASS=CONSTANT,DISP=SAVE,PFMT=PTR,VECTOR=ADDR);
       55     2416        %INCLUDE F_MACROS_C;
       56     2427        %SUB FCG#='0615'O;
       57     2428        %SUB MID#='20'O;
       58     2429        %ERRCODE(NAME=FMP$E$INVASN,COD#=%E$INVASN);
       59     2433        %ERRCODE(NAME=FMP$E$DCBCLOSED,COD#=%E$DCBCLOSED,SEV#=0);
       60     2437        %ERRCODE(NAME=FMP$E$DOMAIN,COD#=%E$DOMAIN);
       61     2441                    /* AUTOMATIC DATA */
       62     2442    1   DCL JDCB$ PTR; /* POINTER TO THE DCB */
       63     2443        %SUB TOPX="SIZEW(CLOSEP)-1";
       64     2444        %INCLUDE F$CP6P_C;
       65     2455        %FPT$CLOSE_P(FPTN=CLOSEP,STCLASS=,PFMT=PTR);
       66     2459    1   DCL FPT$(0:0) BASED PTR;
       67     2460        %SUB FPT$="ADDR(CLOSEP)->FPT$";
       68     2461    1   DCL I SBIN; /* TEMPORARY INDEX */
       69     2462                    /* DEFINE EXTERNAL ROUTINES */
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:12   
       70     2463    1   DCL HFF$NILERASE ENTRY(1) ALTRET; /* QUERY PARAMETER PRESENCE */
       71     2464    1   DCL HFF$TRAPALT ENTRY ALTRET;
       72     2465    1   DCL FMO$GETDOMAIN ENTRY(1);
       73     2466    1   DCL FMP$CLSF ENTRY(1); /* CLOSE FILE ROUTINE */
       74     2467    1   DCL FTC$CLOSE ENTRY(1);
       75     2468    1   DCL FPC$CLSOD ENTRY(1); /* Close OD file routine */
       76     2469    1   DCL FSP$CLSDEV ENTRY(1) ALTRET; /* CLOSE DEVICE ROUTINE */
       77     2470    1   DCL KCO$CLCG ENTRY(1); /* Close comgroup */
       78     2471    1   DCL TDP$CLOSE ENTRY; /* CLOSE T&D DCB */
       79     2472    1   DCL NAO$CLS ENTRY;
       80     2473                    /* SYMREF DATA */
       81     2474    1   DCL B$JIT$ PTR SYMREF; /* POINTER TO THE JIT */
       82     2475    1   DCL B$M$STAR$ PTR SYMREF READONLY;
       83     2476    1   DCL B$M$DO$ PTR SYMREF READONLY;
       84     2477    1   DCL B$PS$(0:0)PTR SYMREF;
       85     2478        %EJECT;
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:13   
       86     2479    1      CALL HFF$TRAPALT ALTRET(DFLCLS);

   2479  1 000002   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000003   000000 701000 xent               TSX1    HFF$TRAPALT
         1 000004   000030 702000 1                  TSX2    DFLCLS

       87     2480    2      DO I=0 TO TOPX;

   2480  1 000005   200022 450100                    STZ     I,,AUTO
         1 000006   000024 710000 1                  TRA     NOTNIL+1

       88     2481    2         FPT$(I)=ADDR(NIL);

   2481  1 000007   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000010   200022 720100                    LXL0    I,,AUTO
         1 000011   200004 756110                    STQ     CLOSEP,X0,AUTO

       89     2482    2         CALL HFF$NILERASE(I) ALTRET(NOTNIL);

   2482  1 000012   200022 630500                    EPPR0   I,,AUTO
         1 000013   200024 450500                    STP0    I+2,,AUTO
         1 000014   200024 630500                    EPPR0   I+2,,AUTO
         1 000015   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000016   000000 701000 xent               TSX1    HFF$NILERASE
         1 000017   000023 702000 1                  TSX2    NOTNIL

       90     2483    2         FPT$(I)=B$PS$(I);

   2483  1 000020   200022 720100                    LXL0    I,,AUTO
         1 000021   000000 236010 xsym               LDQ     B$PS$,X0
         1 000022   200004 756110                    STQ     CLOSEP,X0,AUTO

   2483  1 000023                       NOTNIL       null
       91     2484    2   NOTNIL:;
       92     2485    2         END;

   2485  1 000023   200022 054100                    AOS     I,,AUTO
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:14   
         1 000024   200022 235100                    LDA     I,,AUTO
         1 000025   000015 115007                    CMPA    13,DL
         1 000026   000007 604400 1                  TMOZ    s:2481

       93     2486    1      GOTO CLSCOMMON;

   2486  1 000027   000055 710000 1                  TRA     CLSCOMMON

   2481  1 000030   000033 710000 1     DFLCLS       TRA     s:2492

       94     2487                    /*F*     NAME:   FMP$CLSJ
       95     2488                  DESCRIPTION: Closes the DCB pointed to by B$JIT.DCB$ as if M$CLOSEed with
       96     2489                    no fpt. */
       97     2490    1   DFLCLS:;
       98     2491    1   FMP$CLSJ: ENTRY;

   2491  1 000031   000000 700200 xent  FMP$CLSJ     TSX0  ! X66_AUTO_0
         1 000032   000026 000000                    ZERO    22,0

       99     2492    2      DO I=0 TO TOPX;

   2492  1 000033   200022 450100                    STZ     I,,AUTO
         1 000034   000041 710000 1                  TRA     s:2494+1

      100     2493    2         FPT$(I)=ADDR(NIL);

   2493  1 000035   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000036   200022 720100                    LXL0    I,,AUTO
         1 000037   200004 756110                    STQ     CLOSEP,X0,AUTO

      101     2494    2         END;

   2494  1 000040   200022 054100                    AOS     I,,AUTO
         1 000041   200022 235100                    LDA     I,,AUTO
         1 000042   000015 115007                    CMPA    13,DL
         1 000043   000035 604400 1                  TMOZ    s:2493

PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:15   
      102     2495    1      IF B$JIT.DCB$=B$M$DO$ THEN FPT$(0)=CLSSAVE.V_;

   2495  1 000044   000000 470400 xsym               LDP0    B$JIT$
         1 000045   000232 236100                    LDQ     154,,PR0
         1 000046   000000 116000 xsym               CMPQ    B$M$DO$
         1 000047   000052 601000 1                  TNZ     s:2496

   2495  1 000050   000000 236000 0                  LDQ     CLSSAVE
         1 000051   200004 756100                    STQ     CLOSEP,,AUTO

      103     2496    1      B$JIT.DCB$->F$DCB.FFLG.EXEC='0'B;

   2496  1 000052   000232 471500                    LDP1    154,,PR0
         1 000053   000000 236000 2                  LDQ     0
         1 000054   100004 356100                    ANSQ    4,,PR1

      104     2497    1   CLSCOMMON:
      105     2498    1      JDCB$=B$JIT$->B$JIT.DCB$;

   2498  1 000055   000000 470400 xsym  CLSCOMMON    LDP0    B$JIT$
         1 000056   000232 236100                    LDQ     154,,PR0
         1 000057   200003 756100                    STQ     JDCB$,,AUTO

      106     2499    1      IF NOT JDCB$->F$DCB.FCD THEN GOTO FMPE$DCBCLOSED;

   2499  1 000060   200003 471500                    LDP1    JDCB$,,AUTO
         1 000061   100031 236100                    LDQ     25,,PR1
         1 000062   020000 316007                    CANQ    8192,DL
         1 000063   000242 600000 1                  TZE     FMPE$DCBCLOSED

      107     2500    2      IF JDCB$->F$DCB.FFLG.EXEC THEN DO;

   2500  1 000064   100004 236100                    LDQ     4,,PR1
         1 000065   002000 316003                    CANQ    1024,DU
         1 000066   000106 600000 1                  TZE     s:2504

      108     2501    2         CALL FMO$GETDOMAIN(I);
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:16   

   2501  1 000067   200022 633500                    EPPR3   I,,AUTO
         1 000070   200024 453500                    STP3    I+2,,AUTO
         1 000071   200024 630500                    EPPR0   I+2,,AUTO
         1 000072   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000073   000000 701000 xent               TSX1    FMO$GETDOMAIN
         1 000074   000000 011000                    NOP     0

      109     2502    2         IF I>1 AND I~=JDCB$->F$DCB.WSR THEN GOTO FMPE$DOMAIN;

   2502  1 000075   200022 235100                    LDA     I,,AUTO
         1 000076   000001 115007                    CMPA    1,DL
         1 000077   000106 604400 1                  TMOZ    s:2504
         1 000100   200003 470500                    LDP0    JDCB$,,AUTO
         1 000101   000040 236100                    LDQ     32,,PR0
         1 000102   000022 772000                    QRL     18
         1 000103   000777 376007                    ANQ     511,DL
         1 000104   200022 116100                    CMPQ    I,,AUTO
         1 000105   000236 601000 1                  TNZ     FMPE$DOMAIN

      110     2503    2         END;

      111     2504    2      DO CASE(JDCB$->F$DCB.ASN);

   2504  1 000106   200003 470500                    LDP0    JDCB$,,AUTO
         1 000107   000032 236100                    LDQ     26,,PR0
         1 000110   000011 772000                    QRL     9
         1 000111   000777 376007                    ANQ     511,DL
         1 000112   000012 116007                    CMPQ    10,DL
         1 000113   000115 602006 1                  TNC     s:2504+7,QL
         1 000114   000227 710000 1                  TRA     s:2527
         1 000115   000227 710000 1                  TRA     s:2527
         1 000116   000127 710000 1                  TRA     s:2506
         1 000117   000151 710000 1                  TRA     s:2511
         1 000120   000160 710000 1                  TRA     s:2513
         1 000121   000167 710000 1                  TRA     s:2515
         1 000122   000227 710000 1                  TRA     s:2527
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:17   
         1 000123   000217 710000 1                  TRA     s:2523
         1 000124   000227 710000 1                  TRA     s:2527
         1 000125   000227 710000 1                  TRA     s:2527
         1 000126   000223 710000 1                  TRA     s:2525

      112     2505    2      CASE(%FILE#);

      113     2506    2         IF JDCB$->F$DCB.IASN = %OD# THEN

   2506  1 000127   000103 236100                    LDQ     67,,PR0
         1 000130   000777 376007                    ANQ     511,DL
         1 000131   000012 116007                    CMPQ    10,DL
         1 000132   000142 601000 1                  TNZ     s:2509

      114     2507    2            CALL FPC$CLSOD (FPT$);

   2507  1 000133   200004 631500                    EPPR1   CLOSEP,,AUTO
         1 000134   200024 451500                    STP1    I+2,,AUTO
         1 000135   200024 630500                    EPPR0   I+2,,AUTO
         1 000136   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000137   000000 701000 xent               TSX1    FPC$CLSOD
         1 000140   000000 011000                    NOP     0
         1 000141   000230 710000 1                  TRA     s:2532

      115     2508    2         ELSE
      116     2509    2            CALL FMP$CLSF (FPT$);

   2509  1 000142   200004 631500                    EPPR1   CLOSEP,,AUTO
         1 000143   200024 451500                    STP1    I+2,,AUTO
         1 000144   200024 630500                    EPPR0   I+2,,AUTO
         1 000145   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000146   000000 701000 xent               TSX1    FMP$CLSF
         1 000147   000000 011000                    NOP     0
         1 000150   000230 710000 1                  TRA     s:2532

      117     2510    2      CASE(%TAPE#);

PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:18   
      118     2511    2         CALL FTC$CLOSE(FPT$);

   2511  1 000151   200004 631500                    EPPR1   CLOSEP,,AUTO
         1 000152   200024 451500                    STP1    I+2,,AUTO
         1 000153   200024 630500                    EPPR0   I+2,,AUTO
         1 000154   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000155   000000 701000 xent               TSX1    FTC$CLOSE
         1 000156   000000 011000                    NOP     0
         1 000157   000230 710000 1                  TRA     s:2532

      119     2512    2      CASE(%DEVICE#);

      120     2513    2         CALL FSP$CLSDEV(FPT$)ALTRET(UCNOCLOSE);

   2513  1 000160   200004 631500                    EPPR1   CLOSEP,,AUTO
         1 000161   200024 451500                    STP1    I+2,,AUTO
         1 000162   200024 630500                    EPPR0   I+2,,AUTO
         1 000163   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000164   000000 701000 xent               TSX1    FSP$CLSDEV
         1 000165   000235 702000 1                  TSX2    UCNOCLOSE
         1 000166   000230 710000 1                  TRA     s:2532

      121     2514    2      CASE(%COMGROUP#);

      122     2515    2         IF B$JIT$ -> B$JIT.MODE = %M_INT# AND JDCB$ = B$M$STAR$

   2515  1 000167   000000 471400 xsym               LDP1    B$JIT$
         1 000170   100000 236100                    LDQ     0,,PR1
         1 000171   740000 376003                    ANQ     -16384,DU
         1 000172   140000 116003                    CMPQ    49152,DU
         1 000173   000210 601000 1                  TNZ     s:2521
         1 000174   200003 236100                    LDQ     JDCB$,,AUTO
         1 000175   000000 116000 xsym               CMPQ    B$M$STAR$
         1 000176   000210 601000 1                  TNZ     s:2521

      123     2516    3         THEN DO;

PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:19   
      124     2517    3            CALL FMO$GETDOMAIN(I);

   2517  1 000177   200022 633500                    EPPR3   I,,AUTO
         1 000200   200024 453500                    STP3    I+2,,AUTO
         1 000201   200024 630500                    EPPR0   I+2,,AUTO
         1 000202   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000203   000000 701000 xent               TSX1    FMO$GETDOMAIN
         1 000204   000000 011000                    NOP     0

      125     2518    3            IF I > 1

   2518  1 000205   200022 235100                    LDA     I,,AUTO
         1 000206   000001 115007                    CMPA    1,DL
         1 000207   000235 605400 1                  TPNZ    UCNOCLOSE

      126     2519    3            THEN GOTO UCNOCLOSE;
      127     2520    3            END;

      128     2521    2         CALL KCO$CLCG(FPT$);

   2521  1 000210   200004 630500                    EPPR0   CLOSEP,,AUTO
         1 000211   200024 450500                    STP0    I+2,,AUTO
         1 000212   200024 630500                    EPPR0   I+2,,AUTO
         1 000213   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000214   000000 701000 xent               TSX1    KCO$CLCG
         1 000215   000000 011000                    NOP     0
         1 000216   000230 710000 1                  TRA     s:2532

      129     2522    2      CASE(%T@D#);

      130     2523    2         CALL TDP$CLOSE;

   2523  1 000217   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000220   000000 701000 xent               TSX1    TDP$CLOSE
         1 000221   000000 011000                    NOP     0
         1 000222   000230 710000 1                  TRA     s:2532

PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:20   
      131     2524    2      CASE(%FPAP#);

      132     2525    2         CALL NAO$CLS;

   2525  1 000223   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000224   000000 701000 xent               TSX1    NAO$CLS
         1 000225   000000 011000                    NOP     0
         1 000226   000230 710000 1                  TRA     s:2532

      133     2526    2      CASE(ELSE);

      134     2527    2         GOTO FMPE$INVASN;

   2527  1 000227   000245 710000 1                  TRA     FMPE$INVASN

      135     2528    2      END;

      136     2529                    /*
      137     2530                    *  SET THE DCB CLOSED
      138     2531                    */
      139     2532    1      JDCB$->F$DCB.FCD='0'B;

   2532  1 000230   200003 470500                    LDP0    JDCB$,,AUTO
         1 000231   000001 236000 2                  LDQ     1
         1 000232   000031 356100                    ANSQ    25,,PR0

      140     2533    1      JDCB$->F$DCB.FCI='1'B;

   2533  1 000233   040000 236007                    LDQ     16384,DL
         1 000234   000031 256100                    ORSQ    25,,PR0

      141     2534    1   UCNOCLOSE:
      142     2535    1      RETURN;

   2535  1 000235   000000 702200 xent  UCNOCLOSE    TSX2  ! X66_ARET

      143     2536                    /*
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:21   
      144     2537                    *  CLOSE ERRORS ARE PROCESSED HERE
      145     2538                    */
      146     2539                    /*E*     ERROR:   FMP-E$DOMAIN-E
      147     2540                    *        MESSAGE: DCB% %DC% cannot be closed from your domain.
      148     2541                    */
      149     2542    1   FMPE$DOMAIN:B$JIT.ERR=FMP$E$DOMAIN;

   2542  1 000236   000024 236000 0     FMPE$DOMAIN  LDQ     FMP$E$DOMAIN
         1 000237   000000 471400 xsym               LDP1    B$JIT$
         1 000240   100012 756100                    STQ     10,,PR1

      150     2543    1      RETURN;

   2543  1 000241   000000 702200 xent               TSX2  ! X66_ARET

      151     2544                    /*E*     ERROR:   FMP-E$DCBCLOSED-C
      152     2545                    *        MESSAGE: DCB% %DC% is already closed.
      153     2546                    */
      154     2547    1   FMPE$DCBCLOSED: B$JIT$->B$JIT.ERR=FMP$E$DCBCLOSED;

   2547  1 000242   000023 236000 0     FMPE$DCBCLO* LDQ     FMP$E$DCBCLOSED
         1 000243   000012 756100                    STQ     10,,PR0

      155     2548    1      RETURN;

   2548  1 000244   000000 702200 xent               TSX2  ! X66_ARET

      156     2549                    /*E*     ERROR:   FMP-E$INVASN-E
      157     2550                    *        MESSAGE: DCB% %DC% was not opened by CP-6.
      158     2551                    */
      159     2552    1   FMPE$INVASN: B$JIT$->B$JIT.ERR=FMP$E$INVASN;

   2552  1 000245   000022 236000 0     FMPE$INVASN  LDQ     FMP$E$INVASN
         1 000246   000000 471400 xsym               LDP1    B$JIT$
         1 000247   100012 756100                    STQ     10,,PR1

      160     2553    1      JDCB$->F$DCB.FCD='0'B; /* FORCE DCB CLOSED */
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:22   

   2553  1 000250   000001 236000 2                  LDQ     1
         1 000251   000031 356100                    ANSQ    25,,PR0

      161     2554    1      RETURN;

   2554  1 000252   000000 702200 xent               TSX2  ! X66_ARET

CLSSAVE
 Sect OctLoc
   0     000   000016 006000   000000 006014   000000 006014   000000 006014    ................
   0     004   000000 006014   000000 006014   000000 006014   000000 006014    ................
   0     014*  000000 006014   ****** ******   000000 000002   000000 000040    ...............
   0     020   000220 000000   000000 000000                                    ........

FMP$E$INVASN
 Sect OctLoc
   0     022   061520 001452                                                    1...

FMP$E$DCBCLOSED
 Sect OctLoc
   0     023   061520 002260                                                    1...

FMP$E$DOMAIN
 Sect OctLoc
   0     024   061520 006262                                                    1...

(unnamed)
 Sect OctLoc
   2     000   775777 777777   777777 757777                                    ........
      162     2555    1   END FMP$CLS;
      163     2556        %EOD;

PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:23   
--  Include file information  --

   F$CP6P_C.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMP$CLS.
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:24   

 **** Variables and constants ****

  ****  Section 000 RoData FMP$CLS

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(648)   r     1 CLSSAVE                   23-0-0/b STRC        r     1 FMP$E$DCBCLOSED
    24-0-0/b STRC        r     1 FMP$E$DOMAIN              22-0-0/b STRC        r     1 FMP$E$INVASN

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w STRC(504)   r     1 CLOSEP                    22-0-0/w SBIN        r     1 I
     3-0-0/w PTR         r     1 JDCB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$DO$
     0-0-0/w PTR         r     1 B$M$STAR$                  0-0-0/w PTR         r     1 B$PS$(0:0)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w PTR         r     1 FPT$(0:0)


   Procedure FMP$CLS requires 171 words for executable code.
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:25   
   Procedure FMP$CLS requires 22 words of local(AUTO) storage.
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:26   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:27   
          MINI XREF LISTING

B$JIT.DCB$
       465**DCL      2495>>IF       2496>>ASSIGN   2498>>ASSIGN
B$JIT.ERR
       375**DCL      2542<<ASSIGN   2547<<ASSIGN   2552<<ASSIGN
B$JIT.ERR.MID
       376**DCL       376--REDEF
B$JIT.MODE
       370**DCL      2515>>IF
B$JIT$
      2474**DCL       370--IMP-PTR  2495>>IF       2496>>ASSIGN   2498>>ASSIGN   2515>>IF       2542>>ASSIGN
      2547>>ASSIGN   2552>>ASSIGN
B$M$DO$
      2476**DCL      2495>>IF
B$M$STAR$
      2475**DCL      2515>>IF
B$PS$
      2477**DCL      2483>>ASSIGN
CLOSEP
      2456**DCL      2480--DOINDEX  2481--ASSIGN   2483--ASSIGN   2492--DOINDEX  2493--ASSIGN   2495--ASSIGN
      2507--CALL     2509--CALL     2511--CALL     2513--CALL     2521--CALL
CLOSEP.SN_
      2456**DCL      2456--REDEF
CLOSEP.UTL_
      2456**DCL      2456--REDEF
CLSCOMMON
      2498**LABEL    2486--GOTO
CLSSAVE.SN_
      2397**DCL      2397--REDEF
CLSSAVE.UTL_
      2398**DCL      2398--REDEF
CLSSAVE.V
      2402**DCL      2397--DCLINIT
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:28   
CLSSAVE.V.EXPIRE#
      2412**DCL      2412--REDEF
CLSSAVE.V.TYPE#
      2410**DCL      2410--REDEF
CLSSAVE.V.XTNSIZE#
      2407**DCL      2407--REDEF    2409--REDEF
CLSSAVE.V_
      2397**DCL      2495>>ASSIGN
DFLCLS
      2481**LABEL    2479--CALLALT
F$DCB.ACTPOS
       504**DCL       504--REDEF
F$DCB.ARS
       479**DCL       479--REDEF
F$DCB.ASN
       494**DCL      2504>>DOCASE
F$DCB.ATTR
       497**DCL       498--REDEF
F$DCB.BORROW
       512**DCL       512--REDEF     512--REDEF     512--REDEF
F$DCB.DCBNAME.L
       526**DCL       526--IMP-SIZ
F$DCB.EOMCHAR
       483**DCL       483--REDEF
F$DCB.FCD
       492**DCL      2499>>IF       2532<<ASSIGN   2553<<ASSIGN
F$DCB.FCI
       492**DCL      2533<<ASSIGN
F$DCB.FFLG.EXEC
       484**DCL      2496<<ASSIGN   2500>>IF
F$DCB.FLDID
       507**DCL       507--REDEF
F$DCB.FORM$
       501**DCL       501--REDEF
F$DCB.FSECT
       517**DCL       517--REDEF
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:29   
F$DCB.FSN
       494**DCL       494--REDEF     494--REDEF     495--REDEF
F$DCB.HEADER$
       500**DCL       500--REDEF
F$DCB.IASN
       520**DCL      2506>>IF
F$DCB.IXTNSIZE
       498**DCL       498--REDEF
F$DCB.LASTSTA$
       488**DCL       488--REDEF
F$DCB.LVL
       513**DCL       513--REDEF
F$DCB.NAME.C
       488**DCL       488--REDEF
F$DCB.NOEOF
       509**DCL       509--REDEF
F$DCB.NRECS
       499**DCL       499--REDEF
F$DCB.NRECX
       518**DCL       518--REDEF
F$DCB.OHDR
       510**DCL       510--REDEF
F$DCB.ORG
       493**DCL       493--REDEF
F$DCB.PRECNO
       516**DCL       516--REDEF
F$DCB.RCSZ
       521**DCL       521--REDEF
F$DCB.RES
       489**DCL       489--REDEF
F$DCB.SETX
       501**DCL       501--REDEF
F$DCB.TAB$
       500**DCL       501--REDEF
F$DCB.TDA
       515**DCL       515--REDEF
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:30   
F$DCB.WSN
       490**DCL       490--REDEF
F$DCB.WSR
       496**DCL      2502>>IF
FMO$GETDOMAIN
      2465**DCL-ENT  2501--CALL     2517--CALL
FMP$CLSF
      2466**DCL-ENT  2509--CALL
FMP$E$DCBCLOSED
      2434**DCL      2547>>ASSIGN
FMP$E$DOMAIN
      2438**DCL      2542>>ASSIGN
FMP$E$INVASN
      2430**DCL      2552>>ASSIGN
FMPE$DCBCLOSED
      2547**LABEL    2499--GOTO
FMPE$DOMAIN
      2542**LABEL    2502--GOTO
FMPE$INVASN
      2552**LABEL    2527--GOTO
FPC$CLSOD
      2468**DCL-ENT  2507--CALL
FPT$
      2459**DCL      2481<<ASSIGN   2483<<ASSIGN   2493<<ASSIGN   2495<<ASSIGN   2507<>CALL     2509<>CALL
      2511<>CALL     2513<>CALL     2521<>CALL
FSP$CLSDEV
      2469**DCL-ENT  2513--CALL
FTC$CLOSE
      2467**DCL-ENT  2511--CALL
HFF$NILERASE
      2463**DCL-ENT  2482--CALL
HFF$TRAPALT
      2464**DCL-ENT  2479--CALL
I
      2461**DCL      2480<<DOINDEX  2481>>ASSIGN   2482<>CALL     2483>>ASSIGN   2483>>ASSIGN   2492<<DOINDEX
      2493>>ASSIGN   2501<>CALL     2502>>IF       2502>>IF       2517<>CALL     2518>>IF
PL6.E3A0      #001=FMP$CLS File=FMP$CLSF.:E05TSI                                 TUE 07/29/97 16:57 Page:31   
JDCB$
      2442**DCL      2498<<ASSIGN   2499>>IF       2500>>IF       2502>>IF       2504>>DOCASE   2506>>IF
      2515>>IF       2532>>ASSIGN   2533>>ASSIGN   2553>>ASSIGN
KCO$CLCG
      2470**DCL-ENT  2521--CALL
NAO$CLS
      2472**DCL-ENT  2525--CALL
NOTNIL
      2483**LABEL    2482--CALLALT
TDP$CLOSE
      2471**DCL-ENT  2523--CALL
UCNOCLOSE
      2535**LABEL    2513--CALLALT  2519--GOTO

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:32   
      164        1        /*T***********************************************************/
      165        2        /*T*                                                         */
      166        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      167        4        /*T*                                                         */
      168        5        /*T***********************************************************/
      169        6                    /*F*
      170        7                    *     NAME:   FMP$CLSF
      171        8                    *
      172        9                    *     PURPOSE:  TO CLOSE A FILE DCB.
      173       10                    */
      174       11                    /*D*
      175       12                    *     NAME:   FMP$CLSF
      176       13                    *     CALL:   CALL FMP$CLSF(FPT$);
      177       14                    *
      178       15                    *             WHERE  B$JIT.DCB$ POINTS TO THE DCB BEING CLOSED.
      179       16                    *                    FPT$ IS AN ARRAY OF POINTERS TO THE CLOSE FPT.
      180       17                    *
      181       18                    *     INPUT:  THE CLOSE FPT AND THE DCB.
      182       19                    *
      183       20                    *     OUTPUT: A CLOSED DCB, WITH THE FILE EITHER SAVED OR RELEASED
      184       21                    *             BASED UPON THE SPECIFIED (OR DEFAULT) DISPOSITION.
      185       22                    *
      186       23                    *     DESCRIPTION:  FMP$CLSF UPDATES THE FIT, CATALOGS THE FILE,
      187       24                    *             RELEASES THE CFUS, AND CLOSES THE DCB.
      188       25                    */
      189       26        FMP$CLSF: PROC(FPT$);
      190       27                    /* PARAMETER DATA */
      191       28        %INCLUDE F$CP6P_C;
      192       39        %FPT$CLOSE_P(FPTN=FPT$,STCLASS=,PFMT=PTR);
      193       43    1   DCL JDCB$ PTR; /* POINTER TO THE DCB */
      194       44                    /* AUTOMATIC DATA */
      195       45    1   DCL CFU$ PTR; /* POINTER TO THE CFU */
      196       46    1   DCL I SBIN; /* TEMPORARY INDEX */
      197       47    1   DCL IB REDEF I BIT(36);
      198       48    1   DCL CFUX$ PTR; /* OUR CFU POINTS TO THIS ONE */
      199       49    1   DCL SFDA SBIN; /* OLD FILE FIT DISK ADDRESS */
      200       50    1   DCL KEY$ PTR; /* PTR TO FD KEY ENTRY */
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:33   
      201       51    1   DCL SEG$ PTR; /* PTR TO FD SEGMENT ENTRY */
      202       52    1   DCL ACCT$ PTR; /* PTR TO THE ACCT BLOCK */
      203       53    1   DCL ERRCODE UBIN;
      204       54    1   DCL BUF$ PTR; /* BUFFER POINTER */
      205       55        %FPT$CLOSE_P(FPTN=MYFPT$,STCLASS=AUTO,PFMT=PTR);
      206       59                    /* SYMREF DATA */
      207       60    1   DCL B$JIT$ PTR SYMREF; /* POINTER TO THE JIT */
      208       61    1   DCL F$CFU$ PTR SYMREF READONLY; /* POINTER TO THE CFU AREA */
      209       62    1   DCL ZERO(0:3) UBIN CONSTANT INIT(0*0);
      210       63        %MACRO F$DCB#(BASED=BASED);
      211       64        %INCLUDE F$DCB;
      212      113        %MEND;
      213      114        %F$DCB#(BASED="BASED(JDCB$)");
      214      164        %INCLUDE F$JIT_C;
      215      594        %INCLUDE F_ERRORS_C;
      216      834        %INCLUDE CP_6_SUBS;
      217     1374        %INCLUDE FM$MACROS;
      218     1749        %FM$CFU(BASED="BASED(CFU$)");
      219     1755        %FM$CFUA(BASED="BASED(ACCT$)");
      220     1761        %FM$CFUF(BASED="BASED(CFU$)");
      221     1764        %FM$CFUJ(BASED="BASED(CFU$)");
      222     1769        %FM$FDSEG(BASED="BASED(SEG$)");
      223     1773        %FM$KEYENT(BASED="BASED(KEY$)");
      224     1776        %FM$SET(BASED="BASED(F$CFU$)");
      225     1781        %INCLUDE F$CP6V_C;
      226     2007        %FPT$CLOSE_V(BASED="BASED(MYFPT$.V_)");
      227     2016        %SUB FD_LOCK=0;
      228     2017        %SUB FCG#='0615'O;
      229     2018        %SUB MID#='20'O;
      230     2019        %ERRCODE(NAME=FMP$E$CLSREL,COD#=%E$CLSREL);
      231     2023        %ERRCODE(NAME=FMO$E$CLSREL,COD#=%E$CLSREL,MID#='17'O);
      232     2027        %ERRCODE(NAME=FMP$E$QSTOW,COD#=%E$QSTOW);
      233     2031        %ERRCODE(NAME=FMP$E$RENAME,COD#=%E$RENAME);
      234     2035        %ERRCODE(NAME=FMP$E$REATTR,COD#=%E$REATTR);
      235     2039        %ERRCODE(NAME=FMP$E$FILEBUSY,COD#=%E$FILEBUSY);
      236     2043        %INCLUDE JG_GHOSTS_C;
      237     2133                    /**/
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:34   
      238     2134    1   DCL FM_FRZERO UBIN SYMREF;
      239     2135    1   DCL FM_SYSACCTX SBIN SYMREF;
      240     2136    1   DCL FM_SYSSETX UBIN SYMREF;
      241     2137    1   DCL FMB$IOSPIN ENTRY;
      242     2138    1   DCL FMD$FLSHBUF ENTRY(1); /* FLUSH THE BUFFERS */
      243     2139    1   DCL FMD$RELBUF ENTRY(1);
      244     2140    1   DCL FMD$WRTBUF ENTRY(1);
      245     2141    1   DCL FMG$REMKEY ENTRY ALTRET;
      246     2142    1   DCL FMH$JRELPG ENTRY(1) ALTRET; /* GIVE PACK THE JOURNAL BBUF */
      247     2143    1   DCL FMH$UBLKCLS ENTRY ALTRET;
      248     2144    1   DCL FMI$DSREL ENTRY ALTRET;
      249     2145    1   DCL FMO$MODFIT ENTRY(1) ALTRET; /* MODIFY THE FIT */
      250     2146    1   DCL FMP$CGRANS ENTRY(2); /* COUNT FILE GRANULES */
      251     2147    1   DCL FMP$RELCFUS ENTRY(1); /* RELEASE THE CFUS */
      252     2148    1   DCL FMP$UPFDDESC ENTRY ALTRET;
      253     2149    1   DCL FMQ$CTG ENTRY(2) ALTRET; /* CATALOG THE FILE */
      254     2150    1   DCL FMQ$SRCHFD ENTRY(5) ALTRET; /* SEARCH FILE DIRECTORY */
      255     2151    1   DCL FMR$FN ENTRY(1);
      256     2152    1   DCL FMR$L8 ENTRY; /* LOCK THE CFU SEGMENT */
      257     2153    1   DCL FMR$U8 ENTRY; /* UNLOCK THE CFU SEGMENT */
      258     2154    1   DCL FMR$UPDGAC ENTRY(2);
      259     2155    1   DCL FMU$BLD ENTRY;
      260     2156    1   DCL FMU$ALTBLD ENTRY(1);
      261     2157    1   DCL SSS$SYSTIME ENTRY(1);
      262     2158    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      263     2159    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      264     2160        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:35   
      265     2161                    /*
      266     2162                    *  INITIAL FUNCTIONS FOR ALL TYPES OF CLOSE
      267     2163                    */
      268     2164    1      IF NOT B$JIT.DCB$->F$DCB.FCD THEN RETURN;
      269     2165    1      B$JIT.DCB$->F$DCB.WAIT=0;
      270     2166    1      CALL FMB$IOSPIN;
      271     2167    1   FMP$CLSERR:ENTRY;
      272     2168    1      MYFPT$.V_=ADDR(ZERO);
      273     2169    1      IF ADDR(FPT$)~=ADDR(NIL)
      274     2170    1      THEN IF FPT$.V_~=ADDR(NIL) THEN MYFPT$=FPT$;
      275     2171    1      JDCB$=B$JIT.DCB$;
      276     2172    1      CFU$=F$DCB.CFU$;
      277     2173                    /*
      278     2174                    *  SCRATCH AND DELETED FILES EXIT HERE
      279     2175                    */
      280     2176    1      IF FM$CFUF.ACCNAM=0 THEN GOTO SCRATCHCLS;
      281     2177    2      DO CASE(FM$CFU.FUN);
      282     2178    2      CASE(%CREATE#);
      283     2179    2         IF FPT$CLOSE_V.DISP=%SAVE# THEN GOTO NEWSAVE;
      284     2180    2   NEWREL: CALL FMR$L8;
      285     2181    2         IF FM$CFU.NAMEX~=0 THEN B$JIT.FEXT(F$DCB.FEXTX)='0'B;
      286     2182    3         IF FM$CFU.ACCTX=0 THEN DO;
      287     2183    3            PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACFU=0;
      288     2184    3            FM$CFU.ACCTX=PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACCTX;
      289     2185    3            CALL FMP$RELCFUS(PINCRW(F$CFU$,FM$CFU.NAMEX));
      290     2186    3            END;
      291     2187    3         ELSE DO;
      292     2188    3            I=FM$CFU.ACCTX;
      293     2189    3            CALL FMR$FN(F$DCB.CFU$);
      294     2190    3            FM$CFU.ACCTX=I;
      295     2191    3            CALL FMR$U8;
      296     2192    3            END;
      297     2193    2         IF F$DCB.BORROW<0 THEN
      298     2194    3            IF FM$CFU.STARX.F=0 THEN DO;
      299     2195    3               CALL FMR$L8;
      300     2196    3               PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GRANS=
      301     2197    3                 PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GRANS-JDCB$->F$DCB.BORROW;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:36   
      302     2198    3               PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GMOD=1;
      303     2199    3               IF F$DCB.WSR~=1 AND FM$CFU.ACCTX~=FM_SYSACCTX
      304     2200    3               THEN B$JIT.PRDPRM=B$JIT.PRDPRM-F$DCB.BORROW;
      305     2201    3               CALL FMR$U8;
      306     2202    3               END;
      307     2203    3            ELSE DO;
      308     2204    3   SCRATCHCLS: CALL FMR$UPDGAC(B$JIT.TMPGAC,B$JIT.CURTMPDP);
      309     2205    3               B$JIT.CURTMPDP=B$JIT.CURTMPDP+F$DCB.BORROW;
      310     2206    3               END;
      311     2207    2   ENDREL: ;
      312     2208    2         FM$CFUF.ACCNAM=0;
      313     2209    3         DO I=0 TO 4;
      314     2210    3            IF FM$CFU.AFIT=0 AND F$DCB.BFR.DA(I)=FM_FRZERO
      315     2211    3            THEN F$DCB.BFR.DA(I)=FM$CFU.FITSDA;
      316     2212    3            F$DCB.BFR.BUFUP(I)='0'B;
      317     2213    3            END;
      318     2214    2         FM$CFU.FMOD='0'B;
      319     2215    2         FM$CFU.ALTBLD='0'B;
      320     2216    2         CALL FMI$DSREL;
      321     2217    2         GOTO ENDCLS;
      322     2218        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:37   
      323     2219                    /*
      324     2220                    *  SAVE IS SPECIFIED
      325     2221                    */
      326     2222    2   NEWSAVE:
      327     2223    2         CALL FMI$DSREL ALTRET(NEWREL);
      328     2224    2         CALL FMU$BLD; /* BUILD UPPER LVL, IF RREQ'D */
      329     2225    2         IF F$DCB.ACS=%UBLOCK# THEN IF F$DCB.ORG=%CONSEC# AND NOT F$DCB.SPAN
      330     2226    2            THEN CALL FMH$UBLKCLS ALTRET(NEWREL);
      331     2227    2         CALL FMO$MODFIT(MYFPT$);
      332     2228                    /*
      333     2229                    *  CATALOG THE FILE
      334     2230                    */
      335     2231    2         IB=B$JIT.ERR;
      336     2232    2         IF FM$CFU.FITSDA~=0 THEN /* UNLESS IT HAS BEEN RENAMED ALREADY */
      337     2233    2            CALL FMQ$CTG(ADDR(F$DCB.NAME),SFDA)ALTRET(NEWREL);
      338     2234    2         B$JIT.ERR=IB;
      339     2235        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:38   
      340     2236    2      CASE(%IN#,%UPDATE#);
      341     2237                    /*
      342     2238                    *  THE FILE IS OPEN IN INPUT OR UPDATE MODE
      343     2239                    *
      344     2240                    *  NOTE THAT THE DCB MAY HAVE BEEN EITHER CREATE,OLDFILE OR
      345     2241                    *  B$JIT.FEXT CONTROLLED.  IN THOSE CASES THE CFU FUNCTION
      346     2242                    *  INDICATES UPDATE MODE EVEN THOUGH THE DCB FUNCTION IS CREATE.
      347     2243                    */
      348     2244    2         IF FPT$CLOSE_V.DISP~=%SCRATCH# THEN GOTO CLSSAVE;
      349     2245    2   CLSREL:;
      350     2246    2         CALL FMR$L8;
      351     2247    2         IF NOT F$DCB.FFLG.DELF
      352     2248    2           OR FM$CFU.FUN=%UPDATE# AND FM$CFU.USECNT>1
      353     2249    3           OR FM$CFU.ACFU~=0 THEN DO;
      354     2250    3            CALL FMR$U8;
      355     2251    3            IF F$DCB.FFLG.DELF THEN B$JIT.ERR=FMP$E$FILEBUSY;
      356     2252    3            ELSE IF F$DCB.DESC.ARCHIVE THEN B$JIT.ERR=FMP$E$QSTOW;
      357     2253                    /*E* ERROR: FMP-E$QSTOW-E
      358     2254                    *    MESSAGE:Cannot delete file% %FN% - it is archived.
      359     2255                    *    MESSAGE1:File% %UF% is archived and so read-only.
      360     2256                    *             You must UNSTOW it to delete it.
      361     2257                    */
      362     2258    3               ELSE B$JIT.ERR=FMP$E$CLSREL;
      363     2259                    /*E* ERROR: FMP-E$CLSREL-E
      364     2260                    *        MESSAGE: You may not delete file %FN
      365     2261                    *        MESSAGE1:File% %UF% may not be deleted,
      366     2262                    *                 because you have no DELF access to it.
      367     2263                    */
      368     2264    3            GOTO CLSSAVE;
      369     2265    3            END;
      370     2266    2         FM$CFU.SHARE=%NONE#;
      371     2267    2         CALL FMR$U8;
      372     2268    3         IF F$DCB.DESC.QS THEN DO;
      373     2269    3            B$JIT.ERR=FMP$E$QSTOW;
      374     2270    3            GOTO CLSSAVE;
      375     2271    3            END;
      376     2272    2         IF FM$CFUF.ACCNAM=0 THEN GOTO ENDREL; /* ALREADY UNCATALOGUED */
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:39   
      377     2273    3         IF F$DCB.STARX~=0 THEN DO;
      378     2274    3            B$JIT.STAR.DA(F$DCB.STARX)=0;
      379     2275    3            GOTO SETCFUREL;
      380     2276    3            END;
      381     2277    2         ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);
      382     2278    2         IF NOT F$DCB.STARF THEN CALL UQB$MENQX(ACCT$)ALTRET(CLSSAVE);
      383     2279    2         SFDA=BITBIN(F$DCB.BFR(1)); /* Save in case the FIT */
      384     2280    2         IB=F$DCB.BFR1(1);
      385     2281    2         F$DCB.BFR(1)='0'B;
      386     2282    2         F$DCB.BFR1(1)='0'B;
      387     2283    2         CALL FMQ$SRCHFD(ADDR(F$DCB.NAME),KEY$,SEG$,ACCT$,ADDR(NIL))
      388     2284    2           ALTRET(SCFURELFD);
      389     2285    2         FM$KEYENT.D='1'B; /* SET KEY DELETED */
      390     2286    2         FM$FDSEG='0'B;
      391     2287    2         FM$FDSEG.DESC.DELF='1'B;
      392     2288    2         IF B$JIT.PRIV.ACTIVE&%PR_FMEFT# THEN ERRCODE=F$DCB.EXPIRE;
      393     2289    2         ELSE CALL SSS$SYSTIME(ERRCODE);
      394     2290    2         FM$FDSEG.FITSDA=ERRCODE/512;
      395     2291    2         IF F$DCB.STARF THEN CALL FMG$REMKEY;
      396     2292    2         ELSE IF NOT FM$CFUA.ACCESS.BUPF THEN CALL FMG$REMKEY;
      397     2293    2         IF F$DCB.BFR.BUFX(1)~=0 THEN CALL FMD$WRTBUF(1);
      398     2294    2   SCFURELFD: IF NOT F$DCB.STARF THEN CALL UQB$MDEQ(ACCT$);
      399     2295    2         F$DCB.BFR(1)=BINBIT(SFDA,36);
      400     2296    2         F$DCB.BFR1(1)=IB;
      401     2297    2   SETCFUREL:
      402     2298    2         I=MOD(FM$CFU.UGRANS+FM$CFU.NGAVAL,67108864);
      403     2299    2         CALL FMR$L8;
      404     2300    2         IF FM$CFU.ACCTX~=0
      405     2301    3         THEN IF FM$CFU.STARX.F=0 THEN DO;
      406     2302    3               IF F$DCB.WSR~=1 AND FM$CFU.ACCTX~=FM_SYSACCTX
      407     2303    3               THEN B$JIT.PRDPRM=B$JIT.PRDPRM+I;
      408     2304    3               PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GRANS=
      409     2305    3                 PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GRANS+I;
      410     2306    3               PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GMOD=1;
      411     2307    3               END;
      412     2308    3            ELSE DO;
      413     2309    3               CALL FMR$UPDGAC(B$JIT.TMPGAC,B$JIT.CURTMPDP);
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:40   
      414     2310    3               B$JIT.CURTMPDP=B$JIT.CURTMPDP-I;
      415     2311    3               END;
      416     2312    2         CALL FMR$FN(F$DCB.CFU$);
      417     2313    2         CALL FMR$U8;
      418     2314    2         GOTO ENDREL;
      419     2315        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:41   
      420     2316                    /*
      421     2317                    *  SCRATCH IS NOT SPECIFIED
      422     2318                    */
      423     2319    2   CLSSAVE:
      424     2320    2         CALL FMI$DSREL ALTRET(NEWREL);
      425     2321    2         IF B$JIT.PRIV.ACTIVE&%PR_FMEFT# AND FPT$CLOSE_V.EFTOPER
      426     2322    2           OR FM$CFU.SHARED OR FM$CFU.FMOD
      427     2323    3           OR FM$CFU.FUN~=%IN# AND F$DCB.FCD THEN DO;
      428     2324    3            IB=F$DCB.DESC;
      429     2325    3            IF FPT$CLOSE_V.OPER.REBLD THEN FM$CFU.ULBLD=1;
      430     2326    3            IF FPT$CLOSE_V.ALTBLD=%YES# THEN FM$CFU.ALTBLD='1'B;
      431     2327    3            CALL FMU$BLD;
      432     2328    3            CALL FMO$MODFIT(MYFPT$);
      433     2329    3            IF (IB\F$DCB.DESC)&'777'O AND FM$CFUF.ACCNAM~=0
      434     2330    3              AND FM$CFU.FITSDA~=0 THEN CALL FMP$UPFDDESC;
      435     2331    3            END;
      436     2332    2         ELSE IF F$DCB.FUN~=%IN#
      437     2333    2            THEN IF FPT$CLOSE_V.OPER.CHGATT
      438     2334    2               THEN IF FPT$.NAME_~=ADDR(NIL)
      439     2335    2                    OR FPT$.PASS_~=ADDR(NIL) THEN B$JIT.ERR=FMP$E$RENAME;
      440     2336    2                  ELSE IF FPT$.ACCESS_~=ADDR(NIL)
      441     2337    2                       OR FPT$.ACSVEH_~=ADDR(NIL)
      442     2338    2                     THEN B$JIT.ERR=FMO$E$CLSREL;
      443     2339    2                     ELSE B$JIT.ERR=FMP$E$REATTR;
      444     2340    2               ELSE IF FPT$CLOSE_V.OPER.RELG THEN B$JIT.ERR=FMO$E$CLSREL;
      445     2341        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:42   
      446     2342    2      CASE(%JRNL#);
      447     2343    3         IF F$DCB.OWNER THEN DO;
      448     2344    4            IF F$DCB.ASN~=%FILE# THEN DO;
      449     2345    4               FM$CFU.LDA=FM_FRZERO;
      450     2346                    /* CLEAN UP THE TAPE STUFF IN THE CFU */
      451     2347    4               FM$CFUJ.UPD='0'B;
      452     2348    4               FM$CFU.NGAVAL=0;
      453     2349    4               FM$CFUJ.BLKLEN=0;
      454     2350    4               FM$CFU.RCSZ=0;
      455     2351    4               FM$CFU.UGRANS=1;
      456     2352    4               F$DCB.IASN=%FILE#;
      457     2353    4               IF F$DCB.STARF OR FM$CFU.ACCTX=0 THEN F$DCB.SETX=FM_SYSSETX;
      458     2354    4               ELSE F$DCB.SETX=PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.SETX;
      459     2355    4               F$DCB.PSN=FM$SET.PSN(F$DCB.SETX);
      460     2356    4               CALL FMD$RELBUF(1);
      461     2357    4               IF B$JIT.SYSID~=JG_JAYS# THEN GOTO NEWREL;
      462     2358    4               END;
      463     2359    3            CALL FMO$MODFIT(MYFPT$);
      464     2360    3            CALL FMH$JRELPG(1);
      465     2361    3            FM$CFUJ.USER=0; /* FIX THE CFU TO ALLOW A NEW OWNER */
      466     2362    3            FM$CFUJ.ERR_WAIT='0'B;
      467     2363    3            END;
      468     2364    2         ELSE CALL FMD$RELBUF(1);
      469     2365        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:43   
      470     2366    2      END;     /* OF DO CASE ON CFU.FUN */
      471     2367                    /*
      472     2368                    *  ALL CLOSES ENTER HERE TO FLUSH BUFFERS, PURGE READ AHEAD,
      473     2369                    *  AND RELEASE CFU BLOCKS.
      474     2370                    */
      475     2371    1   ENDCLS:
      476     2372    2      DO I=0 TO 4;
      477     2373    2         IF F$DCB.BFR.BUFUP(I) THEN CALL FMD$FLSHBUF(I);
      478     2374    2         END;
      479     2375    1      IF F$DCB.ALTKEYX~=0 AND FPT$CLOSE_V.ALTBLD THEN
      480     2376    1         CALL FMU$ALTBLD(MYFPT$);
      481     2377    1      CALL FMP$RELCFUS(F$DCB.CFU$);
      482     2378    2      DO I=0 TO 4;
      483     2379    2         IF F$DCB.BFR.BUFX(I)~=0 THEN CALL FMD$FLSHBUF(I);
      484     2380    2         END;
      485     2381                    /*
      486     2382                    *  SET THE DCB CLOSED IN CASE THIS WAS A CALL FROM THE SYSTEM RATHER
      487     2383                    *  THAN A PMME REQUEST.
      488     2384                    */
      489     2385    1      F$DCB.FCD='0'B;
      490     2386    1      F$DCB.FCI='1'B;
      491     2387    1      RETURN;
      492     2388        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:44   
      493     2389                    /*F*     NAME: FMP$CLSTAR
      494     2390                    *        PURPOSE: To close a DCB which may be open only to
      495     2391                    *        a file in input mode.
      496     2392                    *        DESCRIPTION: RETURNs if the parameter DCB is not open,
      497     2393                    *        otherwise closes it.
      498     2394                    */
      499     2395    1   FMP$CLSTAR:ENTRY;
      500     2396    1      JDCB$=B$JIT.DCB$;
      501     2397    1      IF NOT F$DCB.FCD THEN RETURN;
      502     2398    1      MYFPT$.V_ = ADDR(ZERO);
      503     2399    1      CFU$=F$DCB.CFU$;
      504     2400    1      GOTO ENDCLS;
      505     2401        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:45   
      506     2402                    /*F*
      507     2403                    *     NAME:   FMP$CLSREL
      508     2404                    *
      509     2405                    *     PURPOSE:  TO CLOSE AND RELEASE A FILE.  FMP$CLSREL IS
      510     2406                    *               CALLED BY OPEN WHEN 'DELETE' IS SPECIFIED.
      511     2407                    *
      512     2408                    *     DESCRIPTION:  FMP$CLSREL IS CALLED BY FMN$OPNF WHEN THE
      513     2409                    *             DELETE OPTION IS SPECIFIED ON OPEN, AND THE
      514     2410                    *             CALLER HAS OBTAINED THE PRIVILEGE TO OPEN THE
      515     2411                    *             FILE.  THE DELETE PRIVILEGE IS CHECKED HERE.
      516     2412                    *
      517     2413                    */
      518     2414    1   FMP$CLSREL: ENTRY;
      519     2415    1      JDCB$=B$JIT.DCB$;
      520     2416    1      MYFPT$.V_=ADDR(ZERO);
      521     2417    1      CFU$=F$DCB.CFU$;
      522     2418    1      GOTO CLSREL;
      523     2419    1   END FMP$CLSF;
      524     2420        %EOD;

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:46   
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FMP$CLSF.

   Procedure FMP$CLSF requires 726 words for executable code.
   Procedure FMP$CLSF requires 36 words of local(AUTO) storage.

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:47   

 Object Unit name= FMP$CLSF                                   File name= FMP$CLSF.:E05TOU
 UTS= JUL 29 '97 16:58:05.16 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     10     12  FMP$CLSF
    1   Proc  even  none   726   1326  FMP$CLSF
    2  RoData even  none    10     12  FMP$CLSF

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  FMP$CLSF
     1     16                  yes      Std        0  FMP$CLSERR
     1   1274                  yes      Std        0  FMP$CLSTAR
     1   1313                  yes      Std        0  FMP$CLSREL
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:48   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FMB$IOSPIN
         yes           Std       0 FMR$L8
         yes           Std       1 FMP$RELCFUS
         yes           Std       1 FMR$FN
         yes           Std       2 FMR$UPDGAC
 yes     yes           Std       1 FMO$MODFIT
         yes           Std       1 FMD$RELBUF
         yes           Std       1 SSS$SYSTIME
         yes           Std       1 FMD$FLSHBUF
 yes     yes           Std       0 FMI$DSREL
         yes           Std       1 FMD$WRTBUF
         yes           Std       0 FMU$BLD
 yes     yes           Std       1 FMH$JRELPG
 yes     yes           Std       5 FMQ$SRCHFD
 yes     yes           Std       1 UQB$MDEQ
 yes     yes           Std       0 FMP$UPFDDESC
         yes           Std       0 FMR$U8
 yes     yes           Std       2 FMQ$CTG
 yes     yes           Std       1 UQB$MENQX
 yes     yes           Std       0 FMG$REMKEY
         yes           Std       1 FMU$ALTBLD
 yes     yes           Std       0 FMH$UBLKCLS
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:49   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                           r    F$CFU$                                FM_FRZERO
     FM_SYSACCTX                           FM_SYSSETX                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:50   


      164        1        /*T***********************************************************/
      165        2        /*T*                                                         */
      166        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      167        4        /*T*                                                         */
      168        5        /*T***********************************************************/
      169        6                    /*F*
      170        7                    *     NAME:   FMP$CLSF
      171        8                    *
      172        9                    *     PURPOSE:  TO CLOSE A FILE DCB.
      173       10                    */
      174       11                    /*D*
      175       12                    *     NAME:   FMP$CLSF
      176       13                    *     CALL:   CALL FMP$CLSF(FPT$);
      177       14                    *
      178       15                    *             WHERE  B$JIT.DCB$ POINTS TO THE DCB BEING CLOSED.
      179       16                    *                    FPT$ IS AN ARRAY OF POINTERS TO THE CLOSE FPT.
      180       17                    *
      181       18                    *     INPUT:  THE CLOSE FPT AND THE DCB.
      182       19                    *
      183       20                    *     OUTPUT: A CLOSED DCB, WITH THE FILE EITHER SAVED OR RELEASED
      184       21                    *             BASED UPON THE SPECIFIED (OR DEFAULT) DISPOSITION.
      185       22                    *
      186       23                    *     DESCRIPTION:  FMP$CLSF UPDATES THE FIT, CATALOGS THE FILE,
      187       24                    *             RELEASES THE CFUS, AND CLOSES THE DCB.
      188       25                    */
      189       26        FMP$CLSF: PROC(FPT$);

     26  1 000000   000000 700200 xent  FMP$CLSF     TSX0  ! X66_AUTO_1
         1 000001   000044 000001                    ZERO    36,1

      190       27                    /* PARAMETER DATA */
      191       28        %INCLUDE F$CP6P_C;
      192       39        %FPT$CLOSE_P(FPTN=FPT$,STCLASS=,PFMT=PTR);
      193       43    1   DCL JDCB$ PTR; /* POINTER TO THE DCB */
      194       44                    /* AUTOMATIC DATA */
      195       45    1   DCL CFU$ PTR; /* POINTER TO THE CFU */
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:51   
      196       46    1   DCL I SBIN; /* TEMPORARY INDEX */
      197       47    1   DCL IB REDEF I BIT(36);
      198       48    1   DCL CFUX$ PTR; /* OUR CFU POINTS TO THIS ONE */
      199       49    1   DCL SFDA SBIN; /* OLD FILE FIT DISK ADDRESS */
      200       50    1   DCL KEY$ PTR; /* PTR TO FD KEY ENTRY */
      201       51    1   DCL SEG$ PTR; /* PTR TO FD SEGMENT ENTRY */
      202       52    1   DCL ACCT$ PTR; /* PTR TO THE ACCT BLOCK */
      203       53    1   DCL ERRCODE UBIN;
      204       54    1   DCL BUF$ PTR; /* BUFFER POINTER */
      205       55        %FPT$CLOSE_P(FPTN=MYFPT$,STCLASS=AUTO,PFMT=PTR);
      206       59                    /* SYMREF DATA */
      207       60    1   DCL B$JIT$ PTR SYMREF; /* POINTER TO THE JIT */
      208       61    1   DCL F$CFU$ PTR SYMREF READONLY; /* POINTER TO THE CFU AREA */
      209       62    1   DCL ZERO(0:3) UBIN CONSTANT INIT(0*0);
      210       63        %MACRO F$DCB#(BASED=BASED);
      211       64        %INCLUDE F$DCB;
      212      113        %MEND;
      213      114        %F$DCB#(BASED="BASED(JDCB$)");
      214      164        %INCLUDE F$JIT_C;
      215      594        %INCLUDE F_ERRORS_C;
      216      834        %INCLUDE CP_6_SUBS;
      217     1374        %INCLUDE FM$MACROS;
      218     1749        %FM$CFU(BASED="BASED(CFU$)");
      219     1755        %FM$CFUA(BASED="BASED(ACCT$)");
      220     1761        %FM$CFUF(BASED="BASED(CFU$)");
      221     1764        %FM$CFUJ(BASED="BASED(CFU$)");
      222     1769        %FM$FDSEG(BASED="BASED(SEG$)");
      223     1773        %FM$KEYENT(BASED="BASED(KEY$)");
      224     1776        %FM$SET(BASED="BASED(F$CFU$)");
      225     1781        %INCLUDE F$CP6V_C;
      226     2007        %FPT$CLOSE_V(BASED="BASED(MYFPT$.V_)");
      227     2016        %SUB FD_LOCK=0;
      228     2017        %SUB FCG#='0615'O;
      229     2018        %SUB MID#='20'O;
      230     2019        %ERRCODE(NAME=FMP$E$CLSREL,COD#=%E$CLSREL);
      231     2023        %ERRCODE(NAME=FMO$E$CLSREL,COD#=%E$CLSREL,MID#='17'O);
      232     2027        %ERRCODE(NAME=FMP$E$QSTOW,COD#=%E$QSTOW);
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:52   
      233     2031        %ERRCODE(NAME=FMP$E$RENAME,COD#=%E$RENAME);
      234     2035        %ERRCODE(NAME=FMP$E$REATTR,COD#=%E$REATTR);
      235     2039        %ERRCODE(NAME=FMP$E$FILEBUSY,COD#=%E$FILEBUSY);
      236     2043        %INCLUDE JG_GHOSTS_C;
      237     2133                    /**/
      238     2134    1   DCL FM_FRZERO UBIN SYMREF;
      239     2135    1   DCL FM_SYSACCTX SBIN SYMREF;
      240     2136    1   DCL FM_SYSSETX UBIN SYMREF;
      241     2137    1   DCL FMB$IOSPIN ENTRY;
      242     2138    1   DCL FMD$FLSHBUF ENTRY(1); /* FLUSH THE BUFFERS */
      243     2139    1   DCL FMD$RELBUF ENTRY(1);
      244     2140    1   DCL FMD$WRTBUF ENTRY(1);
      245     2141    1   DCL FMG$REMKEY ENTRY ALTRET;
      246     2142    1   DCL FMH$JRELPG ENTRY(1) ALTRET; /* GIVE PACK THE JOURNAL BBUF */
      247     2143    1   DCL FMH$UBLKCLS ENTRY ALTRET;
      248     2144    1   DCL FMI$DSREL ENTRY ALTRET;
      249     2145    1   DCL FMO$MODFIT ENTRY(1) ALTRET; /* MODIFY THE FIT */
      250     2146    1   DCL FMP$CGRANS ENTRY(2); /* COUNT FILE GRANULES */
      251     2147    1   DCL FMP$RELCFUS ENTRY(1); /* RELEASE THE CFUS */
      252     2148    1   DCL FMP$UPFDDESC ENTRY ALTRET;
      253     2149    1   DCL FMQ$CTG ENTRY(2) ALTRET; /* CATALOG THE FILE */
      254     2150    1   DCL FMQ$SRCHFD ENTRY(5) ALTRET; /* SEARCH FILE DIRECTORY */
      255     2151    1   DCL FMR$FN ENTRY(1);
      256     2152    1   DCL FMR$L8 ENTRY; /* LOCK THE CFU SEGMENT */
      257     2153    1   DCL FMR$U8 ENTRY; /* UNLOCK THE CFU SEGMENT */
      258     2154    1   DCL FMR$UPDGAC ENTRY(2);
      259     2155    1   DCL FMU$BLD ENTRY;
      260     2156    1   DCL FMU$ALTBLD ENTRY(1);
      261     2157    1   DCL SSS$SYSTIME ENTRY(1);
      262     2158    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      263     2159    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      264     2160        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:53   
      265     2161                    /*
      266     2162                    *  INITIAL FUNCTIONS FOR ALL TYPES OF CLOSE
      267     2163                    */
      268     2164    1      IF NOT B$JIT.DCB$->F$DCB.FCD THEN RETURN;

   2164  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 471500                    LDP1    154,,PR0
         1 000004   100031 236100                    LDQ     25,,PR1
         1 000005   020000 316007                    CANQ    8192,DL
         1 000006   000010 601000 1                  TNZ     s:2165

   2164  1 000007   000000 702200 xent               TSX2  ! X66_ARET

      269     2165    1      B$JIT.DCB$->F$DCB.WAIT=0;

   2165  1 000010   000000 236000 2                  LDQ     0
         1 000011   100064 356100                    ANSQ    52,,PR1

      270     2166    1      CALL FMB$IOSPIN;

   2166  1 000012   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000013   000000 701000 xent               TSX1    FMB$IOSPIN
         1 000014   000000 011000                    NOP     0
         1 000015   000020 710000 1                  TRA     s:2168

      271     2167    1   FMP$CLSERR:ENTRY;

   2167  1 000016   000000 700200 xent  FMP$CLSERR   TSX0  ! X66_AUTO_1
         1 000017   000044 000001                    ZERO    36,1

      272     2168    1      MYFPT$.V_=ADDR(ZERO);

   2168  1 000020   000001 236000 2                  LDQ     1
         1 000021   200016 756100                    STQ     MYFPT$,,AUTO

      273     2169    1      IF ADDR(FPT$)~=ADDR(NIL)

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:54   
   2169  1 000022   200003 236100                    LDQ     @FPT$,,AUTO
         1 000023   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000024   000034 600000 1                  TZE     s:2171

      274     2170    1      THEN IF FPT$.V_~=ADDR(NIL) THEN MYFPT$=FPT$;

   2170  1 000025   200003 470500                    LDP0    @FPT$,,AUTO
         1 000026   000000 236100                    LDQ     0,,PR0
         1 000027   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000030   000034 600000 1                  TZE     s:2171

   2170  1 000031   000100 100500                    MLR     fill='000'O
         1 000032   000000 000070                    ADSC9   0,,PR0                   cn=0,n=56
         1 000033   200016 000070                    ADSC9   MYFPT$,,AUTO             cn=0,n=56

      275     2171    1      JDCB$=B$JIT.DCB$;

   2171  1 000034   000000 470400 xsym               LDP0    B$JIT$
         1 000035   000232 236100                    LDQ     154,,PR0
         1 000036   200004 756100                    STQ     JDCB$,,AUTO

      276     2172    1      CFU$=F$DCB.CFU$;

   2172  1 000037   200004 471500                    LDP1    JDCB$,,AUTO
         1 000040   100066 236100                    LDQ     54,,PR1
         1 000041   200005 756100                    STQ     CFU$,,AUTO

      277     2173                    /*
      278     2174                    *  SCRATCH AND DELETED FILES EXIT HERE
      279     2175                    */
      280     2176    1      IF FM$CFUF.ACCNAM=0 THEN GOTO SCRATCHCLS;

   2176  1 000042   200005 473500                    LDP3    CFU$,,AUTO
         1 000043   300002 235100                    LDA     2,,PR3
         1 000044   000211 600000 1                  TZE     SCRATCHCLS

      281     2177    2      DO CASE(FM$CFU.FUN);
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:55   

   2177  1 000045   300000 236100                    LDQ     0,,PR3
         1 000046   000041 772000                    QRL     33
         1 000047   000005 116007                    CMPQ    5,DL
         1 000050   000052 602006 1                  TNC     s:2177+5,QL
         1 000051   001203 710000 1                  TRA     ENDCLS
         1 000052   001203 710000 1                  TRA     ENDCLS
         1 000053   000352 710000 1                  TRA     s:2244
         1 000054   000352 710000 1                  TRA     s:2244
         1 000055   000057 710000 1                  TRA     s:2179
         1 000056   001100 710000 1                  TRA     s:2343

      282     2178    2      CASE(%CREATE#);

      283     2179    2         IF FPT$CLOSE_V.DISP=%SAVE# THEN GOTO NEWSAVE;

   2179  1 000057   200016 474500                    LDP4    MYFPT$,,AUTO
         1 000060   400000 236100                    LDQ     0,,PR4
         1 000061   000777 376007                    ANQ     511,DL
         1 000062   000002 116007                    CMPQ    2,DL
         1 000063   000271 600000 1                  TZE     NEWSAVE

      284     2180    2   NEWREL: CALL FMR$L8;

   2180  1 000064   000002 631400 xsym  NEWREL       EPPR1   B_VECTNIL+2
         1 000065   000000 701000 xent               TSX1    FMR$L8
         1 000066   000000 011000                    NOP     0

      285     2181    2         IF FM$CFU.NAMEX~=0 THEN B$JIT.FEXT(F$DCB.FEXTX)='0'B;

   2181  1 000067   200005 470500                    LDP0    CFU$,,AUTO
         1 000070   000002 720100                    LXL0    2,,PR0
         1 000071   000102 600000 1                  TZE     s:2182

   2181  1 000072   200004 471500                    LDP1    JDCB$,,AUTO
         1 000073   100034 236100                    LDQ     28,,PR1
         1 000074   000011 772000                    QRL     9
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:56   
         1 000075   000777 376007                    ANQ     511,DL
         1 000076   000000 473400 xsym               LDP3    B$JIT$
         1 000077   003106 060400                    CSL     bolr='003'O
         1 000100   000002 000001 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=1
         1 000101   300220 000001                    BDSC    144,Q,PR3                by=0,bit=0,n=1

      286     2182    3         IF FM$CFU.ACCTX=0 THEN DO;

   2182  1 000102   000002 220100                    LDX0    2,,PR0
         1 000103   000125 601000 1                  TNZ     s:2188

      287     2183    3            PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACFU=0;

   2183  1 000104   000002 721100                    LXL1    2,,PR0
         1 000105   000000 471400 xsym               LDP1    F$CFU$
         1 000106   000002 236000 2                  LDQ     2
         1 000107   100000 356111                    ANSQ    0,X1,PR1

      288     2184    3            FM$CFU.ACCTX=PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACCTX;

   2184  1 000110   000002 720100                    LXL0    2,,PR0
         1 000111   100002 221110                    LDX1    2,X0,PR1
         1 000112   000002 741100                    STX1    2,,PR0

      289     2185    3            CALL FMP$RELCFUS(PINCRW(F$CFU$,FM$CFU.NAMEX));

   2185  1 000113   000000 636010                    EAQ     0,X0
         1 000114   000000 036000 xsym               ADLQ    F$CFU$
         1 000115   200034 756100                    STQ     MYFPT$+14,,AUTO
         1 000116   200034 633500                    EPPR3   MYFPT$+14,,AUTO
         1 000117   200035 453500                    STP3    MYFPT$+15,,AUTO
         1 000120   200035 630500                    EPPR0   MYFPT$+15,,AUTO
         1 000121   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000122   000000 701000 xent               TSX1    FMP$RELCFUS
         1 000123   000000 011000                    NOP     0

      290     2186    3            END;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:57   

   2186  1 000124   000145 710000 1                  TRA     s:2193

      291     2187    3         ELSE DO;

      292     2188    3            I=FM$CFU.ACCTX;

   2188  1 000125   000002 236100                    LDQ     2,,PR0
         1 000126   000022 772000                    QRL     18
         1 000127   200006 756100                    STQ     I,,AUTO

      293     2189    3            CALL FMR$FN(F$DCB.CFU$);

   2189  1 000130   200004 236100                    LDQ     JDCB$,,AUTO
         1 000131   000066 036003                    ADLQ    54,DU
         1 000132   200034 756100                    STQ     MYFPT$+14,,AUTO
         1 000133   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 000134   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000135   000000 701000 xent               TSX1    FMR$FN
         1 000136   000000 011000                    NOP     0

      294     2190    3            FM$CFU.ACCTX=I;

   2190  1 000137   200006 720100                    LXL0    I,,AUTO
         1 000140   200005 470500                    LDP0    CFU$,,AUTO
         1 000141   000002 740100                    STX0    2,,PR0

      295     2191    3            CALL FMR$U8;

   2191  1 000142   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000143   000000 701000 xent               TSX1    FMR$U8
         1 000144   000000 011000                    NOP     0

      296     2192    3            END;

      297     2193    2         IF F$DCB.BORROW<0 THEN

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:58   
   2193  1 000145   200004 470500                    LDP0    JDCB$,,AUTO
         1 000146   000065 235100                    LDA     53,,PR0
         1 000147   000230 605000 1                  TPL     ENDREL

      298     2194    3            IF FM$CFU.STARX.F=0 THEN DO;

   2194  1 000150   200005 471500                    LDP1    CFU$,,AUTO
         1 000151   100002 236100                    LDQ     2,,PR1
         1 000152   400000 316003                    CANQ    -131072,DU
         1 000153   000211 601000 1                  TNZ     SCRATCHCLS

      299     2195    3               CALL FMR$L8;

   2195  1 000154   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000155   000000 701000 xent               TSX1    FMR$L8
         1 000156   000000 011000                    NOP     0

      300     2196    3               PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GRANS=

   2196  1 000157   200005 470500                    LDP0    CFU$,,AUTO
         1 000160   000002 220100                    LDX0    2,,PR0
         1 000161   200004 471500                    LDP1    JDCB$,,AUTO
         1 000162   000000 473400 xsym               LDP3    F$CFU$
         1 000163   300007 236110                    LDQ     7,X0,PR3
         1 000164   100065 136100                    SBLQ    53,,PR1
         1 000165   300007 756110                    STQ     7,X0,PR3

      301     2197    3                 PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GRANS-JDCB$->F$DCB.BORROW;
      302     2198    3               PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GMOD=1;

   2198  1 000166   000002 220100                    LDX0    2,,PR0
         1 000167   100000 236003                    LDQ     32768,DU
         1 000170   300005 256110                    ORSQ    5,X0,PR3

      303     2199    3               IF F$DCB.WSR~=1 AND FM$CFU.ACCTX~=FM_SYSACCTX

   2199  1 000171   100040 236100                    LDQ     32,,PR1
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:59   
         1 000172   000777 376003                    ANQ     511,DU
         1 000173   000001 116003                    CMPQ    1,DU
         1 000174   000205 600000 1                  TZE     s:2201
         1 000175   000002 236100                    LDQ     2,,PR0
         1 000176   000022 772000                    QRL     18
         1 000177   000000 116000 xsym               CMPQ    FM_SYSACCTX
         1 000200   000205 600000 1                  TZE     s:2201

      304     2200    3               THEN B$JIT.PRDPRM=B$JIT.PRDPRM-F$DCB.BORROW;

   2200  1 000201   000000 474400 xsym               LDP4    B$JIT$
         1 000202   400242 236100                    LDQ     162,,PR4
         1 000203   100065 136100                    SBLQ    53,,PR1
         1 000204   400242 756100                    STQ     162,,PR4

      305     2201    3               CALL FMR$U8;

   2201  1 000205   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000206   000000 701000 xent               TSX1    FMR$U8
         1 000207   000000 011000                    NOP     0

      306     2202    3               END;

   2202  1 000210   000230 710000 1                  TRA     ENDREL

      307     2203    3            ELSE DO;

      308     2204    3   SCRATCHCLS: CALL FMR$UPDGAC(B$JIT.TMPGAC,B$JIT.CURTMPDP);

   2204  1 000211   000000 236000 xsym  SCRATCHCLS   LDQ     B$JIT$
         1 000212   000240 036003                    ADLQ    160,DU
         1 000213   200035 756100                    STQ     MYFPT$+15,,AUTO
         1 000214   000000 236000 xsym               LDQ     B$JIT$
         1 000215   000246 036003                    ADLQ    166,DU
         1 000216   200034 756100                    STQ     MYFPT$+14,,AUTO
         1 000217   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 000220   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:60   
         1 000221   000000 701000 xent               TSX1    FMR$UPDGAC
         1 000222   000000 011000                    NOP     0

      309     2205    3               B$JIT.CURTMPDP=B$JIT.CURTMPDP+F$DCB.BORROW;

   2205  1 000223   000000 470400 xsym               LDP0    B$JIT$
         1 000224   200004 471500                    LDP1    JDCB$,,AUTO
         1 000225   000240 236100                    LDQ     160,,PR0
         1 000226   100065 036100                    ADLQ    53,,PR1
         1 000227   000240 756100                    STQ     160,,PR0

      310     2206    3               END;

   2204  1 000230                       ENDREL       null
      311     2207    2   ENDREL: ;
      312     2208    2         FM$CFUF.ACCNAM=0;

   2208  1 000230   200005 470500                    LDP0    CFU$,,AUTO
         1 000231   000002 450100                    STZ     2,,PR0

      313     2209    3         DO I=0 TO 4;

   2209  1 000232   200006 450100                    STZ     I,,AUTO

      314     2210    3            IF FM$CFU.AFIT=0 AND F$DCB.BFR.DA(I)=FM_FRZERO

   2210  1 000233   200005 470500                    LDP0    CFU$,,AUTO
         1 000234   000000 236100                    LDQ     0,,PR0
         1 000235   001000 316003                    CANQ    512,DU
         1 000236   000251 601000 1                  TNZ     s:2212
         1 000237   200004 471500                    LDP1    JDCB$,,AUTO
         1 000240   200006 720100                    LXL0    I,,AUTO
         1 000241   100115 236110                    LDQ     77,X0,PR1
         1 000242   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000243   000000 116000 xsym               CMPQ    FM_FRZERO
         1 000244   000251 601000 1                  TNZ     s:2212

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:61   
      315     2211    3            THEN F$DCB.BFR.DA(I)=FM$CFU.FITSDA;

   2211  1 000245   000000 236100                    LDQ     0,,PR0
         1 000246   100115 676110                    ERQ     77,X0,PR1
         1 000247   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000250   100115 656110                    ERSQ    77,X0,PR1

      316     2212    3            F$DCB.BFR.BUFUP(I)='0'B;

   2212  1 000251   200004 471500                    LDP1    JDCB$,,AUTO
         1 000252   200006 720100                    LXL0    I,,AUTO
         1 000253   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000254   100115 356110                    ANSQ    77,X0,PR1

      317     2213    3            END;

   2213  1 000255   200006 054100                    AOS     I,,AUTO
         1 000256   200006 235100                    LDA     I,,AUTO
         1 000257   000004 115007                    CMPA    4,DL
         1 000260   000233 604400 1                  TMOZ    s:2210

      318     2214    2         FM$CFU.FMOD='0'B;

   2214  1 000261   000003 236000 2                  LDQ     3
         1 000262   000000 356100                    ANSQ    0,,PR0

      319     2215    2         FM$CFU.ALTBLD='0'B;

   2215  1 000263   000004 236000 2                  LDQ     4
         1 000264   000006 356100                    ANSQ    6,,PR0

      320     2216    2         CALL FMI$DSREL;

   2216  1 000265   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000266   000000 701000 xent               TSX1    FMI$DSREL
         1 000267   000000 011000                    NOP     0

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:62   
      321     2217    2         GOTO ENDCLS;

   2217  1 000270   001203 710000 1                  TRA     ENDCLS

      322     2218        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:63   
      323     2219                    /*
      324     2220                    *  SAVE IS SPECIFIED
      325     2221                    */
      326     2222    2   NEWSAVE:
      327     2223    2         CALL FMI$DSREL ALTRET(NEWREL);

   2223  1 000271   000002 631400 xsym  NEWSAVE      EPPR1   B_VECTNIL+2
         1 000272   000000 701000 xent               TSX1    FMI$DSREL
         1 000273   000064 702000 1                  TSX2    NEWREL

      328     2224    2         CALL FMU$BLD; /* BUILD UPPER LVL, IF RREQ'D */

   2224  1 000274   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000275   000000 701000 xent               TSX1    FMU$BLD
         1 000276   000000 011000                    NOP     0

      329     2225    2         IF F$DCB.ACS=%UBLOCK# THEN IF F$DCB.ORG=%CONSEC# AND NOT F$DCB.SPAN

   2225  1 000277   200004 470500                    LDP0    JDCB$,,AUTO
         1 000300   000036 236100                    LDQ     30,,PR0
         1 000301   000777 376007                    ANQ     511,DL
         1 000302   000014 116007                    CMPQ    12,DL
         1 000303   000316 601000 1                  TNZ     s:2227

   2225  1 000304   000032 236100                    LDQ     26,,PR0
         1 000305   777000 376003                    ANQ     -512,DU
         1 000306   001000 116003                    CMPQ    512,DU
         1 000307   000316 601000 1                  TNZ     s:2227
         1 000310   000064 236100                    LDQ     52,,PR0
         1 000311   100000 316007                    CANQ    32768,DL
         1 000312   000316 601000 1                  TNZ     s:2227

      330     2226    2            THEN CALL FMH$UBLKCLS ALTRET(NEWREL);

   2226  1 000313   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000314   000000 701000 xent               TSX1    FMH$UBLKCLS
         1 000315   000064 702000 1                  TSX2    NEWREL
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:64   

      331     2227    2         CALL FMO$MODFIT(MYFPT$);

   2227  1 000316   200016 630500                    EPPR0   MYFPT$,,AUTO
         1 000317   200034 450500                    STP0    MYFPT$+14,,AUTO
         1 000320   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 000321   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000322   000000 701000 xent               TSX1    FMO$MODFIT
         1 000323   000000 011000                    NOP     0

      332     2228                    /*
      333     2229                    *  CATALOG THE FILE
      334     2230                    */
      335     2231    2         IB=B$JIT.ERR;

   2231  1 000324   000000 470400 xsym               LDP0    B$JIT$
         1 000325   000012 236100                    LDQ     10,,PR0
         1 000326   200006 756100                    STQ     I,,AUTO

      336     2232    2         IF FM$CFU.FITSDA~=0 THEN /* UNLESS IT HAS BEEN RENAMED ALREADY */

   2232  1 000327   200005 471500                    LDP1    CFU$,,AUTO
         1 000330   100000 236100                    LDQ     0,,PR1
         1 000331   000032 316000 xsym               CANQ    B_VECTNIL+26
         1 000332   000346 600000 1                  TZE     s:2234

      337     2233    2            CALL FMQ$CTG(ADDR(F$DCB.NAME),SFDA)ALTRET(NEWREL);

   2233  1 000333   200004 236100                    LDQ     JDCB$,,AUTO
         1 000334   000010 036003                    ADLQ    8,DU
         1 000335   200034 756100                    STQ     MYFPT$+14,,AUTO
         1 000336   200010 633500                    EPPR3   SFDA,,AUTO
         1 000337   200037 453500                    STP3    MYFPT$+17,,AUTO
         1 000340   200034 634500                    EPPR4   MYFPT$+14,,AUTO
         1 000341   200036 454500                    STP4    MYFPT$+16,,AUTO
         1 000342   200036 630500                    EPPR0   MYFPT$+16,,AUTO
         1 000343   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:65   
         1 000344   000000 701000 xent               TSX1    FMQ$CTG
         1 000345   000064 702000 1                  TSX2    NEWREL

      338     2234    2         B$JIT.ERR=IB;

   2234  1 000346   200006 236100                    LDQ     I,,AUTO
         1 000347   000000 470400 xsym               LDP0    B$JIT$
         1 000350   000012 756100                    STQ     10,,PR0
         1 000351   001203 710000 1                  TRA     ENDCLS

      339     2235        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:66   
      340     2236    2      CASE(%IN#,%UPDATE#);

      341     2237                    /*
      342     2238                    *  THE FILE IS OPEN IN INPUT OR UPDATE MODE
      343     2239                    *
      344     2240                    *  NOTE THAT THE DCB MAY HAVE BEEN EITHER CREATE,OLDFILE OR
      345     2241                    *  B$JIT.FEXT CONTROLLED.  IN THOSE CASES THE CFU FUNCTION
      346     2242                    *  INDICATES UPDATE MODE EVEN THOUGH THE DCB FUNCTION IS CREATE.
      347     2243                    */
      348     2244    2         IF FPT$CLOSE_V.DISP~=%SCRATCH# THEN GOTO CLSSAVE;

   2244  1 000352   200016 474500                    LDP4    MYFPT$,,AUTO
         1 000353   400000 236100                    LDQ     0,,PR4
         1 000354   000777 376007                    ANQ     511,DL
         1 000355   000001 116007                    CMPQ    1,DL
         1 000356   000727 601000 1                  TNZ     CLSSAVE

   2244  1 000357                       CLSREL       null
      349     2245    2   CLSREL:;
      350     2246    2         CALL FMR$L8;

   2246  1 000357   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000360   000000 701000 xent               TSX1    FMR$L8
         1 000361   000000 011000                    NOP     0

      351     2247    2         IF NOT F$DCB.FFLG.DELF

   2247  1 000362   200004 470500                    LDP0    JDCB$,,AUTO
         1 000363   000004 236100                    LDQ     4,,PR0
         1 000364   020000 316003                    CANQ    8192,DU
         1 000365   000401 600000 1                  TZE     s:2250
         1 000366   200005 471500                    LDP1    CFU$,,AUTO
         1 000367   100000 236100                    LDQ     0,,PR1
         1 000370   700000 376003                    ANQ     -32768,DU
         1 000371   100000 116003                    CMPQ    32768,DU
         1 000372   000376 601000 1                  TNZ     s:2247+12
         1 000373   100003 720100                    LXL0    3,,PR1
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:67   
         1 000374   000002 100003                    CMPX0   2,DU
         1 000375   000401 603000 1                  TRC     s:2250
         1 000376   100000 236100                    LDQ     0,,PR1
         1 000377   010000 316003                    CANQ    4096,DU
         1 000400   000427 600000 1                  TZE     s:2266

      352     2248    2           OR FM$CFU.FUN=%UPDATE# AND FM$CFU.USECNT>1
      353     2249    3           OR FM$CFU.ACFU~=0 THEN DO;

      354     2250    3            CALL FMR$U8;

   2250  1 000401   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000402   000000 701000 xent               TSX1    FMR$U8
         1 000403   000000 011000                    NOP     0

      355     2251    3            IF F$DCB.FFLG.DELF THEN B$JIT.ERR=FMP$E$FILEBUSY;

   2251  1 000404   200004 470500                    LDP0    JDCB$,,AUTO
         1 000405   000004 236100                    LDQ     4,,PR0
         1 000406   020000 316003                    CANQ    8192,DU
         1 000407   000414 600000 1                  TZE     s:2252

   2251  1 000410   000011 236000 0                  LDQ     FMP$E$FILEBUSY
         1 000411   000000 471400 xsym               LDP1    B$JIT$
         1 000412   100012 756100                    STQ     10,,PR1
         1 000413   000426 710000 1                  TRA     s:2264

      356     2252    3            ELSE IF F$DCB.DESC.ARCHIVE THEN B$JIT.ERR=FMP$E$QSTOW;

   2252  1 000414   000005 236100                    LDQ     5,,PR0
         1 000415   001000 316007                    CANQ    512,DL
         1 000416   000423 600000 1                  TZE     s:2258

   2252  1 000417   000006 236000 0                  LDQ     FMP$E$QSTOW
         1 000420   000000 471400 xsym               LDP1    B$JIT$
         1 000421   100012 756100                    STQ     10,,PR1
         1 000422   000426 710000 1                  TRA     s:2264
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:68   

      357     2253                    /*E* ERROR: FMP-E$QSTOW-E
      358     2254                    *    MESSAGE:Cannot delete file% %FN% - it is archived.
      359     2255                    *    MESSAGE1:File% %UF% is archived and so read-only.
      360     2256                    *             You must UNSTOW it to delete it.
      361     2257                    */
      362     2258    3               ELSE B$JIT.ERR=FMP$E$CLSREL;

   2258  1 000423   000004 236000 0                  LDQ     FMP$E$CLSREL
         1 000424   000000 471400 xsym               LDP1    B$JIT$
         1 000425   100012 756100                    STQ     10,,PR1

      363     2259                    /*E* ERROR: FMP-E$CLSREL-E
      364     2260                    *        MESSAGE: You may not delete file %FN
      365     2261                    *        MESSAGE1:File% %UF% may not be deleted,
      366     2262                    *                 because you have no DELF access to it.
      367     2263                    */
      368     2264    3            GOTO CLSSAVE;

   2264  1 000426   000727 710000 1                  TRA     CLSSAVE

      369     2265    3            END;
      370     2266    2         FM$CFU.SHARE=%NONE#;

   2266  1 000427   060000 236003                    LDQ     24576,DU
         1 000430   100000 256100                    ORSQ    0,,PR1

      371     2267    2         CALL FMR$U8;

   2267  1 000431   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000432   000000 701000 xent               TSX1    FMR$U8
         1 000433   000000 011000                    NOP     0

      372     2268    3         IF F$DCB.DESC.QS THEN DO;

   2268  1 000434   200004 470500                    LDP0    JDCB$,,AUTO
         1 000435   000005 236100                    LDQ     5,,PR0
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:69   
         1 000436   010000 316007                    CANQ    4096,DL
         1 000437   000444 600000 1                  TZE     s:2272

      373     2269    3            B$JIT.ERR=FMP$E$QSTOW;

   2269  1 000440   000006 236000 0                  LDQ     FMP$E$QSTOW
         1 000441   000000 471400 xsym               LDP1    B$JIT$
         1 000442   100012 756100                    STQ     10,,PR1

      374     2270    3            GOTO CLSSAVE;

   2270  1 000443   000727 710000 1                  TRA     CLSSAVE

      375     2271    3            END;
      376     2272    2         IF FM$CFUF.ACCNAM=0 THEN GOTO ENDREL; /* ALREADY UNCATALOGUED */

   2272  1 000444   200005 471500                    LDP1    CFU$,,AUTO
         1 000445   100002 235100                    LDA     2,,PR1
         1 000446   000230 600000 1                  TZE     ENDREL

      377     2273    3         IF F$DCB.STARX~=0 THEN DO;

   2273  1 000447   000064 236100                    LDQ     52,,PR0
         1 000450   007000 316007                    CANQ    3584,DL
         1 000451   000460 600000 1                  TZE     s:2277

      378     2274    3            B$JIT.STAR.DA(F$DCB.STARX)=0;

   2274  1 000452   000064 236100                    LDQ     52,,PR0
         1 000453   000011 772000                    QRL     9
         1 000454   000007 376007                    ANQ     7,DL
         1 000455   000000 473400 xsym               LDP3    B$JIT$
         1 000456   300222 450106                    STZ     146,QL,PR3

      379     2275    3            GOTO SETCFUREL;

   2275  1 000457   000626 710000 1                  TRA     SETCFUREL
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:70   

      380     2276    3            END;
      381     2277    2         ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);

   2277  1 000460   100002 220100                    LDX0    2,,PR1
         1 000461   000000 636010                    EAQ     0,X0
         1 000462   000000 036000 xsym               ADLQ    F$CFU$
         1 000463   200013 756100                    STQ     ACCT$,,AUTO

      382     2278    2         IF NOT F$DCB.STARF THEN CALL UQB$MENQX(ACCT$)ALTRET(CLSSAVE);

   2278  1 000464   000064 236100                    LDQ     52,,PR0
         1 000465   200000 316003                    CANQ    65536,DU
         1 000466   000475 601000 1                  TNZ     s:2279

   2278  1 000467   200013 633500                    EPPR3   ACCT$,,AUTO
         1 000470   200034 453500                    STP3    MYFPT$+14,,AUTO
         1 000471   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 000472   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000473   000000 701000 xent               TSX1    UQB$MENQX
         1 000474   000727 702000 1                  TSX2    CLSSAVE

      383     2279    2         SFDA=BITBIN(F$DCB.BFR(1)); /* Save in case the FIT */

   2279  1 000475   200004 470500                    LDP0    JDCB$,,AUTO
         1 000476   000116 235100                    LDA     78,,PR0
         1 000477   200010 755100                    STA     SFDA,,AUTO

      384     2280    2         IB=F$DCB.BFR1(1);

   2280  1 000500   000123 236100                    LDQ     83,,PR0
         1 000501   200006 756100                    STQ     I,,AUTO

      385     2281    2         F$DCB.BFR(1)='0'B;

   2281  1 000502   000116 450100                    STZ     78,,PR0

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:71   
      386     2282    2         F$DCB.BFR1(1)='0'B;

   2282  1 000503   000123 450100                    STZ     83,,PR0

      387     2283    2         CALL FMQ$SRCHFD(ADDR(F$DCB.NAME),KEY$,SEG$,ACCT$,ADDR(NIL))

   2283  1 000504   200004 236100                    LDQ     JDCB$,,AUTO
         1 000505   000010 036003                    ADLQ    8,DU
         1 000506   200034 756100                    STQ     MYFPT$+14,,AUTO
         1 000507   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000510   200035 756100                    STQ     MYFPT$+15,,AUTO
         1 000511   200035 631500                    EPPR1   MYFPT$+15,,AUTO
         1 000512   200042 451500                    STP1    MYFPT$+20,,AUTO
         1 000513   200013 633500                    EPPR3   ACCT$,,AUTO
         1 000514   200041 453500                    STP3    MYFPT$+19,,AUTO
         1 000515   200012 634500                    EPPR4   SEG$,,AUTO
         1 000516   200040 454500                    STP4    MYFPT$+18,,AUTO
         1 000517   200011 635500                    EPPR5   KEY$,,AUTO
         1 000520   200037 455500                    STP5    MYFPT$+17,,AUTO
         1 000521   200034 636500                    EPPR6   MYFPT$+14,,AUTO
         1 000522   200036 456500                    STP6    MYFPT$+16,,AUTO
         1 000523   200036 630500                    EPPR0   MYFPT$+16,,AUTO
         1 000524   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000525   000000 701000 xent               TSX1    FMQ$SRCHFD
         1 000526   000607 702000 1                  TSX2    SCFURELFD

      388     2284    2           ALTRET(SCFURELFD);
      389     2285    2         FM$KEYENT.D='1'B; /* SET KEY DELETED */

   2285  1 000527   200011 470500                    LDP0    KEY$,,AUTO
         1 000530   400000 236003                    LDQ     -131072,DU
         1 000531   000000 256100                    ORSQ    0,,PR0

      390     2286    2         FM$FDSEG='0'B;

   2286  1 000532   200012 470500                    LDP0    SEG$,,AUTO
         1 000533   000000 450100                    STZ     0,,PR0
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:72   

      391     2287    2         FM$FDSEG.DESC.DELF='1'B;

   2287  1 000534   200012 470500                    LDP0    SEG$,,AUTO
         1 000535   000000 256100                    ORSQ    0,,PR0

      392     2288    2         IF B$JIT.PRIV.ACTIVE&%PR_FMEFT# THEN ERRCODE=F$DCB.EXPIRE;

   2288  1 000536   000000 470400 xsym               LDP0    B$JIT$
         1 000537   000013 236100                    LDQ     11,,PR0
         1 000540   000030 376000 xsym               ANQ     B_VECTNIL+24
         1 000541   000546 600000 1                  TZE     s:2289

   2288  1 000542   200004 471500                    LDP1    JDCB$,,AUTO
         1 000543   100035 235100                    LDA     29,,PR1
         1 000544   200014 755100                    STA     ERRCODE,,AUTO
         1 000545   000554 710000 1                  TRA     s:2290

      393     2289    2         ELSE CALL SSS$SYSTIME(ERRCODE);

   2289  1 000546   200014 631500                    EPPR1   ERRCODE,,AUTO
         1 000547   200034 451500                    STP1    MYFPT$+14,,AUTO
         1 000550   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 000551   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000552   000000 701000 xent               TSX1    SSS$SYSTIME
         1 000553   000000 011000                    NOP     0

      394     2290    2         FM$FDSEG.FITSDA=ERRCODE/512;

   2290  1 000554   200014 236100                    LDQ     ERRCODE,,AUTO
         1 000555   000011 772000                    QRL     9
         1 000556   200012 470500                    LDP0    SEG$,,AUTO
         1 000557   000000 552134                    STBQ    0,'34'O,PR0

      395     2291    2         IF F$DCB.STARF THEN CALL FMG$REMKEY;

   2291  1 000560   200004 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:73   
         1 000561   000064 236100                    LDQ     52,,PR0
         1 000562   200000 316003                    CANQ    65536,DU
         1 000563   000570 600000 1                  TZE     s:2292

   2291  1 000564   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000565   000000 701000 xent               TSX1    FMG$REMKEY
         1 000566   000000 011000                    NOP     0
         1 000567   000577 710000 1                  TRA     s:2293

      396     2292    2         ELSE IF NOT FM$CFUA.ACCESS.BUPF THEN CALL FMG$REMKEY;

   2292  1 000570   200013 471500                    LDP1    ACCT$,,AUTO
         1 000571   100005 236100                    LDQ     5,,PR1
         1 000572   040000 316007                    CANQ    16384,DL
         1 000573   000577 601000 1                  TNZ     s:2293

   2292  1 000574   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000575   000000 701000 xent               TSX1    FMG$REMKEY
         1 000576   000000 011000                    NOP     0

      397     2293    2         IF F$DCB.BFR.BUFX(1)~=0 THEN CALL FMD$WRTBUF(1);

   2293  1 000577   200004 470500                    LDP0    JDCB$,,AUTO
         1 000600   000116 236100                    LDQ     78,,PR0
         1 000601   037000 316003                    CANQ    15872,DU
         1 000602   000607 600000 1                  TZE     SCFURELFD

   2293  1 000603   000005 630400 2                  EPPR0   5
         1 000604   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000605   000000 701000 xent               TSX1    FMD$WRTBUF
         1 000606   000000 011000                    NOP     0

      398     2294    2   SCFURELFD: IF NOT F$DCB.STARF THEN CALL UQB$MDEQ(ACCT$);

   2294  1 000607   200004 470500       SCFURELFD    LDP0    JDCB$,,AUTO
         1 000610   000064 236100                    LDQ     52,,PR0
         1 000611   200000 316003                    CANQ    65536,DU
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:74   
         1 000612   000621 601000 1                  TNZ     s:2295

   2294  1 000613   200013 631500                    EPPR1   ACCT$,,AUTO
         1 000614   200034 451500                    STP1    MYFPT$+14,,AUTO
         1 000615   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 000616   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000617   000000 701000 xent               TSX1    UQB$MDEQ
         1 000620   000000 011000                    NOP     0

      399     2295    2         F$DCB.BFR(1)=BINBIT(SFDA,36);

   2295  1 000621   200010 236100                    LDQ     SFDA,,AUTO
         1 000622   200004 470500                    LDP0    JDCB$,,AUTO
         1 000623   000116 756100                    STQ     78,,PR0

      400     2296    2         F$DCB.BFR1(1)=IB;

   2296  1 000624   200006 236100                    LDQ     I,,AUTO
         1 000625   000123 756100                    STQ     83,,PR0

      401     2297    2   SETCFUREL:
      402     2298    2         I=MOD(FM$CFU.UGRANS+FM$CFU.NGAVAL,67108864);

   2298  1 000626   200005 471500       SETCFUREL    LDP1    CFU$,,AUTO
         1 000627   100007 236100                    LDQ     7,,PR1
         1 000630   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000631   200034 756100                    STQ     MYFPT$+14,,AUTO
         1 000632   100004 236100                    LDQ     4,,PR1
         1 000633   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000634   200034 036100                    ADLQ    MYFPT$+14,,AUTO
         1 000635   000006 376000 2                  ANQ     6
         1 000636   200006 756100                    STQ     I,,AUTO

      403     2299    2         CALL FMR$L8;

   2299  1 000637   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000640   000000 701000 xent               TSX1    FMR$L8
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:75   
         1 000641   000000 011000                    NOP     0

      404     2300    2         IF FM$CFU.ACCTX~=0

   2300  1 000642   200005 470500                    LDP0    CFU$,,AUTO
         1 000643   000002 220100                    LDX0    2,,PR0
         1 000644   000714 600000 1                  TZE     s:2312

      405     2301    3         THEN IF FM$CFU.STARX.F=0 THEN DO;

   2301  1 000645   000002 236100                    LDQ     2,,PR0
         1 000646   400000 316003                    CANQ    -131072,DU
         1 000647   000676 601000 1                  TNZ     s:2309

      406     2302    3               IF F$DCB.WSR~=1 AND FM$CFU.ACCTX~=FM_SYSACCTX

   2302  1 000650   200004 471500                    LDP1    JDCB$,,AUTO
         1 000651   100040 236100                    LDQ     32,,PR1
         1 000652   000777 376003                    ANQ     511,DU
         1 000653   000001 116003                    CMPQ    1,DU
         1 000654   000665 600000 1                  TZE     s:2304
         1 000655   000002 236100                    LDQ     2,,PR0
         1 000656   000022 772000                    QRL     18
         1 000657   000000 116000 xsym               CMPQ    FM_SYSACCTX
         1 000660   000665 600000 1                  TZE     s:2304

      407     2303    3               THEN B$JIT.PRDPRM=B$JIT.PRDPRM+I;

   2303  1 000661   000000 473400 xsym               LDP3    B$JIT$
         1 000662   300242 236100                    LDQ     162,,PR3
         1 000663   200006 036100                    ADLQ    I,,AUTO
         1 000664   300242 756100                    STQ     162,,PR3

      408     2304    3               PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GRANS=

   2304  1 000665   000002 220100                    LDX0    2,,PR0
         1 000666   000000 473400 xsym               LDP3    F$CFU$
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:76   
         1 000667   300007 236110                    LDQ     7,X0,PR3
         1 000670   200006 036100                    ADLQ    I,,AUTO
         1 000671   300007 756110                    STQ     7,X0,PR3

      409     2305    3                 PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GRANS+I;
      410     2306    3               PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GMOD=1;

   2306  1 000672   000002 220100                    LDX0    2,,PR0
         1 000673   100000 236003                    LDQ     32768,DU
         1 000674   300005 256110                    ORSQ    5,X0,PR3

      411     2307    3               END;

   2307  1 000675   000714 710000 1                  TRA     s:2312

      412     2308    3            ELSE DO;

      413     2309    3               CALL FMR$UPDGAC(B$JIT.TMPGAC,B$JIT.CURTMPDP);

   2309  1 000676   000000 236000 xsym               LDQ     B$JIT$
         1 000677   000240 036003                    ADLQ    160,DU
         1 000700   200035 756100                    STQ     MYFPT$+15,,AUTO
         1 000701   000000 236000 xsym               LDQ     B$JIT$
         1 000702   000246 036003                    ADLQ    166,DU
         1 000703   200034 756100                    STQ     MYFPT$+14,,AUTO
         1 000704   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 000705   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000706   000000 701000 xent               TSX1    FMR$UPDGAC
         1 000707   000000 011000                    NOP     0

      414     2310    3               B$JIT.CURTMPDP=B$JIT.CURTMPDP-I;

   2310  1 000710   000000 470400 xsym               LDP0    B$JIT$
         1 000711   000240 236100                    LDQ     160,,PR0
         1 000712   200006 136100                    SBLQ    I,,AUTO
         1 000713   000240 756100                    STQ     160,,PR0

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:77   
      415     2311    3               END;

      416     2312    2         CALL FMR$FN(F$DCB.CFU$);

   2312  1 000714   200004 236100                    LDQ     JDCB$,,AUTO
         1 000715   000066 036003                    ADLQ    54,DU
         1 000716   200034 756100                    STQ     MYFPT$+14,,AUTO
         1 000717   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 000720   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000721   000000 701000 xent               TSX1    FMR$FN
         1 000722   000000 011000                    NOP     0

      417     2313    2         CALL FMR$U8;

   2313  1 000723   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000724   000000 701000 xent               TSX1    FMR$U8
         1 000725   000000 011000                    NOP     0

      418     2314    2         GOTO ENDREL;

   2314  1 000726   000230 710000 1                  TRA     ENDREL

      419     2315        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:78   
      420     2316                    /*
      421     2317                    *  SCRATCH IS NOT SPECIFIED
      422     2318                    */
      423     2319    2   CLSSAVE:
      424     2320    2         CALL FMI$DSREL ALTRET(NEWREL);

   2320  1 000727   000002 631400 xsym  CLSSAVE      EPPR1   B_VECTNIL+2
         1 000730   000000 701000 xent               TSX1    FMI$DSREL
         1 000731   000064 702000 1                  TSX2    NEWREL

      425     2321    2         IF B$JIT.PRIV.ACTIVE&%PR_FMEFT# AND FPT$CLOSE_V.EFTOPER

   2321  1 000732   000000 470400 xsym               LDP0    B$JIT$
         1 000733   000013 236100                    LDQ     11,,PR0
         1 000734   000030 376000 xsym               ANQ     B_VECTNIL+24
         1 000735   000742 600000 1                  TZE     s:2321+8
         1 000736   200016 471500                    LDP1    MYFPT$,,AUTO
         1 000737   100000 236100                    LDQ     0,,PR1
         1 000740   076000 316007                    CANQ    31744,DL
         1 000741   000760 601000 1                  TNZ     s:2324
         1 000742   200005 471500                    LDP1    CFU$,,AUTO
         1 000743   100000 236100                    LDQ     0,,PR1
         1 000744   002000 316003                    CANQ    1024,DU
         1 000745   000760 601000 1                  TNZ     s:2324
         1 000746   004000 316003                    CANQ    2048,DU
         1 000747   000760 601000 1                  TNZ     s:2324
         1 000750   100000 236100                    LDQ     0,,PR1
         1 000751   700000 376003                    ANQ     -32768,DU
         1 000752   200000 116003                    CMPQ    65536,DU
         1 000753   001034 600000 1                  TZE     s:2332
         1 000754   200004 473500                    LDP3    JDCB$,,AUTO
         1 000755   300031 236100                    LDQ     25,,PR3
         1 000756   020000 316007                    CANQ    8192,DL
         1 000757   001034 600000 1                  TZE     s:2332

      426     2322    2           OR FM$CFU.SHARED OR FM$CFU.FMOD
      427     2323    3           OR FM$CFU.FUN~=%IN# AND F$DCB.FCD THEN DO;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:79   

      428     2324    3            IB=F$DCB.DESC;

   2324  1 000760   200004 471500                    LDP1    JDCB$,,AUTO
         1 000761   100005 236100                    LDQ     5,,PR1
         1 000762   000022 736000                    QLS     18
         1 000763   200006 756100                    STQ     I,,AUTO

      429     2325    3            IF FPT$CLOSE_V.OPER.REBLD THEN FM$CFU.ULBLD=1;

   2325  1 000764   200016 473500                    LDP3    MYFPT$,,AUTO
         1 000765   300000 236100                    LDQ     0,,PR3
         1 000766   100000 316007                    CANQ    32768,DL
         1 000767   000773 600000 1                  TZE     s:2326

   2325  1 000770   200005 474500                    LDP4    CFU$,,AUTO
         1 000771   000001 236003                    LDQ     1,DU
         1 000772   400006 256100                    ORSQ    6,,PR4

      430     2326    3            IF FPT$CLOSE_V.ALTBLD=%YES# THEN FM$CFU.ALTBLD='1'B;

   2326  1 000773   200016 473500                    LDP3    MYFPT$,,AUTO
         1 000774   300002 236100                    LDQ     2,,PR3
         1 000775   000060 376003                    ANQ     48,DU
         1 000776   000040 116003                    CMPQ    32,DU
         1 000777   001003 601000 1                  TNZ     s:2327

   2326  1 001000   200005 474500                    LDP4    CFU$,,AUTO
         1 001001   000004 236003                    LDQ     4,DU
         1 001002   400006 256100                    ORSQ    6,,PR4

      431     2327    3            CALL FMU$BLD;

   2327  1 001003   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001004   000000 701000 xent               TSX1    FMU$BLD
         1 001005   000000 011000                    NOP     0

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:80   
      432     2328    3            CALL FMO$MODFIT(MYFPT$);

   2328  1 001006   200016 630500                    EPPR0   MYFPT$,,AUTO
         1 001007   200034 450500                    STP0    MYFPT$+14,,AUTO
         1 001010   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 001011   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001012   000000 701000 xent               TSX1    FMO$MODFIT
         1 001013   000000 011000                    NOP     0

      433     2329    3            IF (IB\F$DCB.DESC)&'777'O AND FM$CFUF.ACCNAM~=0

   2329  1 001014   200004 470500                    LDP0    JDCB$,,AUTO
         1 001015   000005 236100                    LDQ     5,,PR0
         1 001016   000022 736000                    QLS     18
         1 001017   200006 676100                    ERQ     I,,AUTO
         1 001020   777000 376003                    ANQ     -512,DU
         1 001021   001203 600000 1                  TZE     ENDCLS
         1 001022   200005 471500                    LDP1    CFU$,,AUTO
         1 001023   100002 235100                    LDA     2,,PR1
         1 001024   001203 600000 1                  TZE     ENDCLS
         1 001025   100000 236100                    LDQ     0,,PR1
         1 001026   000032 316000 xsym               CANQ    B_VECTNIL+26
         1 001027   001203 600000 1                  TZE     ENDCLS

      434     2330    3              AND FM$CFU.FITSDA~=0 THEN CALL FMP$UPFDDESC;

   2330  1 001030   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001031   000000 701000 xent               TSX1    FMP$UPFDDESC
         1 001032   000000 011000                    NOP     0

      435     2331    3            END;

   2331  1 001033   001203 710000 1                  TRA     ENDCLS

      436     2332    2         ELSE IF F$DCB.FUN~=%IN#

   2332  1 001034   200004 473500                    LDP3    JDCB$,,AUTO
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:81   
         1 001035   300032 236100                    LDQ     26,,PR3
         1 001036   000777 376003                    ANQ     511,DU
         1 001037   000002 116003                    CMPQ    2,DU
         1 001040   001203 600000 1                  TZE     ENDCLS

      437     2333    2            THEN IF FPT$CLOSE_V.OPER.CHGATT

   2333  1 001041   200016 474500                    LDP4    MYFPT$,,AUTO
         1 001042   400000 236100                    LDQ     0,,PR4
         1 001043   400000 316007                    CANQ    -131072,DL
         1 001044   001073 600000 1                  TZE     s:2340

      438     2334    2               THEN IF FPT$.NAME_~=ADDR(NIL)

   2334  1 001045   200003 475500                    LDP5    @FPT$,,AUTO
         1 001046   500003 236100                    LDQ     3,,PR5
         1 001047   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001050   001054 601000 1                  TNZ     s:2335
         1 001051   500004 236100                    LDQ     4,,PR5
         1 001052   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001053   001057 600000 1                  TZE     s:2336

      439     2335    2                    OR FPT$.PASS_~=ADDR(NIL) THEN B$JIT.ERR=FMP$E$RENAME;

   2335  1 001054   000007 236000 0                  LDQ     FMP$E$RENAME
         1 001055   000012 756100                    STQ     10,,PR0
         1 001056   001203 710000 1                  TRA     ENDCLS

      440     2336    2                  ELSE IF FPT$.ACCESS_~=ADDR(NIL)

   2336  1 001057   500005 236100                    LDQ     5,,PR5
         1 001060   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001061   001065 601000 1                  TNZ     s:2338
         1 001062   500006 236100                    LDQ     6,,PR5
         1 001063   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001064   001070 600000 1                  TZE     s:2339

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:82   
      441     2337    2                       OR FPT$.ACSVEH_~=ADDR(NIL)
      442     2338    2                     THEN B$JIT.ERR=FMO$E$CLSREL;

   2338  1 001065   000005 236000 0                  LDQ     FMO$E$CLSREL
         1 001066   000012 756100                    STQ     10,,PR0
         1 001067   001203 710000 1                  TRA     ENDCLS

      443     2339    2                     ELSE B$JIT.ERR=FMP$E$REATTR;

   2339  1 001070   000010 236000 0                  LDQ     FMP$E$REATTR
         1 001071   000012 756100                    STQ     10,,PR0
         1 001072   001203 710000 1                  TRA     ENDCLS

      444     2340    2               ELSE IF FPT$CLOSE_V.OPER.RELG THEN B$JIT.ERR=FMO$E$CLSREL;

   2340  1 001073   200000 316007                    CANQ    65536,DL
         1 001074   001203 600000 1                  TZE     ENDCLS

   2340  1 001075   000005 236000 0                  LDQ     FMO$E$CLSREL
         1 001076   000012 756100                    STQ     10,,PR0
         1 001077   001203 710000 1                  TRA     ENDCLS

      445     2341        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:83   
      446     2342    2      CASE(%JRNL#);

      447     2343    3         IF F$DCB.OWNER THEN DO;

   2343  1 001100   100064 236100                    LDQ     52,,PR1
         1 001101   040000 316007                    CANQ    16384,DL
         1 001102   001177 600000 1                  TZE     s:2364

      448     2344    4            IF F$DCB.ASN~=%FILE# THEN DO;

   2344  1 001103   100032 236100                    LDQ     26,,PR1
         1 001104   777000 376007                    ANQ     -512,DL
         1 001105   001000 116007                    CMPQ    512,DL
         1 001106   001157 600000 1                  TZE     s:2359

      449     2345    4               FM$CFU.LDA=FM_FRZERO;

   2345  1 001107   000100 101400                    MRL     fill='000'O
         1 001110   000000 000004 xsym               ADSC9   FM_FRZERO                cn=0,n=4
         1 001111   300006 400003                    ADSC9   6,,PR3                   cn=2,n=3

      450     2346                    /* CLEAN UP THE TAPE STUFF IN THE CFU */
      451     2347    4               FM$CFUJ.UPD='0'B;

   2347  1 001112   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 001113   300005 356100                    ANSQ    5,,PR3

      452     2348    4               FM$CFU.NGAVAL=0;

   2348  1 001114   000000 236003                    LDQ     0,DU
         1 001115   300007 552134                    STBQ    7,'34'O,PR3

      453     2349    4               FM$CFUJ.BLKLEN=0;

   2349  1 001116   000000 220003                    LDX0    0,DU
         1 001117   300006 740100                    STX0    6,,PR3

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:84   
      454     2350    4               FM$CFU.RCSZ=0;

   2350  1 001120   300004 552140                    STBQ    4,'40'O,PR3

      455     2351    4               FM$CFU.UGRANS=1;

   2351  1 001121   000001 236007                    LDQ     1,DL
         1 001122   300004 552134                    STBQ    4,'34'O,PR3

      456     2352    4               F$DCB.IASN=%FILE#;

   2352  1 001123   100103 552104                    STBQ    67,'04'O,PR1

      457     2353    4               IF F$DCB.STARF OR FM$CFU.ACCTX=0 THEN F$DCB.SETX=FM_SYSSETX;

   2353  1 001124   100064 236100                    LDQ     52,,PR1
         1 001125   200000 316003                    CANQ    65536,DU
         1 001126   001131 601000 1                  TNZ     s:2353+5
         1 001127   300002 221100                    LDX1    2,,PR3
         1 001130   001134 601000 1                  TNZ     s:2354

   2353  1 001131   000000 721000 xsym               LXL1    FM_SYSSETX
         1 001132   100051 441100                    SXL1    41,,PR1
         1 001133   001137 710000 1                  TRA     s:2355

      458     2354    4               ELSE F$DCB.SETX=PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.SETX;

   2354  1 001134   000000 474400 xsym               LDP4    F$CFU$
         1 001135   400000 222111                    LDX2    0,X1,PR4
         1 001136   100051 442100                    SXL2    41,,PR1

      459     2355    4               F$DCB.PSN=FM$SET.PSN(F$DCB.SETX);

   2355  1 001137   100051 236100                    LDQ     41,,PR1
         1 001140   000003 736000                    QLS     3
         1 001141   000007 376000 2                  ANQ     7
         1 001142   000002 736000                    QLS     2
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:85   
         1 001143   000000 474400 xsym               LDP4    F$CFU$
         1 001144   040100 100506                    MLR     fill='040'O
         1 001145   400000 400006                    ADSC9   0,Q,PR4                  cn=2,n=6
         1 001146   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6

      460     2356    4               CALL FMD$RELBUF(1);

   2356  1 001147   000005 630400 2                  EPPR0   5
         1 001150   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001151   000000 701000 xent               TSX1    FMD$RELBUF
         1 001152   000000 011000                    NOP     0

      461     2357    4               IF B$JIT.SYSID~=JG_JAYS# THEN GOTO NEWREL;

   2357  1 001153   000000 470400 xsym               LDP0    B$JIT$
         1 001154   000000 720100                    LXL0    0,,PR0
         1 001155   000015 100003                    CMPX0   13,DU
         1 001156   000064 601000 1                  TNZ     NEWREL

      462     2358    4               END;

      463     2359    3            CALL FMO$MODFIT(MYFPT$);

   2359  1 001157   200016 631500                    EPPR1   MYFPT$,,AUTO
         1 001160   200034 451500                    STP1    MYFPT$+14,,AUTO
         1 001161   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 001162   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001163   000000 701000 xent               TSX1    FMO$MODFIT
         1 001164   000000 011000                    NOP     0

      464     2360    3            CALL FMH$JRELPG(1);

   2360  1 001165   000005 630400 2                  EPPR0   5
         1 001166   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001167   000000 701000 xent               TSX1    FMH$JRELPG
         1 001170   000000 011000                    NOP     0

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:86   
      465     2361    3            FM$CFUJ.USER=0; /* FIX THE CFU TO ALLOW A NEW OWNER */

   2361  1 001171   200005 470500                    LDP0    CFU$,,AUTO
         1 001172   000000 236003                    LDQ     0,DU
         1 001173   000005 552120                    STBQ    5,'20'O,PR0

      466     2362    3            FM$CFUJ.ERR_WAIT='0'B;

   2362  1 001174   000010 236000 2                  LDQ     8
         1 001175   000005 356100                    ANSQ    5,,PR0

      467     2363    3            END;

   2363  1 001176   001203 710000 1                  TRA     ENDCLS

      468     2364    2         ELSE CALL FMD$RELBUF(1);

   2364  1 001177   000005 630400 2                  EPPR0   5
         1 001200   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001201   000000 701000 xent               TSX1    FMD$RELBUF
         1 001202   000000 011000                    NOP     0

      469     2365        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:87   
      470     2366    2      END;     /* OF DO CASE ON CFU.FUN */

      471     2367                    /*
      472     2368                    *  ALL CLOSES ENTER HERE TO FLUSH BUFFERS, PURGE READ AHEAD,
      473     2369                    *  AND RELEASE CFU BLOCKS.
      474     2370                    */
      475     2371    1   ENDCLS:
      476     2372    2      DO I=0 TO 4;

   2372  1 001203   200006 450100       ENDCLS       STZ     I,,AUTO

      477     2373    2         IF F$DCB.BFR.BUFUP(I) THEN CALL FMD$FLSHBUF(I);

   2373  1 001204   200004 470500                    LDP0    JDCB$,,AUTO
         1 001205   200006 720100                    LXL0    I,,AUTO
         1 001206   000115 234110                    SZN     77,X0,PR0
         1 001207   001216 605000 1                  TPL     s:2374

   2373  1 001210   200006 631500                    EPPR1   I,,AUTO
         1 001211   200034 451500                    STP1    MYFPT$+14,,AUTO
         1 001212   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 001213   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001214   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 001215   000000 011000                    NOP     0

      478     2374    2         END;

   2374  1 001216   200006 054100                    AOS     I,,AUTO
         1 001217   200006 235100                    LDA     I,,AUTO
         1 001220   000004 115007                    CMPA    4,DL
         1 001221   001204 604400 1                  TMOZ    s:2373

      479     2375    1      IF F$DCB.ALTKEYX~=0 AND FPT$CLOSE_V.ALTBLD THEN

   2375  1 001222   200004 470500                    LDP0    JDCB$,,AUTO
         1 001223   000052 720100                    LXL0    42,,PR0
         1 001224   001237 600000 1                  TZE     s:2377
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:88   
         1 001225   200016 471500                    LDP1    MYFPT$,,AUTO
         1 001226   100002 236100                    LDQ     2,,PR1
         1 001227   000060 316003                    CANQ    48,DU
         1 001230   001237 600000 1                  TZE     s:2377

      480     2376    1         CALL FMU$ALTBLD(MYFPT$);

   2376  1 001231   200016 633500                    EPPR3   MYFPT$,,AUTO
         1 001232   200034 453500                    STP3    MYFPT$+14,,AUTO
         1 001233   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 001234   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001235   000000 701000 xent               TSX1    FMU$ALTBLD
         1 001236   000000 011000                    NOP     0

      481     2377    1      CALL FMP$RELCFUS(F$DCB.CFU$);

   2377  1 001237   200004 236100                    LDQ     JDCB$,,AUTO
         1 001240   000066 036003                    ADLQ    54,DU
         1 001241   200034 756100                    STQ     MYFPT$+14,,AUTO
         1 001242   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 001243   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001244   000000 701000 xent               TSX1    FMP$RELCFUS
         1 001245   000000 011000                    NOP     0

      482     2378    2      DO I=0 TO 4;

   2378  1 001246   200006 450100                    STZ     I,,AUTO

      483     2379    2         IF F$DCB.BFR.BUFX(I)~=0 THEN CALL FMD$FLSHBUF(I);

   2379  1 001247   200004 470500                    LDP0    JDCB$,,AUTO
         1 001250   200006 720100                    LXL0    I,,AUTO
         1 001251   000115 236110                    LDQ     77,X0,PR0
         1 001252   037000 316003                    CANQ    15872,DU
         1 001253   001262 600000 1                  TZE     s:2380

   2379  1 001254   200006 631500                    EPPR1   I,,AUTO
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:89   
         1 001255   200034 451500                    STP1    MYFPT$+14,,AUTO
         1 001256   200034 630500                    EPPR0   MYFPT$+14,,AUTO
         1 001257   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001260   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 001261   000000 011000                    NOP     0

      484     2380    2         END;

   2380  1 001262   200006 054100                    AOS     I,,AUTO
         1 001263   200006 235100                    LDA     I,,AUTO
         1 001264   000004 115007                    CMPA    4,DL
         1 001265   001247 604400 1                  TMOZ    s:2379

      485     2381                    /*
      486     2382                    *  SET THE DCB CLOSED IN CASE THIS WAS A CALL FROM THE SYSTEM RATHER
      487     2383                    *  THAN A PMME REQUEST.
      488     2384                    */
      489     2385    1      F$DCB.FCD='0'B;

   2385  1 001266   200004 470500                    LDP0    JDCB$,,AUTO
         1 001267   000011 236000 2                  LDQ     9
         1 001270   000031 356100                    ANSQ    25,,PR0

      490     2386    1      F$DCB.FCI='1'B;

   2386  1 001271   040000 236007                    LDQ     16384,DL
         1 001272   000031 256100                    ORSQ    25,,PR0

      491     2387    1      RETURN;

   2387  1 001273   000000 702200 xent               TSX2  ! X66_ARET

      492     2388        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:90   
      493     2389                    /*F*     NAME: FMP$CLSTAR
      494     2390                    *        PURPOSE: To close a DCB which may be open only to
      495     2391                    *        a file in input mode.
      496     2392                    *        DESCRIPTION: RETURNs if the parameter DCB is not open,
      497     2393                    *        otherwise closes it.
      498     2394                    */
      499     2395    1   FMP$CLSTAR:ENTRY;

   2395  1 001274   000000 700200 xent  FMP$CLSTAR   TSX0  ! X66_AUTO_1
         1 001275   000044 000001                    ZERO    36,1

      500     2396    1      JDCB$=B$JIT.DCB$;

   2396  1 001276   000000 470400 xsym               LDP0    B$JIT$
         1 001277   000232 236100                    LDQ     154,,PR0
         1 001300   200004 756100                    STQ     JDCB$,,AUTO

      501     2397    1      IF NOT F$DCB.FCD THEN RETURN;

   2397  1 001301   200004 471500                    LDP1    JDCB$,,AUTO
         1 001302   100031 236100                    LDQ     25,,PR1
         1 001303   020000 316007                    CANQ    8192,DL
         1 001304   001306 601000 1                  TNZ     s:2398

   2397  1 001305   000000 702200 xent               TSX2  ! X66_ARET

      502     2398    1      MYFPT$.V_ = ADDR(ZERO);

   2398  1 001306   000001 236000 2                  LDQ     1
         1 001307   200016 756100                    STQ     MYFPT$,,AUTO

      503     2399    1      CFU$=F$DCB.CFU$;

   2399  1 001310   100066 236100                    LDQ     54,,PR1
         1 001311   200005 756100                    STQ     CFU$,,AUTO

      504     2400    1      GOTO ENDCLS;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:91   

   2400  1 001312   001203 710000 1                  TRA     ENDCLS

      505     2401        %EJECT;
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:92   
      506     2402                    /*F*
      507     2403                    *     NAME:   FMP$CLSREL
      508     2404                    *
      509     2405                    *     PURPOSE:  TO CLOSE AND RELEASE A FILE.  FMP$CLSREL IS
      510     2406                    *               CALLED BY OPEN WHEN 'DELETE' IS SPECIFIED.
      511     2407                    *
      512     2408                    *     DESCRIPTION:  FMP$CLSREL IS CALLED BY FMN$OPNF WHEN THE
      513     2409                    *             DELETE OPTION IS SPECIFIED ON OPEN, AND THE
      514     2410                    *             CALLER HAS OBTAINED THE PRIVILEGE TO OPEN THE
      515     2411                    *             FILE.  THE DELETE PRIVILEGE IS CHECKED HERE.
      516     2412                    *
      517     2413                    */
      518     2414    1   FMP$CLSREL: ENTRY;

   2414  1 001313   000000 700200 xent  FMP$CLSREL   TSX0  ! X66_AUTO_1
         1 001314   000044 000001                    ZERO    36,1

      519     2415    1      JDCB$=B$JIT.DCB$;

   2415  1 001315   000000 470400 xsym               LDP0    B$JIT$
         1 001316   000232 236100                    LDQ     154,,PR0
         1 001317   200004 756100                    STQ     JDCB$,,AUTO

      520     2416    1      MYFPT$.V_=ADDR(ZERO);

   2416  1 001320   000001 236000 2                  LDQ     1
         1 001321   200016 756100                    STQ     MYFPT$,,AUTO

      521     2417    1      CFU$=F$DCB.CFU$;

   2417  1 001322   200004 471500                    LDP1    JDCB$,,AUTO
         1 001323   100066 236100                    LDQ     54,,PR1
         1 001324   200005 756100                    STQ     CFU$,,AUTO

      522     2418    1      GOTO CLSREL;

   2418  1 001325   000357 710000 1                  TRA     CLSREL
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:93   

ZERO
 Sect OctLoc
   0     000   000000 000000   000000 000000   000000 000000   000000 000000    ................

FMP$E$CLSREL
 Sect OctLoc
   0     004   061520 002332                                                    1...

FMO$E$CLSREL
 Sect OctLoc
   0     005   061517 002332                                                    1...

FMP$E$QSTOW
 Sect OctLoc
   0     006   061520 001632                                                    1...

FMP$E$RENAME
 Sect OctLoc
   0     007   061520 001672                                                    1...

FMP$E$REATTR
 Sect OctLoc
   0     010   061520 001662                                                    1...

FMP$E$FILEBUSY
 Sect OctLoc
   0     011   061520 001552                                                    1...

(unnamed)
 Sect OctLoc
   2     000   777777 777757   000000 006000   767777 777777   773777 777777    ................
   2     004   777773 777777   000003 006000   000377 777777   000007 777770    ................
   2     010   577777 777777   777777 757777                                    ........
      523     2419    1   END FMP$CLSF;
      524     2420        %EOD;

PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:94   
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FMP$CLSF.
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:95   

 **** Variables and constants ****

  ****  Section 000 RoData FMP$CLSF

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/b STRC        r     1 FMO$E$CLSREL               4-0-0/b STRC        r     1 FMP$E$CLSREL
    11-0-0/b STRC        r     1 FMP$E$FILEBUSY             6-0-0/b STRC        r     1 FMP$E$QSTOW
    10-0-0/b STRC        r     1 FMP$E$REATTR               7-0-0/b STRC        r     1 FMP$E$RENAME
     0-0-0/w UBIN        r     1 ZERO(0:3)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FPT$                     13-0-0/w PTR         r     1 ACCT$
     5-0-0/w PTR         r     1 CFU$                      14-0-0/w UBIN        r     1 ERRCODE
    *0-0-0/w STRC(504)   r     1 FPT$                       6-0-0/w SBIN        r     1 I
     6-0-0/w BIT         r     1 IB                         4-0-0/w PTR         r     1 JDCB$
    11-0-0/w PTR         r     1 KEY$                      16-0-0/w STRC(504)   r     1 MYFPT$
    12-0-0/w PTR         r     1 SEG$                      10-0-0/w SBIN        r     1 SFDA

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w UBIN        r     1 FM_FRZERO                  0-0-0/w SBIN        r     1 FM_SYSACCTX
     0-0-0/w UBIN        r     1 FM_SYSSETX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:96   

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU                     0-0-0/w STRC(288)   r     1 FM$CFUA
     0-0-0/w STRC(288)   r     1 FM$CFUF                    0-0-0/w STRC(288)   r     1 FM$CFUJ
     0-0-0/w STRC        r     1 FM$FDSEG                   0-0-0/w ASTR(9)     r     1 FM$KEYENT
     0-0-0/w STRC(288)   r     1 FM$SET(0:0)                0-0-0/d STRC(144)   r     1 FPT$CLOSE_V


   Procedure FMP$CLSF requires 726 words for executable code.
   Procedure FMP$CLSF requires 36 words of local(AUTO) storage.
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:97   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:98   
          MINI XREF LISTING

ACCT$
        52**DCL      1756--IMP-PTR  2277<<ASSIGN   2278<>CALL     2283<>CALL     2292>>IF       2294<>CALL
B$JIT.CURTMPDP
       582**DCL      2204<>CALL     2205<<ASSIGN   2205>>ASSIGN   2309<>CALL     2310<<ASSIGN   2310>>ASSIGN
B$JIT.DCB$
       581**DCL      2164>>IF       2165>>ASSIGN   2171>>ASSIGN   2396>>ASSIGN   2415>>ASSIGN
B$JIT.ERR
       491**DCL      2231>>ASSIGN   2234<<ASSIGN   2251<<ASSIGN   2252<<ASSIGN   2258<<ASSIGN   2269<<ASSIGN
      2335<<ASSIGN   2338<<ASSIGN   2339<<ASSIGN   2340<<ASSIGN
B$JIT.ERR.MID
       492**DCL       492--REDEF
B$JIT.FEXT
       581**DCL      2181<<ASSIGN
B$JIT.PRDPRM
       582**DCL      2200<<ASSIGN   2200>>ASSIGN   2303<<ASSIGN   2303>>ASSIGN
B$JIT.PRIV.ACTIVE
       492**DCL      2288>>IF       2321>>IF
B$JIT.STAR.DA
       581**DCL      2274<<ASSIGN
B$JIT.SYSID
       491**DCL      2357>>IF
B$JIT.TMPGAC
       582**DCL      2204<>CALL     2309<>CALL
B$JIT$
        60**DCL       486--IMP-PTR  2164>>IF       2165>>ASSIGN   2171>>ASSIGN   2181>>ASSIGN   2200>>ASSIGN
      2200>>ASSIGN   2204>>CALL     2204>>CALL     2205>>ASSIGN   2205>>ASSIGN   2231>>ASSIGN   2234>>ASSIGN
      2251>>ASSIGN   2252>>ASSIGN   2258>>ASSIGN   2269>>ASSIGN   2274>>ASSIGN   2288>>IF       2303>>ASSIGN
      2303>>ASSIGN   2309>>CALL     2309>>CALL     2310>>ASSIGN   2310>>ASSIGN   2321>>IF       2335>>ASSIGN
      2338>>ASSIGN   2339>>ASSIGN   2340>>ASSIGN   2357>>IF       2396>>ASSIGN   2415>>ASSIGN
CFU$
        45**DCL      1750--IMP-PTR  1762--IMP-PTR  1765--IMP-PTR  2172<<ASSIGN   2176>>IF       2177>>DOCASE
      2181>>IF       2182>>IF       2183>>ASSIGN   2184>>ASSIGN   2184>>ASSIGN   2185>>CALL     2188>>ASSIGN
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:99   
      2190>>ASSIGN   2194>>IF       2196>>ASSIGN   2196>>ASSIGN   2198>>ASSIGN   2199>>IF       2208>>ASSIGN
      2210>>IF       2211>>ASSIGN   2214>>ASSIGN   2215>>ASSIGN   2232>>IF       2247>>IF       2247>>IF
      2247>>IF       2266>>ASSIGN   2272>>IF       2277>>ASSIGN   2298>>ASSIGN   2298>>ASSIGN   2300>>IF
      2301>>IF       2302>>IF       2304>>ASSIGN   2304>>ASSIGN   2306>>ASSIGN   2321>>IF       2321>>IF
      2321>>IF       2325>>ASSIGN   2326>>ASSIGN   2329>>IF       2329>>IF       2345>>ASSIGN   2347>>ASSIGN
      2348>>ASSIGN   2349>>ASSIGN   2350>>ASSIGN   2351>>ASSIGN   2353>>IF       2354>>ASSIGN   2361>>ASSIGN
      2362>>ASSIGN   2399<<ASSIGN   2417<<ASSIGN
CLSREL
      2244**LABEL    2418--GOTO
CLSSAVE
      2320**LABEL    2244--GOTO     2264--GOTO     2270--GOTO     2278--CALLALT
ENDCLS
      2372**LABEL    2217--GOTO     2400--GOTO
ENDREL
      2204**LABEL    2272--GOTO     2314--GOTO
ERRCODE
        53**DCL      2288<<ASSIGN   2289<>CALL     2290>>ASSIGN
F$CFU$
        61**DCL      1777--IMP-PTR  2183>>ASSIGN   2184>>ASSIGN   2185>>CALL     2196>>ASSIGN   2196>>ASSIGN
      2198>>ASSIGN   2277>>ASSIGN   2304>>ASSIGN   2304>>ASSIGN   2306>>ASSIGN   2354>>ASSIGN   2355>>ASSIGN
F$DCB.ACS
       132**DCL      2225>>IF
F$DCB.ACTPOS
       140**DCL       140--REDEF
F$DCB.ALTKEYX
       138**DCL      2375>>IF
F$DCB.ARS
       115**DCL       115--REDEF
F$DCB.ASN
       130**DCL      2344>>IF
F$DCB.ATTR
       133**DCL       134--REDEF
F$DCB.BFR
       159**DCL      2279>>ASSIGN   2281<<ASSIGN   2295<<ASSIGN
F$DCB.BFR.BUFUP
       159**DCL      2212<<ASSIGN   2373>>IF
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:100  
F$DCB.BFR.BUFX
       160**DCL      2293>>IF       2379>>IF
F$DCB.BFR.DA
       160**DCL      2210>>IF       2211<<ASSIGN
F$DCB.BFR1
       160**DCL      2280>>ASSIGN   2282<<ASSIGN   2296<<ASSIGN
F$DCB.BORROW
       148**DCL       148--REDEF     148--REDEF     148--REDEF    2193>>IF       2196>>ASSIGN   2200>>ASSIGN
      2205>>ASSIGN
F$DCB.CFU$
       149**DCL      2172>>ASSIGN   2189<>CALL     2312<>CALL     2377<>CALL     2399>>ASSIGN   2417>>ASSIGN
F$DCB.DCBNAME.L
       162**DCL       162--IMP-SIZ
F$DCB.DESC
       122**DCL      2324>>ASSIGN   2329>>IF
F$DCB.DESC.ARCHIVE
       123**DCL      2252>>IF
F$DCB.DESC.QS
       123**DCL      2268>>IF
F$DCB.EOMCHAR
       119**DCL       119--REDEF
F$DCB.EXPIRE
       131**DCL      2288>>ASSIGN
F$DCB.FCD
       128**DCL      2164>>IF       2321>>IF       2385<<ASSIGN   2397>>IF
F$DCB.FCI
       128**DCL      2386<<ASSIGN
F$DCB.FEXTX
       131**DCL      2181>>ASSIGN
F$DCB.FFLG.DELF
       120**DCL      2247>>IF       2251>>IF
F$DCB.FLDID
       143**DCL       143--REDEF
F$DCB.FORM$
       137**DCL       137--REDEF
F$DCB.FSECT
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:101  
       153**DCL       153--REDEF
F$DCB.FSN
       130**DCL       130--REDEF     130--REDEF     131--REDEF
F$DCB.FUN
       129**DCL      2332>>IF
F$DCB.HEADER$
       136**DCL       136--REDEF
F$DCB.IASN
       156**DCL      2352<<ASSIGN
F$DCB.IXTNSIZE
       134**DCL       134--REDEF
F$DCB.LASTSTA$
       124**DCL       124--REDEF
F$DCB.LVL
       149**DCL       149--REDEF
F$DCB.NAME
       124**DCL      2233--CALL     2283--CALL
F$DCB.NAME.C
       124**DCL       124--REDEF
F$DCB.NOEOF
       145**DCL       145--REDEF
F$DCB.NRECS
       135**DCL       135--REDEF
F$DCB.NRECX
       154**DCL       154--REDEF
F$DCB.OHDR
       146**DCL       146--REDEF
F$DCB.ORG
       129**DCL       129--REDEF    2225>>IF
F$DCB.OWNER
       146**DCL      2343>>IF
F$DCB.PRECNO
       152**DCL       152--REDEF
F$DCB.PSN
       125**DCL      2355<<ASSIGN
F$DCB.RCSZ
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:102  
       157**DCL       157--REDEF
F$DCB.RES
       125**DCL       125--REDEF
F$DCB.SETX
       137**DCL       137--REDEF    2353<<ASSIGN   2354<<ASSIGN   2355>>ASSIGN
F$DCB.SPAN
       146**DCL      2225>>IF
F$DCB.STARF
       144**DCL      2278>>IF       2291>>IF       2294>>IF       2353>>IF
F$DCB.STARX
       146**DCL      2273>>IF       2274>>ASSIGN
F$DCB.TAB$
       136**DCL       137--REDEF
F$DCB.TDA
       151**DCL       151--REDEF
F$DCB.WAIT
       147**DCL      2165<<ASSIGN
F$DCB.WSN
       126**DCL       126--REDEF
F$DCB.WSR
       132**DCL      2199>>IF       2302>>IF
FM$CFU.ACCTX
      1751**DCL      1751--REDEF    2182>>IF       2184<<ASSIGN   2184>>ASSIGN   2188>>ASSIGN   2190<<ASSIGN
      2196>>ASSIGN   2196>>ASSIGN   2198>>ASSIGN   2199>>IF       2277>>ASSIGN   2300>>IF       2302>>IF
      2304>>ASSIGN   2304>>ASSIGN   2306>>ASSIGN   2353>>IF       2354>>ASSIGN
FM$CFU.ACFU
      1750**DCL      2183<<ASSIGN   2247>>IF
FM$CFU.AFIT
      1750**DCL      2210>>IF
FM$CFU.ALTBLD
      1753**DCL      2215<<ASSIGN   2326<<ASSIGN
FM$CFU.FITSDA
      1751**DCL      2211>>ASSIGN   2232>>IF       2329>>IF
FM$CFU.FMOD
      1750**DCL      2214<<ASSIGN   2321>>IF
FM$CFU.FUN
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:103  
      1750**DCL      2177>>DOCASE   2247>>IF       2321>>IF
FM$CFU.LDA
      1753**DCL      2345<<ASSIGN
FM$CFU.NAMEX
      1751**DCL      2181>>IF       2183>>ASSIGN   2184>>ASSIGN   2185>>CALL
FM$CFU.NGAVAL
      1753**DCL      2298>>ASSIGN   2348<<ASSIGN
FM$CFU.RCSZ
      1752**DCL      2350<<ASSIGN
FM$CFU.SHARE
      1750**DCL      2266<<ASSIGN
FM$CFU.SHARED
      1750**DCL      2321>>IF
FM$CFU.STARX.F
      1751**DCL      2194>>IF       2301>>IF
FM$CFU.UGRANS
      1752**DCL      2298>>ASSIGN   2351<<ASSIGN
FM$CFU.ULBLD
      1753**DCL      2325<<ASSIGN
FM$CFU.USECNT
      1752**DCL      2247>>IF
FM$CFUA.ACCESS.BUPF
      1758**DCL      2292>>IF
FM$CFUA.GMOD
      1757**DCL      2198<<ASSIGN   2306<<ASSIGN
FM$CFUA.GRANS
      1759**DCL      2196<<ASSIGN   2196>>ASSIGN   2304<<ASSIGN   2304>>ASSIGN
FM$CFUA.SETX
      1756**DCL      2354>>ASSIGN
FM$CFUF.ACCNAM
      1762**DCL      2176>>IF       2208<<ASSIGN   2272>>IF       2329>>IF
FM$CFUJ.BLKLEN
      1766**DCL      2349<<ASSIGN
FM$CFUJ.ERR_WAIT
      1766**DCL      2362<<ASSIGN
FM$CFUJ.UPD
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:104  
      1765**DCL      2347<<ASSIGN
FM$CFUJ.USER
      1766**DCL      2361<<ASSIGN
FM$FDSEG
      1770**DCL      2286<<ASSIGN
FM$FDSEG.DESC.DELF
      1770**DCL      2287<<ASSIGN
FM$FDSEG.FITSDA
      1771**DCL      2290<<ASSIGN
FM$KEYENT.D
      1774**DCL      2285<<ASSIGN
FM$KEYENT.KLB
      1774**DCL      1774--IMP-SIZ
FM$SET.PSN
      1777**DCL      2355>>ASSIGN
FM$SET.USERLIST
      1778**DCL      1778--REDEF
FMB$IOSPIN
      2137**DCL-ENT  2166--CALL
FMD$FLSHBUF
      2138**DCL-ENT  2373--CALL     2379--CALL
FMD$RELBUF
      2139**DCL-ENT  2356--CALL     2364--CALL
FMD$WRTBUF
      2140**DCL-ENT  2293--CALL
FMG$REMKEY
      2141**DCL-ENT  2291--CALL     2292--CALL
FMH$JRELPG
      2142**DCL-ENT  2360--CALL
FMH$UBLKCLS
      2143**DCL-ENT  2226--CALL
FMI$DSREL
      2144**DCL-ENT  2216--CALL     2223--CALL     2320--CALL
FMO$E$CLSREL
      2024**DCL      2338>>ASSIGN   2340>>ASSIGN
FMO$MODFIT
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:105  
      2145**DCL-ENT  2227--CALL     2328--CALL     2359--CALL
FMP$E$CLSREL
      2020**DCL      2258>>ASSIGN
FMP$E$FILEBUSY
      2040**DCL      2251>>ASSIGN
FMP$E$QSTOW
      2028**DCL      2252>>ASSIGN   2269>>ASSIGN
FMP$E$REATTR
      2036**DCL      2339>>ASSIGN
FMP$E$RENAME
      2032**DCL      2335>>ASSIGN
FMP$RELCFUS
      2147**DCL-ENT  2185--CALL     2377--CALL
FMP$UPFDDESC
      2148**DCL-ENT  2330--CALL
FMQ$CTG
      2149**DCL-ENT  2233--CALL
FMQ$SRCHFD
      2150**DCL-ENT  2283--CALL
FMR$FN
      2151**DCL-ENT  2189--CALL     2312--CALL
FMR$L8
      2152**DCL-ENT  2180--CALL     2195--CALL     2246--CALL     2299--CALL
FMR$U8
      2153**DCL-ENT  2191--CALL     2201--CALL     2250--CALL     2267--CALL     2313--CALL
FMR$UPDGAC
      2154**DCL-ENT  2204--CALL     2309--CALL
FMU$ALTBLD
      2156**DCL-ENT  2376--CALL
FMU$BLD
      2155**DCL-ENT  2224--CALL     2327--CALL
FM_FRZERO
      2134**DCL      2210>>IF       2345>>ASSIGN
FM_SYSACCTX
      2135**DCL      2199>>IF       2302>>IF
FM_SYSSETX
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:106  
      2136**DCL      2353>>ASSIGN
FPT$
        40**DCL        26--PROC     2169--IF       2170>>ASSIGN
FPT$.ACCESS_
        40**DCL      2336>>IF
FPT$.ACSVEH_
        41**DCL      2336>>IF
FPT$.NAME_
        40**DCL      2334>>IF
FPT$.PASS_
        40**DCL      2334>>IF
FPT$.SN_
        40**DCL        40--REDEF
FPT$.UTL_
        40**DCL        40--REDEF
FPT$.V_
        40**DCL      2170>>IF
FPT$CLOSE_V.ALTBLD
      2012**DCL      2326>>IF       2375>>IF
FPT$CLOSE_V.DISP
      2009**DCL      2179>>IF       2244>>IF
FPT$CLOSE_V.EFTOPER
      2008**DCL      2321>>IF
FPT$CLOSE_V.EXPIRE
      2013**DCL      2013--REDEF
FPT$CLOSE_V.OPER.CHGATT
      2008**DCL      2333>>IF
FPT$CLOSE_V.OPER.REBLD
      2008**DCL      2325>>IF
FPT$CLOSE_V.OPER.RELG
      2008**DCL      2340>>IF
FPT$CLOSE_V.TYPE
      2012**DCL      2012--REDEF
FPT$CLOSE_V.XTNSIZE
      2009**DCL      2009--REDEF    2011--REDEF
I
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:107  
        46**DCL        47--REDEF    2188<<ASSIGN   2190>>ASSIGN   2209<<DOINDEX  2210>>IF       2211>>ASSIGN
      2212>>ASSIGN   2298<<ASSIGN   2303>>ASSIGN   2304>>ASSIGN   2310>>ASSIGN   2372<<DOINDEX  2373>>IF
      2373<>CALL     2378<<DOINDEX  2379>>IF       2379<>CALL
IB
        47**DCL      2231<<ASSIGN   2234>>ASSIGN   2280<<ASSIGN   2296>>ASSIGN   2324<<ASSIGN   2329>>IF
JDCB$
        43**DCL       115--IMP-PTR  2171<<ASSIGN   2172>>ASSIGN   2181>>ASSIGN   2189>>CALL     2193>>IF
      2196>>ASSIGN   2199>>IF       2200>>ASSIGN   2205>>ASSIGN   2210>>IF       2211>>ASSIGN   2212>>ASSIGN
      2225>>IF       2225>>IF       2225>>IF       2233>>CALL     2247>>IF       2251>>IF       2252>>IF
      2268>>IF       2273>>IF       2274>>ASSIGN   2278>>IF       2279>>ASSIGN   2280>>ASSIGN   2281>>ASSIGN
      2282>>ASSIGN   2283>>CALL     2288>>ASSIGN   2291>>IF       2293>>IF       2294>>IF       2295>>ASSIGN
      2296>>ASSIGN   2302>>IF       2312>>CALL     2321>>IF       2324>>ASSIGN   2329>>IF       2332>>IF
      2343>>IF       2344>>IF       2352>>ASSIGN   2353>>IF       2353>>ASSIGN   2354>>ASSIGN   2355>>ASSIGN
      2355>>ASSIGN   2373>>IF       2375>>IF       2377>>CALL     2379>>IF       2385>>ASSIGN   2386>>ASSIGN
      2396<<ASSIGN   2397>>IF       2399>>ASSIGN   2415<<ASSIGN   2417>>ASSIGN
KEY$
        50**DCL      1774--IMP-PTR  2283<>CALL     2285>>ASSIGN
MYFPT$
        56**DCL      2170<<ASSIGN   2227<>CALL     2328<>CALL     2359<>CALL     2376<>CALL
MYFPT$.SN_
        56**DCL        56--REDEF
MYFPT$.UTL_
        56**DCL        56--REDEF
MYFPT$.V_
        56**DCL      2008--IMP-PTR  2168<<ASSIGN   2179>>IF       2244>>IF       2321>>IF       2325>>IF
      2326>>IF       2333>>IF       2340>>IF       2375>>IF       2398<<ASSIGN   2416<<ASSIGN
NEWREL
      2180**LABEL    2223--CALLALT  2226--CALLALT  2233--CALLALT  2320--CALLALT  2357--GOTO
NEWSAVE
      2223**LABEL    2179--GOTO
SCFURELFD
      2294**LABEL    2283--CALLALT
SCRATCHCLS
      2204**LABEL    2176--GOTO
SEG$
        51**DCL      1770--IMP-PTR  2283<>CALL     2286>>ASSIGN   2287>>ASSIGN   2290>>ASSIGN
PL6.E3A0      #002=FMP$CLSF File=FMP$CLSF.:E05TSI                                TUE 07/29/97 16:58 Page:108  
SETCFUREL
      2298**LABEL    2275--GOTO
SFDA
        49**DCL      2233<>CALL     2279<<ASSIGN   2295>>ASSIGN
SSS$SYSTIME
      2157**DCL-ENT  2289--CALL
UQB$MDEQ
      2159**DCL-ENT  2294--CALL
UQB$MENQX
      2158**DCL-ENT  2278--CALL
ZERO
        62**DCL      2168--ASSIGN   2398--ASSIGN   2416--ASSIGN

PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:109  
      525        1        /*T***********************************************************/
      526        2        /*T*                                                         */
      527        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      528        4        /*T*                                                         */
      529        5        /*T***********************************************************/
      530        6                    /*F*   NAME:   FMP$ALTCLEANUP
      531        7                           PURPOSE:  To clean up the DCBs and CFUs after rebuilding
      532        8                                     the alternate indexes for an alternate keyed file.
      533        9                    */
      534       10        FMP$ALTCLEANUP: PROC;
      535       11                    /* */
      536       12               %INCLUDE B$JIT;
      537      615               %MACRO F$DCB(BASED=BASED);
      538      616               %INCLUDE F$DCB;
      539      665               %MEND;
      540      666                    /* */
      541      667    1   DCL B$JIT$ PTR SYMREF;
      542      668    1   DCL FMP$RELCFUS ENTRY(1);
      543      669                    /* */
      544      670               %F$DCB(BASED="BASED(JDCB$)");
      545      720                    /* */
      546      721    1   DCL JDCB$ PTR;
      547      722                    /* */
      548      723    1      JDCB$=B$JIT.SAVEDCB$;
      549      724    1      F$DCB.FCD='0'B;
      550      725    1      F$DCB.FCI='1'B;
      551      726    1      IF B$JIT.CHECK_CFU THEN CALL FMP$RELCFUS(F$DCB.CFU$);
      552      727    1      B$JIT.CHECK_CFU = '0'B;
      553      728
      554      729    1      RETURN;
      555      730    1   END FMP$ALTCLEANUP;
      556      731               %EOD;

PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:110  
--  Include file information  --

   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMP$ALTCLEANUP.

   Procedure FMP$ALTCLEANUP requires 24 words for executable code.
   Procedure FMP$ALTCLEANUP requires 6 words of local(AUTO) storage.

PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:111  

 Object Unit name= FMP$ALTCLEANUP                             File name= FMP$CLSF.:E05TOU
 UTS= JUL 29 '97 16:58:37.32 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    24     30  FMP$ALTCLEANUP
    1  RoData even  none     2      2  FMP$ALTCLEANUP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        0  FMP$ALTCLEANUP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMP$RELCFUS
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                B_VECTNIL
PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:112  


      525        1        /*T***********************************************************/
      526        2        /*T*                                                         */
      527        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      528        4        /*T*                                                         */
      529        5        /*T***********************************************************/
      530        6                    /*F*   NAME:   FMP$ALTCLEANUP
      531        7                           PURPOSE:  To clean up the DCBs and CFUs after rebuilding
      532        8                                     the alternate indexes for an alternate keyed file.
      533        9                    */
      534       10        FMP$ALTCLEANUP: PROC;

     10  0 000000   000000 700200 xent  FMP$ALTCLEA* TSX0  ! X66_AUTO_0
         0 000001   000006 000000                    ZERO    6,0

      535       11                    /* */
      536       12               %INCLUDE B$JIT;
      537      615               %MACRO F$DCB(BASED=BASED);
      538      616               %INCLUDE F$DCB;
      539      665               %MEND;
      540      666                    /* */
      541      667    1   DCL B$JIT$ PTR SYMREF;
      542      668    1   DCL FMP$RELCFUS ENTRY(1);
      543      669                    /* */
      544      670               %F$DCB(BASED="BASED(JDCB$)");
      545      720                    /* */
      546      721    1   DCL JDCB$ PTR;
      547      722                    /* */
      548      723    1      JDCB$=B$JIT.SAVEDCB$;

    723  0 000002   000000 470400 xsym               LDP0    B$JIT$
         0 000003   000251 236100                    LDQ     169,,PR0
         0 000004   200003 756100                    STQ     JDCB$,,AUTO

      549      724    1      F$DCB.FCD='0'B;

    724  0 000005   200003 471500                    LDP1    JDCB$,,AUTO
PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:113  
         0 000006   000000 236000 1                  LDQ     0
         0 000007   100031 356100                    ANSQ    25,,PR1

      550      725    1      F$DCB.FCI='1'B;

    725  0 000010   040000 236007                    LDQ     16384,DL
         0 000011   100031 256100                    ORSQ    25,,PR1

      551      726    1      IF B$JIT.CHECK_CFU THEN CALL FMP$RELCFUS(F$DCB.CFU$);

    726  0 000012   000250 236100                    LDQ     168,,PR0
         0 000013   000400 316003                    CANQ    256,DU
         0 000014   000024 600000 0                  TZE     s:727

    726  0 000015   200003 236100                    LDQ     JDCB$,,AUTO
         0 000016   000066 036003                    ADLQ    54,DU
         0 000017   200004 756100                    STQ     JDCB$+1,,AUTO
         0 000020   200004 630500                    EPPR0   JDCB$+1,,AUTO
         0 000021   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000022   000000 701000 xent               TSX1    FMP$RELCFUS
         0 000023   000000 011000                    NOP     0

      552      727    1      B$JIT.CHECK_CFU = '0'B;

    727  0 000024   000000 470400 xsym               LDP0    B$JIT$
         0 000025   000001 236000 1                  LDQ     1
         0 000026   000250 356100                    ANSQ    168,,PR0

      553      728
      554      729    1      RETURN;

    729  0 000027   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   777777 757777   777377 777777                                    ........
      555      730    1   END FMP$ALTCLEANUP;
PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:114  
      556      731               %EOD;

PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:115  
--  Include file information  --

   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMP$ALTCLEANUP.
PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:116  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 JDCB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB


   Procedure FMP$ALTCLEANUP requires 24 words for executable code.
   Procedure FMP$ALTCLEANUP requires 6 words of local(AUTO) storage.
PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:117  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:118  
          MINI XREF LISTING

B$JIT.CHECK_CFU
       509**DCL       726>>IF        727<<ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       433**DCL       433--REDEF
B$JIT.ERR.MID
       340**DCL       340--REDEF
B$JIT.JRESPEAK
       501**DCL       502--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       610**DCL       610--REDEF     611--REDEF
B$JIT.PNR
       514**DCL       514--REDEF
B$JIT.SAVEDCB$
       509**DCL       723>>ASSIGN
B$JIT.TSLINE
       608**DCL       609--REDEF
B$JIT$
       667**DCL       334--IMP-PTR   723>>ASSIGN    726>>IF        727>>ASSIGN
F$DCB.ACTPOS
       696**DCL       696--REDEF
F$DCB.ARS
       671**DCL       671--REDEF
F$DCB.ATTR
       689**DCL       690--REDEF
F$DCB.BORROW
       704**DCL       704--REDEF     704--REDEF     704--REDEF
F$DCB.CFU$
       705**DCL       726<>CALL
F$DCB.DCBNAME.L
       718**DCL       718--IMP-SIZ
F$DCB.EOMCHAR
       675**DCL       675--REDEF
PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:119  
F$DCB.FCD
       684**DCL       724<<ASSIGN
F$DCB.FCI
       684**DCL       725<<ASSIGN
F$DCB.FLDID
       699**DCL       699--REDEF
F$DCB.FORM$
       693**DCL       693--REDEF
F$DCB.FSECT
       709**DCL       709--REDEF
F$DCB.FSN
       686**DCL       686--REDEF     686--REDEF     687--REDEF
F$DCB.HEADER$
       692**DCL       692--REDEF
F$DCB.IXTNSIZE
       690**DCL       690--REDEF
F$DCB.LASTSTA$
       680**DCL       680--REDEF
F$DCB.LVL
       705**DCL       705--REDEF
F$DCB.NAME.C
       680**DCL       680--REDEF
F$DCB.NOEOF
       701**DCL       701--REDEF
F$DCB.NRECS
       691**DCL       691--REDEF
F$DCB.NRECX
       710**DCL       710--REDEF
F$DCB.OHDR
       702**DCL       702--REDEF
F$DCB.ORG
       685**DCL       685--REDEF
F$DCB.PRECNO
       708**DCL       708--REDEF
F$DCB.RCSZ
       713**DCL       713--REDEF
PL6.E3A0      #003=FMP$ALTCLEANUP File=FMP$CLSF.:E05TSI                          TUE 07/29/97 16:58 Page:120  
F$DCB.RES
       681**DCL       681--REDEF
F$DCB.SETX
       693**DCL       693--REDEF
F$DCB.TAB$
       692**DCL       693--REDEF
F$DCB.TDA
       707**DCL       707--REDEF
F$DCB.WSN
       682**DCL       682--REDEF
FMP$RELCFUS
       668**DCL-ENT   726--CALL
JDCB$
       721**DCL       671--IMP-PTR   723<<ASSIGN    724>>ASSIGN    725>>ASSIGN    726>>CALL

PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:121  
      557        1        /*T***********************************************************/
      558        2        /*T*                                                         */
      559        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      560        4        /*T*                                                         */
      561        5        /*T***********************************************************/
      562        6                    /*F*
      563        7                    *     NAME:   FMP$RELCFUS
      564        8                    *
      565        9                    *     PURPOSE:  TO RELEASE THE CFUS ASSOCIATED WITH THIS FILE.
      566       10                    *               NOTE THAT FOR A CREATE OPEN, TWO SETS OF CFUS
      567       11                    *               MAY BE RELEASED;  THE CREATE CFU MAY POINT TO
      568       12                    *               AN INPUT CFU.  WHEN THIS IS THE CASE, BOTH SETS
      569       13                    *               OF CFUS HAVE THEIR USE COUNTS INCREMENTED BY THE
      570       14                    *               CREATE OPEN.
      571       15                    */
      572       16        FMP$RELCFUS: PROC(CFU$);
      573       17                    /* PARAMETER DATA */
      574       18    1   DCL CFU$ PTR; /* CFU SET TO RELEASE */
      575       19                    /* AUTOMATIC DATA */
      576       20    1   DCL CFUX$ PTR;
      577       21    1   DCL CFUX SBIN; /* LINKX TO NEXT CFU */
      578       22    1   DCL ACCNAM SBIN; /* RELEASE GRANULES INDICATOR */
      579       23    1   DCL FDA SBIN; /* FIT DISK ADDRESS */
      580       24    1   DCL F$CFU$ PTR SYMREF;
      581       25                    /* DEFINE EXTERNAL ROUTINES */
      582       26    1   DCL FAG$RFILE ENTRY(1) ALTRET; /* RELEASE ONE FILE */
      583       27    1   DCL FMD$FLSHBUF ENTRY(1);
      584       28    1   DCL FMR$F8 ENTRY(1) ALTRET; /* RELEASE PRIMARY CFU BLOCK */
      585       29    1   DCL FMR$L8 ENTRY;
      586       30    1   DCL FMR$Z8 ENTRY(1); /* RELEASE SECONDARY CFU BLOCK */
      587       31    1   DCL UQB$DELQID ENTRY(1)ALTRET; /*DEQUEUE ALL USER ENTRIES */
      588       32    1   DCL UQB$DELQIDX ENTRY(1)ALTRET; /* REMOVE QID (LAST USER) */
      589       33    1   DCL B$JIT$ PTR SYMREF;
      590       34        %INCLUDE F$JIT_C;
      591      464        %INCLUDE F$DCB;
      592      513        %INCLUDE FM$MACROS;
      593      888        %FM$CFU(BASED="BASED(CFUX$)");
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:122  
      594      894        %FM$CFUF(BASED="BASED(CFUX$)");
      595      897        %FM$CFUEXT;
      596      901        %EJECT;
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:123  
      597      902    1      CALL FMR$L8;
      598      903    1      CFUX$=CFU$;
      599      904    1      CFUX=FM$CFU.XTX;
      600      905    1      ACCNAM=FM$CFUF.ACCNAM;
      601      906    1      FDA=FM$CFU.FITSDA;
      602      907                    /* DONT SAVE CFU FOR FILE CATALOGUED IN THE JIT */
      603      908    2      IF FM$CFU.USECNT=1 THEN DO;
      604      909    2         IF B$JIT.DCB$->F$DCB.STARX~=0 THEN FM$CFU.FITSDA=0;
      605      910    2         CALL UQB$DELQIDX(CFU$);
      606      911    2         END;
      607      912    1      ELSE CALL UQB$DELQID(CFU$);
      608      913                    /*
      609      914                    *  RELEASE THE PRIMARY CFU.  THE ALTRETURN IS TAKEN IF OTHER
      610      915                    *  USERS STILL HAVE THE FILE OPEN.
      611      916                    */
      612      917    1      CALL FMR$F8(CFU$) ALTRET(STILLOPN);
      613      918    1      IF ADDR(CFU$)=ADDR(B$JIT.DCB$->F$DCB.CFU$) THEN CFU$=ADDR(NIL);
      614      919                    /*
      615      920                    *  GIVE BACK EXTENTS IF FILE IS TO BE RELEASED
      616      921                    */
      617      922    1      IF CFUX=0 THEN GOTO STILLOPN;
      618      923    2      IF ACCNAM=0 AND FDA~=0 THEN DO;
      619      924    2         CALL FAG$RFILE(FDA);
      620      925    2         END;
      621      926    2      DO WHILE(CFUX>1);
      622      927    2         CFUX$=PINCRW(F$CFU$,CFUX);
      623      928    2         CFUX=CFUX$->FM$CFUEXT.LINKX;
      624      929    2         CALL FMR$Z8(CFUX$);
      625      930    2         END;
      626      931    1   STILLOPN:
      627      932    1      RETURN;
      628      933    1   END FMP$RELCFUS;
      629      934        %EOD;

PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:124  
--  Include file information  --

   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMP$RELCFUS.

   Procedure FMP$RELCFUS requires 83 words for executable code.
   Procedure FMP$RELCFUS requires 10 words of local(AUTO) storage.

PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:125  

 Object Unit name= FMP$RELCFUS                                File name= FMP$CLSF.:E05TOU
 UTS= JUL 29 '97 16:58:46.76 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    83    123  FMP$RELCFUS

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  FMP$RELCFUS

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FMR$L8
 yes     yes           Std       1 UQB$DELQID
         yes           Std       1 FMR$Z8
 yes     yes           Std       1 FAG$RFILE
 yes     yes           Std       1 UQB$DELQIDX
 yes     yes           Std       1 FMR$F8
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:126  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     F$CFU$                                B$JIT$                                B_VECTNIL
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:127  


      557        1        /*T***********************************************************/
      558        2        /*T*                                                         */
      559        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      560        4        /*T*                                                         */
      561        5        /*T***********************************************************/
      562        6                    /*F*
      563        7                    *     NAME:   FMP$RELCFUS
      564        8                    *
      565        9                    *     PURPOSE:  TO RELEASE THE CFUS ASSOCIATED WITH THIS FILE.
      566       10                    *               NOTE THAT FOR A CREATE OPEN, TWO SETS OF CFUS
      567       11                    *               MAY BE RELEASED;  THE CREATE CFU MAY POINT TO
      568       12                    *               AN INPUT CFU.  WHEN THIS IS THE CASE, BOTH SETS
      569       13                    *               OF CFUS HAVE THEIR USE COUNTS INCREMENTED BY THE
      570       14                    *               CREATE OPEN.
      571       15                    */
      572       16        FMP$RELCFUS: PROC(CFU$);

     16  0 000000   000000 700200 xent  FMP$RELCFUS  TSX0  ! X66_AUTO_1
         0 000001   000012 000001                    ZERO    10,1

      573       17                    /* PARAMETER DATA */
      574       18    1   DCL CFU$ PTR; /* CFU SET TO RELEASE */
      575       19                    /* AUTOMATIC DATA */
      576       20    1   DCL CFUX$ PTR;
      577       21    1   DCL CFUX SBIN; /* LINKX TO NEXT CFU */
      578       22    1   DCL ACCNAM SBIN; /* RELEASE GRANULES INDICATOR */
      579       23    1   DCL FDA SBIN; /* FIT DISK ADDRESS */
      580       24    1   DCL F$CFU$ PTR SYMREF;
      581       25                    /* DEFINE EXTERNAL ROUTINES */
      582       26    1   DCL FAG$RFILE ENTRY(1) ALTRET; /* RELEASE ONE FILE */
      583       27    1   DCL FMD$FLSHBUF ENTRY(1);
      584       28    1   DCL FMR$F8 ENTRY(1) ALTRET; /* RELEASE PRIMARY CFU BLOCK */
      585       29    1   DCL FMR$L8 ENTRY;
      586       30    1   DCL FMR$Z8 ENTRY(1); /* RELEASE SECONDARY CFU BLOCK */
      587       31    1   DCL UQB$DELQID ENTRY(1)ALTRET; /*DEQUEUE ALL USER ENTRIES */
      588       32    1   DCL UQB$DELQIDX ENTRY(1)ALTRET; /* REMOVE QID (LAST USER) */
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:128  
      589       33    1   DCL B$JIT$ PTR SYMREF;
      590       34        %INCLUDE F$JIT_C;
      591      464        %INCLUDE F$DCB;
      592      513        %INCLUDE FM$MACROS;
      593      888        %FM$CFU(BASED="BASED(CFUX$)");
      594      894        %FM$CFUF(BASED="BASED(CFUX$)");
      595      897        %FM$CFUEXT;
      596      901        %EJECT;
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:129  
      597      902    1      CALL FMR$L8;

    902  0 000002   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000003   000000 701000 xent               TSX1    FMR$L8
         0 000004   000000 011000                    NOP     0

      598      903    1      CFUX$=CFU$;

    903  0 000005   200003 470500                    LDP0    @CFU$,,AUTO
         0 000006   000000 236100                    LDQ     0,,PR0
         0 000007   200004 756100                    STQ     CFUX$,,AUTO

      599      904    1      CFUX=FM$CFU.XTX;

    904  0 000010   200004 471500                    LDP1    CFUX$,,AUTO
         0 000011   100003 236100                    LDQ     3,,PR1
         0 000012   000022 772000                    QRL     18
         0 000013   200005 756100                    STQ     CFUX,,AUTO

      600      905    1      ACCNAM=FM$CFUF.ACCNAM;

    905  0 000014   100002 235100                    LDA     2,,PR1
         0 000015   200006 755100                    STA     ACCNAM,,AUTO

      601      906    1      FDA=FM$CFU.FITSDA;

    906  0 000016   100000 236100                    LDQ     0,,PR1
         0 000017   000032 376000 xsym               ANQ     B_VECTNIL+26
         0 000020   200007 756100                    STQ     FDA,,AUTO

      602      907                    /* DONT SAVE CFU FOR FILE CATALOGUED IN THE JIT */
      603      908    2      IF FM$CFU.USECNT=1 THEN DO;

    908  0 000021   100003 720100                    LXL0    3,,PR1
         0 000022   000001 100003                    CMPX0   1,DU
         0 000023   000040 601000 0                  TNZ     s:912

PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:130  
      604      909    2         IF B$JIT.DCB$->F$DCB.STARX~=0 THEN FM$CFU.FITSDA=0;

    909  0 000024   000000 473400 xsym               LDP3    B$JIT$
         0 000025   300232 474500                    LDP4    154,,PR3
         0 000026   400064 236100                    LDQ     52,,PR4
         0 000027   007000 316007                    CANQ    3584,DL
         0 000030   000033 600000 0                  TZE     s:910

    909  0 000031   000000 236003                    LDQ     0,DU
         0 000032   100000 552134                    STBQ    0,'34'O,PR1

      605      910    2         CALL UQB$DELQIDX(CFU$);

    910  0 000033   200003 630500                    EPPR0   @CFU$,,AUTO
         0 000034   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000035   000000 701000 xent               TSX1    UQB$DELQIDX
         0 000036   000000 011000                    NOP     0

      606      911    2         END;

    911  0 000037   000044 710000 0                  TRA     s:917

      607      912    1      ELSE CALL UQB$DELQID(CFU$);

    912  0 000040   200003 630500                    EPPR0   @CFU$,,AUTO
         0 000041   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000042   000000 701000 xent               TSX1    UQB$DELQID
         0 000043   000000 011000                    NOP     0

      608      913                    /*
      609      914                    *  RELEASE THE PRIMARY CFU.  THE ALTRETURN IS TAKEN IF OTHER
      610      915                    *  USERS STILL HAVE THE FILE OPEN.
      611      916                    */
      612      917    1      CALL FMR$F8(CFU$) ALTRET(STILLOPN);

    917  0 000044   200003 630500                    EPPR0   @CFU$,,AUTO
         0 000045   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:131  
         0 000046   000000 701000 xent               TSX1    FMR$F8
         0 000047   000122 702000 0                  TSX2    STILLOPN

      613      918    1      IF ADDR(CFU$)=ADDR(B$JIT.DCB$->F$DCB.CFU$) THEN CFU$=ADDR(NIL);

    918  0 000050   000000 470400 xsym               LDP0    B$JIT$
         0 000051   000232 471500                    LDP1    154,,PR0
         0 000052   200010 451500                    STP1    FDA+1,,AUTO
         0 000053   200010 236100                    LDQ     FDA+1,,AUTO
         0 000054   000066 036003                    ADLQ    54,DU
         0 000055   200003 116100                    CMPQ    @CFU$,,AUTO
         0 000056   000062 601000 0                  TNZ     s:922

    918  0 000057   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000060   200003 473500                    LDP3    @CFU$,,AUTO
         0 000061   300000 756100                    STQ     0,,PR3

      614      919                    /*
      615      920                    *  GIVE BACK EXTENTS IF FILE IS TO BE RELEASED
      616      921                    */
      617      922    1      IF CFUX=0 THEN GOTO STILLOPN;

    922  0 000062   200005 235100                    LDA     CFUX,,AUTO
         0 000063   000122 600000 0                  TZE     STILLOPN

      618      923    2      IF ACCNAM=0 AND FDA~=0 THEN DO;

    923  0 000064   200006 236100                    LDQ     ACCNAM,,AUTO
         0 000065   000076 601000 0                  TNZ     s:926
         0 000066   200007 235100                    LDA     FDA,,AUTO
         0 000067   000076 600000 0                  TZE     s:926

      619      924    2         CALL FAG$RFILE(FDA);

    924  0 000070   200007 630500                    EPPR0   FDA,,AUTO
         0 000071   200010 450500                    STP0    FDA+1,,AUTO
         0 000072   200010 630500                    EPPR0   FDA+1,,AUTO
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:132  
         0 000073   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000074   000000 701000 xent               TSX1    FAG$RFILE
         0 000075   000000 011000                    NOP     0

      620      925    2         END;

      621      926    2      DO WHILE(CFUX>1);

    926  0 000076   200005 235100                    LDA     CFUX,,AUTO
         0 000077   000001 115007                    CMPA    1,DL
         0 000100   000122 604400 0                  TMOZ    STILLOPN

      622      927    2         CFUX$=PINCRW(F$CFU$,CFUX);

    927  0 000101   200005 236100                    LDQ     CFUX,,AUTO
         0 000102   000022 736000                    QLS     18
         0 000103   000000 036000 xsym               ADLQ    F$CFU$
         0 000104   200004 756100                    STQ     CFUX$,,AUTO

      623      928    2         CFUX=CFUX$->FM$CFUEXT.LINKX;

    928  0 000105   200004 470500                    LDP0    CFUX$,,AUTO
         0 000106   000000 236100                    LDQ     0,,PR0
         0 000107   777777 376007                    ANQ     -1,DL
         0 000110   200005 756100                    STQ     CFUX,,AUTO

      624      929    2         CALL FMR$Z8(CFUX$);

    929  0 000111   200004 631500                    EPPR1   CFUX$,,AUTO
         0 000112   200010 451500                    STP1    FDA+1,,AUTO
         0 000113   200010 630500                    EPPR0   FDA+1,,AUTO
         0 000114   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000115   000000 701000 xent               TSX1    FMR$Z8
         0 000116   000000 011000                    NOP     0

      625      930    2         END;

PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:133  
    930  0 000117   200005 235100                    LDA     CFUX,,AUTO
         0 000120   000001 115007                    CMPA    1,DL
         0 000121   000101 605400 0                  TPNZ    s:927

      626      931    1   STILLOPN:
      627      932    1      RETURN;

    932  0 000122   000000 702200 xent  STILLOPN     TSX2  ! X66_ARET
      628      933    1   END FMP$RELCFUS;
      629      934        %EOD;

PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:134  
--  Include file information  --

   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMP$RELCFUS.
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:135  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @CFU$                      6-0-0/w SBIN        r     1 ACCNAM
    *0-0-0/w PTR         r     1 CFU$                       5-0-0/w SBIN        r     1 CFUX
     4-0-0/w PTR         r     1 CFUX$                      7-0-0/w SBIN        r     1 FDA

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 F$CFU$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU                     0-0-0/w STRC(288)   r     1 FM$CFUEXT
     0-0-0/w STRC(288)   r     1 FM$CFUF


   Procedure FMP$RELCFUS requires 83 words for executable code.
   Procedure FMP$RELCFUS requires 10 words of local(AUTO) storage.
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:136  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:137  
          MINI XREF LISTING

ACCNAM
        22**DCL       905<<ASSIGN    923>>IF
B$JIT.DCB$
       451**DCL       909>>IF        918>>IF
B$JIT.ERR.MID
       362**DCL       362--REDEF
B$JIT$
        33**DCL       356--IMP-PTR   909>>IF        918>>IF
CFU$
        18**DCL        16--PROC      903>>ASSIGN    910<>CALL      912<>CALL      917<>CALL      918--IF
       918<<ASSIGN
CFUX
        21**DCL       904<<ASSIGN    922>>IF        926>>DOWHILE   927>>ASSIGN    928<<ASSIGN
CFUX$
        20**DCL       889--IMP-PTR   895--IMP-PTR   903<<ASSIGN    904>>ASSIGN    905>>ASSIGN    906>>ASSIGN
       908>>IF        909>>ASSIGN    927<<ASSIGN    928>>ASSIGN    929<>CALL
F$CFU$
        24**DCL       927>>ASSIGN
F$DCB.ACTPOS
       490**DCL       490--REDEF
F$DCB.ARS
       465**DCL       465--REDEF
F$DCB.ATTR
       483**DCL       484--REDEF
F$DCB.BORROW
       498**DCL       498--REDEF     498--REDEF     498--REDEF
F$DCB.CFU$
       499**DCL       918--IF
F$DCB.DCBNAME.L
       512**DCL       512--IMP-SIZ
F$DCB.EOMCHAR
       469**DCL       469--REDEF
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:138  
F$DCB.FLDID
       493**DCL       493--REDEF
F$DCB.FORM$
       487**DCL       487--REDEF
F$DCB.FSECT
       503**DCL       503--REDEF
F$DCB.FSN
       480**DCL       480--REDEF     480--REDEF     481--REDEF
F$DCB.HEADER$
       486**DCL       486--REDEF
F$DCB.IXTNSIZE
       484**DCL       484--REDEF
F$DCB.LASTSTA$
       474**DCL       474--REDEF
F$DCB.LVL
       499**DCL       499--REDEF
F$DCB.NAME.C
       474**DCL       474--REDEF
F$DCB.NOEOF
       495**DCL       495--REDEF
F$DCB.NRECS
       485**DCL       485--REDEF
F$DCB.NRECX
       504**DCL       504--REDEF
F$DCB.OHDR
       496**DCL       496--REDEF
F$DCB.ORG
       479**DCL       479--REDEF
F$DCB.PRECNO
       502**DCL       502--REDEF
F$DCB.RCSZ
       507**DCL       507--REDEF
F$DCB.RES
       475**DCL       475--REDEF
F$DCB.SETX
       487**DCL       487--REDEF
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:139  
F$DCB.STARX
       496**DCL       909>>IF
F$DCB.TAB$
       486**DCL       487--REDEF
F$DCB.TDA
       501**DCL       501--REDEF
F$DCB.WSN
       476**DCL       476--REDEF
FAG$RFILE
        26**DCL-ENT   924--CALL
FDA
        23**DCL       906<<ASSIGN    923>>IF        924<>CALL
FM$CFU.ACCTX
       890**DCL       890--REDEF
FM$CFU.FITSDA
       890**DCL       906>>ASSIGN    909<<ASSIGN
FM$CFU.USECNT
       891**DCL       908>>IF
FM$CFU.XTX
       891**DCL       904>>ASSIGN
FM$CFUEXT.LINKX
       898**DCL       928>>ASSIGN
FM$CFUEXT.XTNT
       898**DCL       899--REDEF
FM$CFUF.ACCNAM
       895**DCL       905>>ASSIGN
FMR$F8
        28**DCL-ENT   917--CALL
FMR$L8
        29**DCL-ENT   902--CALL
FMR$Z8
        30**DCL-ENT   929--CALL
STILLOPN
       932**LABEL     917--CALLALT   922--GOTO
UQB$DELQID
        31**DCL-ENT   912--CALL
PL6.E3A0      #004=FMP$RELCFUS File=FMP$CLSF.:E05TSI                             TUE 07/29/97 16:58 Page:140  
UQB$DELQIDX
        32**DCL-ENT   910--CALL

PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:141  
      630        1        /*T***********************************************************/
      631        2        /*T*                                                         */
      632        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      633        4        /*T*                                                         */
      634        5        /*T***********************************************************/
      635        6                    /*F*     NAME: FMP$ULIST
      636        7                    *        ENTRY: FMP$UDLIST
      637        8                  *        PURPOSE: To maintain the SYSID list of active users of a packset.
      638        9                    *        CALL: A single parameter is the FM$SET entry for the packset.
      639       10              *             If a second is present, it is a UBIN SYSID to use (else JIT's).
      640       11              *        DESCRIPTION: The list is maintained in CFU blocks (14 SYSIDs each)
      641       12              *        unless only one user exists, when the SYSID is in FM$SET.
      642       13              *        Each SYSID is present only once, and the list is compact (only
      643       14              *        the last CFU block in the chain is not full).
      644       15              *        ENVIRONMENT: For ULIST only, the CFUs are locked (and remain so).
      645       16              *        For UDLIST, CFUS must be locked if SYSID is specified,
      646       17              *        and will remain so. Otherwise they will be unlocked.
      647       18              */
      648       19        FMP$ULIST: PROC(FM$SET,J) ALTRET;
      649       20        %INCLUDE F$JIT_C;
      650      450        %INCLUDE FM$MACROS;
      651      825        %FM$SET(BASED=,ARY=);
      652      830        %FM$SETU(FM$SETU=FM$QU,BASED="BASED(Q$)");
      653      833        %FM$SETU(FM$SETU=FM$PU,BASED="BASED(P$)");
      654      836        %FM$DEV(BASED="BASED(F$CFU$)");
      655      842        %FM$VOL(BASED="BASED(F$CFU$)");
      656      848        %FM$VOL(FM$VOL=Q$VOL,ARY=,BASED="BASED(Q$)");
      657      854        %INCLUDE FR$RAT;
      658      907        %FR$RAT(STCLASS="BASED(P$)");
      659      947        %INCLUDE NI$TABLES;
      660     1163        %NI$DCT;
      661     1211        %INCLUDE F_ERRORS_C;
      662     1451        %INCLUDE FR_ERRORS_C;
      663     1482        %INCLUDE JG_GHOSTS_C;
      664     1572        %INCLUDE OCI_SUBS_C;
      665     1670        %INCLUDE CP_6_SUBS;
      666     2210        %SUB FCG#='0615'O;
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:142  
      667     2211        %SUB MID#='20'O;
      668     2212        %ERRCODE(NAME=FMP$E$NONEWU,COD#=%E$NONEWU);
      669     2216        %ERRCODE(NAME=FMP$E$NOCFUS,COD#=%E$NOCFUS);
      670     2220        %ERRCODE(NAME=FMP$E$NORSNN,COD#=%E$NORSNN);
      671     2224        %ERRCODE(NAME=FMP$E$XCLSET,COD#=%E$XCLSET);
      672     2228    1   DCL F$CFU$ PTR SYMREF;
      673     2229    1   DCL N$DCT$$ PTR SYMREF;
      674     2230    1   DCL N$DCT$(0:0) PTR BASED(N$DCT$$);
      675     2231    1   DCL FM_SYSSETX UBIN SYMREF;
      676     2232    1   DCL B$JIT$ PTR SYMREF;
      677     2233        %JG_GHOSTS(STCLASS=SYMREF);
      678     2271    1   DCL FMR$GA ENTRY(2)ALTRET;
      679     2272    1   DCL FMR$ZA ENTRY(1);
      680     2273    1   DCL FMR$L8 ENTRY;
      681     2274    1   DCL FMR$U8 ENTRY;
      682     2275    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      683     2276    1   DCL I UBIN;
      684     2277    1   DCL J UBIN ALIGNED;
      685     2278    1   DCL Q$ PTR;
      686     2279    1   DCL P$ PTR;
      687     2280    1   DCL FR_DPREQ UBIN CONSTANT SYMDEF INIT(0);
      688     2281                    /*  PATCH NON-ZERO TO ENFORCE BATCH PACKSET REQUESTS */
      689     2282    1   DCL SYSID UBIN;
      690     2283    1   DCL 1 DISM,
      691     2284    1         2 CODE UBIN(18)UNAL,
      692     2285    1         2 CATTR BIT(18),
      693     2286    1         2 PSN CHAR(6);
      694     2287                    /* PROCEDURE */
      695     2288    1      IF ADDR(J)=ADDR(NIL) THEN SYSID=B$JIT.SYSID;
      696     2289    1      ELSE SYSID=J;
      697     2290    2      IF FM$SET.USERLIST=0 THEN DO;
      698     2291    2         CALL CHKNEW ALTRET(RETALT);
      699     2292                    /*E*   ERROR: FMP-E$NONEWU-E
      700     2293                    *        MESSAGE:Packset% DP#%SN% is being dismounted.
      701     2294                    */
      702     2295    2         FM$SET.ONEU='1'B;
      703     2296    2         FM$SET.SYSID=SYSID;
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:143  
      704     2297    3         IF FM$DEV.DCTX(FM$SET.DCTX)~=FM$SET.DCTX OR FM$SET.DCTX=0 THEN DO;
      705     2298    3            FM$SET.DIAGOPN='0'B;
      706     2299    3            I=FM$SET.DCTX;
      707     2300    4            DO WHILE(I~=0);
      708     2301    5               IF FM$VOL.SECT#(I)~=0 THEN DO;
      709     2302    5                  P$=N$DCT$(FM$VOL.DCTX(I))->NI$DCT.RAT$;
      710     2303    6                  IF FR$RAT.RES.SISID=JG_PIG# THEN DO;
      711     2304    6                     FR$RAT.FLG.OPN='1'B;
      712     2305    6                     FR$RAT.FLG.MBIT.MTD='1'B;
      713     2306    6                     END;
      714     2307    5                  END;
      715     2308    4               I=FM$VOL.VOLL(I);
      716     2309    4               END;
      717     2310    3            END;
      718     2311    2         RETURN;
      719     2312    2         END;
      720     2313    2      IF FM$SET.ONEU THEN DO;
      721     2314    2         IF FM$SET.SYSID=SYSID THEN RETURN;
      722     2315    2         CALL CHKNEW ALTRET(RETALT);
      723     2316    2         CALL FMR$GA(Q$,I)ALTRET(FMPE$NOCFUS);
      724     2317    2         FM$QU.NUM=1;
      725     2318    2         FM$SET.ONEU='0'B;
      726     2319    2         FM$QU.SYSID(0)=FM$SET.SYSID;
      727     2320    2         FM$SET.USERLIST=I;
      728     2321    2         END;
      729     2322    1      P$=PINCRW(F$CFU$,FM$SET.USERLIST);
      730     2323    2      DO WHILE (P$~=F$CFU$);
      731     2324    3         DO I=0 TO FM$PU.NUM-1;
      732     2325    3            IF FM$PU.SYSID(I)=SYSID THEN RETURN;
      733     2326    3            END;
      734     2327    2         Q$=P$;
      735     2328    2         P$=PINCRW(F$CFU$,FM$PU.LINKX);
      736     2329    2         END;
      737     2330    1      CALL CHKNEW ALTRET(RETALT);
      738     2331    2      IF FM$QU.NUM=14 THEN DO;
      739     2332    2         P$=Q$;
      740     2333    2         CALL FMR$GA(Q$,I)ALTRET(FMPE$NOCFUS);
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:144  
      741     2334    2         FM$PU.LINKX=I;
      742     2335    2         END;
      743     2336    1      FM$QU.SYSID(FM$QU.NUM)=SYSID;
      744     2337    1      FM$QU.NUM=FM$QU.NUM+1;
      745     2338    1      RETURN;
      746     2339    1   CHKNEW: PROC ALTRET;
      747     2340    2      IF FR_DPREQ~=0 THEN
      748     2341    2         IF B$JIT.MODE=%M_BATCH# AND I~=FM_SYSSETX THEN GOTO FMPE$NORSNN;
      749     2342    2      IF FM$SET.XCL AND FM$SET.SYSID~=0 THEN GOTO FMPE$XCLSET;
      750     2343    2      IF NOT FM$SET.NONEWU THEN RETURN;
      751     2344                    /*  ERRORS */
      752     2345    2   FMPE$NONEWU: B$JIT.ERR=FMP$E$NONEWU;
      753     2346    2      ALTRETURN;
      754     2347    2   FMPE$XCLSET: B$JIT.ERR=FMP$E$XCLSET;
      755     2348    2      ALTRETURN;
      756     2349    2   FMPE$NORSNN: B$JIT.ERR=FMP$E$NORSNN;
      757     2350                    /*E*     ERROR: FMP-E$NORSNN-E
      758     2351                    *        MESSAGE:Batch access to packset% DP#%SN% must be requested.
      759     2352                    *        MESSAGE1:Packset% DP#%SN% was not listed on a !RESOURCE command
      760     2353                    *        and is not the system set or your HPSN (home packset).
      761     2354                    */
      762     2355    2      ALTRETURN;
      763     2356    2   END CHKNEW;
      764     2357    1   FMPE$NOCFUS: B$JIT.ERR=FMP$E$NOCFUS;
      765     2358    1   RETALT:;
      766     2359    1      ALTRETURN;
      767     2360        %EJECT;
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:145  
      768     2361    1   FMP$UDLIST:ENTRY(FM$SET,J)ALTRET;
      769     2362    2      IF ADDR(J)=ADDR(NIL) THEN DO;
      770     2363    2         SYSID=B$JIT.SYSID;
      771     2364    2         CALL FMR$L8;
      772     2365    2         END;
      773     2366    1      ELSE SYSID=J;
      774     2367    1      Q$=ADDR(FM$SET.USERLIST);
      775     2368    2      IF FM$SET.ONEU THEN DO;
      776     2369    2         IF FM$SET.SYSID=SYSID THEN FM$SET.SYSID=0;
      777     2370    2         GOTO RETRET;
      778     2371    2         END;
      779     2372    1      P$=PINCRW(F$CFU$,FM$SET.USERLIST);
      780     2373    2      DO WHILE(P$~=F$CFU$);
      781     2374    3         DO I=0 TO FM$PU.NUM-1;
      782     2375    4            IF FM$PU.SYSID(I)=SYSID THEN DO;
      783     2376    5               IF FM$PU.NUM=1 THEN DO;
      784     2377    5                  CALL FMR$ZA(P$);
      785     2378    5                  FM$QU.LINKX=0;
      786     2379    5                  GOTO RETRET;
      787     2380    5                  END;
      788     2381    5               IF FM$PU.LINKX=0 THEN DO;
      789     2382    5                  FM$PU.NUM=FM$PU.NUM-1;
      790     2383    5                  FM$PU.SYSID(I)=FM$PU.SYSID(FM$PU.NUM);
      791     2384    6                  IF FM$PU.NUM=1 AND Q$=ADDR(FM$SET.USERLIST) THEN DO;
      792     2385    6                     FM$SET.ONEU='1'B;
      793     2386    6                     FM$SET.SYSID=FM$PU.SYSID(0);
      794     2387    6                     FM$SET.XCL=FM$SET.NONEWU;
      795     2388    6                     CALL FMR$ZA(P$);
      796     2389    6                     END;
      797     2390    5                  GOTO RETRET;
      798     2391    5                  END;
      799     2392    4               Q$=PINCRW(F$CFU$,FM$PU.LINKX);
      800     2393    4               FM$PU.SYSID(I)=FM$QU.SYSID(0);
      801     2394    4               SYSID=FM$QU.SYSID(0);
      802     2395    4               I=14;
      803     2396    4               END;
      804     2397    3            END;
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:146  
      805     2398    2         Q$=P$;
      806     2399    2         P$=PINCRW(F$CFU$,FM$PU.LINKX);
      807     2400    2         END;
      808     2401    1   RETRET:;
      809     2402    2      IF FM$SET.SYSID=0 THEN DO;
      810     2403    2         FM$SET.XCL='1'B;
      811     2404    2         FM$SET.NONEWU='0'B;
      812     2405    2         FM$SET.DSMTF='0'B;
      813     2406    2         Q$=ADDR(FM$VOL(FM$SET.DCTX));
      814     2407    3         IF Q$VOL.DCTX~=FM$SET.DCTX THEN DO WHILE(Q$~=F$CFU$);
      815     2408    3            I=FM$DEV.SECTL(Q$VOL.DCTX);
      816     2409    4            DO WHILE(I~=0);
      817     2410    4               IF FM$VOL.SETX(I)~=0 AND FM$VOL.SYSID(FM$VOL.SETX(I))~=0
      818     2411    4               THEN GOTO STILLOPN;
      819     2412    4               I=FM$VOL.SECTL(I);
      820     2413    4               END;
      821     2414    3            P$=N$DCT$(Q$VOL.DCTX)->NI$DCT.RAT$;
      822     2415    3            FR$RAT.FLG.OPN='0'B;
      823     2416    3            IF FM$SET.DIAGOPN OR Q$VOL.SECT#~=0 THEN FR$RAT.FLG.MBIT='0'B;
      824     2417    3   STILLOPN:Q$=ADDR(FM$VOL(Q$VOL.VOLL));
      825     2418    3            END;
      826     2419    2         END;
      827     2420    2      IF FM$SET.NONEWU AND FM$SET.SYSID=JG_PIG# THEN DO;
      828     2421    2         FM$SET.XCL='1'B;
      829     2422    2         IF B$JIT.USER=JG_PIG# THEN EXIT;
      830     2423    2         CALL FMR$U8;
      831     2424    2         DISM.PSN=FM$SET.PSN;
      832     2425    2         DISM.CATTR=K_DISK;
      833     2426    2         DISM.CODE=%SETDSMTX#;
      834     2427    2         CALL KUW$WRITE(DISM,10,J_PIG);
      835     2428    2         CALL FMR$L8;
      836     2429    2         END;
      837     2430    1      IF ADDR(J)=ADDR(NIL) THEN CALL FMR$U8;
      838     2431    1      RETURN;
      839     2432    1   END FMP$ULIST;
      840     2433        %EOD;

PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:147  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   FR_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMP$ULIST.

   Procedure FMP$ULIST requires 440 words for executable code.
   Procedure FMP$ULIST requires 18 words of local(AUTO) storage.

PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:148  

 Object Unit name= FMP$ULIST                                  File name= FMP$CLSF.:E05TOU
 UTS= JUL 29 '97 16:58:58.36 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      5      5  FMP$ULIST
    1   Proc  even  none   440    670  FMP$ULIST
    2  RoData even  none    10     12  FMP$ULIST

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  FMP$ULIST
     1    303          yes     yes      Std        2  FMP$UDLIST

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      4  FR_DPREQ
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:149  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 FMR$GA
         yes           Std       1 FMR$ZA
         yes           Std       0 FMR$L8
         yes           Std       0 FMR$U8
 yes     yes           Std       3 KUW$WRITE
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     F$CFU$                                N$DCT$$                               FM_SYSSETX
     B$JIT$                                J_PIG                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:150  


      630        1        /*T***********************************************************/
      631        2        /*T*                                                         */
      632        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      633        4        /*T*                                                         */
      634        5        /*T***********************************************************/
      635        6                    /*F*     NAME: FMP$ULIST
      636        7                    *        ENTRY: FMP$UDLIST
      637        8                  *       PURPOSE: To maintain the SYSID list of active users of a packset.
      638        9                    *        CALL: A single parameter is the FM$SET entry for the packset.
      639       10              *             If a second is present, it is a UBIN SYSID to use (else JIT's).
      640       11              *        DESCRIPTION: The list is maintained in CFU blocks (14 SYSIDs each)
      641       12              *        unless only one user exists, when the SYSID is in FM$SET.
      642       13              *        Each SYSID is present only once, and the list is compact (only
      643       14              *        the last CFU block in the chain is not full).
      644       15              *        ENVIRONMENT: For ULIST only, the CFUs are locked (and remain so).
      645       16              *        For UDLIST, CFUS must be locked if SYSID is specified,
      646       17              *        and will remain so. Otherwise they will be unlocked.
      647       18              */
      648       19        FMP$ULIST: PROC(FM$SET,J) ALTRET;

     19  1 000000   000000 700200 xent  FMP$ULIST    TSX0  ! X66_AUTO_2
         1 000001   000022 000002                    ZERO    18,2

      649       20        %INCLUDE F$JIT_C;
      650      450        %INCLUDE FM$MACROS;
      651      825        %FM$SET(BASED=,ARY=);
      652      830        %FM$SETU(FM$SETU=FM$QU,BASED="BASED(Q$)");
      653      833        %FM$SETU(FM$SETU=FM$PU,BASED="BASED(P$)");
      654      836        %FM$DEV(BASED="BASED(F$CFU$)");
      655      842        %FM$VOL(BASED="BASED(F$CFU$)");
      656      848        %FM$VOL(FM$VOL=Q$VOL,ARY=,BASED="BASED(Q$)");
      657      854        %INCLUDE FR$RAT;
      658      907        %FR$RAT(STCLASS="BASED(P$)");
      659      947        %INCLUDE NI$TABLES;
      660     1163        %NI$DCT;
      661     1211        %INCLUDE F_ERRORS_C;
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:151  
      662     1451        %INCLUDE FR_ERRORS_C;
      663     1482        %INCLUDE JG_GHOSTS_C;
      664     1572        %INCLUDE OCI_SUBS_C;
      665     1670        %INCLUDE CP_6_SUBS;
      666     2210        %SUB FCG#='0615'O;
      667     2211        %SUB MID#='20'O;
      668     2212        %ERRCODE(NAME=FMP$E$NONEWU,COD#=%E$NONEWU);
      669     2216        %ERRCODE(NAME=FMP$E$NOCFUS,COD#=%E$NOCFUS);
      670     2220        %ERRCODE(NAME=FMP$E$NORSNN,COD#=%E$NORSNN);
      671     2224        %ERRCODE(NAME=FMP$E$XCLSET,COD#=%E$XCLSET);
      672     2228    1   DCL F$CFU$ PTR SYMREF;
      673     2229    1   DCL N$DCT$$ PTR SYMREF;
      674     2230    1   DCL N$DCT$(0:0) PTR BASED(N$DCT$$);
      675     2231    1   DCL FM_SYSSETX UBIN SYMREF;
      676     2232    1   DCL B$JIT$ PTR SYMREF;
      677     2233        %JG_GHOSTS(STCLASS=SYMREF);
      678     2271    1   DCL FMR$GA ENTRY(2)ALTRET;
      679     2272    1   DCL FMR$ZA ENTRY(1);
      680     2273    1   DCL FMR$L8 ENTRY;
      681     2274    1   DCL FMR$U8 ENTRY;
      682     2275    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      683     2276    1   DCL I UBIN;
      684     2277    1   DCL J UBIN ALIGNED;
      685     2278    1   DCL Q$ PTR;
      686     2279    1   DCL P$ PTR;
      687     2280    1   DCL FR_DPREQ UBIN CONSTANT SYMDEF INIT(0);
      688     2281                    /*  PATCH NON-ZERO TO ENFORCE BATCH PACKSET REQUESTS */
      689     2282    1   DCL SYSID UBIN;
      690     2283    1   DCL 1 DISM,
      691     2284    1         2 CODE UBIN(18)UNAL,
      692     2285    1         2 CATTR BIT(18),
      693     2286    1         2 PSN CHAR(6);
      694     2287                    /* PROCEDURE */
      695     2288    1      IF ADDR(J)=ADDR(NIL) THEN SYSID=B$JIT.SYSID;

   2288  1 000002   200004 236100                    LDQ     @J,,AUTO
         1 000003   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:152  
         1 000004   000012 601000 1                  TNZ     s:2289

   2288  1 000005   000000 470400 xsym               LDP0    B$JIT$
         1 000006   000000 236100                    LDQ     0,,PR0
         1 000007   777777 376007                    ANQ     -1,DL
         1 000010   200010 756100                    STQ     SYSID,,AUTO
         1 000011   000015 710000 1                  TRA     s:2290

      696     2289    1      ELSE SYSID=J;

   2289  1 000012   200004 470500                    LDP0    @J,,AUTO
         1 000013   000000 235100                    LDA     0,,PR0
         1 000014   200010 755100                    STA     SYSID,,AUTO

      697     2290    2      IF FM$SET.USERLIST=0 THEN DO;

   2290  1 000015   200003 470500                    LDP0    @FM$SET,,AUTO
         1 000016   000002 720100                    LXL0    2,,PR0
         1 000017   000076 601000 1                  TNZ     s:2313

      698     2291    2         CALL CHKNEW ALTRET(RETALT);

   2291  1 000020   000235 701000 1                  TSX1    CHKNEW
         1 000021   000302 702000 1                  TSX2    RETALT

      699     2292                    /*E*   ERROR: FMP-E$NONEWU-E
      700     2293                    *        MESSAGE:Packset% DP#%SN% is being dismounted.
      701     2294                    */
      702     2295    2         FM$SET.ONEU='1'B;

   2295  1 000022   200003 470500                    LDP0    @FM$SET,,AUTO
         1 000023   000001 236003                    LDQ     1,DU
         1 000024   000002 256100                    ORSQ    2,,PR0

      703     2296    2         FM$SET.SYSID=SYSID;

   2296  1 000025   200010 720100                    LXL0    SYSID,,AUTO
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:153  
         1 000026   000002 440100                    SXL0    2,,PR0

      704     2297    3         IF FM$DEV.DCTX(FM$SET.DCTX)~=FM$SET.DCTX OR FM$SET.DCTX=0 THEN DO;

   2297  1 000027   000000 236100                    LDQ     0,,PR0
         1 000030   000017 772000                    QRL     15
         1 000031   000000 376000 2                  ANQ     0
         1 000032   000000 471400 xsym               LDP1    F$CFU$
         1 000033   100000 221106                    LDX1    0,QL,PR1
         1 000034   000000 101100                    CMPX1   0,,PR0
         1 000035   000040 601000 1                  TNZ     s:2298
         1 000036   000000 222100                    LDX2    0,,PR0
         1 000037   000075 601000 1                  TNZ     s:2311

      705     2298    3            FM$SET.DIAGOPN='0'B;

   2298  1 000040   000001 236000 2                  LDQ     1
         1 000041   000002 356100                    ANSQ    2,,PR0

      706     2299    3            I=FM$SET.DCTX;

   2299  1 000042   000000 236100                    LDQ     0,,PR0
         1 000043   000022 772000                    QRL     18
         1 000044   200005 756100                    STQ     I,,AUTO

      707     2300    4            DO WHILE(I~=0);

   2300  1 000045   000075 600000 1                  TZE     s:2311

      708     2301    5               IF FM$VOL.SECT#(I)~=0 THEN DO;

   2301  1 000046   200005 235100                    LDA     I,,AUTO
         1 000047   000003 735000                    ALS     3
         1 000050   000000 470400 xsym               LDP0    F$CFU$
         1 000051   000001 236105                    LDQ     1,AL,PR0
         1 000052   777000 316003                    CANQ    -512,DU
         1 000053   000071 600000 1                  TZE     s:2308
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:154  

      709     2302    5                  P$=N$DCT$(FM$VOL.DCTX(I))->NI$DCT.RAT$;

   2302  1 000054   000000 220105                    LDX0    0,AL,PR0
         1 000055   000000 471400 xsym               LDP1    N$DCT$$
         1 000056   100000 473510                    LDP3    0,X0,PR1
         1 000057   300005 236100                    LDQ     5,,PR3
         1 000060   200007 756100                    STQ     P$,,AUTO

      710     2303    6                  IF FR$RAT.RES.SISID=JG_PIG# THEN DO;

   2303  1 000061   200007 473500                    LDP3    P$,,AUTO
         1 000062   300001 220100                    LDX0    1,,PR3
         1 000063   000007 100003                    CMPX0   7,DU
         1 000064   000071 601000 1                  TNZ     s:2308

      711     2304    6                     FR$RAT.FLG.OPN='1'B;

   2304  1 000065   000020 236007                    LDQ     16,DL
         1 000066   300010 256100                    ORSQ    8,,PR3

      712     2305    6                     FR$RAT.FLG.MBIT.MTD='1'B;

   2305  1 000067   000400 236007                    LDQ     256,DL
         1 000070   300010 256100                    ORSQ    8,,PR3

      713     2306    6                     END;

      714     2307    5                  END;

      715     2308    4               I=FM$VOL.VOLL(I);

   2308  1 000071   000005 236105                    LDQ     5,AL,PR0
         1 000072   000022 772000                    QRL     18
         1 000073   200005 756100                    STQ     I,,AUTO

      716     2309    4               END;
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:155  

   2309  1 000074   000046 601000 1                  TNZ     s:2301

      717     2310    3            END;

      718     2311    2         RETURN;

   2311  1 000075   000000 702200 xent               TSX2  ! X66_ARET

      719     2312    2         END;
      720     2313    2      IF FM$SET.ONEU THEN DO;

   2313  1 000076   000002 236100                    LDQ     2,,PR0
         1 000077   000001 316003                    CANQ    1,DU
         1 000100   000133 600000 1                  TZE     s:2322

      721     2314    2         IF FM$SET.SYSID=SYSID THEN RETURN;

   2314  1 000101   000002 236100                    LDQ     2,,PR0
         1 000102   777777 376007                    ANQ     -1,DL
         1 000103   200010 116100                    CMPQ    SYSID,,AUTO
         1 000104   000106 601000 1                  TNZ     s:2315

   2314  1 000105   000000 702200 xent               TSX2  ! X66_ARET

      722     2315    2         CALL CHKNEW ALTRET(RETALT);

   2315  1 000106   000235 701000 1                  TSX1    CHKNEW
         1 000107   000302 702000 1                  TSX2    RETALT

      723     2316    2         CALL FMR$GA(Q$,I)ALTRET(FMPE$NOCFUS);

   2316  1 000110   200005 630500                    EPPR0   I,,AUTO
         1 000111   200017 450500                    STP0    DISM+6,,AUTO
         1 000112   200006 631500                    EPPR1   Q$,,AUTO
         1 000113   200016 451500                    STP1    DISM+5,,AUTO
         1 000114   200016 630500                    EPPR0   DISM+5,,AUTO
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:156  
         1 000115   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000116   000000 701000 xent               TSX1    FMR$GA
         1 000117   000277 702000 1                  TSX2    FMPE$NOCFUS

      724     2317    2         FM$QU.NUM=1;

   2317  1 000120   000001 220003                    LDX0    1,DU
         1 000121   200006 470500                    LDP0    Q$,,AUTO
         1 000122   000000 740100                    STX0    0,,PR0

      725     2318    2         FM$SET.ONEU='0'B;

   2318  1 000123   200003 470500                    LDP0    @FM$SET,,AUTO
         1 000124   000002 236000 2                  LDQ     2
         1 000125   000002 356100                    ANSQ    2,,PR0

      726     2319    2         FM$QU.SYSID(0)=FM$SET.SYSID;

   2319  1 000126   000002 721100                    LXL1    2,,PR0
         1 000127   200006 471500                    LDP1    Q$,,AUTO
         1 000130   100001 741100                    STX1    1,,PR1

      727     2320    2         FM$SET.USERLIST=I;

   2320  1 000131   200005 721100                    LXL1    I,,AUTO
         1 000132   000002 441100                    SXL1    2,,PR0

      728     2321    2         END;

      729     2322    1      P$=PINCRW(F$CFU$,FM$SET.USERLIST);

   2322  1 000133   000002 720100                    LXL0    2,,PR0
         1 000134   000000 636010                    EAQ     0,X0
         1 000135   000000 036000 xsym               ADLQ    F$CFU$
         1 000136   200007 756100                    STQ     P$,,AUTO

      730     2323    2      DO WHILE (P$~=F$CFU$);
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:157  

   2323  1 000137   000000 116000 xsym               CMPQ    F$CFU$
         1 000140   000176 600000 1                  TZE     s:2330

      731     2324    3         DO I=0 TO FM$PU.NUM-1;

   2324  1 000141   200005 450100                    STZ     I,,AUTO
         1 000142   000160 710000 1                  TRA     s:2326+3

      732     2325    3            IF FM$PU.SYSID(I)=SYSID THEN RETURN;

   2325  1 000143   200005 235100                    LDA     I,,AUTO
         1 000144   000001 735000                    ALS     1
         1 000145   200007 470500                    LDP0    P$,,AUTO
         1 000146   000100 101505                    MRL     fill='000'O
         1 000147   000001 000002                    ADSC9   1,A,PR0                  cn=0,n=2
         1 000150   200016 000004                    ADSC9   DISM+5,,AUTO             cn=0,n=4
         1 000151   200016 236100                    LDQ     DISM+5,,AUTO
         1 000152   200010 116100                    CMPQ    SYSID,,AUTO
         1 000153   000155 601000 1                  TNZ     s:2326

   2325  1 000154   000000 702200 xent               TSX2  ! X66_ARET

      733     2326    3            END;

   2326  1 000155   200005 235100                    LDA     I,,AUTO
         1 000156   000001 035007                    ADLA    1,DL
         1 000157   200005 755100                    STA     I,,AUTO
         1 000160   200007 470500                    LDP0    P$,,AUTO
         1 000161   000000 236100                    LDQ     0,,PR0
         1 000162   000022 772000                    QRL     18
         1 000163   200005 116100                    CMPQ    I,,AUTO
         1 000164   000166 600000 1                  TZE     s:2327
         1 000165   000143 603000 1                  TRC     s:2325

      734     2327    2         Q$=P$;

PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:158  
   2327  1 000166   200007 236100                    LDQ     P$,,AUTO
         1 000167   200006 756100                    STQ     Q$,,AUTO

      735     2328    2         P$=PINCRW(F$CFU$,FM$PU.LINKX);

   2328  1 000170   000000 720100                    LXL0    0,,PR0
         1 000171   000000 636010                    EAQ     0,X0
         1 000172   000000 036000 xsym               ADLQ    F$CFU$
         1 000173   200007 756100                    STQ     P$,,AUTO

      736     2329    2         END;

   2329  1 000174   000000 116000 xsym               CMPQ    F$CFU$
         1 000175   000141 601000 1                  TNZ     s:2324

      737     2330    1      CALL CHKNEW ALTRET(RETALT);

   2330  1 000176   000235 701000 1                  TSX1    CHKNEW
         1 000177   000302 702000 1                  TSX2    RETALT

      738     2331    2      IF FM$QU.NUM=14 THEN DO;

   2331  1 000200   200006 470500                    LDP0    Q$,,AUTO
         1 000201   000000 220100                    LDX0    0,,PR0
         1 000202   000016 100003                    CMPX0   14,DU
         1 000203   000221 601000 1                  TNZ     s:2336

      739     2332    2         P$=Q$;

   2332  1 000204   200006 236100                    LDQ     Q$,,AUTO
         1 000205   200007 756100                    STQ     P$,,AUTO

      740     2333    2         CALL FMR$GA(Q$,I)ALTRET(FMPE$NOCFUS);

   2333  1 000206   200005 631500                    EPPR1   I,,AUTO
         1 000207   200017 451500                    STP1    DISM+6,,AUTO
         1 000210   200006 633500                    EPPR3   Q$,,AUTO
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:159  
         1 000211   200016 453500                    STP3    DISM+5,,AUTO
         1 000212   200016 630500                    EPPR0   DISM+5,,AUTO
         1 000213   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000214   000000 701000 xent               TSX1    FMR$GA
         1 000215   000277 702000 1                  TSX2    FMPE$NOCFUS

      741     2334    2         FM$PU.LINKX=I;

   2334  1 000216   200005 720100                    LXL0    I,,AUTO
         1 000217   200007 470500                    LDP0    P$,,AUTO
         1 000220   000000 440100                    SXL0    0,,PR0

      742     2335    2         END;

      743     2336    1      FM$QU.SYSID(FM$QU.NUM)=SYSID;

   2336  1 000221   200006 470500                    LDP0    Q$,,AUTO
         1 000222   000000 236100                    LDQ     0,,PR0
         1 000223   000022 772000                    QRL     18
         1 000224   000001 736000                    QLS     1
         1 000225   000106 101500                    MRL     fill='000'O
         1 000226   200010 000004                    ADSC9   SYSID,,AUTO              cn=0,n=4
         1 000227   000001 000002                    ADSC9   1,Q,PR0                  cn=0,n=2

      744     2337    1      FM$QU.NUM=FM$QU.NUM+1;

   2337  1 000230   200006 470500                    LDP0    Q$,,AUTO
         1 000231   000000 220100                    LDX0    0,,PR0
         1 000232   000001 621010                    EAX1    1,X0
         1 000233   000000 741100                    STX1    0,,PR0

      745     2338    1      RETURN;

   2338  1 000234   000000 702200 xent               TSX2  ! X66_ARET

      746     2339    1   CHKNEW: PROC ALTRET;

PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:160  
   2339  1 000235   200014 741300       CHKNEW       STX1  ! DISM+3,,AUTO

      747     2340    2      IF FR_DPREQ~=0 THEN

   2340  1 000236   000004 235000 0                  LDA     FR_DPREQ
         1 000237   000250 600000 1                  TZE     s:2342

      748     2341    2         IF B$JIT.MODE=%M_BATCH# AND I~=FM_SYSSETX THEN GOTO FMPE$NORSNN;

   2341  1 000240   000000 470400 xsym               LDP0    B$JIT$
         1 000241   000000 236100                    LDQ     0,,PR0
         1 000242   740000 376003                    ANQ     -16384,DU
         1 000243   040000 116003                    CMPQ    16384,DU
         1 000244   000250 601000 1                  TNZ     s:2342
         1 000245   200005 236100                    LDQ     I,,AUTO
         1 000246   000000 116000 xsym               CMPQ    FM_SYSSETX
         1 000247   000273 601000 1                  TNZ     FMPE$NORSNN

      749     2342    2      IF FM$SET.XCL AND FM$SET.SYSID~=0 THEN GOTO FMPE$XCLSET;

   2342  1 000250   200003 470500                    LDP0    @FM$SET,,AUTO
         1 000251   000002 234100                    SZN     2,,PR0
         1 000252   000255 605000 1                  TPL     s:2343
         1 000253   000002 720100                    LXL0    2,,PR0
         1 000254   000266 601000 1                  TNZ     FMPE$XCLSET

      750     2343    2      IF NOT FM$SET.NONEWU THEN RETURN;

   2343  1 000255   000002 236100                    LDQ     2,,PR0
         1 000256   040000 316003                    CANQ    16384,DU
         1 000257   000261 601000 1                  TNZ     FMPE$NONEWU

   2343  1 000260   000001 702211                    TSX2  ! 1,X1

      751     2344                    /*  ERRORS */
      752     2345    2   FMPE$NONEWU: B$JIT.ERR=FMP$E$NONEWU;

PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:161  
   2345  1 000261   000000 236000 0     FMPE$NONEWU  LDQ     FMP$E$NONEWU
         1 000262   000000 471400 xsym               LDP1    B$JIT$
         1 000263   100012 756100                    STQ     10,,PR1

      753     2346    2      ALTRETURN;

   2346  1 000264   200014 221300                    LDX1  ! DISM+3,,AUTO
         1 000265   000000 702211                    TSX2  ! 0,X1

      754     2347    2   FMPE$XCLSET: B$JIT.ERR=FMP$E$XCLSET;

   2347  1 000266   000003 236000 0     FMPE$XCLSET  LDQ     FMP$E$XCLSET
         1 000267   000000 471400 xsym               LDP1    B$JIT$
         1 000270   100012 756100                    STQ     10,,PR1

      755     2348    2      ALTRETURN;

   2348  1 000271   200014 221300                    LDX1  ! DISM+3,,AUTO
         1 000272   000000 702211                    TSX2  ! 0,X1

      756     2349    2   FMPE$NORSNN: B$JIT.ERR=FMP$E$NORSNN;

   2349  1 000273   000002 236000 0     FMPE$NORSNN  LDQ     FMP$E$NORSNN
         1 000274   000012 756100                    STQ     10,,PR0

      757     2350                    /*E*     ERROR: FMP-E$NORSNN-E
      758     2351                    *        MESSAGE:Batch access to packset% DP#%SN% must be requested.
      759     2352                    *       MESSAGE1:Packset% DP#%SN% was not listed on a !RESOURCE command
      760     2353                    *        and is not the system set or your HPSN (home packset).
      761     2354                    */
      762     2355    2      ALTRETURN;

   2355  1 000275   200014 221300                    LDX1  ! DISM+3,,AUTO
         1 000276   000000 702211                    TSX2  ! 0,X1

      763     2356    2   END CHKNEW;
      764     2357    1   FMPE$NOCFUS: B$JIT.ERR=FMP$E$NOCFUS;
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:162  

   2357  1 000277   000001 236000 0     FMPE$NOCFUS  LDQ     FMP$E$NOCFUS
         1 000300   000000 470400 xsym               LDP0    B$JIT$
         1 000301   000012 756100                    STQ     10,,PR0

   2355  1 000302                       RETALT       null
      765     2358    1   RETALT:;
      766     2359    1      ALTRETURN;

   2359  1 000302   000000 702200 xent               TSX2  ! X66_AALT

      767     2360        %EJECT;
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:163  
      768     2361    1   FMP$UDLIST:ENTRY(FM$SET,J)ALTRET;

   2361  1 000303   000000 700200 xent  FMP$UDLIST   TSX0  ! X66_AUTO_2
         1 000304   000022 000002                    ZERO    18,2

      769     2362    2      IF ADDR(J)=ADDR(NIL) THEN DO;

   2362  1 000305   200004 236100                    LDQ     @J,,AUTO
         1 000306   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000307   000320 601000 1                  TNZ     s:2366

      770     2363    2         SYSID=B$JIT.SYSID;

   2363  1 000310   000000 470400 xsym               LDP0    B$JIT$
         1 000311   000000 236100                    LDQ     0,,PR0
         1 000312   777777 376007                    ANQ     -1,DL
         1 000313   200010 756100                    STQ     SYSID,,AUTO

      771     2364    2         CALL FMR$L8;

   2364  1 000314   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000315   000000 701000 xent               TSX1    FMR$L8
         1 000316   000000 011000                    NOP     0

      772     2365    2         END;

   2365  1 000317   000323 710000 1                  TRA     s:2367

      773     2366    1      ELSE SYSID=J;

   2366  1 000320   200004 470500                    LDP0    @J,,AUTO
         1 000321   000000 235100                    LDA     0,,PR0
         1 000322   200010 755100                    STA     SYSID,,AUTO

      774     2367    1      Q$=ADDR(FM$SET.USERLIST);

   2367  1 000323   200003 236100                    LDQ     @FM$SET,,AUTO
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:164  
         1 000324   000003 036000 2                  ADLQ    3
         1 000325   200006 756100                    STQ     Q$,,AUTO

      775     2368    2      IF FM$SET.ONEU THEN DO;

   2368  1 000326   200003 470500                    LDP0    @FM$SET,,AUTO
         1 000327   000002 236100                    LDQ     2,,PR0
         1 000330   000001 316003                    CANQ    1,DU
         1 000331   000341 600000 1                  TZE     s:2372

      776     2369    2         IF FM$SET.SYSID=SYSID THEN FM$SET.SYSID=0;

   2369  1 000332   000002 236100                    LDQ     2,,PR0
         1 000333   777777 376007                    ANQ     -1,DL
         1 000334   200010 116100                    CMPQ    SYSID,,AUTO
         1 000335   000340 601000 1                  TNZ     s:2370

   2369  1 000336   000000 220003                    LDX0    0,DU
         1 000337   000002 440100                    SXL0    2,,PR0

      777     2370    2         GOTO RETRET;

   2370  1 000340   000504 710000 1                  TRA     RETRET

      778     2371    2         END;
      779     2372    1      P$=PINCRW(F$CFU$,FM$SET.USERLIST);

   2372  1 000341   000002 720100                    LXL0    2,,PR0
         1 000342   000000 636010                    EAQ     0,X0
         1 000343   000000 036000 xsym               ADLQ    F$CFU$
         1 000344   200007 756100                    STQ     P$,,AUTO

      780     2373    2      DO WHILE(P$~=F$CFU$);

   2373  1 000345   000000 116000 xsym               CMPQ    F$CFU$
         1 000346   000504 600000 1                  TZE     RETRET

PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:165  
      781     2374    3         DO I=0 TO FM$PU.NUM-1;

   2374  1 000347   200005 450100                    STZ     I,,AUTO
         1 000350   000466 710000 1                  TRA     s:2397+3

      782     2375    4            IF FM$PU.SYSID(I)=SYSID THEN DO;

   2375  1 000351   200005 235100                    LDA     I,,AUTO
         1 000352   000001 735000                    ALS     1
         1 000353   200007 470500                    LDP0    P$,,AUTO
         1 000354   000100 101505                    MRL     fill='000'O
         1 000355   000001 000002                    ADSC9   1,A,PR0                  cn=0,n=2
         1 000356   200016 000004                    ADSC9   DISM+5,,AUTO             cn=0,n=4
         1 000357   200016 236100                    LDQ     DISM+5,,AUTO
         1 000360   200010 116100                    CMPQ    SYSID,,AUTO
         1 000361   000463 601000 1                  TNZ     s:2397

      783     2376    5               IF FM$PU.NUM=1 THEN DO;

   2376  1 000362   000000 220100                    LDX0    0,,PR0
         1 000363   000001 100003                    CMPX0   1,DU
         1 000364   000377 601000 1                  TNZ     s:2381

      784     2377    5                  CALL FMR$ZA(P$);

   2377  1 000365   200007 631500                    EPPR1   P$,,AUTO
         1 000366   200016 451500                    STP1    DISM+5,,AUTO
         1 000367   200016 630500                    EPPR0   DISM+5,,AUTO
         1 000370   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000371   000000 701000 xent               TSX1    FMR$ZA
         1 000372   000000 011000                    NOP     0

      785     2378    5                  FM$QU.LINKX=0;

   2378  1 000373   000000 220003                    LDX0    0,DU
         1 000374   200006 470500                    LDP0    Q$,,AUTO
         1 000375   000000 440100                    SXL0    0,,PR0
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:166  

      786     2379    5                  GOTO RETRET;

   2379  1 000376   000504 710000 1                  TRA     RETRET

      787     2380    5                  END;
      788     2381    5               IF FM$PU.LINKX=0 THEN DO;

   2381  1 000377   000000 721100                    LXL1    0,,PR0
         1 000400   000446 601000 1                  TNZ     s:2392

      789     2382    5                  FM$PU.NUM=FM$PU.NUM-1;

   2382  1 000401   777777 622010                    EAX2    -1,X0
         1 000402   000000 742100                    STX2    0,,PR0

      790     2383    5                  FM$PU.SYSID(I)=FM$PU.SYSID(FM$PU.NUM);

   2383  1 000403   200007 470500                    LDP0    P$,,AUTO
         1 000404   000000 236100                    LDQ     0,,PR0
         1 000405   000022 772000                    QRL     18
         1 000406   000001 736000                    QLS     1
         1 000407   200005 235100                    LDA     I,,AUTO
         1 000410   000001 735000                    ALS     1
         1 000411   000105 100506                    MLR     fill='000'O
         1 000412   000001 000002                    ADSC9   1,Q,PR0                  cn=0,n=2
         1 000413   000001 000002                    ADSC9   1,A,PR0                  cn=0,n=2

      791     2384    6                  IF FM$PU.NUM=1 AND Q$=ADDR(FM$SET.USERLIST) THEN DO;

   2384  1 000414   200007 470500                    LDP0    P$,,AUTO
         1 000415   000000 220100                    LDX0    0,,PR0
         1 000416   000001 100003                    CMPX0   1,DU
         1 000417   000445 601000 1                  TNZ     s:2390
         1 000420   200003 236100                    LDQ     @FM$SET,,AUTO
         1 000421   000003 036000 2                  ADLQ    3
         1 000422   200006 116100                    CMPQ    Q$,,AUTO
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:167  
         1 000423   000445 601000 1                  TNZ     s:2390

      792     2385    6                     FM$SET.ONEU='1'B;

   2385  1 000424   200003 471500                    LDP1    @FM$SET,,AUTO
         1 000425   000001 236003                    LDQ     1,DU
         1 000426   100002 256100                    ORSQ    2,,PR1

      793     2386    6                     FM$SET.SYSID=FM$PU.SYSID(0);

   2386  1 000427   200007 470500                    LDP0    P$,,AUTO
         1 000430   000001 220100                    LDX0    1,,PR0
         1 000431   100002 440100                    SXL0    2,,PR1

      794     2387    6                     FM$SET.XCL=FM$SET.NONEWU;

   2387  1 000432   100002 236100                    LDQ     2,,PR1
         1 000433   000003 736000                    QLS     3
         1 000434   100002 676100                    ERQ     2,,PR1
         1 000435   400000 376003                    ANQ     -131072,DU
         1 000436   100002 656100                    ERSQ    2,,PR1

      795     2388    6                     CALL FMR$ZA(P$);

   2388  1 000437   200007 630500                    EPPR0   P$,,AUTO
         1 000440   200016 450500                    STP0    DISM+5,,AUTO
         1 000441   200016 630500                    EPPR0   DISM+5,,AUTO
         1 000442   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000443   000000 701000 xent               TSX1    FMR$ZA
         1 000444   000000 011000                    NOP     0

      796     2389    6                     END;

      797     2390    5                  GOTO RETRET;

   2390  1 000445   000504 710000 1                  TRA     RETRET

PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:168  
      798     2391    5                  END;
      799     2392    4               Q$=PINCRW(F$CFU$,FM$PU.LINKX);

   2392  1 000446   000000 636011                    EAQ     0,X1
         1 000447   000000 036000 xsym               ADLQ    F$CFU$
         1 000450   200006 756100                    STQ     Q$,,AUTO

      800     2393    4               FM$PU.SYSID(I)=FM$QU.SYSID(0);

   2393  1 000451   200006 471500                    LDP1    Q$,,AUTO
         1 000452   000105 100500                    MLR     fill='000'O
         1 000453   100001 000002                    ADSC9   1,,PR1                   cn=0,n=2
         1 000454   000001 000002                    ADSC9   1,A,PR0                  cn=0,n=2

      801     2394    4               SYSID=FM$QU.SYSID(0);

   2394  1 000455   200006 470500                    LDP0    Q$,,AUTO
         1 000456   000001 236100                    LDQ     1,,PR0
         1 000457   000022 772000                    QRL     18
         1 000460   200010 756100                    STQ     SYSID,,AUTO

      802     2395    4               I=14;

   2395  1 000461   000016 235007                    LDA     14,DL
         1 000462   200005 755100                    STA     I,,AUTO

      803     2396    4               END;

      804     2397    3            END;

   2397  1 000463   200005 235100                    LDA     I,,AUTO
         1 000464   000001 035007                    ADLA    1,DL
         1 000465   200005 755100                    STA     I,,AUTO
         1 000466   200007 470500                    LDP0    P$,,AUTO
         1 000467   000000 236100                    LDQ     0,,PR0
         1 000470   000022 772000                    QRL     18
         1 000471   200005 116100                    CMPQ    I,,AUTO
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:169  
         1 000472   000474 600000 1                  TZE     s:2398
         1 000473   000351 603000 1                  TRC     s:2375

      805     2398    2         Q$=P$;

   2398  1 000474   200007 236100                    LDQ     P$,,AUTO
         1 000475   200006 756100                    STQ     Q$,,AUTO

      806     2399    2         P$=PINCRW(F$CFU$,FM$PU.LINKX);

   2399  1 000476   000000 720100                    LXL0    0,,PR0
         1 000477   000000 636010                    EAQ     0,X0
         1 000500   000000 036000 xsym               ADLQ    F$CFU$
         1 000501   200007 756100                    STQ     P$,,AUTO

      807     2400    2         END;

   2400  1 000502   000000 116000 xsym               CMPQ    F$CFU$
         1 000503   000347 601000 1                  TNZ     s:2374

   2393  1 000504                       RETRET       null
      808     2401    1   RETRET:;
      809     2402    2      IF FM$SET.SYSID=0 THEN DO;

   2402  1 000504   200003 470500                    LDP0    @FM$SET,,AUTO
         1 000505   000002 720100                    LXL0    2,,PR0
         1 000506   000613 601000 1                  TNZ     s:2420

      810     2403    2         FM$SET.XCL='1'B;

   2403  1 000507   400000 236003                    LDQ     -131072,DU
         1 000510   000002 256100                    ORSQ    2,,PR0

      811     2404    2         FM$SET.NONEWU='0'B;

   2404  1 000511   000004 236000 2                  LDQ     4
         1 000512   000002 356100                    ANSQ    2,,PR0
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:170  

      812     2405    2         FM$SET.DSMTF='0'B;

   2405  1 000513   000005 236000 2                  LDQ     5
         1 000514   000002 356100                    ANSQ    2,,PR0

      813     2406    2         Q$=ADDR(FM$VOL(FM$SET.DCTX));

   2406  1 000515   000000 236100                    LDQ     0,,PR0
         1 000516   000017 772000                    QRL     15
         1 000517   000000 376000 2                  ANQ     0
         1 000520   000022 736000                    QLS     18
         1 000521   000000 036000 xsym               ADLQ    F$CFU$
         1 000522   200006 756100                    STQ     Q$,,AUTO

      814     2407    3         IF Q$VOL.DCTX~=FM$SET.DCTX THEN DO WHILE(Q$~=F$CFU$);

   2407  1 000523   200006 471500                    LDP1    Q$,,AUTO
         1 000524   100000 220100                    LDX0    0,,PR1
         1 000525   000000 100100                    CMPX0   0,,PR0
         1 000526   000613 600000 1                  TZE     s:2420

   2407  1 000527   000000 116000 xsym               CMPQ    F$CFU$
         1 000530   000613 600000 1                  TZE     s:2420

      815     2408    3            I=FM$DEV.SECTL(Q$VOL.DCTX);

   2408  1 000531   200006 470500                    LDP0    Q$,,AUTO
         1 000532   000000 236100                    LDQ     0,,PR0
         1 000533   000017 772000                    QRL     15
         1 000534   000000 376000 2                  ANQ     0
         1 000535   000000 471400 xsym               LDP1    F$CFU$
         1 000536   100005 236106                    LDQ     5,QL,PR1
         1 000537   777777 376007                    ANQ     -1,DL
         1 000540   200005 756100                    STQ     I,,AUTO

      816     2409    4            DO WHILE(I~=0);
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:171  

   2409  1 000541   000560 600000 1                  TZE     s:2414

      817     2410    4               IF FM$VOL.SETX(I)~=0 AND FM$VOL.SYSID(FM$VOL.SETX(I))~=0

   2410  1 000542   200005 235100                    LDA     I,,AUTO
         1 000543   000003 735000                    ALS     3
         1 000544   000000 470400 xsym               LDP0    F$CFU$
         1 000545   000000 720105                    LXL0    0,AL,PR0
         1 000546   000554 600000 1                  TZE     s:2412
         1 000547   000000 236105                    LDQ     0,AL,PR0
         1 000550   000003 736000                    QLS     3
         1 000551   000000 376000 2                  ANQ     0
         1 000552   000002 721106                    LXL1    2,QL,PR0
         1 000553   000602 601000 1                  TNZ     STILLOPN

      818     2411    4               THEN GOTO STILLOPN;
      819     2412    4               I=FM$VOL.SECTL(I);

   2412  1 000554   000005 236105                    LDQ     5,AL,PR0
         1 000555   777777 376007                    ANQ     -1,DL
         1 000556   200005 756100                    STQ     I,,AUTO

      820     2413    4               END;

   2413  1 000557   000542 601000 1                  TNZ     s:2410

      821     2414    3            P$=N$DCT$(Q$VOL.DCTX)->NI$DCT.RAT$;

   2414  1 000560   200006 470500                    LDP0    Q$,,AUTO
         1 000561   000000 220100                    LDX0    0,,PR0
         1 000562   000000 471400 xsym               LDP1    N$DCT$$
         1 000563   100000 473510                    LDP3    0,X0,PR1
         1 000564   300005 236100                    LDQ     5,,PR3
         1 000565   200007 756100                    STQ     P$,,AUTO

      822     2415    3            FR$RAT.FLG.OPN='0'B;
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:172  

   2415  1 000566   200007 473500                    LDP3    P$,,AUTO
         1 000567   000006 236000 2                  LDQ     6
         1 000570   300010 356100                    ANSQ    8,,PR3

      823     2416    3            IF FM$SET.DIAGOPN OR Q$VOL.SECT#~=0 THEN FR$RAT.FLG.MBIT='0'B;

   2416  1 000571   200003 474500                    LDP4    @FM$SET,,AUTO
         1 000572   400002 236100                    LDQ     2,,PR4
         1 000573   004000 316003                    CANQ    2048,DU
         1 000574   000600 601000 1                  TNZ     s:2416+7
         1 000575   000001 236100                    LDQ     1,,PR0
         1 000576   777000 316003                    CANQ    -512,DU
         1 000577   000602 600000 1                  TZE     STILLOPN

   2416  1 000600   000007 236000 2                  LDQ     7
         1 000601   300010 356100                    ANSQ    8,,PR3

      824     2417    3   STILLOPN:Q$=ADDR(FM$VOL(Q$VOL.VOLL));

   2417  1 000602   200006 470500       STILLOPN     LDP0    Q$,,AUTO
         1 000603   000005 236100                    LDQ     5,,PR0
         1 000604   000017 772000                    QRL     15
         1 000605   000000 376000 2                  ANQ     0
         1 000606   000022 736000                    QLS     18
         1 000607   000000 036000 xsym               ADLQ    F$CFU$
         1 000610   200006 756100                    STQ     Q$,,AUTO

      825     2418    3            END;

   2418  1 000611   000000 116000 xsym               CMPQ    F$CFU$
         1 000612   000531 601000 1                  TNZ     s:2408

      826     2419    2         END;

      827     2420    2      IF FM$SET.NONEWU AND FM$SET.SYSID=JG_PIG# THEN DO;

PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:173  
   2420  1 000613   200003 470500                    LDP0    @FM$SET,,AUTO
         1 000614   000002 236100                    LDQ     2,,PR0
         1 000615   040000 316003                    CANQ    16384,DU
         1 000616   000661 600000 1                  TZE     s:2430
         1 000617   000002 720100                    LXL0    2,,PR0
         1 000620   000007 100003                    CMPX0   7,DU
         1 000621   000661 601000 1                  TNZ     s:2430

      828     2421    2         FM$SET.XCL='1'B;

   2421  1 000622   400000 236003                    LDQ     -131072,DU
         1 000623   000002 256100                    ORSQ    2,,PR0

      829     2422    2         IF B$JIT.USER=JG_PIG# THEN EXIT;

   2422  1 000624   000000 471400 xsym               LDP1    B$JIT$
         1 000625   100000 236100                    LDQ     0,,PR1
         1 000626   000777 376003                    ANQ     511,DU
         1 000627   000007 116003                    CMPQ    7,DU
         1 000630   000661 600000 1                  TZE     s:2430

      830     2423    2         CALL FMR$U8;

   2423  1 000631   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000632   000000 701000 xent               TSX1    FMR$U8
         1 000633   000000 011000                    NOP     0

      831     2424    2         DISM.PSN=FM$SET.PSN;

   2424  1 000634   200003 470500                    LDP0    @FM$SET,,AUTO
         1 000635   040100 100500                    MLR     fill='040'O
         1 000636   000000 400006                    ADSC9   0,,PR0                   cn=2,n=6
         1 000637   200012 000006                    ADSC9   DISM+1,,AUTO             cn=0,n=6

      832     2425    2         DISM.CATTR=K_DISK;

   2425  1 000640   100000 220003                    LDX0    32768,DU
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:174  
         1 000641   200011 440100                    SXL0    DISM,,AUTO

      833     2426    2         DISM.CODE=%SETDSMTX#;

   2426  1 000642   000015 221003                    LDX1    13,DU
         1 000643   200011 741100                    STX1    DISM,,AUTO

      834     2427    2         CALL KUW$WRITE(DISM,10,J_PIG);

   2427  1 000644   000010 236000 2                  LDQ     8
         1 000645   200020 756100                    STQ     DISM+7,,AUTO
         1 000646   000011 236000 2                  LDQ     9
         1 000647   200017 756100                    STQ     DISM+6,,AUTO
         1 000650   200011 631500                    EPPR1   DISM,,AUTO
         1 000651   200016 451500                    STP1    DISM+5,,AUTO
         1 000652   200016 630500                    EPPR0   DISM+5,,AUTO
         1 000653   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000654   000000 701000 xent               TSX1    KUW$WRITE
         1 000655   000000 011000                    NOP     0

      835     2428    2         CALL FMR$L8;

   2428  1 000656   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000657   000000 701000 xent               TSX1    FMR$L8
         1 000660   000000 011000                    NOP     0

      836     2429    2         END;

      837     2430    1      IF ADDR(J)=ADDR(NIL) THEN CALL FMR$U8;

   2430  1 000661   200004 236100                    LDQ     @J,,AUTO
         1 000662   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000663   000667 601000 1                  TNZ     s:2431

   2430  1 000664   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000665   000000 701000 xent               TSX1    FMR$U8
         1 000666   000000 011000                    NOP     0
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:175  

      838     2431    1      RETURN;

   2431  1 000667   000000 702200 xent               TSX2  ! X66_ARET

FMP$E$NONEWU
 Sect OctLoc
   0     000   061520 001522                                                    1...

FMP$E$NOCFUS
 Sect OctLoc
   0     001   061520 001572                                                    1...

FMP$E$NORSNN
 Sect OctLoc
   0     002   061520 012322                                                    1...

FMP$E$XCLSET
 Sect OctLoc
   0     003   061520 002172                                                    1..z

FR_DPREQ
 Sect OctLoc
   0     004   000000 000000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000007 777770   773777 777777   777776 777777   000002 400000    ................
   2     004   737777 777777   757777 777777   777777 777757   777777 777077    ...............?
   2     010   000000 006000   000014 006000                                    ........
      839     2432    1   END FMP$ULIST;
      840     2433        %EOD;

PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:176  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   FR_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMP$ULIST.
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:177  

 **** Variables and constants ****

  ****  Section 000 RoData FMP$ULIST

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     1-0-0/b STRC        r     1 FMP$E$NOCFUS               0-0-0/b STRC        r     1 FMP$E$NONEWU
     2-0-0/b STRC        r     1 FMP$E$NORSNN               3-0-0/b STRC        r     1 FMP$E$XCLSET
     4-0-0/w UBIN        r     1 FR_DPREQ

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FM$SET                    4-0-0/w PTR         r     1 @J
    11-0-0/c STRC(90)    r     1 DISM                      *0-0-0/w STRC(288)   r     1 FM$SET
     5-0-0/w UBIN        r     1 I                         *0-0-0/w UBIN        r     1 J
     7-0-0/w PTR         r     1 P$                         6-0-0/w PTR         r     1 Q$
    10-0-0/w UBIN        r     1 SYSID

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w UBIN        r     1 FM_SYSSETX                 0-0-0/d CHAR(8)     r     1 J_PIG
     0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(288)   r     1 FM$DEV(0:0)
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:178  
     0-0-0/w STRC(288)   r     1 FM$PU                      0-0-0/w STRC(288)   r     1 FM$QU
     0-0-0/w STRC(288)   r     1 FM$VOL(0:0)                0-0-0/w STRC(324)   r     1 FR$RAT
     0-0-0/w PTR         r     1 N$DCT$(0:0)                0-0-0/w STRC(1332)  r     1 NI$DCT
     0-0-0/w STRC(288)   r     1 Q$VOL


   Procedure FMP$ULIST requires 440 words for executable code.
   Procedure FMP$ULIST requires 18 words of local(AUTO) storage.
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:179  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:180  
          MINI XREF LISTING

B$JIT.ERR
       347**DCL      2345<<ASSIGN   2347<<ASSIGN   2349<<ASSIGN   2357<<ASSIGN
B$JIT.ERR.MID
       348**DCL       348--REDEF
B$JIT.MODE
       342**DCL      2341>>IF
B$JIT.SYSID
       347**DCL      2288>>ASSIGN   2363>>ASSIGN
B$JIT.USER
       347**DCL      2422>>IF
B$JIT$
      2232**DCL       342--IMP-PTR  2288>>ASSIGN   2341>>IF       2345>>ASSIGN   2347>>ASSIGN   2349>>ASSIGN
      2357>>ASSIGN   2363>>ASSIGN   2422>>IF
CHKNEW
      2339**PROC     2291--CALL     2315--CALL     2330--CALL
DISM
      2283**DCL      2427<>CALL
DISM.CATTR
      2285**DCL      2425<<ASSIGN
DISM.CODE
      2284**DCL      2426<<ASSIGN
DISM.PSN
      2286**DCL      2424<<ASSIGN
F$CFU$
      2228**DCL       837--IMP-PTR   843--IMP-PTR  2297>>IF       2301>>IF       2302>>ASSIGN   2308>>ASSIGN
      2322>>ASSIGN   2323>>DOWHILE  2328>>ASSIGN   2372>>ASSIGN   2373>>DOWHILE  2392>>ASSIGN   2399>>ASSIGN
      2406>>ASSIGN   2407>>DOWHILE  2408>>ASSIGN   2410>>IF       2410>>IF       2410>>IF       2412>>ASSIGN
      2417>>ASSIGN
FM$DEV.DCTX
       837**DCL      2297>>IF
FM$DEV.SECTL
       839**DCL      2408>>ASSIGN
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:181  
FM$DEV.USERLIST
       838**DCL       839--REDEF
FM$PU.LINKX
       834**DCL      2328>>ASSIGN   2334<<ASSIGN   2381>>IF       2392>>ASSIGN   2399>>ASSIGN
FM$PU.NUM
       834**DCL      2324>>DOINDEX  2374>>DOINDEX  2376>>IF       2382<<ASSIGN   2382>>ASSIGN   2383>>ASSIGN
      2384>>IF
FM$PU.SYSID
       834**DCL      2325>>IF       2375>>IF       2383<<ASSIGN   2383>>ASSIGN   2386>>ASSIGN   2393<<ASSIGN
FM$QU.LINKX
       831**DCL      2378<<ASSIGN
FM$QU.NUM
       831**DCL      2317<<ASSIGN   2331>>IF       2336>>ASSIGN   2337<<ASSIGN   2337>>ASSIGN
FM$QU.SYSID
       831**DCL      2319<<ASSIGN   2336<<ASSIGN   2393>>ASSIGN   2394>>ASSIGN
FM$SET
       826**DCL        19--PROC     2361--ENTRY
FM$SET.DCTX
       826**DCL      2297>>IF       2297>>IF       2297>>IF       2299>>ASSIGN   2406>>ASSIGN   2407>>IF
FM$SET.DIAGOPN
       827**DCL      2298<<ASSIGN   2416>>IF
FM$SET.DSMTF
       826**DCL      2405<<ASSIGN
FM$SET.NONEWU
       826**DCL      2343>>IF       2387>>ASSIGN   2404<<ASSIGN   2420>>IF
FM$SET.ONEU
       827**DCL      2295<<ASSIGN   2313>>IF       2318<<ASSIGN   2368>>IF       2385<<ASSIGN
FM$SET.PSN
       826**DCL      2424>>ASSIGN
FM$SET.SYSID
       827**DCL      2296<<ASSIGN   2314>>IF       2319>>ASSIGN   2342>>IF       2369>>IF       2369<<ASSIGN
      2386<<ASSIGN   2402>>IF       2420>>IF
FM$SET.USERLIST
       827**DCL       827--REDEF    2290>>IF       2320<<ASSIGN   2322>>ASSIGN   2367--ASSIGN   2372>>ASSIGN
      2384--IF
FM$SET.XCL
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:182  
       826**DCL      2342>>IF       2387<<ASSIGN   2403<<ASSIGN   2421<<ASSIGN
FM$VOL
       843**DCL      2406--ASSIGN   2417--ASSIGN
FM$VOL.DCTX
       843**DCL      2302>>ASSIGN
FM$VOL.SECT#
       843**DCL      2301>>IF
FM$VOL.SECTL
       845**DCL      2412>>ASSIGN
FM$VOL.SETX
       843**DCL      2410>>IF       2410>>IF
FM$VOL.SYSID
       845**DCL      2410>>IF
FM$VOL.USERLIST
       844**DCL       845--REDEF
FM$VOL.VOLL
       845**DCL      2308>>ASSIGN
FMP$E$NOCFUS
      2217**DCL      2357>>ASSIGN
FMP$E$NONEWU
      2213**DCL      2345>>ASSIGN
FMP$E$NORSNN
      2221**DCL      2349>>ASSIGN
FMP$E$XCLSET
      2225**DCL      2347>>ASSIGN
FMPE$NOCFUS
      2357**LABEL    2316--CALLALT  2333--CALLALT
FMPE$NORSNN IN PROCEDURE CHKNEW
      2349**LABEL    2341--GOTO
FMPE$XCLSET IN PROCEDURE CHKNEW
      2347**LABEL    2342--GOTO
FMR$GA
      2271**DCL-ENT  2316--CALL     2333--CALL
FMR$L8
      2273**DCL-ENT  2364--CALL     2428--CALL
FMR$U8
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:183  
      2274**DCL-ENT  2423--CALL     2430--CALL
FMR$ZA
      2272**DCL-ENT  2377--CALL     2388--CALL
FM_SYSSETX
      2231**DCL      2341>>IF
FR$RAT.FLG.MBIT
       936**DCL      2416<<ASSIGN
FR$RAT.FLG.MBIT.MTD
       937**DCL      2305<<ASSIGN
FR$RAT.FLG.OPN
       941**DCL      2304<<ASSIGN   2415<<ASSIGN
FR$RAT.RES.SISID
       912**DCL      2303>>IF
FR_DPREQ
      2280**DCL      2340>>IF
I
      2276**DCL      2299<<ASSIGN   2300>>DOWHILE  2301>>IF       2302>>ASSIGN   2308<<ASSIGN   2308>>ASSIGN
      2316<>CALL     2320>>ASSIGN   2324<<DOINDEX  2325>>IF       2333<>CALL     2334>>ASSIGN   2341>>IF
      2374<<DOINDEX  2375>>IF       2383>>ASSIGN   2393>>ASSIGN   2395<<ASSIGN   2408<<ASSIGN   2409>>DOWHILE
      2410>>IF       2410>>IF       2412<<ASSIGN   2412>>ASSIGN
J
      2277**DCL        19--PROC     2288--IF       2289>>ASSIGN   2361--ENTRY    2362--IF       2366>>ASSIGN
      2430--IF
J_PIG
      2260**DCL      2427<>CALL
KUW$WRITE
      2275**DCL-ENT  2427--CALL
N$DCT$
      2230**DCL      2302>>ASSIGN   2414>>ASSIGN
N$DCT$$
      2229**DCL      2230--IMP-PTR  2302>>ASSIGN   2414>>ASSIGN
NI$DCT.DP
      1192**DCL      1199--REDEF    1202--REDEF    1203--REDEF    1205--REDEF    1205--REDEF    1206--REDEF
      1207--REDEF    1207--REDEF
NI$DCT.MPC.IOCHANX
      1200**DCL      1200--REDEF
PL6.E3A0      #005=FMP$ULIST File=FMP$CLSF.:E05TSI                               TUE 07/29/97 16:58 Page:184  
NI$DCT.RAT$
      1173**DCL      2302>>ASSIGN   2414>>ASSIGN
P$
      2279**DCL       834--IMP-PTR   909--IMP-PTR  2302<<ASSIGN   2303>>IF       2304>>ASSIGN   2305>>ASSIGN
      2322<<ASSIGN   2323>>DOWHILE  2324>>DOINDEX  2325>>IF       2327>>ASSIGN   2328<<ASSIGN   2328>>ASSIGN
      2332<<ASSIGN   2334>>ASSIGN   2372<<ASSIGN   2373>>DOWHILE  2374>>DOINDEX  2375>>IF       2376>>IF
      2377<>CALL     2381>>IF       2382>>ASSIGN   2382>>ASSIGN   2383>>ASSIGN   2383>>ASSIGN   2383>>ASSIGN
      2384>>IF       2386>>ASSIGN   2388<>CALL     2392>>ASSIGN   2393>>ASSIGN   2398>>ASSIGN   2399<<ASSIGN
      2399>>ASSIGN   2414<<ASSIGN   2415>>ASSIGN   2416>>ASSIGN
Q$
      2278**DCL       831--IMP-PTR   849--IMP-PTR  2316<>CALL     2317>>ASSIGN   2319>>ASSIGN   2327<<ASSIGN
      2331>>IF       2332>>ASSIGN   2333<>CALL     2336>>ASSIGN   2336>>ASSIGN   2337>>ASSIGN   2337>>ASSIGN
      2367<<ASSIGN   2378>>ASSIGN   2384>>IF       2392<<ASSIGN   2393>>ASSIGN   2394>>ASSIGN   2398<<ASSIGN
      2406<<ASSIGN   2407>>IF       2407>>DOWHILE  2408>>ASSIGN   2414>>ASSIGN   2416>>IF       2417<<ASSIGN
      2417>>ASSIGN
Q$VOL.DCTX
       849**DCL      2407>>IF       2408>>ASSIGN   2414>>ASSIGN
Q$VOL.SECT#
       849**DCL      2416>>IF
Q$VOL.USERLIST
       850**DCL       851--REDEF
Q$VOL.VOLL
       851**DCL      2417>>ASSIGN
RETALT
      2355**LABEL    2291--CALLALT  2315--CALLALT  2330--CALLALT
RETRET
      2393**LABEL    2370--GOTO     2379--GOTO     2390--GOTO
STILLOPN
      2417**LABEL    2411--GOTO
SYSID
      2282**DCL      2288<<ASSIGN   2289<<ASSIGN   2296>>ASSIGN   2314>>IF       2325>>IF       2336>>ASSIGN
      2363<<ASSIGN   2366<<ASSIGN   2369>>IF       2375>>IF       2394<<ASSIGN

PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:185  
      841        1        /*T***********************************************************/
      842        2        /*T*                                                         */
      843        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      844        4        /*T*                                                         */
      845        5        /*T***********************************************************/
      846        6                    /*F* NAME: FMP$UPFDDESC
      847        7                    *
      848        8                    *    PURPOSE: To update the descriptors in the file directory if they
      849        9                   *        need it, or to catalog a file opened with CTG=YES without losing
      850       10              *        the FIT buffer. JIT points to the DCB, ALTRETURNs if FMQ$CTG does.
      851       11              */
      852       12        FMP$UPFDDESC: PROC ALTRET;
      853       13    1   DCL FMQ$CTG ENTRY(2) ALTRET;
      854       14    1   DCL FMD$FLSHBUF ENTRY(1);
      855       15    1   DCL FDA UBIN;
      856       16    1   DCL BFR BIT(36);
      857       17    1   DCL BFR1 BIT(36);
      858       18    1   DCL ERR BIT(36);
      859       19        %INCLUDE FM$CFU;
      860       64        %FM$CFU;
      861       70        %INCLUDE CP_6_SUBS;
      862      610    1   DCL JDCB$ PTR; /* POINT TO DCB */
      863      611        %MACRO F$DCB#(BASED=BASED);
      864      612        %INCLUDE F$DCB;
      865      661        %MEND;
      866      662        %F$DCB#(BASED="BASED(JDCB$)");
      867      712    1   DCL B$JIT$ PTR SYMREF;
      868      713        %INCLUDE F$JIT_C;
      869     1143        %EJECT;
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:186  
      870     1144                    /* PROCEDURE */
      871     1145    1      JDCB$=B$JIT.DCB$;
      872     1146    1      IF F$DCB.STARF AND MOD(F$DCB.CFU$->FM$CFU.FUN,4)~=%CREATE# THEN RETURN;
      873     1147    1   AFITNTRY:;
      874     1148    1      BFR=F$DCB.BFR(1);
      875     1149    1      BFR1=F$DCB.BFR1(1);
      876     1150    1      F$DCB.BFR(1)='0'B;
      877     1151    1      F$DCB.BFR1(1)='0'B;
      878     1152    1      ERR=B$JIT.ERR;
      879     1153    1      FDA=0;
      880     1154    1      CALL FMQ$CTG(ADDR(F$DCB.NAME),FDA)ALTRET(RETALT);
      881     1155    1      IF F$DCB.BFR.BUFX(1) > 0 THEN
      882     1156    1         CALL FMD$FLSHBUF(1);
      883     1157    1      F$DCB.BFR(1)=BFR;
      884     1158    1      F$DCB.BFR1(1)=BFR1;
      885     1159    1      B$JIT.ERR=ERR;
      886     1160    1      RETURN;
      887     1161    1   RETALT: F$DCB.BFR(1)=BFR;
      888     1162    1      F$DCB.BFR1(1)=BFR1;
      889     1163    1      IF FDA=F$DCB.CFU$->FM$CFU.FITSDA THEN B$JIT.ERR=ERR;
      890     1164    1      ALTRETURN;
      891     1165    1   FMP$AFITCTG: ENTRY ALTRET;
      892     1166                    /*F* NAME: FMP$AFITCTG
      893     1167                    *
      894     1168                    *     PURPOSE: To change a file's disk address in the directory
      895     1169                    *     (used when a file needs an AFIT). Saves BUF(1).
      896     1170                    */
      897     1171    1      JDCB$=B$JIT.DCB$;
      898     1172    1      GOTO AFITNTRY;
      899     1173    1   END FMP$UPFDDESC;
      900     1174        %EOD;

PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:187  
--  Include file information  --

   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$CFU.:E05TOU  is referenced.
      No diagnostics issued in procedure FMP$UPFDDESC.

   Procedure FMP$UPFDDESC requires 75 words for executable code.
   Procedure FMP$UPFDDESC requires 12 words of local(AUTO) storage.

PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:188  

 Object Unit name= FMP$UPFDDESC                               File name= FMP$CLSF.:E05TOU
 UTS= JUL 29 '97 16:59:22.48 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    75    113  FMP$UPFDDESC
    1  RoData even  none     1      1  FMP$UPFDDESC

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        0  FMP$UPFDDESC
     0    105          yes     yes      Std        0  FMP$AFITCTG

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 FMQ$CTG
         yes           Std       1 FMD$FLSHBUF
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                B_VECTNIL
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:189  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:190  


      841        1        /*T***********************************************************/
      842        2        /*T*                                                         */
      843        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      844        4        /*T*                                                         */
      845        5        /*T***********************************************************/
      846        6                    /*F* NAME: FMP$UPFDDESC
      847        7                    *
      848        8                    *    PURPOSE: To update the descriptors in the file directory if they
      849        9                   *       need it, or to catalog a file opened with CTG=YES without losing
      850       10              *        the FIT buffer. JIT points to the DCB, ALTRETURNs if FMQ$CTG does.
      851       11              */
      852       12        FMP$UPFDDESC: PROC ALTRET;

     12  0 000000   000000 700200 xent  FMP$UPFDDESC TSX0  ! X66_AUTO_0
         0 000001   000014 000000                    ZERO    12,0

      853       13    1   DCL FMQ$CTG ENTRY(2) ALTRET;
      854       14    1   DCL FMD$FLSHBUF ENTRY(1);
      855       15    1   DCL FDA UBIN;
      856       16    1   DCL BFR BIT(36);
      857       17    1   DCL BFR1 BIT(36);
      858       18    1   DCL ERR BIT(36);
      859       19        %INCLUDE FM$CFU;
      860       64        %FM$CFU;
      861       70        %INCLUDE CP_6_SUBS;
      862      610    1   DCL JDCB$ PTR; /* POINT TO DCB */
      863      611        %MACRO F$DCB#(BASED=BASED);
      864      612        %INCLUDE F$DCB;
      865      661        %MEND;
      866      662        %F$DCB#(BASED="BASED(JDCB$)");
      867      712    1   DCL B$JIT$ PTR SYMREF;
      868      713        %INCLUDE F$JIT_C;
      869     1143        %EJECT;
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:191  
      870     1144                    /* PROCEDURE */
      871     1145    1      JDCB$=B$JIT.DCB$;

   1145  0 000002   000000 470400 xsym               LDP0    B$JIT$
         0 000003   000232 236100                    LDQ     154,,PR0
         0 000004   200007 756100                    STQ     JDCB$,,AUTO

      872     1146    1      IF F$DCB.STARF AND MOD(F$DCB.CFU$->FM$CFU.FUN,4)~=%CREATE# THEN RETURN;

   1146  0 000005   200007 471500                    LDP1    JDCB$,,AUTO
         0 000006   100064 236100                    LDQ     52,,PR1
         0 000007   200000 316003                    CANQ    65536,DU
         0 000010   000020 600000 0                  TZE     AFITNTRY
         0 000011   100066 473500                    LDP3    54,,PR1
         0 000012   300000 236100                    LDQ     0,,PR3
         0 000013   000041 772000                    QRL     33
         0 000014   000003 376007                    ANQ     3,DL
         0 000015   000003 116007                    CMPQ    3,DL
         0 000016   000020 600000 0                  TZE     AFITNTRY

   1146  0 000017   000000 702200 xent               TSX2  ! X66_ARET

   1146  0 000020                       AFITNTRY     null
      873     1147    1   AFITNTRY:;
      874     1148    1      BFR=F$DCB.BFR(1);

   1148  0 000020   200007 470500                    LDP0    JDCB$,,AUTO
         0 000021   000116 236100                    LDQ     78,,PR0
         0 000022   200004 756100                    STQ     BFR,,AUTO

      875     1149    1      BFR1=F$DCB.BFR1(1);

   1149  0 000023   000123 236100                    LDQ     83,,PR0
         0 000024   200005 756100                    STQ     BFR1,,AUTO

      876     1150    1      F$DCB.BFR(1)='0'B;

PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:192  
   1150  0 000025   000116 450100                    STZ     78,,PR0

      877     1151    1      F$DCB.BFR1(1)='0'B;

   1151  0 000026   000123 450100                    STZ     83,,PR0

      878     1152    1      ERR=B$JIT.ERR;

   1152  0 000027   000000 471400 xsym               LDP1    B$JIT$
         0 000030   100012 236100                    LDQ     10,,PR1
         0 000031   200006 756100                    STQ     ERR,,AUTO

      879     1153    1      FDA=0;

   1153  0 000032   200003 450100                    STZ     FDA,,AUTO

      880     1154    1      CALL FMQ$CTG(ADDR(F$DCB.NAME),FDA)ALTRET(RETALT);

   1154  0 000033   200007 236100                    LDQ     JDCB$,,AUTO
         0 000034   000010 036003                    ADLQ    8,DU
         0 000035   200010 756100                    STQ     JDCB$+1,,AUTO
         0 000036   200003 633500                    EPPR3   FDA,,AUTO
         0 000037   200013 453500                    STP3    JDCB$+4,,AUTO
         0 000040   200010 634500                    EPPR4   JDCB$+1,,AUTO
         0 000041   200012 454500                    STP4    JDCB$+3,,AUTO
         0 000042   200012 630500                    EPPR0   JDCB$+3,,AUTO
         0 000043   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000044   000000 701000 xent               TSX1    FMQ$CTG
         0 000045   000067 702000 0                  TSX2    RETALT

      881     1155    1      IF F$DCB.BFR.BUFX(1) > 0 THEN

   1155  0 000046   200007 470500                    LDP0    JDCB$,,AUTO
         0 000047   000116 236100                    LDQ     78,,PR0
         0 000050   037000 316003                    CANQ    15872,DU
         0 000051   000056 600000 0                  TZE     s:1157

PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:193  
      882     1156    1         CALL FMD$FLSHBUF(1);

   1156  0 000052   000000 630400 1                  EPPR0   0
         0 000053   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000054   000000 701000 xent               TSX1    FMD$FLSHBUF
         0 000055   000000 011000                    NOP     0

      883     1157    1      F$DCB.BFR(1)=BFR;

   1157  0 000056   200004 236100                    LDQ     BFR,,AUTO
         0 000057   200007 470500                    LDP0    JDCB$,,AUTO
         0 000060   000116 756100                    STQ     78,,PR0

      884     1158    1      F$DCB.BFR1(1)=BFR1;

   1158  0 000061   200005 236100                    LDQ     BFR1,,AUTO
         0 000062   000123 756100                    STQ     83,,PR0

      885     1159    1      B$JIT.ERR=ERR;

   1159  0 000063   200006 236100                    LDQ     ERR,,AUTO
         0 000064   000000 471400 xsym               LDP1    B$JIT$
         0 000065   100012 756100                    STQ     10,,PR1

      886     1160    1      RETURN;

   1160  0 000066   000000 702200 xent               TSX2  ! X66_ARET

      887     1161    1   RETALT: F$DCB.BFR(1)=BFR;

   1161  0 000067   200004 236100       RETALT       LDQ     BFR,,AUTO
         0 000070   200007 470500                    LDP0    JDCB$,,AUTO
         0 000071   000116 756100                    STQ     78,,PR0

      888     1162    1      F$DCB.BFR1(1)=BFR1;

   1162  0 000072   200005 236100                    LDQ     BFR1,,AUTO
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:194  
         0 000073   000123 756100                    STQ     83,,PR0

      889     1163    1      IF FDA=F$DCB.CFU$->FM$CFU.FITSDA THEN B$JIT.ERR=ERR;

   1163  0 000074   000066 471500                    LDP1    54,,PR0
         0 000075   100000 236100                    LDQ     0,,PR1
         0 000076   000032 376000 xsym               ANQ     B_VECTNIL+26
         0 000077   200003 116100                    CMPQ    FDA,,AUTO
         0 000100   000104 601000 0                  TNZ     s:1164

   1163  0 000101   200006 236100                    LDQ     ERR,,AUTO
         0 000102   000000 473400 xsym               LDP3    B$JIT$
         0 000103   300012 756100                    STQ     10,,PR3

      890     1164    1      ALTRETURN;

   1164  0 000104   000000 702200 xent               TSX2  ! X66_AALT

      891     1165    1   FMP$AFITCTG: ENTRY ALTRET;

   1165  0 000105   000000 700200 xent  FMP$AFITCTG  TSX0  ! X66_AUTO_0
         0 000106   000014 000000                    ZERO    12,0

      892     1166                    /*F* NAME: FMP$AFITCTG
      893     1167                    *
      894     1168                    *     PURPOSE: To change a file's disk address in the directory
      895     1169                    *     (used when a file needs an AFIT). Saves BUF(1).
      896     1170                    */
      897     1171    1      JDCB$=B$JIT.DCB$;

   1171  0 000107   000000 470400 xsym               LDP0    B$JIT$
         0 000110   000232 236100                    LDQ     154,,PR0
         0 000111   200007 756100                    STQ     JDCB$,,AUTO

      898     1172    1      GOTO AFITNTRY;

   1172  0 000112   000020 710000 0                  TRA     AFITNTRY
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:195  

(unnamed)
 Sect OctLoc
   1     000   000003 006000                                                    ....
      899     1173    1   END FMP$UPFDDESC;
      900     1174        %EOD;

PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:196  
--  Include file information  --

   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$CFU.:E05TOU  is referenced.
      No diagnostics issued in procedure FMP$UPFDDESC.
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:197  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/b BIT         r     1 BFR                        5-0-0/b BIT         r     1 BFR1
     6-0-0/b BIT         r     1 ERR                        3-0-0/w UBIN        r     1 FDA
     7-0-0/w PTR         r     1 JDCB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU


   Procedure FMP$UPFDDESC requires 75 words for executable code.
   Procedure FMP$UPFDDESC requires 12 words of local(AUTO) storage.
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:198  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:199  
          MINI XREF LISTING

AFITNTRY
      1146**LABEL    1172--GOTO
B$JIT.DCB$
      1130**DCL      1145>>ASSIGN   1171>>ASSIGN
B$JIT.ERR
      1040**DCL      1152>>ASSIGN   1159<<ASSIGN   1163<<ASSIGN
B$JIT.ERR.MID
      1041**DCL      1041--REDEF
B$JIT$
       712**DCL      1035--IMP-PTR  1145>>ASSIGN   1152>>ASSIGN   1159>>ASSIGN   1163>>ASSIGN   1171>>ASSIGN
BFR
        16**DCL      1148<<ASSIGN   1157>>ASSIGN   1161>>ASSIGN
BFR1
        17**DCL      1149<<ASSIGN   1158>>ASSIGN   1162>>ASSIGN
ERR
        18**DCL      1152<<ASSIGN   1159>>ASSIGN   1163>>ASSIGN
F$DCB.ACTPOS
       688**DCL       688--REDEF
F$DCB.ARS
       663**DCL       663--REDEF
F$DCB.ATTR
       681**DCL       682--REDEF
F$DCB.BFR
       707**DCL      1148>>ASSIGN   1150<<ASSIGN   1157<<ASSIGN   1161<<ASSIGN
F$DCB.BFR.BUFX
       708**DCL      1155>>IF
F$DCB.BFR1
       708**DCL      1149>>ASSIGN   1151<<ASSIGN   1158<<ASSIGN   1162<<ASSIGN
F$DCB.BORROW
       696**DCL       696--REDEF     696--REDEF     696--REDEF
F$DCB.CFU$
       697**DCL      1146>>IF       1163>>IF
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:200  
F$DCB.DCBNAME.L
       710**DCL       710--IMP-SIZ
F$DCB.EOMCHAR
       667**DCL       667--REDEF
F$DCB.FLDID
       691**DCL       691--REDEF
F$DCB.FORM$
       685**DCL       685--REDEF
F$DCB.FSECT
       701**DCL       701--REDEF
F$DCB.FSN
       678**DCL       678--REDEF     678--REDEF     679--REDEF
F$DCB.HEADER$
       684**DCL       684--REDEF
F$DCB.IXTNSIZE
       682**DCL       682--REDEF
F$DCB.LASTSTA$
       672**DCL       672--REDEF
F$DCB.LVL
       697**DCL       697--REDEF
F$DCB.NAME
       672**DCL      1154--CALL
F$DCB.NAME.C
       672**DCL       672--REDEF
F$DCB.NOEOF
       693**DCL       693--REDEF
F$DCB.NRECS
       683**DCL       683--REDEF
F$DCB.NRECX
       702**DCL       702--REDEF
F$DCB.OHDR
       694**DCL       694--REDEF
F$DCB.ORG
       677**DCL       677--REDEF
F$DCB.PRECNO
       700**DCL       700--REDEF
PL6.E3A0      #006=FMP$UPFDDESC File=FMP$CLSF.:E05TSI                            TUE 07/29/97 16:59 Page:201  
F$DCB.RCSZ
       705**DCL       705--REDEF
F$DCB.RES
       673**DCL       673--REDEF
F$DCB.SETX
       685**DCL       685--REDEF
F$DCB.STARF
       692**DCL      1146>>IF
F$DCB.TAB$
       684**DCL       685--REDEF
F$DCB.TDA
       699**DCL       699--REDEF
F$DCB.WSN
       674**DCL       674--REDEF
FDA
        15**DCL      1153<<ASSIGN   1154<>CALL     1163>>IF
FM$CFU.ACCTX
        66**DCL        66--REDEF
FM$CFU.FITSDA
        66**DCL      1163>>IF
FM$CFU.FUN
        65**DCL      1146>>IF
FMD$FLSHBUF
        14**DCL-ENT  1156--CALL
FMQ$CTG
        13**DCL-ENT  1154--CALL
JDCB$
       610**DCL       663--IMP-PTR  1145<<ASSIGN   1146>>IF       1146>>IF       1148>>ASSIGN   1149>>ASSIGN
      1150>>ASSIGN   1151>>ASSIGN   1154>>CALL     1155>>IF       1157>>ASSIGN   1158>>ASSIGN   1161>>ASSIGN
      1162>>ASSIGN   1163>>IF       1171<<ASSIGN
RETALT
      1161**LABEL    1154--CALLALT

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:202  
      901        1        /*T***********************************************************/
      902        2        /*T*                                                         */
      903        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      904        4        /*T*                                                         */
      905        5        /*T***********************************************************/
      906        6        FMP$RENAME: PROC(NAME$)ALTRET;
      907        7                    /*F*     NAME: FMP$RENAME
      908        8                    *        PURPOSE: To perform the FIT and directory manipulation
      909        9                    *        required for file name change and m$JRNL.
      910       10                    *        DESCRIPTION: The single parameter is a pointer to the new name.
      911       11                    *        The M$* DCB is used and must not be open.  The used DCB pointer
      912       12                    *        is in B$JIT.DCB$ and is not disturbed.  The new name must be in
      913       13                    *        the same directory as the old one (e.g., both star files).  The
      914       14                    *        new name must not refer to an existing or busy file.       */
      915       15    1   DCL NAME$ PTR;
      916       16        %INCLUDE FM$MACROS;
      917      391        %INCLUDE F_ERRORS_C;
      918      631        %INCLUDE F$JIT_C;
      919     1061        %INCLUDE JG_GHOSTS_C;
      920     1151        %MACRO F$DCB(BASED=,F$DCB=);
      921     1152        %INCLUDE F$DCB;
      922     1201        %MEND;
      923     1202        %F$DCB(F$DCB=S$DCB,BASED="BASED(SDCB$)");
      924     1252        %F$DCB(F$DCB=U$DCB,BASED="BASED(UDCB$)");
      925     1302        %FM$CFU(FM$CFU=S$CFU,BASED="BASED(SCFU$)");
      926     1308        %FM$CFU(FM$CFU=U$CFU,BASED="BASED(UCFU$)");
      927     1314        %FM$CFUJ(FM$CFUJ=U$CFUJ,BASED="BASED(UCFU$)");
      928     1319        %FM$CFUA(BASED="BASED(ACCT$)");
      929     1325        %FM$CFUEXT(BASED="BASED(LOC$)");
      930     1329        %FM$FIT(BASED="BASED(LOC$)");
      931     1332        %INCLUDE CP_6_SUBS;
      932     1872        %FM$KEYENT(BASED="BASED(BUF$)");
      933     1875        %FM$FDSEG(BASED="BASED(TMP$)");
      934     1879        %FM$GRAN(BASED="BASED(BUF$)");
      935     1883        %CODE01(BASED="BASED(LOC$)");
      936     1887        %CODE03(BASED="BASED(LOC$)");
      937     1894        %CODE04(BASED="BASED(LOC$)");
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:203  
      938     1902    1   DCL 1 NAME BASED(NAME$),
      939     1903    1         2 L CHAR(1),
      940     1904    1         2 C CHAR(I);
      941     1905        %EJECT;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:204  
      942     1906    1   DCL I SBIN;
      943     1907    1   DCL 1 IC(0:3) REDEF I CHAR(1);
      944     1908    1   DCL IU REDEF I UBIN;
      945     1909    1   DCL BUFNO UBIN;
      946     1910    1   DCL UDCB$ PTR;
      947     1911    1   DCL SDCB$ PTR;
      948     1912    1   DCL UCFU$ PTR;
      949     1913    1   DCL SCFU$ PTR;
      950     1914    1   DCL LOC$ PTR;
      951     1915    1   DCL BUF$ PTR;
      952     1916    1   DCL ACCT$ PTR;
      953     1917    1   DCL TMP$ PTR; /* Used in subroutine calls, to preserve the real ones */
      954     1918    1   DCL GRAN BASED CHAR(4096);
      955     1919    1   DCL DA UBIN;
      956     1920                    /**/
      957     1921    1   DCL FAG$COUNT ENTRY(1) ALTRET;
      958     1922    1   DCL FAG$GEXT ENTRY ALTRET;
      959     1923    1   DCL FMD$FLSHBUF ENTRY(1);
      960     1924    1   DCL FMD$GETBUF ENTRY(3);
      961     1925    1   DCL FMD$WRTBUF ENTRY(1);
      962     1926    1   DCL FMD$WRTSV ENTRY(1);
      963     1927    1   DCL FMD$REDBUFBC ENTRY(6) ALTRET;
      964     1928    1   DCL FMC$CLR1 ENTRY(1);
      965     1929    1   DCL FMF$PEOF ENTRY(1);
      966     1930        %INCLUDE F_FPTCODE_C;
      967     1966    1   DCL FMG$ADDKEY ENTRY(4)ALTRET;
      968     1967    1   DCL FMG$REMKEY ENTRY ALTRET;
      969     1968    1   DCL FMH$JGETPG ENTRY(1)ALTRET;
      970     1969    1   DCL FMH$INIT ENTRY;
      971     1970    1   DCL FMH$JRELPG ENTRY(1)ALTRET;
      972     1971    1   DCL FMM$NSTAMP ENTRY(1);
      973     1972    1   DCL FMM$SCRUB ENTRY(1);
      974     1973    1   DCL FMN$CHKFLACN ENTRY(1)ALTRET;
      975     1974    1   DCL FMN$GETFIT ENTRY(2)ALTRET;
      976     1975    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
      977     1976    1   DCL FMO$LOCCODX ENTRY(2)ALTRET;
      978     1977    1   DCL FMP$RELCFUS ENTRY(1);
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:205  
      979     1978    1   DCL FMQ$BLDFD ENTRY(1)ALTRET;
      980     1979    1   DCL FMQ$CTG ENTRY(2)ALTRET;
      981     1980    1   DCL FMQ$SRCHFD ENTRY(5)ALTRET;
      982     1981    1   DCL FMR$G8 ENTRY(2)ALTRET;
      983     1982    1   DCL FMS$SCANNAME ENTRY ALTRET;
      984     1983    1   DCL SSS$SYSTIME ENTRY(1);
      985     1984    1   DCL UDB$PMMEXIT ENTRY;
      986     1985    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      987     1986    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      988     1987                    /**/
      989     1988    1   DCL B$JIT$ PTR SYMREF;
      990     1989    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      991     1990    1   DCL F$CFU$ PTR SYMREF;
      992     1991    1   DCL FM_FRZERO UBIN SYMREF;
      993     1992    1   DCL FM_SYSACCTX UBIN SYMREF;
      994     1993    1   DCL S_CUN UBIN WORD SYMREF;
      995     1994        %SUB FCG#='0615'O;
      996     1995        %SUB MID#='20'O;
      997     1996        %ERRCODE(NAME=FMP$E$BADFNME,COD#=%E$BADFNME);
      998     2000        %ERRCODE(NAME=FMP$E$PSGRANS,COD#=%E$PSGRANS);
      999     2004        %ERRCODE(NAME=FMP$E$USGRANS,COD#=%E$USGRANS);
     1000     2008        %ERRCODE(NAME=FMP$E$ACGRANS,COD#=%E$ACGRANS);
     1001     2012        %EJECT;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:206  
     1002     2013    1      SDCB$=B$M$STAR$;
     1003     2014    1      UDCB$=B$JIT.DCB$;
     1004     2015    1      UCFU$=U$DCB.CFU$;
     1005     2016    2      IF S$DCB.FCD THEN DO;
     1006     2017    2         SDCB$=ADDR(NIL);
     1007     2018    2         GOTO FMPE$BADFNME;
     1008     2019    2         END;
     1009     2020                    /*E*     ERROR: FMP-E$BADFNME-E
     1010     2021                    *        MESSAGE: Rename% of %FN% not permitted.
     1011     2022                    *        MESSAGE1: The new file% %U1% either exists, is being created,
     1012     2023                    *        or is not the same "starness"% as %UF%
     1013     2024                    */
     1014     2025    1      I=U$CFU.ACCTX;
     1015     2026    1      IF I=0 THEN I=PINCRW(F$CFU$,U$CFU.NAMEX)->U$CFU.ACCTX;
     1016     2027    1      ACCT$=PINCRW(F$CFU$,I);
     1017     2028    1      CALL FAG$COUNT (I); /* Make sure there's some space to work with */
     1018     2029    2      IF U$CFU.FUN=%JRNL# THEN DO;
     1019     2030    2         I=I-U$DCB.XTNSIZE-1;
     1020     2031    2         IF U$DCB.BORROW>1 THEN EXIT; /* Need 2 granules of user space */
     1021     2032    2         IF NOT U$DCB.STARF AND FM$CFUA.GRANS<2
     1022     2033    2         THEN B$JIT.ERR=FMP$E$ACGRANS;
     1023     2034    2         ELSE IF U$DCB.STARF AND B$JIT.CURTMPDP+2<=B$JIT.MAXTMPDP
     1024     2035    2              OR NOT U$DCB.STARF AND B$JIT.PRDPRM>1 THEN EXIT;
     1025     2036    2            ELSE B$JIT.ERR=FMP$E$USGRANS;
     1026     2037    2         GOTO NOSPACE;
     1027     2038    2         END;
     1028     2039    1      IF U$CFU.FUN=%CREATE# THEN I=I-1;
     1029     2040    2      IF I<1 THEN DO;
     1030     2041    2         B$JIT.ERR=FMP$E$PSGRANS;
     1031     2042    2   NOSPACE:;
     1032     2043    2         SDCB$=ADDR(NIL);
     1033     2044    2         GOTO RETRET;
     1034     2045    2         END;
     1035     2046    1      CALL FMM$SCRUB(DCBADDR(%M$STAR#));
     1036     2047    1      I=0;
     1037     2048    1      IC(3)=NAME.L;
     1038     2049    1      S$DCB.NAME.L=I;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:207  
     1039     2050    1      S$DCB.NAME.C=NAME.C;
     1040     2051    1      IF S$DCB.NAME=U$DCB.NAME THEN GOTO RETRET;
     1041     2052    1      S$DCB.DESC=U$DCB.DESC;
     1042     2053    1      S$DCB.ACCT=U$DCB.ACCT;
     1043     2054    1      S$DCB.IASN=%FILE#;
     1044     2055    1      S$DCB.FUN=%CREATE#;
     1045     2056    1      S$DCB.WSR=U$DCB.WSR;
     1046     2057    1      CALL FMN$CHKFLACN(DCBADDR(%M$STAR#))ALTRET(RETRET);
     1047     2058    1      IF S$DCB.STARF~=U$DCB.STARF THEN GOTO FMPE$BADFNME;
     1048     2059    1      S$DCB.SETX=U$DCB.SETX;
     1049     2060    1      CALL FMR$G8(S$DCB.CFU$,I)ALTRET(RETRET);
     1050     2061    1      SCFU$=S$DCB.CFU$;
     1051     2062    1      S$CFU.FUN=7;
     1052     2063    1      S$DCB.FUN=%UPDATE#;
     1053     2064    1      S$CFU.SHARE=%NONE#;
     1054     2065    1      S$CFU.ACCTX=POFFW(ACCT$,F$CFU$);
     1055     2066    1      B$JIT.DCB$=SDCB$;
     1056     2067    1      IF NOT U$DCB.STARF THEN CALL UQB$MENQX(ACCT$)ALTRET(RETRET);
     1057     2068    1      CALL FMS$SCANNAME ALTRET(FMPE$BADFNME);/* ALTRETS IF CFU FOUND */
     1058     2069    2      IF S$DCB.STARX=0 THEN DO;
     1059     2070    2         IF S$DCB.STARF AND B$JIT.STAR.DA(0)=0 THEN CALL FMQ$BLDFD ALTRET(RETRET);
     1060     2071    2         CALL FMQ$SRCHFD(ADDR(S$DCB.NAME),BUF$,TMP$,ACCT$,ADDR(NIL))ALTRET(NOKEY);
     1061     2072    2         GOTO FMPE$BADFNME;
     1062     2073    2   NOKEY:;
     1063     2074    2         IF B$JIT.ERR.CODE~=%E$NOKEY THEN GOTO RETRET;
     1064     2075    2         IF SUBSTR(S$DCB.NAME.C,0,7)=':SECLOG' AND S$CFU.ACCTX=FM_SYSACCTX AND S_CUN~=
              2075                  JG_ELF#
     1065     2076    2         THEN GOTO FMPE$BADFNME;
     1066     2077    2         IF B$JIT.ERR.MID~='21'O THEN CALL
     1067     2078    2              FMG$ADDKEY(TMP$,SIZEW(FM$FDSEG),BUF$,ADDR(S$DCB.NAME))ALTRET(RETRET);
     1068     2079    2         B$JIT.ERR='0'B;
     1069     2080    2         FM$KEYENT.D='0'B;
     1070     2081    2         FM$FDSEG.FITSDA=U$CFU.FITSDA;
     1071     2082    2         U$DCB.DESC.BUF=U$DCB.DESC.BUPM;
     1072     2083    2         FM$FDSEG.DESC=U$DCB.DESC;
     1073     2084    2         CALL FMD$WRTSV(1);
     1074     2085    2         END;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:208  
     1075     2086    1      ELSE B$JIT.STAR.DA(S$DCB.STARX)=U$CFU.FITSDA;
     1076     2087        %EJECT;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:209  
     1077     2088                    /* THE NEW NAME IS NOW CATALOGUED, BUT THE FIT DOWSN'T MATCH */
     1078     2089                    /* IF THE FILE IS NEW, MAKE SURE THERE IS NO OLD ONE */
     1079     2090                    /* SINCE WE BORROWED ON ITS GRANULES */
     1080     2091    2      IF U$CFU.FUN=%CREATE# THEN DO;
     1081     2092    2         CALL FMD$FLSHBUF(1); /* RELEASE THE FD BUFFER */
     1082     2093    2         B$JIT.DCB$=UDCB$;
     1083     2094    2         CALL FMQ$CTG(ADDR(U$DCB.NAME),I);
     1084     2095    2         IF NOT U$DCB.STARF THEN CALL UQB$MENQX(ACCT$);
     1085     2096    2         END;
     1086     2097    1      B$JIT.DCB$=UDCB$;
     1087     2098    1      BUFNO=0;
     1088     2099    1      CALL FMN$GETFIT(BUF$,BUFNO)ALTRET(RETRET);
     1089     2100    1      LOC$=PINCRW(BUF$,SIZEW(FM$GRAN));
     1090     2101    1      TMP$=LOC$;
     1091     2102    2      DO I=5 TO 6;
     1092     2103    2         CALL FMO$LOCCODX(TMP$,I)ALTRET(NOEFT);
     1093     2104    2         FM$FIT.CODES.NDW(I)=0;
     1094     2105    2         I=FM$FIT.CODES.CODE(I);
     1095     2106    2   NOEFT:END;
     1096     2107    1      CALL SSS$SYSTIME(I);
     1097     2108    1      CALL LOCCODP(4)ALTRET(NOTIME);
     1098     2109    1      CODE04.MODIFY.TIME=I;
     1099     2110    1   NOTIME:;
     1100     2111    1      CALL LOCCODP(3);
     1101     2112    1      B$JIT.DCB$=SDCB$;
     1102     2113    1      CALL FMM$NSTAMP(CODE03.NSTAMP);
     1103     2114    1      B$JIT.DCB$=UDCB$;
     1104     2115    1      CALL FMD$WRTSV(BUFNO);
     1105     2116    1      S$CFU.FITSDA=U$CFU.FITSDA;
     1106     2117    2      IF U$CFU.FUN=%JRNL# THEN DO;
     1107     2118                    /* IF JOURNAL SWITCH, START UP A NEW FILE HERE */
     1108     2119    3         IF BUFNO=1 THEN DO;
     1109     2120    3            LOC$=BUF$;
     1110     2121    3            CALL FMD$GETBUF(0,1,BUF$);
     1111     2122    3            BUF$->GRAN=LOC$->GRAN;
     1112     2123    3            BUFNO=0;
     1113     2124    3            DA=U$CFU.FITSDA;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:210  
     1114     2125    3            CALL FMC$CLR1(DA);
     1115     2126    3            CALL LOCCODP(3);
     1116     2127    3            END;
     1117     2128    2         ELSE
     1118     2129    3         DO;   /* GET UNCACHED COPY */
     1119     2130    3            CALL FMD$FLSHBUF(BUFNO);
     1120     2131    3            DA=U$CFU.FITSDA;
     1121     2132    3            CALL FMD$REDBUFBC(BUF$, BUFNO, DA) ALTRET(RETRET);
     1122     2133    3            END; /* GET UNCACHED COPY */
     1123     2134    2         CALL FMH$JRELPG(1);
     1124     2135    2         U$DCB.BFR(1)=U$DCB.BFR(BUFNO);
     1125     2136    2         U$DCB.BFR1(1)=U$DCB.BFR1(BUFNO);
     1126     2137    2         U$DCB.BFR(BUFNO)='0'B;
     1127     2138    2         U$DCB.BFR1(BUFNO)='0'B;
     1128     2139    2         U$CFU.FITSDA=0;
     1129     2140    2         U$CFU.UGRANS=0;
     1130     2141    2         U$CFU.AFIT=0;
     1131     2142    2         U$CFU.NRECS=0;
     1132     2143    2         U$CFU.LDA=FM_FRZERO;
     1133     2144    2         FM$GRAN.LVL=0;/* NOT AN AFIT */
     1134     2145    2         FM$GRAN.NAVX=FM$GRAN.FCEX;
     1135     2146    2         FM$GRAN.AVAIL=1024-FM$GRAN.NAVX;
     1136     2147    2         CALL FMM$NSTAMP(CODE03.NSTAMP);
     1137     2148    2         CODE03.UGRANS=0;
     1138     2149    2         CODE03.NGAVAL=0;
     1139     2150    2         CODE03.NRECS=0;
     1140     2151    2         CODE03.DESC.BAD='0'B;
     1141     2152    2         U$DCB.HASH=I;
     1142     2153    2         FM$GRAN.STAMP.GMOD=0;
     1143     2154    2         FM$GRAN.STAMP.HASH=I;
     1144     2155    2         CALL LOCCODP(4)ALTRET(NOTIME1);
     1145     2156    2         CODE04.ACCESS.TIME=I;
     1146     2157    2         CODE04.CREATION.TIME=I;
     1147     2158    2         CODE04.SVMODIFY.TIME=I;
     1148     2159    2   NOTIME1:;
     1149     2160    2         PINCRW(BUF$,SIZEW(FM$GRAN))->FM$FIT.CODES.NDW(1)=1;
     1150     2161    2         CALL LOCCODP(1);/* FIX EXTENT LIST, HASH*/
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:211  
     1151     2162    2         CODE01.HASH=I;
     1152     2163    2         CODE01.NXTNTS=0;
     1153     2164    2         CALL FMR$G8(TMP$,I)ALTRET(RETRET);
     1154     2165    2         S$CFU.XTX=U$CFU.XTX;
     1155     2166    2         U$CFU.XTX=I;
     1156     2167    2         U$DCB.BFR.DA(1)=FM_FRZERO;
     1157     2168    2         U$DCB.IXTNSIZE=U$DCB.XTNSIZE+1;
     1158     2169    2         U$DCB.BFR.BUFUP(1)='1'B;
     1159     2170    2         CALL FAG$GEXT ALTRET(RETRET);
     1160     2171    2         U$CFU.UGRANS=1;
     1161     2172    2         U$CFU.NGAVAL=U$CFU.NGAVAL-1;
     1162     2173    2         U$CFU.FITSDA=FM$CFUEXT.XTNT.XTNSDA(0);
     1163     2174    2         U$CFUJ.ERR_WAIT='0'B;
     1164     2175    2         END;
     1165     2176    1      ELSE U$CFU.FITSDA=0;
     1166     2177    1      CALL FMD$FLSHBUF(1);/* MOVE STAR BUFFER HERE*/
     1167     2178    1      U$DCB.BFR1(1)=S$DCB.BFR1(1);
     1168     2179    1      S$DCB.BFR1(1)='0'B;
     1169     2180    1      U$DCB.BFR(1)=S$DCB.BFR(1);
     1170     2181    1      S$DCB.BFR(1)='0'B;
     1171     2182    2      IF U$DCB.STARX=0 THEN DO;
     1172     2183                    /* NOW REMOVE THE OLD FD POINTER */
     1173     2184    2         CALL FMQ$SRCHFD(ADDR(U$DCB.NAME),BUF$,TMP$,ACCT$,ADDR(NIL))ALTRET(RETRET);
     1174     2185    2         FM$FDSEG.FITSDA=U$CFU.FITSDA;
     1175     2186    2         FM$FDSEG.DESC.BAD='0'B;
     1176     2187    2         U$DCB.BFR.BUFUP(1)='1'B;
     1177     2188    3         IF U$CFU.FITSDA=0 THEN DO;
     1178     2189    3            FM$KEYENT.D='1'B;
     1179     2190    3            FM$FDSEG='0'B;
     1180     2191    3            FM$FDSEG.DESC.DELF='1'B;
     1181     2192    3            IF U$DCB.STARF THEN CALL FMG$REMKEY;
     1182     2193    3            ELSE IF NOT FM$CFUA.ACCESS.BUPF THEN CALL FMG$REMKEY;
     1183     2194    4               ELSE DO;
     1184     2195    4                  CALL SSS$SYSTIME(I);
     1185     2196    4                  FM$FDSEG.FITSDA=IU/512;
     1186     2197    4                  END;
     1187     2198    3            END;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:212  
     1188     2199    2         END;
     1189     2200    1      ELSE B$JIT.STAR.DA(U$DCB.STARX)=U$CFU.FITSDA;
     1190     2201    1      CALL FMP$RELCFUS(S$DCB.CFU$);
     1191     2202    1      CALL FMD$FLSHBUF(1);
     1192     2203    1      IF NOT U$DCB.STARF THEN CALL UQB$MDEQ(ACCT$);
     1193     2204    2      IF U$CFU.FUN=%JRNL# THEN DO;
     1194     2205    2         IC=B$JIT.ERR;
     1195     2206    2   JRNLRET:;
     1196     2207    2         U$DCB.SHARED='0'B; /* DISABLE ENQ-DEQ IN FMF */
     1197     2208    2         U$DCB.GTYP=FMGTFILE;
     1198     2209    2         CALL FMF$PEOF(FPTPFILEOF);
     1199     2210    2         U$DCB.SHARED='1'B;
     1200     2211    2         CALL FMH$JGETPG(1);
     1201     2212    2         CALL UQB$MDEQ(U$DCB.CFU$);
     1202     2213    2         B$JIT.ERR=IC;
     1203     2214    2         CALL UDB$PMMEXIT;
     1204     2215    2         END;
     1205     2216    1      RETURN;
     1206     2217                    /**/
     1207     2218        %EJECT;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:213  
     1208     2219    1   FMPE$BADFNME:;
     1209     2220    1      B$JIT.ERR=FMP$E$BADFNME;
     1210     2221    1   RETRET:;
     1211     2222    1      IF SDCB$ ~= ADDR(NIL) THEN
     1212     2223    2         IF S$DCB.CFU$~=ADDR(NIL) THEN DO;
     1213     2224    2            B$JIT.DCB$=SDCB$;
     1214     2225    2            CALL FMD$FLSHBUF(1);
     1215     2226    2            CALL FMP$RELCFUS(S$DCB.CFU$);
     1216     2227    2            B$JIT.DCB$=UDCB$;
     1217     2228    2            CALL FMD$FLSHBUF(1);
     1218     2229    2            IF NOT U$DCB.STARF THEN CALL UQB$MDEQ(ACCT$);
     1219     2230    2            END;
     1220     2231    1      IF U$CFU.FUN=%CREATE# AND B$JIT.ERR.CODE=%E$NOKEY
     1221     2232    1      THEN B$JIT.ERR='0'B;
     1222     2233    1      IF U$CFU.FUN~=%JRNL# THEN ALTRETURN;
     1223     2234    1      CALL FMH$JRELPG(1);
     1224     2235    1      BUFNO=0;
     1225     2236    1      IC=B$JIT.ERR;
     1226     2237    1      CALL FMN$GETFIT(BUF$,BUFNO) ALTRET(JRNLRET);
     1227     2238    1      CALL LOCCODP(3) ALTRET(JRNLRET);
     1228     2239    1      CODE03.UGRANS=CODE03.UGRANS+CODE03.NGAVAL;
     1229     2240    1      CODE03.NGAVAL=0;
     1230     2241    1      CALL LOCCODP(4) ALTRET(MBSTAR);
     1231     2242    1      CODE04.SVMODIFY=CODE04.MODIFY; /* MAKE IT LOOK OPEN */
     1232     2243    1   MBSTAR:;
     1233     2244    1      CALL FMD$WRTBUF(BUFNO);
     1234     2245    1      GOTO JRNLRET;
     1235     2246        %EJECT;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:214  
     1236     2247                    /*I* NAME: LOCCODP
     1237     2248                         DESCRIPTION: Calls FMO$LOCCODP for the single parameter without
     1238     2249                         making PL6 think LOC$ is a poor risk. */
     1239     2250    1   LOCCODP: PROC(I) ALTRET;
     1240     2251    2   DCL I UBIN;
     1241     2252    2      TMP$=PINCRW(BUF$,SIZEW(FM$GRAN));
     1242     2253    3      CALL FMO$LOCCODP(TMP$,I) WHENALTRETURN DO; ALTRETURN; END;
     1243     2254    2      LOC$=TMP$;
     1244     2255    2      RETURN;
     1245     2256    2   END LOCCODP;
     1246     2257    1   END FMP$RENAME;

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:215  
--  Include file information  --

   F_FPTCODE_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure FMP$RENAME.

   Procedure FMP$RENAME requires 860 words for executable code.
   Procedure FMP$RENAME requires 26 words of local(AUTO) storage.

    No errors detected in file FMP$CLSF.:E05TSI    .

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:216  

 Object Unit name= FMP$RENAME                                 File name= FMP$CLSF.:E05TOU
 UTS= JUL 29 '97 16:59:33.00 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      6      6  FMP$RENAME
    1   Proc  even  none   860   1534  FMP$RENAME
    2  RoData even  none    15     17  FMP$RENAME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  FMP$RENAME
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:217  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 FAG$COUNT
         yes           Std       1 FMD$WRTSV
         yes           Std       1 SSS$SYSTIME
 yes     yes           Std       1 FMH$JGETPG
         yes           Std       1 FMD$FLSHBUF
 yes     yes           Std       2 FMO$LOCCODX
         yes           Std       1 FMM$NSTAMP
         yes           Std       1 FMD$WRTBUF
         yes           Std       1 FMM$SCRUB
 yes     yes           Std       2 FMR$G8
         yes           Std       1 FMP$RELCFUS
 yes     yes           Std       5 FMQ$SRCHFD
 yes     yes           Std       4 FMG$ADDKEY
         yes           Std       3 FMD$GETBUF
         yes           Std       1 FMF$PEOF
 yes     yes           Std       1 FMH$JRELPG
 yes     yes           Std       1 UQB$MDEQ
 yes     yes           Std       1 FMN$CHKFLACN
 yes     yes           Std       1 FMQ$BLDFD
 yes     yes           Std       1 UQB$MENQX
 yes     yes           Std       0 FMS$SCANNAME
 yes     yes           Std       2 FMQ$CTG
 yes     yes           Std       2 FMN$GETFIT
         yes           Std       0 UDB$PMMEXIT
 yes     yes           Std       0 FAG$GEXT
 yes     yes           Std       0 FMG$REMKEY
         yes           Std       1 FMC$CLR1
 yes     yes           Std       6 FMD$REDBUFBC
 yes     yes           Std       2 FMO$LOCCODP
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:218  
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                           r    B$M$STAR$                             F$CFU$
     FM_FRZERO                             FM_SYSACCTX                           S_CUN
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 ISSID
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:219  


      901        1        /*T***********************************************************/
      902        2        /*T*                                                         */
      903        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      904        4        /*T*                                                         */
      905        5        /*T***********************************************************/
      906        6        FMP$RENAME: PROC(NAME$)ALTRET;

      6  1 000000   000000 700200 xent  FMP$RENAME   TSX0  ! X66_AUTO_1
         1 000001   000032 000001                    ZERO    26,1

      907        7                    /*F*     NAME: FMP$RENAME
      908        8                    *        PURPOSE: To perform the FIT and directory manipulation
      909        9                    *        required for file name change and m$JRNL.
      910       10                    *       DESCRIPTION: The single parameter is a pointer to the new name.
      911       11                    *        The M$* DCB is used and must not be open. The used DCB pointer
      912       12                    *        is in B$JIT.DCB$ and is not disturbed. The new name must be in
      913       13                    *        the same directory as the old one (e.g., both star files). The
      914       14                    *        new name must not refer to an existing or busy file.       */
      915       15    1   DCL NAME$ PTR;
      916       16        %INCLUDE FM$MACROS;
      917      391        %INCLUDE F_ERRORS_C;
      918      631        %INCLUDE F$JIT_C;
      919     1061        %INCLUDE JG_GHOSTS_C;
      920     1151        %MACRO F$DCB(BASED=,F$DCB=);
      921     1152        %INCLUDE F$DCB;
      922     1201        %MEND;
      923     1202        %F$DCB(F$DCB=S$DCB,BASED="BASED(SDCB$)");
      924     1252        %F$DCB(F$DCB=U$DCB,BASED="BASED(UDCB$)");
      925     1302        %FM$CFU(FM$CFU=S$CFU,BASED="BASED(SCFU$)");
      926     1308        %FM$CFU(FM$CFU=U$CFU,BASED="BASED(UCFU$)");
      927     1314        %FM$CFUJ(FM$CFUJ=U$CFUJ,BASED="BASED(UCFU$)");
      928     1319        %FM$CFUA(BASED="BASED(ACCT$)");
      929     1325        %FM$CFUEXT(BASED="BASED(LOC$)");
      930     1329        %FM$FIT(BASED="BASED(LOC$)");
      931     1332        %INCLUDE CP_6_SUBS;
      932     1872        %FM$KEYENT(BASED="BASED(BUF$)");
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:220  
      933     1875        %FM$FDSEG(BASED="BASED(TMP$)");
      934     1879        %FM$GRAN(BASED="BASED(BUF$)");
      935     1883        %CODE01(BASED="BASED(LOC$)");
      936     1887        %CODE03(BASED="BASED(LOC$)");
      937     1894        %CODE04(BASED="BASED(LOC$)");
      938     1902    1   DCL 1 NAME BASED(NAME$),
      939     1903    1         2 L CHAR(1),
      940     1904    1         2 C CHAR(I);
      941     1905        %EJECT;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:221  
      942     1906    1   DCL I SBIN;
      943     1907    1   DCL 1 IC(0:3) REDEF I CHAR(1);
      944     1908    1   DCL IU REDEF I UBIN;
      945     1909    1   DCL BUFNO UBIN;
      946     1910    1   DCL UDCB$ PTR;
      947     1911    1   DCL SDCB$ PTR;
      948     1912    1   DCL UCFU$ PTR;
      949     1913    1   DCL SCFU$ PTR;
      950     1914    1   DCL LOC$ PTR;
      951     1915    1   DCL BUF$ PTR;
      952     1916    1   DCL ACCT$ PTR;
      953     1917    1   DCL TMP$ PTR; /* Used in subroutine calls, to preserve the real ones */
      954     1918    1   DCL GRAN BASED CHAR(4096);
      955     1919    1   DCL DA UBIN;
      956     1920                    /**/
      957     1921    1   DCL FAG$COUNT ENTRY(1) ALTRET;
      958     1922    1   DCL FAG$GEXT ENTRY ALTRET;
      959     1923    1   DCL FMD$FLSHBUF ENTRY(1);
      960     1924    1   DCL FMD$GETBUF ENTRY(3);
      961     1925    1   DCL FMD$WRTBUF ENTRY(1);
      962     1926    1   DCL FMD$WRTSV ENTRY(1);
      963     1927    1   DCL FMD$REDBUFBC ENTRY(6) ALTRET;
      964     1928    1   DCL FMC$CLR1 ENTRY(1);
      965     1929    1   DCL FMF$PEOF ENTRY(1);
      966     1930        %INCLUDE F_FPTCODE_C;
      967     1966    1   DCL FMG$ADDKEY ENTRY(4)ALTRET;
      968     1967    1   DCL FMG$REMKEY ENTRY ALTRET;
      969     1968    1   DCL FMH$JGETPG ENTRY(1)ALTRET;
      970     1969    1   DCL FMH$INIT ENTRY;
      971     1970    1   DCL FMH$JRELPG ENTRY(1)ALTRET;
      972     1971    1   DCL FMM$NSTAMP ENTRY(1);
      973     1972    1   DCL FMM$SCRUB ENTRY(1);
      974     1973    1   DCL FMN$CHKFLACN ENTRY(1)ALTRET;
      975     1974    1   DCL FMN$GETFIT ENTRY(2)ALTRET;
      976     1975    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
      977     1976    1   DCL FMO$LOCCODX ENTRY(2)ALTRET;
      978     1977    1   DCL FMP$RELCFUS ENTRY(1);
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:222  
      979     1978    1   DCL FMQ$BLDFD ENTRY(1)ALTRET;
      980     1979    1   DCL FMQ$CTG ENTRY(2)ALTRET;
      981     1980    1   DCL FMQ$SRCHFD ENTRY(5)ALTRET;
      982     1981    1   DCL FMR$G8 ENTRY(2)ALTRET;
      983     1982    1   DCL FMS$SCANNAME ENTRY ALTRET;
      984     1983    1   DCL SSS$SYSTIME ENTRY(1);
      985     1984    1   DCL UDB$PMMEXIT ENTRY;
      986     1985    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      987     1986    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      988     1987                    /**/
      989     1988    1   DCL B$JIT$ PTR SYMREF;
      990     1989    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      991     1990    1   DCL F$CFU$ PTR SYMREF;
      992     1991    1   DCL FM_FRZERO UBIN SYMREF;
      993     1992    1   DCL FM_SYSACCTX UBIN SYMREF;
      994     1993    1   DCL S_CUN UBIN WORD SYMREF;
      995     1994        %SUB FCG#='0615'O;
      996     1995        %SUB MID#='20'O;
      997     1996        %ERRCODE(NAME=FMP$E$BADFNME,COD#=%E$BADFNME);
      998     2000        %ERRCODE(NAME=FMP$E$PSGRANS,COD#=%E$PSGRANS);
      999     2004        %ERRCODE(NAME=FMP$E$USGRANS,COD#=%E$USGRANS);
     1000     2008        %ERRCODE(NAME=FMP$E$ACGRANS,COD#=%E$ACGRANS);
     1001     2012        %EJECT;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:223  
     1002     2013    1      SDCB$=B$M$STAR$;

   2013  1 000002   000000 236000 xsym               LDQ     B$M$STAR$
         1 000003   200007 756100                    STQ     SDCB$,,AUTO

     1003     2014    1      UDCB$=B$JIT.DCB$;

   2014  1 000004   000000 470400 xsym               LDP0    B$JIT$
         1 000005   000232 236100                    LDQ     154,,PR0
         1 000006   200006 756100                    STQ     UDCB$,,AUTO

     1004     2015    1      UCFU$=U$DCB.CFU$;

   2015  1 000007   200006 471500                    LDP1    UDCB$,,AUTO
         1 000010   100066 236100                    LDQ     54,,PR1
         1 000011   200010 756100                    STQ     UCFU$,,AUTO

     1005     2016    2      IF S$DCB.FCD THEN DO;

   2016  1 000012   200007 473500                    LDP3    SDCB$,,AUTO
         1 000013   300031 236100                    LDQ     25,,PR3
         1 000014   020000 316007                    CANQ    8192,DL
         1 000015   000021 600000 1                  TZE     s:2025

     1006     2017    2         SDCB$=ADDR(NIL);

   2017  1 000016   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000017   200007 756100                    STQ     SDCB$,,AUTO

     1007     2018    2         GOTO FMPE$BADFNME;

   2018  1 000020   001344 710000 1                  TRA     FMPE$BADFNME

     1008     2019    2         END;
     1009     2020                    /*E*     ERROR: FMP-E$BADFNME-E
     1010     2021                    *        MESSAGE: Rename% of %FN% not permitted.
     1011     2022                    *        MESSAGE1: The new file% %U1% either exists, is being created,
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:224  
     1012     2023                    *        or is not the same "starness"% as %UF%
     1013     2024                    */
     1014     2025    1      I=U$CFU.ACCTX;

   2025  1 000021   200010 474500                    LDP4    UCFU$,,AUTO
         1 000022   400002 236100                    LDQ     2,,PR4
         1 000023   000022 772000                    QRL     18
         1 000024   200004 756100                    STQ     I,,AUTO

     1015     2026    1      IF I=0 THEN I=PINCRW(F$CFU$,U$CFU.NAMEX)->U$CFU.ACCTX;

   2026  1 000025   000033 601000 1                  TNZ     s:2027

   2026  1 000026   400002 720100                    LXL0    2,,PR4
         1 000027   000000 475400 xsym               LDP5    F$CFU$
         1 000030   500002 236110                    LDQ     2,X0,PR5
         1 000031   000022 772000                    QRL     18
         1 000032   200004 756100                    STQ     I,,AUTO

     1016     2027    1      ACCT$=PINCRW(F$CFU$,I);

   2027  1 000033   000022 736000                    QLS     18
         1 000034   000000 036000 xsym               ADLQ    F$CFU$
         1 000035   200014 756100                    STQ     ACCT$,,AUTO

     1017     2028    1      CALL FAG$COUNT (I); /* Make sure there's some space to work with */

   2028  1 000036   200004 635500                    EPPR5   I,,AUTO
         1 000037   200022 455500                    STP5    @I+1,,AUTO
         1 000040   200022 630500                    EPPR0   @I+1,,AUTO
         1 000041   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000042   000000 701000 xent               TSX1    FAG$COUNT
         1 000043   000000 011000                    NOP     0

     1018     2029    2      IF U$CFU.FUN=%JRNL# THEN DO;

   2029  1 000044   200010 470500                    LDP0    UCFU$,,AUTO
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:225  
         1 000045   000000 236100                    LDQ     0,,PR0
         1 000046   700000 376003                    ANQ     -32768,DU
         1 000047   400000 116003                    CMPQ    -131072,DU
         1 000050   000121 601000 1                  TNZ     s:2039

     1019     2030    2         I=I-U$DCB.XTNSIZE-1;

   2030  1 000051   200006 471500                    LDP1    UDCB$,,AUTO
         1 000052   100037 236100                    LDQ     31,,PR1
         1 000053   000022 772000                    QRL     18
         1 000054   200022 756100                    STQ     @I+1,,AUTO
         1 000055   200004 236100                    LDQ     I,,AUTO
         1 000056   200022 136100                    SBLQ    @I+1,,AUTO
         1 000057   000001 136007                    SBLQ    1,DL
         1 000060   200004 756100                    STQ     I,,AUTO

     1020     2031    2         IF U$DCB.BORROW>1 THEN EXIT; /* Need 2 granules of user space */

   2031  1 000061   100065 235100                    LDA     53,,PR1
         1 000062   000001 115007                    CMPA    1,DL
         1 000063   000121 605400 1                  TPNZ    s:2039

     1021     2032    2         IF NOT U$DCB.STARF AND FM$CFUA.GRANS<2

   2032  1 000064   100064 236100                    LDQ     52,,PR1
         1 000065   200000 316003                    CANQ    65536,DU
         1 000066   000077 601000 1                  TNZ     s:2034
         1 000067   200014 473500                    LDP3    ACCT$,,AUTO
         1 000070   300007 235100                    LDA     7,,PR3
         1 000071   000002 115007                    CMPA    2,DL
         1 000072   000077 605000 1                  TPL     s:2034

     1022     2033    2         THEN B$JIT.ERR=FMP$E$ACGRANS;

   2033  1 000073   000003 236000 0                  LDQ     FMP$E$ACGRANS
         1 000074   000000 474400 xsym               LDP4    B$JIT$
         1 000075   400012 756100                    STQ     10,,PR4
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:226  
         1 000076   000120 710000 1                  TRA     s:2037

     1023     2034    2         ELSE IF U$DCB.STARF AND B$JIT.CURTMPDP+2<=B$JIT.MAXTMPDP

   2034  1 000077   200000 316003                    CANQ    65536,DU
         1 000100   000106 600000 1                  TZE     s:2034+7
         1 000101   000000 473400 xsym               LDP3    B$JIT$
         1 000102   300240 236100                    LDQ     160,,PR3
         1 000103   000002 036007                    ADLQ    2,DL
         1 000104   300241 116100                    CMPQ    161,,PR3
         1 000105   000121 604400 1                  TMOZ    s:2039
         1 000106   100064 236100                    LDQ     52,,PR1
         1 000107   200000 316003                    CANQ    65536,DU
         1 000110   000115 601000 1                  TNZ     s:2036
         1 000111   000000 473400 xsym               LDP3    B$JIT$
         1 000112   300242 235100                    LDA     162,,PR3
         1 000113   000001 115007                    CMPA    1,DL
         1 000114   000121 605400 1                  TPNZ    s:2039

     1024     2035    2              OR NOT U$DCB.STARF AND B$JIT.PRDPRM>1 THEN EXIT;
     1025     2036    2            ELSE B$JIT.ERR=FMP$E$USGRANS;

   2036  1 000115   000002 236000 0                  LDQ     FMP$E$USGRANS
         1 000116   000000 473400 xsym               LDP3    B$JIT$
         1 000117   300012 756100                    STQ     10,,PR3

     1026     2037    2         GOTO NOSPACE;

   2037  1 000120   000134 710000 1                  TRA     NOSPACE

     1027     2038    2         END;
     1028     2039    1      IF U$CFU.FUN=%CREATE# THEN I=I-1;

   2039  1 000121   000000 236100                    LDQ     0,,PR0
         1 000122   700000 376003                    ANQ     -32768,DU
         1 000123   300000 116003                    CMPQ    98304,DU
         1 000124   000127 601000 1                  TNZ     s:2040
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:227  

   2039  1 000125   000001 336007                    LCQ     1,DL
         1 000126   200004 056100                    ASQ     I,,AUTO

     1029     2040    2      IF I<1 THEN DO;

   2040  1 000127   200004 235100                    LDA     I,,AUTO
         1 000130   000137 605400 1                  TPNZ    s:2046

     1030     2041    2         B$JIT.ERR=FMP$E$PSGRANS;

   2041  1 000131   000001 236000 0                  LDQ     FMP$E$PSGRANS
         1 000132   000000 471400 xsym               LDP1    B$JIT$
         1 000133   100012 756100                    STQ     10,,PR1

   2041  1 000134                       NOSPACE      null
     1031     2042    2   NOSPACE:;
     1032     2043    2         SDCB$=ADDR(NIL);

   2043  1 000134   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000135   200007 756100                    STQ     SDCB$,,AUTO

     1033     2044    2         GOTO RETRET;

   2044  1 000136   001347 710000 1                  TRA     RETRET

     1034     2045    2         END;
     1035     2046    1      CALL FMM$SCRUB(DCBADDR(%M$STAR#));

   2046  1 000137   000000 471400 2                  LDP1    0
         1 000140   100000 473500                    LDP3    0,,PR1
         1 000141   300001 634500                    EPPR4   1,,PR3
         1 000142   200022 454500                    STP4    @I+1,,AUTO
         1 000143   200022 630500                    EPPR0   @I+1,,AUTO
         1 000144   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000145   000000 701000 xent               TSX1    FMM$SCRUB
         1 000146   000000 011000                    NOP     0
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:228  

     1036     2047    1      I=0;

   2047  1 000147   200004 450100                    STZ     I,,AUTO

     1037     2048    1      IC(3)=NAME.L;

   2048  1 000150   200003 470500                    LDP0    @NAME$,,AUTO
         1 000151   000000 471500                    LDP1    0,,PR0
         1 000152   040100 100500                    MLR     fill='040'O
         1 000153   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 000154   200004 600001                    ADSC9   I,,AUTO                  cn=3,n=1

     1038     2049    1      S$DCB.NAME.L=I;

   2049  1 000155   200007 471500                    LDP1    SDCB$,,AUTO
         1 000156   200004 236100                    LDQ     I,,AUTO
         1 000157   000033 736000                    QLS     27
         1 000160   100010 552140                    STBQ    8,'40'O,PR1

     1039     2050    1      S$DCB.NAME.C=NAME.C;

   2050  1 000161   000000 473500                    LDP3    0,,PR0
         1 000162   200004 720100                    LXL0    I,,AUTO
         1 000163   040100 100540                    MLR     fill='040'O
         1 000164   300000 200010                    ADSC9   0,,PR3                   cn=1,n=*X0
         1 000165   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31

     1040     2051    1      IF S$DCB.NAME=U$DCB.NAME THEN GOTO RETRET;

   2051  1 000166   200006 473500                    LDP3    UDCB$,,AUTO
         1 000167   000100 106500                    CMPC    fill='000'O
         1 000170   100010 000040                    ADSC9   8,,PR1                   cn=0,n=32
         1 000171   300010 000040                    ADSC9   8,,PR3                   cn=0,n=32
         1 000172   001347 600000 1                  TZE     RETRET

     1041     2052    1      S$DCB.DESC=U$DCB.DESC;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:229  

   2052  1 000173   300005 721100                    LXL1    5,,PR3
         1 000174   100005 441100                    SXL1    5,,PR1

     1042     2053    1      S$DCB.ACCT=U$DCB.ACCT;

   2053  1 000175   300020 237100                    LDAQ    16,,PR3
         1 000176   100020 757100                    STAQ    16,,PR1

     1043     2054    1      S$DCB.IASN=%FILE#;

   2054  1 000177   000001 236007                    LDQ     1,DL
         1 000200   100103 552104                    STBQ    67,'04'O,PR1

     1044     2055    1      S$DCB.FUN=%CREATE#;

   2055  1 000201   000003 236003                    LDQ     3,DU
         1 000202   100032 552120                    STBQ    26,'20'O,PR1

     1045     2056    1      S$DCB.WSR=U$DCB.WSR;

   2056  1 000203   300040 236100                    LDQ     32,,PR3
         1 000204   100040 552120                    STBQ    32,'20'O,PR1

     1046     2057    1      CALL FMN$CHKFLACN(DCBADDR(%M$STAR#))ALTRET(RETRET);

   2057  1 000205   000000 474400 2                  LDP4    0
         1 000206   400000 475500                    LDP5    0,,PR4
         1 000207   500001 636500                    EPPR6   1,,PR5
         1 000210   200022 456500                    STP6    @I+1,,AUTO
         1 000211   200022 630500                    EPPR0   @I+1,,AUTO
         1 000212   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000213   000000 701000 xent               TSX1    FMN$CHKFLACN
         1 000214   001347 702000 1                  TSX2    RETRET

     1047     2058    1      IF S$DCB.STARF~=U$DCB.STARF THEN GOTO FMPE$BADFNME;

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:230  
   2058  1 000215   200006 470500                    LDP0    UDCB$,,AUTO
         1 000216   200007 471500                    LDP1    SDCB$,,AUTO
         1 000217   100064 236100                    LDQ     52,,PR1
         1 000220   000064 676100                    ERQ     52,,PR0
         1 000221   200000 376003                    ANQ     65536,DU
         1 000222   001344 601000 1                  TNZ     FMPE$BADFNME

     1048     2059    1      S$DCB.SETX=U$DCB.SETX;

   2059  1 000223   000051 720100                    LXL0    41,,PR0
         1 000224   100051 440100                    SXL0    41,,PR1

     1049     2060    1      CALL FMR$G8(S$DCB.CFU$,I)ALTRET(RETRET);

   2060  1 000225   200004 633500                    EPPR3   I,,AUTO
         1 000226   200023 453500                    STP3    @I+2,,AUTO
         1 000227   200007 236100                    LDQ     SDCB$,,AUTO
         1 000230   000066 036003                    ADLQ    54,DU
         1 000231   200022 756100                    STQ     @I+1,,AUTO
         1 000232   200022 630500                    EPPR0   @I+1,,AUTO
         1 000233   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000234   000000 701000 xent               TSX1    FMR$G8
         1 000235   001347 702000 1                  TSX2    RETRET

     1050     2061    1      SCFU$=S$DCB.CFU$;

   2061  1 000236   200007 470500                    LDP0    SDCB$,,AUTO
         1 000237   000066 236100                    LDQ     54,,PR0
         1 000240   200011 756100                    STQ     SCFU$,,AUTO

     1051     2062    1      S$CFU.FUN=7;

   2062  1 000241   200011 471500                    LDP1    SCFU$,,AUTO
         1 000242   700000 236003                    LDQ     -32768,DU
         1 000243   100000 256100                    ORSQ    0,,PR1

     1052     2063    1      S$DCB.FUN=%UPDATE#;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:231  

   2063  1 000244   000001 236003                    LDQ     1,DU
         1 000245   000032 552120                    STBQ    26,'20'O,PR0

     1053     2064    1      S$CFU.SHARE=%NONE#;

   2064  1 000246   060000 236003                    LDQ     24576,DU
         1 000247   100000 256100                    ORSQ    0,,PR1

     1054     2065    1      S$CFU.ACCTX=POFFW(ACCT$,F$CFU$);

   2065  1 000250   000000 235000 xsym               LDA     F$CFU$
         1 000251   000022 771000                    ARL     18
         1 000252   200022 755100                    STA     @I+1,,AUTO
         1 000253   200014 236100                    LDQ     ACCT$,,AUTO
         1 000254   000022 772000                    QRL     18
         1 000255   200022 136100                    SBLQ    @I+1,,AUTO
         1 000256   000000 620006                    EAX0    0,QL
         1 000257   100002 740100                    STX0    2,,PR1

     1055     2066    1      B$JIT.DCB$=SDCB$;

   2066  1 000260   200007 236100                    LDQ     SDCB$,,AUTO
         1 000261   000000 473400 xsym               LDP3    B$JIT$
         1 000262   300232 756100                    STQ     154,,PR3

     1056     2067    1      IF NOT U$DCB.STARF THEN CALL UQB$MENQX(ACCT$)ALTRET(RETRET);

   2067  1 000263   200006 474500                    LDP4    UDCB$,,AUTO
         1 000264   400064 236100                    LDQ     52,,PR4
         1 000265   200000 316003                    CANQ    65536,DU
         1 000266   000275 601000 1                  TNZ     s:2068

   2067  1 000267   200014 635500                    EPPR5   ACCT$,,AUTO
         1 000270   200022 455500                    STP5    @I+1,,AUTO
         1 000271   200022 630500                    EPPR0   @I+1,,AUTO
         1 000272   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:232  
         1 000273   000000 701000 xent               TSX1    UQB$MENQX
         1 000274   001347 702000 1                  TSX2    RETRET

     1057     2068    1      CALL FMS$SCANNAME ALTRET(FMPE$BADFNME);/* ALTRETS IF CFU FOUND */

   2068  1 000275   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000276   000000 701000 xent               TSX1    FMS$SCANNAME
         1 000277   001344 702000 1                  TSX2    FMPE$BADFNME

     1058     2069    2      IF S$DCB.STARX=0 THEN DO;

   2069  1 000300   200007 470500                    LDP0    SDCB$,,AUTO
         1 000301   000064 236100                    LDQ     52,,PR0
         1 000302   007000 316007                    CANQ    3584,DL
         1 000303   000435 601000 1                  TNZ     s:2086

     1059     2070    2         IF S$DCB.STARF AND B$JIT.STAR.DA(0)=0 THEN CALL FMQ$BLDFD ALTRET(RETRET);

   2070  1 000304   200000 316003                    CANQ    65536,DU
         1 000305   000314 600000 1                  TZE     s:2071
         1 000306   000000 471400 xsym               LDP1    B$JIT$
         1 000307   100222 235100                    LDA     146,,PR1
         1 000310   000314 601000 1                  TNZ     s:2071

   2070  1 000311   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000312   000000 701000 xent               TSX1    FMQ$BLDFD
         1 000313   001347 702000 1                  TSX2    RETRET

     1060     2071    2         CALL FMQ$SRCHFD(ADDR(S$DCB.NAME),BUF$,TMP$,ACCT$,ADDR(NIL))ALTRET(NOKEY);

   2071  1 000314   200007 236100                    LDQ     SDCB$,,AUTO
         1 000315   000010 036003                    ADLQ    8,DU
         1 000316   200022 756100                    STQ     @I+1,,AUTO
         1 000317   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000320   200023 756100                    STQ     @I+2,,AUTO
         1 000321   200023 630500                    EPPR0   @I+2,,AUTO
         1 000322   200030 450500                    STP0    @I+7,,AUTO
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:233  
         1 000323   200014 631500                    EPPR1   ACCT$,,AUTO
         1 000324   200027 451500                    STP1    @I+6,,AUTO
         1 000325   200015 633500                    EPPR3   TMP$,,AUTO
         1 000326   200026 453500                    STP3    @I+5,,AUTO
         1 000327   200013 634500                    EPPR4   BUF$,,AUTO
         1 000330   200025 454500                    STP4    @I+4,,AUTO
         1 000331   200022 635500                    EPPR5   @I+1,,AUTO
         1 000332   200024 455500                    STP5    @I+3,,AUTO
         1 000333   200024 630500                    EPPR0   @I+3,,AUTO
         1 000334   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000335   000000 701000 xent               TSX1    FMQ$SRCHFD
         1 000336   000340 702000 1                  TSX2    NOKEY

     1061     2072    2         GOTO FMPE$BADFNME;

   2072  1 000337   001344 710000 1                  TRA     FMPE$BADFNME

   2070  1 000340                       NOKEY        null
     1062     2073    2   NOKEY:;
     1063     2074    2         IF B$JIT.ERR.CODE~=%E$NOKEY THEN GOTO RETRET;

   2074  1 000340   000000 470400 xsym               LDP0    B$JIT$
         1 000341   000012 236100                    LDQ     10,,PR0
         1 000342   377770 376007                    ANQ     131064,DL
         1 000343   001020 116007                    CMPQ    528,DL
         1 000344   001347 601000 1                  TNZ     RETRET

     1064     2075    2         IF SUBSTR(S$DCB.NAME.C,0,7)=':SECLOG' AND S$CFU.ACCTX=FM_SYSACCTX AND S_CUN~=
              2075                  JG_ELF#

   2075  1 000345   200007 471500                    LDP1    SDCB$,,AUTO
         1 000346   040000 106500                    CMPC    fill='040'O
         1 000347   100010 200007                    ADSC9   8,,PR1                   cn=1,n=7
         1 000350   000004 000007 0                  ADSC9   FMP$E$ACGRANS+1          cn=0,n=7
         1 000351   000362 601000 1                  TNZ     s:2077
         1 000352   200011 473500                    LDP3    SCFU$,,AUTO
         1 000353   300002 236100                    LDQ     2,,PR3
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:234  
         1 000354   000022 772000                    QRL     18
         1 000355   000000 116000 xsym               CMPQ    FM_SYSACCTX
         1 000356   000362 601000 1                  TNZ     s:2077
         1 000357   000000 235000 xsym               LDA     S_CUN
         1 000360   000006 115007                    CMPA    6,DL
         1 000361   001344 601000 1                  TNZ     FMPE$BADFNME

     1065     2076    2         THEN GOTO FMPE$BADFNME;
     1066     2077    2         IF B$JIT.ERR.MID~='21'O THEN CALL

   2077  1 000362   000012 236100                    LDQ     10,,PR0
         1 000363   000077 376003                    ANQ     63,DU
         1 000364   000021 116003                    CMPQ    17,DU
         1 000365   000405 600000 1                  TZE     s:2079

     1067     2078    2              FMG$ADDKEY(TMP$,SIZEW(FM$FDSEG),BUF$,ADDR(S$DCB.NAME))ALTRET(RETRET);

   2078  1 000366   200007 236100                    LDQ     SDCB$,,AUTO
         1 000367   000010 036003                    ADLQ    8,DU
         1 000370   200022 756100                    STQ     @I+1,,AUTO
         1 000371   200022 633500                    EPPR3   @I+1,,AUTO
         1 000372   200027 453500                    STP3    @I+6,,AUTO
         1 000373   200013 634500                    EPPR4   BUF$,,AUTO
         1 000374   200026 454500                    STP4    @I+5,,AUTO
         1 000375   000001 236000 2                  LDQ     1
         1 000376   200025 756100                    STQ     @I+4,,AUTO
         1 000377   200015 635500                    EPPR5   TMP$,,AUTO
         1 000400   200024 455500                    STP5    @I+3,,AUTO
         1 000401   200024 630500                    EPPR0   @I+3,,AUTO
         1 000402   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000403   000000 701000 xent               TSX1    FMG$ADDKEY
         1 000404   001347 702000 1                  TSX2    RETRET

     1068     2079    2         B$JIT.ERR='0'B;

   2079  1 000405   000000 470400 xsym               LDP0    B$JIT$
         1 000406   000012 450100                    STZ     10,,PR0
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:235  

     1069     2080    2         FM$KEYENT.D='0'B;

   2080  1 000407   200013 471500                    LDP1    BUF$,,AUTO
         1 000410   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000411   100000 356100                    ANSQ    0,,PR1

     1070     2081    2         FM$FDSEG.FITSDA=U$CFU.FITSDA;

   2081  1 000412   200010 470500                    LDP0    UCFU$,,AUTO
         1 000413   200015 471500                    LDP1    TMP$,,AUTO
         1 000414   000000 236100                    LDQ     0,,PR0
         1 000415   100000 552134                    STBQ    0,'34'O,PR1

     1071     2082    2         U$DCB.DESC.BUF=U$DCB.DESC.BUPM;

   2082  1 000416   200006 471500                    LDP1    UDCB$,,AUTO
         1 000417   100005 236100                    LDQ     5,,PR1
         1 000420   000007 736000                    QLS     7
         1 000421   100005 676100                    ERQ     5,,PR1
         1 000422   100000 376007                    ANQ     32768,DL
         1 000423   100005 656100                    ERSQ    5,,PR1

     1072     2083    2         FM$FDSEG.DESC=U$DCB.DESC;

   2083  1 000424   200015 473500                    LDP3    TMP$,,AUTO
         1 000425   100005 236100                    LDQ     5,,PR1
         1 000426   000022 736000                    QLS     18
         1 000427   300000 552140                    STBQ    0,'40'O,PR3

     1073     2084    2         CALL FMD$WRTSV(1);

   2084  1 000430   000001 630400 2                  EPPR0   1
         1 000431   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000432   000000 701000 xent               TSX1    FMD$WRTSV
         1 000433   000000 011000                    NOP     0

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:236  
     1074     2085    2         END;

   2085  1 000434   000446 710000 1                  TRA     s:2091

     1075     2086    1      ELSE B$JIT.STAR.DA(S$DCB.STARX)=U$CFU.FITSDA;

   2086  1 000435   000064 236100                    LDQ     52,,PR0
         1 000436   000011 772000                    QRL     9
         1 000437   000007 376007                    ANQ     7,DL
         1 000440   200010 471500                    LDP1    UCFU$,,AUTO
         1 000441   000000 473400 xsym               LDP3    B$JIT$
         1 000442   000000 620006                    EAX0    0,QL
         1 000443   100000 236100                    LDQ     0,,PR1
         1 000444   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000445   300222 756110                    STQ     146,X0,PR3

     1076     2087        %EJECT;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:237  
     1077     2088                    /* THE NEW NAME IS NOW CATALOGUED, BUT THE FIT DOWSN'T MATCH */
     1078     2089                    /* IF THE FILE IS NEW, MAKE SURE THERE IS NO OLD ONE */
     1079     2090                    /* SINCE WE BORROWED ON ITS GRANULES */
     1080     2091    2      IF U$CFU.FUN=%CREATE# THEN DO;

   2091  1 000446   200010 470500                    LDP0    UCFU$,,AUTO
         1 000447   000000 236100                    LDQ     0,,PR0
         1 000450   700000 376003                    ANQ     -32768,DU
         1 000451   300000 116003                    CMPQ    98304,DU
         1 000452   000506 601000 1                  TNZ     s:2097

     1081     2092    2         CALL FMD$FLSHBUF(1); /* RELEASE THE FD BUFFER */

   2092  1 000453   000001 630400 2                  EPPR0   1
         1 000454   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000455   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 000456   000000 011000                    NOP     0

     1082     2093    2         B$JIT.DCB$=UDCB$;

   2093  1 000457   200006 236100                    LDQ     UDCB$,,AUTO
         1 000460   000000 470400 xsym               LDP0    B$JIT$
         1 000461   000232 756100                    STQ     154,,PR0

     1083     2094    2         CALL FMQ$CTG(ADDR(U$DCB.NAME),I);

   2094  1 000462   000010 036003                    ADLQ    8,DU
         1 000463   200022 756100                    STQ     @I+1,,AUTO
         1 000464   200004 631500                    EPPR1   I,,AUTO
         1 000465   200025 451500                    STP1    @I+4,,AUTO
         1 000466   200022 633500                    EPPR3   @I+1,,AUTO
         1 000467   200024 453500                    STP3    @I+3,,AUTO
         1 000470   200024 630500                    EPPR0   @I+3,,AUTO
         1 000471   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000472   000000 701000 xent               TSX1    FMQ$CTG
         1 000473   000000 011000                    NOP     0

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:238  
     1084     2095    2         IF NOT U$DCB.STARF THEN CALL UQB$MENQX(ACCT$);

   2095  1 000474   200006 470500                    LDP0    UDCB$,,AUTO
         1 000475   000064 236100                    LDQ     52,,PR0
         1 000476   200000 316003                    CANQ    65536,DU
         1 000477   000506 601000 1                  TNZ     s:2097

   2095  1 000500   200014 631500                    EPPR1   ACCT$,,AUTO
         1 000501   200022 451500                    STP1    @I+1,,AUTO
         1 000502   200022 630500                    EPPR0   @I+1,,AUTO
         1 000503   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000504   000000 701000 xent               TSX1    UQB$MENQX
         1 000505   000000 011000                    NOP     0

     1085     2096    2         END;

     1086     2097    1      B$JIT.DCB$=UDCB$;

   2097  1 000506   200006 236100                    LDQ     UDCB$,,AUTO
         1 000507   000000 470400 xsym               LDP0    B$JIT$
         1 000510   000232 756100                    STQ     154,,PR0

     1087     2098    1      BUFNO=0;

   2098  1 000511   200005 450100                    STZ     BUFNO,,AUTO

     1088     2099    1      CALL FMN$GETFIT(BUF$,BUFNO)ALTRET(RETRET);

   2099  1 000512   200005 631500                    EPPR1   BUFNO,,AUTO
         1 000513   200023 451500                    STP1    @I+2,,AUTO
         1 000514   200013 633500                    EPPR3   BUF$,,AUTO
         1 000515   200022 453500                    STP3    @I+1,,AUTO
         1 000516   200022 630500                    EPPR0   @I+1,,AUTO
         1 000517   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000520   000000 701000 xent               TSX1    FMN$GETFIT
         1 000521   001347 702000 1                  TSX2    RETRET

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:239  
     1089     2100    1      LOC$=PINCRW(BUF$,SIZEW(FM$GRAN));

   2100  1 000522   200013 236100                    LDQ     BUF$,,AUTO
         1 000523   000005 036003                    ADLQ    5,DU
         1 000524   200012 756100                    STQ     LOC$,,AUTO

     1090     2101    1      TMP$=LOC$;

   2101  1 000525   200015 756100                    STQ     TMP$,,AUTO

     1091     2102    2      DO I=5 TO 6;

   2102  1 000526   000005 235007                    LDA     5,DL
         1 000527   200004 755100                    STA     I,,AUTO

     1092     2103    2         CALL FMO$LOCCODX(TMP$,I)ALTRET(NOEFT);

   2103  1 000530   200004 630500                    EPPR0   I,,AUTO
         1 000531   200023 450500                    STP0    @I+2,,AUTO
         1 000532   200015 631500                    EPPR1   TMP$,,AUTO
         1 000533   200022 451500                    STP1    @I+1,,AUTO
         1 000534   200022 630500                    EPPR0   @I+1,,AUTO
         1 000535   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000536   000000 701000 xent               TSX1    FMO$LOCCODX
         1 000537   000550 702000 1                  TSX2    NOEFT

     1093     2104    2         FM$FIT.CODES.NDW(I)=0;

   2104  1 000540   200012 470500                    LDP0    LOC$,,AUTO
         1 000541   200004 720100                    LXL0    I,,AUTO
         1 000542   000002 236000 2                  LDQ     2
         1 000543   000000 356110                    ANSQ    0,X0,PR0

     1094     2105    2         I=FM$FIT.CODES.CODE(I);

   2105  1 000544   200004 720100                    LXL0    I,,AUTO
         1 000545   000000 236110                    LDQ     0,X0,PR0
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:240  
         1 000546   000037 772000                    QRL     31
         1 000547   200004 756100                    STQ     I,,AUTO

     1095     2106    2   NOEFT:END;

   2106  1 000550   200004 054100       NOEFT        AOS     I,,AUTO
         1 000551   200004 235100                    LDA     I,,AUTO
         1 000552   000006 115007                    CMPA    6,DL
         1 000553   000530 604400 1                  TMOZ    s:2103

     1096     2107    1      CALL SSS$SYSTIME(I);

   2107  1 000554   200004 630500                    EPPR0   I,,AUTO
         1 000555   200022 450500                    STP0    @I+1,,AUTO
         1 000556   200022 630500                    EPPR0   @I+1,,AUTO
         1 000557   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000560   000000 701000 xent               TSX1    SSS$SYSTIME
         1 000561   000000 011000                    NOP     0

     1097     2108    1      CALL LOCCODP(4)ALTRET(NOTIME);

   2108  1 000562   000003 236000 2                  LDQ     3
         1 000563   200021 756100                    STQ     DA+3,,AUTO
         1 000564   001511 701000 1                  TSX1    LOCCODP
         1 000565   000571 702000 1                  TSX2    NOTIME

     1098     2109    1      CODE04.MODIFY.TIME=I;

   2109  1 000566   200004 235100                    LDA     I,,AUTO
         1 000567   200012 470500                    LDP0    LOC$,,AUTO
         1 000570   000001 755100                    STA     1,,PR0

   2109  1 000571                       NOTIME       null
     1099     2110    1   NOTIME:;
     1100     2111    1      CALL LOCCODP(3);

   2111  1 000571   000004 236000 2                  LDQ     4
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:241  
         1 000572   200021 756100                    STQ     DA+3,,AUTO
         1 000573   001511 701000 1                  TSX1    LOCCODP
         1 000574   000000 011000                    NOP     0

     1101     2112    1      B$JIT.DCB$=SDCB$;

   2112  1 000575   200007 236100                    LDQ     SDCB$,,AUTO
         1 000576   000000 470400 xsym               LDP0    B$JIT$
         1 000577   000232 756100                    STQ     154,,PR0

     1102     2113    1      CALL FMM$NSTAMP(CODE03.NSTAMP);

   2113  1 000600   200012 236100                    LDQ     LOC$,,AUTO
         1 000601   000006 036003                    ADLQ    6,DU
         1 000602   200022 756100                    STQ     @I+1,,AUTO
         1 000603   200022 630500                    EPPR0   @I+1,,AUTO
         1 000604   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000605   000000 701000 xent               TSX1    FMM$NSTAMP
         1 000606   000000 011000                    NOP     0

     1103     2114    1      B$JIT.DCB$=UDCB$;

   2114  1 000607   200006 236100                    LDQ     UDCB$,,AUTO
         1 000610   000000 470400 xsym               LDP0    B$JIT$
         1 000611   000232 756100                    STQ     154,,PR0

     1104     2115    1      CALL FMD$WRTSV(BUFNO);

   2115  1 000612   200005 631500                    EPPR1   BUFNO,,AUTO
         1 000613   200022 451500                    STP1    @I+1,,AUTO
         1 000614   200022 630500                    EPPR0   @I+1,,AUTO
         1 000615   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000616   000000 701000 xent               TSX1    FMD$WRTSV
         1 000617   000000 011000                    NOP     0

     1105     2116    1      S$CFU.FITSDA=U$CFU.FITSDA;

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:242  
   2116  1 000620   200010 470500                    LDP0    UCFU$,,AUTO
         1 000621   200011 471500                    LDP1    SCFU$,,AUTO
         1 000622   000000 236100                    LDQ     0,,PR0
         1 000623   100000 552134                    STBQ    0,'34'O,PR1

     1106     2117    2      IF U$CFU.FUN=%JRNL# THEN DO;

   2117  1 000624   000000 236100                    LDQ     0,,PR0
         1 000625   700000 376003                    ANQ     -32768,DU
         1 000626   400000 116003                    CMPQ    -131072,DU
         1 000627   001114 601000 1                  TNZ     s:2176

     1107     2118                    /* IF JOURNAL SWITCH, START UP A NEW FILE HERE */
     1108     2119    3         IF BUFNO=1 THEN DO;

   2119  1 000630   200005 235100                    LDA     BUFNO,,AUTO
         1 000631   000001 115007                    CMPA    1,DL
         1 000632   000673 601000 1                  TNZ     s:2130

     1109     2120    3            LOC$=BUF$;

   2120  1 000633   200013 236100                    LDQ     BUF$,,AUTO
         1 000634   200012 756100                    STQ     LOC$,,AUTO

     1110     2121    3            CALL FMD$GETBUF(0,1,BUF$);

   2121  1 000635   200013 633500                    EPPR3   BUF$,,AUTO
         1 000636   200024 453500                    STP3    @I+3,,AUTO
         1 000637   000006 237000 2                  LDAQ    6
         1 000640   200022 757100                    STAQ    @I+1,,AUTO
         1 000641   200022 630500                    EPPR0   @I+1,,AUTO
         1 000642   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000643   000000 701000 xent               TSX1    FMD$GETBUF
         1 000644   000000 011000                    NOP     0

     1111     2122    3            BUF$->GRAN=LOC$->GRAN;

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:243  
   2122  1 000645   200012 470500                    LDP0    LOC$,,AUTO
         1 000646   010000 220003                    LDX0    4096,DU
         1 000647   200013 471500                    LDP1    BUF$,,AUTO
         1 000650   040140 100540                    MLR     fill='040'O
         1 000651   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         1 000652   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

     1112     2123    3            BUFNO=0;

   2123  1 000653   200005 450100                    STZ     BUFNO,,AUTO

     1113     2124    3            DA=U$CFU.FITSDA;

   2124  1 000654   200010 471500                    LDP1    UCFU$,,AUTO
         1 000655   100000 236100                    LDQ     0,,PR1
         1 000656   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000657   200016 756100                    STQ     DA,,AUTO

     1114     2125    3            CALL FMC$CLR1(DA);

   2125  1 000660   200016 633500                    EPPR3   DA,,AUTO
         1 000661   200022 453500                    STP3    @I+1,,AUTO
         1 000662   200022 630500                    EPPR0   @I+1,,AUTO
         1 000663   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000664   000000 701000 xent               TSX1    FMC$CLR1
         1 000665   000000 011000                    NOP     0

     1115     2126    3            CALL LOCCODP(3);

   2126  1 000666   000004 236000 2                  LDQ     4
         1 000667   200021 756100                    STQ     DA+3,,AUTO
         1 000670   001511 701000 1                  TSX1    LOCCODP
         1 000671   000000 011000                    NOP     0

     1116     2127    3            END;

   2127  1 000672   000717 710000 1                  TRA     s:2134
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:244  

     1117     2128    2         ELSE
     1118     2129    3         DO;   /* GET UNCACHED COPY */

     1119     2130    3            CALL FMD$FLSHBUF(BUFNO);

   2130  1 000673   200005 633500                    EPPR3   BUFNO,,AUTO
         1 000674   200022 453500                    STP3    @I+1,,AUTO
         1 000675   200022 630500                    EPPR0   @I+1,,AUTO
         1 000676   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000677   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 000700   000000 011000                    NOP     0

     1120     2131    3            DA=U$CFU.FITSDA;

   2131  1 000701   200010 470500                    LDP0    UCFU$,,AUTO
         1 000702   000000 236100                    LDQ     0,,PR0
         1 000703   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000704   200016 756100                    STQ     DA,,AUTO

     1121     2132    3            CALL FMD$REDBUFBC(BUF$, BUFNO, DA) ALTRET(RETRET);

   2132  1 000705   200016 631500                    EPPR1   DA,,AUTO
         1 000706   200024 451500                    STP1    @I+3,,AUTO
         1 000707   200005 633500                    EPPR3   BUFNO,,AUTO
         1 000710   200023 453500                    STP3    @I+2,,AUTO
         1 000711   200013 634500                    EPPR4   BUF$,,AUTO
         1 000712   200022 454500                    STP4    @I+1,,AUTO
         1 000713   200022 630500                    EPPR0   @I+1,,AUTO
         1 000714   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000715   000000 701000 xent               TSX1    FMD$REDBUFBC
         1 000716   001347 702000 1                  TSX2    RETRET

     1122     2133    3            END; /* GET UNCACHED COPY */

     1123     2134    2         CALL FMH$JRELPG(1);

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:245  
   2134  1 000717   000001 630400 2                  EPPR0   1
         1 000720   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000721   000000 701000 xent               TSX1    FMH$JRELPG
         1 000722   000000 011000                    NOP     0

     1124     2135    2         U$DCB.BFR(1)=U$DCB.BFR(BUFNO);

   2135  1 000723   200006 470500                    LDP0    UDCB$,,AUTO
         1 000724   200005 720100                    LXL0    BUFNO,,AUTO
         1 000725   000115 236110                    LDQ     77,X0,PR0
         1 000726   000116 756100                    STQ     78,,PR0

     1125     2136    2         U$DCB.BFR1(1)=U$DCB.BFR1(BUFNO);

   2136  1 000727   000122 236110                    LDQ     82,X0,PR0
         1 000730   000123 756100                    STQ     83,,PR0

     1126     2137    2         U$DCB.BFR(BUFNO)='0'B;

   2137  1 000731   000115 450110                    STZ     77,X0,PR0

     1127     2138    2         U$DCB.BFR1(BUFNO)='0'B;

   2138  1 000732   200005 720100                    LXL0    BUFNO,,AUTO
         1 000733   000122 450110                    STZ     82,X0,PR0

     1128     2139    2         U$CFU.FITSDA=0;

   2139  1 000734   200010 471500                    LDP1    UCFU$,,AUTO
         1 000735   000000 236003                    LDQ     0,DU
         1 000736   100000 552134                    STBQ    0,'34'O,PR1

     1129     2140    2         U$CFU.UGRANS=0;

   2140  1 000737   100004 552134                    STBQ    4,'34'O,PR1

     1130     2141    2         U$CFU.AFIT=0;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:246  

   2141  1 000740   000010 236000 2                  LDQ     8
         1 000741   100000 356100                    ANSQ    0,,PR1

     1131     2142    2         U$CFU.NRECS=0;

   2142  1 000742   100001 450100                    STZ     1,,PR1

     1132     2143    2         U$CFU.LDA=FM_FRZERO;

   2143  1 000743   000100 101400                    MRL     fill='000'O
         1 000744   000000 000004 xsym               ADSC9   FM_FRZERO                cn=0,n=4
         1 000745   100006 400003                    ADSC9   6,,PR1                   cn=2,n=3

     1133     2144    2         FM$GRAN.LVL=0;/* NOT AN AFIT */

   2144  1 000746   200013 473500                    LDP3    BUF$,,AUTO
         1 000747   000011 236000 2                  LDQ     9
         1 000750   300001 356100                    ANSQ    1,,PR3

     1134     2145    2         FM$GRAN.NAVX=FM$GRAN.FCEX;

   2145  1 000751   200013 473500                    LDP3    BUF$,,AUTO
         1 000752   300002 220100                    LDX0    2,,PR3
         1 000753   300001 740100                    STX0    1,,PR3

     1135     2146    2         FM$GRAN.AVAIL=1024-FM$GRAN.NAVX;

   2146  1 000754   200013 473500                    LDP3    BUF$,,AUTO
         1 000755   300001 236100                    LDQ     1,,PR3
         1 000756   000022 772000                    QRL     18
         1 000757   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 000760   002001 036007                    ADLQ    1025,DL
         1 000761   300001 676100                    ERQ     1,,PR3
         1 000762   001777 376007                    ANQ     1023,DL
         1 000763   300001 656100                    ERSQ    1,,PR3

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:247  
     1136     2147    2         CALL FMM$NSTAMP(CODE03.NSTAMP);

   2147  1 000764   200012 236100                    LDQ     LOC$,,AUTO
         1 000765   000006 036003                    ADLQ    6,DU
         1 000766   200022 756100                    STQ     @I+1,,AUTO
         1 000767   200022 630500                    EPPR0   @I+1,,AUTO
         1 000770   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000771   000000 701000 xent               TSX1    FMM$NSTAMP
         1 000772   000000 011000                    NOP     0

     1137     2148    2         CODE03.UGRANS=0;

   2148  1 000773   200012 470500                    LDP0    LOC$,,AUTO
         1 000774   000000 236003                    LDQ     0,DU
         1 000775   000000 552134                    STBQ    0,'34'O,PR0

     1138     2149    2         CODE03.NGAVAL=0;

   2149  1 000776   000003 552134                    STBQ    3,'34'O,PR0

     1139     2150    2         CODE03.NRECS=0;

   2150  1 000777   000002 450100                    STZ     2,,PR0

     1140     2151    2         CODE03.DESC.BAD='0'B;

   2151  1 001000   000012 236000 2                  LDQ     10
         1 001001   000001 356100                    ANSQ    1,,PR0

     1141     2152    2         U$DCB.HASH=I;

   2152  1 001002   200006 471500                    LDP1    UDCB$,,AUTO
         1 001003   200004 236100                    LDQ     I,,AUTO
         1 001004   000011 736000                    QLS     9
         1 001005   100073 552170                    STBQ    59,'70'O,PR1

     1142     2153    2         FM$GRAN.STAMP.GMOD=0;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:248  

   2153  1 001006   200013 473500                    LDP3    BUF$,,AUTO
         1 001007   000000 236003                    LDQ     0,DU
         1 001010   300000 552104                    STBQ    0,'04'O,PR3

     1143     2154    2         FM$GRAN.STAMP.HASH=I;

   2154  1 001011   200013 473500                    LDP3    BUF$,,AUTO
         1 001012   200004 236100                    LDQ     I,,AUTO
         1 001013   000011 736000                    QLS     9
         1 001014   300000 552170                    STBQ    0,'70'O,PR3

     1144     2155    2         CALL LOCCODP(4)ALTRET(NOTIME1);

   2155  1 001015   000003 236000 2                  LDQ     3
         1 001016   200021 756100                    STQ     DA+3,,AUTO
         1 001017   001511 701000 1                  TSX1    LOCCODP
         1 001020   001030 702000 1                  TSX2    NOTIME1

     1145     2156    2         CODE04.ACCESS.TIME=I;

   2156  1 001021   200004 235100                    LDA     I,,AUTO
         1 001022   200012 470500                    LDP0    LOC$,,AUTO
         1 001023   000000 755100                    STA     0,,PR0

     1146     2157    2         CODE04.CREATION.TIME=I;

   2157  1 001024   200004 236100                    LDQ     I,,AUTO
         1 001025   000002 756100                    STQ     2,,PR0

     1147     2158    2         CODE04.SVMODIFY.TIME=I;

   2158  1 001026   200004 235100                    LDA     I,,AUTO
         1 001027   000010 755100                    STA     8,,PR0

   2158  1 001030                       NOTIME1      null
     1148     2159    2   NOTIME1:;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:249  
     1149     2160    2         PINCRW(BUF$,SIZEW(FM$GRAN))->FM$FIT.CODES.NDW(1)=1;

   2160  1 001030   200013 470500                    LDP0    BUF$,,AUTO
         1 001031   000006 236100                    LDQ     6,,PR0
         1 001032   000002 376000 2                  ANQ     2
         1 001033   002000 276007                    ORQ     1024,DL
         1 001034   000006 756100                    STQ     6,,PR0

     1150     2161    2         CALL LOCCODP(1);/* FIX EXTENT LIST, HASH*/

   2161  1 001035   000001 236000 2                  LDQ     1
         1 001036   200021 756100                    STQ     DA+3,,AUTO
         1 001037   001511 701000 1                  TSX1    LOCCODP
         1 001040   000000 011000                    NOP     0

     1151     2162    2         CODE01.HASH=I;

   2162  1 001041   200012 470500                    LDP0    LOC$,,AUTO
         1 001042   200004 236100                    LDQ     I,,AUTO
         1 001043   000000 552134                    STBQ    0,'34'O,PR0

     1152     2163    2         CODE01.NXTNTS=0;

   2163  1 001044   000000 236003                    LDQ     0,DU
         1 001045   000000 552140                    STBQ    0,'40'O,PR0

     1153     2164    2         CALL FMR$G8(TMP$,I)ALTRET(RETRET);

   2164  1 001046   200004 631500                    EPPR1   I,,AUTO
         1 001047   200023 451500                    STP1    @I+2,,AUTO
         1 001050   200015 633500                    EPPR3   TMP$,,AUTO
         1 001051   200022 453500                    STP3    @I+1,,AUTO
         1 001052   200022 630500                    EPPR0   @I+1,,AUTO
         1 001053   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001054   000000 701000 xent               TSX1    FMR$G8
         1 001055   001347 702000 1                  TSX2    RETRET

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:250  
     1154     2165    2         S$CFU.XTX=U$CFU.XTX;

   2165  1 001056   200010 470500                    LDP0    UCFU$,,AUTO
         1 001057   000003 220100                    LDX0    3,,PR0
         1 001060   200011 471500                    LDP1    SCFU$,,AUTO
         1 001061   100003 740100                    STX0    3,,PR1

     1155     2166    2         U$CFU.XTX=I;

   2166  1 001062   200004 721100                    LXL1    I,,AUTO
         1 001063   000003 741100                    STX1    3,,PR0

     1156     2167    2         U$DCB.BFR.DA(1)=FM_FRZERO;

   2167  1 001064   200006 473500                    LDP3    UDCB$,,AUTO
         1 001065   000000 236000 xsym               LDQ     FM_FRZERO
         1 001066   300116 552134                    STBQ    78,'34'O,PR3

     1157     2168    2         U$DCB.IXTNSIZE=U$DCB.XTNSIZE+1;

   2168  1 001067   300037 236100                    LDQ     31,,PR3
         1 001070   000022 772000                    QRL     18
         1 001071   000001 036007                    ADLQ    1,DL
         1 001072   300041 756100                    STQ     33,,PR3

     1158     2169    2         U$DCB.BFR.BUFUP(1)='1'B;

   2169  1 001073   400000 236003                    LDQ     -131072,DU
         1 001074   300116 256100                    ORSQ    78,,PR3

     1159     2170    2         CALL FAG$GEXT ALTRET(RETRET);

   2170  1 001075   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001076   000000 701000 xent               TSX1    FAG$GEXT
         1 001077   001347 702000 1                  TSX2    RETRET

     1160     2171    2         U$CFU.UGRANS=1;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:251  

   2171  1 001100   200010 470500                    LDP0    UCFU$,,AUTO
         1 001101   000001 236007                    LDQ     1,DL
         1 001102   000004 552134                    STBQ    4,'34'O,PR0

     1161     2172    2         U$CFU.NGAVAL=U$CFU.NGAVAL-1;

   2172  1 001103   000007 236100                    LDQ     7,,PR0
         1 001104   000032 036000 xsym               ADLQ    B_VECTNIL+26
         1 001105   000007 552134                    STBQ    7,'34'O,PR0

     1162     2173    2         U$CFU.FITSDA=FM$CFUEXT.XTNT.XTNSDA(0);

   2173  1 001106   200012 471500                    LDP1    LOC$,,AUTO
         1 001107   100001 236100                    LDQ     1,,PR1
         1 001110   000000 552134                    STBQ    0,'34'O,PR0

     1163     2174    2         U$CFUJ.ERR_WAIT='0'B;

   2174  1 001111   000013 236000 2                  LDQ     11
         1 001112   000005 356100                    ANSQ    5,,PR0

     1164     2175    2         END;

   2175  1 001113   001116 710000 1                  TRA     s:2177

     1165     2176    1      ELSE U$CFU.FITSDA=0;

   2176  1 001114   000000 236003                    LDQ     0,DU
         1 001115   000000 552134                    STBQ    0,'34'O,PR0

     1166     2177    1      CALL FMD$FLSHBUF(1);/* MOVE STAR BUFFER HERE*/

   2177  1 001116   000001 630400 2                  EPPR0   1
         1 001117   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001120   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 001121   000000 011000                    NOP     0
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:252  

     1167     2178    1      U$DCB.BFR1(1)=S$DCB.BFR1(1);

   2178  1 001122   200007 470500                    LDP0    SDCB$,,AUTO
         1 001123   000123 236100                    LDQ     83,,PR0
         1 001124   200006 471500                    LDP1    UDCB$,,AUTO
         1 001125   100123 756100                    STQ     83,,PR1

     1168     2179    1      S$DCB.BFR1(1)='0'B;

   2179  1 001126   000123 450100                    STZ     83,,PR0

     1169     2180    1      U$DCB.BFR(1)=S$DCB.BFR(1);

   2180  1 001127   000116 236100                    LDQ     78,,PR0
         1 001130   100116 756100                    STQ     78,,PR1

     1170     2181    1      S$DCB.BFR(1)='0'B;

   2181  1 001131   000116 450100                    STZ     78,,PR0

     1171     2182    2      IF U$DCB.STARX=0 THEN DO;

   2182  1 001132   100064 236100                    LDQ     52,,PR1
         1 001133   007000 316007                    CANQ    3584,DL
         1 001134   001236 601000 1                  TNZ     s:2200

     1172     2183                    /* NOW REMOVE THE OLD FD POINTER */
     1173     2184    2         CALL FMQ$SRCHFD(ADDR(U$DCB.NAME),BUF$,TMP$,ACCT$,ADDR(NIL))ALTRET(RETRET);

   2184  1 001135   200006 236100                    LDQ     UDCB$,,AUTO
         1 001136   000010 036003                    ADLQ    8,DU
         1 001137   200022 756100                    STQ     @I+1,,AUTO
         1 001140   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001141   200023 756100                    STQ     @I+2,,AUTO
         1 001142   200023 633500                    EPPR3   @I+2,,AUTO
         1 001143   200030 453500                    STP3    @I+7,,AUTO
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:253  
         1 001144   200014 634500                    EPPR4   ACCT$,,AUTO
         1 001145   200027 454500                    STP4    @I+6,,AUTO
         1 001146   200015 635500                    EPPR5   TMP$,,AUTO
         1 001147   200026 455500                    STP5    @I+5,,AUTO
         1 001150   200013 636500                    EPPR6   BUF$,,AUTO
         1 001151   200025 456500                    STP6    @I+4,,AUTO
         1 001152   200022 637500                    EPPR7   @I+1,,AUTO
         1 001153   200024 457500                    STP7    @I+3,,AUTO
         1 001154   200024 630500                    EPPR0   @I+3,,AUTO
         1 001155   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 001156   000000 701000 xent               TSX1    FMQ$SRCHFD
         1 001157   001347 702000 1                  TSX2    RETRET

     1174     2185    2         FM$FDSEG.FITSDA=U$CFU.FITSDA;

   2185  1 001160   200010 470500                    LDP0    UCFU$,,AUTO
         1 001161   200015 471500                    LDP1    TMP$,,AUTO
         1 001162   000000 236100                    LDQ     0,,PR0
         1 001163   100000 552134                    STBQ    0,'34'O,PR1

     1175     2186    2         FM$FDSEG.DESC.BAD='0'B;

   2186  1 001164   200015 471500                    LDP1    TMP$,,AUTO
         1 001165   000012 236000 2                  LDQ     10
         1 001166   100000 356100                    ANSQ    0,,PR1

     1176     2187    2         U$DCB.BFR.BUFUP(1)='1'B;

   2187  1 001167   200006 471500                    LDP1    UDCB$,,AUTO
         1 001170   400000 236003                    LDQ     -131072,DU
         1 001171   100116 256100                    ORSQ    78,,PR1

     1177     2188    3         IF U$CFU.FITSDA=0 THEN DO;

   2188  1 001172   000000 236100                    LDQ     0,,PR0
         1 001173   000032 316000 xsym               CANQ    B_VECTNIL+26
         1 001174   001247 601000 1                  TNZ     s:2201
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:254  

     1178     2189    3            FM$KEYENT.D='1'B;

   2189  1 001175   200013 473500                    LDP3    BUF$,,AUTO
         1 001176   400000 236003                    LDQ     -131072,DU
         1 001177   300000 256100                    ORSQ    0,,PR3

     1179     2190    3            FM$FDSEG='0'B;

   2190  1 001200   200015 473500                    LDP3    TMP$,,AUTO
         1 001201   300000 450100                    STZ     0,,PR3

     1180     2191    3            FM$FDSEG.DESC.DELF='1'B;

   2191  1 001202   200015 473500                    LDP3    TMP$,,AUTO
         1 001203   300000 256100                    ORSQ    0,,PR3

     1181     2192    3            IF U$DCB.STARF THEN CALL FMG$REMKEY;

   2192  1 001204   100064 236100                    LDQ     52,,PR1
         1 001205   200000 316003                    CANQ    65536,DU
         1 001206   001213 600000 1                  TZE     s:2193

   2192  1 001207   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001210   000000 701000 xent               TSX1    FMG$REMKEY
         1 001211   000000 011000                    NOP     0
         1 001212   001247 710000 1                  TRA     s:2201

     1182     2193    3            ELSE IF NOT FM$CFUA.ACCESS.BUPF THEN CALL FMG$REMKEY;

   2193  1 001213   200014 473500                    LDP3    ACCT$,,AUTO
         1 001214   300005 236100                    LDQ     5,,PR3
         1 001215   040000 316007                    CANQ    16384,DL
         1 001216   001223 601000 1                  TNZ     s:2195

   2193  1 001217   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001220   000000 701000 xent               TSX1    FMG$REMKEY
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:255  
         1 001221   000000 011000                    NOP     0
         1 001222   001247 710000 1                  TRA     s:2201

     1183     2194    4               ELSE DO;

     1184     2195    4                  CALL SSS$SYSTIME(I);

   2195  1 001223   200004 634500                    EPPR4   I,,AUTO
         1 001224   200022 454500                    STP4    @I+1,,AUTO
         1 001225   200022 630500                    EPPR0   @I+1,,AUTO
         1 001226   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001227   000000 701000 xent               TSX1    SSS$SYSTIME
         1 001230   000000 011000                    NOP     0

     1185     2196    4                  FM$FDSEG.FITSDA=IU/512;

   2196  1 001231   200004 236100                    LDQ     I,,AUTO
         1 001232   000011 772000                    QRL     9
         1 001233   200015 470500                    LDP0    TMP$,,AUTO
         1 001234   000000 552134                    STBQ    0,'34'O,PR0

     1186     2197    4                  END;

     1187     2198    3            END;

     1188     2199    2         END;

   2199  1 001235   001247 710000 1                  TRA     s:2201

     1189     2200    1      ELSE B$JIT.STAR.DA(U$DCB.STARX)=U$CFU.FITSDA;

   2200  1 001236   100064 236100                    LDQ     52,,PR1
         1 001237   000011 772000                    QRL     9
         1 001240   000007 376007                    ANQ     7,DL
         1 001241   200010 473500                    LDP3    UCFU$,,AUTO
         1 001242   000000 474400 xsym               LDP4    B$JIT$
         1 001243   000000 620006                    EAX0    0,QL
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:256  
         1 001244   300000 236100                    LDQ     0,,PR3
         1 001245   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001246   400222 756110                    STQ     146,X0,PR4

     1190     2201    1      CALL FMP$RELCFUS(S$DCB.CFU$);

   2201  1 001247   200007 236100                    LDQ     SDCB$,,AUTO
         1 001250   000066 036003                    ADLQ    54,DU
         1 001251   200022 756100                    STQ     @I+1,,AUTO
         1 001252   200022 630500                    EPPR0   @I+1,,AUTO
         1 001253   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001254   000000 701000 xent               TSX1    FMP$RELCFUS
         1 001255   000000 011000                    NOP     0

     1191     2202    1      CALL FMD$FLSHBUF(1);

   2202  1 001256   000001 630400 2                  EPPR0   1
         1 001257   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001260   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 001261   000000 011000                    NOP     0

     1192     2203    1      IF NOT U$DCB.STARF THEN CALL UQB$MDEQ(ACCT$);

   2203  1 001262   200006 470500                    LDP0    UDCB$,,AUTO
         1 001263   000064 236100                    LDQ     52,,PR0
         1 001264   200000 316003                    CANQ    65536,DU
         1 001265   001274 601000 1                  TNZ     s:2204

   2203  1 001266   200014 631500                    EPPR1   ACCT$,,AUTO
         1 001267   200022 451500                    STP1    @I+1,,AUTO
         1 001270   200022 630500                    EPPR0   @I+1,,AUTO
         1 001271   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001272   000000 701000 xent               TSX1    UQB$MDEQ
         1 001273   000000 011000                    NOP     0

     1193     2204    2      IF U$CFU.FUN=%JRNL# THEN DO;

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:257  
   2204  1 001274   200010 470500                    LDP0    UCFU$,,AUTO
         1 001275   000000 236100                    LDQ     0,,PR0
         1 001276   700000 376003                    ANQ     -32768,DU
         1 001277   400000 116003                    CMPQ    -131072,DU
         1 001300   001343 601000 1                  TNZ     s:2216

     1194     2205    2         IC=B$JIT.ERR;

   2205  1 001301   000000 471400 xsym               LDP1    B$JIT$
         1 001302   100012 236100                    LDQ     10,,PR1
         1 001303   200004 756100                    STQ     I,,AUTO

   2205  1 001304                       JRNLRET      null
     1195     2206    2   JRNLRET:;
     1196     2207    2         U$DCB.SHARED='0'B; /* DISABLE ENQ-DEQ IN FMF */

   2207  1 001304   200006 470500                    LDP0    UDCB$,,AUTO
         1 001305   000014 236000 2                  LDQ     12
         1 001306   000064 356100                    ANSQ    52,,PR0

     1197     2208    2         U$DCB.GTYP=FMGTFILE;

   2208  1 001307   000064 236100                    LDQ     52,,PR0
         1 001310   000015 376000 2                  ANQ     13
         1 001311   030000 276003                    ORQ     12288,DU
         1 001312   000064 756100                    STQ     52,,PR0

     1198     2209    2         CALL FMF$PEOF(FPTPFILEOF);

   2209  1 001313   000016 630400 2                  EPPR0   14
         1 001314   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001315   000000 701000 xent               TSX1    FMF$PEOF
         1 001316   000000 011000                    NOP     0

     1199     2210    2         U$DCB.SHARED='1'B;

   2210  1 001317   200006 470500                    LDP0    UDCB$,,AUTO
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:258  
         1 001320   100000 236003                    LDQ     32768,DU
         1 001321   000064 256100                    ORSQ    52,,PR0

     1200     2211    2         CALL FMH$JGETPG(1);

   2211  1 001322   000001 630400 2                  EPPR0   1
         1 001323   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001324   000000 701000 xent               TSX1    FMH$JGETPG
         1 001325   000000 011000                    NOP     0

     1201     2212    2         CALL UQB$MDEQ(U$DCB.CFU$);

   2212  1 001326   200006 236100                    LDQ     UDCB$,,AUTO
         1 001327   000066 036003                    ADLQ    54,DU
         1 001330   200022 756100                    STQ     @I+1,,AUTO
         1 001331   200022 630500                    EPPR0   @I+1,,AUTO
         1 001332   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001333   000000 701000 xent               TSX1    UQB$MDEQ
         1 001334   000000 011000                    NOP     0

     1202     2213    2         B$JIT.ERR=IC;

   2213  1 001335   200004 236100                    LDQ     I,,AUTO
         1 001336   000000 470400 xsym               LDP0    B$JIT$
         1 001337   000012 756100                    STQ     10,,PR0

     1203     2214    2         CALL UDB$PMMEXIT;

   2214  1 001340   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001341   000000 701000 xent               TSX1    UDB$PMMEXIT
         1 001342   000000 011000                    NOP     0

     1204     2215    2         END;

     1205     2216    1      RETURN;

   2216  1 001343   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:259  

   2212  1 001344                       FMPE$BADFNME null
     1206     2217                    /**/
     1207     2218        %EJECT;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:260  
     1208     2219    1   FMPE$BADFNME:;
     1209     2220    1      B$JIT.ERR=FMP$E$BADFNME;

   2220  1 001344   000000 236000 0                  LDQ     FMP$E$BADFNME
         1 001345   000000 470400 xsym               LDP0    B$JIT$
         1 001346   000012 756100                    STQ     10,,PR0

   2220  1 001347                       RETRET       null
     1210     2221    1   RETRET:;
     1211     2222    1      IF SDCB$ ~= ADDR(NIL) THEN

   2222  1 001347   200007 236100                    LDQ     SDCB$,,AUTO
         1 001350   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001351   001415 600000 1                  TZE     s:2231

     1212     2223    2         IF S$DCB.CFU$~=ADDR(NIL) THEN DO;

   2223  1 001352   200007 470500                    LDP0    SDCB$,,AUTO
         1 001353   000066 236100                    LDQ     54,,PR0
         1 001354   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001355   001415 600000 1                  TZE     s:2231

     1213     2224    2            B$JIT.DCB$=SDCB$;

   2224  1 001356   200007 236100                    LDQ     SDCB$,,AUTO
         1 001357   000000 471400 xsym               LDP1    B$JIT$
         1 001360   100232 756100                    STQ     154,,PR1

     1214     2225    2            CALL FMD$FLSHBUF(1);

   2225  1 001361   000001 630400 2                  EPPR0   1
         1 001362   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001363   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 001364   000000 011000                    NOP     0

     1215     2226    2            CALL FMP$RELCFUS(S$DCB.CFU$);

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:261  
   2226  1 001365   200007 236100                    LDQ     SDCB$,,AUTO
         1 001366   000066 036003                    ADLQ    54,DU
         1 001367   200022 756100                    STQ     @I+1,,AUTO
         1 001370   200022 630500                    EPPR0   @I+1,,AUTO
         1 001371   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001372   000000 701000 xent               TSX1    FMP$RELCFUS
         1 001373   000000 011000                    NOP     0

     1216     2227    2            B$JIT.DCB$=UDCB$;

   2227  1 001374   200006 236100                    LDQ     UDCB$,,AUTO
         1 001375   000000 470400 xsym               LDP0    B$JIT$
         1 001376   000232 756100                    STQ     154,,PR0

     1217     2228    2            CALL FMD$FLSHBUF(1);

   2228  1 001377   000001 630400 2                  EPPR0   1
         1 001400   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001401   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 001402   000000 011000                    NOP     0

     1218     2229    2            IF NOT U$DCB.STARF THEN CALL UQB$MDEQ(ACCT$);

   2229  1 001403   200006 470500                    LDP0    UDCB$,,AUTO
         1 001404   000064 236100                    LDQ     52,,PR0
         1 001405   200000 316003                    CANQ    65536,DU
         1 001406   001415 601000 1                  TNZ     s:2231

   2229  1 001407   200014 631500                    EPPR1   ACCT$,,AUTO
         1 001410   200022 451500                    STP1    @I+1,,AUTO
         1 001411   200022 630500                    EPPR0   @I+1,,AUTO
         1 001412   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001413   000000 701000 xent               TSX1    UQB$MDEQ
         1 001414   000000 011000                    NOP     0

     1219     2230    2            END;

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:262  
     1220     2231    1      IF U$CFU.FUN=%CREATE# AND B$JIT.ERR.CODE=%E$NOKEY

   2231  1 001415   200010 470500                    LDP0    UCFU$,,AUTO
         1 001416   000000 236100                    LDQ     0,,PR0
         1 001417   700000 376003                    ANQ     -32768,DU
         1 001420   300000 116003                    CMPQ    98304,DU
         1 001421   001430 601000 1                  TNZ     s:2233
         1 001422   000000 471400 xsym               LDP1    B$JIT$
         1 001423   100012 236100                    LDQ     10,,PR1
         1 001424   377770 376007                    ANQ     131064,DL
         1 001425   001020 116007                    CMPQ    528,DL
         1 001426   001430 601000 1                  TNZ     s:2233

     1221     2232    1      THEN B$JIT.ERR='0'B;

   2232  1 001427   100012 450100                    STZ     10,,PR1

     1222     2233    1      IF U$CFU.FUN~=%JRNL# THEN ALTRETURN;

   2233  1 001430   000000 236100                    LDQ     0,,PR0
         1 001431   700000 376003                    ANQ     -32768,DU
         1 001432   400000 116003                    CMPQ    -131072,DU
         1 001433   001435 600000 1                  TZE     s:2234

   2233  1 001434   000000 702200 xent               TSX2  ! X66_AALT

     1223     2234    1      CALL FMH$JRELPG(1);

   2234  1 001435   000001 630400 2                  EPPR0   1
         1 001436   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001437   000000 701000 xent               TSX1    FMH$JRELPG
         1 001440   000000 011000                    NOP     0

     1224     2235    1      BUFNO=0;

   2235  1 001441   200005 450100                    STZ     BUFNO,,AUTO

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:263  
     1225     2236    1      IC=B$JIT.ERR;

   2236  1 001442   000000 470400 xsym               LDP0    B$JIT$
         1 001443   000012 236100                    LDQ     10,,PR0
         1 001444   200004 756100                    STQ     I,,AUTO

     1226     2237    1      CALL FMN$GETFIT(BUF$,BUFNO) ALTRET(JRNLRET);

   2237  1 001445   200005 631500                    EPPR1   BUFNO,,AUTO
         1 001446   200023 451500                    STP1    @I+2,,AUTO
         1 001447   200013 633500                    EPPR3   BUF$,,AUTO
         1 001450   200022 453500                    STP3    @I+1,,AUTO
         1 001451   200022 630500                    EPPR0   @I+1,,AUTO
         1 001452   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001453   000000 701000 xent               TSX1    FMN$GETFIT
         1 001454   001304 702000 1                  TSX2    JRNLRET

     1227     2238    1      CALL LOCCODP(3) ALTRET(JRNLRET);

   2238  1 001455   000004 236000 2                  LDQ     4
         1 001456   200021 756100                    STQ     DA+3,,AUTO
         1 001457   001511 701000 1                  TSX1    LOCCODP
         1 001460   001304 702000 1                  TSX2    JRNLRET

     1228     2239    1      CODE03.UGRANS=CODE03.UGRANS+CODE03.NGAVAL;

   2239  1 001461   200012 470500                    LDP0    LOC$,,AUTO
         1 001462   000003 236100                    LDQ     3,,PR0
         1 001463   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001464   200022 756100                    STQ     @I+1,,AUTO
         1 001465   000000 236100                    LDQ     0,,PR0
         1 001466   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001467   200022 036100                    ADLQ    @I+1,,AUTO
         1 001470   000000 552134                    STBQ    0,'34'O,PR0

     1229     2240    1      CODE03.NGAVAL=0;

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:264  
   2240  1 001471   000000 236003                    LDQ     0,DU
         1 001472   000003 552134                    STBQ    3,'34'O,PR0

     1230     2241    1      CALL LOCCODP(4) ALTRET(MBSTAR);

   2241  1 001473   000003 236000 2                  LDQ     3
         1 001474   200021 756100                    STQ     DA+3,,AUTO
         1 001475   001511 701000 1                  TSX1    LOCCODP
         1 001476   001502 702000 1                  TSX2    MBSTAR

     1231     2242    1      CODE04.SVMODIFY=CODE04.MODIFY; /* MAKE IT LOOK OPEN */

   2242  1 001477   200012 470500                    LDP0    LOC$,,AUTO
         1 001500   000001 236100                    LDQ     1,,PR0
         1 001501   000010 756100                    STQ     8,,PR0

   2242  1 001502                       MBSTAR       null
     1232     2243    1   MBSTAR:;
     1233     2244    1      CALL FMD$WRTBUF(BUFNO);

   2244  1 001502   200005 630500                    EPPR0   BUFNO,,AUTO
         1 001503   200022 450500                    STP0    @I+1,,AUTO
         1 001504   200022 630500                    EPPR0   @I+1,,AUTO
         1 001505   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001506   000000 701000 xent               TSX1    FMD$WRTBUF
         1 001507   000000 011000                    NOP     0

     1234     2245    1      GOTO JRNLRET;

   2245  1 001510   001304 710000 1                  TRA     JRNLRET

     1235     2246        %EJECT;
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:265  
     1236     2247                    /*I* NAME: LOCCODP
     1237     2248                         DESCRIPTION: Calls FMO$LOCCODP for the single parameter without
     1238     2249                         making PL6 think LOC$ is a poor risk. */
     1239     2250    1   LOCCODP: PROC(I) ALTRET;

   2250  1 001511   200020 741300       LOCCODP      STX1  ! DA+2,,AUTO

     1240     2251    2   DCL I UBIN;
     1241     2252    2      TMP$=PINCRW(BUF$,SIZEW(FM$GRAN));

   2252  1 001512   200013 236100                    LDQ     BUF$,,AUTO
         1 001513   000005 036003                    ADLQ    5,DU
         1 001514   200015 756100                    STQ     TMP$,,AUTO

     1242     2253    3      CALL FMO$LOCCODP(TMP$,I) WHENALTRETURN DO; ALTRETURN; END;

   2253  1 001515   200021 236100                    LDQ     @I,,AUTO
         1 001516   200023 756100                    STQ     @I+2,,AUTO
         1 001517   200015 630500                    EPPR0   TMP$,,AUTO
         1 001520   200022 450500                    STP0    @I+1,,AUTO
         1 001521   200022 630500                    EPPR0   @I+1,,AUTO
         1 001522   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001523   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001524   001526 702000 1                  TSX2    s:2253+9
         1 001525   001530 710000 1                  TRA     s:2254

   2253  1 001526   200020 221300                    LDX1  ! DA+2,,AUTO
         1 001527   000000 702211                    TSX2  ! 0,X1

     1243     2254    2      LOC$=TMP$;

   2254  1 001530   200015 236100                    LDQ     TMP$,,AUTO
         1 001531   200012 756100                    STQ     LOC$,,AUTO

     1244     2255    2      RETURN;

   2255  1 001532   200020 221300                    LDX1  ! DA+2,,AUTO
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:266  
         1 001533   000001 702211                    TSX2  ! 1,X1

FMP$E$BADFNME
 Sect OctLoc
   0     000   061520 001622                                                    1...

FMP$E$PSGRANS
 Sect OctLoc
   0     001   061520 002142                                                    1..b

FMP$E$USGRANS
 Sect OctLoc
   0     002   061520 002152                                                    1..j

FMP$E$ACGRANS
 Sect OctLoc
   0     003   061520 002162                                                    1..r

(unnamed)
 Sect OctLoc
   0     004   072123 105103   114117 107040                                    :SECLOG

(unnamed)
 Sect OctLoc
   2     000   000000 006003   000003 006000   777774 001777   000006 006000    ................
   2     004   000005 006000   000000 000000   000002 006000   000003 006000    ................
   2     010   776777 777777   777777 437777   757777 777777   577777 777777    ................
   2     014   677777 777777   743777 777777   000012 006000                    ............
     1245     2256    2   END LOCCODP;
     1246     2257    1   END FMP$RENAME;

PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:267  
--  Include file information  --

   F_FPTCODE_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure FMP$RENAME.
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:268  

 **** Variables and constants ****

  ****  Section 000 RoData FMP$RENAME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/b STRC        r     1 FMP$E$ACGRANS              0-0-0/b STRC        r     1 FMP$E$BADFNME
     1-0-0/b STRC        r     1 FMP$E$PSGRANS              2-0-0/b STRC        r     1 FMP$E$USGRANS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    21-0-0/w PTR         r     1 @I                         3-0-0/w PTR         r     1 @NAME$
    14-0-0/w PTR         r     1 ACCT$                     13-0-0/w PTR         r     1 BUF$
     5-0-0/w UBIN        r     1 BUFNO                     16-0-0/w UBIN        r     1 DA
     4-0-0/w SBIN        r     1 I                         *0-0-0/w UBIN        r     1 I
     4-0-0/w CHAR        r     1 IC(0:3)                    4-0-0/w UBIN        r     1 IU
    12-0-0/w PTR         r     1 LOC$                      *0-0-0/w PTR         r     1 NAME$
    11-0-0/w PTR         r     1 SCFU$                      7-0-0/w PTR         r     1 SDCB$
    15-0-0/w PTR         r     1 TMP$                      10-0-0/w PTR         r     1 UCFU$
     6-0-0/w PTR         r     1 UDCB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$STAR$
     0-0-0/w PTR         r     1 F$CFU$                     0-0-0/w UBIN        r     1 FM_FRZERO
     0-0-0/w UBIN        r     1 FM_SYSACCTX                0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:269  
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(576)   r     1 CODE01
     0-0-0/w STRC(324)   r     1 CODE03                     0-0-0/w STRC(396)   r     1 CODE04
     0-0-0/w STRC(288)   r     1 FM$CFUA                    0-0-0/w STRC(288)   r     1 FM$CFUEXT
     0-0-0/w STRC        r     1 FM$FDSEG                   0-0-0/w STRC(1116)  r     1 FM$FIT
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/w ASTR(9)     r     1 FM$KEYENT
     0-0-0/c CHAR(4096)  r     1 GRAN                       0-0-0/c ASTR(9)     r     1 NAME
     0-0-0/w STRC(288)   r     1 S$CFU                      0-0-0/d ASTR(3528)  r     1 S$DCB
     0-0-0/w STRC(288)   r     1 U$CFU                      0-0-0/w STRC(288)   r     1 U$CFUJ
     0-0-0/d ASTR(3528)  r     1 U$DCB


   Procedure FMP$RENAME requires 860 words for executable code.
   Procedure FMP$RENAME requires 26 words of local(AUTO) storage.

    No errors detected in file FMP$CLSF.:E05TSI    .
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:270  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:271  
          MINI XREF LISTING

ACCT$
      1916**DCL      1320--IMP-PTR  2027<<ASSIGN   2032>>IF       2065>>ASSIGN   2067<>CALL     2071<>CALL
      2095<>CALL     2184<>CALL     2193>>IF       2203<>CALL     2229<>CALL
B$JIT.CURTMPDP
      1049**DCL      2034>>IF
B$JIT.DCB$
      1048**DCL      2014>>ASSIGN   2066<<ASSIGN   2093<<ASSIGN   2097<<ASSIGN   2112<<ASSIGN   2114<<ASSIGN
      2224<<ASSIGN   2227<<ASSIGN
B$JIT.ERR
       958**DCL      2033<<ASSIGN   2036<<ASSIGN   2041<<ASSIGN   2079<<ASSIGN   2205>>ASSIGN   2213<<ASSIGN
      2220<<ASSIGN   2232<<ASSIGN   2236>>ASSIGN
B$JIT.ERR.CODE
       959**DCL      2074>>IF       2231>>IF
B$JIT.ERR.MID
       959**DCL       959--REDEF    2077>>IF
B$JIT.MAXTMPDP
      1049**DCL      2034>>IF
B$JIT.PRDPRM
      1049**DCL      2034>>IF
B$JIT.STAR.DA
      1048**DCL      2070>>IF       2086<<ASSIGN   2200<<ASSIGN
B$JIT$
      1988**DCL       953--IMP-PTR  2014>>ASSIGN   2033>>ASSIGN   2034>>IF       2034>>IF       2034>>IF
      2036>>ASSIGN   2041>>ASSIGN   2066>>ASSIGN   2070>>IF       2074>>IF       2077>>IF       2079>>ASSIGN
      2086>>ASSIGN   2093>>ASSIGN   2097>>ASSIGN   2112>>ASSIGN   2114>>ASSIGN   2200>>ASSIGN   2205>>ASSIGN
      2213>>ASSIGN   2220>>ASSIGN   2224>>ASSIGN   2227>>ASSIGN   2231>>IF       2232>>ASSIGN   2236>>ASSIGN
B$M$STAR$
      1989**DCL      2013>>ASSIGN
BUF$
      1915**DCL      1873--IMP-PTR  1880--IMP-PTR  2071<>CALL     2078<>CALL     2080>>ASSIGN   2099<>CALL
      2100>>ASSIGN   2120>>ASSIGN   2121<>CALL     2122>>ASSIGN   2132<>CALL     2144>>ASSIGN   2145>>ASSIGN
      2145>>ASSIGN   2146>>ASSIGN   2146>>ASSIGN   2153>>ASSIGN   2154>>ASSIGN   2160>>ASSIGN   2184<>CALL
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:272  
      2189>>ASSIGN   2237<>CALL     2252>>ASSIGN
BUFNO
      1909**DCL      2098<<ASSIGN   2099<>CALL     2115<>CALL     2119>>IF       2123<<ASSIGN   2130<>CALL
      2132<>CALL     2135>>ASSIGN   2136>>ASSIGN   2137>>ASSIGN   2138>>ASSIGN   2235<<ASSIGN   2237<>CALL
      2244<>CALL
CODE01.HASH
      1884**DCL      2162<<ASSIGN
CODE01.NXTNTS
      1884**DCL      2163<<ASSIGN
CODE01.XTNT
      1884**DCL      1885--REDEF
CODE03.DESC.BAD
      1889**DCL      2151<<ASSIGN
CODE03.NGAVAL
      1890**DCL      2149<<ASSIGN   2239>>ASSIGN   2240<<ASSIGN
CODE03.NRECS
      1890**DCL      2150<<ASSIGN
CODE03.NSTAMP
      1891**DCL      2113<>CALL     2147<>CALL
CODE03.UGRANS
      1888**DCL      2148<<ASSIGN   2239<<ASSIGN   2239>>ASSIGN
CODE04.ACCESS.TIME
      1899**DCL      2156<<ASSIGN
CODE04.CREATION.TIME
      1899**DCL      2157<<ASSIGN
CODE04.MODIFY
      1899**DCL      2242>>ASSIGN
CODE04.MODIFY.TIME
      1899**DCL      2109<<ASSIGN
CODE04.SVMODIFY
      1900**DCL      2242<<ASSIGN
CODE04.SVMODIFY.TIME
      1900**DCL      2158<<ASSIGN
DA
      1919**DCL      2124<<ASSIGN   2125<>CALL     2131<<ASSIGN   2132<>CALL
F$CFU$
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:273  
      1990**DCL      2026>>ASSIGN   2027>>ASSIGN   2065>>ASSIGN
FAG$COUNT
      1921**DCL-ENT  2028--CALL
FAG$GEXT
      1922**DCL-ENT  2170--CALL
FM$CFUA.ACCESS.BUPF
      1322**DCL      2193>>IF
FM$CFUA.GRANS
      1323**DCL      2032>>IF
FM$CFUEXT.XTNT
      1326**DCL      1327--REDEF
FM$CFUEXT.XTNT.XTNSDA
      1327**DCL      2173>>ASSIGN
FM$FDSEG
      1876**DCL      2078--CALL     2190<<ASSIGN
FM$FDSEG.DESC
      1876**DCL      2083<<ASSIGN
FM$FDSEG.DESC.BAD
      1876**DCL      2186<<ASSIGN
FM$FDSEG.DESC.DELF
      1876**DCL      2191<<ASSIGN
FM$FDSEG.FITSDA
      1877**DCL      2081<<ASSIGN   2185<<ASSIGN   2196<<ASSIGN
FM$FIT.CODES.CODE
      1330**DCL      2105>>ASSIGN
FM$FIT.CODES.NDW
      1330**DCL      2104<<ASSIGN   2160<<ASSIGN
FM$GRAN
      1880**DCL      2100--ASSIGN   2160--ASSIGN   2252--ASSIGN
FM$GRAN.AVAIL
      1881**DCL      2146<<ASSIGN
FM$GRAN.FCEX
      1881**DCL      2145>>ASSIGN
FM$GRAN.LVL
      1880**DCL      2144<<ASSIGN
FM$GRAN.NAVX
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:274  
      1880**DCL      2145<<ASSIGN   2146>>ASSIGN
FM$GRAN.STAMP.GMOD
      1880**DCL      2153<<ASSIGN
FM$GRAN.STAMP.HASH
      1880**DCL      2154<<ASSIGN
FM$KEYENT.D
      1873**DCL      2080<<ASSIGN   2189<<ASSIGN
FM$KEYENT.KLB
      1873**DCL      1873--IMP-SIZ
FMC$CLR1
      1928**DCL-ENT  2125--CALL
FMD$FLSHBUF
      1923**DCL-ENT  2092--CALL     2130--CALL     2177--CALL     2202--CALL     2225--CALL     2228--CALL
FMD$GETBUF
      1924**DCL-ENT  2121--CALL
FMD$REDBUFBC
      1927**DCL-ENT  2132--CALL
FMD$WRTBUF
      1925**DCL-ENT  2244--CALL
FMD$WRTSV
      1926**DCL-ENT  2084--CALL     2115--CALL
FMF$PEOF
      1929**DCL-ENT  2209--CALL
FMG$ADDKEY
      1966**DCL-ENT  2078--CALL
FMG$REMKEY
      1967**DCL-ENT  2192--CALL     2193--CALL
FMH$JGETPG
      1968**DCL-ENT  2211--CALL
FMH$JRELPG
      1970**DCL-ENT  2134--CALL     2234--CALL
FMM$NSTAMP
      1971**DCL-ENT  2113--CALL     2147--CALL
FMM$SCRUB
      1972**DCL-ENT  2046--CALL
FMN$CHKFLACN
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:275  
      1973**DCL-ENT  2057--CALL
FMN$GETFIT
      1974**DCL-ENT  2099--CALL     2237--CALL
FMO$LOCCODP
      1975**DCL-ENT  2253--CALL
FMO$LOCCODX
      1976**DCL-ENT  2103--CALL
FMP$E$ACGRANS
      2009**DCL      2033>>ASSIGN
FMP$E$BADFNME
      1997**DCL      2220>>ASSIGN
FMP$E$PSGRANS
      2001**DCL      2041>>ASSIGN
FMP$E$USGRANS
      2005**DCL      2036>>ASSIGN
FMP$RELCFUS
      1977**DCL-ENT  2201--CALL     2226--CALL
FMPE$BADFNME
      2212**LABEL    2018--GOTO     2058--GOTO     2068--CALLALT  2072--GOTO     2076--GOTO
FMQ$BLDFD
      1978**DCL-ENT  2070--CALL
FMQ$CTG
      1979**DCL-ENT  2094--CALL
FMQ$SRCHFD
      1980**DCL-ENT  2071--CALL     2184--CALL
FMR$G8
      1981**DCL-ENT  2060--CALL     2164--CALL
FMS$SCANNAME
      1982**DCL-ENT  2068--CALL
FM_FRZERO
      1991**DCL      2143>>ASSIGN   2167>>ASSIGN
FM_SYSACCTX
      1992**DCL      2075>>IF
GRAN
      1918**DCL      2122<<ASSIGN   2122>>ASSIGN
I
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:276  
      1906**DCL      1904--IMP-SIZ  1907--REDEF    1908--REDEF    2025<<ASSIGN   2026>>IF       2026<<ASSIGN
      2027>>ASSIGN   2028<>CALL     2030<<ASSIGN   2030>>ASSIGN   2039<<ASSIGN   2039>>ASSIGN   2040>>IF
      2047<<ASSIGN   2049>>ASSIGN   2050>>ASSIGN   2060<>CALL     2094<>CALL     2102<<DOINDEX  2103<>CALL
      2104>>ASSIGN   2105<<ASSIGN   2105>>ASSIGN   2107<>CALL     2109>>ASSIGN   2152>>ASSIGN   2154>>ASSIGN
      2156>>ASSIGN   2157>>ASSIGN   2158>>ASSIGN   2162>>ASSIGN   2164<>CALL     2166>>ASSIGN   2195<>CALL
I IN PROCEDURE LOCCODP
      2251**DCL      2250--PROC     2253<>CALL
IC
      1907**DCL      2048<<ASSIGN   2205<<ASSIGN   2213>>ASSIGN   2236<<ASSIGN
IU
      1908**DCL      2196>>ASSIGN
JRNLRET
      2205**LABEL    2237--CALLALT  2238--CALLALT  2245--GOTO
LOC$
      1914**DCL      1326--IMP-PTR  1330--IMP-PTR  1884--IMP-PTR  1888--IMP-PTR  1897--IMP-PTR  2100<<ASSIGN
      2101>>ASSIGN   2104>>ASSIGN   2105>>ASSIGN   2109>>ASSIGN   2113>>CALL     2120<<ASSIGN   2122>>ASSIGN
      2147>>CALL     2148>>ASSIGN   2149>>ASSIGN   2150>>ASSIGN   2151>>ASSIGN   2156>>ASSIGN   2157>>ASSIGN
      2158>>ASSIGN   2162>>ASSIGN   2163>>ASSIGN   2173>>ASSIGN   2239>>ASSIGN   2239>>ASSIGN   2239>>ASSIGN
      2240>>ASSIGN   2242>>ASSIGN   2242>>ASSIGN   2254<<ASSIGN
LOCCODP
      2250**PROC     2108--CALL     2111--CALL     2126--CALL     2155--CALL     2161--CALL     2238--CALL
      2241--CALL
MBSTAR
      2242**LABEL    2241--CALLALT
NAME.C
      1904**DCL      2050>>ASSIGN
NAME.L
      1903**DCL      2048>>ASSIGN
NAME$
        15**DCL         6--PROC     1902--IMP-PTR  2048>>ASSIGN   2050>>ASSIGN
NOEFT
      2106**LABEL    2103--CALLALT
NOKEY
      2070**LABEL    2071--CALLALT
NOSPACE
      2041**LABEL    2037--GOTO
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:277  
NOTIME
      2109**LABEL    2108--CALLALT
NOTIME1
      2158**LABEL    2155--CALLALT
RETRET
      2220**LABEL    2044--GOTO     2051--GOTO     2057--CALLALT  2060--CALLALT  2067--CALLALT  2070--CALLALT
      2074--GOTO     2078--CALLALT  2099--CALLALT  2132--CALLALT  2164--CALLALT  2170--CALLALT  2184--CALLALT
S$CFU.ACCTX
      1304**DCL      1304--REDEF    2065<<ASSIGN   2075>>IF
S$CFU.FITSDA
      1304**DCL      2116<<ASSIGN
S$CFU.FUN
      1303**DCL      2062<<ASSIGN
S$CFU.SHARE
      1303**DCL      2064<<ASSIGN
S$CFU.XTX
      1305**DCL      2165<<ASSIGN
S$DCB.ACCT
      1213**DCL      2053<<ASSIGN
S$DCB.ACTPOS
      1228**DCL      1228--REDEF
S$DCB.ARS
      1203**DCL      1203--REDEF
S$DCB.ATTR
      1221**DCL      1222--REDEF
S$DCB.BFR
      1247**DCL      2180>>ASSIGN   2181<<ASSIGN
S$DCB.BFR1
      1248**DCL      2178>>ASSIGN   2179<<ASSIGN
S$DCB.BORROW
      1236**DCL      1236--REDEF    1236--REDEF    1236--REDEF
S$DCB.CFU$
      1237**DCL      2060<>CALL     2061>>ASSIGN   2201<>CALL     2223>>IF       2226<>CALL
S$DCB.DCBNAME.L
      1250**DCL      1250--IMP-SIZ
S$DCB.DESC
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:278  
      1210**DCL      2052<<ASSIGN
S$DCB.EOMCHAR
      1207**DCL      1207--REDEF
S$DCB.FCD
      1216**DCL      2016>>IF
S$DCB.FLDID
      1231**DCL      1231--REDEF
S$DCB.FORM$
      1225**DCL      1225--REDEF
S$DCB.FSECT
      1241**DCL      1241--REDEF
S$DCB.FSN
      1218**DCL      1218--REDEF    1218--REDEF    1219--REDEF
S$DCB.FUN
      1217**DCL      2055<<ASSIGN   2063<<ASSIGN
S$DCB.HEADER$
      1224**DCL      1224--REDEF
S$DCB.IASN
      1244**DCL      2054<<ASSIGN
S$DCB.IXTNSIZE
      1222**DCL      1222--REDEF
S$DCB.LASTSTA$
      1212**DCL      1212--REDEF
S$DCB.LVL
      1237**DCL      1237--REDEF
S$DCB.NAME
      1212**DCL      2051>>IF       2071--CALL     2078--CALL
S$DCB.NAME.C
      1212**DCL      1212--REDEF    2050<<ASSIGN   2075>>IF
S$DCB.NAME.L
      1212**DCL      2049<<ASSIGN
S$DCB.NOEOF
      1233**DCL      1233--REDEF
S$DCB.NRECS
      1223**DCL      1223--REDEF
S$DCB.NRECX
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:279  
      1242**DCL      1242--REDEF
S$DCB.OHDR
      1234**DCL      1234--REDEF
S$DCB.ORG
      1217**DCL      1217--REDEF
S$DCB.PRECNO
      1240**DCL      1240--REDEF
S$DCB.RCSZ
      1245**DCL      1245--REDEF
S$DCB.RES
      1213**DCL      1213--REDEF
S$DCB.SETX
      1225**DCL      1225--REDEF    2059<<ASSIGN
S$DCB.STARF
      1232**DCL      2058>>IF       2070>>IF
S$DCB.STARX
      1234**DCL      2069>>IF       2086>>ASSIGN
S$DCB.TAB$
      1224**DCL      1225--REDEF
S$DCB.TDA
      1239**DCL      1239--REDEF
S$DCB.WSN
      1214**DCL      1214--REDEF
S$DCB.WSR
      1220**DCL      2056<<ASSIGN
SCFU$
      1913**DCL      1303--IMP-PTR  2061<<ASSIGN   2062>>ASSIGN   2064>>ASSIGN   2065>>ASSIGN   2075>>IF
      2116>>ASSIGN   2165>>ASSIGN
SDCB$
      1911**DCL      1203--IMP-PTR  2013<<ASSIGN   2016>>IF       2017<<ASSIGN   2043<<ASSIGN   2049>>ASSIGN
      2050>>ASSIGN   2051>>IF       2052>>ASSIGN   2053>>ASSIGN   2054>>ASSIGN   2055>>ASSIGN   2056>>ASSIGN
      2058>>IF       2059>>ASSIGN   2060>>CALL     2061>>ASSIGN   2063>>ASSIGN   2066>>ASSIGN   2069>>IF
      2070>>IF       2071>>CALL     2075>>IF       2078>>CALL     2086>>ASSIGN   2112>>ASSIGN   2178>>ASSIGN
      2179>>ASSIGN   2180>>ASSIGN   2181>>ASSIGN   2201>>CALL     2222>>IF       2223>>IF       2224>>ASSIGN
      2226>>CALL
SSS$SYSTIME
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:280  
      1983**DCL-ENT  2107--CALL     2195--CALL
S_CUN
      1993**DCL      2075>>IF
TMP$
      1917**DCL      1876--IMP-PTR  2071<>CALL     2078<>CALL     2081>>ASSIGN   2083>>ASSIGN   2101<<ASSIGN
      2103<>CALL     2164<>CALL     2184<>CALL     2185>>ASSIGN   2186>>ASSIGN   2190>>ASSIGN   2191>>ASSIGN
      2196>>ASSIGN   2252<<ASSIGN   2253<>CALL     2254>>ASSIGN
U$CFU.ACCTX
      1310**DCL      1310--REDEF    2025>>ASSIGN   2026>>ASSIGN
U$CFU.AFIT
      1309**DCL      2141<<ASSIGN
U$CFU.FITSDA
      1310**DCL      2081>>ASSIGN   2086>>ASSIGN   2116>>ASSIGN   2124>>ASSIGN   2131>>ASSIGN   2139<<ASSIGN
      2173<<ASSIGN   2176<<ASSIGN   2185>>ASSIGN   2188>>IF       2200>>ASSIGN
U$CFU.FUN
      1309**DCL      2029>>IF       2039>>IF       2091>>IF       2117>>IF       2204>>IF       2231>>IF
      2233>>IF
U$CFU.LDA
      1312**DCL      2143<<ASSIGN
U$CFU.NAMEX
      1310**DCL      2026>>ASSIGN
U$CFU.NGAVAL
      1312**DCL      2172<<ASSIGN   2172>>ASSIGN
U$CFU.NRECS
      1310**DCL      2142<<ASSIGN
U$CFU.UGRANS
      1311**DCL      2140<<ASSIGN   2171<<ASSIGN
U$CFU.XTX
      1311**DCL      2165>>ASSIGN   2166<<ASSIGN
U$CFUJ.ERR_WAIT
      1316**DCL      2174<<ASSIGN
U$DCB.ACCT
      1263**DCL      2053>>ASSIGN
U$DCB.ACTPOS
      1278**DCL      1278--REDEF
U$DCB.ARS
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:281  
      1253**DCL      1253--REDEF
U$DCB.ATTR
      1271**DCL      1272--REDEF
U$DCB.BFR
      1297**DCL      2135<<ASSIGN   2135>>ASSIGN   2137<<ASSIGN   2180<<ASSIGN
U$DCB.BFR.BUFUP
      1297**DCL      2169<<ASSIGN   2187<<ASSIGN
U$DCB.BFR.DA
      1298**DCL      2167<<ASSIGN
U$DCB.BFR1
      1298**DCL      2136<<ASSIGN   2136>>ASSIGN   2138<<ASSIGN   2178<<ASSIGN
U$DCB.BORROW
      1286**DCL      1286--REDEF    1286--REDEF    1286--REDEF    2031>>IF
U$DCB.CFU$
      1287**DCL      2015>>ASSIGN   2212<>CALL
U$DCB.DCBNAME.L
      1300**DCL      1300--IMP-SIZ
U$DCB.DESC
      1260**DCL      2052>>ASSIGN   2083>>ASSIGN
U$DCB.DESC.BUF
      1260**DCL      2082<<ASSIGN
U$DCB.DESC.BUPM
      1261**DCL      2082>>ASSIGN
U$DCB.EOMCHAR
      1257**DCL      1257--REDEF
U$DCB.FLDID
      1281**DCL      1281--REDEF
U$DCB.FORM$
      1275**DCL      1275--REDEF
U$DCB.FSECT
      1291**DCL      1291--REDEF
U$DCB.FSN
      1268**DCL      1268--REDEF    1268--REDEF    1269--REDEF
U$DCB.GTYP
      1282**DCL      2208<<ASSIGN
U$DCB.HASH
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:282  
      1290**DCL      2152<<ASSIGN
U$DCB.HEADER$
      1274**DCL      1274--REDEF
U$DCB.IXTNSIZE
      1272**DCL      1272--REDEF    2168<<ASSIGN
U$DCB.LASTSTA$
      1262**DCL      1262--REDEF
U$DCB.LVL
      1287**DCL      1287--REDEF
U$DCB.NAME
      1262**DCL      2051>>IF       2094--CALL     2184--CALL
U$DCB.NAME.C
      1262**DCL      1262--REDEF
U$DCB.NOEOF
      1283**DCL      1283--REDEF
U$DCB.NRECS
      1273**DCL      1273--REDEF
U$DCB.NRECX
      1292**DCL      1292--REDEF
U$DCB.OHDR
      1284**DCL      1284--REDEF
U$DCB.ORG
      1267**DCL      1267--REDEF
U$DCB.PRECNO
      1290**DCL      1290--REDEF
U$DCB.RCSZ
      1295**DCL      1295--REDEF
U$DCB.RES
      1263**DCL      1263--REDEF
U$DCB.SETX
      1275**DCL      1275--REDEF    2059>>ASSIGN
U$DCB.SHARED
      1282**DCL      2207<<ASSIGN   2210<<ASSIGN
U$DCB.STARF
      1282**DCL      2032>>IF       2034>>IF       2034>>IF       2058>>IF       2067>>IF       2095>>IF
      2192>>IF       2203>>IF       2229>>IF
PL6.E3A0      #007=FMP$RENAME File=FMP$CLSF.:E05TSI                              TUE 07/29/97 16:59 Page:283  
U$DCB.STARX
      1284**DCL      2182>>IF       2200>>ASSIGN
U$DCB.TAB$
      1274**DCL      1275--REDEF
U$DCB.TDA
      1289**DCL      1289--REDEF
U$DCB.WSN
      1264**DCL      1264--REDEF
U$DCB.WSR
      1270**DCL      2056>>ASSIGN
U$DCB.XTNSIZE
      1270**DCL      2030>>ASSIGN   2168>>ASSIGN
UCFU$
      1912**DCL      1309--IMP-PTR  1315--IMP-PTR  2015<<ASSIGN   2025>>ASSIGN   2026>>ASSIGN   2029>>IF
      2039>>IF       2081>>ASSIGN   2086>>ASSIGN   2091>>IF       2116>>ASSIGN   2117>>IF       2124>>ASSIGN
      2131>>ASSIGN   2139>>ASSIGN   2140>>ASSIGN   2141>>ASSIGN   2142>>ASSIGN   2143>>ASSIGN   2165>>ASSIGN
      2166>>ASSIGN   2171>>ASSIGN   2172>>ASSIGN   2172>>ASSIGN   2173>>ASSIGN   2174>>ASSIGN   2176>>ASSIGN
      2185>>ASSIGN   2188>>IF       2200>>ASSIGN   2204>>IF       2231>>IF       2233>>IF
UDB$PMMEXIT
      1984**DCL-ENT  2214--CALL
UDCB$
      1910**DCL      1253--IMP-PTR  2014<<ASSIGN   2015>>ASSIGN   2030>>ASSIGN   2031>>IF       2032>>IF
      2034>>IF       2034>>IF       2051>>IF       2052>>ASSIGN   2053>>ASSIGN   2056>>ASSIGN   2058>>IF
      2059>>ASSIGN   2067>>IF       2082>>ASSIGN   2082>>ASSIGN   2083>>ASSIGN   2093>>ASSIGN   2094>>CALL
      2095>>IF       2097>>ASSIGN   2114>>ASSIGN   2135>>ASSIGN   2135>>ASSIGN   2136>>ASSIGN   2136>>ASSIGN
      2137>>ASSIGN   2138>>ASSIGN   2152>>ASSIGN   2167>>ASSIGN   2168>>ASSIGN   2168>>ASSIGN   2169>>ASSIGN
      2178>>ASSIGN   2180>>ASSIGN   2182>>IF       2184>>CALL     2187>>ASSIGN   2192>>IF       2200>>ASSIGN
      2203>>IF       2207>>ASSIGN   2208>>ASSIGN   2210>>ASSIGN   2212>>CALL     2227>>ASSIGN   2229>>IF
UQB$MDEQ
      1986**DCL-ENT  2203--CALL     2212--CALL     2229--CALL
UQB$MENQX
      1985**DCL-ENT  2067--CALL     2095--CALL
