VERSION B06

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:1    
        1        1        /*M* VWS$SCOTTY - File transporter ghost. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC, PLM=3, CTI=2, CSI=2, ECI=2, MCI=YES, SDI=6, THI=2 */
        8        8        /*F**
        9        9        *
       10       10        *   NAME:  VWS$SCOTTY
       11       11        *
       12       12        *   PURPOSE:
       13       13        *       To handle remotely-initiated file transfer requests.
       14       14        *
       15       15        *   DESCRIPTION:
       16       16        *       SCOTTY acts as the "catcher" for BEAMed files and as the "thrower"
       17       17        *       for SUCKed files.  It also acts as a message switch for files that
       18       18        *       pass through a node on their way to another.
       19       19        *
       20       20        *   REFERENCE:
       21       21        *       See the appropriate Architecture File document for a description
       22       22        *       of MOVE and SCOTTY.
       23       23        *
       24       24        ****/
       25       25
       26       26        /*D**
       27       27        *
       28       28        *   NAME:  VWS$SCOTTY
       29       29        *
       30       30        *   CALL:
       31       31        *       Main program.
       32       32        *
       33       33        *   PARAMETERS:
       34       34        *       None.
       35       35        *
       36       36        *   INTERFACE:
       37       37        *       SCOTTY calls VWE$EVOM, VWB$BEAM, VWX$MAIL (SCOTTY's version),
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:2    
       38       38        *       VWH$HEADER, VWF$FOOTER, VWI$TRANSI, VWO$TRANSO, VWA$ABORT,
       39       39        *       DAM$INIT, DAM$MAP, and the XUR$ routines.  The wildcarder is
       40       40        *       also used by VWB$BEAM.
       41       41        *
       42       42        *   ENVIRONMENT:
       43       43        *       SCOTTY must run as a ghost from .:SYS, as it must have JIT access
       44       44        *       privilege.  It uses this privilege to modify its JIT with user
       45       45        *       logon information and privileges, thus performing a crude version
       46       46        *       of SLUG processes.  This preserves file security.
       47       47        *
       48       48        *   INPUT:
       49       49        *       Files are read and processed from .:MOVE until end-of-account.
       50       50        *       SCOTTY then sleeps for a minute and looks for more work to do.
       51       51        *
       52       52        *   OUTPUT:
       53       53        *       None, although disastrous errors may cause a PMD dump and/or
       54       54        *       an operator's console message.
       55       55        *
       56       56        *   SCRATCH:
       57       57        *       None.
       58       58        *
       59       59        *   DESCRIPTION:
       60       60        *       SCOTTY runs as a ghost on all interconnected machines using the
       61       61        *       MOVE facility.  It acts as the "catcher" for BEAMs and the
       62       62        *       transmitter for SUCKs.
       63       63        *
       64       64        *       To avoid security holes, SCOTTY assumes the user's logon
       65       65        *       identity when fetching or creating a file.  If the user has not
       66       66        *       supplied a valid logon account, name, and password, the file
       67       67        *       cannot be fetched or stowed.  Also, if the user does not
       68       68        *       normally have access to the file in question, access will be
       69       69        *       denied by the file management system.  FMS is turned on IF the
       70       70        *       user is authorized for FMS.
       71       71        *
       72       72        *       Mail may be created in sender or receiver mailboxes.
       73       73        *
       74       74        *       SCOTTY must (a) run as a ghost, (b) run in :SYS, and (c) have
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:3    
       75       75        *       JIT access.  It also needs to access :HLP.:SYS and :USERS.:SYS
       76       76        *       to validate logons.  Files are !NCTL files read from account
       77       77        *       :MOVE, which must be on a packset which is always present,
       78       78        *       such as #SYS.  SCOTTY and INSYM must have WRITE access to
       79       79        *       :MOVE.
       80       80        *
       81       81        *       If SCOTTY finds an operational error, the message is written
       82       82        *       via M$LO, which should default to LP@LOCAL.
       83       83        *
       84       84        ****/
       85       85
       86       86        VWS$SCOTTY: PROC MAIN NOAUTO;
       87       87
       88       88        /****
       89       89        *
       90       90        *   %INCLUDEs
       91       91        *
       92       92        ****/
       93       93
       94       94        %INCLUDE CP_6;
       95     5653        %INCLUDE CP_6_SUBS;
       96     6193        %INCLUDE B$JIT;
       97     6796        %INCLUDE FM$FIT;
       98     7017        %INCLUDE XU_MACRO_C;
       99    10123        %INCLUDE XUR_ENTRY;
      100    10155        %INCLUDE KL_SUPER_C;
      101    13057        %INCLUDE AS_SUPER_C;
      102    13492        %INCLUDE B_ERRORS_C;
      103    14619        %INCLUDE VW_MOVE_E;
      104    14697        %INCLUDE VWM_ERRS_E;
      105    15071        %INCLUDE VW_OPTS_M;
      106    15755        %MOVE_OPTIONS(STCLASS="STATIC SYMDEF");
      107    16258        %INCLUDE VW_NODEATER_E;
      108    16314        %INCLUDE VW_FPTS_M;
      109    16735           %include B$TABLES_C;
      110    16843        %B$SR_NON_BLANK;
      111    16847
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:4    
      112    16848        /****
      113    16849        *
      114    16850        *   FPTs
      115    16851        *
      116    16852        ****/
      117    16853
      118    16854        %FPT_OPEN(FPTN=OPEN_MAILBOX,
      119    16855                  DCB=M$MAIL,
      120    16856                  ASN=FILE,
      121    16857                  NAME=NAME_MAILBOX,
      122    16858                  FUN=IN,
      123    16859                  EXIST=OLDFILE,
      124    16860                  TEST=YES);
      125    16969
      126    16970        %VLP_NAME(FPTN=NAME_MAILBOX,
      127    16971                  NAME=':MAIL_CENTRAL');
      128    16998
      129    16999        %FPT_OPEN(FPTN=OPEN_MAIL,
      130    17000                  DCB=M$MAIL,
      131    17001                  ASN=FILE,
      132    17002                  NAME=NAME_MAIL,
      133    17003                  FUN=CREATE,
      134    17004                  EXIST=NEWFILE,
      135    17005                  ORG=KEYED,
      136    17006                  ACS=DIRECT,
      137    17007                  SCRUB=YES);
      138    17116
      139    17117        %VLP_NAME(FPTN=NAME_MAIL,
      140    17118                  LEN=9,
      141    17119                  NAME='*MOVEMAIL');
      142    17146
      143    17147        %FPT_WRITE(FPTN=WRITE_MAIL,
      144    17148                   DCB=M$MAIL,
      145    17149                   KEY=VW_MAILKEY#,
      146    17150                   ONEWKEY=YES,
      147    17151                   BUF=VW_MAILBUF#);
      148    17182
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:5    
      149    17183        %FPT_CLOSE(FPTN=CLOSE_MAIL,
      150    17184                   DCB=M$MAIL,
      151    17185                   DISP=SAVE);
      152    17227
      153    17228        %FPT_OPEN(FPTN=OPEN_JF,
      154    17229                  DCB=M$JF,
      155    17230                  ASN=DEVICE,
      156    17231                  FUN=CREATE,
      157    17232                  EXIST=NEWFILE,
      158    17233                  RES='JF  ');
      159    17342
      160    17343        %FPT_WRITE(FPTN=WRITE_JF,
      161    17344                   DCB=M$JF,
      162    17345                   BUF=JIBUF);
      163    17376
      164    17377        %FPT_CLOSE(FPTN=CLOSE_JF,
      165    17378                   DCB=M$JF,
      166    17379                   DISP=SAVE);
      167    17421
      168    17422        %FPT_OPEN(FPTN=OPEN_JI,
      169    17423                  DCB=M$JI,
      170    17424                  NAME=NAME_JI,
      171    17425                  NXTF=YES,
      172    17426                  THISF=NO,
      173    17427                  ACCT=VWS_ACCT_JI,
      174    17428                  PASS=PASS_JI,
      175    17429                  FUN=IN,
      176    17430                  FPARAM=FITBUF,
      177    17431                  SCRUB=YES,
      178    17432                  ASN=FILE);
      179    17541
      180    17542        %VLP_NAME(FPTN=NAME_JI,
      181    17543                  LEN=31,
      182    17544                  NAME='MOVE                           ');
      183    17571
      184    17572        %VLP_ACCT(FPTN=VWS_ACCT_JI,
      185    17573                  STCLASS="STATIC SYMDEF",
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:6    
      186    17574                  ACCT=':MOVE   ');
      187    17587
      188    17588        %VLP_PASS(FPTN=PASS_JI,
      189    17589                  STCLASS=CONSTANT,
      190    17590                  PASS='Montgmry');
      191    17603
      192    17604        %FPT_READ(FPTN=READ_JI,
      193    17605                  DCB=M$JI,
      194    17606                  BUF=JIBUF);
      195    17645
      196    17646        %FPT_PRECORD(FPTN=PRECORD_JI,
      197    17647                     DCB=M$JI,
      198    17648                     N=-1);
      199    17669
      200    17670        %FPT_CLOSE(FPTN=CLOSE_JI,
      201    17671                   DCB=M$JI,
      202    17672                   DISP=RELEASE);
      203    17714
      204    17715        %FPT_OPEN(FPTN=OPEN_HLP,
      205    17716                  DCB=M$HLP,
      206    17717                  NAME=NAME_HLP,
      207    17718                  ACCT=ACCT_HLP,
      208    17719                  FUN=IN,
      209    17720                  ACS=DIRECT,
      210    17721                  SHARE=ALL,
      211    17722                  ASN=FILE);
      212    17831
      213    17832        %VLP_NAME(FPTN=NAME_HLP,
      214    17833                  LEN=4,
      215    17834                  NAME=':HLP');
      216    17861
      217    17862        %VLP_ACCT(FPTN=ACCT_HLP,
      218    17863                  ACCT=':SYS    ');
      219    17876
      220    17877        %FPT_READ(FPTN=READ_HLP,
      221    17878                  DCB=M$HLP,
      222    17879                  BUF=HLPBUF,
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:7    
      223    17880                  KEYS=YES,
      224    17881                  KEY=ACCTNAME);
      225    17920
      226    17921        %FPT_CLOSE(FPTN=CLOSE_HLP,
      227    17922                   DCB=M$HLP,
      228    17923                   DISP=SAVE);
      229    17965
      230    17966        %FPT_OPEN(FPTN=OPEN_USERS,
      231    17967                  DCB=M$USERS,
      232    17968                  NAME=NAME_USERS,
      233    17969                  ACCT=ACCT_USERS,
      234    17970                  FUN=UPDATE,
      235    17971                  ACS=DIRECT,
      236    17972                  SHARE=ALL,
      237    17973                  ASN=FILE);
      238    18082
      239    18083        %VLP_NAME(FPTN=NAME_USERS,
      240    18084                  LEN=6,
      241    18085                  NAME=':USERS');
      242    18112
      243    18113        %VLP_ACCT(FPTN=ACCT_USERS,
      244    18114                  ACCT=':SYS    ');
      245    18127
      246    18128        %FPT_ENQ(FPTN=ENQ_USERS,
      247    18129                 DCB=M$USERS,
      248    18130                 RNAME=ACCTNAME,
      249    18131                 SHARE=NONE);
      250    18149
      251    18150        %FPT_DEQ(FPTN=DEQ_USERS,
      252    18151                 DCB=M$USERS);
      253    18168
      254    18169        %FPT_READ(FPTN=READ_USERS,
      255    18170                  DCB=M$USERS,
      256    18171                  BUF=USERSBUF,
      257    18172                  KEYS=YES,
      258    18173                  KEY=ACCTNAME);
      259    18212
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:8    
      260    18213        %FPT_WRITE(FPTN=WRITE_USERS,
      261    18214                   DCB=M$USERS,
      262    18215                   BUF=USERSBUF,
      263    18216                   KEY=ACCTNAME);
      264    18247
      265    18248        %FPT_TRUNC(FPTN=TRUNC_USERS,
      266    18249                   DCB=M$USERS);
      267    18263
      268    18264        %FPT_CLOSE(FPTN=CLOSE_USERS,
      269    18265                   DCB=M$USERS,
      270    18266                   DISP=SAVE);
      271    18308
      272    18309        %FPT_OPEN(FPTN=OPEN_JE,
      273    18310                  DCB=M$JE,
      274    18311                  ASN=DEVICE,
      275    18312                  WSN=WSN_JE,
      276    18313                  SCRUB=YES,
      277    18314                  RES='JE  ',
      278    18315                  FUN=CREATE,
      279    18316                  EXIST=OLDFILE,
      280    18317                  ORG=CONSEC);
      281    18426
      282    18427        %VLP_WSN(FPTN=WSN_JE,
      283    18428                 WSN='        ');
      284    18441
      285    18442        %FPT_WRITE(FPTN=WRITE_JE,
      286    18443                   DCB=M$JE,
      287    18444                   BUF=JEBUF);
      288    18475
      289    18476        %FPT_CLOSE(FPTN=CLOSE_JE,
      290    18477                   DCB=M$JE,
      291    18478                   DISP=SAVE);
      292    18520
      293    18521        %FPT_WAIT(FPTN=SLEEP,
      294    18522                  UNITS=60);
      295    18536
      296    18537        %FPT_WAIT(FPTN=SNOOZE,
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:9    
      297    18538                  UNITS=5);
      298    18552
      299    18553        %FPT_TIME(FPTN=LOGON_TIME,
      300    18554                  SOURCE=CLOCK,
      301    18555                  DEST=UTS,
      302    18556                  TSTAMP=LOGON_UTS);
      303    18575
      304    18576        %FPT_LINK(FPTN=LINK_SEND,
      305    18577                  CP_CMD=CMD_LINK);
      306    18595
      307    18596        %FPT_LDTRC(FPTN=LINK_TO_NEW_SCOTTY);
      308    18614
      309    18615        %FPT_RESCTL(RPSN=VLP_RPSN,
      310    18616                    PRES=VLP_PRES);
      311    18633
      312    18634        %VLP_RPSN(N=6);
      313    18649
      314    18650        %VLP_PRES(N=2);
      315    18666
      316    18667        %FPT_ENQ   (FPTN=ENQ_ON_NODES,
      317    18668                    DCB=M$NODE,
      318    18669                    RNAME=WHO_AM_I,
      319    18670                    SHARE=NONE,
      320    18671                    WAIT=YES,
      321    18672                    WAIT_TIME=0);
      322    18690
      323    18691        %FPT_OLAY(FPTN=KILL_VWB$BEAM,
      324    18692                  CANCEL=YES,
      325    18693                  ONAME=NAME_VWB$BEAM);
      326    18709
      327    18710        %VLP_NAME(FPTN=NAME_VWB$BEAM,
      328    18711                  NAME='VWB$BEAM');
      329    18738
      330    18739        %FPT_OLAY(FPTN=KILL_VWE$EVOM,
      331    18740                  CANCEL=YES,
      332    18741                  ONAME=NAME_VWE$EVOM);
      333    18757
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:10   
      334    18758        %VLP_NAME(FPTN=NAME_VWE$EVOM,
      335    18759                  NAME='VWE$EVOM');
      336    18786
      337    18787        %FPT_XCON(FPTN=FPT_XCON1,
      338    18788                  UENTRY=VWA$ABORT);
      339    18802
      340    18803        %FPT_XCON(FPTN=FPT_XCON2,
      341    18804                  UENTRY=NIL);
      342    18818
      343    18819        %F$DCB(DCBN=DUMMY);
      344    18876
      345    18877        %B$TCB;
      346    18880
      347    18881        %B$ALT;
      348    18889
      349    18890        %FM$FIT;
      350    18893
      351    18894        %MACRO FS$JOBORIG (NAME=FS$JOBORIG,STCLASS=BASED,
      352    18895          SIZ(FIT=",2 SIZ UBIN",NAWNDW=",2 NAW UBIN HALF UNAL,2 NDW UBIN HALF UNAL")=);
      353    18896        /* FS$JOBORIG is UATTR for jobs being batched */
      354    18897        DCL 1 NAME STCLASS ALIGNED SIZ,
      355    18898        /*  ORIGINATOR_PORT.FROM_CR/FROM_GHOST/FROM_INT are of historical interest:   */
      356    18899        /*  they contain information concerning the very first card reader,           */
      357    18900        /*  ghost user, or online user who submitted a job stream which               */
      358    18901        /*  eventuated in the creation of this job.  See ORIGINATOR_MODE below.       */
      359    18902                  2 ORIGINATOR_PORT,
      360    18903                        3 FROM_CR,              /* Originator info if from a CR       */
      361    18904                              4 DEVICE CHAR(4), /* Device of origin                   */
      362    18905                              4 TNAME CHAR(8),  /* TNAME of device of origin          */
      363    18906                        3 FROM_GHOST REDEF FROM_CR, /* Originator info if from a ghost    */
      364    18907                            4 SYSID UBIN HALF UNAL, /* SYSID of ghost originator          */
      365    18908                              4 * CHAR(10),
      366    18909                        3 FROM_INT REDEF FROM_CR, /* Originator info if from INT user   */
      367    18910        /*  The following TSLINE structure is lifted from B$JIT.TSLINE.               */
      368    18911                              4 TSLINE,
      369    18912                                    5 FEX UBIN(9) UNAL,
      370    18913                                    5 SPEED UBIN(9) UNAL,
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:11   
      371    18914                                    5 PORT UBIN(18) UNAL,
      372    18915                                    5 LEV UBIN BYTE UNAL,
      373    18916                                    5 TTYP UBIN BYTE UNAL,
      374    18917                                    5 SUBDEVICE UBIN(18) UNAL,
      375    18918                                    5 SUBSUBDEVICE UBIN(18) UNAL,
      376    18919                                    5 * UBIN(18) UNAL,
      377    18920                  2 WOO CHAR(8),                /* WSN of origin                      */
      378    18921                  2 SYSID UBIN(18) UNAL,        /* SYSID of originator                */
      379    18922                  2 MAXPRI UBIN BYTE UNAL,      /* Maximum batching PRIO              */
      380    18923                  2 DEFPRI UBIN BYTE UNAL,      /* Default batching PRIO              */
      381    18924                  2 FLAG UBIN BYTE UNAL,        /* JIT.MODE if !BATCHed;              */
      382    18925                                                /* JOBORIG if from card reader        */
      383    18926                  2 ORIGINATOR_MODE UBIN(4) UNAL, /* See B$JIT.ORIGINATOR_MODE          */
      384    18927                  2 * UBIN;
      385    18928        %MEND;
      386    18929
      387    18930        %FS$JOBORIG;
      388    18964
      389    18965        %XUR_INIT;
      390    19064
      391    19065        %AS_USERS(STR_NAME=USERSBUF,
      392    19066                  STCLASS=STATIC);
      393    19244
      394    19245        %KL_DREC(NAME=HLPBUF,LAST=",");
      395    19358
      396    19359        %KL_FEBLK(LVL=2,STCLASS=STATIC,RCNT=31);
      397    19408
      398    19409        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:12   
      399    19410        /****
      400    19411        *
      401    19412        *   Local variables
      402    19413        *
      403    19414        ****/
      404    19415
      405    19416    1   DCL M$LM                           DCB;
      406    19417    1   DCL M$JF                           DCB;
      407    19418    1   DCL M$JI                           DCB;
      408    19419    1   DCL M$JE                           DCB;
      409    19420    1   DCL M$HLP                          DCB;
      410    19421    1   DCL M$USERS                        DCB;
      411    19422    1   DCL M$MAIL                         DCB;
      412    19423    1   DCL M$NODE                         DCB;
      413    19424
      414    19425    1   DCL B$TCB$ SYMREF                  PTR;
      415    19426    1   DCL B$JIT$ SYMREF                  PTR;
      416    19427    1   DCL JIPTR                          PTR;
      417    19428    1   DCL JEPTR                          PTR;
      418    19429    1   DCL MAILPTR                        PTR;
      419    19430    1   DCL P                              PTR;
      420    19431    1   DCL OPTX                           SBIN;
      421    19432
      422    19433    1   DCL I                              SBIN;
      423    19434    1   DCL J                              SBIN;
      424    19435    1   DCL K                              SBIN;
      425    19436    1   DCL ARS                            SBIN;
      426    19437    1   DCL VW_INPCNT# STATIC SYMDEF       SBIN;
      427    19438    1   DCL VW_OUTCNT# STATIC SYMDEF       SBIN;
      428    19439    1   DCL VW_TOTBYTES# STATIC SYMDEF     SBIN;
      429    19440    1   DCL VW_BROKEN# STATIC SYMDEF       SBIN;
      430    19441    1   DCL ERRDCB                         SBIN;
      431    19442    1   DCL LOGON_UTS                      UBIN;
      432    19443
      433    19444    1   DCL ERRCODE                        UBIN;
      434    19445    1   DCL 1 ERRBITS REDEF ERRCODE,
      435    19446    1             2 FCG                        UNAL BIT(18),
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:13   
      436    19447    1             2 M                          UNAL BIT(1),
      437    19448    1             2 CODE                       UNAL UBIN(14),
      438    19449    1             2 SEV                        UNAL UBIN(3);
      439    19450
      440    19451    1   DCL STATUS_LINE STATIC             CHAR(80);
      441    19452    1   DCL JIBUF STATIC                   CHAR(80);
      442    19453    1   DCL JEBUF STATIC                   CHAR(80);
      443    19454    1   DCL FITBUF STATIC                  CHAR(4096);
      444    19455    1   DCL VW_MAILBUF# SYMREF             CHAR(144);
      445    19456    1   DCL 1 VW_MAILKEY# SYMREF,
      446    19457    1             2 L UNAL                     UBIN BYTE,
      447    19458    1             2 C UNAL                     UBIN(27);
      448    19459
      449    19460    1   DCL 1 ACCTNAME STATIC,
      450    19461    1             2 L                          UNAL UBIN BYTE,
      451    19462    1             2 ACCT                       UNAL CHAR(8),
      452    19463    1             2 NAME                       UNAL CHAR(12);
      453    19464
      454    19465    1   DCL 1 ERRMSGFID CONSTANT,
      455    19466    1             2 L UNAL                     UBIN BYTE INIT(15),
      456    19467    1             2 C UNAL                     CHAR(39) INIT(':VWERRMSG.:SYS');
      457    19468
      458    19469    1   DCL 1 CMD_LINK CONSTANT,
      459    19470    1             2 * UNAL                     UBIN BYTE INIT(79),
      460    19471    1             2 * UNAL                     CHAR(79) INIT
      461    19472    1               ('SEND *MOVEMAIL');
      462    19473
      463    19474    1   DCL 1 WHO_AM_I STATIC,
      464    19475    1             2 L# UBIN BYTE CALIGNED,
      465    19476    1             2 NAME# CHAR(31);
      466    19477
      467    19478    1   DCL 1 B_VERSION SYMREF READONLY,
      468    19479    1             2 L# UBIN BYTE CALIGNED,
      469    19480    1             2 NAME# CHAR(B_VERSION.L#) CALIGNED;
      470    19481
      471    19482    1   DCL 1 GOOD_PATTERN CONSTANT,
      472    19483    1             2 L UBIN BYTE CALIGNED INIT (31),
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:14   
      473    19484    1             2 C CHAR (31) INIT (%VW_PATTERN#);
      474    19485
      475    19486    1   DCL 1 BAD_PATTERN AUTO,
      476    19487    1             2 L UBIN BYTE CALIGNED,
      477    19488    1             2 C CHAR (31);
      478    19489
      479    19490
      480    19491    1   DCL PASSWORD                       CHAR(8);
      481    19492    1   DCL BIT6(0:11) REDEF PASSWORD UNAL UBIN(6);
      482    19493    1   DCL VW_IAM# STATIC SYMDEF          CHAR(8);
      483    19494
      484    19495    1   DCL VW_SCRAMBLE# STATIC SYMDEF     BIT(1);
      485    19496    1   DCL VW_OPERERR# SYMREF             BIT(1);
      486    19497
      487    19498    1   DCL VWE$EVOM                       ENTRY ALTRET;
      488    19499    1   DCL VWB$BEAM                       ENTRY(1) ALTRET;
      489    19500    1   DCL VWX$MAIL                       ENTRY(5);
      490    19501    1   DCL VWH$HEADER                     ENTRY(3) ALTRET;
      491    19502    1   DCL VWF$FOOTER                     ENTRY(3) ALTRET;
      492    19503    1   DCL VWI$TRANSI                     ENTRY(1);
      493    19504    1   DCL VWO$TRANSO                     ENTRY(1);
      494    19505    1   DCL VWA$ABORT                      ENTRY ASYNC;
      495    19506
      496    19507        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:15   
      497    19508        /****
      498    19509        *
      499    19510        *   Sleep for awhile; upon awakening, reset the file name for JI
      500    19511        *   to null and open the next file in .:MOVE, if any.  At end, go
      501    19512        *   back to sleep.  Read the file found into VW_OPTIONS#, checking that
      502    19513        *   it looks legal.  Open MAIL appropriately, then call BEAM or
      503    19514        *   SUCK or a packet switching routine called POST.
      504    19515        *
      505    19516        ****/
      506    19517
      507    19518    1      CALL XUR$INIT(XUR_INIT);
      508    19519    1      CALL XUR$SETERRMSG(ERRMSGFID);
      509    19520
      510    19521        /****
      511    19522        *
      512    19523        *   Don't run if we're not a ghost.  If we are, initialize the DCB
      513    19524        *   pointers, then set up stuff in the JIT.  If we don't have JIT
      514    19525        *   access, we'll bomb here pretty quick.
      515    19526        *
      516    19527        ****/
      517    19528
      518    19529    1   RESTART:
      519    19530    1      IF B$JIT.MODE~=%M_GHOST# THEN
      520    19531    1         RETURN;
      521    19532    1      CALL M$XCON(FPT_XCON1);
      522    19533    1      JIPTR=DCBADDR(DCBNUM(M$JI));
      523    19534    1      JEPTR=DCBADDR(DCBNUM(M$JE));
      524    19535    1      MAILPTR=DCBADDR(DCBNUM(M$MAIL));
      525    19536    2      if B$JIT.PRIV.ACTIVE.JIT then do;
      526    19537    2         B$JIT.PRIV.ACTIVE = (%PR_JIT#|%PR_SPCLMM#);
      527    19538    2         B$JIT.PRIV.AUTH   = (B$JIT.PRIV.AUTH|%PR_SPCLMM#);
      528    19539    2         end;
      529    19540
      530    19541        /****
      531    19542        *
      532    19543        *   Find out who I am by reading the *IAM record from :NODES.  Leave :NODES
      533    19544        *   open so that nobody can change it on us without our knowledge.
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:16   
      534    19545        *
      535    19546        ****/
      536    19547
      537    19548    1      CALL M$OPEN(OPEN_NODE) ALTRET(BAD_NOD);
      538    19549    1      NODEKEY.L=8;
      539    19550    1      NODEKEY.C='*IAM';
      540    19551    1      CALL M$READ(READ_NODE) ALTRET(BAD_NOD);
      541    19552    1      VW_IAM#=NODEOVR.PATH_NAME;
      542    19553
      543    19554        /****
      544    19555        *
      545    19556        *   Make sure I'm the only SCOTTY running by issuing an M$ENQ on the :NODES
      546    19557        *   file, specifying a resource name of "Scotty XXX".
      547    19558        *
      548    19559        ****/
      549    19560
      550    19561    1      CALL CONCAT (WHO_AM_I.NAME#, 'Scotty ', B_VERSION.NAME#);
      551    19562    1      WHO_AM_I.L# = MINIMUM (B_VERSION.L# + LENGTHC('Scotty '),
      552    19563    1        LENGTHC(WHO_AM_I.NAME#));
      553    19564    1      CALL M$ENQ (ENQ_ON_NODES)
      554    19565    2        WHENALTRETURN DO;
      555    19566    2         RETURN;
      556    19567    2         END;
      557    19568
      558    19569        /****
      559    19570        *
      560    19571        *   Check to see that :MAIL_CENTRAL.:MOVE exists.  If it
      561    19572        *   doesn't, create it.  This isn't easy:  We must write the
      562    19573        *   proper commands to JF, then go to EOJ.  MAIL will then be
      563    19574        *   invoked to create the mailbox.  Then we'll recall ourself
      564    19575        *   and get back here again.  If we get here twice and there's
      565    19576        *   no :MAIL_CENTRAL.:MOVE, bomb!
      566    19577        *
      567    19578        ****/
      568    19579
      569    19580    2      if B$JIT.PRIV.ACTIVE.JIT then do;
      570    19581    2         B$JIT.ACCN  = VWS_ACCT_JI.ACCT#;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:17   
      571    19582    2         B$JIT.FACCN = VWS_ACCT_JI.ACCT#;
      572    19583    2         end;
      573    19584    2      CALL M$OPEN(OPEN_MAILBOX) WHENALTRETURN DO;
      574    19585    3         IF B$JIT.JOBNAME=WHO_AM_I.NAME# THEN DO;
      575    19586    3            CALL M$XCON(FPT_XCON2);
      576    19587    3            CALL M$XXX;
      577    19588    3            END;
      578    19589    2         if B$JIT.PRIV.ACTIVE.JIT
      579    19590    2           then B$JIT.JOBNAME=WHO_AM_I.NAME#;
      580    19591    2         CALL M$OPEN(OPEN_JF);
      581    19592    2         JIBUF='!MAIL';
      582    19593    2         CALL M$WRITE(WRITE_JF);
      583    19594    2         JIBUF='CREATE FOLDER';
      584    19595    2         CALL M$WRITE(WRITE_JF);
      585    19596    2         JIBUF='USE /CENTRAL';
      586    19597    2         CALL M$WRITE(WRITE_JF);
      587    19598    2         CALL CONCAT(JIBUF,'PROFILE SIGNED=''',SUBSTR(WHO_AM_I.NAME#, 0,
      588    19599    2           WHO_AM_I.L#), '''');
      589    19600    2         CALL M$WRITE(WRITE_JF);
      590    19601    2         JIBUF='END';
      591    19602    2         CALL M$WRITE(WRITE_JF);
      592    19603    2         CALL CONCAT(JIBUF,'!',SUBSTR(DCBADDR(DCBNUM(M$LM))->DUMMY.NAME#.C,
      593    19604    2           0,DCBADDR(DCBNUM(M$LM))->DUMMY.NAME#.L));
      594    19605    2         CALL M$WRITE(WRITE_JF);
      595    19606    2         CALL M$CLOSE(CLOSE_JF);
      596    19607    2         CALL M$XCON(FPT_XCON2);
      597    19608    2         CALL M$EXIT;
      598    19609    2         END;
      599    19610
      600    19611        /****
      601    19612        *
      602    19613        *   Kill all overlays, then sleep for awhile.
      603    19614        *
      604    19615        ****/
      605    19616
      606    19617    1      VW_OPERERR#='0'B;
      607    19618
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:18   
      608    19619    1   ZZZZZ:
      609    19620    2      CALL M$OLAY(KILL_VWB$BEAM) WHENALTRETURN DO;
      610    19621    2         ;
      611    19622    2         END;
      612    19623    2      CALL M$OLAY(KILL_VWE$EVOM) WHENALTRETURN DO;
      613    19624    2         ;
      614    19625    2         END;
      615    19626    1      STATUS_LINE = 'Transporter idle, Cap''n...';
      616    19627    1      call UPDATE_STATUS;
      617    19628    1      CALL M$WAIT(SLEEP);
      618    19629
      619    19630        /****
      620    19631        *
      621    19632        *   Someone has awakened us.  Check to see if the operator has issued
      622    19633        *   an error (E) keyin.  If so, close the nodes file, and M$LDTRC
      623    19634        *   to a fresh copy of this rununit.  Normally, this is done so that
      624    19635        *   the system manager can make changes in :NODES, copy it OVER the
      625    19636        *   copy in .:SYS, and then !E the SCOTTY ghost to make SCOTTY aware
      626    19637        *   of the changes.  It may also be done if an updated (or repatched)
      627    19638        *   version of SCOTTY has been copied into .:SYS.
      628    19639        *
      629    19640        ****/
      630    19641
      631    19642    2      IF VW_OPERERR# THEN DO;
      632    19643    2         CALL M$CLOSE(CLOSE_NODE);
      633    19644    2         LINK_TO_NEW_SCOTTY.NAME_ = VECTOR(DCBADDR(DCBNUM(M$LM)) -> DUMMY.NAME#);
      634    19645    2         LINK_TO_NEW_SCOTTY.ACCT_ = VECTOR(DCBADDR(DCBNUM(M$LM)) -> DUMMY.ACCT#);
      635    19646    2         CALL M$XCON(FPT_XCON2);
      636    19647    2         CALL M$LDTRC (LINK_TO_NEW_SCOTTY);
      637    19648    2         END;
      638    19649
      639    19650        /****
      640    19651        *
      641    19652        *   Try to find another file.  The filename must begin with "MOVE" and
      642    19653        *   it must be at least 12 characters long.  Make sure we've got our
      643    19654        *   own identity in the JIT fields and that we have the appropriate
      644    19655        *   privileges on.
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:19   
      645    19656        *
      646    19657        ****/
      647    19658
      648    19659    1      NAME_JI.L#=12;
      649    19660    1      NAME_JI.NAME#='MOVE';
      650    19661
      651    19662    1   NEXT_FILE:
      652    19663    2      if B$JIT.PRIV.ACTIVE.JIT then do;
      653    19664    2         B$JIT.ACCN   = ':SYS    ';
      654    19665    2         B$JIT.UNAME  = 'SCOTTY';
      655    19666    2         B$JIT.FACCN  =  VWS_ACCT_JI.ACCT#;
      656    19667    2         B$JIT.MRT    =  34359738367;
      657    19668    2         B$JIT.REMCPO =  34359738367;
      658    19669    2         B$JIT.PRIV.ACTIVE = (%PR_JIT#|%PR_FMSEC#);
      659    19670    2         end;
      660    19671
      661    19672        /****
      662    19673        *
      663    19674        *   Try to open the "next" file in .:MOVE.  The filename must be
      664    19675        *   in the format MOVExxxxxxxxnnnnnnnn.
      665    19676        *
      666    19677        ****/
      667    19678
      668    19679    1      CALL M$OPEN(OPEN_JI) ALTRET(BAD_JIO);
      669    19680
      670    19681        /****
      671    19682        *
      672    19683        *   We found a file.  Check to see if it's a legal name.
      673    19684        *
      674    19685        ****/
      675    19686
      676    19687    1      STATUS_LINE = 'Transporter engaged.';
      677    19688    1      call UPDATE_STATUS;
      678    19689    1      NAME_JI=JIPTR->DUMMY.NAME#;
      679    19690    1      IF JIPTR->DUMMY.NAME#.L<=12 OR SUBSTR(JIPTR->DUMMY.NAME#.C,0,4)
      680    19691    1        ~='MOVE' THEN
      681    19692    1         GOTO REL_INP_REL_OUT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:20   
      682    19693
      683    19694        /****
      684    19695        *
      685    19696        *   We've got something open that looks like a good file.  Determine
      686    19697        *   what to do with it, if anything.  Note that the file may be
      687    19698        *   scrambled.
      688    19699        *
      689    19700        ****/
      690    19701
      691    19702    1      VW_OPTIONS#=' ';
      692    19703    1      OPTX=0;
      693    19704    1      JIBUF=' ';
      694    19705    1      VW_SCRAMBLE#='0'B;
      695    19706
      696    19707        /****
      697    19708        *
      698    19709        *   In order to determine if the file is scrambled, look for a valid
      699    19710        *   first command (BEAM, SUCK, or SHUT).  If we don't find this, try
      700    19711        *   unscrambling the record and check again.  If we still don't get
      701    19712        *   anything sensible, trash the file.  If the descrambling produced
      702    19713        *   readable text, set the scramble flag for later.
      703    19714        *
      704    19715        ****/
      705    19716
      706    19717    1      CALL M$READ(READ_JI) ALTRET(BAD_JIF);
      707    19718    1      IF SUBSTR(JIBUF,0,4)~='BEAM' AND SUBSTR(JIBUF,0,4)~='SUCK' AND
      708    19719    2        SUBSTR(JIBUF,0,4)~='SHUT' THEN DO;
      709    19720    2         CALL VWI$TRANSI(JIBUF);
      710    19721    2         VW_SCRAMBLE#='1'B;
      711    19722    2         IF SUBSTR(JIBUF,0,4)~='BEAM' AND SUBSTR(JIBUF,0,4)~='SUCK'
      712    19723    2           AND SUBSTR(JIBUF,0,4)~='SHUT' THEN
      713    19724    2            GOTO BAD_CMD;
      714    19725    2         END;
      715    19726
      716    19727        /****
      717    19728        *
      718    19729        *   See if this is a special shutdown message.
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:21   
      719    19730        *
      720    19731        ****/
      721    19732
      722    19733    2      IF SUBSTR(JIBUF,0,15)='SHUT UP, STELLA' THEN DO;
      723    19734    2         CLOSE_JI.V.DISP#=%RELEASE#;
      724    19735    2         CALL M$CLOSE(CLOSE_JI);
      725    19736    2         CALL M$XCON(FPT_XCON2);
      726    19737    2         RETURN;
      727    19738    2         END;
      728    19739
      729    19740        /****
      730    19741        *
      731    19742        *   Try to read the :NODES entry for the target node in this record.
      732    19743        *   If the node's name is a synonym, read the "real" node's name.
      733    19744        *
      734    19745        ****/
      735    19746
      736    19747    1      NODEKEY.C=SUBSTR(JIBUF,72,8);
      737    19748    2      CALL M$READ(READ_NODE) WHENRETURN DO;
      738    19749    2         IF DCBADDR(DCBNUM(M$NODE))->DUMMY.ARS#=8 THEN
      739    19750    2            SUBSTR(JIBUF,72,8)=NODEOVR.PATH_NAME;
      740    19751    2         END;
      741    19752
      742    19753        /****
      743    19754        *
      744    19755        *   If the node specified is not me, send this packet elsewhere.
      745    19756        *
      746    19757        ****/
      747    19758
      748    19759    1      IF SUBSTR(JIBUF,72,8)~=VW_IAM# THEN
      749    19760    1         GOTO DO_POST;
      750    19761
      751    19762        /****
      752    19763        *
      753    19764        *   We want to do something with this packet.  Assemble the commands
      754    19765        *   into the OPTS buffer.  Note that we always read one more command
      755    19766        *   into JIBUF than is necessary.
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:22   
      756    19767        *
      757    19768        ****/
      758    19769
      759    19770        /****
      760    19771        *
      761    19772        *   Read the SUCK command header (two records), if present.  A SUCK
      762    19773        *   request turns into a BEAM here; the SUCK information is used to
      763    19774        *   log the retrieving user onto this node.
      764    19775        *
      765    19776        ****/
      766    19777
      767    19778    2      IF SUBSTR(JIBUF,0,4)='SUCK' THEN DO;
      768    19779    2         CARD(0)=JIBUF;
      769    19780    2         JIBUF=' ';
      770    19781    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);
      771    19782    2         IF VW_SCRAMBLE# THEN
      772    19783    2            CALL VWI$TRANSI(JIBUF);
      773    19784    2         CARD(1)=JIBUF;
      774    19785    2         JIBUF=' ';
      775    19786    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);
      776    19787    2         IF VW_SCRAMBLE# THEN
      777    19788    2            CALL VWI$TRANSI(JIBUF);
      778    19789    2         END;
      779    19790
      780    19791        /****
      781    19792        *
      782    19793        *   Read the BEAM command header (two records), if present (this should
      783    19794        *   always be true).  If SUCK isn't present, the file contains a file
      784    19795        *   to be restored here via the EVOM routine; the BEAM records contain
      785    19796        *   the logon for the file restorer.  If SUCK is present, the BEAM
      786    19797        *   records specify the file name and logon at the distant node.
      787    19798        *
      788    19799        ****/
      789    19800
      790    19801    2      IF SUBSTR(JIBUF,0,4)='BEAM' THEN DO;
      791    19802    2         CARD(2)=JIBUF;
      792    19803    2         JIBUF=' ';
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:23   
      793    19804    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);
      794    19805    2         IF VW_SCRAMBLE# THEN
      795    19806    2            CALL VWI$TRANSI(JIBUF);
      796    19807    2         CARD(3)=JIBUF;
      797    19808    2         JIBUF=' ';
      798    19809    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);
      799    19810    2         IF VW_SCRAMBLE# THEN
      800    19811    2            CALL VWI$TRANSI(JIBUF);
      801    19812    2         END;
      802    19813
      803    19814
      804    19815        /****
      805    19816        *
      806    19817        *   Read the various MAIL records (two each), if present.  There may
      807    19818        *   be MAILI (mail to initiator), MAILR (mail to receiver), and/or
      808    19819        *   MAILS (mail to sender) records.  Each consists of a header containing
      809    19820        *   the node name and the name of the mailbox.
      810    19821        *
      811    19822        ****/
      812    19823
      813    19824    2      DO WHILE(SUBSTR(JIBUF,0,4)='MAIL');
      814    19825    2         IF SUBSTR(JIBUF,4,1)='S' THEN
      815    19826    2            I=4;
      816    19827    2           ELSE IF SUBSTR(JIBUF,4,1)='R' THEN
      817    19828    2               I=6;
      818    19829    2              ELSE
      819    19830    2               I=8;
      820    19831    2         CARD(I)=JIBUF;
      821    19832    2         JIBUF=' ';
      822    19833    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);
      823    19834    2         IF VW_SCRAMBLE# THEN
      824    19835    2            CALL VWI$TRANSI(JIBUF);
      825    19836    2         CARD(I+1)=JIBUF;
      826    19837    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);
      827    19838    2         IF VW_SCRAMBLE# THEN
      828    19839    2            CALL VWI$TRANSI(JIBUF);
      829    19840    2         END;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:24   
      830    19841
      831    19842        /****
      832    19843        *
      833    19844        *   Read options records, if present.  When we're done with this, we
      834    19845        *   will have read one too many records.  In the case of a SUCK, we
      835    19846        *   will have read the " EOF" record, which we'll discard (we don't
      836    19847        *   bother checking for it, however).  In the case of a BEAM, we will
      837    19848        *   have read the first data record which will contain the beginning
      838    19849        *   of the FIT.
      839    19850        *
      840    19851        ****/
      841    19852
      842    19853    2      DO WHILE(SUBSTR(JIBUF,0,4)='OPTS');
      843    19854    2         OPTS.OPTSRECS(OPTX)=JIBUF;
      844    19855    2         OPTX=OPTX+1;
      845    19856    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);
      846    19857    2         IF VW_SCRAMBLE# THEN
      847    19858    2            CALL VWI$TRANSI(JIBUF);
      848    19859    2         END;
      849    19860
      850    19861        /****
      851    19862        *
      852    19863        *   Reposition in the input file correctly.
      853    19864        *
      854    19865        ****/
      855    19866
      856    19867    1      CALL M$PRECORD(PRECORD_JI) ALTRET(BAD_JIF);
      857    19868
      858    19869        /****
      859    19870        *
      860    19871        *   Now figure out who to call to do what needs to be done.
      861    19872        *
      862    19873        ****/
      863    19874
      864    19875    1      IF OPTS.INP.CMD='SUCK' THEN
      865    19876    1         GOTO DO_SUCK;
      866    19877    1      IF OPTS.OUT.CMD='BEAM' THEN
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:25   
      867    19878    1         GOTO DO_BEAM;
      868    19879    1      GOTO REL_INP_REL_OUT;
      869    19880
      870    19881        /****
      871    19882        *
      872    19883        *   We didn't find a good command in the file.
      873    19884        *
      874    19885        ****/
      875    19886
      876    19887    1   BAD_CMD:
      877    19888    1      ERRCODE=%E$VWM_CMD;
      878    19889    1      GOTO BAD_USRERR;
      879    19890
      880    19891        /****
      881    19892        *
      882    19893        *   The :NODES file isn't available.  If we got a "Packset is not
      883    19894        *   ready to use", just wait for it awhile.  Come here also if *IAM
      884    19895        *   doesn't exist.
      885    19896        *
      886    19897        ****/
      887    19898
      888    19899    1   BAD_NOD:
      889    19900    1      ERRBITS=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      890    19901    2      IF ERRBITS.CODE=%E$SETDOWN THEN DO;
      891    19902    2         CALL M$WAIT(SLEEP);
      892    19903    2         GOTO RESTART;
      893    19904    2         END;
      894    19905    1      GOTO BAD_USRERR;
      895    19906
      896    19907        /****
      897    19908        *
      898    19909        *   The destination node isn't known to us here.
      899    19910        *
      900    19911        ****/
      901    19912
      902    19913    1   BAD_DST:
      903    19914    1      ERRCODE=%E$VWM_DST;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:26   
      904    19915    1      GOTO BAD_USRERR;
      905    19916
      906    19917        /****
      907    19918        *
      908    19919        *   The user has specified an illegal logon/password.
      909    19920        *
      910    19921        ****/
      911    19922
      912    19923    1   BAD_LGN:
      913    19924    1      ERRCODE=%E$VWM_LGN;
      914    19925    1      GOTO BAD_USRERR;
      915    19926
      916    19927        /****
      917    19928        *
      918    19929        *   You cannot use :MAIL,500ATOB as a logon.
      919    19930        *
      920    19931        ****/
      921    19932
      922    19933    1   BAD_SUK:
      923    19934    1      ERRCODE=%E$VWM_SUK;
      924    19935    1      GOTO BAD_USRERR;
      925    19936
      926    19937        /****
      927    19938        *
      928    19939        *   Packet header shows signs of mistranslation.
      929    19940        *
      930    19941        ****/
      931    19942
      932    19943    1   BAD_TRANSLATION:
      933    19944    1      ERRCODE = %E$VWM_XLATION;
      934    19945    1      CALL VWX$MAIL (ERRCODE,VECTOR(BAD_PATTERN),VECTOR(GOOD_PATTERN));
      935    19946    1      GOTO REL_INP_REL_OUT;
      936    19947
      937    19948        /****
      938    19949        *
      939    19950        *   Error opening the JI stream.  This may just be end-of-directory.
      940    19951        *
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:27   
      941    19952        ****/
      942    19953
      943    19954    1   BAD_JIO:
      944    19955    1      ERRBITS=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      945    19956    1      IF ERRBITS.CODE~=%E$FDEOF THEN
      946    19957    1         GOTO BAD_JIF;
      947    19958    1      GOTO ZZZZZ;
      948    19959
      949    19960        /****
      950    19961        *
      951    19962        *   Error reading the JI stream.  This is bad.
      952    19963        *
      953    19964        ****/
      954    19965
      955    19966    1   BAD_JIF:
      956    19967    1      ERRDCB=DCBNUM(M$JI);
      957    19968    1      GOTO BAD_SYSERR;
      958    19969
      959    19970        /****
      960    19971        *
      961    19972        *   The nodename specified in the :NODES file doesn't exist.  This
      962    19973        *   is a system manager error.
      963    19974        *
      964    19975        ****/
      965    19976
      966    19977    1   BAD_VIA:
      967    19978    1      ERRDCB=DCBNUM(M$MAIL);
      968    19979    1      GOTO BAD_SYSERR;
      969    19980
      970    19981        /****
      971    19982        *
      972    19983        *   Unable to write output to JE.
      973    19984        *
      974    19985        ****/
      975    19986
      976    19987    1   BAD_WRM:
      977    19988    1      ERRDCB=DCBNUM(M$JE);
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:28   
      978    19989    1      GOTO BAD_SYSERR;
      979    19990
      980    19991        /****
      981    19992        *
      982    19993        *   The JI file is incomplete or garbled in some way.
      983    19994        *
      984    19995        ****/
      985    19996
      986    19997    1   BAD_RJI:
      987    19998    1      ERRDCB=DCBNUM(M$JI);
      988    19999    1      GOTO BAD_SYSERR;
      989    20000
      990    20001        /****
      991    20002        *
      992    20003        *   Handle a user-land error, then release any input and/or output files.
      993    20004        *
      994    20005        ****/
      995    20006
      996    20007    1   BAD_USRERR:
      997    20008    1      CALL VWX$MAIL(ERRCODE);
      998    20009    1      GOTO REL_INP_REL_OUT;
      999    20010
     1000    20011        /****
     1001    20012        *
     1002    20013        *   Handle a monitor error, then release any input and/or output files.
     1003    20014        *
     1004    20015        ****/
     1005    20016
     1006    20017    1   BAD_SYSERR:
     1007    20018    1      ERRBITS=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
     1008    20019    1      ERRBITS.SEV=0;
     1009    20020    1      CALL VWX$MAIL(ERRCODE,,,,ERRDCB);
     1010    20021    1      GOTO REL_INP_REL_OUT;
     1011    20022
     1012    20023        /****
     1013    20024        *
     1014    20025        *   Save the input file for later, release any output.  This is used
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:29   
     1015    20026        *   when some recoverable error occurs, such as packset not mounted or
     1016    20027        *   file busy.
     1017    20028        *
     1018    20029        ****/
     1019    20030
     1020    20031    1   SAV_INP_REL_OUT:
     1021    20032    1      if B$JIT.PRIV.ACTIVE.JIT
     1022    20033    1        then B$JIT.PRIV.ACTIVE=(%PR_JIT#|%PR_FMSEC#);
     1023    20034    2      IF JIPTR->DUMMY.FCD# THEN DO;
     1024    20035    2         CLOSE_JI.V.DISP#=%SAVE#;
     1025    20036    2         CALL M$CLOSE(CLOSE_JI);
     1026    20037    2         END;
     1027    20038    2      IF JEPTR->DUMMY.FCD# THEN DO;
     1028    20039    2         CLOSE_JE.V.DISP#=%RELEASE#;
     1029    20040    2         CALL M$CLOSE(CLOSE_JE);
     1030    20041    2         END;
     1031    20042    1      CALL CLOSE_THE_MAIL_FILE;
     1032    20043    1      GOTO NEXT_FILE;
     1033    20044
     1034    20045        /****
     1035    20046        *
     1036    20047        *   Release the input file, save the output file.  This is the normal,
     1037    20048        *   desired condition.
     1038    20049        *
     1039    20050        ****/
     1040    20051
     1041    20052    1   REL_INP_SAV_OUT:
     1042    20053    1      if B$JIT.PRIV.ACTIVE.JIT
     1043    20054    1        then B$JIT.PRIV.ACTIVE=(%PR_JIT#|%PR_FMSEC#);
     1044    20055    2      IF JIPTR->DUMMY.FCD# THEN DO;
     1045    20056    2         CLOSE_JI.V.DISP#=%RELEASE#;
     1046    20057    2         CALL M$CLOSE(CLOSE_JI);
     1047    20058    2         END;
     1048    20059    2      IF JEPTR->DUMMY.FCD# THEN DO;
     1049    20060    2         CLOSE_JE.V.DISP#=%SAVE#;
     1050    20061    2         CALL M$CLOSE(CLOSE_JE);
     1051    20062    2         END;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:30   
     1052    20063    1      CALL CLOSE_THE_MAIL_FILE;
     1053    20064    1      GOTO NEXT_FILE;
     1054    20065
     1055    20066        /****
     1056    20067        *
     1057    20068        *   Release both the input and output files.  This is used to trash
     1058    20069        *   an offensive file and anything that we might have done whilst
     1059    20070        *   processing it.
     1060    20071        *
     1061    20072        ****/
     1062    20073
     1063    20074    1   REL_INP_REL_OUT:
     1064    20075    1      if B$JIT.PRIV.ACTIVE.JIT
     1065    20076    1        then B$JIT.PRIV.ACTIVE=(%PR_JIT#|%PR_FMSEC#);
     1066    20077    2      IF JIPTR->DUMMY.FCD# THEN DO;
     1067    20078    2         CLOSE_JI.V.DISP#=%RELEASE#;
     1068    20079    2         CALL M$CLOSE(CLOSE_JI);
     1069    20080    2         END;
     1070    20081    2      IF JEPTR->DUMMY.FCD# THEN DO;
     1071    20082    2         CLOSE_JE.V.DISP#=%RELEASE#;
     1072    20083    2         CALL M$CLOSE(CLOSE_JE);
     1073    20084    2         END;
     1074    20085    1      CALL CLOSE_THE_MAIL_FILE;
     1075    20086    1      GOTO NEXT_FILE;
     1076    20087
     1077    20088        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:31   
     1078    20089        /****
     1079    20090        *
     1080    20091        *   Handle transferring a message packet from this machine to
     1081    20092        *   another:  Fetch the destination node's :NODES record to find
     1082    20093        *   the (next) path to send it down in order that it will get to
     1083    20094        *   its ultimate destination.  Then simply copy the records from
     1084    20095        *   the input file to the output path.  No editing is done.
     1085    20096        *
     1086    20097        ****/
     1087    20098
     1088    20099    1   DO_POST:
     1089    20100    1      NODEKEY.C=SUBSTR(JIBUF,72,8);
     1090    20101    1      CALL M$READ(READ_NODE) ALTRET(BAD_DST);
     1091    20102    2      IF DCBADDR(DCBNUM(M$NODE))->DUMMY.ARS#=8 THEN DO;
     1092    20103    2         NODEKEY.C=NODEOVR.PATH_NAME;
     1093    20104    2         CALL M$READ(READ_NODE) ALTRET(BAD_DST);
     1094    20105    2         END;
     1095    20106
     1096    20107        /****
     1097    20108        *
     1098    20109        *   Disallow MOVEing from non-Honeywell to non-Honeywell sites
     1099    20110        *   if we are the L66A system.  We do this by examining the CODE11
     1100    20111        *   entry in the FIT of the JI file, which is built by INSYM.  It
     1101    20112        *   contains the WSN (pathname) of the originating station.  Since
     1102    20113        *   This is built on the L66A system by the L66A system, there is
     1103    20114        *   no way for a customer to circumvent it.
     1104    20115        *
     1105    20116        ****/
     1106    20117
     1107    20118    2      IF VW_IAM#='L66A' THEN DO;
     1108    20119    2         P=ADDR(FITBUF);
     1109    20120    2         I=1;
     1110    20121    3         DO WHILE(I<=P->FM$FIT.CODES.CODE(0) AND P->FM$FIT.CODES.CODE(I)~=11);
     1111    20122    3            I=I+1;
     1112    20123    3            END;
     1113    20124    3         IF I<=P->FM$FIT.CODES.CODE(0) THEN DO;
     1114    20125    3            P=PINCRW(P,P->FM$FIT.CODES.ITEMX(I));
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:32   
     1115    20126    3            IF P->FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME~='L66A'
     1116    20127    3              AND P->FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME~='L66B'
     1117    20128    3              AND P->FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME~='L66C'
     1118    20129    3              AND P->FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME~='L66D'
     1119    20130    3              AND P->FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME~='BMS' AND
     1120    20131    3              NODEOVR.NODE_NAME~='L66A' AND NODEOVR.NODE_NAME~='L66B' AND
     1121    20132    3              NODEOVR.NODE_NAME~='L66C' AND NODEOVR.NODE_NAME~='L66D' AND
     1122    20133    3              NODEOVR.NODE_NAME~='BMS' THEN
     1123    20134    3               GOTO REL_INP_REL_OUT;
     1124    20135    3            END;
     1125    20136    2         END;
     1126    20137
     1127    20138        /****
     1128    20139        *
     1129    20140        *   Looks OK, so let's ship it.  Reset the PO count, since we're
     1130    20141        *   "punching cards", to allow for the maximum file size (about 1,000
     1131    20142        *   granules or so).  Then open the JE stream to the specified node.
     1132    20143        *
     1133    20144        ****/
     1134    20145
     1135    20146    1      if B$JIT.PRIV.ACTIVE.JIT
     1136    20147    1        then B$JIT.REMCPO=131071;
     1137    20148    1      WSN_JE.WSN#=NODEOVR.PATH_NAME;
     1138    20149    1      WRITE_JE.BUF_.BOUND=79;
     1139    20150    1      CALL M$OPEN(OPEN_JE) ALTRET(BAD_VIA);
     1140    20151
     1141    20152        /****
     1142    20153        *
     1143    20154        *   Supply the header appropriate for this type of node.
     1144    20155        *
     1145    20156        ****/
     1146    20157
     1147    20158    1      I=NODEOVR.TYPE_PATH;
     1148    20159    1      CALL VWH$HEADER(DCBNUM(M$JE),JEBUF,I) ALTRET(BAD_WRM);
     1149    20160
     1150    20161        /****
     1151    20162        *
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:33   
     1152    20163        *   Recall that we have one extra record already in JIBUF, and that
     1153    20164        *   it has been descrambled.
     1154    20165        *
     1155    20166        ****/
     1156    20167
     1157    20168    1      JEBUF=JIBUF;
     1158    20169    1      IF VW_SCRAMBLE# THEN
     1159    20170    1         CALL VWO$TRANSO(JEBUF);
     1160    20171    1      CALL M$WRITE(WRITE_JE) ALTRET(BAD_WRM);
     1161    20172
     1162    20173        /****
     1163    20174        *
     1164    20175        *   Now simply read and write until EOF.  Strip the EOF record from the file.
     1165    20176        *
     1166    20177        ****/
     1167    20178
     1168    20179    2      DO WHILE('1'B);
     1169    20180    2         JIBUF=' ';
     1170    20181    2         CALL M$READ(READ_JI) ALTRET(POST_EOF);
     1171    20182    2         JEBUF=JIBUF;
     1172    20183    2         IF VW_SCRAMBLE# THEN
     1173    20184    2            CALL VWI$TRANSI(JIBUF);
     1174    20185    2         IF SUBSTR(JEBUF,0,4)~=' EOF' THEN
     1175    20186    2            CALL M$WRITE(WRITE_JE) ALTRET(BAD_WRM);
     1176    20187    2         END;
     1177    20188
     1178    20189        /****
     1179    20190        *
     1180    20191        *   If we didn't get here via EOF, we're in trouble.
     1181    20192        *
     1182    20193        ****/
     1183    20194
     1184    20195    1   POST_EOF:
     1185    20196    1      IF (JIPTR->DUMMY.TYC&'104200000000'O)='0'B THEN
     1186    20197    1         GOTO BAD_RJI;
     1187    20198
     1188    20199        /****
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:34   
     1189    20200        *
     1190    20201        *   Supply appropriate closing text, then ship this sucker.
     1191    20202        *
     1192    20203        ****/
     1193    20204
     1194    20205    1      I=NODEOVR.TYPE_PATH;
     1195    20206    1      CALL VWF$FOOTER(DCBNUM(M$JE),JEBUF,I) ALTRET(BAD_WRM);
     1196    20207    1      GOTO REL_INP_SAV_OUT;
     1197    20208
     1198    20209        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:35   
     1199    20210        /****
     1200    20211        *
     1201    20212        *   Handle a "SUCK" request (which turns into a BEAM at this end).
     1202    20213        *   Assume the user's identity specified in the SUCK record (card
     1203    20214        *   0) and try to "logon" by accessing :USERS and :HLP.  Merge
     1204    20215        *   the user's privileges into the JIT, but keep JIT access on
     1205    20216        *   regardless.  If a MAIL record is present, open M$MAIL to the
     1206    20217        *   proper file and write the header information.
     1207    20218        *
     1208    20219        ****/
     1209    20220
     1210    20221    1   DO_SUCK:
     1211    20222    1      IF OPTS.MAILINIT.CMD='MAIL' OR OPTS.MAILSNDR.CMD='MAIL' THEN
     1212    20223    1         CALL OPEN_THE_MAIL_FILE('SNDR');
     1213    20224
     1214    20225        /****
     1215    20226        *
     1216    20227        *   Check to make sure that the packet survived transmission OK.
     1217    20228        *
     1218    20229        ****/
     1219    20230
     1220    20231    1      CALL CHECK_PACKET ALTRET (BAD_TRANSLATION);
     1221    20232
     1222    20233    1      CALL IMPERSONATE_USER(OPTS.INP) ALTRET(BAD_LGN);
     1223    20234
     1224    20235        /****
     1225    20236        *
     1226    20237        *   Disallow use of :MAIL,500ATOB as a legal logon for a SUCK.
     1227    20238        *
     1228    20239        ****/
     1229    20240
     1230    20241    1      IF B$JIT.ACCN=':MAIL' AND B$JIT.UNAME='500ATOB' THEN
     1231    20242    1         GOTO BAD_SUK;
     1232    20243    1      CALL VWB$BEAM ALTRET(SUCK_BUSY);
     1233    20244    1      GOTO REL_INP_SAV_OUT;
     1234    20245
     1235    20246        /****
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:36   
     1236    20247        *
     1237    20248        *   If VWB$BEAM ALTRETs, check to see if the file was busy or
     1238    20249        *   the packset wasn't up.  If so, keep this request packet
     1239    20250        *   around for processing later.
     1240    20251        *
     1241    20252        ****/
     1242    20253
     1243    20254    1   SUCK_BUSY:
     1244    20255    2      IF OPTS.MAILINIT.CMD='BUSY' THEN DO;
     1245    20256    2         CLOSE_MAIL.V.DISP#=%RELEASE#;
     1246    20257    2         CALL M$CLOSE(CLOSE_MAIL);
     1247    20258    2         GOTO SAV_INP_REL_OUT;
     1248    20259    2         END;
     1249    20260    1      GOTO REL_INP_REL_OUT;
     1250    20261
     1251    20262        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:37   
     1252    20263        /****
     1253    20264        *
     1254    20265        *   Perform a "BEAM" command (which turns into "EVOM" here).
     1255    20266        *   Assume the user's identity specified in the BEAM record (card
     1256    20267        *   2) and try to "logon" by accessing :USERS and :HLP.  Merge
     1257    20268        *   the user's privileges into the JIT, but keep JIT access on
     1258    20269        *   regardless.  If a MAIL is requested, open the M$MAIL file to
     1259    20270        *   the appropriate file and initialize it.
     1260    20271        *
     1261    20272        ****/
     1262    20273
     1263    20274    1   DO_BEAM:
     1264    20275    1      IF OPTS.MAILINIT.CMD='MAIL' OR OPTS.MAILRCVR.CMD='MAIL' THEN
     1265    20276    1         CALL OPEN_THE_MAIL_FILE('RCVR');
     1266    20277
     1267    20278        /****
     1268    20279        *
     1269    20280        *   Check to make sure that the packet survived transmission OK.
     1270    20281        *
     1271    20282        ****/
     1272    20283
     1273    20284    1      CALL CHECK_PACKET ALTRET (BAD_TRANSLATION);
     1274    20285
     1275    20286    1      CALL IMPERSONATE_USER(OPTS.OUT) ALTRET(BAD_LGN);
     1276    20287    1      CALL VWE$EVOM ALTRET(BEAM_BUSY);
     1277    20288    1      GOTO REL_INP_SAV_OUT;
     1278    20289
     1279    20290        /****
     1280    20291        *
     1281    20292        *   If VWE$EVOM ALTRETs, check to see if the file was busy or
     1282    20293        *   the packset wasn't up.  If so, keep this request packet
     1283    20294        *   around for later processing.
     1284    20295        *
     1285    20296        ****/
     1286    20297
     1287    20298    1   BEAM_BUSY:
     1288    20299    2      IF OPTS.MAILINIT.CMD='BUSY' THEN DO;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:38   
     1289    20300    2         CLOSE_MAIL.V.DISP#=%RELEASE#;
     1290    20301    2         CALL M$CLOSE(CLOSE_MAIL);
     1291    20302    2         GOTO SAV_INP_REL_OUT;
     1292    20303    2         END;
     1293    20304    1      GOTO REL_INP_REL_OUT;
     1294    20305
     1295    20306        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:39   
     1296    20307        /*I**
     1297    20308        *
     1298    20309        *   NAME:  OPEN_THE_MAIL_FILE
     1299    20310        *
     1300    20311        *   PURPOSE:
     1301    20312        *       To open the M$MAIL DCB to the proper destination.
     1302    20313        *
     1303    20314        *   CALL:
     1304    20315        *       CALL OPEN_THE_MAIL_FILE(who)
     1305    20316        *
     1306    20317        *   PARAMETERS:
     1307    20318        *       who - is either 'RCVR' or 'SNDR', describing which MAIL record set
     1308    20319        *       from VW_OPTIONS# is to be used as the mailbox address.
     1309    20320        *
     1310    20321        *   DATA:
     1311    20322        *       VW_MAILKEY# and VW_MAILBUF# are set and/or used.  The VW_OPTIONS#
     1312    20323        *       block is used heavily.  The MAIL FPTs are also used.
     1313    20324        *
     1314    20325        *   DESCRIPTION:
     1315    20326        *       Open the M$MAIL DCB to the proper destination.  WHO defines the
     1316    20327        *       mailbox to open.
     1317    20328        *
     1318    20329        ****/
     1319    20330
     1320    20331    1   OPEN_THE_MAIL_FILE: PROC(WHO);
     1321    20332
     1322    20333    2   DCL WHO                            CHAR(4);
     1323    20334
     1324    20335    2   DCL 1 MAILBOX,
     1325    20336    2             2 L UNAL                     UBIN BYTE,
     1326    20337    2             2 C UNAL                     CHAR(79);
     1327    20338
     1328    20339
     1329    20340        /****
     1330    20341        *
     1331    20342        *   Open the temp file for mail messages.  We must do this because we
     1332    20343        *   don't know the subject line (which is actually the result) until
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:40   
     1333    20344        *   after the BEAM/EVOM process is done.
     1334    20345        *
     1335    20346        ****/
     1336    20347
     1337    20348    2      CALL M$OPEN(OPEN_MAIL) ALTRET(OTMF_ALTRET);
     1338    20349
     1339    20350        /****
     1340    20351        *
     1341    20352        *   Generate the TO: line (line 1.000).  Send mail to the initiator,
     1342    20353        *   if requested, and to either the receiver or sender, based on WHO.
     1343    20354        *
     1344    20355        ****/
     1345    20356
     1346    20357    2      VW_MAILKEY#.L=3;
     1347    20358    2      VW_MAILKEY#.C=1000;
     1348    20359    2      VW_MAILBUF#='TO:';
     1349    20360    2      J=3;
     1350    20361
     1351    20362    3      IF OPTS.MAILINIT.WHO~=' ' THEN DO;
     1352    20363    3         CALL GENERATE_ADDRESS(OPTS.MAILINIT);
     1353    20364    3         CALL INSERT(VW_MAILBUF#,J,MAILBOX.L,SUBSTR(MAILBOX.C,0,MAILBOX.L));
     1354    20365    3         J=J+MAILBOX.L;
     1355    20366    3         END;
     1356    20367
     1357    20368    3      IF WHO='SNDR' AND OPTS.MAILSNDR.WHO~=' ' THEN DO;
     1358    20369    4         IF J>3 THEN DO;
     1359    20370    4            CALL INSERT(VW_MAILBUF#,J,1,',');
     1360    20371    4            J=J+1;
     1361    20372    4            END;
     1362    20373    3         CALL GENERATE_ADDRESS(OPTS.MAILSNDR);
     1363    20374    3         CALL INSERT(VW_MAILBUF#,J,MAILBOX.L,SUBSTR(MAILBOX.C,0,MAILBOX.L));
     1364    20375    3         J=J+MAILBOX.L;
     1365    20376    3         END;
     1366    20377
     1367    20378    3      IF WHO='RCVR' AND OPTS.MAILRCVR.WHO~=' ' THEN DO;
     1368    20379    4         IF J>3 THEN DO;
     1369    20380    4            CALL INSERT(VW_MAILBUF#,J,1,',');
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:41   
     1370    20381    4            J=J+1;
     1371    20382    4            END;
     1372    20383    3         CALL GENERATE_ADDRESS(OPTS.MAILRCVR);
     1373    20384    3         CALL INSERT(VW_MAILBUF#,J,MAILBOX.L,SUBSTR(MAILBOX.C,0,MAILBOX.L));
     1374    20385    3         J=J+MAILBOX.L;
     1375    20386    3         END;
     1376    20387
     1377    20388    2      WRITE_MAIL.BUF_.BOUND=J-1;
     1378    20389    2      CALL M$WRITE(WRITE_MAIL) ALTRET(OTMF_ALTRET);
     1379    20390
     1380    20391        /****
     1381    20392        *
     1382    20393        *   Set up the mail key to 3.000.  Record 2.000 will be written at EOJ.
     1383    20394        *
     1384    20395        ****/
     1385    20396
     1386    20397    2      VW_MAILKEY#.C=3000;
     1387    20398    2      RETURN;
     1388    20399
     1389    20400        /****
     1390    20401        *
     1391    20402        *   Something prevented us from writing/opening the mailbox.  If we
     1392    20403        *   have the mailbox open, close and release it.  This will signal
     1393    20404        *   other processes not to create mail.
     1394    20405        *
     1395    20406        ****/
     1396    20407
     1397    20408    2   OTMF_ALTRET:
     1398    20409    3      IF MAILPTR->DUMMY.FCD#='1'B THEN DO;
     1399    20410    3         CLOSE_MAIL.V.DISP#=%RELEASE#;
     1400    20411    3         CALL M$CLOSE(CLOSE_MAIL);
     1401    20412    3         END;
     1402    20413    2      RETURN;
     1403    20414
     1404    20415        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:42   
     1405    20416        /*I**
     1406    20417        *
     1407    20418        *   NAME:  GENERATE_ADDRESS
     1408    20419        *
     1409    20420        *   PURPOSE:
     1410    20421        *       To provide a properly-formatted mailbox address.
     1411    20422        *
     1412    20423        *   CALL:
     1413    20424        *       CALL GENERATE_ADDRESS(opt)
     1414    20425        *
     1415    20426        *   PARAMETERS:
     1416    20427        *       opt - is a two-"card" structure containing mail information.
     1417    20428        *
     1418    20429        *   DATA:
     1419    20430        *       MAILBOX will contain the decoded mailbox name if successful.
     1420    20431        *       VW_IAM# is referenced.
     1421    20432        *
     1422    20433        *   DESCRIPTION:
     1423    20434        *       Decode the mailbox name passed as an argument and form it into
     1424    20435        *       a proper address:  [/folder].account[.password][@wsn]
     1425    20436        *
     1426    20437        ****/
     1427    20438
     1428    20439    2   GENERATE_ADDRESS: PROC(OPT);
     1429    20440
     1430    20441        /****
     1431    20442        *
     1432    20443        *   FPTs for decoding the mailbox name.
     1433    20444        *
     1434    20445        ****/
     1435    20446
     1436    20447        %FPT_FID(ACCT=VLP_ACCT,
     1437    20448                 NAME=VLP_NAME,
     1438    20449                 PASS=VLP_PASS,
     1439    20450                 SN=VLP_SN,
     1440    20451                 ASN=ASN,
     1441    20452                 RES=RES,
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:43   
     1442    20453                 RESULTS=VLR_FID);
     1443    20476
     1444    20477        %VLP_ACCT(ACCT=' ');
     1445    20490
     1446    20491        %VLP_NAME(LEN=31,NAME=' ');
     1447    20518
     1448    20519        %VLP_PASS(PASS=' ');
     1449    20532
     1450    20533        %VLP_SN(N=6);
     1451    20546
     1452    20547        %VLR_FID;
     1453    20566
     1454    20567    3   DCL 1 OPT ALIGNED,
     1455    20568    3             2 * UNAL                     CHAR(72),
     1456    20569    3             2 NODE UNAL                  CHAR(8),
     1457    20570    3             2 L UNAL                     UBIN BYTE,
     1458    20571    3             2 MAILBOX UNAL               CHAR(79);
     1459    20572
     1460    20573    3   DCL ASN                            SBIN;
     1461    20574    3   DCL RES                            CHAR(4);
     1462    20575
     1463    20576    3   DCL I                              SBIN;
     1464    20577    3   DCL J                              SBIN;
     1465    20578
     1466    20579        /****
     1467    20580        *
     1468    20581        *   Attempt to decode the mailbox name as a normal FID.
     1469    20582        *
     1470    20583        ****/
     1471    20584
     1472    20585    3      FPT_FID.TEXTFID_=VECTOR(OPT.MAILBOX);
     1473    20586    3      VLR_FID='0'B;
     1474    20587    3      VLP_NAME.L#=31;
     1475    20588    3      VLP_SN.NUM#=6;
     1476    20589    4      call index(I,'.',OPT.MAILBOX) whenaltreturn do; I = 0; end;
     1477    20590    3      MAILBOX.L=0;
     1478    20591    3      MAILBOX.C=' ';
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:44   
     1479    20592    4      if I=0 or substr(OPT.MAILBOX,,6) ~= ':MAIL_' then do;
     1480    20593    4         MAILBOX.C = OPT.MAILBOX;
     1481    20594    4         call searchr(I,J,B$SR_NON_BLANK,MAILBOX.C)
     1482    20595    5           whenreturn do;
     1483    20596    5            I = I + 1;
     1484    20597    5            end;
     1485    20598    5           whenaltreturn do;
     1486    20599    5            I = 0;
     1487    20600    5            end;
     1488    20601    4         MAILBOX.L = I;
     1489    20602    4         end;
     1490    20603    4        else do;
     1491    20604    5         CALL M$FID(FPT_FID) WHENALTRETURN DO;
     1492    20605    5            RETURN;
     1493    20606    5            END;
     1494    20607
     1495    20608        /****
     1496    20609        *
     1497    20610        *   If we successfully parsed the mailbox name, fix it up into the
     1498    20611        *   desired format.
     1499    20612        *
     1500    20613        ****/
     1501    20614
     1502    20615    4         I=0;
     1503    20616    4         IF VLR_FID.NAME AND VLP_NAME.L#=13 AND VLP_NAME.NAME#=':MAIL_CENTRAL' THEN
     1504    20617    4            VLR_FID.NAME='0'B;
     1505    20618    5         IF VLR_FID.NAME THEN DO;
     1506    20619    6            IF VLP_NAME.L#>6 AND SUBSTR(VLP_NAME.NAME#,0,6)=':MAIL_' THEN DO;
     1507    20620    6               CALL CONCAT(MAILBOX.C,'/',SUBSTR(VLP_NAME.NAME#,6,VLP_NAME.L#-6));
     1508    20621    6               I=I+VLP_NAME.L#-5;
     1509    20622    6               END;
     1510    20623    6              ELSE DO;
     1511    20624    6               CALL CONCAT(MAILBOX.C,'/',SUBSTR(VLP_NAME.NAME#,0,VLP_NAME.L#));
     1512    20625    6               I=I+VLP_NAME.L#+1;
     1513    20626    6               END;
     1514    20627    5            END;
     1515    20628    4         IF VLR_FID.ACCT THEN
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:45   
     1516    20629    4            CALL INSERT(MAILBOX.C,I,,'.',VLP_ACCT.ACCT#);
     1517    20630    4           ELSE
     1518    20631    4            CALL INSERT(MAILBOX.C,I,,'.',B$JIT.ACCN);
     1519    20632    4         CALL INDEX(I,' ',MAILBOX.C);
     1520    20633    5         IF VLR_FID.PASS THEN DO;
     1521    20634    5            CALL INSERT(MAILBOX.C,I,,'.',VLP_PASS.PASS#);
     1522    20635    5            CALL INDEX(I,' ',MAILBOX.C);
     1523    20636    5            END;
     1524    20637    4         END;
     1525    20638
     1526    20639        /****
     1527    20640        *
     1528    20641        *   Supply the WSN if not here.
     1529    20642        *
     1530    20643        ****/
     1531    20644
     1532    20645    4      IF OPT.NODE~=VW_IAM# THEN DO;
     1533    20646    4         CALL INSERT(MAILBOX.C,I,,'@',OPT.NODE);
     1534    20647    4         CALL INDEX(I,' ',MAILBOX.C,I);
     1535    20648    4         END;
     1536    20649    3      MAILBOX.L=I;
     1537    20650    3      RETURN;
     1538    20651
     1539    20652    3   END;
     1540    20653
     1541    20654    2   END;
     1542    20655
     1543    20656        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:46   
     1544    20657        /*I**
     1545    20658        *
     1546    20659        *   NAME:  IMPERSONATE_USER
     1547    20660        *
     1548    20661        *   PURPOSE:
     1549    20662        *       To perform SLUG-like operations, logging on a user.
     1550    20663        *
     1551    20664        *   CALL:
     1552    20665        *       CALL IMPERSONATE_USER(opt) ALTRET...
     1553    20666        *
     1554    20667        *   PARAMETERS:
     1555    20668        *       opt - is a two-"card" structure containing logon information.
     1556    20669        *
     1557    20670        *   DATA:
     1558    20671        *       ACCTNAME is modified with the logon.  The FPTs for accessing the
     1559    20672        *       :HLP and :USERS files are used, and data are read into their
     1560    20673        *       respective buffers.  If the logon is successful, the account, name,
     1561    20674        *       and fma fields in the JIT are modified to impersonate the user, and
     1562    20675        *       the active privileges are set to the user's authorized privileges
     1563    20676        *       (batch, online, ghost ORed together) plus JIT access (so we can
     1564    20677        *       get back).
     1565    20678        *
     1566    20679        *   DESCRIPTION:
     1567    20680        *       "LOGON" the user identified in the parameter passed.  This
     1568    20681        *       involves reading :HLP.:SYS with the name and account given to
     1569    20682        *       check that the user is authorized and to validate his password.
     1570    20683        *       Then read :USERS.:SYS to fetch the user's authorized privileges
     1571    20684        *       and merge them into the active privileges in the JIT along with
     1572    20685        *       JIT access (so we can get back).  Then modify the JIT to the
     1573    20686        *       user's name and account.  If any of the files needed are busy,
     1574    20687        *       sleep until they aren't.  ALTRET if the user is not authorized.
     1575    20688        *
     1576    20689        ****/
     1577    20690
     1578    20691    1   IMPERSONATE_USER: PROC(OPT) ALTRET;
     1579    20692
     1580    20693    2   DCL 1 OPT ALIGNED,
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:47   
     1581    20694    2             2 *                          CHAR(4),
     1582    20695    2             2 ACCT                       CHAR(8),
     1583    20696    2             2 NAME                       CHAR(12),
     1584    20697    2             2 EPASS                      CHAR(12),
     1585    20698    2             2 BIT9(0:11) REDEF EPASS UNAL UBIN BYTE,
     1586    20699    2             2 *                          CHAR(44);
     1587    20700
     1588    20701        /****
     1589    20702        *
     1590    20703        *   Form the key for the :HLP file.
     1591    20704        *
     1592    20705        ****/
     1593    20706
     1594    20707    2      if not (B$JIT.PRIV.ACTIVE & (%PR_JIT# | %PR_FMSEC#)) then return;
     1595    20708    2      ACCTNAME.ACCT=OPT.ACCT;
     1596    20709    2      ACCTNAME.NAME=OPT.NAME;
     1597    20710    2      CALL INDEX1(I,' ',ACCTNAME.NAME);
     1598    20711    2      ACCTNAME.L=I+8;
     1599    20712    3      DO I=0 TO 11;
     1600    20713    3         BIT6(I)=OPT.BIT9(I)-ASCBIN(' ');
     1601    20714    3         END;
     1602    20715
     1603    20716        /****
     1604    20717        *
     1605    20718        *   Attempt to open and read the :HLP file.  If the M$OPEN ALTRETs,
     1606    20719        *   sleep for awhile and try again (forever).  If the file gets
     1607    20720        *   opened, read it quickly and close it so that SUPER doesn't get
     1608    20721        *   upset.
     1609    20722        *
     1610    20723        ****/
     1611    20724
     1612    20725    3      DO WHILE('0'B);
     1613    20726
     1614    20727    3   SLEEP_HLP:
     1615    20728    3         CALL M$WAIT(SNOOZE);
     1616    20729    3         END;
     1617    20730    2      CALL M$OPEN(OPEN_HLP) ALTRET(SLEEP_HLP);
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:48   
     1618    20731    2      CALL M$READ(READ_HLP) ALTRET(SETUP_ABORT);
     1619    20732    2      CALL M$CLOSE(CLOSE_HLP);
     1620    20733
     1621    20734        /****
     1622    20735        *
     1623    20736        *   Now open and update the :USERS file.  If the password is bad,
     1624    20737        *   increment the bad-logon count, otherwise set the last-logon
     1625    20738        *   timestamp.  Since we're changing the file, we need to enqueue
     1626    20739        *   on the record key, and TRUNC the file to get the change out to disk.
     1627    20740        *
     1628    20741        ****/
     1629    20742
     1630    20743    3      DO WHILE('0'B);
     1631    20744
     1632    20745    3   SLEEP_USERS:
     1633    20746    3         CALL M$WAIT(SNOOZE);
     1634    20747    3         END;
     1635    20748    2      CALL M$OPEN(OPEN_USERS) ALTRET(SLEEP_USERS);
     1636    20749    2      CALL M$ENQ(ENQ_USERS) ALTRET(SETUP_ABORT);
     1637    20750    3      CALL M$READ(READ_USERS) WHENALTRETURN DO;
     1638    20751    3         CALL M$DEQ(DEQ_USERS);
     1639    20752    3         GOTO SETUP_ABORT;
     1640    20753    3         END;
     1641    20754    3      IF HLPBUF.PASSWORD~=PASSWORD THEN DO;
     1642    20755    3         USERSBUF.BAD_LOGON_CNT=USERSBUF.BAD_LOGON_CNT+1;
     1643    20756    3         USERSBUF.LOGINS.BAD_LOGON_CNT(%M_GHOST#-1)=
     1644    20757    3           USERSBUF.LOGINS.BAD_LOGON_CNT(%M_GHOST#-1)+1;
     1645    20758    3         END;
     1646    20759    3        ELSE DO;
     1647    20760    4         CALL M$TIME(LOGON_TIME) WHENRETURN DO;
     1648    20761    4            USERSBUF.LAST_LOGON_TIME=BINBIT(LOGON_UTS,36);
     1649    20762    4            USERSBUF.LOGINS.LAST_LOGON_TIME(%M_GHOST#-1)=LOGON_UTS;
     1650    20763    4            END;
     1651    20764    3         END;
     1652    20765    2      CALL M$WRITE(WRITE_USERS);
     1653    20766    2      CALL M$TRUNC(TRUNC_USERS);
     1654    20767    2      CALL M$DEQ(DEQ_USERS);
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:49   
     1655    20768    2      CALL M$CLOSE(CLOSE_USERS);
     1656    20769
     1657    20770        /****
     1658    20771        *
     1659    20772        *   If the password doesn't match, altreturn to report the error.
     1660    20773        *
     1661    20774        ****/
     1662    20775
     1663    20776    2      IF HLPBUF.PASSWORD~=PASSWORD THEN
     1664    20777    2         ALTRETURN;
     1665    20778
     1666    20779        /****
     1667    20780        *
     1668    20781        *   "Become" this user.
     1669    20782        *
     1670    20783        ****/
     1671    20784
     1672    20785    3      if B$JIT.PRIV.ACTIVE.JIT then do;
     1673    20786    3         B$JIT.PRIV.ACTIVE=(%PR_JIT#|USERSBUF.PRIV(0)|USERSBUF.PRIV(1)
     1674    20787    3           |USERSBUF.PRIV(2));
     1675    20788    3         B$JIT.ACCN   = ACCTNAME.ACCT;
     1676    20789    3         B$JIT.UNAME  = ACCTNAME.NAME;
     1677    20790    3         B$JIT.FACCN  = ACCTNAME.ACCT;
     1678    20791    3         B$JIT.DEFEXP = USERSBUF.DEXP;
     1679    20792    3         B$JIT.MAXEXP = USERSBUF.MEXP;
     1680    20793    3         end;
     1681    20794
     1682    20795    2      RETURN;
     1683    20796
     1684    20797        /****
     1685    20798        *
     1686    20799        *   This user isn't authorized if the :HLP or :USERS record isn't there.
     1687    20800        *   ALTRET, but first make sure we have all the files closed.
     1688    20801        *
     1689    20802        ****/
     1690    20803
     1691    20804    2   SETUP_ABORT:
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:50   
     1692    20805    2      IF DCBADDR(DCBNUM(M$HLP))->DUMMY.FCD# THEN
     1693    20806    2         CALL M$CLOSE(CLOSE_HLP);
     1694    20807    2      IF DCBADDR(DCBNUM(M$USERS))->DUMMY.FCD# THEN
     1695    20808    2         CALL M$CLOSE(CLOSE_USERS);
     1696    20809    2      ALTRETURN;
     1697    20810
     1698    20811    2   END;
     1699    20812
     1700    20813        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:51   
     1701    20814        /*I**
     1702    20815        *
     1703    20816        *   NAME:  CLOSE_THE_MAIL_FILE
     1704    20817        *
     1705    20818        *   PURPOSE:
     1706    20819        *       To close the M$MAIL DCB, supplying appropriate ending text,
     1707    20820        *       then ship the mail by linking to SEND.
     1708    20821        *
     1709    20822        *   CALL:
     1710    20823        *       CALL CLOSE_THE_MAIL_FILE
     1711    20824        *
     1712    20825        *   PARAMETERS:
     1713    20826        *       None.
     1714    20827        *
     1715    20828        *   DATA:
     1716    20829        *       The JIT is modified back to :MOVE,SCOTTY.  VW_MAILKEY# and
     1717    20830        *       VW_MAILBUF# are modified.  M$MAIL is closed.  Then the resources
     1718    20831        *       which have been acquired (packsets, mostly) are released so that
     1719    20832        *       EFT doesn't get upset.
     1720    20833        *
     1721    20834        *   DESCRIPTION:
     1722    20835        *       Close the MAIL file, supplying appropriate ending text.  Ship
     1723    20836        *       the mail (if any) by linking to SEND.  Then release any acquired
     1724    20837        *       resources so that SCOTTY doesn't wind up "owning" all the packsets
     1725    20838        *       on the system.
     1726    20839        *
     1727    20840        ****/
     1728    20841
     1729    20842    1   CLOSE_THE_MAIL_FILE: PROC;
     1730    20843
     1731    20844        /****
     1732    20845        *
     1733    20846        *   Resume our proper identity for sending mail.
     1734    20847        *
     1735    20848        ****/
     1736    20849
     1737    20850    3      if B$JIT.PRIV.ACTIVE.JIT then do;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:52   
     1738    20851    3         B$JIT.ACCN  = VWS_ACCT_JI.ACCT#;
     1739    20852    3         B$JIT.UNAME = 'SCOTTY';
     1740    20853    3         B$JIT.FACCN = VWS_ACCT_JI.ACCT#;
     1741    20854    3         B$JIT.PRIV.ACTIVE = (%PR_JIT#|%PR_FMSEC#);
     1742    20855    3         end;
     1743    20856
     1744    20857        /****
     1745    20858        *
     1746    20859        *   If the mailbox is opened, the last message written is still in
     1747    20860        *   VW_MAILBUF#.  Use this as the subject line and overwrite record
     1748    20861        *   3.000 in the temporary file.
     1749    20862        *
     1750    20863        ****/
     1751    20864
     1752    20865    3      IF MAILPTR->DUMMY.FCD# THEN DO;
     1753    20866    3         VW_MAILKEY#.C=3000;
     1754    20867    3         FITBUF=VW_MAILBUF#;
     1755    20868    3         CALL CONCAT(VW_MAILBUF#,'SUBJECT:',FITBUF);
     1756    20869    3         CALL INDEX(I,'    ',VW_MAILBUF#);
     1757    20870    3         WRITE_MAIL.BUF_.BOUND=I-1;
     1758    20871    3         CALL M$WRITE(WRITE_MAIL);
     1759    20872
     1760    20873        /****
     1761    20874        *
     1762    20875        *   Now close the temp file and link to SEND to do the mail.  We don't
     1763    20876        *   do anything special if SEND aborts.
     1764    20877        *
     1765    20878        ****/
     1766    20879
     1767    20880    3         CALL M$CLOSE(CLOSE_MAIL);
     1768    20881    3         CALL M$LINK(LINK_SEND) ALTRET(CTMF_IGNORE);
     1769    20882    3         END;
     1770    20883
     1771    20884        /****
     1772    20885        *
     1773    20886        *   Now release all the resources we got by doing whatever it was we did.
     1774    20887        *   Otherwise, we wind up "owning" all the packsets on the system and EFT
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:53   
     1775    20888        *   won't run.
     1776    20889        *
     1777    20890        ****/
     1778    20891
     1779    20892    2   CTMF_IGNORE:
     1780    20893    2      VLP_RPSN.NN#=6;
     1781    20894    2      VLP_PRES.NN#=2;
     1782    20895    2      CALL M$DISPRES(FPT_RESCTL) ALTRET(CTMF_ALTRET);
     1783    20896    3      DO I=0 TO VLP_RPSN.NN#-1;
     1784    20897    4         IF VLP_RPSN.RPLIST.PSN#(I)='SYS   ' THEN DO;
     1785    20898    4            VLP_RPSN.RPLIST.PSN#(I)=VLP_RPSN.RPLIST.PSN#(VLP_RPSN.NN#-1);
     1786    20899    4            VLP_RPSN.NN#=VLP_RPSN.NN#-1;
     1787    20900    4            END;
     1788    20901    3         VLP_RPSN.RPLIST.DISP#(I)=2 /* REM */;
     1789    20902    3         END;
     1790    20903    2      IF VLP_RPSN.NN#>0 OR VLP_PRES.NN#>0 THEN
     1791    20904    2         CALL M$RELRES(FPT_RESCTL) ALTRET(CTMF_ALTRET);
     1792    20905
     1793    20906        /****
     1794    20907        *
     1795    20908        *   Ignore any errors from the M$RELRES.
     1796    20909        *
     1797    20910        ****/
     1798    20911
     1799    20912    2   CTMF_ALTRET:
     1800    20913    2      RETURN;
     1801    20914
     1802    20915    2   END;
     1803    20916
     1804    20917        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:54   
     1805    20918    1   CHECK_PACKET: PROC ALTRET;
     1806    20919
     1807    20920        /*I*  NAME: CHECK_PACKET
     1808    20921              DESCRIPTION: This proc is called to ensure that a BEAM or SUCK
     1809    20922                 packet has survived its travels throughout the land of strange
     1810    20923                 character sets without being damaged.  The VWB$BEAM module (B00
     1811    20924                 and later) writes an OPTS record (subtype CHAR) that contains a
     1812    20925                 31-character string which is vulnerable to incorrect character set
     1813    20926                 translation.  Particular trouble spots are the ASCII-to-EBCDIC
     1814    20927                 translation performed during HASP translation, and also unit-record
     1815    20928                 FORM and/or CHAIN translation.
     1816    20929        */
     1817    20930
     1818    20931    2   DCL OPTION UBIN;
     1819    20932    2   DCL OPT$ PTR;
     1820    20933
     1821    20934    3      DO OPTION = 0 TO OPTX - 1;
     1822    20935    3         OPT$ = ADDR(OPTS.OPTSRECS(OPTION));
     1823    20936    3         IF OPT$ -> OPTSCHAR.CMD = 'OPTS'
     1824    20937    3           AND OPT$ -> OPTSCHAR.SUB = 'CHAR'
     1825    20938    4           THEN DO;
     1826    20939    4            IF OPT$ -> OPTSCHAR.PATTERN = %VW_PATTERN#
     1827    20940    4              THEN
     1828    20941    4               RETURN;
     1829    20942    4            BAD_PATTERN.C = OPT$ -> OPTSCHAR.PATTERN;
     1830    20943    4            ALTRETURN;
     1831    20944    4            END;
     1832    20945    3         END;
     1833    20946    2      RETURN;
     1834    20947
     1835    20948    2   END CHECK_PACKET;
     1836    20949        %eject;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:55   
     1837    20950    1   UPDATE_STATUS: proc;
     1838    20951
     1839    20952    3      if B$JIT.PRIV.ACTIVE.JIT then do;
     1840    20953    3         B$JIT.CCBUF = STATUS_LINE;
     1841    20954    3         end;
     1842    20955
     1843    20956    2      return;
     1844    20957
     1845    20958    2   end UPDATE_STATUS;
     1846    20959    1   end VWS$SCOTTY;

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:56   
--  Include file information  --

   B$TABLES_C.:LIB_E05  cannot be made into a system file and is referenced.
   VW_FPTS_M.:VMB6TOU  cannot be made into a system file and is referenced.
   VW_NODEATER_E.:VMB6TOU  is referenced.
   VW_OPTS_M.:VMB6TOU  is referenced.
   VWM_ERRS_E.:VMB6TOU  is referenced.
   VW_MOVE_E.:VMB6TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   AS_SUPER_C.:LIB_E05  is referenced.
   KL_SUPER_C.:LIB_E05  is referenced.
   XUR_ENTRY.:LIB_E05  cannot be made into a system file and is referenced.
   XU_MACRO_C.:LIB_E05  is referenced.
   FM$FIT.:LIB_E05  is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VWS$SCOTTY.

   Procedure VWS$SCOTTY requires 1541 words for executable code.
   Procedure VWS$SCOTTY is declared NOAUTO and requires 3462 words of local(STATIC) storage.

    No errors detected in file VWS$SCOTTY.:VMB6TSI    .

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:57   

 Object Unit name= VWS$SCOTTY                                 File name= VWS$SCOTTY.:VMB6TOU
 UTS= AUG 20 '97 15:49:26.20 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none  3462   6606  VWS$SCOTTY
    1   DCB   even  none     0      0  M$UC
    2  RtLbCm even  none     2      2  ACCT_NODE
    3  RoData even  UTS    153    231  VWS$SCOTTY
    4   DCB   even  none     0      0  M$LM
    5   DCB   even  none     0      0  M$JF
    6   DCB   even  none     0      0  M$JI
    7   DCB   even  none     0      0  M$JE
    8   DCB   even  none     0      0  M$HLP
    9   DCB   even  none     0      0  M$USERS
   10   DCB   even  none     0      0  M$MAIL
   11   DCB   even  none     0      0  M$NODE
   12   Proc  even  none  1541   3005  VWS$SCOTTY
   13  RoData even  none    47     57  VWS$SCOTTY

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    12      0   yes            yes      Main       0  VWS$SCOTTY
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:58   

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      1  VW_OPTIONS#                        0   1664  VWS_ACCT_JI
    0   4306  VW_INPCNT#                         0   4307  VW_OUTCNT#
    0   4310  VW_TOTBYTES#                       0   4311  VW_BROKEN#
    0   6441  VW_IAM#                            0   6443  VW_SCRAMBLE#

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
 yes     yes           Std       3 VWH$HEADER
 yes     yes           Std       1 VWB$BEAM
         yes          Async      0 VWA$ABORT
         yes           Std       1 VWI$TRANSI
 yes     yes           Std       2 XTX$ADAPT
         yes           Std       5 VWX$MAIL
         yes           Std       1 VWO$TRANSO
 yes     yes           Std       3 XUR$INIT
 yes     yes           Std       1 XUR$SETERRMSG
 yes     yes           Std       0 VWE$EVOM
 yes     yes           Std       3 VWF$FOOTER
                       nStd      0 X66_MSTATIC
                       nStd      0 X66_MSRET
                       nStd      0 X66_INDEX
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:59   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    B$SR_NON_BLANK$                       M$LM
     M$JF                                  M$JI                                  M$JE
     M$HLP                                 M$USERS                               M$MAIL
     M$NODE                                B$TCB$                                B$JIT$
     VW_MAILBUF#                           VW_MAILKEY#                      r    B_VERSION
     VW_OPERERR#

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:60   


        1        1        /*M* VWS$SCOTTY - File transporter ghost. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC, PLM=3, CTI=2, CSI=2, ECI=2, MCI=YES, SDI=6, THI=2 */
        8        8        /*F**
        9        9        *
       10       10        *   NAME:  VWS$SCOTTY
       11       11        *
       12       12        *   PURPOSE:
       13       13        *       To handle remotely-initiated file transfer requests.
       14       14        *
       15       15        *   DESCRIPTION:
       16       16        *       SCOTTY acts as the "catcher" for BEAMed files and as the "thrower"
       17       17        *       for SUCKed files.  It also acts as a message switch for files that
       18       18        *       pass through a node on their way to another.
       19       19        *
       20       20        *   REFERENCE:
       21       21        *       See the appropriate Architecture File document for a description
       22       22        *       of MOVE and SCOTTY.
       23       23        *
       24       24        ****/
       25       25
       26       26        /*D**
       27       27        *
       28       28        *   NAME:  VWS$SCOTTY
       29       29        *
       30       30        *   CALL:
       31       31        *       Main program.
       32       32        *
       33       33        *   PARAMETERS:
       34       34        *       None.
       35       35        *
       36       36        *   INTERFACE:
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:61   
       37       37        *       SCOTTY calls VWE$EVOM, VWB$BEAM, VWX$MAIL (SCOTTY's version),
       38       38        *       VWH$HEADER, VWF$FOOTER, VWI$TRANSI, VWO$TRANSO, VWA$ABORT,
       39       39        *       DAM$INIT, DAM$MAP, and the XUR$ routines.  The wildcarder is
       40       40        *       also used by VWB$BEAM.
       41       41        *
       42       42        *   ENVIRONMENT:
       43       43        *       SCOTTY must run as a ghost from .:SYS, as it must have JIT access
       44       44        *       privilege.  It uses this privilege to modify its JIT with user
       45       45        *       logon information and privileges, thus performing a crude version
       46       46        *       of SLUG processes.  This preserves file security.
       47       47        *
       48       48        *   INPUT:
       49       49        *       Files are read and processed from .:MOVE until end-of-account.
       50       50        *       SCOTTY then sleeps for a minute and looks for more work to do.
       51       51        *
       52       52        *   OUTPUT:
       53       53        *       None, although disastrous errors may cause a PMD dump and/or
       54       54        *       an operator's console message.
       55       55        *
       56       56        *   SCRATCH:
       57       57        *       None.
       58       58        *
       59       59        *   DESCRIPTION:
       60       60        *       SCOTTY runs as a ghost on all interconnected machines using the
       61       61        *       MOVE facility.  It acts as the "catcher" for BEAMs and the
       62       62        *       transmitter for SUCKs.
       63       63        *
       64       64        *       To avoid security holes, SCOTTY assumes the user's logon
       65       65        *       identity when fetching or creating a file.  If the user has not
       66       66        *       supplied a valid logon account, name, and password, the file
       67       67        *       cannot be fetched or stowed.  Also, if the user does not
       68       68        *       normally have access to the file in question, access will be
       69       69        *       denied by the file management system.  FMS is turned on IF the
       70       70        *       user is authorized for FMS.
       71       71        *
       72       72        *       Mail may be created in sender or receiver mailboxes.
       73       73        *
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:62   
       74       74        *       SCOTTY must (a) run as a ghost, (b) run in :SYS, and (c) have
       75       75        *       JIT access.  It also needs to access :HLP.:SYS and :USERS.:SYS
       76       76        *       to validate logons.  Files are !NCTL files read from account
       77       77        *       :MOVE, which must be on a packset which is always present,
       78       78        *       such as #SYS.  SCOTTY and INSYM must have WRITE access to
       79       79        *       :MOVE.
       80       80        *
       81       81        *       If SCOTTY finds an operational error, the message is written
       82       82        *       via M$LO, which should default to LP@LOCAL.
       83       83        *
       84       84        ****/
       85       85
       86       86        VWS$SCOTTY: PROC MAIN NOAUTO;

     86 12 000000   000000 700200 xent  VWS$SCOTTY   TSX0  ! X66_MSTATIC
        12 000001   000000 000000 0                  ZERO    0,0

       87       87
       88       88        /****
       89       89        *
       90       90        *   %INCLUDEs
       91       91        *
       92       92        ****/
       93       93
       94       94        %INCLUDE CP_6;
       95     5653        %INCLUDE CP_6_SUBS;
       96     6193        %INCLUDE B$JIT;
       97     6796        %INCLUDE FM$FIT;
       98     7017        %INCLUDE XU_MACRO_C;
       99    10123        %INCLUDE XUR_ENTRY;
      100    10155        %INCLUDE KL_SUPER_C;
      101    13057        %INCLUDE AS_SUPER_C;
      102    13492        %INCLUDE B_ERRORS_C;
      103    14619        %INCLUDE VW_MOVE_E;
      104    14697        %INCLUDE VWM_ERRS_E;
      105    15071        %INCLUDE VW_OPTS_M;
      106    15755        %MOVE_OPTIONS(STCLASS="STATIC SYMDEF");
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:63   
      107    16258        %INCLUDE VW_NODEATER_E;
      108    16314        %INCLUDE VW_FPTS_M;
      109    16735           %include B$TABLES_C;
      110    16843        %B$SR_NON_BLANK;
      111    16847
      112    16848        /****
      113    16849        *
      114    16850        *   FPTs
      115    16851        *
      116    16852        ****/
      117    16853
      118    16854        %FPT_OPEN(FPTN=OPEN_MAILBOX,
      119    16855                  DCB=M$MAIL,
      120    16856                  ASN=FILE,
      121    16857                  NAME=NAME_MAILBOX,
      122    16858                  FUN=IN,
      123    16859                  EXIST=OLDFILE,
      124    16860                  TEST=YES);
      125    16969
      126    16970        %VLP_NAME(FPTN=NAME_MAILBOX,
      127    16971                  NAME=':MAIL_CENTRAL');
      128    16998
      129    16999        %FPT_OPEN(FPTN=OPEN_MAIL,
      130    17000                  DCB=M$MAIL,
      131    17001                  ASN=FILE,
      132    17002                  NAME=NAME_MAIL,
      133    17003                  FUN=CREATE,
      134    17004                  EXIST=NEWFILE,
      135    17005                  ORG=KEYED,
      136    17006                  ACS=DIRECT,
      137    17007                  SCRUB=YES);
      138    17116
      139    17117        %VLP_NAME(FPTN=NAME_MAIL,
      140    17118                  LEN=9,
      141    17119                  NAME='*MOVEMAIL');
      142    17146
      143    17147        %FPT_WRITE(FPTN=WRITE_MAIL,
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:64   
      144    17148                   DCB=M$MAIL,
      145    17149                   KEY=VW_MAILKEY#,
      146    17150                   ONEWKEY=YES,
      147    17151                   BUF=VW_MAILBUF#);
      148    17182
      149    17183        %FPT_CLOSE(FPTN=CLOSE_MAIL,
      150    17184                   DCB=M$MAIL,
      151    17185                   DISP=SAVE);
      152    17227
      153    17228        %FPT_OPEN(FPTN=OPEN_JF,
      154    17229                  DCB=M$JF,
      155    17230                  ASN=DEVICE,
      156    17231                  FUN=CREATE,
      157    17232                  EXIST=NEWFILE,
      158    17233                  RES='JF  ');
      159    17342
      160    17343        %FPT_WRITE(FPTN=WRITE_JF,
      161    17344                   DCB=M$JF,
      162    17345                   BUF=JIBUF);
      163    17376
      164    17377        %FPT_CLOSE(FPTN=CLOSE_JF,
      165    17378                   DCB=M$JF,
      166    17379                   DISP=SAVE);
      167    17421
      168    17422        %FPT_OPEN(FPTN=OPEN_JI,
      169    17423                  DCB=M$JI,
      170    17424                  NAME=NAME_JI,
      171    17425                  NXTF=YES,
      172    17426                  THISF=NO,
      173    17427                  ACCT=VWS_ACCT_JI,
      174    17428                  PASS=PASS_JI,
      175    17429                  FUN=IN,
      176    17430                  FPARAM=FITBUF,
      177    17431                  SCRUB=YES,
      178    17432                  ASN=FILE);
      179    17541
      180    17542        %VLP_NAME(FPTN=NAME_JI,
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:65   
      181    17543                  LEN=31,
      182    17544                  NAME='MOVE                           ');
      183    17571
      184    17572        %VLP_ACCT(FPTN=VWS_ACCT_JI,
      185    17573                  STCLASS="STATIC SYMDEF",
      186    17574                  ACCT=':MOVE   ');
      187    17587
      188    17588        %VLP_PASS(FPTN=PASS_JI,
      189    17589                  STCLASS=CONSTANT,
      190    17590                  PASS='Montgmry');
      191    17603
      192    17604        %FPT_READ(FPTN=READ_JI,
      193    17605                  DCB=M$JI,
      194    17606                  BUF=JIBUF);
      195    17645
      196    17646        %FPT_PRECORD(FPTN=PRECORD_JI,
      197    17647                     DCB=M$JI,
      198    17648                     N=-1);
      199    17669
      200    17670        %FPT_CLOSE(FPTN=CLOSE_JI,
      201    17671                   DCB=M$JI,
      202    17672                   DISP=RELEASE);
      203    17714
      204    17715        %FPT_OPEN(FPTN=OPEN_HLP,
      205    17716                  DCB=M$HLP,
      206    17717                  NAME=NAME_HLP,
      207    17718                  ACCT=ACCT_HLP,
      208    17719                  FUN=IN,
      209    17720                  ACS=DIRECT,
      210    17721                  SHARE=ALL,
      211    17722                  ASN=FILE);
      212    17831
      213    17832        %VLP_NAME(FPTN=NAME_HLP,
      214    17833                  LEN=4,
      215    17834                  NAME=':HLP');
      216    17861
      217    17862        %VLP_ACCT(FPTN=ACCT_HLP,
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:66   
      218    17863                  ACCT=':SYS    ');
      219    17876
      220    17877        %FPT_READ(FPTN=READ_HLP,
      221    17878                  DCB=M$HLP,
      222    17879                  BUF=HLPBUF,
      223    17880                  KEYS=YES,
      224    17881                  KEY=ACCTNAME);
      225    17920
      226    17921        %FPT_CLOSE(FPTN=CLOSE_HLP,
      227    17922                   DCB=M$HLP,
      228    17923                   DISP=SAVE);
      229    17965
      230    17966        %FPT_OPEN(FPTN=OPEN_USERS,
      231    17967                  DCB=M$USERS,
      232    17968                  NAME=NAME_USERS,
      233    17969                  ACCT=ACCT_USERS,
      234    17970                  FUN=UPDATE,
      235    17971                  ACS=DIRECT,
      236    17972                  SHARE=ALL,
      237    17973                  ASN=FILE);
      238    18082
      239    18083        %VLP_NAME(FPTN=NAME_USERS,
      240    18084                  LEN=6,
      241    18085                  NAME=':USERS');
      242    18112
      243    18113        %VLP_ACCT(FPTN=ACCT_USERS,
      244    18114                  ACCT=':SYS    ');
      245    18127
      246    18128        %FPT_ENQ(FPTN=ENQ_USERS,
      247    18129                 DCB=M$USERS,
      248    18130                 RNAME=ACCTNAME,
      249    18131                 SHARE=NONE);
      250    18149
      251    18150        %FPT_DEQ(FPTN=DEQ_USERS,
      252    18151                 DCB=M$USERS);
      253    18168
      254    18169        %FPT_READ(FPTN=READ_USERS,
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:67   
      255    18170                  DCB=M$USERS,
      256    18171                  BUF=USERSBUF,
      257    18172                  KEYS=YES,
      258    18173                  KEY=ACCTNAME);
      259    18212
      260    18213        %FPT_WRITE(FPTN=WRITE_USERS,
      261    18214                   DCB=M$USERS,
      262    18215                   BUF=USERSBUF,
      263    18216                   KEY=ACCTNAME);
      264    18247
      265    18248        %FPT_TRUNC(FPTN=TRUNC_USERS,
      266    18249                   DCB=M$USERS);
      267    18263
      268    18264        %FPT_CLOSE(FPTN=CLOSE_USERS,
      269    18265                   DCB=M$USERS,
      270    18266                   DISP=SAVE);
      271    18308
      272    18309        %FPT_OPEN(FPTN=OPEN_JE,
      273    18310                  DCB=M$JE,
      274    18311                  ASN=DEVICE,
      275    18312                  WSN=WSN_JE,
      276    18313                  SCRUB=YES,
      277    18314                  RES='JE  ',
      278    18315                  FUN=CREATE,
      279    18316                  EXIST=OLDFILE,
      280    18317                  ORG=CONSEC);
      281    18426
      282    18427        %VLP_WSN(FPTN=WSN_JE,
      283    18428                 WSN='        ');
      284    18441
      285    18442        %FPT_WRITE(FPTN=WRITE_JE,
      286    18443                   DCB=M$JE,
      287    18444                   BUF=JEBUF);
      288    18475
      289    18476        %FPT_CLOSE(FPTN=CLOSE_JE,
      290    18477                   DCB=M$JE,
      291    18478                   DISP=SAVE);
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:68   
      292    18520
      293    18521        %FPT_WAIT(FPTN=SLEEP,
      294    18522                  UNITS=60);
      295    18536
      296    18537        %FPT_WAIT(FPTN=SNOOZE,
      297    18538                  UNITS=5);
      298    18552
      299    18553        %FPT_TIME(FPTN=LOGON_TIME,
      300    18554                  SOURCE=CLOCK,
      301    18555                  DEST=UTS,
      302    18556                  TSTAMP=LOGON_UTS);
      303    18575
      304    18576        %FPT_LINK(FPTN=LINK_SEND,
      305    18577                  CP_CMD=CMD_LINK);
      306    18595
      307    18596        %FPT_LDTRC(FPTN=LINK_TO_NEW_SCOTTY);
      308    18614
      309    18615        %FPT_RESCTL(RPSN=VLP_RPSN,
      310    18616                    PRES=VLP_PRES);
      311    18633
      312    18634        %VLP_RPSN(N=6);
      313    18649
      314    18650        %VLP_PRES(N=2);
      315    18666
      316    18667        %FPT_ENQ   (FPTN=ENQ_ON_NODES,
      317    18668                    DCB=M$NODE,
      318    18669                    RNAME=WHO_AM_I,
      319    18670                    SHARE=NONE,
      320    18671                    WAIT=YES,
      321    18672                    WAIT_TIME=0);
      322    18690
      323    18691        %FPT_OLAY(FPTN=KILL_VWB$BEAM,
      324    18692                  CANCEL=YES,
      325    18693                  ONAME=NAME_VWB$BEAM);
      326    18709
      327    18710        %VLP_NAME(FPTN=NAME_VWB$BEAM,
      328    18711                  NAME='VWB$BEAM');
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:69   
      329    18738
      330    18739        %FPT_OLAY(FPTN=KILL_VWE$EVOM,
      331    18740                  CANCEL=YES,
      332    18741                  ONAME=NAME_VWE$EVOM);
      333    18757
      334    18758        %VLP_NAME(FPTN=NAME_VWE$EVOM,
      335    18759                  NAME='VWE$EVOM');
      336    18786
      337    18787        %FPT_XCON(FPTN=FPT_XCON1,
      338    18788                  UENTRY=VWA$ABORT);
      339    18802
      340    18803        %FPT_XCON(FPTN=FPT_XCON2,
      341    18804                  UENTRY=NIL);
      342    18818
      343    18819        %F$DCB(DCBN=DUMMY);
      344    18876
      345    18877        %B$TCB;
      346    18880
      347    18881        %B$ALT;
      348    18889
      349    18890        %FM$FIT;
      350    18893
      351    18894        %MACRO FS$JOBORIG (NAME=FS$JOBORIG,STCLASS=BASED,
      352    18895          SIZ(FIT=",2 SIZ UBIN",NAWNDW=",2 NAW UBIN HALF UNAL,2 NDW UBIN HALF UNAL")=);
      353    18896        /* FS$JOBORIG is UATTR for jobs being batched */
      354    18897        DCL 1 NAME STCLASS ALIGNED SIZ,
      355    18898        /*  ORIGINATOR_PORT.FROM_CR/FROM_GHOST/FROM_INT are of historical interest:   */
      356    18899        /*  they contain information concerning the very first card reader,           */
      357    18900        /*  ghost user, or online user who submitted a job stream which               */
      358    18901        /*  eventuated in the creation of this job.  See ORIGINATOR_MODE below.       */
      359    18902                  2 ORIGINATOR_PORT,
      360    18903                        3 FROM_CR,              /* Originator info if from a CR       */
      361    18904                              4 DEVICE CHAR(4), /* Device of origin                   */
      362    18905                              4 TNAME CHAR(8),  /* TNAME of device of origin          */
      363    18906                        3 FROM_GHOST REDEF FROM_CR, /* Originator info if from a ghost   */
      364    18907                            4 SYSID UBIN HALF UNAL, /* SYSID of ghost originator         */
      365    18908                              4 * CHAR(10),
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:70   
      366    18909                        3 FROM_INT REDEF FROM_CR, /* Originator info if from INT user   */
      367    18910        /*  The following TSLINE structure is lifted from B$JIT.TSLINE.               */
      368    18911                              4 TSLINE,
      369    18912                                    5 FEX UBIN(9) UNAL,
      370    18913                                    5 SPEED UBIN(9) UNAL,
      371    18914                                    5 PORT UBIN(18) UNAL,
      372    18915                                    5 LEV UBIN BYTE UNAL,
      373    18916                                    5 TTYP UBIN BYTE UNAL,
      374    18917                                    5 SUBDEVICE UBIN(18) UNAL,
      375    18918                                    5 SUBSUBDEVICE UBIN(18) UNAL,
      376    18919                                    5 * UBIN(18) UNAL,
      377    18920                  2 WOO CHAR(8),                /* WSN of origin                      */
      378    18921                  2 SYSID UBIN(18) UNAL,        /* SYSID of originator                */
      379    18922                  2 MAXPRI UBIN BYTE UNAL,      /* Maximum batching PRIO              */
      380    18923                  2 DEFPRI UBIN BYTE UNAL,      /* Default batching PRIO              */
      381    18924                  2 FLAG UBIN BYTE UNAL,        /* JIT.MODE if !BATCHed;              */
      382    18925                                                /* JOBORIG if from card reader        */
      383    18926                  2 ORIGINATOR_MODE UBIN(4) UNAL, /* See B$JIT.ORIGINATOR_MODE          */
      384    18927                  2 * UBIN;
      385    18928        %MEND;
      386    18929
      387    18930        %FS$JOBORIG;
      388    18964
      389    18965        %XUR_INIT;
      390    19064
      391    19065        %AS_USERS(STR_NAME=USERSBUF,
      392    19066                  STCLASS=STATIC);
      393    19244
      394    19245        %KL_DREC(NAME=HLPBUF,LAST=",");
      395    19358
      396    19359        %KL_FEBLK(LVL=2,STCLASS=STATIC,RCNT=31);
      397    19408
      398    19409        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:71   
      399    19410        /****
      400    19411        *
      401    19412        *   Local variables
      402    19413        *
      403    19414        ****/
      404    19415
      405    19416    1   DCL M$LM                           DCB;
      406    19417    1   DCL M$JF                           DCB;
      407    19418    1   DCL M$JI                           DCB;
      408    19419    1   DCL M$JE                           DCB;
      409    19420    1   DCL M$HLP                          DCB;
      410    19421    1   DCL M$USERS                        DCB;
      411    19422    1   DCL M$MAIL                         DCB;
      412    19423    1   DCL M$NODE                         DCB;
      413    19424
      414    19425    1   DCL B$TCB$ SYMREF                  PTR;
      415    19426    1   DCL B$JIT$ SYMREF                  PTR;
      416    19427    1   DCL JIPTR                          PTR;
      417    19428    1   DCL JEPTR                          PTR;
      418    19429    1   DCL MAILPTR                        PTR;
      419    19430    1   DCL P                              PTR;
      420    19431    1   DCL OPTX                           SBIN;
      421    19432
      422    19433    1   DCL I                              SBIN;
      423    19434    1   DCL J                              SBIN;
      424    19435    1   DCL K                              SBIN;
      425    19436    1   DCL ARS                            SBIN;
      426    19437    1   DCL VW_INPCNT# STATIC SYMDEF       SBIN;
      427    19438    1   DCL VW_OUTCNT# STATIC SYMDEF       SBIN;
      428    19439    1   DCL VW_TOTBYTES# STATIC SYMDEF     SBIN;
      429    19440    1   DCL VW_BROKEN# STATIC SYMDEF       SBIN;
      430    19441    1   DCL ERRDCB                         SBIN;
      431    19442    1   DCL LOGON_UTS                      UBIN;
      432    19443
      433    19444    1   DCL ERRCODE                        UBIN;
      434    19445    1   DCL 1 ERRBITS REDEF ERRCODE,
      435    19446    1             2 FCG                        UNAL BIT(18),
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:72   
      436    19447    1             2 M                          UNAL BIT(1),
      437    19448    1             2 CODE                       UNAL UBIN(14),
      438    19449    1             2 SEV                        UNAL UBIN(3);
      439    19450
      440    19451    1   DCL STATUS_LINE STATIC             CHAR(80);
      441    19452    1   DCL JIBUF STATIC                   CHAR(80);
      442    19453    1   DCL JEBUF STATIC                   CHAR(80);
      443    19454    1   DCL FITBUF STATIC                  CHAR(4096);
      444    19455    1   DCL VW_MAILBUF# SYMREF             CHAR(144);
      445    19456    1   DCL 1 VW_MAILKEY# SYMREF,
      446    19457    1             2 L UNAL                     UBIN BYTE,
      447    19458    1             2 C UNAL                     UBIN(27);
      448    19459
      449    19460    1   DCL 1 ACCTNAME STATIC,
      450    19461    1             2 L                          UNAL UBIN BYTE,
      451    19462    1             2 ACCT                       UNAL CHAR(8),
      452    19463    1             2 NAME                       UNAL CHAR(12);
      453    19464
      454    19465    1   DCL 1 ERRMSGFID CONSTANT,
      455    19466    1             2 L UNAL                     UBIN BYTE INIT(15),
      456    19467    1             2 C UNAL                     CHAR(39) INIT(':VWERRMSG.:SYS');
      457    19468
      458    19469    1   DCL 1 CMD_LINK CONSTANT,
      459    19470    1             2 * UNAL                     UBIN BYTE INIT(79),
      460    19471    1             2 * UNAL                     CHAR(79) INIT
      461    19472    1               ('SEND *MOVEMAIL');
      462    19473
      463    19474    1   DCL 1 WHO_AM_I STATIC,
      464    19475    1             2 L# UBIN BYTE CALIGNED,
      465    19476    1             2 NAME# CHAR(31);
      466    19477
      467    19478    1   DCL 1 B_VERSION SYMREF READONLY,
      468    19479    1             2 L# UBIN BYTE CALIGNED,
      469    19480    1             2 NAME# CHAR(B_VERSION.L#) CALIGNED;
      470    19481
      471    19482    1   DCL 1 GOOD_PATTERN CONSTANT,
      472    19483    1             2 L UBIN BYTE CALIGNED INIT (31),
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:73   
      473    19484    1             2 C CHAR (31) INIT (%VW_PATTERN#);
      474    19485
      475    19486    1   DCL 1 BAD_PATTERN AUTO,
      476    19487    1             2 L UBIN BYTE CALIGNED,
      477    19488    1             2 C CHAR (31);
      478    19489
      479    19490
      480    19491    1   DCL PASSWORD                       CHAR(8);
      481    19492    1   DCL BIT6(0:11) REDEF PASSWORD UNAL UBIN(6);
      482    19493    1   DCL VW_IAM# STATIC SYMDEF          CHAR(8);
      483    19494
      484    19495    1   DCL VW_SCRAMBLE# STATIC SYMDEF     BIT(1);
      485    19496    1   DCL VW_OPERERR# SYMREF             BIT(1);
      486    19497
      487    19498    1   DCL VWE$EVOM                       ENTRY ALTRET;
      488    19499    1   DCL VWB$BEAM                       ENTRY(1) ALTRET;
      489    19500    1   DCL VWX$MAIL                       ENTRY(5);
      490    19501    1   DCL VWH$HEADER                     ENTRY(3) ALTRET;
      491    19502    1   DCL VWF$FOOTER                     ENTRY(3) ALTRET;
      492    19503    1   DCL VWI$TRANSI                     ENTRY(1);
      493    19504    1   DCL VWO$TRANSO                     ENTRY(1);
      494    19505    1   DCL VWA$ABORT                      ENTRY ASYNC;
      495    19506
      496    19507        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:74   
      497    19508        /****
      498    19509        *
      499    19510        *   Sleep for awhile; upon awakening, reset the file name for JI
      500    19511        *   to null and open the next file in .:MOVE, if any.  At end, go
      501    19512        *   back to sleep.  Read the file found into VW_OPTIONS#, checking that
      502    19513        *   it looks legal.  Open MAIL appropriately, then call BEAM or
      503    19514        *   SUCK or a packet switching routine called POST.
      504    19515        *
      505    19516        ****/
      506    19517
      507    19518    1      CALL XUR$INIT(XUR_INIT);

  19518 12 000002   000001 630400 13                 EPPR0   1
        12 000003   000000 631400 13                 EPPR1   0
        12 000004   000000 701000 xent               TSX1    XUR$INIT
        12 000005   000000 011000                    NOP     0

      508    19519    1      CALL XUR$SETERRMSG(ERRMSGFID);

  19519 12 000006   000002 630400 13                 EPPR0   2
        12 000007   000000 631400 13                 EPPR1   0
        12 000010   000000 701000 xent               TSX1    XUR$SETERRMSG
        12 000011   000000 011000                    NOP     0

      509    19520
      510    19521        /****
      511    19522        *
      512    19523        *   Don't run if we're not a ghost.  If we are, initialize the DCB
      513    19524        *   pointers, then set up stuff in the JIT.  If we don't have JIT
      514    19525        *   access, we'll bomb here pretty quick.
      515    19526        *
      516    19527        ****/
      517    19528
      518    19529    1   RESTART:
      519    19530    1      IF B$JIT.MODE~=%M_GHOST# THEN

  19530 12 000012   000000 470400 xsym  RESTART      LDP0    B$JIT$
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:75   
        12 000013   000000 236100                    LDQ     0,,PR0
        12 000014   740000 376003                    ANQ     -16384,DU
        12 000015   100000 116003                    CMPQ    32768,DU
        12 000016   000020 600000 12                 TZE     s:19532

      520    19531    1         RETURN;

  19531 12 000017   000000 702200 xent               TSX2  ! X66_MSRET

      521    19532    1      CALL M$XCON(FPT_XCON1);

  19532 12 000020   002734 630400 0                  EPPR0   FPT_XCON1
        12 000021   010003 713400                    CLIMB   4099
        12 000022   400400 401760                    pmme    nvectors=2

      522    19533    1      JIPTR=DCBADDR(DCBNUM(M$JI));

  19533 12 000023   000000 236007 xsym               LDQ     M$JI,DL
        12 000024   000003 470400 13                 LDP0    3
        12 000025   000000 471500                    LDP1    0,,PR0
        12 000026   100000 236106                    LDQ     0,QL,PR1
        12 000027   004275 756000 0                  STQ     JIPTR

      523    19534    1      JEPTR=DCBADDR(DCBNUM(M$JE));

  19534 12 000030   000000 236007 xsym               LDQ     M$JE,DL
        12 000031   100000 236106                    LDQ     0,QL,PR1
        12 000032   004276 756000 0                  STQ     JEPTR

      524    19535    1      MAILPTR=DCBADDR(DCBNUM(M$MAIL));

  19535 12 000033   000000 236007 xsym               LDQ     M$MAIL,DL
        12 000034   100000 236106                    LDQ     0,QL,PR1
        12 000035   004277 756000 0                  STQ     MAILPTR

      525    19536    2      if B$JIT.PRIV.ACTIVE.JIT then do;

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:76   
  19536 12 000036   000000 473400 xsym               LDP3    B$JIT$
        12 000037   300013 236100                    LDQ     11,,PR3
        12 000040   000040 316007                    CANQ    32,DL
        12 000041   000050 600000 12                 TZE     s:19548

      526    19537    2         B$JIT.PRIV.ACTIVE = (%PR_JIT#|%PR_SPCLMM#);

  19537 12 000042   000111 236000 3                  LDQ     GOOD_PATTERN+8
        12 000043   000112 276000 3                  ORQ     GOOD_PATTERN+9
        12 000044   300013 756100                    STQ     11,,PR3

      527    19538    2         B$JIT.PRIV.AUTH   = (B$JIT.PRIV.AUTH|%PR_SPCLMM#);

  19538 12 000045   300014 236100                    LDQ     12,,PR3
        12 000046   000112 276000 3                  ORQ     GOOD_PATTERN+9
        12 000047   300014 756100                    STQ     12,,PR3

      528    19539    2         end;

      529    19540
      530    19541        /****
      531    19542        *
      532    19543        *   Find out who I am by reading the *IAM record from :NODES.  Leave :NODES
      533    19544        *   open so that nobody can change it on us without our knowledge.
      534    19545        *
      535    19546        ****/
      536    19547
      537    19548    1      CALL M$OPEN(OPEN_NODE) ALTRET(BAD_NOD);

  19548 12 000050   000766 630400 0                  EPPR0   OPEN_NODE
        12 000051   450000 713400                    CLIMB   alt,open
        12 000052   410400 401760                    pmme    nvectors=18
        12 000053   000757 702000 12                 TSX2    BAD_NOD

      538    19549    1      NODEKEY.L=8;

  19549 12 000054   010000 236003                    LDQ     4096,DU
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:77   
        12 000055   001136 552040 0                  STBQ    NODEKEY,'40'O

      539    19550    1      NODEKEY.C='*IAM';

  19550 12 000056   040000 100400                    MLR     fill='040'O
        12 000057   000113 000004 3                  ADSC9   GOOD_PATTERN+10          cn=0,n=4
        12 000060   001136 200010 0                  ADSC9   NODEKEY                  cn=1,n=8

      540    19551    1      CALL M$READ(READ_NODE) ALTRET(BAD_NOD);

  19551 12 000061   001062 630400 0                  EPPR0   READ_NODE
        12 000062   440000 713400                    CLIMB   alt,read
        12 000063   401400 401760                    pmme    nvectors=4
        12 000064   000757 702000 12                 TSX2    BAD_NOD

      541    19552    1      VW_IAM#=NODEOVR.PATH_NAME;

  19552 12 000065   040000 100400                    MLR     fill='040'O
        12 000066   001141 000010 0                  ADSC9   NODEOVR                  cn=0,n=8
        12 000067   006441 000010 0                  ADSC9   VW_IAM#                  cn=0,n=8

      542    19553
      543    19554        /****
      544    19555        *
      545    19556        *   Make sure I'm the only SCOTTY running by issuing an M$ENQ on the :NODES
      546    19557        *   file, specifying a resource name of "Scotty XXX".
      547    19558        *
      548    19559        ****/
      549    19560
      550    19561    1      CALL CONCAT (WHO_AM_I.NAME#, 'Scotty ', B_VERSION.NAME#);

  19561 12 000070   000000 236000 xsym               LDQ     B_VERSION
        12 000071   000033 772000                    QRL     27
        12 000072   040000 100400                    MLR     fill='040'O
        12 000073   000114 000007 3                  ADSC9   GOOD_PATTERN+11          cn=0,n=7
        12 000074   006417 200007 0                  ADSC9   WHO_AM_I                 cn=1,n=7
        12 000075   000000 620006                    EAX0    0,QL
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:78   
        12 000076   040000 100440                    MLR     fill='040'O
        12 000077   000000 200010 xsym               ADSC9   B_VERSION                cn=1,n=*X0
        12 000100   006421 000030 0                  ADSC9   WHO_AM_I+2               cn=0,n=24

      551    19562    1      WHO_AM_I.L# = MINIMUM (B_VERSION.L# + LENGTHC('Scotty '),

  19562 12 000101   000000 236000 xsym               LDQ     B_VERSION
        12 000102   000033 772000                    QRL     27
        12 000103   000007 036007                    ADLQ    7,DL
        12 000104   000037 116007                    CMPQ    31,DL
        12 000105   000110 602000 12                 TNC     s:19562+7
        12 000106   000110 600000 12                 TZE     s:19562+7
        12 000107   000037 236007                    LDQ     31,DL
        12 000110   000033 736000                    QLS     27
        12 000111   006417 552040 0                  STBQ    WHO_AM_I,'40'O

      552    19563    1        LENGTHC(WHO_AM_I.NAME#));
      553    19564    1      CALL M$ENQ (ENQ_ON_NODES)

  19564 12 000112   002676 630400 0                  EPPR0   ENQ_ON_NODES
        12 000113   420002 713400                    CLIMB   alt,+8194
        12 000114   401000 401760                    pmme    nvectors=3
        12 000115   000117 702000 12                 TSX2    s:19566
        12 000116   000120 710000 12                 TRA     s:19580

      554    19565    2        WHENALTRETURN DO;

      555    19566    2         RETURN;

  19566 12 000117   000000 702200 xent               TSX2  ! X66_MSRET

      556    19567    2         END;
      557    19568
      558    19569        /****
      559    19570        *
      560    19571        *   Check to see that :MAIL_CENTRAL.:MOVE exists.  If it
      561    19572        *   doesn't, create it.  This isn't easy:  We must write the
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:79   
      562    19573        *   proper commands to JF, then go to EOJ.  MAIL will then be
      563    19574        *   invoked to create the mailbox.  Then we'll recall ourself
      564    19575        *   and get back here again.  If we get here twice and there's
      565    19576        *   no :MAIL_CENTRAL.:MOVE, bomb!
      566    19577        *
      567    19578        ****/
      568    19579
      569    19580    2      if B$JIT.PRIV.ACTIVE.JIT then do;

  19580 12 000120   000000 470400 xsym               LDP0    B$JIT$
        12 000121   000013 236100                    LDQ     11,,PR0
        12 000122   000040 316007                    CANQ    32,DL
        12 000123   000131 600000 12                 TZE     s:19584

      570    19581    2         B$JIT.ACCN  = VWS_ACCT_JI.ACCT#;

  19581 12 000124   001664 237000 0                  LDAQ    VWS_ACCT_JI
        12 000125   000001 755100                    STA     1,,PR0
        12 000126   000002 756100                    STQ     2,,PR0

      571    19582    2         B$JIT.FACCN = VWS_ACCT_JI.ACCT#;

  19582 12 000127   001664 237000 0                  LDAQ    VWS_ACCT_JI
        12 000130   000006 757100                    STAQ    6,,PR0

      572    19583    2         end;

      573    19584    2      CALL M$OPEN(OPEN_MAILBOX) WHENALTRETURN DO;

  19584 12 000131   001150 630400 0                  EPPR0   OPEN_MAILBOX
        12 000132   450000 713400                    CLIMB   alt,open
        12 000133   410400 401760                    pmme    nvectors=18
        12 000134   000136 702000 12                 TSX2    s:19585
        12 000135   000266 710000 12                 TRA     s:19617

      574    19585    3         IF B$JIT.JOBNAME=WHO_AM_I.NAME# THEN DO;

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:80   
  19585 12 000136   000000 470400 xsym               LDP0    B$JIT$
        12 000137   040000 106500                    CMPC    fill='040'O
        12 000140   000156 200037                    ADSC9   110,,PR0                 cn=1,n=31
        12 000141   006417 200037 0                  ADSC9   WHO_AM_I                 cn=1,n=31
        12 000142   000150 601000 12                 TNZ     s:19589

      575    19586    3            CALL M$XCON(FPT_XCON2);

  19586 12 000143   002742 630400 0                  EPPR0   FPT_XCON2
        12 000144   010003 713400                    CLIMB   4099
        12 000145   400400 401760                    pmme    nvectors=2

      576    19587    3            CALL M$XXX;

  19587 12 000146   000003 713400                    CLIMB   3
        12 000147   000000 401760                    pmme    nvectors=0

      577    19588    3            END;

      578    19589    2         if B$JIT.PRIV.ACTIVE.JIT

  19589 12 000150   000000 470400 xsym               LDP0    B$JIT$
        12 000151   000013 236100                    LDQ     11,,PR0
        12 000152   000040 316007                    CANQ    32,DL
        12 000153   000157 600000 12                 TZE     s:19591

      579    19590    2           then B$JIT.JOBNAME=WHO_AM_I.NAME#;

  19590 12 000154   040100 100400                    MLR     fill='040'O
        12 000155   006417 200037 0                  ADSC9   WHO_AM_I                 cn=1,n=31
        12 000156   000156 200037                    ADSC9   110,,PR0                 cn=1,n=31

      580    19591    2         CALL M$OPEN(OPEN_JF);

  19591 12 000157   001416 630400 0                  EPPR0   OPEN_JF
        12 000160   050000 713400                    CLIMB   open
        12 000161   410400 401760                    pmme    nvectors=18
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:81   

      581    19592    2         JIBUF='!MAIL';

  19592 12 000162   040000 100400                    MLR     fill='040'O
        12 000163   000116 000005 3                  ADSC9   GOOD_PATTERN+13          cn=0,n=5
        12 000164   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

      582    19593    2         CALL M$WRITE(WRITE_JF);

  19593 12 000165   001510 630400 0                  EPPR0   WRITE_JF
        12 000166   040001 713400                    CLIMB   write
        12 000167   401400 401760                    pmme    nvectors=4

      583    19594    2         JIBUF='CREATE FOLDER';

  19594 12 000170   040000 100400                    MLR     fill='040'O
        12 000171   000120 000015 3                  ADSC9   GOOD_PATTERN+15          cn=0,n=13
        12 000172   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

      584    19595    2         CALL M$WRITE(WRITE_JF);

  19595 12 000173   001510 630400 0                  EPPR0   WRITE_JF
        12 000174   040001 713400                    CLIMB   write
        12 000175   401400 401760                    pmme    nvectors=4

      585    19596    2         JIBUF='USE /CENTRAL';

  19596 12 000176   040000 100400                    MLR     fill='040'O
        12 000177   000124 000014 3                  ADSC9   GOOD_PATTERN+19          cn=0,n=12
        12 000200   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

      586    19597    2         CALL M$WRITE(WRITE_JF);

  19597 12 000201   001510 630400 0                  EPPR0   WRITE_JF
        12 000202   040001 713400                    CLIMB   write
        12 000203   401400 401760                    pmme    nvectors=4

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:82   
      587    19598    2         CALL CONCAT(JIBUF,'PROFILE SIGNED=''',SUBSTR(WHO_AM_I.NAME#, 0,

  19598 12 000204   006417 236000 0                  LDQ     WHO_AM_I
        12 000205   000033 772000                    QRL     27
        12 000206   040000 100400                    MLR     fill='040'O
        12 000207   000127 000020 3                  ADSC9   GOOD_PATTERN+22          cn=0,n=16
        12 000210   004341 000020 0                  ADSC9   JIBUF                    cn=0,n=16
        12 000211   000000 620006                    EAX0    0,QL
        12 000212   040000 100440                    MLR     fill='040'O
        12 000213   006417 200010 0                  ADSC9   WHO_AM_I                 cn=1,n=*X0
        12 000214   004345 000100 0                  ADSC9   JIBUF+4                  cn=0,n=64
        12 000215   000100 116007                    CMPQ    64,DL
        12 000216   000224 603000 12                 TRC     s:19600
        12 000217   777677 620006                    EAX0    -65,QL
        12 000220   777777 660003                    ERX0    -1,DU
        12 000221   040046 100400                    MLR     fill='040'O
        12 000222   000004 000001 13                 ADSC9   4                        cn=0,n=1
        12 000223   004345 000010 0                  ADSC9   JIBUF+4,Q                cn=0,n=*X0

      588    19599    2           WHO_AM_I.L#), '''');
      589    19600    2         CALL M$WRITE(WRITE_JF);

  19600 12 000224   001510 630400 0                  EPPR0   WRITE_JF
        12 000225   040001 713400                    CLIMB   write
        12 000226   401400 401760                    pmme    nvectors=4

      590    19601    2         JIBUF='END';

  19601 12 000227   040000 100400                    MLR     fill='040'O
        12 000230   000133 000003 3                  ADSC9   GOOD_PATTERN+26          cn=0,n=3
        12 000231   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

      591    19602    2         CALL M$WRITE(WRITE_JF);

  19602 12 000232   001510 630400 0                  EPPR0   WRITE_JF
        12 000233   040001 713400                    CLIMB   write
        12 000234   401400 401760                    pmme    nvectors=4
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:83   

      592    19603    2         CALL CONCAT(JIBUF,'!',SUBSTR(DCBADDR(DCBNUM(M$LM))->DUMMY.NAME#.C,

  19603 12 000235   000000 236007 xsym               LDQ     M$LM,DL
        12 000236   000003 470400 13                 LDP0    3
        12 000237   000000 471500                    LDP1    0,,PR0
        12 000240   100000 473506                    LDP3    0,QL,PR1
        12 000241   000000 236007 xsym               LDQ     M$LM,DL
        12 000242   100000 474506                    LDP4    0,QL,PR1
        12 000243   400010 236100                    LDQ     8,,PR4
        12 000244   000033 772000                    QRL     27
        12 000245   000000 620006                    EAX0    0,QL
        12 000246   041000 236003                    LDQ     16896,DU
        12 000247   004341 756000 0                  STQ     JIBUF
        12 000250   040000 100540                    MLR     fill='040'O
        12 000251   300010 200010                    ADSC9   8,,PR3                   cn=1,n=*X0
        12 000252   004341 200117 0                  ADSC9   JIBUF                    cn=1,n=79

      593    19604    2           0,DCBADDR(DCBNUM(M$LM))->DUMMY.NAME#.L));
      594    19605    2         CALL M$WRITE(WRITE_JF);

  19605 12 000253   001510 630400 0                  EPPR0   WRITE_JF
        12 000254   040001 713400                    CLIMB   write
        12 000255   401400 401760                    pmme    nvectors=4

      595    19606    2         CALL M$CLOSE(CLOSE_JF);

  19606 12 000256   001524 630400 0                  EPPR0   CLOSE_JF
        12 000257   050001 713400                    CLIMB   close
        12 000260   406000 401760                    pmme    nvectors=13

      596    19607    2         CALL M$XCON(FPT_XCON2);

  19607 12 000261   002742 630400 0                  EPPR0   FPT_XCON2
        12 000262   010003 713400                    CLIMB   4099
        12 000263   400400 401760                    pmme    nvectors=2

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:84   
      597    19608    2         CALL M$EXIT;

  19608 12 000264   000001 713400                    CLIMB   exit
        12 000265   000000 401760                    pmme    nvectors=0

      598    19609    2         END;

      599    19610
      600    19611        /****
      601    19612        *
      602    19613        *   Kill all overlays, then sleep for awhile.
      603    19614        *
      604    19615        ****/
      605    19616
      606    19617    1      VW_OPERERR#='0'B;

  19617 12 000266   000000 450000 xsym               STZ     VW_OPERERR#

      607    19618
      608    19619    1   ZZZZZ:
      609    19620    2      CALL M$OLAY(KILL_VWB$BEAM) WHENALTRETURN DO;

  19620 12 000267   002710 630400 0     ZZZZZ        EPPR0   KILL_VWB$BEAM
        12 000270   400004 713400                    CLIMB   alt,+4
        12 000271   400400 401760                    pmme    nvectors=2
        12 000272   000274 702000 12                 TSX2    s:19623
        12 000273   000274 710000 12                 TRA     s:19623

      610    19621    2         ;
      611    19622    2         END;

      612    19623    2      CALL M$OLAY(KILL_VWE$EVOM) WHENALTRETURN DO;

  19623 12 000274   002722 630400 0                  EPPR0   KILL_VWE$EVOM
        12 000275   400004 713400                    CLIMB   alt,+4
        12 000276   400400 401760                    pmme    nvectors=2
        12 000277   000301 702000 12                 TSX2    s:19626
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:85   
        12 000300   000301 710000 12                 TRA     s:19626

      613    19624    2         ;
      614    19625    2         END;

      615    19626    1      STATUS_LINE = 'Transporter idle, Cap''n...';

  19626 12 000301   040000 100400                    MLR     fill='040'O
        12 000302   000134 000032 3                  ADSC9   GOOD_PATTERN+27          cn=0,n=26
        12 000303   004315 000120 0                  ADSC9   STATUS_LINE              cn=0,n=80

      616    19627    1      call UPDATE_STATUS;

  19627 12 000304   002773 701000 12                 TSX1    UPDATE_STATUS
        12 000305   000000 011000                    NOP     0

      617    19628    1      CALL M$WAIT(SLEEP);

  19628 12 000306   002510 630400 0                  EPPR0   SLEEP
        12 000307   020006 713400                    CLIMB   8198
        12 000310   400400 401760                    pmme    nvectors=2

      618    19629
      619    19630        /****
      620    19631        *
      621    19632        *   Someone has awakened us.  Check to see if the operator has issued
      622    19633        *   an error (E) keyin.  If so, close the nodes file, and M$LDTRC
      623    19634        *   to a fresh copy of this rununit.  Normally, this is done so that
      624    19635        *   the system manager can make changes in :NODES, copy it OVER the
      625    19636        *   copy in .:SYS, and then !E the SCOTTY ghost to make SCOTTY aware
      626    19637        *   of the changes.  It may also be done if an updated (or repatched)
      627    19638        *   version of SCOTTY has been copied into .:SYS.
      628    19639        *
      629    19640        ****/
      630    19641
      631    19642    2      IF VW_OPERERR# THEN DO;

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:86   
  19642 12 000311   000000 234000 xsym               SZN     VW_OPERERR#
        12 000312   000344 605000 12                 TPL     s:19659

      632    19643    2         CALL M$CLOSE(CLOSE_NODE);

  19643 12 000313   001100 630400 0                  EPPR0   CLOSE_NODE
        12 000314   050001 713400                    CLIMB   close
        12 000315   406000 401760                    pmme    nvectors=13

      633    19644    2         LINK_TO_NEW_SCOTTY.NAME_ = VECTOR(DCBADDR(DCBNUM(M$LM)) -> DUMMY.NAME#);

  19644 12 000316   000000 236007 xsym               LDQ     M$LM,DL
        12 000317   000003 470400 13                 LDP0    3
        12 000320   000000 471500                    LDP1    0,,PR0
        12 000321   100000 473506                    LDP3    0,QL,PR1
        12 000322   000005 235000 13                 LDA     5
        12 000323   006600 453400 0                  STP3    OPT$+3
        12 000324   006600 236000 0                  LDQ     OPT$+3
        12 000325   000010 036003                    ADLQ    8,DU
        12 000326   002560 757000 0                  STAQ    LINK_TO_NEW_SCOTTY

      634    19645    2         LINK_TO_NEW_SCOTTY.ACCT_ = VECTOR(DCBADDR(DCBNUM(M$LM)) -> DUMMY.ACCT#);

  19645 12 000327   000000 236007 xsym               LDQ     M$LM,DL
        12 000330   100000 473506                    LDP3    0,QL,PR1
        12 000331   000006 235000 13                 LDA     6
        12 000332   006600 453400 0                  STP3    OPT$+3
        12 000333   006600 236000 0                  LDQ     OPT$+3
        12 000334   000020 036003                    ADLQ    16,DU
        12 000335   002562 757000 0                  STAQ    LINK_TO_NEW_SCOTTY+2

      635    19646    2         CALL M$XCON(FPT_XCON2);

  19646 12 000336   002742 630400 0                  EPPR0   FPT_XCON2
        12 000337   010003 713400                    CLIMB   4099
        12 000340   400400 401760                    pmme    nvectors=2

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:87   
      636    19647    2         CALL M$LDTRC (LINK_TO_NEW_SCOTTY);

  19647 12 000341   002560 630400 0                  EPPR0   LINK_TO_NEW_SCOTTY
        12 000342   000006 713400                    CLIMB   6
        12 000343   403000 401760                    pmme    nvectors=7

      637    19648    2         END;

      638    19649
      639    19650        /****
      640    19651        *
      641    19652        *   Try to find another file.  The filename must begin with "MOVE" and
      642    19653        *   it must be at least 12 characters long.  Make sure we've got our
      643    19654        *   own identity in the JIT fields and that we have the appropriate
      644    19655        *   privileges on.
      645    19656        *
      646    19657        ****/
      647    19658
      648    19659    1      NAME_JI.L#=12;

  19659 12 000344   014000 236003                    LDQ     6144,DU
        12 000345   001654 552040 0                  STBQ    NAME_JI,'40'O

      649    19660    1      NAME_JI.NAME#='MOVE';

  19660 12 000346   040000 100400                    MLR     fill='040'O
        12 000347   000143 000004 3                  ADSC9   GOOD_PATTERN+34          cn=0,n=4
        12 000350   001654 200037 0                  ADSC9   NAME_JI                  cn=1,n=31

      650    19661
      651    19662    1   NEXT_FILE:
      652    19663    2      if B$JIT.PRIV.ACTIVE.JIT then do;

  19663 12 000351   000000 470400 xsym  NEXT_FILE    LDP0    B$JIT$
        12 000352   000013 236100                    LDQ     11,,PR0
        12 000353   000040 316007                    CANQ    32,DL
        12 000354   000373 600000 12                 TZE     s:19679
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:88   

      653    19664    2         B$JIT.ACCN   = ':SYS    ';

  19664 12 000355   000144 237000 3                  LDAQ    GOOD_PATTERN+35
        12 000356   000001 755100                    STA     1,,PR0
        12 000357   000002 756100                    STQ     2,,PR0

      654    19665    2         B$JIT.UNAME  = 'SCOTTY';

  19665 12 000360   040100 100400                    MLR     fill='040'O
        12 000361   000146 000006 3                  ADSC9   GOOD_PATTERN+37          cn=0,n=6
        12 000362   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12

      655    19666    2         B$JIT.FACCN  =  VWS_ACCT_JI.ACCT#;

  19666 12 000363   001664 237000 0                  LDAQ    VWS_ACCT_JI
        12 000364   000006 757100                    STAQ    6,,PR0

      656    19667    2         B$JIT.MRT    =  34359738367;

  19667 12 000365   000007 235000 13                 LDA     7
        12 000366   000276 755100                    STA     190,,PR0

      657    19668    2         B$JIT.REMCPO =  34359738367;

  19668 12 000367   000360 755100                    STA     240,,PR0

      658    19669    2         B$JIT.PRIV.ACTIVE = (%PR_JIT#|%PR_FMSEC#);

  19669 12 000370   000111 236000 3                  LDQ     GOOD_PATTERN+8
        12 000371   000150 276000 3                  ORQ     GOOD_PATTERN+39
        12 000372   000013 756100                    STQ     11,,PR0

      659    19670    2         end;

      660    19671
      661    19672        /****
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:89   
      662    19673        *
      663    19674        *   Try to open the "next" file in .:MOVE.  The filename must be
      664    19675        *   in the format MOVExxxxxxxxnnnnnnnn.
      665    19676        *
      666    19677        ****/
      667    19678
      668    19679    1      CALL M$OPEN(OPEN_JI) ALTRET(BAD_JIO);

  19679 12 000373   001562 630400 0                  EPPR0   OPEN_JI
        12 000374   450000 713400                    CLIMB   alt,open
        12 000375   410400 401760                    pmme    nvectors=18
        12 000376   001014 702000 12                 TSX2    BAD_JIO

      669    19680
      670    19681        /****
      671    19682        *
      672    19683        *   We found a file.  Check to see if it's a legal name.
      673    19684        *
      674    19685        ****/
      675    19686
      676    19687    1      STATUS_LINE = 'Transporter engaged.';

  19687 12 000377   040000 100400                    MLR     fill='040'O
        12 000400   000151 000024 3                  ADSC9   GOOD_PATTERN+40          cn=0,n=20
        12 000401   004315 000120 0                  ADSC9   STATUS_LINE              cn=0,n=80

      677    19688    1      call UPDATE_STATUS;

  19688 12 000402   002773 701000 12                 TSX1    UPDATE_STATUS
        12 000403   000000 011000                    NOP     0

      678    19689    1      NAME_JI=JIPTR->DUMMY.NAME#;

  19689 12 000404   004275 470400 0                  LDP0    JIPTR
        12 000405   000000 100500                    MLR     fill='000'O
        12 000406   000010 000040                    ADSC9   8,,PR0                   cn=0,n=32
        12 000407   001654 000040 0                  ADSC9   NAME_JI                  cn=0,n=32
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:90   

      679    19690    1      IF JIPTR->DUMMY.NAME#.L<=12 OR SUBSTR(JIPTR->DUMMY.NAME#.C,0,4)

  19690 12 000410   000010 236100                    LDQ     8,,PR0
        12 000411   777000 376003                    ANQ     -512,DU
        12 000412   015000 116003                    CMPQ    6656,DU
        12 000413   001161 602000 12                 TNC     REL_INP_REL_OUT
        12 000414   040000 106500                    CMPC    fill='040'O
        12 000415   000010 200004                    ADSC9   8,,PR0                   cn=1,n=4
        12 000416   000143 000004 3                  ADSC9   GOOD_PATTERN+34          cn=0,n=4
        12 000417   001161 601000 12                 TNZ     REL_INP_REL_OUT

      680    19691    1        ~='MOVE' THEN
      681    19692    1         GOTO REL_INP_REL_OUT;
      682    19693
      683    19694        /****
      684    19695        *
      685    19696        *   We've got something open that looks like a good file.  Determine
      686    19697        *   what to do with it, if anything.  Note that the file may be
      687    19698        *   scrambled.
      688    19699        *
      689    19700        ****/
      690    19701
      691    19702    1      VW_OPTIONS#=' ';

  19702 12 000420   040000 100400                    MLR     fill='040'O
        12 000421   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 000422   000001 003720 0                  ADSC9   VW_OPTIONS#              cn=0,n=2000

      692    19703    1      OPTX=0;

  19703 12 000423   004301 450000 0                  STZ     OPTX

      693    19704    1      JIBUF=' ';

  19704 12 000424   040000 100400                    MLR     fill='040'O
        12 000425   000010 000001 13                 ADSC9   8                        cn=0,n=1
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:91   
        12 000426   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

      694    19705    1      VW_SCRAMBLE#='0'B;

  19705 12 000427   006443 450000 0                  STZ     VW_SCRAMBLE#

      695    19706
      696    19707        /****
      697    19708        *
      698    19709        *   In order to determine if the file is scrambled, look for a valid
      699    19710        *   first command (BEAM, SUCK, or SHUT).  If we don't find this, try
      700    19711        *   unscrambling the record and check again.  If we still don't get
      701    19712        *   anything sensible, trash the file.  If the descrambling produced
      702    19713        *   readable text, set the scramble flag for later.
      703    19714        *
      704    19715        ****/
      705    19716
      706    19717    1      CALL M$READ(READ_JI) ALTRET(BAD_JIF);

  19717 12 000430   001666 630400 0                  EPPR0   READ_JI
        12 000431   440000 713400                    CLIMB   alt,read
        12 000432   401400 401760                    pmme    nvectors=4
        12 000433   001025 702000 12                 TSX2    BAD_JIF

      707    19718    1      IF SUBSTR(JIBUF,0,4)~='BEAM' AND SUBSTR(JIBUF,0,4)~='SUCK' AND

  19718 12 000434   004341 236000 0                  LDQ     JIBUF
        12 000435   000156 116000 3                  CMPQ    GOOD_PATTERN+45
        12 000436   000460 600000 12                 TZE     s:19733
        12 000437   000157 116000 3                  CMPQ    GOOD_PATTERN+46
        12 000440   000460 600000 12                 TZE     s:19733
        12 000441   000160 116000 3                  CMPQ    GOOD_PATTERN+47
        12 000442   000460 600000 12                 TZE     s:19733

      708    19719    2        SUBSTR(JIBUF,0,4)~='SHUT' THEN DO;

      709    19720    2         CALL VWI$TRANSI(JIBUF);
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:92   

  19720 12 000443   000011 630400 13                 EPPR0   9
        12 000444   000000 631400 13                 EPPR1   0
        12 000445   000000 701000 xent               TSX1    VWI$TRANSI
        12 000446   000000 011000                    NOP     0

      710    19721    2         VW_SCRAMBLE#='1'B;

  19721 12 000447   400000 236003                    LDQ     -131072,DU
        12 000450   006443 756000 0                  STQ     VW_SCRAMBLE#

      711    19722    2         IF SUBSTR(JIBUF,0,4)~='BEAM' AND SUBSTR(JIBUF,0,4)~='SUCK'

  19722 12 000451   004341 236000 0                  LDQ     JIBUF
        12 000452   000156 116000 3                  CMPQ    GOOD_PATTERN+45
        12 000453   000460 600000 12                 TZE     s:19733
        12 000454   000157 116000 3                  CMPQ    GOOD_PATTERN+46
        12 000455   000460 600000 12                 TZE     s:19733
        12 000456   000160 116000 3                  CMPQ    GOOD_PATTERN+47
        12 000457   000754 601000 12                 TNZ     BAD_CMD

      712    19723    2           AND SUBSTR(JIBUF,0,4)~='SHUT' THEN
      713    19724    2            GOTO BAD_CMD;
      714    19725    2         END;

      715    19726
      716    19727        /****
      717    19728        *
      718    19729        *   See if this is a special shutdown message.
      719    19730        *
      720    19731        ****/
      721    19732
      722    19733    2      IF SUBSTR(JIBUF,0,15)='SHUT UP, STELLA' THEN DO;

  19733 12 000460   040000 106400                    CMPC    fill='040'O
        12 000461   004341 000017 0                  ADSC9   JIBUF                    cn=0,n=15
        12 000462   000161 000017 3                  ADSC9   GOOD_PATTERN+48          cn=0,n=15
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:93   
        12 000463   000475 601000 12                 TNZ     s:19747

      723    19734    2         CLOSE_JI.V.DISP#=%RELEASE#;

  19734 12 000464   000001 236007                    LDQ     1,DL
        12 000465   001750 552004 0                  STBQ    CLOSE_JI+26,'04'O

      724    19735    2         CALL M$CLOSE(CLOSE_JI);

  19735 12 000466   001716 630400 0                  EPPR0   CLOSE_JI
        12 000467   050001 713400                    CLIMB   close
        12 000470   406000 401760                    pmme    nvectors=13

      725    19736    2         CALL M$XCON(FPT_XCON2);

  19736 12 000471   002742 630400 0                  EPPR0   FPT_XCON2
        12 000472   010003 713400                    CLIMB   4099
        12 000473   400400 401760                    pmme    nvectors=2

      726    19737    2         RETURN;

  19737 12 000474   000000 702200 xent               TSX2  ! X66_MSRET

      727    19738    2         END;
      728    19739
      729    19740        /****
      730    19741        *
      731    19742        *   Try to read the :NODES entry for the target node in this record.
      732    19743        *   If the node's name is a synonym, read the "real" node's name.
      733    19744        *
      734    19745        ****/
      735    19746
      736    19747    1      NODEKEY.C=SUBSTR(JIBUF,72,8);

  19747 12 000475   040000 100400                    MLR     fill='040'O
        12 000476   004363 000010 0                  ADSC9   JIBUF+18                 cn=0,n=8
        12 000477   001136 200010 0                  ADSC9   NODEKEY                  cn=1,n=8
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:94   

      737    19748    2      CALL M$READ(READ_NODE) WHENRETURN DO;

  19748 12 000500   001062 630400 0                  EPPR0   READ_NODE
        12 000501   440000 713400                    CLIMB   alt,read
        12 000502   401400 401760                    pmme    nvectors=4
        12 000503   000516 702000 12                 TSX2    s:19759

      738    19749    2         IF DCBADDR(DCBNUM(M$NODE))->DUMMY.ARS#=8 THEN

  19749 12 000504   000000 236007 xsym               LDQ     M$NODE,DL
        12 000505   000003 470400 13                 LDP0    3
        12 000506   000000 471500                    LDP1    0,,PR0
        12 000507   100000 473506                    LDP3    0,QL,PR1
        12 000510   300000 235100                    LDA     0,,PR3
        12 000511   000010 115007                    CMPA    8,DL
        12 000512   000516 601000 12                 TNZ     s:19759

      739    19750    2            SUBSTR(JIBUF,72,8)=NODEOVR.PATH_NAME;

  19750 12 000513   040000 100400                    MLR     fill='040'O
        12 000514   001141 000010 0                  ADSC9   NODEOVR                  cn=0,n=8
        12 000515   004363 000010 0                  ADSC9   JIBUF+18                 cn=0,n=8

      740    19751    2         END;

      741    19752
      742    19753        /****
      743    19754        *
      744    19755        *   If the node specified is not me, send this packet elsewhere.
      745    19756        *
      746    19757        ****/
      747    19758
      748    19759    1      IF SUBSTR(JIBUF,72,8)~=VW_IAM# THEN

  19759 12 000516   040000 106400                    CMPC    fill='040'O
        12 000517   004363 000010 0                  ADSC9   JIBUF+18                 cn=0,n=8
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:95   
        12 000520   006441 000010 0                  ADSC9   VW_IAM#                  cn=0,n=8
        12 000521   001215 601000 12                 TNZ     DO_POST

      749    19760    1         GOTO DO_POST;
      750    19761
      751    19762        /****
      752    19763        *
      753    19764        *   We want to do something with this packet.  Assemble the commands
      754    19765        *   into the OPTS buffer.  Note that we always read one more command
      755    19766        *   into JIBUF than is necessary.
      756    19767        *
      757    19768        ****/
      758    19769
      759    19770        /****
      760    19771        *
      761    19772        *   Read the SUCK command header (two records), if present.  A SUCK
      762    19773        *   request turns into a BEAM here; the SUCK information is used to
      763    19774        *   log the retrieving user onto this node.
      764    19775        *
      765    19776        ****/
      766    19777
      767    19778    2      IF SUBSTR(JIBUF,0,4)='SUCK' THEN DO;

  19778 12 000522   004341 236000 0                  LDQ     JIBUF
        12 000523   000157 116000 3                  CMPQ    GOOD_PATTERN+46
        12 000524   000565 601000 12                 TNZ     s:19801

      768    19779    2         CARD(0)=JIBUF;

  19779 12 000525   040000 100400                    MLR     fill='040'O
        12 000526   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80
        12 000527   000001 000120 0                  ADSC9   VW_OPTIONS#              cn=0,n=80

      769    19780    2         JIBUF=' ';

  19780 12 000530   040000 100400                    MLR     fill='040'O
        12 000531   000010 000001 13                 ADSC9   8                        cn=0,n=1
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:96   
        12 000532   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

      770    19781    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);

  19781 12 000533   001666 630400 0                  EPPR0   READ_JI
        12 000534   440000 713400                    CLIMB   alt,read
        12 000535   401400 401760                    pmme    nvectors=4
        12 000536   001025 702000 12                 TSX2    BAD_JIF

      771    19782    2         IF VW_SCRAMBLE# THEN

  19782 12 000537   006443 234000 0                  SZN     VW_SCRAMBLE#
        12 000540   000545 605000 12                 TPL     s:19784

      772    19783    2            CALL VWI$TRANSI(JIBUF);

  19783 12 000541   000011 630400 13                 EPPR0   9
        12 000542   000000 631400 13                 EPPR1   0
        12 000543   000000 701000 xent               TSX1    VWI$TRANSI
        12 000544   000000 011000                    NOP     0

      773    19784    2         CARD(1)=JIBUF;

  19784 12 000545   040000 100400                    MLR     fill='040'O
        12 000546   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80
        12 000547   000025 000120 0                  ADSC9   VW_OPTIONS#+20           cn=0,n=80

      774    19785    2         JIBUF=' ';

  19785 12 000550   040000 100400                    MLR     fill='040'O
        12 000551   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 000552   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

      775    19786    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);

  19786 12 000553   001666 630400 0                  EPPR0   READ_JI
        12 000554   440000 713400                    CLIMB   alt,read
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:97   
        12 000555   401400 401760                    pmme    nvectors=4
        12 000556   001025 702000 12                 TSX2    BAD_JIF

      776    19787    2         IF VW_SCRAMBLE# THEN

  19787 12 000557   006443 234000 0                  SZN     VW_SCRAMBLE#
        12 000560   000565 605000 12                 TPL     s:19801

      777    19788    2            CALL VWI$TRANSI(JIBUF);

  19788 12 000561   000011 630400 13                 EPPR0   9
        12 000562   000000 631400 13                 EPPR1   0
        12 000563   000000 701000 xent               TSX1    VWI$TRANSI
        12 000564   000000 011000                    NOP     0

      778    19789    2         END;

      779    19790
      780    19791        /****
      781    19792        *
      782    19793        *   Read the BEAM command header (two records), if present (this should
      783    19794        *   always be true).  If SUCK isn't present, the file contains a file
      784    19795        *   to be restored here via the EVOM routine; the BEAM records contain
      785    19796        *   the logon for the file restorer.  If SUCK is present, the BEAM
      786    19797        *   records specify the file name and logon at the distant node.
      787    19798        *
      788    19799        ****/
      789    19800
      790    19801    2      IF SUBSTR(JIBUF,0,4)='BEAM' THEN DO;

  19801 12 000565   004341 236000 0                  LDQ     JIBUF
        12 000566   000156 116000 3                  CMPQ    GOOD_PATTERN+45
        12 000567   000630 601000 12                 TNZ     s:19824

      791    19802    2         CARD(2)=JIBUF;

  19802 12 000570   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:98   
        12 000571   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80
        12 000572   000051 000120 0                  ADSC9   VW_OPTIONS#+40           cn=0,n=80

      792    19803    2         JIBUF=' ';

  19803 12 000573   040000 100400                    MLR     fill='040'O
        12 000574   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 000575   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

      793    19804    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);

  19804 12 000576   001666 630400 0                  EPPR0   READ_JI
        12 000577   440000 713400                    CLIMB   alt,read
        12 000600   401400 401760                    pmme    nvectors=4
        12 000601   001025 702000 12                 TSX2    BAD_JIF

      794    19805    2         IF VW_SCRAMBLE# THEN

  19805 12 000602   006443 234000 0                  SZN     VW_SCRAMBLE#
        12 000603   000610 605000 12                 TPL     s:19807

      795    19806    2            CALL VWI$TRANSI(JIBUF);

  19806 12 000604   000011 630400 13                 EPPR0   9
        12 000605   000000 631400 13                 EPPR1   0
        12 000606   000000 701000 xent               TSX1    VWI$TRANSI
        12 000607   000000 011000                    NOP     0

      796    19807    2         CARD(3)=JIBUF;

  19807 12 000610   040000 100400                    MLR     fill='040'O
        12 000611   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80
        12 000612   000075 000120 0                  ADSC9   VW_OPTIONS#+60           cn=0,n=80

      797    19808    2         JIBUF=' ';

  19808 12 000613   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:99   
        12 000614   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 000615   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

      798    19809    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);

  19809 12 000616   001666 630400 0                  EPPR0   READ_JI
        12 000617   440000 713400                    CLIMB   alt,read
        12 000620   401400 401760                    pmme    nvectors=4
        12 000621   001025 702000 12                 TSX2    BAD_JIF

      799    19810    2         IF VW_SCRAMBLE# THEN

  19810 12 000622   006443 234000 0                  SZN     VW_SCRAMBLE#
        12 000623   000630 605000 12                 TPL     s:19824

      800    19811    2            CALL VWI$TRANSI(JIBUF);

  19811 12 000624   000011 630400 13                 EPPR0   9
        12 000625   000000 631400 13                 EPPR1   0
        12 000626   000000 701000 xent               TSX1    VWI$TRANSI
        12 000627   000000 011000                    NOP     0

      801    19812    2         END;

      802    19813
      803    19814
      804    19815        /****
      805    19816        *
      806    19817        *   Read the various MAIL records (two each), if present.  There may
      807    19818        *   be MAILI (mail to initiator), MAILR (mail to receiver), and/or
      808    19819        *   MAILS (mail to sender) records.  Each consists of a header containing
      809    19820        *   the node name and the name of the mailbox.
      810    19821        *
      811    19822        ****/
      812    19823
      813    19824    2      DO WHILE(SUBSTR(JIBUF,0,4)='MAIL');

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:100  
  19824 12 000630   000712 710000 12                 TRA     s:19840

      814    19825    2         IF SUBSTR(JIBUF,4,1)='S' THEN

  19825 12 000631   004342 236000 0                  LDQ     JIBUF+1
        12 000632   777000 376003                    ANQ     -512,DU
        12 000633   123000 116003                    CMPQ    42496,DU
        12 000634   000640 601000 12                 TNZ     s:19827

      815    19826    2            I=4;

  19826 12 000635   000004 235007                    LDA     4,DL
        12 000636   004302 755000 0                  STA     I
        12 000637   000651 710000 12                 TRA     s:19831

      816    19827    2           ELSE IF SUBSTR(JIBUF,4,1)='R' THEN

  19827 12 000640   004342 236000 0                  LDQ     JIBUF+1
        12 000641   777000 376003                    ANQ     -512,DU
        12 000642   122000 116003                    CMPQ    41984,DU
        12 000643   000647 601000 12                 TNZ     s:19830

      817    19828    2               I=6;

  19828 12 000644   000006 235007                    LDA     6,DL
        12 000645   004302 755000 0                  STA     I
        12 000646   000651 710000 12                 TRA     s:19831

      818    19829    2              ELSE
      819    19830    2               I=8;

  19830 12 000647   000010 235007                    LDA     8,DL
        12 000650   004302 755000 0                  STA     I

      820    19831    2         CARD(I)=JIBUF;

  19831 12 000651   004302 236000 0                  LDQ     I
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:101  
        12 000652   000120 402007                    MPY     80,DL
        12 000653   040006 100400                    MLR     fill='040'O
        12 000654   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80
        12 000655   000001 000120 0                  ADSC9   VW_OPTIONS#,Q            cn=0,n=80

      821    19832    2         JIBUF=' ';

  19832 12 000656   040000 100400                    MLR     fill='040'O
        12 000657   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 000660   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

      822    19833    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);

  19833 12 000661   001666 630400 0                  EPPR0   READ_JI
        12 000662   440000 713400                    CLIMB   alt,read
        12 000663   401400 401760                    pmme    nvectors=4
        12 000664   001025 702000 12                 TSX2    BAD_JIF

      823    19834    2         IF VW_SCRAMBLE# THEN

  19834 12 000665   006443 234000 0                  SZN     VW_SCRAMBLE#
        12 000666   000673 605000 12                 TPL     s:19836

      824    19835    2            CALL VWI$TRANSI(JIBUF);

  19835 12 000667   000011 630400 13                 EPPR0   9
        12 000670   000000 631400 13                 EPPR1   0
        12 000671   000000 701000 xent               TSX1    VWI$TRANSI
        12 000672   000000 011000                    NOP     0

      825    19836    2         CARD(I+1)=JIBUF;

  19836 12 000673   004302 236000 0                  LDQ     I
        12 000674   000120 402007                    MPY     80,DL
        12 000675   040006 100400                    MLR     fill='040'O
        12 000676   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80
        12 000677   000025 000120 0                  ADSC9   VW_OPTIONS#+20,Q         cn=0,n=80
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:102  

      826    19837    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);

  19837 12 000700   001666 630400 0                  EPPR0   READ_JI
        12 000701   440000 713400                    CLIMB   alt,read
        12 000702   401400 401760                    pmme    nvectors=4
        12 000703   001025 702000 12                 TSX2    BAD_JIF

      827    19838    2         IF VW_SCRAMBLE# THEN

  19838 12 000704   006443 234000 0                  SZN     VW_SCRAMBLE#
        12 000705   000712 605000 12                 TPL     s:19840

      828    19839    2            CALL VWI$TRANSI(JIBUF);

  19839 12 000706   000011 630400 13                 EPPR0   9
        12 000707   000000 631400 13                 EPPR1   0
        12 000710   000000 701000 xent               TSX1    VWI$TRANSI
        12 000711   000000 011000                    NOP     0

      829    19840    2         END;

  19840 12 000712   004341 236000 0                  LDQ     JIBUF
        12 000713   000165 116000 3                  CMPQ    GOOD_PATTERN+52
        12 000714   000631 600000 12                 TZE     s:19825

      830    19841
      831    19842        /****
      832    19843        *
      833    19844        *   Read options records, if present.  When we're done with this, we
      834    19845        *   will have read one too many records.  In the case of a SUCK, we
      835    19846        *   will have read the " EOF" record, which we'll discard (we don't
      836    19847        *   bother checking for it, however).  In the case of a BEAM, we will
      837    19848        *   have read the first data record which will contain the beginning
      838    19849        *   of the FIT.
      839    19850        *
      840    19851        ****/
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:103  
      841    19852
      842    19853    2      DO WHILE(SUBSTR(JIBUF,0,4)='OPTS');

  19853 12 000715   000736 710000 12                 TRA     s:19859

      843    19854    2         OPTS.OPTSRECS(OPTX)=JIBUF;

  19854 12 000716   004301 236000 0                  LDQ     OPTX
        12 000717   000120 402007                    MPY     80,DL
        12 000720   040006 100400                    MLR     fill='040'O
        12 000721   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80
        12 000722   000311 000120 0                  ADSC9   VW_OPTIONS#+200,Q        cn=0,n=80

      844    19855    2         OPTX=OPTX+1;

  19855 12 000723   004301 054000 0                  AOS     OPTX

      845    19856    2         CALL M$READ(READ_JI) ALTRET(BAD_JIF);

  19856 12 000724   001666 630400 0                  EPPR0   READ_JI
        12 000725   440000 713400                    CLIMB   alt,read
        12 000726   401400 401760                    pmme    nvectors=4
        12 000727   001025 702000 12                 TSX2    BAD_JIF

      846    19857    2         IF VW_SCRAMBLE# THEN

  19857 12 000730   006443 234000 0                  SZN     VW_SCRAMBLE#
        12 000731   000736 605000 12                 TPL     s:19859

      847    19858    2            CALL VWI$TRANSI(JIBUF);

  19858 12 000732   000011 630400 13                 EPPR0   9
        12 000733   000000 631400 13                 EPPR1   0
        12 000734   000000 701000 xent               TSX1    VWI$TRANSI
        12 000735   000000 011000                    NOP     0

      848    19859    2         END;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:104  

  19859 12 000736   004341 236000 0                  LDQ     JIBUF
        12 000737   000166 116000 3                  CMPQ    GOOD_PATTERN+53
        12 000740   000716 600000 12                 TZE     s:19854

      849    19860
      850    19861        /****
      851    19862        *
      852    19863        *   Reposition in the input file correctly.
      853    19864        *
      854    19865        ****/
      855    19866
      856    19867    1      CALL M$PRECORD(PRECORD_JI) ALTRET(BAD_JIF);

  19867 12 000741   001704 630400 0                  EPPR0   PRECORD_JI
        12 000742   440003 713400                    CLIMB   alt,+16387
        12 000743   401000 401760                    pmme    nvectors=3
        12 000744   001025 702000 12                 TSX2    BAD_JIF

      857    19868
      858    19869        /****
      859    19870        *
      860    19871        *   Now figure out who to call to do what needs to be done.
      861    19872        *
      862    19873        ****/
      863    19874
      864    19875    1      IF OPTS.INP.CMD='SUCK' THEN

  19875 12 000745   000001 236000 0                  LDQ     VW_OPTIONS#
        12 000746   000157 116000 3                  CMPQ    GOOD_PATTERN+46
        12 000747   001500 600000 12                 TZE     DO_SUCK

      865    19876    1         GOTO DO_SUCK;
      866    19877    1      IF OPTS.OUT.CMD='BEAM' THEN

  19877 12 000750   000051 236000 0                  LDQ     VW_OPTIONS#+40
        12 000751   000156 116000 3                  CMPQ    GOOD_PATTERN+45
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:105  
        12 000752   001547 600000 12                 TZE     DO_BEAM

      867    19878    1         GOTO DO_BEAM;
      868    19879    1      GOTO REL_INP_REL_OUT;

  19879 12 000753   001161 710000 12                 TRA     REL_INP_REL_OUT

      869    19880
      870    19881        /****
      871    19882        *
      872    19883        *   We didn't find a good command in the file.
      873    19884        *
      874    19885        ****/
      875    19886
      876    19887    1   BAD_CMD:
      877    19888    1      ERRCODE=%E$VWM_CMD;

  19888 12 000754   000012 235000 13    BAD_CMD      LDA     10
        12 000755   004314 755000 0                  STA     ERRCODE

      878    19889    1      GOTO BAD_USRERR;

  19889 12 000756   001041 710000 12                 TRA     BAD_USRERR

      879    19890
      880    19891        /****
      881    19892        *
      882    19893        *   The :NODES file isn't available.  If we got a "Packset is not
      883    19894        *   ready to use", just wait for it awhile.  Come here also if *IAM
      884    19895        *   doesn't exist.
      885    19896        *
      886    19897        ****/
      887    19898
      888    19899    1   BAD_NOD:
      889    19900    1      ERRBITS=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

  19900 12 000757   000000 470400 xsym  BAD_NOD      LDP0    B$TCB$
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:106  
        12 000760   000000 471500                    LDP1    0,,PR0
        12 000761   100102 236100                    LDQ     66,,PR1
        12 000762   004314 756000 0                  STQ     ERRCODE

      890    19901    2      IF ERRBITS.CODE=%E$SETDOWN THEN DO;

  19901 12 000763   004314 236000 0                  LDQ     ERRCODE
        12 000764   377770 376007                    ANQ     131064,DL
        12 000765   002200 116007                    CMPQ    1152,DL
        12 000766   000773 601000 12                 TNZ     s:19905

      891    19902    2         CALL M$WAIT(SLEEP);

  19902 12 000767   002510 630400 0                  EPPR0   SLEEP
        12 000770   020006 713400                    CLIMB   8198
        12 000771   400400 401760                    pmme    nvectors=2

      892    19903    2         GOTO RESTART;

  19903 12 000772   000012 710000 12                 TRA     RESTART

      893    19904    2         END;
      894    19905    1      GOTO BAD_USRERR;

  19905 12 000773   001041 710000 12                 TRA     BAD_USRERR

      895    19906
      896    19907        /****
      897    19908        *
      898    19909        *   The destination node isn't known to us here.
      899    19910        *
      900    19911        ****/
      901    19912
      902    19913    1   BAD_DST:
      903    19914    1      ERRCODE=%E$VWM_DST;

  19914 12 000774   000013 235000 13    BAD_DST      LDA     11
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:107  
        12 000775   004314 755000 0                  STA     ERRCODE

      904    19915    1      GOTO BAD_USRERR;

  19915 12 000776   001041 710000 12                 TRA     BAD_USRERR

      905    19916
      906    19917        /****
      907    19918        *
      908    19919        *   The user has specified an illegal logon/password.
      909    19920        *
      910    19921        ****/
      911    19922
      912    19923    1   BAD_LGN:
      913    19924    1      ERRCODE=%E$VWM_LGN;

  19924 12 000777   000014 235000 13    BAD_LGN      LDA     12
        12 001000   004314 755000 0                  STA     ERRCODE

      914    19925    1      GOTO BAD_USRERR;

  19925 12 001001   001041 710000 12                 TRA     BAD_USRERR

      915    19926
      916    19927        /****
      917    19928        *
      918    19929        *   You cannot use :MAIL,500ATOB as a logon.
      919    19930        *
      920    19931        ****/
      921    19932
      922    19933    1   BAD_SUK:
      923    19934    1      ERRCODE=%E$VWM_SUK;

  19934 12 001002   000015 235000 13    BAD_SUK      LDA     13
        12 001003   004314 755000 0                  STA     ERRCODE

      924    19935    1      GOTO BAD_USRERR;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:108  

  19935 12 001004   001041 710000 12                 TRA     BAD_USRERR

      925    19936
      926    19937        /****
      927    19938        *
      928    19939        *   Packet header shows signs of mistranslation.
      929    19940        *
      930    19941        ****/
      931    19942
      932    19943    1   BAD_TRANSLATION:
      933    19944    1      ERRCODE = %E$VWM_XLATION;

  19944 12 001005   000016 235000 13    BAD_TRANSLA* LDA     14
        12 001006   004314 755000 0                  STA     ERRCODE

      934    19945    1      CALL VWX$MAIL (ERRCODE,VECTOR(BAD_PATTERN),VECTOR(GOOD_PATTERN));

  19945 12 001007   000024 630400 13                 EPPR0   20
        12 001010   000017 631400 13                 EPPR1   15
        12 001011   000000 701000 xent               TSX1    VWX$MAIL
        12 001012   000000 011000                    NOP     0

      935    19946    1      GOTO REL_INP_REL_OUT;

  19946 12 001013   001161 710000 12                 TRA     REL_INP_REL_OUT

      936    19947
      937    19948        /****
      938    19949        *
      939    19950        *   Error opening the JI stream.  This may just be end-of-directory.
      940    19951        *
      941    19952        ****/
      942    19953
      943    19954    1   BAD_JIO:
      944    19955    1      ERRBITS=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:109  
  19955 12 001014   000000 470400 xsym  BAD_JIO      LDP0    B$TCB$
        12 001015   000000 471500                    LDP1    0,,PR0
        12 001016   100102 236100                    LDQ     66,,PR1
        12 001017   004314 756000 0                  STQ     ERRCODE

      945    19956    1      IF ERRBITS.CODE~=%E$FDEOF THEN

  19956 12 001020   004314 236000 0                  LDQ     ERRCODE
        12 001021   377770 376007                    ANQ     131064,DL
        12 001022   001540 116007                    CMPQ    864,DL
        12 001023   001025 601000 12                 TNZ     BAD_JIF

      946    19957    1         GOTO BAD_JIF;
      947    19958    1      GOTO ZZZZZ;

  19958 12 001024   000267 710000 12                 TRA     ZZZZZ

      948    19959
      949    19960        /****
      950    19961        *
      951    19962        *   Error reading the JI stream.  This is bad.
      952    19963        *
      953    19964        ****/
      954    19965
      955    19966    1   BAD_JIF:
      956    19967    1      ERRDCB=DCBNUM(M$JI);

  19967 12 001025   000000 236007 xsym  BAD_JIF      LDQ     M$JI,DL
        12 001026   004312 756000 0                  STQ     ERRDCB

      957    19968    1      GOTO BAD_SYSERR;

  19968 12 001027   001046 710000 12                 TRA     BAD_SYSERR

      958    19969
      959    19970        /****
      960    19971        *
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:110  
      961    19972        *   The nodename specified in the :NODES file doesn't exist.  This
      962    19973        *   is a system manager error.
      963    19974        *
      964    19975        ****/
      965    19976
      966    19977    1   BAD_VIA:
      967    19978    1      ERRDCB=DCBNUM(M$MAIL);

  19978 12 001030   000000 236007 xsym  BAD_VIA      LDQ     M$MAIL,DL
        12 001031   004312 756000 0                  STQ     ERRDCB

      968    19979    1      GOTO BAD_SYSERR;

  19979 12 001032   001046 710000 12                 TRA     BAD_SYSERR

      969    19980
      970    19981        /****
      971    19982        *
      972    19983        *   Unable to write output to JE.
      973    19984        *
      974    19985        ****/
      975    19986
      976    19987    1   BAD_WRM:
      977    19988    1      ERRDCB=DCBNUM(M$JE);

  19988 12 001033   000000 236007 xsym  BAD_WRM      LDQ     M$JE,DL
        12 001034   004312 756000 0                  STQ     ERRDCB

      978    19989    1      GOTO BAD_SYSERR;

  19989 12 001035   001046 710000 12                 TRA     BAD_SYSERR

      979    19990
      980    19991        /****
      981    19992        *
      982    19993        *   The JI file is incomplete or garbled in some way.
      983    19994        *
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:111  
      984    19995        ****/
      985    19996
      986    19997    1   BAD_RJI:
      987    19998    1      ERRDCB=DCBNUM(M$JI);

  19998 12 001036   000000 236007 xsym  BAD_RJI      LDQ     M$JI,DL
        12 001037   004312 756000 0                  STQ     ERRDCB

      988    19999    1      GOTO BAD_SYSERR;

  19999 12 001040   001046 710000 12                 TRA     BAD_SYSERR

      989    20000
      990    20001        /****
      991    20002        *
      992    20003        *   Handle a user-land error, then release any input and/or output files.
      993    20004        *
      994    20005        ****/
      995    20006
      996    20007    1   BAD_USRERR:
      997    20008    1      CALL VWX$MAIL(ERRCODE);

  20008 12 001041   000024 630400 13    BAD_USRERR   EPPR0   20
        12 001042   000000 631400 13                 EPPR1   0
        12 001043   000000 701000 xent               TSX1    VWX$MAIL
        12 001044   000000 011000                    NOP     0

      998    20009    1      GOTO REL_INP_REL_OUT;

  20009 12 001045   001161 710000 12                 TRA     REL_INP_REL_OUT

      999    20010
     1000    20011        /****
     1001    20012        *
     1002    20013        *   Handle a monitor error, then release any input and/or output files.
     1003    20014        *
     1004    20015        ****/
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:112  
     1005    20016
     1006    20017    1   BAD_SYSERR:
     1007    20018    1      ERRBITS=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

  20018 12 001046   000000 470400 xsym  BAD_SYSERR   LDP0    B$TCB$
        12 001047   000000 471500                    LDP1    0,,PR0
        12 001050   100102 236100                    LDQ     66,,PR1
        12 001051   004314 756000 0                  STQ     ERRCODE

     1008    20019    1      ERRBITS.SEV=0;

  20019 12 001052   000027 236000 13                 LDQ     23
        12 001053   004314 356000 0                  ANSQ    ERRCODE

     1009    20020    1      CALL VWX$MAIL(ERRCODE,,,,ERRDCB);

  20020 12 001054   000032 236000 13                 LDQ     26
        12 001055   006604 756000 0                  STQ     OPT$+7
        12 001056   000031 236000 13                 LDQ     25
        12 001057   000031 235000 13                 LDA     25
        12 001060   006602 757000 0                  STAQ    OPT$+5
        12 001061   000031 236000 13                 LDQ     25
        12 001062   000024 235000 13                 LDA     20
        12 001063   006600 757000 0                  STAQ    OPT$+3
        12 001064   006600 630400 0                  EPPR0   OPT$+3
        12 001065   000030 631400 13                 EPPR1   24
        12 001066   000000 701000 xent               TSX1    VWX$MAIL
        12 001067   000000 011000                    NOP     0

     1010    20021    1      GOTO REL_INP_REL_OUT;

  20021 12 001070   001161 710000 12                 TRA     REL_INP_REL_OUT

     1011    20022
     1012    20023        /****
     1013    20024        *
     1014    20025        *   Save the input file for later, release any output.  This is used
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:113  
     1015    20026        *   when some recoverable error occurs, such as packset not mounted or
     1016    20027        *   file busy.
     1017    20028        *
     1018    20029        ****/
     1019    20030
     1020    20031    1   SAV_INP_REL_OUT:
     1021    20032    1      if B$JIT.PRIV.ACTIVE.JIT

  20032 12 001071   000000 470400 xsym  SAV_INP_REL* LDP0    B$JIT$
        12 001072   000013 236100                    LDQ     11,,PR0
        12 001073   000040 316007                    CANQ    32,DL
        12 001074   001100 600000 12                 TZE     s:20034

     1022    20033    1        then B$JIT.PRIV.ACTIVE=(%PR_JIT#|%PR_FMSEC#);

  20033 12 001075   000111 236000 3                  LDQ     GOOD_PATTERN+8
        12 001076   000150 276000 3                  ORQ     GOOD_PATTERN+39
        12 001077   000013 756100                    STQ     11,,PR0

     1023    20034    2      IF JIPTR->DUMMY.FCD# THEN DO;

  20034 12 001100   004275 471400 0                  LDP1    JIPTR
        12 001101   100031 236100                    LDQ     25,,PR1
        12 001102   020000 316007                    CANQ    8192,DL
        12 001103   001111 600000 12                 TZE     s:20038

     1024    20035    2         CLOSE_JI.V.DISP#=%SAVE#;

  20035 12 001104   000002 236007                    LDQ     2,DL
        12 001105   001750 552004 0                  STBQ    CLOSE_JI+26,'04'O

     1025    20036    2         CALL M$CLOSE(CLOSE_JI);

  20036 12 001106   001716 630400 0                  EPPR0   CLOSE_JI
        12 001107   050001 713400                    CLIMB   close
        12 001110   406000 401760                    pmme    nvectors=13

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:114  
     1026    20037    2         END;

     1027    20038    2      IF JEPTR->DUMMY.FCD# THEN DO;

  20038 12 001111   004276 470400 0                  LDP0    JEPTR
        12 001112   000031 236100                    LDQ     25,,PR0
        12 001113   020000 316007                    CANQ    8192,DL
        12 001114   001122 600000 12                 TZE     s:20042

     1028    20039    2         CLOSE_JE.V.DISP#=%RELEASE#;

  20039 12 001115   000001 236007                    LDQ     1,DL
        12 001116   002504 552004 0                  STBQ    CLOSE_JE+26,'04'O

     1029    20040    2         CALL M$CLOSE(CLOSE_JE);

  20040 12 001117   002452 630400 0                  EPPR0   CLOSE_JE
        12 001120   050001 713400                    CLIMB   close
        12 001121   406000 401760                    pmme    nvectors=13

     1030    20041    2         END;

     1031    20042    1      CALL CLOSE_THE_MAIL_FILE;

  20042 12 001122   002561 701000 12                 TSX1    CLOSE_THE_MAIL_FILE
        12 001123   000000 011000                    NOP     0

     1032    20043    1      GOTO NEXT_FILE;

  20043 12 001124   000351 710000 12                 TRA     NEXT_FILE

     1033    20044
     1034    20045        /****
     1035    20046        *
     1036    20047        *   Release the input file, save the output file.  This is the normal,
     1037    20048        *   desired condition.
     1038    20049        *
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:115  
     1039    20050        ****/
     1040    20051
     1041    20052    1   REL_INP_SAV_OUT:
     1042    20053    1      if B$JIT.PRIV.ACTIVE.JIT

  20053 12 001125   000000 470400 xsym  REL_INP_SAV* LDP0    B$JIT$
        12 001126   000013 236100                    LDQ     11,,PR0
        12 001127   000040 316007                    CANQ    32,DL
        12 001130   001134 600000 12                 TZE     s:20055

     1043    20054    1        then B$JIT.PRIV.ACTIVE=(%PR_JIT#|%PR_FMSEC#);

  20054 12 001131   000111 236000 3                  LDQ     GOOD_PATTERN+8
        12 001132   000150 276000 3                  ORQ     GOOD_PATTERN+39
        12 001133   000013 756100                    STQ     11,,PR0

     1044    20055    2      IF JIPTR->DUMMY.FCD# THEN DO;

  20055 12 001134   004275 471400 0                  LDP1    JIPTR
        12 001135   100031 236100                    LDQ     25,,PR1
        12 001136   020000 316007                    CANQ    8192,DL
        12 001137   001145 600000 12                 TZE     s:20059

     1045    20056    2         CLOSE_JI.V.DISP#=%RELEASE#;

  20056 12 001140   000001 236007                    LDQ     1,DL
        12 001141   001750 552004 0                  STBQ    CLOSE_JI+26,'04'O

     1046    20057    2         CALL M$CLOSE(CLOSE_JI);

  20057 12 001142   001716 630400 0                  EPPR0   CLOSE_JI
        12 001143   050001 713400                    CLIMB   close
        12 001144   406000 401760                    pmme    nvectors=13

     1047    20058    2         END;

     1048    20059    2      IF JEPTR->DUMMY.FCD# THEN DO;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:116  

  20059 12 001145   004276 470400 0                  LDP0    JEPTR
        12 001146   000031 236100                    LDQ     25,,PR0
        12 001147   020000 316007                    CANQ    8192,DL
        12 001150   001156 600000 12                 TZE     s:20063

     1049    20060    2         CLOSE_JE.V.DISP#=%SAVE#;

  20060 12 001151   000002 236007                    LDQ     2,DL
        12 001152   002504 552004 0                  STBQ    CLOSE_JE+26,'04'O

     1050    20061    2         CALL M$CLOSE(CLOSE_JE);

  20061 12 001153   002452 630400 0                  EPPR0   CLOSE_JE
        12 001154   050001 713400                    CLIMB   close
        12 001155   406000 401760                    pmme    nvectors=13

     1051    20062    2         END;

     1052    20063    1      CALL CLOSE_THE_MAIL_FILE;

  20063 12 001156   002561 701000 12                 TSX1    CLOSE_THE_MAIL_FILE
        12 001157   000000 011000                    NOP     0

     1053    20064    1      GOTO NEXT_FILE;

  20064 12 001160   000351 710000 12                 TRA     NEXT_FILE

     1054    20065
     1055    20066        /****
     1056    20067        *
     1057    20068        *   Release both the input and output files.  This is used to trash
     1058    20069        *   an offensive file and anything that we might have done whilst
     1059    20070        *   processing it.
     1060    20071        *
     1061    20072        ****/
     1062    20073
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:117  
     1063    20074    1   REL_INP_REL_OUT:
     1064    20075    1      if B$JIT.PRIV.ACTIVE.JIT

  20075 12 001161   000000 470400 xsym  REL_INP_REL* LDP0    B$JIT$
        12 001162   000013 236100                    LDQ     11,,PR0
        12 001163   000040 316007                    CANQ    32,DL
        12 001164   001170 600000 12                 TZE     s:20077

     1065    20076    1        then B$JIT.PRIV.ACTIVE=(%PR_JIT#|%PR_FMSEC#);

  20076 12 001165   000111 236000 3                  LDQ     GOOD_PATTERN+8
        12 001166   000150 276000 3                  ORQ     GOOD_PATTERN+39
        12 001167   000013 756100                    STQ     11,,PR0

     1066    20077    2      IF JIPTR->DUMMY.FCD# THEN DO;

  20077 12 001170   004275 471400 0                  LDP1    JIPTR
        12 001171   100031 236100                    LDQ     25,,PR1
        12 001172   020000 316007                    CANQ    8192,DL
        12 001173   001201 600000 12                 TZE     s:20081

     1067    20078    2         CLOSE_JI.V.DISP#=%RELEASE#;

  20078 12 001174   000001 236007                    LDQ     1,DL
        12 001175   001750 552004 0                  STBQ    CLOSE_JI+26,'04'O

     1068    20079    2         CALL M$CLOSE(CLOSE_JI);

  20079 12 001176   001716 630400 0                  EPPR0   CLOSE_JI
        12 001177   050001 713400                    CLIMB   close
        12 001200   406000 401760                    pmme    nvectors=13

     1069    20080    2         END;

     1070    20081    2      IF JEPTR->DUMMY.FCD# THEN DO;

  20081 12 001201   004276 470400 0                  LDP0    JEPTR
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:118  
        12 001202   000031 236100                    LDQ     25,,PR0
        12 001203   020000 316007                    CANQ    8192,DL
        12 001204   001212 600000 12                 TZE     s:20085

     1071    20082    2         CLOSE_JE.V.DISP#=%RELEASE#;

  20082 12 001205   000001 236007                    LDQ     1,DL
        12 001206   002504 552004 0                  STBQ    CLOSE_JE+26,'04'O

     1072    20083    2         CALL M$CLOSE(CLOSE_JE);

  20083 12 001207   002452 630400 0                  EPPR0   CLOSE_JE
        12 001210   050001 713400                    CLIMB   close
        12 001211   406000 401760                    pmme    nvectors=13

     1073    20084    2         END;

     1074    20085    1      CALL CLOSE_THE_MAIL_FILE;

  20085 12 001212   002561 701000 12                 TSX1    CLOSE_THE_MAIL_FILE
        12 001213   000000 011000                    NOP     0

     1075    20086    1      GOTO NEXT_FILE;

  20086 12 001214   000351 710000 12                 TRA     NEXT_FILE

     1076    20087
     1077    20088        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:119  
     1078    20089        /****
     1079    20090        *
     1080    20091        *   Handle transferring a message packet from this machine to
     1081    20092        *   another:  Fetch the destination node's :NODES record to find
     1082    20093        *   the (next) path to send it down in order that it will get to
     1083    20094        *   its ultimate destination.  Then simply copy the records from
     1084    20095        *   the input file to the output path.  No editing is done.
     1085    20096        *
     1086    20097        ****/
     1087    20098
     1088    20099    1   DO_POST:
     1089    20100    1      NODEKEY.C=SUBSTR(JIBUF,72,8);

  20100 12 001215   040000 100400       DO_POST      MLR     fill='040'O
        12 001216   004363 000010 0                  ADSC9   JIBUF+18                 cn=0,n=8
        12 001217   001136 200010 0                  ADSC9   NODEKEY                  cn=1,n=8

     1090    20101    1      CALL M$READ(READ_NODE) ALTRET(BAD_DST);

  20101 12 001220   001062 630400 0                  EPPR0   READ_NODE
        12 001221   440000 713400                    CLIMB   alt,read
        12 001222   401400 401760                    pmme    nvectors=4
        12 001223   000774 702000 12                 TSX2    BAD_DST

     1091    20102    2      IF DCBADDR(DCBNUM(M$NODE))->DUMMY.ARS#=8 THEN DO;

  20102 12 001224   000000 236007 xsym               LDQ     M$NODE,DL
        12 001225   000003 470400 13                 LDP0    3
        12 001226   000000 471500                    LDP1    0,,PR0
        12 001227   100000 473506                    LDP3    0,QL,PR1
        12 001230   300000 235100                    LDA     0,,PR3
        12 001231   000010 115007                    CMPA    8,DL
        12 001232   001242 601000 12                 TNZ     s:20118

     1092    20103    2         NODEKEY.C=NODEOVR.PATH_NAME;

  20103 12 001233   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:120  
        12 001234   001141 000010 0                  ADSC9   NODEOVR                  cn=0,n=8
        12 001235   001136 200010 0                  ADSC9   NODEKEY                  cn=1,n=8

     1093    20104    2         CALL M$READ(READ_NODE) ALTRET(BAD_DST);

  20104 12 001236   001062 630400 0                  EPPR0   READ_NODE
        12 001237   440000 713400                    CLIMB   alt,read
        12 001240   401400 401760                    pmme    nvectors=4
        12 001241   000774 702000 12                 TSX2    BAD_DST

     1094    20105    2         END;

     1095    20106
     1096    20107        /****
     1097    20108        *
     1098    20109        *   Disallow MOVEing from non-Honeywell to non-Honeywell sites
     1099    20110        *   if we are the L66A system.  We do this by examining the CODE11
     1100    20111        *   entry in the FIT of the JI file, which is built by INSYM.  It
     1101    20112        *   contains the WSN (pathname) of the originating station.  Since
     1102    20113        *   This is built on the L66A system by the L66A system, there is
     1103    20114        *   no way for a customer to circumvent it.
     1104    20115        *
     1105    20116        ****/
     1106    20117
     1107    20118    2      IF VW_IAM#='L66A' THEN DO;

  20118 12 001242   040000 106400                    CMPC    fill='040'O
        12 001243   006441 000010 0                  ADSC9   VW_IAM#                  cn=0,n=8
        12 001244   000167 000004 3                  ADSC9   GOOD_PATTERN+54          cn=0,n=4
        12 001245   001351 601000 12                 TNZ     s:20146

     1108    20119    2         P=ADDR(FITBUF);

  20119 12 001246   000033 236000 13                 LDQ     27
        12 001247   004300 756000 0                  STQ     P

     1109    20120    2         I=1;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:121  

  20120 12 001250   000001 235007                    LDA     1,DL
        12 001251   004302 755000 0                  STA     I

     1110    20121    3         DO WHILE(I<=P->FM$FIT.CODES.CODE(0) AND P->FM$FIT.CODES.CODE(I)~=11);

  20121 12 001252   001254 710000 12                 TRA     s:20123

     1111    20122    3            I=I+1;

  20122 12 001253   004302 054000 0                  AOS     I

     1112    20123    3            END;

  20123 12 001254   004300 470400 0                  LDP0    P
        12 001255   000000 236100                    LDQ     0,,PR0
        12 001256   000037 772000                    QRL     31
        12 001257   004302 116000 0                  CMPQ    I
        12 001260   001266 604000 12                 TMI     s:20124
        12 001261   004302 720000 0                  LXL0    I
        12 001262   000000 236110                    LDQ     0,X0,PR0
        12 001263   760000 376003                    ANQ     -8192,DU
        12 001264   260000 116003                    CMPQ    90112,DU
        12 001265   001253 601000 12                 TNZ     s:20122

     1113    20124    3         IF I<=P->FM$FIT.CODES.CODE(0) THEN DO;

  20124 12 001266   000000 236100                    LDQ     0,,PR0
        12 001267   000037 772000                    QRL     31
        12 001270   004302 116000 0                  CMPQ    I
        12 001271   001351 604000 12                 TMI     s:20146

     1114    20125    3            P=PINCRW(P,P->FM$FIT.CODES.ITEMX(I));

  20125 12 001272   004302 720000 0                  LXL0    I
        12 001273   000000 721110                    LXL1    0,X0,PR0
        12 001274   001777 361003                    ANX1    1023,DU
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:122  
        12 001275   000000 636011                    EAQ     0,X1
        12 001276   004300 036000 0                  ADLQ    P
        12 001277   004300 756000 0                  STQ     P

     1115    20126    3            IF P->FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME~='L66A'

  20126 12 001300   004300 470400 0                  LDP0    P
        12 001301   040000 106500                    CMPC    fill='040'O
        12 001302   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        12 001303   000167 000004 3                  ADSC9   GOOD_PATTERN+54          cn=0,n=4
        12 001304   001351 600000 12                 TZE     s:20146
        12 001305   040000 106500                    CMPC    fill='040'O
        12 001306   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        12 001307   000170 000004 3                  ADSC9   GOOD_PATTERN+55          cn=0,n=4
        12 001310   001351 600000 12                 TZE     s:20146
        12 001311   040000 106500                    CMPC    fill='040'O
        12 001312   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        12 001313   000171 000004 3                  ADSC9   GOOD_PATTERN+56          cn=0,n=4
        12 001314   001351 600000 12                 TZE     s:20146
        12 001315   040000 106500                    CMPC    fill='040'O
        12 001316   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        12 001317   000172 000004 3                  ADSC9   GOOD_PATTERN+57          cn=0,n=4
        12 001320   001351 600000 12                 TZE     s:20146
        12 001321   040000 106500                    CMPC    fill='040'O
        12 001322   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        12 001323   000173 000003 3                  ADSC9   GOOD_PATTERN+58          cn=0,n=3
        12 001324   001351 600000 12                 TZE     s:20146
        12 001325   040000 106400                    CMPC    fill='040'O
        12 001326   001143 000010 0                  ADSC9   NODEOVR+2                cn=0,n=8
        12 001327   000167 000004 3                  ADSC9   GOOD_PATTERN+54          cn=0,n=4
        12 001330   001351 600000 12                 TZE     s:20146
        12 001331   040000 106400                    CMPC    fill='040'O
        12 001332   001143 000010 0                  ADSC9   NODEOVR+2                cn=0,n=8
        12 001333   000170 000004 3                  ADSC9   GOOD_PATTERN+55          cn=0,n=4
        12 001334   001351 600000 12                 TZE     s:20146
        12 001335   040000 106400                    CMPC    fill='040'O
        12 001336   001143 000010 0                  ADSC9   NODEOVR+2                cn=0,n=8
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:123  
        12 001337   000171 000004 3                  ADSC9   GOOD_PATTERN+56          cn=0,n=4
        12 001340   001351 600000 12                 TZE     s:20146
        12 001341   040000 106400                    CMPC    fill='040'O
        12 001342   001143 000010 0                  ADSC9   NODEOVR+2                cn=0,n=8
        12 001343   000172 000004 3                  ADSC9   GOOD_PATTERN+57          cn=0,n=4
        12 001344   001351 600000 12                 TZE     s:20146
        12 001345   040000 106400                    CMPC    fill='040'O
        12 001346   001143 000010 0                  ADSC9   NODEOVR+2                cn=0,n=8
        12 001347   000173 000003 3                  ADSC9   GOOD_PATTERN+58          cn=0,n=3
        12 001350   001161 601000 12                 TNZ     REL_INP_REL_OUT

     1116    20127    3              AND P->FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME~='L66B'
     1117    20128    3              AND P->FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME~='L66C'
     1118    20129    3              AND P->FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME~='L66D'
     1119    20130    3              AND P->FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME~='BMS' AND
     1120    20131    3              NODEOVR.NODE_NAME~='L66A' AND NODEOVR.NODE_NAME~='L66B' AND
     1121    20132    3              NODEOVR.NODE_NAME~='L66C' AND NODEOVR.NODE_NAME~='L66D' AND
     1122    20133    3              NODEOVR.NODE_NAME~='BMS' THEN
     1123    20134    3               GOTO REL_INP_REL_OUT;
     1124    20135    3            END;

     1125    20136    2         END;

     1126    20137
     1127    20138        /****
     1128    20139        *
     1129    20140        *   Looks OK, so let's ship it.  Reset the PO count, since we're
     1130    20141        *   "punching cards", to allow for the maximum file size (about 1,000
     1131    20142        *   granules or so).  Then open the JE stream to the specified node.
     1132    20143        *
     1133    20144        ****/
     1134    20145
     1135    20146    1      if B$JIT.PRIV.ACTIVE.JIT

  20146 12 001351   000000 470400 xsym               LDP0    B$JIT$
        12 001352   000013 236100                    LDQ     11,,PR0
        12 001353   000040 316007                    CANQ    32,DL
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:124  
        12 001354   001357 600000 12                 TZE     s:20148

     1136    20147    1        then B$JIT.REMCPO=131071;

  20147 12 001355   377777 235007                    LDA     131071,DL
        12 001356   000360 755100                    STA     240,,PR0

     1137    20148    1      WSN_JE.WSN#=NODEOVR.PATH_NAME;

  20148 12 001357   040000 100400                    MLR     fill='040'O
        12 001360   001141 000010 0                  ADSC9   NODEOVR                  cn=0,n=8
        12 001361   002434 000010 0                  ADSC9   WSN_JE                   cn=0,n=8

     1138    20149    1      WRITE_JE.BUF_.BOUND=79;

  20149 12 001362   002442 236000 0                  LDQ     WRITE_JE+4
        12 001363   177777 376007                    ANQ     65535,DL
        12 001364   000034 276000 13                 ORQ     28
        12 001365   002442 756000 0                  STQ     WRITE_JE+4

     1139    20150    1      CALL M$OPEN(OPEN_JE) ALTRET(BAD_VIA);

  20150 12 001366   002342 630400 0                  EPPR0   OPEN_JE
        12 001367   450000 713400                    CLIMB   alt,open
        12 001370   410400 401760                    pmme    nvectors=18
        12 001371   001030 702000 12                 TSX2    BAD_VIA

     1140    20151
     1141    20152        /****
     1142    20153        *
     1143    20154        *   Supply the header appropriate for this type of node.
     1144    20155        *
     1145    20156        ****/
     1146    20157
     1147    20158    1      I=NODEOVR.TYPE_PATH;

  20158 12 001372   001145 236000 0                  LDQ     NODEOVR+4
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:125  
        12 001373   000011 772000                    QRL     9
        12 001374   000777 376007                    ANQ     511,DL
        12 001375   004302 756000 0                  STQ     I

     1148    20159    1      CALL VWH$HEADER(DCBNUM(M$JE),JEBUF,I) ALTRET(BAD_WRM);

  20159 12 001376   000000 236007 xsym               LDQ     M$JE,DL
        12 001377   006600 756000 0                  STQ     OPT$+3
        12 001400   000036 237000 13                 LDAQ    30
        12 001401   006602 757000 0                  STAQ    OPT$+5
        12 001402   006600 630400 0                  EPPR0   OPT$+3
        12 001403   006601 450400 0                  STP0    OPT$+4
        12 001404   006601 630400 0                  EPPR0   OPT$+4
        12 001405   000017 631400 13                 EPPR1   15
        12 001406   000000 701000 xent               TSX1    VWH$HEADER
        12 001407   001033 702000 12                 TSX2    BAD_WRM

     1149    20160
     1150    20161        /****
     1151    20162        *
     1152    20163        *   Recall that we have one extra record already in JIBUF, and that
     1153    20164        *   it has been descrambled.
     1154    20165        *
     1155    20166        ****/
     1156    20167
     1157    20168    1      JEBUF=JIBUF;

  20168 12 001410   040000 100400                    MLR     fill='040'O
        12 001411   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80
        12 001412   004365 000120 0                  ADSC9   JEBUF                    cn=0,n=80

     1158    20169    1      IF VW_SCRAMBLE# THEN

  20169 12 001413   006443 234000 0                  SZN     VW_SCRAMBLE#
        12 001414   001421 605000 12                 TPL     s:20171

     1159    20170    1         CALL VWO$TRANSO(JEBUF);
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:126  

  20170 12 001415   000036 630400 13                 EPPR0   30
        12 001416   000000 631400 13                 EPPR1   0
        12 001417   000000 701000 xent               TSX1    VWO$TRANSO
        12 001420   000000 011000                    NOP     0

     1160    20171    1      CALL M$WRITE(WRITE_JE) ALTRET(BAD_WRM);

  20171 12 001421   002436 630400 0                  EPPR0   WRITE_JE
        12 001422   440001 713400                    CLIMB   alt,write
        12 001423   401400 401760                    pmme    nvectors=4
        12 001424   001033 702000 12                 TSX2    BAD_WRM

     1161    20172
     1162    20173        /****
     1163    20174        *
     1164    20175        *   Now simply read and write until EOF.  Strip the EOF record from the file.
     1165    20176        *
     1166    20177        ****/
     1167    20178
     1168    20179    2      DO WHILE('1'B);

     1169    20180    2         JIBUF=' ';

  20180 12 001425   040000 100400                    MLR     fill='040'O
        12 001426   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 001427   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80

     1170    20181    2         CALL M$READ(READ_JI) ALTRET(POST_EOF);

  20181 12 001430   001666 630400 0                  EPPR0   READ_JI
        12 001431   440000 713400                    CLIMB   alt,read
        12 001432   401400 401760                    pmme    nvectors=4
        12 001433   001455 702000 12                 TSX2    POST_EOF

     1171    20182    2         JEBUF=JIBUF;

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:127  
  20182 12 001434   040000 100400                    MLR     fill='040'O
        12 001435   004341 000120 0                  ADSC9   JIBUF                    cn=0,n=80
        12 001436   004365 000120 0                  ADSC9   JEBUF                    cn=0,n=80

     1172    20183    2         IF VW_SCRAMBLE# THEN

  20183 12 001437   006443 234000 0                  SZN     VW_SCRAMBLE#
        12 001440   001445 605000 12                 TPL     s:20185

     1173    20184    2            CALL VWI$TRANSI(JIBUF);

  20184 12 001441   000011 630400 13                 EPPR0   9
        12 001442   000000 631400 13                 EPPR1   0
        12 001443   000000 701000 xent               TSX1    VWI$TRANSI
        12 001444   000000 011000                    NOP     0

     1174    20185    2         IF SUBSTR(JEBUF,0,4)~=' EOF' THEN

  20185 12 001445   004365 236000 0                  LDQ     JEBUF
        12 001446   000174 116000 3                  CMPQ    GOOD_PATTERN+59
        12 001447   001425 600000 12                 TZE     s:20180

     1175    20186    2            CALL M$WRITE(WRITE_JE) ALTRET(BAD_WRM);

  20186 12 001450   002436 630400 0                  EPPR0   WRITE_JE
        12 001451   440001 713400                    CLIMB   alt,write
        12 001452   401400 401760                    pmme    nvectors=4
        12 001453   001033 702000 12                 TSX2    BAD_WRM

     1176    20187    2         END;

  20187 12 001454   001425 710000 12                 TRA     s:20180

     1177    20188
     1178    20189        /****
     1179    20190        *
     1180    20191        *   If we didn't get here via EOF, we're in trouble.
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:128  
     1181    20192        *
     1182    20193        ****/
     1183    20194
     1184    20195    1   POST_EOF:
     1185    20196    1      IF (JIPTR->DUMMY.TYC&'104200000000'O)='0'B THEN

  20196 12 001455   004275 470400 0     POST_EOF     LDP0    JIPTR
        12 001456   000002 236100                    LDQ     2,,PR0
        12 001457   000175 376000 3                  ANQ     GOOD_PATTERN+60
        12 001460   001036 600000 12                 TZE     BAD_RJI

     1186    20197    1         GOTO BAD_RJI;
     1187    20198
     1188    20199        /****
     1189    20200        *
     1190    20201        *   Supply appropriate closing text, then ship this sucker.
     1191    20202        *
     1192    20203        ****/
     1193    20204
     1194    20205    1      I=NODEOVR.TYPE_PATH;

  20205 12 001461   001145 236000 0                  LDQ     NODEOVR+4
        12 001462   000011 772000                    QRL     9
        12 001463   000777 376007                    ANQ     511,DL
        12 001464   004302 756000 0                  STQ     I

     1195    20206    1      CALL VWF$FOOTER(DCBNUM(M$JE),JEBUF,I) ALTRET(BAD_WRM);

  20206 12 001465   000000 236007 xsym               LDQ     M$JE,DL
        12 001466   006600 756000 0                  STQ     OPT$+3
        12 001467   000036 237000 13                 LDAQ    30
        12 001470   006602 757000 0                  STAQ    OPT$+5
        12 001471   006600 631400 0                  EPPR1   OPT$+3
        12 001472   006601 451400 0                  STP1    OPT$+4
        12 001473   006601 630400 0                  EPPR0   OPT$+4
        12 001474   000017 631400 13                 EPPR1   15
        12 001475   000000 701000 xent               TSX1    VWF$FOOTER
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:129  
        12 001476   001033 702000 12                 TSX2    BAD_WRM

     1196    20207    1      GOTO REL_INP_SAV_OUT;

  20207 12 001477   001125 710000 12                 TRA     REL_INP_SAV_OUT

     1197    20208
     1198    20209        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:130  
     1199    20210        /****
     1200    20211        *
     1201    20212        *   Handle a "SUCK" request (which turns into a BEAM at this end).
     1202    20213        *   Assume the user's identity specified in the SUCK record (card
     1203    20214        *   0) and try to "logon" by accessing :USERS and :HLP.  Merge
     1204    20215        *   the user's privileges into the JIT, but keep JIT access on
     1205    20216        *   regardless.  If a MAIL record is present, open M$MAIL to the
     1206    20217        *   proper file and write the header information.
     1207    20218        *
     1208    20219        ****/
     1209    20220
     1210    20221    1   DO_SUCK:
     1211    20222    1      IF OPTS.MAILINIT.CMD='MAIL' OR OPTS.MAILSNDR.CMD='MAIL' THEN

  20222 12 001500   000241 236000 0     DO_SUCK      LDQ     VW_OPTIONS#+160
        12 001501   000165 116000 3                  CMPQ    GOOD_PATTERN+52
        12 001502   001506 600000 12                 TZE     s:20223
        12 001503   000121 236000 0                  LDQ     VW_OPTIONS#+80
        12 001504   000165 116000 3                  CMPQ    GOOD_PATTERN+52
        12 001505   001512 601000 12                 TNZ     s:20231

     1212    20223    1         CALL OPEN_THE_MAIL_FILE('SNDR');

  20223 12 001506   000035 236000 13                 LDQ     29
        12 001507   006445 756000 0                  STQ     VW_SCRAMBLE#+2
        12 001510   001605 701000 12                 TSX1    OPEN_THE_MAIL_FILE
        12 001511   000000 011000                    NOP     0

     1213    20224
     1214    20225        /****
     1215    20226        *
     1216    20227        *   Check to make sure that the packet survived transmission OK.
     1217    20228        *
     1218    20229        ****/
     1219    20230
     1220    20231    1      CALL CHECK_PACKET ALTRET (BAD_TRANSLATION);

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:131  
  20231 12 001512   002727 701000 12                 TSX1    CHECK_PACKET
        12 001513   001005 702000 12                 TSX2    BAD_TRANSLATION

     1221    20232
     1222    20233    1      CALL IMPERSONATE_USER(OPTS.INP) ALTRET(BAD_LGN);

  20233 12 001514   000040 236000 13                 LDQ     32
        12 001515   006571 756000 0                  STQ     J+2
        12 001516   002321 701000 12                 TSX1    IMPERSONATE_USER
        12 001517   000777 702000 12                 TSX2    BAD_LGN

     1223    20234
     1224    20235        /****
     1225    20236        *
     1226    20237        *   Disallow use of :MAIL,500ATOB as a legal logon for a SUCK.
     1227    20238        *
     1228    20239        ****/
     1229    20240
     1230    20241    1      IF B$JIT.ACCN=':MAIL' AND B$JIT.UNAME='500ATOB' THEN

  20241 12 001520   000000 470400 xsym               LDP0    B$JIT$
        12 001521   040000 106500                    CMPC    fill='040'O
        12 001522   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        12 001523   000177 000005 3                  ADSC9   GOOD_PATTERN+62          cn=0,n=5
        12 001524   001531 601000 12                 TNZ     s:20243
        12 001525   040000 106500                    CMPC    fill='040'O
        12 001526   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12
        12 001527   000201 000007 3                  ADSC9   GOOD_PATTERN+64          cn=0,n=7
        12 001530   001002 600000 12                 TZE     BAD_SUK

     1231    20242    1         GOTO BAD_SUK;
     1232    20243    1      CALL VWB$BEAM ALTRET(SUCK_BUSY);

  20243 12 001531   000041 631400 13                 EPPR1   33
        12 001532   000000 701000 xent               TSX1    VWB$BEAM
        12 001533   001535 702000 12                 TSX2    SUCK_BUSY

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:132  
     1233    20244    1      GOTO REL_INP_SAV_OUT;

  20244 12 001534   001125 710000 12                 TRA     REL_INP_SAV_OUT

     1234    20245
     1235    20246        /****
     1236    20247        *
     1237    20248        *   If VWB$BEAM ALTRETs, check to see if the file was busy or
     1238    20249        *   the packset wasn't up.  If so, keep this request packet
     1239    20250        *   around for processing later.
     1240    20251        *
     1241    20252        ****/
     1242    20253
     1243    20254    1   SUCK_BUSY:
     1244    20255    2      IF OPTS.MAILINIT.CMD='BUSY' THEN DO;

  20255 12 001535   000241 236000 0     SUCK_BUSY    LDQ     VW_OPTIONS#+160
        12 001536   000203 116000 3                  CMPQ    GOOD_PATTERN+66
        12 001537   001546 601000 12                 TNZ     s:20260

     1245    20256    2         CLOSE_MAIL.V.DISP#=%RELEASE#;

  20256 12 001540   000001 236007                    LDQ     1,DL
        12 001541   001412 552004 0                  STBQ    CLOSE_MAIL+26,'04'O

     1246    20257    2         CALL M$CLOSE(CLOSE_MAIL);

  20257 12 001542   001360 630400 0                  EPPR0   CLOSE_MAIL
        12 001543   050001 713400                    CLIMB   close
        12 001544   406000 401760                    pmme    nvectors=13

     1247    20258    2         GOTO SAV_INP_REL_OUT;

  20258 12 001545   001071 710000 12                 TRA     SAV_INP_REL_OUT

     1248    20259    2         END;
     1249    20260    1      GOTO REL_INP_REL_OUT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:133  

  20260 12 001546   001161 710000 12                 TRA     REL_INP_REL_OUT

     1250    20261
     1251    20262        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:134  
     1252    20263        /****
     1253    20264        *
     1254    20265        *   Perform a "BEAM" command (which turns into "EVOM" here).
     1255    20266        *   Assume the user's identity specified in the BEAM record (card
     1256    20267        *   2) and try to "logon" by accessing :USERS and :HLP.  Merge
     1257    20268        *   the user's privileges into the JIT, but keep JIT access on
     1258    20269        *   regardless.  If a MAIL is requested, open the M$MAIL file to
     1259    20270        *   the appropriate file and initialize it.
     1260    20271        *
     1261    20272        ****/
     1262    20273
     1263    20274    1   DO_BEAM:
     1264    20275    1      IF OPTS.MAILINIT.CMD='MAIL' OR OPTS.MAILRCVR.CMD='MAIL' THEN

  20275 12 001547   000241 236000 0     DO_BEAM      LDQ     VW_OPTIONS#+160
        12 001550   000165 116000 3                  CMPQ    GOOD_PATTERN+52
        12 001551   001555 600000 12                 TZE     s:20276
        12 001552   000171 236000 0                  LDQ     VW_OPTIONS#+120
        12 001553   000165 116000 3                  CMPQ    GOOD_PATTERN+52
        12 001554   001561 601000 12                 TNZ     s:20284

     1265    20276    1         CALL OPEN_THE_MAIL_FILE('RCVR');

  20276 12 001555   000042 236000 13                 LDQ     34
        12 001556   006445 756000 0                  STQ     VW_SCRAMBLE#+2
        12 001557   001605 701000 12                 TSX1    OPEN_THE_MAIL_FILE
        12 001560   000000 011000                    NOP     0

     1266    20277
     1267    20278        /****
     1268    20279        *
     1269    20280        *   Check to make sure that the packet survived transmission OK.
     1270    20281        *
     1271    20282        ****/
     1272    20283
     1273    20284    1      CALL CHECK_PACKET ALTRET (BAD_TRANSLATION);

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:135  
  20284 12 001561   002727 701000 12                 TSX1    CHECK_PACKET
        12 001562   001005 702000 12                 TSX2    BAD_TRANSLATION

     1274    20285
     1275    20286    1      CALL IMPERSONATE_USER(OPTS.OUT) ALTRET(BAD_LGN);

  20286 12 001563   000043 236000 13                 LDQ     35
        12 001564   006571 756000 0                  STQ     J+2
        12 001565   002321 701000 12                 TSX1    IMPERSONATE_USER
        12 001566   000777 702000 12                 TSX2    BAD_LGN

     1276    20287    1      CALL VWE$EVOM ALTRET(BEAM_BUSY);

  20287 12 001567   000041 631400 13                 EPPR1   33
        12 001570   000000 701000 xent               TSX1    VWE$EVOM
        12 001571   001573 702000 12                 TSX2    BEAM_BUSY

     1277    20288    1      GOTO REL_INP_SAV_OUT;

  20288 12 001572   001125 710000 12                 TRA     REL_INP_SAV_OUT

     1278    20289
     1279    20290        /****
     1280    20291        *
     1281    20292        *   If VWE$EVOM ALTRETs, check to see if the file was busy or
     1282    20293        *   the packset wasn't up.  If so, keep this request packet
     1283    20294        *   around for later processing.
     1284    20295        *
     1285    20296        ****/
     1286    20297
     1287    20298    1   BEAM_BUSY:
     1288    20299    2      IF OPTS.MAILINIT.CMD='BUSY' THEN DO;

  20299 12 001573   000241 236000 0     BEAM_BUSY    LDQ     VW_OPTIONS#+160
        12 001574   000203 116000 3                  CMPQ    GOOD_PATTERN+66
        12 001575   001604 601000 12                 TNZ     s:20304

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:136  
     1289    20300    2         CLOSE_MAIL.V.DISP#=%RELEASE#;

  20300 12 001576   000001 236007                    LDQ     1,DL
        12 001577   001412 552004 0                  STBQ    CLOSE_MAIL+26,'04'O

     1290    20301    2         CALL M$CLOSE(CLOSE_MAIL);

  20301 12 001600   001360 630400 0                  EPPR0   CLOSE_MAIL
        12 001601   050001 713400                    CLIMB   close
        12 001602   406000 401760                    pmme    nvectors=13

     1291    20302    2         GOTO SAV_INP_REL_OUT;

  20302 12 001603   001071 710000 12                 TRA     SAV_INP_REL_OUT

     1292    20303    2         END;
     1293    20304    1      GOTO REL_INP_REL_OUT;

  20304 12 001604   001161 710000 12                 TRA     REL_INP_REL_OUT

     1294    20305
     1295    20306        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:137  
     1296    20307        /*I**
     1297    20308        *
     1298    20309        *   NAME:  OPEN_THE_MAIL_FILE
     1299    20310        *
     1300    20311        *   PURPOSE:
     1301    20312        *       To open the M$MAIL DCB to the proper destination.
     1302    20313        *
     1303    20314        *   CALL:
     1304    20315        *       CALL OPEN_THE_MAIL_FILE(who)
     1305    20316        *
     1306    20317        *   PARAMETERS:
     1307    20318        *       who - is either 'RCVR' or 'SNDR', describing which MAIL record set
     1308    20319        *       from VW_OPTIONS# is to be used as the mailbox address.
     1309    20320        *
     1310    20321        *   DATA:
     1311    20322        *       VW_MAILKEY# and VW_MAILBUF# are set and/or used.  The VW_OPTIONS#
     1312    20323        *       block is used heavily.  The MAIL FPTs are also used.
     1313    20324        *
     1314    20325        *   DESCRIPTION:
     1315    20326        *       Open the M$MAIL DCB to the proper destination.  WHO defines the
     1316    20327        *       mailbox to open.
     1317    20328        *
     1318    20329        ****/
     1319    20330
     1320    20331    1   OPEN_THE_MAIL_FILE: PROC(WHO);

  20331 12 001605   006444 741200 0     OPEN_THE_MA* STX1  ! VW_SCRAMBLE#+1

     1321    20332
     1322    20333    2   DCL WHO                            CHAR(4);
     1323    20334
     1324    20335    2   DCL 1 MAILBOX,
     1325    20336    2             2 L UNAL                     UBIN BYTE,
     1326    20337    2             2 C UNAL                     CHAR(79);
     1327    20338
     1328    20339
     1329    20340        /****
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:138  
     1330    20341        *
     1331    20342        *   Open the temp file for mail messages.  We must do this because we
     1332    20343        *   don't know the subject line (which is actually the result) until
     1333    20344        *   after the BEAM/EVOM process is done.
     1334    20345        *
     1335    20346        ****/
     1336    20347
     1337    20348    2      CALL M$OPEN(OPEN_MAIL) ALTRET(OTMF_ALTRET);

  20348 12 001606   001246 630400 0                  EPPR0   OPEN_MAIL
        12 001607   450000 713400                    CLIMB   alt,open
        12 001610   410400 401760                    pmme    nvectors=18
        12 001611   001773 702000 12                 TSX2    OTMF_ALTRET

     1338    20349
     1339    20350        /****
     1340    20351        *
     1341    20352        *   Generate the TO: line (line 1.000).  Send mail to the initiator,
     1342    20353        *   if requested, and to either the receiver or sender, based on WHO.
     1343    20354        *
     1344    20355        ****/
     1345    20356
     1346    20357    2      VW_MAILKEY#.L=3;

  20357 12 001612   003000 236003                    LDQ     1536,DU
        12 001613   000000 552040 xsym               STBQ    VW_MAILKEY#,'40'O

     1347    20358    2      VW_MAILKEY#.C=1000;

  20358 12 001614   001750 236007                    LDQ     1000,DL
        12 001615   000000 552034 xsym               STBQ    VW_MAILKEY#,'34'O

     1348    20359    2      VW_MAILBUF#='TO:';

  20359 12 001616   040000 100400                    MLR     fill='040'O
        12 001617   000205 000003 3                  ADSC9   GOOD_PATTERN+68          cn=0,n=3
        12 001620   000000 000220 xsym               ADSC9   VW_MAILBUF#              cn=0,n=144
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:139  

     1349    20360    2      J=3;

  20360 12 001621   000003 235007                    LDA     3,DL
        12 001622   004303 755000 0                  STA     J

     1350    20361
     1351    20362    3      IF OPTS.MAILINIT.WHO~=' ' THEN DO;

  20362 12 001623   000242 236000 0                  LDQ     VW_OPTIONS#+161
        12 001624   777000 376003                    ANQ     -512,DU
        12 001625   040000 116003                    CMPQ    16384,DU
        12 001626   001651 600000 12                 TZE     s:20368

     1352    20363    3         CALL GENERATE_ADDRESS(OPTS.MAILINIT);

  20363 12 001627   000044 236000 13                 LDQ     36
        12 001630   006473 756000 0                  STQ     MAILBOX+21
        12 001631   002006 701000 12                 TSX1    GENERATE_ADDRESS
        12 001632   000000 011000                    NOP     0

     1353    20364    3         CALL INSERT(VW_MAILBUF#,J,MAILBOX.L,SUBSTR(MAILBOX.C,0,MAILBOX.L));

  20364 12 001633   006446 236000 0                  LDQ     MAILBOX
        12 001634   000033 772000                    QRL     27
        12 001635   000000 620006                    EAX0    0,QL
        12 001636   006446 236000 0                  LDQ     MAILBOX
        12 001637   000033 772000                    QRL     27
        12 001640   000000 621006                    EAX1    0,QL
        12 001641   004303 235000 0                  LDA     J
        12 001642   040045 100440                    MLR     fill='040'O
        12 001643   006446 200010 0                  ADSC9   MAILBOX                  cn=1,n=*X0
        12 001644   000000 000011 xsym               ADSC9   VW_MAILBUF#,A            cn=0,n=*X1

     1354    20365    3         J=J+MAILBOX.L;

  20365 12 001645   006446 236000 0                  LDQ     MAILBOX
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:140  
        12 001646   000033 772000                    QRL     27
        12 001647   004303 036000 0                  ADLQ    J
        12 001650   004303 756000 0                  STQ     J

     1355    20366    3         END;

     1356    20367
     1357    20368    3      IF WHO='SNDR' AND OPTS.MAILSNDR.WHO~=' ' THEN DO;

  20368 12 001651   006445 470400 0                  LDP0    @WHO
        12 001652   040000 106500                    CMPC    fill='040'O
        12 001653   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
        12 001654   000176 000004 3                  ADSC9   GOOD_PATTERN+61          cn=0,n=4
        12 001655   001713 601000 12                 TNZ     s:20378
        12 001656   000122 236000 0                  LDQ     VW_OPTIONS#+81
        12 001657   777000 376003                    ANQ     -512,DU
        12 001660   040000 116003                    CMPQ    16384,DU
        12 001661   001713 600000 12                 TZE     s:20378

     1358    20369    4         IF J>3 THEN DO;

  20369 12 001662   004303 235000 0                  LDA     J
        12 001663   000003 115007                    CMPA    3,DL
        12 001664   001671 604400 12                 TMOZ    s:20373

     1359    20370    4            CALL INSERT(VW_MAILBUF#,J,1,',');

  20370 12 001665   040005 100400                    MLR     fill='040'O
        12 001666   000045 000001 13                 ADSC9   37                       cn=0,n=1
        12 001667   000000 000001 xsym               ADSC9   VW_MAILBUF#,A            cn=0,n=1

     1360    20371    4            J=J+1;

  20371 12 001670   004303 054000 0                  AOS     J

     1361    20372    4            END;

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:141  
     1362    20373    3         CALL GENERATE_ADDRESS(OPTS.MAILSNDR);

  20373 12 001671   000046 236000 13                 LDQ     38
        12 001672   006473 756000 0                  STQ     MAILBOX+21
        12 001673   002006 701000 12                 TSX1    GENERATE_ADDRESS
        12 001674   000000 011000                    NOP     0

     1363    20374    3         CALL INSERT(VW_MAILBUF#,J,MAILBOX.L,SUBSTR(MAILBOX.C,0,MAILBOX.L));

  20374 12 001675   006446 236000 0                  LDQ     MAILBOX
        12 001676   000033 772000                    QRL     27
        12 001677   000000 620006                    EAX0    0,QL
        12 001700   006446 236000 0                  LDQ     MAILBOX
        12 001701   000033 772000                    QRL     27
        12 001702   000000 621006                    EAX1    0,QL
        12 001703   004303 235000 0                  LDA     J
        12 001704   040045 100440                    MLR     fill='040'O
        12 001705   006446 200010 0                  ADSC9   MAILBOX                  cn=1,n=*X0
        12 001706   000000 000011 xsym               ADSC9   VW_MAILBUF#,A            cn=0,n=*X1

     1364    20375    3         J=J+MAILBOX.L;

  20375 12 001707   006446 236000 0                  LDQ     MAILBOX
        12 001710   000033 772000                    QRL     27
        12 001711   004303 036000 0                  ADLQ    J
        12 001712   004303 756000 0                  STQ     J

     1365    20376    3         END;

     1366    20377
     1367    20378    3      IF WHO='RCVR' AND OPTS.MAILRCVR.WHO~=' ' THEN DO;

  20378 12 001713   006445 470400 0                  LDP0    @WHO
        12 001714   040000 106500                    CMPC    fill='040'O
        12 001715   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
        12 001716   000204 000004 3                  ADSC9   GOOD_PATTERN+67          cn=0,n=4
        12 001717   001755 601000 12                 TNZ     s:20388
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:142  
        12 001720   000172 236000 0                  LDQ     VW_OPTIONS#+121
        12 001721   777000 376003                    ANQ     -512,DU
        12 001722   040000 116003                    CMPQ    16384,DU
        12 001723   001755 600000 12                 TZE     s:20388

     1368    20379    4         IF J>3 THEN DO;

  20379 12 001724   004303 235000 0                  LDA     J
        12 001725   000003 115007                    CMPA    3,DL
        12 001726   001733 604400 12                 TMOZ    s:20383

     1369    20380    4            CALL INSERT(VW_MAILBUF#,J,1,',');

  20380 12 001727   040005 100400                    MLR     fill='040'O
        12 001730   000045 000001 13                 ADSC9   37                       cn=0,n=1
        12 001731   000000 000001 xsym               ADSC9   VW_MAILBUF#,A            cn=0,n=1

     1370    20381    4            J=J+1;

  20381 12 001732   004303 054000 0                  AOS     J

     1371    20382    4            END;

     1372    20383    3         CALL GENERATE_ADDRESS(OPTS.MAILRCVR);

  20383 12 001733   000047 236000 13                 LDQ     39
        12 001734   006473 756000 0                  STQ     MAILBOX+21
        12 001735   002006 701000 12                 TSX1    GENERATE_ADDRESS
        12 001736   000000 011000                    NOP     0

     1373    20384    3         CALL INSERT(VW_MAILBUF#,J,MAILBOX.L,SUBSTR(MAILBOX.C,0,MAILBOX.L));

  20384 12 001737   006446 236000 0                  LDQ     MAILBOX
        12 001740   000033 772000                    QRL     27
        12 001741   000000 620006                    EAX0    0,QL
        12 001742   006446 236000 0                  LDQ     MAILBOX
        12 001743   000033 772000                    QRL     27
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:143  
        12 001744   000000 621006                    EAX1    0,QL
        12 001745   004303 235000 0                  LDA     J
        12 001746   040045 100440                    MLR     fill='040'O
        12 001747   006446 200010 0                  ADSC9   MAILBOX                  cn=1,n=*X0
        12 001750   000000 000011 xsym               ADSC9   VW_MAILBUF#,A            cn=0,n=*X1

     1374    20385    3         J=J+MAILBOX.L;

  20385 12 001751   006446 236000 0                  LDQ     MAILBOX
        12 001752   000033 772000                    QRL     27
        12 001753   004303 036000 0                  ADLQ    J
        12 001754   004303 756000 0                  STQ     J

     1375    20386    3         END;

     1376    20387
     1377    20388    2      WRITE_MAIL.BUF_.BOUND=J-1;

  20388 12 001755   004303 236000 0                  LDQ     J
        12 001756   000001 136007                    SBLQ    1,DL
        12 001757   000020 736000                    QLS     16
        12 001760   001350 676000 0                  ERQ     WRITE_MAIL+4
        12 001761   000050 376000 13                 ANQ     40
        12 001762   001350 656000 0                  ERSQ    WRITE_MAIL+4

     1378    20389    2      CALL M$WRITE(WRITE_MAIL) ALTRET(OTMF_ALTRET);

  20389 12 001763   001344 630400 0                  EPPR0   WRITE_MAIL
        12 001764   440001 713400                    CLIMB   alt,write
        12 001765   401400 401760                    pmme    nvectors=4
        12 001766   001773 702000 12                 TSX2    OTMF_ALTRET

     1379    20390
     1380    20391        /****
     1381    20392        *
     1382    20393        *   Set up the mail key to 3.000.  Record 2.000 will be written at EOJ.
     1383    20394        *
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:144  
     1384    20395        ****/
     1385    20396
     1386    20397    2      VW_MAILKEY#.C=3000;

  20397 12 001767   005670 236007                    LDQ     3000,DL
        12 001770   000000 552034 xsym               STBQ    VW_MAILKEY#,'34'O

     1387    20398    2      RETURN;

  20398 12 001771   006444 221200 0                  LDX1  ! VW_SCRAMBLE#+1
        12 001772   000001 702211                    TSX2  ! 1,X1

     1388    20399
     1389    20400        /****
     1390    20401        *
     1391    20402        *   Something prevented us from writing/opening the mailbox.  If we
     1392    20403        *   have the mailbox open, close and release it.  This will signal
     1393    20404        *   other processes not to create mail.
     1394    20405        *
     1395    20406        ****/
     1396    20407
     1397    20408    2   OTMF_ALTRET:
     1398    20409    3      IF MAILPTR->DUMMY.FCD#='1'B THEN DO;

  20409 12 001773   004277 470400 0     OTMF_ALTRET  LDP0    MAILPTR
        12 001774   000031 236100                    LDQ     25,,PR0
        12 001775   020000 316007                    CANQ    8192,DL
        12 001776   002004 600000 12                 TZE     s:20413

     1399    20410    3         CLOSE_MAIL.V.DISP#=%RELEASE#;

  20410 12 001777   000001 236007                    LDQ     1,DL
        12 002000   001412 552004 0                  STBQ    CLOSE_MAIL+26,'04'O

     1400    20411    3         CALL M$CLOSE(CLOSE_MAIL);

  20411 12 002001   001360 630400 0                  EPPR0   CLOSE_MAIL
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:145  
        12 002002   050001 713400                    CLIMB   close
        12 002003   406000 401760                    pmme    nvectors=13

     1401    20412    3         END;

     1402    20413    2      RETURN;

  20413 12 002004   006444 221200 0                  LDX1  ! VW_SCRAMBLE#+1
        12 002005   000001 702211                    TSX2  ! 1,X1

     1403    20414
     1404    20415        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:146  
     1405    20416        /*I**
     1406    20417        *
     1407    20418        *   NAME:  GENERATE_ADDRESS
     1408    20419        *
     1409    20420        *   PURPOSE:
     1410    20421        *       To provide a properly-formatted mailbox address.
     1411    20422        *
     1412    20423        *   CALL:
     1413    20424        *       CALL GENERATE_ADDRESS(opt)
     1414    20425        *
     1415    20426        *   PARAMETERS:
     1416    20427        *       opt - is a two-"card" structure containing mail information.
     1417    20428        *
     1418    20429        *   DATA:
     1419    20430        *       MAILBOX will contain the decoded mailbox name if successful.
     1420    20431        *       VW_IAM# is referenced.
     1421    20432        *
     1422    20433        *   DESCRIPTION:
     1423    20434        *       Decode the mailbox name passed as an argument and form it into
     1424    20435        *       a proper address:  [/folder].account[.password][@wsn]
     1425    20436        *
     1426    20437        ****/
     1427    20438
     1428    20439    2   GENERATE_ADDRESS: PROC(OPT);

  20439 12 002006   006472 741200 0     GENERATE_AD* STX1  ! MAILBOX+20

     1429    20440
     1430    20441        /****
     1431    20442        *
     1432    20443        *   FPTs for decoding the mailbox name.
     1433    20444        *
     1434    20445        ****/
     1435    20446
     1436    20447        %FPT_FID(ACCT=VLP_ACCT,
     1437    20448                 NAME=VLP_NAME,
     1438    20449                 PASS=VLP_PASS,
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:147  
     1439    20450                 SN=VLP_SN,
     1440    20451                 ASN=ASN,
     1441    20452                 RES=RES,
     1442    20453                 RESULTS=VLR_FID);
     1443    20476
     1444    20477        %VLP_ACCT(ACCT=' ');
     1445    20490
     1446    20491        %VLP_NAME(LEN=31,NAME=' ');
     1447    20518
     1448    20519        %VLP_PASS(PASS=' ');
     1449    20532
     1450    20533        %VLP_SN(N=6);
     1451    20546
     1452    20547        %VLR_FID;
     1453    20566
     1454    20567    3   DCL 1 OPT ALIGNED,
     1455    20568    3             2 * UNAL                     CHAR(72),
     1456    20569    3             2 NODE UNAL                  CHAR(8),
     1457    20570    3             2 L UNAL                     UBIN BYTE,
     1458    20571    3             2 MAILBOX UNAL               CHAR(79);
     1459    20572
     1460    20573    3   DCL ASN                            SBIN;
     1461    20574    3   DCL RES                            CHAR(4);
     1462    20575
     1463    20576    3   DCL I                              SBIN;
     1464    20577    3   DCL J                              SBIN;
     1465    20578
     1466    20579        /****
     1467    20580        *
     1468    20581        *   Attempt to decode the mailbox name as a normal FID.
     1469    20582        *
     1470    20583        ****/
     1471    20584
     1472    20585    3      FPT_FID.TEXTFID_=VECTOR(OPT.MAILBOX);

  20585 12 002007   000051 235000 13                 LDA     41
        12 002010   006473 236000 0                  LDQ     @OPT
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:148  
        12 002011   000052 036000 13                 ADLQ    42
        12 002012   006476 757000 0                  STAQ    FPT_FID+2

     1473    20586    3      VLR_FID='0'B;

  20586 12 002013   000000 100400                    MLR     fill='000'O
        12 002014   000041 000001 13                 ADSC9   33                       cn=0,n=1
        12 002015   006552 000044 0                  ADSC9   VLR_FID                  cn=0,n=36

     1474    20587    3      VLP_NAME.L#=31;

  20587 12 002016   037000 236003                    LDQ     15872,DU
        12 002017   006526 552040 0                  STBQ    VLP_NAME,'40'O

     1475    20588    3      VLP_SN.NUM#=6;

  20588 12 002020   000006 235007                    LDA     6,DL
        12 002021   006540 755000 0                  STA     VLP_SN

     1476    20589    4      call index(I,'.',OPT.MAILBOX) whenaltreturn do; I = 0; end;

  20589 12 002022   006473 470400 0                  LDP0    @OPT
        12 002023   000000 124500                    SCM     mask='000'O
        12 002024   000024 200117                    ADSC9   20,,PR0                  cn=1,n=79
        12 002025   000053 000001 13                 ADSC9   43                       cn=0,n=1
        12 002026   006566 000000 0                  ARG     I
        12 002027   002031 606400 12                 TTN     s:20589+7
        12 002030   002032 710000 12                 TRA     s:20590

  20589 12 002031   006566 450000 0                  STZ     I

     1477    20590    3      MAILBOX.L=0;

  20590 12 002032   000000 236003                    LDQ     0,DU
        12 002033   006446 552040 0                  STBQ    MAILBOX,'40'O

     1478    20591    3      MAILBOX.C=' ';
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:149  

  20591 12 002034   040000 100400                    MLR     fill='040'O
        12 002035   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 002036   006446 200117 0                  ADSC9   MAILBOX                  cn=1,n=79

     1479    20592    4      if I=0 or substr(OPT.MAILBOX,,6) ~= ':MAIL_' then do;

  20592 12 002037   006566 235000 0                  LDA     I
        12 002040   002046 600000 12                 TZE     s:20593
        12 002041   006473 470400 0                  LDP0    @OPT
        12 002042   040000 106500                    CMPC    fill='040'O
        12 002043   000024 200006                    ADSC9   20,,PR0                  cn=1,n=6
        12 002044   000206 000006 3                  ADSC9   GOOD_PATTERN+69          cn=0,n=6
        12 002045   002075 600000 12                 TZE     s:20604

     1480    20593    4         MAILBOX.C = OPT.MAILBOX;

  20593 12 002046   006473 470400 0                  LDP0    @OPT
        12 002047   040000 100500                    MLR     fill='040'O
        12 002050   000024 200117                    ADSC9   20,,PR0                  cn=1,n=79
        12 002051   006446 200117 0                  ADSC9   MAILBOX                  cn=1,n=79

     1481    20594    4         call searchr(I,J,B$SR_NON_BLANK,MAILBOX.C)

  20594 12 002052   000000 471400 xsym               LDP1    B$SR_NON_BLANK$
        12 002053   000000 165400                    TCTR
        12 002054   006446 200117 0                  ADSC9   MAILBOX                  cn=1,n=79
        12 002055   100000 000100                    ARG     0,,PR1
        12 002056   006566 000000 0                  ARG     I
        12 002057   006566 235000 0                  LDA     I
        12 002060   000033 771000                    ARL     27
        12 002061   006567 755000 0                  STA     J
        12 002062   006566 551040 0                  STBA    I,'40'O
        12 002063   002070 606400 12                 TTN     s:20599
        12 002064   000116 236007                    LDQ     78,DL
        12 002065   006566 156000 0                  SSQ     I

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:150  
     1482    20595    5           whenreturn do;

     1483    20596    5            I = I + 1;

  20596 12 002066   006566 054000 0                  AOS     I

     1484    20597    5            end;

  20597 12 002067   002071 710000 12                 TRA     s:20601

     1485    20598    5           whenaltreturn do;

     1486    20599    5            I = 0;

  20599 12 002070   006566 450000 0                  STZ     I

     1487    20600    5            end;

     1488    20601    4         MAILBOX.L = I;

  20601 12 002071   006566 236000 0                  LDQ     I
        12 002072   000033 736000                    QLS     27
        12 002073   006446 552040 0                  STBQ    MAILBOX,'40'O

     1489    20602    4         end;

  20602 12 002074   002263 710000 12                 TRA     s:20645

     1490    20603    4        else do;

     1491    20604    5         CALL M$FID(FPT_FID) WHENALTRETURN DO;

  20604 12 002075   006474 630400 0                  EPPR0   FPT_FID
        12 002076   420001 713400                    CLIMB   alt,+8193
        12 002077   404400 401760                    pmme    nvectors=10
        12 002100   002102 702000 12                 TSX2    s:20605
        12 002101   002104 710000 12                 TRA     s:20615
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:151  

     1492    20605    5            RETURN;

  20605 12 002102   006472 221200 0                  LDX1  ! MAILBOX+20
        12 002103   000001 702211                    TSX2  ! 1,X1

     1493    20606    5            END;
     1494    20607
     1495    20608        /****
     1496    20609        *
     1497    20610        *   If we successfully parsed the mailbox name, fix it up into the
     1498    20611        *   desired format.
     1499    20612        *
     1500    20613        ****/
     1501    20614
     1502    20615    4         I=0;

  20615 12 002104   006566 450000 0                  STZ     I

     1503    20616    4         IF VLR_FID.NAME AND VLP_NAME.L#=13 AND VLP_NAME.NAME#=':MAIL_CENTRAL' THEN

  20616 12 002105   006552 234000 0                  SZN     VLR_FID
        12 002106   002121 605000 12                 TPL     s:20618
        12 002107   006526 236000 0                  LDQ     VLP_NAME
        12 002110   777000 376003                    ANQ     -512,DU
        12 002111   015000 116003                    CMPQ    6656,DU
        12 002112   002121 601000 12                 TNZ     s:20618
        12 002113   040000 106400                    CMPC    fill='040'O
        12 002114   006526 200037 0                  ADSC9   VLP_NAME                 cn=1,n=31
        12 002115   000210 000015 3                  ADSC9   GOOD_PATTERN+71          cn=0,n=13
        12 002116   002121 601000 12                 TNZ     s:20618

     1504    20617    4            VLR_FID.NAME='0'B;

  20617 12 002117   000007 236000 13                 LDQ     7
        12 002120   006552 356000 0                  ANSQ    VLR_FID

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:152  
     1505    20618    5         IF VLR_FID.NAME THEN DO;

  20618 12 002121   006552 234000 0                  SZN     VLR_FID
        12 002122   002166 605000 12                 TPL     s:20628

     1506    20619    6            IF VLP_NAME.L#>6 AND SUBSTR(VLP_NAME.NAME#,0,6)=':MAIL_' THEN DO;

  20619 12 002123   006526 236000 0                  LDQ     VLP_NAME
        12 002124   777000 376003                    ANQ     -512,DU
        12 002125   007000 116003                    CMPQ    3584,DU
        12 002126   002151 602000 12                 TNC     s:20624
        12 002127   040000 106400                    CMPC    fill='040'O
        12 002130   006526 200006 0                  ADSC9   VLP_NAME                 cn=1,n=6
        12 002131   000206 000006 3                  ADSC9   GOOD_PATTERN+69          cn=0,n=6
        12 002132   002151 601000 12                 TNZ     s:20624

     1507    20620    6               CALL CONCAT(MAILBOX.C,'/',SUBSTR(VLP_NAME.NAME#,6,VLP_NAME.L#-6));

  20620 12 002133   006526 236000 0                  LDQ     VLP_NAME
        12 002134   000033 772000                    QRL     27
        12 002135   777772 620006                    EAX0    -6,QL
        12 002136   000057 236003                    LDQ     47,DU
        12 002137   006446 552020 0                  STBQ    MAILBOX,'20'O
        12 002140   040000 100440                    MLR     fill='040'O
        12 002141   006527 600010 0                  ADSC9   VLP_NAME+1               cn=3,n=*X0
        12 002142   006446 400116 0                  ADSC9   MAILBOX                  cn=2,n=78

     1508    20621    6               I=I+VLP_NAME.L#-5;

  20621 12 002143   006526 236000 0                  LDQ     VLP_NAME
        12 002144   000033 772000                    QRL     27
        12 002145   006566 036000 0                  ADLQ    I
        12 002146   000005 136007                    SBLQ    5,DL
        12 002147   006566 756000 0                  STQ     I

     1509    20622    6               END;

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:153  
  20622 12 002150   002166 710000 12                 TRA     s:20628

     1510    20623    6              ELSE DO;

     1511    20624    6               CALL CONCAT(MAILBOX.C,'/',SUBSTR(VLP_NAME.NAME#,0,VLP_NAME.L#));

  20624 12 002151   006526 236000 0                  LDQ     VLP_NAME
        12 002152   000033 772000                    QRL     27
        12 002153   000000 620006                    EAX0    0,QL
        12 002154   000057 236003                    LDQ     47,DU
        12 002155   006446 552020 0                  STBQ    MAILBOX,'20'O
        12 002156   040000 100440                    MLR     fill='040'O
        12 002157   006526 200010 0                  ADSC9   VLP_NAME                 cn=1,n=*X0
        12 002160   006446 400116 0                  ADSC9   MAILBOX                  cn=2,n=78

     1512    20625    6               I=I+VLP_NAME.L#+1;

  20625 12 002161   006526 236000 0                  LDQ     VLP_NAME
        12 002162   000033 772000                    QRL     27
        12 002163   006566 036000 0                  ADLQ    I
        12 002164   000001 036007                    ADLQ    1,DL
        12 002165   006566 756000 0                  STQ     I

     1513    20626    6               END;

     1514    20627    5            END;

     1515    20628    4         IF VLR_FID.ACCT THEN

  20628 12 002166   006552 236000 0                  LDQ     VLR_FID
        12 002167   200000 316003                    CANQ    65536,DU
        12 002170   002211 600000 12                 TZE     s:20631

     1516    20629    4            CALL INSERT(MAILBOX.C,I,,'.',VLP_ACCT.ACCT#);

  20629 12 002171   006566 720000 0                  LXL0    I
        12 002172   777660 620010                    EAX0    -80,X0
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:154  
        12 002173   777777 660003                    ERX0    -1,DU
        12 002174   006566 235000 0                  LDA     I
        12 002175   040045 100400                    MLR     fill='040'O
        12 002176   000053 000001 13                 ADSC9   43                       cn=0,n=1
        12 002177   006446 200010 0                  ADSC9   MAILBOX,A                cn=1,n=*X0
        12 002200   006566 236000 0                  LDQ     I
        12 002201   000116 116007                    CMPQ    78,DL
        12 002202   002210 605000 12                 TPL     s:20629+15
        12 002203   777661 621006                    EAX1    -79,QL
        12 002204   777777 661003                    ERX1    -1,DU
        12 002205   040046 100400                    MLR     fill='040'O
        12 002206   006524 000010 0                  ADSC9   VLP_ACCT                 cn=0,n=8
        12 002207   006446 400011 0                  ADSC9   MAILBOX,Q                cn=2,n=*X1
        12 002210   002231 710000 12                 TRA     s:20632

     1517    20630    4           ELSE
     1518    20631    4            CALL INSERT(MAILBOX.C,I,,'.',B$JIT.ACCN);

  20631 12 002211   006566 720000 0                  LXL0    I
        12 002212   777660 620010                    EAX0    -80,X0
        12 002213   777777 660003                    ERX0    -1,DU
        12 002214   006566 235000 0                  LDA     I
        12 002215   040045 100400                    MLR     fill='040'O
        12 002216   000053 000001 13                 ADSC9   43                       cn=0,n=1
        12 002217   006446 200010 0                  ADSC9   MAILBOX,A                cn=1,n=*X0
        12 002220   006566 236000 0                  LDQ     I
        12 002221   000116 116007                    CMPQ    78,DL
        12 002222   002231 605000 12                 TPL     s:20632
        12 002223   777661 621006                    EAX1    -79,QL
        12 002224   777777 661003                    ERX1    -1,DU
        12 002225   000000 470400 xsym               LDP0    B$JIT$
        12 002226   040046 100500                    MLR     fill='040'O
        12 002227   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        12 002230   006446 400011 0                  ADSC9   MAILBOX,Q                cn=2,n=*X1

     1519    20632    4         CALL INDEX(I,' ',MAILBOX.C);

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:155  
  20632 12 002231   000000 124400                    SCM     mask='000'O
        12 002232   006446 200117 0                  ADSC9   MAILBOX                  cn=1,n=79
        12 002233   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 002234   006566 000000 0                  ARG     I

     1520    20633    5         IF VLR_FID.PASS THEN DO;

  20633 12 002235   006552 236000 0                  LDQ     VLR_FID
        12 002236   100000 316003                    CANQ    32768,DU
        12 002237   002263 600000 12                 TZE     s:20645

     1521    20634    5            CALL INSERT(MAILBOX.C,I,,'.',VLP_PASS.PASS#);

  20634 12 002240   006566 720000 0                  LXL0    I
        12 002241   777660 620010                    EAX0    -80,X0
        12 002242   777777 660003                    ERX0    -1,DU
        12 002243   006566 235000 0                  LDA     I
        12 002244   040045 100400                    MLR     fill='040'O
        12 002245   000053 000001 13                 ADSC9   43                       cn=0,n=1
        12 002246   006446 200010 0                  ADSC9   MAILBOX,A                cn=1,n=*X0
        12 002247   006566 236000 0                  LDQ     I
        12 002250   000116 116007                    CMPQ    78,DL
        12 002251   002257 605000 12                 TPL     s:20635
        12 002252   777661 621006                    EAX1    -79,QL
        12 002253   777777 661003                    ERX1    -1,DU
        12 002254   040046 100400                    MLR     fill='040'O
        12 002255   006536 000010 0                  ADSC9   VLP_PASS                 cn=0,n=8
        12 002256   006446 400011 0                  ADSC9   MAILBOX,Q                cn=2,n=*X1

     1522    20635    5            CALL INDEX(I,' ',MAILBOX.C);

  20635 12 002257   000000 124400                    SCM     mask='000'O
        12 002260   006446 200117 0                  ADSC9   MAILBOX                  cn=1,n=79
        12 002261   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 002262   006566 000000 0                  ARG     I

     1523    20636    5            END;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:156  

     1524    20637    4         END;

     1525    20638
     1526    20639        /****
     1527    20640        *
     1528    20641        *   Supply the WSN if not here.
     1529    20642        *
     1530    20643        ****/
     1531    20644
     1532    20645    4      IF OPT.NODE~=VW_IAM# THEN DO;

  20645 12 002263   006473 470400 0                  LDP0    @OPT
        12 002264   040000 106500                    CMPC    fill='040'O
        12 002265   000022 000010                    ADSC9   18,,PR0                  cn=0,n=8
        12 002266   006441 000010 0                  ADSC9   VW_IAM#                  cn=0,n=8
        12 002267   002314 600000 12                 TZE     s:20649

     1533    20646    4         CALL INSERT(MAILBOX.C,I,,'@',OPT.NODE);

  20646 12 002270   006566 720000 0                  LXL0    I
        12 002271   777660 620010                    EAX0    -80,X0
        12 002272   777777 660003                    ERX0    -1,DU
        12 002273   006566 235000 0                  LDA     I
        12 002274   040045 100400                    MLR     fill='040'O
        12 002275   000054 000001 13                 ADSC9   44                       cn=0,n=1
        12 002276   006446 200010 0                  ADSC9   MAILBOX,A                cn=1,n=*X0
        12 002277   006566 236000 0                  LDQ     I
        12 002300   000116 116007                    CMPQ    78,DL
        12 002301   002307 605000 12                 TPL     s:20647
        12 002302   777661 621006                    EAX1    -79,QL
        12 002303   777777 661003                    ERX1    -1,DU
        12 002304   040046 100500                    MLR     fill='040'O
        12 002305   000022 000010                    ADSC9   18,,PR0                  cn=0,n=8
        12 002306   006446 400011 0                  ADSC9   MAILBOX,Q                cn=2,n=*X1

     1534    20647    4         CALL INDEX(I,' ',MAILBOX.C,I);
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:157  

  20647 12 002307   000000 124445                    SCM     mask='000'O
        12 002310   006446 200010 0                  ADSC9   MAILBOX,A                cn=1,n=*X0
        12 002311   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 002312   006566 000000 0                  ARG     I
        12 002313   006566 056000 0                  ASQ     I

     1535    20648    4         END;

     1536    20649    3      MAILBOX.L=I;

  20649 12 002314   006566 236000 0                  LDQ     I
        12 002315   000033 736000                    QLS     27
        12 002316   006446 552040 0                  STBQ    MAILBOX,'40'O

     1537    20650    3      RETURN;

  20650 12 002317   006472 221200 0                  LDX1  ! MAILBOX+20
        12 002320   000001 702211                    TSX2  ! 1,X1

     1538    20651
     1539    20652    3   END;
     1540    20653
     1541    20654    2   END;
     1542    20655
     1543    20656        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:158  
     1544    20657        /*I**
     1545    20658        *
     1546    20659        *   NAME:  IMPERSONATE_USER
     1547    20660        *
     1548    20661        *   PURPOSE:
     1549    20662        *       To perform SLUG-like operations, logging on a user.
     1550    20663        *
     1551    20664        *   CALL:
     1552    20665        *       CALL IMPERSONATE_USER(opt) ALTRET...
     1553    20666        *
     1554    20667        *   PARAMETERS:
     1555    20668        *       opt - is a two-"card" structure containing logon information.
     1556    20669        *
     1557    20670        *   DATA:
     1558    20671        *       ACCTNAME is modified with the logon.  The FPTs for accessing the
     1559    20672        *       :HLP and :USERS files are used, and data are read into their
     1560    20673        *       respective buffers.  If the logon is successful, the account, name,
     1561    20674        *       and fma fields in the JIT are modified to impersonate the user, and
     1562    20675        *       the active privileges are set to the user's authorized privileges
     1563    20676        *       (batch, online, ghost ORed together) plus JIT access (so we can
     1564    20677        *       get back).
     1565    20678        *
     1566    20679        *   DESCRIPTION:
     1567    20680        *       "LOGON" the user identified in the parameter passed.  This
     1568    20681        *       involves reading :HLP.:SYS with the name and account given to
     1569    20682        *       check that the user is authorized and to validate his password.
     1570    20683        *       Then read :USERS.:SYS to fetch the user's authorized privileges
     1571    20684        *       and merge them into the active privileges in the JIT along with
     1572    20685        *       JIT access (so we can get back).  Then modify the JIT to the
     1573    20686        *       user's name and account.  If any of the files needed are busy,
     1574    20687        *       sleep until they aren't.  ALTRET if the user is not authorized.
     1575    20688        *
     1576    20689        ****/
     1577    20690
     1578    20691    1   IMPERSONATE_USER: PROC(OPT) ALTRET;

  20691 12 002321   006570 741200 0     IMPERSONATE* STX1  ! J+1
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:159  

     1579    20692
     1580    20693    2   DCL 1 OPT ALIGNED,
     1581    20694    2             2 *                          CHAR(4),
     1582    20695    2             2 ACCT                       CHAR(8),
     1583    20696    2             2 NAME                       CHAR(12),
     1584    20697    2             2 EPASS                      CHAR(12),
     1585    20698    2             2 BIT9(0:11) REDEF EPASS UNAL UBIN BYTE,
     1586    20699    2             2 *                          CHAR(44);
     1587    20700
     1588    20701        /****
     1589    20702        *
     1590    20703        *   Form the key for the :HLP file.
     1591    20704        *
     1592    20705        ****/
     1593    20706
     1594    20707    2      if not (B$JIT.PRIV.ACTIVE & (%PR_JIT# | %PR_FMSEC#)) then return;

  20707 12 002322   000111 236000 3                  LDQ     GOOD_PATTERN+8
        12 002323   000150 276000 3                  ORQ     GOOD_PATTERN+39
        12 002324   000000 470400 xsym               LDP0    B$JIT$
        12 002325   000013 376100                    ANQ     11,,PR0
        12 002326   002330 601000 12                 TNZ     s:20708

  20707 12 002327   000001 702211                    TSX2  ! 1,X1

     1595    20708    2      ACCTNAME.ACCT=OPT.ACCT;

  20708 12 002330   006571 471400 0                  LDP1    @OPT
        12 002331   040000 100500                    MLR     fill='040'O
        12 002332   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
        12 002333   006411 200010 0                  ADSC9   ACCTNAME                 cn=1,n=8

     1596    20709    2      ACCTNAME.NAME=OPT.NAME;

  20709 12 002334   040000 100500                    MLR     fill='040'O
        12 002335   100003 000014                    ADSC9   3,,PR1                   cn=0,n=12
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:160  
        12 002336   006413 200014 0                  ADSC9   ACCTNAME+2               cn=1,n=12

     1597    20710    2      CALL INDEX1(I,' ',ACCTNAME.NAME);

  20710 12 002337   000000 124400                    SCM     mask='000'O
        12 002340   006413 200014 0                  ADSC9   ACCTNAME+2               cn=1,n=12
        12 002341   000010 000001 13                 ADSC9   8                        cn=0,n=1
        12 002342   004302 000000 0                  ARG     I

     1598    20711    2      ACCTNAME.L=I+8;

  20711 12 002343   004302 236000 0                  LDQ     I
        12 002344   000010 036007                    ADLQ    8,DL
        12 002345   000033 736000                    QLS     27
        12 002346   006411 552040 0                  STBQ    ACCTNAME,'40'O

     1599    20712    3      DO I=0 TO 11;

  20712 12 002347   004302 450000 0                  STZ     I

     1600    20713    3         BIT6(I)=OPT.BIT9(I)-ASCBIN(' ');

  20713 12 002350   006571 470400 0                  LDP0    @OPT
        12 002351   004302 235000 0                  LDA     I
        12 002352   000000 101505                    MRL     fill='000'O
        12 002353   000006 000001                    ADSC9   6,A,PR0                  cn=0,n=1
        12 002354   006601 000004 0                  ADSC9   OPT$+4                   cn=0,n=4
        12 002355   006601 236000 0                  LDQ     OPT$+4
        12 002356   000040 136007                    SBLQ    32,DL
        12 002357   006600 756000 0                  STQ     OPT$+3
        12 002360   000000 115003                    CMPA    0,DU
        12 002361   002363 605000 12                 TPL     s:20713+11
        12 002362   000006 035003                    ADLA    6,DU
        12 002363   000005 101400                    MRL     fill='000'O
        12 002364   006600 020006 0                  ADSC6   OPT$+3                   cn=0,n=6
        12 002365   006437 020001 0                  ADSC6   PASSWORD,A               cn=0,n=1

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:161  
     1601    20714    3         END;

  20714 12 002366   004302 054000 0                  AOS     I
        12 002367   004302 235000 0                  LDA     I
        12 002370   000013 115007                    CMPA    11,DL
        12 002371   002350 604400 12                 TMOZ    s:20713

     1602    20715
     1603    20716        /****
     1604    20717        *
     1605    20718        *   Attempt to open and read the :HLP file.  If the M$OPEN ALTRETs,
     1606    20719        *   sleep for awhile and try again (forever).  If the file gets
     1607    20720        *   opened, read it quickly and close it so that SUPER doesn't get
     1608    20721        *   upset.
     1609    20722        *
     1610    20723        ****/
     1611    20724
     1612    20725    3      DO WHILE('0'B);

  20725 12 002372   002376 710000 12                 TRA     s:20730

     1613    20726
     1614    20727    3   SLEEP_HLP:
     1615    20728    3         CALL M$WAIT(SNOOZE);

  20728 12 002373   002516 630400 0     SLEEP_HLP    EPPR0   SNOOZE
        12 002374   020006 713400                    CLIMB   8198
        12 002375   400400 401760                    pmme    nvectors=2

     1616    20729    3         END;

     1617    20730    2      CALL M$OPEN(OPEN_HLP) ALTRET(SLEEP_HLP);

  20730 12 002376   001754 630400 0                  EPPR0   OPEN_HLP
        12 002377   450000 713400                    CLIMB   alt,open
        12 002400   410400 401760                    pmme    nvectors=18
        12 002401   002373 702000 12                 TSX2    SLEEP_HLP
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:162  

     1618    20731    2      CALL M$READ(READ_HLP) ALTRET(SETUP_ABORT);

  20731 12 002402   002052 630400 0                  EPPR0   READ_HLP
        12 002403   440000 713400                    CLIMB   alt,read
        12 002404   401400 401760                    pmme    nvectors=4
        12 002405   002533 702000 12                 TSX2    SETUP_ABORT

     1619    20732    2      CALL M$CLOSE(CLOSE_HLP);

  20732 12 002406   002070 630400 0                  EPPR0   CLOSE_HLP
        12 002407   050001 713400                    CLIMB   close
        12 002410   406000 401760                    pmme    nvectors=13

     1620    20733
     1621    20734        /****
     1622    20735        *
     1623    20736        *   Now open and update the :USERS file.  If the password is bad,
     1624    20737        *   increment the bad-logon count, otherwise set the last-logon
     1625    20738        *   timestamp.  Since we're changing the file, we need to enqueue
     1626    20739        *   on the record key, and TRUNC the file to get the change out to disk.
     1627    20740        *
     1628    20741        ****/
     1629    20742
     1630    20743    3      DO WHILE('0'B);

  20743 12 002411   002415 710000 12                 TRA     s:20748

     1631    20744
     1632    20745    3   SLEEP_USERS:
     1633    20746    3         CALL M$WAIT(SNOOZE);

  20746 12 002412   002516 630400 0     SLEEP_USERS  EPPR0   SNOOZE
        12 002413   020006 713400                    CLIMB   8198
        12 002414   400400 401760                    pmme    nvectors=2

     1634    20747    3         END;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:163  

     1635    20748    2      CALL M$OPEN(OPEN_USERS) ALTRET(SLEEP_USERS);

  20748 12 002415   002126 630400 0                  EPPR0   OPEN_USERS
        12 002416   450000 713400                    CLIMB   alt,open
        12 002417   410400 401760                    pmme    nvectors=18
        12 002420   002412 702000 12                 TSX2    SLEEP_USERS

     1636    20749    2      CALL M$ENQ(ENQ_USERS) ALTRET(SETUP_ABORT);

  20749 12 002421   002224 630400 0                  EPPR0   ENQ_USERS
        12 002422   420002 713400                    CLIMB   alt,+8194
        12 002423   401000 401760                    pmme    nvectors=3
        12 002424   002533 702000 12                 TSX2    SETUP_ABORT

     1637    20750    3      CALL M$READ(READ_USERS) WHENALTRETURN DO;

  20750 12 002425   002246 630400 0                  EPPR0   READ_USERS
        12 002426   440000 713400                    CLIMB   alt,read
        12 002427   401400 401760                    pmme    nvectors=4
        12 002430   002432 702000 12                 TSX2    s:20751
        12 002431   002436 710000 12                 TRA     s:20754

     1638    20751    3         CALL M$DEQ(DEQ_USERS);

  20751 12 002432   002236 630400 0                  EPPR0   DEQ_USERS
        12 002433   020003 713400                    CLIMB   8195
        12 002434   401000 401760                    pmme    nvectors=3

     1639    20752    3         GOTO SETUP_ABORT;

  20752 12 002435   002533 710000 12                 TRA     SETUP_ABORT

     1640    20753    3         END;
     1641    20754    3      IF HLPBUF.PASSWORD~=PASSWORD THEN DO;

  20754 12 002436   040000 106400                    CMPC    fill='040'O
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:164  
        12 002437   004026 000010 0                  ADSC9   HLPBUF+2                 cn=0,n=8
        12 002440   006437 000010 0                  ADSC9   PASSWORD                 cn=0,n=8
        12 002441   002451 600000 12                 TZE     s:20760

     1642    20755    3         USERSBUF.BAD_LOGON_CNT=USERSBUF.BAD_LOGON_CNT+1;

  20755 12 002442   004003 220000 0                  LDX0    USERSBUF+499
        12 002443   000001 621010                    EAX1    1,X0
        12 002444   004003 741000 0                  STX1    USERSBUF+499

     1643    20756    3         USERSBUF.LOGINS.BAD_LOGON_CNT(%M_GHOST#-1)=

  20756 12 002445   004007 235000 0                  LDA     USERSBUF+503
        12 002446   000001 035007                    ADLA    1,DL
        12 002447   004007 755000 0                  STA     USERSBUF+503

     1644    20757    3           USERSBUF.LOGINS.BAD_LOGON_CNT(%M_GHOST#-1)+1;
     1645    20758    3         END;

  20758 12 002450   002461 710000 12                 TRA     s:20765

     1646    20759    3        ELSE DO;

     1647    20760    4         CALL M$TIME(LOGON_TIME) WHENRETURN DO;

  20760 12 002451   002524 630400 0                  EPPR0   LOGON_TIME
        12 002452   420004 713400                    CLIMB   alt,+8196
        12 002453   402000 401760                    pmme    nvectors=5
        12 002454   002461 702000 12                 TSX2    s:20765

     1648    20761    4            USERSBUF.LAST_LOGON_TIME=BINBIT(LOGON_UTS,36);

  20761 12 002455   004313 236000 0                  LDQ     LOGON_UTS
        12 002456   004002 756000 0                  STQ     USERSBUF+498

     1649    20762    4            USERSBUF.LOGINS.LAST_LOGON_TIME(%M_GHOST#-1)=LOGON_UTS;

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:165  
  20762 12 002457   004313 235000 0                  LDA     LOGON_UTS
        12 002460   004006 755000 0                  STA     USERSBUF+502

     1650    20763    4            END;

     1651    20764    3         END;

     1652    20765    2      CALL M$WRITE(WRITE_USERS);

  20765 12 002461   002264 630400 0                  EPPR0   WRITE_USERS
        12 002462   040001 713400                    CLIMB   write
        12 002463   401400 401760                    pmme    nvectors=4

     1653    20766    2      CALL M$TRUNC(TRUNC_USERS);

  20766 12 002464   002300 630400 0                  EPPR0   TRUNC_USERS
        12 002465   050003 713400                    CLIMB   20483
        12 002466   400000 401760                    pmme    nvectors=1

     1654    20767    2      CALL M$DEQ(DEQ_USERS);

  20767 12 002467   002236 630400 0                  EPPR0   DEQ_USERS
        12 002470   020003 713400                    CLIMB   8195
        12 002471   401000 401760                    pmme    nvectors=3

     1655    20768    2      CALL M$CLOSE(CLOSE_USERS);

  20768 12 002472   002304 630400 0                  EPPR0   CLOSE_USERS
        12 002473   050001 713400                    CLIMB   close
        12 002474   406000 401760                    pmme    nvectors=13

     1656    20769
     1657    20770        /****
     1658    20771        *
     1659    20772        *   If the password doesn't match, altreturn to report the error.
     1660    20773        *
     1661    20774        ****/
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:166  
     1662    20775
     1663    20776    2      IF HLPBUF.PASSWORD~=PASSWORD THEN

  20776 12 002475   040000 106400                    CMPC    fill='040'O
        12 002476   004026 000010 0                  ADSC9   HLPBUF+2                 cn=0,n=8
        12 002477   006437 000010 0                  ADSC9   PASSWORD                 cn=0,n=8
        12 002500   002503 600000 12                 TZE     s:20785

     1664    20777    2         ALTRETURN;

  20777 12 002501   006570 221200 0                  LDX1  ! J+1
        12 002502   000000 702211                    TSX2  ! 0,X1

     1665    20778
     1666    20779        /****
     1667    20780        *
     1668    20781        *   "Become" this user.
     1669    20782        *
     1670    20783        ****/
     1671    20784
     1672    20785    3      if B$JIT.PRIV.ACTIVE.JIT then do;

  20785 12 002503   000000 470400 xsym               LDP0    B$JIT$
        12 002504   000013 236100                    LDQ     11,,PR0
        12 002505   000040 316007                    CANQ    32,DL
        12 002506   002531 600000 12                 TZE     s:20795

     1673    20786    3         B$JIT.PRIV.ACTIVE=(%PR_JIT#|USERSBUF.PRIV(0)|USERSBUF.PRIV(1)

  20786 12 002507   003245 236000 0                  LDQ     USERSBUF+149
        12 002510   000111 276000 3                  ORQ     GOOD_PATTERN+8
        12 002511   003246 276000 0                  ORQ     USERSBUF+150
        12 002512   003247 276000 0                  ORQ     USERSBUF+151
        12 002513   000013 756100                    STQ     11,,PR0

     1674    20787    3           |USERSBUF.PRIV(2));
     1675    20788    3         B$JIT.ACCN   = ACCTNAME.ACCT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:167  

  20788 12 002514   040100 100400                    MLR     fill='040'O
        12 002515   006411 200010 0                  ADSC9   ACCTNAME                 cn=1,n=8
        12 002516   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8

     1676    20789    3         B$JIT.UNAME  = ACCTNAME.NAME;

  20789 12 002517   040100 100400                    MLR     fill='040'O
        12 002520   006413 200014 0                  ADSC9   ACCTNAME+2               cn=1,n=12
        12 002521   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12

     1677    20790    3         B$JIT.FACCN  = ACCTNAME.ACCT;

  20790 12 002522   040100 100400                    MLR     fill='040'O
        12 002523   006411 200010 0                  ADSC9   ACCTNAME                 cn=1,n=8
        12 002524   000006 000010                    ADSC9   6,,PR0                   cn=0,n=8

     1678    20791    3         B$JIT.DEFEXP = USERSBUF.DEXP;

  20791 12 002525   003263 720000 0                  LXL0    USERSBUF+163
        12 002526   000221 740100                    STX0    145,,PR0

     1679    20792    3         B$JIT.MAXEXP = USERSBUF.MEXP;

  20792 12 002527   003262 721000 0                  LXL1    USERSBUF+162
        12 002530   000221 441100                    SXL1    145,,PR0

     1680    20793    3         end;

     1681    20794
     1682    20795    2      RETURN;

  20795 12 002531   006570 221200 0                  LDX1  ! J+1
        12 002532   000001 702211                    TSX2  ! 1,X1

     1683    20796
     1684    20797        /****
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:168  
     1685    20798        *
     1686    20799        *   This user isn't authorized if the :HLP or :USERS record isn't there.
     1687    20800        *   ALTRET, but first make sure we have all the files closed.
     1688    20801        *
     1689    20802        ****/
     1690    20803
     1691    20804    2   SETUP_ABORT:
     1692    20805    2      IF DCBADDR(DCBNUM(M$HLP))->DUMMY.FCD# THEN

  20805 12 002533   000000 236007 xsym  SETUP_ABORT  LDQ     M$HLP,DL
        12 002534   000003 470400 13                 LDP0    3
        12 002535   000000 471500                    LDP1    0,,PR0
        12 002536   100000 473506                    LDP3    0,QL,PR1
        12 002537   300031 236100                    LDQ     25,,PR3
        12 002540   020000 316007                    CANQ    8192,DL
        12 002541   002545 600000 12                 TZE     s:20807

     1693    20806    2         CALL M$CLOSE(CLOSE_HLP);

  20806 12 002542   002070 630400 0                  EPPR0   CLOSE_HLP
        12 002543   050001 713400                    CLIMB   close
        12 002544   406000 401760                    pmme    nvectors=13

     1694    20807    2      IF DCBADDR(DCBNUM(M$USERS))->DUMMY.FCD# THEN

  20807 12 002545   000000 236007 xsym               LDQ     M$USERS,DL
        12 002546   000003 470400 13                 LDP0    3
        12 002547   000000 471500                    LDP1    0,,PR0
        12 002550   100000 473506                    LDP3    0,QL,PR1
        12 002551   300031 236100                    LDQ     25,,PR3
        12 002552   020000 316007                    CANQ    8192,DL
        12 002553   002557 600000 12                 TZE     s:20809

     1695    20808    2         CALL M$CLOSE(CLOSE_USERS);

  20808 12 002554   002304 630400 0                  EPPR0   CLOSE_USERS
        12 002555   050001 713400                    CLIMB   close
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:169  
        12 002556   406000 401760                    pmme    nvectors=13

     1696    20809    2      ALTRETURN;

  20809 12 002557   006570 221200 0                  LDX1  ! J+1
        12 002560   000000 702211                    TSX2  ! 0,X1

     1697    20810
     1698    20811    2   END;
     1699    20812
     1700    20813        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:170  
     1701    20814        /*I**
     1702    20815        *
     1703    20816        *   NAME:  CLOSE_THE_MAIL_FILE
     1704    20817        *
     1705    20818        *   PURPOSE:
     1706    20819        *       To close the M$MAIL DCB, supplying appropriate ending text,
     1707    20820        *       then ship the mail by linking to SEND.
     1708    20821        *
     1709    20822        *   CALL:
     1710    20823        *       CALL CLOSE_THE_MAIL_FILE
     1711    20824        *
     1712    20825        *   PARAMETERS:
     1713    20826        *       None.
     1714    20827        *
     1715    20828        *   DATA:
     1716    20829        *       The JIT is modified back to :MOVE,SCOTTY.  VW_MAILKEY# and
     1717    20830        *       VW_MAILBUF# are modified.  M$MAIL is closed.  Then the resources
     1718    20831        *       which have been acquired (packsets, mostly) are released so that
     1719    20832        *       EFT doesn't get upset.
     1720    20833        *
     1721    20834        *   DESCRIPTION:
     1722    20835        *       Close the MAIL file, supplying appropriate ending text.  Ship
     1723    20836        *       the mail (if any) by linking to SEND.  Then release any acquired
     1724    20837        *       resources so that SCOTTY doesn't wind up "owning" all the packsets
     1725    20838        *       on the system.
     1726    20839        *
     1727    20840        ****/
     1728    20841
     1729    20842    1   CLOSE_THE_MAIL_FILE: PROC;

  20842 12 002561   006572 741200 0     CLOSE_THE_M* STX1  ! @OPT+1

     1730    20843
     1731    20844        /****
     1732    20845        *
     1733    20846        *   Resume our proper identity for sending mail.
     1734    20847        *
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:171  
     1735    20848        ****/
     1736    20849
     1737    20850    3      if B$JIT.PRIV.ACTIVE.JIT then do;

  20850 12 002562   000000 470400 xsym               LDP0    B$JIT$
        12 002563   000013 236100                    LDQ     11,,PR0
        12 002564   000040 316007                    CANQ    32,DL
        12 002565   002601 600000 12                 TZE     s:20865

     1738    20851    3         B$JIT.ACCN  = VWS_ACCT_JI.ACCT#;

  20851 12 002566   001664 237000 0                  LDAQ    VWS_ACCT_JI
        12 002567   000001 755100                    STA     1,,PR0
        12 002570   000002 756100                    STQ     2,,PR0

     1739    20852    3         B$JIT.UNAME = 'SCOTTY';

  20852 12 002571   040100 100400                    MLR     fill='040'O
        12 002572   000146 000006 3                  ADSC9   GOOD_PATTERN+37          cn=0,n=6
        12 002573   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12

     1740    20853    3         B$JIT.FACCN = VWS_ACCT_JI.ACCT#;

  20853 12 002574   001664 237000 0                  LDAQ    VWS_ACCT_JI
        12 002575   000006 757100                    STAQ    6,,PR0

     1741    20854    3         B$JIT.PRIV.ACTIVE = (%PR_JIT#|%PR_FMSEC#);

  20854 12 002576   000111 236000 3                  LDQ     GOOD_PATTERN+8
        12 002577   000150 276000 3                  ORQ     GOOD_PATTERN+39
        12 002600   000013 756100                    STQ     11,,PR0

     1742    20855    3         end;

     1743    20856
     1744    20857        /****
     1745    20858        *
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:172  
     1746    20859        *   If the mailbox is opened, the last message written is still in
     1747    20860        *   VW_MAILBUF#.  Use this as the subject line and overwrite record
     1748    20861        *   3.000 in the temporary file.
     1749    20862        *
     1750    20863        ****/
     1751    20864
     1752    20865    3      IF MAILPTR->DUMMY.FCD# THEN DO;

  20865 12 002601   004277 471400 0                  LDP1    MAILPTR
        12 002602   100031 236100                    LDQ     25,,PR1
        12 002603   020000 316007                    CANQ    8192,DL
        12 002604   002651 600000 12                 TZE     CTMF_IGNORE

     1753    20866    3         VW_MAILKEY#.C=3000;

  20866 12 002605   005670 236007                    LDQ     3000,DL
        12 002606   000000 552034 xsym               STBQ    VW_MAILKEY#,'34'O

     1754    20867    3         FITBUF=VW_MAILBUF#;

  20867 12 002607   010000 220003                    LDX0    4096,DU
        12 002610   040040 100400                    MLR     fill='040'O
        12 002611   000000 000220 xsym               ADSC9   VW_MAILBUF#              cn=0,n=144
        12 002612   004411 000010 0                  ADSC9   FITBUF                   cn=0,n=*X0

     1755    20868    3         CALL CONCAT(VW_MAILBUF#,'SUBJECT:',FITBUF);

  20868 12 002613   000214 237000 3                  LDAQ    GOOD_PATTERN+75
        12 002614   000000 755000 xsym               STA     VW_MAILBUF#
        12 002615   000001 756000 xsym               STQ     VW_MAILBUF#+1
        12 002616   040000 100400                    MLR     fill='040'O
        12 002617   004411 000210 0                  ADSC9   FITBUF                   cn=0,n=136
        12 002620   000002 000210 xsym               ADSC9   VW_MAILBUF#+2            cn=0,n=136

     1756    20869    3         CALL INDEX(I,'    ',VW_MAILBUF#);

  20869 12 002621   004302 631400 0                  EPPR1   I
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:173  
        12 002622   000145 633400 3                  EPPR3   GOOD_PATTERN+36
        12 002623   000004 223003                    LDX3    4,DU
        12 002624   000000 630400 xsym               EPPR0   VW_MAILBUF#
        12 002625   000220 220003                    LDX0    144,DU
        12 002626   000000 236003                    LDQ     0,DU
        12 002627   000000 701000 xent               TSX1    X66_INDEX
        12 002630   000000 011000                    NOP     0

     1757    20870    3         WRITE_MAIL.BUF_.BOUND=I-1;

  20870 12 002631   004302 236000 0                  LDQ     I
        12 002632   000001 136007                    SBLQ    1,DL
        12 002633   000020 736000                    QLS     16
        12 002634   001350 676000 0                  ERQ     WRITE_MAIL+4
        12 002635   000050 376000 13                 ANQ     40
        12 002636   001350 656000 0                  ERSQ    WRITE_MAIL+4

     1758    20871    3         CALL M$WRITE(WRITE_MAIL);

  20871 12 002637   001344 630400 0                  EPPR0   WRITE_MAIL
        12 002640   040001 713400                    CLIMB   write
        12 002641   401400 401760                    pmme    nvectors=4

     1759    20872
     1760    20873        /****
     1761    20874        *
     1762    20875        *   Now close the temp file and link to SEND to do the mail.  We don't
     1763    20876        *   do anything special if SEND aborts.
     1764    20877        *
     1765    20878        ****/
     1766    20879
     1767    20880    3         CALL M$CLOSE(CLOSE_MAIL);

  20880 12 002642   001360 630400 0                  EPPR0   CLOSE_MAIL
        12 002643   050001 713400                    CLIMB   close
        12 002644   406000 401760                    pmme    nvectors=13

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:174  
     1768    20881    3         CALL M$LINK(LINK_SEND) ALTRET(CTMF_IGNORE);

  20881 12 002645   002540 630400 0                  EPPR0   LINK_SEND
        12 002646   400005 713400                    CLIMB   alt,+5
        12 002647   403000 401760                    pmme    nvectors=7
        12 002650   002651 702000 12                 TSX2    CTMF_IGNORE

     1769    20882    3         END;

     1770    20883
     1771    20884        /****
     1772    20885        *
     1773    20886        *   Now release all the resources we got by doing whatever it was we did.
     1774    20887        *   Otherwise, we wind up "owning" all the packsets on the system and EFT
     1775    20888        *   won't run.
     1776    20889        *
     1777    20890        ****/
     1778    20891
     1779    20892    2   CTMF_IGNORE:
     1780    20893    2      VLP_RPSN.NN#=6;

  20893 12 002651   000006 235007       CTMF_IGNORE  LDA     6,DL
        12 002652   002622 755000 0                  STA     VLP_RPSN

     1781    20894    2      VLP_PRES.NN#=2;

  20894 12 002653   000002 236007                    LDQ     2,DL
        12 002654   002660 756000 0                  STQ     VLP_PRES

     1782    20895    2      CALL M$DISPRES(FPT_RESCTL) ALTRET(CTMF_ALTRET);

  20895 12 002655   002600 630400 0                  EPPR0   FPT_RESCTL
        12 002656   550002 713400                    CLIMB   alt,+53250
        12 002657   402400 401760                    pmme    nvectors=6
        12 002660   002725 702000 12                 TSX2    CTMF_ALTRET

     1783    20896    3      DO I=0 TO VLP_RPSN.NN#-1;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:175  

  20896 12 002661   004302 450000 0                  STZ     I
        12 002662   002712 710000 12                 TRA     s:20902+1

     1784    20897    4         IF VLP_RPSN.RPLIST.PSN#(I)='SYS   ' THEN DO;

  20897 12 002663   004302 235000 0                  LDA     I
        12 002664   000004 735000                    ALS     4
        12 002665   040000 106405                    CMPC    fill='040'O
        12 002666   002624 000006 0                  ADSC9   VLP_RPSN+2,A             cn=0,n=6
        12 002667   000216 000006 3                  ADSC9   GOOD_PATTERN+77          cn=0,n=6
        12 002670   002703 601000 12                 TNZ     s:20901

     1785    20898    4            VLP_RPSN.RPLIST.PSN#(I)=VLP_RPSN.RPLIST.PSN#(VLP_RPSN.NN#-1);

  20898 12 002671   004302 236000 0                  LDQ     I
        12 002672   000002 736000                    QLS     2
        12 002673   002622 235000 0                  LDA     VLP_RPSN
        12 002674   000004 735000                    ALS     4
        12 002675   000002 736000                    QLS     2
        12 002676   040006 100405                    MLR     fill='040'O
        12 002677   002620 000006 0                  ADSC9   FPT_RESCTL+16,A          cn=0,n=6
        12 002700   002624 000006 0                  ADSC9   VLP_RPSN+2,Q             cn=0,n=6

     1786    20899    4            VLP_RPSN.NN#=VLP_RPSN.NN#-1;

  20899 12 002701   000001 336007                    LCQ     1,DL
        12 002702   002622 056000 0                  ASQ     VLP_RPSN

     1787    20900    4            END;

     1788    20901    3         VLP_RPSN.RPLIST.DISP#(I)=2 /* REM */;

  20901 12 002703   004302 235000 0                  LDA     I
        12 002704   000002 735000                    ALS     2
        12 002705   002625 236005 0                  LDQ     VLP_RPSN+3,AL
        12 002706   000055 376000 13                 ANQ     45
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:176  
        12 002707   000002 276007                    ORQ     2,DL
        12 002710   002625 756005 0                  STQ     VLP_RPSN+3,AL

     1789    20902    3         END;

  20902 12 002711   004302 054000 0                  AOS     I
        12 002712   004302 236000 0                  LDQ     I
        12 002713   002622 116000 0                  CMPQ    VLP_RPSN
        12 002714   002663 604000 12                 TMI     s:20897

     1790    20903    2      IF VLP_RPSN.NN#>0 OR VLP_PRES.NN#>0 THEN

  20903 12 002715   002622 235000 0                  LDA     VLP_RPSN
        12 002716   002721 605400 12                 TPNZ    s:20904
        12 002717   002660 235000 0                  LDA     VLP_PRES
        12 002720   002725 604400 12                 TMOZ    CTMF_ALTRET

     1791    20904    2         CALL M$RELRES(FPT_RESCTL) ALTRET(CTMF_ALTRET);

  20904 12 002721   002600 630400 0                  EPPR0   FPT_RESCTL
        12 002722   550003 713400                    CLIMB   alt,+53251
        12 002723   402400 401760                    pmme    nvectors=6
        12 002724   002725 702000 12                 TSX2    CTMF_ALTRET

     1792    20905
     1793    20906        /****
     1794    20907        *
     1795    20908        *   Ignore any errors from the M$RELRES.
     1796    20909        *
     1797    20910        ****/
     1798    20911
     1799    20912    2   CTMF_ALTRET:
     1800    20913    2      RETURN;

  20913 12 002725   006572 221200 0     CTMF_ALTRET  LDX1  ! @OPT+1
        12 002726   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:177  
     1801    20914
     1802    20915    2   END;
     1803    20916
     1804    20917        %EJECT;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:178  
     1805    20918    1   CHECK_PACKET: PROC ALTRET;

  20918 12 002727   006573 741200 0     CHECK_PACKET STX1  ! @OPT+2

     1806    20919
     1807    20920        /*I*  NAME: CHECK_PACKET
     1808    20921              DESCRIPTION: This proc is called to ensure that a BEAM or SUCK
     1809    20922                 packet has survived its travels throughout the land of strange
     1810    20923                 character sets without being damaged.  The VWB$BEAM module (B00
     1811    20924                 and later) writes an OPTS record (subtype CHAR) that contains a
     1812    20925                 31-character string which is vulnerable to incorrect character set
     1813    20926                 translation.  Particular trouble spots are the ASCII-to-EBCDIC
     1814    20927                 translation performed during HASP translation, and also unit-record
     1815    20928                 FORM and/or CHAIN translation.
     1816    20929        */
     1817    20930
     1818    20931    2   DCL OPTION UBIN;
     1819    20932    2   DCL OPT$ PTR;
     1820    20933
     1821    20934    3      DO OPTION = 0 TO OPTX - 1;

  20934 12 002730   006574 450000 0                  STZ     OPTION
        12 002731   002765 710000 12                 TRA     s:20945+3

     1822    20935    3         OPT$ = ADDR(OPTS.OPTSRECS(OPTION));

  20935 12 002732   006574 236000 0                  LDQ     OPTION
        12 002733   000024 402003                    MPY     20,DU
        12 002734   000056 036000 13                 ADLQ    46
        12 002735   006575 756000 0                  STQ     OPT$

     1823    20936    3         IF OPT$ -> OPTSCHAR.CMD = 'OPTS'

  20936 12 002736   006575 470400 0                  LDP0    OPT$
        12 002737   040000 106500                    CMPC    fill='040'O
        12 002740   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
        12 002741   000166 000004 3                  ADSC9   GOOD_PATTERN+53          cn=0,n=4
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:179  
        12 002742   002762 601000 12                 TNZ     s:20945
        12 002743   040000 106500                    CMPC    fill='040'O
        12 002744   000001 000004                    ADSC9   1,,PR0                   cn=0,n=4
        12 002745   000220 000004 3                  ADSC9   GOOD_PATTERN+79          cn=0,n=4
        12 002746   002762 601000 12                 TNZ     s:20945

     1824    20937    3           AND OPT$ -> OPTSCHAR.SUB = 'CHAR'
     1825    20938    4           THEN DO;

     1826    20939    4            IF OPT$ -> OPTSCHAR.PATTERN = %VW_PATTERN#

  20939 12 002747   040000 106500                    CMPC    fill='040'O
        12 002750   000002 000037                    ADSC9   2,,PR0                   cn=0,n=31
        12 002751   000221 000037 3                  ADSC9   GOOD_PATTERN+80          cn=0,n=31
        12 002752   002755 601000 12                 TNZ     s:20942

     1827    20940    4              THEN
     1828    20941    4               RETURN;

  20941 12 002753   006573 221200 0                  LDX1  ! @OPT+2
        12 002754   000001 702211                    TSX2  ! 1,X1

     1829    20942    4            BAD_PATTERN.C = OPT$ -> OPTSCHAR.PATTERN;

  20942 12 002755   040000 100500                    MLR     fill='040'O
        12 002756   000002 000037                    ADSC9   2,,PR0                   cn=0,n=31
        12 002757   006427 200037 0                  ADSC9   BAD_PATTERN              cn=1,n=31

     1830    20943    4            ALTRETURN;

  20943 12 002760   006573 221200 0                  LDX1  ! @OPT+2
        12 002761   000000 702211                    TSX2  ! 0,X1

     1831    20944    4            END;
     1832    20945    3         END;

  20945 12 002762   006574 235000 0                  LDA     OPTION
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:180  
        12 002763   000001 035007                    ADLA    1,DL
        12 002764   006574 755000 0                  STA     OPTION
        12 002765   006574 236000 0                  LDQ     OPTION
        12 002766   002771 604000 12                 TMI     s:20946
        12 002767   004301 116000 0                  CMPQ    OPTX
        12 002770   002732 604000 12                 TMI     s:20935

     1833    20946    2      RETURN;

  20946 12 002771   006573 221200 0                  LDX1  ! @OPT+2
        12 002772   000001 702211                    TSX2  ! 1,X1

     1834    20947
     1835    20948    2   END CHECK_PACKET;
     1836    20949        %eject;
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:181  
     1837    20950    1   UPDATE_STATUS: proc;

  20950 12 002773   006576 741200 0     UPDATE_STAT* STX1  ! OPT$+1

     1838    20951
     1839    20952    3      if B$JIT.PRIV.ACTIVE.JIT then do;

  20952 12 002774   000000 470400 xsym               LDP0    B$JIT$
        12 002775   000013 236100                    LDQ     11,,PR0
        12 002776   000040 316007                    CANQ    32,DL
        12 002777   003003 600000 12                 TZE     s:20956

     1840    20953    3         B$JIT.CCBUF = STATUS_LINE;

  20953 12 003000   040100 100400                    MLR     fill='040'O
        12 003001   004315 000120 0                  ADSC9   STATUS_LINE              cn=0,n=80
        12 003002   000033 000400                    ADSC9   27,,PR0                  cn=0,n=256

     1841    20954    3         end;

     1842    20955
     1843    20956    2      return;

  20956 12 003003   006576 221200 0                  LDX1  ! OPT$+1
        12 003004   000001 702211                    TSX2  ! 1,X1

VW_OPTIONS#
 Sect OctLoc
   0     001   ****** ******   ****** ******   ****** ******   ****** ******    ................

OPEN_NODE
 Sect OctLoc
   0     766   000025 777640   001032 006000   000000 177640   000000 006014    ................
   0     772   000000 177640   000000 006014   000001 577640   001060 006000    .............0..
   0     776   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    1012*  000001 777640   000000 006000   000000 177640   000000 006014    ................
   0    1016   000000 177640   000000 006014   000000 177640   000000 006014    ................
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:182  
   0    1032*  000000 000042   000000 002001   252525 002002   000040 252520    ..."......... ..
   0    1036   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   0    1042   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    1046   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   0    1052   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0    1056   000000 000000   ****** ******                                    ........

NAME_NODE
 Sect OctLoc
   0    1060   006072 116117   104105 123***                                    .:NODES.

READ_NODE
 Sect OctLoc
   0    1062   000005 777640   001072 006000   000002 177640   001136 006000    .....:.......^..
   0    1066   000005 377640   001141 006000   000000 177640   000000 006014    .....a..........
   0    1072   000000 600000   000000 000000   000000 000000   000000 000000    ................
   0    1076   000000 000000   000000 000000                                    ........

CLOSE_NODE
 Sect OctLoc
   0    1100   000003 777640   001132 006000   000000 177640   000000 006014    .....Z..........
   0    1104   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    1130*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   0    1134   000220 000000   000000 000000                                    ........

NODEKEY
 Sect OctLoc
   0    1136   010*** ******   ****** ******   ****** ******                    ............

NODEOVR
 Sect OctLoc
   0    1141   ****** ******   ****** ******   ****** ******   ****** ******    ................

OPEN_MAILBOX
 Sect OctLoc
   0    1150   000025 777640   001214 006000   000000 177640   000000 006014    ................
   0    1154   000000 177640   000000 006014   000003 377640   001242 006000    ................
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:183  
   0    1160   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    1214*  000000 020442   000000 002001   252525 000000   000040 252520    ............. ..
   0    1220   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   0    1224   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    1230   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   0    1234   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0    1240   000000 000000   ****** ******                                    ........

NAME_MAILBOX
 Sect OctLoc
   0    1242   015072 115101   111114 137103   105116 124122   101114 ******    .:MAIL_CENTRAL..

OPEN_MAIL
 Sect OctLoc
   0    1246   000025 777640   001312 006000   000000 177640   000000 006014    ................
   0    1252   000000 177640   000000 006014   000002 377640   001340 006000    ................
   0    1256   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    1312*  000000 400642   000000 003001   252525 002002   000040 252520    ............. ..
   0    1316   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   0    1322   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    1326   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   0    1332   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0    1336   000000 000000   ****** ******                                    ........

NAME_MAIL
 Sect OctLoc
   0    1340   011052 115117   126105 115101   111114 ******                    .*MOVEMAIL..

WRITE_MAIL
 Sect OctLoc
   0    1344   000003 777640   001354 006000   000000 777640   000000 006000    ................
   0    1350   000043 777640   000000 006000   000000 177640   000000 006014    .#..............
   0    1354   000000 400400   000000 000000   000000 000000   000000 000000    ................

CLOSE_MAIL
 Sect OctLoc
   0    1360   000003 777640   001412 006000   000000 177640   000000 006014    ................
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:184  
   0    1364   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    1410*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   0    1414   000220 000000   000000 000000                                    ........

OPEN_JF
 Sect OctLoc
   0    1416   000025 777640   001462 006000   000000 177640   000000 006014    ................
   0    1422   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    1462*  000000 000642   000000 003003   252525 000000   000040 252520    ............. ..
   0    1466   112106 040040   000000 000000   000000 777777   000000 000000    JF  ............
   0    1472   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    1476   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   0    1502   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0    1506   000000 000000   ****** ******                                    ........

WRITE_JF
 Sect OctLoc
   0    1510   000003 777640   001520 006000   000000 177640   000000 006014    ................
   0    1514   000023 777640   004341 006000   000000 177640   000000 006014    ................
   0    1520   000000 400400   000000 000000   000000 000000   000000 000000    ................

CLOSE_JF
 Sect OctLoc
   0    1524   000003 777640   001556 006000   000000 177640   000000 006014    ................
   0    1530   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    1554*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   0    1560   000220 000000   000000 000000                                    ........

OPEN_JI
 Sect OctLoc
   0    1562   000025 777640   001626 006000   000000 177640   000000 006014    ................
   0    1566   000000 177640   000000 006014   000007 777640   001654 006000    ................
   0    1572   000001 777640   000041 006000   000000 177640   000000 006014    .....!..........
   0    1576   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    1606*  000001 777640   001664 006000   000000 177640   000000 006014    ................
   0    1612   001777 777640   004411 006000   000000 177640   000000 006014    ................
   0    1616   000000 177640   000000 006014   000000 177640   000000 006014    ................
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:185  
   0    1626*  000000 404042   000000 002001   252525 000000   000040 252520    ..."......... ..
   0    1632   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   0    1636   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    1642   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   0    1646   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0    1652   000000 000000   ****** ******                                    ........

NAME_JI
 Sect OctLoc
   0    1654   037115 117126   105040 040040   040040 040040   040040 040040    .MOVE
   0    1660   040040 040040   040040 040040   040040 040040   040040 040040

VWS_ACCT_JI
 Sect OctLoc
   0    1664   072115 117126   105040 040040                                    :MOVE

READ_JI
 Sect OctLoc
   0    1666   000005 777640   001676 006000   000000 177640   000000 006014    ................
   0    1672   000023 777640   004341 006000   000000 177640   000000 006014    ................
   0    1676   000000 400000   000000 000000   000000 000000   000000 000000    ................
   0    1702   000000 000000   000000 000000                                    ........

PRECORD_JI
 Sect OctLoc
   0    1704   000003 777640   001712 006000   000000 177640   000000 006014    ................
   0    1710   000000 177640   000000 006014   000000 000000   777777 777777    ................
   0    1714   000000 000000   0***** ******                                    ........

CLOSE_JI
 Sect OctLoc
   0    1716   000003 777640   001750 006000   000000 177640   000000 006014    ................
   0    1722   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    1746*  000000 177640   000000 006014   000000 000001   000000 000040    ...............
   0    1752   000220 000000   000000 000000                                    ........

OPEN_HLP
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:186  
 Sect OctLoc
   0    1754   000025 777640   002020 006000   000000 177640   000000 006014    ................
   0    1760   000000 177640   000000 006014   000001 177640   002046 006000    .............&..
   0    1764   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2000*  000001 777640   002050 006000   000000 177640   000000 006014    .....(..........
   0    2004   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2020*  000000 000052   000000 002001   252525 000002   000040 252520    ...*......... ..
   0    2024   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   0    2030   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    2034   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   0    2040   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0    2044   000000 000000   ****** ******                                    ........

NAME_HLP
 Sect OctLoc
   0    2046   004072 110114   120*** ******                                    .:HLP...

ACCT_HLP
 Sect OctLoc
   0    2050   072123 131123   040040 040040                                    :SYS

READ_HLP
 Sect OctLoc
   0    2052   000005 777640   002062 006000   000005 177640   006411 006000    .....2..........
   0    2056   000250 777640   004024 006000   000000 177640   000000 006014    ................
   0    2062   000000 600000   000000 000000   000000 000000   000000 000000    ................
   0    2066   000000 000000   000000 000000                                    ........

CLOSE_HLP
 Sect OctLoc
   0    2070   000003 777640   002122 006000   000000 177640   000000 006014    .....R..........
   0    2074   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2120*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   0    2124   000220 000000   000000 000000                                    ........

OPEN_USERS
 Sect OctLoc
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:187  
   0    2126   000025 777640   002172 006000   000000 177640   000000 006014    .....z..........
   0    2132   000000 177640   000000 006014   000001 577640   002220 006000    ................
   0    2136   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2152*  000001 777640   002222 006000   000000 177640   000000 006014    ................
   0    2156   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2172*  000000 000052   000000 001001   252525 000002   000040 252520    ...*......... ..
   0    2176   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   0    2202   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    2206   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   0    2212   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0    2216   000000 000000   ****** ******                                    ........

NAME_USERS
 Sect OctLoc
   0    2220   006072 125123   105122 123***                                    .:USERS.

ACCT_USERS
 Sect OctLoc
   0    2222   072123 131123   040040 040040                                    :SYS

ENQ_USERS
 Sect OctLoc
   0    2224   000003 777640   002232 006000   000005 177640   006411 006000    ................
   0    2230   000000 177640   000000 006014   000000 540000   777777 777777    ................
   0    2234   000000 000000   000000 000000                                    ........

DEQ_USERS
 Sect OctLoc
   0    2236   000001 777640   002244 006000   000000 177640   000000 006014    ................
   0    2242   000000 177640   000000 006014   000000 400000   000000 000000    ................

READ_USERS
 Sect OctLoc
   0    2246   000005 777640   002256 006000   000005 177640   006411 006000    ................
   0    2252   001003 777640   003020 006000   000000 177640   000000 006014    ................
   0    2256   000000 600000   000000 000000   000000 000000   000000 000000    ................
   0    2262   000000 000000   000000 000000                                    ........
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:188  

WRITE_USERS
 Sect OctLoc
   0    2264   000003 777640   002274 006000   000005 177640   006411 006000    ................
   0    2270   001003 777640   003020 006000   000000 177640   000000 006014    ................
   0    2274   000000 400400   000000 000000   000000 000000   000000 000000    ................

TRUNC_USERS
 Sect OctLoc
   0    2300   000001 777640   002302 006000   000000 000000   000000 000000    ................

CLOSE_USERS
 Sect OctLoc
   0    2304   000003 777640   002336 006000   000000 177640   000000 006014    ................
   0    2310   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2334*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   0    2340   000220 000000   000000 000000                                    ........

OPEN_JE
 Sect OctLoc
   0    2342   000025 777640   002406 006000   000000 177640   000000 006014    ................
   0    2346   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2372*  000000 177640   000000 006014   000001 777640   002434 006000    ................
   0    2376   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2406*  000000 400442   000000 003003   252525 001000   000040 252520    ............. ..
   0    2412   112105 040040   000000 000000   000000 777777   000000 000000    JE  ............
   0    2416   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    2422   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   0    2426   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0    2432   000000 000000   ****** ******                                    ........

WSN_JE
 Sect OctLoc
   0    2434   040040 040040   040040 040040

WRITE_JE
 Sect OctLoc
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:189  
   0    2436   000003 777640   002446 006000   000000 177640   000000 006014    ................
   0    2442   000023 777640   004365 006000   000000 177640   000000 006014    ................
   0    2446   000000 400400   000000 000000   000000 000000   000000 000000    ................

CLOSE_JE
 Sect OctLoc
   0    2452   000003 777640   002504 006000   000000 177640   000000 006014    ................
   0    2456   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2502*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   0    2506   000220 000000   000000 000000                                    ........

SLEEP
 Sect OctLoc
   0    2510   000001 777640   002514 006000   000000 177640   000000 006014    ................
   0    2514   000000 000074   000000 000001                                    ...<....

SNOOZE
 Sect OctLoc
   0    2516   000001 777640   002522 006000   000000 177640   000000 006014    ................
   0    2522   000000 000005   000000 000001                                    ........

LOGON_TIME
 Sect OctLoc
   0    2524   000001 777640   002536 006000   000000 177640   000000 006014    ................
   0    2530   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2534   000000 777640   004313 006000   000004 000000   ****** ******    ................

LINK_SEND
 Sect OctLoc
   0    2540   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2550*  000000 177640   000000 006014   000023 777640   000055 006000    .............-..
   0    2554   000001 777640   002556 006000   600000 000000   000000 000000    ................

LINK_TO_NEW_SCOTTY
 Sect OctLoc
   0    2560   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2574*  000001 777640   002576 006000   400000 000000   000000 000000    ................
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:190  

FPT_RESCTL
 Sect OctLoc
   0    2600   000005 777640   002614 006000   000000 177640   000000 006014    ................
   0    2604   000015 777640   002660 006000   000035 777640   002622 006000    ................
   0    2610   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2614   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    2620   000000 000000   000000 000000                                    ........

VLP_RPSN
 Sect OctLoc
   0    2622   000000 000006   000000 000000   040040 040040   040040 001001    ........      ..
   0    2626   000000 000000   000000 000000   040040 040040   040040 000001    ........      ..
   0    2656*  000000 000000   000000 000000                                    ........

VLP_PRES
 Sect OctLoc
   0    2660   000000 000002   000000 000000   040040 040040   040040 000000    ........      ..
   0    2664   000000 006014   000000 000000   040040 040040   040040 000000    ........      ..
   0    2674*  000000 006014   000000 000000                                    ........

ENQ_ON_NODES
 Sect OctLoc
   0    2676   000003 777640   002704 006000   000007 777640   006417 006000    ................
   0    2702   000000 177640   000000 006014   000000 540000   000000 000000    ................
   0    2706   000000 000000   000000 000000                                    ........

KILL_VWB$BEAM
 Sect OctLoc
   0    2710   000002 177640   002716 006000   000001 777640   002714 006000    ................
   0    2714   001000 000000   000000 000000                                    ........

NAME_VWB$BEAM
 Sect OctLoc
   0    2716   010126 127102   044102 105101   115*** ******                    .VWB$BEAM...

KILL_VWE$EVOM
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:191  
 Sect OctLoc
   0    2722   000002 177640   002730 006000   000001 777640   002726 006000    ................
   0    2726   001000 000000   000000 000000                                    ........

NAME_VWE$EVOM
 Sect OctLoc
   0    2730   010126 127105   044105 126117   115*** ******                    .VWE$EVOM...

FPT_XCON1
 Sect OctLoc
   0    2734   000001 777640   002740 006000   000000 177640   000000 006014    ................
   0    2740   000000 000000   000000 000000                                    ........

FPT_XCON2
 Sect OctLoc
   0    2742   000001 777640   002746 006000   000000 177640   000000 006014    ................
   0    2746   000000 000000   000000 000000                                    ........

XUR_INIT
 Sect OctLoc
   0    2750   520000 000001   000000 000000   000000 000000   000000 000000    ................
   0    2754   000000 006014   000000 177640   000000 006014   000000 000000    ................
   0    2760   000000 006014   000000 000000   000000 000000   ****** ******    ................
   0    2764   000000 177640   000000 006014   000000 000000   000000 000000    ................
   0    2770   000000 177640   000000 006014   000000 000000   00000* ******    ................
   0    2774   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    3014*  000000 000000   000000 000000   000000 000000                    ............

USERSBUF
 Sect OctLoc
   0    3020   040040 040040   040040 040040   040040 040040   040040 040040
   0    3024   040040 040040   040200 777777   777777 777777   000000 000000         ...........
   0    3030   777777 777777   000000 000000   004116 117116   105040 040040    .........NONE
   0    3034   040040 040040   040040 040040   040040 040040   040540 000000                 ...
   0    3040   061040 040040   040040 061040   040040 040040   061040 040040    1     1     1
   0    3044   040040 061040   040040 040040   000000 000000   000000 000000      1     ........
   0    3050   040040 040040   040040 040040   040040 040040   040040 040040
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:192  
   0    3054   040040 040040   040040 040007   000000 303237   000000 303237           .........
   0    3060   000000 303237   000000 303237   000000 001750   000000 303237    ................
   0    3064   000000 303237   000000 303237   000000 303237   000000 303237    ................
   0    3070   000000 303237   000000 303237   000000 000062   000000 303237    ...........2....
   0    3074   000000 303237   000000 303237   000000 303237   000000 303237    ................
   0    3100   000000 303237   000000 303237   000000 000144   000000 303237    ...........d....
   0    3104   000000 303237   000000 303237   000000 303237   000000 303237    ................
   0    3120*  000000 303237   000000 303237   000000 003720   000000 003720    ................
   0    3124   000000 023417   000000 003720   037037 037037   012012 012012    ................
   0    3130   007007 007007   007007 007007   040040 040040   040040 040040    ........
   0    3134   040040 040040   040040 040040   040040 040040   040040 040040
   0    3140   040040 040040   040040 040040   040040 040040   123131 123040                SYS
   0    3144   040040 000000   004111 102105   130040 040040   040040 040040      ...IBEX
   0    3150   040040 040040   040040 040040   040040 040040   040040 040040
   0    3154   040040 040040   004111 102105   130040 040040   040040 040040        .IBEX
   0    3160   040040 040040   040040 040040   040040 040040   040040 040040
   0    3164   040040 040040   004111 102105   130040 040040   040040 040040        .IBEX
   0    3170   040040 040040   040040 040040   040040 040040   040040 040040
   0    3174   040040 040040   004111 102105   130040 040040   040040 040040        .IBEX
   0    3200   040040 040040   040040 040040   040040 040040   040040 040040
   0    3204   040040 040040   000040 040040   040040 040040   040040 040040        .
   0    3210   040040 040040   040040 040040   040040 040040   040040 040040
   0    3214   040040 040040   000040 040040   040040 040040   040040 040040        .
   0    3220   040040 040040   040040 040040   040040 040040   040040 040040
   0    3224   040040 040040   000040 040040   040040 040040   040040 040040        .
   0    3230   040040 040040   040040 040040   040040 040040   040040 040040
   0    3234   040040 040040   000040 040040   040040 040040   040040 040040        .
   0    3240   040040 040040   040040 040040   040040 040040   040040 040040
   0    3244   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0    3250   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    3260*  000000 000000   000000 000000   777777 777777   777777 777777    ................
   0    3264   000000 000000   040040 040040   040040 040040   040040 040040    ....
   0    3270   040040 040040   000344 702250   000344 702250   000344 702250        ............
   0    3274   000344 702250   000000 165140   000344 702250   000344 702250    ......u`........
   0    3300   000344 702250   000777 000777   000777 000777   000100 000400    .............@..
   0    3304   000200 000400   040040 040040   040040 040040   000000 000000    ....        ....
   0    3310   000000 000000   040040 040040   040040 040040   000000 000000    ....        ....
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:193  
   0    3344*  000000 000000   000002 115124   000004 000004   000004 000004    ......MT........
   0    3350   104120 000004   000004 000004   000004 040040   000000 000000    DP........  ....
   0    3354   000000 000000   040040 000000   000000 000000   000000 040040    ....  ........
   0    3360   000000 000000   000000 000000   040040 000000   000000 000000    ........  ......
   0    3364   000000 040040   000000 000000   000000 000000   040040 000000    ..  ........  ..
   0    3370   000000 000000   000000 000000   777777 777777   777777 777777    ................
   0    3374   777777 777777   777777 777777   777777 777777   777777 777777    ................
   0    3400   777777 777777   000000 000000   040040 040040   040040 040040    ........
   0    3404   040040 040040   040040 040040   040040 040040   040040 040040
   0    4000*  040040 040040   040040 040040   000000 000000   000000 000000            ........
   0    4004   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    4020*  000000 000000   000000 000000   000000 000000   000000 000000    ................

HLPBUF
 Sect OctLoc
   0    4024   001140 000000   060060 060060   040040 040040   040040 040040    .`..0000
   0    4030   000040 040040   040040 040040   040040 040040   114117 103101    .           LOCA
   0    4034   114040 040040   123131 123040   040040 040040   040040 040040    L   SYS
   0    4040   040040 040040   114117 103101   114040 040040   000000 000000        LOCAL   ....
   0    4044   061040 040040   040040 061040   040040 040040   061040 040040    1     1     1
   0    4050   040040 061040   040040 040040   040040 040040   040040 040040      1
   0    4054   000000 000000   377023 417000   000000 000000   000000 000000    ................
   0    4060   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    4064   000000 000000   000000 000000   000344 702250   000344 702250    ................
   0    4070   000344 702250   000344 702250   000200 000200   000200 000200    ................
   0    4074   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    4114*  040040 040040   040040 040040   000000 000000   000000 000000            ........
   0    4154*  000037 040040   000000 000000   000000 000000   040040 000000    ..  ........  ..
   0    4160   000000 000000   000000 040040   000000 000000   000000 000000    ......  ........
   0    4164   040040 000000   000000 000000   000000 040040   000000 000000      ........  ....
   0    4170   000000 000000   040040 000000   000000 000000   000000 040040    ....  ........
   0    4174   000000 000000   000000 000000   040040 000000   000000 000000    ........  ......
   0    4200   000000 040040   000000 000000   000000 000000   040040 000000    ..  ........  ..
   0    4204   000000 000000   000000 040040   000000 000000   000000 000000    ......  ........
   0    4210   040040 000000   000000 000000   000000 040040   000000 000000      ........  ....
   0    4214   000000 000000   040040 000000   000000 000000   000000 040040    ....  ........
   0    4220   000000 000000   000000 000000   040040 000000   000000 000000    ........  ......
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:194  
   0    4224   000000 040040   000000 000000   000000 000000   040040 000000    ..  ........  ..
   0    4230   000000 000000   000000 040040   000000 000000   000000 000000    ......  ........
   0    4234   040040 000000   000000 000000   000000 040040   000000 000000      ........  ....
   0    4240   000000 000000   040040 000000   000000 000000   000000 040040    ....  ........
   0    4244   000000 000000   000000 000000   040040 000000   000000 000000    ........  ......
   0    4250   000000 040040   000000 000000   000000 000000   040040 000000    ..  ........  ..
   0    4254   000000 000000   000000 040040   000000 000000   000000 000000    ......  ........
   0    4260   040040 000000   000000 000000   000000 040040   000000 000000      ........  ....
   0    4264   000000 000000   040040 000000   000000 000000   000000 040040    ....  ........
   0    4270   000000 000000   000000 000000   040040 000000   000000 000000    ........  ......
   0    4274   000000 ******                                                    ....

STATUS_LINE
 Sect OctLoc
   0    4315   ****** ******   ****** ******   ****** ******   ****** ******    ................

JIBUF
 Sect OctLoc
   0    4341   ****** ******   ****** ******   ****** ******   ****** ******    ................

JEBUF
 Sect OctLoc
   0    4365   ****** ******   ****** ******   ****** ******   ****** ******    ................

FITBUF
 Sect OctLoc
   0    4411   ****** ******   ****** ******   ****** ******   ****** ******    ................

ACCTNAME
 Sect OctLoc
   0    6411   ****** ******   ****** ******   ****** ******   ****** ******    ................

WHO_AM_I
 Sect OctLoc
   0    6417   ****** ******   ****** ******   ****** ******   ****** ******    ................

BAD_PATTERN
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:195  
 Sect OctLoc
   0    6427   ****** ******   ****** ******   ****** ******   ****** ******    ................

MAILBOX
 Sect OctLoc
   0    6446   ****** ******   ****** ******   ****** ******   ****** ******    ................

FPT_FID
 Sect OctLoc
   0    6474   000003 777640   006520 006000   000000 177640   000000 006014    ................
   0    6500   000007 777640   006526 006000   000001 777640   006524 006000    ................
   0    6504   000001 777640   006536 006000   000011 777640   006540 006000    ................
   0    6510   000000 177640   000000 006014   000000 777640   006564 006000    ................
   0    6514   000000 777640   006565 006000   000011 777640   006552 006000    ................
   0    6520   777000 000000   000000 000000   000000 000000   ****** ******    ................

VLP_ACCT
 Sect OctLoc
   0    6524   040040 040040   040040 040040

VLP_NAME
 Sect OctLoc
   0    6526   001040 040040   040040 040040   040040 040040   040040 040040    .
   0    6532   040040 040040   040040 040040   040040 040040   040040 040040

VLP_PASS
 Sect OctLoc
   0    6536   040040 040040   040040 040040

VLP_SN
 Sect OctLoc
   0    6540   000000 000006   040040 040040   040040 040040   040040 040040    ....
   0    6544   040040 040040   040040 040040   040040 040040   040040 040040
   0    6550   040040 040040   040040 040040

VLR_FID
 Sect OctLoc
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:196  
   0    6552   ****** ******   ****** ******   ****** ******   ****** ******    ................

(unnamed)
 Sect OctLoc
   0    6576   ****** ******   ****** ******   ****** ******   ****** ******    ................

ACCT_NODE
 Sect OctLoc
   2     000   072123 131123   040040 040040                                    :SYS

MODE
 Sect OctLoc
   3     000   006144 151141   154165 160040   040040 040040   010150 141162    .dialup     .har
   3     004   144167 151162   145040 040040                                    dwire

TYPE
 Sect OctLoc
   3     006   006103 120066   103060 060040   040006 103120   066102 060063    .CP6C00  .CP6B03
   3     012   040040 006103   120066 102060   062040 040003   103120 066040      .CP6B02  .CP6
   3     016   040040 040040   004103 120055   066040 040040   040003 103120        .CP-6    .CP
   3     022   126040 040040   040040 004103   120055 126040   040040 040005    V     .CP-V    .
   3     026   107103 117123   063040 040040   005107 103117   123070 040040    GCOS3   .GCOS8
   3     032   040007 107103   117123 066120   106040 005107   103117 123066     .GCOS6PF .GCOS6
   3     036   040040 040010   105130 124105   122116 101114                       .EXTERNAL

PASS_JI
 Sect OctLoc
   3     041   115157 156164   147155 162171                                    Montgmry

ERRMSGFID
 Sect OctLoc
   3     043   017072 126127   105122 122115   123107 056072   123131 123040    .:VWERRMSG.:SYS
   3     047   040040 040040   040040 040040   040040 040040   040040 040040
   3     053   040040 040040   040040 040040

CMD_LINK
 Sect OctLoc
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:197  
   3     055   117123 105116   104040 052115   117126 105115   101111 114040    OSEND *MOVEMAIL
   3     061   040040 040040   040040 040040   040040 040040   040040 040040
   3     075*  040040 040040   040040 040040   040040 040040   040040 040040

GOOD_PATTERN
 Sect OctLoc
   3     101   037041 162151   172141 127173   144156 141162   107175 145150    .!rizaW{dnarG}eh
   3     105   164133 162157   146135 144156   145123 174140   176045 136047    t[rof]dneS|`~%^'

(unnamed)
 Sect OctLoc
   3     111   000000 000040   000000 000001   052111 101115   123143 157164    ... ....*IAMScot
   3     115   164171 040040   041115 101111   114040 040040   103122 105101    ty  !MAIL   CREA
   3     121   124105 040106   117114 104105   122040 040040   125123 105040    TE FOLDER   USE
   3     125   057103 105116   124122 101114   120122 117106   111114 105040    /CENTRALPROFILE
   3     131   123111 107116   105104 075047   105116 104040   124162 141156    SIGNED='END Tran
   3     135   163160 157162   164145 162040   151144 154145   054040 103141    sporter idle, Ca
   3     141   160047 156056   056056 040040   115117 126105   072123 131123    p'n...  MOVE:SYS
   3     145   040040 040040   123103 117124   124131 040040   100000 000000        SCOTTY  @...
   3     151   124162 141156   163160 157162   164145 162040   145156 147141    Transporter enga
   3     155   147145 144056   102105 101115   123125 103113   123110 125124    ged.BEAMSUCKSHUT
   3     161   123110 125124   040125 120054   040123 124105   114114 101040    SHUT UP, STELLA
   3     165   115101 111114   117120 124123   114066 066101   114066 066102    MAILOPTSL66AL66B
   3     171   114066 066103   114066 066104   102115 123040   040105 117106    L66CL66DBMS  EOF
   3     175   104200 000000   123116 104122   072115 101111   114040 040040    D...SNDR:MAIL
   3     201   065060 060101   124117 102040   102125 123131   122103 126122    500ATOB BUSYRCVR
   3     205   124117 072040   072115 101111   114137 040040   072115 101111    TO: :MAIL_  :MAI
   3     211   114137 103105   116124 122101   114040 040040   123125 102112    L_CENTRAL   SUBJ
   3     215   105103 124072   123131 123040   040040 040040   103110 101122    ECT:SYS     CHAR
   3     221   041162 151172   141127 173144   156141 162107   175145 150164    !rizaW{dnarG}eht
   3     225   133162 157146   135144 156145   123174 140176   045136 047040    [rof]dneS|`~%^'

(unnamed)
 Sect OctLoc
  13     000   000001 000000   002750 006000   000043 006000   000000 006003    .........#......
  13     004   047040 040040   000007 777640   000001 777640   377777 777777    '   ............
  13     010   040040 040040   004341 006000   262715 000600   262715 000220        ............
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:198  
  13     014   262715 000250   262715 000150   262715 000700   000003 000000    .......h........
  13     020   000007 777640   006427 006000   000007 777640   000101 006000    .............A..
  13     024   004314 006000   000020 006000   000022 006000   777777 777770    ................
  13     030   000005 000000   000000 006014   004312 006000   004411 006000    ................
  13     034   000023 600000   000176 006000   004365 006000   004302 006000    .....~..........
  13     040   000001 006000   000000 000000   000204 006000   000051 006000    .............)..
  13     044   000241 006000   054040 040040   000121 006000   000171 006000    ....,   .Q...y..
  13     050   777777 600000   000023 577640   000024 200000   056040 040040    .............
  13     054   100040 040040   777777 777000   000311 006000                    @   ........
     1844    20957
     1845    20958    2   end UPDATE_STATUS;
     1846    20959    1   end VWS$SCOTTY;

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:199  
--  Include file information  --

   B$TABLES_C.:LIB_E05  cannot be made into a system file and is referenced.
   VW_FPTS_M.:VMB6TOU  cannot be made into a system file and is referenced.
   VW_NODEATER_E.:VMB6TOU  is referenced.
   VW_OPTS_M.:VMB6TOU  is referenced.
   VWM_ERRS_E.:VMB6TOU  is referenced.
   VW_MOVE_E.:VMB6TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   AS_SUPER_C.:LIB_E05  is referenced.
   KL_SUPER_C.:LIB_E05  is referenced.
   XUR_ENTRY.:LIB_E05  cannot be made into a system file and is referenced.
   XU_MACRO_C.:LIB_E05  is referenced.
   FM$FIT.:LIB_E05  is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VWS$SCOTTY.
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:200  

 **** Variables and constants ****

  ****  Section 000  Data  VWS$SCOTTY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  6473-0-0/w PTR         r     1 @OPT                    6571-0-0/w PTR         r     1 @OPT
  6445-0-0/w PTR         r     1 @WHO                    6411-0-0/c STRC(189)   r     1 ACCTNAME
  2050-0-0/c STRC(72)    r     1 ACCT_HLP                2222-0-0/c STRC(72)    r     1 ACCT_USERS
  4305-0-0/w SBIN              1 ARS                     6564-0-0/w SBIN        r     1 ASN
  6427-0-0/c STRC(288)   r     1 BAD_PATTERN             6437-0-0/c UBIN(6)     r     1 BIT6(0:11)
     1-0-0/c CHAR(80)    r     1 CARD(0:24)              2070-0-0/d STRC(1080)  r     1 CLOSE_HLP
  2452-0-0/d STRC(1080)  r     1 CLOSE_JE                1524-0-0/d STRC(1080)  r     1 CLOSE_JF
  1716-0-0/d STRC(1080)  r     1 CLOSE_JI                1360-0-0/d STRC(1080)  r     1 CLOSE_MAIL
  1100-0-0/d STRC(1080)  r     1 CLOSE_NODE              2304-0-0/d STRC(1080)  r     1 CLOSE_USERS
  2236-0-0/d STRC(288)   r     1 DEQ_USERS               2676-0-0/d STRC(360)   r     1 ENQ_ON_NODES
  2224-0-0/d STRC(360)   r     1 ENQ_USERS               4314-0-0/w STRC        r     1 ERRBITS
  4314-0-0/w UBIN        r     1 ERRCODE                 4312-0-0/w SBIN        r     1 ERRDCB
  4411-0-0/c CHAR(4096)  r     1 FITBUF                  6474-0-0/d STRC(864)   r     1 FPT_FID
  2600-0-0/d STRC(648)   r     1 FPT_RESCTL              2734-0-0/d STRC(216)   r     1 FPT_XCON1
  2742-0-0/d STRC(216)   r     1 FPT_XCON2               4024-0-0/w STRC(6084)  r     1 HLPBUF
  4302-0-0/w SBIN        r     1 I                       6566-0-0/w SBIN        r     1 I
  4303-0-0/w SBIN        r     1 J                       6567-0-0/w SBIN        r     1 J
  4365-0-0/c CHAR(80)    r     1 JEBUF                   4276-0-0/w PTR         r     1 JEPTR
  4341-0-0/c CHAR(80)    r     1 JIBUF                   4275-0-0/w PTR         r     1 JIPTR
  4304-0-0/w SBIN              1 K                       2710-0-0/d STRC(216)   r     1 KILL_VWB$BEAM
  2722-0-0/d STRC(216)   r     1 KILL_VWE$EVOM           2540-0-0/d STRC(576)   r     1 LINK_SEND
  2560-0-0/d STRC(576)   r     1 LINK_TO_NEW_SCOTTY      2524-0-0/d STRC(432)   r     1 LOGON_TIME
  4313-0-0/w UBIN        r     1 LOGON_UTS               6446-0-0/c STRC(720)   r     1 MAILBOX
  4277-0-0/w PTR         r     1 MAILPTR                 2046-0-0/c STRC(45)    r     1 NAME_HLP
  1654-0-0/c STRC(288)   r     1 NAME_JI                 1340-0-0/c STRC(90)    r     1 NAME_MAIL
  1242-0-0/c STRC(126)   r     1 NAME_MAILBOX            1060-0-0/c STRC(63)    r     1 NAME_NODE
  2220-0-0/c STRC(63)    r     1 NAME_USERS              2716-0-0/c STRC(81)    r     1 NAME_VWB$BEAM
  2730-0-0/c STRC(81)    r     1 NAME_VWE$EVOM           1136-0-0/c STRC(81)    r     1 NODEKEY
  1141-0-0/c STRC(198)   r     1 NODEOVR                 1141-0-0/c CHAR(22)    r     1 NODEREC
  1754-0-0/d STRC(2088)  r     1 OPEN_HLP                2342-0-0/d STRC(2088)  r     1 OPEN_JE
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:201  
  1416-0-0/d STRC(2088)  r     1 OPEN_JF                 1562-0-0/d STRC(2088)  r     1 OPEN_JI
  1246-0-0/d STRC(2088)  r     1 OPEN_MAIL               1150-0-0/d STRC(2088)  r     1 OPEN_MAILBOX
   766-0-0/d STRC(2088)  r     1 OPEN_NODE               2126-0-0/d STRC(2088)  r     1 OPEN_USERS
    *0-0-0/w STRC(1440)  r     1 OPT                       *0-0-0/w STRC(720)   r     1 OPT
  6575-0-0/w PTR         r     1 OPT$                    6574-0-0/w UBIN        r     1 OPTION
     1-0-0/c STRC(18000) r     1 OPTS                    4301-0-0/w SBIN        r     1 OPTX
  4300-0-0/w PTR         r     1 P                       6437-0-0/c CHAR(8)     r     1 PASSWORD
  1704-0-0/d STRC(360)   r     1 PRECORD_JI              2052-0-0/d STRC(504)   r     1 READ_HLP
  1666-0-0/d STRC(504)   r     1 READ_JI                 1062-0-0/d STRC(504)   r     1 READ_NODE
  2246-0-0/d STRC(504)   r     1 READ_USERS              6565-0-0/c CHAR(4)     r     1 RES
  2510-0-0/d STRC(216)   r     1 SLEEP                   2516-0-0/d STRC(216)   r     1 SNOOZE
  4315-0-0/c CHAR(80)    r     1 STATUS_LINE             2300-0-0/d STRC(144)   r     1 TRUNC_USERS
  3020-0-0/w STRC(18576) r     1 USERSBUF                6524-0-0/c STRC(72)    r     1 VLP_ACCT
  6526-0-0/c STRC(288)   r     1 VLP_NAME                6536-0-0/c STRC(72)    r     1 VLP_PASS
  2660-0-0/d STRC(504)   r     1 VLP_PRES                2622-0-0/d STRC(1080)  r     1 VLP_RPSN
  6540-0-0/d STRC(360)   r     1 VLP_SN                  6552-0-0/d STRC(324)   r     1 VLR_FID
  1664-0-0/c STRC(72)    r     1 VWS_ACCT_JI             4311-0-0/w SBIN              1 VW_BROKEN#
  6441-0-0/c CHAR(8)     r     1 VW_IAM#                 4306-0-0/w SBIN              1 VW_INPCNT#
     1-0-0/c CHAR(2000)  r     1 VW_OPTIONS#             4307-0-0/w SBIN              1 VW_OUTCNT#
  6443-0-0/b BIT         r     1 VW_SCRAMBLE#            4310-0-0/w SBIN              1 VW_TOTBYTES#
    *0-0-0/c CHAR(4)     r     1 WHO                     6417-0-0/c STRC(288)   r     1 WHO_AM_I
  2436-0-0/d STRC(432)   r     1 WRITE_JE                1510-0-0/d STRC(432)   r     1 WRITE_JF
  1344-0-0/d STRC(432)   r     1 WRITE_MAIL              2264-0-0/d STRC(432)   r     1 WRITE_USERS
  2434-0-0/c STRC(72)    r     1 WSN_JE                  2750-0-0/d STRC(1404)  r     1 XUR_INIT

  ****  Section 002 RtLmCm ACCT_NODE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(72)    r     1 ACCT_NODE

  ****  Section 003 RoData VWS$SCOTTY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:202  
    55-0-0/c STRC(720)   r     1 CMD_LINK                  43-0-0/c STRC(360)   r     1 ERRMSGFID
   101-0-0/c STRC(288)   r     1 GOOD_PATTERN               0-0-0/c STRC(108)         1 MODE(0:1)
    41-0-0/c STRC(72)    r     1 PASS_JI                    6-0-0/c STRC(81)          1 TYPE(0:11)

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$SR_NON_BLANK$
     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/c ASTR(9)     r     1 B_VERSION
     0-0-0/c CHAR(144)   r     1 VW_MAILBUF#                0-0-0/b STRC        r     1 VW_MAILKEY#
     0-0-0/b BIT         r     1 VW_OPERERR#

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/d STRC(4608)  r     1 B$SR_NON_BLANK             0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/d ASTR(3528)  r     1 DUMMY                      0-0-0/w STRC(1116)  r     1 FM$FIT
     0-0-0/w STRC(288)   r     1 FS$JOBORIG                 0-0-0N  NULL        r     1 M$HLP
     0-0-0N  NULL        r     1 M$JE                       0-0-0N  NULL        r     1 M$JF
     0-0-0N  NULL        r     1 M$JI                       0-0-0N  NULL        r     1 M$LM
     0-0-0N  NULL        r     1 M$MAIL                     0-0-0N  NULL        r     1 M$NODE
     0-0-0N  NULL        r     1 M$UC                       0-0-0N  NULL        r     1 M$USERS
     0-0-0/c STRC(720)   r     1 OPTSCHAR                   0-0-0/c STRC(720)         1 OPTSDATE
     0-0-0/c STRC(720)         1 OPTSRECS


   Procedure VWS$SCOTTY requires 1541 words for executable code.
   Procedure VWS$SCOTTY is declared NOAUTO and requires 3462 words of local(STATIC) storage.

    No errors detected in file VWS$SCOTTY.:VMB6TSI    .
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:203  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:204  
          MINI XREF LISTING

ACCTNAME
     19460**DCL     17898--DCLINIT 17899--DCLINIT 18142--DCLINIT 18190--DCLINIT 18191--DCLINIT 18233--DCLINIT
ACCTNAME.ACCT
     19462**DCL     20708<<ASSIGN  20788>>ASSIGN  20790>>ASSIGN
ACCTNAME.L
     19461**DCL     20711<<ASSIGN
ACCTNAME.NAME
     19463**DCL     20709<<ASSIGN  20710>>CALLBLT 20789>>ASSIGN
ACCT_HLP
     17874**DCL     17792--DCLINIT
ACCT_NODE
     16500**DCL     16417--DCLINIT
ACCT_USERS
     18125**DCL     18043--DCLINIT
ASN IN PROCEDURE GENERATE_ADDRESS
     20573**DCL     20467--DCLINIT
B$ALT.CODE
     18883**DCL     18883--REDEF   18884--REDEF   18884--REDEF
B$ALT.ERR
     18884**DCL     19900>>ASSIGN  19955>>ASSIGN  20018>>ASSIGN
B$ALT.ERR.ERR#
     18885**DCL     18885--REDEF
B$ALT.EVID
     18884**DCL     18884--REDEF   18884--REDEF
B$JIT.ACCN
      6520**DCL     19581<<ASSIGN  19664<<ASSIGN  20241>>IF      20631>>CALLBLT 20788<<ASSIGN  20851<<ASSIGN
B$JIT.CCBUF
      6608**DCL     20953<<ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      6614**DCL      6614--REDEF
B$JIT.DEFEXP
      6688**DCL     20791<<ASSIGN
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:205  
B$JIT.ERR.MID
      6521**DCL      6521--REDEF
B$JIT.FACCN
      6520**DCL     19582<<ASSIGN  19666<<ASSIGN  20790<<ASSIGN  20853<<ASSIGN
B$JIT.JOBNAME
      6669**DCL     19585>>IF      19590<<ASSIGN
B$JIT.JRESPEAK
      6682**DCL      6683--REDEF
B$JIT.MAXEXP
      6688**DCL     20792<<ASSIGN
B$JIT.MODE
      6515**DCL     19530>>IF
B$JIT.MRT
      6694**DCL     19667<<ASSIGN
B$JIT.ORIGINATOR_PORT.FROM_CR
      6791**DCL      6791--REDEF    6792--REDEF
B$JIT.PNR
      6695**DCL      6695--REDEF
B$JIT.PRIV.ACTIVE
      6521**DCL     19537<<ASSIGN  19669<<ASSIGN  20033<<ASSIGN  20054<<ASSIGN  20076<<ASSIGN  20707>>IF
     20786<<ASSIGN  20854<<ASSIGN
B$JIT.PRIV.ACTIVE.JIT
      6525**DCL     19536>>IF      19580>>IF      19589>>IF      19663>>IF      20032>>IF      20053>>IF
     20075>>IF      20146>>IF      20785>>IF      20850>>IF      20952>>IF
B$JIT.PRIV.AUTH
      6561**DCL     19538<<ASSIGN  19538>>ASSIGN
B$JIT.REMCPO
      6793**DCL     19668<<ASSIGN  20147<<ASSIGN
B$JIT.TSLINE
      6789**DCL      6790--REDEF
B$JIT.UNAME
      6520**DCL     19665<<ASSIGN  20241>>IF      20789<<ASSIGN  20852<<ASSIGN
B$JIT$
     19426**DCL      6515--IMP-PTR 19530>>IF      19536>>IF      19537>>ASSIGN  19538>>ASSIGN  19538>>ASSIGN
     19580>>IF      19581>>ASSIGN  19582>>ASSIGN  19585>>IF      19589>>IF      19590>>ASSIGN  19663>>IF
     19664>>ASSIGN  19665>>ASSIGN  19666>>ASSIGN  19667>>ASSIGN  19668>>ASSIGN  19669>>ASSIGN  20032>>IF
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:206  
     20033>>ASSIGN  20053>>IF      20054>>ASSIGN  20075>>IF      20076>>ASSIGN  20146>>IF      20147>>ASSIGN
     20241>>IF      20241>>IF      20631>>CALLBLT 20707>>IF      20785>>IF      20786>>ASSIGN  20788>>ASSIGN
     20789>>ASSIGN  20790>>ASSIGN  20791>>ASSIGN  20792>>ASSIGN  20850>>IF      20851>>ASSIGN  20852>>ASSIGN
     20853>>ASSIGN  20854>>ASSIGN  20952>>IF      20953>>ASSIGN
B$SR_NON_BLANK
     16845**DCL     20594>>CALLBLT
B$SR_NON_BLANK$
     16844**DCL     16845--IMP-PTR 20594>>CALLBLT
B$TCB.ALT$
     18878**DCL     19900>>ASSIGN  19955>>ASSIGN  20018>>ASSIGN
B$TCB$
     19425**DCL     19900>>ASSIGN  19955>>ASSIGN  20018>>ASSIGN
BAD_CMD
     19888**LABEL   19724--GOTO
BAD_DST
     19914**LABEL   20101--CALLALT 20104--CALLALT
BAD_JIF
     19967**LABEL   19717--CALLALT 19781--CALLALT 19786--CALLALT 19804--CALLALT 19809--CALLALT 19833--CALLALT
     19837--CALLALT 19856--CALLALT 19867--CALLALT 19957--GOTO
BAD_JIO
     19955**LABEL   19679--CALLALT
BAD_LGN
     19924**LABEL   20233--CALLALT 20286--CALLALT
BAD_NOD
     19900**LABEL   19548--CALLALT 19551--CALLALT
BAD_PATTERN
     19486**DCL     19945--CALL
BAD_PATTERN.C
     19488**DCL     20942<<ASSIGN
BAD_RJI
     19998**LABEL   20197--GOTO
BAD_SUK
     19934**LABEL   20242--GOTO
BAD_SYSERR
     20018**LABEL   19968--GOTO    19979--GOTO    19989--GOTO    19999--GOTO
BAD_TRANSLATION
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:207  
     19944**LABEL   20231--CALLALT 20284--CALLALT
BAD_USRERR
     20008**LABEL   19889--GOTO    19905--GOTO    19915--GOTO    19925--GOTO    19935--GOTO
BAD_VIA
     19978**LABEL   20150--CALLALT
BAD_WRM
     19988**LABEL   20159--CALLALT 20171--CALLALT 20186--CALLALT 20206--CALLALT
BEAM_BUSY
     20299**LABEL   20287--CALLALT
BIT6
     19492**DCL     20713<<ASSIGN
B_VERSION.L#
     19479**DCL     19480--IMP-SIZ 19561>>CALLBLT 19562>>ASSIGN
B_VERSION.NAME#
     19480**DCL     19561>>CALLBLT
CARD
     16130**DCL     19779<<ASSIGN  19784<<ASSIGN  19802<<ASSIGN  19807<<ASSIGN  19831<<ASSIGN  19836<<ASSIGN
CHECK_PACKET
     20918**PROC    20231--CALL    20284--CALL
CLOSE_HLP
     17946**DCL     20732<>CALL    20806<>CALL
CLOSE_HLP.SN_
     17946**DCL     17946--REDEF
CLOSE_HLP.UTL_
     17947**DCL     17947--REDEF
CLOSE_HLP.V
     17951**DCL     17946--DCLINIT
CLOSE_HLP.V.EXPIRE#
     17961**DCL     17961--REDEF
CLOSE_HLP.V.TYPE#
     17959**DCL     17959--REDEF
CLOSE_HLP.V.XTNSIZE#
     17956**DCL     17956--REDEF   17958--REDEF
CLOSE_JE
     18501**DCL     20040<>CALL    20061<>CALL    20083<>CALL
CLOSE_JE.SN_
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:208  
     18501**DCL     18501--REDEF
CLOSE_JE.UTL_
     18502**DCL     18502--REDEF
CLOSE_JE.V
     18506**DCL     18501--DCLINIT
CLOSE_JE.V.DISP#
     18510**DCL     20039<<ASSIGN  20060<<ASSIGN  20082<<ASSIGN
CLOSE_JE.V.EXPIRE#
     18516**DCL     18516--REDEF
CLOSE_JE.V.TYPE#
     18514**DCL     18514--REDEF
CLOSE_JE.V.XTNSIZE#
     18511**DCL     18511--REDEF   18513--REDEF
CLOSE_JF
     17402**DCL     19606<>CALL
CLOSE_JF.SN_
     17402**DCL     17402--REDEF
CLOSE_JF.UTL_
     17403**DCL     17403--REDEF
CLOSE_JF.V
     17407**DCL     17402--DCLINIT
CLOSE_JF.V.EXPIRE#
     17417**DCL     17417--REDEF
CLOSE_JF.V.TYPE#
     17415**DCL     17415--REDEF
CLOSE_JF.V.XTNSIZE#
     17412**DCL     17412--REDEF   17414--REDEF
CLOSE_JI
     17695**DCL     19735<>CALL    20036<>CALL    20057<>CALL    20079<>CALL
CLOSE_JI.SN_
     17695**DCL     17695--REDEF
CLOSE_JI.UTL_
     17696**DCL     17696--REDEF
CLOSE_JI.V
     17700**DCL     17695--DCLINIT
CLOSE_JI.V.DISP#
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:209  
     17704**DCL     19734<<ASSIGN  20035<<ASSIGN  20056<<ASSIGN  20078<<ASSIGN
CLOSE_JI.V.EXPIRE#
     17710**DCL     17710--REDEF
CLOSE_JI.V.TYPE#
     17708**DCL     17708--REDEF
CLOSE_JI.V.XTNSIZE#
     17705**DCL     17705--REDEF   17707--REDEF
CLOSE_MAIL
     17208**DCL     20257<>CALL    20301<>CALL    20411<>CALL    20880<>CALL
CLOSE_MAIL.SN_
     17208**DCL     17208--REDEF
CLOSE_MAIL.UTL_
     17209**DCL     17209--REDEF
CLOSE_MAIL.V
     17213**DCL     17208--DCLINIT
CLOSE_MAIL.V.DISP#
     17217**DCL     20256<<ASSIGN  20300<<ASSIGN  20410<<ASSIGN
CLOSE_MAIL.V.EXPIRE#
     17223**DCL     17223--REDEF
CLOSE_MAIL.V.TYPE#
     17221**DCL     17221--REDEF
CLOSE_MAIL.V.XTNSIZE#
     17218**DCL     17218--REDEF   17220--REDEF
CLOSE_NODE
     16572**DCL     19643<>CALL
CLOSE_NODE.SN_
     16572**DCL     16572--REDEF
CLOSE_NODE.UTL_
     16573**DCL     16573--REDEF
CLOSE_NODE.V
     16577**DCL     16572--DCLINIT
CLOSE_NODE.V.EXPIRE#
     16587**DCL     16587--REDEF
CLOSE_NODE.V.TYPE#
     16585**DCL     16585--REDEF
CLOSE_NODE.V.XTNSIZE#
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:210  
     16582**DCL     16582--REDEF   16584--REDEF
CLOSE_THE_MAIL_FILE
     20842**PROC    20042--CALL    20063--CALL    20085--CALL
CLOSE_USERS
     18289**DCL     20768<>CALL    20808<>CALL
CLOSE_USERS.SN_
     18289**DCL     18289--REDEF
CLOSE_USERS.UTL_
     18290**DCL     18290--REDEF
CLOSE_USERS.V
     18294**DCL     18289--DCLINIT
CLOSE_USERS.V.EXPIRE#
     18304**DCL     18304--REDEF
CLOSE_USERS.V.TYPE#
     18302**DCL     18302--REDEF
CLOSE_USERS.V.XTNSIZE#
     18299**DCL     18299--REDEF   18301--REDEF
CMD_LINK
     19469**DCL     18591--DCLINIT
CTMF_ALTRET IN PROCEDURE CLOSE_THE_MAIL_FILE
     20913**LABEL   20895--CALLALT 20904--CALLALT
CTMF_IGNORE IN PROCEDURE CLOSE_THE_MAIL_FILE
     20893**LABEL   20881--CALLALT
DEQ_USERS
     18162**DCL     20751<>CALL    20767<>CALL
DEQ_USERS.V
     18163**DCL     18162--DCLINIT
DO_BEAM
     20275**LABEL   19878--GOTO
DO_POST
     20100**LABEL   19760--GOTO
DO_SUCK
     20222**LABEL   19876--GOTO
DUMMY.ACCT#
     18836**DCL     19645--ASSIGN
DUMMY.ACTPOS
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:211  
     18852**DCL     18852--REDEF
DUMMY.ARS#
     18826**DCL     18826--REDEF   19749>>IF      20102>>IF
DUMMY.ATTR
     18845**DCL     18846--REDEF
DUMMY.BORROW
     18860**DCL     18860--REDEF   18860--REDEF   18860--REDEF
DUMMY.DCBNAME.L
     18874**DCL     18874--IMP-SIZ
DUMMY.EOMCHAR#
     18830**DCL     18830--REDEF
DUMMY.FCD#
     18839**DCL     20034>>IF      20038>>IF      20055>>IF      20059>>IF      20077>>IF      20081>>IF
     20409>>IF      20805>>IF      20807>>IF      20865>>IF
DUMMY.FLDID
     18855**DCL     18855--REDEF
DUMMY.FORM$
     18849**DCL     18849--REDEF
DUMMY.FSECT
     18865**DCL     18865--REDEF
DUMMY.FSN#
     18842**DCL     18842--REDEF   18842--REDEF   18843--REDEF
DUMMY.HEADER$
     18848**DCL     18848--REDEF
DUMMY.IXTNSIZE#
     18846**DCL     18846--REDEF
DUMMY.LASTSTA$
     18835**DCL     18835--REDEF
DUMMY.LVL
     18861**DCL     18861--REDEF
DUMMY.NAME#
     18836**DCL     19644--ASSIGN  19689>>ASSIGN
DUMMY.NAME#.C
     18836**DCL     18836--REDEF   19603>>CALLBLT 19690>>IF
DUMMY.NAME#.L
     18836**DCL     19603>>CALLBLT 19690>>IF
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:212  
DUMMY.NOEOF
     18858**DCL     18858--REDEF
DUMMY.NRECS#
     18847**DCL     18847--REDEF
DUMMY.NRECX
     18866**DCL     18866--REDEF
DUMMY.OHDR
     18858**DCL     18858--REDEF
DUMMY.ORG#
     18841**DCL     18841--REDEF
DUMMY.PRECNO
     18864**DCL     18864--REDEF
DUMMY.RCSZ
     18870**DCL     18870--REDEF
DUMMY.RES#
     18837**DCL     18837--REDEF
DUMMY.SETX
     18849**DCL     18849--REDEF
DUMMY.TAB$
     18849**DCL     18849--REDEF
DUMMY.TDA
     18863**DCL     18864--REDEF
DUMMY.TYC
     18826**DCL     20196>>IF
DUMMY.WSN#
     18837**DCL     18837--REDEF
ENQ_ON_NODES
     18683**DCL     19564<>CALL
ENQ_ON_NODES.V
     18684**DCL     18683--DCLINIT
ENQ_USERS
     18142**DCL     20749<>CALL
ENQ_USERS.V
     18143**DCL     18142--DCLINIT
ERRBITS
     19445**DCL     19900<<ASSIGN  19955<<ASSIGN  20018<<ASSIGN
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:213  
ERRBITS.CODE
     19448**DCL     19901>>IF      19956>>IF
ERRBITS.SEV
     19449**DCL     20019<<ASSIGN
ERRCODE
     19444**DCL     19445--REDEF   19888<<ASSIGN  19914<<ASSIGN  19924<<ASSIGN  19934<<ASSIGN  19944<<ASSIGN
     19945<>CALL    20008<>CALL    20020<>CALL
ERRDCB
     19441**DCL     19967<<ASSIGN  19978<<ASSIGN  19988<<ASSIGN  19998<<ASSIGN  20020<>CALL
ERRMSGFID
     19465**DCL     19519<>CALL
FITBUF
     19454**DCL     17502--DCLINIT 20119--ASSIGN  20867<<ASSIGN  20868>>CALLBLT
FM$FIT.CODES.CODE
     18891**DCL     20121>>DOWHILE 20121>>DOWHILE 20124>>IF
FM$FIT.CODES.ITEMX
     18891**DCL     20125>>ASSIGN
FPT_FID IN PROCEDURE GENERATE_ADDRESS
     20464**DCL     20604<>CALL
FPT_FID.TEXTFID_ IN PROCEDURE GENERATE_ADDRESS
     20464**DCL     20585<<ASSIGN
FPT_FID.V IN PROCEDURE GENERATE_ADDRESS
     20468**DCL     20464--DCLINIT
FPT_RESCTL
     18627**DCL     20895<>CALL    20904<>CALL
FPT_RESCTL.V
     18629**DCL     18627--DCLINIT
FPT_XCON1
     18799**DCL     19532<>CALL
FPT_XCON1.V
     18800**DCL     18799--DCLINIT
FPT_XCON2
     18815**DCL     19586<>CALL    19607<>CALL    19646<>CALL    19736<>CALL
FPT_XCON2.V
     18816**DCL     18815--DCLINIT
FS$JOBORIG.ORIGINATOR_PORT.FROM_CR
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:214  
     18938**DCL     18941--REDEF   18944--REDEF
FS$JOBORIG.ORIGINATOR_PORT.FROM_CR.TNAME
     18940**DCL     20126>>IF      20126>>IF      20126>>IF      20126>>IF      20126>>IF
GENERATE_ADDRESS IN PROCEDURE OPEN_THE_MAIL_FILE
     20439**PROC    20363--CALL    20373--CALL    20383--CALL
GOOD_PATTERN
     19482**DCL     19945--CALL
HLPBUF
     19258**DCL     17900--DCLINIT 17901--DCLINIT
HLPBUF.PASSWORD
     19316**DCL     19320--REDEF   20754>>IF      20776>>IF
HLPBUF.RENAME
     19339**DCL     19340--REDEF
I
     19433**DCL     19826<<ASSIGN  19828<<ASSIGN  19830<<ASSIGN  19831>>ASSIGN  19836>>ASSIGN  20120<<ASSIGN
     20121>>DOWHILE 20121>>DOWHILE 20122<<ASSIGN  20122>>ASSIGN  20124>>IF      20125>>ASSIGN  20158<<ASSIGN
     20159<>CALL    20205<<ASSIGN  20206<>CALL    20710<<CALLBLT 20711>>ASSIGN  20712<<DOINDEX 20713>>ASSIGN
     20713>>ASSIGN  20869<<CALLBLT 20870>>ASSIGN  20896<<DOINDEX 20897>>IF      20898>>ASSIGN  20901>>ASSIGN
I IN PROCEDURE GENERATE_ADDRESS
     20576**DCL     20589<<CALLBLT 20589<<ASSIGN  20592>>IF      20594<<CALLBLT 20596<<ASSIGN  20596>>ASSIGN
     20599<<ASSIGN  20601>>ASSIGN  20615<<ASSIGN  20621<<ASSIGN  20621>>ASSIGN  20625<<ASSIGN  20625>>ASSIGN
     20629>>CALLBLT 20631>>CALLBLT 20632<<CALLBLT 20634>>CALLBLT 20635<<CALLBLT 20646>>CALLBLT 20647<<CALLBLT
     20647>>CALLBLT 20649>>ASSIGN
IMPERSONATE_USER
     20691**PROC    20233--CALL    20286--CALL
J
     19434**DCL     20360<<ASSIGN  20364>>CALLBLT 20365<<ASSIGN  20365>>ASSIGN  20369>>IF      20370>>CALLBLT
     20371<<ASSIGN  20371>>ASSIGN  20374>>CALLBLT 20375<<ASSIGN  20375>>ASSIGN  20379>>IF      20380>>CALLBLT
     20381<<ASSIGN  20381>>ASSIGN  20384>>CALLBLT 20385<<ASSIGN  20385>>ASSIGN  20388>>ASSIGN
J IN PROCEDURE GENERATE_ADDRESS
     20577**DCL     20594<<CALLBLT
JEBUF
     19453**DCL     18462--DCLINIT 18463--DCLINIT 20159<>CALL    20168<<ASSIGN  20170<>CALL    20182<<ASSIGN
     20185>>IF      20206<>CALL
JEPTR
     19428**DCL     19534<<ASSIGN  20038>>IF      20059>>IF      20081>>IF
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:215  
JIBUF
     19452**DCL     17363--DCLINIT 17364--DCLINIT 17625--DCLINIT 17626--DCLINIT 19592<<ASSIGN  19594<<ASSIGN
     19596<<ASSIGN  19598<<CALLBLT 19601<<ASSIGN  19603<<CALLBLT 19704<<ASSIGN  19718>>IF      19718>>IF
     19718>>IF      19720<>CALL    19722>>IF      19722>>IF      19722>>IF      19733>>IF      19747>>ASSIGN
     19750<<ASSIGN  19759>>IF      19778>>IF      19779>>ASSIGN  19780<<ASSIGN  19783<>CALL    19784>>ASSIGN
     19785<<ASSIGN  19788<>CALL    19801>>IF      19802>>ASSIGN  19803<<ASSIGN  19806<>CALL    19807>>ASSIGN
     19808<<ASSIGN  19811<>CALL    19824>>DOWHILE 19825>>IF      19827>>IF      19831>>ASSIGN  19832<<ASSIGN
     19835<>CALL    19836>>ASSIGN  19839<>CALL    19853>>DOWHILE 19854>>ASSIGN  19858<>CALL    20100>>ASSIGN
     20168>>ASSIGN  20180<<ASSIGN  20182>>ASSIGN  20184<>CALL
JIPTR
     19427**DCL     19533<<ASSIGN  19689>>ASSIGN  19690>>IF      19690>>IF      20034>>IF      20055>>IF
     20077>>IF      20196>>IF
KILL_VWB$BEAM
     18704**DCL     19620<>CALL
KILL_VWB$BEAM.V
     18705**DCL     18704--DCLINIT
KILL_VWE$EVOM
     18752**DCL     19623<>CALL
KILL_VWE$EVOM.V
     18753**DCL     18752--DCLINIT
LINK_SEND
     18590**DCL     20881<>CALL
LINK_SEND.V
     18592**DCL     18592--DCLINIT
LINK_TO_NEW_SCOTTY
     18609**DCL     19647<>CALL
LINK_TO_NEW_SCOTTY.ACCT_
     18609**DCL     19645<<ASSIGN
LINK_TO_NEW_SCOTTY.NAME_
     18609**DCL     19644<<ASSIGN
LINK_TO_NEW_SCOTTY.V
     18611**DCL     18611--DCLINIT
LOGON_TIME
     18567**DCL     20760<>CALL
LOGON_TIME.V
     18571**DCL     18567--DCLINIT
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:216  
LOGON_UTS
     19442**DCL     18571--DCLINIT 20761>>ASSIGN  20762>>ASSIGN
M$CLOSE
      5581**DCL-ENT 19606--CALL    19643--CALL    19735--CALL    20036--CALL    20040--CALL    20057--CALL
     20061--CALL    20079--CALL    20083--CALL    20257--CALL    20301--CALL    20411--CALL    20732--CALL
     20768--CALL    20806--CALL    20808--CALL    20880--CALL
M$DEQ
      5648**DCL-ENT 20751--CALL    20767--CALL
M$DISPRES
      5588**DCL-ENT 20895--CALL
M$ENQ
      5647**DCL-ENT 19564--CALL    20749--CALL
M$EXIT
      5593**DCL-ENT 19608--CALL
M$FID
      5644**DCL-ENT 20604--CALL
M$HLP
     19420**DCL     20805--IF
M$JE
     19419**DCL     19534--ASSIGN  19988>>ASSIGN  20159<>CALL    20206<>CALL
M$JI
     19418**DCL     19533--ASSIGN  19967>>ASSIGN  19998>>ASSIGN
M$LDTRC
      5594**DCL-ENT 19647--CALL
M$LINK
      5593**DCL-ENT 20881--CALL
M$LM
     19416**DCL     19603--CALLBLT 19603--CALLBLT 19644--ASSIGN  19645--ASSIGN
M$MAIL
     19422**DCL     19535--ASSIGN  19978>>ASSIGN
M$NODE
     19423**DCL     19749--IF      20102--IF
M$OLAY
      5593**DCL-ENT 19620--CALL    19623--CALL
M$OPEN
      5581**DCL-ENT 19548--CALL    19584--CALL    19591--CALL    19679--CALL    20150--CALL    20348--CALL
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:217  
     20730--CALL    20748--CALL
M$PRECORD
      5585**DCL-ENT 19867--CALL
M$READ
      5582**DCL-ENT 19551--CALL    19717--CALL    19748--CALL    19781--CALL    19786--CALL    19804--CALL
     19809--CALL    19833--CALL    19837--CALL    19856--CALL    20101--CALL    20104--CALL    20181--CALL
     20731--CALL    20750--CALL
M$RELRES
      5588**DCL-ENT 20904--CALL
M$TIME
      5648**DCL-ENT 20760--CALL
M$TRUNC
      5582**DCL-ENT 20766--CALL
M$USERS
     19421**DCL     20807--IF
M$WAIT
      5639**DCL-ENT 19628--CALL    19902--CALL    20728--CALL    20746--CALL
M$WRITE
      5582**DCL-ENT 19593--CALL    19595--CALL    19597--CALL    19600--CALL    19602--CALL    19605--CALL
     20171--CALL    20186--CALL    20389--CALL    20765--CALL    20871--CALL
M$XCON
      5636**DCL-ENT 19532--CALL    19586--CALL    19607--CALL    19646--CALL    19736--CALL
M$XXX
      5593**DCL-ENT 19587--CALL
MAILBOX.C IN PROCEDURE OPEN_THE_MAIL_FILE
     20337**DCL     20364>>CALLBLT 20374>>CALLBLT 20384>>CALLBLT 20591<<ASSIGN  20593<<ASSIGN  20594>>CALLBLT
     20620<<CALLBLT 20624<<CALLBLT 20629<<CALLBLT 20631<<CALLBLT 20632>>CALLBLT 20634<<CALLBLT 20635>>CALLBLT
     20646<<CALLBLT 20647>>CALLBLT
MAILBOX.L IN PROCEDURE OPEN_THE_MAIL_FILE
     20336**DCL     20364>>CALLBLT 20364>>CALLBLT 20365>>ASSIGN  20374>>CALLBLT 20374>>CALLBLT 20375>>ASSIGN
     20384>>CALLBLT 20384>>CALLBLT 20385>>ASSIGN  20590<<ASSIGN  20601<<ASSIGN  20649<<ASSIGN
MAILPTR
     19429**DCL     19535<<ASSIGN  20409>>IF      20865>>IF
NAME_HLP
     17859**DCL     17788--DCLINIT
NAME_JI
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:218  
     17569**DCL     17498--DCLINIT 19689<<ASSIGN
NAME_JI.L#
     17569**DCL     19659<<ASSIGN
NAME_JI.NAME#
     17569**DCL     19660<<ASSIGN
NAME_MAIL
     17144**DCL     17073--DCLINIT
NAME_MAILBOX
     16996**DCL     16926--DCLINIT
NAME_NODE
     16484**DCL     16413--DCLINIT
NAME_USERS
     18110**DCL     18039--DCLINIT
NAME_VWB$BEAM
     18736**DCL     18704--DCLINIT
NAME_VWE$EVOM
     18784**DCL     18752--DCLINIT
NEXT_FILE
     19663**LABEL   20043--GOTO    20064--GOTO    20086--GOTO
NODEKEY
     16628**DCL     16524--DCLINIT 16525--DCLINIT
NODEKEY.C
     16630**DCL     19550<<ASSIGN  19747<<ASSIGN  20100<<ASSIGN  20103<<ASSIGN
NODEKEY.L
     16629**DCL     19549<<ASSIGN
NODEOVR
     16639**DCL     16734--REDEF
NODEOVR.NODE_NAME
     16668**DCL     20126>>IF      20126>>IF      20126>>IF      20126>>IF      20126>>IF
NODEOVR.PATH_NAME
     16648**DCL     16659--REDEF   19552>>ASSIGN  19750>>ASSIGN  20103>>ASSIGN  20148>>ASSIGN
NODEOVR.TYPE_PATH
     16697**DCL     20158>>ASSIGN  20205>>ASSIGN
NODEREC
     16734**DCL     16526--DCLINIT 16527--DCLINIT
OPEN_HLP
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:219  
     17787**DCL     20730<>CALL
OPEN_HLP.ACSVEH_
     17789**DCL     17790--REDEF
OPEN_HLP.ALTKEYS_
     17795**DCL     17796--REDEF   17796--REDEF
OPEN_HLP.HDR_
     17794**DCL     17795--REDEF
OPEN_HLP.TAB_
     17793**DCL     17794--REDEF
OPEN_HLP.UHL_
     17787**DCL     17788--REDEF   17788--REDEF
OPEN_HLP.V
     17796**DCL     17787--DCLINIT
OPEN_HLP.V.FSN#
     17827**DCL     17827--REDEF   17827--REDEF
OPEN_HLP.WSN_
     17793**DCL     17793--REDEF
OPEN_JE
     18382**DCL     20150<>CALL
OPEN_JE.ACSVEH_
     18384**DCL     18385--REDEF
OPEN_JE.ALTKEYS_
     18390**DCL     18391--REDEF   18391--REDEF
OPEN_JE.HDR_
     18389**DCL     18390--REDEF
OPEN_JE.TAB_
     18388**DCL     18389--REDEF
OPEN_JE.UHL_
     18382**DCL     18383--REDEF   18383--REDEF
OPEN_JE.V
     18391**DCL     18382--DCLINIT
OPEN_JE.V.FSN#
     18422**DCL     18422--REDEF   18422--REDEF
OPEN_JE.WSN_
     18388**DCL     18388--REDEF
OPEN_JF
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:220  
     17298**DCL     19591<>CALL
OPEN_JF.ACSVEH_
     17300**DCL     17301--REDEF
OPEN_JF.ALTKEYS_
     17306**DCL     17307--REDEF   17307--REDEF
OPEN_JF.HDR_
     17305**DCL     17306--REDEF
OPEN_JF.TAB_
     17304**DCL     17305--REDEF
OPEN_JF.UHL_
     17298**DCL     17299--REDEF   17299--REDEF
OPEN_JF.V
     17307**DCL     17298--DCLINIT
OPEN_JF.V.FSN#
     17338**DCL     17338--REDEF   17338--REDEF
OPEN_JF.WSN_
     17304**DCL     17304--REDEF
OPEN_JI
     17497**DCL     19679<>CALL
OPEN_JI.ACSVEH_
     17499**DCL     17500--REDEF
OPEN_JI.ALTKEYS_
     17505**DCL     17506--REDEF   17506--REDEF
OPEN_JI.HDR_
     17504**DCL     17505--REDEF
OPEN_JI.TAB_
     17503**DCL     17504--REDEF
OPEN_JI.UHL_
     17497**DCL     17498--REDEF   17498--REDEF
OPEN_JI.V
     17506**DCL     17497--DCLINIT
OPEN_JI.V.FSN#
     17537**DCL     17537--REDEF   17537--REDEF
OPEN_JI.WSN_
     17503**DCL     17503--REDEF
OPEN_MAIL
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:221  
     17072**DCL     20348<>CALL
OPEN_MAIL.ACSVEH_
     17074**DCL     17075--REDEF
OPEN_MAIL.ALTKEYS_
     17080**DCL     17081--REDEF   17081--REDEF
OPEN_MAIL.HDR_
     17079**DCL     17080--REDEF
OPEN_MAIL.TAB_
     17078**DCL     17079--REDEF
OPEN_MAIL.UHL_
     17072**DCL     17073--REDEF   17073--REDEF
OPEN_MAIL.V
     17081**DCL     17072--DCLINIT
OPEN_MAIL.V.FSN#
     17112**DCL     17112--REDEF   17112--REDEF
OPEN_MAIL.WSN_
     17078**DCL     17078--REDEF
OPEN_MAILBOX
     16925**DCL     19584<>CALL
OPEN_MAILBOX.ACSVEH_
     16927**DCL     16928--REDEF
OPEN_MAILBOX.ALTKEYS_
     16933**DCL     16934--REDEF   16934--REDEF
OPEN_MAILBOX.HDR_
     16932**DCL     16933--REDEF
OPEN_MAILBOX.TAB_
     16931**DCL     16932--REDEF
OPEN_MAILBOX.UHL_
     16925**DCL     16926--REDEF   16926--REDEF
OPEN_MAILBOX.V
     16934**DCL     16925--DCLINIT
OPEN_MAILBOX.V.FSN#
     16965**DCL     16965--REDEF   16965--REDEF
OPEN_MAILBOX.WSN_
     16931**DCL     16931--REDEF
OPEN_NODE
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:222  
     16412**DCL     19548<>CALL
OPEN_NODE.ACSVEH_
     16414**DCL     16415--REDEF
OPEN_NODE.ALTKEYS_
     16420**DCL     16421--REDEF   16421--REDEF
OPEN_NODE.HDR_
     16419**DCL     16420--REDEF
OPEN_NODE.TAB_
     16418**DCL     16419--REDEF
OPEN_NODE.UHL_
     16412**DCL     16413--REDEF   16413--REDEF
OPEN_NODE.V
     16421**DCL     16412--DCLINIT
OPEN_NODE.V.FSN#
     16452**DCL     16452--REDEF   16452--REDEF
OPEN_NODE.WSN_
     16418**DCL     16418--REDEF
OPEN_THE_MAIL_FILE
     20331**PROC    20223--CALL    20276--CALL
OPEN_USERS
     18038**DCL     20748<>CALL
OPEN_USERS.ACSVEH_
     18040**DCL     18041--REDEF
OPEN_USERS.ALTKEYS_
     18046**DCL     18047--REDEF   18047--REDEF
OPEN_USERS.HDR_
     18045**DCL     18046--REDEF
OPEN_USERS.TAB_
     18044**DCL     18045--REDEF
OPEN_USERS.UHL_
     18038**DCL     18039--REDEF   18039--REDEF
OPEN_USERS.V
     18047**DCL     18038--DCLINIT
OPEN_USERS.V.FSN#
     18078**DCL     18078--REDEF   18078--REDEF
OPEN_USERS.WSN_
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:223  
     18044**DCL     18044--REDEF
OPT IN PROCEDURE GENERATE_ADDRESS
     20567**DCL     20439--PROC
OPT.MAILBOX IN PROCEDURE GENERATE_ADDRESS
     20571**DCL     20585--ASSIGN  20589>>CALLBLT 20592>>IF      20593>>ASSIGN
OPT.NODE IN PROCEDURE GENERATE_ADDRESS
     20569**DCL     20645>>IF      20646>>CALLBLT
OPT IN PROCEDURE IMPERSONATE_USER
     20693**DCL     20691--PROC
OPT.ACCT IN PROCEDURE IMPERSONATE_USER
     20695**DCL     20708>>ASSIGN
OPT.BIT9 IN PROCEDURE IMPERSONATE_USER
     20698**DCL     20713>>ASSIGN
OPT.EPASS IN PROCEDURE IMPERSONATE_USER
     20697**DCL     20698--REDEF
OPT.NAME IN PROCEDURE IMPERSONATE_USER
     20696**DCL     20709>>ASSIGN
OPT$ IN PROCEDURE CHECK_PACKET
     20932**DCL     20935<<ASSIGN  20936>>IF      20936>>IF      20939>>IF      20942>>ASSIGN
OPTION IN PROCEDURE CHECK_PACKET
     20931**DCL     20934<<DOINDEX 20935>>ASSIGN
OPTS.INP
     15773**DCL     20233<>CALL
OPTS.INP.CMD
     15779**DCL     19875>>IF
OPTS.MAILINIT
     16074**DCL     20363<>CALL
OPTS.MAILINIT.CMD
     16080**DCL     20222>>IF      20255>>IF      20275>>IF      20299>>IF
OPTS.MAILINIT.WHO
     16089**DCL     20362>>IF
OPTS.MAILRCVR
     16031**DCL     20383<>CALL
OPTS.MAILRCVR.CMD
     16037**DCL     20275>>IF
OPTS.MAILRCVR.WHO
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:224  
     16043**DCL     20378>>IF
OPTS.MAILSNDR
     15988**DCL     20373<>CALL
OPTS.MAILSNDR.CMD
     15994**DCL     20222>>IF
OPTS.MAILSNDR.WHO
     16000**DCL     20368>>IF
OPTS.OPTSRECS
     16124**DCL     19854<<ASSIGN  20935--ASSIGN
OPTS.OUT
     15882**DCL     20286<>CALL
OPTS.OUT.CMD
     15888**DCL     19877>>IF
OPTSCHAR.CMD
     16228**DCL     20936>>IF
OPTSCHAR.PATTERN
     16242**DCL     20939>>IF      20942>>ASSIGN
OPTSCHAR.SUB
     16234**DCL     20936>>IF
OPTX
     19431**DCL     19703<<ASSIGN  19854>>ASSIGN  19855<<ASSIGN  19855>>ASSIGN  20934>>DOINDEX
OTMF_ALTRET IN PROCEDURE OPEN_THE_MAIL_FILE
     20409**LABEL   20348--CALLALT 20389--CALLALT
P
     19430**DCL     20119<<ASSIGN  20121>>DOWHILE 20121>>DOWHILE 20124>>IF      20125<<ASSIGN  20125>>ASSIGN
     20125>>ASSIGN  20126>>IF      20126>>IF      20126>>IF      20126>>IF      20126>>IF
PASSWORD
     19491**DCL     19492--REDEF   20754>>IF      20776>>IF
PASS_JI
     17601**DCL     17499--DCLINIT
POST_EOF
     20196**LABEL   20181--CALLALT
PRECORD_JI
     17659**DCL     19867<>CALL
PRECORD_JI.V
     17661**DCL     17659--DCLINIT
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:225  
READ_HLP
     17898**DCL     20731<>CALL
READ_HLP.STATION_
     17901**DCL     17902--REDEF
READ_HLP.V
     17902**DCL     17898--DCLINIT
READ_HLP.V.DVBYTE.REREAD#
     17913**DCL     17913--REDEF
READ_HLP.V.INDX#
     17911**DCL     17911--REDEF
READ_JI
     17623**DCL     19717<>CALL    19781<>CALL    19786<>CALL    19804<>CALL    19809<>CALL    19833<>CALL
     19837<>CALL    19856<>CALL    20181<>CALL
READ_JI.STATION_
     17626**DCL     17627--REDEF
READ_JI.V
     17627**DCL     17623--DCLINIT
READ_JI.V.DVBYTE.REREAD#
     17638**DCL     17638--REDEF
READ_JI.V.INDX#
     17636**DCL     17636--REDEF
READ_NODE
     16524**DCL     19551<>CALL    19748<>CALL    20101<>CALL    20104<>CALL
READ_NODE.STATION_
     16527**DCL     16528--REDEF
READ_NODE.V
     16528**DCL     16524--DCLINIT
READ_NODE.V.DVBYTE.REREAD#
     16539**DCL     16539--REDEF
READ_NODE.V.INDX#
     16537**DCL     16537--REDEF
READ_USERS
     18190**DCL     20750<>CALL
READ_USERS.STATION_
     18193**DCL     18194--REDEF
READ_USERS.V
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:226  
     18194**DCL     18190--DCLINIT
READ_USERS.V.DVBYTE.REREAD#
     18205**DCL     18205--REDEF
READ_USERS.V.INDX#
     18203**DCL     18203--REDEF
REL_INP_REL_OUT
     20075**LABEL   19692--GOTO    19879--GOTO    19946--GOTO    20009--GOTO    20021--GOTO    20134--GOTO
     20260--GOTO    20304--GOTO
REL_INP_SAV_OUT
     20053**LABEL   20207--GOTO    20244--GOTO    20288--GOTO
RES IN PROCEDURE GENERATE_ADDRESS
     20574**DCL     20467--DCLINIT
RESTART
     19530**LABEL   19903--GOTO
SAV_INP_REL_OUT
     20032**LABEL   20258--GOTO    20302--GOTO
SETUP_ABORT IN PROCEDURE IMPERSONATE_USER
     20805**LABEL   20731--CALLALT 20749--CALLALT 20752--GOTO
SLEEP
     18533**DCL     19628<>CALL    19902<>CALL
SLEEP.V
     18534**DCL     18533--DCLINIT
SLEEP_HLP IN PROCEDURE IMPERSONATE_USER
     20728**LABEL   20730--CALLALT
SLEEP_USERS IN PROCEDURE IMPERSONATE_USER
     20746**LABEL   20748--CALLALT
SNOOZE
     18549**DCL     20728<>CALL    20746<>CALL
SNOOZE.V
     18550**DCL     18549--DCLINIT
STATUS_LINE
     19451**DCL     19626<<ASSIGN  19687<<ASSIGN  20953>>ASSIGN
SUCK_BUSY
     20255**LABEL   20243--CALLALT
TRUNC_USERS
     18260**DCL     20766<>CALL
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:227  
TRUNC_USERS.V
     18260**DCL     18260--DCLINIT
UPDATE_STATUS
     20950**PROC    19627--CALL    19688--CALL
USERSBUF
     19079**DCL     18192--DCLINIT 18193--DCLINIT 18234--DCLINIT 18235--DCLINIT
USERSBUF.BAD_LOGON_CNT
     19221**DCL     20755<<ASSIGN  20755>>ASSIGN
USERSBUF.BANNER_PERM
     19194**DCL     19195--REDEF
USERSBUF.BUDGET.MACCT
     19099**DCL     19103--REDEF
USERSBUF.BUDGET.MAX_PROJECTS
     19112**DCL     19115--REDEF
USERSBUF.BUDGET.PACCUM
     19095**DCL     19097--REDEF
USERSBUF.BUDGET.PMAXC
     19090**DCL     19092--REDEF
USERSBUF.DEXP
     19168**DCL     20791>>ASSIGN
USERSBUF.LAST_LOGON_TIME
     19219**DCL     20761<<ASSIGN
USERSBUF.LOGINS.BAD_LOGON_CNT
     19229**DCL     20756<<ASSIGN  20756>>ASSIGN
USERSBUF.LOGINS.LAST_LOGON_TIME
     19227**DCL     20762<<ASSIGN
USERSBUF.MEXP
     19167**DCL     20792>>ASSIGN
USERSBUF.PRIV
     19157**DCL     20786>>ASSIGN  20786>>ASSIGN  20786>>ASSIGN
USERSBUF.SETUP_CHRA.TXT
     19210**DCL     19211--REDEF   19212--REDEF
VLP_ACCT IN PROCEDURE GENERATE_ADDRESS
     20488**DCL     20465--DCLINIT
VLP_ACCT.ACCT# IN PROCEDURE GENERATE_ADDRESS
     20488**DCL     20629>>CALLBLT
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:228  
VLP_NAME IN PROCEDURE GENERATE_ADDRESS
     20516**DCL     20465--DCLINIT
VLP_NAME.L# IN PROCEDURE GENERATE_ADDRESS
     20516**DCL     20587<<ASSIGN  20616>>IF      20619>>IF      20620>>CALLBLT 20621>>ASSIGN  20624>>CALLBLT
     20625>>ASSIGN
VLP_NAME.NAME# IN PROCEDURE GENERATE_ADDRESS
     20516**DCL     20616>>IF      20619>>IF      20620>>CALLBLT 20624>>CALLBLT
VLP_PASS IN PROCEDURE GENERATE_ADDRESS
     20530**DCL     20466--DCLINIT
VLP_PASS.PASS# IN PROCEDURE GENERATE_ADDRESS
     20530**DCL     20634>>CALLBLT
VLP_PRES
     18661**DCL     18628--DCLINIT
VLP_PRES.NN#
     18661**DCL     20894<<ASSIGN  20903>>IF
VLP_PRES.PRLIST.RNAME#
     18661**DCL     18662--REDEF
VLP_RPSN
     18645**DCL     18628--DCLINIT
VLP_RPSN.NN#
     18645**DCL     20893<<ASSIGN  20896>>DOINDEX 20898>>ASSIGN  20899<<ASSIGN  20899>>ASSIGN  20903>>IF
VLP_RPSN.RPLIST.DISP#
     18646**DCL     20901<<ASSIGN
VLP_RPSN.RPLIST.PSN#
     18645**DCL     20897>>IF      20898<<ASSIGN  20898>>ASSIGN
VLP_SN IN PROCEDURE GENERATE_ADDRESS
     20544**DCL     20466--DCLINIT
VLP_SN.NUM# IN PROCEDURE GENERATE_ADDRESS
     20544**DCL     20588<<ASSIGN
VLR_FID IN PROCEDURE GENERATE_ADDRESS
     20558**DCL     20468--DCLINIT 20586<<ASSIGN
VLR_FID.ACCT IN PROCEDURE GENERATE_ADDRESS
     20558**DCL     20628>>IF
VLR_FID.NAME IN PROCEDURE GENERATE_ADDRESS
     20558**DCL     20616>>IF      20617<<ASSIGN  20618>>IF
VLR_FID.PASS IN PROCEDURE GENERATE_ADDRESS
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:229  
     20558**DCL     20633>>IF
VWA$ABORT
     19505**DCL-ENT 18800--DCLINIT
VWB$BEAM
     19499**DCL-ENT 20243--CALL
VWE$EVOM
     19498**DCL-ENT 20287--CALL
VWF$FOOTER
     19502**DCL-ENT 20206--CALL
VWH$HEADER
     19501**DCL-ENT 20159--CALL
VWI$TRANSI
     19503**DCL-ENT 19720--CALL    19783--CALL    19788--CALL    19806--CALL    19811--CALL    19835--CALL
     19839--CALL    19858--CALL    20184--CALL
VWO$TRANSO
     19504**DCL-ENT 20170--CALL
VWS_ACCT_JI
     17585**DCL     17502--DCLINIT
VWS_ACCT_JI.ACCT#
     17585**DCL     19581>>ASSIGN  19582>>ASSIGN  19666>>ASSIGN  20851>>ASSIGN  20853>>ASSIGN
VWX$MAIL
     19500**DCL-ENT 19945--CALL    20008--CALL    20020--CALL
VW_IAM#
     19493**DCL     19552<<ASSIGN  19759>>IF      20118>>IF      20645>>IF
VW_MAILBUF#
     19455**DCL     17169--DCLINIT 17170--DCLINIT 20359<<ASSIGN  20364<<CALLBLT 20370<<CALLBLT 20374<<CALLBLT
     20380<<CALLBLT 20384<<CALLBLT 20867>>ASSIGN  20868<<CALLBLT 20869>>CALLBLT
VW_MAILKEY#
     19456**DCL     17168--DCLINIT
VW_MAILKEY#.C
     19458**DCL     20358<<ASSIGN  20397<<ASSIGN  20866<<ASSIGN
VW_MAILKEY#.L
     19457**DCL     20357<<ASSIGN
VW_OPERERR#
     19496**DCL     19617<<ASSIGN  19642>>IF
VW_OPTIONS#
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:230  
     15761**DCL     15767--REDEF   16130--REDEF   19702<<ASSIGN
VW_SCRAMBLE#
     19495**DCL     19705<<ASSIGN  19721<<ASSIGN  19782>>IF      19787>>IF      19805>>IF      19810>>IF
     19834>>IF      19838>>IF      19857>>IF      20169>>IF      20183>>IF
WHO IN PROCEDURE OPEN_THE_MAIL_FILE
     20333**DCL     20331--PROC    20368>>IF      20378>>IF
WHO_AM_I
     19474**DCL     18683--DCLINIT
WHO_AM_I.L#
     19475**DCL     19562<<ASSIGN  19598>>CALLBLT
WHO_AM_I.NAME#
     19476**DCL     19561<<CALLBLT 19562--ASSIGN  19585>>IF      19590>>ASSIGN  19598>>CALLBLT
WRITE_JE
     18461**DCL     20171<>CALL    20186<>CALL
WRITE_JE.BUF_.BOUND
     18461**DCL     20149<<ASSIGN
WRITE_JE.STATION_
     18463**DCL     18463--REDEF
WRITE_JE.V
     18464**DCL     18461--DCLINIT
WRITE_JE.V.DVBYTE.VFC#
     18470**DCL     18470--REDEF
WRITE_JF
     17362**DCL     19593<>CALL    19595<>CALL    19597<>CALL    19600<>CALL    19602<>CALL    19605<>CALL
WRITE_JF.STATION_
     17364**DCL     17364--REDEF
WRITE_JF.V
     17365**DCL     17362--DCLINIT
WRITE_JF.V.DVBYTE.VFC#
     17371**DCL     17371--REDEF
WRITE_MAIL
     17168**DCL     20389<>CALL    20871<>CALL
WRITE_MAIL.BUF_.BOUND
     17168**DCL     20388<<ASSIGN  20870<<ASSIGN
WRITE_MAIL.STATION_
     17170**DCL     17170--REDEF
PL6.E3A0      #001=VWS$SCOTTY File=VWS$SCOTTY.:VMB6TSI                           WED 08/20/97 15:49 Page:231  
WRITE_MAIL.V
     17171**DCL     17168--DCLINIT
WRITE_MAIL.V.DVBYTE.VFC#
     17177**DCL     17177--REDEF
WRITE_USERS
     18233**DCL     20765<>CALL
WRITE_USERS.STATION_
     18235**DCL     18235--REDEF
WRITE_USERS.V
     18236**DCL     18233--DCLINIT
WRITE_USERS.V.DVBYTE.VFC#
     18242**DCL     18242--REDEF
WSN_JE
     18439**DCL     18388--DCLINIT
WSN_JE.WSN#
     18439**DCL     20148<<ASSIGN
XTX$ADAPT
     18982**DCL-ENT 19061--DCLINIT
XUR$INIT
     10135**DCL-ENT 19518--CALL
XUR$SETERRMSG
     10140**DCL-ENT 19519--CALL
XUR_INIT
     18987**DCL     19518<>CALL
XUR_INIT.WORKR_
     19001**DCL     19002--REDEF
ZZZZZ
     19620**LABEL   19958--GOTO
