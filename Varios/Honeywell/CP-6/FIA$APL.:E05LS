VERSION E05

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:1    
        1        1        /*M* FIA$APL APLCG administrator in the INSYM ghost */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         FIA$APL
       10       10
       11       11             PURPOSE:      To provide support for the APLCG
       12       12
       13       13             DESCRIPTION:  The system ghost INSYM (in the person of FIA$APL)
       14       14                           is responsible for the administration of the APLCG
       15       15                           which provides shared variable capabilities to
       16       16                           APL users.
       17       17
       18       18                           The major entry points are:
       19       19
       20       20                               o  FIA$INIT
       21       21
       22       22                                  This routine is called at INSYM's startup
       23       23                                  time to open up the APLCG comgroup and
       24       24                                  shared variable datafile.
       25       25
       26       26                               o  FIA$APLAU
       27       27
       28       28                                  This is called whenever a comgroup
       29       29                                  administrative event occurs.  Comgroup
       30       30                                  connects, disconnects and warnings are
       31       31                                  handled.
       32       32
       33       33                                  When a connect event occurs, the connecting
       34       34                                  station is informed of the version of the
       35       35                                  shared variable processor in the VNAME
       36       36                                  field of the message.  The message
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:2    
       37       37                                  identifier for this message is -1.
       38       38
       39       39                                  When a disconnect occurs, all of the
       40       40                                  variables shared by this user are retracted
       41       41                                  and the associated partners activated if
       42       42                                  they are awaiting access.
       43       43
       44       44                                  When a comgroup warning occurs, the comgroup
       45       45                                  size is extended by %FIMI_CXMP#.
       46       46
       47       47                               o  FIA$APLRD
       48       48
       49       49                                  This routine processes all reads from the
       50       50                                  connected comgroup stations.  The routine
       51       51                                  SVPROCESSOR is called to process the
       52       52                                  message.
       53       53
       54       54                               o  FIA$ZAP
       55       55
       56       56                                  Provides for an orderly shutdown of the
       57       57                                  shared variable processor.  The comgroup
       58       58                                  and shared variable database are then
       59       59                                  closed and released.
       60       60        */
       61       61        /**/
       62       62        FIA$APL: PROC;
       63       63        /**/
       64       64
       65       65
       66       66
       67       67        /**/
       68       68        /* INCLUDES */
       69       69        /**/
       70       70        %INCLUDE CP_6;
       71      151        %INCLUDE CP_6_SUBS;
       72      691        %INCLUDE JG_EVID_C;
       73      916        %INCLUDE FI_SUBS_C;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:3    
       74     1018 S      %INCLUDE B$JIT_C;
       75     1019        %INCLUDE JG_GHOSTS_C;
       76     1109        %INCLUDE FI_MAC_C;
       77     1479        %INCLUDE F_ERRORS_C;
       78     1719        %INCLUDE KC_SUBS_C;
       79     1735        %INCLUDE KC_ERRORS_C;
       80     1782        %INCLUDE FOO_MAC_C;
       81     2530        %INCLUDE B$ROSEG;
       82     2593        %INCLUDE FI_DATA_R;
       83     2859        %INCLUDE FI_SCODE_C;
       84     2876
       85     2877
       86     2878
       87     2879        /**/
       88     2880        /* BASED STRUCTURES */
       89     2881        /**/
       90     2882        %FI_SV (FPTN=FI$SV,STCLASS=BASED);
       91     2934        %B$TCB (STCLASS=BASED);
       92     2937        %B$ALT (STCLASS=BASED);
       93     2945        %F$DCB;
       94     3002        %FI_EVNT   (FPTN=FI$EVNT   ,STCLASS=BASED);
       95     3065    1   DCL KBUF CHAR( K) BASED CALIGNED;
       96     3066    1   DCL HBIN( 0: 0) UBIN( 18) BASED HALIGNED;
       97     3067    1   DCL INTG( 0: 0) SBIN BASED ALIGNED;
       98     3068        %B$CGAURD (FPTN=B$CGAURD,LAST=",");
       99     3087        %B$CGAUCI (FPTN=CONINFO,LVL=2,LAST=",");
      100     3109        %FI_CONINFO (FPTN=FIINFO,LVL=2,STCLASS=BASED);
      101     3153        %FI_CITE (FPTN=FI$APLRD,TYP=CGRD,STCLASS=BASED);
      102     3197
      103     3198    1   DCL 1  ZA1_DABLK   BASED ALIGNED,
      104     3199    1         2  TYPE     UBIN(9)  UNAL,
      105     3200    1         2  RANK     UBIN(9)  UNAL,
      106     3201    1         2  SIZE     UBIN(18) HALIGNED,
      107     3202    1         2  REF      SBIN     ALIGNED,
      108     3203    1         2  LENGTHS(0:0) SBIN ALIGNED;
      109     3204
      110     3205
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:4    
      111     3206
      112     3207        /**/
      113     3208        /* AUTO */
      114     3209        /**/
      115     3210    1   DCL I UBIN WORD;
      116     3211    1   DCL LPAR$ PTR;
      117     3212    1   DCL CGAURD$ PTR;
      118     3213
      119     3214
      120     3215
      121     3216        /**/
      122     3217        /* STATIC */
      123     3218        /**/
      124     3219    1   DCL M$APLCG$ PTR STATIC;
      125     3220    1   DCL F$SV$ PTR STATIC;
      126     3221    1   DCL F$SVS$ PTR STATIC;
      127     3222    1   DCL F$SVX$ PTR STATIC;
      128     3223    1   DCL 1 SPARE STATIC ALIGNED,
      129     3224    1         2 * UBIN( 9) INIT( 2) UNAL, /* Datablock type */
      130     3225    1         2 * UBIN( 9) INIT( 2) UNAL, /* Datablock rank */
      131     3226    1         2 SIZE UBIN( 18) INIT( 0) UNAL, /* Datablock size */
      132     3227    1         2 * UBIN INIT( 1) ALIGNED, /* Ref count */
      133     3228    1         2 LENGTH1 UBIN INIT( 0) ALIGNED, /* num. rows */
      134     3229    1         2 LENGTH2 UBIN INIT( 0) ALIGNED, /* num. cols */
      135     3230    1         2 DATA(0:719) UBIN INIT(720*0) ALIGNED,
      136     3231    1         2 BUFR  REDEF DATA CHAR(2880);
      137     3232    1   DCL STATION CHAR(8) STATIC;
      138     3233        %VLP_STATION (FPTN=STA,STCLASS=STATIC);
      139     3260    1   DCL NEW$ PTR STATIC;
      140     3261    1   DCL MASK BIT( 4) STATIC UNAL;
      141     3262    1   DCL BMASK( 0: 3) REDEF MASK BIT( 1) UNAL;
      142     3263    1   DCL KEYVAL UBIN STATIC INIT(1);
      143     3264    1   DCL TEMP SBIN STATIC;
      144     3265    1   DCL K$ PTR STATIC;
      145     3266    1   DCL K SBIN STATIC;
      146     3267    1   DCL L SBIN;
      147     3268    1   DCL STATIONNAME CHAR(8) STATIC DALIGNED;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:5    
      148     3269    1   DCL D$ PTR STATIC;
      149     3270    1   DCL 1 DBKEY STATIC ALIGNED,
      150     3271    1         2 C UBIN( 9) INIT( 3) UNAL,
      151     3272    1         2 VAL UBIN( 27) UNAL;
      152     3273    1   DCL 1  DBKEY2   STATIC ALIGNED,
      153     3274    1         2  *  UBIN(9)   UNAL INIT(3),
      154     3275    1         2  VAL UBIN(27) UNAL INIT(0);
      155     3276    1   DCL FLIPPED( 0: 15) BIT( 4) CONSTANT INIT(
      156     3277    1      '0000'B, '0010'B, '0001'B, '0011'B,
      157     3278    1      '1000'B, '1010'B, '1001'B, '1011'B,
      158     3279    1      '0100'B, '0110'B, '0101'B, '0111'B,
      159     3280    1      '1100'B, '1110'B, '1101'B, '1111'B);
      160     3281    1   DCL SV$ PTR STATIC;
      161     3282    1   DCL SVX$ PTR STATIC;
      162     3283    1   DCL SVSIGNON$ PTR STATIC;
      163     3284        %FI_SV (FPTN=SV_INIT,STCLASS=CONSTANT);
      164     3336        %FO_SCB                                (FPTN=SVSCB,
      165     3337                 SEG       = FISN_APL#,
      166     3338                 FSIZ      ="SIZEW(FI$SV)",
      167     3339                 MAP       = NO,
      168     3340                 NPG       = 1,
      169     3341                 STCLASS   = STATIC);
      170     3371    1   DCL SVHD$ PTR STATIC ALIGNED INIT(ADDR(NIL));
      171     3372    1   DCL SVTL$ PTR STATIC ALIGNED INIT(ADDR(NIL));
      172     3373    1   DCL INSYMNAME CHAR(8) STATIC INIT('INSYM');
      173     3374        /*B*    NAME:    FIA_DISPLAYS
      174     3375
      175     3376                PURPOSE: To control outputting of shared variable information
      176     3377                         used while debugging the shared variable processor.
      177     3378
      178     3379                DESCRIPTION:
      179     3380                         This cell is normally set to zero resulting in NO
      180     3381                         displays.  Usefull values are:
      181     3382                            (1)   Only Error Conditions
      182     3383                            (2)   Debugging Information
      183     3384                            (3)   Generally everything happening.
      184     3385                         A setting of FIA_DISPLAYS causes all messages up to
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:6    
      185     3386                         and including the current value to be displayed.
      186     3387                                                                            */
      187     3388    1   DCL FIA_DISPLAYS SBIN CONSTANT SYMDEF INIT(0);
      188     3389    1   DCL DISPLAYS     SBIN STATIC   INIT(0);
      189     3390    1   DCL FIA_VDISPLAY SBIN STATIC   INIT(0);
      190     3391
      191     3392    1   DCL 1  LOG_HEADER  CONSTANT ALIGNED,
      192     3393    1         2  *        UBIN(9)  CALIGNED INIT(2),
      193     3394    1         2  *        UBIN(9)  CALIGNED INIT(2),
      194     3395    1         2  *        UBIN(18) HALIGNED INIT(4),
      195     3396    1         2  *        SBIN     ALIGNED  INIT(1),
      196     3397    1         2  *        SBIN     ALIGNED  INIT(0),
      197     3398    1         2  *        SBIN     ALIGNED  INIT(80);
      198     3399
      199     3400    1   DCL 1  SVXKEY      STATIC   ALIGNED,
      200     3401    1         2  *        UBIN(9)  CALIGNED INIT(3),
      201     3402    1         2  VAL      UBIN(27) CALIGNED INIT(0);
      202     3403
      203     3404    1   DCL  FIA_VRECS0     SBIN     STATIC;
      204     3405    1   DCL  FIA_VRECS1     SBIN     STATIC;
      205     3406
      206     3407        %SET MYVARS=2;
      207     3408
      208     3409    1   DCL  MYVARS(0:%MYVARS) CHAR(20) CONSTANT
      209     3410    1           INIT('LOG',
      210     3411    1                'SV',
      211     3412    1                ' '*0);
      212     3413
      213     3414    1   DCL  MYSV$(0:%MYVARS)  PTR STATIC
      214     3415    1           INIT( ADDR(NIL)*0 );
      215     3416
      216     3417    1   DCL  MYID  CHAR(20) CONSTANT INIT('APLSVP.:SYS');
      217     3418
      218     3419    1   DCL  NEWSTATES(0:7)   BIT(4)  CONSTANT  ALIGNED INIT(
      219     3420    1                 /* 'X000'B  */    '0000'B,
      220     3421    1                 /* 'X001'B  */    '0010'B,
      221     3422    1                 /* 'X010'B  */    '0000'B,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:7    
      222     3423    1                 /* 'X011'B  */    '0000'B,
      223     3424    1                 /* 'X100'B  */    '0000'B,
      224     3425    1                 /* 'X101'B  */    '0110'B,
      225     3426    1                 /* 'X110'B  */    '0000'B,
      226     3427    1                 /* 'X111'B  */    '0011'B);
      227     3428
      228     3429        /*   NEWSTATES is used to correct the state for the
      229     3430             offer'ers retract of a shared variable when the
      230     3431             coupling is 2.
      231     3432                                                                */
      232     3433
      233     3434
      234     3435
      235     3436
      236     3437        /**/
      237     3438        /* CONSTANT */
      238     3439        /**/
      239     3440        %VLP_STATION                          (FPTN=DACTALL,
      240     3441                 STATION   = '?',
      241     3442                 ALLTRMS   = YES,
      242     3443                 ALLDCBS   = YES,
      243     3444                 STCLASS   = CONSTANT);
      244     3471
      245     3472
      246     3473
      247     3474        /**/
      248     3475        /* DCBS */
      249     3476        /**/
      250     3477    1   DCL M$APLCG DCB;
      251     3478    1   DCL F$SV DCB;
      252     3479    1   DCL  F$SVS DCB;
      253     3480    1   DCL  M$DO DCB;
      254     3481    1   DCL  F$SVX DCB;
      255     3482
      256     3483
      257     3484
      258     3485        /**/
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:8    
      259     3486        /* REFS */
      260     3487        /**/
      261     3488    1   DCL B$TCB$ PTR SYMREF;
      262     3489    1   DCL FOI$LDTRC ENTRY(4) ALTRET;
      263     3490    1   DCL FOI$GBUF ENTRY(2) ALTRET;
      264     3491    1   DCL FOI$RBUF ENTRY(2) ALTRET;
      265     3492        %FI_APLMSG (FPTN=FI_APLCGBUF,STCLASS=SYMREF);
      266     3522        %FI_APLMSG (FPTN=MSG        ,STCLASS="REDEF FI_APLCGBUF");
      267     3552
      268     3553
      269     3554
      270     3555        /**/
      271     3556        /* PMME FPTS */
      272     3557        /**/
      273     3558        %FPT_OPEN                              (FPTN=OPENCG@,
      274     3559                 DCB       = M$APLCG,
      275     3560                 SHARE     = ALL,
      276     3561                 SCRUB     = YES,
      277     3562                 CTG       = YES,
      278     3563                 IXTNSIZE  = %FIMI_CIXT#,
      279     3564                 AU        = YES,
      280     3565                 NAME      = APLCGNAME,
      281     3566                 ACCT      = FI_SYSACCT,
      282     3567                 SETSTA    = MYAPLCGSETSTA,
      283     3568                 ASN       = COMGROUP,
      284     3569                 ORG       = CONSEC,
      285     3570                 FUN       = CREATE,
      286     3571                 EXIST     = OLDFILE,
      287     3572                 ACCESS    = ATTRCG@,
      288     3573                 ACSVEH    = ACSV@,
      289     3574                 STCLASS   = STATIC);
      290     3683        %VLP_SETSTA                           (FPTN=MYAPLCGSETSTA,
      291     3684                 MYSTATION = 'INSYM',
      292     3685                 STCLASS   = CONSTANT);
      293     3713        %VLP_SETSTA                           (FPTN=APLCGSETSTA,
      294     3714                 OSTATION  = 'INSYM',
      295     3715                 STCLASS   = CONSTANT);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:9    
      296     3743        %FPT_CGCTL                            (FPTN=APLCGCTL,
      297     3744                 DCB       = M$APLCG,
      298     3745                 CGCP      = APLCGCP,
      299     3746                 SETSTA    = APLCGSETSTA,
      300     3747                 STCLASS   = CONSTANT);
      301     3770        %VLP_CGCP                             (FPTN=APLCGCP,
      302     3771                 TMTYP     = ' ',
      303     3772                 DMTYP     = ' ',
      304     3773                 MAXPG     = %FIMI_CIMP#,
      305     3774                 DISKWARN  = %FIMI_CXMP#,
      306     3775                 MEMWARN   = %FIMI_CXMP#,
      307     3776                 DATAPGS   =10,
      308     3777                 CONMSG    = YES,
      309     3778                 TERMCONAU = NO,
      310     3779                 DCBCONAU  = YES,
      311     3780                 TERMCONNAU= NO,
      312     3781                 DCBCONNAU = YES,
      313     3782                 AUCONTERM = NC,
      314     3783                 AUCONDCB  = NC,
      315     3784                 AUDCONTERM= NC,
      316     3785                 AUDCONDCB = DEACTIVATE,
      317     3786                 XSTALGL   = YES,
      318     3787                 WAS       = NO,
      319     3788                 RAS       = NO,
      320     3789                 SMD       = NO,
      321     3790                 XTYPLGL   = YES,
      322     3791                 MAXMC     = 1024,
      323     3792                 TERMCONLGL= NO,
      324     3793                 DCBCONLGL = YES,
      325     3794                 INPUT     = NO,
      326     3795                 OUTPUT    = NO,
      327     3796                 SECURE    = NO,
      328     3797                 STCLASS   = STATIC);
      329     3840        %VLP_NAME                              (FPTN=APLCGNAME,
      330     3841                 NAME      = 'APLCG',
      331     3842                 STCLASS   = CONSTANT);
      332     3869        %FPT_EXTEND                           (FPTN=EXTEND_APLCG,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:10   
      333     3870                 DCB       = M$APLCG,
      334     3871                 SIZ       = %FIMI_CXXT#,
      335     3872                 STCLASS   = CONSTANT);
      336     3886        %FPT_CLOSE                            (FPTN=CLOSECG,
      337     3887                 DCB       = M$APLCG,
      338     3888                 DISP      = RELEASE,
      339     3889                 STCLASS   = CONSTANT);
      340     3931        %FPT_CLOSE                            (FPTN=CLOSEPOOL,
      341     3932                 DCB       = F$SV,
      342     3933                 DISP      = RELEASE,
      343     3934                 STCLASS   = CONSTANT);
      344     3976        %VLP_NAME                              (FPTN=POOLFILENAME,
      345     3977                 NAME      = ':ZASV',
      346     3978                 STCLASS   = CONSTANT);
      347     4005        %VLP_ATTR                              (FPTN=ATTRCG@);
      348     4019        %VLP_ACCESS                            (STCLASS=CONSTANT,
      349     4020                 READ      = YES,
      350     4021                 UPD       = YES,
      351     4022                 WNEW      = YES,
      352     4023                 DELR      = YES,
      353     4024                 DELF      = YES,
      354     4025                 REATTR    = YES,
      355     4026                 ACCT      = ':SYS',
      356     4027                 LAST      = ",");
      357     4044        %VLP_ACCESS                            (STCLASS=CONSTANT,
      358     4045                 READ      = YES,
      359     4046                 UPD       = YES,
      360     4047                 WNEW      = YES,
      361     4048                 DELR      = YES,
      362     4049                 DELF      = NO,
      363     4050                 REATTR    = NO,
      364     4051                 ACCT      = '?',
      365     4052                 LAST      = ";");
      366     4069        %VLP_ATTR                              (FPTN=ATTR@);
      367     4083        %VLP_ACCESS                            (STCLASS=CONSTANT,
      368     4084                 READ      = YES,
      369     4085                 UPD       = YES,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:11   
      370     4086                 WNEW      = YES,
      371     4087                 DELR      = YES,
      372     4088                 DELF      = YES,
      373     4089                 REATTR    = YES,
      374     4090                 ACCT      = ':SYS',
      375     4091                 LAST      =",");
      376     4108        %VLP_ACCESS                            (STCLASS=CONSTANT,
      377     4109                 READ      = NO,
      378     4110                 UPD       = NO,
      379     4111                 WNEW      = NO,
      380     4112                 DELR      = NO,
      381     4113                 DELF      = NO,
      382     4114                 REATTR    = NO,
      383     4115                 EXEC      = YES,
      384     4116                 ACCT      = '?',
      385     4117                 LAST      =";");
      386     4134        %VLP_ATTR                              (FPTN=ACSV@,
      387     4135                 STCLASS   = CONSTANT);
      388     4149        %VLP_ACSVEH                            (STCLASS=CONSTANT,
      389     4150                 READ      = YES,
      390     4151                 UPD       = YES,
      391     4152                 WNEW      = YES,
      392     4153                 DELR      = NO,
      393     4154                 DELF      = NO,
      394     4155                 REATTR    = NO,
      395     4156                 VEHICLE   = 'APL',
      396     4157                 LAST      =";");
      397     4174        %FPT_OPEN                              (FPTN=OPEN@,
      398     4175                 DCB       = F$SV,
      399     4176                 ASN       = FILE,
      400     4177                 FUN       = CREATE,
      401     4178                 NAME      = POOLFILENAME,
      402     4179                 ACCT      = FI_SYSACCT,
      403     4180                 CTG       = YES,
      404     4181                 ORG       = KEYED,
      405     4182                 ACS       = DIRECT,
      406     4183                 SHARE     = ALL,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:12   
      407     4184                 EXIST     = NEWFILE,
      408     4185                 ACCESS    = ATTR@,
      409     4186                 ACSVEH    = ACSV@,
      410     4187                 STCLASS   = STATIC);                                            /*#15.175*/
      411     4296        %FPT_ACTIVATE                          (FPTN=DEACTIVATE_USER,
      412     4297                 DCB       = M$APLCG,
      413     4298                 STATION   = STATIONNAME,
      414     4299                 FLUSH     = YES,
      415     4300                 STCLASS   = CONSTANT);
      416     4323        %FPT_WRITE                             (FPTN=WRITECG@,
      417     4324                 DCB       = M$APLCG,
      418     4325                 BUF       = MSG,
      419     4326                 STATION   = STA,
      420     4327                 STCLASS   = STATIC);
      421     4358        %FPT_WRITE                             (FPTN=WRITE@,
      422     4359                 DCB       = F$SV,
      423     4360                 KEY       = DBKEY,
      424     4361                 STCLASS   = STATIC);
      425     4392        %FPT_READ                              (FPTN=READSVS@,
      426     4393                 DCB       = F$SVS,
      427     4394                 KEY       = DBKEY,
      428     4395                 KEYS      = YES,
      429     4396                 STCLASS   = STATIC);
      430     4435        %FPT_OPEN                              (FPTN=OPENSVS@,
      431     4436                 DCB       = F$SVS,
      432     4437                 ASN       = FILE,
      433     4438                 FUN       = CREATE,
      434     4439                 NAME      = SVTEMP,
      435     4440                 ACCT      = FI_SYSACCT,
      436     4441                 ORG       = KEYED,
      437     4442                 ACS       = DIRECT,
      438     4443                 EXIST     = NEWFILE,
      439     4444                 STCLASS   = CONSTANT);
      440     4553        %FPT_WRITE                             (FPTN=WRITESVS@,
      441     4554                 DCB       = F$SVS,
      442     4555                 KEY       = DBKEY,
      443     4556                 STCLASS   = STATIC);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:13   
      444     4587        %VLP_NAME                              (FPTN=SVTEMP,
      445     4588                 NAME      = '*SVS',
      446     4589                 STCLASS   = CONSTANT);
      447     4616        %FPT_OPEN                              (FPTN=OPENSVX@,
      448     4617                 DCB       = F$SVX,
      449     4618                 ASN       = FILE,
      450     4619                 FUN       = CREATE,
      451     4620                 NAME      = SXTEMP,
      452     4621                 ACCT      = FI_SYSACCT,
      453     4622                 ORG       = KEYED,
      454     4623                 ACS       = DIRECT,
      455     4624                 EXIST     = NEWFILE,
      456     4625                 STCLASS   = CONSTANT);
      457     4734        %VLP_NAME                              (FPTN=SXTEMP,
      458     4735                 NAME      = '*SVX',
      459     4736                 STCLASS   = CONSTANT);
      460     4763        %FPT_TRUNC                             (FPTN=TRUNCSVX@,
      461     4764                 DCB       = F$SVX,
      462     4765                 STCLASS   = CONSTANT);
      463     4779        %FPT_TRUNC                             (FPTN=TRUNCSVS@,
      464     4780                 DCB       = F$SVS,
      465     4781                 STCLASS   = CONSTANT);
      466     4795        %FPT_TRUNC                             (FPTN=TRUNCSV@,
      467     4796                 DCB       = F$SV,
      468     4797                 STCLASS   = CONSTANT);
      469     4811        %FPT_WRITE                             (FPTN=WRITESVX@,
      470     4812                 DCB       = F$SVX,
      471     4813                 KEY       = SVXKEY,
      472     4814                 STCLASS   = STATIC);
      473     4845        %FPT_READ                              (FPTN=READSVX@,
      474     4846                 DCB       = F$SVX,
      475     4847                 KEY       = SVXKEY,
      476     4848                 KEYS      = YES,
      477     4849                 STCLASS   = STATIC);
      478     4888        %FPT_READ                              (FPTN=READ@,
      479     4889                 DCB       = F$SV,
      480     4890                 KEY       = DBKEY2,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:14   
      481     4891                 KEYS      = YES,
      482     4892                 STCLASS   = STATIC);
      483     4931        %FPT_READ                              (FPTN=READCGC@,
      484     4932                 DCB       = M$APLCG,
      485     4933                 BUF       = MSG,
      486     4934                 STCLASS   = STATIC);
      487     4973        %FPT_ACTIVATE                         (FPTN=DEACT_ALL,
      488     4974                 STATION   = DACTALL,
      489     4975                 DCB       = M$APLCG,
      490     4976                 STCLASS   = CONSTANT);
      491     4999
      492     5000
      493     5001
      494     5002        /**/
      495     5003        /* IMPLICIT POINTERED BASED STRUCTURES */
      496     5004        /**/
      497     5005        /*B*    NAME:    FI_SV
      498     5006
      499     5007                PURPOSE:       To define the APL Shared Variable context
      500     5008                               block.
      501     5009
      502     5010                DESCRIPTION:
      503     5011                               LNK$     The forward link to the next context
      504     5012                                        block.
      505     5013
      506     5014                               BLNK$    The backward link to the previous
      507     5015                                        context block.
      508     5016
      509     5017                               ASMO     The access state matrix as view by
      510     5018                                        the offerer.
      511     5019
      512     5020                               ASMM     The access state matrix as viewed by
      513     5021                                        the matcher.
      514     5022
      515     5023                               ACVO     The access control vector as supplied
      516     5024                                        by the offerer.
      517     5025
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:15   
      518     5026                               ACVM     The access control vector as supplied
      519     5027                                        by the matcher.
      520     5028
      521     5029                               COUPLING The current coupling level of the
      522     5030                                        shared variable.
      523     5031
      524     5032                               SURROGATE  The name by which this variable is
      525     5033                                          known.
      526     5034
      527     5035                               INAME      The variables "internal" name.
      528     5036                                          Normally a pointer to this structure
      529     5037
      530     5038                               INAMER     The internal name as a pointer.
      531     5039
      532     5040                               DBKEY      The key of this variable on the
      533     5041                                          database file.
      534     5042
      535     5043                               OFFER      This field is broken down into its
      536     5044                                          components.  There is a similar
      537     5045                                          field with identical sub-fields for
      538     5046                                          the matching user called MATCH.
      539     5047
      540     5048                               STATION    The first subfield of OFFER and
      541     5049                                          MATCH.  The com-group station name
      542     5050                                          of the matching or offering station.
      543     5051
      544     5052                               NAME       The name of the user including his
      545     5053                                          clone-id.  Normally, this is an
      546     5054                                          account / clone-id pair.  This field
      547     5055                                          may also be viewed as N.ACCT for
      548     5056                                          just the account, and N.UNAME for
      549     5057                                          just the clone-id.  This is the
      550     5058                                          second subfield of OFFER and MATCH.
      551     5059
      552     5060                               N.ACCT     The account offering/matching this
      553     5061                                          shared variable instance.  The
      554     5062                                          third sub-field of OFFER and MATCH.
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:16   
      555     5063
      556     5064                               N.UNAME    The clone-id of the offer/match.
      557     5065                                          This is the final sub-field of
      558     5066                                          OFFER and MATCH.
      559     5067
      560     5068                               STATE      This indicates the current state
      561     5069                                          of the variable.  This is not to
      562     5070                                          be confused with the access state
      563     5071                                          matrix.  The state indicates whether
      564     5072                                          one of the stations is waiting for
      565     5073                                          access to the variable (STATE.N) and
      566     5074                                          indicates who has currently got
      567     5075                                          access.
      568     5076
      569     5077                               SURRLEN    The length of the name being shared.
      570     5078
      571     5079                               DBSIZE     The size of the datablock holding
      572     5080                                          the shared variable.
      573     5081
      574     5082                               MIDO       The message ID that the OFFERING
      575     5083                                          station expects to see in reply to
      576     5084                                          his outstanding request.
      577     5085
      578     5086                               MIDM       The message ID that the MATCHING
      579     5087                                          station expects to see in reply to
      580     5088                                          his outstanding request.
      581     5089
      582     5090                               SCNO       If true, the OFFERING station
      583     5091                                          expects to be notified of any
      584     5092                                          state changes immediately.
      585     5093
      586     5094                               SCNM       If true, the MATCHING station
      587     5095                                          expects to be notified of any
      588     5096                                          state changes immediately.
      589     5097
      590     5098                               SCO        If true, a state change has occured
      591     5099                                          since the STATECHANGE function was
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:17   
      592     5100                                          last requested by the OFFERING
      593     5101                                          station.
      594     5102
      595     5103                               SCM        If true, a state change has occured
      596     5104                                          since the STATECHANGE function was
      597     5105                                          last requested by the OFFERING
      598     5106                                          station.
      599     5107
      600     5108                                                                            */
      601     5109        %FI_SV (FPTN=SV,STCLASS="BASED(SV$)");
      602     5161
      603     5162
      604     5163    1   DCL  SV_NOT_ALLOWED(0:17) BIT(1) CONSTANT INIT(
      605     5164             /*  SV$ not allowed by message type */
      606     5165    1        '1'B,'0'B*8,'1'B*3,'0'B,'1'B*2,'0'B*2,'1'B);
      607     5166
      608     5167    1   DCL  SV_REQUIRED(0:17)    BIT(1) CONSTANT INIT(
      609     5168             /*  SV$ required by message type    */
      610     5169    1        '1'B,'0'B,'1'B*7,'0'B*3,'1'B,'0'B*2,'0'B,'1'B,'0'B);
      611     5170
      612     5171
      613     5172        /**/
      614     5173        /* SUBS */
      615     5174        /**/
      616     5175        %SUB TRUE ="'1'B";
      617     5176        %SUB FALSE ="'0'B";
      618     5177        %SUB INITIAL ="'0'B";
      619     5178
      620     5179        %SUB F_FI='0611'O;
      621     5180        %SUB M_A='01'O;
      622     5181
      623     5182                           /* WARNING!!: THE FOLLOWING SUBS MUST BE THE
      624     5183                              SAME AS THE APL PROCESSOR SUBS FILE ZAQ_SUBS */
      625     5184        %SUB COMPLETED = 0/* COMPLETED */;
      626     5185        %SUB SHARE = 1/* SHARE */;
      627     5186        %SUB RETRACT = 2/* RETRACT */;
      628     5187        %SUB SETACV = 3/* SETACV */;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:18   
      629     5188        %SUB GETACV = 4/* GETACV */;
      630     5189        %SUB PREREAD = 5/* PREREAD */;
      631     5190        %SUB PREWRITE = 6/* PREWRITE */;
      632     5191        %SUB SEIZE = 7/* SEIZE */;
      633     5192        %SUB RELEASE = 8/* RELEASE */;
      634     5193        %SUB QUERY = 9/* QUERY */;
      635     5194        %SUB WAIT4CONTROL = 10/* WAIT4CONTROL */;
      636     5195        %SUB NOSPACE = 11/* NOSPACE */;
      637     5196        %SUB GETASM = 12 /* OBTAIN ACCESS STATE MATRIX */;
      638     5197        %SUB VERSION = 13 /* VERSION OF SHARED VARIABLE PROCESSOR */;
      639     5198        %SUB STATECHANGE = 14 /* WAIT FOR STATE CHANGE */;
      640     5199        %SUB GETDATA = 15 /* SEND APL DB TO STATION    */;
      641     5200        %SUB PUTDATA = 16 /* RECIEVE APL DB FROM STATION */;
      642     5201        %SUB SIGNON  = 17 /* SIGN-ON TO COMGROUP       */;
      643     5202
      644     5203        %SET SELECTOR = 200000000;
      645     5204        %EQU_CG;
      646     5252        %SUB B$ERRCODE = B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE;
      647     5253        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:19   
      648     5254        /**************************************************************/
      649     5255        /**                                                          **/
      650     5256        /**              Reporting  Macros                           **/
      651     5257        /**                                                          **/
      652     5258        /**************************************************************/
      653     5259
      654     5260        %MACRO DISP(  MSG      =  "*HERE*",
      655     5261                      STATION  =  STATION,
      656     5262                      CLASS(   INFO  =  3,
      657     5263                               DEBUG =  2,
      658     5264                               ERROR =  1) = 3);
      659     5265        %SET MESS   =  TEXTCHAR(MSG);
      660     5266                DO;
      661     5267        %IF LENGTHC(MESS)>0;
      662     5268                IF DISPLAYS>=CLASS THEN CALL WRITEMESS(STATION,%MESS,%LENGTHC(MESS),CLASS);
      663     5269        %ENDIF;
      664     5270        %IF CLASS=1;
      665     5271                GOTO RIDSTATION;
      666     5272        %ENDIF;
      667     5273                END;
      668     5274        %MEND;
      669     5275        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:20   
      670     5276        /*F* NAME:         FIA$INIT
      671     5277
      672     5278             PURPOSE:      To set up INSYM to deal with the APLCG
      673     5279
      674     5280             DESCRIPTION:  Called by INSYM initialization when the system
      675     5281                           is booted.
      676     5282        */
      677     5283    1   FIA$INIT: ENTRY;
      678     5284    1         M$APLCG$ = DCBADDR( DCBNUM( M$APLCG));
      679     5285    1         F$SV$ = DCBADDR( DCBNUM( F$SV));
      680     5286    1         F$SVS$ = DCBADDR(DCBNUM(F$SVS));
      681     5287    1         F$SVX$ = DCBADDR(DCBNUM(F$SVX));
      682     5288    1         OPENCG@.V.FUN#=%CREATE#;
      683     5289    1         CALL M$OPEN (OPENCG@) ALTRET(OPENCG@ALT);
      684     5290    1         GOTO OPENEDCG@;
      685     5291    1   OPENCG@ALT0:;
      686     5292    1         CALL M$MERC;
      687     5293    1   OPENCG@ALT:;
      688     5294    1         OPENCG@.V.EXIST#=%NEWFILE#;
      689     5295    1         CALL M$OPEN (OPENCG@) ALTRET(OPENCG@ALT0);
      690     5296    1   OPENEDCG@:;
      691     5297    1         CALL M$CGCTL (APLCGCTL) ALTRET(CTLA0);
      692     5298    1   CTLA0:OPEN@.V.FUN#=%CREATE#;
      693     5299    1         CALL M$OPEN (OPEN@) ALTRET(OPEN@ALT);
      694     5300    1         GOTO OPENED@;
      695     5301    1   OPEN@ALT0:;
      696     5302    1         CALL M$MERC;
      697     5303    1   OPEN@ALT:;
      698     5304    1         IF B$ERRCODE ~= %E$FILEBUSY THEN GOTO OPEN@ALT0;
      699     5305    1         OPEN@.V.FUN#=%UPDATE#;
      700     5306    1         CALL M$OPEN (OPEN@) ALTRET(OPEN@ALT0);
      701     5307    1   OPENED@:;
      702     5308    1         CALL M$OPEN(OPENSVS@) ALTRET(OPEN@ALT0);
      703     5309    1         CALL M$OPEN(OPENSVX@) ALTRET(OPEN@ALT0);
      704     5310    1         CALL M$TRUNC(TRUNCSVX@) ALTRET(OPEN@ALT0);
      705     5311    1         CALL M$TRUNC(TRUNCSVS@) ALTRET(OPEN@ALT0);
      706     5312    1         CALL M$TRUNC(TRUNCSV@) ALTRET(OPEN@ALT0);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:21   
      707     5313    1         RETURN;
      708     5314        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:22   
      709     5315        /*F* NAME:         FIA$APLRD
      710     5316
      711     5317             PURPOSE:      To process completed reads on the APLCG
      712     5318
      713     5319             DESCRIPTION:  Called from FII$INSYM when a no-wait read to
      714     5320                           the APLCG completes.  FI_EVNT$ points to an
      715     5321                           event queue frame containing the information
      716     5322                           about the completed read.
      717     5323        */
      718     5324    1   FIA$APLRD: ENTRY;
      719     5325    1         CALL SVPROCESSOR;
      720     5326    1         RETURN;
      721     5327        /**/
      722     5328        /*F* NAME:         FIA$ZAP
      723     5329             PURPOSE:      To shut down APL shared variables when the
      724     5330                           system is being zapped.
      725     5331             DESCRIPTION:  Closes down the comgroup, and closes the
      726     5332                           shared var file. */
      727     5333    1   FIA$ZAP: ENTRY;
      728     5334        /**/
      729     5335    1         CALL M$DEACTIVATE (DEACT_ALL) ALTRET(Z0);
      730     5336    1   Z0:   CALL M$CLOSE (CLOSECG) ALTRET(Z1);
      731     5337    1   Z1:   CALL M$CLOSE (CLOSEPOOL) ALTRET(Z2);
      732     5338    1   Z2:   RETURN;
      733     5339        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:23   
      734     5340        /*F* NAME:         FIA$APLAU
      735     5341
      736     5342             PURPOSE:      To process APLCG administrative user events
      737     5343
      738     5344             DESCRIPTION:  Called from FII$INSYM when INSYM receives an
      739     5345                           APLCG administrative user event.  FI_EVNT$
      740     5346                           points to an event queue frame describing the
      741     5347                           event.
      742     5348        */
      743     5349    1   FIA$APLAU: ENTRY;
      744     5350
      745     5351    1         CGAURD$=ADDR(FI_APLCGBUF);
      746     5352    2           DO CASE (CGAURD$->B$CGAURD.EVENT);
      747     5353
      748     5354
      749     5355    2             CASE (%CG_DCLS#);
      750     5356    2               CALL DISCONNECT;
      751     5357
      752     5358    2             CASE(%CG_DOPN#);
      753     5359    2               CALL CONNECT;
      754     5360
      755     5361    2             CASE (%CG_WARN#);
      756     5362    2               CALL M$EXTEND (EXTEND_APLCG) ALTRET(XTNDALT);
      757     5363    2   XTNDALT:    ;
      758     5364    2               APLCGCP.MAXPG#=APLCGCP.MAXPG#+%FIMI_CXMP#;
      759     5365    2               CALL M$CGCTL (APLCGCTL) ALTRET(XTNDALT0);
      760     5366    2   XTNDALT0:   ;
      761     5367
      762     5368    2           END;
      763     5369
      764     5370    1         RETURN;
      765     5371        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:24   
      766     5372    1   DISCONNECT: PROC ALTRET;
      767     5373    2         STATION=CGAURD$->B$CGAURD.STATION;
      768     5374              %DISP(MSG="AUEV: Disconnecting Station");
      769     5385    2         STA.STATION# = STATION;
      770     5386    2         SV$ = SVHD$;
      771     5387    3           DO WHILE (SV$ ~= ADDR(NIL));
      772     5388    3           NEW$ = SV.LNK$;
      773     5389    3           IF STATION=SV.OFFER.STATION                                       /*#8.369*/
      774     5390    3           OR STATION=SV.MATCH.STATION THEN                                  /*#8.369*/
      775     5391    4             DO CASE( SV.COUPLING);
      776     5392    4               CASE( 1);
      777     5393                      %DISP(MSG="DISCONNECT: retracting unmatched offer",CLASS=DEBUG);
      778     5404    4                 IF STATION = SV.OFFER.STATION THEN
      779     5405    5                   DO;
      780     5406    5                   CALL SVDELINK;
      781     5407    5                   SVX$ = SV$;
      782     5408    5                   CALL FOI$RBUF (SVSCB,SVX$);
      783     5409    5                   END;
      784     5410    4               CASE( 2);
      785     5411                      %DISP(MSG="DISCONNECT: retracting matched offer",CLASS=DEBUG);
      786     5422    4                 IF STATION = SV.OFFER.STATION THEN
      787     5423    5                   DO;
      788     5424    5                   MSG.PARTNER2 = SV.OFFER.NAME;
      789     5425    5                   SV.OFFER.NAME = SV.MATCH.NAME;
      790     5426    5                   SV.MATCH.NAME = MSG.PARTNER2;
      791     5427    5                   SV.OFFER.STATION = SV.MATCH.STATION;
      792     5428    5                   SV.ACVO = SV.ACVM;
      793     5429    5                   SV.ASMO = SV.ASMM;
      794     5430    5                   SV.SCNO = SV.SCNM;
      795     5431    5                   IF SV.STATE.N THEN
      796     5432    6                     DO;
      797     5433    6                     TEMP = SV.MIDM;
      798     5434    6                     SV.MIDM = SV.MIDO;
      799     5435    6                     SV.MIDO = TEMP;
      800     5436    6                     END;
      801     5437    5                   SV.STATE.OC = SV.STATE.MC;
      802     5438    5                   END;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:25   
      803     5439    4                 SV.MATCH.STATION = ' ';
      804     5440    4                 SV.MIDM = 0;
      805     5441    4                 IF SV.MIDO > 0 THEN
      806     5442    4                  SV.STATE.N = TRUE;
      807     5443    4                 ELSE
      808     5444    4                  SV.STATE.N = FALSE;
      809     5445    4                 SV.SCO  = TRUE;
      810     5446    4                 SV.STATE.MC = FALSE;
      811     5447    4                 SV.COUPLING = 1;
      812     5448    4                 CALL MAYNOTIFY;
      813     5449    4                 IF SV.SCNO THEN CALL SCNOTIFYO;
      814     5450    4                 IF SV.OFFER.NAME = MYID THEN CALL MYRETRACT;
      815     5451    4             END;
      816     5452    3           SV$ = NEW$;
      817     5453    3           END;
      818     5454    2         RETURN;
      819     5455    2   END DISCONNECT;
      820     5456    1   SVDELINK: PROC;
      821     5457    2         IF SV$->SV.BLNK$ ~= ADDR(NIL) THEN
      822     5458    2          SV$->SV.BLNK$->SV.LNK$ = SV$->SV.LNK$;
      823     5459    2         ELSE SVHD$ = SV$->SV.LNK$;
      824     5460    2         IF SV$->SV.LNK$ ~= ADDR(NIL) THEN
      825     5461    2          SV$->SV.LNK$->SV.BLNK$ = SV$->SV.BLNK$;
      826     5462    2         ELSE SVTL$=SV$->SV.BLNK$;
      827     5463    2         RETURN;
      828     5464    2   END SVDELINK;
      829     5465    1   SVLINK: PROC;
      830     5466    2         SV$->SV.LNK$=ADDR(NIL);
      831     5467    2         SV$->SV.BLNK$=SVTL$;
      832     5468    2         IF SVTL$ ~= ADDR(NIL) THEN
      833     5469    2          SVTL$->SV.LNK$=SV$;
      834     5470    2         ELSE SVHD$=SV$;
      835     5471    2         SVTL$=SV$;
      836     5472    2         RETURN;
      837     5473    2   END SVLINK;
      838     5474        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:26   
      839     5475    1   CONNECT: PROC;
      840     5476
      841     5477    2         STATION = CGAURD$->B$CGAURD.STATION;
      842     5478              %DISP(MSG="AUEV: Connecting Station");
      843     5489    2         STA.STATION# = STATION;
      844     5490    2         MSG.TYPE = VERSION;
      845     5491    2         MSG.VNAME = 'B02';
      846     5492    2         MSG.MID   = BITBIN('777777777777'O);
      847     5493    2         CALL M$WRITE(WRITECG@) ALTRET(CGERR);
      848     5494    2         RETURN;
      849     5495    2   CGERR:
      850     5496    2         IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE = %E$LDSC THEN RETURN;
      851     5497    2         CALL M$MERC;
      852     5498
      853     5499    2   END CONNECT;
      854     5500        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:27   
      855     5501    1   MAYMATCH:
      856     5502    1         PROC ALTRET;
      857     5503    2         IF SV.COUPLING=1 THEN
      858     5504    2          IF MSG.VNAME = SV.SURROGATE THEN
      859     5505        /*
      860     5506          Rules for Sharing:
      861     5507                (1)   Two general offers NEVER match.
      862     5508                (2)   A general offer is matched ONLY by a specific
      863     5509                      matching offer.
      864     5510                (3)   A specific offer only matches the alternate specific
      865     5511                      offer.
      866     5512                (4)   An offer may not be matched by the same user.
      867     5513                                                                         */
      868     5514    2           IF SV.OFFER.NAME ~= MSG.PARTNER1 THEN
      869     5515    2            IF     (SV.MATCH.NAME = ' '    /*** Willing to share w/anyone ***/
      870     5516    2            AND (SV.OFFER.NAME = MSG.P2.ACCT OR SV.OFFER.NAME = MSG.PARTNER2))
      871     5517    2            OR                /*** Finally, Specific Offers ***/
      872     5518    2            ((SV.MATCH.NAME = MSG.P1.ACCT OR SV.MATCH.NAME = MSG.PARTNER1)
      873     5519    2            AND (SV.OFFER.NAME = MSG.P2.ACCT OR SV.OFFER.NAME = MSG.PARTNER2))THEN
      874     5520    3              DO;
      875     5521                   %DISP(MSG="MAYMATCH: Share Match");
      876     5532    3              SV.MATCH.NAME = MSG.PARTNER1;
      877     5533    3              SV.MATCH.STATION = STATION;
      878     5534    3              SV.COUPLING = 2;
      879     5535    3              SV.ACVM = INITIAL;
      880     5536    3              L = MSG.MID;
      881     5537    3              IF MSG.FIELD1~=0 AND SV.DBKEY<%SELECTOR THEN CALL VARTOSVS;
      882     5538    3              MSG.MID = L;
      883     5539    3              MSG.TYPE = COMPLETED;
      884     5540    3              MSG.INAME = SV.INAME;
      885     5541    3              MSG.FIELD2 = 0;
      886     5542    3              IF SV.DBSIZE > 0 THEN MSG.FIELD2 = SV.DBKEY;
      887     5543    3              MSG.FIELD1 = SV.COUPLING;
      888     5544    3              CALL M$WRITE( WRITECG@) ALTRET(CGERR);
      889     5545    3              SV.SCO  = TRUE;
      890     5546    3              IF SV.SCNO THEN CALL SCNOTIFYO;
      891     5547    3              ALTRETURN;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:28   
      892     5548    3              END;
      893     5549    2         RETURN;
      894     5550    2   CGERR:
      895     5551    2         IF %E$LDSC = B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.CODE THEN
      896     5552    2          ALTRETURN;
      897     5553    2         CALL M$MERC;
      898     5554    2   END MAYMATCH;
      899     5555        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:29   
      900     5556    1   DOSIGNON: PROC ALTRET;
      901     5557                /*   Allow this user on as an APL      */
      902     5558    2         CALL FOI$GBUF(SVSCB,SVX$) ALTRET(NOSVS);
      903     5559    2         SV$ = SVX$;
      904     5560              %DISP(MSG="DOSIGNON: Sign on Complete");
      905     5571    2         SV = SV_INIT;
      906     5572    2         SV.SCDF = '1'B;   /* Signon-record     */
      907     5573    2         SV.OFFER.NAME = MSG.PARTNER1;
      908     5574    2         SV.INAMER = SV$;
      909     5575    2         SV.OFFER.STATION = STATION;
      910     5576    2         SV.MATCH.NAME = MYID;
      911     5577    2         SV.SURROGATE  = %CONCAT(BITASC('325'O),'SC');
      912     5578    2         SV.COUPLING = 1;
      913     5579    2         SV.ASMO = '0011'B;
      914     5580    2         SV.ASMM = '0011'B;
      915     5581    2         IF MSG.FIELD1 = 0
      916     5582    2         THEN SV.DBKEY = KEYVAL;
      917     5583    3         ELSE DO;
      918     5584    3           SV.DBKEY = KEYVAL+%SELECTOR;
      919     5585                %DISP(MSG="DOSIGNON: * file requested",CLASS=DEBUG);
      920     5596    3           END;
      921     5597    2         KEYVAL   = KEYVAL + 1;
      922     5598    2         IF KEYVAL >= %SELECTOR THEN KEYVAL = 1;
      923     5599    2         SV.SURRLEN = MSG.FIELD1;
      924     5600    2         CALL SVLINK;
      925     5601    2         RETURN;
      926     5602    2   NOSVS:
      927     5603              %DISP(MSG="DOSIGNON: Signon Failed due to FOI$GBUF",CLASS=DEBUG);
      928     5614    2         ALTRETURN;
      929     5615    2   END DOSIGNON;
      930     5616        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:30   
      931     5617    1   CHECKSIGNON: PROC ALTRET;
      932     5618
      933     5619    2         NEW$ = SV$;
      934     5620    2         SV$ = SVHD$;
      935     5621    3           DO WHILE(SV$ ~= ADDR(NIL));
      936     5622    3           IF SV.SCDF THEN
      937     5623    3            IF SV.OFFER.NAME = MSG.PARTNER1 THEN
      938     5624    3             IF SV.OFFER.STATION = STATION
      939     5625    3             THEN GOTO OKAY;
      940     5626    3             ELSE GOTO BAD1;
      941     5627    3            ELSE IF SV.OFFER.STATION = STATION THEN GOTO BAD1;
      942     5628    3           SV$ = SV.LNK$;
      943     5629    3           END;
      944     5630    2         IF MSG.PARTNER1 = MYID THEN GOTO BAD1;
      945     5631    2         CALL DOSIGNON ALTRET(NOSVS);;
      946     5632    2   OKAY:
      947     5633    2         SVSIGNON$ = SV$;
      948     5634    2         SV$ = NEW$;
      949     5635    2         RETURN;
      950     5636    2   BAD1:
      951     5637              %DISP(MSG="CHECKSIGNON: Duplicate Signon exists",CLASS=DEBUG);
      952     5648    2         K = 1;
      953     5649    2         SV$ = NEW$;
      954     5650    2         ALTRETURN;
      955     5651    2   NOSVS:
      956     5652    2         K = 0;
      957     5653    2         SV$ = NEW$;
      958     5654    2         ALTRETURN;
      959     5655    2   END CHECKSIGNON;
      960     5656        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:31   
      961     5657    1   VARTOSVS: PROC;
      962     5658                      /*  To copy the value of a shared variable from */
      963     5659                      /*  :ZASV to our temp file.                     */
      964     5660              %DISP(MSG="VARTOSVS: Copying variable to * file.",CLASS=DEBUG);
      965     5671    2         DBKEY2.VAL = SV.DBKEY;
      966     5672    2         DBKEY.VAL  = 0-SV.DBKEY;
      967     5673    2         WRITESVS@.BUF_ = VECTOR(MSG);
      968     5674    2         READ@.BUF_     = VECTOR(MSG);
      969     5675    2   RDLP:
      970     5676    2         CALL M$READ(READ@) ALTRET(LD);
      971     5677    2         READ@.V.DVBYTE.CONT#   = FALSE;
      972     5678    2         WRITESVS@.V.DVBYTE.CONT# = FALSE;
      973     5679    2         K = F$SV$->F$DCB.ARS#;
      974     5680    2         WRITESVS@.BUF_ = VECTOR(ADDR(MSG)->KBUF);
      975     5681    2   CON:
      976     5682    2         CALL M$WRITE(WRITESVS@) ALTRET(NOCANDO);
      977     5683    2         IF WRITESVS@.V.DVBYTE.CONT# = TRUE THEN GOTO RDLP;
      978     5684    2   NOCANDO:
      979     5685    2         READ@.V.DVBYTE.CONT#   = FALSE;
      980     5686    2         WRITESVS@.V.DVBYTE.CONT# = FALSE;
      981     5687    2         SV.DBKEY = 0-SV.DBKEY;
      982     5688    2         WRITESVS@.BUF_ = VECTOR(MSG);
      983     5689    2         RETURN;
      984     5690    2   LD:
      985     5691    2         IF B$ERRCODE = %E$LD THEN
      986     5692    3           DO;
      987     5693    3           WRITESVS@.V.DVBYTE.CONT# = TRUE;
      988     5694    3           READ@.V.DVBYTE.CONT#     = TRUE;
      989     5695    3           GOTO CON;
      990     5696    3           END;
      991     5697    2         GOTO NOCANDO;
      992     5698    2   END VARTOSVS;
      993     5699        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:32   
      994     5700    1   MAYREAD:
      995     5701    1         PROC ALTRET;
      996     5702    2   DCL TYPE UBIN;
      997     5703    2         TYPE = 1;
      998     5704    2         GOTO COMMON;
      999     5705    2   MAYWRITE:
     1000     5706    2         ENTRY ALTRET;
     1001     5707    2         TYPE = 0;
     1002     5708    2         GOTO COMMON;
     1003     5709    2   MAYSEIZE:
     1004     5710    2         ENTRY ALTRET;
     1005     5711    2         TYPE = 2;
     1006     5712    2   COMMON:
     1007     5713    2         IF STATION = SV.OFFER.STATION THEN
     1008     5714    2          IF SV.STATE.MC THEN
     1009     5715    2           GOTO NOTNOW;
     1010     5716    2         IF STATION = SV.MATCH.STATION THEN
     1011     5717    2          IF SV.STATE.OC THEN
     1012     5718    2           GOTO NOTNOW;
     1013     5719    2         IF TYPE < 2 THEN
     1014     5720    3           DO;
     1015     5721    3           IF STATION = SV.OFFER.STATION
     1016     5722    3           THEN MASK = (SV.ACVO | FLIPPED( BITBIN(SV.ACVM) )) & SV.ASMO;
     1017     5723    3           ELSE MASK = (SV.ACVM | FLIPPED( BITBIN(SV.ACVO) )) & SV.ASMM;
     1018     5724    3           IF BMASK( TYPE+TYPE) THEN
     1019     5725    3            GOTO NOTNOW;
     1020     5726    3           END;
     1021     5727    2         IF STATION = SV.OFFER.STATION THEN
     1022     5728    3           DO CASE( TYPE);
     1023     5729    3             CASE( 0);
     1024     5730    3               MASK = '0110'B;
     1025     5731    3             CASE( 1);
     1026     5732    3               MASK = '0010'B;
     1027     5733    3             CASE( 2);
     1028     5734    3               MASK = '0011'B;
     1029     5735    3           END;
     1030     5736    2         ELSE
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:33   
     1031     5737    3           DO CASE( TYPE);
     1032     5738    3             CASE( 0);
     1033     5739    3               MASK = '0101'B;
     1034     5740    3             CASE( 1);
     1035     5741    3               MASK = '0001'B;
     1036     5742    3             CASE( 2);
     1037     5743    3               MASK = '0111'B;
     1038     5744    3           END;
     1039     5745    2         IF SV.STATE.N THEN
     1040     5746    2          MASK = MASK | '1000'B;
     1041     5747    2         SV.STATE = MASK;
     1042     5748    2         RETURN;
     1043     5749    2   NOTNOW:
     1044     5750    2         SV.STATE.N = TRUE;
     1045     5751    2         IF STATION = SV.OFFER.STATION THEN
     1046     5752    2          SV.MIDO = MSG.MID;
     1047     5753    2         ELSE
     1048     5754    2          SV.MIDM = MSG.MID;
     1049     5755    2         MSG.TYPE = WAIT4CONTROL;
     1050     5756    2         CALL M$WRITE( WRITECG@) ALTRET(CGERR);
     1051     5757    2         ALTRETURN;
     1052     5758    2   CGERR:
     1053     5759    2         IF %E$LDSC = B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.CODE THEN
     1054     5760    2          ALTRETURN;
     1055     5761    2         CALL M$MERC;
     1056     5762    2   END MAYREAD;
     1057     5763        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:34   
     1058     5764    1   MAYNOTIFY:
     1059     5765    1         PROC;
     1060     5766    2         IF NOT SV.STATE.N THEN
     1061     5767    2          RETURN;
     1062     5768    2   NOTIFY:
     1063     5769    2         ENTRY;
     1064     5770    2         MSG.TYPE = COMPLETED;
     1065     5771    2         MSG.FIELD1 = 1;
     1066     5772    2         MSG.INAMER = SV$;
     1067     5773    2         IF SV.MIDO > 0 THEN
     1068     5774    3           DO;
     1069     5775    3           MSG.MID = SV.MIDO;
     1070     5776    3           STA.STATION#= SV.OFFER.STATION;
     1071     5777    3           CALL M$WRITE( WRITECG@) ALTRET(CGERR);
     1072     5778                %DISP(MSG="NOTIFY: Station notified to retry outstanding request",
     1073     5779                STATION="STA.STATION#",CLASS=DEBUG);
     1074     5790    3           IF SV.SCNO THEN CALL CLEARSC;
     1075     5791    3           END;
     1076     5792    2         IF SV.MIDM > 0 THEN
     1077     5793    3           DO;
     1078     5794    3           MSG.MID = SV.MIDM;
     1079     5795    3           STA.STATION#= SV.MATCH.STATION;
     1080     5796    3           IF SV.MATCH.NAME~=MYID THEN CALL M$WRITE(WRITECG@)ALTRET(CGERR);
     1081     5797                %DISP(MSG="NOTIFY: Station notified to retry outstanding request",
     1082     5798                STATION="STA.STATION#",CLASS=DEBUG);
     1083     5809    3           IF SV.SCNM THEN CALL CLEARSC;
     1084     5810    3           END;
     1085     5811    2   WROTEIT:;
     1086     5812    2         STA.STATION# = STATION;
     1087     5813    2         SV.STATE.N = FALSE;
     1088     5814    2         SV.MIDO = 0;
     1089     5815    2         SV.MIDM = 0;
     1090     5816    2         RETURN;
     1091     5817    2   CGERR:
     1092     5818    2         IF %E$LDSC = B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.CODE THEN
     1093     5819    2          GOTO WROTEIT;
     1094     5820    2         CALL M$MERC;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:35   
     1095     5821    2   END MAYNOTIFY;
     1096     5822        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:36   
     1097     5823    1   CLEARSC: PROC;
     1098     5824    2   DCL CLRSCE BIT(1);
     1099     5825    2   DCL OSV$   PTR;
     1100     5826    2         CLRSCE = TRUE;
     1101     5827    2         GOTO CONTIN;
     1102     5828    2   CLEARSCN: ENTRY;
     1103     5829    2         CLRSCE = FALSE;
     1104     5830    2   CONTIN:
     1105     5831    2         OSV$ = SV$;
     1106     5832                         /*  To remove $QSC pending from SV entries   */
     1107     5833    2         SV$ = SVHD$;
     1108     5834    3           DO WHILE(SV$ ~= ADDR(NIL));
     1109     5835
     1110     5836    3           IF SV.OFFER.STATION = STA.STATION# THEN
     1111     5837    4             DO;
     1112     5838    4             IF CLRSCE THEN SV.SCO = FALSE;
     1113     5839    4             SV.SCNO= FALSE;
     1114     5840    4             END;
     1115     5841    3           ELSE
     1116     5842    3            IF SV.MATCH.STATION = STA.STATION# THEN
     1117     5843    4              DO;
     1118     5844    4              IF CLRSCE THEN SV.SCM = FALSE;
     1119     5845    4              SV.SCNM= FALSE;
     1120     5846    4              END;
     1121     5847    3           SV$ = SV.LNK$;
     1122     5848    3           END;
     1123     5849    2         SV$ = OSV$;
     1124     5850    2         RETURN;
     1125     5851    2   END CLEARSC;
     1126     5852        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:37   
     1127     5853    1   SCNOTIFYM: PROC;
     1128     5854                /*  To notify SV user that state change has occured   */
     1129     5855    2         MSG.MID = SV.MIDM;
     1130     5856    2         STA.STATION# = SV.MATCH.STATION;
     1131     5857    2         IF SV.MATCH.NAME = MYID THEN GOTO WROTIT;
     1132     5858    2         GOTO CONTIN;
     1133     5859
     1134     5860    2   SCNOTIFYO: ENTRY;
     1135     5861    2         MSG.MID = SV.MIDO;
     1136     5862    2         STA.STATION# = SV.OFFER.STATION;
     1137     5863    2   CONTIN:
     1138     5864              %DISP(MSG="SCNOTIFY: $QSC change",STATION="STA.STATION#",CLASS=DEBUG);
     1139     5875    2         MSG.TYPE = COMPLETED;
     1140     5876    2         MSG.FIELD1 = 1;
     1141     5877    2         CALL M$WRITE(WRITECG@) ALTRET(CGERR);
     1142     5878    2   WROTIT:
     1143     5879    2         CALL CLEARSC;
     1144     5880    2         STA.STATION# = STATION;
     1145     5881    2         RETURN;
     1146     5882    2   CGERR:
     1147     5883    2         IF %E$LDSC = B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE THEN GOTO WROTIT;
     1148     5884    2         CALL M$MERC;
     1149     5885    2   END SCNOTIFYM;
     1150     5886        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:38   
     1151     5887    1   MATCHSC: PROC;
     1152     5888                   /*  To determine if an offer exists for a user with
     1153     5889                       a $QSC request outstanding.                       */
     1154     5890    2         IF SV.MATCH.NAME = ' ' THEN RETURN;
     1155     5891    2         NEW$ = SV$;
     1156     5892    2         SV$ = SVHD$;
     1157     5893    3           DO WHILE(SV$ ~= ADDR(NIL));
     1158     5894    3           IF SV.SCDF THEN
     1159     5895    3            IF SV.OFFER.NAME = NEW$->SV.MATCH.NAME THEN
     1160     5896    4              DO;
     1161     5897    4              IF SV.SCNO THEN      /* If we notify...               */
     1162     5898    5                DO;
     1163     5899    5                SV.SCO = TRUE;
     1164     5900    5                CALL SCNOTIFYO;
     1165     5901    5                END;
     1166     5902    4              RETURN;
     1167     5903    4              END;
     1168     5904    3           SV$ = SV.LNK$;
     1169     5905    3           END;
     1170     5906    2         RETURN;
     1171     5907    2   END MATCHSC;
     1172     5908        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:39   
     1173     5909    1   SVPROCESSOR: PROC ALTRET;
     1174     5910
     1175     5911        /*I*    NAME:       FIA$SVPROCESSOR
     1176     5912
     1177     5913                PURPOSE:    To process shared variable reads from other
     1178     5914                            comgroup stations.
     1179     5915
     1180     5916                CALL:       CALL SVPROCESSOR;
     1181     5917
     1182     5918                INPUT:      FI_APLCGBUF
     1183     5919
     1184     5920                DESCRIPTION:
     1185     5921
     1186     5922                   The following functions are performed:
     1187     5923
     1188     5924                   o  If the message includes the "internal" variable name,
     1189     5925                      the name is looked up.  If the name does not exist
     1190     5926                      or if the name doesn't belong to this station, then
     1191     5927                      the station is deactivated.
     1192     5928
     1193     5929                   o  The message type is then investigated to determine
     1194     5930                      whether or not the internal name is required to be
     1195     5931                      present for this type of message.  If this is in
     1196     5932                      error, the station will be deactivated.
     1197     5933
     1198     5934                   o  If the variable whose internal name is supplied has
     1199     5935                      the current station  in awaiting a reply status
     1200     5936                      (SV.STATE.N = true) then the waiting state is removed.
     1201     5937
     1202     5938                   o  One of the following special actions is selected
     1203     5939                      depending upon the field MSG.TYPE:
     1204     5940
     1205     5941                   o  MSG.TYPE = SHARE
     1206     5942
     1207     5943                      INPUT:   MSG.INAME      ...   Internal variable name
     1208     5944                               MSG.VNAME      ...   Surrogate name
     1209     5945                               MSG.PARTNER1   ...   Account/Cloneid of msg
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:40   
     1210     5946                               MSG.PARTNER2   ...   Account/Cloneid of partner
     1211     5947                               MSG.FIELD1     ...   0=:ZASV user,1=CG
     1212     5948                               MSG.FIELD2     ...   0=no value,1=value to come
     1213     5949
     1214     5950                      OUTPUT:  MSG.FIELD1     ...   SV coupling
     1215     5951                               MSG.INAME      ...   Internal variable name
     1216     5952                               MSG.FIELD2     ...   DBFILE KEY
     1217     5953                               MSG.TYPE       ...   COMPLETED
     1218     5954
     1219     5955                      DESCRIPTION:
     1220     5956
     1221     5957                         o  The message is first checked to verify that the
     1222     5958                            station has an associated logon entry.  If there
     1223     5959                            isn't one, it will be created if MSG.PARTNER1
     1224     5960                            is unique and there is table space.  If the
     1225     5961                            processor ID is not unique (MSG.PARTNER1) then
     1226     5962                            MSG.FIELD1 is set to -1 and MSG.FIELD2 is set
     1227     5963                            to zero and the originating station is sent
     1228     5964                            a complete message.
     1229     5965
     1230     5966                         o  If the signon was successful, then the internal
     1231     5967                            variable name is checked.  If non-zero then this
     1232     5968                            is a repetition of a previous offer to share.
     1233     5969                            A complete message is then returned with the
     1234     5970                            shared variable coupling, internal name and
     1235     5971                            key of the variable in the variable database.
     1236     5972
     1237     5973                         o  If the internal name is zero (no internal name
     1238     5974                            specified), then this is a new offer to share.
     1239     5975                            First this offer is checked to see if it matches
     1240     5976                            any previous offers.  If it does the internal
     1241     5977                            name etc are returned.
     1242     5978
     1243     5979                         o  Since it doesn't match an old offer, a new offer
     1244     5980                            is then created and its status initialized.
     1245     5981                            The coupling returned in this case is 1.
     1246     5982
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:41   
     1247     5983
     1248     5984                   o  MSG.TYPE = RETRACT
     1249     5985
     1250     5986                      INPUT:   MSG.INAME      ...   Internal variable name
     1251     5987
     1252     5988                      OUTPUT:  MSG.FIELD1     ...   Previous SV coupling
     1253     5989                               MSG.TYPE       ...   COMPLETED
     1254     5990
     1255     5991                      DESCRIPTION:
     1256     5992
     1257     5993                         o  If the coupling level is 1, then this internal
     1258     5994                            variable name entry is released.
     1259     5995
     1260     5996                         o  Otherwise, if this is the original offerer then
     1261     5997                            the information about the matcher of the offer
     1262     5998                            is moved to replace the offerer.
     1263     5999
     1264     6000                         o  The state of the variable is made to appear as
     1265     6001                            though the matcher has just assigned a value to
     1266     6002                            the shared variable (in spite of any interlocks).
     1267     6003
     1268     6004                         o  If the offerer has an outstanding request for the
     1269     6005                            variable then he is awakened.
     1270     6006
     1271     6007                         o  The coupling of the variable is demotted to 1.
     1272     6008
     1273     6009                         o  This offer is re-linked at the tail of the current
     1274     6010                            offers.
     1275     6011
     1276     6012                         o  If the other user is awaiting a state change, then
     1277     6013                            he is awakened.
     1278     6014
     1279     6015
     1280     6016                   o  MSG.TYPE = SETACV
     1281     6017
     1282     6018                      INPUT:   MSG.INAME      ...   Internal variable name
     1283     6019                               MSG.FIELD1     ...   User's ACV contribution
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:42   
     1284     6020
     1285     6021                      OUTPUT:  MSG.FIELD1     ...   New ACV.
     1286     6022                               MSG.TYPE       ...   COMPLETED
     1287     6023
     1288     6024                      DESCRIPTION:
     1289     6025
     1290     6026                         o  The users access control vector contribution is
     1291     6027                            set as indicated by bits 32-35 of MSG.FIELD1.
     1292     6028
     1293     6029                         o  The resulting access control vector for this
     1294     6030                            variable is returned (logical sum of user and
     1295     6031                            partner) in bits 32-35 of MSG.FIELD1.
     1296     6032
     1297     6033
     1298     6034                   o  MSG.TYPE = GETACV
     1299     6035
     1300     6036                      INPUT:   MSG.INAME      ...   Internal variable name
     1301     6037
     1302     6038                      OUTPUT:  MSG.FIELD1     ...   Current ACV.
     1303     6039                               MSG.TYPE       ...   COMPLETED
     1304     6040
     1305     6041                      DESCRIPTION:
     1306     6042
     1307     6043                         o  The resulting access control vector for this
     1308     6044                            variable is returned (logical sum of user and
     1309     6045                            partner) in bits 32-35 of MSG.FIELD1.
     1310     6046
     1311     6047
     1312     6048                   o  MSG.TYPE = PREREAD/PREWRITE
     1313     6049
     1314     6050                      INPUT:   MSG.INAME      ...   Internal variable name
     1315     6051
     1316     6052                      OUTPUT:  MSG.INAME      ...   Database Key
     1317     6053                               MSG.FIELD1     ...   Size of DB for READ
     1318     6054                               MSG.TYPE       ...   COMPLETED/WAIT4CONTROL
     1319     6055
     1320     6056                      DESCRIPTION:
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:43   
     1321     6057
     1322     6058                         o  If the other station currently has control,
     1323     6059                            or if the access control matrix prevents giving
     1324     6060                            access at this time, the response is WAIT4CONTROL,
     1325     6061                            SV.STATE.N is set to true and the current message
     1326     6062                            ID is set in SV.MIDO/M.
     1327     6063
     1328     6064                            A COMPLETED message following a WAIT4CONTROL
     1329     6065                            message is to be interpreted by the station as
     1330     6066                            a request to repeat the PREREAD/PREWRITE/SEIZE
     1331     6067                            message that blocked them.
     1332     6068
     1333     6069                         o  If control can be granted, the SV.STATE is set
     1334     6070                            to indicate that it has been given and the key
     1335     6071                            of the variables datablock and the size of the
     1336     6072                            datablock are returned to the requestor in the
     1337     6073                            COMPLETED message.
     1338     6074
     1339     6075
     1340     6076                   o  MSG.TYPE = SEIZE
     1341     6077
     1342     6078                      INPUT:   MSG.INAME      ...   Internal variable name
     1343     6079
     1344     6080                      OUTPUT:  MSG.FIELD1     ...   Size of variable
     1345     6081                               MSG.INAME      ...   Database KEY
     1346     6082                               MSG.TYPE       ...   COMPLETED/WAIT4CONTROL
     1347     6083
     1348     6084                      DESCRIPTION:
     1349     6085
     1350     6086                         o  This message is the same as the PREREAD and
     1351     6087                            PREWRITE commands except that access controls
     1352     6088                            are ignored in determining whether to grant
     1353     6089                            access.
     1354     6090
     1355     6091
     1356     6092                   o  MSG.TYPE = GETASM
     1357     6093
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:44   
     1358     6094                      INPUT:   MSG.INAME      ...   Internal variable name
     1359     6095
     1360     6096                      OUTPUT:  MSG.FIELD1     ...   Current SV state matrix
     1361     6097                               MSG.TYPE       ...   COMPLETED
     1362     6098
     1363     6099                      DESCRIPTION:
     1364     6100
     1365     6101                         o  The shared variable state matrix for this
     1366     6102                            variable is returned in bits 32-35 of MSG.FIELD1.
     1367     6103
     1368     6104
     1369     6105                   o  MSG.TYPE = SIGNON
     1370     6106
     1371     6107                      INPUT:   MSG.PARTNER1   ...   Proposed processor ID
     1372     6108                               MSG.FIELD1     ...   0=:ZASV user,1=CG
     1373     6109
     1374     6110                      OUTPUT:  MSG.FIELD1     ...   Signon status
     1375     6111                               MSG.TYPE       ...   COMPLETED
     1376     6112
     1377     6113                      DESCRIPTION:
     1378     6114
     1379     6115                         o  If the proposed processor ID is unique a signon
     1380     6116                            block is allocated for this station and
     1381     6117                            MSG.FIELD1 is returned as 1.
     1382     6118
     1383     6119                         o  Otherwise, either the processor ID is a duplicate
     1384     6120                            or no space is available for the ID and MSG.FIELD1
     1385     6121                            is returned as 0.
     1386     6122
     1387     6123
     1388     6124                   o  MSG.TYPE = RELEASE
     1389     6125
     1390     6126                      INPUT:   MSG.INAME      ...   Internal variable name
     1391     6127                               MSG.FIELD1     ...   Size of DB or Zero.
     1392     6128
     1393     6129                      OUTPUT:  MSG.TYPE       ...   COMPLETED
     1394     6130
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:45   
     1395     6131                      DESCRIPTION:
     1396     6132
     1397     6133                         o  The size of the datablock is saved in SV.DBSIZE
     1398     6134                            if MSG.FIELD1 is non-zero.
     1399     6135
     1400     6136                         o  The variable's state matrix is set according to
     1401     6137                            the operation that has just occured.
     1402     6138
     1403     6139                         o  If the partner is waiting for access, he is sent
     1404     6140                            a reply to retry his request.
     1405     6141
     1406     6142                         o  SV.STATE is reset to reflect the variable being
     1407     6143                            free.
     1408     6144
     1409     6145
     1410     6146                   o  MSG.TYPE = QUERY
     1411     6147
     1412     6148                      INPUT:   MSG.PARTNER1   ...   Account/Cloneid of msg
     1413     6149                               MSG.PARTNER2   ...   Account/Cloneid of partner
     1414     6150                               MSG.FIELD1     ...   0=:ZASV user,1=CG
     1415     6151
     1416     6152                      OUTPUT:  MSG.FIELD1     ...   Database Key
     1417     6153                               MSG.INAME      ...   Size of Query rs datablock
     1418     6154                               MSG.FIELD2     ...   Maximum row length
     1419     6155                               MSG.TYPE       ...   COMPLETED
     1420     6156
     1421     6157                      DESCRIPTION:
     1422     6158
     1423     6159                         o  The current stations signon is verified as in
     1424     6160                            the SHARE command.
     1425     6161
     1426     6162                         o  If MSG.PARTNER2 is blank then this is a request
     1427     6163                            for a list of the accounts offering variables
     1428     6164                            to this processor.  All of the variable entries
     1429     6165                            of coupling level 1 are scanned extracting the
     1430     6166                            processor IDs that are making either general
     1431     6167                            offers to share or a specific offer to share with
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:46   
     1432     6168                            this processor.  The resulting APL datablock is
     1433     6169                            written to the file using the key in this stations
     1434     6170                            signon record.
     1435     6171
     1436     6172                         o  If MSG.PARTNER2 is non-blank then this is a
     1437     6173                            request for the list of variables being offered to
     1438     6174                            this processor by the processor identified in
     1439     6175                            MSG.PARTNER2.  An APL datablock is created and
     1440     6176                            returned with the variable names one per row
     1441     6177                            in an N by 80 matrix.
     1442     6178
     1443     6179
     1444     6180                   o  MSG.TYPE = STATECHANGE
     1445     6181
     1446     6182                      INPUT:   MSG.PARTNER1   ...   Processor ID
     1447     6183                               MSG.FIELD1     ...   0=:ZASV user,1=CG
     1448     6184
     1449     6185                      OUTPUT:  MSG.FIELD1     ...   Status of request
     1450     6186
     1451     6187                      DESCRIPTION:
     1452     6188
     1453     6189                         o  The current stations signon is verified as in
     1454     6190                            the SHARE command.
     1455     6191
     1456     6192                         o  All of the variables shared by this station are
     1457     6193                            scanned looking for a variable entry with SV.SCO/M
     1458     6194                            set (which indicates that a statechange has
     1459     6195                            occured since this command was last issued).
     1460     6196
     1461     6197                         o  If no change has occured then SV.SCNO/M is set to
     1462     6198                            indicate that when a state change does occur that
     1463     6199                            this station is to be notified.
     1464     6200
     1465     6201                         o  When a state change does occur (or has been found)
     1466     6202                            then all of the SV entries are scanned, resetting
     1467     6203                            the SV.SCNO/M and SV.SCO/M fields.
     1468     6204
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:47   
     1469     6205                         o  MSG.FIELD1 is returned as zero if a valid signon
     1470     6206                            was not achieved, otherwise, MSG.FIELD1 is
     1471     6207                            returned as 1.
     1472     6208
     1473     6209                         o  The SV.SCNO/M field is interrogated when a
     1474     6210                            variable is retracted, or when the command
     1475     6211                            RELEASE is issued, when an offer is matched
     1476     6212                            or when a new offer is made specifically to this
     1477     6213                            station.
     1478     6214
     1479     6215
     1480     6216                   o  MSG.TYPE = GETDATA
     1481     6217
     1482     6218                      INPUT:   MSG.INAME      ...   Internal variable name
     1483     6219
     1484     6220                      OUTPUT:  MSG.VNAME      ...   Current SV state matrix
     1485     6221                               MSG.TYPE       ...   GETDATA
     1486     6222
     1487     6223                      DESCRIPTION:
     1488     6224
     1489     6225                         o  If the internal variable name was not specified,
     1490     6226                            then this is treated as an attempt to read the
     1491     6227                            latest $QSVQ result.  Otherwise it is the value
     1492     6228                            of the variable specified.
     1493     6229
     1494     6230                         o  If the variable state indicates that the
     1495     6231                            appropriate MAYREAD or MAYSEIZE command didn't
     1496     6232                            precede this message then the station is
     1497     6233                            deactivated.
     1498     6234
     1499     6235                         o  Otherwise, a variable length record is written
     1500     6236                            in response which contains the APL datablock
     1501     6237                            starting at position MSG.VNAME.
     1502     6238
     1503     6239
     1504     6240                   o  MSG.TYPE = PUTDATA
     1505     6241
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:48   
     1506     6242                      INPUT:   MSG.INAME      ...   Internal variable name
     1507     6243                               MSG.VNAME      ...   APL Datablock
     1508     6244
     1509     6245                      OUTPUT:  *NONE*
     1510     6246
     1511     6247                      DESCRIPTION:
     1512     6248
     1513     6249                         o  If the variable state indicates that the
     1514     6250                            appropriate MAYWRITE command didn't precede
     1515     6251                            this message then the station is deactivated.
     1516     6252
     1517     6253                         o  Otherwise, the datablock type and rank are
     1518     6254                            verified, if illegal then the station is
     1519     6255                            deactivated.
     1520     6256
     1521     6257                         o  Finally, the variable length message is read
     1522     6258                            from the comgroup (if not completed already)
     1523     6259                            and written to the variable database file.
     1524     6260
     1525     6261
     1526     6262
     1527     6263
     1528     6264                                                                            */
     1529     6265
     1530     6266
     1531     6267    2         STATION=FI_EVNT$->FI$EVNT.CITE$->FI$APLRD.NAME;
     1532     6268    2         STA.STATION# = STATION;
     1533     6269    2         IF MSG.INAME ~= 0 THEN
     1534     6270    3           DO;
     1535     6271    3           SV$ = SVHD$;
     1536     6272    4             DO WHILE SV$ ~= ADDR(NIL);
     1537     6273    4             IF SV$ = MSG.INAMER THEN GOTO SVISOK;
     1538     6274    4             SV$ = SV.LNK$;
     1539     6275    4             END;
     1540     6276                %DISP(MSG="SVPROCESSOR: INAME does not exist",CLASS=ERROR);
     1541     6287    3   SVISOK:
     1542     6288    3           IF SV_NOT_ALLOWED(MSG.TYPE) THEN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:49   
     1543     6289                 %DISP(MSG="SVPROCESSOR: INAME not legal here",CLASS=ERROR);
     1544     6300    3           IF STATION = SV.OFFER.STATION THEN
     1545     6301    4             DO;
     1546     6302    4             IF SV.SCNO THEN CALL CLEARSCN;
     1547     6303    4             SV$ = MSG.INAMER;
     1548     6304    4             SV.MIDO = 0;
     1549     6305    4             END;
     1550     6306    3           ELSE
     1551     6307    3            IF STATION = SV.MATCH.STATION THEN
     1552     6308    4              DO;
     1553     6309    4              IF SV.SCNM THEN CALL CLEARSCN;
     1554     6310    4              SV$ = MSG.INAMER;
     1555     6311    4              SV.MIDM = 0;
     1556     6312    4              END;
     1557     6313    3            ELSE
     1558     6314                  %DISP(MSG="SVPROCESSOR: INAME is not one of yours",CLASS=ERROR);
     1559     6325
     1560     6326    3           IF SV.MIDO+SV.MIDM = 0 THEN SV.STATE.N = FALSE;
     1561     6327    3           END;
     1562     6328    2         ELSE IF SV_REQUIRED(MSG.TYPE) THEN
     1563     6329                %DISP(MSG="SVPROCESSOR: INAME is required here",CLASS=ERROR);
     1564     6340    3           DO CASE( MSG.TYPE);
     1565     6341        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:50   
     1566     6342    3             CASE( SHARE);
     1567     6343                    %DISP(MSG="$QSVO: Offer to share");
     1568     6354    3               IF MSG.INAME = 0 THEN
     1569     6355    4                 DO;
     1570     6356    4                 CALL CHECKSIGNON ALTRET(SHERR);
     1571     6357    4                 SV$ = SVHD$;
     1572     6358    4                 NEW$ = ADDR( NIL);
     1573     6359    5                   DO WHILE (SV$ ~= ADDR(NIL));
     1574     6360    5                   CALL MAYMATCH ALTRET( LEAVE);
     1575     6361    5                   SV$ = SV$->SV.LNK$;
     1576     6362    5                   END;
     1577     6363    4                 CALL FOI$GBUF (SVSCB,SVX$) ALTRET(NOSVS);
     1578     6364    4                 SV$ = SVX$;
     1579     6365    4                 SV$->SV=SV_INIT;
     1580     6366    4                 CALL SVLINK;
     1581     6367    4                 GOTO NEWSV;
     1582     6368    4   NOSVS:        ;
     1583     6369                      %DISP(MSG="Reporting NOSPACE for offer or signon",CLASS=DEBUG);
     1584     6380    4                 MSG.TYPE = NOSPACE;
     1585     6381    4                 CALL M$WRITE( WRITECG@) ALTRET( CGERR);
     1586     6382    4                 GOTO LEAVE;
     1587     6383    4   NEWSV:        ;
     1588     6384                      %DISP(MSG="$QSVO: Entering unmatched offer",CLASS=DEBUG);
     1589     6395    4                 SV.SURROGATE = MSG.VNAME;
     1590     6396    4                 CALL INDEX(TEMP, ' ', MSG.VNAME);
     1591     6397    4                 SV.SURRLEN = TEMP;
     1592     6398    4                 SV.INAMER = SV$;
     1593     6399    4                 IF SVSIGNON$->SV.DBKEY < %SELECTOR
     1594     6400    4                 THEN SV.DBKEY = KEYVAL;
     1595     6401    4                 ELSE SV.DBKEY = KEYVAL+%SELECTOR;
     1596     6402    4                 KEYVAL = KEYVAL + 1;
     1597     6403    4                 IF KEYVAL >= %SELECTOR THEN KEYVAL = 1;
     1598     6404    4                 SV.OFFER.STATION = STATION;
     1599     6405    4                 SV.OFFER.NAME = MSG.PARTNER1;
     1600     6406    4                 SV.MATCH.STATION = ' ';
     1601     6407    4                 SV.MATCH.NAME = MSG.PARTNER2;
     1602     6408    4                 SV.COUPLING = 1;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:51   
     1603     6409    4                 SV.STATE = INITIAL;
     1604     6410    4                 SV.ASMO = '0011'B;
     1605     6411    4                 SV.ASMM = '0011'B;
     1606     6412    4                 SV.ACVO = INITIAL;
     1607     6413    4                 SV.ACVM = INITIAL;
     1608     6414    4                 SV.DBSIZE = 0;
     1609     6415    4                 SV.MIDO = 0;
     1610     6416    4                 SV.MIDM = 0;
     1611     6417    4                 MSG.TYPE = COMPLETED;
     1612     6418    4                 MSG.INAMER = SV$;
     1613     6419    4                 IF MSG.FIELD2 > 0 THEN SV.STATE = '0110'B;
     1614     6420    4                 IF SV.MATCH.NAME = MYID THEN CALL MYOFFER;
     1615     6421    4                 MSG.FIELD1 = SV.COUPLING;
     1616     6422    4                 MSG.FIELD2 = SV.DBKEY;
     1617     6423    4                 CALL M$WRITE( WRITECG@) ALTRET( CGERR);
     1618     6424    4                 CALL MATCHSC;
     1619     6425    4                 GOTO LEAVE;
     1620     6426    4                 END;
     1621     6427    3               ELSE
     1622     6428    4                 DO; /* MSG.INAME > 0 */
     1623     6429    4                 IF STATION = SV.OFFER.STATION THEN
     1624     6430    5                   DO; /* repetition of earlier offer */
     1625     6431    5                   MSG.TYPE = COMPLETED;
     1626     6432    5                   MSG.INAMER = SV$;
     1627     6433    5                   MSG.FIELD1 = SV.COUPLING;
     1628     6434    5                   MSG.FIELD2 = SV.DBKEY;
     1629     6435    5                   CALL M$WRITE( WRITECG@) ALTRET( CGERR);
     1630     6436    5                   GOTO LEAVE;
     1631     6437    5                   END;
     1632     6438    4                 CALL MAYMATCH ALTRET( LEAVE);
     1633     6439    4                 MSG.TYPE = COMPLETED;
     1634     6440    4                 MSG.INAMER = SV$;
     1635     6441    4                 MSG.FIELD2 = SV.DBKEY;
     1636     6442    4                 MSG.FIELD1 = SV.COUPLING;
     1637     6443    4                 CALL M$WRITE( WRITECG@) ALTRET( CGERR);
     1638     6444    4                 CALL MAYNOTIFY;
     1639     6445    4                 GOTO LEAVE;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:52   
     1640     6446    4                 END;
     1641     6447    3   SHERR:
     1642     6448    3               IF K = 0 THEN GOTO NOSVS;
     1643     6449    3               MSG.TYPE = COMPLETED;
     1644     6450    3               MSG.INAME = 0;
     1645     6451    3               MSG.FIELD1 = BITBIN('777777777777'O);
     1646     6452    3               MSG.FIELD2 = 0;
     1647     6453    3               CALL M$WRITE(WRITECG@) ALTRET(CGERR);
     1648     6454    3               GOTO LEAVE;
     1649     6455        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:53   
     1650     6456    3             CASE( RETRACT);
     1651     6457                    %DISP(MSG="$QSVR: Offer retraction");
     1652     6468    3               MSG.FIELD1 = SV.COUPLING;
     1653     6469    3               IF SV.COUPLING = 2 THEN
     1654     6470    4                 DO;
     1655     6471                      %DISP(MSG="$QSVR Matched Offer retraction",CLASS=DEBUG);
     1656     6482    4                 IF STATION = SV.OFFER.STATION THEN
     1657     6483    5                   DO;
     1658     6484    5                   MSG.PARTNER2 = SV.OFFER.NAME;
     1659     6485    5                   SV.OFFER.NAME = SV.MATCH.NAME;
     1660     6486    5                   SV.MATCH.NAME = MSG.PARTNER2;
     1661     6487    5                   SV.OFFER.STATION = SV.MATCH.STATION;
     1662     6488    5                   SV.ACVO = SV.ACVM;
     1663     6489    5                   SV.ASMO = SV.ASMM;
     1664     6490    5                   SV.MIDO = SV.MIDM;
     1665     6491    5                   SV.SCNO = SV.SCNM;
     1666     6492    5                   SV.STATE=(SV.STATE&'1000'B)|NEWSTATES(BITBIN(SV.STATE&'0111'B));
     1667     6493    5                   END;
     1668     6494    4                 SV.MATCH.STATION = ' ';
     1669     6495    4                 SV.MIDM = 0;
     1670     6496    4                 IF SV.MIDO > 0 THEN
     1671     6497    4                  SV.STATE.N = TRUE;
     1672     6498    4                 ELSE
     1673     6499    4                  SV.STATE.N = FALSE;
     1674     6500    4                 SV.SCO  = TRUE;
     1675     6501    4                 SV.ACVM = INITIAL;
     1676     6502    4                 SV.COUPLING = 1;
     1677     6503    4                 CALL SVDELINK;
     1678     6504    4                 CALL SVLINK;
     1679     6505    4                 MSG.TYPE = COMPLETED;
     1680     6506    4                 CALL M$WRITE(WRITECG@) ALTRET(CGERR);
     1681     6507    4                 CALL MAYNOTIFY;
     1682     6508    4                 IF SV.SCNO THEN CALL SCNOTIFYO;
     1683     6509    4                 IF SV.OFFER.NAME = MYID THEN CALL MYRETRACT;
     1684     6510    4                 END;
     1685     6511    3               ELSE
     1686     6512    4                 DO;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:54   
     1687     6513                      %DISP(MSG="$QSVR Unmatched offer retraction",CLASS=DEBUG);
     1688     6524    4                 CALL SVDELINK;
     1689     6525    4                 SVX$ = SV$;
     1690     6526    4                 CALL FOI$RBUF (SVSCB,SVX$);
     1691     6527    4                 MSG.TYPE = COMPLETED;
     1692     6528    4                 CALL M$WRITE(WRITECG@) ALTRET(CGERR);
     1693     6529    4                 END;
     1694     6530        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:55   
     1695     6531    3             CASE( SETACV);
     1696     6532                    %DISP(MSG="$QSVC Set access controls");
     1697     6543    3               IF STATION = SV.OFFER.STATION THEN
     1698     6544    3                SV.ACVO = BINBIT( MSG.FIELD1, 4);
     1699     6545    3               ELSE
     1700     6546    3                SV.ACVM = BINBIT( MSG.FIELD1, 4);
     1701     6547    3               GOTO ACVGO;
     1702     6548    3             CASE( GETACV);
     1703     6549                    %DISP(MSG="$QSVC Get access controls");
     1704     6560    3   ACVGO:
     1705     6561    3               IF STATION = SV.OFFER.STATION THEN
     1706     6562    3                MSG.FIELD1 = BITBIN( SV.ACVO | FLIPPED( BITBIN( SV.ACVM)));
     1707     6563    3               ELSE
     1708     6564    3                MSG.FIELD1 = BITBIN( SV.ACVM | FLIPPED( BITBIN( SV.ACVO)));
     1709     6565    3               MSG.TYPE = COMPLETED;
     1710     6566    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);
     1711     6567    3               CALL MAYNOTIFY; /* NOTIFY possible on SETACV... */
     1712     6568        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:56   
     1713     6569    3             CASE( PREREAD);
     1714     6570    3               IF SV.MATCH.NAME ~= MYID THEN
     1715     6571                     %DISP(MSG="*PreREAD*");
     1716     6582    3               CALL MAYREAD ALTRET( LEAVE);
     1717     6583    3               IF SV.MATCH.NAME = MYID THEN CALL MYLATCH;
     1718     6584    3               MSG.TYPE = COMPLETED;
     1719     6585    3               MSG.INAME = SV.DBKEY;
     1720     6586    3               MSG.FIELD1 = SV.DBSIZE;
     1721     6587    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);
     1722     6588    3             CASE( PREWRITE);
     1723     6589                    %DISP(MSG="*PreWRITE*");
     1724     6600    3               CALL MAYWRITE ALTRET( LEAVE);
     1725     6601    3               MSG.TYPE = COMPLETED;
     1726     6602    3               MSG.INAME = SV.DBKEY;
     1727     6603    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);
     1728     6604    3             CASE( SEIZE);
     1729     6605                    %DISP(MSG="*Seize*");
     1730     6616    3               CALL MAYSEIZE ALTRET( LEAVE);
     1731     6617    3               MSG.TYPE = COMPLETED;
     1732     6618    3               MSG.INAME = SV.DBKEY;
     1733     6619    3               MSG.FIELD1 = SV.DBSIZE;
     1734     6620    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);
     1735     6621
     1736     6622
     1737     6623    3             CASE(GETASM);
     1738     6624    3               IF SV.MATCH.NAME ~= MYID THEN
     1739     6625                     %DISP(MSG="$QSVS Get access state matrix");
     1740     6636    3               IF STATION = SV.OFFER.STATION
     1741     6637    3               THEN MSG.FIELD1 = BITBIN(SV.ASMO);
     1742     6638    3               ELSE MSG.FIELD1 = BITBIN(SV.ASMM);
     1743     6639    3               MSG.TYPE = COMPLETED;
     1744     6640    3               CALL M$WRITE(WRITECG@) ALTRET(CGERR);
     1745     6641        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:57   
     1746     6642    3             CASE(SIGNON);
     1747     6643                    %DISP(MSG="$QSVN Signon");
     1748     6654    3               SV$ = SVHD$;
     1749     6655    4                 DO WHILE(SV$ ~= ADDR(NIL));
     1750     6656    4                 IF SV.SCDF THEN
     1751     6657    4                  IF SV.OFFER.NAME = MSG.PARTNER1 THEN GOTO DUPL;
     1752     6658    4                  ELSE IF SV.OFFER.STATION = STATION THEN GOTO DUPL;
     1753     6659    4                 SV$ = SV.LNK$;
     1754     6660    4                 END;
     1755     6661
     1756     6662    3               IF MSG.PARTNER1 = MYID THEN GOTO DUPL;
     1757     6663    3               CALL DOSIGNON ALTRET(NOSVS);
     1758     6664    3               MSG.FIELD1 = 1;  /*  Report successful Signon */
     1759     6665    3               GOTO DONESVN;
     1760     6666    3   DUPL:
     1761     6667                    %DISP(MSG="$QSVN: Duplicate signon exists",CLASS=DEBUG);
     1762     6678    3               MSG.FIELD1 = 0;  /*  Unsuccessful Signon      */
     1763     6679    3   DONESVN:
     1764     6680    3               MSG.TYPE = COMPLETED;
     1765     6681    3               CALL M$WRITE(WRITECG@) ALTRET(CGERR);
     1766     6682        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:58   
     1767     6683    3             CASE(STATECHANGE);
     1768     6684                   /*  Access of $QSC automatically shared variable.  */
     1769     6685        /*** %DISP(MSG="$QSC: Statechange wait");  **********************/
     1770     6686    3               CALL CHECKSIGNON ALTRET(CANTWT);
     1771     6687    3               SV$ = SVHD$;
     1772     6688    4                 DO WHILE(SV$ ~= ADDR(NIL));
     1773     6689    4                 IF SV.OFFER.STATION = STATION THEN
     1774     6690    5                   DO;
     1775     6691    5                   IF SV.SCO THEN GOTO WAKUP;
     1776     6692    5                   SV.SCNO = TRUE;
     1777     6693    5                   SV.MIDO = MSG.MID;
     1778     6694    5                   END;
     1779     6695    4                 ELSE
     1780     6696    4                  IF SV.MATCH.STATION = STATION THEN
     1781     6697    5                    DO;
     1782     6698    5                    IF SV.SCM THEN GOTO WAKUP;
     1783     6699    5                    SV.SCNM = TRUE;
     1784     6700    5                    SV.MIDM = MSG.MID;
     1785     6701    5                    END;
     1786     6702    4                 SV$ = SV.LNK$;
     1787     6703    4                 END;
     1788     6704    3               GOTO LEAVE;
     1789     6705    3   WAKUP:
     1790     6706                    %DISP(MSG="$QSC: State change upon access",CLASS=DEBUG);
     1791     6717    3               CALL CLEARSC;
     1792     6718    3               MSG.FIELD1 = 1;
     1793     6719    3               GOTO SCEXIT;
     1794     6720    3   CANTWT:
     1795     6721    3               MSG.FIELD1 = 0;
     1796     6722    3   SCEXIT:
     1797     6723    3               MSG.TYPE = COMPLETED;
     1798     6724    3               CALL M$WRITE(WRITECG@) ALTRET(CGERR);
     1799     6725        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:59   
     1800     6726    3             CASE( RELEASE);
     1801     6727    3               IF SV.MATCH.NAME ~= MYID THEN
     1802     6728                     %DISP(MSG="*Releasing* Variable");
     1803     6739    3               IF MSG.FIELD1 > 0 THEN
     1804     6740    3                SV.DBSIZE = MSG.FIELD1;
     1805     6741    3               TEMP = BITBIN( SV.STATE);
     1806     6742    3               IF STATION = SV.OFFER.STATION THEN
     1807     6743    4                 DO;
     1808     6744    4                 IF SV.ASMO = '0011'B THEN
     1809     6745    5                   DO;
     1810     6746    5   WRITE:
     1811     6747    5                   IF TEMP = 6 OR TEMP = 14 THEN
     1812     6748    6                     DO;
     1813     6749    6                     SV.ASMO = '1010'B;
     1814     6750    6                     SV.ASMM = '0101'B;
     1815     6751    6                     END;
     1816     6752    5                   GOTO SETSTATE;
     1817     6753    5                   END;
     1818     6754    4                 IF SV.ASMO = '0101'B THEN
     1819     6755    5                   DO;
     1820     6756    5                   IF TEMP = 2 OR TEMP = 10 THEN
     1821     6757    6                     DO;
     1822     6758    6                     SV.ASMO = '0011'B;
     1823     6759    6                     SV.ASMM = '0011'B;
     1824     6760    6                     END;
     1825     6761    5                   GOTO WRITE;
     1826     6762    5                   END;
     1827     6763    4                 IF SV.ASMO = '1010'B THEN
     1828     6764    4                  GOTO SETSTATE;
     1829     6765                      %DISP(MSG="Release: Illegal State Transition (OFFER)",CLASS=DEBUG);
     1830     6776    4                 GOTO SNAP;
     1831     6777    4                 END;
     1832     6778    3               ELSE
     1833     6779    4                 DO;
     1834     6780    4                 IF SV.ASMM = '0011'B THEN
     1835     6781    5                   DO;
     1836     6782    5   WRITE2:
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:60   
     1837     6783    5                   IF TEMP = 5 OR TEMP = 13 THEN
     1838     6784    6                     DO;
     1839     6785    6                     SV.ASMM = '1010'B;
     1840     6786    6                     SV.ASMO = '0101'B;
     1841     6787    6                     END;
     1842     6788    5                   GOTO SETSTATE;
     1843     6789    5                   END;
     1844     6790    4                 IF SV.ASMM = '0101'B THEN
     1845     6791    5                   DO;
     1846     6792    5                   IF TEMP = 1 OR TEMP = 9 THEN
     1847     6793    6                     DO;
     1848     6794    6                     SV.ASMM = '0011'B;
     1849     6795    6                     SV.ASMO = '0011'B;
     1850     6796    6                     END;
     1851     6797    5                   GOTO WRITE2;
     1852     6798    5                   END;
     1853     6799    4                 IF SV.ASMM = '1010'B THEN
     1854     6800    4                  GOTO SETSTATE;
     1855     6801                      %DISP(MSG="Release: Illegal State Transition (MATCH)",CLASS=DEBUG);
     1856     6812    4   SNAP:         ;
     1857     6813    4                 CALL FOI$LDTRC (%S$APLSV,F_FI,M_A,INSYMNAME);
     1858     6814        /*S* SCREECH_CODE: FIA-S$APLSV
     1859     6815             TYPE:         SNAP
     1860     6816             MESSAGE:      INSYM's APLCG tables have gone bad
     1861     6817             DESCRIPTION:  This SNAP occurs when INSYM discovers an incon-
     1862     6818                           sistency in the internal tables which govern the
     1863     6819                           APL comgroup.  INSYM LDTRCs to a new copy of
     1864     6820                           himself after taking the snap.  APLCG users get
     1865     6821                           deactivated. */
     1866     6822    4                 END;
     1867     6823        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:61   
     1868     6824    3   SETSTATE:
     1869     6825    3               MSG.TYPE = COMPLETED;
     1870     6826    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);
     1871     6827    3               IF STATION = SV.OFFER.STATION THEN
     1872     6828    4                 DO;
     1873     6829    5                   DO CASE( TEMP);
     1874     6830    5                     CASE( 2, 3, 6);
     1875     6831    5                       SV.STATE = INITIAL;
     1876     6832    5                     CASE( 10, 11, 14);
     1877     6833    5                       SV.STATE = INITIAL;
     1878     6834    5                       CALL NOTIFY;
     1879     6835    5                     CASE( ELSE);
     1880     6836    5                   END;
     1881     6837    4                 SV.SCM = TRUE;
     1882     6838    4                 IF SV.SCNM THEN CALL SCNOTIFYM;
     1883     6839    4                 IF SV.MATCH.NAME = MYID THEN CALL MYRELEASE;
     1884     6840    4                 END;
     1885     6841    3               ELSE
     1886     6842    4                 DO;
     1887     6843    5                   DO CASE( TEMP);
     1888     6844    5                     CASE( 1, 5, 7);
     1889     6845    5                       SV.STATE = INITIAL;
     1890     6846    5                     CASE( 9, 13, 15);
     1891     6847    5                       SV.STATE = INITIAL;
     1892     6848    5                       CALL NOTIFY;
     1893     6849    5                     CASE( ELSE);
     1894     6850    5                   END;
     1895     6851    4                 SV.SCO = TRUE;
     1896     6852    4                 IF SV.SCNO THEN CALL SCNOTIFYO;
     1897     6853    4                 END;
     1898     6854        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:62   
     1899     6855    3             CASE( QUERY);
     1900     6856                    %DISP(MSG="$QSVQ:  Query");
     1901     6867    3               CALL CHECKSIGNON ALTRET(SHERR);
     1902     6868    3               IF MSG.PARTNER2 = ' ' THEN
     1903     6869    3                K = 20;
     1904     6870    3               ELSE
     1905     6871    3                K = 80;
     1906     6872    3               TEMP = 0;
     1907     6873    3               D$=ADDR(SPARE.DATA);                                          /*#8.369*/
     1908     6874    3               SV$=SVHD$;
     1909     6875    4                 DO WHILE (SV$ ~= ADDR(NIL));
     1910     6876    4                 IF SV.COUPLING = 1 THEN
     1911     6877    4                  IF (SV.MATCH.NAME=MSG.PARTNER1) OR (SV.MATCH.NAME=' ') OR
     1912     6878    4                  (SV.MATCH.N.UNAME=' ' AND SV.MATCH.N.ACCT=MSG.P1.ACCT) THEN
     1913     6879    5                    DO;
     1914     6880    5                    IF K = 80 THEN
     1915     6881    6                      DO;
     1916     6882    6                      IF (MSG.PARTNER2=SV.OFFER.NAME) OR
     1917     6883    6                      (MSG.P2.UNAME=' ' AND MSG.P2.ACCT=SV.OFFER.N.ACCT) THEN
     1918     6884    6                       GOTO YES;
     1919     6885    6                      GOTO NO;
     1920     6886    6                      END;
     1921     6887    5   YES:
     1922     6888    5                    IF MSG.PARTNER1 = SV.OFFER.NAME THEN
     1923     6889    5                     GOTO NO;
     1924     6890    5                    NEW$=ADDR(SPARE.DATA);                                   /*#8.369*/
     1925     6891    6                      DO WHILE( NEW$ < D$);
     1926     6892    6                      IF K = 20 THEN
     1927     6893    6                       IF NEW$ -> KBUF = SV.OFFER.NAME THEN
     1928     6894    6                        GOTO NO;
     1929     6895    6                      IF K = 80 THEN
     1930     6896    6                       IF NEW$ -> KBUF = SV.SURROGATE THEN
     1931     6897    6                        GOTO NO;
     1932     6898    6                      NEW$ = PINCRC( NEW$, K);
     1933     6899    6                      END;
     1934     6900    5                    IF K = 20 THEN
     1935     6901    5                     D$ -> KBUF = SV.OFFER.NAME;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:63   
     1936     6902    5                    ELSE
     1937     6903    6                      DO;
     1938     6904    6                      D$ -> KBUF = SV.SURROGATE;
     1939     6905    6                      IF SV.SURRLEN > TEMP THEN
     1940     6906    6                       TEMP = SV.SURRLEN;
     1941     6907    6                      END;
     1942     6908    5                    D$ = PINCRC( D$, K);
     1943     6909    5                    IF POFFW(D$,ADDR(SPARE.DATA)) > (LENGTHW(SPARE.DATA)-K/4) THEN
              6909                             /*#8.369*/
     1944     6910    5                     GOTO READY;                                             /*#8.369*/
     1945     6911    5                    END;
     1946     6912    4   NO:
     1947     6913    4                 SV$=SV$->SV.LNK$;
     1948     6914    4                 END;
     1949     6915    3   READY:      ;                                                             /*#8.369*/
     1950     6916    3               IF TEMP = 0 THEN
     1951     6917    3                MSG.FIELD2 = 20;
     1952     6918    3               ELSE
     1953     6919    3                MSG.FIELD2 = TEMP;
     1954     6920    3               TEMP=POFFW(D$,ADDR(SPARE.DATA));                              /*#8.369*/
     1955     6921    3               SPARE.SIZE = TEMP+4;
     1956     6922    3               SPARE.LENGTH1 = TEMP/(K/4);
     1957     6923    3               SPARE.LENGTH2 = K;
     1958     6924    3               K=4*SPARE.SIZE;                                               /*#8.369*/
     1959     6925    3               WRITE@.BUF_ = VECTOR( ADDR( SPARE) -> KBUF);
     1960     6926    3               WRITESVS@.BUF_ = VECTOR( ADDR(SPARE)->KBUF );
     1961     6927    3               DBKEY.VAL = SVSIGNON$->SV.DBKEY;
     1962     6928    3               IF SVSIGNON$->SV.DBKEY < %SELECTOR
     1963     6929    3               THEN CALL M$WRITE(WRITE@) ALTRET(SVERR);
     1964     6930    3               ELSE CALL M$WRITE(WRITESVS@) ALTRET(SVERR);
     1965     6931    3               SVSIGNON$->SV.DBSIZE = SPARE.SIZE;
     1966     6932    3               MSG.TYPE = COMPLETED;
     1967     6933    3               MSG.INAME = SPARE.SIZE;
     1968     6934    3               MSG.FIELD1 = SVSIGNON$->SV.DBKEY;
     1969     6935    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);
     1970     6936        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:64   
     1971     6937    3             CASE(GETDATA);
     1972     6938                /*  Transmit value of SV to SV user      */
     1973     6939    3               IF MSG.INAME = 0 THEN
     1974     6940                     %DISP(MSG="*Getdata* $QSVQ result");
     1975     6951    3               ELSE IF SV.MATCH.NAME ~= MYID THEN
     1976     6952                      %DISP(MSG="*Getdata*");
     1977     6963    3               IF MSG.INAME = 0 THEN
     1978     6964    4                 DO;
     1979     6965    4                 SV$ = SVHD$;
     1980     6966    5                   DO WHILE( SV$ ~= ADDR(NIL) );
     1981     6967    5                   IF SV.SCDF THEN
     1982     6968    5                    IF SV.OFFER.STATION = STATION THEN GOTO GOTCHA;
     1983     6969    5                   SV$ = SV.LNK$;
     1984     6970    5                   END;
     1985     6971                      %DISP(MSG="No Signon Record for $QSVQ Result",CLASS=ERROR);
     1986     6982    4   GOTCHA:
     1987     6983    4                 END;
     1988     6984    3               ELSE
     1989     6985    4                 DO;
     1990     6986    4                 K = BITBIN(SV.STATE & '0111'B);
     1991     6987    4                 IF SV.OFFER.STATION = STATION THEN
     1992     6988    5                   DO;
     1993     6989    5                   IF K < 2 OR K > 3 THEN
     1994     6990                         %DISP(MSG="*Getdata* status bad (OFFER)",CLASS=ERROR);
     1995     7001    5                   END;
     1996     7002    4                 ELSE
     1997     7003    5                   DO;
     1998     7004    5                   IF K ~= 1 AND K ~= 7 THEN
     1999     7005                         %DISP(MSG="*Getdata* status bad (MATCH)",CLASS=ERROR);
     2000     7016    5                   END;
     2001     7017    4                 END;
     2002     7018    3               IF SV.MATCH.NAME = MYID THEN CALL MYASSIGNMENT ALTRET(LEAVE);
     2003     7019    3               READSVS@.BUF_ = VECTOR(MSG.VNAME);
     2004     7020    3               IF SV.DBKEY < %SELECTOR THEN
     2005     7021                     %DISP(MSG="*Getdata* data not on * file",CLASS=ERROR);
     2006     7032    3               DBKEY.VAL  = SV.DBKEY;
     2007     7033    3               K = 0;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:65   
     2008     7034    3   GETLP:
     2009     7035    3               CALL M$READ(READSVS@) ALTRET(GETLD);
     2010     7036    3               READSVS@.V.DVBYTE.CONT# = FALSE;
     2011     7037    3               WRITECG@.V.DVBYTE.CONT# = FALSE;
     2012     7038    3               IF K = 0 THEN
     2013     7039    4                 DO;
     2014     7040    4                 K = F$SVS$->F$DCB.ARS#;
     2015     7041    4                 K = LENGTHC(MSG) - ( LENGTHC(MSG.VNAME) - K);
     2016     7042    4                 END;
     2017     7043    3               ELSE K = F$SVS$->F$DCB.ARS#;    /* Write remaining */
     2018     7044    3               WRITECG@.BUF_ = VECTOR( ADDR(MSG)->KBUF );
     2019     7045    3   GETCN:
     2020     7046    3               CALL M$WRITE(WRITECG@) ALTRET(CGERR);
     2021     7047    3               IF READSVS@.V.DVBYTE.CONT# = TRUE THEN GOTO GETLP;
     2022     7048    3               WRITECG@.BUF_ = VECTOR(MSG);
     2023     7049    3               GOTO LEAVE;
     2024     7050    3   GETLD:
     2025     7051    3               IF B$ERRCODE = %E$LD THEN
     2026     7052    4                 DO;
     2027     7053    4                 READSVS@.V.DVBYTE.CONT# = TRUE;
     2028     7054    4                 WRITECG@.V.DVBYTE.CONT# = TRUE;
     2029     7055    4                 READSVS@.BUF_ = VECTOR(MSG);
     2030     7056    4                 IF K = 0
     2031     7057    4                 THEN K = ADDR(MSG.VNAME)->ZA1_DABLK.SIZE*4 - LENGTHC(MSG.VNAME);
     2032     7058    4                 ELSE K = K - LENGTHC(MSG);
     2033     7059    4                 GOTO GETCN;
     2034     7060    4                 END;
     2035     7061    3               IF B$ERRCODE = %E$NOKEY THEN
     2036     7062    4                 DO;
     2037     7063    4                 MSG.TYPE = COMPLETED;
     2038     7064    4                 CALL M$WRITE(WRITECG@) ALTRET(CGERR);
     2039     7065    4                 GOTO LEAVE;
     2040     7066    4                 END;
     2041     7067    3               CALL M$MERC;
     2042     7068        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:66   
     2043     7069    3             CASE(PUTDATA);
     2044     7070                   /*   Recieve new SV value from CG      */
     2045     7071
     2046     7072                    %DISP(MSG="*Putdata*");
     2047     7083    3               K = BITBIN(SV.STATE & '0111'B);
     2048     7084    3               IF SV.OFFER.STATION = STATION THEN
     2049     7085    4                 DO;
     2050     7086    4                 IF K ~= 6 AND K~= 3 THEN
     2051     7087                       %DISP(MSG="*Putdata* state illegal (OFFER)",CLASS=ERROR);
     2052     7098    4                 END;
     2053     7099    3               ELSE
     2054     7100    3                IF K ~= 5 AND K~= 7 THEN
     2055     7101                      %DISP(MSG="*Putdata* state illegal (MATCH)",CLASS=ERROR);
     2056     7112
     2057     7113    3               K = ADDR(MSG.VNAME)->ZA1_DABLK.TYPE;
     2058     7114    3               IF K < 1 OR K > 5 AND K~=10 THEN
     2059     7115                     %DISP(MSG="*Putdata* Illegal Data type",CLASS=ERROR);
     2060     7126    3               K = ADDR(MSG.VNAME)->ZA1_DABLK.RANK;
     2061     7127    3               IF K > 62 THEN
     2062     7128                     %DISP(MSG="*Putdata* Illegal Rank",CLASS=ERROR);
     2063     7139    3               SV.DBSIZE = ADDR(MSG.VNAME)->ZA1_DABLK.SIZE;
     2064     7140    3               K = ADDR(MSG.VNAME)->ZA1_DABLK.SIZE*4;
     2065     7141    3               IF SV.MATCH.NAME = MYID THEN CALL HISASSIGN ALTRET(LEAVE);
     2066     7142    3               L = K;
     2067     7143    3               READCGC@.V.DVBYTE.CONT# = TRUE;
     2068     7144    3               IF FI_EVNT$->FI$EVNT.CITE$->FI$APLRD.ERRCODE = %E$LD THEN
     2069     7145    4                 DO;
     2070     7146    4                 WRITESVS@.V.DVBYTE.CONT# = TRUE;
     2071     7147    4                 WRITESVS@.BUF_ = VECTOR(MSG.VNAME);
     2072     7148    4                 END;
     2073     7149    3               ELSE
     2074     7150    4                 DO;
     2075     7151    4                 WRITESVS@.BUF_ = VECTOR(ADDR(MSG.VNAME)->KBUF);
     2076     7152    4                 WRITESVS@.V.DVBYTE.CONT# = FALSE;
     2077     7153    4                 END;
     2078     7154    3               TEMP = LENGTHC(MSG.VNAME);
     2079     7155    3               IF SV.DBKEY < %SELECTOR THEN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:67   
     2080     7156                     %DISP(MSG="*Putdata* Data not on * file",CLASS=ERROR);
     2081     7167    3               DBKEY.VAL = SV.DBKEY;
     2082     7168    3   PUTLP:
     2083     7169    3               CALL M$WRITE(WRITESVS@) ALTRET(SVERR);
     2084     7170    3               IF WRITESVS@.V.DVBYTE.CONT# = FALSE THEN GOTO LEAVE;
     2085     7171    3               L = L - TEMP;
     2086     7172    3               IF L <= 0 THEN
     2087     7173                     %DISP(MSG="*Putdata* More data written that DBSIZE",CLASS=ERROR);
     2088     7184    3               TEMP = LENGTHC(MSG);
     2089     7185    3               K = MINIMUM(LENGTHC(MSG),L);
     2090     7186    3               READCGC@.BUF_ = VECTOR( ADDR(MSG)->KBUF );
     2091     7187    3               WRITESVS@.BUF_ = READCGC@.BUF_;
     2092     7188    3               IF L = K THEN WRITESVS@.V.DVBYTE.CONT# = FALSE;
     2093     7189    3               CALL M$READ(READCGC@) ALTRET(PUTLD);
     2094     7190    3               WRITESVS@.V.DVBYTE.CONT# = FALSE;
     2095     7191    3               IF L~=K THEN
     2096     7192                     %DISP(MSG="*Putdata* Less data written than DBSIZE",CLASS=ERROR);
     2097     7203    3               GOTO PUTLP;
     2098     7204    3   PUTLD:
     2099     7205    3               IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD THEN GOTO PUTLP;
     2100     7206    3               GOTO CGERR;
     2101     7207        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:68   
     2102     7208    3             CASE( ELSE);
     2103     7209    3   RIDSTATION:
     2104     7210    3               STATIONNAME=FI_EVNT$->FI$EVNT.CITE$->FI$APLRD.NAME;
     2105     7211    3               IF STATIONNAME = 'INSYM' THEN GOTO LEAVE;
     2106     7212    3               CALL M$DEACTIVATE (DEACTIVATE_USER) ALTRET(A1);
     2107     7213    3   A1:         ;
     2108     7214    3           END; /* OF CASE( MSG.TYPE) */
     2109     7215    2   LEAVE:
     2110     7216    2         RETURN;
     2111     7217    2   CGERR:
     2112     7218    2         IF %E$LDSC = B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.CODE THEN
     2113     7219    2          RETURN;
     2114     7220    2         CALL M$MERC;
     2115     7221    2   SVERR:;
     2116     7222    2         CALL M$MERC;
     2117     7223    2   END SVPROCESSOR;
     2118     7224        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:69   
     2119     7225        /**************************************************************/
     2120     7226        /*                                                            */
     2121     7227        /*I*    NAME:       WRITEMESS                                 *
     2122     7228         *                                                            *
     2123     7229         *      PURPOSE:    To format the message to be displayed.    *
     2124     7230         *                                                            *
     2125     7231         *      DESCRIPTION: The message to be displayed is prefixed  *
     2126     7232         *                  by the current station name and the       *
     2127     7233         *                  message is written through M$DO (if       *
     2128     7234         *                  FI_DISPLAYS > 0).                         *
     2129     7235         *                                                            *
     2130     7236         **************************************************************/
     2131     7237
     2132     7238    1   WRITEMESS: PROC(STATION, MESSAGE, LEN, CLASS);
     2133     7239
     2134     7240    2   DCL  STATION  CHAR(8);
     2135     7241    2   DCL  MESSAGE  CHAR(LEN);
     2136     7242    2   DCL  LEN      UBIN;
     2137     7243    2   DCL  CLASS    SBIN;
     2138     7244    2   DCL  OLDTYPE  SBIN;
     2139     7245    2   DCL  OLDFLD1  SBIN;
     2140     7246    2   DCL  OLDINAM  SBIN;
     2141     7247    2   DCL  OLDMID   SBIN;
     2142     7248    2   DCL  STX      CHAR(8);
     2143     7249
     2144     7250        %FPT_WRITE(   FPTN     =  WRITEMSG@,
     2145     7251                      DCB      =  M$DO,
     2146     7252                      BUF      =  SPARE.BUFR,
     2147     7253                      STCLASS  =  STATIC);
     2148     7284
     2149     7285    2         SUBSTR(SPARE.BUFR,0,150) = ' ';
     2150     7286    2         SUBSTR(SPARE.BUFR,2,10)  = STATION;
     2151     7287    2         SUBSTR(SPARE.BUFR,11,2)  = '->';
     2152     7288    2         SUBSTR(SPARE.BUFR,14,130)= MESSAGE;
     2153     7289    2         WRITEMSG@.BUF_.BOUND = LEN+16;
     2154     7290    2         IF FIA_DISPLAYS>=CLASS THEN CALL M$WRITE(WRITEMSG@)ALTRET(IGNORE);
     2155     7291    2   IGNORE:
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:70   
     2156     7292    2         IF FIA_VDISPLAY>=CLASS THEN
     2157     7293    3           DO;
     2158     7294    3           WRITESVX@.BUF_ = VECTOR(SUBSTR(SPARE.BUFR,0,80));
     2159     7295    3           WRITESVX@.V.DVBYTE.CONT# = TRUE;
     2160     7296    3           IF FIA_VRECS0 <= 50 THEN
     2161     7297    4             DO;
     2162     7298    4             IF FIA_VRECS0 = 50
     2163     7299    4             THEN SUBSTR(SPARE.BUFR,,80) = '******* OVERFLOW *******';
     2164     7300    4             CALL M$WRITE(WRITESVX@) ALTRET(IGNRE);
     2165     7301    4             FIA_VRECS0 = FIA_VRECS0 + 1;
     2166     7302    4             END;
     2167     7303    3           IF BITBIN(MYSV$(0)->SV.STATE) = 8 AND MYSV$(0)->SV.MIDO>0 THEN
     2168     7304    4             DO;
     2169     7305    4             STX = STA.STATION#;
     2170     7306    4             STA.STATION# = MYSV$(0)->SV.OFFER.STATION;
     2171     7307    4             OLDMID = MSG.MID;
     2172     7308    4             OLDTYPE= MSG.TYPE;
     2173     7309    4             OLDFLD1= MSG.FIELD1;
     2174     7310    4             OLDINAM= MSG.INAME;
     2175     7311
     2176     7312    4             MSG.TYPE = COMPLETED;
     2177     7313    4             MSG.MID  = MYSV$(0)->SV.MIDO;
     2178     7314    4             MSG.FIELD1 = 1;
     2179     7315    4             MSG.INAMER = MYSV$(0);
     2180     7316    4             CALL M$WRITE(WRITECG@) ALTRET(IGNO);
     2181     7317    4   IGNO:
     2182     7318    4             STA.STATION# = STX;
     2183     7319    4             MSG.MID      = OLDMID;
     2184     7320    4             MSG.TYPE     = OLDTYPE;
     2185     7321    4             MSG.FIELD1   = OLDFLD1;
     2186     7322    4             MSG.INAME    = OLDINAM;
     2187     7323
     2188     7324    4             MYSV$(0)->SV.STATE.N = '0'B;
     2189     7325    4             MYSV$(0)->SV.MIDO    = 0;
     2190     7326    4             END;
     2191     7327
     2192     7328    3           IF BITBIN(MYSV$(0)->SV.STATE & '0111'B) = 0 THEN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:71   
     2193     7329    4             DO;
     2194     7330    4             MYSV$(0)->SV.ASMM = '1010'B;
     2195     7331    4             MYSV$(0)->SV.ASMO = '0101'B;
     2196     7332    4             END;
     2197     7333    3           END;
     2198     7334    2   IGNRE:
     2199     7335    2         RETURN;
     2200     7336    2   END WRITEMESS;
     2201     7337        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:72   
     2202     7338    1   MYOFFER: PROC;
     2203     7339    2   DCL  I     SBIN;
     2204     7340
     2205     7341    3           DO I = 0 TO %MYVARS;
     2206     7342    3           IF SV.SURROGATE = MYVARS(I) THEN GOTO GOTV;
     2207     7343    3           END;
     2208     7344    2         RETURN;
     2209     7345    2   GOTV:
     2210     7346    2         IF MYSV$(I) ~= ADDR(NIL) THEN RETURN;
     2211     7347    2         MYSV$(I) = SV$;
     2212     7348    2         SV.COUPLING = 2;
     2213     7349    2         SV.MATCH.NAME = MYID;
     2214     7350    2         SV.MATCH.STATION = 'APLSVP';
     2215     7351    2         SV.ACVM = INITIAL;
     2216     7352    2         SV.SCO = TRUE;
     2217     7353    2         IF SV.DBKEY < %SELECTOR THEN SV.DBKEY = SV.DBKEY + %SELECTOR;
     2218     7354
     2219     7355    3           DO CASE(I);
     2220     7356    3             CASE(0);
     2221     7357    3               FIA_VDISPLAY = 3;
     2222     7358    3               FIA_VRECS0   = 0;
     2223     7359    3               FIA_VRECS1   = 0;
     2224     7360    3               CALL COMPUTE_DISPLAY;
     2225     7361    3               WRITESVX@.BUF_ = VECTOR(LOG_HEADER);
     2226     7362    3               WRITESVX@.V.DVBYTE.CONT# = TRUE;
     2227     7363    3               CALL M$WRITE(WRITESVX@) ALTRET(IG);
     2228     7364    3   IG:
     2229     7365    3           END;
     2230     7366    2   DONE:
     2231     7367    2         RETURN;
     2232     7368    2   END MYOFFER;
     2233     7369        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:73   
     2234     7370    1   MYRETRACT: PROC;
     2235     7371    2   DCL  I     SBIN;
     2236     7372
     2237     7373    3           DO I = 0 TO %MYVARS;
     2238     7374    3           IF SV.SURROGATE = MYVARS(I) THEN GOTO GOTV;
     2239     7375    3           END;
     2240     7376    2         RETURN;
     2241     7377    2   GOTV:
     2242     7378    2         IF MYSV$(I) ~= SV$ THEN RETURN;
     2243     7379    2         MYSV$(I) = ADDR(NIL);
     2244     7380    2         CALL SVDELINK;
     2245     7381    2         SVX$ = SV$;
     2246     7382    2         CALL FOI$RBUF(SVSCB,SVX$);
     2247     7383
     2248     7384    3           DO CASE(I);
     2249     7385    3             CASE(0);
     2250     7386    3               FIA_VDISPLAY = 0;
     2251     7387    3               CALL COMPUTE_DISPLAY;
     2252     7388    3               WRITESVX@.BUF_ = VECTOR(NIL);
     2253     7389    3               WRITESVX@.V.DVBYTE.CONT# = FALSE;
     2254     7390    3               CALL M$WRITE(WRITESVX@) ALTRET(IGN);
     2255     7391    3   IGN:
     2256     7392    3           END;
     2257     7393    2   DONE:
     2258     7394    2         RETURN;
     2259     7395    2   END MYRETRACT;
     2260     7396        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:74   
     2261     7397    1   HISASSIGN: PROC ALTRET;
     2262     7398    2   DCL  I  SBIN;
     2263     7399
     2264     7400    2         CALL MYLOOKUP(I) ALTRET(DONE);
     2265     7401    3           DO CASE(I);
     2266     7402    3             CASE(0);
     2267     7403    3               IF ADDR(MSG.VNAME)->ZA1_DABLK.TYPE ~= 3 THEN ALTRETURN;
     2268     7404    4                 DO CASE( ADDR(MSG.VNAME)->ZA1_DABLK.RANK );
     2269     7405    4                   CASE(0);
     2270     7406    4                     L = ADDR(MSG.VNAME)->ZA1_DABLK.LENGTHS(0);
     2271     7407    4                   CASE(1);
     2272     7408    4                     L = ADDR(MSG.VNAME)->ZA1_DABLK.LENGTHS(0);
     2273     7409    4                     IF L ~= 1 THEN RETURN;
     2274     7410    4                     L = ADDR(MSG.VNAME)->ZA1_DABLK.LENGTHS(1);
     2275     7411    4                   CASE(ELSE);
     2276     7412    4                     RETURN;
     2277     7413    4                 END;
     2278     7414    3               IF L < 0 THEN L = 0;
     2279     7415    3               IF L > 3 THEN L = 3;
     2280     7416    3               FIA_VDISPLAY = L;
     2281     7417    3               CALL COMPUTE_DISPLAY;
     2282     7418    3               ALTRETURN;
     2283     7419    3           END;
     2284     7420    2   DONE:
     2285     7421    2         RETURN;
     2286     7422    2   END HISASSIGN;
     2287     7423        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:75   
     2288     7424    1   MYASSIGNMENT: PROC ALTRET;
     2289     7425    2   DCL  I  SBIN;
     2290     7426
     2291     7427    2         CALL MYLOOKUP(I) ALTRET(DONE);
     2292     7428    3           DO CASE(I);
     2293     7429    3             CASE(0); ;
     2294     7430    3           END;  /*** Of my variable case      ***/
     2295     7431    2   DONE:
     2296     7432    2         RETURN;
     2297     7433    2   END MYASSIGNMENT;
     2298     7434        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:76   
     2299     7435    1   MYLATCH: PROC;
     2300     7436    2   DCL  I     SBIN;
     2301     7437    2   DCL  FIRST SBIN;
     2302     7438
     2303     7439    2         CALL MYLOOKUP(I) ALTRET(DONE);
     2304     7440    3           DO CASE(I);
     2305     7441    3             CASE(0);
     2306     7442    3               WRITESVX@.BUF_ = VECTOR(NIL);
     2307     7443    3               WRITESVX@.V.DVBYTE.CONT# = FALSE;
     2308     7444    3               CALL M$WRITE(WRITESVX@) ALTRET(IGNOR);
     2309     7445    3   IGNOR:
     2310     7446    3               FIA_VRECS1 = FIA_VRECS0;
     2311     7447
     2312     7448    3               DBKEY.VAL = SV.DBKEY;
     2313     7449    3               WRITESVS@.V.DVBYTE.CONT# = FALSE;
     2314     7450    3               READSVX@.V.DVBYTE.CONT# = FALSE;
     2315     7451    3               READSVX@.BUF_ = VECTOR(SPARE.BUFR);
     2316     7452    3               FIRST = 0;
     2317     7453    3   COPYLP:
     2318     7454    3               CALL M$READ(READSVX@) ALTRET(CHKLD);
     2319     7455    3               READSVX@.V.DVBYTE.CONT# = FALSE;
     2320     7456    3               WRITESVS@.V.DVBYTE.CONT# = FALSE;
     2321     7457    3   CONT:
     2322     7458    3               IF FIRST = 0 THEN
     2323     7459    4                 DO;
     2324     7460    4                 ADDR(SPARE.BUFR)->ZA1_DABLK.SIZE = 4+FIA_VRECS1*20;
     2325     7461    4                 ADDR(SPARE.BUFR)->ZA1_DABLK.LENGTHS(0) = FIA_VRECS1;
     2326     7462    4                 FIRST = 1;
     2327     7463    4                 END;
     2328     7464    3               K = F$SVX$->F$DCB.ARS#;
     2329     7465    3               WRITESVS@.BUF_ = VECTOR( ADDR(SPARE.BUFR)->KBUF );
     2330     7466    3               CALL M$WRITE(WRITESVS@) ALTRET(HMMERR);
     2331     7467    3   HMMERR:
     2332     7468    3               IF WRITESVS@.V.DVBYTE.CONT# = TRUE THEN GOTO COPYLP;
     2333     7469    3   ENDLOG:
     2334     7470    3               FIA_VRECS0 = 0;
     2335     7471    3               WRITESVX@.BUF_ = VECTOR(LOG_HEADER);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:77   
     2336     7472    3               WRITESVX@.V.DVBYTE.CONT# = TRUE;
     2337     7473    3               CALL M$WRITE(WRITESVX@) ALTRET(IGNR);
     2338     7474    3   IGNR:
     2339     7475    3               SV.DBSIZE = 4 + FIA_VRECS1*20;
     2340     7476
     2341     7477
     2342     7478
     2343     7479    3             CASE(1);
     2344     7480
     2345     7481    3               K = (4*4) + 0;
     2346     7482    3               D$ = SVHD$;
     2347     7483
     2348     7484    4                 DO WHILE(D$ ~= ADDR(NIL));
     2349     7485
     2350     7486    4                 SUBSTR(SPARE.BUFR,K,2) = BINASC(D$->SV.COUPLING+ASCBIN('0'));
     2351     7487    4                 SUBSTR(SPARE.BUFR,K+2,21) = D$->SV.OFFER.NAME;
     2352     7488    4                 SUBSTR(SPARE.BUFR,K+23,21) = D$->SV.MATCH.NAME;
     2353     7489    4                 SUBSTR(SPARE.BUFR,K+44,84) = D$->SV.SURROGATE;
     2354     7490    4                 K = K+128;
     2355     7491    4                 D$ = D$->SV.LNK$;
     2356     7492    4                 IF K+128>LENGTHC(SPARE.BUFR) AND D$~= ADDR(NIL) THEN
     2357     7493    5                   DO;
     2358     7494    5                   SUBSTR(SPARE.BUFR,K-128,128) = '** Overflow **';
     2359     7495    5                   GOTO FIN;
     2360     7496    5                   END;
     2361     7497
     2362     7498    4                 END;
     2363     7499    3   FIN:
     2364     7500    3               ADDR(SPARE.BUFR)->ZA1_DABLK.LENGTHS(0) = K / 128;
     2365     7501    3               ADDR(SPARE.BUFR)->ZA1_DABLK.TYPE = 2;
     2366     7502    3               ADDR(SPARE.BUFR)->ZA1_DABLK.RANK = 2;
     2367     7503    3               ADDR(SPARE.BUFR)->ZA1_DABLK.SIZE = K / 4;
     2368     7504    3               SV.DBSIZE = ADDR(SPARE.BUFR)->ZA1_DABLK.SIZE;
     2369     7505    3               ADDR(SPARE.BUFR)->ZA1_DABLK.LENGTHS(1) = 128;
     2370     7506    3               WRITESVS@.V.DVBYTE.CONT# = FALSE;
     2371     7507    3               WRITESVS@.BUF_ = VECTOR( ADDR(SPARE.BUFR)->KBUF );
     2372     7508    3               DBKEY.VAL = SV.DBKEY;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:78   
     2373     7509    3               CALL M$WRITE(WRITESVS@) ALTRET(IGIT);
     2374     7510    3   IGIT:
     2375     7511    3           END;
     2376     7512    2   DONE:
     2377     7513    2         RETURN;
     2378     7514    2   CHKLD:
     2379     7515    2         IF %E$LD = B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE THEN
     2380     7516    3           DO;
     2381     7517    3           READSVX@.V.DVBYTE.CONT# = TRUE;
     2382     7518    3           WRITESVS@.V.DVBYTE.CONT# = TRUE;
     2383     7519    3           GOTO CONT;
     2384     7520    3           END;
     2385     7521    2         WRITESVS@.BUF_ = VECTOR(NIL);
     2386     7522    2         WRITESVS@.V.DVBYTE.CONT# = FALSE;
     2387     7523    2         IF FIRST ~= 0 THEN CALL M$WRITE(WRITESVS@) ALTRET(ENDLOG);
     2388     7524    2         GOTO ENDLOG;
     2389     7525    2   END MYLATCH;
     2390     7526        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:79   
     2391     7527    1   MYRELEASE: PROC;
     2392     7528    2   DCL  I     SBIN;
     2393     7529
     2394     7530    2         CALL MYLOOKUP(I) ALTRET(DONE);
     2395     7531    3           DO CASE(I);
     2396     7532    3             CASE(0);
     2397     7533    3               SV.ASMM = '0011'B;
     2398     7534    3               SV.ASMO = '0011'B;
     2399     7535    3               IF FIA_VRECS0 > 0 THEN
     2400     7536    4                 DO;
     2401     7537    4                 SV.ASMM = '1010'B;
     2402     7538    4                 SV.ASMO = '0101'B;
     2403     7539    4                 END;
     2404     7540    3           END;
     2405     7541    2   DONE:
     2406     7542    2         RETURN;
     2407     7543    2   END MYRELEASE;
     2408     7544        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:80   
     2409     7545    1   MYLOOKUP: PROC(NUM) ALTRET;
     2410     7546    2   DCL  NUM   SBIN;
     2411     7547    2   DCL  I     SBIN;
     2412     7548
     2413     7549    3           DO I = 0 TO %MYVARS;
     2414     7550    3           IF SV.SURROGATE = MYVARS(I) THEN GOTO GOTV;
     2415     7551    3           END;
     2416     7552    2         ALTRETURN;
     2417     7553    2   GOTV:
     2418     7554    2         IF SV$ ~= MYSV$(I) THEN ALTRETURN;
     2419     7555    2         IF SV.COUPLING ~= 2 THEN ALTRETURN;
     2420     7556    2         NUM = I;
     2421     7557    2         RETURN;
     2422     7558    2   END MYLOOKUP;
     2423     7559
     2424     7560
     2425     7561
     2426     7562    1   COMPUTE_DISPLAY: PROC;
     2427     7563
     2428     7564    2         DISPLAYS = FIA_VDISPLAY;
     2429     7565    2         IF FIA_DISPLAYS > 0 THEN
     2430     7566    2          IF FIA_VDISPLAY = 0
     2431     7567    2          THEN DISPLAYS = FIA_DISPLAYS;
     2432     7568    2          ELSE DISPLAYS = MINIMUM(FIA_DISPLAYS,FIA_VDISPLAY);
     2433     7569    2         RETURN;
     2434     7570    2   END COMPUTE_DISPLAY;
     2435     7571        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:81   
     2436     7572    1   END FIA$APL;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:82   
--  Include file information  --

   FI_SCODE_C.:E05TOU  is referenced.
   FI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   FOO_MAC_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FI_MAC_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   FI_SUBS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FIA$APL.

   Procedure FIA$APL requires 3328 words for executable code.
   Procedure FIA$APL requires 30 words of local(AUTO) storage.

    No errors detected in file FIA$APL.:E05TSI    .

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:83   

 Object Unit name= FIA$APL                                    File name= FIA$APL.:E05TOU
 UTS= JUL 29 '97 15:25:19.68 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none  1036   2014  FIA$APL
    2  RoData even  UTS    741   1345  FIA$APL
    3   DCB   even  none     0      0  M$APLCG
    4   DCB   even  none     0      0  F$SV
    5   DCB   even  none     0      0  F$SVS
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  F$SVX
    8   Proc  even  none  3328   6400  FIA$APL
    9  RoData even  none   167    247  FIA$APL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     8      0   yes            yes      Std        0  FIA$APL
     8      3                  yes      Std        0  FIA$INIT
     8    120                  yes      Std        0  FIA$APLRD
     8    125                  yes      Std        0  FIA$ZAP
     8    144                  yes      Std        0  FIA$APLAU

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    2     52  FIA_DISPLAYS
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:84   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 FOI$RBUF
 yes     yes           Std       2 FOI$GBUF
 yes     yes           Std       4 FOI$LDTRC
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  FI_CSCGBUF                            FI_EVNT$
     FI_SYSACCT                            M$APLCG                               F$SV
     F$SVS                                 M$DO                                  F$SVX
     B$TCB$                                FI_APLCGBUF                           B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:85   


        1        1        /*M* FIA$APL APLCG administrator in the INSYM ghost */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         FIA$APL
       10       10
       11       11             PURPOSE:      To provide support for the APLCG
       12       12
       13       13             DESCRIPTION:  The system ghost INSYM (in the person of FIA$APL)
       14       14                           is responsible for the administration of the APLCG
       15       15                           which provides shared variable capabilities to
       16       16                           APL users.
       17       17
       18       18                           The major entry points are:
       19       19
       20       20                               o  FIA$INIT
       21       21
       22       22                                  This routine is called at INSYM's startup
       23       23                                  time to open up the APLCG comgroup and
       24       24                                  shared variable datafile.
       25       25
       26       26                               o  FIA$APLAU
       27       27
       28       28                                  This is called whenever a comgroup
       29       29                                  administrative event occurs.  Comgroup
       30       30                                  connects, disconnects and warnings are
       31       31                                  handled.
       32       32
       33       33                                  When a connect event occurs, the connecting
       34       34                                  station is informed of the version of the
       35       35                                  shared variable processor in the VNAME
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:86   
       36       36                                  field of the message.  The message
       37       37                                  identifier for this message is -1.
       38       38
       39       39                                  When a disconnect occurs, all of the
       40       40                                  variables shared by this user are retracted
       41       41                                  and the associated partners activated if
       42       42                                  they are awaiting access.
       43       43
       44       44                                  When a comgroup warning occurs, the comgroup
       45       45                                  size is extended by %FIMI_CXMP#.
       46       46
       47       47                               o  FIA$APLRD
       48       48
       49       49                                  This routine processes all reads from the
       50       50                                  connected comgroup stations.  The routine
       51       51                                  SVPROCESSOR is called to process the
       52       52                                  message.
       53       53
       54       54                               o  FIA$ZAP
       55       55
       56       56                                  Provides for an orderly shutdown of the
       57       57                                  shared variable processor.  The comgroup
       58       58                                  and shared variable database are then
       59       59                                  closed and released.
       60       60        */
       61       61        /**/
       62       62        FIA$APL: PROC;

     62  8 000000   000000 700200 xent  FIA$APL      TSX0  ! X66_AUTO_0
         8 000001   000036 000000                    ZERO    30,0
         8 000002   000005 710000 8                  TRA     s:5284

       63       63        /**/
       64       64
       65       65
       66       66
       67       67        /**/
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:87   
       68       68        /* INCLUDES */
       69       69        /**/
       70       70        %INCLUDE CP_6;
       71      151        %INCLUDE CP_6_SUBS;
       72      691        %INCLUDE JG_EVID_C;
       73      916        %INCLUDE FI_SUBS_C;
       74     1018 S      %INCLUDE B$JIT_C;
       75     1019        %INCLUDE JG_GHOSTS_C;
       76     1109        %INCLUDE FI_MAC_C;
       77     1479        %INCLUDE F_ERRORS_C;
       78     1719        %INCLUDE KC_SUBS_C;
       79     1735        %INCLUDE KC_ERRORS_C;
       80     1782        %INCLUDE FOO_MAC_C;
       81     2530        %INCLUDE B$ROSEG;
       82     2593        %INCLUDE FI_DATA_R;
       83     2859        %INCLUDE FI_SCODE_C;
       84     2876
       85     2877
       86     2878
       87     2879        /**/
       88     2880        /* BASED STRUCTURES */
       89     2881        /**/
       90     2882        %FI_SV (FPTN=FI$SV,STCLASS=BASED);
       91     2934        %B$TCB (STCLASS=BASED);
       92     2937        %B$ALT (STCLASS=BASED);
       93     2945        %F$DCB;
       94     3002        %FI_EVNT   (FPTN=FI$EVNT   ,STCLASS=BASED);
       95     3065    1   DCL KBUF CHAR( K) BASED CALIGNED;
       96     3066    1   DCL HBIN( 0: 0) UBIN( 18) BASED HALIGNED;
       97     3067    1   DCL INTG( 0: 0) SBIN BASED ALIGNED;
       98     3068        %B$CGAURD (FPTN=B$CGAURD,LAST=",");
       99     3087        %B$CGAUCI (FPTN=CONINFO,LVL=2,LAST=",");
      100     3109        %FI_CONINFO (FPTN=FIINFO,LVL=2,STCLASS=BASED);
      101     3153        %FI_CITE (FPTN=FI$APLRD,TYP=CGRD,STCLASS=BASED);
      102     3197
      103     3198    1   DCL 1  ZA1_DABLK   BASED ALIGNED,
      104     3199    1         2  TYPE     UBIN(9)  UNAL,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:88   
      105     3200    1         2  RANK     UBIN(9)  UNAL,
      106     3201    1         2  SIZE     UBIN(18) HALIGNED,
      107     3202    1         2  REF      SBIN     ALIGNED,
      108     3203    1         2  LENGTHS(0:0) SBIN ALIGNED;
      109     3204
      110     3205
      111     3206
      112     3207        /**/
      113     3208        /* AUTO */
      114     3209        /**/
      115     3210    1   DCL I UBIN WORD;
      116     3211    1   DCL LPAR$ PTR;
      117     3212    1   DCL CGAURD$ PTR;
      118     3213
      119     3214
      120     3215
      121     3216        /**/
      122     3217        /* STATIC */
      123     3218        /**/
      124     3219    1   DCL M$APLCG$ PTR STATIC;
      125     3220    1   DCL F$SV$ PTR STATIC;
      126     3221    1   DCL F$SVS$ PTR STATIC;
      127     3222    1   DCL F$SVX$ PTR STATIC;
      128     3223    1   DCL 1 SPARE STATIC ALIGNED,
      129     3224    1         2 * UBIN( 9) INIT( 2) UNAL, /* Datablock type */
      130     3225    1         2 * UBIN( 9) INIT( 2) UNAL, /* Datablock rank */
      131     3226    1         2 SIZE UBIN( 18) INIT( 0) UNAL, /* Datablock size */
      132     3227    1         2 * UBIN INIT( 1) ALIGNED, /* Ref count */
      133     3228    1         2 LENGTH1 UBIN INIT( 0) ALIGNED, /* num. rows */
      134     3229    1         2 LENGTH2 UBIN INIT( 0) ALIGNED, /* num. cols */
      135     3230    1         2 DATA(0:719) UBIN INIT(720*0) ALIGNED,
      136     3231    1         2 BUFR  REDEF DATA CHAR(2880);
      137     3232    1   DCL STATION CHAR(8) STATIC;
      138     3233        %VLP_STATION (FPTN=STA,STCLASS=STATIC);
      139     3260    1   DCL NEW$ PTR STATIC;
      140     3261    1   DCL MASK BIT( 4) STATIC UNAL;
      141     3262    1   DCL BMASK( 0: 3) REDEF MASK BIT( 1) UNAL;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:89   
      142     3263    1   DCL KEYVAL UBIN STATIC INIT(1);
      143     3264    1   DCL TEMP SBIN STATIC;
      144     3265    1   DCL K$ PTR STATIC;
      145     3266    1   DCL K SBIN STATIC;
      146     3267    1   DCL L SBIN;
      147     3268    1   DCL STATIONNAME CHAR(8) STATIC DALIGNED;
      148     3269    1   DCL D$ PTR STATIC;
      149     3270    1   DCL 1 DBKEY STATIC ALIGNED,
      150     3271    1         2 C UBIN( 9) INIT( 3) UNAL,
      151     3272    1         2 VAL UBIN( 27) UNAL;
      152     3273    1   DCL 1  DBKEY2   STATIC ALIGNED,
      153     3274    1         2  *  UBIN(9)   UNAL INIT(3),
      154     3275    1         2  VAL UBIN(27) UNAL INIT(0);
      155     3276    1   DCL FLIPPED( 0: 15) BIT( 4) CONSTANT INIT(
      156     3277    1      '0000'B, '0010'B, '0001'B, '0011'B,
      157     3278    1      '1000'B, '1010'B, '1001'B, '1011'B,
      158     3279    1      '0100'B, '0110'B, '0101'B, '0111'B,
      159     3280    1      '1100'B, '1110'B, '1101'B, '1111'B);
      160     3281    1   DCL SV$ PTR STATIC;
      161     3282    1   DCL SVX$ PTR STATIC;
      162     3283    1   DCL SVSIGNON$ PTR STATIC;
      163     3284        %FI_SV (FPTN=SV_INIT,STCLASS=CONSTANT);
      164     3336        %FO_SCB                                (FPTN=SVSCB,
      165     3337                 SEG       = FISN_APL#,
      166     3338                 FSIZ      ="SIZEW(FI$SV)",
      167     3339                 MAP       = NO,
      168     3340                 NPG       = 1,
      169     3341                 STCLASS   = STATIC);
      170     3371    1   DCL SVHD$ PTR STATIC ALIGNED INIT(ADDR(NIL));
      171     3372    1   DCL SVTL$ PTR STATIC ALIGNED INIT(ADDR(NIL));
      172     3373    1   DCL INSYMNAME CHAR(8) STATIC INIT('INSYM');
      173     3374        /*B*    NAME:    FIA_DISPLAYS
      174     3375
      175     3376                PURPOSE: To control outputting of shared variable information
      176     3377                         used while debugging the shared variable processor.
      177     3378
      178     3379                DESCRIPTION:
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:90   
      179     3380                         This cell is normally set to zero resulting in NO
      180     3381                         displays.  Usefull values are:
      181     3382                            (1)   Only Error Conditions
      182     3383                            (2)   Debugging Information
      183     3384                            (3)   Generally everything happening.
      184     3385                         A setting of FIA_DISPLAYS causes all messages up to
      185     3386                         and including the current value to be displayed.
      186     3387                                                                            */
      187     3388    1   DCL FIA_DISPLAYS SBIN CONSTANT SYMDEF INIT(0);
      188     3389    1   DCL DISPLAYS     SBIN STATIC   INIT(0);
      189     3390    1   DCL FIA_VDISPLAY SBIN STATIC   INIT(0);
      190     3391
      191     3392    1   DCL 1  LOG_HEADER  CONSTANT ALIGNED,
      192     3393    1         2  *        UBIN(9)  CALIGNED INIT(2),
      193     3394    1         2  *        UBIN(9)  CALIGNED INIT(2),
      194     3395    1         2  *        UBIN(18) HALIGNED INIT(4),
      195     3396    1         2  *        SBIN     ALIGNED  INIT(1),
      196     3397    1         2  *        SBIN     ALIGNED  INIT(0),
      197     3398    1         2  *        SBIN     ALIGNED  INIT(80);
      198     3399
      199     3400    1   DCL 1  SVXKEY      STATIC   ALIGNED,
      200     3401    1         2  *        UBIN(9)  CALIGNED INIT(3),
      201     3402    1         2  VAL      UBIN(27) CALIGNED INIT(0);
      202     3403
      203     3404    1   DCL  FIA_VRECS0     SBIN     STATIC;
      204     3405    1   DCL  FIA_VRECS1     SBIN     STATIC;
      205     3406
      206     3407        %SET MYVARS=2;
      207     3408
      208     3409    1   DCL  MYVARS(0:%MYVARS) CHAR(20) CONSTANT
      209     3410    1           INIT('LOG',
      210     3411    1                'SV',
      211     3412    1                ' '*0);
      212     3413
      213     3414    1   DCL  MYSV$(0:%MYVARS)  PTR STATIC
      214     3415    1           INIT( ADDR(NIL)*0 );
      215     3416
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:91   
      216     3417    1   DCL  MYID  CHAR(20) CONSTANT INIT('APLSVP.:SYS');
      217     3418
      218     3419    1   DCL  NEWSTATES(0:7)   BIT(4)  CONSTANT  ALIGNED INIT(
      219     3420    1                 /* 'X000'B  */    '0000'B,
      220     3421    1                 /* 'X001'B  */    '0010'B,
      221     3422    1                 /* 'X010'B  */    '0000'B,
      222     3423    1                 /* 'X011'B  */    '0000'B,
      223     3424    1                 /* 'X100'B  */    '0000'B,
      224     3425    1                 /* 'X101'B  */    '0110'B,
      225     3426    1                 /* 'X110'B  */    '0000'B,
      226     3427    1                 /* 'X111'B  */    '0011'B);
      227     3428
      228     3429        /*   NEWSTATES is used to correct the state for the
      229     3430             offer'ers retract of a shared variable when the
      230     3431             coupling is 2.
      231     3432                                                                */
      232     3433
      233     3434
      234     3435
      235     3436
      236     3437        /**/
      237     3438        /* CONSTANT */
      238     3439        /**/
      239     3440        %VLP_STATION                          (FPTN=DACTALL,
      240     3441                 STATION   = '?',
      241     3442                 ALLTRMS   = YES,
      242     3443                 ALLDCBS   = YES,
      243     3444                 STCLASS   = CONSTANT);
      244     3471
      245     3472
      246     3473
      247     3474        /**/
      248     3475        /* DCBS */
      249     3476        /**/
      250     3477    1   DCL M$APLCG DCB;
      251     3478    1   DCL F$SV DCB;
      252     3479    1   DCL  F$SVS DCB;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:92   
      253     3480    1   DCL  M$DO DCB;
      254     3481    1   DCL  F$SVX DCB;
      255     3482
      256     3483
      257     3484
      258     3485        /**/
      259     3486        /* REFS */
      260     3487        /**/
      261     3488    1   DCL B$TCB$ PTR SYMREF;
      262     3489    1   DCL FOI$LDTRC ENTRY(4) ALTRET;
      263     3490    1   DCL FOI$GBUF ENTRY(2) ALTRET;
      264     3491    1   DCL FOI$RBUF ENTRY(2) ALTRET;
      265     3492        %FI_APLMSG (FPTN=FI_APLCGBUF,STCLASS=SYMREF);
      266     3522        %FI_APLMSG (FPTN=MSG        ,STCLASS="REDEF FI_APLCGBUF");
      267     3552
      268     3553
      269     3554
      270     3555        /**/
      271     3556        /* PMME FPTS */
      272     3557        /**/
      273     3558        %FPT_OPEN                              (FPTN=OPENCG@,
      274     3559                 DCB       = M$APLCG,
      275     3560                 SHARE     = ALL,
      276     3561                 SCRUB     = YES,
      277     3562                 CTG       = YES,
      278     3563                 IXTNSIZE  = %FIMI_CIXT#,
      279     3564                 AU        = YES,
      280     3565                 NAME      = APLCGNAME,
      281     3566                 ACCT      = FI_SYSACCT,
      282     3567                 SETSTA    = MYAPLCGSETSTA,
      283     3568                 ASN       = COMGROUP,
      284     3569                 ORG       = CONSEC,
      285     3570                 FUN       = CREATE,
      286     3571                 EXIST     = OLDFILE,
      287     3572                 ACCESS    = ATTRCG@,
      288     3573                 ACSVEH    = ACSV@,
      289     3574                 STCLASS   = STATIC);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:93   
      290     3683        %VLP_SETSTA                           (FPTN=MYAPLCGSETSTA,
      291     3684                 MYSTATION = 'INSYM',
      292     3685                 STCLASS   = CONSTANT);
      293     3713        %VLP_SETSTA                           (FPTN=APLCGSETSTA,
      294     3714                 OSTATION  = 'INSYM',
      295     3715                 STCLASS   = CONSTANT);
      296     3743        %FPT_CGCTL                            (FPTN=APLCGCTL,
      297     3744                 DCB       = M$APLCG,
      298     3745                 CGCP      = APLCGCP,
      299     3746                 SETSTA    = APLCGSETSTA,
      300     3747                 STCLASS   = CONSTANT);
      301     3770        %VLP_CGCP                             (FPTN=APLCGCP,
      302     3771                 TMTYP     = ' ',
      303     3772                 DMTYP     = ' ',
      304     3773                 MAXPG     = %FIMI_CIMP#,
      305     3774                 DISKWARN  = %FIMI_CXMP#,
      306     3775                 MEMWARN   = %FIMI_CXMP#,
      307     3776                 DATAPGS   =10,
      308     3777                 CONMSG    = YES,
      309     3778                 TERMCONAU = NO,
      310     3779                 DCBCONAU  = YES,
      311     3780                 TERMCONNAU= NO,
      312     3781                 DCBCONNAU = YES,
      313     3782                 AUCONTERM = NC,
      314     3783                 AUCONDCB  = NC,
      315     3784                 AUDCONTERM= NC,
      316     3785                 AUDCONDCB = DEACTIVATE,
      317     3786                 XSTALGL   = YES,
      318     3787                 WAS       = NO,
      319     3788                 RAS       = NO,
      320     3789                 SMD       = NO,
      321     3790                 XTYPLGL   = YES,
      322     3791                 MAXMC     = 1024,
      323     3792                 TERMCONLGL= NO,
      324     3793                 DCBCONLGL = YES,
      325     3794                 INPUT     = NO,
      326     3795                 OUTPUT    = NO,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:94   
      327     3796                 SECURE    = NO,
      328     3797                 STCLASS   = STATIC);
      329     3840        %VLP_NAME                              (FPTN=APLCGNAME,
      330     3841                 NAME      = 'APLCG',
      331     3842                 STCLASS   = CONSTANT);
      332     3869        %FPT_EXTEND                           (FPTN=EXTEND_APLCG,
      333     3870                 DCB       = M$APLCG,
      334     3871                 SIZ       = %FIMI_CXXT#,
      335     3872                 STCLASS   = CONSTANT);
      336     3886        %FPT_CLOSE                            (FPTN=CLOSECG,
      337     3887                 DCB       = M$APLCG,
      338     3888                 DISP      = RELEASE,
      339     3889                 STCLASS   = CONSTANT);
      340     3931        %FPT_CLOSE                            (FPTN=CLOSEPOOL,
      341     3932                 DCB       = F$SV,
      342     3933                 DISP      = RELEASE,
      343     3934                 STCLASS   = CONSTANT);
      344     3976        %VLP_NAME                              (FPTN=POOLFILENAME,
      345     3977                 NAME      = ':ZASV',
      346     3978                 STCLASS   = CONSTANT);
      347     4005        %VLP_ATTR                              (FPTN=ATTRCG@);
      348     4019        %VLP_ACCESS                            (STCLASS=CONSTANT,
      349     4020                 READ      = YES,
      350     4021                 UPD       = YES,
      351     4022                 WNEW      = YES,
      352     4023                 DELR      = YES,
      353     4024                 DELF      = YES,
      354     4025                 REATTR    = YES,
      355     4026                 ACCT      = ':SYS',
      356     4027                 LAST      = ",");
      357     4044        %VLP_ACCESS                            (STCLASS=CONSTANT,
      358     4045                 READ      = YES,
      359     4046                 UPD       = YES,
      360     4047                 WNEW      = YES,
      361     4048                 DELR      = YES,
      362     4049                 DELF      = NO,
      363     4050                 REATTR    = NO,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:95   
      364     4051                 ACCT      = '?',
      365     4052                 LAST      = ";");
      366     4069        %VLP_ATTR                              (FPTN=ATTR@);
      367     4083        %VLP_ACCESS                            (STCLASS=CONSTANT,
      368     4084                 READ      = YES,
      369     4085                 UPD       = YES,
      370     4086                 WNEW      = YES,
      371     4087                 DELR      = YES,
      372     4088                 DELF      = YES,
      373     4089                 REATTR    = YES,
      374     4090                 ACCT      = ':SYS',
      375     4091                 LAST      =",");
      376     4108        %VLP_ACCESS                            (STCLASS=CONSTANT,
      377     4109                 READ      = NO,
      378     4110                 UPD       = NO,
      379     4111                 WNEW      = NO,
      380     4112                 DELR      = NO,
      381     4113                 DELF      = NO,
      382     4114                 REATTR    = NO,
      383     4115                 EXEC      = YES,
      384     4116                 ACCT      = '?',
      385     4117                 LAST      =";");
      386     4134        %VLP_ATTR                              (FPTN=ACSV@,
      387     4135                 STCLASS   = CONSTANT);
      388     4149        %VLP_ACSVEH                            (STCLASS=CONSTANT,
      389     4150                 READ      = YES,
      390     4151                 UPD       = YES,
      391     4152                 WNEW      = YES,
      392     4153                 DELR      = NO,
      393     4154                 DELF      = NO,
      394     4155                 REATTR    = NO,
      395     4156                 VEHICLE   = 'APL',
      396     4157                 LAST      =";");
      397     4174        %FPT_OPEN                              (FPTN=OPEN@,
      398     4175                 DCB       = F$SV,
      399     4176                 ASN       = FILE,
      400     4177                 FUN       = CREATE,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:96   
      401     4178                 NAME      = POOLFILENAME,
      402     4179                 ACCT      = FI_SYSACCT,
      403     4180                 CTG       = YES,
      404     4181                 ORG       = KEYED,
      405     4182                 ACS       = DIRECT,
      406     4183                 SHARE     = ALL,
      407     4184                 EXIST     = NEWFILE,
      408     4185                 ACCESS    = ATTR@,
      409     4186                 ACSVEH    = ACSV@,
      410     4187                 STCLASS   = STATIC);                                           /*#15.175*/
      411     4296        %FPT_ACTIVATE                          (FPTN=DEACTIVATE_USER,
      412     4297                 DCB       = M$APLCG,
      413     4298                 STATION   = STATIONNAME,
      414     4299                 FLUSH     = YES,
      415     4300                 STCLASS   = CONSTANT);
      416     4323        %FPT_WRITE                             (FPTN=WRITECG@,
      417     4324                 DCB       = M$APLCG,
      418     4325                 BUF       = MSG,
      419     4326                 STATION   = STA,
      420     4327                 STCLASS   = STATIC);
      421     4358        %FPT_WRITE                             (FPTN=WRITE@,
      422     4359                 DCB       = F$SV,
      423     4360                 KEY       = DBKEY,
      424     4361                 STCLASS   = STATIC);
      425     4392        %FPT_READ                              (FPTN=READSVS@,
      426     4393                 DCB       = F$SVS,
      427     4394                 KEY       = DBKEY,
      428     4395                 KEYS      = YES,
      429     4396                 STCLASS   = STATIC);
      430     4435        %FPT_OPEN                              (FPTN=OPENSVS@,
      431     4436                 DCB       = F$SVS,
      432     4437                 ASN       = FILE,
      433     4438                 FUN       = CREATE,
      434     4439                 NAME      = SVTEMP,
      435     4440                 ACCT      = FI_SYSACCT,
      436     4441                 ORG       = KEYED,
      437     4442                 ACS       = DIRECT,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:97   
      438     4443                 EXIST     = NEWFILE,
      439     4444                 STCLASS   = CONSTANT);
      440     4553        %FPT_WRITE                             (FPTN=WRITESVS@,
      441     4554                 DCB       = F$SVS,
      442     4555                 KEY       = DBKEY,
      443     4556                 STCLASS   = STATIC);
      444     4587        %VLP_NAME                              (FPTN=SVTEMP,
      445     4588                 NAME      = '*SVS',
      446     4589                 STCLASS   = CONSTANT);
      447     4616        %FPT_OPEN                              (FPTN=OPENSVX@,
      448     4617                 DCB       = F$SVX,
      449     4618                 ASN       = FILE,
      450     4619                 FUN       = CREATE,
      451     4620                 NAME      = SXTEMP,
      452     4621                 ACCT      = FI_SYSACCT,
      453     4622                 ORG       = KEYED,
      454     4623                 ACS       = DIRECT,
      455     4624                 EXIST     = NEWFILE,
      456     4625                 STCLASS   = CONSTANT);
      457     4734        %VLP_NAME                              (FPTN=SXTEMP,
      458     4735                 NAME      = '*SVX',
      459     4736                 STCLASS   = CONSTANT);
      460     4763        %FPT_TRUNC                             (FPTN=TRUNCSVX@,
      461     4764                 DCB       = F$SVX,
      462     4765                 STCLASS   = CONSTANT);
      463     4779        %FPT_TRUNC                             (FPTN=TRUNCSVS@,
      464     4780                 DCB       = F$SVS,
      465     4781                 STCLASS   = CONSTANT);
      466     4795        %FPT_TRUNC                             (FPTN=TRUNCSV@,
      467     4796                 DCB       = F$SV,
      468     4797                 STCLASS   = CONSTANT);
      469     4811        %FPT_WRITE                             (FPTN=WRITESVX@,
      470     4812                 DCB       = F$SVX,
      471     4813                 KEY       = SVXKEY,
      472     4814                 STCLASS   = STATIC);
      473     4845        %FPT_READ                              (FPTN=READSVX@,
      474     4846                 DCB       = F$SVX,
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:98   
      475     4847                 KEY       = SVXKEY,
      476     4848                 KEYS      = YES,
      477     4849                 STCLASS   = STATIC);
      478     4888        %FPT_READ                              (FPTN=READ@,
      479     4889                 DCB       = F$SV,
      480     4890                 KEY       = DBKEY2,
      481     4891                 KEYS      = YES,
      482     4892                 STCLASS   = STATIC);
      483     4931        %FPT_READ                              (FPTN=READCGC@,
      484     4932                 DCB       = M$APLCG,
      485     4933                 BUF       = MSG,
      486     4934                 STCLASS   = STATIC);
      487     4973        %FPT_ACTIVATE                         (FPTN=DEACT_ALL,
      488     4974                 STATION   = DACTALL,
      489     4975                 DCB       = M$APLCG,
      490     4976                 STCLASS   = CONSTANT);
      491     4999
      492     5000
      493     5001
      494     5002        /**/
      495     5003        /* IMPLICIT POINTERED BASED STRUCTURES */
      496     5004        /**/
      497     5005        /*B*    NAME:    FI_SV
      498     5006
      499     5007                PURPOSE:       To define the APL Shared Variable context
      500     5008                               block.
      501     5009
      502     5010                DESCRIPTION:
      503     5011                               LNK$     The forward link to the next context
      504     5012                                        block.
      505     5013
      506     5014                               BLNK$    The backward link to the previous
      507     5015                                        context block.
      508     5016
      509     5017                               ASMO     The access state matrix as view by
      510     5018                                        the offerer.
      511     5019
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:99   
      512     5020                               ASMM     The access state matrix as viewed by
      513     5021                                        the matcher.
      514     5022
      515     5023                               ACVO     The access control vector as supplied
      516     5024                                        by the offerer.
      517     5025
      518     5026                               ACVM     The access control vector as supplied
      519     5027                                        by the matcher.
      520     5028
      521     5029                               COUPLING The current coupling level of the
      522     5030                                        shared variable.
      523     5031
      524     5032                               SURROGATE  The name by which this variable is
      525     5033                                          known.
      526     5034
      527     5035                               INAME      The variables "internal" name.
      528     5036                                          Normally a pointer to this structure
      529     5037
      530     5038                               INAMER     The internal name as a pointer.
      531     5039
      532     5040                               DBKEY      The key of this variable on the
      533     5041                                          database file.
      534     5042
      535     5043                               OFFER      This field is broken down into its
      536     5044                                          components.  There is a similar
      537     5045                                          field with identical sub-fields for
      538     5046                                          the matching user called MATCH.
      539     5047
      540     5048                               STATION    The first subfield of OFFER and
      541     5049                                          MATCH.  The com-group station name
      542     5050                                          of the matching or offering station.
      543     5051
      544     5052                               NAME       The name of the user including his
      545     5053                                          clone-id.  Normally, this is an
      546     5054                                          account / clone-id pair.  This field
      547     5055                                          may also be viewed as N.ACCT for
      548     5056                                          just the account, and N.UNAME for
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:100  
      549     5057                                          just the clone-id.  This is the
      550     5058                                          second subfield of OFFER and MATCH.
      551     5059
      552     5060                               N.ACCT     The account offering/matching this
      553     5061                                          shared variable instance.  The
      554     5062                                          third sub-field of OFFER and MATCH.
      555     5063
      556     5064                               N.UNAME    The clone-id of the offer/match.
      557     5065                                          This is the final sub-field of
      558     5066                                          OFFER and MATCH.
      559     5067
      560     5068                               STATE      This indicates the current state
      561     5069                                          of the variable.  This is not to
      562     5070                                          be confused with the access state
      563     5071                                          matrix.  The state indicates whether
      564     5072                                          one of the stations is waiting for
      565     5073                                          access to the variable (STATE.N) and
      566     5074                                          indicates who has currently got
      567     5075                                          access.
      568     5076
      569     5077                               SURRLEN    The length of the name being shared.
      570     5078
      571     5079                               DBSIZE     The size of the datablock holding
      572     5080                                          the shared variable.
      573     5081
      574     5082                               MIDO       The message ID that the OFFERING
      575     5083                                          station expects to see in reply to
      576     5084                                          his outstanding request.
      577     5085
      578     5086                               MIDM       The message ID that the MATCHING
      579     5087                                          station expects to see in reply to
      580     5088                                          his outstanding request.
      581     5089
      582     5090                               SCNO       If true, the OFFERING station
      583     5091                                          expects to be notified of any
      584     5092                                          state changes immediately.
      585     5093
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:101  
      586     5094                               SCNM       If true, the MATCHING station
      587     5095                                          expects to be notified of any
      588     5096                                          state changes immediately.
      589     5097
      590     5098                               SCO        If true, a state change has occured
      591     5099                                          since the STATECHANGE function was
      592     5100                                          last requested by the OFFERING
      593     5101                                          station.
      594     5102
      595     5103                               SCM        If true, a state change has occured
      596     5104                                          since the STATECHANGE function was
      597     5105                                          last requested by the OFFERING
      598     5106                                          station.
      599     5107
      600     5108                                                                            */
      601     5109        %FI_SV (FPTN=SV,STCLASS="BASED(SV$)");
      602     5161
      603     5162
      604     5163    1   DCL  SV_NOT_ALLOWED(0:17) BIT(1) CONSTANT INIT(
      605     5164             /*  SV$ not allowed by message type */
      606     5165    1        '1'B,'0'B*8,'1'B*3,'0'B,'1'B*2,'0'B*2,'1'B);
      607     5166
      608     5167    1   DCL  SV_REQUIRED(0:17)    BIT(1) CONSTANT INIT(
      609     5168             /*  SV$ required by message type    */
      610     5169    1        '1'B,'0'B,'1'B*7,'0'B*3,'1'B,'0'B*2,'0'B,'1'B,'0'B);
      611     5170
      612     5171
      613     5172        /**/
      614     5173        /* SUBS */
      615     5174        /**/
      616     5175        %SUB TRUE ="'1'B";
      617     5176        %SUB FALSE ="'0'B";
      618     5177        %SUB INITIAL ="'0'B";
      619     5178
      620     5179        %SUB F_FI='0611'O;
      621     5180        %SUB M_A='01'O;
      622     5181
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:102  
      623     5182                           /* WARNING!!: THE FOLLOWING SUBS MUST BE THE
      624     5183                              SAME AS THE APL PROCESSOR SUBS FILE ZAQ_SUBS */
      625     5184        %SUB COMPLETED = 0/* COMPLETED */;
      626     5185        %SUB SHARE = 1/* SHARE */;
      627     5186        %SUB RETRACT = 2/* RETRACT */;
      628     5187        %SUB SETACV = 3/* SETACV */;
      629     5188        %SUB GETACV = 4/* GETACV */;
      630     5189        %SUB PREREAD = 5/* PREREAD */;
      631     5190        %SUB PREWRITE = 6/* PREWRITE */;
      632     5191        %SUB SEIZE = 7/* SEIZE */;
      633     5192        %SUB RELEASE = 8/* RELEASE */;
      634     5193        %SUB QUERY = 9/* QUERY */;
      635     5194        %SUB WAIT4CONTROL = 10/* WAIT4CONTROL */;
      636     5195        %SUB NOSPACE = 11/* NOSPACE */;
      637     5196        %SUB GETASM = 12 /* OBTAIN ACCESS STATE MATRIX */;
      638     5197        %SUB VERSION = 13 /* VERSION OF SHARED VARIABLE PROCESSOR */;
      639     5198        %SUB STATECHANGE = 14 /* WAIT FOR STATE CHANGE */;
      640     5199        %SUB GETDATA = 15 /* SEND APL DB TO STATION    */;
      641     5200        %SUB PUTDATA = 16 /* RECIEVE APL DB FROM STATION */;
      642     5201        %SUB SIGNON  = 17 /* SIGN-ON TO COMGROUP       */;
      643     5202
      644     5203        %SET SELECTOR = 200000000;
      645     5204        %EQU_CG;
      646     5252        %SUB B$ERRCODE = B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE;
      647     5253        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:103  
      648     5254        /**************************************************************/
      649     5255        /**                                                          **/
      650     5256        /**              Reporting  Macros                           **/
      651     5257        /**                                                          **/
      652     5258        /**************************************************************/
      653     5259
      654     5260        %MACRO DISP(  MSG      =  "*HERE*",
      655     5261                      STATION  =  STATION,
      656     5262                      CLASS(   INFO  =  3,
      657     5263                               DEBUG =  2,
      658     5264                               ERROR =  1) = 3);
      659     5265        %SET MESS   =  TEXTCHAR(MSG);
      660     5266                DO;
      661     5267        %IF LENGTHC(MESS)>0;
      662     5268                IF DISPLAYS>=CLASS THEN CALL WRITEMESS(STATION,%MESS,%LENGTHC(MESS),CLASS);
      663     5269        %ENDIF;
      664     5270        %IF CLASS=1;
      665     5271                GOTO RIDSTATION;
      666     5272        %ENDIF;
      667     5273                END;
      668     5274        %MEND;
      669     5275        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:104  
      670     5276        /*F* NAME:         FIA$INIT
      671     5277
      672     5278             PURPOSE:      To set up INSYM to deal with the APLCG
      673     5279
      674     5280             DESCRIPTION:  Called by INSYM initialization when the system
      675     5281                           is booted.
      676     5282        */
      677     5283    1   FIA$INIT: ENTRY;

   5283  8 000003   000000 700200 xent  FIA$INIT     TSX0  ! X66_AUTO_0
         8 000004   000036 000000                    ZERO    30,0

      678     5284    1         M$APLCG$ = DCBADDR( DCBNUM( M$APLCG));

   5284  8 000005   000000 236007 xsym               LDQ     M$APLCG,DL
         8 000006   000000 470400 9                  LDP0    0
         8 000007   000000 471500                    LDP1    0,,PR0
         8 000010   100000 236106                    LDQ     0,QL,PR1
         8 000011   000000 756000 1                  STQ     M$APLCG$

      679     5285    1         F$SV$ = DCBADDR( DCBNUM( F$SV));

   5285  8 000012   000000 236007 xsym               LDQ     F$SV,DL
         8 000013   100000 236106                    LDQ     0,QL,PR1
         8 000014   000001 756000 1                  STQ     F$SV$

      680     5286    1         F$SVS$ = DCBADDR(DCBNUM(F$SVS));

   5286  8 000015   000000 236007 xsym               LDQ     F$SVS,DL
         8 000016   100000 236106                    LDQ     0,QL,PR1
         8 000017   000002 756000 1                  STQ     F$SVS$

      681     5287    1         F$SVX$ = DCBADDR(DCBNUM(F$SVX));

   5287  8 000020   000000 236007 xsym               LDQ     F$SVX,DL
         8 000021   100000 236106                    LDQ     0,QL,PR1
         8 000022   000003 756000 1                  STQ     F$SVX$
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:105  

      682     5288    1         OPENCG@.V.FUN#=%CREATE#;

   5288  8 000023   003000 236007                    LDQ     1536,DL
         8 000024   001451 552010 1                  STBQ    OPENCG@+37,'10'O

      683     5289    1         CALL M$OPEN (OPENCG@) ALTRET(OPENCG@ALT);

   5289  8 000025   001404 630400 1                  EPPR0   OPENCG@
         8 000026   450000 713400                    CLIMB   alt,open
         8 000027   410400 401760                    pmme    nvectors=18
         8 000030   000034 702000 8                  TSX2    OPENCG@ALT

      684     5290    1         GOTO OPENEDCG@;

   5290  8 000031   000042 710000 8                  TRA     OPENEDCG@

   5288  8 000032                       OPENCG@ALT0  null
      685     5291    1   OPENCG@ALT0:;
      686     5292    1         CALL M$MERC;

   5292  8 000032   010007 713400                    CLIMB   4103
         8 000033   000000 401760                    pmme    nvectors=0

   5288  8 000034                       OPENCG@ALT   null
      687     5293    1   OPENCG@ALT:;
      688     5294    1         OPENCG@.V.EXIST#=%NEWFILE#;

   5294  8 000034   000600 236007                    LDQ     384,DL
         8 000035   001450 256000 1                  ORSQ    OPENCG@+36

      689     5295    1         CALL M$OPEN (OPENCG@) ALTRET(OPENCG@ALT0);

   5295  8 000036   001404 630400 1                  EPPR0   OPENCG@
         8 000037   450000 713400                    CLIMB   alt,open
         8 000040   410400 401760                    pmme    nvectors=18
         8 000041   000032 702000 8                  TSX2    OPENCG@ALT0
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:106  

   5294  8 000042                       OPENEDCG@    null
      690     5296    1   OPENEDCG@:;
      691     5297    1         CALL M$CGCTL (APLCGCTL) ALTRET(CTLA0);

   5297  8 000042   000154 630400 2                  EPPR0   APLCGCTL
         8 000043   500003 713400                    CLIMB   alt,+32771
         8 000044   411400 401760                    pmme    nvectors=20
         8 000045   000046 702000 8                  TSX2    CTLA0

      692     5298    1   CTLA0:OPEN@.V.FUN#=%CREATE#;

   5298  8 000046   003000 236007       CTLA0        LDQ     1536,DL
         8 000047   001603 552010 1                  STBQ    OPEN@+37,'10'O

      693     5299    1         CALL M$OPEN (OPEN@) ALTRET(OPEN@ALT);

   5299  8 000050   001536 630400 1                  EPPR0   OPEN@
         8 000051   450000 713400                    CLIMB   alt,open
         8 000052   410400 401760                    pmme    nvectors=18
         8 000053   000057 702000 8                  TSX2    OPEN@ALT

      694     5300    1         GOTO OPENED@;

   5300  8 000054   000073 710000 8                  TRA     OPENED@

   5294  8 000055                       OPEN@ALT0    null
      695     5301    1   OPEN@ALT0:;
      696     5302    1         CALL M$MERC;

   5302  8 000055   010007 713400                    CLIMB   4103
         8 000056   000000 401760                    pmme    nvectors=0

   5302  8 000057                       OPEN@ALT     null
      697     5303    1   OPEN@ALT:;
      698     5304    1         IF B$ERRCODE ~= %E$FILEBUSY THEN GOTO OPEN@ALT0;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:107  
   5304  8 000057   000000 470400 xsym               LDP0    B$TCB$
         8 000060   000000 471500                    LDP1    0,,PR0
         8 000061   100102 236100                    LDQ     66,,PR1
         8 000062   377770 376007                    ANQ     131064,DL
         8 000063   001550 116007                    CMPQ    872,DL
         8 000064   000055 601000 8                  TNZ     OPEN@ALT0

      699     5305    1         OPEN@.V.FUN#=%UPDATE#;

   5305  8 000065   001000 236007                    LDQ     512,DL
         8 000066   001603 552010 1                  STBQ    OPEN@+37,'10'O

      700     5306    1         CALL M$OPEN (OPEN@) ALTRET(OPEN@ALT0);

   5306  8 000067   001536 630400 1                  EPPR0   OPEN@
         8 000070   450000 713400                    CLIMB   alt,open
         8 000071   410400 401760                    pmme    nvectors=18
         8 000072   000055 702000 8                  TSX2    OPEN@ALT0

   5305  8 000073                       OPENED@      null
      701     5307    1   OPENED@:;
      702     5308    1         CALL M$OPEN(OPENSVS@) ALTRET(OPEN@ALT0);

   5308  8 000073   000370 630400 2                  EPPR0   OPENSVS@
         8 000074   450000 713400                    CLIMB   alt,open
         8 000075   410400 401760                    pmme    nvectors=18
         8 000076   000055 702000 8                  TSX2    OPEN@ALT0

      703     5309    1         CALL M$OPEN(OPENSVX@) ALTRET(OPEN@ALT0);

   5309  8 000077   000464 630400 2                  EPPR0   OPENSVX@
         8 000100   450000 713400                    CLIMB   alt,open
         8 000101   410400 401760                    pmme    nvectors=18
         8 000102   000055 702000 8                  TSX2    OPEN@ALT0

      704     5310    1         CALL M$TRUNC(TRUNCSVX@) ALTRET(OPEN@ALT0);

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:108  
   5310  8 000103   000560 630400 2                  EPPR0   TRUNCSVX@
         8 000104   450003 713400                    CLIMB   alt,+20483
         8 000105   400000 401760                    pmme    nvectors=1
         8 000106   000055 702000 8                  TSX2    OPEN@ALT0

      705     5311    1         CALL M$TRUNC(TRUNCSVS@) ALTRET(OPEN@ALT0);

   5311  8 000107   000564 630400 2                  EPPR0   TRUNCSVS@
         8 000110   450003 713400                    CLIMB   alt,+20483
         8 000111   400000 401760                    pmme    nvectors=1
         8 000112   000055 702000 8                  TSX2    OPEN@ALT0

      706     5312    1         CALL M$TRUNC(TRUNCSV@) ALTRET(OPEN@ALT0);

   5312  8 000113   000570 630400 2                  EPPR0   TRUNCSV@
         8 000114   450003 713400                    CLIMB   alt,+20483
         8 000115   400000 401760                    pmme    nvectors=1
         8 000116   000055 702000 8                  TSX2    OPEN@ALT0

      707     5313    1         RETURN;

   5313  8 000117   000000 702200 xent               TSX2  ! X66_ARET

      708     5314        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:109  
      709     5315        /*F* NAME:         FIA$APLRD
      710     5316
      711     5317             PURPOSE:      To process completed reads on the APLCG
      712     5318
      713     5319             DESCRIPTION:  Called from FII$INSYM when a no-wait read to
      714     5320                           the APLCG completes.  FI_EVNT$ points to an
      715     5321                           event queue frame containing the information
      716     5322                           about the completed read.
      717     5323        */
      718     5324    1   FIA$APLRD: ENTRY;

   5324  8 000120   000000 700200 xent  FIA$APLRD    TSX0  ! X66_AUTO_0
         8 000121   000036 000000                    ZERO    30,0

      719     5325    1         CALL SVPROCESSOR;

   5325  8 000122   002137 701000 8                  TSX1    SVPROCESSOR
         8 000123   000000 011000                    NOP     0

      720     5326    1         RETURN;

   5326  8 000124   000000 702200 xent               TSX2  ! X66_ARET

      721     5327        /**/
      722     5328        /*F* NAME:         FIA$ZAP
      723     5329             PURPOSE:      To shut down APL shared variables when the
      724     5330                           system is being zapped.
      725     5331             DESCRIPTION:  Closes down the comgroup, and closes the
      726     5332                           shared var file. */
      727     5333    1   FIA$ZAP: ENTRY;

   5333  8 000125   000000 700200 xent  FIA$ZAP      TSX0  ! X66_AUTO_0
         8 000126   000036 000000                    ZERO    30,0

      728     5334        /**/
      729     5335    1         CALL M$DEACTIVATE (DEACT_ALL) ALTRET(Z0);

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:110  
   5335  8 000127   000574 630400 2                  EPPR0   DEACT_ALL
         8 000130   500001 713400                    CLIMB   alt,+32769
         8 000131   401400 401760                    pmme    nvectors=4
         8 000132   000133 702000 8                  TSX2    Z0

      730     5336    1   Z0:   CALL M$CLOSE (CLOSECG) ALTRET(Z1);

   5336  8 000133   000246 630400 2     Z0           EPPR0   CLOSECG
         8 000134   450001 713400                    CLIMB   alt,close
         8 000135   406000 401760                    pmme    nvectors=13
         8 000136   000137 702000 8                  TSX2    Z1

      731     5337    1   Z1:   CALL M$CLOSE (CLOSEPOOL) ALTRET(Z2);

   5337  8 000137   000304 630400 2     Z1           EPPR0   CLOSEPOOL
         8 000140   450001 713400                    CLIMB   alt,close
         8 000141   406000 401760                    pmme    nvectors=13
         8 000142   000143 702000 8                  TSX2    Z2

      732     5338    1   Z2:   RETURN;

   5338  8 000143   000000 702200 xent  Z2           TSX2  ! X66_ARET

      733     5339        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:111  
      734     5340        /*F* NAME:         FIA$APLAU
      735     5341
      736     5342             PURPOSE:      To process APLCG administrative user events
      737     5343
      738     5344             DESCRIPTION:  Called from FII$INSYM when INSYM receives an
      739     5345                           APLCG administrative user event.  FI_EVNT$
      740     5346                           points to an event queue frame describing the
      741     5347                           event.
      742     5348        */
      743     5349    1   FIA$APLAU: ENTRY;

   5349  8 000144   000000 700200 xent  FIA$APLAU    TSX0  ! X66_AUTO_0
         8 000145   000036 000000                    ZERO    30,0

      744     5350
      745     5351    1         CGAURD$=ADDR(FI_APLCGBUF);

   5351  8 000146   000001 236000 9                  LDQ     1
         8 000147   200005 756100                    STQ     CGAURD$,,AUTO

      746     5352    2           DO CASE (CGAURD$->B$CGAURD.EVENT);

   5352  8 000150   200005 470500                    LDP0    CGAURD$,,AUTO
         8 000151   000000 235100                    LDA     0,,PR0
         8 000152   000012 115007                    CMPA    10,DL
         8 000153   000155 602005 8                  TNC     s:5352+5,AL
         8 000154   000210 710000 8                  TRA     XTNDALT0
         8 000155   000172 710000 8                  TRA     s:5359
         8 000156   000167 710000 8                  TRA     s:5356
         8 000157   000210 710000 8                  TRA     XTNDALT0
         8 000160   000210 710000 8                  TRA     XTNDALT0
         8 000161   000210 710000 8                  TRA     XTNDALT0
         8 000162   000210 710000 8                  TRA     XTNDALT0
         8 000163   000210 710000 8                  TRA     XTNDALT0
         8 000164   000210 710000 8                  TRA     XTNDALT0
         8 000165   000210 710000 8                  TRA     XTNDALT0
         8 000166   000175 710000 8                  TRA     s:5362
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:112  

      747     5353
      748     5354
      749     5355    2             CASE (%CG_DCLS#);

      750     5356    2               CALL DISCONNECT;

   5356  8 000167   000211 701000 8                  TSX1    DISCONNECT
         8 000170   000000 011000                    NOP     0
         8 000171   000210 710000 8                  TRA     XTNDALT0

      751     5357
      752     5358    2             CASE(%CG_DOPN#);

      753     5359    2               CALL CONNECT;

   5359  8 000172   000524 701000 8                  TSX1    CONNECT
         8 000173   000000 011000                    NOP     0
         8 000174   000210 710000 8                  TRA     XTNDALT0

      754     5360
      755     5361    2             CASE (%CG_WARN#);

      756     5362    2               CALL M$EXTEND (EXTEND_APLCG) ALTRET(XTNDALT);

   5362  8 000175   000242 630400 2                  EPPR0   EXTEND_APLCG
         8 000176   440005 713400                    CLIMB   alt,+16389
         8 000177   400000 401760                    pmme    nvectors=1
         8 000200   000201 702000 8                  TSX2    XTNDALT

   5362  8 000201                       XTNDALT      null
      757     5363    2   XTNDALT:    ;
      758     5364    2               APLCGCP.MAXPG#=APLCGCP.MAXPG#+%FIMI_CXMP#;

   5364  8 000201   001504 220000 1                  LDX0    APLCGCP+6
         8 000202   000031 621010                    EAX1    25,X0
         8 000203   001504 741000 1                  STX1    APLCGCP+6
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:113  

      759     5365    2               CALL M$CGCTL (APLCGCTL) ALTRET(XTNDALT0);

   5365  8 000204   000154 630400 2                  EPPR0   APLCGCTL
         8 000205   500003 713400                    CLIMB   alt,+32771
         8 000206   411400 401760                    pmme    nvectors=20
         8 000207   000210 702000 8                  TSX2    XTNDALT0

   5364  8 000210                       XTNDALT0     null
      760     5366    2   XTNDALT0:   ;
      761     5367
      762     5368    2           END;

      763     5369
      764     5370    1         RETURN;

   5370  8 000210   000000 702200 xent               TSX2  ! X66_ARET

      765     5371        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:114  
      766     5372    1   DISCONNECT: PROC ALTRET;

   5372  8 000211   200010 741300       DISCONNECT   STX1  ! L+2,,AUTO

      767     5373    2         STATION=CGAURD$->B$CGAURD.STATION;

   5373  8 000212   200005 470500                    LDP0    CGAURD$,,AUTO
         8 000213   040000 100500                    MLR     fill='040'O
         8 000214   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         8 000215   001330 000010 1                  ADSC9   STATION                  cn=0,n=8

      768     5374              %DISP(MSG="AUEV: Disconnecting Station");

   5378  8 000216   001374 235000 1                  LDA     DISPLAYS
         8 000217   000003 115007                    CMPA    3,DL
         8 000220   000231 604000 8                  TMI     s:5385

   5378  8 000221   000003 236000 9                  LDQ     3
         8 000222   200022 756100                    STQ     @LEN+1,,AUTO
         8 000223   000004 237000 9                  LDAQ    4
         8 000224   200020 757100                    STAQ    @NUM+1,,AUTO
         8 000225   000006 236000 9                  LDQ     6
         8 000226   200017 756100                    STQ     FIRST+3,,AUTO
         8 000227   005351 701000 8                  TSX1    WRITEMESS
         8 000230   000000 011000                    NOP     0

      769     5385    2         STA.STATION# = STATION;

   5385  8 000231   001330 237000 1                  LDAQ    STATION
         8 000232   001332 757000 1                  STAQ    STA

      770     5386    2         SV$ = SVHD$;

   5386  8 000233   001370 236000 1                  LDQ     SVHD$
         8 000234   001355 756000 1                  STQ     SV$

      771     5387    3           DO WHILE (SV$ ~= ADDR(NIL));
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:115  

   5387  8 000235   000451 710000 8                  TRA     s:5453

      772     5388    3           NEW$ = SV.LNK$;

   5388  8 000236   001355 470400 1                  LDP0    SV$
         8 000237   000000 236100                    LDQ     0,,PR0
         8 000240   001342 756000 1                  STQ     NEW$

      773     5389    3           IF STATION=SV.OFFER.STATION                                      /*#8.369*/

   5389  8 000241   040100 106400                    CMPC    fill='040'O
         8 000242   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 000243   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 000244   000251 600000 8                  TZE     s:5391
         8 000245   040100 106400                    CMPC    fill='040'O
         8 000246   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 000247   000037 000010                    ADSC9   31,,PR0                  cn=0,n=8
         8 000250   000447 601000 8                  TNZ     s:5452

      774     5390    3           OR STATION=SV.MATCH.STATION THEN                                 /*#8.369*/
      775     5391    4             DO CASE( SV.COUPLING);

   5391  8 000251   000002 220100                    LDX0    2,,PR0
         8 000252   000003 360003                    ANX0    3,DU
         8 000253   000003 100003                    CMPX0   3,DU
         8 000254   000256 602010 8                  TNC     s:5391+5,X0
         8 000255   000447 710000 8                  TRA     s:5452
         8 000256   000447 710000 8                  TRA     s:5452
         8 000257   000261 710000 8                  TRA     s:5397
         8 000260   000312 710000 8                  TRA     s:5415

      776     5392    4               CASE( 1);

      777     5393                      %DISP(MSG="DISCONNECT: retracting unmatched offer",CLASS=DEBUG);

   5397  8 000261   001374 235000 1                  LDA     DISPLAYS
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:116  
         8 000262   000002 115007                    CMPA    2,DL
         8 000263   000274 604000 8                  TMI     s:5404

   5397  8 000264   000010 236000 9                  LDQ     8
         8 000265   200022 756100                    STQ     @LEN+1,,AUTO
         8 000266   000012 237000 9                  LDAQ    10
         8 000267   200020 757100                    STAQ    @NUM+1,,AUTO
         8 000270   000006 236000 9                  LDQ     6
         8 000271   200017 756100                    STQ     FIRST+3,,AUTO
         8 000272   005351 701000 8                  TSX1    WRITEMESS
         8 000273   000000 011000                    NOP     0

      778     5404    4                 IF STATION = SV.OFFER.STATION THEN

   5404  8 000274   001355 470400 1                  LDP0    SV$
         8 000275   040100 106400                    CMPC    fill='040'O
         8 000276   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 000277   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 000300   000447 601000 8                  TNZ     s:5452

      779     5405    5                   DO;

      780     5406    5                   CALL SVDELINK;

   5406  8 000301   000455 701000 8                  TSX1    SVDELINK
         8 000302   000000 011000                    NOP     0

      781     5407    5                   SVX$ = SV$;

   5407  8 000303   001355 236000 1                  LDQ     SV$
         8 000304   001356 756000 1                  STQ     SVX$

      782     5408    5                   CALL FOI$RBUF (SVSCB,SVX$);

   5408  8 000305   000014 630400 9                  EPPR0   12
         8 000306   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000307   000000 701000 xent               TSX1    FOI$RBUF
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:117  
         8 000310   000000 011000                    NOP     0

      783     5409    5                   END;

   5409  8 000311   000447 710000 8                  TRA     s:5452

      784     5410    4               CASE( 2);

      785     5411                      %DISP(MSG="DISCONNECT: retracting matched offer",CLASS=DEBUG);

   5415  8 000312   001374 235000 1                  LDA     DISPLAYS
         8 000313   000002 115007                    CMPA    2,DL
         8 000314   000325 604000 8                  TMI     s:5422

   5415  8 000315   000010 236000 9                  LDQ     8
         8 000316   200022 756100                    STQ     @LEN+1,,AUTO
         8 000317   000020 237000 9                  LDAQ    16
         8 000320   200020 757100                    STAQ    @NUM+1,,AUTO
         8 000321   000006 236000 9                  LDQ     6
         8 000322   200017 756100                    STQ     FIRST+3,,AUTO
         8 000323   005351 701000 8                  TSX1    WRITEMESS
         8 000324   000000 011000                    NOP     0

      786     5422    4                 IF STATION = SV.OFFER.STATION THEN

   5422  8 000325   001355 470400 1                  LDP0    SV$
         8 000326   040100 106400                    CMPC    fill='040'O
         8 000327   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 000330   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 000331   000403 601000 8                  TNZ     s:5439

      787     5423    5                   DO;

      788     5424    5                   MSG.PARTNER2 = SV.OFFER.NAME;

   5424  8 000332   040000 100500                    MLR     fill='040'O
         8 000333   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:118  
         8 000334   000012 000024 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=20

      789     5425    5                   SV.OFFER.NAME = SV.MATCH.NAME;

   5425  8 000335   040100 100500                    MLR     fill='040'O
         8 000336   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 000337   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20

      790     5426    5                   SV.MATCH.NAME = MSG.PARTNER2;

   5426  8 000340   040100 100400                    MLR     fill='040'O
         8 000341   000012 000024 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=20
         8 000342   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20

      791     5427    5                   SV.OFFER.STATION = SV.MATCH.STATION;

   5427  8 000343   040100 100500                    MLR     fill='040'O
         8 000344   000037 000010                    ADSC9   31,,PR0                  cn=0,n=8
         8 000345   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8

      792     5428    5                   SV.ACVO = SV.ACVM;

   5428  8 000346   000002 236100                    LDQ     2,,PR0
         8 000347   000004 736000                    QLS     4
         8 000350   000002 676100                    ERQ     2,,PR0
         8 000351   001700 376003                    ANQ     960,DU
         8 000352   000002 656100                    ERSQ    2,,PR0

      793     5429    5                   SV.ASMO = SV.ASMM;

   5429  8 000353   000002 236100                    LDQ     2,,PR0
         8 000354   000004 736000                    QLS     4
         8 000355   000002 676100                    ERQ     2,,PR0
         8 000356   740000 376003                    ANQ     -16384,DU
         8 000357   000002 656100                    ERSQ    2,,PR0

      794     5430    5                   SV.SCNO = SV.SCNM;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:119  

   5430  8 000360   000046 236100                    LDQ     38,,PR0
         8 000361   000001 736000                    QLS     1
         8 000362   000046 676100                    ERQ     38,,PR0
         8 000363   020000 376003                    ANQ     8192,DU
         8 000364   000046 656100                    ERSQ    38,,PR0

      795     5431    5                   IF SV.STATE.N THEN

   5431  8 000365   000046 234100                    SZN     38,,PR0
         8 000366   000376 605000 8                  TPL     s:5437

      796     5432    6                     DO;

      797     5433    6                     TEMP = SV.MIDM;

   5433  8 000367   000047 236100                    LDQ     39,,PR0
         8 000370   777777 376007                    ANQ     -1,DL
         8 000371   001345 756000 1                  STQ     TEMP

      798     5434    6                     SV.MIDM = SV.MIDO;

   5434  8 000372   000047 220100                    LDX0    39,,PR0
         8 000373   000047 440100                    SXL0    39,,PR0

      799     5435    6                     SV.MIDO = TEMP;

   5435  8 000374   000000 621006                    EAX1    0,QL
         8 000375   000047 741100                    STX1    39,,PR0

      800     5436    6                     END;

      801     5437    5                   SV.STATE.OC = SV.STATE.MC;

   5437  8 000376   000046 236100                    LDQ     38,,PR0
         8 000377   000001 736000                    QLS     1
         8 000400   000046 676100                    ERQ     38,,PR0
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:120  
         8 000401   100000 376003                    ANQ     32768,DU
         8 000402   000046 656100                    ERSQ    38,,PR0

      802     5438    5                   END;

      803     5439    4                 SV.MATCH.STATION = ' ';

   5439  8 000403   000035 235000 xsym               LDA     B_VECTNIL+29
         8 000404   000035 236000 xsym               LDQ     B_VECTNIL+29
         8 000405   000037 755100                    STA     31,,PR0
         8 000406   000040 756100                    STQ     32,,PR0

      804     5440    4                 SV.MIDM = 0;

   5440  8 000407   000000 220003                    LDX0    0,DU
         8 000410   000047 440100                    SXL0    39,,PR0

      805     5441    4                 IF SV.MIDO > 0 THEN

   5441  8 000411   000047 221100                    LDX1    39,,PR0
         8 000412   000416 600000 8                  TZE     s:5444

      806     5442    4                  SV.STATE.N = TRUE;

   5442  8 000413   400000 236003                    LDQ     -131072,DU
         8 000414   000046 256100                    ORSQ    38,,PR0
         8 000415   000420 710000 8                  TRA     s:5445

      807     5443    4                 ELSE
      808     5444    4                  SV.STATE.N = FALSE;

   5444  8 000416   000031 236000 xsym               LDQ     B_VECTNIL+25
         8 000417   000046 356100                    ANSQ    38,,PR0

      809     5445    4                 SV.SCO  = TRUE;

   5445  8 000420   004000 236003                    LDQ     2048,DU
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:121  
         8 000421   000046 256100                    ORSQ    38,,PR0

      810     5446    4                 SV.STATE.MC = FALSE;

   5446  8 000422   000017 236000 9                  LDQ     15
         8 000423   000046 356100                    ANSQ    38,,PR0

      811     5447    4                 SV.COUPLING = 1;

   5447  8 000424   000002 236100                    LDQ     2,,PR0
         8 000425   000022 376000 9                  ANQ     18
         8 000426   000001 276003                    ORQ     1,DU
         8 000427   000002 756100                    STQ     2,,PR0

      812     5448    4                 CALL MAYNOTIFY;

   5448  8 000430   001574 701000 8                  TSX1    MAYNOTIFY
         8 000431   000000 011000                    NOP     0

      813     5449    4                 IF SV.SCNO THEN CALL SCNOTIFYO;

   5449  8 000432   001355 470400 1                  LDP0    SV$
         8 000433   000046 236100                    LDQ     38,,PR0
         8 000434   020000 316003                    CANQ    8192,DU
         8 000435   000440 600000 8                  TZE     s:5450

   5449  8 000436   002022 701000 8                  TSX1    SCNOTIFYO
         8 000437   000000 011000                    NOP     0

      814     5450    4                 IF SV.OFFER.NAME = MYID THEN CALL MYRETRACT;

   5450  8 000440   001355 470400 1                  LDP0    SV$
         8 000441   040000 106500                    CMPC    fill='040'O
         8 000442   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 000443   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 000444   000447 601000 8                  TNZ     s:5452

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:122  
   5450  8 000445   005633 701000 8                  TSX1    MYRETRACT
         8 000446   000000 011000                    NOP     0

      815     5451    4             END;

      816     5452    3           SV$ = NEW$;

   5452  8 000447   001342 236000 1                  LDQ     NEW$
         8 000450   001355 756000 1                  STQ     SV$

      817     5453    3           END;

   5453  8 000451   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 000452   000236 601000 8                  TNZ     s:5388

      818     5454    2         RETURN;

   5454  8 000453   200010 221300                    LDX1  ! L+2,,AUTO
         8 000454   000001 702211                    TSX2  ! 1,X1

      819     5455    2   END DISCONNECT;
      820     5456    1   SVDELINK: PROC;

   5456  8 000455   200014 741300       SVDELINK     STX1  ! I+1,,AUTO

      821     5457    2         IF SV$->SV.BLNK$ ~= ADDR(NIL) THEN

   5457  8 000456   001355 470400 1                  LDP0    SV$
         8 000457   000001 236100                    LDQ     1,,PR0
         8 000460   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 000461   000466 600000 8                  TZE     s:5459

      822     5458    2          SV$->SV.BLNK$->SV.LNK$ = SV$->SV.LNK$;

   5458  8 000462   000001 471500                    LDP1    1,,PR0
         8 000463   000000 236100                    LDQ     0,,PR0
         8 000464   100000 756100                    STQ     0,,PR1
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:123  
         8 000465   000470 710000 8                  TRA     s:5460

      823     5459    2         ELSE SVHD$ = SV$->SV.LNK$;

   5459  8 000466   000000 236100                    LDQ     0,,PR0
         8 000467   001370 756000 1                  STQ     SVHD$

      824     5460    2         IF SV$->SV.LNK$ ~= ADDR(NIL) THEN

   5460  8 000470   000000 236100                    LDQ     0,,PR0
         8 000471   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 000472   000477 600000 8                  TZE     s:5462

      825     5461    2          SV$->SV.LNK$->SV.BLNK$ = SV$->SV.BLNK$;

   5461  8 000473   000000 471500                    LDP1    0,,PR0
         8 000474   000001 236100                    LDQ     1,,PR0
         8 000475   100001 756100                    STQ     1,,PR1
         8 000476   000501 710000 8                  TRA     s:5463

      826     5462    2         ELSE SVTL$=SV$->SV.BLNK$;

   5462  8 000477   000001 236100                    LDQ     1,,PR0
         8 000500   001371 756000 1                  STQ     SVTL$

      827     5463    2         RETURN;

   5463  8 000501   200014 221300                    LDX1  ! I+1,,AUTO
         8 000502   000001 702211                    TSX2  ! 1,X1

      828     5464    2   END SVDELINK;
      829     5465    1   SVLINK: PROC;

   5465  8 000503   200016 741300       SVLINK       STX1  ! FIRST+2,,AUTO

      830     5466    2         SV$->SV.LNK$=ADDR(NIL);

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:124  
   5466  8 000504   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 000505   001355 470400 1                  LDP0    SV$
         8 000506   000000 756100                    STQ     0,,PR0

      831     5467    2         SV$->SV.BLNK$=SVTL$;

   5467  8 000507   001371 236000 1                  LDQ     SVTL$
         8 000510   000001 756100                    STQ     1,,PR0

      832     5468    2         IF SVTL$ ~= ADDR(NIL) THEN

   5468  8 000511   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 000512   000517 600000 8                  TZE     s:5470

      833     5469    2          SVTL$->SV.LNK$=SV$;

   5469  8 000513   001355 236000 1                  LDQ     SV$
         8 000514   001371 471400 1                  LDP1    SVTL$
         8 000515   100000 756100                    STQ     0,,PR1
         8 000516   000521 710000 8                  TRA     s:5471

      834     5470    2         ELSE SVHD$=SV$;

   5470  8 000517   001355 236000 1                  LDQ     SV$
         8 000520   001370 756000 1                  STQ     SVHD$

      835     5471    2         SVTL$=SV$;

   5471  8 000521   001371 756000 1                  STQ     SVTL$

      836     5472    2         RETURN;

   5472  8 000522   200016 221300                    LDX1  ! FIRST+2,,AUTO
         8 000523   000001 702211                    TSX2  ! 1,X1

      837     5473    2   END SVLINK;
      838     5474        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:125  
      839     5475    1   CONNECT: PROC;

   5475  8 000524   200010 741300       CONNECT      STX1  ! L+2,,AUTO

      840     5476
      841     5477    2         STATION = CGAURD$->B$CGAURD.STATION;

   5477  8 000525   200005 470500                    LDP0    CGAURD$,,AUTO
         8 000526   040000 100500                    MLR     fill='040'O
         8 000527   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         8 000530   001330 000010 1                  ADSC9   STATION                  cn=0,n=8

      842     5478              %DISP(MSG="AUEV: Connecting Station");

   5482  8 000531   001374 235000 1                  LDA     DISPLAYS
         8 000532   000003 115007                    CMPA    3,DL
         8 000533   000544 604000 8                  TMI     s:5489

   5482  8 000534   000003 236000 9                  LDQ     3
         8 000535   200022 756100                    STQ     @LEN+1,,AUTO
         8 000536   000024 237000 9                  LDAQ    20
         8 000537   200020 757100                    STAQ    @NUM+1,,AUTO
         8 000540   000006 236000 9                  LDQ     6
         8 000541   200017 756100                    STQ     FIRST+3,,AUTO
         8 000542   005351 701000 8                  TSX1    WRITEMESS
         8 000543   000000 011000                    NOP     0

      843     5489    2         STA.STATION# = STATION;

   5489  8 000544   001330 237000 1                  LDAQ    STATION
         8 000545   001332 757000 1                  STAQ    STA

      844     5490    2         MSG.TYPE = VERSION;

   5490  8 000546   000015 235007                    LDA     13,DL
         8 000547   000000 755000 xsym               STA     FI_APLCGBUF

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:126  
      845     5491    2         MSG.VNAME = 'B02';

   5491  8 000550   040000 100400                    MLR     fill='040'O
         8 000551   000656 000003 2                  ADSC9   SV_REQUIRED+33           cn=0,n=3
         8 000552   000017 000120 xsym               ADSC9   FI_APLCGBUF+15           cn=0,n=80

      846     5492    2         MSG.MID   = BITBIN('777777777777'O);

   5492  8 000553   000027 235000 xsym               LDA     B_VECTNIL+23
         8 000554   000001 755000 xsym               STA     FI_APLCGBUF+1

      847     5493    2         CALL M$WRITE(WRITECG@) ALTRET(CGERR);

   5493  8 000555   001630 630400 1                  EPPR0   WRITECG@
         8 000556   440001 713400                    CLIMB   alt,write
         8 000557   401400 401760                    pmme    nvectors=4
         8 000560   000563 702000 8                  TSX2    CGERR

      848     5494    2         RETURN;

   5494  8 000561   200010 221300                    LDX1  ! L+2,,AUTO
         8 000562   000001 702211                    TSX2  ! 1,X1

      849     5495    2   CGERR:
      850     5496    2         IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE = %E$LDSC THEN RETURN;

   5496  8 000563   000000 470400 xsym  CGERR        LDP0    B$TCB$
         8 000564   000000 471500                    LDP1    0,,PR0
         8 000565   100102 236100                    LDQ     66,,PR1
         8 000566   377770 376007                    ANQ     131064,DL
         8 000567   000140 116007                    CMPQ    96,DL
         8 000570   000573 601000 8                  TNZ     s:5497

   5496  8 000571   200010 221300                    LDX1  ! L+2,,AUTO
         8 000572   000001 702211                    TSX2  ! 1,X1

      851     5497    2         CALL M$MERC;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:127  

   5497  8 000573   010007 713400                    CLIMB   4103
         8 000574   000000 401760                    pmme    nvectors=0

      852     5498
      853     5499    2   END CONNECT;

   5499  8 000575   200010 221300                    LDX1  ! L+2,,AUTO
         8 000576   000001 702211                    TSX2  ! 1,X1

      854     5500        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:128  
      855     5501    1   MAYMATCH:

   5501  8 000577   200012 741300       MAYMATCH     STX1  ! L+4,,AUTO

      856     5502    1         PROC ALTRET;
      857     5503    2         IF SV.COUPLING=1 THEN

   5503  8 000600   001355 470400 1                  LDP0    SV$
         8 000601   000002 236100                    LDQ     2,,PR0
         8 000602   000003 376003                    ANQ     3,DU
         8 000603   000001 116003                    CMPQ    1,DU
         8 000604   000747 601000 8                  TNZ     s:5549

      858     5504    2          IF MSG.VNAME = SV.SURROGATE THEN

   5504  8 000605   040100 106400                    CMPC    fill='040'O
         8 000606   000017 000120 xsym               ADSC9   FI_APLCGBUF+15           cn=0,n=80
         8 000607   000002 400116                    ADSC9   2,,PR0                   cn=2,n=78
         8 000610   000747 601000 8                  TNZ     s:5549

      859     5505        /*
      860     5506          Rules for Sharing:
      861     5507                (1)   Two general offers NEVER match.
      862     5508                (2)   A general offer is matched ONLY by a specific
      863     5509                      matching offer.
      864     5510                (3)   A specific offer only matches the alternate specific
      865     5511                      offer.
      866     5512                (4)   An offer may not be matched by the same user.
      867     5513                                                                         */
      868     5514    2           IF SV.OFFER.NAME ~= MSG.PARTNER1 THEN

   5514  8 000611   040000 106500                    CMPC    fill='040'O
         8 000612   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 000613   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
         8 000614   000747 600000 8                  TZE     s:5549

      869     5515    2            IF     (SV.MATCH.NAME = ' '    /*** Willing to share w/anyone ***/
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:129  

   5515  8 000615   040000 106500                    CMPC    fill='040'O
         8 000616   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 000617   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 000620   000631 601000 8                  TNZ     s:5515+12
         8 000621   040000 106500                    CMPC    fill='040'O
         8 000622   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 000623   000012 000010 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=8
         8 000624   000651 600000 8                  TZE     s:5525
         8 000625   040000 106500                    CMPC    fill='040'O
         8 000626   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 000627   000012 000024 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=20
         8 000630   000651 600000 8                  TZE     s:5525
         8 000631   040000 106500                    CMPC    fill='040'O
         8 000632   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 000633   000005 000010 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=8
         8 000634   000641 600000 8                  TZE     s:5515+20
         8 000635   040000 106500                    CMPC    fill='040'O
         8 000636   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 000637   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
         8 000640   000747 601000 8                  TNZ     s:5549
         8 000641   040000 106500                    CMPC    fill='040'O
         8 000642   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 000643   000012 000010 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=8
         8 000644   000651 600000 8                  TZE     s:5525
         8 000645   040000 106500                    CMPC    fill='040'O
         8 000646   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 000647   000012 000024 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=20
         8 000650   000747 601000 8                  TNZ     s:5549

      870     5516    2            AND (SV.OFFER.NAME = MSG.P2.ACCT OR SV.OFFER.NAME = MSG.PARTNER2))
      871     5517    2            OR                /*** Finally, Specific Offers ***/
      872     5518    2            ((SV.MATCH.NAME = MSG.P1.ACCT OR SV.MATCH.NAME = MSG.PARTNER1)
      873     5519    2            AND (SV.OFFER.NAME = MSG.P2.ACCT OR SV.OFFER.NAME = MSG.PARTNER2))THEN
      874     5520    3              DO;

      875     5521                   %DISP(MSG="MAYMATCH: Share Match");
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:130  

   5525  8 000651   001374 235000 1                  LDA     DISPLAYS
         8 000652   000003 115007                    CMPA    3,DL
         8 000653   000664 604000 8                  TMI     s:5532

   5525  8 000654   000003 236000 9                  LDQ     3
         8 000655   200022 756100                    STQ     @LEN+1,,AUTO
         8 000656   000030 237000 9                  LDAQ    24
         8 000657   200020 757100                    STAQ    @NUM+1,,AUTO
         8 000660   000006 236000 9                  LDQ     6
         8 000661   200017 756100                    STQ     FIRST+3,,AUTO
         8 000662   005351 701000 8                  TSX1    WRITEMESS
         8 000663   000000 011000                    NOP     0

      876     5532    3              SV.MATCH.NAME = MSG.PARTNER1;

   5532  8 000664   001355 470400 1                  LDP0    SV$
         8 000665   040100 100400                    MLR     fill='040'O
         8 000666   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
         8 000667   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20

      877     5533    3              SV.MATCH.STATION = STATION;

   5533  8 000670   001330 237000 1                  LDAQ    STATION
         8 000671   000037 755100                    STA     31,,PR0
         8 000672   000040 756100                    STQ     32,,PR0

      878     5534    3              SV.COUPLING = 2;

   5534  8 000673   000002 236100                    LDQ     2,,PR0
         8 000674   000022 376000 9                  ANQ     18
         8 000675   000002 276003                    ORQ     2,DU
         8 000676   000002 756100                    STQ     2,,PR0

      879     5535    3              SV.ACVM = INITIAL;

   5535  8 000677   000027 236000 9                  LDQ     23
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:131  
         8 000700   000002 356100                    ANSQ    2,,PR0

      880     5536    3              L = MSG.MID;

   5536  8 000701   000001 235000 xsym               LDA     FI_APLCGBUF+1
         8 000702   200006 755100                    STA     L,,AUTO

      881     5537    3              IF MSG.FIELD1~=0 AND SV.DBKEY<%SELECTOR THEN CALL VARTOSVS;

   5537  8 000703   000003 235000 xsym               LDA     FI_APLCGBUF+3
         8 000704   000712 600000 8                  TZE     s:5538
         8 000705   000027 235100                    LDA     23,,PR0
         8 000706   000032 115000 9                  CMPA    26
         8 000707   000712 603000 8                  TRC     s:5538

   5537  8 000710   001221 701000 8                  TSX1    VARTOSVS
         8 000711   000000 011000                    NOP     0

      882     5538    3              MSG.MID = L;

   5538  8 000712   200006 235100                    LDA     L,,AUTO
         8 000713   000001 755000 xsym               STA     FI_APLCGBUF+1

      883     5539    3              MSG.TYPE = COMPLETED;

   5539  8 000714   000000 450000 xsym               STZ     FI_APLCGBUF

      884     5540    3              MSG.INAME = SV.INAME;

   5540  8 000715   001355 470400 1                  LDP0    SV$
         8 000716   000026 235100                    LDA     22,,PR0
         8 000717   000002 755000 xsym               STA     FI_APLCGBUF+2

      885     5541    3              MSG.FIELD2 = 0;

   5541  8 000720   000004 450000 xsym               STZ     FI_APLCGBUF+4

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:132  
      886     5542    3              IF SV.DBSIZE > 0 THEN MSG.FIELD2 = SV.DBKEY;

   5542  8 000721   000046 720100                    LXL0    38,,PR0
         8 000722   000725 600000 8                  TZE     s:5543

   5542  8 000723   000027 235100                    LDA     23,,PR0
         8 000724   000004 755000 xsym               STA     FI_APLCGBUF+4

      887     5543    3              MSG.FIELD1 = SV.COUPLING;

   5543  8 000725   000002 236100                    LDQ     2,,PR0
         8 000726   000022 772000                    QRL     18
         8 000727   000003 376007                    ANQ     3,DL
         8 000730   000003 756000 xsym               STQ     FI_APLCGBUF+3

      888     5544    3              CALL M$WRITE( WRITECG@) ALTRET(CGERR);

   5544  8 000731   001630 630400 1                  EPPR0   WRITECG@
         8 000732   440001 713400                    CLIMB   alt,write
         8 000733   401400 401760                    pmme    nvectors=4
         8 000734   000750 702000 8                  TSX2    CGERR

      889     5545    3              SV.SCO  = TRUE;

   5545  8 000735   001355 470400 1                  LDP0    SV$
         8 000736   004000 236003                    LDQ     2048,DU
         8 000737   000046 256100                    ORSQ    38,,PR0

      890     5546    3              IF SV.SCNO THEN CALL SCNOTIFYO;

   5546  8 000740   000046 236100                    LDQ     38,,PR0
         8 000741   020000 316003                    CANQ    8192,DU
         8 000742   000745 600000 8                  TZE     s:5547

   5546  8 000743   002022 701000 8                  TSX1    SCNOTIFYO
         8 000744   000000 011000                    NOP     0

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:133  
      891     5547    3              ALTRETURN;

   5547  8 000745   200012 221300                    LDX1  ! L+4,,AUTO
         8 000746   000000 702211                    TSX2  ! 0,X1

      892     5548    3              END;
      893     5549    2         RETURN;

   5549  8 000747   000001 702211                    TSX2  ! 1,X1

      894     5550    2   CGERR:
      895     5551    2         IF %E$LDSC = B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.CODE THEN

   5551  8 000750   000000 470400 xsym  CGERR        LDP0    B$TCB$
         8 000751   000000 471500                    LDP1    0,,PR0
         8 000752   100102 236100                    LDQ     66,,PR1
         8 000753   377770 376007                    ANQ     131064,DL
         8 000754   000140 116007                    CMPQ    96,DL
         8 000755   000760 601000 8                  TNZ     s:5553

      896     5552    2          ALTRETURN;

   5552  8 000756   200012 221300                    LDX1  ! L+4,,AUTO
         8 000757   000000 702211                    TSX2  ! 0,X1

      897     5553    2         CALL M$MERC;

   5553  8 000760   010007 713400                    CLIMB   4103
         8 000761   000000 401760                    pmme    nvectors=0

      898     5554    2   END MAYMATCH;

   5554  8 000762   200012 221300                    LDX1  ! L+4,,AUTO
         8 000763   000001 702211                    TSX2  ! 1,X1

      899     5555        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:134  
      900     5556    1   DOSIGNON: PROC ALTRET;

   5556  8 000764   200014 741300       DOSIGNON     STX1  ! I+1,,AUTO

      901     5557                /*   Allow this user on as an APL      */
      902     5558    2         CALL FOI$GBUF(SVSCB,SVX$) ALTRET(NOSVS);

   5558  8 000765   000014 630400 9                  EPPR0   12
         8 000766   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000767   000000 701000 xent               TSX1    FOI$GBUF
         8 000770   001110 702000 8                  TSX2    NOSVS

      903     5559    2         SV$ = SVX$;

   5559  8 000771   001356 236000 1                  LDQ     SVX$
         8 000772   001355 756000 1                  STQ     SV$

      904     5560              %DISP(MSG="DOSIGNON: Sign on Complete");

   5564  8 000773   001374 235000 1                  LDA     DISPLAYS
         8 000774   000003 115007                    CMPA    3,DL
         8 000775   001006 604000 8                  TMI     s:5571

   5564  8 000776   000003 236000 9                  LDQ     3
         8 000777   200022 756100                    STQ     @LEN+1,,AUTO
         8 001000   000034 237000 9                  LDAQ    28
         8 001001   200020 757100                    STAQ    @NUM+1,,AUTO
         8 001002   000006 236000 9                  LDQ     6
         8 001003   200017 756100                    STQ     FIRST+3,,AUTO
         8 001004   005351 701000 8                  TSX1    WRITEMESS
         8 001005   000000 011000                    NOP     0

      905     5571    2         SV = SV_INIT;

   5571  8 001006   001355 470400 1                  LDP0    SV$
         8 001007   000100 100400                    MLR     fill='000'O
         8 001010   000002 000240 2                  ADSC9   SV_INIT                  cn=0,n=160
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:135  
         8 001011   000000 000240                    ADSC9   0,,PR0                   cn=0,n=160

      906     5572    2         SV.SCDF = '1'B;   /* Signon-record     */

   5572  8 001012   001000 236003                    LDQ     512,DU
         8 001013   000046 256100                    ORSQ    38,,PR0

      907     5573    2         SV.OFFER.NAME = MSG.PARTNER1;

   5573  8 001014   040100 100400                    MLR     fill='040'O
         8 001015   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
         8 001016   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20

      908     5574    2         SV.INAMER = SV$;

   5574  8 001017   001355 236000 1                  LDQ     SV$
         8 001020   000026 756100                    STQ     22,,PR0

      909     5575    2         SV.OFFER.STATION = STATION;

   5575  8 001021   001330 237000 1                  LDAQ    STATION
         8 001022   000030 755100                    STA     24,,PR0
         8 001023   000031 756100                    STQ     25,,PR0

      910     5576    2         SV.MATCH.NAME = MYID;

   5576  8 001024   040100 100400                    MLR     fill='040'O
         8 001025   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 001026   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20

      911     5577    2         SV.SURROGATE  = %CONCAT(BITASC('325'O),'SC');

   5577  8 001027   040100 100400                    MLR     fill='040'O
         8 001030   000673 000003 2                  ADSC9   SV_REQUIRED+46           cn=0,n=3
         8 001031   000002 400116                    ADSC9   2,,PR0                   cn=2,n=78

      912     5578    2         SV.COUPLING = 1;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:136  

   5578  8 001032   000002 236100                    LDQ     2,,PR0
         8 001033   000022 376000 9                  ANQ     18
         8 001034   000001 276003                    ORQ     1,DU
         8 001035   000002 756100                    STQ     2,,PR0

      913     5579    2         SV.ASMO = '0011'B;

   5579  8 001036   000002 236100                    LDQ     2,,PR0
         8 001037   000036 376000 9                  ANQ     30
         8 001040   140000 276003                    ORQ     49152,DU
         8 001041   000002 756100                    STQ     2,,PR0

      914     5580    2         SV.ASMM = '0011'B;

   5580  8 001042   000002 236100                    LDQ     2,,PR0
         8 001043   000037 376000 9                  ANQ     31
         8 001044   006000 276003                    ORQ     3072,DU
         8 001045   000002 756100                    STQ     2,,PR0

      915     5581    2         IF MSG.FIELD1 = 0

   5581  8 001046   000003 235000 xsym               LDA     FI_APLCGBUF+3
         8 001047   001053 601000 8                  TNZ     s:5584

      916     5582    2         THEN SV.DBKEY = KEYVAL;

   5582  8 001050   001344 235000 1                  LDA     KEYVAL
         8 001051   000027 755100                    STA     23,,PR0
         8 001052   001071 710000 8                  TRA     s:5597

      917     5583    3         ELSE DO;

      918     5584    3           SV.DBKEY = KEYVAL+%SELECTOR;

   5584  8 001053   001344 235000 1                  LDA     KEYVAL
         8 001054   000032 035000 9                  ADLA    26
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:137  
         8 001055   000027 755100                    STA     23,,PR0

      919     5585                %DISP(MSG="DOSIGNON: * file requested",CLASS=DEBUG);

   5589  8 001056   001374 235000 1                  LDA     DISPLAYS
         8 001057   000002 115007                    CMPA    2,DL
         8 001060   001071 604000 8                  TMI     s:5597

   5589  8 001061   000010 236000 9                  LDQ     8
         8 001062   200022 756100                    STQ     @LEN+1,,AUTO
         8 001063   000040 237000 9                  LDAQ    32
         8 001064   200020 757100                    STAQ    @NUM+1,,AUTO
         8 001065   000006 236000 9                  LDQ     6
         8 001066   200017 756100                    STQ     FIRST+3,,AUTO
         8 001067   005351 701000 8                  TSX1    WRITEMESS
         8 001070   000000 011000                    NOP     0

      920     5596    3           END;

      921     5597    2         KEYVAL   = KEYVAL + 1;

   5597  8 001071   001344 235000 1                  LDA     KEYVAL
         8 001072   000001 035007                    ADLA    1,DL
         8 001073   001344 755000 1                  STA     KEYVAL

      922     5598    2         IF KEYVAL >= %SELECTOR THEN KEYVAL = 1;

   5598  8 001074   000032 115000 9                  CMPA    26
         8 001075   001100 602000 8                  TNC     s:5599

   5598  8 001076   000001 236007                    LDQ     1,DL
         8 001077   001344 756000 1                  STQ     KEYVAL

      923     5599    2         SV.SURRLEN = MSG.FIELD1;

   5599  8 001100   001355 470400 1                  LDP0    SV$
         8 001101   000003 236000 xsym               LDQ     FI_APLCGBUF+3
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:138  
         8 001102   000022 736000                    QLS     18
         8 001103   000046 552120                    STBQ    38,'20'O,PR0

      924     5600    2         CALL SVLINK;

   5600  8 001104   000503 701000 8                  TSX1    SVLINK
         8 001105   000000 011000                    NOP     0

      925     5601    2         RETURN;

   5601  8 001106   200014 221300                    LDX1  ! I+1,,AUTO
         8 001107   000001 702211                    TSX2  ! 1,X1

      926     5602    2   NOSVS:
      927     5603              %DISP(MSG="DOSIGNON: Signon Failed due to FOI$GBUF",CLASS=DEBUG);

   5605  8 001110                       NOSVS        null
   5607  8 001110   001374 235000 1                  LDA     DISPLAYS
         8 001111   000002 115007                    CMPA    2,DL
         8 001112   001123 604000 8                  TMI     s:5614

   5607  8 001113   000010 236000 9                  LDQ     8
         8 001114   200022 756100                    STQ     @LEN+1,,AUTO
         8 001115   000044 237000 9                  LDAQ    36
         8 001116   200020 757100                    STAQ    @NUM+1,,AUTO
         8 001117   000006 236000 9                  LDQ     6
         8 001120   200017 756100                    STQ     FIRST+3,,AUTO
         8 001121   005351 701000 8                  TSX1    WRITEMESS
         8 001122   000000 011000                    NOP     0

      928     5614    2         ALTRETURN;

   5614  8 001123   200014 221300                    LDX1  ! I+1,,AUTO
         8 001124   000000 702211                    TSX2  ! 0,X1

      929     5615    2   END DOSIGNON;
      930     5616        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:139  
      931     5617    1   CHECKSIGNON: PROC ALTRET;

   5617  8 001125   200012 741300       CHECKSIGNON  STX1  ! L+4,,AUTO

      932     5618
      933     5619    2         NEW$ = SV$;

   5619  8 001126   001355 236000 1                  LDQ     SV$
         8 001127   001342 756000 1                  STQ     NEW$

      934     5620    2         SV$ = SVHD$;

   5620  8 001130   001370 236000 1                  LDQ     SVHD$
         8 001131   001355 756000 1                  STQ     SV$

      935     5621    3           DO WHILE(SV$ ~= ADDR(NIL));

   5621  8 001132   001155 710000 8                  TRA     s:5629

      936     5622    3           IF SV.SCDF THEN

   5622  8 001133   001355 470400 1                  LDP0    SV$
         8 001134   000046 430100                    FSZN    38,,PR0
         8 001135   001153 605000 8                  TPL     s:5628

      937     5623    3            IF SV.OFFER.NAME = MSG.PARTNER1 THEN

   5623  8 001136   040000 106500                    CMPC    fill='040'O
         8 001137   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 001140   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
         8 001141   001147 601000 8                  TNZ     s:5627

      938     5624    3             IF SV.OFFER.STATION = STATION

   5624  8 001142   040000 106500                    CMPC    fill='040'O
         8 001143   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 001144   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:140  
         8 001145   001165 600000 8                  TZE     OKAY

      939     5625    3             THEN GOTO OKAY;
      940     5626    3             ELSE GOTO BAD1;

   5626  8 001146   001173 710000 8                  TRA     BAD1

      941     5627    3            ELSE IF SV.OFFER.STATION = STATION THEN GOTO BAD1;

   5627  8 001147   040000 106500                    CMPC    fill='040'O
         8 001150   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 001151   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 001152   001173 600000 8                  TZE     BAD1

      942     5628    3           SV$ = SV.LNK$;

   5628  8 001153   000000 236100                    LDQ     0,,PR0
         8 001154   001355 756000 1                  STQ     SV$

      943     5629    3           END;

   5629  8 001155   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 001156   001133 601000 8                  TNZ     s:5622

      944     5630    2         IF MSG.PARTNER1 = MYID THEN GOTO BAD1;

   5630  8 001157   040000 106400                    CMPC    fill='040'O
         8 001160   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
         8 001161   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 001162   001173 600000 8                  TZE     BAD1

      945     5631    2         CALL DOSIGNON ALTRET(NOSVS);;

   5631  8 001163   000764 701000 8                  TSX1    DOSIGNON
         8 001164   001214 702000 8                  TSX2    NOSVS

      946     5632    2   OKAY:
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:141  
      947     5633    2         SVSIGNON$ = SV$;

   5633  8 001165   001355 236000 1     OKAY         LDQ     SV$
         8 001166   001357 756000 1                  STQ     SVSIGNON$

      948     5634    2         SV$ = NEW$;

   5634  8 001167   001342 236000 1                  LDQ     NEW$
         8 001170   001355 756000 1                  STQ     SV$

      949     5635    2         RETURN;

   5635  8 001171   200012 221300                    LDX1  ! L+4,,AUTO
         8 001172   000001 702211                    TSX2  ! 1,X1

      950     5636    2   BAD1:
      951     5637              %DISP(MSG="CHECKSIGNON: Duplicate Signon exists",CLASS=DEBUG);

   5639  8 001173                       BAD1         null
   5641  8 001173   001374 235000 1                  LDA     DISPLAYS
         8 001174   000002 115007                    CMPA    2,DL
         8 001175   001206 604000 8                  TMI     s:5648

   5641  8 001176   000010 236000 9                  LDQ     8
         8 001177   200022 756100                    STQ     @LEN+1,,AUTO
         8 001200   000046 237000 9                  LDAQ    38
         8 001201   200020 757100                    STAQ    @NUM+1,,AUTO
         8 001202   000006 236000 9                  LDQ     6
         8 001203   200017 756100                    STQ     FIRST+3,,AUTO
         8 001204   005351 701000 8                  TSX1    WRITEMESS
         8 001205   000000 011000                    NOP     0

      952     5648    2         K = 1;

   5648  8 001206   000001 235007                    LDA     1,DL
         8 001207   001347 755000 1                  STA     K

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:142  
      953     5649    2         SV$ = NEW$;

   5649  8 001210   001342 236000 1                  LDQ     NEW$
         8 001211   001355 756000 1                  STQ     SV$

      954     5650    2         ALTRETURN;

   5650  8 001212   200012 221300                    LDX1  ! L+4,,AUTO
         8 001213   000000 702211                    TSX2  ! 0,X1

      955     5651    2   NOSVS:
      956     5652    2         K = 0;

   5652  8 001214   001347 450000 1     NOSVS        STZ     K

      957     5653    2         SV$ = NEW$;

   5653  8 001215   001342 236000 1                  LDQ     NEW$
         8 001216   001355 756000 1                  STQ     SV$

      958     5654    2         ALTRETURN;

   5654  8 001217   200012 221300                    LDX1  ! L+4,,AUTO
         8 001220   000000 702211                    TSX2  ! 0,X1

      959     5655    2   END CHECKSIGNON;
      960     5656        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:143  
      961     5657    1   VARTOSVS: PROC;

   5657  8 001221   200014 741300       VARTOSVS     STX1  ! I+1,,AUTO

      962     5658                      /*  To copy the value of a shared variable from */
      963     5659                      /*  :ZASV to our temp file.                     */
      964     5660              %DISP(MSG="VARTOSVS: Copying variable to * file.",CLASS=DEBUG);

   5664  8 001222   001374 235000 1                  LDA     DISPLAYS
         8 001223   000002 115007                    CMPA    2,DL
         8 001224   001235 604000 8                  TMI     s:5671

   5664  8 001225   000010 236000 9                  LDQ     8
         8 001226   200022 756100                    STQ     @LEN+1,,AUTO
         8 001227   000052 237000 9                  LDAQ    42
         8 001230   200020 757100                    STAQ    @NUM+1,,AUTO
         8 001231   000006 236000 9                  LDQ     6
         8 001232   200017 756100                    STQ     FIRST+3,,AUTO
         8 001233   005351 701000 8                  TSX1    WRITEMESS
         8 001234   000000 011000                    NOP     0

      965     5671    2         DBKEY2.VAL = SV.DBKEY;

   5671  8 001235   001355 470400 1                  LDP0    SV$
         8 001236   000027 236100                    LDQ     23,,PR0
         8 001237   001354 552034 1                  STBQ    DBKEY2,'34'O

      966     5672    2         DBKEY.VAL  = 0-SV.DBKEY;

   5672  8 001240   000027 236100                    LDQ     23,,PR0
         8 001241   000027 676000 xsym               ERQ     B_VECTNIL+23
         8 001242   000001 036007                    ADLQ    1,DL
         8 001243   001353 552034 1                  STBQ    DBKEY,'34'O

      967     5673    2         WRITESVS@.BUF_ = VECTOR(MSG);

   5673  8 001244   000054 237000 9                  LDAQ    44
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:144  
         8 001245   001702 757000 1                  STAQ    WRITESVS@+4

      968     5674    2         READ@.BUF_     = VECTOR(MSG);

   5674  8 001246   000054 237000 9                  LDAQ    44
         8 001247   001750 757000 1                  STAQ    READ@+4

      969     5675    2   RDLP:
      970     5676    2         CALL M$READ(READ@) ALTRET(LD);

   5676  8 001250   001744 630400 1     RDLP         EPPR0   READ@
         8 001251   440000 713400                    CLIMB   alt,read
         8 001252   401400 401760                    pmme    nvectors=4
         8 001253   001310 702000 8                  TSX2    LD

      971     5677    2         READ@.V.DVBYTE.CONT#   = FALSE;

   5677  8 001254   000051 236000 9                  LDQ     41
         8 001255   001757 356000 1                  ANSQ    READ@+11

      972     5678    2         WRITESVS@.V.DVBYTE.CONT# = FALSE;

   5678  8 001256   001711 356000 1                  ANSQ    WRITESVS@+11

      973     5679    2         K = F$SV$->F$DCB.ARS#;

   5679  8 001257   000001 470400 1                  LDP0    F$SV$
         8 001260   000000 235100                    LDA     0,,PR0
         8 001261   001347 755000 1                  STA     K

      974     5680    2         WRITESVS@.BUF_ = VECTOR(ADDR(MSG)->KBUF);

   5680  8 001262   000020 735000                    ALS     16
         8 001263   000140 135007                    SBLA    96,DL
         8 001264   000001 236000 9                  LDQ     1
         8 001265   001702 757000 1                  STAQ    WRITESVS@+4

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:145  
      975     5681    2   CON:
      976     5682    2         CALL M$WRITE(WRITESVS@) ALTRET(NOCANDO);

   5682  8 001266   001676 630400 1     CON          EPPR0   WRITESVS@
         8 001267   440001 713400                    CLIMB   alt,write
         8 001270   401400 401760                    pmme    nvectors=4
         8 001271   001274 702000 8                  TSX2    NOCANDO

      977     5683    2         IF WRITESVS@.V.DVBYTE.CONT# = TRUE THEN GOTO RDLP;

   5683  8 001272   001711 430000 1                  FSZN    WRITESVS@+11
         8 001273   001250 604000 8                  TMI     RDLP

      978     5684    2   NOCANDO:
      979     5685    2         READ@.V.DVBYTE.CONT#   = FALSE;

   5685  8 001274   000051 236000 9     NOCANDO      LDQ     41
         8 001275   001757 356000 1                  ANSQ    READ@+11

      980     5686    2         WRITESVS@.V.DVBYTE.CONT# = FALSE;

   5686  8 001276   001711 356000 1                  ANSQ    WRITESVS@+11

      981     5687    2         SV.DBKEY = 0-SV.DBKEY;

   5687  8 001277   001355 470400 1                  LDP0    SV$
         8 001300   000027 235100                    LDA     23,,PR0
         8 001301   000027 675000 xsym               ERA     B_VECTNIL+23
         8 001302   000001 035007                    ADLA    1,DL
         8 001303   000027 755100                    STA     23,,PR0

      982     5688    2         WRITESVS@.BUF_ = VECTOR(MSG);

   5688  8 001304   000054 237000 9                  LDAQ    44
         8 001305   001702 757000 1                  STAQ    WRITESVS@+4

      983     5689    2         RETURN;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:146  

   5689  8 001306   200014 221300                    LDX1  ! I+1,,AUTO
         8 001307   000001 702211                    TSX2  ! 1,X1

      984     5690    2   LD:
      985     5691    2         IF B$ERRCODE = %E$LD THEN

   5691  8 001310   000000 470400 xsym  LD           LDP0    B$TCB$
         8 001311   000000 471500                    LDP1    0,,PR0
         8 001312   100102 236100                    LDQ     66,,PR1
         8 001313   377770 376007                    ANQ     131064,DL
         8 001314   000070 116007                    CMPQ    56,DL
         8 001315   001322 601000 8                  TNZ     s:5697

      986     5692    3           DO;

      987     5693    3           WRITESVS@.V.DVBYTE.CONT# = TRUE;

   5693  8 001316   001000 236003                    LDQ     512,DU
         8 001317   001711 256000 1                  ORSQ    WRITESVS@+11

      988     5694    3           READ@.V.DVBYTE.CONT#     = TRUE;

   5694  8 001320   001757 256000 1                  ORSQ    READ@+11

      989     5695    3           GOTO CON;

   5695  8 001321   001266 710000 8                  TRA     CON

      990     5696    3           END;
      991     5697    2         GOTO NOCANDO;

   5697  8 001322   001274 710000 8                  TRA     NOCANDO

      992     5698    2   END VARTOSVS;
      993     5699        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:147  
      994     5700    1   MAYREAD:

   5700  8 001323   200012 741300       MAYREAD      STX1  ! L+4,,AUTO

      995     5701    1         PROC ALTRET;
      996     5702    2   DCL TYPE UBIN;
      997     5703    2         TYPE = 1;

   5703  8 001324   000001 235007                    LDA     1,DL
         8 001325   200013 755100                    STA     TYPE,,AUTO

      998     5704    2         GOTO COMMON;

   5704  8 001326   001335 710000 8                  TRA     COMMON

      999     5705    2   MAYWRITE:
     1000     5706    2         ENTRY ALTRET;

   5706  8 001327   200012 741300       MAYWRITE     STX1  ! L+4,,AUTO

     1001     5707    2         TYPE = 0;

   5707  8 001330   200013 450100                    STZ     TYPE,,AUTO

     1002     5708    2         GOTO COMMON;

   5708  8 001331   001335 710000 8                  TRA     COMMON

     1003     5709    2   MAYSEIZE:
     1004     5710    2         ENTRY ALTRET;

   5710  8 001332   200012 741300       MAYSEIZE     STX1  ! L+4,,AUTO

     1005     5711    2         TYPE = 2;

   5711  8 001333   000002 235007                    LDA     2,DL
         8 001334   200013 755100                    STA     TYPE,,AUTO
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:148  

     1006     5712    2   COMMON:
     1007     5713    2         IF STATION = SV.OFFER.STATION THEN

   5713  8 001335   001355 470400 1     COMMON       LDP0    SV$
         8 001336   040100 106400                    CMPC    fill='040'O
         8 001337   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 001340   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 001341   001345 601000 8                  TNZ     s:5716

     1008     5714    2          IF SV.STATE.MC THEN

   5714  8 001342   000046 236100                    LDQ     38,,PR0
         8 001343   040000 316003                    CANQ    16384,DU
         8 001344   001535 601000 8                  TNZ     NOTNOW

     1009     5715    2           GOTO NOTNOW;
     1010     5716    2         IF STATION = SV.MATCH.STATION THEN

   5716  8 001345   040100 106400                    CMPC    fill='040'O
         8 001346   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 001347   000037 000010                    ADSC9   31,,PR0                  cn=0,n=8
         8 001350   001354 601000 8                  TNZ     s:5719

     1011     5717    2          IF SV.STATE.OC THEN

   5717  8 001351   000046 236100                    LDQ     38,,PR0
         8 001352   100000 316003                    CANQ    32768,DU
         8 001353   001535 601000 8                  TNZ     NOTNOW

     1012     5718    2           GOTO NOTNOW;
     1013     5719    2         IF TYPE < 2 THEN

   5719  8 001354   200013 235100                    LDA     TYPE,,AUTO
         8 001355   000002 115007                    CMPA    2,DL
         8 001356   001443 603000 8                  TRC     s:5727

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:149  
     1014     5720    3           DO;

     1015     5721    3           IF STATION = SV.OFFER.STATION

   5721  8 001357   040100 106400                    CMPC    fill='040'O
         8 001360   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 001361   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 001362   001410 601000 8                  TNZ     s:5723

     1016     5722    3           THEN MASK = (SV.ACVO | FLIPPED( BITBIN(SV.ACVM) )) & SV.ASMO;

   5722  8 001363   000002 236100                    LDQ     2,,PR0
         8 001364   000024 772000                    QRL     20
         8 001365   000017 376007                    ANQ     15,DL
         8 001366   000002 736000                    QLS     2
         8 001367   003100 060406                    CSL     bolr='003'O
         8 001370   000000 000004 2                  BDSC    FLIPPED,Q                by=0,bit=0,n=4
         8 001371   200032 000044                    BDSC    STX+3,,AUTO              by=0,bit=0,n=36
         8 001372   000002 236100                    LDQ     2,,PR0
         8 001373   000010 736000                    QLS     8
         8 001374   740000 376003                    ANQ     -16384,DU
         8 001375   200032 276100                    ORQ     STX+3,,AUTO
         8 001376   200033 756100                    STQ     STX+4,,AUTO
         8 001377   000002 236100                    LDQ     2,,PR0
         8 001400   740000 376003                    ANQ     -16384,DU
         8 001401   200034 756100                    STQ     STX+5,,AUTO
         8 001402   200033 236100                    LDQ     STX+4,,AUTO
         8 001403   200034 376100                    ANQ     STX+5,,AUTO
         8 001404   001343 676000 1                  ERQ     MASK
         8 001405   740000 376003                    ANQ     -16384,DU
         8 001406   001343 656000 1                  ERSQ    MASK
         8 001407   001435 710000 8                  TRA     s:5724

     1017     5723    3           ELSE MASK = (SV.ACVM | FLIPPED( BITBIN(SV.ACVO) )) & SV.ASMM;

   5723  8 001410   000002 236100                    LDQ     2,,PR0
         8 001411   000030 772000                    QRL     24
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:150  
         8 001412   000017 376007                    ANQ     15,DL
         8 001413   000002 736000                    QLS     2
         8 001414   003100 060406                    CSL     bolr='003'O
         8 001415   000000 000004 2                  BDSC    FLIPPED,Q                by=0,bit=0,n=4
         8 001416   200032 000044                    BDSC    STX+3,,AUTO              by=0,bit=0,n=36
         8 001417   000002 236100                    LDQ     2,,PR0
         8 001420   000014 736000                    QLS     12
         8 001421   740000 376003                    ANQ     -16384,DU
         8 001422   200032 276100                    ORQ     STX+3,,AUTO
         8 001423   200033 756100                    STQ     STX+4,,AUTO
         8 001424   000002 236100                    LDQ     2,,PR0
         8 001425   000004 736000                    QLS     4
         8 001426   740000 376003                    ANQ     -16384,DU
         8 001427   200034 756100                    STQ     STX+5,,AUTO
         8 001430   200033 236100                    LDQ     STX+4,,AUTO
         8 001431   200034 376100                    ANQ     STX+5,,AUTO
         8 001432   001343 676000 1                  ERQ     MASK
         8 001433   740000 376003                    ANQ     -16384,DU
         8 001434   001343 656000 1                  ERSQ    MASK

     1018     5724    3           IF BMASK( TYPE+TYPE) THEN

   5724  8 001435   200013 236100                    LDQ     TYPE,,AUTO
         8 001436   200013 036100                    ADLQ    TYPE,,AUTO
         8 001437   000000 066406                    CMPB    filb='0'B
         8 001440   001343 000001 1                  BDSC    MASK,Q                   by=0,bit=0,n=1
         8 001441   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         8 001442   001535 601000 8                  TNZ     NOTNOW

     1019     5725    3            GOTO NOTNOW;
     1020     5726    3           END;

     1021     5727    2         IF STATION = SV.OFFER.STATION THEN

   5727  8 001443   040100 106400                    CMPC    fill='040'O
         8 001444   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 001445   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:151  
         8 001446   001474 601000 8                  TNZ     s:5737

     1022     5728    3           DO CASE( TYPE);

   5728  8 001447   000003 115007                    CMPA    3,DL
         8 001450   001452 602005 8                  TNC     s:5728+3,AL
         8 001451   001520 710000 8                  TRA     s:5745
         8 001452   001455 710000 8                  TRA     s:5730
         8 001453   001462 710000 8                  TRA     s:5732
         8 001454   001467 710000 8                  TRA     s:5734

     1023     5729    3             CASE( 0);

     1024     5730    3               MASK = '0110'B;

   5730  8 001455   001343 236000 1                  LDQ     MASK
         8 001456   000036 376000 9                  ANQ     30
         8 001457   300000 276003                    ORQ     98304,DU
         8 001460   001343 756000 1                  STQ     MASK
         8 001461   001520 710000 8                  TRA     s:5745

     1025     5731    3             CASE( 1);

     1026     5732    3               MASK = '0010'B;

   5732  8 001462   001343 236000 1                  LDQ     MASK
         8 001463   000036 376000 9                  ANQ     30
         8 001464   100000 276003                    ORQ     32768,DU
         8 001465   001343 756000 1                  STQ     MASK
         8 001466   001520 710000 8                  TRA     s:5745

     1027     5733    3             CASE( 2);

     1028     5734    3               MASK = '0011'B;

   5734  8 001467   001343 236000 1                  LDQ     MASK
         8 001470   000036 376000 9                  ANQ     30
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:152  
         8 001471   140000 276003                    ORQ     49152,DU
         8 001472   001343 756000 1                  STQ     MASK

     1029     5735    3           END;

   5735  8 001473   001520 710000 8                  TRA     s:5745

     1030     5736    2         ELSE
     1031     5737    3           DO CASE( TYPE);

   5737  8 001474   000003 115007                    CMPA    3,DL
         8 001475   001477 602005 8                  TNC     s:5737+3,AL
         8 001476   001520 710000 8                  TRA     s:5745
         8 001477   001502 710000 8                  TRA     s:5739
         8 001500   001507 710000 8                  TRA     s:5741
         8 001501   001514 710000 8                  TRA     s:5743

     1032     5738    3             CASE( 0);

     1033     5739    3               MASK = '0101'B;

   5739  8 001502   001343 236000 1                  LDQ     MASK
         8 001503   000036 376000 9                  ANQ     30
         8 001504   240000 276003                    ORQ     81920,DU
         8 001505   001343 756000 1                  STQ     MASK
         8 001506   001520 710000 8                  TRA     s:5745

     1034     5740    3             CASE( 1);

     1035     5741    3               MASK = '0001'B;

   5741  8 001507   001343 236000 1                  LDQ     MASK
         8 001510   000036 376000 9                  ANQ     30
         8 001511   040000 276003                    ORQ     16384,DU
         8 001512   001343 756000 1                  STQ     MASK
         8 001513   001520 710000 8                  TRA     s:5745

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:153  
     1036     5742    3             CASE( 2);

     1037     5743    3               MASK = '0111'B;

   5743  8 001514   001343 236000 1                  LDQ     MASK
         8 001515   000036 376000 9                  ANQ     30
         8 001516   340000 276003                    ORQ     114688,DU
         8 001517   001343 756000 1                  STQ     MASK

     1038     5744    3           END;

     1039     5745    2         IF SV.STATE.N THEN

   5745  8 001520   000046 234100                    SZN     38,,PR0
         8 001521   001530 605000 8                  TPL     s:5747

     1040     5746    2          MASK = MASK | '1000'B;

   5746  8 001522   001343 236000 1                  LDQ     MASK
         8 001523   740000 376003                    ANQ     -16384,DU
         8 001524   400000 276003                    ORQ     -131072,DU
         8 001525   001343 676000 1                  ERQ     MASK
         8 001526   740000 376003                    ANQ     -16384,DU
         8 001527   001343 656000 1                  ERSQ    MASK

     1041     5747    2         SV.STATE = MASK;

   5747  8 001530   001343 236000 1                  LDQ     MASK
         8 001531   000046 676100                    ERQ     38,,PR0
         8 001532   740000 376003                    ANQ     -16384,DU
         8 001533   000046 656100                    ERSQ    38,,PR0

     1042     5748    2         RETURN;

   5748  8 001534   000001 702211                    TSX2  ! 1,X1

     1043     5749    2   NOTNOW:
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:154  
     1044     5750    2         SV.STATE.N = TRUE;

   5750  8 001535   400000 236003       NOTNOW       LDQ     -131072,DU
         8 001536   000046 256100                    ORSQ    38,,PR0

     1045     5751    2         IF STATION = SV.OFFER.STATION THEN

   5751  8 001537   040100 106400                    CMPC    fill='040'O
         8 001540   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 001541   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 001542   001546 601000 8                  TNZ     s:5754

     1046     5752    2          SV.MIDO = MSG.MID;

   5752  8 001543   000001 720000 xsym               LXL0    FI_APLCGBUF+1
         8 001544   000047 740100                    STX0    39,,PR0
         8 001545   001550 710000 8                  TRA     s:5755

     1047     5753    2         ELSE
     1048     5754    2          SV.MIDM = MSG.MID;

   5754  8 001546   000001 720000 xsym               LXL0    FI_APLCGBUF+1
         8 001547   000047 440100                    SXL0    39,,PR0

     1049     5755    2         MSG.TYPE = WAIT4CONTROL;

   5755  8 001550   000012 235007                    LDA     10,DL
         8 001551   000000 755000 xsym               STA     FI_APLCGBUF

     1050     5756    2         CALL M$WRITE( WRITECG@) ALTRET(CGERR);

   5756  8 001552   001630 630400 1                  EPPR0   WRITECG@
         8 001553   440001 713400                    CLIMB   alt,write
         8 001554   401400 401760                    pmme    nvectors=4
         8 001555   001560 702000 8                  TSX2    CGERR

     1051     5757    2         ALTRETURN;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:155  

   5757  8 001556   200012 221300                    LDX1  ! L+4,,AUTO
         8 001557   000000 702211                    TSX2  ! 0,X1

     1052     5758    2   CGERR:
     1053     5759    2         IF %E$LDSC = B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.CODE THEN

   5759  8 001560   000000 470400 xsym  CGERR        LDP0    B$TCB$
         8 001561   000000 471500                    LDP1    0,,PR0
         8 001562   100102 236100                    LDQ     66,,PR1
         8 001563   377770 376007                    ANQ     131064,DL
         8 001564   000140 116007                    CMPQ    96,DL
         8 001565   001570 601000 8                  TNZ     s:5761

     1054     5760    2          ALTRETURN;

   5760  8 001566   200012 221300                    LDX1  ! L+4,,AUTO
         8 001567   000000 702211                    TSX2  ! 0,X1

     1055     5761    2         CALL M$MERC;

   5761  8 001570   010007 713400                    CLIMB   4103
         8 001571   000000 401760                    pmme    nvectors=0

     1056     5762    2   END MAYREAD;

   5762  8 001572   200012 221300                    LDX1  ! L+4,,AUTO
         8 001573   000001 702211                    TSX2  ! 1,X1

     1057     5763        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:156  
     1058     5764    1   MAYNOTIFY:

   5764  8 001574   200012 741300       MAYNOTIFY    STX1  ! L+4,,AUTO

     1059     5765    1         PROC;
     1060     5766    2         IF NOT SV.STATE.N THEN

   5766  8 001575   001355 470400 1                  LDP0    SV$
         8 001576   000046 234100                    SZN     38,,PR0
         8 001577   001601 604000 8                  TMI     s:5767+1

     1061     5767    2          RETURN;

   5767  8 001600   000001 702211                    TSX2  ! 1,X1
         8 001601   001603 710000 8                  TRA     s:5770

     1062     5768    2   NOTIFY:
     1063     5769    2         ENTRY;

   5769  8 001602   200012 741300       NOTIFY       STX1  ! L+4,,AUTO

     1064     5770    2         MSG.TYPE = COMPLETED;

   5770  8 001603   000000 450000 xsym               STZ     FI_APLCGBUF

     1065     5771    2         MSG.FIELD1 = 1;

   5771  8 001604   000001 235007                    LDA     1,DL
         8 001605   000003 755000 xsym               STA     FI_APLCGBUF+3

     1066     5772    2         MSG.INAMER = SV$;

   5772  8 001606   001355 236000 1                  LDQ     SV$
         8 001607   000002 756000 xsym               STQ     FI_APLCGBUF+2

     1067     5773    2         IF SV.MIDO > 0 THEN

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:157  
   5773  8 001610   001355 470400 1                  LDP0    SV$
         8 001611   000047 220100                    LDX0    39,,PR0
         8 001612   001646 600000 8                  TZE     s:5792

     1068     5774    3           DO;

     1069     5775    3           MSG.MID = SV.MIDO;

   5775  8 001613   000047 236100                    LDQ     39,,PR0
         8 001614   000022 772000                    QRL     18
         8 001615   000001 756000 xsym               STQ     FI_APLCGBUF+1

     1070     5776    3           STA.STATION#= SV.OFFER.STATION;

   5776  8 001616   040000 100500                    MLR     fill='040'O
         8 001617   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 001620   001332 000010 1                  ADSC9   STA                      cn=0,n=8

     1071     5777    3           CALL M$WRITE( WRITECG@) ALTRET(CGERR);

   5777  8 001621   001630 630400 1                  EPPR0   WRITECG@
         8 001622   440001 713400                    CLIMB   alt,write
         8 001623   401400 401760                    pmme    nvectors=4
         8 001624   001722 702000 8                  TSX2    CGERR

     1072     5778                %DISP(MSG="NOTIFY: Station notified to retry outstanding request",
     1073     5779                STATION="STA.STATION#",CLASS=DEBUG);

   5783  8 001625   001374 235000 1                  LDA     DISPLAYS
         8 001626   000002 115007                    CMPA    2,DL
         8 001627   001640 604000 8                  TMI     s:5790

   5783  8 001630   000010 236000 9                  LDQ     8
         8 001631   200022 756100                    STQ     @LEN+1,,AUTO
         8 001632   000060 237000 9                  LDAQ    48
         8 001633   200020 757100                    STAQ    @NUM+1,,AUTO
         8 001634   000057 236000 9                  LDQ     47
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:158  
         8 001635   200017 756100                    STQ     FIRST+3,,AUTO
         8 001636   005351 701000 8                  TSX1    WRITEMESS
         8 001637   000000 011000                    NOP     0

     1074     5790    3           IF SV.SCNO THEN CALL CLEARSC;

   5790  8 001640   001355 470400 1                  LDP0    SV$
         8 001641   000046 236100                    LDQ     38,,PR0
         8 001642   020000 316003                    CANQ    8192,DU
         8 001643   001646 600000 8                  TZE     s:5792

   5790  8 001644   001734 701000 8                  TSX1    CLEARSC
         8 001645   000000 011000                    NOP     0

     1075     5791    3           END;

     1076     5792    2         IF SV.MIDM > 0 THEN

   5792  8 001646   001355 470400 1                  LDP0    SV$
         8 001647   000047 720100                    LXL0    39,,PR0
         8 001650   001710 600000 8                  TZE     WROTEIT

     1077     5793    3           DO;

     1078     5794    3           MSG.MID = SV.MIDM;

   5794  8 001651   000047 236100                    LDQ     39,,PR0
         8 001652   777777 376007                    ANQ     -1,DL
         8 001653   000001 756000 xsym               STQ     FI_APLCGBUF+1

     1079     5795    3           STA.STATION#= SV.MATCH.STATION;

   5795  8 001654   040000 100500                    MLR     fill='040'O
         8 001655   000037 000010                    ADSC9   31,,PR0                  cn=0,n=8
         8 001656   001332 000010 1                  ADSC9   STA                      cn=0,n=8

     1080     5796    3           IF SV.MATCH.NAME~=MYID THEN CALL M$WRITE(WRITECG@)ALTRET(CGERR);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:159  

   5796  8 001657   040000 106500                    CMPC    fill='040'O
         8 001660   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 001661   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 001662   001667 600000 8                  TZE     s:5802

   5796  8 001663   001630 630400 1                  EPPR0   WRITECG@
         8 001664   440001 713400                    CLIMB   alt,write
         8 001665   401400 401760                    pmme    nvectors=4
         8 001666   001722 702000 8                  TSX2    CGERR

     1081     5797                %DISP(MSG="NOTIFY: Station notified to retry outstanding request",
     1082     5798                STATION="STA.STATION#",CLASS=DEBUG);

   5802  8 001667   001374 235000 1                  LDA     DISPLAYS
         8 001670   000002 115007                    CMPA    2,DL
         8 001671   001702 604000 8                  TMI     s:5809

   5802  8 001672   000010 236000 9                  LDQ     8
         8 001673   200022 756100                    STQ     @LEN+1,,AUTO
         8 001674   000060 237000 9                  LDAQ    48
         8 001675   200020 757100                    STAQ    @NUM+1,,AUTO
         8 001676   000057 236000 9                  LDQ     47
         8 001677   200017 756100                    STQ     FIRST+3,,AUTO
         8 001700   005351 701000 8                  TSX1    WRITEMESS
         8 001701   000000 011000                    NOP     0

     1083     5809    3           IF SV.SCNM THEN CALL CLEARSC;

   5809  8 001702   001355 470400 1                  LDP0    SV$
         8 001703   000046 236100                    LDQ     38,,PR0
         8 001704   010000 316003                    CANQ    4096,DU
         8 001705   001710 600000 8                  TZE     WROTEIT

   5809  8 001706   001734 701000 8                  TSX1    CLEARSC
         8 001707   000000 011000                    NOP     0

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:160  
     1084     5810    3           END;

   5802  8 001710                       WROTEIT      null
     1085     5811    2   WROTEIT:;
     1086     5812    2         STA.STATION# = STATION;

   5812  8 001710   001330 237000 1                  LDAQ    STATION
         8 001711   001332 757000 1                  STAQ    STA

     1087     5813    2         SV.STATE.N = FALSE;

   5813  8 001712   001355 470400 1                  LDP0    SV$
         8 001713   000031 236000 xsym               LDQ     B_VECTNIL+25
         8 001714   000046 356100                    ANSQ    38,,PR0

     1088     5814    2         SV.MIDO = 0;

   5814  8 001715   000000 220003                    LDX0    0,DU
         8 001716   000047 740100                    STX0    39,,PR0

     1089     5815    2         SV.MIDM = 0;

   5815  8 001717   000047 440100                    SXL0    39,,PR0

     1090     5816    2         RETURN;

   5816  8 001720   200012 221300                    LDX1  ! L+4,,AUTO
         8 001721   000001 702211                    TSX2  ! 1,X1

     1091     5817    2   CGERR:
     1092     5818    2         IF %E$LDSC = B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.CODE THEN

   5818  8 001722   000000 470400 xsym  CGERR        LDP0    B$TCB$
         8 001723   000000 471500                    LDP1    0,,PR0
         8 001724   100102 236100                    LDQ     66,,PR1
         8 001725   377770 376007                    ANQ     131064,DL
         8 001726   000140 116007                    CMPQ    96,DL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:161  
         8 001727   001710 600000 8                  TZE     WROTEIT

     1093     5819    2          GOTO WROTEIT;
     1094     5820    2         CALL M$MERC;

   5820  8 001730   010007 713400                    CLIMB   4103
         8 001731   000000 401760                    pmme    nvectors=0

     1095     5821    2   END MAYNOTIFY;

   5821  8 001732   200012 221300                    LDX1  ! L+4,,AUTO
         8 001733   000001 702211                    TSX2  ! 1,X1

     1096     5822        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:162  
     1097     5823    1   CLEARSC: PROC;

   5823  8 001734   200016 741300       CLEARSC      STX1  ! FIRST+2,,AUTO

     1098     5824    2   DCL CLRSCE BIT(1);
     1099     5825    2   DCL OSV$   PTR;
     1100     5826    2         CLRSCE = TRUE;

   5826  8 001735   400000 236003                    LDQ     -131072,DU
         8 001736   200017 756100                    STQ     CLRSCE,,AUTO

     1101     5827    2         GOTO CONTIN;

   5827  8 001737   001742 710000 8                  TRA     CONTIN

     1102     5828    2   CLEARSCN: ENTRY;

   5828  8 001740   200016 741300       CLEARSCN     STX1  ! FIRST+2,,AUTO

     1103     5829    2         CLRSCE = FALSE;

   5829  8 001741   200017 450100                    STZ     CLRSCE,,AUTO

     1104     5830    2   CONTIN:
     1105     5831    2         OSV$ = SV$;

   5831  8 001742   001355 236000 1     CONTIN       LDQ     SV$
         8 001743   200020 756100                    STQ     OSV$,,AUTO

     1106     5832                         /*  To remove $QSC pending from SV entries   */
     1107     5833    2         SV$ = SVHD$;

   5833  8 001744   001370 236000 1                  LDQ     SVHD$
         8 001745   001355 756000 1                  STQ     SV$

     1108     5834    3           DO WHILE(SV$ ~= ADDR(NIL));

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:163  
   5834  8 001746   001777 710000 8                  TRA     s:5848

     1109     5835
     1110     5836    3           IF SV.OFFER.STATION = STA.STATION# THEN

   5836  8 001747   001355 470400 1                  LDP0    SV$
         8 001750   040000 106500                    CMPC    fill='040'O
         8 001751   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 001752   001332 000010 1                  ADSC9   STA                      cn=0,n=8
         8 001753   001763 601000 8                  TNZ     s:5842

     1111     5837    4             DO;

     1112     5838    4             IF CLRSCE THEN SV.SCO = FALSE;

   5838  8 001754   200017 234100                    SZN     CLRSCE,,AUTO
         8 001755   001760 605000 8                  TPL     s:5839

   5838  8 001756   000062 236000 9                  LDQ     50
         8 001757   000046 356100                    ANSQ    38,,PR0

     1113     5839    4             SV.SCNO= FALSE;

   5839  8 001760   000063 236000 9                  LDQ     51
         8 001761   000046 356100                    ANSQ    38,,PR0

     1114     5840    4             END;

   5840  8 001762   001775 710000 8                  TRA     s:5847

     1115     5841    3           ELSE
     1116     5842    3            IF SV.MATCH.STATION = STA.STATION# THEN

   5842  8 001763   040000 106500                    CMPC    fill='040'O
         8 001764   000037 000010                    ADSC9   31,,PR0                  cn=0,n=8
         8 001765   001332 000010 1                  ADSC9   STA                      cn=0,n=8
         8 001766   001775 601000 8                  TNZ     s:5847
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:164  

     1117     5843    4              DO;

     1118     5844    4              IF CLRSCE THEN SV.SCM = FALSE;

   5844  8 001767   200017 234100                    SZN     CLRSCE,,AUTO
         8 001770   001773 605000 8                  TPL     s:5845

   5844  8 001771   000064 236000 9                  LDQ     52
         8 001772   000046 356100                    ANSQ    38,,PR0

     1119     5845    4              SV.SCNM= FALSE;

   5845  8 001773   000065 236000 9                  LDQ     53
         8 001774   000046 356100                    ANSQ    38,,PR0

     1120     5846    4              END;

     1121     5847    3           SV$ = SV.LNK$;

   5847  8 001775   000000 236100                    LDQ     0,,PR0
         8 001776   001355 756000 1                  STQ     SV$

     1122     5848    3           END;

   5848  8 001777   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 002000   001747 601000 8                  TNZ     s:5836

     1123     5849    2         SV$ = OSV$;

   5849  8 002001   200020 236100                    LDQ     OSV$,,AUTO
         8 002002   001355 756000 1                  STQ     SV$

     1124     5850    2         RETURN;

   5850  8 002003   200016 221300                    LDX1  ! FIRST+2,,AUTO
         8 002004   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:165  

     1125     5851    2   END CLEARSC;
     1126     5852        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:166  
     1127     5853    1   SCNOTIFYM: PROC;

   5853  8 002005   200014 741300       SCNOTIFYM    STX1  ! I+1,,AUTO

     1128     5854                /*  To notify SV user that state change has occured   */
     1129     5855    2         MSG.MID = SV.MIDM;

   5855  8 002006   001355 470400 1                  LDP0    SV$
         8 002007   000047 236100                    LDQ     39,,PR0
         8 002010   777777 376007                    ANQ     -1,DL
         8 002011   000001 756000 xsym               STQ     FI_APLCGBUF+1

     1130     5856    2         STA.STATION# = SV.MATCH.STATION;

   5856  8 002012   040000 100500                    MLR     fill='040'O
         8 002013   000037 000010                    ADSC9   31,,PR0                  cn=0,n=8
         8 002014   001332 000010 1                  ADSC9   STA                      cn=0,n=8

     1131     5857    2         IF SV.MATCH.NAME = MYID THEN GOTO WROTIT;

   5857  8 002015   040000 106500                    CMPC    fill='040'O
         8 002016   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 002017   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 002020   002054 600000 8                  TZE     WROTIT

     1132     5858    2         GOTO CONTIN;

   5858  8 002021   002032 710000 8                  TRA     CONTIN

     1133     5859
     1134     5860    2   SCNOTIFYO: ENTRY;

   5860  8 002022   200014 741300       SCNOTIFYO    STX1  ! I+1,,AUTO

     1135     5861    2         MSG.MID = SV.MIDO;

   5861  8 002023   001355 470400 1                  LDP0    SV$
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:167  
         8 002024   000047 236100                    LDQ     39,,PR0
         8 002025   000022 772000                    QRL     18
         8 002026   000001 756000 xsym               STQ     FI_APLCGBUF+1

     1136     5862    2         STA.STATION# = SV.OFFER.STATION;

   5862  8 002027   040000 100500                    MLR     fill='040'O
         8 002030   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 002031   001332 000010 1                  ADSC9   STA                      cn=0,n=8

     1137     5863    2   CONTIN:
     1138     5864              %DISP(MSG="SCNOTIFY: $QSC change",STATION="STA.STATION#",CLASS=DEBUG);

   5866  8 002032                       CONTIN       null
   5868  8 002032   001374 235000 1                  LDA     DISPLAYS
         8 002033   000002 115007                    CMPA    2,DL
         8 002034   002045 604000 8                  TMI     s:5875

   5868  8 002035   000010 236000 9                  LDQ     8
         8 002036   200022 756100                    STQ     @LEN+1,,AUTO
         8 002037   000070 237000 9                  LDAQ    56
         8 002040   200020 757100                    STAQ    OSV$,,AUTO
         8 002041   000057 236000 9                  LDQ     47
         8 002042   200017 756100                    STQ     CLRSCE,,AUTO
         8 002043   005351 701000 8                  TSX1    WRITEMESS
         8 002044   000000 011000                    NOP     0

     1139     5875    2         MSG.TYPE = COMPLETED;

   5875  8 002045   000000 450000 xsym               STZ     FI_APLCGBUF

     1140     5876    2         MSG.FIELD1 = 1;

   5876  8 002046   000001 235007                    LDA     1,DL
         8 002047   000003 755000 xsym               STA     FI_APLCGBUF+3

     1141     5877    2         CALL M$WRITE(WRITECG@) ALTRET(CGERR);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:168  

   5877  8 002050   001630 630400 1                  EPPR0   WRITECG@
         8 002051   440001 713400                    CLIMB   alt,write
         8 002052   401400 401760                    pmme    nvectors=4
         8 002053   002062 702000 8                  TSX2    CGERR

     1142     5878    2   WROTIT:
     1143     5879    2         CALL CLEARSC;

   5879  8 002054   001734 701000 8     WROTIT       TSX1    CLEARSC
         8 002055   000000 011000                    NOP     0

     1144     5880    2         STA.STATION# = STATION;

   5880  8 002056   001330 237000 1                  LDAQ    STATION
         8 002057   001332 757000 1                  STAQ    STA

     1145     5881    2         RETURN;

   5881  8 002060   200014 221300                    LDX1  ! I+1,,AUTO
         8 002061   000001 702211                    TSX2  ! 1,X1

     1146     5882    2   CGERR:
     1147     5883    2         IF %E$LDSC = B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE THEN GOTO WROTIT;

   5883  8 002062   000000 470400 xsym  CGERR        LDP0    B$TCB$
         8 002063   000000 471500                    LDP1    0,,PR0
         8 002064   100102 236100                    LDQ     66,,PR1
         8 002065   377770 376007                    ANQ     131064,DL
         8 002066   000140 116007                    CMPQ    96,DL
         8 002067   002054 600000 8                  TZE     WROTIT

     1148     5884    2         CALL M$MERC;

   5884  8 002070   010007 713400                    CLIMB   4103
         8 002071   000000 401760                    pmme    nvectors=0

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:169  
     1149     5885    2   END SCNOTIFYM;

   5885  8 002072   200014 221300                    LDX1  ! I+1,,AUTO
         8 002073   000001 702211                    TSX2  ! 1,X1

     1150     5886        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:170  
     1151     5887    1   MATCHSC: PROC;

   5887  8 002074   200012 741300       MATCHSC      STX1  ! L+4,,AUTO

     1152     5888                   /*  To determine if an offer exists for a user with
     1153     5889                       a $QSC request outstanding.                       */
     1154     5890    2         IF SV.MATCH.NAME = ' ' THEN RETURN;

   5890  8 002075   001355 470400 1                  LDP0    SV$
         8 002076   040000 106500                    CMPC    fill='040'O
         8 002077   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 002100   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 002101   002103 601000 8                  TNZ     s:5891

   5890  8 002102   000001 702211                    TSX2  ! 1,X1

     1155     5891    2         NEW$ = SV$;

   5891  8 002103   001355 236000 1                  LDQ     SV$
         8 002104   001342 756000 1                  STQ     NEW$

     1156     5892    2         SV$ = SVHD$;

   5892  8 002105   001370 236000 1                  LDQ     SVHD$
         8 002106   001355 756000 1                  STQ     SV$

     1157     5893    3           DO WHILE(SV$ ~= ADDR(NIL));

   5893  8 002107   002133 710000 8                  TRA     s:5905

     1158     5894    3           IF SV.SCDF THEN

   5894  8 002110   001355 470400 1                  LDP0    SV$
         8 002111   000046 430100                    FSZN    38,,PR0
         8 002112   002131 605000 8                  TPL     s:5904

     1159     5895    3            IF SV.OFFER.NAME = NEW$->SV.MATCH.NAME THEN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:171  

   5895  8 002113   001342 471400 1                  LDP1    NEW$
         8 002114   040100 106500                    CMPC    fill='040'O
         8 002115   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 002116   100041 000024                    ADSC9   33,,PR1                  cn=0,n=20
         8 002117   002131 601000 8                  TNZ     s:5904

     1160     5896    4              DO;

     1161     5897    4              IF SV.SCNO THEN      /* If we notify...               */

   5897  8 002120   000046 236100                    LDQ     38,,PR0
         8 002121   020000 316003                    CANQ    8192,DU
         8 002122   002127 600000 8                  TZE     s:5902

     1162     5898    5                DO;

     1163     5899    5                SV.SCO = TRUE;

   5899  8 002123   004000 236003                    LDQ     2048,DU
         8 002124   000046 256100                    ORSQ    38,,PR0

     1164     5900    5                CALL SCNOTIFYO;

   5900  8 002125   002022 701000 8                  TSX1    SCNOTIFYO
         8 002126   000000 011000                    NOP     0

     1165     5901    5                END;

     1166     5902    4              RETURN;

   5902  8 002127   200012 221300                    LDX1  ! L+4,,AUTO
         8 002130   000001 702211                    TSX2  ! 1,X1

     1167     5903    4              END;
     1168     5904    3           SV$ = SV.LNK$;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:172  
   5904  8 002131   000000 236100                    LDQ     0,,PR0
         8 002132   001355 756000 1                  STQ     SV$

     1169     5905    3           END;

   5905  8 002133   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 002134   002110 601000 8                  TNZ     s:5894

     1170     5906    2         RETURN;

   5906  8 002135   200012 221300                    LDX1  ! L+4,,AUTO
         8 002136   000001 702211                    TSX2  ! 1,X1

     1171     5907    2   END MATCHSC;
     1172     5908        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:173  
     1173     5909    1   SVPROCESSOR: PROC ALTRET;

   5909  8 002137   200010 741300       SVPROCESSOR  STX1  ! L+2,,AUTO

     1174     5910
     1175     5911        /*I*    NAME:       FIA$SVPROCESSOR
     1176     5912
     1177     5913                PURPOSE:    To process shared variable reads from other
     1178     5914                            comgroup stations.
     1179     5915
     1180     5916                CALL:       CALL SVPROCESSOR;
     1181     5917
     1182     5918                INPUT:      FI_APLCGBUF
     1183     5919
     1184     5920                DESCRIPTION:
     1185     5921
     1186     5922                   The following functions are performed:
     1187     5923
     1188     5924                   o  If the message includes the "internal" variable name,
     1189     5925                      the name is looked up.  If the name does not exist
     1190     5926                      or if the name doesn't belong to this station, then
     1191     5927                      the station is deactivated.
     1192     5928
     1193     5929                   o  The message type is then investigated to determine
     1194     5930                      whether or not the internal name is required to be
     1195     5931                      present for this type of message.  If this is in
     1196     5932                      error, the station will be deactivated.
     1197     5933
     1198     5934                   o  If the variable whose internal name is supplied has
     1199     5935                      the current station  in awaiting a reply status
     1200     5936                      (SV.STATE.N = true) then the waiting state is removed.
     1201     5937
     1202     5938                   o  One of the following special actions is selected
     1203     5939                      depending upon the field MSG.TYPE:
     1204     5940
     1205     5941                   o  MSG.TYPE = SHARE
     1206     5942
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:174  
     1207     5943                      INPUT:   MSG.INAME      ...   Internal variable name
     1208     5944                               MSG.VNAME      ...   Surrogate name
     1209     5945                               MSG.PARTNER1   ...   Account/Cloneid of msg
     1210     5946                               MSG.PARTNER2   ...   Account/Cloneid of partner
     1211     5947                               MSG.FIELD1     ...   0=:ZASV user,1=CG
     1212     5948                               MSG.FIELD2     ...   0=no value,1=value to come
     1213     5949
     1214     5950                      OUTPUT:  MSG.FIELD1     ...   SV coupling
     1215     5951                               MSG.INAME      ...   Internal variable name
     1216     5952                               MSG.FIELD2     ...   DBFILE KEY
     1217     5953                               MSG.TYPE       ...   COMPLETED
     1218     5954
     1219     5955                      DESCRIPTION:
     1220     5956
     1221     5957                         o  The message is first checked to verify that the
     1222     5958                            station has an associated logon entry.  If there
     1223     5959                            isn't one, it will be created if MSG.PARTNER1
     1224     5960                            is unique and there is table space.  If the
     1225     5961                            processor ID is not unique (MSG.PARTNER1) then
     1226     5962                            MSG.FIELD1 is set to -1 and MSG.FIELD2 is set
     1227     5963                            to zero and the originating station is sent
     1228     5964                            a complete message.
     1229     5965
     1230     5966                         o  If the signon was successful, then the internal
     1231     5967                            variable name is checked.  If non-zero then this
     1232     5968                            is a repetition of a previous offer to share.
     1233     5969                            A complete message is then returned with the
     1234     5970                            shared variable coupling, internal name and
     1235     5971                            key of the variable in the variable database.
     1236     5972
     1237     5973                         o  If the internal name is zero (no internal name
     1238     5974                            specified), then this is a new offer to share.
     1239     5975                            First this offer is checked to see if it matches
     1240     5976                            any previous offers.  If it does the internal
     1241     5977                            name etc are returned.
     1242     5978
     1243     5979                         o  Since it doesn't match an old offer, a new offer
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:175  
     1244     5980                            is then created and its status initialized.
     1245     5981                            The coupling returned in this case is 1.
     1246     5982
     1247     5983
     1248     5984                   o  MSG.TYPE = RETRACT
     1249     5985
     1250     5986                      INPUT:   MSG.INAME      ...   Internal variable name
     1251     5987
     1252     5988                      OUTPUT:  MSG.FIELD1     ...   Previous SV coupling
     1253     5989                               MSG.TYPE       ...   COMPLETED
     1254     5990
     1255     5991                      DESCRIPTION:
     1256     5992
     1257     5993                         o  If the coupling level is 1, then this internal
     1258     5994                            variable name entry is released.
     1259     5995
     1260     5996                         o  Otherwise, if this is the original offerer then
     1261     5997                            the information about the matcher of the offer
     1262     5998                            is moved to replace the offerer.
     1263     5999
     1264     6000                         o  The state of the variable is made to appear as
     1265     6001                            though the matcher has just assigned a value to
     1266     6002                            the shared variable (in spite of any interlocks).
     1267     6003
     1268     6004                         o  If the offerer has an outstanding request for the
     1269     6005                            variable then he is awakened.
     1270     6006
     1271     6007                         o  The coupling of the variable is demotted to 1.
     1272     6008
     1273     6009                         o  This offer is re-linked at the tail of the current
     1274     6010                            offers.
     1275     6011
     1276     6012                         o  If the other user is awaiting a state change, then
     1277     6013                            he is awakened.
     1278     6014
     1279     6015
     1280     6016                   o  MSG.TYPE = SETACV
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:176  
     1281     6017
     1282     6018                      INPUT:   MSG.INAME      ...   Internal variable name
     1283     6019                               MSG.FIELD1     ...   User's ACV contribution
     1284     6020
     1285     6021                      OUTPUT:  MSG.FIELD1     ...   New ACV.
     1286     6022                               MSG.TYPE       ...   COMPLETED
     1287     6023
     1288     6024                      DESCRIPTION:
     1289     6025
     1290     6026                         o  The users access control vector contribution is
     1291     6027                            set as indicated by bits 32-35 of MSG.FIELD1.
     1292     6028
     1293     6029                         o  The resulting access control vector for this
     1294     6030                            variable is returned (logical sum of user and
     1295     6031                            partner) in bits 32-35 of MSG.FIELD1.
     1296     6032
     1297     6033
     1298     6034                   o  MSG.TYPE = GETACV
     1299     6035
     1300     6036                      INPUT:   MSG.INAME      ...   Internal variable name
     1301     6037
     1302     6038                      OUTPUT:  MSG.FIELD1     ...   Current ACV.
     1303     6039                               MSG.TYPE       ...   COMPLETED
     1304     6040
     1305     6041                      DESCRIPTION:
     1306     6042
     1307     6043                         o  The resulting access control vector for this
     1308     6044                            variable is returned (logical sum of user and
     1309     6045                            partner) in bits 32-35 of MSG.FIELD1.
     1310     6046
     1311     6047
     1312     6048                   o  MSG.TYPE = PREREAD/PREWRITE
     1313     6049
     1314     6050                      INPUT:   MSG.INAME      ...   Internal variable name
     1315     6051
     1316     6052                      OUTPUT:  MSG.INAME      ...   Database Key
     1317     6053                               MSG.FIELD1     ...   Size of DB for READ
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:177  
     1318     6054                               MSG.TYPE       ...   COMPLETED/WAIT4CONTROL
     1319     6055
     1320     6056                      DESCRIPTION:
     1321     6057
     1322     6058                         o  If the other station currently has control,
     1323     6059                            or if the access control matrix prevents giving
     1324     6060                            access at this time, the response is WAIT4CONTROL,
     1325     6061                            SV.STATE.N is set to true and the current message
     1326     6062                            ID is set in SV.MIDO/M.
     1327     6063
     1328     6064                            A COMPLETED message following a WAIT4CONTROL
     1329     6065                            message is to be interpreted by the station as
     1330     6066                            a request to repeat the PREREAD/PREWRITE/SEIZE
     1331     6067                            message that blocked them.
     1332     6068
     1333     6069                         o  If control can be granted, the SV.STATE is set
     1334     6070                            to indicate that it has been given and the key
     1335     6071                            of the variables datablock and the size of the
     1336     6072                            datablock are returned to the requestor in the
     1337     6073                            COMPLETED message.
     1338     6074
     1339     6075
     1340     6076                   o  MSG.TYPE = SEIZE
     1341     6077
     1342     6078                      INPUT:   MSG.INAME      ...   Internal variable name
     1343     6079
     1344     6080                      OUTPUT:  MSG.FIELD1     ...   Size of variable
     1345     6081                               MSG.INAME      ...   Database KEY
     1346     6082                               MSG.TYPE       ...   COMPLETED/WAIT4CONTROL
     1347     6083
     1348     6084                      DESCRIPTION:
     1349     6085
     1350     6086                         o  This message is the same as the PREREAD and
     1351     6087                            PREWRITE commands except that access controls
     1352     6088                            are ignored in determining whether to grant
     1353     6089                            access.
     1354     6090
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:178  
     1355     6091
     1356     6092                   o  MSG.TYPE = GETASM
     1357     6093
     1358     6094                      INPUT:   MSG.INAME      ...   Internal variable name
     1359     6095
     1360     6096                      OUTPUT:  MSG.FIELD1     ...   Current SV state matrix
     1361     6097                               MSG.TYPE       ...   COMPLETED
     1362     6098
     1363     6099                      DESCRIPTION:
     1364     6100
     1365     6101                         o  The shared variable state matrix for this
     1366     6102                            variable is returned in bits 32-35 of MSG.FIELD1.
     1367     6103
     1368     6104
     1369     6105                   o  MSG.TYPE = SIGNON
     1370     6106
     1371     6107                      INPUT:   MSG.PARTNER1   ...   Proposed processor ID
     1372     6108                               MSG.FIELD1     ...   0=:ZASV user,1=CG
     1373     6109
     1374     6110                      OUTPUT:  MSG.FIELD1     ...   Signon status
     1375     6111                               MSG.TYPE       ...   COMPLETED
     1376     6112
     1377     6113                      DESCRIPTION:
     1378     6114
     1379     6115                         o  If the proposed processor ID is unique a signon
     1380     6116                            block is allocated for this station and
     1381     6117                            MSG.FIELD1 is returned as 1.
     1382     6118
     1383     6119                         o  Otherwise, either the processor ID is a duplicate
     1384     6120                            or no space is available for the ID and MSG.FIELD1
     1385     6121                            is returned as 0.
     1386     6122
     1387     6123
     1388     6124                   o  MSG.TYPE = RELEASE
     1389     6125
     1390     6126                      INPUT:   MSG.INAME      ...   Internal variable name
     1391     6127                               MSG.FIELD1     ...   Size of DB or Zero.
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:179  
     1392     6128
     1393     6129                      OUTPUT:  MSG.TYPE       ...   COMPLETED
     1394     6130
     1395     6131                      DESCRIPTION:
     1396     6132
     1397     6133                         o  The size of the datablock is saved in SV.DBSIZE
     1398     6134                            if MSG.FIELD1 is non-zero.
     1399     6135
     1400     6136                         o  The variable's state matrix is set according to
     1401     6137                            the operation that has just occured.
     1402     6138
     1403     6139                         o  If the partner is waiting for access, he is sent
     1404     6140                            a reply to retry his request.
     1405     6141
     1406     6142                         o  SV.STATE is reset to reflect the variable being
     1407     6143                            free.
     1408     6144
     1409     6145
     1410     6146                   o  MSG.TYPE = QUERY
     1411     6147
     1412     6148                      INPUT:   MSG.PARTNER1   ...   Account/Cloneid of msg
     1413     6149                               MSG.PARTNER2   ...   Account/Cloneid of partner
     1414     6150                               MSG.FIELD1     ...   0=:ZASV user,1=CG
     1415     6151
     1416     6152                      OUTPUT:  MSG.FIELD1     ...   Database Key
     1417     6153                               MSG.INAME      ...   Size of Query rs datablock
     1418     6154                               MSG.FIELD2     ...   Maximum row length
     1419     6155                               MSG.TYPE       ...   COMPLETED
     1420     6156
     1421     6157                      DESCRIPTION:
     1422     6158
     1423     6159                         o  The current stations signon is verified as in
     1424     6160                            the SHARE command.
     1425     6161
     1426     6162                         o  If MSG.PARTNER2 is blank then this is a request
     1427     6163                            for a list of the accounts offering variables
     1428     6164                            to this processor.  All of the variable entries
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:180  
     1429     6165                            of coupling level 1 are scanned extracting the
     1430     6166                            processor IDs that are making either general
     1431     6167                            offers to share or a specific offer to share with
     1432     6168                            this processor.  The resulting APL datablock is
     1433     6169                            written to the file using the key in this stations
     1434     6170                            signon record.
     1435     6171
     1436     6172                         o  If MSG.PARTNER2 is non-blank then this is a
     1437     6173                            request for the list of variables being offered to
     1438     6174                            this processor by the processor identified in
     1439     6175                            MSG.PARTNER2.  An APL datablock is created and
     1440     6176                            returned with the variable names one per row
     1441     6177                            in an N by 80 matrix.
     1442     6178
     1443     6179
     1444     6180                   o  MSG.TYPE = STATECHANGE
     1445     6181
     1446     6182                      INPUT:   MSG.PARTNER1   ...   Processor ID
     1447     6183                               MSG.FIELD1     ...   0=:ZASV user,1=CG
     1448     6184
     1449     6185                      OUTPUT:  MSG.FIELD1     ...   Status of request
     1450     6186
     1451     6187                      DESCRIPTION:
     1452     6188
     1453     6189                         o  The current stations signon is verified as in
     1454     6190                            the SHARE command.
     1455     6191
     1456     6192                         o  All of the variables shared by this station are
     1457     6193                            scanned looking for a variable entry with SV.SCO/M
     1458     6194                            set (which indicates that a statechange has
     1459     6195                            occured since this command was last issued).
     1460     6196
     1461     6197                         o  If no change has occured then SV.SCNO/M is set to
     1462     6198                            indicate that when a state change does occur that
     1463     6199                            this station is to be notified.
     1464     6200
     1465     6201                         o  When a state change does occur (or has been found)
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:181  
     1466     6202                            then all of the SV entries are scanned, resetting
     1467     6203                            the SV.SCNO/M and SV.SCO/M fields.
     1468     6204
     1469     6205                         o  MSG.FIELD1 is returned as zero if a valid signon
     1470     6206                            was not achieved, otherwise, MSG.FIELD1 is
     1471     6207                            returned as 1.
     1472     6208
     1473     6209                         o  The SV.SCNO/M field is interrogated when a
     1474     6210                            variable is retracted, or when the command
     1475     6211                            RELEASE is issued, when an offer is matched
     1476     6212                            or when a new offer is made specifically to this
     1477     6213                            station.
     1478     6214
     1479     6215
     1480     6216                   o  MSG.TYPE = GETDATA
     1481     6217
     1482     6218                      INPUT:   MSG.INAME      ...   Internal variable name
     1483     6219
     1484     6220                      OUTPUT:  MSG.VNAME      ...   Current SV state matrix
     1485     6221                               MSG.TYPE       ...   GETDATA
     1486     6222
     1487     6223                      DESCRIPTION:
     1488     6224
     1489     6225                         o  If the internal variable name was not specified,
     1490     6226                            then this is treated as an attempt to read the
     1491     6227                            latest $QSVQ result.  Otherwise it is the value
     1492     6228                            of the variable specified.
     1493     6229
     1494     6230                         o  If the variable state indicates that the
     1495     6231                            appropriate MAYREAD or MAYSEIZE command didn't
     1496     6232                            precede this message then the station is
     1497     6233                            deactivated.
     1498     6234
     1499     6235                         o  Otherwise, a variable length record is written
     1500     6236                            in response which contains the APL datablock
     1501     6237                            starting at position MSG.VNAME.
     1502     6238
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:182  
     1503     6239
     1504     6240                   o  MSG.TYPE = PUTDATA
     1505     6241
     1506     6242                      INPUT:   MSG.INAME      ...   Internal variable name
     1507     6243                               MSG.VNAME      ...   APL Datablock
     1508     6244
     1509     6245                      OUTPUT:  *NONE*
     1510     6246
     1511     6247                      DESCRIPTION:
     1512     6248
     1513     6249                         o  If the variable state indicates that the
     1514     6250                            appropriate MAYWRITE command didn't precede
     1515     6251                            this message then the station is deactivated.
     1516     6252
     1517     6253                         o  Otherwise, the datablock type and rank are
     1518     6254                            verified, if illegal then the station is
     1519     6255                            deactivated.
     1520     6256
     1521     6257                         o  Finally, the variable length message is read
     1522     6258                            from the comgroup (if not completed already)
     1523     6259                            and written to the variable database file.
     1524     6260
     1525     6261
     1526     6262
     1527     6263
     1528     6264                                                                            */
     1529     6265
     1530     6266
     1531     6267    2         STATION=FI_EVNT$->FI$EVNT.CITE$->FI$APLRD.NAME;

   6267  8 002140   000000 470400 xsym               LDP0    FI_EVNT$
         8 002141   000002 471500                    LDP1    2,,PR0
         8 002142   040000 100500                    MLR     fill='040'O
         8 002143   100004 000010                    ADSC9   4,,PR1                   cn=0,n=8
         8 002144   001330 000010 1                  ADSC9   STATION                  cn=0,n=8

     1532     6268    2         STA.STATION# = STATION;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:183  

   6268  8 002145   001330 237000 1                  LDAQ    STATION
         8 002146   001332 757000 1                  STAQ    STA

     1533     6269    2         IF MSG.INAME ~= 0 THEN

   6269  8 002147   000002 235000 xsym               LDA     FI_APLCGBUF+2
         8 002150   002303 600000 8                  TZE     s:6328

     1534     6270    3           DO;

     1535     6271    3           SV$ = SVHD$;

   6271  8 002151   001370 236000 1                  LDQ     SVHD$
         8 002152   001355 756000 1                  STQ     SV$

     1536     6272    4             DO WHILE SV$ ~= ADDR(NIL);

   6272  8 002153   002162 710000 8                  TRA     s:6275

     1537     6273    4             IF SV$ = MSG.INAMER THEN GOTO SVISOK;

   6273  8 002154   001355 236000 1                  LDQ     SV$
         8 002155   000002 116000 xsym               CMPQ    FI_APLCGBUF+2
         8 002156   002177 600000 8                  TZE     SVISOK

     1538     6274    4             SV$ = SV.LNK$;

   6274  8 002157   001355 470400 1                  LDP0    SV$
         8 002160   000000 236100                    LDQ     0,,PR0
         8 002161   001355 756000 1                  STQ     SV$

     1539     6275    4             END;

   6275  8 002162   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 002163   002154 601000 8                  TNZ     s:6273

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:184  
     1540     6276                %DISP(MSG="SVPROCESSOR: INAME does not exist",CLASS=ERROR);

   6280  8 002164   001374 235000 1                  LDA     DISPLAYS
         8 002165   002176 604400 8                  TMOZ    s:6283

   6280  8 002166   000072 236000 9                  LDQ     58
         8 002167   200022 756100                    STQ     @LEN+1,,AUTO
         8 002170   000074 237000 9                  LDAQ    60
         8 002171   200020 757100                    STAQ    OSV$,,AUTO
         8 002172   000006 236000 9                  LDQ     6
         8 002173   200017 756100                    STQ     CLRSCE,,AUTO
         8 002174   005351 701000 8                  TSX1    WRITEMESS
         8 002175   000000 011000                    NOP     0

   6283  8 002176   005314 710000 8                  TRA     RIDSTATION

     1541     6287    3   SVISOK:
     1542     6288    3           IF SV_NOT_ALLOWED(MSG.TYPE) THEN

   6288  8 002177   000000 235000 xsym  SVISOK       LDA     FI_APLCGBUF
         8 002200   000000 066405                    CMPB    filb='0'B
         8 002201   000614 000001 2                  BDSC    SV_NOT_ALLOWED,A         by=0,bit=0,n=1
         8 002202   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         8 002203   002217 600000 8                  TZE     s:6300

     1543     6289                 %DISP(MSG="SVPROCESSOR: INAME not legal here",CLASS=ERROR);

   6293  8 002204   001374 235000 1                  LDA     DISPLAYS
         8 002205   002216 604400 8                  TMOZ    s:6296

   6293  8 002206   000072 236000 9                  LDQ     58
         8 002207   200022 756100                    STQ     @LEN+1,,AUTO
         8 002210   000076 237000 9                  LDAQ    62
         8 002211   200020 757100                    STAQ    OSV$,,AUTO
         8 002212   000006 236000 9                  LDQ     6
         8 002213   200017 756100                    STQ     CLRSCE,,AUTO
         8 002214   005351 701000 8                  TSX1    WRITEMESS
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:185  
         8 002215   000000 011000                    NOP     0

   6296  8 002216   005314 710000 8                  TRA     RIDSTATION

     1544     6300    3           IF STATION = SV.OFFER.STATION THEN

   6300  8 002217   001355 470400 1                  LDP0    SV$
         8 002220   040100 106400                    CMPC    fill='040'O
         8 002221   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 002222   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 002223   002237 601000 8                  TNZ     s:6307

     1545     6301    4             DO;

     1546     6302    4             IF SV.SCNO THEN CALL CLEARSCN;

   6302  8 002224   000046 236100                    LDQ     38,,PR0
         8 002225   020000 316003                    CANQ    8192,DU
         8 002226   002231 600000 8                  TZE     s:6303

   6302  8 002227   001740 701000 8                  TSX1    CLEARSCN
         8 002230   000000 011000                    NOP     0

     1547     6303    4             SV$ = MSG.INAMER;

   6303  8 002231   000002 236000 xsym               LDQ     FI_APLCGBUF+2
         8 002232   001355 756000 1                  STQ     SV$

     1548     6304    4             SV.MIDO = 0;

   6304  8 002233   000000 220003                    LDX0    0,DU
         8 002234   001355 470400 1                  LDP0    SV$
         8 002235   000047 740100                    STX0    39,,PR0

     1549     6305    4             END;

   6305  8 002236   002271 710000 8                  TRA     s:6326
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:186  

     1550     6306    3           ELSE
     1551     6307    3            IF STATION = SV.MATCH.STATION THEN

   6307  8 002237   040100 106400                    CMPC    fill='040'O
         8 002240   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 002241   000037 000010                    ADSC9   31,,PR0                  cn=0,n=8
         8 002242   002256 601000 8                  TNZ     s:6318

     1552     6308    4              DO;

     1553     6309    4              IF SV.SCNM THEN CALL CLEARSCN;

   6309  8 002243   000046 236100                    LDQ     38,,PR0
         8 002244   010000 316003                    CANQ    4096,DU
         8 002245   002250 600000 8                  TZE     s:6310

   6309  8 002246   001740 701000 8                  TSX1    CLEARSCN
         8 002247   000000 011000                    NOP     0

     1554     6310    4              SV$ = MSG.INAMER;

   6310  8 002250   000002 236000 xsym               LDQ     FI_APLCGBUF+2
         8 002251   001355 756000 1                  STQ     SV$

     1555     6311    4              SV.MIDM = 0;

   6311  8 002252   000000 220003                    LDX0    0,DU
         8 002253   001355 470400 1                  LDP0    SV$
         8 002254   000047 440100                    SXL0    39,,PR0

     1556     6312    4              END;

   6312  8 002255   002271 710000 8                  TRA     s:6326

     1557     6313    3            ELSE
     1558     6314                  %DISP(MSG="SVPROCESSOR: INAME is not one of yours",CLASS=ERROR);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:187  

   6318  8 002256   001374 235000 1                  LDA     DISPLAYS
         8 002257   002270 604400 8                  TMOZ    s:6321

   6318  8 002260   000072 236000 9                  LDQ     58
         8 002261   200022 756100                    STQ     @LEN+1,,AUTO
         8 002262   000100 237000 9                  LDAQ    64
         8 002263   200020 757100                    STAQ    OSV$,,AUTO
         8 002264   000006 236000 9                  LDQ     6
         8 002265   200017 756100                    STQ     CLRSCE,,AUTO
         8 002266   005351 701000 8                  TSX1    WRITEMESS
         8 002267   000000 011000                    NOP     0

   6321  8 002270   005314 710000 8                  TRA     RIDSTATION

     1559     6325
     1560     6326    3           IF SV.MIDO+SV.MIDM = 0 THEN SV.STATE.N = FALSE;

   6326  8 002271   000047 236100                    LDQ     39,,PR0
         8 002272   777777 376007                    ANQ     -1,DL
         8 002273   200032 756100                    STQ     STX+3,,AUTO
         8 002274   000047 236100                    LDQ     39,,PR0
         8 002275   000022 772000                    QRL     18
         8 002276   200032 036100                    ADLQ    STX+3,,AUTO
         8 002277   002323 601000 8                  TNZ     s:6340

   6326  8 002300   000031 236000 xsym               LDQ     B_VECTNIL+25
         8 002301   000046 356100                    ANSQ    38,,PR0

     1561     6327    3           END;

   6327  8 002302   002323 710000 8                  TRA     s:6340

     1562     6328    2         ELSE IF SV_REQUIRED(MSG.TYPE) THEN

   6328  8 002303   000000 235000 xsym               LDA     FI_APLCGBUF
         8 002304   000000 066405                    CMPB    filb='0'B
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:188  
         8 002305   000615 000001 2                  BDSC    SV_REQUIRED,A            by=0,bit=0,n=1
         8 002306   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         8 002307   002323 600000 8                  TZE     s:6340

     1563     6329                %DISP(MSG="SVPROCESSOR: INAME is required here",CLASS=ERROR);

   6333  8 002310   001374 235000 1                  LDA     DISPLAYS
         8 002311   002322 604400 8                  TMOZ    s:6336

   6333  8 002312   000072 236000 9                  LDQ     58
         8 002313   200022 756100                    STQ     @LEN+1,,AUTO
         8 002314   000102 237000 9                  LDAQ    66
         8 002315   200020 757100                    STAQ    OSV$,,AUTO
         8 002316   000006 236000 9                  LDQ     6
         8 002317   200017 756100                    STQ     CLRSCE,,AUTO
         8 002320   005351 701000 8                  TSX1    WRITEMESS
         8 002321   000000 011000                    NOP     0

   6336  8 002322   005314 710000 8                  TRA     RIDSTATION

     1564     6340    3           DO CASE( MSG.TYPE);

   6340  8 002323   000000 235000 xsym               LDA     FI_APLCGBUF
         8 002324   000022 115007                    CMPA    18,DL
         8 002325   002327 602005 8                  TNC     s:6340+4,AL
         8 002326   005314 710000 8                  TRA     RIDSTATION
         8 002327   005314 710000 8                  TRA     RIDSTATION
         8 002330   002351 710000 8                  TRA     s:6347
         8 002331   002677 710000 8                  TRA     s:6461
         8 002332   003125 710000 8                  TRA     s:6536
         8 002333   003163 710000 8                  TRA     s:6553
         8 002334   003246 710000 8                  TRA     s:6570
         8 002335   003313 710000 8                  TRA     s:6593
         8 002336   003341 710000 8                  TRA     s:6609
         8 002337   003616 710000 8                  TRA     s:6727
         8 002340   004162 710000 8                  TRA     s:6860
         8 002341   005314 710000 8                  TRA     RIDSTATION
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:189  
         8 002342   005314 710000 8                  TRA     RIDSTATION
         8 002343   003372 710000 8                  TRA     s:6624
         8 002344   005314 710000 8                  TRA     RIDSTATION
         8 002345   003525 710000 8                  TRA     s:6686
         8 002346   004503 710000 8                  TRA     s:6939
         8 002347   005000 710000 8                  TRA     s:7076
         8 002350   003435 710000 8                  TRA     s:6647

     1565     6341        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:190  
     1566     6342    3             CASE( SHARE);

     1567     6343                    %DISP(MSG="$QSVO: Offer to share");

   6347  8 002351   001374 236000 1                  LDQ     DISPLAYS
         8 002352   000003 116007                    CMPQ    3,DL
         8 002353   002364 604000 8                  TMI     s:6354

   6347  8 002354   000003 236000 9                  LDQ     3
         8 002355   200022 756100                    STQ     @LEN+1,,AUTO
         8 002356   000104 237000 9                  LDAQ    68
         8 002357   200020 757100                    STAQ    OSV$,,AUTO
         8 002360   000006 236000 9                  LDQ     6
         8 002361   200017 756100                    STQ     CLRSCE,,AUTO
         8 002362   005351 701000 8                  TSX1    WRITEMESS
         8 002363   000000 011000                    NOP     0

     1568     6354    3               IF MSG.INAME = 0 THEN

   6354  8 002364   000002 235000 xsym               LDA     FI_APLCGBUF+2
         8 002365   002615 601000 8                  TNZ     s:6429

     1569     6355    4                 DO;

     1570     6356    4                 CALL CHECKSIGNON ALTRET(SHERR);

   6356  8 002366   001125 701000 8                  TSX1    CHECKSIGNON
         8 002367   002663 702000 8                  TSX2    SHERR

     1571     6357    4                 SV$ = SVHD$;

   6357  8 002370   001370 236000 1                  LDQ     SVHD$
         8 002371   001355 756000 1                  STQ     SV$

     1572     6358    4                 NEW$ = ADDR( NIL);

   6358  8 002372   000001 236000 xsym               LDQ     B_VECTNIL+1
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:191  
         8 002373   001342 756000 1                  STQ     NEW$

     1573     6359    5                   DO WHILE (SV$ ~= ADDR(NIL));

   6359  8 002374   002402 710000 8                  TRA     s:6362

     1574     6360    5                   CALL MAYMATCH ALTRET( LEAVE);

   6360  8 002375   000577 701000 8                  TSX1    MAYMATCH
         8 002376   005331 702000 8                  TSX2    A1

     1575     6361    5                   SV$ = SV$->SV.LNK$;

   6361  8 002377   001355 470400 1                  LDP0    SV$
         8 002400   000000 236100                    LDQ     0,,PR0
         8 002401   001355 756000 1                  STQ     SV$

     1576     6362    5                   END;

   6362  8 002402   001355 236000 1                  LDQ     SV$
         8 002403   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 002404   002375 601000 8                  TNZ     s:6360

     1577     6363    4                 CALL FOI$GBUF (SVSCB,SVX$) ALTRET(NOSVS);

   6363  8 002405   000014 630400 9                  EPPR0   12
         8 002406   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002407   000000 701000 xent               TSX1    FOI$GBUF
         8 002410   002422 702000 8                  TSX2    NOSVS

     1578     6364    4                 SV$ = SVX$;

   6364  8 002411   001356 236000 1                  LDQ     SVX$
         8 002412   001355 756000 1                  STQ     SV$

     1579     6365    4                 SV$->SV=SV_INIT;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:192  
   6365  8 002413   001355 470400 1                  LDP0    SV$
         8 002414   000100 100400                    MLR     fill='000'O
         8 002415   000002 000240 2                  ADSC9   SV_INIT                  cn=0,n=160
         8 002416   000000 000240                    ADSC9   0,,PR0                   cn=0,n=160

     1580     6366    4                 CALL SVLINK;

   6366  8 002417   000503 701000 8                  TSX1    SVLINK
         8 002420   000000 011000                    NOP     0

     1581     6367    4                 GOTO NEWSV;

   6367  8 002421   002444 710000 8                  TRA     NEWSV

   6365  8 002422                       NOSVS        null
     1582     6368    4   NOSVS:        ;
     1583     6369                      %DISP(MSG="Reporting NOSPACE for offer or signon",CLASS=DEBUG);

   6373  8 002422   001374 235000 1                  LDA     DISPLAYS
         8 002423   000002 115007                    CMPA    2,DL
         8 002424   002435 604000 8                  TMI     s:6380

   6373  8 002425   000010 236000 9                  LDQ     8
         8 002426   200022 756100                    STQ     @LEN+1,,AUTO
         8 002427   000110 237000 9                  LDAQ    72
         8 002430   200020 757100                    STAQ    OSV$,,AUTO
         8 002431   000006 236000 9                  LDQ     6
         8 002432   200017 756100                    STQ     CLRSCE,,AUTO
         8 002433   005351 701000 8                  TSX1    WRITEMESS
         8 002434   000000 011000                    NOP     0

     1584     6380    4                 MSG.TYPE = NOSPACE;

   6380  8 002435   000013 235007                    LDA     11,DL
         8 002436   000000 755000 xsym               STA     FI_APLCGBUF

     1585     6381    4                 CALL M$WRITE( WRITECG@) ALTRET( CGERR);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:193  

   6381  8 002437   001630 630400 1                  EPPR0   WRITECG@
         8 002440   440001 713400                    CLIMB   alt,write
         8 002441   401400 401760                    pmme    nvectors=4
         8 002442   005333 702000 8                  TSX2    CGERR

     1586     6382    4                 GOTO LEAVE;

   6382  8 002443   005331 710000 8                  TRA     A1

   6380  8 002444                       NEWSV        null
     1587     6383    4   NEWSV:        ;
     1588     6384                      %DISP(MSG="$QSVO: Entering unmatched offer",CLASS=DEBUG);

   6388  8 002444   001374 235000 1                  LDA     DISPLAYS
         8 002445   000002 115007                    CMPA    2,DL
         8 002446   002457 604000 8                  TMI     s:6395

   6388  8 002447   000010 236000 9                  LDQ     8
         8 002450   200022 756100                    STQ     @LEN+1,,AUTO
         8 002451   000112 237000 9                  LDAQ    74
         8 002452   200020 757100                    STAQ    OSV$,,AUTO
         8 002453   000006 236000 9                  LDQ     6
         8 002454   200017 756100                    STQ     CLRSCE,,AUTO
         8 002455   005351 701000 8                  TSX1    WRITEMESS
         8 002456   000000 011000                    NOP     0

     1589     6395    4                 SV.SURROGATE = MSG.VNAME;

   6395  8 002457   001355 470400 1                  LDP0    SV$
         8 002460   040100 100400                    MLR     fill='040'O
         8 002461   000017 000116 xsym               ADSC9   FI_APLCGBUF+15           cn=0,n=78
         8 002462   000002 400116                    ADSC9   2,,PR0                   cn=2,n=78

     1590     6396    4                 CALL INDEX(TEMP, ' ', MSG.VNAME);

   6396  8 002463   000000 124400                    SCM     mask='000'O
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:194  
         8 002464   000017 000120 xsym               ADSC9   FI_APLCGBUF+15           cn=0,n=80
         8 002465   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 002466   001345 000000 1                  ARG     TEMP

     1591     6397    4                 SV.SURRLEN = TEMP;

   6397  8 002467   001345 236000 1                  LDQ     TEMP
         8 002470   000022 736000                    QLS     18
         8 002471   000046 552120                    STBQ    38,'20'O,PR0

     1592     6398    4                 SV.INAMER = SV$;

   6398  8 002472   001355 236000 1                  LDQ     SV$
         8 002473   000026 756100                    STQ     22,,PR0

     1593     6399    4                 IF SVSIGNON$->SV.DBKEY < %SELECTOR

   6399  8 002474   001357 471400 1                  LDP1    SVSIGNON$
         8 002475   100027 235100                    LDA     23,,PR1
         8 002476   000032 115000 9                  CMPA    26
         8 002477   002503 603000 8                  TRC     s:6401

     1594     6400    4                 THEN SV.DBKEY = KEYVAL;

   6400  8 002500   001344 235000 1                  LDA     KEYVAL
         8 002501   000027 755100                    STA     23,,PR0
         8 002502   002506 710000 8                  TRA     s:6402

     1595     6401    4                 ELSE SV.DBKEY = KEYVAL+%SELECTOR;

   6401  8 002503   001344 235000 1                  LDA     KEYVAL
         8 002504   000032 035000 9                  ADLA    26
         8 002505   000027 755100                    STA     23,,PR0

     1596     6402    4                 KEYVAL = KEYVAL + 1;

   6402  8 002506   001344 235000 1                  LDA     KEYVAL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:195  
         8 002507   000001 035007                    ADLA    1,DL
         8 002510   001344 755000 1                  STA     KEYVAL

     1597     6403    4                 IF KEYVAL >= %SELECTOR THEN KEYVAL = 1;

   6403  8 002511   000032 115000 9                  CMPA    26
         8 002512   002515 602000 8                  TNC     s:6404

   6403  8 002513   000001 235007                    LDA     1,DL
         8 002514   001344 755000 1                  STA     KEYVAL

     1598     6404    4                 SV.OFFER.STATION = STATION;

   6404  8 002515   001330 237000 1                  LDAQ    STATION
         8 002516   000030 755100                    STA     24,,PR0
         8 002517   000031 756100                    STQ     25,,PR0

     1599     6405    4                 SV.OFFER.NAME = MSG.PARTNER1;

   6405  8 002520   040100 100400                    MLR     fill='040'O
         8 002521   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
         8 002522   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20

     1600     6406    4                 SV.MATCH.STATION = ' ';

   6406  8 002523   000035 235000 xsym               LDA     B_VECTNIL+29
         8 002524   000035 236000 xsym               LDQ     B_VECTNIL+29
         8 002525   000037 755100                    STA     31,,PR0
         8 002526   000040 756100                    STQ     32,,PR0

     1601     6407    4                 SV.MATCH.NAME = MSG.PARTNER2;

   6407  8 002527   040100 100400                    MLR     fill='040'O
         8 002530   000012 000024 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=20
         8 002531   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20

     1602     6408    4                 SV.COUPLING = 1;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:196  

   6408  8 002532   000002 236100                    LDQ     2,,PR0
         8 002533   000022 376000 9                  ANQ     18
         8 002534   000001 276003                    ORQ     1,DU
         8 002535   000002 756100                    STQ     2,,PR0

     1603     6409    4                 SV.STATE = INITIAL;

   6409  8 002536   000036 236000 9                  LDQ     30
         8 002537   000046 356100                    ANSQ    38,,PR0

     1604     6410    4                 SV.ASMO = '0011'B;

   6410  8 002540   000002 236100                    LDQ     2,,PR0
         8 002541   000036 376000 9                  ANQ     30
         8 002542   140000 276003                    ORQ     49152,DU
         8 002543   000002 756100                    STQ     2,,PR0

     1605     6411    4                 SV.ASMM = '0011'B;

   6411  8 002544   000002 236100                    LDQ     2,,PR0
         8 002545   000037 376000 9                  ANQ     31
         8 002546   006000 276003                    ORQ     3072,DU
         8 002547   000002 756100                    STQ     2,,PR0

     1606     6412    4                 SV.ACVO = INITIAL;

   6412  8 002550   000114 236000 9                  LDQ     76
         8 002551   000002 356100                    ANSQ    2,,PR0

     1607     6413    4                 SV.ACVM = INITIAL;

   6413  8 002552   000027 236000 9                  LDQ     23
         8 002553   000002 356100                    ANSQ    2,,PR0

     1608     6414    4                 SV.DBSIZE = 0;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:197  
   6414  8 002554   000000 220003                    LDX0    0,DU
         8 002555   000046 440100                    SXL0    38,,PR0

     1609     6415    4                 SV.MIDO = 0;

   6415  8 002556   000047 740100                    STX0    39,,PR0

     1610     6416    4                 SV.MIDM = 0;

   6416  8 002557   000047 440100                    SXL0    39,,PR0

     1611     6417    4                 MSG.TYPE = COMPLETED;

   6417  8 002560   000000 450000 xsym               STZ     FI_APLCGBUF

     1612     6418    4                 MSG.INAMER = SV$;

   6418  8 002561   001355 236000 1                  LDQ     SV$
         8 002562   000002 756000 xsym               STQ     FI_APLCGBUF+2

     1613     6419    4                 IF MSG.FIELD2 > 0 THEN SV.STATE = '0110'B;

   6419  8 002563   000004 235000 xsym               LDA     FI_APLCGBUF+4
         8 002564   002571 600000 8                  TZE     s:6420

   6419  8 002565   000046 236100                    LDQ     38,,PR0
         8 002566   000036 376000 9                  ANQ     30
         8 002567   300000 276003                    ORQ     98304,DU
         8 002570   000046 756100                    STQ     38,,PR0

     1614     6420    4                 IF SV.MATCH.NAME = MYID THEN CALL MYOFFER;

   6420  8 002571   040000 106500                    CMPC    fill='040'O
         8 002572   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 002573   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 002574   002577 601000 8                  TNZ     s:6421

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:198  
   6420  8 002575   005534 701000 8                  TSX1    MYOFFER
         8 002576   000000 011000                    NOP     0

     1615     6421    4                 MSG.FIELD1 = SV.COUPLING;

   6421  8 002577   001355 470400 1                  LDP0    SV$
         8 002600   000002 236100                    LDQ     2,,PR0
         8 002601   000022 772000                    QRL     18
         8 002602   000003 376007                    ANQ     3,DL
         8 002603   000003 756000 xsym               STQ     FI_APLCGBUF+3

     1616     6422    4                 MSG.FIELD2 = SV.DBKEY;

   6422  8 002604   000027 235100                    LDA     23,,PR0
         8 002605   000004 755000 xsym               STA     FI_APLCGBUF+4

     1617     6423    4                 CALL M$WRITE( WRITECG@) ALTRET( CGERR);

   6423  8 002606   001630 630400 1                  EPPR0   WRITECG@
         8 002607   440001 713400                    CLIMB   alt,write
         8 002610   401400 401760                    pmme    nvectors=4
         8 002611   005333 702000 8                  TSX2    CGERR

     1618     6424    4                 CALL MATCHSC;

   6424  8 002612   002074 701000 8                  TSX1    MATCHSC
         8 002613   000000 011000                    NOP     0

     1619     6425    4                 GOTO LEAVE;

   6425  8 002614   005331 710000 8                  TRA     A1

     1620     6426    4                 END;
     1621     6427    3               ELSE
     1622     6428    4                 DO; /* MSG.INAME > 0 */

     1623     6429    4                 IF STATION = SV.OFFER.STATION THEN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:199  

   6429  8 002615   001355 470400 1                  LDP0    SV$
         8 002616   040100 106400                    CMPC    fill='040'O
         8 002617   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 002620   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 002621   002640 601000 8                  TNZ     s:6438

     1624     6430    5                   DO; /* repetition of earlier offer */

     1625     6431    5                   MSG.TYPE = COMPLETED;

   6431  8 002622   000000 450000 xsym               STZ     FI_APLCGBUF

     1626     6432    5                   MSG.INAMER = SV$;

   6432  8 002623   001355 236000 1                  LDQ     SV$
         8 002624   000002 756000 xsym               STQ     FI_APLCGBUF+2

     1627     6433    5                   MSG.FIELD1 = SV.COUPLING;

   6433  8 002625   000002 236100                    LDQ     2,,PR0
         8 002626   000022 772000                    QRL     18
         8 002627   000003 376007                    ANQ     3,DL
         8 002630   000003 756000 xsym               STQ     FI_APLCGBUF+3

     1628     6434    5                   MSG.FIELD2 = SV.DBKEY;

   6434  8 002631   000027 235100                    LDA     23,,PR0
         8 002632   000004 755000 xsym               STA     FI_APLCGBUF+4

     1629     6435    5                   CALL M$WRITE( WRITECG@) ALTRET( CGERR);

   6435  8 002633   001630 630400 1                  EPPR0   WRITECG@
         8 002634   440001 713400                    CLIMB   alt,write
         8 002635   401400 401760                    pmme    nvectors=4
         8 002636   005333 702000 8                  TSX2    CGERR

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:200  
     1630     6436    5                   GOTO LEAVE;

   6436  8 002637   005331 710000 8                  TRA     A1

     1631     6437    5                   END;
     1632     6438    4                 CALL MAYMATCH ALTRET( LEAVE);

   6438  8 002640   000577 701000 8                  TSX1    MAYMATCH
         8 002641   005331 702000 8                  TSX2    A1

     1633     6439    4                 MSG.TYPE = COMPLETED;

   6439  8 002642   000000 450000 xsym               STZ     FI_APLCGBUF

     1634     6440    4                 MSG.INAMER = SV$;

   6440  8 002643   001355 236000 1                  LDQ     SV$
         8 002644   000002 756000 xsym               STQ     FI_APLCGBUF+2

     1635     6441    4                 MSG.FIELD2 = SV.DBKEY;

   6441  8 002645   001355 470400 1                  LDP0    SV$
         8 002646   000027 235100                    LDA     23,,PR0
         8 002647   000004 755000 xsym               STA     FI_APLCGBUF+4

     1636     6442    4                 MSG.FIELD1 = SV.COUPLING;

   6442  8 002650   000002 236100                    LDQ     2,,PR0
         8 002651   000022 772000                    QRL     18
         8 002652   000003 376007                    ANQ     3,DL
         8 002653   000003 756000 xsym               STQ     FI_APLCGBUF+3

     1637     6443    4                 CALL M$WRITE( WRITECG@) ALTRET( CGERR);

   6443  8 002654   001630 630400 1                  EPPR0   WRITECG@
         8 002655   440001 713400                    CLIMB   alt,write
         8 002656   401400 401760                    pmme    nvectors=4
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:201  
         8 002657   005333 702000 8                  TSX2    CGERR

     1638     6444    4                 CALL MAYNOTIFY;

   6444  8 002660   001574 701000 8                  TSX1    MAYNOTIFY
         8 002661   000000 011000                    NOP     0

     1639     6445    4                 GOTO LEAVE;

   6445  8 002662   005331 710000 8                  TRA     A1

     1640     6446    4                 END;
     1641     6447    3   SHERR:
     1642     6448    3               IF K = 0 THEN GOTO NOSVS;

   6448  8 002663   001347 235000 1     SHERR        LDA     K
         8 002664   002422 600000 8                  TZE     NOSVS

     1643     6449    3               MSG.TYPE = COMPLETED;

   6449  8 002665   000000 450000 xsym               STZ     FI_APLCGBUF

     1644     6450    3               MSG.INAME = 0;

   6450  8 002666   000002 450000 xsym               STZ     FI_APLCGBUF+2

     1645     6451    3               MSG.FIELD1 = BITBIN('777777777777'O);

   6451  8 002667   000027 236000 xsym               LDQ     B_VECTNIL+23
         8 002670   000003 756000 xsym               STQ     FI_APLCGBUF+3

     1646     6452    3               MSG.FIELD2 = 0;

   6452  8 002671   000004 450000 xsym               STZ     FI_APLCGBUF+4

     1647     6453    3               CALL M$WRITE(WRITECG@) ALTRET(CGERR);

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:202  
   6453  8 002672   001630 630400 1                  EPPR0   WRITECG@
         8 002673   440001 713400                    CLIMB   alt,write
         8 002674   401400 401760                    pmme    nvectors=4
         8 002675   005333 702000 8                  TSX2    CGERR

     1648     6454    3               GOTO LEAVE;

   6454  8 002676   005331 710000 8                  TRA     A1

     1649     6455        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:203  
     1650     6456    3             CASE( RETRACT);

     1651     6457                    %DISP(MSG="$QSVR: Offer retraction");

   6461  8 002677   001374 236000 1                  LDQ     DISPLAYS
         8 002700   000003 116007                    CMPQ    3,DL
         8 002701   002712 604000 8                  TMI     s:6468

   6461  8 002702   000003 236000 9                  LDQ     3
         8 002703   200022 756100                    STQ     @LEN+1,,AUTO
         8 002704   000116 237000 9                  LDAQ    78
         8 002705   200020 757100                    STAQ    OSV$,,AUTO
         8 002706   000006 236000 9                  LDQ     6
         8 002707   200017 756100                    STQ     CLRSCE,,AUTO
         8 002710   005351 701000 8                  TSX1    WRITEMESS
         8 002711   000000 011000                    NOP     0

     1652     6468    3               MSG.FIELD1 = SV.COUPLING;

   6468  8 002712   001355 470400 1                  LDP0    SV$
         8 002713   000002 236100                    LDQ     2,,PR0
         8 002714   000022 772000                    QRL     18
         8 002715   000003 376007                    ANQ     3,DL
         8 002716   000003 756000 xsym               STQ     FI_APLCGBUF+3

     1653     6469    3               IF SV.COUPLING = 2 THEN

   6469  8 002717   000002 236100                    LDQ     2,,PR0
         8 002720   000003 376003                    ANQ     3,DU
         8 002721   000002 116003                    CMPQ    2,DU
         8 002722   003074 601000 8                  TNZ     s:6517

     1654     6470    4                 DO;

     1655     6471                      %DISP(MSG="$QSVR Matched Offer retraction",CLASS=DEBUG);

   6475  8 002723   001374 235000 1                  LDA     DISPLAYS
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:204  
         8 002724   000002 115007                    CMPA    2,DL
         8 002725   002736 604000 8                  TMI     s:6482

   6475  8 002726   000010 236000 9                  LDQ     8
         8 002727   200022 756100                    STQ     @LEN+1,,AUTO
         8 002730   000122 237000 9                  LDAQ    82
         8 002731   200020 757100                    STAQ    OSV$,,AUTO
         8 002732   000006 236000 9                  LDQ     6
         8 002733   200017 756100                    STQ     CLRSCE,,AUTO
         8 002734   005351 701000 8                  TSX1    WRITEMESS
         8 002735   000000 011000                    NOP     0

     1656     6482    4                 IF STATION = SV.OFFER.STATION THEN

   6482  8 002736   001355 470400 1                  LDP0    SV$
         8 002737   040100 106400                    CMPC    fill='040'O
         8 002740   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 002741   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 002742   003016 601000 8                  TNZ     s:6494

     1657     6483    5                   DO;

     1658     6484    5                   MSG.PARTNER2 = SV.OFFER.NAME;

   6484  8 002743   040000 100500                    MLR     fill='040'O
         8 002744   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 002745   000012 000024 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=20

     1659     6485    5                   SV.OFFER.NAME = SV.MATCH.NAME;

   6485  8 002746   040100 100500                    MLR     fill='040'O
         8 002747   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 002750   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20

     1660     6486    5                   SV.MATCH.NAME = MSG.PARTNER2;

   6486  8 002751   040100 100400                    MLR     fill='040'O
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:205  
         8 002752   000012 000024 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=20
         8 002753   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20

     1661     6487    5                   SV.OFFER.STATION = SV.MATCH.STATION;

   6487  8 002754   040100 100500                    MLR     fill='040'O
         8 002755   000037 000010                    ADSC9   31,,PR0                  cn=0,n=8
         8 002756   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8

     1662     6488    5                   SV.ACVO = SV.ACVM;

   6488  8 002757   000002 236100                    LDQ     2,,PR0
         8 002760   000004 736000                    QLS     4
         8 002761   000002 676100                    ERQ     2,,PR0
         8 002762   001700 376003                    ANQ     960,DU
         8 002763   000002 656100                    ERSQ    2,,PR0

     1663     6489    5                   SV.ASMO = SV.ASMM;

   6489  8 002764   000002 236100                    LDQ     2,,PR0
         8 002765   000004 736000                    QLS     4
         8 002766   000002 676100                    ERQ     2,,PR0
         8 002767   740000 376003                    ANQ     -16384,DU
         8 002770   000002 656100                    ERSQ    2,,PR0

     1664     6490    5                   SV.MIDO = SV.MIDM;

   6490  8 002771   000047 720100                    LXL0    39,,PR0
         8 002772   000047 740100                    STX0    39,,PR0

     1665     6491    5                   SV.SCNO = SV.SCNM;

   6491  8 002773   000046 236100                    LDQ     38,,PR0
         8 002774   000001 736000                    QLS     1
         8 002775   000046 676100                    ERQ     38,,PR0
         8 002776   020000 376003                    ANQ     8192,DU
         8 002777   000046 656100                    ERSQ    38,,PR0
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:206  

     1666     6492    5                   SV.STATE=(SV.STATE&'1000'B)|NEWSTATES(BITBIN(SV.STATE&'0111'B));

   6492  8 003000   000046 236100                    LDQ     38,,PR0
         8 003001   740000 376003                    ANQ     -16384,DU
         8 003002   400000 376003                    ANQ     -131072,DU
         8 003003   200032 756100                    STQ     STX+3,,AUTO
         8 003004   000046 236100                    LDQ     38,,PR0
         8 003005   740000 376003                    ANQ     -16384,DU
         8 003006   340000 376003                    ANQ     114688,DU
         8 003007   000040 772000                    QRL     32
         8 003010   000103 236006 2                  LDQ     NEWSTATES,QL
         8 003011   740000 376003                    ANQ     -16384,DU
         8 003012   200032 276100                    ORQ     STX+3,,AUTO
         8 003013   000046 676100                    ERQ     38,,PR0
         8 003014   740000 376003                    ANQ     -16384,DU
         8 003015   000046 656100                    ERSQ    38,,PR0

     1667     6493    5                   END;

     1668     6494    4                 SV.MATCH.STATION = ' ';

   6494  8 003016   000035 235000 xsym               LDA     B_VECTNIL+29
         8 003017   000035 236000 xsym               LDQ     B_VECTNIL+29
         8 003020   000037 755100                    STA     31,,PR0
         8 003021   000040 756100                    STQ     32,,PR0

     1669     6495    4                 SV.MIDM = 0;

   6495  8 003022   000000 220003                    LDX0    0,DU
         8 003023   000047 440100                    SXL0    39,,PR0

     1670     6496    4                 IF SV.MIDO > 0 THEN

   6496  8 003024   000047 221100                    LDX1    39,,PR0
         8 003025   003031 600000 8                  TZE     s:6499

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:207  
     1671     6497    4                  SV.STATE.N = TRUE;

   6497  8 003026   400000 236003                    LDQ     -131072,DU
         8 003027   000046 256100                    ORSQ    38,,PR0
         8 003030   003033 710000 8                  TRA     s:6500

     1672     6498    4                 ELSE
     1673     6499    4                  SV.STATE.N = FALSE;

   6499  8 003031   000031 236000 xsym               LDQ     B_VECTNIL+25
         8 003032   000046 356100                    ANSQ    38,,PR0

     1674     6500    4                 SV.SCO  = TRUE;

   6500  8 003033   004000 236003                    LDQ     2048,DU
         8 003034   000046 256100                    ORSQ    38,,PR0

     1675     6501    4                 SV.ACVM = INITIAL;

   6501  8 003035   000027 236000 9                  LDQ     23
         8 003036   000002 356100                    ANSQ    2,,PR0

     1676     6502    4                 SV.COUPLING = 1;

   6502  8 003037   000002 236100                    LDQ     2,,PR0
         8 003040   000022 376000 9                  ANQ     18
         8 003041   000001 276003                    ORQ     1,DU
         8 003042   000002 756100                    STQ     2,,PR0

     1677     6503    4                 CALL SVDELINK;

   6503  8 003043   000455 701000 8                  TSX1    SVDELINK
         8 003044   000000 011000                    NOP     0

     1678     6504    4                 CALL SVLINK;

   6504  8 003045   000503 701000 8                  TSX1    SVLINK
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:208  
         8 003046   000000 011000                    NOP     0

     1679     6505    4                 MSG.TYPE = COMPLETED;

   6505  8 003047   000000 450000 xsym               STZ     FI_APLCGBUF

     1680     6506    4                 CALL M$WRITE(WRITECG@) ALTRET(CGERR);

   6506  8 003050   001630 630400 1                  EPPR0   WRITECG@
         8 003051   440001 713400                    CLIMB   alt,write
         8 003052   401400 401760                    pmme    nvectors=4
         8 003053   005333 702000 8                  TSX2    CGERR

     1681     6507    4                 CALL MAYNOTIFY;

   6507  8 003054   001574 701000 8                  TSX1    MAYNOTIFY
         8 003055   000000 011000                    NOP     0

     1682     6508    4                 IF SV.SCNO THEN CALL SCNOTIFYO;

   6508  8 003056   001355 470400 1                  LDP0    SV$
         8 003057   000046 236100                    LDQ     38,,PR0
         8 003060   020000 316003                    CANQ    8192,DU
         8 003061   003064 600000 8                  TZE     s:6509

   6508  8 003062   002022 701000 8                  TSX1    SCNOTIFYO
         8 003063   000000 011000                    NOP     0

     1683     6509    4                 IF SV.OFFER.NAME = MYID THEN CALL MYRETRACT;

   6509  8 003064   001355 470400 1                  LDP0    SV$
         8 003065   040000 106500                    CMPC    fill='040'O
         8 003066   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 003067   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 003070   005331 601000 8                  TNZ     A1

   6509  8 003071   005633 701000 8                  TSX1    MYRETRACT
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:209  
         8 003072   000000 011000                    NOP     0

     1684     6510    4                 END;

   6510  8 003073   005331 710000 8                  TRA     A1

     1685     6511    3               ELSE
     1686     6512    4                 DO;

     1687     6513                      %DISP(MSG="$QSVR Unmatched offer retraction",CLASS=DEBUG);

   6517  8 003074   001374 235000 1                  LDA     DISPLAYS
         8 003075   000002 115007                    CMPA    2,DL
         8 003076   003107 604000 8                  TMI     s:6524

   6517  8 003077   000010 236000 9                  LDQ     8
         8 003100   200022 756100                    STQ     @LEN+1,,AUTO
         8 003101   000124 237000 9                  LDAQ    84
         8 003102   200020 757100                    STAQ    OSV$,,AUTO
         8 003103   000006 236000 9                  LDQ     6
         8 003104   200017 756100                    STQ     CLRSCE,,AUTO
         8 003105   005351 701000 8                  TSX1    WRITEMESS
         8 003106   000000 011000                    NOP     0

     1688     6524    4                 CALL SVDELINK;

   6524  8 003107   000455 701000 8                  TSX1    SVDELINK
         8 003110   000000 011000                    NOP     0

     1689     6525    4                 SVX$ = SV$;

   6525  8 003111   001355 236000 1                  LDQ     SV$
         8 003112   001356 756000 1                  STQ     SVX$

     1690     6526    4                 CALL FOI$RBUF (SVSCB,SVX$);

   6526  8 003113   000014 630400 9                  EPPR0   12
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:210  
         8 003114   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 003115   000000 701000 xent               TSX1    FOI$RBUF
         8 003116   000000 011000                    NOP     0

     1691     6527    4                 MSG.TYPE = COMPLETED;

   6527  8 003117   000000 450000 xsym               STZ     FI_APLCGBUF

     1692     6528    4                 CALL M$WRITE(WRITECG@) ALTRET(CGERR);

   6528  8 003120   001630 630400 1                  EPPR0   WRITECG@
         8 003121   440001 713400                    CLIMB   alt,write
         8 003122   401400 401760                    pmme    nvectors=4
         8 003123   005333 702000 8                  TSX2    CGERR

     1693     6529    4                 END;

   6529  8 003124   005331 710000 8                  TRA     A1

     1694     6530        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:211  
     1695     6531    3             CASE( SETACV);

     1696     6532                    %DISP(MSG="$QSVC Set access controls");

   6536  8 003125   001374 236000 1                  LDQ     DISPLAYS
         8 003126   000003 116007                    CMPQ    3,DL
         8 003127   003140 604000 8                  TMI     s:6543

   6536  8 003130   000003 236000 9                  LDQ     3
         8 003131   200022 756100                    STQ     @LEN+1,,AUTO
         8 003132   000126 237000 9                  LDAQ    86
         8 003133   200020 757100                    STAQ    OSV$,,AUTO
         8 003134   000006 236000 9                  LDQ     6
         8 003135   200017 756100                    STQ     CLRSCE,,AUTO
         8 003136   005351 701000 8                  TSX1    WRITEMESS
         8 003137   000000 011000                    NOP     0

     1697     6543    3               IF STATION = SV.OFFER.STATION THEN

   6543  8 003140   001355 470400 1                  LDP0    SV$
         8 003141   040100 106400                    CMPC    fill='040'O
         8 003142   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 003143   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 003144   003154 601000 8                  TNZ     s:6546

     1698     6544    3                SV.ACVO = BINBIT( MSG.FIELD1, 4);

   6544  8 003145   000003 236000 xsym               LDQ     FI_APLCGBUF+3
         8 003146   000040 736000                    QLS     32
         8 003147   000010 772000                    QRL     8
         8 003150   000002 676100                    ERQ     2,,PR0
         8 003151   001700 376003                    ANQ     960,DU
         8 003152   000002 656100                    ERSQ    2,,PR0
         8 003153   003162 710000 8                  TRA     s:6547

     1699     6545    3               ELSE
     1700     6546    3                SV.ACVM = BINBIT( MSG.FIELD1, 4);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:212  

   6546  8 003154   000003 236000 xsym               LDQ     FI_APLCGBUF+3
         8 003155   000040 736000                    QLS     32
         8 003156   000014 772000                    QRL     12
         8 003157   000002 676100                    ERQ     2,,PR0
         8 003160   000074 376003                    ANQ     60,DU
         8 003161   000002 656100                    ERSQ    2,,PR0

     1701     6547    3               GOTO ACVGO;

   6547  8 003162   003176 710000 8                  TRA     ACVGO

     1702     6548    3             CASE( GETACV);

     1703     6549                    %DISP(MSG="$QSVC Get access controls");

   6553  8 003163   001374 236000 1                  LDQ     DISPLAYS
         8 003164   000003 116007                    CMPQ    3,DL
         8 003165   003176 604000 8                  TMI     ACVGO

   6553  8 003166   000003 236000 9                  LDQ     3
         8 003167   200022 756100                    STQ     @LEN+1,,AUTO
         8 003170   000130 237000 9                  LDAQ    88
         8 003171   200020 757100                    STAQ    OSV$,,AUTO
         8 003172   000006 236000 9                  LDQ     6
         8 003173   200017 756100                    STQ     CLRSCE,,AUTO
         8 003174   005351 701000 8                  TSX1    WRITEMESS
         8 003175   000000 011000                    NOP     0

     1704     6560    3   ACVGO:
     1705     6561    3               IF STATION = SV.OFFER.STATION THEN

   6561  8 003176   001355 470400 1     ACVGO        LDP0    SV$
         8 003177   040100 106400                    CMPC    fill='040'O
         8 003200   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 003201   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 003202   003221 601000 8                  TNZ     s:6564
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:213  

     1706     6562    3                MSG.FIELD1 = BITBIN( SV.ACVO | FLIPPED( BITBIN( SV.ACVM)));

   6562  8 003203   000002 236100                    LDQ     2,,PR0
         8 003204   000024 772000                    QRL     20
         8 003205   000017 376007                    ANQ     15,DL
         8 003206   000002 736000                    QLS     2
         8 003207   003100 060406                    CSL     bolr='003'O
         8 003210   000000 000004 2                  BDSC    FLIPPED,Q                by=0,bit=0,n=4
         8 003211   200032 000044                    BDSC    STX+3,,AUTO              by=0,bit=0,n=36
         8 003212   000002 236100                    LDQ     2,,PR0
         8 003213   000010 736000                    QLS     8
         8 003214   740000 376003                    ANQ     -16384,DU
         8 003215   200032 276100                    ORQ     STX+3,,AUTO
         8 003216   000040 772000                    QRL     32
         8 003217   000003 756000 xsym               STQ     FI_APLCGBUF+3
         8 003220   003236 710000 8                  TRA     s:6565

     1707     6563    3               ELSE
     1708     6564    3                MSG.FIELD1 = BITBIN( SV.ACVM | FLIPPED( BITBIN( SV.ACVO)));

   6564  8 003221   000002 236100                    LDQ     2,,PR0
         8 003222   000030 772000                    QRL     24
         8 003223   000017 376007                    ANQ     15,DL
         8 003224   000002 736000                    QLS     2
         8 003225   003100 060406                    CSL     bolr='003'O
         8 003226   000000 000004 2                  BDSC    FLIPPED,Q                by=0,bit=0,n=4
         8 003227   200032 000044                    BDSC    STX+3,,AUTO              by=0,bit=0,n=36
         8 003230   000002 236100                    LDQ     2,,PR0
         8 003231   000014 736000                    QLS     12
         8 003232   740000 376003                    ANQ     -16384,DU
         8 003233   200032 276100                    ORQ     STX+3,,AUTO
         8 003234   000040 772000                    QRL     32
         8 003235   000003 756000 xsym               STQ     FI_APLCGBUF+3

     1709     6565    3               MSG.TYPE = COMPLETED;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:214  
   6565  8 003236   000000 450000 xsym               STZ     FI_APLCGBUF

     1710     6566    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);

   6566  8 003237   001630 630400 1                  EPPR0   WRITECG@
         8 003240   440001 713400                    CLIMB   alt,write
         8 003241   401400 401760                    pmme    nvectors=4
         8 003242   005333 702000 8                  TSX2    CGERR

     1711     6567    3               CALL MAYNOTIFY; /* NOTIFY possible on SETACV... */

   6567  8 003243   001574 701000 8                  TSX1    MAYNOTIFY
         8 003244   000000 011000                    NOP     0
         8 003245   005331 710000 8                  TRA     A1

     1712     6568        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:215  
     1713     6569    3             CASE( PREREAD);

     1714     6570    3               IF SV.MATCH.NAME ~= MYID THEN

   6570  8 003246   001355 470400 1                  LDP0    SV$
         8 003247   040000 106500                    CMPC    fill='040'O
         8 003250   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 003251   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 003252   003266 600000 8                  TZE     s:6582

     1715     6571                     %DISP(MSG="*PreREAD*");

   6575  8 003253   001374 236000 1                  LDQ     DISPLAYS
         8 003254   000003 116007                    CMPQ    3,DL
         8 003255   003266 604000 8                  TMI     s:6582

   6575  8 003256   000003 236000 9                  LDQ     3
         8 003257   200022 756100                    STQ     @LEN+1,,AUTO
         8 003260   000132 237000 9                  LDAQ    90
         8 003261   200020 757100                    STAQ    OSV$,,AUTO
         8 003262   000006 236000 9                  LDQ     6
         8 003263   200017 756100                    STQ     CLRSCE,,AUTO
         8 003264   005351 701000 8                  TSX1    WRITEMESS
         8 003265   000000 011000                    NOP     0

     1716     6582    3               CALL MAYREAD ALTRET( LEAVE);

   6582  8 003266   001323 701000 8                  TSX1    MAYREAD
         8 003267   005331 702000 8                  TSX2    A1

     1717     6583    3               IF SV.MATCH.NAME = MYID THEN CALL MYLATCH;

   6583  8 003270   001355 470400 1                  LDP0    SV$
         8 003271   040000 106500                    CMPC    fill='040'O
         8 003272   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 003273   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 003274   003277 601000 8                  TNZ     s:6584
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:216  

   6583  8 003275   006013 701000 8                  TSX1    MYLATCH
         8 003276   000000 011000                    NOP     0

     1718     6584    3               MSG.TYPE = COMPLETED;

   6584  8 003277   000000 450000 xsym               STZ     FI_APLCGBUF

     1719     6585    3               MSG.INAME = SV.DBKEY;

   6585  8 003300   001355 470400 1                  LDP0    SV$
         8 003301   000027 235100                    LDA     23,,PR0
         8 003302   000002 755000 xsym               STA     FI_APLCGBUF+2

     1720     6586    3               MSG.FIELD1 = SV.DBSIZE;

   6586  8 003303   000046 236100                    LDQ     38,,PR0
         8 003304   777777 376007                    ANQ     -1,DL
         8 003305   000003 756000 xsym               STQ     FI_APLCGBUF+3

     1721     6587    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);

   6587  8 003306   001630 630400 1                  EPPR0   WRITECG@
         8 003307   440001 713400                    CLIMB   alt,write
         8 003310   401400 401760                    pmme    nvectors=4
         8 003311   005333 702000 8                  TSX2    CGERR
         8 003312   005331 710000 8                  TRA     A1

     1722     6588    3             CASE( PREWRITE);

     1723     6589                    %DISP(MSG="*PreWRITE*");

   6593  8 003313   001374 236000 1                  LDQ     DISPLAYS
         8 003314   000003 116007                    CMPQ    3,DL
         8 003315   003326 604000 8                  TMI     s:6600

   6593  8 003316   000003 236000 9                  LDQ     3
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:217  
         8 003317   200022 756100                    STQ     @LEN+1,,AUTO
         8 003320   000134 237000 9                  LDAQ    92
         8 003321   200020 757100                    STAQ    OSV$,,AUTO
         8 003322   000006 236000 9                  LDQ     6
         8 003323   200017 756100                    STQ     CLRSCE,,AUTO
         8 003324   005351 701000 8                  TSX1    WRITEMESS
         8 003325   000000 011000                    NOP     0

     1724     6600    3               CALL MAYWRITE ALTRET( LEAVE);

   6600  8 003326   001327 701000 8                  TSX1    MAYWRITE
         8 003327   005331 702000 8                  TSX2    A1

     1725     6601    3               MSG.TYPE = COMPLETED;

   6601  8 003330   000000 450000 xsym               STZ     FI_APLCGBUF

     1726     6602    3               MSG.INAME = SV.DBKEY;

   6602  8 003331   001355 470400 1                  LDP0    SV$
         8 003332   000027 235100                    LDA     23,,PR0
         8 003333   000002 755000 xsym               STA     FI_APLCGBUF+2

     1727     6603    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);

   6603  8 003334   001630 630400 1                  EPPR0   WRITECG@
         8 003335   440001 713400                    CLIMB   alt,write
         8 003336   401400 401760                    pmme    nvectors=4
         8 003337   005333 702000 8                  TSX2    CGERR
         8 003340   005331 710000 8                  TRA     A1

     1728     6604    3             CASE( SEIZE);

     1729     6605                    %DISP(MSG="*Seize*");

   6609  8 003341   001374 236000 1                  LDQ     DISPLAYS
         8 003342   000003 116007                    CMPQ    3,DL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:218  
         8 003343   003354 604000 8                  TMI     s:6616

   6609  8 003344   000003 236000 9                  LDQ     3
         8 003345   200022 756100                    STQ     @LEN+1,,AUTO
         8 003346   000136 237000 9                  LDAQ    94
         8 003347   200020 757100                    STAQ    OSV$,,AUTO
         8 003350   000006 236000 9                  LDQ     6
         8 003351   200017 756100                    STQ     CLRSCE,,AUTO
         8 003352   005351 701000 8                  TSX1    WRITEMESS
         8 003353   000000 011000                    NOP     0

     1730     6616    3               CALL MAYSEIZE ALTRET( LEAVE);

   6616  8 003354   001332 701000 8                  TSX1    MAYSEIZE
         8 003355   005331 702000 8                  TSX2    A1

     1731     6617    3               MSG.TYPE = COMPLETED;

   6617  8 003356   000000 450000 xsym               STZ     FI_APLCGBUF

     1732     6618    3               MSG.INAME = SV.DBKEY;

   6618  8 003357   001355 470400 1                  LDP0    SV$
         8 003360   000027 235100                    LDA     23,,PR0
         8 003361   000002 755000 xsym               STA     FI_APLCGBUF+2

     1733     6619    3               MSG.FIELD1 = SV.DBSIZE;

   6619  8 003362   000046 236100                    LDQ     38,,PR0
         8 003363   777777 376007                    ANQ     -1,DL
         8 003364   000003 756000 xsym               STQ     FI_APLCGBUF+3

     1734     6620    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);

   6620  8 003365   001630 630400 1                  EPPR0   WRITECG@
         8 003366   440001 713400                    CLIMB   alt,write
         8 003367   401400 401760                    pmme    nvectors=4
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:219  
         8 003370   005333 702000 8                  TSX2    CGERR
         8 003371   005331 710000 8                  TRA     A1

     1735     6621
     1736     6622
     1737     6623    3             CASE(GETASM);

     1738     6624    3               IF SV.MATCH.NAME ~= MYID THEN

   6624  8 003372   001355 470400 1                  LDP0    SV$
         8 003373   040000 106500                    CMPC    fill='040'O
         8 003374   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 003375   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 003376   003412 600000 8                  TZE     s:6636

     1739     6625                     %DISP(MSG="$QSVS Get access state matrix");

   6629  8 003377   001374 236000 1                  LDQ     DISPLAYS
         8 003400   000003 116007                    CMPQ    3,DL
         8 003401   003412 604000 8                  TMI     s:6636

   6629  8 003402   000003 236000 9                  LDQ     3
         8 003403   200022 756100                    STQ     @LEN+1,,AUTO
         8 003404   000142 237000 9                  LDAQ    98
         8 003405   200020 757100                    STAQ    OSV$,,AUTO
         8 003406   000006 236000 9                  LDQ     6
         8 003407   200017 756100                    STQ     CLRSCE,,AUTO
         8 003410   005351 701000 8                  TSX1    WRITEMESS
         8 003411   000000 011000                    NOP     0

     1740     6636    3               IF STATION = SV.OFFER.STATION

   6636  8 003412   001355 470400 1                  LDP0    SV$
         8 003413   040100 106400                    CMPC    fill='040'O
         8 003414   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 003415   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 003416   003423 601000 8                  TNZ     s:6638
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:220  

     1741     6637    3               THEN MSG.FIELD1 = BITBIN(SV.ASMO);

   6637  8 003417   000002 236100                    LDQ     2,,PR0
         8 003420   000040 772000                    QRL     32
         8 003421   000003 756000 xsym               STQ     FI_APLCGBUF+3
         8 003422   003427 710000 8                  TRA     s:6639

     1742     6638    3               ELSE MSG.FIELD1 = BITBIN(SV.ASMM);

   6638  8 003423   000002 236100                    LDQ     2,,PR0
         8 003424   000034 772000                    QRL     28
         8 003425   000017 376007                    ANQ     15,DL
         8 003426   000003 756000 xsym               STQ     FI_APLCGBUF+3

     1743     6639    3               MSG.TYPE = COMPLETED;

   6639  8 003427   000000 450000 xsym               STZ     FI_APLCGBUF

     1744     6640    3               CALL M$WRITE(WRITECG@) ALTRET(CGERR);

   6640  8 003430   001630 630400 1                  EPPR0   WRITECG@
         8 003431   440001 713400                    CLIMB   alt,write
         8 003432   401400 401760                    pmme    nvectors=4
         8 003433   005333 702000 8                  TSX2    CGERR
         8 003434   005331 710000 8                  TRA     A1

     1745     6641        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:221  
     1746     6642    3             CASE(SIGNON);

     1747     6643                    %DISP(MSG="$QSVN Signon");

   6647  8 003435   001374 236000 1                  LDQ     DISPLAYS
         8 003436   000003 116007                    CMPQ    3,DL
         8 003437   003450 604000 8                  TMI     s:6654

   6647  8 003440   000003 236000 9                  LDQ     3
         8 003441   200022 756100                    STQ     @LEN+1,,AUTO
         8 003442   000144 237000 9                  LDAQ    100
         8 003443   200020 757100                    STAQ    OSV$,,AUTO
         8 003444   000006 236000 9                  LDQ     6
         8 003445   200017 756100                    STQ     CLRSCE,,AUTO
         8 003446   005351 701000 8                  TSX1    WRITEMESS
         8 003447   000000 011000                    NOP     0

     1748     6654    3               SV$ = SVHD$;

   6654  8 003450   001370 236000 1                  LDQ     SVHD$
         8 003451   001355 756000 1                  STQ     SV$

     1749     6655    4                 DO WHILE(SV$ ~= ADDR(NIL));

   6655  8 003452   003470 710000 8                  TRA     s:6660

     1750     6656    4                 IF SV.SCDF THEN

   6656  8 003453   001355 470400 1                  LDP0    SV$
         8 003454   000046 430100                    FSZN    38,,PR0
         8 003455   003466 605000 8                  TPL     s:6659

     1751     6657    4                  IF SV.OFFER.NAME = MSG.PARTNER1 THEN GOTO DUPL;

   6657  8 003456   040000 106500                    CMPC    fill='040'O
         8 003457   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 003460   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:222  
         8 003461   003503 600000 8                  TZE     DUPL

     1752     6658    4                  ELSE IF SV.OFFER.STATION = STATION THEN GOTO DUPL;

   6658  8 003462   040000 106500                    CMPC    fill='040'O
         8 003463   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 003464   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 003465   003503 600000 8                  TZE     DUPL

     1753     6659    4                 SV$ = SV.LNK$;

   6659  8 003466   000000 236100                    LDQ     0,,PR0
         8 003467   001355 756000 1                  STQ     SV$

     1754     6660    4                 END;

   6660  8 003470   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 003471   003453 601000 8                  TNZ     s:6656

     1755     6661
     1756     6662    3               IF MSG.PARTNER1 = MYID THEN GOTO DUPL;

   6662  8 003472   040000 106400                    CMPC    fill='040'O
         8 003473   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
         8 003474   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 003475   003503 600000 8                  TZE     DUPL

     1757     6663    3               CALL DOSIGNON ALTRET(NOSVS);

   6663  8 003476   000764 701000 8                  TSX1    DOSIGNON
         8 003477   002422 702000 8                  TSX2    NOSVS

     1758     6664    3               MSG.FIELD1 = 1;  /*  Report successful Signon */

   6664  8 003500   000001 235007                    LDA     1,DL
         8 003501   000003 755000 xsym               STA     FI_APLCGBUF+3

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:223  
     1759     6665    3               GOTO DONESVN;

   6665  8 003502   003517 710000 8                  TRA     DONESVN

     1760     6666    3   DUPL:
     1761     6667                    %DISP(MSG="$QSVN: Duplicate signon exists",CLASS=DEBUG);

   6669  8 003503                       DUPL         null
   6671  8 003503   001374 235000 1                  LDA     DISPLAYS
         8 003504   000002 115007                    CMPA    2,DL
         8 003505   003516 604000 8                  TMI     s:6678

   6671  8 003506   000010 236000 9                  LDQ     8
         8 003507   200022 756100                    STQ     @LEN+1,,AUTO
         8 003510   000146 237000 9                  LDAQ    102
         8 003511   200020 757100                    STAQ    OSV$,,AUTO
         8 003512   000006 236000 9                  LDQ     6
         8 003513   200017 756100                    STQ     CLRSCE,,AUTO
         8 003514   005351 701000 8                  TSX1    WRITEMESS
         8 003515   000000 011000                    NOP     0

     1762     6678    3               MSG.FIELD1 = 0;  /*  Unsuccessful Signon      */

   6678  8 003516   000003 450000 xsym               STZ     FI_APLCGBUF+3

     1763     6679    3   DONESVN:
     1764     6680    3               MSG.TYPE = COMPLETED;

   6680  8 003517   000000 450000 xsym  DONESVN      STZ     FI_APLCGBUF

     1765     6681    3               CALL M$WRITE(WRITECG@) ALTRET(CGERR);

   6681  8 003520   001630 630400 1                  EPPR0   WRITECG@
         8 003521   440001 713400                    CLIMB   alt,write
         8 003522   401400 401760                    pmme    nvectors=4
         8 003523   005333 702000 8                  TSX2    CGERR
         8 003524   005331 710000 8                  TRA     A1
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:224  

     1766     6682        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:225  
     1767     6683    3             CASE(STATECHANGE);

     1768     6684                   /*  Access of $QSC automatically shared variable.  */
     1769     6685        /*** %DISP(MSG="$QSC: Statechange wait");  **********************/
     1770     6686    3               CALL CHECKSIGNON ALTRET(CANTWT);

   6686  8 003525   001125 701000 8                  TSX1    CHECKSIGNON
         8 003526   003607 702000 8                  TSX2    CANTWT

     1771     6687    3               SV$ = SVHD$;

   6687  8 003527   001370 236000 1                  LDQ     SVHD$
         8 003530   001355 756000 1                  STQ     SV$

     1772     6688    4                 DO WHILE(SV$ ~= ADDR(NIL));

   6688  8 003531   003564 710000 8                  TRA     s:6703

     1773     6689    4                 IF SV.OFFER.STATION = STATION THEN

   6689  8 003532   001355 470400 1                  LDP0    SV$
         8 003533   040000 106500                    CMPC    fill='040'O
         8 003534   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 003535   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 003536   003547 601000 8                  TNZ     s:6696

     1774     6690    5                   DO;

     1775     6691    5                   IF SV.SCO THEN GOTO WAKUP;

   6691  8 003537   000046 236100                    LDQ     38,,PR0
         8 003540   004000 316003                    CANQ    2048,DU
         8 003541   003567 601000 8                  TNZ     WAKUP

     1776     6692    5                   SV.SCNO = TRUE;

   6692  8 003542   020000 236003                    LDQ     8192,DU
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:226  
         8 003543   000046 256100                    ORSQ    38,,PR0

     1777     6693    5                   SV.MIDO = MSG.MID;

   6693  8 003544   000001 720000 xsym               LXL0    FI_APLCGBUF+1
         8 003545   000047 740100                    STX0    39,,PR0

     1778     6694    5                   END;

   6694  8 003546   003562 710000 8                  TRA     s:6702

     1779     6695    4                 ELSE
     1780     6696    4                  IF SV.MATCH.STATION = STATION THEN

   6696  8 003547   040000 106500                    CMPC    fill='040'O
         8 003550   000037 000010                    ADSC9   31,,PR0                  cn=0,n=8
         8 003551   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 003552   003562 601000 8                  TNZ     s:6702

     1781     6697    5                    DO;

     1782     6698    5                    IF SV.SCM THEN GOTO WAKUP;

   6698  8 003553   000046 236100                    LDQ     38,,PR0
         8 003554   002000 316003                    CANQ    1024,DU
         8 003555   003567 601000 8                  TNZ     WAKUP

     1783     6699    5                    SV.SCNM = TRUE;

   6699  8 003556   010000 236003                    LDQ     4096,DU
         8 003557   000046 256100                    ORSQ    38,,PR0

     1784     6700    5                    SV.MIDM = MSG.MID;

   6700  8 003560   000001 720000 xsym               LXL0    FI_APLCGBUF+1
         8 003561   000047 440100                    SXL0    39,,PR0

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:227  
     1785     6701    5                    END;

     1786     6702    4                 SV$ = SV.LNK$;

   6702  8 003562   000000 236100                    LDQ     0,,PR0
         8 003563   001355 756000 1                  STQ     SV$

     1787     6703    4                 END;

   6703  8 003564   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 003565   003532 601000 8                  TNZ     s:6689

     1788     6704    3               GOTO LEAVE;

   6704  8 003566   005331 710000 8                  TRA     A1

     1789     6705    3   WAKUP:
     1790     6706                    %DISP(MSG="$QSC: State change upon access",CLASS=DEBUG);

   6708  8 003567                       WAKUP        null
   6710  8 003567   001374 235000 1                  LDA     DISPLAYS
         8 003570   000002 115007                    CMPA    2,DL
         8 003571   003602 604000 8                  TMI     s:6717

   6710  8 003572   000010 236000 9                  LDQ     8
         8 003573   200022 756100                    STQ     @LEN+1,,AUTO
         8 003574   000150 237000 9                  LDAQ    104
         8 003575   200020 757100                    STAQ    OSV$,,AUTO
         8 003576   000006 236000 9                  LDQ     6
         8 003577   200017 756100                    STQ     CLRSCE,,AUTO
         8 003600   005351 701000 8                  TSX1    WRITEMESS
         8 003601   000000 011000                    NOP     0

     1791     6717    3               CALL CLEARSC;

   6717  8 003602   001734 701000 8                  TSX1    CLEARSC
         8 003603   000000 011000                    NOP     0
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:228  

     1792     6718    3               MSG.FIELD1 = 1;

   6718  8 003604   000001 235007                    LDA     1,DL
         8 003605   000003 755000 xsym               STA     FI_APLCGBUF+3

     1793     6719    3               GOTO SCEXIT;

   6719  8 003606   003610 710000 8                  TRA     SCEXIT

     1794     6720    3   CANTWT:
     1795     6721    3               MSG.FIELD1 = 0;

   6721  8 003607   000003 450000 xsym  CANTWT       STZ     FI_APLCGBUF+3

     1796     6722    3   SCEXIT:
     1797     6723    3               MSG.TYPE = COMPLETED;

   6723  8 003610   000000 450000 xsym  SCEXIT       STZ     FI_APLCGBUF

     1798     6724    3               CALL M$WRITE(WRITECG@) ALTRET(CGERR);

   6724  8 003611   001630 630400 1                  EPPR0   WRITECG@
         8 003612   440001 713400                    CLIMB   alt,write
         8 003613   401400 401760                    pmme    nvectors=4
         8 003614   005333 702000 8                  TSX2    CGERR
         8 003615   005331 710000 8                  TRA     A1

     1799     6725        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:229  
     1800     6726    3             CASE( RELEASE);

     1801     6727    3               IF SV.MATCH.NAME ~= MYID THEN

   6727  8 003616   001355 470400 1                  LDP0    SV$
         8 003617   040000 106500                    CMPC    fill='040'O
         8 003620   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 003621   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 003622   003636 600000 8                  TZE     s:6739

     1802     6728                     %DISP(MSG="*Releasing* Variable");

   6732  8 003623   001374 236000 1                  LDQ     DISPLAYS
         8 003624   000003 116007                    CMPQ    3,DL
         8 003625   003636 604000 8                  TMI     s:6739

   6732  8 003626   000003 236000 9                  LDQ     3
         8 003627   200022 756100                    STQ     @LEN+1,,AUTO
         8 003630   000152 237000 9                  LDAQ    106
         8 003631   200020 757100                    STAQ    OSV$,,AUTO
         8 003632   000006 236000 9                  LDQ     6
         8 003633   200017 756100                    STQ     CLRSCE,,AUTO
         8 003634   005351 701000 8                  TSX1    WRITEMESS
         8 003635   000000 011000                    NOP     0

     1803     6739    3               IF MSG.FIELD1 > 0 THEN

   6739  8 003636   000003 235000 xsym               LDA     FI_APLCGBUF+3
         8 003637   003643 600000 8                  TZE     s:6741

     1804     6740    3                SV.DBSIZE = MSG.FIELD1;

   6740  8 003640   000000 620005                    EAX0    0,AL
         8 003641   001355 470400 1                  LDP0    SV$
         8 003642   000046 440100                    SXL0    38,,PR0

     1805     6741    3               TEMP = BITBIN( SV.STATE);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:230  

   6741  8 003643   001355 470400 1                  LDP0    SV$
         8 003644   000046 236100                    LDQ     38,,PR0
         8 003645   000040 772000                    QRL     32
         8 003646   001345 756000 1                  STQ     TEMP

     1806     6742    3               IF STATION = SV.OFFER.STATION THEN

   6742  8 003647   040100 106400                    CMPC    fill='040'O
         8 003650   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 003651   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 003652   003740 601000 8                  TNZ     s:6780

     1807     6743    4                 DO;

     1808     6744    4                 IF SV.ASMO = '0011'B THEN

   6744  8 003653   000002 236100                    LDQ     2,,PR0
         8 003654   740000 376003                    ANQ     -16384,DU
         8 003655   140000 116003                    CMPQ    49152,DU
         8 003656   003676 601000 8                  TNZ     s:6754

     1809     6745    5                   DO;

     1810     6746    5   WRITE:
     1811     6747    5                   IF TEMP = 6 OR TEMP = 14 THEN

   6747  8 003657   001345 235000 1     WRITE        LDA     TEMP
         8 003660   000006 115007                    CMPA    6,DL
         8 003661   003664 600000 8                  TZE     s:6749
         8 003662   000016 115007                    CMPA    14,DL
         8 003663   003675 601000 8                  TNZ     s:6752

     1812     6748    6                     DO;

     1813     6749    6                     SV.ASMO = '1010'B;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:231  
   6749  8 003664   001355 470400 1                  LDP0    SV$
         8 003665   000002 236100                    LDQ     2,,PR0
         8 003666   000036 376000 9                  ANQ     30
         8 003667   500000 276003                    ORQ     -98304,DU
         8 003670   000002 756100                    STQ     2,,PR0

     1814     6750    6                     SV.ASMM = '0101'B;

   6750  8 003671   000002 236100                    LDQ     2,,PR0
         8 003672   000037 376000 9                  ANQ     31
         8 003673   012000 276003                    ORQ     5120,DU
         8 003674   000002 756100                    STQ     2,,PR0

     1815     6751    6                     END;

     1816     6752    5                   GOTO SETSTATE;

   6752  8 003675   004030 710000 8                  TRA     SETSTATE

     1817     6753    5                   END;
     1818     6754    4                 IF SV.ASMO = '0101'B THEN

   6754  8 003676   000002 236100                    LDQ     2,,PR0
         8 003677   740000 376003                    ANQ     -16384,DU
         8 003700   240000 116003                    CMPQ    81920,DU
         8 003701   003720 601000 8                  TNZ     s:6763

     1819     6755    5                   DO;

     1820     6756    5                   IF TEMP = 2 OR TEMP = 10 THEN

   6756  8 003702   001345 235000 1                  LDA     TEMP
         8 003703   000002 115007                    CMPA    2,DL
         8 003704   003707 600000 8                  TZE     s:6758
         8 003705   000012 115007                    CMPA    10,DL
         8 003706   003717 601000 8                  TNZ     s:6761

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:232  
     1821     6757    6                     DO;

     1822     6758    6                     SV.ASMO = '0011'B;

   6758  8 003707   000002 236100                    LDQ     2,,PR0
         8 003710   000036 376000 9                  ANQ     30
         8 003711   140000 276003                    ORQ     49152,DU
         8 003712   000002 756100                    STQ     2,,PR0

     1823     6759    6                     SV.ASMM = '0011'B;

   6759  8 003713   000002 236100                    LDQ     2,,PR0
         8 003714   000037 376000 9                  ANQ     31
         8 003715   006000 276003                    ORQ     3072,DU
         8 003716   000002 756100                    STQ     2,,PR0

     1824     6760    6                     END;

     1825     6761    5                   GOTO WRITE;

   6761  8 003717   003657 710000 8                  TRA     WRITE

     1826     6762    5                   END;
     1827     6763    4                 IF SV.ASMO = '1010'B THEN

   6763  8 003720   000002 236100                    LDQ     2,,PR0
         8 003721   740000 376003                    ANQ     -16384,DU
         8 003722   500000 116003                    CMPQ    -98304,DU
         8 003723   004030 600000 8                  TZE     SETSTATE

     1828     6764    4                  GOTO SETSTATE;
     1829     6765                      %DISP(MSG="Release: Illegal State Transition (OFFER)",CLASS=DEBUG);

   6769  8 003724   001374 235000 1                  LDA     DISPLAYS
         8 003725   000002 115007                    CMPA    2,DL
         8 003726   003737 604000 8                  TMI     s:6776

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:233  
   6769  8 003727   000010 236000 9                  LDQ     8
         8 003730   200022 756100                    STQ     @LEN+1,,AUTO
         8 003731   000154 237000 9                  LDAQ    108
         8 003732   200020 757100                    STAQ    OSV$,,AUTO
         8 003733   000006 236000 9                  LDQ     6
         8 003734   200017 756100                    STQ     CLRSCE,,AUTO
         8 003735   005351 701000 8                  TSX1    WRITEMESS
         8 003736   000000 011000                    NOP     0

     1830     6776    4                 GOTO SNAP;

   6776  8 003737   004024 710000 8                  TRA     SNAP

     1831     6777    4                 END;
     1832     6778    3               ELSE
     1833     6779    4                 DO;

     1834     6780    4                 IF SV.ASMM = '0011'B THEN

   6780  8 003740   000002 236100                    LDQ     2,,PR0
         8 003741   036000 376003                    ANQ     15360,DU
         8 003742   006000 116003                    CMPQ    3072,DU
         8 003743   003763 601000 8                  TNZ     s:6790

     1835     6781    5                   DO;

     1836     6782    5   WRITE2:
     1837     6783    5                   IF TEMP = 5 OR TEMP = 13 THEN

   6783  8 003744   001345 235000 1     WRITE2       LDA     TEMP
         8 003745   000005 115007                    CMPA    5,DL
         8 003746   003751 600000 8                  TZE     s:6785
         8 003747   000015 115007                    CMPA    13,DL
         8 003750   003762 601000 8                  TNZ     s:6788

     1838     6784    6                     DO;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:234  
     1839     6785    6                     SV.ASMM = '1010'B;

   6785  8 003751   001355 470400 1                  LDP0    SV$
         8 003752   000002 236100                    LDQ     2,,PR0
         8 003753   000037 376000 9                  ANQ     31
         8 003754   024000 276003                    ORQ     10240,DU
         8 003755   000002 756100                    STQ     2,,PR0

     1840     6786    6                     SV.ASMO = '0101'B;

   6786  8 003756   000002 236100                    LDQ     2,,PR0
         8 003757   000036 376000 9                  ANQ     30
         8 003760   240000 276003                    ORQ     81920,DU
         8 003761   000002 756100                    STQ     2,,PR0

     1841     6787    6                     END;

     1842     6788    5                   GOTO SETSTATE;

   6788  8 003762   004030 710000 8                  TRA     SETSTATE

     1843     6789    5                   END;
     1844     6790    4                 IF SV.ASMM = '0101'B THEN

   6790  8 003763   000002 236100                    LDQ     2,,PR0
         8 003764   036000 376003                    ANQ     15360,DU
         8 003765   012000 116003                    CMPQ    5120,DU
         8 003766   004005 601000 8                  TNZ     s:6799

     1845     6791    5                   DO;

     1846     6792    5                   IF TEMP = 1 OR TEMP = 9 THEN

   6792  8 003767   001345 235000 1                  LDA     TEMP
         8 003770   000001 115007                    CMPA    1,DL
         8 003771   003774 600000 8                  TZE     s:6794
         8 003772   000011 115007                    CMPA    9,DL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:235  
         8 003773   004004 601000 8                  TNZ     s:6797

     1847     6793    6                     DO;

     1848     6794    6                     SV.ASMM = '0011'B;

   6794  8 003774   000002 236100                    LDQ     2,,PR0
         8 003775   000037 376000 9                  ANQ     31
         8 003776   006000 276003                    ORQ     3072,DU
         8 003777   000002 756100                    STQ     2,,PR0

     1849     6795    6                     SV.ASMO = '0011'B;

   6795  8 004000   000002 236100                    LDQ     2,,PR0
         8 004001   000036 376000 9                  ANQ     30
         8 004002   140000 276003                    ORQ     49152,DU
         8 004003   000002 756100                    STQ     2,,PR0

     1850     6796    6                     END;

     1851     6797    5                   GOTO WRITE2;

   6797  8 004004   003744 710000 8                  TRA     WRITE2

     1852     6798    5                   END;
     1853     6799    4                 IF SV.ASMM = '1010'B THEN

   6799  8 004005   000002 236100                    LDQ     2,,PR0
         8 004006   036000 376003                    ANQ     15360,DU
         8 004007   024000 116003                    CMPQ    10240,DU
         8 004010   004030 600000 8                  TZE     SETSTATE

     1854     6800    4                  GOTO SETSTATE;
     1855     6801                      %DISP(MSG="Release: Illegal State Transition (MATCH)",CLASS=DEBUG);

   6805  8 004011   001374 235000 1                  LDA     DISPLAYS
         8 004012   000002 115007                    CMPA    2,DL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:236  
         8 004013   004024 604000 8                  TMI     SNAP

   6805  8 004014   000010 236000 9                  LDQ     8
         8 004015   200022 756100                    STQ     @LEN+1,,AUTO
         8 004016   000156 237000 9                  LDAQ    110
         8 004017   200020 757100                    STAQ    OSV$,,AUTO
         8 004020   000006 236000 9                  LDQ     6
         8 004021   200017 756100                    STQ     CLRSCE,,AUTO
         8 004022   005351 701000 8                  TSX1    WRITEMESS
         8 004023   000000 011000                    NOP     0

   6799  8 004024                       SNAP         null
     1856     6812    4   SNAP:         ;
     1857     6813    4                 CALL FOI$LDTRC (%S$APLSV,F_FI,M_A,INSYMNAME);

   6813  8 004024   000163 630400 9                  EPPR0   115
         8 004025   000022 631400 xsym               EPPR1   B_VECTNIL+18
         8 004026   000000 701000 xent               TSX1    FOI$LDTRC
         8 004027   000000 011000                    NOP     0

     1858     6814        /*S* SCREECH_CODE: FIA-S$APLSV
     1859     6815             TYPE:         SNAP
     1860     6816             MESSAGE:      INSYM's APLCG tables have gone bad
     1861     6817             DESCRIPTION:  This SNAP occurs when INSYM discovers an incon-
     1862     6818                           sistency in the internal tables which govern the
     1863     6819                           APL comgroup.  INSYM LDTRCs to a new copy of
     1864     6820                           himself after taking the snap.  APLCG users get
     1865     6821                           deactivated. */
     1866     6822    4                 END;

     1867     6823        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:237  
     1868     6824    3   SETSTATE:
     1869     6825    3               MSG.TYPE = COMPLETED;

   6825  8 004030   000000 450000 xsym  SETSTATE     STZ     FI_APLCGBUF

     1870     6826    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);

   6826  8 004031   001630 630400 1                  EPPR0   WRITECG@
         8 004032   440001 713400                    CLIMB   alt,write
         8 004033   401400 401760                    pmme    nvectors=4
         8 004034   005333 702000 8                  TSX2    CGERR

     1871     6827    3               IF STATION = SV.OFFER.STATION THEN

   6827  8 004035   001355 470400 1                  LDP0    SV$
         8 004036   040100 106400                    CMPC    fill='040'O
         8 004037   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 004040   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 004041   004115 601000 8                  TNZ     s:6843

     1872     6828    4                 DO;

     1873     6829    5                   DO CASE( TEMP);

   6829  8 004042   001345 235000 1                  LDA     TEMP
         8 004043   000017 115007                    CMPA    15,DL
         8 004044   004046 602005 8                  TNC     s:6829+4,AL
         8 004045   004075 710000 8                  TRA     s:6837
         8 004046   004075 710000 8                  TRA     s:6837
         8 004047   004075 710000 8                  TRA     s:6837
         8 004050   004065 710000 8                  TRA     s:6831
         8 004051   004065 710000 8                  TRA     s:6831
         8 004052   004075 710000 8                  TRA     s:6837
         8 004053   004075 710000 8                  TRA     s:6837
         8 004054   004065 710000 8                  TRA     s:6831
         8 004055   004075 710000 8                  TRA     s:6837
         8 004056   004075 710000 8                  TRA     s:6837
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:238  
         8 004057   004075 710000 8                  TRA     s:6837
         8 004060   004070 710000 8                  TRA     s:6833
         8 004061   004070 710000 8                  TRA     s:6833
         8 004062   004075 710000 8                  TRA     s:6837
         8 004063   004075 710000 8                  TRA     s:6837
         8 004064   004070 710000 8                  TRA     s:6833

     1874     6830    5                     CASE( 2, 3, 6);

     1875     6831    5                       SV.STATE = INITIAL;

   6831  8 004065   000036 236000 9                  LDQ     30
         8 004066   000046 356100                    ANSQ    38,,PR0
         8 004067   004075 710000 8                  TRA     s:6837

     1876     6832    5                     CASE( 10, 11, 14);

     1877     6833    5                       SV.STATE = INITIAL;

   6833  8 004070   000036 236000 9                  LDQ     30
         8 004071   000046 356100                    ANSQ    38,,PR0

     1878     6834    5                       CALL NOTIFY;

   6834  8 004072   001602 701000 8                  TSX1    NOTIFY
         8 004073   000000 011000                    NOP     0
         8 004074   004075 710000 8                  TRA     s:6837

     1879     6835    5                     CASE( ELSE);

     1880     6836    5                   END;

     1881     6837    4                 SV.SCM = TRUE;

   6837  8 004075   001355 470400 1                  LDP0    SV$
         8 004076   002000 236003                    LDQ     1024,DU
         8 004077   000046 256100                    ORSQ    38,,PR0
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:239  

     1882     6838    4                 IF SV.SCNM THEN CALL SCNOTIFYM;

   6838  8 004100   000046 236100                    LDQ     38,,PR0
         8 004101   010000 316003                    CANQ    4096,DU
         8 004102   004105 600000 8                  TZE     s:6839

   6838  8 004103   002005 701000 8                  TSX1    SCNOTIFYM
         8 004104   000000 011000                    NOP     0

     1883     6839    4                 IF SV.MATCH.NAME = MYID THEN CALL MYRELEASE;

   6839  8 004105   001355 470400 1                  LDP0    SV$
         8 004106   040000 106500                    CMPC    fill='040'O
         8 004107   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 004110   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 004111   005331 601000 8                  TNZ     A1

   6839  8 004112   006262 701000 8                  TSX1    MYRELEASE
         8 004113   000000 011000                    NOP     0

     1884     6840    4                 END;

   6840  8 004114   005331 710000 8                  TRA     A1

     1885     6841    3               ELSE
     1886     6842    4                 DO;

     1887     6843    5                   DO CASE( TEMP);

   6843  8 004115   001345 235000 1                  LDA     TEMP
         8 004116   000020 115007                    CMPA    16,DL
         8 004117   004121 602005 8                  TNC     s:6843+4,AL
         8 004120   004151 710000 8                  TRA     s:6851
         8 004121   004151 710000 8                  TRA     s:6851
         8 004122   004141 710000 8                  TRA     s:6845
         8 004123   004151 710000 8                  TRA     s:6851
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:240  
         8 004124   004151 710000 8                  TRA     s:6851
         8 004125   004151 710000 8                  TRA     s:6851
         8 004126   004141 710000 8                  TRA     s:6845
         8 004127   004151 710000 8                  TRA     s:6851
         8 004130   004141 710000 8                  TRA     s:6845
         8 004131   004151 710000 8                  TRA     s:6851
         8 004132   004144 710000 8                  TRA     s:6847
         8 004133   004151 710000 8                  TRA     s:6851
         8 004134   004151 710000 8                  TRA     s:6851
         8 004135   004151 710000 8                  TRA     s:6851
         8 004136   004144 710000 8                  TRA     s:6847
         8 004137   004151 710000 8                  TRA     s:6851
         8 004140   004144 710000 8                  TRA     s:6847

     1888     6844    5                     CASE( 1, 5, 7);

     1889     6845    5                       SV.STATE = INITIAL;

   6845  8 004141   000036 236000 9                  LDQ     30
         8 004142   000046 356100                    ANSQ    38,,PR0
         8 004143   004151 710000 8                  TRA     s:6851

     1890     6846    5                     CASE( 9, 13, 15);

     1891     6847    5                       SV.STATE = INITIAL;

   6847  8 004144   000036 236000 9                  LDQ     30
         8 004145   000046 356100                    ANSQ    38,,PR0

     1892     6848    5                       CALL NOTIFY;

   6848  8 004146   001602 701000 8                  TSX1    NOTIFY
         8 004147   000000 011000                    NOP     0
         8 004150   004151 710000 8                  TRA     s:6851

     1893     6849    5                     CASE( ELSE);

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:241  
     1894     6850    5                   END;

     1895     6851    4                 SV.SCO = TRUE;

   6851  8 004151   001355 470400 1                  LDP0    SV$
         8 004152   004000 236003                    LDQ     2048,DU
         8 004153   000046 256100                    ORSQ    38,,PR0

     1896     6852    4                 IF SV.SCNO THEN CALL SCNOTIFYO;

   6852  8 004154   000046 236100                    LDQ     38,,PR0
         8 004155   020000 316003                    CANQ    8192,DU
         8 004156   005331 600000 8                  TZE     A1

   6852  8 004157   002022 701000 8                  TSX1    SCNOTIFYO
         8 004160   000000 011000                    NOP     0

     1897     6853    4                 END;

   6853  8 004161   005331 710000 8                  TRA     A1

     1898     6854        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:242  
     1899     6855    3             CASE( QUERY);

     1900     6856                    %DISP(MSG="$QSVQ:  Query");

   6860  8 004162   001374 236000 1                  LDQ     DISPLAYS
         8 004163   000003 116007                    CMPQ    3,DL
         8 004164   004175 604000 8                  TMI     s:6867

   6860  8 004165   000003 236000 9                  LDQ     3
         8 004166   200022 756100                    STQ     @LEN+1,,AUTO
         8 004167   000170 237000 9                  LDAQ    120
         8 004170   200020 757100                    STAQ    OSV$,,AUTO
         8 004171   000006 236000 9                  LDQ     6
         8 004172   200017 756100                    STQ     CLRSCE,,AUTO
         8 004173   005351 701000 8                  TSX1    WRITEMESS
         8 004174   000000 011000                    NOP     0

     1901     6867    3               CALL CHECKSIGNON ALTRET(SHERR);

   6867  8 004175   001125 701000 8                  TSX1    CHECKSIGNON
         8 004176   002663 702000 8                  TSX2    SHERR

     1902     6868    3               IF MSG.PARTNER2 = ' ' THEN

   6868  8 004177   040000 106400                    CMPC    fill='040'O
         8 004200   000012 000024 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=20
         8 004201   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 004202   004206 601000 8                  TNZ     s:6871

     1903     6869    3                K = 20;

   6869  8 004203   000024 235007                    LDA     20,DL
         8 004204   001347 755000 1                  STA     K
         8 004205   004210 710000 8                  TRA     s:6872

     1904     6870    3               ELSE
     1905     6871    3                K = 80;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:243  

   6871  8 004206   000120 235007                    LDA     80,DL
         8 004207   001347 755000 1                  STA     K

     1906     6872    3               TEMP = 0;

   6872  8 004210   001345 450000 1                  STZ     TEMP

     1907     6873    3               D$=ADDR(SPARE.DATA);                                         /*#8.369*/

   6873  8 004211   000172 236000 9                  LDQ     122
         8 004212   001352 756000 1                  STQ     D$

     1908     6874    3               SV$=SVHD$;

   6874  8 004213   001370 236000 1                  LDQ     SVHD$
         8 004214   001355 756000 1                  STQ     SV$

     1909     6875    4                 DO WHILE (SV$ ~= ADDR(NIL));

   6875  8 004215   004377 710000 8                  TRA     s:6914

     1910     6876    4                 IF SV.COUPLING = 1 THEN

   6876  8 004216   001355 470400 1                  LDP0    SV$
         8 004217   000002 236100                    LDQ     2,,PR0
         8 004220   000003 376003                    ANQ     3,DU
         8 004221   000001 116003                    CMPQ    1,DU
         8 004222   004374 601000 8                  TNZ     NO

     1911     6877    4                  IF (SV.MATCH.NAME=MSG.PARTNER1) OR (SV.MATCH.NAME=' ') OR

   6877  8 004223   040000 106500                    CMPC    fill='040'O
         8 004224   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 004225   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
         8 004226   004243 600000 8                  TZE     s:6880
         8 004227   040000 106500                    CMPC    fill='040'O
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:244  
         8 004230   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 004231   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 004232   004243 600000 8                  TZE     s:6880
         8 004233   040000 106500                    CMPC    fill='040'O
         8 004234   000043 000014                    ADSC9   35,,PR0                  cn=0,n=12
         8 004235   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 004236   004374 601000 8                  TNZ     NO
         8 004237   040000 106500                    CMPC    fill='040'O
         8 004240   000041 000010                    ADSC9   33,,PR0                  cn=0,n=8
         8 004241   000005 000010 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=8
         8 004242   004374 601000 8                  TNZ     NO

     1912     6878    4                  (SV.MATCH.N.UNAME=' ' AND SV.MATCH.N.ACCT=MSG.P1.ACCT) THEN
     1913     6879    5                    DO;

     1914     6880    5                    IF K = 80 THEN

   6880  8 004243   001347 235000 1                  LDA     K
         8 004244   000120 115007                    CMPA    80,DL
         8 004245   004263 601000 8                  TNZ     YES

     1915     6881    6                      DO;

     1916     6882    6                      IF (MSG.PARTNER2=SV.OFFER.NAME) OR

   6882  8 004246   040100 106400                    CMPC    fill='040'O
         8 004247   000012 000024 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=20
         8 004250   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 004251   004263 600000 8                  TZE     YES
         8 004252   040000 106400                    CMPC    fill='040'O
         8 004253   000014 000014 xsym               ADSC9   FI_APLCGBUF+12           cn=0,n=12
         8 004254   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 004255   004262 601000 8                  TNZ     s:6885
         8 004256   040100 106400                    CMPC    fill='040'O
         8 004257   000012 000010 xsym               ADSC9   FI_APLCGBUF+10           cn=0,n=8
         8 004260   000032 000010                    ADSC9   26,,PR0                  cn=0,n=8
         8 004261   004263 600000 8                  TZE     YES
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:245  

     1917     6883    6                      (MSG.P2.UNAME=' ' AND MSG.P2.ACCT=SV.OFFER.N.ACCT) THEN
     1918     6884    6                       GOTO YES;
     1919     6885    6                      GOTO NO;

   6885  8 004262   004374 710000 8                  TRA     NO

     1920     6886    6                      END;
     1921     6887    5   YES:
     1922     6888    5                    IF MSG.PARTNER1 = SV.OFFER.NAME THEN

   6888  8 004263   040100 106400       YES          CMPC    fill='040'O
         8 004264   000005 000024 xsym               ADSC9   FI_APLCGBUF+5            cn=0,n=20
         8 004265   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 004266   004374 600000 8                  TZE     NO

     1923     6889    5                     GOTO NO;
     1924     6890    5                    NEW$=ADDR(SPARE.DATA);                                  /*#8.369*/

   6890  8 004267   000172 236000 9                  LDQ     122
         8 004270   001342 756000 1                  STQ     NEW$

     1925     6891    6                      DO WHILE( NEW$ < D$);

   6891  8 004271   001352 116000 1                  CMPQ    D$
         8 004272   004325 603000 8                  TRC     s:6900

     1926     6892    6                      IF K = 20 THEN

   6892  8 004273   001347 235000 1                  LDA     K
         8 004274   000024 115007                    CMPA    20,DL
         8 004275   004305 601000 8                  TNZ     s:6895

     1927     6893    6                       IF NEW$ -> KBUF = SV.OFFER.NAME THEN

   6893  8 004276   001342 470400 1                  LDP0    NEW$
         8 004277   000000 620005                    EAX0    0,AL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:246  
         8 004300   001355 471400 1                  LDP1    SV$
         8 004301   040100 106540                    CMPC    fill='040'O
         8 004302   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         8 004303   100032 000024                    ADSC9   26,,PR1                  cn=0,n=20
         8 004304   004374 600000 8                  TZE     NO

     1928     6894    6                        GOTO NO;
     1929     6895    6                      IF K = 80 THEN

   6895  8 004305   001347 235000 1                  LDA     K
         8 004306   000120 115007                    CMPA    80,DL
         8 004307   004317 601000 8                  TNZ     s:6898

     1930     6896    6                       IF NEW$ -> KBUF = SV.SURROGATE THEN

   6896  8 004310   001342 470400 1                  LDP0    NEW$
         8 004311   000000 620005                    EAX0    0,AL
         8 004312   001355 471400 1                  LDP1    SV$
         8 004313   040100 106540                    CMPC    fill='040'O
         8 004314   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         8 004315   100002 400116                    ADSC9   2,,PR1                   cn=2,n=78
         8 004316   004374 600000 8                  TZE     NO

     1931     6897    6                        GOTO NO;
     1932     6898    6                      NEW$ = PINCRC( NEW$, K);

   6898  8 004317   001347 236000 1                  LDQ     K
         8 004320   000020 736000                    QLS     16
         8 004321   001342 036000 1                  ADLQ    NEW$
         8 004322   001342 756000 1                  STQ     NEW$

     1933     6899    6                      END;

   6899  8 004323   001352 116000 1                  CMPQ    D$
         8 004324   004273 602000 8                  TNC     s:6892

     1934     6900    5                    IF K = 20 THEN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:247  

   6900  8 004325   001347 235000 1                  LDA     K
         8 004326   000024 115007                    CMPA    20,DL
         8 004327   004337 601000 8                  TNZ     s:6904

     1935     6901    5                     D$ -> KBUF = SV.OFFER.NAME;

   6901  8 004330   001355 470400 1                  LDP0    SV$
         8 004331   001352 471400 1                  LDP1    D$
         8 004332   000000 620005                    EAX0    0,AL
         8 004333   040140 100500                    MLR     fill='040'O
         8 004334   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 004335   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         8 004336   004353 710000 8                  TRA     s:6908

     1936     6902    5                    ELSE
     1937     6903    6                      DO;

     1938     6904    6                      D$ -> KBUF = SV.SURROGATE;

   6904  8 004337   001355 470400 1                  LDP0    SV$
         8 004340   001352 471400 1                  LDP1    D$
         8 004341   000000 620005                    EAX0    0,AL
         8 004342   040140 100500                    MLR     fill='040'O
         8 004343   000002 400116                    ADSC9   2,,PR0                   cn=2,n=78
         8 004344   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

     1939     6905    6                      IF SV.SURRLEN > TEMP THEN

   6905  8 004345   000046 236100                    LDQ     38,,PR0
         8 004346   000022 772000                    QRL     18
         8 004347   000777 376007                    ANQ     511,DL
         8 004350   001345 116000 1                  CMPQ    TEMP
         8 004351   004353 604400 8                  TMOZ    s:6908

     1940     6906    6                       TEMP = SV.SURRLEN;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:248  
   6906  8 004352   001345 756000 1                  STQ     TEMP

     1941     6907    6                      END;

     1942     6908    5                    D$ = PINCRC( D$, K);

   6908  8 004353   001347 236000 1                  LDQ     K
         8 004354   000020 736000                    QLS     16
         8 004355   001352 036000 1                  ADLQ    D$
         8 004356   001352 756000 1                  STQ     D$

     1943     6909    5                    IF POFFW(D$,ADDR(SPARE.DATA)) > (LENGTHW(SPARE.DATA)-K/4) THEN
              6909                             /*#8.369*/

   6909  8 004357   000172 236000 9                  LDQ     122
         8 004360   000022 772000                    QRL     18
         8 004361   200032 756100                    STQ     STX+3,,AUTO
         8 004362   001352 236000 1                  LDQ     D$
         8 004363   000022 772000                    QRL     18
         8 004364   200032 136100                    SBLQ    STX+3,,AUTO
         8 004365   200033 756100                    STQ     STX+4,,AUTO
         8 004366   001347 236000 1                  LDQ     K
         8 004367   000004 506007                    DIV     4,DL
         8 004370   000027 676000 xsym               ERQ     B_VECTNIL+23
         8 004371   001321 036007                    ADLQ    721,DL
         8 004372   200033 116100                    CMPQ    STX+4,,AUTO
         8 004373   004401 604000 8                  TMI     READY

     1944     6910    5                     GOTO READY;                                            /*#8.369*/
     1945     6911    5                    END;

     1946     6912    4   NO:
     1947     6913    4                 SV$=SV$->SV.LNK$;

   6913  8 004374   001355 470400 1     NO           LDP0    SV$
         8 004375   000000 236100                    LDQ     0,,PR0
         8 004376   001355 756000 1                  STQ     SV$
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:249  

     1948     6914    4                 END;

   6914  8 004377   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 004400   004216 601000 8                  TNZ     s:6876

   6909  8 004401                       READY        null
     1949     6915    3   READY:      ;                                                            /*#8.369*/
     1950     6916    3               IF TEMP = 0 THEN

   6916  8 004401   001345 235000 1                  LDA     TEMP
         8 004402   004406 601000 8                  TNZ     s:6919

     1951     6917    3                MSG.FIELD2 = 20;

   6917  8 004403   000024 236007                    LDQ     20,DL
         8 004404   000004 756000 xsym               STQ     FI_APLCGBUF+4
         8 004405   004407 710000 8                  TRA     s:6920

     1952     6918    3               ELSE
     1953     6919    3                MSG.FIELD2 = TEMP;

   6919  8 004406   000004 755000 xsym               STA     FI_APLCGBUF+4

     1954     6920    3               TEMP=POFFW(D$,ADDR(SPARE.DATA));                             /*#8.369*/

   6920  8 004407   000172 236000 9                  LDQ     122
         8 004410   000022 772000                    QRL     18
         8 004411   200032 756100                    STQ     STX+3,,AUTO
         8 004412   001352 236000 1                  LDQ     D$
         8 004413   000022 772000                    QRL     18
         8 004414   200032 136100                    SBLQ    STX+3,,AUTO
         8 004415   001345 756000 1                  STQ     TEMP

     1955     6921    3               SPARE.SIZE = TEMP+4;

   6921  8 004416   000004 620006                    EAX0    4,QL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:250  
         8 004417   000004 440000 1                  SXL0    SPARE

     1956     6922    3               SPARE.LENGTH1 = TEMP/(K/4);

   6922  8 004420   001347 236000 1                  LDQ     K
         8 004421   000004 506007                    DIV     4,DL
         8 004422   200032 756100                    STQ     STX+3,,AUTO
         8 004423   001345 236000 1                  LDQ     TEMP
         8 004424   200032 506100                    DIV     STX+3,,AUTO
         8 004425   000006 756000 1                  STQ     SPARE+2

     1957     6923    3               SPARE.LENGTH2 = K;

   6923  8 004426   001347 235000 1                  LDA     K
         8 004427   000007 755000 1                  STA     SPARE+3

     1958     6924    3               K=4*SPARE.SIZE;                                              /*#8.369*/

   6924  8 004430   000004 236000 1                  LDQ     SPARE
         8 004431   000002 736000                    QLS     2
         8 004432   000173 376000 9                  ANQ     123
         8 004433   001347 756000 1                  STQ     K

     1959     6925    3               WRITE@.BUF_ = VECTOR( ADDR( SPARE) -> KBUF);

   6925  8 004434   001347 235000 1                  LDA     K
         8 004435   000020 735000                    ALS     16
         8 004436   000140 135007                    SBLA    96,DL
         8 004437   000174 236000 9                  LDQ     124
         8 004440   001650 757000 1                  STAQ    WRITE@+4

     1960     6926    3               WRITESVS@.BUF_ = VECTOR( ADDR(SPARE)->KBUF );

   6926  8 004441   001347 235000 1                  LDA     K
         8 004442   000020 735000                    ALS     16
         8 004443   000140 135007                    SBLA    96,DL
         8 004444   000174 236000 9                  LDQ     124
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:251  
         8 004445   001702 757000 1                  STAQ    WRITESVS@+4

     1961     6927    3               DBKEY.VAL = SVSIGNON$->SV.DBKEY;

   6927  8 004446   001357 470400 1                  LDP0    SVSIGNON$
         8 004447   000027 236100                    LDQ     23,,PR0
         8 004450   001353 552034 1                  STBQ    DBKEY,'34'O

     1962     6928    3               IF SVSIGNON$->SV.DBKEY < %SELECTOR

   6928  8 004451   000027 235100                    LDA     23,,PR0
         8 004452   000032 115000 9                  CMPA    26
         8 004453   004461 603000 8                  TRC     s:6930

     1963     6929    3               THEN CALL M$WRITE(WRITE@) ALTRET(SVERR);

   6929  8 004454   001644 630400 1                  EPPR0   WRITE@
         8 004455   440001 713400                    CLIMB   alt,write
         8 004456   401400 401760                    pmme    nvectors=4
         8 004457   005345 702000 8                  TSX2    SVERR
         8 004460   004465 710000 8                  TRA     s:6931

     1964     6930    3               ELSE CALL M$WRITE(WRITESVS@) ALTRET(SVERR);

   6930  8 004461   001676 630400 1                  EPPR0   WRITESVS@
         8 004462   440001 713400                    CLIMB   alt,write
         8 004463   401400 401760                    pmme    nvectors=4
         8 004464   005345 702000 8                  TSX2    SVERR

     1965     6931    3               SVSIGNON$->SV.DBSIZE = SPARE.SIZE;

   6931  8 004465   000004 720000 1                  LXL0    SPARE
         8 004466   001357 470400 1                  LDP0    SVSIGNON$
         8 004467   000046 440100                    SXL0    38,,PR0

     1966     6932    3               MSG.TYPE = COMPLETED;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:252  
   6932  8 004470   000000 450000 xsym               STZ     FI_APLCGBUF

     1967     6933    3               MSG.INAME = SPARE.SIZE;

   6933  8 004471   000004 236000 1                  LDQ     SPARE
         8 004472   777777 376007                    ANQ     -1,DL
         8 004473   000002 756000 xsym               STQ     FI_APLCGBUF+2

     1968     6934    3               MSG.FIELD1 = SVSIGNON$->SV.DBKEY;

   6934  8 004474   000027 235100                    LDA     23,,PR0
         8 004475   000003 755000 xsym               STA     FI_APLCGBUF+3

     1969     6935    3               CALL M$WRITE( WRITECG@) ALTRET( CGERR);

   6935  8 004476   001630 630400 1                  EPPR0   WRITECG@
         8 004477   440001 713400                    CLIMB   alt,write
         8 004500   401400 401760                    pmme    nvectors=4
         8 004501   005333 702000 8                  TSX2    CGERR
         8 004502   005331 710000 8                  TRA     A1

     1970     6936        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:253  
     1971     6937    3             CASE(GETDATA);

     1972     6938                /*  Transmit value of SV to SV user      */
     1973     6939    3               IF MSG.INAME = 0 THEN

   6939  8 004503   000002 236000 xsym               LDQ     FI_APLCGBUF+2
         8 004504   004521 601000 8                  TNZ     s:6951

     1974     6940                     %DISP(MSG="*Getdata* $QSVQ result");

   6944  8 004505   001374 235000 1                  LDA     DISPLAYS
         8 004506   000003 115007                    CMPA    3,DL
         8 004507   004541 604000 8                  TMI     s:6963

   6944  8 004510   000003 236000 9                  LDQ     3
         8 004511   200022 756100                    STQ     @LEN+1,,AUTO
         8 004512   000176 237000 9                  LDAQ    126
         8 004513   200020 757100                    STAQ    OSV$,,AUTO
         8 004514   000006 236000 9                  LDQ     6
         8 004515   200017 756100                    STQ     CLRSCE,,AUTO
         8 004516   005351 701000 8                  TSX1    WRITEMESS
         8 004517   000000 011000                    NOP     0

   6949  8 004520   004541 710000 8                  TRA     s:6963

     1975     6951    3               ELSE IF SV.MATCH.NAME ~= MYID THEN

   6951  8 004521   001355 470400 1                  LDP0    SV$
         8 004522   040000 106500                    CMPC    fill='040'O
         8 004523   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 004524   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 004525   004541 600000 8                  TZE     s:6963

     1976     6952                      %DISP(MSG="*Getdata*");

   6956  8 004526   001374 235000 1                  LDA     DISPLAYS
         8 004527   000003 115007                    CMPA    3,DL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:254  
         8 004530   004541 604000 8                  TMI     s:6963

   6956  8 004531   000003 236000 9                  LDQ     3
         8 004532   200022 756100                    STQ     @LEN+1,,AUTO
         8 004533   000200 237000 9                  LDAQ    128
         8 004534   200020 757100                    STAQ    OSV$,,AUTO
         8 004535   000006 236000 9                  LDQ     6
         8 004536   200017 756100                    STQ     CLRSCE,,AUTO
         8 004537   005351 701000 8                  TSX1    WRITEMESS
         8 004540   000000 011000                    NOP     0

     1977     6963    3               IF MSG.INAME = 0 THEN

   6963  8 004541   000002 235000 xsym               LDA     FI_APLCGBUF+2
         8 004542   004575 601000 8                  TNZ     s:6986

     1978     6964    4                 DO;

     1979     6965    4                 SV$ = SVHD$;

   6965  8 004543   001370 236000 1                  LDQ     SVHD$
         8 004544   001355 756000 1                  STQ     SV$

     1980     6966    5                   DO WHILE( SV$ ~= ADDR(NIL) );

   6966  8 004545   004557 710000 8                  TRA     s:6970

     1981     6967    5                   IF SV.SCDF THEN

   6967  8 004546   001355 470400 1                  LDP0    SV$
         8 004547   000046 430100                    FSZN    38,,PR0
         8 004550   004555 605000 8                  TPL     s:6969

     1982     6968    5                    IF SV.OFFER.STATION = STATION THEN GOTO GOTCHA;

   6968  8 004551   040000 106500                    CMPC    fill='040'O
         8 004552   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:255  
         8 004553   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 004554   004574 600000 8                  TZE     s:6978+1

     1983     6969    5                   SV$ = SV.LNK$;

   6969  8 004555   000000 236100                    LDQ     0,,PR0
         8 004556   001355 756000 1                  STQ     SV$

     1984     6970    5                   END;

   6970  8 004557   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 004560   004546 601000 8                  TNZ     s:6967

     1985     6971                      %DISP(MSG="No Signon Record for $QSVQ Result",CLASS=ERROR);

   6975  8 004561   001374 235000 1                  LDA     DISPLAYS
         8 004562   004573 604400 8                  TMOZ    s:6978

   6975  8 004563   000072 236000 9                  LDQ     58
         8 004564   200022 756100                    STQ     @LEN+1,,AUTO
         8 004565   000202 237000 9                  LDAQ    130
         8 004566   200020 757100                    STAQ    OSV$,,AUTO
         8 004567   000006 236000 9                  LDQ     6
         8 004570   200017 756100                    STQ     CLRSCE,,AUTO
         8 004571   005351 701000 8                  TSX1    WRITEMESS
         8 004572   000000 011000                    NOP     0

   6978  8 004573   005314 710000 8                  TRA     RIDSTATION
         8 004574   004645 710000 8                  TRA     s:7018

     1986     6982    4   GOTCHA:
     1987     6983    4                 END;
     1988     6984    3               ELSE
     1989     6985    4                 DO;

     1990     6986    4                 K = BITBIN(SV.STATE & '0111'B);

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:256  
   6986  8 004575   001355 470400 1                  LDP0    SV$
         8 004576   000046 236100                    LDQ     38,,PR0
         8 004577   740000 376003                    ANQ     -16384,DU
         8 004600   340000 376003                    ANQ     114688,DU
         8 004601   000040 772000                    QRL     32
         8 004602   001347 756000 1                  STQ     K

     1991     6987    4                 IF SV.OFFER.STATION = STATION THEN

   6987  8 004603   040000 106500                    CMPC    fill='040'O
         8 004604   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 004605   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 004606   004626 601000 8                  TNZ     s:7004

     1992     6988    5                   DO;

     1993     6989    5                   IF K < 2 OR K > 3 THEN

   6989  8 004607   000002 116007                    CMPQ    2,DL
         8 004610   004613 604000 8                  TMI     s:6994
         8 004611   000003 116007                    CMPQ    3,DL
         8 004612   004645 604400 8                  TMOZ    s:7018

     1994     6990                         %DISP(MSG="*Getdata* status bad (OFFER)",CLASS=ERROR);

   6994  8 004613   001374 235000 1                  LDA     DISPLAYS
         8 004614   004625 604400 8                  TMOZ    s:6997

   6994  8 004615   000072 236000 9                  LDQ     58
         8 004616   200022 756100                    STQ     @LEN+1,,AUTO
         8 004617   000204 237000 9                  LDAQ    132
         8 004620   200020 757100                    STAQ    OSV$,,AUTO
         8 004621   000006 236000 9                  LDQ     6
         8 004622   200017 756100                    STQ     CLRSCE,,AUTO
         8 004623   005351 701000 8                  TSX1    WRITEMESS
         8 004624   000000 011000                    NOP     0

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:257  
   6997  8 004625   005314 710000 8                  TRA     RIDSTATION

     1995     7001    5                   END;
     1996     7002    4                 ELSE
     1997     7003    5                   DO;

     1998     7004    5                   IF K ~= 1 AND K ~= 7 THEN

   7004  8 004626   000001 116007                    CMPQ    1,DL
         8 004627   004645 600000 8                  TZE     s:7018
         8 004630   000007 116007                    CMPQ    7,DL
         8 004631   004645 600000 8                  TZE     s:7018

     1999     7005                         %DISP(MSG="*Getdata* status bad (MATCH)",CLASS=ERROR);

   7009  8 004632   001374 235000 1                  LDA     DISPLAYS
         8 004633   004644 604400 8                  TMOZ    s:7012

   7009  8 004634   000072 236000 9                  LDQ     58
         8 004635   200022 756100                    STQ     @LEN+1,,AUTO
         8 004636   000206 237000 9                  LDAQ    134
         8 004637   200020 757100                    STAQ    OSV$,,AUTO
         8 004640   000006 236000 9                  LDQ     6
         8 004641   200017 756100                    STQ     CLRSCE,,AUTO
         8 004642   005351 701000 8                  TSX1    WRITEMESS
         8 004643   000000 011000                    NOP     0

   7012  8 004644   005314 710000 8                  TRA     RIDSTATION

     2000     7016    5                   END;
     2001     7017    4                 END;
     2002     7018    3               IF SV.MATCH.NAME = MYID THEN CALL MYASSIGNMENT ALTRET(LEAVE);

   7018  8 004645   040000 106500                    CMPC    fill='040'O
         8 004646   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 004647   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 004650   004653 601000 8                  TNZ     s:7019
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:258  

   7018  8 004651   005777 701000 8                  TSX1    MYASSIGNMENT
         8 004652   005331 702000 8                  TSX2    A1

     2003     7019    3               READSVS@.BUF_ = VECTOR(MSG.VNAME);

   7019  8 004653   000210 237000 9                  LDAQ    136
         8 004654   001664 757000 1                  STAQ    READSVS@+4

     2004     7020    3               IF SV.DBKEY < %SELECTOR THEN

   7020  8 004655   001355 470400 1                  LDP0    SV$
         8 004656   000027 235100                    LDA     23,,PR0
         8 004657   000032 115000 9                  CMPA    26
         8 004660   004674 603000 8                  TRC     s:7032

     2005     7021                     %DISP(MSG="*Getdata* data not on * file",CLASS=ERROR);

   7025  8 004661   001374 235000 1                  LDA     DISPLAYS
         8 004662   004673 604400 8                  TMOZ    s:7028

   7025  8 004663   000072 236000 9                  LDQ     58
         8 004664   200022 756100                    STQ     @LEN+1,,AUTO
         8 004665   000212 237000 9                  LDAQ    138
         8 004666   200020 757100                    STAQ    OSV$,,AUTO
         8 004667   000006 236000 9                  LDQ     6
         8 004670   200017 756100                    STQ     CLRSCE,,AUTO
         8 004671   005351 701000 8                  TSX1    WRITEMESS
         8 004672   000000 011000                    NOP     0

   7028  8 004673   005314 710000 8                  TRA     RIDSTATION

     2006     7032    3               DBKEY.VAL  = SV.DBKEY;

   7032  8 004674   000027 236100                    LDQ     23,,PR0
         8 004675   001353 552034 1                  STBQ    DBKEY,'34'O

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:259  
     2007     7033    3               K = 0;

   7033  8 004676   001347 450000 1                  STZ     K

     2008     7034    3   GETLP:
     2009     7035    3               CALL M$READ(READSVS@) ALTRET(GETLD);

   7035  8 004677   001660 630400 1     GETLP        EPPR0   READSVS@
         8 004700   440000 713400                    CLIMB   alt,read
         8 004701   401400 401760                    pmme    nvectors=4
         8 004702   004737 702000 8                  TSX2    GETLD

     2010     7036    3               READSVS@.V.DVBYTE.CONT# = FALSE;

   7036  8 004703   000051 236000 9                  LDQ     41
         8 004704   001673 356000 1                  ANSQ    READSVS@+11

     2011     7037    3               WRITECG@.V.DVBYTE.CONT# = FALSE;

   7037  8 004705   001643 356000 1                  ANSQ    WRITECG@+11

     2012     7038    3               IF K = 0 THEN

   7038  8 004706   001347 235000 1                  LDA     K
         8 004707   004716 601000 8                  TNZ     s:7043

     2013     7039    4                 DO;

     2014     7040    4                 K = F$SVS$->F$DCB.ARS#;

   7040  8 004710   000002 470400 1                  LDP0    F$SVS$
         8 004711   000000 235100                    LDA     0,,PR0
         8 004712   001347 755000 1                  STA     K

     2015     7041    4                 K = LENGTHC(MSG) - ( LENGTHC(MSG.VNAME) - K);

   7041  8 004713   000074 236007                    LDQ     60,DL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:260  
         8 004714   001347 056000 1                  ASQ     K

     2016     7042    4                 END;

   7042  8 004715   004721 710000 8                  TRA     s:7044

     2017     7043    3               ELSE K = F$SVS$->F$DCB.ARS#;    /* Write remaining */

   7043  8 004716   000002 470400 1                  LDP0    F$SVS$
         8 004717   000000 235100                    LDA     0,,PR0
         8 004720   001347 755000 1                  STA     K

     2018     7044    3               WRITECG@.BUF_ = VECTOR( ADDR(MSG)->KBUF );

   7044  8 004721   001347 236000 1                  LDQ     K
         8 004722   000064 737000                    LLS     52
         8 004723   000140 135007                    SBLA    96,DL
         8 004724   000001 236000 9                  LDQ     1
         8 004725   001634 757000 1                  STAQ    WRITECG@+4

     2019     7045    3   GETCN:
     2020     7046    3               CALL M$WRITE(WRITECG@) ALTRET(CGERR);

   7046  8 004726   001630 630400 1     GETCN        EPPR0   WRITECG@
         8 004727   440001 713400                    CLIMB   alt,write
         8 004730   401400 401760                    pmme    nvectors=4
         8 004731   005333 702000 8                  TSX2    CGERR

     2021     7047    3               IF READSVS@.V.DVBYTE.CONT# = TRUE THEN GOTO GETLP;

   7047  8 004732   001673 430000 1                  FSZN    READSVS@+11
         8 004733   004677 604000 8                  TMI     GETLP

     2022     7048    3               WRITECG@.BUF_ = VECTOR(MSG);

   7048  8 004734   000054 237000 9                  LDAQ    44
         8 004735   001634 757000 1                  STAQ    WRITECG@+4
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:261  

     2023     7049    3               GOTO LEAVE;

   7049  8 004736   005331 710000 8                  TRA     A1

     2024     7050    3   GETLD:
     2025     7051    3               IF B$ERRCODE = %E$LD THEN

   7051  8 004737   000000 470400 xsym  GETLD        LDP0    B$TCB$
         8 004740   000000 471500                    LDP1    0,,PR0
         8 004741   100102 236100                    LDQ     66,,PR1
         8 004742   377770 376007                    ANQ     131064,DL
         8 004743   000070 116007                    CMPQ    56,DL
         8 004744   004765 601000 8                  TNZ     s:7061

     2026     7052    4                 DO;

     2027     7053    4                 READSVS@.V.DVBYTE.CONT# = TRUE;

   7053  8 004745   001000 236003                    LDQ     512,DU
         8 004746   001673 256000 1                  ORSQ    READSVS@+11

     2028     7054    4                 WRITECG@.V.DVBYTE.CONT# = TRUE;

   7054  8 004747   001643 256000 1                  ORSQ    WRITECG@+11

     2029     7055    4                 READSVS@.BUF_ = VECTOR(MSG);

   7055  8 004750   000054 237000 9                  LDAQ    44
         8 004751   001664 757000 1                  STAQ    READSVS@+4

     2030     7056    4                 IF K = 0

   7056  8 004752   001347 235000 1                  LDA     K
         8 004753   004762 601000 8                  TNZ     s:7058

     2031     7057    4                 THEN K = ADDR(MSG.VNAME)->ZA1_DABLK.SIZE*4 - LENGTHC(MSG.VNAME);
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:262  

   7057  8 004754   000017 236000 xsym               LDQ     FI_APLCGBUF+15
         8 004755   000002 736000                    QLS     2
         8 004756   000173 376000 9                  ANQ     123
         8 004757   000120 136007                    SBLQ    80,DL
         8 004760   001347 756000 1                  STQ     K
         8 004761   004764 710000 8                  TRA     s:7059

     2032     7058    4                 ELSE K = K - LENGTHC(MSG);

   7058  8 004762   000214 336007                    LCQ     140,DL
         8 004763   001347 056000 1                  ASQ     K

     2033     7059    4                 GOTO GETCN;

   7059  8 004764   004726 710000 8                  TRA     GETCN

     2034     7060    4                 END;
     2035     7061    3               IF B$ERRCODE = %E$NOKEY THEN

   7061  8 004765   001020 116007                    CMPQ    528,DL
         8 004766   004775 601000 8                  TNZ     s:7067

     2036     7062    4                 DO;

     2037     7063    4                 MSG.TYPE = COMPLETED;

   7063  8 004767   000000 450000 xsym               STZ     FI_APLCGBUF

     2038     7064    4                 CALL M$WRITE(WRITECG@) ALTRET(CGERR);

   7064  8 004770   001630 630400 1                  EPPR0   WRITECG@
         8 004771   440001 713400                    CLIMB   alt,write
         8 004772   401400 401760                    pmme    nvectors=4
         8 004773   005333 702000 8                  TSX2    CGERR

     2039     7065    4                 GOTO LEAVE;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:263  

   7065  8 004774   005331 710000 8                  TRA     A1

     2040     7066    4                 END;
     2041     7067    3               CALL M$MERC;

   7067  8 004775   010007 713400                    CLIMB   4103
         8 004776   000000 401760                    pmme    nvectors=0
         8 004777   005331 710000 8                  TRA     A1

     2042     7068        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:264  
     2043     7069    3             CASE(PUTDATA);

     2044     7070                   /*   Recieve new SV value from CG      */
     2045     7071
     2046     7072                    %DISP(MSG="*Putdata*");

   7076  8 005000   001374 236000 1                  LDQ     DISPLAYS
         8 005001   000003 116007                    CMPQ    3,DL
         8 005002   005013 604000 8                  TMI     s:7083

   7076  8 005003   000003 236000 9                  LDQ     3
         8 005004   200022 756100                    STQ     @LEN+1,,AUTO
         8 005005   000214 237000 9                  LDAQ    140
         8 005006   200020 757100                    STAQ    OSV$,,AUTO
         8 005007   000006 236000 9                  LDQ     6
         8 005010   200017 756100                    STQ     CLRSCE,,AUTO
         8 005011   005351 701000 8                  TSX1    WRITEMESS
         8 005012   000000 011000                    NOP     0

     2047     7083    3               K = BITBIN(SV.STATE & '0111'B);

   7083  8 005013   001355 470400 1                  LDP0    SV$
         8 005014   000046 236100                    LDQ     38,,PR0
         8 005015   740000 376003                    ANQ     -16384,DU
         8 005016   340000 376003                    ANQ     114688,DU
         8 005017   000040 772000                    QRL     32
         8 005020   001347 756000 1                  STQ     K

     2048     7084    3               IF SV.OFFER.STATION = STATION THEN

   7084  8 005021   040000 106500                    CMPC    fill='040'O
         8 005022   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 005023   001330 000010 1                  ADSC9   STATION                  cn=0,n=8
         8 005024   005044 601000 8                  TNZ     s:7100

     2049     7085    4                 DO;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:265  
     2050     7086    4                 IF K ~= 6 AND K~= 3 THEN

   7086  8 005025   000006 116007                    CMPQ    6,DL
         8 005026   005063 600000 8                  TZE     s:7113
         8 005027   000003 116007                    CMPQ    3,DL
         8 005030   005063 600000 8                  TZE     s:7113

     2051     7087                       %DISP(MSG="*Putdata* state illegal (OFFER)",CLASS=ERROR);

   7091  8 005031   001374 235000 1                  LDA     DISPLAYS
         8 005032   005043 604400 8                  TMOZ    s:7094

   7091  8 005033   000072 236000 9                  LDQ     58
         8 005034   200022 756100                    STQ     @LEN+1,,AUTO
         8 005035   000216 237000 9                  LDAQ    142
         8 005036   200020 757100                    STAQ    OSV$,,AUTO
         8 005037   000006 236000 9                  LDQ     6
         8 005040   200017 756100                    STQ     CLRSCE,,AUTO
         8 005041   005351 701000 8                  TSX1    WRITEMESS
         8 005042   000000 011000                    NOP     0

   7094  8 005043   005314 710000 8                  TRA     RIDSTATION

     2052     7098    4                 END;
     2053     7099    3               ELSE
     2054     7100    3                IF K ~= 5 AND K~= 7 THEN

   7100  8 005044   000005 116007                    CMPQ    5,DL
         8 005045   005063 600000 8                  TZE     s:7113
         8 005046   000007 116007                    CMPQ    7,DL
         8 005047   005063 600000 8                  TZE     s:7113

     2055     7101                      %DISP(MSG="*Putdata* state illegal (MATCH)",CLASS=ERROR);

   7105  8 005050   001374 235000 1                  LDA     DISPLAYS
         8 005051   005062 604400 8                  TMOZ    s:7108

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:266  
   7105  8 005052   000072 236000 9                  LDQ     58
         8 005053   200022 756100                    STQ     @LEN+1,,AUTO
         8 005054   000220 237000 9                  LDAQ    144
         8 005055   200020 757100                    STAQ    OSV$,,AUTO
         8 005056   000006 236000 9                  LDQ     6
         8 005057   200017 756100                    STQ     CLRSCE,,AUTO
         8 005060   005351 701000 8                  TSX1    WRITEMESS
         8 005061   000000 011000                    NOP     0

   7108  8 005062   005314 710000 8                  TRA     RIDSTATION

     2056     7112
     2057     7113    3               K = ADDR(MSG.VNAME)->ZA1_DABLK.TYPE;

   7113  8 005063   000017 236000 xsym               LDQ     FI_APLCGBUF+15
         8 005064   000033 772000                    QRL     27
         8 005065   001347 756000 1                  STQ     K

     2058     7114    3               IF K < 1 OR K > 5 AND K~=10 THEN

   7114  8 005066   005073 604400 8                  TMOZ    s:7119
         8 005067   000005 116007                    CMPQ    5,DL
         8 005070   005106 604400 8                  TMOZ    s:7126
         8 005071   000012 116007                    CMPQ    10,DL
         8 005072   005106 600000 8                  TZE     s:7126

     2059     7115                     %DISP(MSG="*Putdata* Illegal Data type",CLASS=ERROR);

   7119  8 005073   001374 235000 1                  LDA     DISPLAYS
         8 005074   005105 604400 8                  TMOZ    s:7122

   7119  8 005075   000072 236000 9                  LDQ     58
         8 005076   200022 756100                    STQ     @LEN+1,,AUTO
         8 005077   000224 237000 9                  LDAQ    148
         8 005100   200020 757100                    STAQ    OSV$,,AUTO
         8 005101   000006 236000 9                  LDQ     6
         8 005102   200017 756100                    STQ     CLRSCE,,AUTO
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:267  
         8 005103   005351 701000 8                  TSX1    WRITEMESS
         8 005104   000000 011000                    NOP     0

   7122  8 005105   005314 710000 8                  TRA     RIDSTATION

     2060     7126    3               K = ADDR(MSG.VNAME)->ZA1_DABLK.RANK;

   7126  8 005106   000017 236000 xsym               LDQ     FI_APLCGBUF+15
         8 005107   000022 772000                    QRL     18
         8 005110   000777 376007                    ANQ     511,DL
         8 005111   001347 756000 1                  STQ     K

     2061     7127    3               IF K > 62 THEN

   7127  8 005112   000076 116007                    CMPQ    62,DL
         8 005113   005127 604400 8                  TMOZ    s:7139

     2062     7128                     %DISP(MSG="*Putdata* Illegal Rank",CLASS=ERROR);

   7132  8 005114   001374 235000 1                  LDA     DISPLAYS
         8 005115   005126 604400 8                  TMOZ    s:7135

   7132  8 005116   000072 236000 9                  LDQ     58
         8 005117   200022 756100                    STQ     @LEN+1,,AUTO
         8 005120   000226 237000 9                  LDAQ    150
         8 005121   200020 757100                    STAQ    OSV$,,AUTO
         8 005122   000006 236000 9                  LDQ     6
         8 005123   200017 756100                    STQ     CLRSCE,,AUTO
         8 005124   005351 701000 8                  TSX1    WRITEMESS
         8 005125   000000 011000                    NOP     0

   7135  8 005126   005314 710000 8                  TRA     RIDSTATION

     2063     7139    3               SV.DBSIZE = ADDR(MSG.VNAME)->ZA1_DABLK.SIZE;

   7139  8 005127   000017 720000 xsym               LXL0    FI_APLCGBUF+15
         8 005130   000046 440100                    SXL0    38,,PR0
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:268  

     2064     7140    3               K = ADDR(MSG.VNAME)->ZA1_DABLK.SIZE*4;

   7140  8 005131   000017 236000 xsym               LDQ     FI_APLCGBUF+15
         8 005132   000002 736000                    QLS     2
         8 005133   000173 376000 9                  ANQ     123
         8 005134   001347 756000 1                  STQ     K

     2065     7141    3               IF SV.MATCH.NAME = MYID THEN CALL HISASSIGN ALTRET(LEAVE);

   7141  8 005135   040000 106500                    CMPC    fill='040'O
         8 005136   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
         8 005137   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 005140   005143 601000 8                  TNZ     s:7142

   7141  8 005141   005714 701000 8                  TSX1    HISASSIGN
         8 005142   005331 702000 8                  TSX2    A1

     2066     7142    3               L = K;

   7142  8 005143   001347 235000 1                  LDA     K
         8 005144   200006 755100                    STA     L,,AUTO

     2067     7143    3               READCGC@.V.DVBYTE.CONT# = TRUE;

   7143  8 005145   001000 236003                    LDQ     512,DU
         8 005146   001775 256000 1                  ORSQ    READCGC@+11

     2068     7144    3               IF FI_EVNT$->FI$EVNT.CITE$->FI$APLRD.ERRCODE = %E$LD THEN

   7144  8 005147   000000 470400 xsym               LDP0    FI_EVNT$
         8 005150   000002 471500                    LDP1    2,,PR0
         8 005151   100003 720100                    LXL0    3,,PR1
         8 005152   000007 100003                    CMPX0   7,DU
         8 005153   005160 601000 8                  TNZ     s:7151

     2069     7145    4                 DO;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:269  

     2070     7146    4                 WRITESVS@.V.DVBYTE.CONT# = TRUE;

   7146  8 005154   001711 256000 1                  ORSQ    WRITESVS@+11

     2071     7147    4                 WRITESVS@.BUF_ = VECTOR(MSG.VNAME);

   7147  8 005155   000210 237000 9                  LDAQ    136
         8 005156   001702 757000 1                  STAQ    WRITESVS@+4

     2072     7148    4                 END;

   7148  8 005157   005166 710000 8                  TRA     s:7154

     2073     7149    3               ELSE
     2074     7150    4                 DO;

     2075     7151    4                 WRITESVS@.BUF_ = VECTOR(ADDR(MSG.VNAME)->KBUF);

   7151  8 005160   000020 735000                    ALS     16
         8 005161   000140 135007                    SBLA    96,DL
         8 005162   000211 236000 9                  LDQ     137
         8 005163   001702 757000 1                  STAQ    WRITESVS@+4

     2076     7152    4                 WRITESVS@.V.DVBYTE.CONT# = FALSE;

   7152  8 005164   000051 236000 9                  LDQ     41
         8 005165   001711 356000 1                  ANSQ    WRITESVS@+11

     2077     7153    4                 END;

     2078     7154    3               TEMP = LENGTHC(MSG.VNAME);

   7154  8 005166   000120 236007                    LDQ     80,DL
         8 005167   001345 756000 1                  STQ     TEMP

     2079     7155    3               IF SV.DBKEY < %SELECTOR THEN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:270  

   7155  8 005170   001355 471400 1                  LDP1    SV$
         8 005171   100027 235100                    LDA     23,,PR1
         8 005172   000032 115000 9                  CMPA    26
         8 005173   005207 603000 8                  TRC     s:7167

     2080     7156                     %DISP(MSG="*Putdata* Data not on * file",CLASS=ERROR);

   7160  8 005174   001374 235000 1                  LDA     DISPLAYS
         8 005175   005206 604400 8                  TMOZ    s:7163

   7160  8 005176   000072 236000 9                  LDQ     58
         8 005177   200022 756100                    STQ     @LEN+1,,AUTO
         8 005200   000230 237000 9                  LDAQ    152
         8 005201   200020 757100                    STAQ    OSV$,,AUTO
         8 005202   000006 236000 9                  LDQ     6
         8 005203   200017 756100                    STQ     CLRSCE,,AUTO
         8 005204   005351 701000 8                  TSX1    WRITEMESS
         8 005205   000000 011000                    NOP     0

   7163  8 005206   005314 710000 8                  TRA     RIDSTATION

     2081     7167    3               DBKEY.VAL = SV.DBKEY;

   7167  8 005207   100027 236100                    LDQ     23,,PR1
         8 005210   001353 552034 1                  STBQ    DBKEY,'34'O

     2082     7168    3   PUTLP:
     2083     7169    3               CALL M$WRITE(WRITESVS@) ALTRET(SVERR);

   7169  8 005211   001676 630400 1     PUTLP        EPPR0   WRITESVS@
         8 005212   440001 713400                    CLIMB   alt,write
         8 005213   401400 401760                    pmme    nvectors=4
         8 005214   005345 702000 8                  TSX2    SVERR

     2084     7170    3               IF WRITESVS@.V.DVBYTE.CONT# = FALSE THEN GOTO LEAVE;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:271  
   7170  8 005215   001711 430000 1                  FSZN    WRITESVS@+11
         8 005216   005331 605000 8                  TPL     A1

     2085     7171    3               L = L - TEMP;

   7171  8 005217   200006 236100                    LDQ     L,,AUTO
         8 005220   001345 136000 1                  SBLQ    TEMP
         8 005221   200006 756100                    STQ     L,,AUTO

     2086     7172    3               IF L <= 0 THEN

   7172  8 005222   005236 605400 8                  TPNZ    s:7184

     2087     7173                     %DISP(MSG="*Putdata* More data written that DBSIZE",CLASS=ERROR);

   7177  8 005223   001374 235000 1                  LDA     DISPLAYS
         8 005224   005235 604400 8                  TMOZ    s:7180

   7177  8 005225   000072 236000 9                  LDQ     58
         8 005226   200022 756100                    STQ     @LEN+1,,AUTO
         8 005227   000232 237000 9                  LDAQ    154
         8 005230   200020 757100                    STAQ    OSV$,,AUTO
         8 005231   000006 236000 9                  LDQ     6
         8 005232   200017 756100                    STQ     CLRSCE,,AUTO
         8 005233   005351 701000 8                  TSX1    WRITEMESS
         8 005234   000000 011000                    NOP     0

   7180  8 005235   005314 710000 8                  TRA     RIDSTATION

     2088     7184    3               TEMP = LENGTHC(MSG);

   7184  8 005236   000214 235007                    LDA     140,DL
         8 005237   001345 755000 1                  STA     TEMP

     2089     7185    3               K = MINIMUM(LENGTHC(MSG),L);

   7185  8 005240   000214 116007                    CMPQ    140,DL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:272  
         8 005241   005243 604400 8                  TMOZ    s:7185+3
         8 005242   000214 236007                    LDQ     140,DL
         8 005243   001347 756000 1                  STQ     K

     2090     7186    3               READCGC@.BUF_ = VECTOR( ADDR(MSG)->KBUF );

   7186  8 005244   001347 235000 1                  LDA     K
         8 005245   000020 735000                    ALS     16
         8 005246   000140 135007                    SBLA    96,DL
         8 005247   000001 236000 9                  LDQ     1
         8 005250   001766 757000 1                  STAQ    READCGC@+4

     2091     7187    3               WRITESVS@.BUF_ = READCGC@.BUF_;

   7187  8 005251   001766 237000 1                  LDAQ    READCGC@+4
         8 005252   001702 757000 1                  STAQ    WRITESVS@+4

     2092     7188    3               IF L = K THEN WRITESVS@.V.DVBYTE.CONT# = FALSE;

   7188  8 005253   200006 236100                    LDQ     L,,AUTO
         8 005254   001347 116000 1                  CMPQ    K
         8 005255   005260 601000 8                  TNZ     s:7189

   7188  8 005256   000051 236000 9                  LDQ     41
         8 005257   001711 356000 1                  ANSQ    WRITESVS@+11

     2093     7189    3               CALL M$READ(READCGC@) ALTRET(PUTLD);

   7189  8 005260   001762 630400 1                  EPPR0   READCGC@
         8 005261   440000 713400                    CLIMB   alt,read
         8 005262   401400 401760                    pmme    nvectors=4
         8 005263   005305 702000 8                  TSX2    PUTLD

     2094     7190    3               WRITESVS@.V.DVBYTE.CONT# = FALSE;

   7190  8 005264   000051 236000 9                  LDQ     41
         8 005265   001711 356000 1                  ANSQ    WRITESVS@+11
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:273  

     2095     7191    3               IF L~=K THEN

   7191  8 005266   200006 236100                    LDQ     L,,AUTO
         8 005267   001347 116000 1                  CMPQ    K
         8 005270   005304 600000 8                  TZE     s:7203

     2096     7192                     %DISP(MSG="*Putdata* Less data written than DBSIZE",CLASS=ERROR);

   7196  8 005271   001374 235000 1                  LDA     DISPLAYS
         8 005272   005303 604400 8                  TMOZ    s:7199

   7196  8 005273   000072 236000 9                  LDQ     58
         8 005274   200022 756100                    STQ     @LEN+1,,AUTO
         8 005275   000234 237000 9                  LDAQ    156
         8 005276   200020 757100                    STAQ    OSV$,,AUTO
         8 005277   000006 236000 9                  LDQ     6
         8 005300   200017 756100                    STQ     CLRSCE,,AUTO
         8 005301   005351 701000 8                  TSX1    WRITEMESS
         8 005302   000000 011000                    NOP     0

   7199  8 005303   005314 710000 8                  TRA     RIDSTATION

     2097     7203    3               GOTO PUTLP;

   7203  8 005304   005211 710000 8                  TRA     PUTLP

     2098     7204    3   PUTLD:
     2099     7205    3               IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD THEN GOTO PUTLP;

   7205  8 005305   000000 470400 xsym  PUTLD        LDP0    B$TCB$
         8 005306   000000 471500                    LDP1    0,,PR0
         8 005307   100102 236100                    LDQ     66,,PR1
         8 005310   377770 376007                    ANQ     131064,DL
         8 005311   000070 116007                    CMPQ    56,DL
         8 005312   005211 600000 8                  TZE     PUTLP

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:274  
     2100     7206    3               GOTO CGERR;

   7206  8 005313   005333 710000 8                  TRA     CGERR

     2101     7207        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:275  
     2102     7208    3             CASE( ELSE);

     2103     7209    3   RIDSTATION:
     2104     7210    3               STATIONNAME=FI_EVNT$->FI$EVNT.CITE$->FI$APLRD.NAME;

   7210  8 005314   000000 470400 xsym  RIDSTATION   LDP0    FI_EVNT$
         8 005315   000002 471500                    LDP1    2,,PR0
         8 005316   040000 100500                    MLR     fill='040'O
         8 005317   100004 000010                    ADSC9   4,,PR1                   cn=0,n=8
         8 005320   001350 000010 1                  ADSC9   STATIONNAME              cn=0,n=8

     2105     7211    3               IF STATIONNAME = 'INSYM' THEN GOTO LEAVE;

   7211  8 005321   040000 106400                    CMPC    fill='040'O
         8 005322   001350 000010 1                  ADSC9   STATIONNAME              cn=0,n=8
         8 005323   001326 000005 2                  ADSC9   SV_REQUIRED+329          cn=0,n=5
         8 005324   005331 600000 8                  TZE     A1

     2106     7212    3               CALL M$DEACTIVATE (DEACTIVATE_USER) ALTRET(A1);

   7212  8 005325   000350 630400 2                  EPPR0   DEACTIVATE_USER
         8 005326   500001 713400                    CLIMB   alt,+32769
         8 005327   401400 401760                    pmme    nvectors=4
         8 005330   005331 702000 8                  TSX2    A1

   7211  8 005331                       A1           null
     2107     7213    3   A1:         ;
     2108     7214    3           END; /* OF CASE( MSG.TYPE) */

     2109     7215    2   LEAVE:
     2110     7216    2         RETURN;

   7216  8 005331   200010 221300       LEAVE        LDX1  ! L+2,,AUTO
         8 005332   000001 702211                    TSX2  ! 1,X1

     2111     7217    2   CGERR:
     2112     7218    2         IF %E$LDSC = B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.CODE THEN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:276  

   7218  8 005333   000000 470400 xsym  CGERR        LDP0    B$TCB$
         8 005334   000000 471500                    LDP1    0,,PR0
         8 005335   100102 236100                    LDQ     66,,PR1
         8 005336   377770 376007                    ANQ     131064,DL
         8 005337   000140 116007                    CMPQ    96,DL
         8 005340   005343 601000 8                  TNZ     s:7220

     2113     7219    2          RETURN;

   7219  8 005341   200010 221300                    LDX1  ! L+2,,AUTO
         8 005342   000001 702211                    TSX2  ! 1,X1

     2114     7220    2         CALL M$MERC;

   7220  8 005343   010007 713400                    CLIMB   4103
         8 005344   000000 401760                    pmme    nvectors=0

   7218  8 005345                       SVERR        null
     2115     7221    2   SVERR:;
     2116     7222    2         CALL M$MERC;

   7222  8 005345   010007 713400                    CLIMB   4103
         8 005346   000000 401760                    pmme    nvectors=0

     2117     7223    2   END SVPROCESSOR;

   7223  8 005347   200010 221300                    LDX1  ! L+2,,AUTO
         8 005350   000001 702211                    TSX2  ! 1,X1

     2118     7224        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:277  
     2119     7225        /**************************************************************/
     2120     7226        /*                                                            */
     2121     7227        /*I*    NAME:       WRITEMESS                                 *
     2122     7228         *                                                            *
     2123     7229         *      PURPOSE:    To format the message to be displayed.    *
     2124     7230         *                                                            *
     2125     7231         *      DESCRIPTION: The message to be displayed is prefixed  *
     2126     7232         *                  by the current station name and the       *
     2127     7233         *                  message is written through M$DO (if       *
     2128     7234         *                  FI_DISPLAYS > 0).                         *
     2129     7235         *                                                            *
     2130     7236         **************************************************************/
     2131     7237
     2132     7238    1   WRITEMESS: PROC(STATION, MESSAGE, LEN, CLASS);

   7238  8 005351   200016 741300       WRITEMESS    STX1  ! FIRST+2,,AUTO

     2133     7239
     2134     7240    2   DCL  STATION  CHAR(8);
     2135     7241    2   DCL  MESSAGE  CHAR(LEN);
     2136     7242    2   DCL  LEN      UBIN;
     2137     7243    2   DCL  CLASS    SBIN;
     2138     7244    2   DCL  OLDTYPE  SBIN;
     2139     7245    2   DCL  OLDFLD1  SBIN;
     2140     7246    2   DCL  OLDINAM  SBIN;
     2141     7247    2   DCL  OLDMID   SBIN;
     2142     7248    2   DCL  STX      CHAR(8);
     2143     7249
     2144     7250        %FPT_WRITE(   FPTN     =  WRITEMSG@,
     2145     7251                      DCB      =  M$DO,
     2146     7252                      BUF      =  SPARE.BUFR,
     2147     7253                      STCLASS  =  STATIC);
     2148     7284
     2149     7285    2         SUBSTR(SPARE.BUFR,0,150) = ' ';

   7285  8 005352   040000 100400                    MLR     fill='040'O
         8 005353   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:278  
         8 005354   000010 000226 1                  ADSC9   SPARE+4                  cn=0,n=150

     2150     7286    2         SUBSTR(SPARE.BUFR,2,10)  = STATION;

   7286  8 005355   200017 470500                    LDP0    @STATION,,AUTO
         8 005356   040000 100500                    MLR     fill='040'O
         8 005357   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         8 005360   000010 400012 1                  ADSC9   SPARE+4                  cn=2,n=10

     2151     7287    2         SUBSTR(SPARE.BUFR,11,2)  = '->';

   7287  8 005361   040000 100400                    MLR     fill='040'O
         8 005362   001330 000002 2                  ADSC9   SV_REQUIRED+331          cn=0,n=2
         8 005363   000012 600002 1                  ADSC9   SPARE+6                  cn=3,n=2

     2152     7288    2         SUBSTR(SPARE.BUFR,14,130)= MESSAGE;

   7288  8 005364   200021 471500                    LDP1    @LEN,,AUTO
         8 005365   100000 720100                    LXL0    0,,PR1
         8 005366   200020 473500                    LDP3    @MESSAGE,,AUTO
         8 005367   040000 100540                    MLR     fill='040'O
         8 005370   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         8 005371   000013 400202 1                  ADSC9   SPARE+7                  cn=2,n=130

     2153     7289    2         WRITEMSG@.BUF_.BOUND = LEN+16;

   7289  8 005372   100000 236100                    LDQ     0,,PR1
         8 005373   000020 036007                    ADLQ    16,DL
         8 005374   000020 736000                    QLS     16
         8 005375   002004 676000 1                  ERQ     WRITEMSG@+4
         8 005376   000034 376000 xsym               ANQ     B_VECTNIL+28
         8 005377   002004 656000 1                  ERSQ    WRITEMSG@+4

     2154     7290    2         IF FIA_DISPLAYS>=CLASS THEN CALL M$WRITE(WRITEMSG@)ALTRET(IGNORE);

   7290  8 005400   200022 474500                    LDP4    @CLASS,,AUTO
         8 005401   000052 236000 2                  LDQ     FIA_DISPLAYS
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:279  
         8 005402   400000 116100                    CMPQ    0,,PR4
         8 005403   005410 604000 8                  TMI     IGNORE

   7290  8 005404   002000 630400 1                  EPPR0   WRITEMSG@
         8 005405   440001 713400                    CLIMB   alt,write
         8 005406   401400 401760                    pmme    nvectors=4
         8 005407   005410 702000 8                  TSX2    IGNORE

     2155     7291    2   IGNORE:
     2156     7292    2         IF FIA_VDISPLAY>=CLASS THEN

   7292  8 005410   200022 470500       IGNORE       LDP0    @CLASS,,AUTO
         8 005411   001375 236000 1                  LDQ     FIA_VDISPLAY
         8 005412   000000 116100                    CMPQ    0,,PR0
         8 005413   005532 604000 8                  TMI     IGNRE

     2157     7293    3           DO;

     2158     7294    3           WRITESVX@.BUF_ = VECTOR(SUBSTR(SPARE.BUFR,0,80));

   7294  8 005414   000236 237000 9                  LDAQ    158
         8 005415   001716 757000 1                  STAQ    WRITESVX@+4

     2159     7295    3           WRITESVX@.V.DVBYTE.CONT# = TRUE;

   7295  8 005416   001000 236003                    LDQ     512,DU
         8 005417   001725 256000 1                  ORSQ    WRITESVX@+11

     2160     7296    3           IF FIA_VRECS0 <= 50 THEN

   7296  8 005420   001377 235000 1                  LDA     FIA_VRECS0
         8 005421   000062 115007                    CMPA    50,DL
         8 005422   005434 605400 8                  TPNZ    s:7303

     2161     7297    4             DO;

     2162     7298    4             IF FIA_VRECS0 = 50
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:280  

   7298  8 005423   005427 601000 8                  TNZ     s:7300

     2163     7299    4             THEN SUBSTR(SPARE.BUFR,,80) = '******* OVERFLOW *******';

   7299  8 005424   040000 100400                    MLR     fill='040'O
         8 005425   001331 000030 2                  ADSC9   SV_REQUIRED+332          cn=0,n=24
         8 005426   000010 000120 1                  ADSC9   SPARE+4                  cn=0,n=80

     2164     7300    4             CALL M$WRITE(WRITESVX@) ALTRET(IGNRE);

   7300  8 005427   001712 630400 1                  EPPR0   WRITESVX@
         8 005430   440001 713400                    CLIMB   alt,write
         8 005431   401400 401760                    pmme    nvectors=4
         8 005432   005532 702000 8                  TSX2    IGNRE

     2165     7301    4             FIA_VRECS0 = FIA_VRECS0 + 1;

   7301  8 005433   001377 054000 1                  AOS     FIA_VRECS0

     2166     7302    4             END;

     2167     7303    3           IF BITBIN(MYSV$(0)->SV.STATE) = 8 AND MYSV$(0)->SV.MIDO>0 THEN

   7303  8 005434   001401 470400 1                  LDP0    MYSV$
         8 005435   000046 236100                    LDQ     38,,PR0
         8 005436   000040 772000                    QRL     32
         8 005437   000010 116007                    CMPQ    8,DL
         8 005440   005515 601000 8                  TNZ     s:7328
         8 005441   000047 220100                    LDX0    39,,PR0
         8 005442   005515 600000 8                  TZE     s:7328

     2168     7304    4             DO;

     2169     7305    4             STX = STA.STATION#;

   7305  8 005443   001332 237000 1                  LDAQ    STA
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:281  
         8 005444   200027 755100                    STA     STX,,AUTO
         8 005445   200030 756100                    STQ     STX+1,,AUTO

     2170     7306    4             STA.STATION# = MYSV$(0)->SV.OFFER.STATION;

   7306  8 005446   040000 100500                    MLR     fill='040'O
         8 005447   000030 000010                    ADSC9   24,,PR0                  cn=0,n=8
         8 005450   001332 000010 1                  ADSC9   STA                      cn=0,n=8

     2171     7307    4             OLDMID = MSG.MID;

   7307  8 005451   000001 235000 xsym               LDA     FI_APLCGBUF+1
         8 005452   200026 755100                    STA     OLDMID,,AUTO

     2172     7308    4             OLDTYPE= MSG.TYPE;

   7308  8 005453   000000 235000 xsym               LDA     FI_APLCGBUF
         8 005454   200023 755100                    STA     OLDTYPE,,AUTO

     2173     7309    4             OLDFLD1= MSG.FIELD1;

   7309  8 005455   000003 235000 xsym               LDA     FI_APLCGBUF+3
         8 005456   200024 755100                    STA     OLDFLD1,,AUTO

     2174     7310    4             OLDINAM= MSG.INAME;

   7310  8 005457   000002 235000 xsym               LDA     FI_APLCGBUF+2
         8 005460   200025 755100                    STA     OLDINAM,,AUTO

     2175     7311
     2176     7312    4             MSG.TYPE = COMPLETED;

   7312  8 005461   000000 450000 xsym               STZ     FI_APLCGBUF

     2177     7313    4             MSG.MID  = MYSV$(0)->SV.MIDO;

   7313  8 005462   000047 236100                    LDQ     39,,PR0
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:282  
         8 005463   000022 772000                    QRL     18
         8 005464   000001 756000 xsym               STQ     FI_APLCGBUF+1

     2178     7314    4             MSG.FIELD1 = 1;

   7314  8 005465   000001 235007                    LDA     1,DL
         8 005466   000003 755000 xsym               STA     FI_APLCGBUF+3

     2179     7315    4             MSG.INAMER = MYSV$(0);

   7315  8 005467   001401 236000 1                  LDQ     MYSV$
         8 005470   000002 756000 xsym               STQ     FI_APLCGBUF+2

     2180     7316    4             CALL M$WRITE(WRITECG@) ALTRET(IGNO);

   7316  8 005471   001630 630400 1                  EPPR0   WRITECG@
         8 005472   440001 713400                    CLIMB   alt,write
         8 005473   401400 401760                    pmme    nvectors=4
         8 005474   005475 702000 8                  TSX2    IGNO

     2181     7317    4   IGNO:
     2182     7318    4             STA.STATION# = STX;

   7318  8 005475   040000 100500       IGNO         MLR     fill='040'O
         8 005476   200027 000010                    ADSC9   STX,,AUTO                cn=0,n=8
         8 005477   001332 000010 1                  ADSC9   STA                      cn=0,n=8

     2183     7319    4             MSG.MID      = OLDMID;

   7319  8 005500   200026 235100                    LDA     OLDMID,,AUTO
         8 005501   000001 755000 xsym               STA     FI_APLCGBUF+1

     2184     7320    4             MSG.TYPE     = OLDTYPE;

   7320  8 005502   200023 236100                    LDQ     OLDTYPE,,AUTO
         8 005503   000000 756000 xsym               STQ     FI_APLCGBUF

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:283  
     2185     7321    4             MSG.FIELD1   = OLDFLD1;

   7321  8 005504   200024 235100                    LDA     OLDFLD1,,AUTO
         8 005505   000003 755000 xsym               STA     FI_APLCGBUF+3

     2186     7322    4             MSG.INAME    = OLDINAM;

   7322  8 005506   200025 235100                    LDA     OLDINAM,,AUTO
         8 005507   000002 755000 xsym               STA     FI_APLCGBUF+2

     2187     7323
     2188     7324    4             MYSV$(0)->SV.STATE.N = '0'B;

   7324  8 005510   001401 470400 1                  LDP0    MYSV$
         8 005511   000031 236000 xsym               LDQ     B_VECTNIL+25
         8 005512   000046 356100                    ANSQ    38,,PR0

     2189     7325    4             MYSV$(0)->SV.MIDO    = 0;

   7325  8 005513   000000 220003                    LDX0    0,DU
         8 005514   000047 740100                    STX0    39,,PR0

     2190     7326    4             END;

     2191     7327
     2192     7328    3           IF BITBIN(MYSV$(0)->SV.STATE & '0111'B) = 0 THEN

   7328  8 005515   000046 236100                    LDQ     38,,PR0
         8 005516   740000 376003                    ANQ     -16384,DU
         8 005517   340000 376003                    ANQ     114688,DU
         8 005520   000040 772000                    QRL     32
         8 005521   005532 601000 8                  TNZ     IGNRE

     2193     7329    4             DO;

     2194     7330    4             MYSV$(0)->SV.ASMM = '1010'B;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:284  
   7330  8 005522   000002 236100                    LDQ     2,,PR0
         8 005523   000037 376000 9                  ANQ     31
         8 005524   024000 276003                    ORQ     10240,DU
         8 005525   000002 756100                    STQ     2,,PR0

     2195     7331    4             MYSV$(0)->SV.ASMO = '0101'B;

   7331  8 005526   000002 236100                    LDQ     2,,PR0
         8 005527   000036 376000 9                  ANQ     30
         8 005530   240000 276003                    ORQ     81920,DU
         8 005531   000002 756100                    STQ     2,,PR0

     2196     7332    4             END;

     2197     7333    3           END;

     2198     7334    2   IGNRE:
     2199     7335    2         RETURN;

   7335  8 005532   200016 221300       IGNRE        LDX1  ! FIRST+2,,AUTO
         8 005533   000001 702211                    TSX2  ! 1,X1

     2200     7336    2   END WRITEMESS;
     2201     7337        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:285  
     2202     7338    1   MYOFFER: PROC;

   7338  8 005534   200012 741300       MYOFFER      STX1  ! L+4,,AUTO

     2203     7339    2   DCL  I     SBIN;
     2204     7340
     2205     7341    3           DO I = 0 TO %MYVARS;

   7341  8 005535   200013 450100                    STZ     I,,AUTO

     2206     7342    3           IF SV.SURROGATE = MYVARS(I) THEN GOTO GOTV;

   7342  8 005536   200013 236100                    LDQ     I,,AUTO
         8 005537   000024 402007                    MPY     20,DL
         8 005540   001355 470400 1                  LDP0    SV$
         8 005541   040006 106500                    CMPC    fill='040'O
         8 005542   000002 400116                    ADSC9   2,,PR0                   cn=2,n=78
         8 005543   000057 000024 2                  ADSC9   MYVARS,Q                 cn=0,n=20
         8 005544   005553 600000 8                  TZE     GOTV

     2207     7343    3           END;

   7343  8 005545   200013 054100                    AOS     I,,AUTO
         8 005546   200013 235100                    LDA     I,,AUTO
         8 005547   000002 115007                    CMPA    2,DL
         8 005550   005536 604400 8                  TMOZ    s:7342

     2208     7344    2         RETURN;

   7344  8 005551   200012 221300                    LDX1  ! L+4,,AUTO
         8 005552   000001 702211                    TSX2  ! 1,X1

     2209     7345    2   GOTV:
     2210     7346    2         IF MYSV$(I) ~= ADDR(NIL) THEN RETURN;

   7346  8 005553   200013 720100       GOTV         LXL0    I,,AUTO
         8 005554   001401 236010 1                  LDQ     MYSV$,X0
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:286  
         8 005555   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 005556   005561 600000 8                  TZE     s:7347

   7346  8 005557   200012 221300                    LDX1  ! L+4,,AUTO
         8 005560   000001 702211                    TSX2  ! 1,X1

     2211     7347    2         MYSV$(I) = SV$;

   7347  8 005561   001355 236000 1                  LDQ     SV$
         8 005562   001401 756010 1                  STQ     MYSV$,X0

     2212     7348    2         SV.COUPLING = 2;

   7348  8 005563   000002 236100                    LDQ     2,,PR0
         8 005564   000022 376000 9                  ANQ     18
         8 005565   000002 276003                    ORQ     2,DU
         8 005566   000002 756100                    STQ     2,,PR0

     2213     7349    2         SV.MATCH.NAME = MYID;

   7349  8 005567   040100 100400                    MLR     fill='040'O
         8 005570   000076 000024 2                  ADSC9   MYID                     cn=0,n=20
         8 005571   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20

     2214     7350    2         SV.MATCH.STATION = 'APLSVP';

   7350  8 005572   040100 100400                    MLR     fill='040'O
         8 005573   001337 000006 2                  ADSC9   SV_REQUIRED+338          cn=0,n=6
         8 005574   000037 000010                    ADSC9   31,,PR0                  cn=0,n=8

     2215     7351    2         SV.ACVM = INITIAL;

   7351  8 005575   000027 236000 9                  LDQ     23
         8 005576   000002 356100                    ANSQ    2,,PR0

     2216     7352    2         SV.SCO = TRUE;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:287  
   7352  8 005577   004000 236003                    LDQ     2048,DU
         8 005600   000046 256100                    ORSQ    38,,PR0

     2217     7353    2         IF SV.DBKEY < %SELECTOR THEN SV.DBKEY = SV.DBKEY + %SELECTOR;

   7353  8 005601   000027 235100                    LDA     23,,PR0
         8 005602   000032 115000 9                  CMPA    26
         8 005603   005606 603000 8                  TRC     s:7355

   7353  8 005604   000032 035000 9                  ADLA    26
         8 005605   000027 755100                    STA     23,,PR0

     2218     7354
     2219     7355    3           DO CASE(I);

   7355  8 005606   200013 235100                    LDA     I,,AUTO
         8 005607   000001 115007                    CMPA    1,DL
         8 005610   005612 602005 8                  TNC     s:7355+4,AL
         8 005611   005631 710000 8                  TRA     IG
         8 005612   005613 710000 8                  TRA     s:7357

     2220     7356    3             CASE(0);

     2221     7357    3               FIA_VDISPLAY = 3;

   7357  8 005613   000003 235007                    LDA     3,DL
         8 005614   001375 755000 1                  STA     FIA_VDISPLAY

     2222     7358    3               FIA_VRECS0   = 0;

   7358  8 005615   001377 450000 1                  STZ     FIA_VRECS0

     2223     7359    3               FIA_VRECS1   = 0;

   7359  8 005616   001400 450000 1                  STZ     FIA_VRECS1

     2224     7360    3               CALL COMPUTE_DISPLAY;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:288  

   7360  8 005617   006361 701000 8                  TSX1    COMPUTE_DISPLAY
         8 005620   000000 011000                    NOP     0

     2225     7361    3               WRITESVX@.BUF_ = VECTOR(LOG_HEADER);

   7361  8 005621   000240 237000 9                  LDAQ    160
         8 005622   001716 757000 1                  STAQ    WRITESVX@+4

     2226     7362    3               WRITESVX@.V.DVBYTE.CONT# = TRUE;

   7362  8 005623   001000 236003                    LDQ     512,DU
         8 005624   001725 256000 1                  ORSQ    WRITESVX@+11

     2227     7363    3               CALL M$WRITE(WRITESVX@) ALTRET(IG);

   7363  8 005625   001712 630400 1                  EPPR0   WRITESVX@
         8 005626   440001 713400                    CLIMB   alt,write
         8 005627   401400 401760                    pmme    nvectors=4
         8 005630   005631 702000 8                  TSX2    IG

     2228     7364    3   IG:
     2229     7365    3           END;

   7365  8 005631                       IG           null
     2230     7366    2   DONE:
     2231     7367    2         RETURN;

   7367  8 005631   200012 221300       DONE         LDX1  ! L+4,,AUTO
         8 005632   000001 702211                    TSX2  ! 1,X1

     2232     7368    2   END MYOFFER;
     2233     7369        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:289  
     2234     7370    1   MYRETRACT: PROC;

   7370  8 005633   200012 741300       MYRETRACT    STX1  ! L+4,,AUTO

     2235     7371    2   DCL  I     SBIN;
     2236     7372
     2237     7373    3           DO I = 0 TO %MYVARS;

   7373  8 005634   200013 450100                    STZ     I,,AUTO

     2238     7374    3           IF SV.SURROGATE = MYVARS(I) THEN GOTO GOTV;

   7374  8 005635   200013 236100                    LDQ     I,,AUTO
         8 005636   000024 402007                    MPY     20,DL
         8 005637   001355 470400 1                  LDP0    SV$
         8 005640   040006 106500                    CMPC    fill='040'O
         8 005641   000002 400116                    ADSC9   2,,PR0                   cn=2,n=78
         8 005642   000057 000024 2                  ADSC9   MYVARS,Q                 cn=0,n=20
         8 005643   005652 600000 8                  TZE     GOTV

     2239     7375    3           END;

   7375  8 005644   200013 054100                    AOS     I,,AUTO
         8 005645   200013 235100                    LDA     I,,AUTO
         8 005646   000002 115007                    CMPA    2,DL
         8 005647   005635 604400 8                  TMOZ    s:7374

     2240     7376    2         RETURN;

   7376  8 005650   200012 221300                    LDX1  ! L+4,,AUTO
         8 005651   000001 702211                    TSX2  ! 1,X1

     2241     7377    2   GOTV:
     2242     7378    2         IF MYSV$(I) ~= SV$ THEN RETURN;

   7378  8 005652   200013 720100       GOTV         LXL0    I,,AUTO
         8 005653   001401 236010 1                  LDQ     MYSV$,X0
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:290  
         8 005654   001355 116000 1                  CMPQ    SV$
         8 005655   005660 600000 8                  TZE     s:7379

   7378  8 005656   200012 221300                    LDX1  ! L+4,,AUTO
         8 005657   000001 702211                    TSX2  ! 1,X1

     2243     7379    2         MYSV$(I) = ADDR(NIL);

   7379  8 005660   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 005661   001401 756010 1                  STQ     MYSV$,X0

     2244     7380    2         CALL SVDELINK;

   7380  8 005662   000455 701000 8                  TSX1    SVDELINK
         8 005663   000000 011000                    NOP     0

     2245     7381    2         SVX$ = SV$;

   7381  8 005664   001355 236000 1                  LDQ     SV$
         8 005665   001356 756000 1                  STQ     SVX$

     2246     7382    2         CALL FOI$RBUF(SVSCB,SVX$);

   7382  8 005666   000014 630400 9                  EPPR0   12
         8 005667   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 005670   000000 701000 xent               TSX1    FOI$RBUF
         8 005671   000000 011000                    NOP     0

     2247     7383
     2248     7384    3           DO CASE(I);

   7384  8 005672   200013 235100                    LDA     I,,AUTO
         8 005673   000001 115007                    CMPA    1,DL
         8 005674   005676 602005 8                  TNC     s:7384+4,AL
         8 005675   005712 710000 8                  TRA     IGN
         8 005676   005677 710000 8                  TRA     s:7386

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:291  
     2249     7385    3             CASE(0);

     2250     7386    3               FIA_VDISPLAY = 0;

   7386  8 005677   001375 450000 1                  STZ     FIA_VDISPLAY

     2251     7387    3               CALL COMPUTE_DISPLAY;

   7387  8 005700   006361 701000 8                  TSX1    COMPUTE_DISPLAY
         8 005701   000000 011000                    NOP     0

     2252     7388    3               WRITESVX@.BUF_ = VECTOR(NIL);

   7388  8 005702   000242 237000 9                  LDAQ    162
         8 005703   001716 757000 1                  STAQ    WRITESVX@+4

     2253     7389    3               WRITESVX@.V.DVBYTE.CONT# = FALSE;

   7389  8 005704   000051 236000 9                  LDQ     41
         8 005705   001725 356000 1                  ANSQ    WRITESVX@+11

     2254     7390    3               CALL M$WRITE(WRITESVX@) ALTRET(IGN);

   7390  8 005706   001712 630400 1                  EPPR0   WRITESVX@
         8 005707   440001 713400                    CLIMB   alt,write
         8 005710   401400 401760                    pmme    nvectors=4
         8 005711   005712 702000 8                  TSX2    IGN

     2255     7391    3   IGN:
     2256     7392    3           END;

   7392  8 005712                       IGN          null
     2257     7393    2   DONE:
     2258     7394    2         RETURN;

   7394  8 005712   200012 221300       DONE         LDX1  ! L+4,,AUTO
         8 005713   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:292  

     2259     7395    2   END MYRETRACT;
     2260     7396        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:293  
     2261     7397    1   HISASSIGN: PROC ALTRET;

   7397  8 005714   200012 741300       HISASSIGN    STX1  ! L+4,,AUTO

     2262     7398    2   DCL  I  SBIN;
     2263     7399
     2264     7400    2         CALL MYLOOKUP(I) ALTRET(DONE);

   7400  8 005715   200013 630500                    EPPR0   I,,AUTO
         8 005716   200017 450500                    STP0    @STATION,,AUTO
         8 005717   006321 701000 8                  TSX1    MYLOOKUP
         8 005720   005775 702000 8                  TSX2    DONE

     2265     7401    3           DO CASE(I);

   7401  8 005721   200013 235100                    LDA     I,,AUTO
         8 005722   000001 115007                    CMPA    1,DL
         8 005723   005725 602005 8                  TNC     s:7401+4,AL
         8 005724   005775 710000 8                  TRA     DONE
         8 005725   005726 710000 8                  TRA     s:7403

     2266     7402    3             CASE(0);

     2267     7403    3               IF ADDR(MSG.VNAME)->ZA1_DABLK.TYPE ~= 3 THEN ALTRETURN;

   7403  8 005726   000017 236000 xsym               LDQ     FI_APLCGBUF+15
         8 005727   777000 376003                    ANQ     -512,DU
         8 005730   003000 116003                    CMPQ    1536,DU
         8 005731   005734 600000 8                  TZE     s:7404

   7403  8 005732   200012 221300                    LDX1  ! L+4,,AUTO
         8 005733   000000 702211                    TSX2  ! 0,X1

     2268     7404    4                 DO CASE( ADDR(MSG.VNAME)->ZA1_DABLK.RANK );

   7404  8 005734   000017 220000 xsym               LDX0    FI_APLCGBUF+15
         8 005735   000777 360003                    ANX0    511,DU
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:294  
         8 005736   000002 100003                    CMPX0   2,DU
         8 005737   005741 602010 8                  TNC     s:7404+5,X0
         8 005740   005757 710000 8                  TRA     s:7412
         8 005741   005743 710000 8                  TRA     s:7406
         8 005742   005746 710000 8                  TRA     s:7408

     2269     7405    4                   CASE(0);

     2270     7406    4                     L = ADDR(MSG.VNAME)->ZA1_DABLK.LENGTHS(0);

   7406  8 005743   000021 235000 xsym               LDA     FI_APLCGBUF+17
         8 005744   200006 755100                    STA     L,,AUTO
         8 005745   005761 710000 8                  TRA     s:7414

     2271     7407    4                   CASE(1);

     2272     7408    4                     L = ADDR(MSG.VNAME)->ZA1_DABLK.LENGTHS(0);

   7408  8 005746   000021 235000 xsym               LDA     FI_APLCGBUF+17
         8 005747   200006 755100                    STA     L,,AUTO

     2273     7409    4                     IF L ~= 1 THEN RETURN;

   7409  8 005750   000001 115007                    CMPA    1,DL
         8 005751   005754 600000 8                  TZE     s:7410

   7409  8 005752   200012 221300                    LDX1  ! L+4,,AUTO
         8 005753   000001 702211                    TSX2  ! 1,X1

     2274     7410    4                     L = ADDR(MSG.VNAME)->ZA1_DABLK.LENGTHS(1);

   7410  8 005754   000022 235000 xsym               LDA     FI_APLCGBUF+18
         8 005755   200006 755100                    STA     L,,AUTO
         8 005756   005761 710000 8                  TRA     s:7414

     2275     7411    4                   CASE(ELSE);

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:295  
     2276     7412    4                     RETURN;

   7412  8 005757   200012 221300                    LDX1  ! L+4,,AUTO
         8 005760   000001 702211                    TSX2  ! 1,X1

     2277     7413    4                 END;

     2278     7414    3               IF L < 0 THEN L = 0;

   7414  8 005761   005763 605000 8                  TPL     s:7415

   7414  8 005762   200006 450100                    STZ     L,,AUTO

     2279     7415    3               IF L > 3 THEN L = 3;

   7415  8 005763   200006 235100                    LDA     L,,AUTO
         8 005764   000003 115007                    CMPA    3,DL
         8 005765   005770 604400 8                  TMOZ    s:7416

   7415  8 005766   000003 235007                    LDA     3,DL
         8 005767   200006 755100                    STA     L,,AUTO

     2280     7416    3               FIA_VDISPLAY = L;

   7416  8 005770   001375 755000 1                  STA     FIA_VDISPLAY

     2281     7417    3               CALL COMPUTE_DISPLAY;

   7417  8 005771   006361 701000 8                  TSX1    COMPUTE_DISPLAY
         8 005772   000000 011000                    NOP     0

     2282     7418    3               ALTRETURN;

   7418  8 005773   200012 221300                    LDX1  ! L+4,,AUTO
         8 005774   000000 702211                    TSX2  ! 0,X1

     2283     7419    3           END;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:296  

     2284     7420    2   DONE:
     2285     7421    2         RETURN;

   7421  8 005775   200012 221300       DONE         LDX1  ! L+4,,AUTO
         8 005776   000001 702211                    TSX2  ! 1,X1

     2286     7422    2   END HISASSIGN;
     2287     7423        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:297  
     2288     7424    1   MYASSIGNMENT: PROC ALTRET;

   7424  8 005777   200012 741300       MYASSIGNMENT STX1  ! L+4,,AUTO

     2289     7425    2   DCL  I  SBIN;
     2290     7426
     2291     7427    2         CALL MYLOOKUP(I) ALTRET(DONE);

   7427  8 006000   200013 630500                    EPPR0   I,,AUTO
         8 006001   200017 450500                    STP0    @STATION,,AUTO
         8 006002   006321 701000 8                  TSX1    MYLOOKUP
         8 006003   006011 702000 8                  TSX2    DONE

     2292     7428    3           DO CASE(I);

   7428  8 006004   200013 235100                    LDA     I,,AUTO
         8 006005   000001 115007                    CMPA    1,DL
         8 006006   006010 602005 8                  TNC     s:7428+4,AL
         8 006007   006011 710000 8                  TRA     DONE
         8 006010   006011 710000 8                  TRA     DONE

     2293     7429    3             CASE(0); ;

     2294     7430    3           END;  /*** Of my variable case      ***/

     2295     7431    2   DONE:
     2296     7432    2         RETURN;

   7432  8 006011   200012 221300       DONE         LDX1  ! L+4,,AUTO
         8 006012   000001 702211                    TSX2  ! 1,X1

     2297     7433    2   END MYASSIGNMENT;
     2298     7434        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:298  
     2299     7435    1   MYLATCH: PROC;

   7435  8 006013   200012 741300       MYLATCH      STX1  ! L+4,,AUTO

     2300     7436    2   DCL  I     SBIN;
     2301     7437    2   DCL  FIRST SBIN;
     2302     7438
     2303     7439    2         CALL MYLOOKUP(I) ALTRET(DONE);

   7439  8 006014   200013 630500                    EPPR0   I,,AUTO
         8 006015   200017 450500                    STP0    @STATION,,AUTO
         8 006016   006321 701000 8                  TSX1    MYLOOKUP
         8 006017   006233 702000 8                  TSX2    IGIT

     2304     7440    3           DO CASE(I);

   7440  8 006020   200013 235100                    LDA     I,,AUTO
         8 006021   000002 115007                    CMPA    2,DL
         8 006022   006024 602005 8                  TNC     s:7440+4,AL
         8 006023   006233 710000 8                  TRA     IGIT
         8 006024   006026 710000 8                  TRA     s:7442
         8 006025   006126 710000 8                  TRA     s:7481

     2305     7441    3             CASE(0);

     2306     7442    3               WRITESVX@.BUF_ = VECTOR(NIL);

   7442  8 006026   000242 237000 9                  LDAQ    162
         8 006027   001716 757000 1                  STAQ    WRITESVX@+4

     2307     7443    3               WRITESVX@.V.DVBYTE.CONT# = FALSE;

   7443  8 006030   000051 236000 9                  LDQ     41
         8 006031   001725 356000 1                  ANSQ    WRITESVX@+11

     2308     7444    3               CALL M$WRITE(WRITESVX@) ALTRET(IGNOR);

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:299  
   7444  8 006032   001712 630400 1                  EPPR0   WRITESVX@
         8 006033   440001 713400                    CLIMB   alt,write
         8 006034   401400 401760                    pmme    nvectors=4
         8 006035   006036 702000 8                  TSX2    IGNOR

     2309     7445    3   IGNOR:
     2310     7446    3               FIA_VRECS1 = FIA_VRECS0;

   7446  8 006036   001377 235000 1     IGNOR        LDA     FIA_VRECS0
         8 006037   001400 755000 1                  STA     FIA_VRECS1

     2311     7447
     2312     7448    3               DBKEY.VAL = SV.DBKEY;

   7448  8 006040   001355 470400 1                  LDP0    SV$
         8 006041   000027 236100                    LDQ     23,,PR0
         8 006042   001353 552034 1                  STBQ    DBKEY,'34'O

     2313     7449    3               WRITESVS@.V.DVBYTE.CONT# = FALSE;

   7449  8 006043   000051 236000 9                  LDQ     41
         8 006044   001711 356000 1                  ANSQ    WRITESVS@+11

     2314     7450    3               READSVX@.V.DVBYTE.CONT# = FALSE;

   7450  8 006045   001741 356000 1                  ANSQ    READSVX@+11

     2315     7451    3               READSVX@.BUF_ = VECTOR(SPARE.BUFR);

   7451  8 006046   000244 237000 9                  LDAQ    164
         8 006047   001732 757000 1                  STAQ    READSVX@+4

     2316     7452    3               FIRST = 0;

   7452  8 006050   200014 450100                    STZ     FIRST,,AUTO

     2317     7453    3   COPYLP:
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:300  
     2318     7454    3               CALL M$READ(READSVX@) ALTRET(CHKLD);

   7454  8 006051   001726 630400 1     COPYLP       EPPR0   READSVX@
         8 006052   440000 713400                    CLIMB   alt,read
         8 006053   401400 401760                    pmme    nvectors=4
         8 006054   006235 702000 8                  TSX2    CHKLD

     2319     7455    3               READSVX@.V.DVBYTE.CONT# = FALSE;

   7455  8 006055   000051 236000 9                  LDQ     41
         8 006056   001741 356000 1                  ANSQ    READSVX@+11

     2320     7456    3               WRITESVS@.V.DVBYTE.CONT# = FALSE;

   7456  8 006057   001711 356000 1                  ANSQ    WRITESVS@+11

     2321     7457    3   CONT:
     2322     7458    3               IF FIRST = 0 THEN

   7458  8 006060   200014 235100       CONT         LDA     FIRST,,AUTO
         8 006061   006072 601000 8                  TNZ     s:7464

     2323     7459    4                 DO;

     2324     7460    4                 ADDR(SPARE.BUFR)->ZA1_DABLK.SIZE = 4+FIA_VRECS1*20;

   7460  8 006062   001400 236000 1                  LDQ     FIA_VRECS1
         8 006063   000024 402007                    MPY     20,DL
         8 006064   000004 620006                    EAX0    4,QL
         8 006065   000010 440000 1                  SXL0    SPARE+4

     2325     7461    4                 ADDR(SPARE.BUFR)->ZA1_DABLK.LENGTHS(0) = FIA_VRECS1;

   7461  8 006066   001400 235000 1                  LDA     FIA_VRECS1
         8 006067   000012 755000 1                  STA     SPARE+6

     2326     7462    4                 FIRST = 1;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:301  

   7462  8 006070   000001 235007                    LDA     1,DL
         8 006071   200014 755100                    STA     FIRST,,AUTO

     2327     7463    4                 END;

     2328     7464    3               K = F$SVX$->F$DCB.ARS#;

   7464  8 006072   000003 470400 1                  LDP0    F$SVX$
         8 006073   000000 235100                    LDA     0,,PR0
         8 006074   001347 755000 1                  STA     K

     2329     7465    3               WRITESVS@.BUF_ = VECTOR( ADDR(SPARE.BUFR)->KBUF );

   7465  8 006075   000020 735000                    ALS     16
         8 006076   000140 135007                    SBLA    96,DL
         8 006077   000172 236000 9                  LDQ     122
         8 006100   001702 757000 1                  STAQ    WRITESVS@+4

     2330     7466    3               CALL M$WRITE(WRITESVS@) ALTRET(HMMERR);

   7466  8 006101   001676 630400 1                  EPPR0   WRITESVS@
         8 006102   440001 713400                    CLIMB   alt,write
         8 006103   401400 401760                    pmme    nvectors=4
         8 006104   006105 702000 8                  TSX2    HMMERR

     2331     7467    3   HMMERR:
     2332     7468    3               IF WRITESVS@.V.DVBYTE.CONT# = TRUE THEN GOTO COPYLP;

   7468  8 006105   001711 430000 1     HMMERR       FSZN    WRITESVS@+11
         8 006106   006051 604000 8                  TMI     COPYLP

     2333     7469    3   ENDLOG:
     2334     7470    3               FIA_VRECS0 = 0;

   7470  8 006107   001377 450000 1     ENDLOG       STZ     FIA_VRECS0

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:302  
     2335     7471    3               WRITESVX@.BUF_ = VECTOR(LOG_HEADER);

   7471  8 006110   000240 237000 9                  LDAQ    160
         8 006111   001716 757000 1                  STAQ    WRITESVX@+4

     2336     7472    3               WRITESVX@.V.DVBYTE.CONT# = TRUE;

   7472  8 006112   001000 236003                    LDQ     512,DU
         8 006113   001725 256000 1                  ORSQ    WRITESVX@+11

     2337     7473    3               CALL M$WRITE(WRITESVX@) ALTRET(IGNR);

   7473  8 006114   001712 630400 1                  EPPR0   WRITESVX@
         8 006115   440001 713400                    CLIMB   alt,write
         8 006116   401400 401760                    pmme    nvectors=4
         8 006117   006120 702000 8                  TSX2    IGNR

     2338     7474    3   IGNR:
     2339     7475    3               SV.DBSIZE = 4 + FIA_VRECS1*20;

   7475  8 006120   001400 236000 1     IGNR         LDQ     FIA_VRECS1
         8 006121   000024 402007                    MPY     20,DL
         8 006122   000004 620006                    EAX0    4,QL
         8 006123   001355 470400 1                  LDP0    SV$
         8 006124   000046 440100                    SXL0    38,,PR0
         8 006125   006233 710000 8                  TRA     IGIT

     2340     7476
     2341     7477
     2342     7478
     2343     7479    3             CASE(1);

     2344     7480
     2345     7481    3               K = (4*4) + 0;

   7481  8 006126   000020 236007                    LDQ     16,DL
         8 006127   001347 756000 1                  STQ     K
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:303  

     2346     7482    3               D$ = SVHD$;

   7482  8 006130   001370 236000 1                  LDQ     SVHD$
         8 006131   001352 756000 1                  STQ     D$

     2347     7483
     2348     7484    4                 DO WHILE(D$ ~= ADDR(NIL));

   7484  8 006132   006175 710000 8                  TRA     s:7498

     2349     7485
     2350     7486    4                 SUBSTR(SPARE.BUFR,K,2) = BINASC(D$->SV.COUPLING+ASCBIN('0'));

   7486  8 006133   001352 470400 1                  LDP0    D$
         8 006134   000002 236100                    LDQ     2,,PR0
         8 006135   000022 772000                    QRL     18
         8 006136   000003 376007                    ANQ     3,DL
         8 006137   000060 036007                    ADLQ    48,DL
         8 006140   000033 736000                    QLS     27
         8 006141   000246 276000 9                  ORQ     166
         8 006142   200032 756100                    STQ     STX+3,,AUTO
         8 006143   001347 235000 1                  LDA     K
         8 006144   040005 100500                    MLR     fill='040'O
         8 006145   200032 000004                    ADSC9   STX+3,,AUTO              cn=0,n=4
         8 006146   000010 000002 1                  ADSC9   SPARE+4,A                cn=0,n=2

     2351     7487    4                 SUBSTR(SPARE.BUFR,K+2,21) = D$->SV.OFFER.NAME;

   7487  8 006147   040005 100500                    MLR     fill='040'O
         8 006150   000032 000024                    ADSC9   26,,PR0                  cn=0,n=20
         8 006151   000010 400025 1                  ADSC9   SPARE+4,A                cn=2,n=21

     2352     7488    4                 SUBSTR(SPARE.BUFR,K+23,21) = D$->SV.MATCH.NAME;

   7488  8 006152   040005 100500                    MLR     fill='040'O
         8 006153   000041 000024                    ADSC9   33,,PR0                  cn=0,n=20
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:304  
         8 006154   000015 600025 1                  ADSC9   SPARE+9,A                cn=3,n=21

     2353     7489    4                 SUBSTR(SPARE.BUFR,K+44,84) = D$->SV.SURROGATE;

   7489  8 006155   040005 100500                    MLR     fill='040'O
         8 006156   000002 400116                    ADSC9   2,,PR0                   cn=2,n=78
         8 006157   000023 000124 1                  ADSC9   SPARE+15,A               cn=0,n=84

     2354     7490    4                 K = K+128;

   7490  8 006160   000200 236007                    LDQ     128,DL
         8 006161   001347 056000 1                  ASQ     K

     2355     7491    4                 D$ = D$->SV.LNK$;

   7491  8 006162   000000 236100                    LDQ     0,,PR0
         8 006163   001352 756000 1                  STQ     D$

     2356     7492    4                 IF K+128>LENGTHC(SPARE.BUFR) AND D$~= ADDR(NIL) THEN

   7492  8 006164   001347 235000 1                  LDA     K
         8 006165   005300 115007                    CMPA    2752,DL
         8 006166   006175 604400 8                  TMOZ    s:7498
         8 006167   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 006170   006175 600000 8                  TZE     s:7498

     2357     7493    5                   DO;

     2358     7494    5                   SUBSTR(SPARE.BUFR,K-128,128) = '** Overflow **';

   7494  8 006171   040005 100400                    MLR     fill='040'O
         8 006172   001341 000016 2                  ADSC9   SV_REQUIRED+340          cn=0,n=14
         8 006173   777750 000200 1                  ADSC9   WRITEMSG@-1048,A         cn=0,n=128

     2359     7495    5                   GOTO FIN;

   7495  8 006174   006177 710000 8                  TRA     FIN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:305  

     2360     7496    5                   END;
     2361     7497
     2362     7498    4                 END;

   7498  8 006175   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 006176   006133 601000 8                  TNZ     s:7486

     2363     7499    3   FIN:
     2364     7500    3               ADDR(SPARE.BUFR)->ZA1_DABLK.LENGTHS(0) = K / 128;

   7500  8 006177   001347 236000 1     FIN          LDQ     K
         8 006200   000200 506007                    DIV     128,DL
         8 006201   000012 756000 1                  STQ     SPARE+6

     2365     7501    3               ADDR(SPARE.BUFR)->ZA1_DABLK.TYPE = 2;

   7501  8 006202   002000 236003                    LDQ     1024,DU
         8 006203   000010 552040 1                  STBQ    SPARE+4,'40'O

     2366     7502    3               ADDR(SPARE.BUFR)->ZA1_DABLK.RANK = 2;

   7502  8 006204   000002 236003                    LDQ     2,DU
         8 006205   000010 552020 1                  STBQ    SPARE+4,'20'O

     2367     7503    3               ADDR(SPARE.BUFR)->ZA1_DABLK.SIZE = K / 4;

   7503  8 006206   001347 236000 1                  LDQ     K
         8 006207   000004 506007                    DIV     4,DL
         8 006210   000000 620006                    EAX0    0,QL
         8 006211   000010 440000 1                  SXL0    SPARE+4

     2368     7504    3               SV.DBSIZE = ADDR(SPARE.BUFR)->ZA1_DABLK.SIZE;

   7504  8 006212   001355 470400 1                  LDP0    SV$
         8 006213   000046 440100                    SXL0    38,,PR0

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:306  
     2369     7505    3               ADDR(SPARE.BUFR)->ZA1_DABLK.LENGTHS(1) = 128;

   7505  8 006214   000200 235007                    LDA     128,DL
         8 006215   000013 755000 1                  STA     SPARE+7

     2370     7506    3               WRITESVS@.V.DVBYTE.CONT# = FALSE;

   7506  8 006216   000051 236000 9                  LDQ     41
         8 006217   001711 356000 1                  ANSQ    WRITESVS@+11

     2371     7507    3               WRITESVS@.BUF_ = VECTOR( ADDR(SPARE.BUFR)->KBUF );

   7507  8 006220   001347 235000 1                  LDA     K
         8 006221   000020 735000                    ALS     16
         8 006222   000140 135007                    SBLA    96,DL
         8 006223   000172 236000 9                  LDQ     122
         8 006224   001702 757000 1                  STAQ    WRITESVS@+4

     2372     7508    3               DBKEY.VAL = SV.DBKEY;

   7508  8 006225   000027 236100                    LDQ     23,,PR0
         8 006226   001353 552034 1                  STBQ    DBKEY,'34'O

     2373     7509    3               CALL M$WRITE(WRITESVS@) ALTRET(IGIT);

   7509  8 006227   001676 630400 1                  EPPR0   WRITESVS@
         8 006230   440001 713400                    CLIMB   alt,write
         8 006231   401400 401760                    pmme    nvectors=4
         8 006232   006233 702000 8                  TSX2    IGIT

     2374     7510    3   IGIT:
     2375     7511    3           END;

   7511  8 006233                       IGIT         null
     2376     7512    2   DONE:
     2377     7513    2         RETURN;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:307  
   7513  8 006233   200012 221300       DONE         LDX1  ! L+4,,AUTO
         8 006234   000001 702211                    TSX2  ! 1,X1

     2378     7514    2   CHKLD:
     2379     7515    2         IF %E$LD = B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE THEN

   7515  8 006235   000000 470400 xsym  CHKLD        LDP0    B$TCB$
         8 006236   000000 471500                    LDP1    0,,PR0
         8 006237   100102 236100                    LDQ     66,,PR1
         8 006240   377770 376007                    ANQ     131064,DL
         8 006241   000070 116007                    CMPQ    56,DL
         8 006242   006247 601000 8                  TNZ     s:7521

     2380     7516    3           DO;

     2381     7517    3           READSVX@.V.DVBYTE.CONT# = TRUE;

   7517  8 006243   001000 236003                    LDQ     512,DU
         8 006244   001741 256000 1                  ORSQ    READSVX@+11

     2382     7518    3           WRITESVS@.V.DVBYTE.CONT# = TRUE;

   7518  8 006245   001711 256000 1                  ORSQ    WRITESVS@+11

     2383     7519    3           GOTO CONT;

   7519  8 006246   006060 710000 8                  TRA     CONT

     2384     7520    3           END;
     2385     7521    2         WRITESVS@.BUF_ = VECTOR(NIL);

   7521  8 006247   000242 237000 9                  LDAQ    162
         8 006250   001702 757000 1                  STAQ    WRITESVS@+4

     2386     7522    2         WRITESVS@.V.DVBYTE.CONT# = FALSE;

   7522  8 006251   000051 236000 9                  LDQ     41
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:308  
         8 006252   001711 356000 1                  ANSQ    WRITESVS@+11

     2387     7523    2         IF FIRST ~= 0 THEN CALL M$WRITE(WRITESVS@) ALTRET(ENDLOG);

   7523  8 006253   200014 235100                    LDA     FIRST,,AUTO
         8 006254   006261 600000 8                  TZE     s:7524

   7523  8 006255   001676 630400 1                  EPPR0   WRITESVS@
         8 006256   440001 713400                    CLIMB   alt,write
         8 006257   401400 401760                    pmme    nvectors=4
         8 006260   006107 702000 8                  TSX2    ENDLOG

     2388     7524    2         GOTO ENDLOG;

   7524  8 006261   006107 710000 8                  TRA     ENDLOG

     2389     7525    2   END MYLATCH;
     2390     7526        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:309  
     2391     7527    1   MYRELEASE: PROC;

   7527  8 006262   200012 741300       MYRELEASE    STX1  ! L+4,,AUTO

     2392     7528    2   DCL  I     SBIN;
     2393     7529
     2394     7530    2         CALL MYLOOKUP(I) ALTRET(DONE);

   7530  8 006263   200013 630500                    EPPR0   I,,AUTO
         8 006264   200017 450500                    STP0    @STATION,,AUTO
         8 006265   006321 701000 8                  TSX1    MYLOOKUP
         8 006266   006317 702000 8                  TSX2    DONE

     2395     7531    3           DO CASE(I);

   7531  8 006267   200013 235100                    LDA     I,,AUTO
         8 006270   000001 115007                    CMPA    1,DL
         8 006271   006273 602005 8                  TNC     s:7531+4,AL
         8 006272   006317 710000 8                  TRA     DONE
         8 006273   006274 710000 8                  TRA     s:7533

     2396     7532    3             CASE(0);

     2397     7533    3               SV.ASMM = '0011'B;

   7533  8 006274   001355 470400 1                  LDP0    SV$
         8 006275   000002 236100                    LDQ     2,,PR0
         8 006276   000037 376000 9                  ANQ     31
         8 006277   006000 276003                    ORQ     3072,DU
         8 006300   000002 756100                    STQ     2,,PR0

     2398     7534    3               SV.ASMO = '0011'B;

   7534  8 006301   000002 236100                    LDQ     2,,PR0
         8 006302   000036 376000 9                  ANQ     30
         8 006303   140000 276003                    ORQ     49152,DU
         8 006304   000002 756100                    STQ     2,,PR0
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:310  

     2399     7535    3               IF FIA_VRECS0 > 0 THEN

   7535  8 006305   001377 235000 1                  LDA     FIA_VRECS0
         8 006306   006317 604400 8                  TMOZ    DONE

     2400     7536    4                 DO;

     2401     7537    4                 SV.ASMM = '1010'B;

   7537  8 006307   000002 236100                    LDQ     2,,PR0
         8 006310   000037 376000 9                  ANQ     31
         8 006311   024000 276003                    ORQ     10240,DU
         8 006312   000002 756100                    STQ     2,,PR0

     2402     7538    4                 SV.ASMO = '0101'B;

   7538  8 006313   000002 236100                    LDQ     2,,PR0
         8 006314   000036 376000 9                  ANQ     30
         8 006315   240000 276003                    ORQ     81920,DU
         8 006316   000002 756100                    STQ     2,,PR0

     2403     7539    4                 END;

     2404     7540    3           END;

     2405     7541    2   DONE:
     2406     7542    2         RETURN;

   7542  8 006317   200012 221300       DONE         LDX1  ! L+4,,AUTO
         8 006320   000001 702211                    TSX2  ! 1,X1

     2407     7543    2   END MYRELEASE;
     2408     7544        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:311  
     2409     7545    1   MYLOOKUP: PROC(NUM) ALTRET;

   7545  8 006321   200016 741300       MYLOOKUP     STX1  ! FIRST+2,,AUTO

     2410     7546    2   DCL  NUM   SBIN;
     2411     7547    2   DCL  I     SBIN;
     2412     7548
     2413     7549    3           DO I = 0 TO %MYVARS;

   7549  8 006322   200020 450100                    STZ     I,,AUTO

     2414     7550    3           IF SV.SURROGATE = MYVARS(I) THEN GOTO GOTV;

   7550  8 006323   200020 236100                    LDQ     I,,AUTO
         8 006324   000024 402007                    MPY     20,DL
         8 006325   001355 470400 1                  LDP0    SV$
         8 006326   040006 106500                    CMPC    fill='040'O
         8 006327   000002 400116                    ADSC9   2,,PR0                   cn=2,n=78
         8 006330   000057 000024 2                  ADSC9   MYVARS,Q                 cn=0,n=20
         8 006331   006340 600000 8                  TZE     GOTV

     2415     7551    3           END;

   7551  8 006332   200020 054100                    AOS     I,,AUTO
         8 006333   200020 235100                    LDA     I,,AUTO
         8 006334   000002 115007                    CMPA    2,DL
         8 006335   006323 604400 8                  TMOZ    s:7550

     2416     7552    2         ALTRETURN;

   7552  8 006336   200016 221300                    LDX1  ! FIRST+2,,AUTO
         8 006337   000000 702211                    TSX2  ! 0,X1

     2417     7553    2   GOTV:
     2418     7554    2         IF SV$ ~= MYSV$(I) THEN ALTRETURN;

   7554  8 006340   200020 720100       GOTV         LXL0    I,,AUTO
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:312  
         8 006341   001355 236000 1                  LDQ     SV$
         8 006342   001401 116010 1                  CMPQ    MYSV$,X0
         8 006343   006346 600000 8                  TZE     s:7555

   7554  8 006344   200016 221300                    LDX1  ! FIRST+2,,AUTO
         8 006345   000000 702211                    TSX2  ! 0,X1

     2419     7555    2         IF SV.COUPLING ~= 2 THEN ALTRETURN;

   7555  8 006346   000002 236100                    LDQ     2,,PR0
         8 006347   000003 376003                    ANQ     3,DU
         8 006350   000002 116003                    CMPQ    2,DU
         8 006351   006354 600000 8                  TZE     s:7556

   7555  8 006352   200016 221300                    LDX1  ! FIRST+2,,AUTO
         8 006353   000000 702211                    TSX2  ! 0,X1

     2420     7556    2         NUM = I;

   7556  8 006354   200017 471500                    LDP1    @NUM,,AUTO
         8 006355   200020 235100                    LDA     I,,AUTO
         8 006356   100000 755100                    STA     0,,PR1

     2421     7557    2         RETURN;

   7557  8 006357   200016 221300                    LDX1  ! FIRST+2,,AUTO
         8 006360   000001 702211                    TSX2  ! 1,X1

     2422     7558    2   END MYLOOKUP;
     2423     7559
     2424     7560
     2425     7561
     2426     7562    1   COMPUTE_DISPLAY: PROC;

   7562  8 006361   200014 741300       COMPUTE_DIS* STX1  ! FIRST,,AUTO

     2427     7563
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:313  
     2428     7564    2         DISPLAYS = FIA_VDISPLAY;

   7564  8 006362   001375 235000 1                  LDA     FIA_VDISPLAY
         8 006363   001374 755000 1                  STA     DISPLAYS

     2429     7565    2         IF FIA_DISPLAYS > 0 THEN

   7565  8 006364   000052 236000 2                  LDQ     FIA_DISPLAYS
         8 006365   006377 604400 8                  TMOZ    s:7569

     2430     7566    2          IF FIA_VDISPLAY = 0

   7566  8 006366   000000 115003                    CMPA    0,DU
         8 006367   006372 601000 8                  TNZ     s:7568

     2431     7567    2          THEN DISPLAYS = FIA_DISPLAYS;

   7567  8 006370   001374 756000 1                  STQ     DISPLAYS
         8 006371   006377 710000 8                  TRA     s:7569

     2432     7568    2          ELSE DISPLAYS = MINIMUM(FIA_DISPLAYS,FIA_VDISPLAY);

   7568  8 006372   001375 236000 1                  LDQ     FIA_VDISPLAY
         8 006373   000052 116000 2                  CMPQ    FIA_DISPLAYS
         8 006374   006376 604400 8                  TMOZ    s:7568+4
         8 006375   000052 236000 2                  LDQ     FIA_DISPLAYS
         8 006376   001374 756000 1                  STQ     DISPLAYS

     2433     7569    2         RETURN;

   7569  8 006377   000001 702211                    TSX2  ! 1,X1
     2434     7570    2   END COMPUTE_DISPLAY;
     2435     7571        %EJECT;
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:314  
     2436     7572    1   END FIA$APL;

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:315  
--  Include file information  --

   FI_SCODE_C.:E05TOU  is referenced.
   FI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   FOO_MAC_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FI_MAC_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   FI_SUBS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FIA$APL.
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:316  

 **** Variables and constants ****

  ****  Section 001  Data  FIA$APL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  1476-0-0/d STRC(720)   r     1 APLCGCP                 1530-0-0/w STRC(216)   r     1 ATTR@
  1522-0-0/w STRC(216)   r     1 ATTRCG@                 1343-0-0/b BIT         r     1 BMASK(0:3)
  1352-0-0/w PTR         r     1 D$                      1353-0-0/w STRC        r     1 DBKEY
  1354-0-0/w STRC        r     1 DBKEY2                  1374-0-0/w SBIN        r     1 DISPLAYS
     1-0-0/w PTR         r     1 F$SV$                      2-0-0/w PTR         r     1 F$SVS$
     3-0-0/w PTR         r     1 F$SVX$                  1375-0-0/w SBIN        r     1 FIA_VDISPLAY
  1377-0-0/w SBIN        r     1 FIA_VRECS0              1400-0-0/w SBIN        r     1 FIA_VRECS1
  1372-0-0/c CHAR(8)     r     1 INSYMNAME               1347-0-0/w SBIN        r     1 K
  1344-0-0/w UBIN        r     1 KEYVAL                     0-0-0/w PTR         r     1 M$APLCG$
  1343-0-0/b BIT (4)     r     1 MASK                    1401-0-0/w PTR         r     1 MYSV$(0:2)
  1342-0-0/w PTR         r     1 NEW$                    1536-0-0/d STRC(2088)  r     1 OPEN@
  1404-0-0/d STRC(2088)  r     1 OPENCG@                 1744-0-0/d STRC(504)   r     1 READ@
  1762-0-0/d STRC(504)   r     1 READCGC@                1660-0-0/d STRC(504)   r     1 READSVS@
  1726-0-0/d STRC(504)   r     1 READSVX@                   4-0-0/w STRC(26064) r     1 SPARE
  1332-0-0/w STRC(288)   r     1 STA                     1330-0-0/c CHAR(8)     r     1 STATION
  1350-0-0/d CHAR(8)     r     1 STATIONNAME             1355-0-0/w PTR         r     1 SV$
  1370-0-0/w PTR         r     1 SVHD$                   1360-0-0/w STRC(288)   r     1 SVSCB
  1357-0-0/w PTR         r     1 SVSIGNON$               1371-0-0/w PTR         r     1 SVTL$
  1356-0-0/w PTR         r     1 SVX$                    1376-0-0/w STRC        r     1 SVXKEY
  1345-0-0/w SBIN        r     1 TEMP                    1644-0-0/d STRC(432)   r     1 WRITE@
  1630-0-0/d STRC(432)   r     1 WRITECG@                2000-0-0/d STRC(432)   r     1 WRITEMSG@
  1676-0-0/d STRC(432)   r     1 WRITESVS@               1712-0-0/d STRC(432)   r     1 WRITESVX@

  ****  Section 002 RoData FIA$APL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   344-0-0/w STRC(90)    r     1 ACSV@                    154-0-0/d STRC(1872)  r     1 APLCGCTL
   240-0-0/c STRC(54)    r     1 APLCGNAME                137-0-0/w STRC(432)   r     1 APLCGSETSTA
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:317  
   246-0-0/d STRC(1080)  r     1 CLOSECG                  304-0-0/d STRC(1080)  r     1 CLOSEPOOL
   113-0-0/w STRC(288)   r     1 DACTALL                  350-0-0/d STRC(576)   r     1 DEACTIVATE_USER
   574-0-0/d STRC(576)   r     1 DEACT_ALL                242-0-0/d STRC(144)   r     1 EXTEND_APLCG
    52-0-0/w SBIN        r     1 FIA_DISPLAYS               0-0-0/b BIT (4)     r     1 FLIPPED(0:15)
    53-0-0/w STRC(144)   r     1 LOG_HEADER               123-0-0/w STRC(432)   r     1 MYAPLCGSETSTA
    76-0-0/c CHAR(20)    r     1 MYID                      57-0-0/c CHAR(20)    r     1 MYVARS(0:2)
   103-0-0/w BIT (4)     r     1 NEWSTATES(0:7)
   370-0-0/d STRC(2088)  r     1 OPENSVS@                 464-0-0/d STRC(2088)  r     1 OPENSVX@
   342-0-0/c STRC(54)    r     1 POOLFILENAME             462-0-0/c STRC(45)    r     1 SVTEMP
     2-0-0/w STRC(1440)  r     1 SV_INIT
   614-0-0/b BIT         r     1 SV_NOT_ALLOWED(0:17)
   615-0-0/b BIT         r     1 SV_REQUIRED(0:17)
   556-0-0/c STRC(45)    r     1 SXTEMP                   570-0-0/d STRC(144)   r     1 TRUNCSV@
   564-0-0/d STRC(144)   r     1 TRUNCSVS@                560-0-0/d STRC(144)   r     1 TRUNCSVX@

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    22-0-0/w PTR         r     1 @CLASS                    21-0-0/w PTR         r     1 @LEN
    20-0-0/w PTR         r     1 @MESSAGE                  17-0-0/w PTR         r     1 @NUM
    17-0-0/w PTR         r     1 @STATION                   5-0-0/w PTR         r     1 CGAURD$
    *0-0-0/w SBIN        r     1 CLASS                     17-0-0/b BIT         r     1 CLRSCE
    14-0-0/w SBIN        r     1 FIRST                     13-0-0/w SBIN        r     1 I
    13-0-0/w SBIN        r     1 I                         13-0-0/w SBIN        r     1 I
    13-0-0/w SBIN        r     1 I                         13-0-0/w SBIN        r     1 I
    13-0-0/w SBIN        r     1 I                         20-0-0/w SBIN        r     1 I
     6-0-0/w SBIN        r     1 L                         *0-0-0/w UBIN        r     1 LEN
    *0-0-0/c ACHR        r     1 MESSAGE                   *0-0-0/w SBIN        r     1 NUM
    24-0-0/w SBIN        r     1 OLDFLD1                   25-0-0/w SBIN        r     1 OLDINAM
    26-0-0/w SBIN        r     1 OLDMID                    23-0-0/w SBIN        r     1 OLDTYPE
    20-0-0/w PTR         r     1 OSV$                      *0-0-0/c CHAR(8)     r     1 STATION
    27-0-0/c CHAR(8)     r     1 STX                       13-0-0/w UBIN        r     1 TYPE

  ****  SYMREF variables  ****

PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:318  
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/w STRC(1260)  r     1 FI_APLCGBUF
     0-0-0/w PTR         r     1 FI_EVNT$                   0-0-0/c STRC(72)    r     1 FI_SYSACCT
     0-0-0/w STRC(1260)  r     1 MSG

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(1440)  r     1 B$CGAURD
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0N  NULL        r     1 F$SV                       0-0-0N  NULL        r     1 F$SVS
     0-0-0N  NULL        r     1 F$SVX                      0-0-0/w STRC(252)   r     1 FI$APLRD
     0-0-0/w STRC(216)   r     1 FI$EVNT                    0-0-0/w STRC(1440)  r     1 FI$SV
     0-0-0/c ACHR        r     1 KBUF                       0-0-0N  NULL        r     1 M$APLCG
     0-0-0N  NULL        r     1 M$DO                       0-0-0/w STRC(1440)  r     1 SV
     0-0-0/w STRC(108)   r     1 ZA1_DABLK


   Procedure FIA$APL requires 3328 words for executable code.
   Procedure FIA$APL requires 30 words of local(AUTO) storage.

    No errors detected in file FIA$APL.:E05TSI    .
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:319  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:320  
          MINI XREF LISTING

A1 IN PROCEDURE SVPROCESSOR
      7211**LABEL    7212--CALLALT
ACSV@
      4146**DCL      3642--DCLINIT  4255--DCLINIT
ACSV@.Q
      4147**DCL      4146--DCLINIT
ACVGO IN PROCEDURE SVPROCESSOR
      6561**LABEL    6547--GOTO
APLCGCP
      3809**DCL      3759--DCLINIT
APLCGCP.DVBYTE.REREAD#
      3823**DCL      3824--REDEF
APLCGCP.MAXPG#
      3815**DCL      5364<<ASSIGN   5364>>ASSIGN
APLCGCTL
      3758**DCL      5297<>CALL     5365<>CALL
APLCGCTL.V
      3763**DCL      3758--DCLINIT
APLCGNAME
      3867**DCL      3640--DCLINIT
APLCGSETSTA
      3727**DCL      3760--DCLINIT
ATTR@
      4080**DCL      4254--DCLINIT
ATTR@.Q
      4081**DCL      4080--DCLINIT
ATTRCG@
      4016**DCL      3641--DCLINIT
ATTRCG@.Q
      4017**DCL      4016--DCLINIT
B$ALT.CODE
      2939**DCL      2939--REDEF    2940--REDEF    2940--REDEF
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:321  
B$ALT.ERR.CODE
      2941**DCL      5304>>IF       5496>>IF       5551>>IF       5691>>IF       5759>>IF       5818>>IF
      5883>>IF       7051>>IF       7061>>IF       7205>>IF       7218>>IF       7515>>IF
B$ALT.ERR.ERR#
      2941**DCL      2941--REDEF
B$ALT.EVID
      2940**DCL      2940--REDEF    2940--REDEF
B$CGAURD.CONINFO.ATTR
      3106**DCL      3106--REDEF
B$CGAURD.EVENT
      3084**DCL      5352>>DOCASE
B$CGAURD.FIINFO.DFLTPRI
      3138**DCL      3139--REDEF
B$CGAURD.STATION
      3084**DCL      3084--REDEF    5373>>ASSIGN   5477>>ASSIGN
B$TCB.ALT$
      2935**DCL      5304>>IF       5496>>IF       5551>>IF       5691>>IF       5759>>IF       5818>>IF
      5883>>IF       7051>>IF       7061>>IF       7205>>IF       7218>>IF       7515>>IF
B$TCB$
      3488**DCL      5304>>IF       5496>>IF       5551>>IF       5691>>IF       5759>>IF       5818>>IF
      5883>>IF       7051>>IF       7061>>IF       7205>>IF       7218>>IF       7515>>IF
BAD1 IN PROCEDURE CHECKSIGNON
      5639**LABEL    5626--GOTO     5627--GOTO     5630--GOTO
BMASK
      3262**DCL      5724>>IF
CANTWT IN PROCEDURE SVPROCESSOR
      6721**LABEL    6686--CALLALT
CGAURD$
      3212**DCL      5351<<ASSIGN   5352>>DOCASE   5373>>ASSIGN   5477>>ASSIGN
CGERR IN PROCEDURE CONNECT
      5496**LABEL    5493--CALLALT
CGERR IN PROCEDURE MAYMATCH
      5551**LABEL    5544--CALLALT
CGERR IN PROCEDURE MAYNOTIFY
      5818**LABEL    5777--CALLALT  5796--CALLALT
CGERR IN PROCEDURE MAYREAD
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:322  
      5759**LABEL    5756--CALLALT
CGERR IN PROCEDURE SCNOTIFYM
      5883**LABEL    5877--CALLALT
CGERR IN PROCEDURE SVPROCESSOR
      7218**LABEL    6381--CALLALT  6423--CALLALT  6435--CALLALT  6443--CALLALT  6453--CALLALT  6506--CALLALT
      6528--CALLALT  6566--CALLALT  6587--CALLALT  6603--CALLALT  6620--CALLALT  6640--CALLALT  6681--CALLALT
      6724--CALLALT  6826--CALLALT  6935--CALLALT  7046--CALLALT  7064--CALLALT  7206--GOTO
CHECKSIGNON
      5617**PROC     6356--CALL     6686--CALL     6867--CALL
CHKLD IN PROCEDURE MYLATCH
      7515**LABEL    7454--CALLALT
CLASS IN PROCEDURE WRITEMESS
      7243**DCL      7238--PROC     7290>>IF       7292>>IF
CLEARSC
      5823**PROC     5790--CALL     5809--CALL     5879--CALL     6717--CALL
CLEARSCN IN PROCEDURE CLEARSC
      5828**ENTRY    6302--CALL     6309--CALL
CLOSECG
      3912**DCL      5336<>CALL
CLOSECG.SN_
      3912**DCL      3912--REDEF
CLOSECG.UTL_
      3913**DCL      3913--REDEF
CLOSECG.V
      3917**DCL      3912--DCLINIT
CLOSECG.V.EXPIRE#
      3927**DCL      3927--REDEF
CLOSECG.V.TYPE#
      3925**DCL      3925--REDEF
CLOSECG.V.XTNSIZE#
      3922**DCL      3922--REDEF    3924--REDEF
CLOSEPOOL
      3957**DCL      5337<>CALL
CLOSEPOOL.SN_
      3957**DCL      3957--REDEF
CLOSEPOOL.UTL_
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:323  
      3958**DCL      3958--REDEF
CLOSEPOOL.V
      3962**DCL      3957--DCLINIT
CLOSEPOOL.V.EXPIRE#
      3972**DCL      3972--REDEF
CLOSEPOOL.V.TYPE#
      3970**DCL      3970--REDEF
CLOSEPOOL.V.XTNSIZE#
      3967**DCL      3967--REDEF    3969--REDEF
CLRSCE IN PROCEDURE CLEARSC
      5824**DCL      5826<<ASSIGN   5829<<ASSIGN   5838>>IF       5844>>IF
COMMON IN PROCEDURE MAYREAD
      5713**LABEL    5704--GOTO     5708--GOTO
COMPUTE_DISPLAY
      7562**PROC     7360--CALL     7387--CALL     7417--CALL
CON IN PROCEDURE VARTOSVS
      5682**LABEL    5695--GOTO
CONNECT
      5475**PROC     5359--CALL
CONT IN PROCEDURE MYLATCH
      7458**LABEL    7519--GOTO
CONTIN IN PROCEDURE CLEARSC
      5831**LABEL    5827--GOTO
CONTIN IN PROCEDURE SCNOTIFYM
      5866**LABEL    5858--GOTO
COPYLP IN PROCEDURE MYLATCH
      7454**LABEL    7468--GOTO
CTLA0
      5298**LABEL    5297--CALLALT
D$
      3269**DCL      6873<<ASSIGN   6891>>DOWHILE  6901>>ASSIGN   6904>>ASSIGN   6908<<ASSIGN   6908>>ASSIGN
      6909>>IF       6920>>ASSIGN   7482<<ASSIGN   7484>>DOWHILE  7486>>ASSIGN   7487>>ASSIGN   7488>>ASSIGN
      7489>>ASSIGN   7491<<ASSIGN   7491>>ASSIGN   7492>>IF
DACTALL
      3456**DCL      4987--DCLINIT
DACTALL.MSGIDXT
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:324  
      3466**DCL      3469--REDEF
DBKEY
      3270**DCL      4378--DCLINIT  4413--DCLINIT  4414--DCLINIT  4573--DCLINIT
DBKEY.VAL
      3272**DCL      5672<<ASSIGN   6927<<ASSIGN   7032<<ASSIGN   7167<<ASSIGN   7448<<ASSIGN   7508<<ASSIGN
DBKEY2
      3273**DCL      4909--DCLINIT  4910--DCLINIT
DBKEY2.VAL
      3275**DCL      5671<<ASSIGN
DEACTIVATE_USER
      4311**DCL      7212<>CALL
DEACTIVATE_USER.V
      4312**DCL      4311--DCLINIT
DEACTIVATE_USER.V.DVBYTE.REREAD#
      4314**DCL      4314--REDEF
DEACT_ALL
      4987**DCL      5335<>CALL
DEACT_ALL.V
      4988**DCL      4987--DCLINIT
DEACT_ALL.V.DVBYTE.REREAD#
      4990**DCL      4990--REDEF
DISCONNECT
      5372**PROC     5356--CALL
DISPLAYS
      3389**DCL      5378>>IF       5397>>IF       5415>>IF       5482>>IF       5525>>IF       5564>>IF
      5589>>IF       5607>>IF       5641>>IF       5664>>IF       5783>>IF       5802>>IF       5868>>IF
      6280>>IF       6293>>IF       6318>>IF       6333>>IF       6347>>IF       6373>>IF       6388>>IF
      6461>>IF       6475>>IF       6517>>IF       6536>>IF       6553>>IF       6575>>IF       6593>>IF
      6609>>IF       6629>>IF       6647>>IF       6671>>IF       6710>>IF       6732>>IF       6769>>IF
      6805>>IF       6860>>IF       6944>>IF       6956>>IF       6975>>IF       6994>>IF       7009>>IF
      7025>>IF       7076>>IF       7091>>IF       7105>>IF       7119>>IF       7132>>IF       7160>>IF
      7177>>IF       7196>>IF       7564<<ASSIGN   7567<<ASSIGN   7568<<ASSIGN
DONE IN PROCEDURE HISASSIGN
      7421**LABEL    7400--CALLALT
DONE IN PROCEDURE MYASSIGNMENT
      7432**LABEL    7427--CALLALT
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:325  
DONE IN PROCEDURE MYLATCH
      7513**LABEL    7439--CALLALT
DONE IN PROCEDURE MYRELEASE
      7542**LABEL    7530--CALLALT
DONESVN IN PROCEDURE SVPROCESSOR
      6680**LABEL    6665--GOTO
DOSIGNON
      5556**PROC     5631--CALL     6663--CALL
DUPL IN PROCEDURE SVPROCESSOR
      6669**LABEL    6657--GOTO     6658--GOTO     6662--GOTO
ENDLOG IN PROCEDURE MYLATCH
      7470**LABEL    7523--CALLALT  7524--GOTO
EXTEND_APLCG
      3883**DCL      5362<>CALL
EXTEND_APLCG.V
      3883**DCL      3883--DCLINIT
F$DCB.ACTPOS
      2978**DCL      2978--REDEF
F$DCB.ARS#
      2952**DCL      2952--REDEF    5679>>ASSIGN   7040>>ASSIGN   7043>>ASSIGN   7464>>ASSIGN
F$DCB.ATTR
      2971**DCL      2972--REDEF
F$DCB.BORROW
      2986**DCL      2986--REDEF    2986--REDEF    2986--REDEF
F$DCB.DCBNAME.L
      3000**DCL      3000--IMP-SIZ
F$DCB.EOMCHAR#
      2956**DCL      2956--REDEF
F$DCB.FLDID
      2981**DCL      2981--REDEF
F$DCB.FORM$
      2975**DCL      2975--REDEF
F$DCB.FSECT
      2991**DCL      2991--REDEF
F$DCB.FSN#
      2968**DCL      2968--REDEF    2968--REDEF    2969--REDEF
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:326  
F$DCB.HEADER$
      2974**DCL      2974--REDEF
F$DCB.IXTNSIZE#
      2972**DCL      2972--REDEF
F$DCB.LASTSTA$
      2961**DCL      2961--REDEF
F$DCB.LVL
      2987**DCL      2987--REDEF
F$DCB.NAME#.C
      2962**DCL      2962--REDEF
F$DCB.NOEOF
      2984**DCL      2984--REDEF
F$DCB.NRECS#
      2973**DCL      2973--REDEF
F$DCB.NRECX
      2992**DCL      2992--REDEF
F$DCB.OHDR
      2984**DCL      2984--REDEF
F$DCB.ORG#
      2967**DCL      2967--REDEF
F$DCB.PRECNO
      2990**DCL      2990--REDEF
F$DCB.RCSZ
      2996**DCL      2996--REDEF
F$DCB.RES#
      2963**DCL      2963--REDEF
F$DCB.SETX
      2975**DCL      2975--REDEF
F$DCB.TAB$
      2975**DCL      2975--REDEF
F$DCB.TDA
      2989**DCL      2990--REDEF
F$DCB.WSN#
      2963**DCL      2963--REDEF
F$SV
      3478**DCL      5285--ASSIGN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:327  
F$SV$
      3220**DCL      5285<<ASSIGN   5679>>ASSIGN
F$SVS
      3479**DCL      5286--ASSIGN
F$SVS$
      3221**DCL      5286<<ASSIGN   7040>>ASSIGN   7043>>ASSIGN
F$SVX
      3481**DCL      5287--ASSIGN
F$SVX$
      3222**DCL      5287<<ASSIGN   7464>>ASSIGN
FI$APLRD.ERRCODE
      3189**DCL      7144>>IF
FI$APLRD.NAME
      3191**DCL      6267>>ASSIGN   7210>>ASSIGN
FI$EVNT.CITE$
      3019**DCL      6267>>ASSIGN   7144>>IF       7210>>ASSIGN
FI$SV
      2895**DCL      3355--DCLINIT
FI$SV.INAME
      2904**DCL      2905--REDEF
FI$SV.MATCH.NAME
      2915**DCL      2916--REDEF
FI$SV.OFFER.NAME
      2909**DCL      2910--REDEF
FIA_DISPLAYS
      3388**DCL      7290>>IF       7565>>IF       7567>>ASSIGN   7568>>ASSIGN
FIA_VDISPLAY
      3390**DCL      7292>>IF       7357<<ASSIGN   7386<<ASSIGN   7416<<ASSIGN   7564>>ASSIGN   7566>>IF
      7568>>ASSIGN
FIA_VRECS0
      3404**DCL      7296>>IF       7298>>IF       7301<<ASSIGN   7301>>ASSIGN   7358<<ASSIGN   7446>>ASSIGN
      7470<<ASSIGN   7535>>IF
FIA_VRECS1
      3405**DCL      7359<<ASSIGN   7446<<ASSIGN   7460>>ASSIGN   7461>>ASSIGN   7475>>ASSIGN
FIN IN PROCEDURE MYLATCH
      7500**LABEL    7495--GOTO
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:328  
FIRST IN PROCEDURE MYLATCH
      7437**DCL      7452<<ASSIGN   7458>>IF       7462<<ASSIGN   7523>>IF
FI_APLCGBUF
      3505**DCL      3535--REDEF    5351--ASSIGN
FI_APLCGBUF.INAME
      3508**DCL      3509--REDEF
FI_APLCGBUF.PARTNER1
      3512**DCL      3513--REDEF
FI_APLCGBUF.PARTNER2
      3516**DCL      3517--REDEF
FI_CSCGBUF
      2602**DCL      2603--REDEF
FI_DEV_INIT.DEST
      2686**DCL      2687--REDEF
FI_DEV_INIT.NAME
      2661**DCL      2662--REDEF
FI_EVNT$
      2644**DCL      6267>>ASSIGN   7144>>IF       7210>>ASSIGN
FI_SYSACCT
      2856**DCL      3644--DCLINIT  4257--DCLINIT  4514--DCLINIT  4695--DCLINIT
FLIPPED
      3276**DCL      5722>>ASSIGN   5723>>ASSIGN   6562>>ASSIGN   6564>>ASSIGN
FOI$GBUF
      3490**DCL-ENT  5558--CALL     6363--CALL
FOI$LDTRC
      3489**DCL-ENT  6813--CALL
FOI$RBUF
      3491**DCL-ENT  5408--CALL     6526--CALL     7382--CALL
GETCN IN PROCEDURE SVPROCESSOR
      7046**LABEL    7059--GOTO
GETLD IN PROCEDURE SVPROCESSOR
      7051**LABEL    7035--CALLALT
GETLP IN PROCEDURE SVPROCESSOR
      7035**LABEL    7047--GOTO
GOTCHA IN PROCEDURE SVPROCESSOR
      6983**LABEL    6968--GOTO
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:329  
GOTV IN PROCEDURE MYLOOKUP
      7554**LABEL    7550--GOTO
GOTV IN PROCEDURE MYOFFER
      7346**LABEL    7342--GOTO
GOTV IN PROCEDURE MYRETRACT
      7378**LABEL    7374--GOTO
HISASSIGN
      7397**PROC     7141--CALL
HMMERR IN PROCEDURE MYLATCH
      7468**LABEL    7466--CALLALT
I IN PROCEDURE HISASSIGN
      7398**DCL      7400<>CALL     7401>>DOCASE
I IN PROCEDURE MYASSIGNMENT
      7425**DCL      7427<>CALL     7428>>DOCASE
I IN PROCEDURE MYLATCH
      7436**DCL      7439<>CALL     7440>>DOCASE
I IN PROCEDURE MYLOOKUP
      7547**DCL      7549<<DOINDEX  7550>>IF       7554>>IF       7556>>ASSIGN
I IN PROCEDURE MYOFFER
      7339**DCL      7341<<DOINDEX  7342>>IF       7346>>IF       7347>>ASSIGN   7355>>DOCASE
I IN PROCEDURE MYRELEASE
      7528**DCL      7530<>CALL     7531>>DOCASE
I IN PROCEDURE MYRETRACT
      7371**DCL      7373<<DOINDEX  7374>>IF       7378>>IF       7379>>ASSIGN   7384>>DOCASE
IG IN PROCEDURE MYOFFER
      7365**LABEL    7363--CALLALT
IGIT IN PROCEDURE MYLATCH
      7511**LABEL    7509--CALLALT
IGN IN PROCEDURE MYRETRACT
      7392**LABEL    7390--CALLALT
IGNO IN PROCEDURE WRITEMESS
      7318**LABEL    7316--CALLALT
IGNOR IN PROCEDURE MYLATCH
      7446**LABEL    7444--CALLALT
IGNORE IN PROCEDURE WRITEMESS
      7292**LABEL    7290--CALLALT
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:330  
IGNR IN PROCEDURE MYLATCH
      7475**LABEL    7473--CALLALT
IGNRE IN PROCEDURE WRITEMESS
      7335**LABEL    7300--CALLALT
INSYMNAME
      3373**DCL      6813<>CALL
K
      3266**DCL      3065--IMP-SIZ  5648<<ASSIGN   5652<<ASSIGN   5679<<ASSIGN   5680>>ASSIGN   6448>>IF
      6869<<ASSIGN   6871<<ASSIGN   6880>>IF       6892>>IF       6893>>IF       6895>>IF       6896>>IF
      6898>>ASSIGN   6900>>IF       6901>>ASSIGN   6904>>ASSIGN   6908>>ASSIGN   6909>>IF       6922>>ASSIGN
      6923>>ASSIGN   6924<<ASSIGN   6925>>ASSIGN   6926>>ASSIGN   6986<<ASSIGN   6989>>IF       6989>>IF
      7004>>IF       7004>>IF       7033<<ASSIGN   7038>>IF       7040<<ASSIGN   7041<<ASSIGN   7041>>ASSIGN
      7043<<ASSIGN   7044>>ASSIGN   7056>>IF       7057<<ASSIGN   7058<<ASSIGN   7058>>ASSIGN   7083<<ASSIGN
      7086>>IF       7086>>IF       7100>>IF       7100>>IF       7113<<ASSIGN   7114>>IF       7114>>IF
      7114>>IF       7126<<ASSIGN   7127>>IF       7140<<ASSIGN   7142>>ASSIGN   7151>>ASSIGN   7185<<ASSIGN
      7186>>ASSIGN   7188>>IF       7191>>IF       7464<<ASSIGN   7465>>ASSIGN   7481<<ASSIGN   7486>>ASSIGN
      7487>>ASSIGN   7488>>ASSIGN   7489>>ASSIGN   7490<<ASSIGN   7490>>ASSIGN   7492>>IF       7494>>ASSIGN
      7500>>ASSIGN   7503>>ASSIGN   7507>>ASSIGN
KBUF
      3065**DCL      5680--ASSIGN   6893>>IF       6896>>IF       6901<<ASSIGN   6904<<ASSIGN   6925--ASSIGN
      6926--ASSIGN   7044--ASSIGN   7151--ASSIGN   7186--ASSIGN   7465--ASSIGN   7507--ASSIGN
KEYVAL
      3263**DCL      5582>>ASSIGN   5584>>ASSIGN   5597<<ASSIGN   5597>>ASSIGN   5598>>IF       5598<<ASSIGN
      6400>>ASSIGN   6401>>ASSIGN   6402<<ASSIGN   6402>>ASSIGN   6403>>IF       6403<<ASSIGN
L
      3267**DCL      5536<<ASSIGN   5538>>ASSIGN   7142<<ASSIGN   7171<<ASSIGN   7171>>ASSIGN   7172>>IF
      7185>>ASSIGN   7188>>IF       7191>>IF       7406<<ASSIGN   7408<<ASSIGN   7409>>IF       7410<<ASSIGN
      7414>>IF       7414<<ASSIGN   7415>>IF       7415<<ASSIGN   7416>>ASSIGN
LD IN PROCEDURE VARTOSVS
      5691**LABEL    5676--CALLALT
LEAVE IN PROCEDURE SVPROCESSOR
      7216**LABEL    6360--CALLALT  6382--GOTO     6425--GOTO     6436--GOTO     6438--CALLALT  6445--GOTO
      6454--GOTO     6582--CALLALT  6600--CALLALT  6616--CALLALT  6704--GOTO     7018--CALLALT  7049--GOTO
      7065--GOTO     7141--CALLALT  7170--GOTO     7211--GOTO
LEN IN PROCEDURE WRITEMESS
      7242**DCL      7238--PROC     7241--IMP-SIZ  7288>>ASSIGN   7289>>ASSIGN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:331  
LOG_HEADER
      3392**DCL      7361--ASSIGN   7471--ASSIGN
M$APLCG
      3477**DCL      5284--ASSIGN
M$APLCG$
      3219**DCL      5284<<ASSIGN
M$CGCTL
       100**DCL-ENT  5297--CALL     5365--CALL
M$CLOSE
        79**DCL-ENT  5336--CALL     5337--CALL
M$DEACTIVATE
        99**DCL-ENT  5335--CALL     7212--CALL
M$EXTEND
        83**DCL-ENT  5362--CALL
M$MERC
       135**DCL-ENT  5292--CALL     5302--CALL     5497--CALL     5553--CALL     5761--CALL     5820--CALL
      5884--CALL     7067--CALL     7220--CALL     7222--CALL
M$OPEN
        79**DCL-ENT  5289--CALL     5295--CALL     5299--CALL     5306--CALL     5308--CALL     5309--CALL
M$READ
        80**DCL-ENT  5676--CALL     7035--CALL     7189--CALL     7454--CALL
M$TRUNC
        80**DCL-ENT  5310--CALL     5311--CALL     5312--CALL
M$WRITE
        80**DCL-ENT  5493--CALL     5544--CALL     5682--CALL     5756--CALL     5777--CALL     5796--CALL
      5877--CALL     6381--CALL     6423--CALL     6435--CALL     6443--CALL     6453--CALL     6506--CALL
      6528--CALL     6566--CALL     6587--CALL     6603--CALL     6620--CALL     6640--CALL     6681--CALL
      6724--CALL     6826--CALL     6929--CALL     6930--CALL     6935--CALL     7046--CALL     7064--CALL
      7169--CALL     7290--CALL     7300--CALL     7316--CALL     7363--CALL     7390--CALL     7444--CALL
      7466--CALL     7473--CALL     7509--CALL     7523--CALL
MASK
      3261**DCL      3262--REDEF    5722<<ASSIGN   5723<<ASSIGN   5730<<ASSIGN   5732<<ASSIGN   5734<<ASSIGN
      5739<<ASSIGN   5741<<ASSIGN   5743<<ASSIGN   5746<<ASSIGN   5746>>ASSIGN   5747>>ASSIGN
MATCHSC
      5887**PROC     6424--CALL
MAYMATCH
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:332  
      5502**PROC     6360--CALL     6438--CALL
MAYNOTIFY
      5765**PROC     5448--CALL     6444--CALL     6507--CALL     6567--CALL
MAYREAD
      5701**PROC     6582--CALL
MAYSEIZE IN PROCEDURE MAYREAD
      5710**ENTRY    6616--CALL
MAYWRITE IN PROCEDURE MAYREAD
      5706**ENTRY    6600--CALL
MESSAGE IN PROCEDURE WRITEMESS
      7241**DCL      7238--PROC     7288>>ASSIGN
MSG
      3535**DCL      4345--DCLINIT  4346--DCLINIT  4953--DCLINIT  4954--DCLINIT  5673--ASSIGN   5674--ASSIGN
      5680--ASSIGN   5688--ASSIGN   7041--ASSIGN   7044--ASSIGN   7048--ASSIGN   7055--ASSIGN   7058--ASSIGN
      7184--ASSIGN   7185--ASSIGN   7186--ASSIGN
MSG.FIELD1
      3540**DCL      5537>>IF       5543<<ASSIGN   5581>>IF       5599>>ASSIGN   5771<<ASSIGN   5876<<ASSIGN
      6421<<ASSIGN   6433<<ASSIGN   6442<<ASSIGN   6451<<ASSIGN   6468<<ASSIGN   6544>>ASSIGN   6546>>ASSIGN
      6562<<ASSIGN   6564<<ASSIGN   6586<<ASSIGN   6619<<ASSIGN   6637<<ASSIGN   6638<<ASSIGN   6664<<ASSIGN
      6678<<ASSIGN   6718<<ASSIGN   6721<<ASSIGN   6739>>IF       6740>>ASSIGN   6934<<ASSIGN   7309>>ASSIGN
      7314<<ASSIGN   7321<<ASSIGN
MSG.FIELD2
      3541**DCL      5541<<ASSIGN   5542<<ASSIGN   6419>>IF       6422<<ASSIGN   6434<<ASSIGN   6441<<ASSIGN
      6452<<ASSIGN   6917<<ASSIGN   6919<<ASSIGN
MSG.INAME
      3538**DCL      3539--REDEF    5540<<ASSIGN   6269>>IF       6354>>IF       6450<<ASSIGN   6585<<ASSIGN
      6602<<ASSIGN   6618<<ASSIGN   6933<<ASSIGN   6939>>IF       6963>>IF       7310>>ASSIGN   7322<<ASSIGN
MSG.INAMER
      3539**DCL      5772<<ASSIGN   6273>>IF       6303>>ASSIGN   6310>>ASSIGN   6418<<ASSIGN   6432<<ASSIGN
      6440<<ASSIGN   7315<<ASSIGN
MSG.MID
      3537**DCL      5492<<ASSIGN   5536>>ASSIGN   5538<<ASSIGN   5752>>ASSIGN   5754>>ASSIGN   5775<<ASSIGN
      5794<<ASSIGN   5855<<ASSIGN   5861<<ASSIGN   6693>>ASSIGN   6700>>ASSIGN   7307>>ASSIGN   7313<<ASSIGN
      7319<<ASSIGN
MSG.P1.ACCT
      3544**DCL      5515>>IF       6877>>IF
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:333  
MSG.P2.ACCT
      3548**DCL      5515>>IF       5515>>IF       6882>>IF
MSG.P2.UNAME
      3549**DCL      6882>>IF
MSG.PARTNER1
      3542**DCL      3543--REDEF    5514>>IF       5515>>IF       5532>>ASSIGN   5573>>ASSIGN   5623>>IF
      5630>>IF       6405>>ASSIGN   6657>>IF       6662>>IF       6877>>IF       6888>>IF
MSG.PARTNER2
      3546**DCL      3547--REDEF    5424<<ASSIGN   5426>>ASSIGN   5515>>IF       5515>>IF       6407>>ASSIGN
      6484<<ASSIGN   6486>>ASSIGN   6868>>IF       6882>>IF
MSG.TYPE
      3536**DCL      5490<<ASSIGN   5539<<ASSIGN   5755<<ASSIGN   5770<<ASSIGN   5875<<ASSIGN   6288>>IF
      6328>>IF       6340>>DOCASE   6380<<ASSIGN   6417<<ASSIGN   6431<<ASSIGN   6439<<ASSIGN   6449<<ASSIGN
      6505<<ASSIGN   6527<<ASSIGN   6565<<ASSIGN   6584<<ASSIGN   6601<<ASSIGN   6617<<ASSIGN   6639<<ASSIGN
      6680<<ASSIGN   6723<<ASSIGN   6825<<ASSIGN   6932<<ASSIGN   7063<<ASSIGN   7308>>ASSIGN   7312<<ASSIGN
      7320<<ASSIGN
MSG.VNAME
      3550**DCL      5491<<ASSIGN   5504>>IF       6395>>ASSIGN   6396>>CALLBLT  7019--ASSIGN   7041--ASSIGN
      7057--ASSIGN   7057--ASSIGN   7113--ASSIGN   7126--ASSIGN   7139--ASSIGN   7140--ASSIGN   7147--ASSIGN
      7151--ASSIGN   7154--ASSIGN   7403--IF       7404--DOCASE   7406--ASSIGN   7408--ASSIGN   7410--ASSIGN
MYAPLCGSETSTA
      3697**DCL      3640--DCLINIT
MYASSIGNMENT
      7424**PROC     7018--CALL
MYID
      3417**DCL      5450>>IF       5576>>ASSIGN   5630>>IF       5796>>IF       5857>>IF       6420>>IF
      6509>>IF       6570>>IF       6583>>IF       6624>>IF       6662>>IF       6727>>IF       6839>>IF
      6951>>IF       7018>>IF       7141>>IF       7349>>ASSIGN
MYLATCH
      7435**PROC     6583--CALL
MYLOOKUP
      7545**PROC     7400--CALL     7427--CALL     7439--CALL     7530--CALL
MYOFFER
      7338**PROC     6420--CALL
MYRELEASE
      7527**PROC     6839--CALL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:334  
MYRETRACT
      7370**PROC     5450--CALL     6509--CALL
MYSV$
      3414**DCL      7303>>IF       7303>>IF       7306>>ASSIGN   7313>>ASSIGN   7315>>ASSIGN   7324>>ASSIGN
      7325>>ASSIGN   7328>>IF       7330>>ASSIGN   7331>>ASSIGN   7346>>IF       7347<<ASSIGN   7378>>IF
      7379<<ASSIGN   7554>>IF
MYVARS
      3409**DCL      7342>>IF       7374>>IF       7550>>IF
NEW$
      3260**DCL      5388<<ASSIGN   5452>>ASSIGN   5619<<ASSIGN   5634>>ASSIGN   5649>>ASSIGN   5653>>ASSIGN
      5891<<ASSIGN   5895>>IF       6358<<ASSIGN   6890<<ASSIGN   6891>>DOWHILE  6893>>IF       6896>>IF
      6898<<ASSIGN   6898>>ASSIGN
NEWSTATES
      3419**DCL      6492>>ASSIGN
NEWSV IN PROCEDURE SVPROCESSOR
      6380**LABEL    6367--GOTO
NO IN PROCEDURE SVPROCESSOR
      6913**LABEL    6885--GOTO     6889--GOTO     6894--GOTO     6897--GOTO
NOCANDO IN PROCEDURE VARTOSVS
      5685**LABEL    5682--CALLALT  5697--GOTO
NOSVS IN PROCEDURE CHECKSIGNON
      5652**LABEL    5631--CALLALT
NOSVS IN PROCEDURE DOSIGNON
      5605**LABEL    5558--CALLALT
NOSVS IN PROCEDURE SVPROCESSOR
      6365**LABEL    6363--CALLALT  6448--GOTO     6663--CALLALT
NOTIFY IN PROCEDURE MAYNOTIFY
      5769**ENTRY    6834--CALL     6848--CALL
NOTNOW IN PROCEDURE MAYREAD
      5750**LABEL    5715--GOTO     5718--GOTO     5725--GOTO
NUM IN PROCEDURE MYLOOKUP
      7546**DCL      7545--PROC     7556<<ASSIGN
OKAY IN PROCEDURE CHECKSIGNON
      5633**LABEL    5625--GOTO
OLDFLD1 IN PROCEDURE WRITEMESS
      7245**DCL      7309<<ASSIGN   7321>>ASSIGN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:335  
OLDINAM IN PROCEDURE WRITEMESS
      7246**DCL      7310<<ASSIGN   7322>>ASSIGN
OLDMID IN PROCEDURE WRITEMESS
      7247**DCL      7307<<ASSIGN   7319>>ASSIGN
OLDTYPE IN PROCEDURE WRITEMESS
      7244**DCL      7308<<ASSIGN   7320>>ASSIGN
OPEN@
      4252**DCL      5299<>CALL     5306<>CALL
OPEN@.ACSVEH_
      4254**DCL      4255--REDEF
OPEN@.ALTKEYS_
      4260**DCL      4261--REDEF    4261--REDEF
OPEN@.HDR_
      4259**DCL      4260--REDEF
OPEN@.TAB_
      4258**DCL      4259--REDEF
OPEN@.UHL_
      4252**DCL      4253--REDEF    4253--REDEF
OPEN@.V
      4261**DCL      4252--DCLINIT
OPEN@.V.FSN#
      4292**DCL      4292--REDEF    4292--REDEF
OPEN@.V.FUN#
      4271**DCL      5298<<ASSIGN   5305<<ASSIGN
OPEN@.WSN_
      4258**DCL      4258--REDEF
OPEN@ALT
      5302**LABEL    5299--CALLALT
OPEN@ALT0
      5294**LABEL    5304--GOTO     5306--CALLALT  5308--CALLALT  5309--CALLALT  5310--CALLALT  5311--CALLALT
      5312--CALLALT
OPENCG@
      3639**DCL      5289<>CALL     5295<>CALL
OPENCG@.ACSVEH_
      3641**DCL      3642--REDEF
OPENCG@.ALTKEYS_
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:336  
      3647**DCL      3648--REDEF    3648--REDEF
OPENCG@.HDR_
      3646**DCL      3647--REDEF
OPENCG@.TAB_
      3645**DCL      3646--REDEF
OPENCG@.UHL_
      3639**DCL      3640--REDEF    3640--REDEF
OPENCG@.V
      3648**DCL      3639--DCLINIT
OPENCG@.V.EXIST#
      3652**DCL      5294<<ASSIGN
OPENCG@.V.FSN#
      3679**DCL      3679--REDEF    3679--REDEF
OPENCG@.V.FUN#
      3658**DCL      5288<<ASSIGN
OPENCG@.WSN_
      3645**DCL      3645--REDEF
OPENCG@ALT
      5288**LABEL    5289--CALLALT
OPENCG@ALT0
      5288**LABEL    5295--CALLALT
OPENED@
      5305**LABEL    5300--GOTO
OPENEDCG@
      5294**LABEL    5290--GOTO
OPENSVS@
      4509**DCL      5308<>CALL
OPENSVS@.ACSVEH_
      4511**DCL      4512--REDEF
OPENSVS@.ALTKEYS_
      4517**DCL      4518--REDEF    4518--REDEF
OPENSVS@.HDR_
      4516**DCL      4517--REDEF
OPENSVS@.TAB_
      4515**DCL      4516--REDEF
OPENSVS@.UHL_
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:337  
      4509**DCL      4510--REDEF    4510--REDEF
OPENSVS@.V
      4518**DCL      4509--DCLINIT
OPENSVS@.V.FSN#
      4549**DCL      4549--REDEF    4549--REDEF
OPENSVS@.WSN_
      4515**DCL      4515--REDEF
OPENSVX@
      4690**DCL      5309<>CALL
OPENSVX@.ACSVEH_
      4692**DCL      4693--REDEF
OPENSVX@.ALTKEYS_
      4698**DCL      4699--REDEF    4699--REDEF
OPENSVX@.HDR_
      4697**DCL      4698--REDEF
OPENSVX@.TAB_
      4696**DCL      4697--REDEF
OPENSVX@.UHL_
      4690**DCL      4691--REDEF    4691--REDEF
OPENSVX@.V
      4699**DCL      4690--DCLINIT
OPENSVX@.V.FSN#
      4730**DCL      4730--REDEF    4730--REDEF
OPENSVX@.WSN_
      4696**DCL      4696--REDEF
OSV$ IN PROCEDURE CLEARSC
      5825**DCL      5831<<ASSIGN   5849>>ASSIGN
POOLFILENAME
      4003**DCL      4253--DCLINIT
PUTLD IN PROCEDURE SVPROCESSOR
      7205**LABEL    7189--CALLALT
PUTLP IN PROCEDURE SVPROCESSOR
      7169**LABEL    7203--GOTO     7205--GOTO
RDLP IN PROCEDURE VARTOSVS
      5676**LABEL    5683--GOTO
READ@
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:338  
      4909**DCL      5676<>CALL
READ@.BUF_
      4911**DCL      5674<<ASSIGN
READ@.STATION_
      4912**DCL      4913--REDEF
READ@.V
      4913**DCL      4909--DCLINIT
READ@.V.DVBYTE.CONT#
      4926**DCL      5677<<ASSIGN   5685<<ASSIGN   5694<<ASSIGN
READ@.V.DVBYTE.REREAD#
      4924**DCL      4924--REDEF
READ@.V.INDX#
      4922**DCL      4922--REDEF
READCGC@
      4951**DCL      7189<>CALL
READCGC@.BUF_
      4953**DCL      7186<<ASSIGN   7187>>ASSIGN
READCGC@.STATION_
      4954**DCL      4955--REDEF
READCGC@.V
      4955**DCL      4951--DCLINIT
READCGC@.V.DVBYTE.CONT#
      4968**DCL      7143<<ASSIGN
READCGC@.V.DVBYTE.REREAD#
      4966**DCL      4966--REDEF
READCGC@.V.INDX#
      4964**DCL      4964--REDEF
READSVS@
      4413**DCL      7035<>CALL
READSVS@.BUF_
      4415**DCL      7019<<ASSIGN   7055<<ASSIGN
READSVS@.STATION_
      4416**DCL      4417--REDEF
READSVS@.V
      4417**DCL      4413--DCLINIT
READSVS@.V.DVBYTE.CONT#
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:339  
      4430**DCL      7036<<ASSIGN   7047>>IF       7053<<ASSIGN
READSVS@.V.DVBYTE.REREAD#
      4428**DCL      4428--REDEF
READSVS@.V.INDX#
      4426**DCL      4426--REDEF
READSVX@
      4866**DCL      7454<>CALL
READSVX@.BUF_
      4868**DCL      7451<<ASSIGN
READSVX@.STATION_
      4869**DCL      4870--REDEF
READSVX@.V
      4870**DCL      4866--DCLINIT
READSVX@.V.DVBYTE.CONT#
      4883**DCL      7450<<ASSIGN   7455<<ASSIGN   7517<<ASSIGN
READSVX@.V.DVBYTE.REREAD#
      4881**DCL      4881--REDEF
READSVX@.V.INDX#
      4879**DCL      4879--REDEF
READY IN PROCEDURE SVPROCESSOR
      6909**LABEL    6910--GOTO
RIDSTATION IN PROCEDURE SVPROCESSOR
      7210**LABEL    6283--GOTO     6296--GOTO     6321--GOTO     6336--GOTO     6978--GOTO     6997--GOTO
      7012--GOTO     7028--GOTO     7094--GOTO     7108--GOTO     7122--GOTO     7135--GOTO     7163--GOTO
      7180--GOTO     7199--GOTO
SCEXIT IN PROCEDURE SVPROCESSOR
      6723**LABEL    6719--GOTO
SCNOTIFYM
      5853**PROC     6838--CALL
SCNOTIFYO IN PROCEDURE SCNOTIFYM
      5860**ENTRY    5449--CALL     5546--CALL     5900--CALL     6508--CALL     6852--CALL
SETSTATE IN PROCEDURE SVPROCESSOR
      6825**LABEL    6752--GOTO     6764--GOTO     6788--GOTO     6800--GOTO
SHERR IN PROCEDURE SVPROCESSOR
      6448**LABEL    6356--CALLALT  6867--CALLALT
SNAP IN PROCEDURE SVPROCESSOR
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:340  
      6799**LABEL    6776--GOTO
SPARE
      3223**DCL      6925--ASSIGN   6926--ASSIGN
SPARE.BUFR
      3231**DCL      7271--DCLINIT  7272--DCLINIT  7285<<ASSIGN   7286<<ASSIGN   7287<<ASSIGN   7288<<ASSIGN
      7294--ASSIGN   7299<<ASSIGN   7451--ASSIGN   7460--ASSIGN   7461--ASSIGN   7465--ASSIGN   7486<<ASSIGN
      7487<<ASSIGN   7488<<ASSIGN   7489<<ASSIGN   7492--IF       7494<<ASSIGN   7500--ASSIGN   7501--ASSIGN
      7502--ASSIGN   7503--ASSIGN   7504--ASSIGN   7505--ASSIGN   7507--ASSIGN
SPARE.DATA
      3230**DCL      3231--REDEF    6873--ASSIGN   6890--ASSIGN   6909--IF       6909--IF       6920--ASSIGN
SPARE.LENGTH1
      3228**DCL      6922<<ASSIGN
SPARE.LENGTH2
      3229**DCL      6923<<ASSIGN
SPARE.SIZE
      3226**DCL      6921<<ASSIGN   6924>>ASSIGN   6931>>ASSIGN   6933>>ASSIGN
STA
      3245**DCL      4346--DCLINIT
STA.MSGIDXT
      3255**DCL      3258--REDEF
STA.STATION#
      3249**DCL      5385<<ASSIGN   5489<<ASSIGN   5776<<ASSIGN   5783<>CALL     5795<<ASSIGN   5802<>CALL
      5812<<ASSIGN   5836>>IF       5842>>IF       5856<<ASSIGN   5862<<ASSIGN   5868<>CALL     5880<<ASSIGN
      6268<<ASSIGN   7305>>ASSIGN   7306<<ASSIGN   7318<<ASSIGN
STATION
      3232**DCL      5373<<ASSIGN   5378<>CALL     5385>>ASSIGN   5389>>IF       5389>>IF       5397<>CALL
      5404>>IF       5415<>CALL     5422>>IF       5477<<ASSIGN   5482<>CALL     5489>>ASSIGN   5525<>CALL
      5533>>ASSIGN   5564<>CALL     5575>>ASSIGN   5589<>CALL     5607<>CALL     5624>>IF       5627>>IF
      5641<>CALL     5664<>CALL     5713>>IF       5716>>IF       5721>>IF       5727>>IF       5751>>IF
      5812>>ASSIGN   5880>>ASSIGN   6267<<ASSIGN   6268>>ASSIGN   6280<>CALL     6293<>CALL     6300>>IF
      6307>>IF       6318<>CALL     6333<>CALL     6347<>CALL     6373<>CALL     6388<>CALL     6404>>ASSIGN
      6429>>IF       6461<>CALL     6475<>CALL     6482>>IF       6517<>CALL     6536<>CALL     6543>>IF
      6553<>CALL     6561>>IF       6575<>CALL     6593<>CALL     6609<>CALL     6629<>CALL     6636>>IF
      6647<>CALL     6658>>IF       6671<>CALL     6689>>IF       6696>>IF       6710<>CALL     6732<>CALL
      6742>>IF       6769<>CALL     6805<>CALL     6827>>IF       6860<>CALL     6944<>CALL     6956<>CALL
      6968>>IF       6975<>CALL     6987>>IF       6994<>CALL     7009<>CALL     7025<>CALL     7076<>CALL
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:341  
      7084>>IF       7091<>CALL     7105<>CALL     7119<>CALL     7132<>CALL     7160<>CALL     7177<>CALL
      7196<>CALL
STATION IN PROCEDURE WRITEMESS
      7240**DCL      7238--PROC     7286>>ASSIGN
STATIONNAME
      3268**DCL      4311--DCLINIT  7210<<ASSIGN   7211>>IF
STX IN PROCEDURE WRITEMESS
      7248**DCL      7305<<ASSIGN   7318>>ASSIGN
SV
      5122**DCL      5571<<ASSIGN   6365<<ASSIGN
SV.ACVM
      5128**DCL      5428>>ASSIGN   5535<<ASSIGN   5722>>ASSIGN   5723>>ASSIGN   6413<<ASSIGN   6488>>ASSIGN
      6501<<ASSIGN   6546<<ASSIGN   6562>>ASSIGN   6564>>ASSIGN   7351<<ASSIGN
SV.ACVO
      5127**DCL      5428<<ASSIGN   5722>>ASSIGN   5723>>ASSIGN   6412<<ASSIGN   6488<<ASSIGN   6544<<ASSIGN
      6562>>ASSIGN   6564>>ASSIGN
SV.ASMM
      5126**DCL      5429>>ASSIGN   5580<<ASSIGN   5723>>ASSIGN   6411<<ASSIGN   6489>>ASSIGN   6638>>ASSIGN
      6750<<ASSIGN   6759<<ASSIGN   6780>>IF       6785<<ASSIGN   6790>>IF       6794<<ASSIGN   6799>>IF
      7330<<ASSIGN   7533<<ASSIGN   7537<<ASSIGN
SV.ASMO
      5125**DCL      5429<<ASSIGN   5579<<ASSIGN   5722>>ASSIGN   6410<<ASSIGN   6489<<ASSIGN   6637>>ASSIGN
      6744>>IF       6749<<ASSIGN   6754>>IF       6758<<ASSIGN   6763>>IF       6786<<ASSIGN   6795<<ASSIGN
      7331<<ASSIGN   7534<<ASSIGN   7538<<ASSIGN
SV.BLNK$
      5124**DCL      5457>>IF       5458>>ASSIGN   5461<<ASSIGN   5461>>ASSIGN   5462>>ASSIGN   5467<<ASSIGN
SV.COUPLING
      5129**DCL      5391>>DOCASE   5447<<ASSIGN   5503>>IF       5534<<ASSIGN   5543>>ASSIGN   5578<<ASSIGN
      6408<<ASSIGN   6421>>ASSIGN   6433>>ASSIGN   6442>>ASSIGN   6468>>ASSIGN   6469>>IF       6502<<ASSIGN
      6876>>IF       7348<<ASSIGN   7486>>ASSIGN   7555>>IF
SV.DBKEY
      5133**DCL      5537>>IF       5542>>ASSIGN   5582<<ASSIGN   5584<<ASSIGN   5671>>ASSIGN   5672>>ASSIGN
      5687<<ASSIGN   5687>>ASSIGN   6399>>IF       6400<<ASSIGN   6401<<ASSIGN   6422>>ASSIGN   6434>>ASSIGN
      6441>>ASSIGN   6585>>ASSIGN   6602>>ASSIGN   6618>>ASSIGN   6927>>ASSIGN   6928>>IF       6934>>ASSIGN
      7020>>IF       7032>>ASSIGN   7155>>IF       7167>>ASSIGN   7353>>IF       7353<<ASSIGN   7353>>ASSIGN
      7448>>ASSIGN   7508>>ASSIGN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:342  
SV.DBSIZE
      5157**DCL      5542>>IF       6414<<ASSIGN   6586>>ASSIGN   6619>>ASSIGN   6740<<ASSIGN   6931<<ASSIGN
      7139<<ASSIGN   7475<<ASSIGN   7504<<ASSIGN
SV.INAME
      5131**DCL      5132--REDEF    5540>>ASSIGN
SV.INAMER
      5132**DCL      5574<<ASSIGN   6398<<ASSIGN
SV.LNK$
      5123**DCL      5388>>ASSIGN   5458<<ASSIGN   5458>>ASSIGN   5459>>ASSIGN   5460>>IF       5461>>ASSIGN
      5466<<ASSIGN   5469<<ASSIGN   5628>>ASSIGN   5847>>ASSIGN   5904>>ASSIGN   6274>>ASSIGN   6361>>ASSIGN
      6659>>ASSIGN   6702>>ASSIGN   6913>>ASSIGN   6969>>ASSIGN   7491>>ASSIGN
SV.MATCH.N.ACCT
      5144**DCL      6877>>IF
SV.MATCH.N.UNAME
      5145**DCL      6877>>IF
SV.MATCH.NAME
      5142**DCL      5143--REDEF    5425>>ASSIGN   5426<<ASSIGN   5515>>IF       5515>>IF       5515>>IF
      5532<<ASSIGN   5576<<ASSIGN   5796>>IF       5857>>IF       5890>>IF       5895>>IF       6407<<ASSIGN
      6420>>IF       6485>>ASSIGN   6486<<ASSIGN   6570>>IF       6583>>IF       6624>>IF       6727>>IF
      6839>>IF       6877>>IF       6877>>IF       6951>>IF       7018>>IF       7141>>IF       7349<<ASSIGN
      7488>>ASSIGN
SV.MATCH.STATION
      5141**DCL      5389>>IF       5427>>ASSIGN   5439<<ASSIGN   5533<<ASSIGN   5716>>IF       5795>>ASSIGN
      5842>>IF       5856>>ASSIGN   6307>>IF       6406<<ASSIGN   6487>>ASSIGN   6494<<ASSIGN   6696>>IF
      7350<<ASSIGN
SV.MIDM
      5159**DCL      5433>>ASSIGN   5434<<ASSIGN   5440<<ASSIGN   5754<<ASSIGN   5792>>IF       5794>>ASSIGN
      5815<<ASSIGN   5855>>ASSIGN   6311<<ASSIGN   6326>>IF       6416<<ASSIGN   6490>>ASSIGN   6495<<ASSIGN
      6700<<ASSIGN
SV.MIDO
      5158**DCL      5434>>ASSIGN   5435<<ASSIGN   5441>>IF       5752<<ASSIGN   5773>>IF       5775>>ASSIGN
      5814<<ASSIGN   5861>>ASSIGN   6304<<ASSIGN   6326>>IF       6415<<ASSIGN   6490<<ASSIGN   6496>>IF
      6693<<ASSIGN   7303>>IF       7313>>ASSIGN   7325<<ASSIGN
SV.OFFER.N.ACCT
      5138**DCL      6882>>IF
SV.OFFER.NAME
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:343  
      5136**DCL      5137--REDEF    5424>>ASSIGN   5425<<ASSIGN   5450>>IF       5514>>IF       5515>>IF
      5515>>IF       5515>>IF       5515>>IF       5573<<ASSIGN   5623>>IF       5895>>IF       6405<<ASSIGN
      6484>>ASSIGN   6485<<ASSIGN   6509>>IF       6657>>IF       6882>>IF       6888>>IF       6893>>IF
      6901>>ASSIGN   7487>>ASSIGN
SV.OFFER.STATION
      5135**DCL      5389>>IF       5404>>IF       5422>>IF       5427<<ASSIGN   5575<<ASSIGN   5624>>IF
      5627>>IF       5713>>IF       5721>>IF       5727>>IF       5751>>IF       5776>>ASSIGN   5836>>IF
      5862>>ASSIGN   6300>>IF       6404<<ASSIGN   6429>>IF       6482>>IF       6487<<ASSIGN   6543>>IF
      6561>>IF       6636>>IF       6658>>IF       6689>>IF       6742>>IF       6827>>IF       6968>>IF
      6987>>IF       7084>>IF       7306>>ASSIGN
SV.SCDF
      5155**DCL      5572<<ASSIGN   5622>>IF       5894>>IF       6656>>IF       6967>>IF
SV.SCM
      5154**DCL      5844<<ASSIGN   6698>>IF       6837<<ASSIGN
SV.SCNM
      5152**DCL      5430>>ASSIGN   5809>>IF       5845<<ASSIGN   6309>>IF       6491>>ASSIGN   6699<<ASSIGN
      6838>>IF
SV.SCNO
      5151**DCL      5430<<ASSIGN   5449>>IF       5546>>IF       5790>>IF       5839<<ASSIGN   5897>>IF
      6302>>IF       6491<<ASSIGN   6508>>IF       6692<<ASSIGN   6852>>IF
SV.SCO
      5153**DCL      5445<<ASSIGN   5545<<ASSIGN   5838<<ASSIGN   5899<<ASSIGN   6500<<ASSIGN   6691>>IF
      6851<<ASSIGN   7352<<ASSIGN
SV.STATE
      5146**DCL      5747<<ASSIGN   6409<<ASSIGN   6419<<ASSIGN   6492<<ASSIGN   6492>>ASSIGN   6492>>ASSIGN
      6741>>ASSIGN   6831<<ASSIGN   6833<<ASSIGN   6845<<ASSIGN   6847<<ASSIGN   6986>>ASSIGN   7083>>ASSIGN
      7303>>IF       7328>>IF
SV.STATE.MC
      5150**DCL      5437>>ASSIGN   5446<<ASSIGN   5714>>IF
SV.STATE.N
      5147**DCL      5431>>IF       5442<<ASSIGN   5444<<ASSIGN   5745>>IF       5750<<ASSIGN   5766>>IF
      5813<<ASSIGN   6326<<ASSIGN   6497<<ASSIGN   6499<<ASSIGN   7324<<ASSIGN
SV.STATE.OC
      5149**DCL      5437<<ASSIGN   5717>>IF
SV.SURRLEN
      5156**DCL      5599<<ASSIGN   6397<<ASSIGN   6905>>IF       6906>>ASSIGN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:344  
SV.SURROGATE
      5130**DCL      5504>>IF       5577<<ASSIGN   6395<<ASSIGN   6896>>IF       6904>>ASSIGN   7342>>IF
      7374>>IF       7489>>ASSIGN   7550>>IF
SV$
      3281**DCL      5122--IMP-PTR  5386<<ASSIGN   5387>>DOWHILE  5388>>ASSIGN   5389>>IF       5389>>IF
      5391>>DOCASE   5404>>IF       5407>>ASSIGN   5422>>IF       5424>>ASSIGN   5425>>ASSIGN   5425>>ASSIGN
      5426>>ASSIGN   5427>>ASSIGN   5427>>ASSIGN   5428>>ASSIGN   5428>>ASSIGN   5429>>ASSIGN   5429>>ASSIGN
      5430>>ASSIGN   5430>>ASSIGN   5431>>IF       5433>>ASSIGN   5434>>ASSIGN   5434>>ASSIGN   5435>>ASSIGN
      5437>>ASSIGN   5437>>ASSIGN   5439>>ASSIGN   5440>>ASSIGN   5441>>IF       5442>>ASSIGN   5444>>ASSIGN
      5445>>ASSIGN   5446>>ASSIGN   5447>>ASSIGN   5449>>IF       5450>>IF       5452<<ASSIGN   5457>>IF
      5458>>ASSIGN   5458>>ASSIGN   5459>>ASSIGN   5460>>IF       5461>>ASSIGN   5461>>ASSIGN   5462>>ASSIGN
      5466>>ASSIGN   5467>>ASSIGN   5469>>ASSIGN   5470>>ASSIGN   5471>>ASSIGN   5503>>IF       5504>>IF
      5514>>IF       5515>>IF       5515>>IF       5515>>IF       5515>>IF       5515>>IF       5515>>IF
      5515>>IF       5532>>ASSIGN   5533>>ASSIGN   5534>>ASSIGN   5535>>ASSIGN   5537>>IF       5540>>ASSIGN
      5542>>IF       5542>>ASSIGN   5543>>ASSIGN   5545>>ASSIGN   5546>>IF       5559<<ASSIGN   5571>>ASSIGN
      5572>>ASSIGN   5573>>ASSIGN   5574>>ASSIGN   5574>>ASSIGN   5575>>ASSIGN   5576>>ASSIGN   5577>>ASSIGN
      5578>>ASSIGN   5579>>ASSIGN   5580>>ASSIGN   5582>>ASSIGN   5584>>ASSIGN   5599>>ASSIGN   5619>>ASSIGN
      5620<<ASSIGN   5621>>DOWHILE  5622>>IF       5623>>IF       5624>>IF       5627>>IF       5628<<ASSIGN
      5628>>ASSIGN   5633>>ASSIGN   5634<<ASSIGN   5649<<ASSIGN   5653<<ASSIGN   5671>>ASSIGN   5672>>ASSIGN
      5687>>ASSIGN   5687>>ASSIGN   5713>>IF       5714>>IF       5716>>IF       5717>>IF       5721>>IF
      5722>>ASSIGN   5722>>ASSIGN   5722>>ASSIGN   5723>>ASSIGN   5723>>ASSIGN   5723>>ASSIGN   5727>>IF
      5745>>IF       5747>>ASSIGN   5750>>ASSIGN   5751>>IF       5752>>ASSIGN   5754>>ASSIGN   5766>>IF
      5772>>ASSIGN   5773>>IF       5775>>ASSIGN   5776>>ASSIGN   5790>>IF       5792>>IF       5794>>ASSIGN
      5795>>ASSIGN   5796>>IF       5809>>IF       5813>>ASSIGN   5814>>ASSIGN   5815>>ASSIGN   5831>>ASSIGN
      5833<<ASSIGN   5834>>DOWHILE  5836>>IF       5838>>ASSIGN   5839>>ASSIGN   5842>>IF       5844>>ASSIGN
      5845>>ASSIGN   5847<<ASSIGN   5847>>ASSIGN   5849<<ASSIGN   5855>>ASSIGN   5856>>ASSIGN   5857>>IF
      5861>>ASSIGN   5862>>ASSIGN   5890>>IF       5891>>ASSIGN   5892<<ASSIGN   5893>>DOWHILE  5894>>IF
      5895>>IF       5897>>IF       5899>>ASSIGN   5904<<ASSIGN   5904>>ASSIGN   6271<<ASSIGN   6272>>DOWHILE
      6273>>IF       6274<<ASSIGN   6274>>ASSIGN   6300>>IF       6302>>IF       6303<<ASSIGN   6304>>ASSIGN
      6307>>IF       6309>>IF       6310<<ASSIGN   6311>>ASSIGN   6326>>IF       6326>>IF       6326>>ASSIGN
      6357<<ASSIGN   6359>>DOWHILE  6361<<ASSIGN   6361>>ASSIGN   6364<<ASSIGN   6365>>ASSIGN   6395>>ASSIGN
      6397>>ASSIGN   6398>>ASSIGN   6398>>ASSIGN   6400>>ASSIGN   6401>>ASSIGN   6404>>ASSIGN   6405>>ASSIGN
      6406>>ASSIGN   6407>>ASSIGN   6408>>ASSIGN   6409>>ASSIGN   6410>>ASSIGN   6411>>ASSIGN   6412>>ASSIGN
      6413>>ASSIGN   6414>>ASSIGN   6415>>ASSIGN   6416>>ASSIGN   6418>>ASSIGN   6419>>ASSIGN   6420>>IF
      6421>>ASSIGN   6422>>ASSIGN   6429>>IF       6432>>ASSIGN   6433>>ASSIGN   6434>>ASSIGN   6440>>ASSIGN
      6441>>ASSIGN   6442>>ASSIGN   6468>>ASSIGN   6469>>IF       6482>>IF       6484>>ASSIGN   6485>>ASSIGN
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:345  
      6485>>ASSIGN   6486>>ASSIGN   6487>>ASSIGN   6487>>ASSIGN   6488>>ASSIGN   6488>>ASSIGN   6489>>ASSIGN
      6489>>ASSIGN   6490>>ASSIGN   6490>>ASSIGN   6491>>ASSIGN   6491>>ASSIGN   6492>>ASSIGN   6492>>ASSIGN
      6492>>ASSIGN   6494>>ASSIGN   6495>>ASSIGN   6496>>IF       6497>>ASSIGN   6499>>ASSIGN   6500>>ASSIGN
      6501>>ASSIGN   6502>>ASSIGN   6508>>IF       6509>>IF       6525>>ASSIGN   6543>>IF       6544>>ASSIGN
      6546>>ASSIGN   6561>>IF       6562>>ASSIGN   6562>>ASSIGN   6564>>ASSIGN   6564>>ASSIGN   6570>>IF
      6583>>IF       6585>>ASSIGN   6586>>ASSIGN   6602>>ASSIGN   6618>>ASSIGN   6619>>ASSIGN   6624>>IF
      6636>>IF       6637>>ASSIGN   6638>>ASSIGN   6654<<ASSIGN   6655>>DOWHILE  6656>>IF       6657>>IF
      6658>>IF       6659<<ASSIGN   6659>>ASSIGN   6687<<ASSIGN   6688>>DOWHILE  6689>>IF       6691>>IF
      6692>>ASSIGN   6693>>ASSIGN   6696>>IF       6698>>IF       6699>>ASSIGN   6700>>ASSIGN   6702<<ASSIGN
      6702>>ASSIGN   6727>>IF       6740>>ASSIGN   6741>>ASSIGN   6742>>IF       6744>>IF       6749>>ASSIGN
      6750>>ASSIGN   6754>>IF       6758>>ASSIGN   6759>>ASSIGN   6763>>IF       6780>>IF       6785>>ASSIGN
      6786>>ASSIGN   6790>>IF       6794>>ASSIGN   6795>>ASSIGN   6799>>IF       6827>>IF       6831>>ASSIGN
      6833>>ASSIGN   6837>>ASSIGN   6838>>IF       6839>>IF       6845>>ASSIGN   6847>>ASSIGN   6851>>ASSIGN
      6852>>IF       6874<<ASSIGN   6875>>DOWHILE  6876>>IF       6877>>IF       6877>>IF       6877>>IF
      6877>>IF       6882>>IF       6882>>IF       6888>>IF       6893>>IF       6896>>IF       6901>>ASSIGN
      6904>>ASSIGN   6905>>IF       6906>>ASSIGN   6913<<ASSIGN   6913>>ASSIGN   6951>>IF       6965<<ASSIGN
      6966>>DOWHILE  6967>>IF       6968>>IF       6969<<ASSIGN   6969>>ASSIGN   6986>>ASSIGN   6987>>IF
      7018>>IF       7020>>IF       7032>>ASSIGN   7083>>ASSIGN   7084>>IF       7139>>ASSIGN   7141>>IF
      7155>>IF       7167>>ASSIGN   7342>>IF       7347>>ASSIGN   7348>>ASSIGN   7349>>ASSIGN   7350>>ASSIGN
      7351>>ASSIGN   7352>>ASSIGN   7353>>IF       7353>>ASSIGN   7353>>ASSIGN   7374>>IF       7378>>IF
      7381>>ASSIGN   7448>>ASSIGN   7475>>ASSIGN   7504>>ASSIGN   7508>>ASSIGN   7533>>ASSIGN   7534>>ASSIGN
      7537>>ASSIGN   7538>>ASSIGN   7550>>IF       7554>>IF       7555>>IF
SVDELINK
      5456**PROC     5406--CALL     6503--CALL     6524--CALL     7380--CALL
SVERR IN PROCEDURE SVPROCESSOR
      7218**LABEL    6929--CALLALT  6930--CALLALT  7169--CALLALT
SVHD$
      3371**DCL      5386>>ASSIGN   5459<<ASSIGN   5470<<ASSIGN   5620>>ASSIGN   5833>>ASSIGN   5892>>ASSIGN
      6271>>ASSIGN   6357>>ASSIGN   6654>>ASSIGN   6687>>ASSIGN   6874>>ASSIGN   6965>>ASSIGN   7482>>ASSIGN
SVISOK IN PROCEDURE SVPROCESSOR
      6288**LABEL    6273--GOTO
SVLINK
      5465**PROC     5600--CALL     6366--CALL     6504--CALL
SVPROCESSOR
      5909**PROC     5325--CALL
SVSCB
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:346  
      3354**DCL      5408<>CALL     5558<>CALL     6363<>CALL     6526<>CALL     7382<>CALL
SVSIGNON$
      3283**DCL      5633<<ASSIGN   6399>>IF       6927>>ASSIGN   6928>>IF       6931>>ASSIGN   6934>>ASSIGN
SVTEMP
      4614**DCL      4510--DCLINIT
SVTL$
      3372**DCL      5462<<ASSIGN   5467>>ASSIGN   5468>>IF       5469>>ASSIGN   5471<<ASSIGN
SVX$
      3282**DCL      5407<<ASSIGN   5408<>CALL     5558<>CALL     5559>>ASSIGN   6363<>CALL     6364>>ASSIGN
      6525<<ASSIGN   6526<>CALL     7381<<ASSIGN   7382<>CALL
SVXKEY
      3400**DCL      4831--DCLINIT  4866--DCLINIT  4867--DCLINIT
SV_INIT
      3297**DCL      5571>>ASSIGN   6365>>ASSIGN
SV_INIT.INAME
      3306**DCL      3307--REDEF
SV_INIT.MATCH.NAME
      3317**DCL      3318--REDEF
SV_INIT.OFFER.NAME
      3311**DCL      3312--REDEF
SV_NOT_ALLOWED
      5163**DCL      6288>>IF
SV_REQUIRED
      5167**DCL      6328>>IF
SXTEMP
      4761**DCL      4691--DCLINIT
TEMP
      3264**DCL      5433<<ASSIGN   5435>>ASSIGN   6396<<CALLBLT  6397>>ASSIGN   6741<<ASSIGN   6747>>IF
      6747>>IF       6756>>IF       6756>>IF       6783>>IF       6783>>IF       6792>>IF       6792>>IF
      6829>>DOCASE   6843>>DOCASE   6872<<ASSIGN   6905>>IF       6906<<ASSIGN   6916>>IF       6919>>ASSIGN
      6920<<ASSIGN   6921>>ASSIGN   6922>>ASSIGN   7154<<ASSIGN   7171>>ASSIGN   7184<<ASSIGN
TRUNCSV@
      4808**DCL      5312<>CALL
TRUNCSV@.V
      4808**DCL      4808--DCLINIT
TRUNCSVS@
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:347  
      4792**DCL      5311<>CALL
TRUNCSVS@.V
      4792**DCL      4792--DCLINIT
TRUNCSVX@
      4776**DCL      5310<>CALL
TRUNCSVX@.V
      4776**DCL      4776--DCLINIT
TYPE IN PROCEDURE MAYREAD
      5702**DCL      5703<<ASSIGN   5707<<ASSIGN   5711<<ASSIGN   5719>>IF       5724>>IF       5724>>IF
      5728>>DOCASE   5737>>DOCASE
VARTOSVS
      5657**PROC     5537--CALL
WAKUP IN PROCEDURE SVPROCESSOR
      6708**LABEL    6691--GOTO     6698--GOTO
WRITE IN PROCEDURE SVPROCESSOR
      6747**LABEL    6761--GOTO
WRITE2 IN PROCEDURE SVPROCESSOR
      6783**LABEL    6797--GOTO
WRITE@
      4378**DCL      6929<>CALL
WRITE@.BUF_
      4378**DCL      6925<<ASSIGN
WRITE@.STATION_
      4380**DCL      4380--REDEF
WRITE@.V
      4381**DCL      4378--DCLINIT
WRITE@.V.DVBYTE.VFC#
      4387**DCL      4387--REDEF
WRITECG@
      4344**DCL      5493<>CALL     5544<>CALL     5756<>CALL     5777<>CALL     5796<>CALL     5877<>CALL
      6381<>CALL     6423<>CALL     6435<>CALL     6443<>CALL     6453<>CALL     6506<>CALL     6528<>CALL
      6566<>CALL     6587<>CALL     6603<>CALL     6620<>CALL     6640<>CALL     6681<>CALL     6724<>CALL
      6826<>CALL     6935<>CALL     7046<>CALL     7064<>CALL     7316<>CALL
WRITECG@.BUF_
      4344**DCL      7044<<ASSIGN   7048<<ASSIGN
WRITECG@.STATION_
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:348  
      4346**DCL      4346--REDEF
WRITECG@.V
      4347**DCL      4344--DCLINIT
WRITECG@.V.DVBYTE.CONT#
      4355**DCL      7037<<ASSIGN   7054<<ASSIGN
WRITECG@.V.DVBYTE.VFC#
      4353**DCL      4353--REDEF
WRITEMESS
      7238**PROC     5378--CALL     5397--CALL     5415--CALL     5482--CALL     5525--CALL     5564--CALL
      5589--CALL     5607--CALL     5641--CALL     5664--CALL     5783--CALL     5802--CALL     5868--CALL
      6280--CALL     6293--CALL     6318--CALL     6333--CALL     6347--CALL     6373--CALL     6388--CALL
      6461--CALL     6475--CALL     6517--CALL     6536--CALL     6553--CALL     6575--CALL     6593--CALL
      6609--CALL     6629--CALL     6647--CALL     6671--CALL     6710--CALL     6732--CALL     6769--CALL
      6805--CALL     6860--CALL     6944--CALL     6956--CALL     6975--CALL     6994--CALL     7009--CALL
      7025--CALL     7076--CALL     7091--CALL     7105--CALL     7119--CALL     7132--CALL     7160--CALL
      7177--CALL     7196--CALL
WRITEMSG@ IN PROCEDURE WRITEMESS
      7270**DCL      7290<>CALL
WRITEMSG@.BUF_.BOUND IN PROCEDURE WRITEMESS
      7270**DCL      7289<<ASSIGN
WRITEMSG@.STATION_ IN PROCEDURE WRITEMESS
      7272**DCL      7272--REDEF
WRITEMSG@.V IN PROCEDURE WRITEMESS
      7273**DCL      7270--DCLINIT
WRITEMSG@.V.DVBYTE.VFC# IN PROCEDURE WRITEMESS
      7279**DCL      7279--REDEF
WRITESVS@
      4573**DCL      5682<>CALL     6930<>CALL     7169<>CALL     7466<>CALL     7509<>CALL     7523<>CALL
WRITESVS@.BUF_
      4573**DCL      5673<<ASSIGN   5680<<ASSIGN   5688<<ASSIGN   6926<<ASSIGN   7147<<ASSIGN   7151<<ASSIGN
      7187<<ASSIGN   7465<<ASSIGN   7507<<ASSIGN   7521<<ASSIGN
WRITESVS@.STATION_
      4575**DCL      4575--REDEF
WRITESVS@.V
      4576**DCL      4573--DCLINIT
WRITESVS@.V.DVBYTE.CONT#
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:349  
      4584**DCL      5678<<ASSIGN   5683>>IF       5686<<ASSIGN   5693<<ASSIGN   7146<<ASSIGN   7152<<ASSIGN
      7170>>IF       7188<<ASSIGN   7190<<ASSIGN   7449<<ASSIGN   7456<<ASSIGN   7468>>IF       7506<<ASSIGN
      7518<<ASSIGN   7522<<ASSIGN
WRITESVS@.V.DVBYTE.VFC#
      4582**DCL      4582--REDEF
WRITESVX@
      4831**DCL      7300<>CALL     7363<>CALL     7390<>CALL     7444<>CALL     7473<>CALL
WRITESVX@.BUF_
      4831**DCL      7294<<ASSIGN   7361<<ASSIGN   7388<<ASSIGN   7442<<ASSIGN   7471<<ASSIGN
WRITESVX@.STATION_
      4833**DCL      4833--REDEF
WRITESVX@.V
      4834**DCL      4831--DCLINIT
WRITESVX@.V.DVBYTE.CONT#
      4842**DCL      7295<<ASSIGN   7362<<ASSIGN   7389<<ASSIGN   7443<<ASSIGN   7472<<ASSIGN
WRITESVX@.V.DVBYTE.VFC#
      4840**DCL      4840--REDEF
WROTEIT IN PROCEDURE MAYNOTIFY
      5802**LABEL    5819--GOTO
WROTIT IN PROCEDURE SCNOTIFYM
      5879**LABEL    5857--GOTO     5883--GOTO
XTNDALT
      5362**LABEL    5362--CALLALT
XTNDALT0
      5364**LABEL    5365--CALLALT
YES IN PROCEDURE SVPROCESSOR
      6888**LABEL    6884--GOTO
Z0
      5336**LABEL    5335--CALLALT
Z1
      5337**LABEL    5336--CALLALT
Z2
      5338**LABEL    5337--CALLALT
ZA1_DABLK.LENGTHS
      3203**DCL      7406>>ASSIGN   7408>>ASSIGN   7410>>ASSIGN   7461<<ASSIGN   7500<<ASSIGN   7505<<ASSIGN
ZA1_DABLK.RANK
PL6.E3A0      #001=FIA$APL File=FIA$APL.:E05TSI                                  TUE 07/29/97 15:25 Page:350  
      3200**DCL      7126>>ASSIGN   7404>>DOCASE   7502<<ASSIGN
ZA1_DABLK.SIZE
      3201**DCL      7057>>ASSIGN   7139>>ASSIGN   7140>>ASSIGN   7460<<ASSIGN   7503<<ASSIGN   7504>>ASSIGN
ZA1_DABLK.TYPE
      3199**DCL      7113>>ASSIGN   7403>>IF       7501<<ASSIGN
