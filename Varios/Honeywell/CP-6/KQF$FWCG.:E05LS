VERSION E05

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:1    
        1        1        /*M* KQF$FWCG - Comgroup FWCG pmme routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=2
                 7        ,IAD=0,PRB */
        8        8        /*P* NAME:        KQF$FWCG
        9        9             PURPOSE:     This module contains the routines used to implement
       10       10                          the M$FWCG pmme.
       11       11             DESCRIPTION: This module contains various external routines that
       12       12                          implement the M$FWCG pmme. KQF$FWCG is is the high
       13       13                          level routine called by the KCP$PMMES, the CG pmme
       14       14                          distributor. KQF$FWCG calls KQL$xFFIND to read messages
       15       15                          from a particular message queue node. KQL$xFFIND in
       16       16                          turn calls KQF$CHKMSG or KQF$GOTMSG to determine if
       17       17                          additional selection criteria are met, and if so to
       18       18                          add the message to the informational (*AUEV) message,
       19       19                          and/or move the message to the *FWCG station for the
       20       20                          change attributes function. Thus, this module contains
       21       21                          two external compile units - KQF$FWCG and KQF$CHKMSG/
       22       22                          KQF$GOTMSG. */
       23       23        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:2    
       24       24        /*F* NAME:        KQF$FWCG
       25       25             PURPOSE:     This routine is the main driver for the M$FWCG pmme.
       26       26             DESCRIPTION: This routine is called by KCP$PMMES, the main driver
       27       27                          for CG pmmes. See KC_CP6_C for a functional description
       28       28                          of the M$FWCG pmme. */
       29       29        /*D* NAME:        KQF$FWCG
       30       30             ENTRY:       KQF$FWCG
       31       31             CALL:        CALL KQF$FWCG (MYSTA$) ALTRET (AURD not sufficient);
       32       32             INPUT:       MYSTA$ - Pointer to station node for user of M$FWCG.
       33       33             OUTPUT:      See KC_CP6_C.
       34       34             SCRATCH:     Local AUTO (TSTACK).
       35       35             DESCRIPTION: Due to the complicated way this pmme is implemented,
       36       36                          the general rule of not checking parameters (and
       37       37                          subsequently trapping if they are bad) is violated,
       38       38                          i.e., the parameters are validated using the appropriate
       39       39                          HFF$? routines. Since only one instance of this pmme per
       40       40                          CG is allowed at a time, the user will be queued for
       41       41                          access if there is currently another M$FWCG user for
       42       42                          the same CG. */
       43       43
       44       44        KQF$FWCG: PROC (MYSTA$) ALTRET;
       45       45
       46       46        /* Includes */
       47       47
       48       48        %INCLUDE B$JIT;
       49      651        %INCLUDE F_ERRORS_C;
       50      891        %INCLUDE HF_LOCK_C;
       51      905        %INCLUDE KC$CP6V_C;
       52     1025        %INCLUDE KC_CP6;
       53     1585        %INCLUDE KC_DATA_R;
       54     1598        %INCLUDE KC_ERRORS_C;
       55     1645        %INCLUDE KQ_MAC_C;
       56     4195        %INCLUDE KQ_DATA_R;
       57     5027        %INCLUDE KQ_ERRORS_C;
       58     5075        %INCLUDE KQ_SUBS_C;
       59     5375        %INCLUDE SS_SCHED_C;
       60     5608        %INCLUDE UD_SEV_C;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:3    
       61     5622
       62     5623        /* Parameters */
       63     5624
       64     5625    1   DCL MYSTA$ PTR;
       65     5626
       66     5627        /* Macros */
       67     5628
       68     5629        %MACRO $ERROR (NAME=GORGO,CODE=0,SEV=SEV_ERROR#);
       69     5630        DCL 1 NAME CONSTANT ALIGNED,
       70     5631              2 * BIT(18) UNAL INIT('132106'O), /* 'KQF' */
       71     5632              2 * UBIN(15) UNAL INIT(CODE),
       72     5633              2 * UBIN(3) UNAL INIT(SEV);
       73     5634        %MEND;
       74     5635
       75     5636        /* Based */
       76     5637
       77     5638    1   DCL 1 KEY$TEMP BASED (KEY$) ALIGNED,
       78     5639    1         2 K CHAR (KEYL);
       79     5640        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CG$)");
       80     6379        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS="BASED");
       81     6432        %KQ_DGRAN (FPTN=KQ$DGRAN,STCLASS="BASED");
       82     6579        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED");
       83     6849        %KQ_QTN (FPTN=KQ$QTN,STCLASS="BASED");
       84     7322        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS="BASED");
       85     7508        %KQ_STA (FPTN=KQ$STA,STCLASS="BASED");
       86     7847        %KQ_THDR (FPTN=KQ$THDR,STCLASS="BASED");
       87     7885        %FPT$FWCG_V (FPTN=FPT$FWCG_V,BASED="BASED(V_$)");
       88     7889        %VLP$CGMA_V (FPTN=VLP$CGMA,BASED="BASED");
       89     7901        %VLP$SCGMA_V (FPTN=VLP$SCGMA,BASED="BASED");
       90     7905        %VLR$FWCG_V (FPTN=VLR$FWCG,BASED="BASED(RESULTS_$)");
       91     7908
       92     7909        /* Auto */
       93     7910
       94     7911    1   DCL ANONYMOUS BIT(1) ALIGNED;
       95     7912    1   DCL CG$ PTR;
       96     7913    1   DCL DELETE BIT(1) ALIGNED;
       97     7914    1   DCL DELETE_ALL_ONLY BIT(1) ALIGNED;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:4    
       98     7915    1   DCL DIRECT BIT(1) ALIGNED;
       99     7916        %KQ_RBLK (FPTN=FWCG$RBLK,STCLASS=" ");
      100     8102    1   DCL KEYL UBIN;
      101     8103    1   DCL KEYLAST CHAR(8);
      102     8104    1   DCL KEYTEMP CHAR(8);
      103     8105    1   DCL KEYBTEMP REDEF KEYTEMP BIT(72);
      104     8106    1   DCL KEY$ PTR;
      105     8107        %KQ_FWP (FPTN=KQ$FWP,STCLASS=" ");
      106     8208    1   DCL MBLK$ PTR;
      107     8209    1   DCL ONEATTR BIT(1) ALIGNED;
      108     8210    1   DCL P$ PTR;
      109     8211    1   DCL QTN$ PTR;
      110     8212    1   DCL REATTR BIT(1) ALIGNED;
      111     8213    1   DCL RESULTS BIT(1) ALIGNED;
      112     8214    1   DCL SAVE_MBLK$ PTR;
      113     8215    1   DCL STA$ PTR;
      114     8216
      115     8217        /* Constant */
      116     8218
      117     8219        %KQ_FWP (FPTN=KQF_IFWP,STCLASS=CONSTANT);
      118     8320    1   DCL KQF_FWCGT CHAR(8) CONSTANT INIT ('*FWCG');
      119     8321
      120     8322        %$ERROR (NAME=E_NOACC_V,CODE=%E$FWCG_V);
      121     8328        %$ERROR (NAME=E_NOACC_CRITERIA,CODE=%E$FWCG_CRITERIA);
      122     8334        %$ERROR (NAME=E_NOACC_SCA,CODE=%E$FWCG_SCA);
      123     8340        %$ERROR (NAME=E_NOACC_REATTR,CODE=%E$FWCG_REATTR);
      124     8346        %$ERROR (NAME=E_NOACC_SRA,CODE=%E$FWCG_SRA);
      125     8352        %$ERROR (NAME=E_NOACC_RESULTS,CODE=%E$FWCG_RESULTS);
      126     8358        %$ERROR (NAME=E_NOACC_ONEATTR,CODE=%E$FWCG_ONEATTR);
      127     8364        %$ERROR (NAME=E_INV_QSELECT,CODE=%E$FWCG_QSELECT);
      128     8370        %$ERROR (NAME=E_NOLATCHED,CODE=%E$FWCG_NOLATCHED);
      129     8376        %$ERROR (NAME=E_INV_STACHAR,CODE=%E$STACHAR);
      130     8382        %$ERROR (NAME=E_INV_TYPCHAR,CODE=%E$TYPCHAR);
      131     8388        %$ERROR (NAME=E_INV_MSGIDXT,CODE=%E$FWCG_MSGIDXT);
      132     8394        %$ERROR (NAME=E_CGFULL,CODE=%E$CGFULL);
      133     8400        %$ERROR (NAME=E_FWCG_NONE,CODE=%E$FWCG_NONE);
      134     8406        %$ERROR (NAME=E_DI,CODE=%E$DI);
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:5    
      135     8412        %$ERROR (NAME=E_INS_DATAPGS,CODE=%E$FWCG_DATAPGS);
      136     8418
      137     8419        /* Refs */
      138     8420
      139     8421    1   DCL HFF$DSIZ       ENTRY(2) ALTRET;
      140     8422    1   DCL HFF$NILERASE   ENTRY(1) ALTRET;
      141     8423    1   DCL HFF$PTPRES     ENTRY(1) ALTRET;
      142     8424    1   DCL HFF$WRITE1     ENTRY(1) ALTRET;
      143     8425    1   DCL KCA$TELLAUM    ENTRY(3) ALTRET;
      144     8426    1   DCL KQB$SRCH       ENTRY(3) ALTRET;
      145     8427    1   DCL KQD$UNLOCK     ENTRY(2) ALTRET;
      146     8428    1   DCL KQD$GETR       ENTRY(3) ALTRET;
      147     8429    1   DCL KQF$GOTMSG     ENTRY(2) ALTRET;
      148     8430    1   DCL KQL$DELMLH     ENTRY(2) ALTRET;
      149     8431    1   DCL KQL$DFFIND     ENTRY(1) ALTRET;
      150     8432    1   DCL KQL$QFFIND     ENTRY(1) ALTRET;
      151     8433    1   DCL KQL$QXFDUN     ENTRY(1) ALTRET;
      152     8434    1   DCL KQM$GETBR      ENTRY(3) ALTRET;
      153     8435    1   DCL KQP$UNLOCK     ENTRY(1) ALTRET;
      154     8436    1   DCL KQR$FWCGF      ENTRY(1) ALTRET;
      155     8437    1   DCL KQR$GETQUEUE   ENTRY(1) ALTRET;
      156     8438    1   DCL KQT$GETSTA     ENTRY(3) ALTRET;
      157     8439    1   DCL KQU$DELETE     ENTRY(1) ALTRET;
      158     8440    1   DCL KQX$SETTIME    ENTRY(1);
      159     8441    1   DCL SC_CGFWST      ENTRY CONV(2,0);
      160     8442    1   DCL SSR$REG        ENTRY(3) ALTRET;
      161     8443    1   DCL SSR$RUE        ENTRY(4);
      162     8444    1   DCL UDB$PMMEXIT    ENTRY(0);
      163     8445
      164     8446    1   DCL                  B$PS0$ PTR SYMREF READONLY;
      165     8447    1   DCL V_$        REDEF B$PS0$ PTR;
      166     8448    1   DCL                  B$PS1$ PTR SYMREF READONLY;
      167     8449    1   DCL CRITERIA_$ REDEF B$PS1$ PTR;
      168     8450    1   DCL                  B$PS2$ PTR SYMREF READONLY;
      169     8451    1   DCL REATTR_$   REDEF B$PS2$ PTR;
      170     8452    1   DCL                  B$PS3$ PTR SYMREF READONLY;
      171     8453    1   DCL SCA_$      REDEF B$PS3$ PTR;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:6    
      172     8454    1   DCL                  B$PS4$ PTR SYMREF READONLY;
      173     8455    1   DCL SRA_$      REDEF B$PS4$ PTR;
      174     8456    1   DCL                  B$PS5$ PTR SYMREF READONLY;
      175     8457    1   DCL RESULTS_$  REDEF B$PS5$ PTR;
      176     8458    1   DCL                  B$PS6$ PTR SYMREF READONLY;
      177     8459    1   DCL ONEATTR_$  REDEF B$PS6$ PTR;
      178     8460
      179     8461    1   DCL B$JIT$ PTR SYMREF READONLY;
      180     8462    1   DCL S_CUN UBIN SYMREF;
      181     8463
      182     8464        /* %Subs */
      183     8465
      184     8466        %EQU_CG;
      185     8514
      186     8515        %EQU FWCG_NONE=0;
      187     8516        %EQU FWCG_REATTR=1;
      188     8517        %EQU FWCG_DELETE=-1;
      189     8518        %SUB FWCG_SIZC="((4096-SIZEC (KQ$DGRAN)-2*SIZEC (KQ$DBLK))/2)";
      190     8519
      191     8520        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:7    
      192     8521
      193     8522    1         CG$ = MYSTA$->KQ$STA.CG$;
      194     8523
      195     8524        /* Validate V_ just in case it ever changes */
      196     8525
      197     8526    1         CALL READ_ACCESS (V_$,SIZEC(FPT$FWCG_V)) ALTRET (NOACC_V);
      198     8527
      199     8528        /* Set up most of KQ$FWP */
      200     8529
      201     8530    1         KQ$FWP = KQF_IFWP;
      202     8531    1         CALL KQX$SETTIME (KQ$FWP.TIMCHK);
      203     8532    1         KQ$FWP.MYSTA$ = MYSTA$;
      204     8533    1         KQ$FWP.RBLK$ = ADDR (FWCG$RBLK);
      205     8534
      206     8535        /* Setup initial function flags */
      207     8536
      208     8537    1         KQ$FWP.INFORM = FPT$FWCG_V.INFORM;
      209     8538    1         DELETE = FPT$FWCG_V.DELETE;
      210     8539
      211     8540        /* Setup to access RESULTS */
      212     8541
      213     8542    1         CALL HFF$NILERASE (RESULTS_$) ALTRET (NO_RESULTS);
      214     8543    1         CALL WRITE_ACCESS (RESULTS_$,SIZEC(VLR$FWCG)) ALTRET (NOACC_RESULTS);
      215     8544    1         RESULTS = '1'B;
      216     8545    1         VLR$FWCG = '0'B;
      217     8546    2           DO WHILE ('0'B);
      218     8547    2   NO_RESULTS:
      219     8548    2           RESULTS = '0'B;
      220     8549    2           END;
      221     8550
      222     8551        /* Setup to access ONEATTR */
      223     8552
      224     8553    1         CALL HFF$NILERASE (ONEATTR_$) ALTRET (NO_ONEATTR);
      225     8554    1         CALL WRITE_ACCESS (ONEATTR_$,SIZEC(VLP$CGMA)) ALTRET (NOACC_ONEATTR);
      226     8555    1         ONEATTR = '1'B;
      227     8556    1         KQ$FWP.GETFIRST = '1'B;
      228     8557    1         KQ$FWP.ONEATTR_$ = ONEATTR_$;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:8    
      229     8558    2           DO WHILE ('0'B);
      230     8559    2   NO_ONEATTR:
      231     8560    2           ONEATTR = '0'B;
      232     8561    2           END;
      233     8562
      234     8563        /* Setup RBLK to process messages */
      235     8564
      236     8565    1         FWCG$RBLK = KQ_IRBLK;
      237     8566    1         FWCG$RBLK.HONK = '1'B;
      238     8567
      239     8568        /* Initialize REATTR for LATCHED input message case */
      240     8569
      241     8570    1         REATTR = '0'B;
      242     8571
      243     8572        /* Either process CRITERIA or LATCHED input message */
      244     8573
      245     8574    1         CALL HFF$NILERASE (CRITERIA_$) ALTRET (DO_LATCHED);
      246     8575
      247     8576        /* CRITERIA specified */
      248     8577
      249     8578    1         CALL READ_ACCESS (CRITERIA_$,SIZEC(VLP$CGMA)) ALTRET (NOACC_CRITERIA);
      250     8579    1         CALL READ_ACCESS (SCA_$,SIZEC(VLP$SCGMA)) ALTRET (NOACC_SCA);
      251     8580
      252     8581    1         KQ$FWP.CRITERIA_$ = CRITERIA_$;
      253     8582    1         KQ$FWP.EXMPTSTAR = SCA_$->VLP$SCGMA.EXMPTSTAR;
      254     8583    1         IF SCA_$->VLP$SCGMA.MSGID THEN
      255     8584    2           DO;
      256     8585    2           FWCG$RBLK.MID.PRIMARY = CRITERIA_$->VLP$CGMA.MSGID;
      257     8586    2           IF (FWCG$RBLK.MID.PRIMARY ~= 0) AND
      258     8587    2           (SCA_$->VLP$SCGMA.MSGIDXT ~= 0) THEN
      259     8588    3             DO;
      260     8589    3             KQ$FWP.MSGIDXT = SCA_$->VLP$SCGMA.MSGIDXT;
      261     8590    3             IF (NOT KQ$CG.AUCTL.BIGMXT) AND (KQ$FWP.MSGIDXT > 6) THEN
      262     8591    3               GOTO INV_MSGIDXT;
      263     8592    3             END;
      264     8593    2           END;
      265     8594    1         IF SCA_$->VLP$SCGMA.ORIGIN THEN
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:9    
      266     8595    2           DO;
      267     8596    2           CALL INDEX (KEYL,SUBSTR(CRITERIA_$->VLP$CGMA.ORIGIN,,1),KC_LGL1ST) ALTRET (
              8596                    INV_STACHAR);
      268     8597    2           CALL INDEX (KEYL,'?',CRITERIA_$->VLP$CGMA.ORIGIN);
      269     8598    2           FWCG$RBLK.KEY2L = KEYL;
      270     8599    2           CALL INSERT (FWCG$RBLK.KEY2,0,KEYL,CRITERIA_$->VLP$CGMA.ORIGIN);
      271     8600    2           END;
      272     8601    1         IF SCA_$->VLP$SCGMA.MSGTYP THEN
      273     8602    2           DO;
      274     8603    2           IF (SUBSTR(CRITERIA_$->VLP$CGMA.MSGTYP,,1) ~= '*') AND
      275     8604    2           (CRITERIA_$->VLP$CGMA.MSGTYP ~= ' ') THEN
      276     8605    2             CALL INDEX (KEYL,SUBSTR(CRITERIA_$->VLP$CGMA.MSGTYP,,1),KC_LGL1ST) ALTRET
              8605                      (INV_TYPCHAR);
      277     8606    2           CALL INDEX (KEYL,'?',CRITERIA_$->VLP$CGMA.MSGTYP);
      278     8607    2           FWCG$RBLK.KEY1L = KEYL;
      279     8608    2           CALL INSERT (FWCG$RBLK.KEY1,0,KEYL,CRITERIA_$->VLP$CGMA.MSGTYP);
      280     8609    2           END;
      281     8610    1         IF KQ$CG.QISS THEN
      282     8611    2           DO;
      283     8612    2           KEYL = FWCG$RBLK.KEY1L;
      284     8613    2           FWCG$RBLK.KEY1L = FWCG$RBLK.KEY2L;
      285     8614    2           FWCG$RBLK.KEY2L = KEYL;
      286     8615    2           KEYTEMP = FWCG$RBLK.KEY1;
      287     8616    2           FWCG$RBLK.KEY1 = FWCG$RBLK.KEY2;
      288     8617    2           FWCG$RBLK.KEY2 = KEYTEMP;
      289     8618    2           END;
      290     8619
      291     8620    1         DIRECT = '1'B;
      292     8621    1         ANONYMOUS = '1'B;
      293     8622    2           DO CASE (FPT$FWCG_V.QSELECT);
      294     8623    2             CASE (%CG_QSELECT_ALL#);
      295     8624    2             CASE (%CG_QSELECT_DIRECT#);
      296     8625    2               ANONYMOUS = '0'B;
      297     8626    2             CASE (%CG_QSELECT_ANONYMOUS#);
      298     8627    2               DIRECT = '0'B;
      299     8628    2             CASE (ELSE);
      300     8629    2               GOTO INV_QSELECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:10   
      301     8630    2           END;
      302     8631
      303     8632        /* Validate REATTR if DELETE not specified */
      304     8633
      305     8634    1         IF NOT DELETE THEN
      306     8635    2           DO;
      307     8636    2           CALL HFF$NILERASE (REATTR_$) ALTRET (NO_REATTR);
      308     8637    2           CALL READ_ACCESS (REATTR_$,SIZEC(VLP$CGMA)) ALTRET (NOACC_REATTR);
      309     8638    2           CALL READ_ACCESS (SRA_$,SIZEC(VLP$SCGMA)) ALTRET (NOACC_SRA);
      310     8639    2           REATTR = '1'B;
      311     8640    2           KQ$FWP.REATTR_$ = REATTR_$;
      312     8641    2           KQ$FWP.SRA_$ = SRA_$;
      313     8642
      314     8643    2           IF SRA_$->VLP$SCGMA.DEST THEN
      315     8644    2             IF REATTR_$->VLP$CGMA.DEST ~= ' ' THEN
      316     8645    2               CALL INDEX (KEYL,SUBSTR(REATTR_$->VLP$CGMA.DEST,,1),KC_LGL1ST) ALTRET (
              8645                        INV_STACHAR);
      317     8646    2           IF SRA_$->VLP$SCGMA.ORIGIN THEN
      318     8647    2             CALL INDEX (KEYL,SUBSTR(REATTR_$->VLP$CGMA.ORIGIN,,1),KC_LGL1ST) ALTRET (
              8647                      INV_STACHAR);
      319     8648    2           IF SRA_$->VLP$SCGMA.MSGTYP THEN
      320     8649    2             IF REATTR_$->VLP$CGMA.MSGTYP ~= ' ' THEN
      321     8650    2               CALL INDEX (KEYL,SUBSTR(REATTR_$->VLP$CGMA.MSGTYP,,1),KC_LGL1ST) ALTRET
              8650                        (INV_TYPCHAR);
      322     8651
      323     8652        /* Get *FWCG station */
      324     8653
      325     8654    2           STA$ = MYSTA$;
      326     8655                %LOCK (G=KQ$CG.STREE.GATE);
      327     8658    2           CALL KQT$GETSTA (KQ$CG,STA$,KQF_FWCGT) ALTRET (CGFULL0);
      328     8659    2           KQ$FWP.FWCGS$ = STA$;
      329     8660                %LOCK (G=KQ$FWP.FWCGS$->KQ$STA.GATE);
      330     8663    2           KQ$FWP.FWCGS$->KQ$STA.USR# = S_CUN;
      331     8664    2           KQ$FWP.FWCGS$->KQ$STA.AUP = '1'B;
      332     8665    2           KQ$FWP.FWCGS$->KQ$STA.SPECIAL = '1'B;
      333     8666                %UNLOCK (G=KQ$FWP.FWCGS$->KQ$STA.GATE);
      334     8669                %UNLOCK (G=KQ$CG.STREE.GATE);
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:11   
      335     8672    2           END;
      336     8673    1         ELSE
      337     8674    1   NO_REATTR:
      338     8675    1           REATTR = '0'B;
      339     8676
      340     8677        /* A little more validation */
      341     8678
      342     8679    1         IF (REATTR OR DELETE) AND (NOT MYSTA$->KQ$STA.AU) THEN
      343     8680    1           ALTRETURN;
      344     8681
      345     8682    1         IF DELETE THEN
      346     8683    1           KQ$FWP.FC = %FWCG_DELETE;
      347     8684    1         ELSE
      348     8685    1           IF REATTR THEN
      349     8686    1             KQ$FWP.FC = %FWCG_REATTR;
      350     8687    1           ELSE
      351     8688    1             KQ$FWP.FC = %FWCG_NONE;
      352     8689    1         IF KQ$FWP.INFORM OR REATTR OR RESULTS OR ONEATTR OR
      353     8690    1         (DELETE AND KQ$FWP.MSGIDXT ~= 0) THEN
      354     8691    1           KQ$FWP.TELLME = '1'B;
      355     8692    1         IF KQ$FWP.INFORM THEN
      356     8693    1           CALL SETUP_AUEV ALTRET (CGFULL0);
      357     8694
      358     8695        /* Only one M$FWCG allowed per comgroup at a time */
      359     8696
      360     8697              %LOCK (G=KQ$CG.GATE.CG);
      361     8700    1         IF KQ$CG.FWUSR# = 0 THEN
      362     8701    2           DO;
      363     8702    2           KQ$CG.FWUSR# = S_CUN;
      364     8703                %UNLOCK (G=KQ$CG.GATE.CG);
      365     8706    2           END;
      366     8707    1         ELSE
      367     8708    2           DO;
      368     8709    2           IF MYSTA$->KQ$STA.MREQ ~= 0 THEN
      369     8710    2             CALL SC_CGFWST;
      370     8711    2           MYSTA$->KQ$STA.RQLNK$ = ADDR (NIL);
      371     8712    2           IF KQ$CG.FWHD$ = ADDR (NIL) THEN
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:12   
      372     8713    2             KQ$CG.FWHD$ = MYSTA$;
      373     8714    2           ELSE
      374     8715    3             DO;
      375     8716    3             P$ = KQ$CG.FWHD$;
      376     8717    4               DO WHILE (P$->KQ$STA.RQLNK$ ~= ADDR (NIL));
      377     8718    4               P$ = P$->KQ$STA.RQLNK$;
      378     8719    4               END;
      379     8720    3             P$->KQ$STA.RQLNK$ = MYSTA$;
      380     8721    3             END;
      381     8722                %UNLOCK (G=KQ$CG.GATE.CG);
      382     8725    2           CALL SSR$REG (%SS_QA);            /* Doesn't ALTRET!! */
      383     8726
      384     8727    2           IF S_CUN ~= KQ$CG.FWUSR# THEN
      385     8728    2             CALL SC_CGFWST;
      386     8729        /*S* SCREECH_CODE: KQF-S$CGFWST
      387     8730             TYPE:         SCREECH
      388     8731             MESSAGE:      Inconsistency while processing M$FWCG. */
      389     8732
      390     8733    2           END;
      391     8734
      392     8735        /* Make sure the min data cache size is at least 2 pages.
      393     8736        If not, error.  Note that KQD$DBLK won't shrink the
      394     8737        cache below two pages if there's an M$FWCG user running. */
      395     8738
      396     8739    1         IF KQ$CG.MINDATAPGS < 2 THEN
      397     8740    1           IF KQ$FWP.INFORM THEN
      398     8741    2             DO;
      399     8742    2             B$JIT.ERR = E_INS_DATAPGS;
      400     8743        /*E* ERROR:    KQF-E$FWCG_DATAPGS-E
      401     8744             MESSAGE0: Comgroup data cache too small for M$FWCG INFORM.
      402     8745             MESSAGE1: M$FWCG with INFORM requires that the data cache
      403     8746                       in the comgroup have a minimum size of at least
      404     8747                       2.  Your comgroup's cache does not. */
      405     8748    2             CALL CLEANUP;                  /* Ignore ALTRET!! */
      406     8749    2             CALL RELEASE_FWCG;
      407     8750    2             GOTO UDB_EXIT;
      408     8751    2             END;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:13   
      409     8752
      410     8753        /* Ready to rock - drive through the appropriate message queues */
      411     8754
      412     8755    1         KEY$ = ADDR (KEYTEMP);
      413     8756
      414     8757        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:14   
      415     8758
      416     8759        /* Directed queue */
      417     8760
      418     8761    1         IF DIRECT THEN
      419     8762    2           DO;
      420     8763    2           IF SCA_$->VLP$SCGMA.DEST THEN
      421     8764    2             CALL INDEX (KEYL,'?',CRITERIA_$->VLP$CGMA.DEST);
      422     8765    2           ELSE
      423     8766    2             KEYL = 0;
      424     8767    2           KEYBTEMP = '0'B;
      425     8768    2           KEY$TEMP.K = CRITERIA_$->VLP$CGMA.DEST;
      426     8769    2           IF (DELETE) AND
      427     8770    2           (NOT KQ$FWP.INFORM) AND (NOT ONEATTR) AND
      428     8771    2           (FWCG$RBLK.KEY1L = 0) AND (FWCG$RBLK.KEY2L = 0) AND
      429     8772    2           (NOT SCA_$->VLP$SCGMA.EXMPTSTAR) AND
      430     8773    2           (NOT SCA_$->VLP$SCGMA.MSGID OR CRITERIA_$->VLP$CGMA.MSGID = 0) THEN
      431     8774    2             DELETE_ALL_ONLY = '1'B;
      432     8775    2           ELSE
      433     8776    2             DELETE_ALL_ONLY = '0'B;
      434     8777
      435     8778        /* Position to initial station */
      436     8779
      437     8780    2           KEYLAST = KEYTEMP;
      438     8781                %LOCK (G=KQ$CG.STREE.GATE);
      439     8784    2           CALL KQB$SRCH (KQ$CG.STREE,KEYLAST,STA$) ALTRET (DFA0);
      440     8785    3             DO WHILE ('0'B);
      441     8786    3   DFA0:
      442     8787    3             IF STA$ = ADDR (NIL) THEN
      443     8788    3               GOTO DFND;
      444     8789    3             IF (STA$->KQ$STA.BTN.KEY < KEYTEMP) THEN
      445     8790    4               DO;
      446     8791    4               STA$ = STA$->KQ$STA.BTN.FLINK$;
      447     8792    4               IF STA$ = ADDR (NIL) THEN
      448     8793    4                 GOTO DFND;
      449     8794    4               END;
      450     8795    3             END;
      451     8796
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:15   
      452     8797        /* Search thru the directed queue */
      453     8798
      454     8799    3             DO WHILE (ADDR (STA$->KQ$STA.BTN.KEY)->KEY$TEMP = KEY$TEMP);
      455     8800    3             KEYLAST = STA$->KQ$STA.BTN.KEY;
      456     8801    3             IF SUBSTR (KEYLAST,0,1) = '*' THEN
      457     8802    3               GOTO DFC0;
      458     8803    3             IF STA$->KQ$STA.MLH.COUNT ~= 0 THEN
      459     8804    4               DO;
      460     8805                    %LOCK (G=STA$->KQ$STA.GATE);
      461     8808    4               IF DELETE_ALL_ONLY THEN
      462     8809    5                 DO;
      463     8810    5                 KQ$FWP.FOUND = KQ$FWP.FOUND + STA$->KQ$STA.MLH.COUNT;
      464     8811    5                 CALL KQL$DELMLH (KQ$CG,ADDR (STA$->KQ$STA.MLH));
              8811                          /* Doesn't ALTRET!! */
      465     8812                      %UNLOCK (G=STA$->KQ$STA.GATE);
      466     8815    5                 GOTO DFC0;
      467     8816    5                 END;
      468     8817    4               STA$->KQ$STA.LOCKCNT = STA$->KQ$STA.LOCKCNT + 1;
      469     8818                    %UNLOCK (G=KQ$CG.STREE.GATE);
      470     8821    4               KQ$FWP.NODE$ = STA$;
      471     8822    4               CALL KQL$DFFIND (KQ$FWP) ALTRET (CGFULLD);
      472     8823
      473     8824        /* Position back to where we left off */
      474     8825
      475     8826    4               CALL KQP$UNLOCK (STA$->KQ$STA); /* Ignore ALTRET */
      476     8827                    %LOCK (G=KQ$CG.STREE.GATE);
      477     8830    4               CALL KQB$SRCH (KQ$CG.STREE,KEYLAST,STA$) ALTRET (DFA1);
      478     8831    4   DFC0:
      479     8832    4               END;
      480     8833    3             STA$ = STA$->KQ$STA.BTN.FLINK$;
      481     8834    3             IF STA$ = ADDR (NIL) THEN
      482     8835    3               GOTO DFND;
      483     8836    4               DO WHILE ('0'B);
      484     8837    4   DFA1:
      485     8838    4               IF STA$ = ADDR (NIL) THEN
      486     8839    4                 GOTO DFND;
      487     8840    4               IF KEYLAST > STA$->KQ$STA.BTN.KEY THEN
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:16   
      488     8841    4                 GOTO DFC0;
      489     8842    4               END;
      490     8843    3             END;
      491     8844
      492     8845    2   DFND:
      493     8846                %UNLOCK (G=KQ$CG.STREE.GATE);
      494     8849    2           END;
      495     8850
      496     8851        /* Finished searching directed queue */
      497     8852
      498     8853        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:17   
      499     8854
      500     8855        /* Anonymous queue */
      501     8856
      502     8857    1         IF ANONYMOUS THEN
      503     8858    2           DO;
      504     8859    2           KEYL = FWCG$RBLK.KEY1L;
      505     8860    2           KEYTEMP = FWCG$RBLK.KEY1;
      506     8861    2           IF (DELETE) AND
      507     8862    2           (NOT KQ$FWP.INFORM) AND (NOT ONEATTR) AND
      508     8863    2           (FWCG$RBLK.KEY2L = 0) AND
      509     8864    2           (NOT SCA_$->VLP$SCGMA.MSGID OR CRITERIA_$->VLP$CGMA.MSGID = 0) THEN
      510     8865    2             DELETE_ALL_ONLY = '1'B;
      511     8866    2           ELSE
      512     8867    2             DELETE_ALL_ONLY = '0'B;
      513     8868
      514     8869        /* Position to initial origin station/message type */
      515     8870
      516     8871    2           KEYLAST = KEYTEMP;
      517     8872    2           CALL KQR$GETQUEUE (MYSTA$->KQ$STA); /* Doesn't ALTRET!! */
      518     8873    2           CALL KQB$SRCH (KQ$CG.QUEUE.QTREE$->KQ$THDR,KEYLAST,QTN$) ALTRET (QFA0);
      519     8874    3             DO WHILE ('0'B);
      520     8875    3   QFA0:
      521     8876    3             IF QTN$ = ADDR (NIL) THEN
      522     8877    3               GOTO QFND;
      523     8878    3             IF (QTN$->KQ$QTN.STA.BTN.KEY < KEYTEMP) THEN
      524     8879    4               DO;
      525     8880    4               QTN$ = QTN$->KQ$QTN.STA.BTN.FLINK$;
      526     8881    4               IF QTN$ = ADDR (NIL) THEN
      527     8882    4                 GOTO QFND;
      528     8883    4               END;
      529     8884    3             END;
      530     8885
      531     8886        /* Search thru the anonymous queue */
      532     8887
      533     8888    3             DO WHILE (ADDR (QTN$->KQ$QTN.STA.BTN.KEY)->KEY$TEMP = KEY$TEMP);
      534     8889    3             KEYLAST = QTN$->KQ$QTN.STA.BTN.KEY;
      535     8890    3             IF QTN$->KQ$QTN.MLH.COUNT ~= 0 THEN
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:18   
      536     8891    4               DO;
      537     8892    4               IF DELETE_ALL_ONLY THEN
      538     8893    5                 DO;
      539     8894    5                 KQ$FWP.FOUND = KQ$FWP.FOUND + QTN$->KQ$QTN.MLH.COUNT;
      540     8895    5                 CALL KQL$DELMLH (KQ$CG,ADDR (QTN$->KQ$QTN.MLH));
              8895                          /* Doesn't ALTRET!! */
      541     8896    5                 GOTO QFC0;
      542     8897    5                 END;
      543     8898    4               KQ$FWP.NODE$ = QTN$;
      544     8899    4               CALL KQL$QFFIND (KQ$FWP) ALTRET (CGFULLQ);
      545     8900
      546     8901        /* Position back to where we left off */
      547     8902
      548     8903    4               CALL KQB$SRCH (KQ$CG.QUEUE.QTREE$->KQ$THDR,KEYLAST,QTN$) ALTRET (QFA1);
      549     8904    4   QFC0:
      550     8905    4               END;
      551     8906    3             QTN$ = QTN$->KQ$QTN.STA.BTN.FLINK$;
      552     8907    3             IF QTN$ = ADDR (NIL) THEN
      553     8908    3               GOTO QFND;
      554     8909    4               DO WHILE ('0'B);
      555     8910    4   QFA1:
      556     8911    4               IF QTN$ = ADDR (NIL) THEN
      557     8912    4                 GOTO QFND;
      558     8913    4               IF KEYLAST > QTN$->KQ$QTN.STA.BTN.KEY THEN
      559     8914    4                 GOTO QFC0;
      560     8915    4               END;
      561     8916    3             END;
      562     8917
      563     8918    2   QFND:
      564     8919    2           CALL KQL$QXFDUN (MYSTA$->KQ$STA); /* Doesn't ALTRET!! */
      565     8920    2           END;
      566     8921
      567     8922        /* Finished searching anonymous queue */
      568     8923
      569     8924        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:19   
      570     8925
      571     8926        /* Just about done - cleanup */
      572     8927
      573     8928    2           DO WHILE ('0'B);
      574     8929    2   CGFULLD:
      575     8930    2           CALL KQP$UNLOCK (STA$->KQ$STA);  /* Ignore ALTRET!! */
      576     8931    3             DO WHILE ('0'B);
      577     8932    3   CGFULLQ:
      578     8933    3             CALL KQL$QXFDUN (MYSTA$->KQ$STA); /* Doesn't ALTRET!! */
      579     8934    3             END;
      580     8935    2           IF KQ$FWP.DI THEN
      581     8936    2             B$JIT.ERR = E_DI;
      582     8937        /*E* ERROR:    KQF-E$DI-E
      583     8938             MESSAGE0: Data inconsistency building INFORM message. */
      584     8939    2           ELSE
      585     8940    2             B$JIT.ERR = E_CGFULL;
      586     8941    2           END;
      587     8942
      588     8943    1         CALL CLEANUP;                      /* Ignore ALTRET!! */
      589     8944
      590     8945        /* Release M$FWCG access queue */
      591     8946
      592     8947    1         CALL RELEASE_FWCG;
      593     8948
      594     8949    1         RETURN;
      595     8950
      596     8951        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:20   
      597     8952
      598     8953        /* Currently LATCHED input message processing */
      599     8954
      600     8955    1   DO_LATCHED:
      601     8956
      602     8957        /* Lock the station gate and see if there is a currently latched input
      603     8958        message. If so, then check INFORM and ONEATTR flags to see what info
      604     8959        the user wants returned. If no such message exists, then just give the
      605     8960        user an error return. In any case, unlock the station gate. */
      606     8961
      607     8962              %LOCK (G=MYSTA$->KQ$STA.GATE);
      608     8965    1         IF MYSTA$->KQ$STA.RBLK$ = ADDR (NIL) THEN
      609     8966    1           GOTO NOLATCHED0;
      610     8967    1         IF (MYSTA$->KQ$STA.RBLK$->KQ$RBLK.STATE = KQRS_COMP#) AND
      611     8968    1         (MYSTA$->KQ$STA.RBLK$->KQ$RBLK.LATCH = '1'B) AND
      612     8969    1         (MYSTA$->KQ$STA.RBLK$->KQ$RBLK.CS = '1'B) AND
      613     8970    1         (MYSTA$->KQ$STA.RBLK$->KQ$RBLK.MBLK$ ~= ADDR (NIL)) THEN
      614     8971    2           DO;
      615     8972                %UNLOCK (G=MYSTA$->KQ$STA.GATE);
      616     8975    2           IF KQ$FWP.INFORM THEN
      617     8976    2             CALL SETUP_AUEV1 ALTRET (CGFULL0);
      618     8977    2           KQ$FWP.FC = %FWCG_NONE;
      619     8978    2           FWCG$RBLK.MBLK$ = MYSTA$->KQ$STA.RBLK$->KQ$RBLK.MBLK$;
      620     8979    2           CALL KQF$GOTMSG (KQ$FWP,FWCG$RBLK.MBLK$->KQ$MBLK);
              8979                    /* Doesn't ALTRET here!! */
      621     8980    2           CALL CLEANUP;                    /* Ignore ALTRET!! */
      622     8981    2           END;
      623     8982    1         ELSE
      624     8983    2           DO;
      625     8984    2   NOLATCHED0:
      626     8985                %UNLOCK (G=MYSTA$->KQ$STA.GATE);
      627     8988    2           GOTO NOLATCHED;
      628     8989    2           END;
      629     8990
      630     8991    1         RETURN;
      631     8992
      632     8993        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:21   
      633     8994
      634     8995        /*I* NAME:        READ_ACCESS
      635     8996             ENTRY:       READ_ACCESS
      636     8997             CALL:        CALL READ_ACCESS (PARAM$,PSIZE) ALTRET (no access);
      637     8998             INPUT:       PARAM$ - Parameter stack pointer.
      638     8999                          PSIZE - Required size of area framed by PARAM$.
      639     9000             DESCRIPTION: The size of the area framed by the parameter stack
      640     9001                          descriptor described by PARAM$ is obtained and must
      641     9002                          be >= PSIZE. If so, then the page table is checked
      642     9003                          to determine if read access is in effect. RETURNs if
      643     9004                          the access conditions are met, else ALTRETURNs. */
      644     9005
      645     9006    1   READ_ACCESS: PROC (PARAM$,PSIZE) ALTRET;
      646     9007
      647     9008    2   DCL PARAM$ PTR;
      648     9009    2   DCL PSIZE UBIN;
      649     9010    2   DCL ASIZE UBIN;
      650     9011
      651     9012    2         CALL HFF$DSIZ (PARAM$,ASIZE) ALTRET (ARET);
      652     9013    2         IF ASIZE < PSIZE THEN
      653     9014    2           GOTO ARET;
      654     9015    2         CALL HFF$PTPRES (PARAM$) ALTRET (ARET);
      655     9016
      656     9017    2         RETURN;
      657     9018
      658     9019        /*I* NAME:        WRITE_ACCESS
      659     9020             ENTRY:       WRITE_ACCESS
      660     9021             CALL:        CALL WRITE_ACCESS (PARAM$,PSIZE) ALTRET (no access);
      661     9022             DESCRIPTION: Just like READ_ACCESS, except that write access is
      662     9023                          validated. */
      663     9024
      664     9025    2   WRITE_ACCESS: ENTRY (PARAM$,PSIZE) ALTRET;
      665     9026
      666     9027    2         CALL HFF$DSIZ (PARAM$,ASIZE) ALTRET (ARET);
      667     9028    2         IF ASIZE < PSIZE THEN
      668     9029    2           GOTO ARET;
      669     9030    2         CALL HFF$WRITE1 (PARAM$) ALTRET (ARET);
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:22   
      670     9031
      671     9032    2         RETURN;
      672     9033
      673     9034    2   ARET:
      674     9035    2         ALTRETURN;
      675     9036
      676     9037    2   END READ_ACCESS;
      677     9038
      678     9039        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:23   
      679     9040
      680     9041        /*I* NAME:        SETUP_AUEV
      681     9042             ENTRY:       SETUP_AUEV
      682     9043             CALL:        CALL SETUP_AUEV ALTRET (CG is full);
      683     9044             INPUT:       CG$FWP
      684     9045             OUTPUT:      FWCG$RBLK.MBLK$ - Pointer to MBLK;
      685     9046                          KQ$FWP.DBLK$ - Pointer to current DBLK.
      686     9047                          KQ$FWP.DDA - DDA of current DBLK.
      687     9048                          KQ$FWP.NEXTDDA - DDA of next DBLK.
      688     9049                          SAVE_MBLK$ - Original value of MYSTA$->KQ$STA.MBLK$ .
      689     9050             SCRATCH:     KEYL, MBLK$
      690     9051             DESCRIPTION: Sets up to create the *AUEV message that will contain
      691     9052                          the results of the INFORM operation. The message will
      692     9053                          be built with only one DBLK in memory at a time.
      693     9054                          However, the next DBLK will have already been allocated,
      694     9055                          thus minimizing I/O at the expense of obtaining an
      695     9056                          extra DBLK. */
      696     9057
      697     9058    1   SETUP_AUEV: PROC ALTRET;
      698     9059
      699     9060    2   DCL ONLY_ONE BIT(1) ALIGNED;
      700     9061
      701     9062    2         ONLY_ONE = '0'B;
      702     9063    2         GOTO GETMBLK;
      703     9064
      704     9065        /*I* NAME:        SETUP_AUEV1
      705     9066             ENTRY:       SETUP_AUEV1
      706     9067             CALL:        CALL SETUP_AUEV1 ALTRET (CG is full);
      707     9068             DESCRIPTION: Just like SETUP_AUEV, except it is known before hand
      708     9069                          that only one DBLK is required. */
      709     9070
      710     9071    2   SETUP_AUEV1: ENTRY ALTRET;
      711     9072
      712     9073    2         ONLY_ONE = '1'B;
      713     9074
      714     9075        /* Get the MBLK */
      715     9076
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:24   
      716     9077    2   GETMBLK:
      717     9078    2         KEYL = KQMR_MBLK#;
      718     9079    2         MBLK$ = MYSTA$;
      719     9080    2         CALL KQM$GETBR (KQ$CG,MBLK$,KEYL) ALTRET (NO_MBLK);
      720     9081    2         SAVE_MBLK$ = MYSTA$->KQ$STA.MBLK$; /* MUST be restored */
      721     9082    2         MYSTA$->KQ$STA.MBLK$ = MBLK$;
      722     9083
      723     9084        /* Now get the DBLKs */
      724     9085
      725     9086    2         IF ONLY_ONE THEN
      726     9087    2           KQ$FWP.NEXTDDA = 0;
      727     9088    2         ELSE
      728     9089    3           DO;
      729     9090    3           KQ$FWP.NEXTDDA = (FWCG_SIZC/SIZEC (VLP$CGMA))*SIZEC (VLP$CGMA);
      730     9091    3           CALL KQD$GETR (KQ$CG,KQ$FWP.DBLK$,KQ$FWP.NEXTDDA) ALTRET (NO_DBLK0);
      731     9092    3           KQ$FWP.DBLK$->KQ$DBLK.STAMP = MBLK$->KQ$MBLK.STAMP;
      732     9093    3           KQ$FWP.DBLK$->KQ$DBLK.DSIZE = 0;
      733     9094    3           CALL KQD$UNLOCK (KQ$CG,KQ$FWP.DBLK$); /* Doesn't ALTRET!! */
      734     9095    3           END;
      735     9096    2         KQ$FWP.DDA = (FWCG_SIZC/SIZEC (VLP$CGMA))*SIZEC (VLP$CGMA);
      736     9097    2         CALL KQD$GETR (KQ$CG,KQ$FWP.DBLK$,KQ$FWP.DDA) ALTRET (NO_DBLK1);
      737     9098    2         KQ$FWP.DBLK$->KQ$DBLK.STAMP = MBLK$->KQ$MBLK.STAMP;
      738     9099    2         KQ$FWP.DBLK$->KQ$DBLK.DSIZE = 0;
      739     9100    2         MBLK$->KQ$MBLK.DDA = KQ$FWP.DDA;
      740     9101    2         KQ$FWP.DBLK$->KQ$DBLK.FLNKDA = KQ$FWP.NEXTDDA;
      741     9102    2         KQ$FWP.DATA$ = PINCRW (KQ$FWP.DBLK$,SIZEW (KQ$DBLK));
      742     9103    2         KQ$FWP.MAXDATA$ = PINCRC (KQ$FWP.DATA$,(FWCG_SIZC/SIZEC (VLP$CGMA))*SIZEC (
              9103                  VLP$CGMA));
      743     9104
      744     9105    2         RETURN;
      745     9106
      746     9107    2   NO_DBLK1:
      747     9108    2         MBLK$->KQ$MBLK.DDA = KQ$FWP.NEXTDDA;
      748     9109
      749     9110    2   NO_DBLK0:
      750     9111    2         CALL KQU$DELETE (MYSTA$->KQ$STA);  /* Doesn't ALTRET!! */
      751     9112    2         MYSTA$->KQ$STA.MBLK$ = SAVE_MBLK$;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:25   
      752     9113
      753     9114    2   NO_MBLK:
      754     9115    2         ALTRETURN;
      755     9116
      756     9117    2   END SETUP_AUEV;
      757     9118
      758     9119        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:26   
      759     9120
      760     9121        /*I* NAME:        CLEANUP
      761     9122             ENTRY:       CLEANUP
      762     9123             CALL:        CALL CLEANUP ALTRET (CG full);
      763     9124             INPUT:       B$JIT.ERR - Current error code if appropriate.
      764     9125                          SAVE_MBLK$ - Ptr to original KQ$STA.MBLK$ .
      765     9126             OUTPUT:      B$JIT.ERR - Set to E$CGFULL if appropriate and there
      766     9127                                      is no current error code.
      767     9128                          MYSTA$->KQ$STA.MBLK$ - Restored to original value.
      768     9129             DESCRIPTION: Cleans up. Sets number of messages found and MSGID
      769     9130                          of INFORMing *AUEV message in VLR$FWCG. If number
      770     9131                          of messages found = 0 then deletes the *AUEV messsage
      771     9132                          that was being built, else sends it on its way. If
      772     9133                          REATTR was specified then causes all messages with
      773     9134                          changed attributes (on the *FWCG station queue) to
      774     9135                          be put where they belong. Restores MYSTA$->KQ$STA.MBLK$
      775     9136                          from SAVE_MBLK$ iff INFORM was specified. RETURNs
      776     9137                          unless the CG is full, then ALTRETURNs. */
      777     9138
      778     9139    1   CLEANUP: PROC ALTRET;
      779     9140
      780     9141    2   DCL MSGID UBIN;
      781     9142
      782     9143    2         IF RESULTS THEN
      783     9144    2           VLR$FWCG.FOUND = KQ$FWP.FOUND;
      784     9145    2         IF KQ$FWP.DBLK$ ~= ADDR (NIL) THEN
      785     9146    3           DO;
      786     9147    3           CALL KQD$UNLOCK (KQ$CG,KQ$FWP.DBLK$); /* Doesn't ALTRET!! */
      787     9148    3           KQ$FWP.DBLK$ = ADDR (NIL);
      788     9149    3           END;
      789     9150    2         IF KQ$FWP.FOUND ~= 0 THEN
      790     9151    3           DO;
      791     9152    3           IF KQ$FWP.INFORM THEN
      792     9153    4             DO;
      793     9154    4             CALL KCA$TELLAUM (MYSTA$->KQ$STA,%CG_FWCG#,MSGID); /* Doesn't ALTRET!! */
      794     9155    4             IF RESULTS THEN
      795     9156    4               VLR$FWCG.MSGID = MSGID;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:27   
      796     9157    4             MYSTA$->KQ$STA.MBLK$ = SAVE_MBLK$;
      797     9158    4             END;
      798     9159    3           IF REATTR THEN
      799     9160    3             CALL KQR$FWCGF (KQ$FWP.FWCGS$->KQ$STA) ALTRET (CGFULLC);
      800     9161    3           END;
      801     9162    2         ELSE
      802     9163    3           DO;
      803     9164    3           IF B$JIT.ERR = '0'B THEN
      804     9165    3             B$JIT.ERR = E_FWCG_NONE;
      805     9166        /*E* ERROR:    KQF-E$FWCG_NONE-E
      806     9167             MESSAGE0: NO messages with the specified criteria were found. */
      807     9168    3           IF KQ$FWP.INFORM THEN
      808     9169    4             DO;
      809     9170    4             CALL KQU$DELETE (MYSTA$->KQ$STA); /* Doesn't ALTRET!! */
      810     9171    4             MYSTA$->KQ$STA.MBLK$ = SAVE_MBLK$;
      811     9172    4             END;
      812     9173    3           END;
      813     9174
      814     9175    2         RETURN;
      815     9176
      816     9177    2   CGFULLC:
      817     9178    2         IF B$JIT.ERR = '0'B THEN
      818     9179    2           B$JIT.ERR = E_CGFULL;
      819     9180
      820     9181    2         ALTRETURN;
      821     9182
      822     9183    2   END CLEANUP;
      823     9184
      824     9185        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:28   
      825     9186
      826     9187        /*I* NAME:        RELEASE_FWCG
      827     9188             ENTRY:       RELEASE_FWCG
      828     9189             CALL:        CALL RELEASE_FWCG;
      829     9190             INPUT:       KQ$CG with user SQA'ed.
      830     9191             DESCRIPTION: Releases the current user SQA'ed for the M$FWCG queue. */
      831     9192
      832     9193    1   RELEASE_FWCG: PROC;
      833     9194
      834     9195              %LOCK (G=KQ$CG.GATE.CG);
      835     9198    2         KQ$CG.FWUSR# = 0;
      836     9199    2         P$ = KQ$CG.FWHD$;
      837     9200    2         IF P$ ~= ADDR(NIL) THEN
      838     9201    3           DO;
      839     9202    3           KQ$CG.FWHD$ = P$->KQ$STA.RQLNK$;
      840     9203    3           KQ$CG.FWUSR# = P$->KQ$STA.USR#;
      841     9204                %UNLOCK (G=KQ$CG.GATE.CG);
      842     9207    3           CALL SSR$RUE (%SS_UQA,P$->KQ$STA.USR#);
      843     9208    3           END;
      844     9209    2         ELSE
      845     9210    3           DO;
      846     9211                %UNLOCK (G=KQ$CG.GATE.CG);
      847     9214    3           END;
      848     9215
      849     9216    2         RETURN;
      850     9217
      851     9218    2   END RELEASE_FWCG;
      852     9219
      853     9220        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:29   
      854     9221
      855     9222        /* Error processing */
      856     9223
      857     9224    1   NOACC_V:
      858     9225    1         B$JIT.ERR = E_NOACC_V; GOTO UDB_EXIT;
      859     9226        /*E* ERROR:    KQF-E$FWCG_V-E
      860     9227             MESSAGE0: The V_ area of your FPT_FWCG is bad. */
      861     9228
      862     9229    1   NOACC_CRITERIA:
      863     9230    1         B$JIT.ERR = E_NOACC_CRITERIA; GOTO UDB_EXIT;
      864     9231        /*E* ERROR:    KQF-E$FWCG_CRITERIA-E
      865     9232             MESSAGE0: The CRITERIA_ area of your FPT_FWCG is bad. */
      866     9233
      867     9234    1   NOACC_SCA:
      868     9235    1         B$JIT.ERR = E_NOACC_SCA; GOTO UDB_EXIT;
      869     9236        /*E* ERROR:    KQF-E$FWCG_SCA-E
      870     9237             MESSAGE0: The SCA_ area of your FPT_FWCG is bad.
      871     9238             MESSAGE1: You specified CRITERIA which requires a valid SCA_ area. */
      872     9239
      873     9240    1   NOACC_REATTR:
      874     9241    1         B$JIT.ERR = E_NOACC_REATTR; GOTO UDB_EXIT;
      875     9242        /*E* ERROR:    KQF-E$FWCG_REATTR-E
      876     9243             MESSAGE0: The REATTR_ area of your FPT_FWCG is bad. */
      877     9244
      878     9245    1   NOACC_SRA:
      879     9246    1         B$JIT.ERR = E_NOACC_SRA; GOTO UDB_EXIT;
      880     9247        /*E* ERROR:    KQF-E$FWCG_SRA-E
      881     9248             MESSAGE0: The SRA_ area of your FPT_FWCG is bad.
      882     9249             MESSAGE1: You specified REATTR which requires a valid SRA_ area. */
      883     9250
      884     9251    1   NOACC_RESULTS:
      885     9252    1         B$JIT.ERR = E_NOACC_RESULTS; GOTO UDB_EXIT;
      886     9253        /*E* ERROR:    KQF-E$FWCG_RESULTS-E
      887     9254             MESSAGE0: The RESULTS_ area of your FPT_FWCG is bad. */
      888     9255
      889     9256    1   NOACC_ONEATTR:
      890     9257    1         B$JIT.ERR = E_NOACC_ONEATTR; GOTO UDB_EXIT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:30   
      891     9258        /*E* ERROR:    KQF-E$FWCG_ONEATTR-E
      892     9259             MESSAGE0: The ONEATTR_ area of your FPT_FWCG is bad. */
      893     9260
      894     9261    1   INV_QSELECT:
      895     9262    1         B$JIT.ERR = E_INV_QSELECT; GOTO UDB_EXIT;
      896     9263        /*E* ERROR:    KQF-E$FWCG_QSELECT-E
      897     9264             MESSAGE0: The QSELECT parameter of your FPT_FWCG is bad. */
      898     9265
      899     9266    1   INV_STACHAR:
      900     9267    1         B$JIT.ERR = E_INV_STACHAR; GOTO UDB_EXIT;
      901     9268        /*E* ERROR:    KQF-E$STACHAR-E
      902     9269             MESSAGE0: The ORIGIN or DEST station of your VLP_CGMA is invalid. */
      903     9270
      904     9271    1   INV_TYPCHAR:
      905     9272    1         B$JIT.ERR = E_INV_TYPCHAR; GOTO UDB_EXIT;
      906     9273        /*E* ERROR:    KQF-E$TYPCHAR-E
      907     9274             MESSAGE0: The MSGTYP of your VLP_CGMA is invalid. */
      908     9275
      909     9276    1   INV_MSGIDXT:
      910     9277    1         B$JIT.ERR = E_INV_MSGIDXT; GOTO UDB_EXIT;
      911     9278        /*E* ERROR:    KQF-E$FWCG_MSGIDXT-E
      912     9279             MESSAGE0: The MSGIDXT of your VLP_CGMA is invalid. */
      913     9280
      914     9281    1   NOLATCHED:
      915     9282    1         B$JIT.ERR = E_NOLATCHED; GOTO UDB_EXIT;
      916     9283        /*E* ERROR:    KQF-E$FWCG_NOLATCHED-E
      917     9284             MESSAGE0: There is no currently LATCHED input message to M$FWCG.
      918     9285             MESSAGE1: You requested the currently LATCHED input message by
      919     9286                       setting CRITERIA to NIL, and you don't have any such
      920     9287                       message. */
      921     9288
      922     9289    1   CGFULL0:
      923     9290    1         B$JIT.ERR = E_CGFULL; GOTO UDB_EXIT;
      924     9291        /*E* ERROR:    KQF-E$CGFULL-E
      925     9292             MESSAGE0: Your comgroup space is exhausted. */
      926     9293
      927     9294    1   UDB_EXIT:
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:31   
      928     9295    1         CALL UDB$PMMEXIT;
      929     9296
      930     9297    1   END KQF$FWCG;

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:32   
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_ERRORS_C.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KQF$FWCG.

   Procedure KQF$FWCG requires 1208 words for executable code.
   Procedure KQF$FWCG requires 74 words of local(AUTO) storage.

    No errors detected in file KQF$FWCG.:E05TSI    .

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:33   

 Object Unit name= KQF$FWCG                                   File name= KQF$FWCG.:E05TOU
 UTS= JUL 30 '97 01:27:04.48 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     42     52  KQF$FWCG
    1   Proc  even  none  1208   2270  KQF$FWCG
    2  RoData even  none    23     27  KQF$FWCG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KQF$FWCG
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:34   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KQX$SETTIME
 yes     yes           Std       1 HFF$NILERASE
 yes     yes           Std       3 KQT$GETSTA
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 SSR$REG
 yes     yes           Std       1 KQP$UNLOCK
 yes     yes           Std       1 KQL$QFFIND
 yes     yes           Std       2 KQL$DELMLH
 yes     yes           Std       1 KQL$DFFIND
 yes     yes           Std       3 KQB$SRCH
 yes     yes           Std       1 KQL$QXFDUN
         yes           Std       1 HFC$LOCK
 yes     yes           Std       1 KQR$GETQUEUE
         yes           Std       0 UDB$PMMEXIT
 yes     yes           Std       2 KQF$GOTMSG
 yes     yes           Std       2 HFF$DSIZ
 yes     yes           Std       1 HFF$WRITE1
 yes     yes           Std       1 HFF$PTPRES
 yes     yes           Std       3 KQM$GETBR
 yes     yes           Std       3 KQD$GETR
 yes     yes           Std       2 KQD$UNLOCK
 yes     yes           Std       1 KQU$DELETE
 yes     yes           Std       3 KCA$TELLAUM
 yes     yes           Std       1 KQR$FWCGF
         yes           Std       4 SSR$RUE
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:35   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_CGFWST                             KC_LGL1ST                             KQ_IRBLK
r    B$PS0$                           r    B$PS1$                           r    B$PS2$
r    B$PS3$                           r    B$PS4$                           r    B$PS5$
r    B$PS6$                           r    B$JIT$                                S_CUN
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ASLENTSID                             ISSID
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:36   


        1        1        /*M* KQF$FWCG - Comgroup FWCG pmme routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=2
                 7        ,IAD=0,PRB */
        8        8        /*P* NAME:        KQF$FWCG
        9        9             PURPOSE:     This module contains the routines used to implement
       10       10                          the M$FWCG pmme.
       11       11             DESCRIPTION: This module contains various external routines that
       12       12                          implement the M$FWCG pmme. KQF$FWCG is is the high
       13       13                          level routine called by the KCP$PMMES, the CG pmme
       14       14                          distributor. KQF$FWCG calls KQL$xFFIND to read messages
       15       15                          from a particular message queue node. KQL$xFFIND in
       16       16                          turn calls KQF$CHKMSG or KQF$GOTMSG to determine if
       17       17                          additional selection criteria are met, and if so to
       18       18                          add the message to the informational (*AUEV) message,
       19       19                          and/or move the message to the *FWCG station for the
       20       20                          change attributes function. Thus, this module contains
       21       21                          two external compile units - KQF$FWCG and KQF$CHKMSG/
       22       22                          KQF$GOTMSG. */
       23       23        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:37   
       24       24        /*F* NAME:        KQF$FWCG
       25       25             PURPOSE:     This routine is the main driver for the M$FWCG pmme.
       26       26             DESCRIPTION: This routine is called by KCP$PMMES, the main driver
       27       27                          for CG pmmes. See KC_CP6_C for a functional description
       28       28                          of the M$FWCG pmme. */
       29       29        /*D* NAME:        KQF$FWCG
       30       30             ENTRY:       KQF$FWCG
       31       31             CALL:        CALL KQF$FWCG (MYSTA$) ALTRET (AURD not sufficient);
       32       32             INPUT:       MYSTA$ - Pointer to station node for user of M$FWCG.
       33       33             OUTPUT:      See KC_CP6_C.
       34       34             SCRATCH:     Local AUTO (TSTACK).
       35       35             DESCRIPTION: Due to the complicated way this pmme is implemented,
       36       36                          the general rule of not checking parameters (and
       37       37                          subsequently trapping if they are bad) is violated,
       38       38                          i.e., the parameters are validated using the appropriate
       39       39                          HFF$? routines. Since only one instance of this pmme per
       40       40                          CG is allowed at a time, the user will be queued for
       41       41                          access if there is currently another M$FWCG user for
       42       42                          the same CG. */
       43       43
       44       44        KQF$FWCG: PROC (MYSTA$) ALTRET;

     44  1 000000   000000 700200 xent  KQF$FWCG     TSX0  ! X66_AUTO_1
         1 000001   000112 000001                    ZERO    74,1

       45       45
       46       46        /* Includes */
       47       47
       48       48        %INCLUDE B$JIT;
       49      651        %INCLUDE F_ERRORS_C;
       50      891        %INCLUDE HF_LOCK_C;
       51      905        %INCLUDE KC$CP6V_C;
       52     1025        %INCLUDE KC_CP6;
       53     1585        %INCLUDE KC_DATA_R;
       54     1598        %INCLUDE KC_ERRORS_C;
       55     1645        %INCLUDE KQ_MAC_C;
       56     4195        %INCLUDE KQ_DATA_R;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:38   
       57     5027        %INCLUDE KQ_ERRORS_C;
       58     5075        %INCLUDE KQ_SUBS_C;
       59     5375        %INCLUDE SS_SCHED_C;
       60     5608        %INCLUDE UD_SEV_C;
       61     5622
       62     5623        /* Parameters */
       63     5624
       64     5625    1   DCL MYSTA$ PTR;
       65     5626
       66     5627        /* Macros */
       67     5628
       68     5629        %MACRO $ERROR (NAME=GORGO,CODE=0,SEV=SEV_ERROR#);
       69     5630        DCL 1 NAME CONSTANT ALIGNED,
       70     5631              2 * BIT(18) UNAL INIT('132106'O), /* 'KQF' */
       71     5632              2 * UBIN(15) UNAL INIT(CODE),
       72     5633              2 * UBIN(3) UNAL INIT(SEV);
       73     5634        %MEND;
       74     5635
       75     5636        /* Based */
       76     5637
       77     5638    1   DCL 1 KEY$TEMP BASED (KEY$) ALIGNED,
       78     5639    1         2 K CHAR (KEYL);
       79     5640        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CG$)");
       80     6379        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS="BASED");
       81     6432        %KQ_DGRAN (FPTN=KQ$DGRAN,STCLASS="BASED");
       82     6579        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED");
       83     6849        %KQ_QTN (FPTN=KQ$QTN,STCLASS="BASED");
       84     7322        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS="BASED");
       85     7508        %KQ_STA (FPTN=KQ$STA,STCLASS="BASED");
       86     7847        %KQ_THDR (FPTN=KQ$THDR,STCLASS="BASED");
       87     7885        %FPT$FWCG_V (FPTN=FPT$FWCG_V,BASED="BASED(V_$)");
       88     7889        %VLP$CGMA_V (FPTN=VLP$CGMA,BASED="BASED");
       89     7901        %VLP$SCGMA_V (FPTN=VLP$SCGMA,BASED="BASED");
       90     7905        %VLR$FWCG_V (FPTN=VLR$FWCG,BASED="BASED(RESULTS_$)");
       91     7908
       92     7909        /* Auto */
       93     7910
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:39   
       94     7911    1   DCL ANONYMOUS BIT(1) ALIGNED;
       95     7912    1   DCL CG$ PTR;
       96     7913    1   DCL DELETE BIT(1) ALIGNED;
       97     7914    1   DCL DELETE_ALL_ONLY BIT(1) ALIGNED;
       98     7915    1   DCL DIRECT BIT(1) ALIGNED;
       99     7916        %KQ_RBLK (FPTN=FWCG$RBLK,STCLASS=" ");
      100     8102    1   DCL KEYL UBIN;
      101     8103    1   DCL KEYLAST CHAR(8);
      102     8104    1   DCL KEYTEMP CHAR(8);
      103     8105    1   DCL KEYBTEMP REDEF KEYTEMP BIT(72);
      104     8106    1   DCL KEY$ PTR;
      105     8107        %KQ_FWP (FPTN=KQ$FWP,STCLASS=" ");
      106     8208    1   DCL MBLK$ PTR;
      107     8209    1   DCL ONEATTR BIT(1) ALIGNED;
      108     8210    1   DCL P$ PTR;
      109     8211    1   DCL QTN$ PTR;
      110     8212    1   DCL REATTR BIT(1) ALIGNED;
      111     8213    1   DCL RESULTS BIT(1) ALIGNED;
      112     8214    1   DCL SAVE_MBLK$ PTR;
      113     8215    1   DCL STA$ PTR;
      114     8216
      115     8217        /* Constant */
      116     8218
      117     8219        %KQ_FWP (FPTN=KQF_IFWP,STCLASS=CONSTANT);
      118     8320    1   DCL KQF_FWCGT CHAR(8) CONSTANT INIT ('*FWCG');
      119     8321
      120     8322        %$ERROR (NAME=E_NOACC_V,CODE=%E$FWCG_V);
      121     8328        %$ERROR (NAME=E_NOACC_CRITERIA,CODE=%E$FWCG_CRITERIA);
      122     8334        %$ERROR (NAME=E_NOACC_SCA,CODE=%E$FWCG_SCA);
      123     8340        %$ERROR (NAME=E_NOACC_REATTR,CODE=%E$FWCG_REATTR);
      124     8346        %$ERROR (NAME=E_NOACC_SRA,CODE=%E$FWCG_SRA);
      125     8352        %$ERROR (NAME=E_NOACC_RESULTS,CODE=%E$FWCG_RESULTS);
      126     8358        %$ERROR (NAME=E_NOACC_ONEATTR,CODE=%E$FWCG_ONEATTR);
      127     8364        %$ERROR (NAME=E_INV_QSELECT,CODE=%E$FWCG_QSELECT);
      128     8370        %$ERROR (NAME=E_NOLATCHED,CODE=%E$FWCG_NOLATCHED);
      129     8376        %$ERROR (NAME=E_INV_STACHAR,CODE=%E$STACHAR);
      130     8382        %$ERROR (NAME=E_INV_TYPCHAR,CODE=%E$TYPCHAR);
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:40   
      131     8388        %$ERROR (NAME=E_INV_MSGIDXT,CODE=%E$FWCG_MSGIDXT);
      132     8394        %$ERROR (NAME=E_CGFULL,CODE=%E$CGFULL);
      133     8400        %$ERROR (NAME=E_FWCG_NONE,CODE=%E$FWCG_NONE);
      134     8406        %$ERROR (NAME=E_DI,CODE=%E$DI);
      135     8412        %$ERROR (NAME=E_INS_DATAPGS,CODE=%E$FWCG_DATAPGS);
      136     8418
      137     8419        /* Refs */
      138     8420
      139     8421    1   DCL HFF$DSIZ       ENTRY(2) ALTRET;
      140     8422    1   DCL HFF$NILERASE   ENTRY(1) ALTRET;
      141     8423    1   DCL HFF$PTPRES     ENTRY(1) ALTRET;
      142     8424    1   DCL HFF$WRITE1     ENTRY(1) ALTRET;
      143     8425    1   DCL KCA$TELLAUM    ENTRY(3) ALTRET;
      144     8426    1   DCL KQB$SRCH       ENTRY(3) ALTRET;
      145     8427    1   DCL KQD$UNLOCK     ENTRY(2) ALTRET;
      146     8428    1   DCL KQD$GETR       ENTRY(3) ALTRET;
      147     8429    1   DCL KQF$GOTMSG     ENTRY(2) ALTRET;
      148     8430    1   DCL KQL$DELMLH     ENTRY(2) ALTRET;
      149     8431    1   DCL KQL$DFFIND     ENTRY(1) ALTRET;
      150     8432    1   DCL KQL$QFFIND     ENTRY(1) ALTRET;
      151     8433    1   DCL KQL$QXFDUN     ENTRY(1) ALTRET;
      152     8434    1   DCL KQM$GETBR      ENTRY(3) ALTRET;
      153     8435    1   DCL KQP$UNLOCK     ENTRY(1) ALTRET;
      154     8436    1   DCL KQR$FWCGF      ENTRY(1) ALTRET;
      155     8437    1   DCL KQR$GETQUEUE   ENTRY(1) ALTRET;
      156     8438    1   DCL KQT$GETSTA     ENTRY(3) ALTRET;
      157     8439    1   DCL KQU$DELETE     ENTRY(1) ALTRET;
      158     8440    1   DCL KQX$SETTIME    ENTRY(1);
      159     8441    1   DCL SC_CGFWST      ENTRY CONV(2,0);
      160     8442    1   DCL SSR$REG        ENTRY(3) ALTRET;
      161     8443    1   DCL SSR$RUE        ENTRY(4);
      162     8444    1   DCL UDB$PMMEXIT    ENTRY(0);
      163     8445
      164     8446    1   DCL                  B$PS0$ PTR SYMREF READONLY;
      165     8447    1   DCL V_$        REDEF B$PS0$ PTR;
      166     8448    1   DCL                  B$PS1$ PTR SYMREF READONLY;
      167     8449    1   DCL CRITERIA_$ REDEF B$PS1$ PTR;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:41   
      168     8450    1   DCL                  B$PS2$ PTR SYMREF READONLY;
      169     8451    1   DCL REATTR_$   REDEF B$PS2$ PTR;
      170     8452    1   DCL                  B$PS3$ PTR SYMREF READONLY;
      171     8453    1   DCL SCA_$      REDEF B$PS3$ PTR;
      172     8454    1   DCL                  B$PS4$ PTR SYMREF READONLY;
      173     8455    1   DCL SRA_$      REDEF B$PS4$ PTR;
      174     8456    1   DCL                  B$PS5$ PTR SYMREF READONLY;
      175     8457    1   DCL RESULTS_$  REDEF B$PS5$ PTR;
      176     8458    1   DCL                  B$PS6$ PTR SYMREF READONLY;
      177     8459    1   DCL ONEATTR_$  REDEF B$PS6$ PTR;
      178     8460
      179     8461    1   DCL B$JIT$ PTR SYMREF READONLY;
      180     8462    1   DCL S_CUN UBIN SYMREF;
      181     8463
      182     8464        /* %Subs */
      183     8465
      184     8466        %EQU_CG;
      185     8514
      186     8515        %EQU FWCG_NONE=0;
      187     8516        %EQU FWCG_REATTR=1;
      188     8517        %EQU FWCG_DELETE=-1;
      189     8518        %SUB FWCG_SIZC="((4096-SIZEC (KQ$DGRAN)-2*SIZEC (KQ$DBLK))/2)";
      190     8519
      191     8520        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:42   
      192     8521
      193     8522    1         CG$ = MYSTA$->KQ$STA.CG$;

   8522  1 000002   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 000003   000000 471500                    LDP1    0,,PR0
         1 000004   100007 236100                    LDQ     7,,PR1
         1 000005   200005 756100                    STQ     CG$,,AUTO

      194     8523
      195     8524        /* Validate V_ just in case it ever changes */
      196     8525
      197     8526    1         CALL READ_ACCESS (V_$,SIZEC(FPT$FWCG_V)) ALTRET (NOACC_V);

   8526  1 000006   000001 236000 2                  LDQ     1
         1 000007   200104 756100                    STQ     MSGID+1,,AUTO
         1 000010   000002 236000 2                  LDQ     2
         1 000011   200103 756100                    STQ     STA$+2,,AUTO
         1 000012   001562 701000 1                  TSX1    READ_ACCESS
         1 000013   002200 702000 1                  TSX2    NOACC_V

      198     8527
      199     8528        /* Set up most of KQ$FWP */
      200     8529
      201     8530    1         KQ$FWP = KQF_IFWP;

   8530  1 000014   000100 100400                    MLR     fill='000'O
         1 000015   000000 000134 0                  ADSC9   KQF_IFWP                 cn=0,n=92
         1 000016   200042 000134                    ADSC9   KQ$FWP,,AUTO             cn=0,n=92

      202     8531    1         CALL KQX$SETTIME (KQ$FWP.TIMCHK);

   8531  1 000017   200042 630500                    EPPR0   KQ$FWP,,AUTO
         1 000020   200106 450500                    STP0    ASIZE+1,,AUTO
         1 000021   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 000022   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000023   000000 701000 xent               TSX1    KQX$SETTIME
         1 000024   000000 011000                    NOP     0
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:43   

      203     8532    1         KQ$FWP.MYSTA$ = MYSTA$;

   8532  1 000025   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 000026   000000 236100                    LDQ     0,,PR0
         1 000027   200044 756100                    STQ     KQ$FWP+2,,AUTO

      204     8533    1         KQ$FWP.RBLK$ = ADDR (FWCG$RBLK);

   8533  1 000030   200012 631500                    EPPR1   FWCG$RBLK,,AUTO
         1 000031   200046 451500                    STP1    KQ$FWP+4,,AUTO

      205     8534
      206     8535        /* Setup initial function flags */
      207     8536
      208     8537    1         KQ$FWP.INFORM = FPT$FWCG_V.INFORM;

   8537  1 000032   000000 473400 xsym               LDP3    B$PS0$
         1 000033   300001 236100                    LDQ     1,,PR3
         1 000034   000040 772000                    QRL     32
         1 000035   200051 676100                    ERQ     KQ$FWP+7,,AUTO
         1 000036   000004 376007                    ANQ     4,DL
         1 000037   200051 656100                    ERSQ    KQ$FWP+7,,AUTO

      209     8538    1         DELETE = FPT$FWCG_V.DELETE;

   8538  1 000040   300001 236100                    LDQ     1,,PR3
         1 000041   400000 376003                    ANQ     -131072,DU
         1 000042   200006 756100                    STQ     DELETE,,AUTO

      210     8539
      211     8540        /* Setup to access RESULTS */
      212     8541
      213     8542    1         CALL HFF$NILERASE (RESULTS_$) ALTRET (NO_RESULTS);

   8542  1 000043   000003 630400 2                  EPPR0   3
         1 000044   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:44   
         1 000045   000000 701000 xent               TSX1    HFF$NILERASE
         1 000046   000064 702000 1                  TSX2    NO_RESULTS

      214     8543    1         CALL WRITE_ACCESS (RESULTS_$,SIZEC(VLR$FWCG)) ALTRET (NOACC_RESULTS);

   8543  1 000047   000005 236000 2                  LDQ     5
         1 000050   200104 756100                    STQ     MSGID+1,,AUTO
         1 000051   000003 236000 2                  LDQ     3
         1 000052   200103 756100                    STQ     STA$+2,,AUTO
         1 000053   001605 701000 1                  TSX1    WRITE_ACCESS
         1 000054   002224 702000 1                  TSX2    NOACC_RESULTS

      215     8544    1         RESULTS = '1'B;

   8544  1 000055   400000 236003                    LDQ     -131072,DU
         1 000056   200077 756100                    STQ     RESULTS,,AUTO

      216     8545    1         VLR$FWCG = '0'B;

   8545  1 000057   000000 470400 xsym               LDP0    B$PS5$
         1 000060   000100 100400                    MLR     fill='000'O
         1 000061   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000062   000000 000050                    ADSC9   0,,PR0                   cn=0,n=40

      217     8546    2           DO WHILE ('0'B);

   8546  1 000063   000065 710000 1                  TRA     s:8553

      218     8547    2   NO_RESULTS:
      219     8548    2           RESULTS = '0'B;

   8548  1 000064   200077 450100       NO_RESULTS   STZ     RESULTS,,AUTO

      220     8549    2           END;

      221     8550
      222     8551        /* Setup to access ONEATTR */
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:45   
      223     8552
      224     8553    1         CALL HFF$NILERASE (ONEATTR_$) ALTRET (NO_ONEATTR);

   8553  1 000065   000006 630400 2                  EPPR0   6
         1 000066   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000067   000000 701000 xent               TSX1    HFF$NILERASE
         1 000070   000106 702000 1                  TSX2    NO_ONEATTR

      225     8554    1         CALL WRITE_ACCESS (ONEATTR_$,SIZEC(VLP$CGMA)) ALTRET (NOACC_ONEATTR);

   8554  1 000071   000010 236000 2                  LDQ     8
         1 000072   200104 756100                    STQ     MSGID+1,,AUTO
         1 000073   000006 236000 2                  LDQ     6
         1 000074   200103 756100                    STQ     STA$+2,,AUTO
         1 000075   001605 701000 1                  TSX1    WRITE_ACCESS
         1 000076   002230 702000 1                  TSX2    NOACC_ONEATTR

      226     8555    1         ONEATTR = '1'B;

   8555  1 000077   400000 236003                    LDQ     -131072,DU
         1 000100   200073 756100                    STQ     ONEATTR,,AUTO

      227     8556    1         KQ$FWP.GETFIRST = '1'B;

   8556  1 000101   000010 236007                    LDQ     8,DL
         1 000102   200051 256100                    ORSQ    KQ$FWP+7,,AUTO

      228     8557    1         KQ$FWP.ONEATTR_$ = ONEATTR_$;

   8557  1 000103   000000 236000 xsym               LDQ     B$PS6$
         1 000104   200064 756100                    STQ     KQ$FWP+18,,AUTO

      229     8558    2           DO WHILE ('0'B);

   8558  1 000105   000107 710000 1                  TRA     s:8565

      230     8559    2   NO_ONEATTR:
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:46   
      231     8560    2           ONEATTR = '0'B;

   8560  1 000106   200073 450100       NO_ONEATTR   STZ     ONEATTR,,AUTO

      232     8561    2           END;

      233     8562
      234     8563        /* Setup RBLK to process messages */
      235     8564
      236     8565    1         FWCG$RBLK = KQ_IRBLK;

   8565  1 000107   000100 100400                    MLR     fill='000'O
         1 000110   000000 000110 xsym               ADSC9   KQ_IRBLK                 cn=0,n=72
         1 000111   200012 000110                    ADSC9   FWCG$RBLK,,AUTO          cn=0,n=72

      237     8566    1         FWCG$RBLK.HONK = '1'B;

   8566  1 000112   000400 236007                    LDQ     256,DL
         1 000113   200013 256100                    ORSQ    FWCG$RBLK+1,,AUTO

      238     8567
      239     8568        /* Initialize REATTR for LATCHED input message case */
      240     8569
      241     8570    1         REATTR = '0'B;

   8570  1 000114   200076 450100                    STZ     REATTR,,AUTO

      242     8571
      243     8572        /* Either process CRITERIA or LATCHED input message */
      244     8573
      245     8574    1         CALL HFF$NILERASE (CRITERIA_$) ALTRET (DO_LATCHED);

   8574  1 000115   000011 630400 2                  EPPR0   9
         1 000116   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000117   000000 701000 xent               TSX1    HFF$NILERASE
         1 000120   001466 702000 1                  TSX2    DO_LATCHED

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:47   
      246     8575
      247     8576        /* CRITERIA specified */
      248     8577
      249     8578    1         CALL READ_ACCESS (CRITERIA_$,SIZEC(VLP$CGMA)) ALTRET (NOACC_CRITERIA);

   8578  1 000121   000010 236000 2                  LDQ     8
         1 000122   200104 756100                    STQ     MSGID+1,,AUTO
         1 000123   000011 236000 2                  LDQ     9
         1 000124   200103 756100                    STQ     STA$+2,,AUTO
         1 000125   001562 701000 1                  TSX1    READ_ACCESS
         1 000126   002204 702000 1                  TSX2    NOACC_CRITERIA

      250     8579    1         CALL READ_ACCESS (SCA_$,SIZEC(VLP$SCGMA)) ALTRET (NOACC_SCA);

   8579  1 000127   000012 236000 2                  LDQ     10
         1 000130   200104 756100                    STQ     MSGID+1,,AUTO
         1 000131   000013 236000 2                  LDQ     11
         1 000132   200103 756100                    STQ     STA$+2,,AUTO
         1 000133   001562 701000 1                  TSX1    READ_ACCESS
         1 000134   002210 702000 1                  TSX2    NOACC_SCA

      251     8580
      252     8581    1         KQ$FWP.CRITERIA_$ = CRITERIA_$;

   8581  1 000135   000000 236000 xsym               LDQ     B$PS1$
         1 000136   200063 756100                    STQ     KQ$FWP+17,,AUTO

      253     8582    1         KQ$FWP.EXMPTSTAR = SCA_$->VLP$SCGMA.EXMPTSTAR;

   8582  1 000137   000000 470400 xsym               LDP0    B$PS3$
         1 000140   000000 236100                    LDQ     0,,PR0
         1 000141   000015 772000                    QRL     13
         1 000142   200051 676100                    ERQ     KQ$FWP+7,,AUTO
         1 000143   000020 376007                    ANQ     16,DL
         1 000144   200051 656100                    ERSQ    KQ$FWP+7,,AUTO

      254     8583    1         IF SCA_$->VLP$SCGMA.MSGID THEN
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:48   

   8583  1 000145   000000 236100                    LDQ     0,,PR0
         1 000146   010000 316003                    CANQ    4096,DU
         1 000147   000172 600000 1                  TZE     s:8594

      255     8584    2           DO;

      256     8585    2           FWCG$RBLK.MID.PRIMARY = CRITERIA_$->VLP$CGMA.MSGID;

   8585  1 000150   000000 471400 xsym               LDP1    B$PS1$
         1 000151   100014 235100                    LDA     12,,PR1
         1 000152   200020 755100                    STA     FWCG$RBLK+6,,AUTO

      257     8586    2           IF (FWCG$RBLK.MID.PRIMARY ~= 0) AND

   8586  1 000153   000172 600000 1                  TZE     s:8594
         1 000154   000000 236100                    LDQ     0,,PR0
         1 000155   000777 316003                    CANQ    511,DU
         1 000156   000172 600000 1                  TZE     s:8594

      258     8587    2           (SCA_$->VLP$SCGMA.MSGIDXT ~= 0) THEN
      259     8588    3             DO;

      260     8589    3             KQ$FWP.MSGIDXT = SCA_$->VLP$SCGMA.MSGIDXT;

   8589  1 000157   000000 236100                    LDQ     0,,PR0
         1 000160   000022 772000                    QRL     18
         1 000161   000777 376007                    ANQ     511,DL
         1 000162   200053 756100                    STQ     KQ$FWP+9,,AUTO

      261     8590    3             IF (NOT KQ$CG.AUCTL.BIGMXT) AND (KQ$FWP.MSGIDXT > 6) THEN

   8590  1 000163   200005 473500                    LDP3    CG$,,AUTO
         1 000164   300136 236100                    LDQ     94,,PR3
         1 000165   010000 316003                    CANQ    4096,DU
         1 000166   000172 601000 1                  TNZ     s:8594
         1 000167   200053 235100                    LDA     KQ$FWP+9,,AUTO
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:49   
         1 000170   000007 115007                    CMPA    7,DL
         1 000171   002250 603000 1                  TRC     INV_MSGIDXT

      262     8591    3               GOTO INV_MSGIDXT;
      263     8592    3             END;

      264     8593    2           END;

      265     8594    1         IF SCA_$->VLP$SCGMA.ORIGIN THEN

   8594  1 000172   000000 236100                    LDQ     0,,PR0
         1 000173   200000 316003                    CANQ    65536,DU
         1 000174   000217 600000 1                  TZE     s:8601

      266     8595    2           DO;

      267     8596    2           CALL INDEX (KEYL,SUBSTR(CRITERIA_$->VLP$CGMA.ORIGIN,,1),KC_LGL1ST) ALTRET (
              8596                    INV_STACHAR);

   8596  1 000175   000000 471400 xsym               LDP1    B$PS1$
         1 000176   000100 124400                    SCM     mask='000'O
         1 000177   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 000200   100004 000001                    ADSC9   4,,PR1                   cn=0,n=1
         1 000201   200034 000100                    ARG     KEYL,,AUTO
         1 000202   002240 606400 1                  TTN     INV_STACHAR

      268     8597    2           CALL INDEX (KEYL,'?',CRITERIA_$->VLP$CGMA.ORIGIN);

   8597  1 000203   000000 124500                    SCM     mask='000'O
         1 000204   100004 000010                    ADSC9   4,,PR1                   cn=0,n=8
         1 000205   000014 000001 2                  ADSC9   12                       cn=0,n=1
         1 000206   200034 000100                    ARG     KEYL,,AUTO

      269     8598    2           FWCG$RBLK.KEY2L = KEYL;

   8598  1 000207   200034 236100                    LDQ     KEYL,,AUTO
         1 000210   200013 676100                    ERQ     FWCG$RBLK+1,,AUTO
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:50   
         1 000211   000017 376007                    ANQ     15,DL
         1 000212   200013 656100                    ERSQ    FWCG$RBLK+1,,AUTO

      270     8599    2           CALL INSERT (FWCG$RBLK.KEY2,0,KEYL,CRITERIA_$->VLP$CGMA.ORIGIN);

   8599  1 000213   200034 720100                    LXL0    KEYL,,AUTO
         1 000214   040140 100500                    MLR     fill='040'O
         1 000215   100004 000010                    ADSC9   4,,PR1                   cn=0,n=8
         1 000216   200016 000010                    ADSC9   FWCG$RBLK+4,,AUTO        cn=0,n=*X0

      271     8600    2           END;

      272     8601    1         IF SCA_$->VLP$SCGMA.MSGTYP THEN

   8601  1 000217   000000 234100                    SZN     0,,PR0
         1 000220   000254 605000 1                  TPL     s:8610

      273     8602    2           DO;

      274     8603    2           IF (SUBSTR(CRITERIA_$->VLP$CGMA.MSGTYP,,1) ~= '*') AND

   8603  1 000221   000000 471400 xsym               LDP1    B$PS1$
         1 000222   100002 236100                    LDQ     2,,PR1
         1 000223   777000 376003                    ANQ     -512,DU
         1 000224   052000 116003                    CMPQ    21504,DU
         1 000225   000237 600000 1                  TZE     s:8606
         1 000226   040000 106500                    CMPC    fill='040'O
         1 000227   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         1 000230   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000231   000237 600000 1                  TZE     s:8606

      275     8604    2           (CRITERIA_$->VLP$CGMA.MSGTYP ~= ' ') THEN
      276     8605    2             CALL INDEX (KEYL,SUBSTR(CRITERIA_$->VLP$CGMA.MSGTYP,,1),KC_LGL1ST) ALTRET
              8605                      (INV_TYPCHAR);

   8605  1 000232   000100 124400                    SCM     mask='000'O
         1 000233   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:51   
         1 000234   100002 000001                    ADSC9   2,,PR1                   cn=0,n=1
         1 000235   200034 000100                    ARG     KEYL,,AUTO
         1 000236   002244 606400 1                  TTN     INV_TYPCHAR

      277     8606    2           CALL INDEX (KEYL,'?',CRITERIA_$->VLP$CGMA.MSGTYP);

   8606  1 000237   000000 124500                    SCM     mask='000'O
         1 000240   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         1 000241   000014 000001 2                  ADSC9   12                       cn=0,n=1
         1 000242   200034 000100                    ARG     KEYL,,AUTO

      278     8607    2           FWCG$RBLK.KEY1L = KEYL;

   8607  1 000243   200034 236100                    LDQ     KEYL,,AUTO
         1 000244   000004 736000                    QLS     4
         1 000245   200013 676100                    ERQ     FWCG$RBLK+1,,AUTO
         1 000246   000360 376007                    ANQ     240,DL
         1 000247   200013 656100                    ERSQ    FWCG$RBLK+1,,AUTO

      279     8608    2           CALL INSERT (FWCG$RBLK.KEY1,0,KEYL,CRITERIA_$->VLP$CGMA.MSGTYP);

   8608  1 000250   200034 720100                    LXL0    KEYL,,AUTO
         1 000251   040140 100500                    MLR     fill='040'O
         1 000252   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         1 000253   200014 000010                    ADSC9   FWCG$RBLK+2,,AUTO        cn=0,n=*X0

      280     8609    2           END;

      281     8610    1         IF KQ$CG.QISS THEN

   8610  1 000254   200005 471500                    LDP1    CG$,,AUTO
         1 000255   100106 235100                    LDA     70,,PR1
         1 000256   000304 600000 1                  TZE     s:8620

      282     8611    2           DO;

      283     8612    2           KEYL = FWCG$RBLK.KEY1L;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:52   

   8612  1 000257   200013 236100                    LDQ     FWCG$RBLK+1,,AUTO
         1 000260   000004 772000                    QRL     4
         1 000261   000017 376007                    ANQ     15,DL
         1 000262   200034 756100                    STQ     KEYL,,AUTO

      284     8613    2           FWCG$RBLK.KEY1L = FWCG$RBLK.KEY2L;

   8613  1 000263   200013 236100                    LDQ     FWCG$RBLK+1,,AUTO
         1 000264   000004 736000                    QLS     4
         1 000265   200013 676100                    ERQ     FWCG$RBLK+1,,AUTO
         1 000266   000360 376007                    ANQ     240,DL
         1 000267   200013 656100                    ERSQ    FWCG$RBLK+1,,AUTO

      285     8614    2           FWCG$RBLK.KEY2L = KEYL;

   8614  1 000270   200034 236100                    LDQ     KEYL,,AUTO
         1 000271   200013 676100                    ERQ     FWCG$RBLK+1,,AUTO
         1 000272   000017 376007                    ANQ     15,DL
         1 000273   200013 656100                    ERSQ    FWCG$RBLK+1,,AUTO

      286     8615    2           KEYTEMP = FWCG$RBLK.KEY1;

   8615  1 000274   200014 237100                    LDAQ    FWCG$RBLK+2,,AUTO
         1 000275   200037 755100                    STA     KEYTEMP,,AUTO
         1 000276   200040 756100                    STQ     KEYTEMP+1,,AUTO

      287     8616    2           FWCG$RBLK.KEY1 = FWCG$RBLK.KEY2;

   8616  1 000277   200016 237100                    LDAQ    FWCG$RBLK+4,,AUTO
         1 000300   200014 757100                    STAQ    FWCG$RBLK+2,,AUTO

      288     8617    2           FWCG$RBLK.KEY2 = KEYTEMP;

   8617  1 000301   040100 100500                    MLR     fill='040'O
         1 000302   200037 000010                    ADSC9   KEYTEMP,,AUTO            cn=0,n=8
         1 000303   200016 000010                    ADSC9   FWCG$RBLK+4,,AUTO        cn=0,n=8
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:53   

      289     8618    2           END;

      290     8619
      291     8620    1         DIRECT = '1'B;

   8620  1 000304   400000 236003                    LDQ     -131072,DU
         1 000305   200010 756100                    STQ     DIRECT,,AUTO

      292     8621    1         ANONYMOUS = '1'B;

   8621  1 000306   200004 756100                    STQ     ANONYMOUS,,AUTO

      293     8622    2           DO CASE (FPT$FWCG_V.QSELECT);

   8622  1 000307   000000 473400 xsym               LDP3    B$PS0$
         1 000310   300001 236100                    LDQ     1,,PR3
         1 000311   000037 772000                    QRL     31
         1 000312   000007 376007                    ANQ     7,DL
         1 000313   000004 116007                    CMPQ    4,DL
         1 000314   000316 602006 1                  TNC     s:8622+7,QL
         1 000315   000326 710000 1                  TRA     s:8629
         1 000316   000326 710000 1                  TRA     s:8629
         1 000317   000327 710000 1                  TRA     s:8634
         1 000320   000322 710000 1                  TRA     s:8625
         1 000321   000324 710000 1                  TRA     s:8627

      294     8623    2             CASE (%CG_QSELECT_ALL#);

      295     8624    2             CASE (%CG_QSELECT_DIRECT#);

      296     8625    2               ANONYMOUS = '0'B;

   8625  1 000322   200004 450100                    STZ     ANONYMOUS,,AUTO
         1 000323   000327 710000 1                  TRA     s:8634

      297     8626    2             CASE (%CG_QSELECT_ANONYMOUS#);
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:54   

      298     8627    2               DIRECT = '0'B;

   8627  1 000324   200010 450100                    STZ     DIRECT,,AUTO
         1 000325   000327 710000 1                  TRA     s:8634

      299     8628    2             CASE (ELSE);

      300     8629    2               GOTO INV_QSELECT;

   8629  1 000326   002234 710000 1                  TRA     INV_QSELECT

      301     8630    2           END;

      302     8631
      303     8632        /* Validate REATTR if DELETE not specified */
      304     8633
      305     8634    1         IF NOT DELETE THEN

   8634  1 000327   200006 234100                    SZN     DELETE,,AUTO
         1 000330   000507 604000 1                  TMI     NO_REATTR

      306     8635    2           DO;

      307     8636    2           CALL HFF$NILERASE (REATTR_$) ALTRET (NO_REATTR);

   8636  1 000331   000015 630400 2                  EPPR0   13
         1 000332   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000333   000000 701000 xent               TSX1    HFF$NILERASE
         1 000334   000507 702000 1                  TSX2    NO_REATTR

      308     8637    2           CALL READ_ACCESS (REATTR_$,SIZEC(VLP$CGMA)) ALTRET (NOACC_REATTR);

   8637  1 000335   000010 236000 2                  LDQ     8
         1 000336   200104 756100                    STQ     MSGID+1,,AUTO
         1 000337   000015 236000 2                  LDQ     13
         1 000340   200103 756100                    STQ     STA$+2,,AUTO
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:55   
         1 000341   001562 701000 1                  TSX1    READ_ACCESS
         1 000342   002214 702000 1                  TSX2    NOACC_REATTR

      309     8638    2           CALL READ_ACCESS (SRA_$,SIZEC(VLP$SCGMA)) ALTRET (NOACC_SRA);

   8638  1 000343   000012 236000 2                  LDQ     10
         1 000344   200104 756100                    STQ     MSGID+1,,AUTO
         1 000345   000016 236000 2                  LDQ     14
         1 000346   200103 756100                    STQ     STA$+2,,AUTO
         1 000347   001562 701000 1                  TSX1    READ_ACCESS
         1 000350   002220 702000 1                  TSX2    NOACC_SRA

      310     8639    2           REATTR = '1'B;

   8639  1 000351   400000 236003                    LDQ     -131072,DU
         1 000352   200076 756100                    STQ     REATTR,,AUTO

      311     8640    2           KQ$FWP.REATTR_$ = REATTR_$;

   8640  1 000353   000000 236000 xsym               LDQ     B$PS2$
         1 000354   200062 756100                    STQ     KQ$FWP+16,,AUTO

      312     8641    2           KQ$FWP.SRA_$ = SRA_$;

   8641  1 000355   000000 236000 xsym               LDQ     B$PS4$
         1 000356   200061 756100                    STQ     KQ$FWP+15,,AUTO

      313     8642
      314     8643    2           IF SRA_$->VLP$SCGMA.DEST THEN

   8643  1 000357   000000 470400 xsym               LDP0    B$PS4$
         1 000360   000000 236100                    LDQ     0,,PR0
         1 000361   100000 316003                    CANQ    32768,DU
         1 000362   000375 600000 1                  TZE     s:8646

      315     8644    2             IF REATTR_$->VLP$CGMA.DEST ~= ' ' THEN

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:56   
   8644  1 000363   000000 471400 xsym               LDP1    B$PS2$
         1 000364   040000 106500                    CMPC    fill='040'O
         1 000365   100011 000010                    ADSC9   9,,PR1                   cn=0,n=8
         1 000366   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000367   000375 600000 1                  TZE     s:8646

      316     8645    2               CALL INDEX (KEYL,SUBSTR(REATTR_$->VLP$CGMA.DEST,,1),KC_LGL1ST) ALTRET (
              8645                        INV_STACHAR);

   8645  1 000370   000100 124400                    SCM     mask='000'O
         1 000371   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 000372   100011 000001                    ADSC9   9,,PR1                   cn=0,n=1
         1 000373   200034 000100                    ARG     KEYL,,AUTO
         1 000374   002240 606400 1                  TTN     INV_STACHAR

      317     8646    2           IF SRA_$->VLP$SCGMA.ORIGIN THEN

   8646  1 000375   000000 236100                    LDQ     0,,PR0
         1 000376   200000 316003                    CANQ    65536,DU
         1 000377   000406 600000 1                  TZE     s:8648

      318     8647    2             CALL INDEX (KEYL,SUBSTR(REATTR_$->VLP$CGMA.ORIGIN,,1),KC_LGL1ST) ALTRET (
              8647                      INV_STACHAR);

   8647  1 000400   000000 471400 xsym               LDP1    B$PS2$
         1 000401   000100 124400                    SCM     mask='000'O
         1 000402   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 000403   100004 000001                    ADSC9   4,,PR1                   cn=0,n=1
         1 000404   200034 000100                    ARG     KEYL,,AUTO
         1 000405   002240 606400 1                  TTN     INV_STACHAR

      319     8648    2           IF SRA_$->VLP$SCGMA.MSGTYP THEN

   8648  1 000406   000000 234100                    SZN     0,,PR0
         1 000407   000422 605000 1                  TPL     s:8654

      320     8649    2             IF REATTR_$->VLP$CGMA.MSGTYP ~= ' ' THEN
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:57   

   8649  1 000410   000000 471400 xsym               LDP1    B$PS2$
         1 000411   040000 106500                    CMPC    fill='040'O
         1 000412   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         1 000413   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000414   000422 600000 1                  TZE     s:8654

      321     8650    2               CALL INDEX (KEYL,SUBSTR(REATTR_$->VLP$CGMA.MSGTYP,,1),KC_LGL1ST) ALTRET
              8650                        (INV_TYPCHAR);

   8650  1 000415   000100 124400                    SCM     mask='000'O
         1 000416   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 000417   100002 000001                    ADSC9   2,,PR1                   cn=0,n=1
         1 000420   200034 000100                    ARG     KEYL,,AUTO
         1 000421   002244 606400 1                  TTN     INV_TYPCHAR

      322     8651
      323     8652        /* Get *FWCG station */
      324     8653
      325     8654    2           STA$ = MYSTA$;

   8654  1 000422   200003 471500                    LDP1    @MYSTA$,,AUTO
         1 000423   100000 236100                    LDQ     0,,PR1
         1 000424   200101 756100                    STQ     STA$,,AUTO

      326     8655                %LOCK (G=KQ$CG.STREE.GATE);

   8656  1 000425   200005 236100                    LDQ     CG$,,AUTO
         1 000426   000075 036003                    ADLQ    61,DU
         1 000427   200106 756100                    STQ     ASIZE+1,,AUTO
         1 000430   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 000431   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000432   000000 701000 xent               TSX1    HFC$LOCK
         1 000433   000000 011000                    NOP     0

      327     8658    2           CALL KQT$GETSTA (KQ$CG,STA$,KQF_FWCGT) ALTRET (CGFULL0);

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:58   
   8658  1 000434   000017 236000 2                  LDQ     15
         1 000435   200110 756100                    STQ     ASIZE+3,,AUTO
         1 000436   200101 630500                    EPPR0   STA$,,AUTO
         1 000437   200107 450500                    STP0    ASIZE+2,,AUTO
         1 000440   200005 236100                    LDQ     CG$,,AUTO
         1 000441   200106 756100                    STQ     ASIZE+1,,AUTO
         1 000442   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 000443   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000444   000000 701000 xent               TSX1    KQT$GETSTA
         1 000445   002260 702000 1                  TSX2    CGFULL0

      328     8659    2           KQ$FWP.FWCGS$ = STA$;

   8659  1 000446   200101 236100                    LDQ     STA$,,AUTO
         1 000447   200047 756100                    STQ     KQ$FWP+5,,AUTO

      329     8660                %LOCK (G=KQ$FWP.FWCGS$->KQ$STA.GATE);

   8661  1 000450   000016 036003                    ADLQ    14,DU
         1 000451   200106 756100                    STQ     ASIZE+1,,AUTO
         1 000452   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 000453   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000454   000000 701000 xent               TSX1    HFC$LOCK
         1 000455   000000 011000                    NOP     0

      330     8663    2           KQ$FWP.FWCGS$->KQ$STA.USR# = S_CUN;

   8663  1 000456   200047 470500                    LDP0    KQ$FWP+5,,AUTO
         1 000457   000000 236000 xsym               LDQ     S_CUN
         1 000460   000011 736000                    QLS     9
         1 000461   000020 552110                    STBQ    16,'10'O,PR0

      331     8664    2           KQ$FWP.FWCGS$->KQ$STA.AUP = '1'B;

   8664  1 000462   200047 470500                    LDP0    KQ$FWP+5,,AUTO
         1 000463   400000 236007                    LDQ     -131072,DL
         1 000464   000023 256100                    ORSQ    19,,PR0
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:59   

      332     8665    2           KQ$FWP.FWCGS$->KQ$STA.SPECIAL = '1'B;

   8665  1 000465   200047 470500                    LDP0    KQ$FWP+5,,AUTO
         1 000466   200000 236007                    LDQ     65536,DL
         1 000467   000023 256100                    ORSQ    19,,PR0

      333     8666                %UNLOCK (G=KQ$FWP.FWCGS$->KQ$STA.GATE);

   8667  1 000470   200047 236100                    LDQ     KQ$FWP+5,,AUTO
         1 000471   000016 036003                    ADLQ    14,DU
         1 000472   200106 756100                    STQ     ASIZE+1,,AUTO
         1 000473   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 000474   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000475   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000476   000000 011000                    NOP     0

      334     8669                %UNLOCK (G=KQ$CG.STREE.GATE);

   8670  1 000477   200005 236100                    LDQ     CG$,,AUTO
         1 000500   000075 036003                    ADLQ    61,DU
         1 000501   200106 756100                    STQ     ASIZE+1,,AUTO
         1 000502   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 000503   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000504   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000505   000000 011000                    NOP     0

      335     8672    2           END;

   8672  1 000506   000510 710000 1                  TRA     s:8679

      336     8673    1         ELSE
      337     8674    1   NO_REATTR:
      338     8675    1           REATTR = '0'B;

   8675  1 000507   200076 450100       NO_REATTR    STZ     REATTR,,AUTO

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:60   
      339     8676
      340     8677        /* A little more validation */
      341     8678
      342     8679    1         IF (REATTR OR DELETE) AND (NOT MYSTA$->KQ$STA.AU) THEN

   8679  1 000510   200076 234100                    SZN     REATTR,,AUTO
         1 000511   000514 604000 1                  TMI     s:8679+4
         1 000512   200006 234100                    SZN     DELETE,,AUTO
         1 000513   000522 605000 1                  TPL     s:8682
         1 000514   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 000515   000000 471500                    LDP1    0,,PR0
         1 000516   100020 236100                    LDQ     16,,PR1
         1 000517   200000 316003                    CANQ    65536,DU
         1 000520   000522 601000 1                  TNZ     s:8682

      343     8680    1           ALTRETURN;

   8680  1 000521   000000 702200 xent               TSX2  ! X66_AALT

      344     8681
      345     8682    1         IF DELETE THEN

   8682  1 000522   200006 234100                    SZN     DELETE,,AUTO
         1 000523   000527 605000 1                  TPL     s:8685

      346     8683    1           KQ$FWP.FC = %FWCG_DELETE;

   8683  1 000524   000001 335007                    LCA     1,DL
         1 000525   200050 755100                    STA     KQ$FWP+6,,AUTO
         1 000526   000535 710000 1                  TRA     s:8689

      347     8684    1         ELSE
      348     8685    1           IF REATTR THEN

   8685  1 000527   200076 234100                    SZN     REATTR,,AUTO
         1 000530   000534 605000 1                  TPL     s:8688

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:61   
      349     8686    1             KQ$FWP.FC = %FWCG_REATTR;

   8686  1 000531   000001 235007                    LDA     1,DL
         1 000532   200050 755100                    STA     KQ$FWP+6,,AUTO
         1 000533   000535 710000 1                  TRA     s:8689

      350     8687    1           ELSE
      351     8688    1             KQ$FWP.FC = %FWCG_NONE;

   8688  1 000534   200050 450100                    STZ     KQ$FWP+6,,AUTO

      352     8689    1         IF KQ$FWP.INFORM OR REATTR OR RESULTS OR ONEATTR OR

   8689  1 000535   200051 236100                    LDQ     KQ$FWP+7,,AUTO
         1 000536   000004 316007                    CANQ    4,DL
         1 000537   000552 601000 1                  TNZ     s:8691
         1 000540   200076 234100                    SZN     REATTR,,AUTO
         1 000541   000552 604000 1                  TMI     s:8691
         1 000542   200077 234100                    SZN     RESULTS,,AUTO
         1 000543   000552 604000 1                  TMI     s:8691
         1 000544   200073 234100                    SZN     ONEATTR,,AUTO
         1 000545   000552 604000 1                  TMI     s:8691
         1 000546   200006 234100                    SZN     DELETE,,AUTO
         1 000547   000554 605000 1                  TPL     s:8692
         1 000550   200053 235100                    LDA     KQ$FWP+9,,AUTO
         1 000551   000554 600000 1                  TZE     s:8692

      353     8690    1         (DELETE AND KQ$FWP.MSGIDXT ~= 0) THEN
      354     8691    1           KQ$FWP.TELLME = '1'B;

   8691  1 000552   400000 236003                    LDQ     -131072,DU
         1 000553   200051 256100                    ORSQ    KQ$FWP+7,,AUTO

      355     8692    1         IF KQ$FWP.INFORM THEN

   8692  1 000554   200051 236100                    LDQ     KQ$FWP+7,,AUTO
         1 000555   000004 316007                    CANQ    4,DL
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:62   
         1 000556   000561 600000 1                  TZE     s:8698

      356     8693    1           CALL SETUP_AUEV ALTRET (CGFULL0);

   8693  1 000557   001632 701000 1                  TSX1    SETUP_AUEV
         1 000560   002260 702000 1                  TSX2    CGFULL0

      357     8694
      358     8695        /* Only one M$FWCG allowed per comgroup at a time */
      359     8696
      360     8697              %LOCK (G=KQ$CG.GATE.CG);

   8698  1 000561   200005 236100                    LDQ     CG$,,AUTO
         1 000562   000107 036003                    ADLQ    71,DU
         1 000563   200106 756100                    STQ     ASIZE+1,,AUTO
         1 000564   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 000565   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000566   000000 701000 xent               TSX1    HFC$LOCK
         1 000567   000000 011000                    NOP     0

      361     8700    1         IF KQ$CG.FWUSR# = 0 THEN

   8700  1 000570   200005 470500                    LDP0    CG$,,AUTO
         1 000571   000122 236100                    LDQ     82,,PR0
         1 000572   777000 316007                    CANQ    -512,DL
         1 000573   000607 601000 1                  TNZ     s:8709

      362     8701    2           DO;

      363     8702    2           KQ$CG.FWUSR# = S_CUN;

   8702  1 000574   000000 236000 xsym               LDQ     S_CUN
         1 000575   000011 736000                    QLS     9
         1 000576   000122 552110                    STBQ    82,'10'O,PR0

      364     8703                %UNLOCK (G=KQ$CG.GATE.CG);

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:63   
   8704  1 000577   200005 236100                    LDQ     CG$,,AUTO
         1 000600   000107 036003                    ADLQ    71,DU
         1 000601   200106 756100                    STQ     ASIZE+1,,AUTO
         1 000602   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 000603   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000604   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000605   000000 011000                    NOP     0

      365     8706    2           END;

   8706  1 000606   000670 710000 1                  TRA     s:8739

      366     8707    1         ELSE
      367     8708    2           DO;

      368     8709    2           IF MYSTA$->KQ$STA.MREQ ~= 0 THEN

   8709  1 000607   200003 471500                    LDP1    @MYSTA$,,AUTO
         1 000610   100000 473500                    LDP3    0,,PR1
         1 000611   300020 236100                    LDQ     16,,PR3
         1 000612   000777 316003                    CANQ    511,DU
         1 000613   000616 600000 1                  TZE     s:8711

      369     8710    2             CALL SC_CGFWST;

   8710  1 000614   000000 713400 xsym               CLIMB   SC_CGFWST
         1 000615   000000 600000 xsid               climb   nvectors=         0

      370     8711    2           MYSTA$->KQ$STA.RQLNK$ = ADDR (NIL);

   8711  1 000616   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 000617   000000 471500                    LDP1    0,,PR0
         1 000620   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000621   100030 756100                    STQ     24,,PR1

      371     8712    2           IF KQ$CG.FWHD$ = ADDR (NIL) THEN

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:64   
   8712  1 000622   200005 471500                    LDP1    CG$,,AUTO
         1 000623   100123 236100                    LDQ     83,,PR1
         1 000624   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000625   000631 601000 1                  TNZ     s:8716

      372     8713    2             KQ$CG.FWHD$ = MYSTA$;

   8713  1 000626   000000 236100                    LDQ     0,,PR0
         1 000627   100123 756100                    STQ     83,,PR1
         1 000630   000645 710000 1                  TRA     s:8723

      373     8714    2           ELSE
      374     8715    3             DO;

      375     8716    3             P$ = KQ$CG.FWHD$;

   8716  1 000631   200074 756100                    STQ     P$,,AUTO

      376     8717    4               DO WHILE (P$->KQ$STA.RQLNK$ ~= ADDR (NIL));

   8717  1 000632   000636 710000 1                  TRA     s:8719

      377     8718    4               P$ = P$->KQ$STA.RQLNK$;

   8718  1 000633   200074 470500                    LDP0    P$,,AUTO
         1 000634   000030 236100                    LDQ     24,,PR0
         1 000635   200074 756100                    STQ     P$,,AUTO

      378     8719    4               END;

   8719  1 000636   200074 470500                    LDP0    P$,,AUTO
         1 000637   000030 236100                    LDQ     24,,PR0
         1 000640   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000641   000633 601000 1                  TNZ     s:8718

      379     8720    3             P$->KQ$STA.RQLNK$ = MYSTA$;

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:65   
   8720  1 000642   200003 471500                    LDP1    @MYSTA$,,AUTO
         1 000643   100000 236100                    LDQ     0,,PR1
         1 000644   000030 756100                    STQ     24,,PR0

      380     8721    3             END;

      381     8722                %UNLOCK (G=KQ$CG.GATE.CG);

   8723  1 000645   200005 236100                    LDQ     CG$,,AUTO
         1 000646   000107 036003                    ADLQ    71,DU
         1 000647   200106 756100                    STQ     ASIZE+1,,AUTO
         1 000650   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 000651   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000652   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000653   000000 011000                    NOP     0

      382     8725    2           CALL SSR$REG (%SS_QA);            /* Doesn't ALTRET!! */

   8725  1 000654   000021 630400 2                  EPPR0   17
         1 000655   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000656   000000 701000 xent               TSX1    SSR$REG
         1 000657   000000 011000                    NOP     0

      383     8726
      384     8727    2           IF S_CUN ~= KQ$CG.FWUSR# THEN

   8727  1 000660   200005 470500                    LDP0    CG$,,AUTO
         1 000661   000122 236100                    LDQ     82,,PR0
         1 000662   000011 772000                    QRL     9
         1 000663   000777 376007                    ANQ     511,DL
         1 000664   000000 116000 xsym               CMPQ    S_CUN
         1 000665   000670 600000 1                  TZE     s:8739

      385     8728    2             CALL SC_CGFWST;

   8728  1 000666   000000 713400 xsym               CLIMB   SC_CGFWST
         1 000667   000000 600000 xsid               climb   nvectors=         0
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:66   

      386     8729        /*S* SCREECH_CODE: KQF-S$CGFWST
      387     8730             TYPE:         SCREECH
      388     8731             MESSAGE:      Inconsistency while processing M$FWCG. */
      389     8732
      390     8733    2           END;

      391     8734
      392     8735        /* Make sure the min data cache size is at least 2 pages.
      393     8736        If not, error.  Note that KQD$DBLK won't shrink the
      394     8737        cache below two pages if there's an M$FWCG user running. */
      395     8738
      396     8739    1         IF KQ$CG.MINDATAPGS < 2 THEN

   8739  1 000670   200005 470500                    LDP0    CG$,,AUTO
         1 000671   000242 220100                    LDX0    162,,PR0
         1 000672   000002 100003                    CMPX0   2,DU
         1 000673   000707 603000 1                  TRC     s:8755

      397     8740    1           IF KQ$FWP.INFORM THEN

   8740  1 000674   200051 236100                    LDQ     KQ$FWP+7,,AUTO
         1 000675   000004 316007                    CANQ    4,DL
         1 000676   000707 600000 1                  TZE     s:8755

      398     8741    2             DO;

      399     8742    2             B$JIT.ERR = E_INS_DATAPGS;

   8742  1 000677   000051 236000 0                  LDQ     E_INS_DATAPGS
         1 000700   000000 471400 xsym               LDP1    B$JIT$
         1 000701   100012 756100                    STQ     10,,PR1

      400     8743        /*E* ERROR:    KQF-E$FWCG_DATAPGS-E
      401     8744             MESSAGE0: Comgroup data cache too small for M$FWCG INFORM.
      402     8745             MESSAGE1: M$FWCG with INFORM requires that the data cache
      403     8746                       in the comgroup have a minimum size of at least
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:67   
      404     8747                       2.  Your comgroup's cache does not. */
      405     8748    2             CALL CLEANUP;                  /* Ignore ALTRET!! */

   8748  1 000702   002004 701000 1                  TSX1    CLEANUP
         1 000703   000000 011000                    NOP     0

      406     8749    2             CALL RELEASE_FWCG;

   8749  1 000704   002123 701000 1                  TSX1    RELEASE_FWCG
         1 000705   000000 011000                    NOP     0

      407     8750    2             GOTO UDB_EXIT;

   8750  1 000706   002264 710000 1                  TRA     UDB_EXIT

      408     8751    2             END;
      409     8752
      410     8753        /* Ready to rock - drive through the appropriate message queues */
      411     8754
      412     8755    1         KEY$ = ADDR (KEYTEMP);

   8755  1 000707   200037 631500                    EPPR1   KEYTEMP,,AUTO
         1 000710   200041 451500                    STP1    KEY$,,AUTO

      413     8756
      414     8757        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:68   
      415     8758
      416     8759        /* Directed queue */
      417     8760
      418     8761    1         IF DIRECT THEN

   8761  1 000711   200010 234100                    SZN     DIRECT,,AUTO
         1 000712   001215 605000 1                  TPL     s:8857

      419     8762    2           DO;

      420     8763    2           IF SCA_$->VLP$SCGMA.DEST THEN

   8763  1 000713   000000 473400 xsym               LDP3    B$PS3$
         1 000714   300000 236100                    LDQ     0,,PR3
         1 000715   100000 316003                    CANQ    32768,DU
         1 000716   000725 600000 1                  TZE     s:8766

      421     8764    2             CALL INDEX (KEYL,'?',CRITERIA_$->VLP$CGMA.DEST);

   8764  1 000717   000000 474400 xsym               LDP4    B$PS1$
         1 000720   000000 124500                    SCM     mask='000'O
         1 000721   400011 000010                    ADSC9   9,,PR4                   cn=0,n=8
         1 000722   000014 000001 2                  ADSC9   12                       cn=0,n=1
         1 000723   200034 000100                    ARG     KEYL,,AUTO
         1 000724   000726 710000 1                  TRA     s:8767

      422     8765    2           ELSE
      423     8766    2             KEYL = 0;

   8766  1 000725   200034 450100                    STZ     KEYL,,AUTO

      424     8767    2           KEYBTEMP = '0'B;

   8767  1 000726   200037 450100                    STZ     KEYTEMP,,AUTO
         1 000727   200040 450100                    STZ     KEYTEMP+1,,AUTO

      425     8768    2           KEY$TEMP.K = CRITERIA_$->VLP$CGMA.DEST;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:69   

   8768  1 000730   000000 471400 xsym               LDP1    B$PS1$
         1 000731   200041 474500                    LDP4    KEY$,,AUTO
         1 000732   200034 721100                    LXL1    KEYL,,AUTO
         1 000733   040140 100500                    MLR     fill='040'O
         1 000734   100011 000010                    ADSC9   9,,PR1                   cn=0,n=8
         1 000735   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1

      426     8769    2           IF (DELETE) AND

   8769  1 000736   200006 234100                    SZN     DELETE,,AUTO
         1 000737   000764 605000 1                  TPL     s:8776
         1 000740   200051 236100                    LDQ     KQ$FWP+7,,AUTO
         1 000741   000004 316007                    CANQ    4,DL
         1 000742   000764 601000 1                  TNZ     s:8776
         1 000743   200073 234100                    SZN     ONEATTR,,AUTO
         1 000744   000764 604000 1                  TMI     s:8776
         1 000745   200013 236100                    LDQ     FWCG$RBLK+1,,AUTO
         1 000746   000360 316007                    CANQ    240,DL
         1 000747   000764 601000 1                  TNZ     s:8776
         1 000750   000017 316007                    CANQ    15,DL
         1 000751   000764 601000 1                  TNZ     s:8776
         1 000752   300000 236100                    LDQ     0,,PR3
         1 000753   400000 316007                    CANQ    -131072,DL
         1 000754   000764 601000 1                  TNZ     s:8776
         1 000755   010000 316003                    CANQ    4096,DU
         1 000756   000761 600000 1                  TZE     s:8774
         1 000757   100014 235100                    LDA     12,,PR1
         1 000760   000764 601000 1                  TNZ     s:8776

      427     8770    2           (NOT KQ$FWP.INFORM) AND (NOT ONEATTR) AND
      428     8771    2           (FWCG$RBLK.KEY1L = 0) AND (FWCG$RBLK.KEY2L = 0) AND
      429     8772    2           (NOT SCA_$->VLP$SCGMA.EXMPTSTAR) AND
      430     8773    2           (NOT SCA_$->VLP$SCGMA.MSGID OR CRITERIA_$->VLP$CGMA.MSGID = 0) THEN
      431     8774    2             DELETE_ALL_ONLY = '1'B;

   8774  1 000761   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:70   
         1 000762   200007 756100                    STQ     DELETE_ALL_ONLY,,AUTO
         1 000763   000765 710000 1                  TRA     s:8780

      432     8775    2           ELSE
      433     8776    2             DELETE_ALL_ONLY = '0'B;

   8776  1 000764   200007 450100                    STZ     DELETE_ALL_ONLY,,AUTO

      434     8777
      435     8778        /* Position to initial station */
      436     8779
      437     8780    2           KEYLAST = KEYTEMP;

   8780  1 000765   040100 100500                    MLR     fill='040'O
         1 000766   200037 000010                    ADSC9   KEYTEMP,,AUTO            cn=0,n=8
         1 000767   200035 000010                    ADSC9   KEYLAST,,AUTO            cn=0,n=8

      438     8781                %LOCK (G=KQ$CG.STREE.GATE);

   8782  1 000770   200005 236100                    LDQ     CG$,,AUTO
         1 000771   000075 036003                    ADLQ    61,DU
         1 000772   200106 756100                    STQ     ASIZE+1,,AUTO
         1 000773   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 000774   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000775   000000 701000 xent               TSX1    HFC$LOCK
         1 000776   000000 011000                    NOP     0

      439     8784    2           CALL KQB$SRCH (KQ$CG.STREE,KEYLAST,STA$) ALTRET (DFA0);

   8784  1 000777   200101 630500                    EPPR0   STA$,,AUTO
         1 001000   200110 450500                    STP0    ASIZE+3,,AUTO
         1 001001   200035 631500                    EPPR1   KEYLAST,,AUTO
         1 001002   200107 451500                    STP1    ASIZE+2,,AUTO
         1 001003   200005 236100                    LDQ     CG$,,AUTO
         1 001004   000075 036003                    ADLQ    61,DU
         1 001005   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001006   200106 630500                    EPPR0   ASIZE+1,,AUTO
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:71   
         1 001007   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001010   000000 701000 xent               TSX1    KQB$SRCH
         1 001011   001013 702000 1                  TSX2    DFA0

      440     8785    3             DO WHILE ('0'B);

   8785  1 001012   001027 710000 1                  TRA     s:8799

      441     8786    3   DFA0:
      442     8787    3             IF STA$ = ADDR (NIL) THEN

   8787  1 001013   200101 236100       DFA0         LDQ     STA$,,AUTO
         1 001014   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001015   001206 600000 1                  TZE     DFND

      443     8788    3               GOTO DFND;
      444     8789    3             IF (STA$->KQ$STA.BTN.KEY < KEYTEMP) THEN

   8789  1 001016   200101 470500                    LDP0    STA$,,AUTO
         1 001017   040100 106500                    CMPC    fill='040'O
         1 001020   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 001021   200037 000010                    ADSC9   KEYTEMP,,AUTO            cn=0,n=8
         1 001022   001027 603000 1                  TRC     s:8799

      445     8790    4               DO;

      446     8791    4               STA$ = STA$->KQ$STA.BTN.FLINK$;

   8791  1 001023   000004 236100                    LDQ     4,,PR0
         1 001024   200101 756100                    STQ     STA$,,AUTO

      447     8792    4               IF STA$ = ADDR (NIL) THEN

   8792  1 001025   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001026   001206 600000 1                  TZE     DFND

      448     8793    4                 GOTO DFND;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:72   
      449     8794    4               END;

      450     8795    3             END;

      451     8796
      452     8797        /* Search thru the directed queue */
      453     8798
      454     8799    3             DO WHILE (ADDR (STA$->KQ$STA.BTN.KEY)->KEY$TEMP = KEY$TEMP);

   8799  1 001027   200101 470500                    LDP0    STA$,,AUTO
         1 001030   200034 720100                    LXL0    KEYL,,AUTO
         1 001031   200041 471500                    LDP1    KEY$,,AUTO
         1 001032   000140 106540                    CMPC    fill='000'O
         1 001033   000005 000010                    ADSC9   5,,PR0                   cn=0,n=*X0
         1 001034   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 001035   001206 601000 1                  TNZ     DFND

      455     8800    3             KEYLAST = STA$->KQ$STA.BTN.KEY;

   8800  1 001036   200101 470500                    LDP0    STA$,,AUTO
         1 001037   040100 100500                    MLR     fill='040'O
         1 001040   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 001041   200035 000010                    ADSC9   KEYLAST,,AUTO            cn=0,n=8

      456     8801    3             IF SUBSTR (KEYLAST,0,1) = '*' THEN

   8801  1 001042   200035 236100                    LDQ     KEYLAST,,AUTO
         1 001043   777000 376003                    ANQ     -512,DU
         1 001044   052000 116003                    CMPQ    21504,DU
         1 001045   001161 600000 1                  TZE     DFC0

      457     8802    3               GOTO DFC0;
      458     8803    3             IF STA$->KQ$STA.MLH.COUNT ~= 0 THEN

   8803  1 001046   000041 235100                    LDA     33,,PR0
         1 001047   001161 600000 1                  TZE     DFC0

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:73   
      459     8804    4               DO;

      460     8805                    %LOCK (G=STA$->KQ$STA.GATE);

   8806  1 001050   200101 236100                    LDQ     STA$,,AUTO
         1 001051   000016 036003                    ADLQ    14,DU
         1 001052   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001053   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001054   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001055   000000 701000 xent               TSX1    HFC$LOCK
         1 001056   000000 011000                    NOP     0

      461     8808    4               IF DELETE_ALL_ONLY THEN

   8808  1 001057   200007 234100                    SZN     DELETE_ALL_ONLY,,AUTO
         1 001060   001110 605000 1                  TPL     s:8817

      462     8809    5                 DO;

      463     8810    5                 KQ$FWP.FOUND = KQ$FWP.FOUND + STA$->KQ$STA.MLH.COUNT;

   8810  1 001061   200101 470500                    LDP0    STA$,,AUTO
         1 001062   200052 236100                    LDQ     KQ$FWP+8,,AUTO
         1 001063   000041 036100                    ADLQ    33,,PR0
         1 001064   200052 756100                    STQ     KQ$FWP+8,,AUTO

      464     8811    5                 CALL KQL$DELMLH (KQ$CG,ADDR (STA$->KQ$STA.MLH));
              8811                          /* Doesn't ALTRET!! */

   8811  1 001065   200101 236100                    LDQ     STA$,,AUTO
         1 001066   000034 036003                    ADLQ    28,DU
         1 001067   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001070   200106 631500                    EPPR1   ASIZE+1,,AUTO
         1 001071   200111 451500                    STP1    ASIZE+4,,AUTO
         1 001072   200005 236100                    LDQ     CG$,,AUTO
         1 001073   200110 756100                    STQ     ASIZE+3,,AUTO
         1 001074   200110 630500                    EPPR0   ASIZE+3,,AUTO
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:74   
         1 001075   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001076   000000 701000 xent               TSX1    KQL$DELMLH
         1 001077   000000 011000                    NOP     0

      465     8812                      %UNLOCK (G=STA$->KQ$STA.GATE);

   8813  1 001100   200101 236100                    LDQ     STA$,,AUTO
         1 001101   000016 036003                    ADLQ    14,DU
         1 001102   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001103   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001104   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001105   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001106   000000 011000                    NOP     0

      466     8815    5                 GOTO DFC0;

   8815  1 001107   001161 710000 1                  TRA     DFC0

      467     8816    5                 END;
      468     8817    4               STA$->KQ$STA.LOCKCNT = STA$->KQ$STA.LOCKCNT + 1;

   8817  1 001110   200101 470500                    LDP0    STA$,,AUTO
         1 001111   000020 236100                    LDQ     16,,PR0
         1 001112   000001 036007                    ADLQ    1,DL
         1 001113   000020 552104                    STBQ    16,'04'O,PR0

      469     8818                    %UNLOCK (G=KQ$CG.STREE.GATE);

   8819  1 001114   200005 236100                    LDQ     CG$,,AUTO
         1 001115   000075 036003                    ADLQ    61,DU
         1 001116   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001117   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001120   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001121   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001122   000000 011000                    NOP     0

      470     8821    4               KQ$FWP.NODE$ = STA$;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:75   

   8821  1 001123   200101 236100                    LDQ     STA$,,AUTO
         1 001124   200045 756100                    STQ     KQ$FWP+3,,AUTO

      471     8822    4               CALL KQL$DFFIND (KQ$FWP) ALTRET (CGFULLD);

   8822  1 001125   200042 630500                    EPPR0   KQ$FWP,,AUTO
         1 001126   200106 450500                    STP0    ASIZE+1,,AUTO
         1 001127   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001130   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001131   000000 701000 xent               TSX1    KQL$DFFIND
         1 001132   001433 702000 1                  TSX2    CGFULLD

      472     8823
      473     8824        /* Position back to where we left off */
      474     8825
      475     8826    4               CALL KQP$UNLOCK (STA$->KQ$STA); /* Ignore ALTRET */

   8826  1 001133   200101 630500                    EPPR0   STA$,,AUTO
         1 001134   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001135   000000 701000 xent               TSX1    KQP$UNLOCK
         1 001136   000000 011000                    NOP     0

      476     8827                    %LOCK (G=KQ$CG.STREE.GATE);

   8828  1 001137   200005 236100                    LDQ     CG$,,AUTO
         1 001140   000075 036003                    ADLQ    61,DU
         1 001141   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001142   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001143   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001144   000000 701000 xent               TSX1    HFC$LOCK
         1 001145   000000 011000                    NOP     0

      477     8830    4               CALL KQB$SRCH (KQ$CG.STREE,KEYLAST,STA$) ALTRET (DFA1);

   8830  1 001146   200101 630500                    EPPR0   STA$,,AUTO
         1 001147   200110 450500                    STP0    ASIZE+3,,AUTO
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:76   
         1 001150   200035 631500                    EPPR1   KEYLAST,,AUTO
         1 001151   200107 451500                    STP1    ASIZE+2,,AUTO
         1 001152   200005 236100                    LDQ     CG$,,AUTO
         1 001153   000075 036003                    ADLQ    61,DU
         1 001154   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001155   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001156   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001157   000000 701000 xent               TSX1    KQB$SRCH
         1 001160   001167 702000 1                  TSX2    DFA1

      478     8831    4   DFC0:
      479     8832    4               END;

   8832  1 001161                       DFC0         null
      480     8833    3             STA$ = STA$->KQ$STA.BTN.FLINK$;

   8833  1 001161   200101 470500                    LDP0    STA$,,AUTO
         1 001162   000004 236100                    LDQ     4,,PR0
         1 001163   200101 756100                    STQ     STA$,,AUTO

      481     8834    3             IF STA$ = ADDR (NIL) THEN

   8834  1 001164   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001165   001206 600000 1                  TZE     DFND

      482     8835    3               GOTO DFND;
      483     8836    4               DO WHILE ('0'B);

   8836  1 001166   001177 710000 1                  TRA     s:8843

      484     8837    4   DFA1:
      485     8838    4               IF STA$ = ADDR (NIL) THEN

   8838  1 001167   200101 236100       DFA1         LDQ     STA$,,AUTO
         1 001170   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001171   001206 600000 1                  TZE     DFND

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:77   
      486     8839    4                 GOTO DFND;
      487     8840    4               IF KEYLAST > STA$->KQ$STA.BTN.KEY THEN

   8840  1 001172   200101 470500                    LDP0    STA$,,AUTO
         1 001173   040100 106500                    CMPC    fill='040'O
         1 001174   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 001175   200035 000010                    ADSC9   KEYLAST,,AUTO            cn=0,n=8
         1 001176   001161 602000 1                  TNC     DFC0

      488     8841    4                 GOTO DFC0;
      489     8842    4               END;

      490     8843    3             END;

   8843  1 001177   200101 470500                    LDP0    STA$,,AUTO
         1 001200   200034 720100                    LXL0    KEYL,,AUTO
         1 001201   200041 471500                    LDP1    KEY$,,AUTO
         1 001202   000140 106540                    CMPC    fill='000'O
         1 001203   000005 000010                    ADSC9   5,,PR0                   cn=0,n=*X0
         1 001204   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 001205   001036 600000 1                  TZE     s:8800

      491     8844
      492     8845    2   DFND:
      493     8846                %UNLOCK (G=KQ$CG.STREE.GATE);

   8847  1 001206   200005 236100       DFND         LDQ     CG$,,AUTO
         1 001207   000075 036003                    ADLQ    61,DU
         1 001210   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001211   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001212   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001213   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001214   000000 011000                    NOP     0

      494     8849    2           END;

      495     8850
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:78   
      496     8851        /* Finished searching directed queue */
      497     8852
      498     8853        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:79   
      499     8854
      500     8855        /* Anonymous queue */
      501     8856
      502     8857    1         IF ANONYMOUS THEN

   8857  1 001215   200004 234100                    SZN     ANONYMOUS,,AUTO
         1 001216   001432 605000 1                  TPL     s:8928

      503     8858    2           DO;

      504     8859    2           KEYL = FWCG$RBLK.KEY1L;

   8859  1 001217   200013 236100                    LDQ     FWCG$RBLK+1,,AUTO
         1 001220   000004 772000                    QRL     4
         1 001221   000017 376007                    ANQ     15,DL
         1 001222   200034 756100                    STQ     KEYL,,AUTO

      505     8860    2           KEYTEMP = FWCG$RBLK.KEY1;

   8860  1 001223   200014 237100                    LDAQ    FWCG$RBLK+2,,AUTO
         1 001224   200037 755100                    STA     KEYTEMP,,AUTO
         1 001225   200040 756100                    STQ     KEYTEMP+1,,AUTO

      506     8861    2           IF (DELETE) AND

   8861  1 001226   200006 234100                    SZN     DELETE,,AUTO
         1 001227   001252 605000 1                  TPL     s:8867
         1 001230   200051 236100                    LDQ     KQ$FWP+7,,AUTO
         1 001231   000004 316007                    CANQ    4,DL
         1 001232   001252 601000 1                  TNZ     s:8867
         1 001233   200073 234100                    SZN     ONEATTR,,AUTO
         1 001234   001252 604000 1                  TMI     s:8867
         1 001235   200013 236100                    LDQ     FWCG$RBLK+1,,AUTO
         1 001236   000017 316007                    CANQ    15,DL
         1 001237   001252 601000 1                  TNZ     s:8867
         1 001240   000000 470400 xsym               LDP0    B$PS3$
         1 001241   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:80   
         1 001242   010000 316003                    CANQ    4096,DU
         1 001243   001247 600000 1                  TZE     s:8865
         1 001244   000000 471400 xsym               LDP1    B$PS1$
         1 001245   100014 235100                    LDA     12,,PR1
         1 001246   001252 601000 1                  TNZ     s:8867

      507     8862    2           (NOT KQ$FWP.INFORM) AND (NOT ONEATTR) AND
      508     8863    2           (FWCG$RBLK.KEY2L = 0) AND
      509     8864    2           (NOT SCA_$->VLP$SCGMA.MSGID OR CRITERIA_$->VLP$CGMA.MSGID = 0) THEN
      510     8865    2             DELETE_ALL_ONLY = '1'B;

   8865  1 001247   400000 236003                    LDQ     -131072,DU
         1 001250   200007 756100                    STQ     DELETE_ALL_ONLY,,AUTO
         1 001251   001253 710000 1                  TRA     s:8871

      511     8866    2           ELSE
      512     8867    2             DELETE_ALL_ONLY = '0'B;

   8867  1 001252   200007 450100                    STZ     DELETE_ALL_ONLY,,AUTO

      513     8868
      514     8869        /* Position to initial origin station/message type */
      515     8870
      516     8871    2           KEYLAST = KEYTEMP;

   8871  1 001253   040100 100500                    MLR     fill='040'O
         1 001254   200037 000010                    ADSC9   KEYTEMP,,AUTO            cn=0,n=8
         1 001255   200035 000010                    ADSC9   KEYLAST,,AUTO            cn=0,n=8

      517     8872    2           CALL KQR$GETQUEUE (MYSTA$->KQ$STA); /* Doesn't ALTRET!! */

   8872  1 001256   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 001257   000000 471500                    LDP1    0,,PR0
         1 001260   200106 451500                    STP1    ASIZE+1,,AUTO
         1 001261   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001262   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001263   000000 701000 xent               TSX1    KQR$GETQUEUE
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:81   
         1 001264   000000 011000                    NOP     0

      518     8873    2           CALL KQB$SRCH (KQ$CG.QUEUE.QTREE$->KQ$THDR,KEYLAST,QTN$) ALTRET (QFA0);

   8873  1 001265   200005 470500                    LDP0    CG$,,AUTO
         1 001266   000057 471500                    LDP1    47,,PR0
         1 001267   200075 633500                    EPPR3   QTN$,,AUTO
         1 001270   200110 453500                    STP3    ASIZE+3,,AUTO
         1 001271   200035 634500                    EPPR4   KEYLAST,,AUTO
         1 001272   200107 454500                    STP4    ASIZE+2,,AUTO
         1 001273   200106 451500                    STP1    ASIZE+1,,AUTO
         1 001274   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001275   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001276   000000 701000 xent               TSX1    KQB$SRCH
         1 001277   001301 702000 1                  TSX2    QFA0

      519     8874    3             DO WHILE ('0'B);

   8874  1 001300   001315 710000 1                  TRA     s:8888

      520     8875    3   QFA0:
      521     8876    3             IF QTN$ = ADDR (NIL) THEN

   8876  1 001301   200075 236100       QFA0         LDQ     QTN$,,AUTO
         1 001302   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001303   001423 600000 1                  TZE     QFND

      522     8877    3               GOTO QFND;
      523     8878    3             IF (QTN$->KQ$QTN.STA.BTN.KEY < KEYTEMP) THEN

   8878  1 001304   200075 470500                    LDP0    QTN$,,AUTO
         1 001305   040100 106500                    CMPC    fill='040'O
         1 001306   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 001307   200037 000010                    ADSC9   KEYTEMP,,AUTO            cn=0,n=8
         1 001310   001315 603000 1                  TRC     s:8888

      524     8879    4               DO;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:82   

      525     8880    4               QTN$ = QTN$->KQ$QTN.STA.BTN.FLINK$;

   8880  1 001311   000004 236100                    LDQ     4,,PR0
         1 001312   200075 756100                    STQ     QTN$,,AUTO

      526     8881    4               IF QTN$ = ADDR (NIL) THEN

   8881  1 001313   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001314   001423 600000 1                  TZE     QFND

      527     8882    4                 GOTO QFND;
      528     8883    4               END;

      529     8884    3             END;

      530     8885
      531     8886        /* Search thru the anonymous queue */
      532     8887
      533     8888    3             DO WHILE (ADDR (QTN$->KQ$QTN.STA.BTN.KEY)->KEY$TEMP = KEY$TEMP);

   8888  1 001315   200075 470500                    LDP0    QTN$,,AUTO
         1 001316   200034 720100                    LXL0    KEYL,,AUTO
         1 001317   200041 471500                    LDP1    KEY$,,AUTO
         1 001320   000140 106540                    CMPC    fill='000'O
         1 001321   000005 000010                    ADSC9   5,,PR0                   cn=0,n=*X0
         1 001322   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 001323   001423 601000 1                  TNZ     QFND

      534     8889    3             KEYLAST = QTN$->KQ$QTN.STA.BTN.KEY;

   8889  1 001324   200075 470500                    LDP0    QTN$,,AUTO
         1 001325   040100 100500                    MLR     fill='040'O
         1 001326   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 001327   200035 000010                    ADSC9   KEYLAST,,AUTO            cn=0,n=8

      535     8890    3             IF QTN$->KQ$QTN.MLH.COUNT ~= 0 THEN
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:83   

   8890  1 001330   000062 235100                    LDA     50,,PR0
         1 001331   001376 600000 1                  TZE     QFC0

      536     8891    4               DO;

      537     8892    4               IF DELETE_ALL_ONLY THEN

   8892  1 001332   200007 234100                    SZN     DELETE_ALL_ONLY,,AUTO
         1 001333   001353 605000 1                  TPL     s:8898

      538     8893    5                 DO;

      539     8894    5                 KQ$FWP.FOUND = KQ$FWP.FOUND + QTN$->KQ$QTN.MLH.COUNT;

   8894  1 001334   200052 236100                    LDQ     KQ$FWP+8,,AUTO
         1 001335   000062 036100                    ADLQ    50,,PR0
         1 001336   200052 756100                    STQ     KQ$FWP+8,,AUTO

      540     8895    5                 CALL KQL$DELMLH (KQ$CG,ADDR (QTN$->KQ$QTN.MLH));
              8895                          /* Doesn't ALTRET!! */

   8895  1 001337   200075 236100                    LDQ     QTN$,,AUTO
         1 001340   000055 036003                    ADLQ    45,DU
         1 001341   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001342   200106 631500                    EPPR1   ASIZE+1,,AUTO
         1 001343   200111 451500                    STP1    ASIZE+4,,AUTO
         1 001344   200005 236100                    LDQ     CG$,,AUTO
         1 001345   200110 756100                    STQ     ASIZE+3,,AUTO
         1 001346   200110 630500                    EPPR0   ASIZE+3,,AUTO
         1 001347   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001350   000000 701000 xent               TSX1    KQL$DELMLH
         1 001351   000000 011000                    NOP     0

      541     8896    5                 GOTO QFC0;

   8896  1 001352   001376 710000 1                  TRA     QFC0
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:84   

      542     8897    5                 END;
      543     8898    4               KQ$FWP.NODE$ = QTN$;

   8898  1 001353   200075 236100                    LDQ     QTN$,,AUTO
         1 001354   200045 756100                    STQ     KQ$FWP+3,,AUTO

      544     8899    4               CALL KQL$QFFIND (KQ$FWP) ALTRET (CGFULLQ);

   8899  1 001355   200042 631500                    EPPR1   KQ$FWP,,AUTO
         1 001356   200106 451500                    STP1    ASIZE+1,,AUTO
         1 001357   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001360   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001361   000000 701000 xent               TSX1    KQL$QFFIND
         1 001362   001440 702000 1                  TSX2    CGFULLQ

      545     8900
      546     8901        /* Position back to where we left off */
      547     8902
      548     8903    4               CALL KQB$SRCH (KQ$CG.QUEUE.QTREE$->KQ$THDR,KEYLAST,QTN$) ALTRET (QFA1);

   8903  1 001363   200005 470500                    LDP0    CG$,,AUTO
         1 001364   000057 471500                    LDP1    47,,PR0
         1 001365   200075 633500                    EPPR3   QTN$,,AUTO
         1 001366   200110 453500                    STP3    ASIZE+3,,AUTO
         1 001367   200035 634500                    EPPR4   KEYLAST,,AUTO
         1 001370   200107 454500                    STP4    ASIZE+2,,AUTO
         1 001371   200106 451500                    STP1    ASIZE+1,,AUTO
         1 001372   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001373   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001374   000000 701000 xent               TSX1    KQB$SRCH
         1 001375   001404 702000 1                  TSX2    QFA1

      549     8904    4   QFC0:
      550     8905    4               END;

   8905  1 001376                       QFC0         null
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:85   
      551     8906    3             QTN$ = QTN$->KQ$QTN.STA.BTN.FLINK$;

   8906  1 001376   200075 470500                    LDP0    QTN$,,AUTO
         1 001377   000004 236100                    LDQ     4,,PR0
         1 001400   200075 756100                    STQ     QTN$,,AUTO

      552     8907    3             IF QTN$ = ADDR (NIL) THEN

   8907  1 001401   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001402   001423 600000 1                  TZE     QFND

      553     8908    3               GOTO QFND;
      554     8909    4               DO WHILE ('0'B);

   8909  1 001403   001414 710000 1                  TRA     s:8916

      555     8910    4   QFA1:
      556     8911    4               IF QTN$ = ADDR (NIL) THEN

   8911  1 001404   200075 236100       QFA1         LDQ     QTN$,,AUTO
         1 001405   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001406   001423 600000 1                  TZE     QFND

      557     8912    4                 GOTO QFND;
      558     8913    4               IF KEYLAST > QTN$->KQ$QTN.STA.BTN.KEY THEN

   8913  1 001407   200075 470500                    LDP0    QTN$,,AUTO
         1 001410   040100 106500                    CMPC    fill='040'O
         1 001411   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 001412   200035 000010                    ADSC9   KEYLAST,,AUTO            cn=0,n=8
         1 001413   001376 602000 1                  TNC     QFC0

      559     8914    4                 GOTO QFC0;
      560     8915    4               END;

      561     8916    3             END;

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:86   
   8916  1 001414   200075 470500                    LDP0    QTN$,,AUTO
         1 001415   200034 720100                    LXL0    KEYL,,AUTO
         1 001416   200041 471500                    LDP1    KEY$,,AUTO
         1 001417   000140 106540                    CMPC    fill='000'O
         1 001420   000005 000010                    ADSC9   5,,PR0                   cn=0,n=*X0
         1 001421   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 001422   001324 600000 1                  TZE     s:8889

      562     8917
      563     8918    2   QFND:
      564     8919    2           CALL KQL$QXFDUN (MYSTA$->KQ$STA); /* Doesn't ALTRET!! */

   8919  1 001423   200003 470500       QFND         LDP0    @MYSTA$,,AUTO
         1 001424   000000 471500                    LDP1    0,,PR0
         1 001425   200106 451500                    STP1    ASIZE+1,,AUTO
         1 001426   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001427   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001430   000000 701000 xent               TSX1    KQL$QXFDUN
         1 001431   000000 011000                    NOP     0

      565     8920    2           END;

      566     8921
      567     8922        /* Finished searching anonymous queue */
      568     8923
      569     8924        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:87   
      570     8925
      571     8926        /* Just about done - cleanup */
      572     8927
      573     8928    2           DO WHILE ('0'B);

   8928  1 001432   001461 710000 1                  TRA     s:8943

      574     8929    2   CGFULLD:
      575     8930    2           CALL KQP$UNLOCK (STA$->KQ$STA);  /* Ignore ALTRET!! */

   8930  1 001433   200101 630500       CGFULLD      EPPR0   STA$,,AUTO
         1 001434   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001435   000000 701000 xent               TSX1    KQP$UNLOCK
         1 001436   000000 011000                    NOP     0

      576     8931    3             DO WHILE ('0'B);

   8931  1 001437   001447 710000 1                  TRA     s:8935

      577     8932    3   CGFULLQ:
      578     8933    3             CALL KQL$QXFDUN (MYSTA$->KQ$STA); /* Doesn't ALTRET!! */

   8933  1 001440   200003 470500       CGFULLQ      LDP0    @MYSTA$,,AUTO
         1 001441   000000 471500                    LDP1    0,,PR0
         1 001442   200106 451500                    STP1    ASIZE+1,,AUTO
         1 001443   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001444   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001445   000000 701000 xent               TSX1    KQL$QXFDUN
         1 001446   000000 011000                    NOP     0

      579     8934    3             END;

      580     8935    2           IF KQ$FWP.DI THEN

   8935  1 001447   200051 236100                    LDQ     KQ$FWP+7,,AUTO
         1 001450   000002 316007                    CANQ    2,DL
         1 001451   001456 600000 1                  TZE     s:8940
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:88   

      581     8936    2             B$JIT.ERR = E_DI;

   8936  1 001452   000050 236000 0                  LDQ     E_DI
         1 001453   000000 470400 xsym               LDP0    B$JIT$
         1 001454   000012 756100                    STQ     10,,PR0
         1 001455   001461 710000 1                  TRA     s:8943

      582     8937        /*E* ERROR:    KQF-E$DI-E
      583     8938             MESSAGE0: Data inconsistency building INFORM message. */
      584     8939    2           ELSE
      585     8940    2             B$JIT.ERR = E_CGFULL;

   8940  1 001456   000046 236000 0                  LDQ     E_CGFULL
         1 001457   000000 470400 xsym               LDP0    B$JIT$
         1 001460   000012 756100                    STQ     10,,PR0

      586     8941    2           END;

      587     8942
      588     8943    1         CALL CLEANUP;                      /* Ignore ALTRET!! */

   8943  1 001461   002004 701000 1                  TSX1    CLEANUP
         1 001462   000000 011000                    NOP     0

      589     8944
      590     8945        /* Release M$FWCG access queue */
      591     8946
      592     8947    1         CALL RELEASE_FWCG;

   8947  1 001463   002123 701000 1                  TSX1    RELEASE_FWCG
         1 001464   000000 011000                    NOP     0

      593     8948
      594     8949    1         RETURN;

   8949  1 001465   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:89   

      595     8950
      596     8951        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:90   
      597     8952
      598     8953        /* Currently LATCHED input message processing */
      599     8954
      600     8955    1   DO_LATCHED:
      601     8956
      602     8957        /* Lock the station gate and see if there is a currently latched input
      603     8958        message. If so, then check INFORM and ONEATTR flags to see what info
      604     8959        the user wants returned. If no such message exists, then just give the
      605     8960        user an error return. In any case, unlock the station gate. */
      606     8961
      607     8962              %LOCK (G=MYSTA$->KQ$STA.GATE);

   8963  1 001466   200003 470500       DO_LATCHED   LDP0    @MYSTA$,,AUTO
         1 001467   000000 471500                    LDP1    0,,PR0
         1 001470   100016 633500                    EPPR3   14,,PR1
         1 001471   200106 453500                    STP3    ASIZE+1,,AUTO
         1 001472   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001473   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001474   000000 701000 xent               TSX1    HFC$LOCK
         1 001475   000000 011000                    NOP     0

      608     8965    1         IF MYSTA$->KQ$STA.RBLK$ = ADDR (NIL) THEN

   8965  1 001476   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 001477   000000 471500                    LDP1    0,,PR0
         1 001500   100011 236100                    LDQ     9,,PR1
         1 001501   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001502   001552 600000 1                  TZE     NOLATCHED0

      609     8966    1           GOTO NOLATCHED0;
      610     8967    1         IF (MYSTA$->KQ$STA.RBLK$->KQ$RBLK.STATE = KQRS_COMP#) AND

   8967  1 001503   100011 473500                    LDP3    9,,PR1
         1 001504   300001 220100                    LDX0    1,,PR3
         1 001505   000001 100003                    CMPX0   1,DU
         1 001506   001552 601000 1                  TNZ     NOLATCHED0
         1 001507   300001 236100                    LDQ     1,,PR3
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:91   
         1 001510   400000 316007                    CANQ    -131072,DL
         1 001511   001552 600000 1                  TZE     NOLATCHED0
         1 001512   040000 316007                    CANQ    16384,DL
         1 001513   001552 600000 1                  TZE     NOLATCHED0
         1 001514   300000 236100                    LDQ     0,,PR3
         1 001515   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001516   001552 600000 1                  TZE     NOLATCHED0

      611     8968    1         (MYSTA$->KQ$STA.RBLK$->KQ$RBLK.LATCH = '1'B) AND
      612     8969    1         (MYSTA$->KQ$STA.RBLK$->KQ$RBLK.CS = '1'B) AND
      613     8970    1         (MYSTA$->KQ$STA.RBLK$->KQ$RBLK.MBLK$ ~= ADDR (NIL)) THEN
      614     8971    2           DO;

      615     8972                %UNLOCK (G=MYSTA$->KQ$STA.GATE);

   8973  1 001517   100016 634500                    EPPR4   14,,PR1
         1 001520   200106 454500                    STP4    ASIZE+1,,AUTO
         1 001521   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001522   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001523   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001524   000000 011000                    NOP     0

      616     8975    2           IF KQ$FWP.INFORM THEN

   8975  1 001525   200051 236100                    LDQ     KQ$FWP+7,,AUTO
         1 001526   000004 316007                    CANQ    4,DL
         1 001527   001532 600000 1                  TZE     s:8977

      617     8976    2             CALL SETUP_AUEV1 ALTRET (CGFULL0);

   8976  1 001530   001635 701000 1                  TSX1    SETUP_AUEV1
         1 001531   002260 702000 1                  TSX2    CGFULL0

      618     8977    2           KQ$FWP.FC = %FWCG_NONE;

   8977  1 001532   200050 450100                    STZ     KQ$FWP+6,,AUTO

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:92   
      619     8978    2           FWCG$RBLK.MBLK$ = MYSTA$->KQ$STA.RBLK$->KQ$RBLK.MBLK$;

   8978  1 001533   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 001534   000000 471500                    LDP1    0,,PR0
         1 001535   100011 473500                    LDP3    9,,PR1
         1 001536   300000 236100                    LDQ     0,,PR3
         1 001537   200012 756100                    STQ     FWCG$RBLK,,AUTO

      620     8979    2           CALL KQF$GOTMSG (KQ$FWP,FWCG$RBLK.MBLK$->KQ$MBLK);
              8979                    /* Doesn't ALTRET here!! */

   8979  1 001540   200107 756100                    STQ     ASIZE+2,,AUTO
         1 001541   200042 631500                    EPPR1   KQ$FWP,,AUTO
         1 001542   200106 451500                    STP1    ASIZE+1,,AUTO
         1 001543   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001544   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001545   000000 701000 xent               TSX1    KQF$GOTMSG
         1 001546   000000 011000                    NOP     0

      621     8980    2           CALL CLEANUP;                    /* Ignore ALTRET!! */

   8980  1 001547   002004 701000 1                  TSX1    CLEANUP
         1 001550   000000 011000                    NOP     0

      622     8981    2           END;

   8981  1 001551   001561 710000 1                  TRA     s:8991

      623     8982    1         ELSE
      624     8983    2           DO;

      625     8984    2   NOLATCHED0:
      626     8985                %UNLOCK (G=MYSTA$->KQ$STA.GATE);

   8986  1 001552   100016 633500       NOLATCHED0   EPPR3   14,,PR1
         1 001553   200106 453500                    STP3    ASIZE+1,,AUTO
         1 001554   200106 630500                    EPPR0   ASIZE+1,,AUTO
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:93   
         1 001555   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001556   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001557   000000 011000                    NOP     0

      627     8988    2           GOTO NOLATCHED;

   8988  1 001560   002254 710000 1                  TRA     NOLATCHED

      628     8989    2           END;
      629     8990
      630     8991    1         RETURN;

   8991  1 001561   000000 702200 xent               TSX2  ! X66_ARET

      631     8992
      632     8993        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:94   
      633     8994
      634     8995        /*I* NAME:        READ_ACCESS
      635     8996             ENTRY:       READ_ACCESS
      636     8997             CALL:        CALL READ_ACCESS (PARAM$,PSIZE) ALTRET (no access);
      637     8998             INPUT:       PARAM$ - Parameter stack pointer.
      638     8999                          PSIZE - Required size of area framed by PARAM$.
      639     9000             DESCRIPTION: The size of the area framed by the parameter stack
      640     9001                          descriptor described by PARAM$ is obtained and must
      641     9002                          be >= PSIZE. If so, then the page table is checked
      642     9003                          to determine if read access is in effect. RETURNs if
      643     9004                          the access conditions are met, else ALTRETURNs. */
      644     9005
      645     9006    1   READ_ACCESS: PROC (PARAM$,PSIZE) ALTRET;

   9006  1 001562   200102 741300       READ_ACCESS  STX1  ! STA$+1,,AUTO

      646     9007
      647     9008    2   DCL PARAM$ PTR;
      648     9009    2   DCL PSIZE UBIN;
      649     9010    2   DCL ASIZE UBIN;
      650     9011
      651     9012    2         CALL HFF$DSIZ (PARAM$,ASIZE) ALTRET (ARET);

   9012  1 001563   200105 630500                    EPPR0   ASIZE,,AUTO
         1 001564   200107 450500                    STP0    ASIZE+2,,AUTO
         1 001565   200103 236100                    LDQ     @PARAM$,,AUTO
         1 001566   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001567   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001570   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001571   000000 701000 xent               TSX1    HFF$DSIZ
         1 001572   001630 702000 1                  TSX2    ARET

      652     9013    2         IF ASIZE < PSIZE THEN

   9013  1 001573   200104 470500                    LDP0    @PSIZE,,AUTO
         1 001574   200105 236100                    LDQ     ASIZE,,AUTO
         1 001575   000000 116100                    CMPQ    0,,PR0
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:95   
         1 001576   001630 602000 1                  TNC     ARET

      653     9014    2           GOTO ARET;
      654     9015    2         CALL HFF$PTPRES (PARAM$) ALTRET (ARET);

   9015  1 001577   200103 630500                    EPPR0   @PARAM$,,AUTO
         1 001600   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001601   000000 701000 xent               TSX1    HFF$PTPRES
         1 001602   001630 702000 1                  TSX2    ARET

      655     9016
      656     9017    2         RETURN;

   9017  1 001603   200102 221300                    LDX1  ! STA$+1,,AUTO
         1 001604   000001 702211                    TSX2  ! 1,X1

      657     9018
      658     9019        /*I* NAME:        WRITE_ACCESS
      659     9020             ENTRY:       WRITE_ACCESS
      660     9021             CALL:        CALL WRITE_ACCESS (PARAM$,PSIZE) ALTRET (no access);
      661     9022             DESCRIPTION: Just like READ_ACCESS, except that write access is
      662     9023                          validated. */
      663     9024
      664     9025    2   WRITE_ACCESS: ENTRY (PARAM$,PSIZE) ALTRET;

   9025  1 001605   200102 741300       WRITE_ACCESS STX1  ! STA$+1,,AUTO

      665     9026
      666     9027    2         CALL HFF$DSIZ (PARAM$,ASIZE) ALTRET (ARET);

   9027  1 001606   200105 630500                    EPPR0   ASIZE,,AUTO
         1 001607   200107 450500                    STP0    ASIZE+2,,AUTO
         1 001610   200103 236100                    LDQ     @PARAM$,,AUTO
         1 001611   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001612   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001613   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001614   000000 701000 xent               TSX1    HFF$DSIZ
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:96   
         1 001615   001630 702000 1                  TSX2    ARET

      667     9028    2         IF ASIZE < PSIZE THEN

   9028  1 001616   200104 470500                    LDP0    @PSIZE,,AUTO
         1 001617   200105 236100                    LDQ     ASIZE,,AUTO
         1 001620   000000 116100                    CMPQ    0,,PR0
         1 001621   001630 602000 1                  TNC     ARET

      668     9029    2           GOTO ARET;
      669     9030    2         CALL HFF$WRITE1 (PARAM$) ALTRET (ARET);

   9030  1 001622   200103 630500                    EPPR0   @PARAM$,,AUTO
         1 001623   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001624   000000 701000 xent               TSX1    HFF$WRITE1
         1 001625   001630 702000 1                  TSX2    ARET

      670     9031
      671     9032    2         RETURN;

   9032  1 001626   200102 221300                    LDX1  ! STA$+1,,AUTO
         1 001627   000001 702211                    TSX2  ! 1,X1

      672     9033
      673     9034    2   ARET:
      674     9035    2         ALTRETURN;

   9035  1 001630   200102 221300       ARET         LDX1  ! STA$+1,,AUTO
         1 001631   000000 702211                    TSX2  ! 0,X1

      675     9036
      676     9037    2   END READ_ACCESS;
      677     9038
      678     9039        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:97   
      679     9040
      680     9041        /*I* NAME:        SETUP_AUEV
      681     9042             ENTRY:       SETUP_AUEV
      682     9043             CALL:        CALL SETUP_AUEV ALTRET (CG is full);
      683     9044             INPUT:       CG$FWP
      684     9045             OUTPUT:      FWCG$RBLK.MBLK$ - Pointer to MBLK;
      685     9046                          KQ$FWP.DBLK$ - Pointer to current DBLK.
      686     9047                          KQ$FWP.DDA - DDA of current DBLK.
      687     9048                          KQ$FWP.NEXTDDA - DDA of next DBLK.
      688     9049                          SAVE_MBLK$ - Original value of MYSTA$->KQ$STA.MBLK$ .
      689     9050             SCRATCH:     KEYL, MBLK$
      690     9051             DESCRIPTION: Sets up to create the *AUEV message that will contain
      691     9052                          the results of the INFORM operation. The message will
      692     9053                          be built with only one DBLK in memory at a time.
      693     9054                          However, the next DBLK will have already been allocated,
      694     9055                          thus minimizing I/O at the expense of obtaining an
      695     9056                          extra DBLK. */
      696     9057
      697     9058    1   SETUP_AUEV: PROC ALTRET;

   9058  1 001632   200102 741300       SETUP_AUEV   STX1  ! STA$+1,,AUTO

      698     9059
      699     9060    2   DCL ONLY_ONE BIT(1) ALIGNED;
      700     9061
      701     9062    2         ONLY_ONE = '0'B;

   9062  1 001633   200103 450100                    STZ     ONLY_ONE,,AUTO

      702     9063    2         GOTO GETMBLK;

   9063  1 001634   001640 710000 1                  TRA     GETMBLK

      703     9064
      704     9065        /*I* NAME:        SETUP_AUEV1
      705     9066             ENTRY:       SETUP_AUEV1
      706     9067             CALL:        CALL SETUP_AUEV1 ALTRET (CG is full);
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:98   
      707     9068             DESCRIPTION: Just like SETUP_AUEV, except it is known before hand
      708     9069                          that only one DBLK is required. */
      709     9070
      710     9071    2   SETUP_AUEV1: ENTRY ALTRET;

   9071  1 001635   200102 741300       SETUP_AUEV1  STX1  ! STA$+1,,AUTO

      711     9072
      712     9073    2         ONLY_ONE = '1'B;

   9073  1 001636   400000 236003                    LDQ     -131072,DU
         1 001637   200103 756100                    STQ     ONLY_ONE,,AUTO

      713     9074
      714     9075        /* Get the MBLK */
      715     9076
      716     9077    2   GETMBLK:
      717     9078    2         KEYL = KQMR_MBLK#;

   9078  1 001640   000001 235007       GETMBLK      LDA     1,DL
         1 001641   200034 755100                    STA     KEYL,,AUTO

      718     9079    2         MBLK$ = MYSTA$;

   9079  1 001642   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 001643   000000 236100                    LDQ     0,,PR0
         1 001644   200072 756100                    STQ     MBLK$,,AUTO

      719     9080    2         CALL KQM$GETBR (KQ$CG,MBLK$,KEYL) ALTRET (NO_MBLK);

   9080  1 001645   200034 631500                    EPPR1   KEYL,,AUTO
         1 001646   200110 451500                    STP1    ASIZE+3,,AUTO
         1 001647   200072 633500                    EPPR3   MBLK$,,AUTO
         1 001650   200107 453500                    STP3    ASIZE+2,,AUTO
         1 001651   200005 236100                    LDQ     CG$,,AUTO
         1 001652   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001653   200106 630500                    EPPR0   ASIZE+1,,AUTO
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:99   
         1 001654   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001655   000000 701000 xent               TSX1    KQM$GETBR
         1 001656   002002 702000 1                  TSX2    NO_MBLK

      720     9081    2         SAVE_MBLK$ = MYSTA$->KQ$STA.MBLK$; /* MUST be restored */

   9081  1 001657   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 001660   000000 471500                    LDP1    0,,PR0
         1 001661   100012 236100                    LDQ     10,,PR1
         1 001662   200100 756100                    STQ     SAVE_MBLK$,,AUTO

      721     9082    2         MYSTA$->KQ$STA.MBLK$ = MBLK$;

   9082  1 001663   200072 236100                    LDQ     MBLK$,,AUTO
         1 001664   100012 756100                    STQ     10,,PR1

      722     9083
      723     9084        /* Now get the DBLKs */
      724     9085
      725     9086    2         IF ONLY_ONE THEN

   9086  1 001665   200103 234100                    SZN     ONLY_ONE,,AUTO
         1 001666   001671 605000 1                  TPL     s:9090

      726     9087    2           KQ$FWP.NEXTDDA = 0;

   9087  1 001667   200056 450100                    STZ     KQ$FWP+12,,AUTO
         1 001670   001724 710000 1                  TRA     s:9096

      727     9088    2         ELSE
      728     9089    3           DO;

      729     9090    3           KQ$FWP.NEXTDDA = (FWCG_SIZC/SIZEC (VLP$CGMA))*SIZEC (VLP$CGMA);

   9090  1 001671   003600 235007                    LDA     1920,DL
         1 001672   200056 755100                    STA     KQ$FWP+12,,AUTO

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:100  
      730     9091    3           CALL KQD$GETR (KQ$CG,KQ$FWP.DBLK$,KQ$FWP.NEXTDDA) ALTRET (NO_DBLK0);

   9091  1 001673   200056 631500                    EPPR1   KQ$FWP+12,,AUTO
         1 001674   200110 451500                    STP1    ASIZE+3,,AUTO
         1 001675   200054 633500                    EPPR3   KQ$FWP+10,,AUTO
         1 001676   200107 453500                    STP3    ASIZE+2,,AUTO
         1 001677   200005 236100                    LDQ     CG$,,AUTO
         1 001700   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001701   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001702   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001703   000000 701000 xent               TSX1    KQD$GETR
         1 001704   001767 702000 1                  TSX2    NO_DBLK0

      731     9092    3           KQ$FWP.DBLK$->KQ$DBLK.STAMP = MBLK$->KQ$MBLK.STAMP;

   9092  1 001705   200072 470500                    LDP0    MBLK$,,AUTO
         1 001706   000001 720100                    LXL0    1,,PR0
         1 001707   200054 471500                    LDP1    KQ$FWP+10,,AUTO
         1 001710   100000 740100                    STX0    0,,PR1

      732     9093    3           KQ$FWP.DBLK$->KQ$DBLK.DSIZE = 0;

   9093  1 001711   000000 220003                    LDX0    0,DU
         1 001712   200054 470500                    LDP0    KQ$FWP+10,,AUTO
         1 001713   000000 440100                    SXL0    0,,PR0

      733     9094    3           CALL KQD$UNLOCK (KQ$CG,KQ$FWP.DBLK$); /* Doesn't ALTRET!! */

   9094  1 001714   200054 630500                    EPPR0   KQ$FWP+10,,AUTO
         1 001715   200107 450500                    STP0    ASIZE+2,,AUTO
         1 001716   200005 236100                    LDQ     CG$,,AUTO
         1 001717   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001720   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001721   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001722   000000 701000 xent               TSX1    KQD$UNLOCK
         1 001723   000000 011000                    NOP     0

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:101  
      734     9095    3           END;

      735     9096    2         KQ$FWP.DDA = (FWCG_SIZC/SIZEC (VLP$CGMA))*SIZEC (VLP$CGMA);

   9096  1 001724   003600 235007                    LDA     1920,DL
         1 001725   200055 755100                    STA     KQ$FWP+11,,AUTO

      736     9097    2         CALL KQD$GETR (KQ$CG,KQ$FWP.DBLK$,KQ$FWP.DDA) ALTRET (NO_DBLK1);

   9097  1 001726   200055 630500                    EPPR0   KQ$FWP+11,,AUTO
         1 001727   200110 450500                    STP0    ASIZE+3,,AUTO
         1 001730   200054 631500                    EPPR1   KQ$FWP+10,,AUTO
         1 001731   200107 451500                    STP1    ASIZE+2,,AUTO
         1 001732   200005 236100                    LDQ     CG$,,AUTO
         1 001733   200106 756100                    STQ     ASIZE+1,,AUTO
         1 001734   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001735   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001736   000000 701000 xent               TSX1    KQD$GETR
         1 001737   001764 702000 1                  TSX2    NO_DBLK1

      737     9098    2         KQ$FWP.DBLK$->KQ$DBLK.STAMP = MBLK$->KQ$MBLK.STAMP;

   9098  1 001740   200072 470500                    LDP0    MBLK$,,AUTO
         1 001741   000001 720100                    LXL0    1,,PR0
         1 001742   200054 471500                    LDP1    KQ$FWP+10,,AUTO
         1 001743   100000 740100                    STX0    0,,PR1

      738     9099    2         KQ$FWP.DBLK$->KQ$DBLK.DSIZE = 0;

   9099  1 001744   000000 220003                    LDX0    0,DU
         1 001745   200054 470500                    LDP0    KQ$FWP+10,,AUTO
         1 001746   000000 440100                    SXL0    0,,PR0

      739     9100    2         MBLK$->KQ$MBLK.DDA = KQ$FWP.DDA;

   9100  1 001747   200072 470500                    LDP0    MBLK$,,AUTO
         1 001750   200055 235100                    LDA     KQ$FWP+11,,AUTO
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:102  
         1 001751   000006 755100                    STA     6,,PR0

      740     9101    2         KQ$FWP.DBLK$->KQ$DBLK.FLNKDA = KQ$FWP.NEXTDDA;

   9101  1 001752   200054 470500                    LDP0    KQ$FWP+10,,AUTO
         1 001753   200056 235100                    LDA     KQ$FWP+12,,AUTO
         1 001754   000001 755100                    STA     1,,PR0

      741     9102    2         KQ$FWP.DATA$ = PINCRW (KQ$FWP.DBLK$,SIZEW (KQ$DBLK));

   9102  1 001755   200054 236100                    LDQ     KQ$FWP+10,,AUTO
         1 001756   000006 036003                    ADLQ    6,DU
         1 001757   200057 756100                    STQ     KQ$FWP+13,,AUTO

      742     9103    2         KQ$FWP.MAXDATA$ = PINCRC (KQ$FWP.DATA$,(FWCG_SIZC/SIZEC (VLP$CGMA))*SIZEC (
              9103                  VLP$CGMA));

   9103  1 001760   000740 036003                    ADLQ    480,DU
         1 001761   200060 756100                    STQ     KQ$FWP+14,,AUTO

      743     9104
      744     9105    2         RETURN;

   9105  1 001762   200102 221300                    LDX1  ! STA$+1,,AUTO
         1 001763   000001 702211                    TSX2  ! 1,X1

      745     9106
      746     9107    2   NO_DBLK1:
      747     9108    2         MBLK$->KQ$MBLK.DDA = KQ$FWP.NEXTDDA;

   9108  1 001764   200072 470500       NO_DBLK1     LDP0    MBLK$,,AUTO
         1 001765   200056 235100                    LDA     KQ$FWP+12,,AUTO
         1 001766   000006 755100                    STA     6,,PR0

      748     9109
      749     9110    2   NO_DBLK0:
      750     9111    2         CALL KQU$DELETE (MYSTA$->KQ$STA);  /* Doesn't ALTRET!! */
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:103  

   9111  1 001767   200003 470500       NO_DBLK0     LDP0    @MYSTA$,,AUTO
         1 001770   000000 471500                    LDP1    0,,PR0
         1 001771   200106 451500                    STP1    ASIZE+1,,AUTO
         1 001772   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 001773   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001774   000000 701000 xent               TSX1    KQU$DELETE
         1 001775   000000 011000                    NOP     0

      751     9112    2         MYSTA$->KQ$STA.MBLK$ = SAVE_MBLK$;

   9112  1 001776   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 001777   000000 471500                    LDP1    0,,PR0
         1 002000   200100 236100                    LDQ     SAVE_MBLK$,,AUTO
         1 002001   100012 756100                    STQ     10,,PR1

      752     9113
      753     9114    2   NO_MBLK:
      754     9115    2         ALTRETURN;

   9115  1 002002   200102 221300       NO_MBLK      LDX1  ! STA$+1,,AUTO
         1 002003   000000 702211                    TSX2  ! 0,X1

      755     9116
      756     9117    2   END SETUP_AUEV;
      757     9118
      758     9119        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:104  
      759     9120
      760     9121        /*I* NAME:        CLEANUP
      761     9122             ENTRY:       CLEANUP
      762     9123             CALL:        CALL CLEANUP ALTRET (CG full);
      763     9124             INPUT:       B$JIT.ERR - Current error code if appropriate.
      764     9125                          SAVE_MBLK$ - Ptr to original KQ$STA.MBLK$ .
      765     9126             OUTPUT:      B$JIT.ERR - Set to E$CGFULL if appropriate and there
      766     9127                                      is no current error code.
      767     9128                          MYSTA$->KQ$STA.MBLK$ - Restored to original value.
      768     9129             DESCRIPTION: Cleans up. Sets number of messages found and MSGID
      769     9130                          of INFORMing *AUEV message in VLR$FWCG. If number
      770     9131                          of messages found = 0 then deletes the *AUEV messsage
      771     9132                          that was being built, else sends it on its way. If
      772     9133                          REATTR was specified then causes all messages with
      773     9134                          changed attributes (on the *FWCG station queue) to
      774     9135                          be put where they belong. Restores MYSTA$->KQ$STA.MBLK$
      775     9136                          from SAVE_MBLK$ iff INFORM was specified. RETURNs
      776     9137                          unless the CG is full, then ALTRETURNs. */
      777     9138
      778     9139    1   CLEANUP: PROC ALTRET;

   9139  1 002004   200102 741300       CLEANUP      STX1  ! STA$+1,,AUTO

      779     9140
      780     9141    2   DCL MSGID UBIN;
      781     9142
      782     9143    2         IF RESULTS THEN

   9143  1 002005   200077 234100                    SZN     RESULTS,,AUTO
         1 002006   002012 605000 1                  TPL     s:9145

      783     9144    2           VLR$FWCG.FOUND = KQ$FWP.FOUND;

   9144  1 002007   000000 470400 xsym               LDP0    B$PS5$
         1 002010   200052 235100                    LDA     KQ$FWP+8,,AUTO
         1 002011   000000 755100                    STA     0,,PR0

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:105  
      784     9145    2         IF KQ$FWP.DBLK$ ~= ADDR (NIL) THEN

   9145  1 002012   200054 236100                    LDQ     KQ$FWP+10,,AUTO
         1 002013   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002014   002027 600000 1                  TZE     s:9150

      785     9146    3           DO;

      786     9147    3           CALL KQD$UNLOCK (KQ$CG,KQ$FWP.DBLK$); /* Doesn't ALTRET!! */

   9147  1 002015   200054 630500                    EPPR0   KQ$FWP+10,,AUTO
         1 002016   200107 450500                    STP0    ASIZE+2,,AUTO
         1 002017   200005 236100                    LDQ     CG$,,AUTO
         1 002020   200106 756100                    STQ     ASIZE+1,,AUTO
         1 002021   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 002022   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002023   000000 701000 xent               TSX1    KQD$UNLOCK
         1 002024   000000 011000                    NOP     0

      787     9148    3           KQ$FWP.DBLK$ = ADDR (NIL);

   9148  1 002025   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002026   200054 756100                    STQ     KQ$FWP+10,,AUTO

      788     9149    3           END;

      789     9150    2         IF KQ$FWP.FOUND ~= 0 THEN

   9150  1 002027   200052 235100                    LDA     KQ$FWP+8,,AUTO
         1 002030   002067 600000 1                  TZE     s:9164

      790     9151    3           DO;

      791     9152    3           IF KQ$FWP.INFORM THEN

   9152  1 002031   200051 236100                    LDQ     KQ$FWP+7,,AUTO
         1 002032   000004 316007                    CANQ    4,DL
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:106  
         1 002033   002060 600000 1                  TZE     s:9159

      792     9153    4             DO;

      793     9154    4             CALL KCA$TELLAUM (MYSTA$->KQ$STA,%CG_FWCG#,MSGID); /* Doesn't ALTRET!! */

   9154  1 002034   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 002035   000000 471500                    LDP1    0,,PR0
         1 002036   200103 633500                    EPPR3   MSGID,,AUTO
         1 002037   200110 453500                    STP3    ASIZE+3,,AUTO
         1 002040   000023 236000 2                  LDQ     19
         1 002041   200107 756100                    STQ     ASIZE+2,,AUTO
         1 002042   200106 451500                    STP1    ASIZE+1,,AUTO
         1 002043   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 002044   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002045   000000 701000 xent               TSX1    KCA$TELLAUM
         1 002046   000000 011000                    NOP     0

      794     9155    4             IF RESULTS THEN

   9155  1 002047   200077 234100                    SZN     RESULTS,,AUTO
         1 002050   002054 605000 1                  TPL     s:9157

      795     9156    4               VLR$FWCG.MSGID = MSGID;

   9156  1 002051   000000 470400 xsym               LDP0    B$PS5$
         1 002052   200103 235100                    LDA     MSGID,,AUTO
         1 002053   000001 755100                    STA     1,,PR0

      796     9157    4             MYSTA$->KQ$STA.MBLK$ = SAVE_MBLK$;

   9157  1 002054   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 002055   000000 471500                    LDP1    0,,PR0
         1 002056   200100 236100                    LDQ     SAVE_MBLK$,,AUTO
         1 002057   100012 756100                    STQ     10,,PR1

      797     9158    4             END;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:107  

      798     9159    3           IF REATTR THEN

   9159  1 002060   200076 234100                    SZN     REATTR,,AUTO
         1 002061   002112 605000 1                  TPL     s:9175

      799     9160    3             CALL KQR$FWCGF (KQ$FWP.FWCGS$->KQ$STA) ALTRET (CGFULLC);

   9160  1 002062   200047 630500                    EPPR0   KQ$FWP+5,,AUTO
         1 002063   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002064   000000 701000 xent               TSX1    KQR$FWCGF
         1 002065   002114 702000 1                  TSX2    CGFULLC

      800     9161    3           END;

   9161  1 002066   002112 710000 1                  TRA     s:9175

      801     9162    2         ELSE
      802     9163    3           DO;

      803     9164    3           IF B$JIT.ERR = '0'B THEN

   9164  1 002067   000000 470400 xsym               LDP0    B$JIT$
         1 002070   000012 235100                    LDA     10,,PR0
         1 002071   002074 601000 1                  TNZ     s:9168

      804     9165    3             B$JIT.ERR = E_FWCG_NONE;

   9165  1 002072   000047 236000 0                  LDQ     E_FWCG_NONE
         1 002073   000012 756100                    STQ     10,,PR0

      805     9166        /*E* ERROR:    KQF-E$FWCG_NONE-E
      806     9167             MESSAGE0: NO messages with the specified criteria were found. */
      807     9168    3           IF KQ$FWP.INFORM THEN

   9168  1 002074   200051 236100                    LDQ     KQ$FWP+7,,AUTO
         1 002075   000004 316007                    CANQ    4,DL
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:108  
         1 002076   002112 600000 1                  TZE     s:9175

      808     9169    4             DO;

      809     9170    4             CALL KQU$DELETE (MYSTA$->KQ$STA); /* Doesn't ALTRET!! */

   9170  1 002077   200003 471500                    LDP1    @MYSTA$,,AUTO
         1 002100   100000 473500                    LDP3    0,,PR1
         1 002101   200106 453500                    STP3    ASIZE+1,,AUTO
         1 002102   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 002103   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002104   000000 701000 xent               TSX1    KQU$DELETE
         1 002105   000000 011000                    NOP     0

      810     9171    4             MYSTA$->KQ$STA.MBLK$ = SAVE_MBLK$;

   9171  1 002106   200003 470500                    LDP0    @MYSTA$,,AUTO
         1 002107   000000 471500                    LDP1    0,,PR0
         1 002110   200100 236100                    LDQ     SAVE_MBLK$,,AUTO
         1 002111   100012 756100                    STQ     10,,PR1

      811     9172    4             END;

      812     9173    3           END;

      813     9174
      814     9175    2         RETURN;

   9175  1 002112   200102 221300                    LDX1  ! STA$+1,,AUTO
         1 002113   000001 702211                    TSX2  ! 1,X1

      815     9176
      816     9177    2   CGFULLC:
      817     9178    2         IF B$JIT.ERR = '0'B THEN

   9178  1 002114   000000 470400 xsym  CGFULLC      LDP0    B$JIT$
         1 002115   000012 235100                    LDA     10,,PR0
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:109  
         1 002116   002121 601000 1                  TNZ     s:9181

      818     9179    2           B$JIT.ERR = E_CGFULL;

   9179  1 002117   000046 236000 0                  LDQ     E_CGFULL
         1 002120   000012 756100                    STQ     10,,PR0

      819     9180
      820     9181    2         ALTRETURN;

   9181  1 002121   200102 221300                    LDX1  ! STA$+1,,AUTO
         1 002122   000000 702211                    TSX2  ! 0,X1

      821     9182
      822     9183    2   END CLEANUP;
      823     9184
      824     9185        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:110  
      825     9186
      826     9187        /*I* NAME:        RELEASE_FWCG
      827     9188             ENTRY:       RELEASE_FWCG
      828     9189             CALL:        CALL RELEASE_FWCG;
      829     9190             INPUT:       KQ$CG with user SQA'ed.
      830     9191             DESCRIPTION: Releases the current user SQA'ed for the M$FWCG queue. */
      831     9192
      832     9193    1   RELEASE_FWCG: PROC;

   9193  1 002123   200102 741300       RELEASE_FWCG STX1  ! STA$+1,,AUTO

      833     9194
      834     9195              %LOCK (G=KQ$CG.GATE.CG);

   9196  1 002124   200005 236100                    LDQ     CG$,,AUTO
         1 002125   000107 036003                    ADLQ    71,DU
         1 002126   200106 756100                    STQ     ASIZE+1,,AUTO
         1 002127   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 002130   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002131   000000 701000 xent               TSX1    HFC$LOCK
         1 002132   000000 011000                    NOP     0

      835     9198    2         KQ$CG.FWUSR# = 0;

   9198  1 002133   200005 470500                    LDP0    CG$,,AUTO
         1 002134   000000 236003                    LDQ     0,DU
         1 002135   000122 552110                    STBQ    82,'10'O,PR0

      836     9199    2         P$ = KQ$CG.FWHD$;

   9199  1 002136   000123 236100                    LDQ     83,,PR0
         1 002137   200074 756100                    STQ     P$,,AUTO

      837     9200    2         IF P$ ~= ADDR(NIL) THEN

   9200  1 002140   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002141   002167 600000 1                  TZE     s:9212
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:111  

      838     9201    3           DO;

      839     9202    3           KQ$CG.FWHD$ = P$->KQ$STA.RQLNK$;

   9202  1 002142   200074 471500                    LDP1    P$,,AUTO
         1 002143   100030 236100                    LDQ     24,,PR1
         1 002144   000123 756100                    STQ     83,,PR0

      840     9203    3           KQ$CG.FWUSR# = P$->KQ$STA.USR#;

   9203  1 002145   100020 236100                    LDQ     16,,PR1
         1 002146   000122 552110                    STBQ    82,'10'O,PR0

      841     9204                %UNLOCK (G=KQ$CG.GATE.CG);

   9205  1 002147   200005 236100                    LDQ     CG$,,AUTO
         1 002150   000107 036003                    ADLQ    71,DU
         1 002151   200106 756100                    STQ     ASIZE+1,,AUTO
         1 002152   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 002153   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002154   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002155   000000 011000                    NOP     0

      842     9207    3           CALL SSR$RUE (%SS_UQA,P$->KQ$STA.USR#);

   9207  1 002156   200074 236100                    LDQ     P$,,AUTO
         1 002157   000025 036000 2                  ADLQ    21
         1 002160   000026 235000 2                  LDA     22
         1 002161   200106 757100                    STAQ    ASIZE+1,,AUTO
         1 002162   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 002163   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002164   000000 701000 xent               TSX1    SSR$RUE
         1 002165   000000 011000                    NOP     0

      843     9208    3           END;

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:112  
   9208  1 002166   002176 710000 1                  TRA     s:9216

      844     9209    2         ELSE
      845     9210    3           DO;

      846     9211                %UNLOCK (G=KQ$CG.GATE.CG);

   9212  1 002167   200005 236100                    LDQ     CG$,,AUTO
         1 002170   000107 036003                    ADLQ    71,DU
         1 002171   200106 756100                    STQ     ASIZE+1,,AUTO
         1 002172   200106 630500                    EPPR0   ASIZE+1,,AUTO
         1 002173   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002174   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002175   000000 011000                    NOP     0

      847     9214    3           END;

      848     9215
      849     9216    2         RETURN;

   9216  1 002176   200102 221300                    LDX1  ! STA$+1,,AUTO
         1 002177   000001 702211                    TSX2  ! 1,X1

      850     9217
      851     9218    2   END RELEASE_FWCG;
      852     9219
      853     9220        %EJECT;
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:113  
      854     9221
      855     9222        /* Error processing */
      856     9223
      857     9224    1   NOACC_V:
      858     9225    1         B$JIT.ERR = E_NOACC_V; GOTO UDB_EXIT;

   9225  1 002200   000032 236000 0     NOACC_V      LDQ     E_NOACC_V
         1 002201   000000 470400 xsym               LDP0    B$JIT$
         1 002202   000012 756100                    STQ     10,,PR0

   9225  1 002203   002264 710000 1                  TRA     UDB_EXIT

      859     9226        /*E* ERROR:    KQF-E$FWCG_V-E
      860     9227             MESSAGE0: The V_ area of your FPT_FWCG is bad. */
      861     9228
      862     9229    1   NOACC_CRITERIA:
      863     9230    1         B$JIT.ERR = E_NOACC_CRITERIA; GOTO UDB_EXIT;

   9230  1 002204   000033 236000 0     NOACC_CRITE* LDQ     E_NOACC_CRITERIA
         1 002205   000000 470400 xsym               LDP0    B$JIT$
         1 002206   000012 756100                    STQ     10,,PR0

   9230  1 002207   002264 710000 1                  TRA     UDB_EXIT

      864     9231        /*E* ERROR:    KQF-E$FWCG_CRITERIA-E
      865     9232             MESSAGE0: The CRITERIA_ area of your FPT_FWCG is bad. */
      866     9233
      867     9234    1   NOACC_SCA:
      868     9235    1         B$JIT.ERR = E_NOACC_SCA; GOTO UDB_EXIT;

   9235  1 002210   000034 236000 0     NOACC_SCA    LDQ     E_NOACC_SCA
         1 002211   000000 470400 xsym               LDP0    B$JIT$
         1 002212   000012 756100                    STQ     10,,PR0

   9235  1 002213   002264 710000 1                  TRA     UDB_EXIT

      869     9236        /*E* ERROR:    KQF-E$FWCG_SCA-E
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:114  
      870     9237             MESSAGE0: The SCA_ area of your FPT_FWCG is bad.
      871     9238             MESSAGE1: You specified CRITERIA which requires a valid SCA_ area. */
      872     9239
      873     9240    1   NOACC_REATTR:
      874     9241    1         B$JIT.ERR = E_NOACC_REATTR; GOTO UDB_EXIT;

   9241  1 002214   000035 236000 0     NOACC_REATTR LDQ     E_NOACC_REATTR
         1 002215   000000 470400 xsym               LDP0    B$JIT$
         1 002216   000012 756100                    STQ     10,,PR0

   9241  1 002217   002264 710000 1                  TRA     UDB_EXIT

      875     9242        /*E* ERROR:    KQF-E$FWCG_REATTR-E
      876     9243             MESSAGE0: The REATTR_ area of your FPT_FWCG is bad. */
      877     9244
      878     9245    1   NOACC_SRA:
      879     9246    1         B$JIT.ERR = E_NOACC_SRA; GOTO UDB_EXIT;

   9246  1 002220   000036 236000 0     NOACC_SRA    LDQ     E_NOACC_SRA
         1 002221   000000 470400 xsym               LDP0    B$JIT$
         1 002222   000012 756100                    STQ     10,,PR0

   9246  1 002223   002264 710000 1                  TRA     UDB_EXIT

      880     9247        /*E* ERROR:    KQF-E$FWCG_SRA-E
      881     9248             MESSAGE0: The SRA_ area of your FPT_FWCG is bad.
      882     9249             MESSAGE1: You specified REATTR which requires a valid SRA_ area. */
      883     9250
      884     9251    1   NOACC_RESULTS:
      885     9252    1         B$JIT.ERR = E_NOACC_RESULTS; GOTO UDB_EXIT;

   9252  1 002224   000037 236000 0     NOACC_RESUL* LDQ     E_NOACC_RESULTS
         1 002225   000000 470400 xsym               LDP0    B$JIT$
         1 002226   000012 756100                    STQ     10,,PR0

   9252  1 002227   002264 710000 1                  TRA     UDB_EXIT

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:115  
      886     9253        /*E* ERROR:    KQF-E$FWCG_RESULTS-E
      887     9254             MESSAGE0: The RESULTS_ area of your FPT_FWCG is bad. */
      888     9255
      889     9256    1   NOACC_ONEATTR:
      890     9257    1         B$JIT.ERR = E_NOACC_ONEATTR; GOTO UDB_EXIT;

   9257  1 002230   000040 236000 0     NOACC_ONEAT* LDQ     E_NOACC_ONEATTR
         1 002231   000000 470400 xsym               LDP0    B$JIT$
         1 002232   000012 756100                    STQ     10,,PR0

   9257  1 002233   002264 710000 1                  TRA     UDB_EXIT

      891     9258        /*E* ERROR:    KQF-E$FWCG_ONEATTR-E
      892     9259             MESSAGE0: The ONEATTR_ area of your FPT_FWCG is bad. */
      893     9260
      894     9261    1   INV_QSELECT:
      895     9262    1         B$JIT.ERR = E_INV_QSELECT; GOTO UDB_EXIT;

   9262  1 002234   000041 236000 0     INV_QSELECT  LDQ     E_INV_QSELECT
         1 002235   000000 474400 xsym               LDP4    B$JIT$
         1 002236   400012 756100                    STQ     10,,PR4

   9262  1 002237   002264 710000 1                  TRA     UDB_EXIT

      896     9263        /*E* ERROR:    KQF-E$FWCG_QSELECT-E
      897     9264             MESSAGE0: The QSELECT parameter of your FPT_FWCG is bad. */
      898     9265
      899     9266    1   INV_STACHAR:
      900     9267    1         B$JIT.ERR = E_INV_STACHAR; GOTO UDB_EXIT;

   9267  1 002240   000043 236000 0     INV_STACHAR  LDQ     E_INV_STACHAR
         1 002241   000000 470400 xsym               LDP0    B$JIT$
         1 002242   000012 756100                    STQ     10,,PR0

   9267  1 002243   002264 710000 1                  TRA     UDB_EXIT

      901     9268        /*E* ERROR:    KQF-E$STACHAR-E
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:116  
      902     9269             MESSAGE0: The ORIGIN or DEST station of your VLP_CGMA is invalid. */
      903     9270
      904     9271    1   INV_TYPCHAR:
      905     9272    1         B$JIT.ERR = E_INV_TYPCHAR; GOTO UDB_EXIT;

   9272  1 002244   000044 236000 0     INV_TYPCHAR  LDQ     E_INV_TYPCHAR
         1 002245   000000 470400 xsym               LDP0    B$JIT$
         1 002246   000012 756100                    STQ     10,,PR0

   9272  1 002247   002264 710000 1                  TRA     UDB_EXIT

      906     9273        /*E* ERROR:    KQF-E$TYPCHAR-E
      907     9274             MESSAGE0: The MSGTYP of your VLP_CGMA is invalid. */
      908     9275
      909     9276    1   INV_MSGIDXT:
      910     9277    1         B$JIT.ERR = E_INV_MSGIDXT; GOTO UDB_EXIT;

   9277  1 002250   000045 236000 0     INV_MSGIDXT  LDQ     E_INV_MSGIDXT
         1 002251   000000 474400 xsym               LDP4    B$JIT$
         1 002252   400012 756100                    STQ     10,,PR4

   9277  1 002253   002264 710000 1                  TRA     UDB_EXIT

      911     9278        /*E* ERROR:    KQF-E$FWCG_MSGIDXT-E
      912     9279             MESSAGE0: The MSGIDXT of your VLP_CGMA is invalid. */
      913     9280
      914     9281    1   NOLATCHED:
      915     9282    1         B$JIT.ERR = E_NOLATCHED; GOTO UDB_EXIT;

   9282  1 002254   000042 236000 0     NOLATCHED    LDQ     E_NOLATCHED
         1 002255   000000 470400 xsym               LDP0    B$JIT$
         1 002256   000012 756100                    STQ     10,,PR0

   9282  1 002257   002264 710000 1                  TRA     UDB_EXIT

      916     9283        /*E* ERROR:    KQF-E$FWCG_NOLATCHED-E
      917     9284             MESSAGE0: There is no currently LATCHED input message to M$FWCG.
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:117  
      918     9285             MESSAGE1: You requested the currently LATCHED input message by
      919     9286                       setting CRITERIA to NIL, and you don't have any such
      920     9287                       message. */
      921     9288
      922     9289    1   CGFULL0:
      923     9290    1         B$JIT.ERR = E_CGFULL; GOTO UDB_EXIT;

   9290  1 002260   000046 236000 0     CGFULL0      LDQ     E_CGFULL
         1 002261   000000 470400 xsym               LDP0    B$JIT$
         1 002262   000012 756100                    STQ     10,,PR0

   9290  1 002263   002264 710000 1                  TRA     UDB_EXIT

      924     9291        /*E* ERROR:    KQF-E$CGFULL-E
      925     9292             MESSAGE0: Your comgroup space is exhausted. */
      926     9293
      927     9294    1   UDB_EXIT:
      928     9295    1         CALL UDB$PMMEXIT;

   9295  1 002264   000002 631400 xsym  UDB_EXIT     EPPR1   B_VECTNIL+2
         1 002265   000000 701000 xent               TSX1    UDB$PMMEXIT
         1 002266   000000 011000                    NOP     0

      929     9296
      930     9297    1   END KQF$FWCG;

   9297  1 002267   000000 702200 xent               TSX2  ! X66_ARET

KQF_IFWP
 Sect OctLoc
   0     000   000000 000000   000000 000000   000000 006014   000000 006014    ................
   0     004   000000 006014   000000 006014   000000 000000   000000 000000    ................
   0     010   000000 000000   000000 000000   000000 006014   000000 000000    ................
   0     014   000000 000000   000000 006014   000000 006014   000000 006014    ................
   0     020   000000 006014   000000 006014   000000 006014   ****** ******    ................
   0     024   ****** ******   ****** ******   ****** ******                    ............

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:118  
KQF_FWCGT
 Sect OctLoc
   0     030   052106 127103   107040 040040                                    *FWCG

E_NOACC_V
 Sect OctLoc
   0     032   132106 022104                                                    ZF.D

E_NOACC_CRITERIA
 Sect OctLoc
   0     033   132106 022114                                                    ZF.L

E_NOACC_SCA
 Sect OctLoc
   0     034   132106 022124                                                    ZF.T

E_NOACC_REATTR
 Sect OctLoc
   0     035   132106 022134                                                    ZF.\

E_NOACC_SRA
 Sect OctLoc
   0     036   132106 022144                                                    ZF.d

E_NOACC_RESULTS
 Sect OctLoc
   0     037   132106 022154                                                    ZF.l

E_NOACC_ONEATTR
 Sect OctLoc
   0     040   132106 022164                                                    ZF.t

E_INV_QSELECT
 Sect OctLoc
   0     041   132106 022174                                                    ZF.|

E_NOLATCHED
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:119  
 Sect OctLoc
   0     042   132106 022204                                                    ZF..

E_INV_STACHAR
 Sect OctLoc
   0     043   132106 015364                                                    ZF..

E_INV_TYPCHAR
 Sect OctLoc
   0     044   132106 015374                                                    ZF..

E_INV_MSGIDXT
 Sect OctLoc
   0     045   132106 022214                                                    ZF..

E_CGFULL
 Sect OctLoc
   0     046   132106 000264                                                    ZF..

E_FWCG_NONE
 Sect OctLoc
   0     047   132106 022224                                                    ZF..

E_DI
 Sect OctLoc
   0     050   132106 000114                                                    ZF.L

E_INS_DATAPGS
 Sect OctLoc
   0     051   132106 022234                                                    ZF..

(unnamed)
 Sect OctLoc
   2     000   000000 000070   000000 006000   000000 006000   000000 006000    ...8............
   2     004   000000 000050   000004 006000   000000 006000   000000 000100    ...(...........@
   2     010   000007 006000   000000 006000   000012 006000   000000 006000    ................
   2     014   077040 040040   000000 006000   000000 006000   000030 006000    ?   ............
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:120  
   2     020   000000 000033   000020 006000   000000 000024   000022 006000    ................
   2     024   000000 000034   000020 400000   000024 006000                    ............

PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:121  
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_ERRORS_C.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KQF$FWCG.

   Procedure KQF$FWCG requires 1208 words for executable code.
   Procedure KQF$FWCG requires 74 words of local(AUTO) storage.

    No errors detected in file KQF$FWCG.:E05TSI    .
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:122  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:123  
          MINI XREF LISTING

ANONYMOUS
      7911**DCL      8621<<ASSIGN   8625<<ASSIGN   8857>>IF
ARET IN PROCEDURE READ_ACCESS
      9035**LABEL    9012--CALLALT  9014--GOTO     9015--CALLALT  9027--CALLALT  9029--GOTO     9030--CALLALT
ASIZE IN PROCEDURE READ_ACCESS
      9010**DCL      9012<>CALL     9013>>IF       9027<>CALL     9028>>IF
B$JIT.CPFLAGS1.SLEAZE
       469**DCL       469--REDEF
B$JIT.ERR
       375**DCL      8742<<ASSIGN   8936<<ASSIGN   8940<<ASSIGN   9164>>IF       9165<<ASSIGN   9178>>IF
      9179<<ASSIGN   9225<<ASSIGN   9230<<ASSIGN   9235<<ASSIGN   9241<<ASSIGN   9246<<ASSIGN   9252<<ASSIGN
      9257<<ASSIGN   9262<<ASSIGN   9267<<ASSIGN   9272<<ASSIGN   9277<<ASSIGN   9282<<ASSIGN   9290<<ASSIGN
B$JIT.ERR.MID
       376**DCL       376--REDEF
B$JIT.JRESPEAK
       537**DCL       538--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       646**DCL       646--REDEF     647--REDEF
B$JIT.PNR
       550**DCL       550--REDEF
B$JIT.TSLINE
       644**DCL       645--REDEF
B$JIT$
      8461**DCL       370--IMP-PTR  8742>>ASSIGN   8936>>ASSIGN   8940>>ASSIGN   9164>>IF       9165>>ASSIGN
      9178>>IF       9179>>ASSIGN   9225>>ASSIGN   9230>>ASSIGN   9235>>ASSIGN   9241>>ASSIGN   9246>>ASSIGN
      9252>>ASSIGN   9257>>ASSIGN   9262>>ASSIGN   9267>>ASSIGN   9272>>ASSIGN   9277>>ASSIGN   9282>>ASSIGN
      9290>>ASSIGN
B$PS0$
      8446**DCL      8447--REDEF
B$PS1$
      8448**DCL      8449--REDEF
B$PS2$
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:124  
      8450**DCL      8451--REDEF
B$PS3$
      8452**DCL      8453--REDEF
B$PS4$
      8454**DCL      8455--REDEF
B$PS5$
      8456**DCL      8457--REDEF
B$PS6$
      8458**DCL      8459--REDEF
CG$
      7912**DCL      5655--IMP-PTR  8522<<ASSIGN   8590>>IF       8610>>IF       8656>>CALL     8658>>CALL
      8670>>CALL     8698>>CALL     8700>>IF       8702>>ASSIGN   8704>>CALL     8712>>IF       8713>>ASSIGN
      8716>>ASSIGN   8723>>CALL     8727>>IF       8739>>IF       8782>>CALL     8784>>CALL     8811>>CALL
      8819>>CALL     8828>>CALL     8830>>CALL     8847>>CALL     8873>>CALL     8895>>CALL     8903>>CALL
      9080>>CALL     9091>>CALL     9094>>CALL     9097>>CALL     9147>>CALL     9196>>CALL     9198>>ASSIGN
      9199>>ASSIGN   9202>>ASSIGN   9203>>ASSIGN   9205>>CALL     9212>>CALL
CGFULL0
      9290**LABEL    8658--CALLALT  8693--CALLALT  8976--CALLALT
CGFULLC IN PROCEDURE CLEANUP
      9178**LABEL    9160--CALLALT
CGFULLD
      8930**LABEL    8822--CALLALT
CGFULLQ
      8933**LABEL    8899--CALLALT
CLEANUP
      9139**PROC     8748--CALL     8943--CALL     8980--CALL
CRITERIA_$
      8449**DCL      8574<>CALL     8578<>CALL     8581>>ASSIGN   8585>>ASSIGN   8596>>CALLBLT  8597>>CALLBLT
      8599>>CALLBLT  8603>>IF       8603>>IF       8605>>CALLBLT  8606>>CALLBLT  8608>>CALLBLT  8764>>CALLBLT
      8768>>ASSIGN   8769>>IF       8861>>IF
DELETE
      7913**DCL      8538<<ASSIGN   8634>>IF       8679>>IF       8682>>IF       8689>>IF       8769>>IF
      8861>>IF
DELETE_ALL_ONLY
      7914**DCL      8774<<ASSIGN   8776<<ASSIGN   8808>>IF       8865<<ASSIGN   8867<<ASSIGN   8892>>IF
DFA0
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:125  
      8787**LABEL    8784--CALLALT
DFA1
      8838**LABEL    8830--CALLALT
DFC0
      8832**LABEL    8802--GOTO     8815--GOTO     8841--GOTO
DFND
      8847**LABEL    8788--GOTO     8793--GOTO     8835--GOTO     8839--GOTO
DIRECT
      7915**DCL      8620<<ASSIGN   8627<<ASSIGN   8761>>IF
DO_LATCHED
      8963**LABEL    8574--CALLALT
E_CGFULL
      8395**DCL      8940>>ASSIGN   9179>>ASSIGN   9290>>ASSIGN
E_DI
      8407**DCL      8936>>ASSIGN
E_FWCG_NONE
      8401**DCL      9165>>ASSIGN
E_INS_DATAPGS
      8413**DCL      8742>>ASSIGN
E_INV_MSGIDXT
      8389**DCL      9277>>ASSIGN
E_INV_QSELECT
      8365**DCL      9262>>ASSIGN
E_INV_STACHAR
      8377**DCL      9267>>ASSIGN
E_INV_TYPCHAR
      8383**DCL      9272>>ASSIGN
E_NOACC_CRITERIA
      8329**DCL      9230>>ASSIGN
E_NOACC_ONEATTR
      8359**DCL      9257>>ASSIGN
E_NOACC_REATTR
      8341**DCL      9241>>ASSIGN
E_NOACC_RESULTS
      8353**DCL      9252>>ASSIGN
E_NOACC_SCA
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:126  
      8335**DCL      9235>>ASSIGN
E_NOACC_SRA
      8347**DCL      9246>>ASSIGN
E_NOACC_V
      8323**DCL      9225>>ASSIGN
E_NOLATCHED
      8371**DCL      9282>>ASSIGN
FPT$FWCG_V
      7886**DCL      8526--CALL
FPT$FWCG_V.DELETE
      7886**DCL      8538>>ASSIGN
FPT$FWCG_V.INFORM
      7886**DCL      8537>>ASSIGN
FPT$FWCG_V.QSELECT
      7886**DCL      8622>>DOCASE
FWCG$RBLK
      7929**DCL      8533--ASSIGN   8565<<ASSIGN
FWCG$RBLK.BUF$
      8051**DCL      8053--REDEF
FWCG$RBLK.CNACTD
      7965**DCL      7974--REDEF
FWCG$RBLK.DBLKX
      8071**DCL      8075--REDEF
FWCG$RBLK.EOFNONE
      7943**DCL      7946--REDEF
FWCG$RBLK.FROMQ
      7949**DCL      7952--REDEF
FWCG$RBLK.HONK
      7980**DCL      8566<<ASSIGN
FWCG$RBLK.KEY1
      7991**DCL      8608<<CALLBLT  8615>>ASSIGN   8616<<ASSIGN   8860>>ASSIGN
FWCG$RBLK.KEY1L
      7986**DCL      8607<<ASSIGN   8612>>ASSIGN   8613<<ASSIGN   8769>>IF       8859>>ASSIGN
FWCG$RBLK.KEY1R
      7990**DCL      7991--REDEF
FWCG$RBLK.KEY2
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:127  
      7996**DCL      8599<<CALLBLT  8616>>ASSIGN   8617<<ASSIGN
FWCG$RBLK.KEY2L
      7988**DCL      8598<<ASSIGN   8613>>ASSIGN   8614<<ASSIGN   8769>>IF       8861>>IF
FWCG$RBLK.KEY2R
      7995**DCL      7996--REDEF
FWCG$RBLK.LATCH
      7938**DCL      7940--REDEF
FWCG$RBLK.LWRITES$
      8082**DCL      8086--REDEF
FWCG$RBLK.MBLK$
      7930**DCL      8978<<ASSIGN   8979>>CALL
FWCG$RBLK.MID.PRIMARY
      8006**DCL      8585<<ASSIGN   8586>>IF
GETMBLK IN PROCEDURE SETUP_AUEV
      9078**LABEL    9063--GOTO
HFC$LOCK
       904**DCL-ENT  8656--CALL     8661--CALL     8698--CALL     8782--CALL     8806--CALL     8828--CALL
      8963--CALL     9196--CALL
HFC$UNLOCK
       904**DCL-ENT  8667--CALL     8670--CALL     8704--CALL     8723--CALL     8813--CALL     8819--CALL
      8847--CALL     8973--CALL     8986--CALL     9205--CALL     9212--CALL
HFF$DSIZ
      8421**DCL-ENT  9012--CALL     9027--CALL
HFF$NILERASE
      8422**DCL-ENT  8542--CALL     8553--CALL     8574--CALL     8636--CALL
HFF$PTPRES
      8423**DCL-ENT  9015--CALL
HFF$WRITE1
      8424**DCL-ENT  9030--CALL
INV_MSGIDXT
      9277**LABEL    8591--GOTO
INV_QSELECT
      9262**LABEL    8629--GOTO
INV_STACHAR
      9267**LABEL    8596--CALLALT  8645--CALLALT  8647--CALLALT
INV_TYPCHAR
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:128  
      9272**LABEL    8605--CALLALT  8650--CALLALT
KCA$TELLAUM
      8425**DCL-ENT  9154--CALL
KC_LGL1ST
      1595**DCL      8596>>CALLBLT  8605>>CALLBLT  8645>>CALLBLT  8647>>CALLBLT  8650>>CALLBLT
KEY$
      8106**DCL      5638--IMP-PTR  8755<<ASSIGN   8768>>ASSIGN   8799>>DOWHILE  8888>>DOWHILE
KEY$TEMP
      5638**DCL      8799>>DOWHILE  8799>>DOWHILE  8888>>DOWHILE  8888>>DOWHILE
KEY$TEMP.K
      5639**DCL      8768<<ASSIGN
KEYBTEMP
      8105**DCL      8767<<ASSIGN
KEYL
      8102**DCL      5639--IMP-SIZ  8596<<CALLBLT  8597<<CALLBLT  8598>>ASSIGN   8599>>CALLBLT  8605<<CALLBLT
      8606<<CALLBLT  8607>>ASSIGN   8608>>CALLBLT  8612<<ASSIGN   8614>>ASSIGN   8645<<CALLBLT  8647<<CALLBLT
      8650<<CALLBLT  8764<<CALLBLT  8766<<ASSIGN   8768>>ASSIGN   8799>>DOWHILE  8799>>DOWHILE  8859<<ASSIGN
      8888>>DOWHILE  8888>>DOWHILE  9078<<ASSIGN   9080<>CALL
KEYLAST
      8103**DCL      8780<<ASSIGN   8784<>CALL     8800<<ASSIGN   8801>>IF       8830<>CALL     8840>>IF
      8871<<ASSIGN   8873<>CALL     8889<<ASSIGN   8903<>CALL     8913>>IF
KEYTEMP
      8104**DCL      8105--REDEF    8615<<ASSIGN   8617>>ASSIGN   8755--ASSIGN   8780>>ASSIGN   8789>>IF
      8860<<ASSIGN   8871>>ASSIGN   8878>>IF
KQ$CG
      5655**DCL      8658<>CALL     8811<>CALL     8895<>CALL     9080<>CALL     9091<>CALL     9094<>CALL
      9097<>CALL     9147<>CALL
KQ$CG.AUCTL.BIGMXT
      6101**DCL      8590>>IF
KQ$CG.AUCTL.DVBYTE.REREAD
      6098**DCL      6099--REDEF
KQ$CG.FWHD$
      6081**DCL      8712>>IF       8713<<ASSIGN   8716>>ASSIGN   9199>>ASSIGN   9202<<ASSIGN
KQ$CG.FWUSR#
      6077**DCL      8700>>IF       8702<<ASSIGN   8727>>IF       9198<<ASSIGN   9203<<ASSIGN
KQ$CG.GATE.CG
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:129  
      6045**DCL      8698<>CALL     8704<>CALL     8723<>CALL     9196<>CALL     9205<>CALL     9212<>CALL
KQ$CG.MINDATAPGS
      6277**DCL      8739>>IF
KQ$CG.QISS
      6041**DCL      8610>>IF
KQ$CG.QUEUE.QTREE$
      5877**DCL      8873>>CALL     8903>>CALL
KQ$CG.STREE
      5987**DCL      8784<>CALL     8830<>CALL
KQ$CG.STREE.GATE
      5989**DCL      8656<>CALL     8670<>CALL     8782<>CALL     8819<>CALL     8828<>CALL     8847<>CALL
KQ$DBLK
      6392**DCL      9090--ASSIGN   9096--ASSIGN   9102--ASSIGN   9103--ASSIGN
KQ$DBLK.DSIZE
      6397**DCL      9093<<ASSIGN   9099<<ASSIGN
KQ$DBLK.FLNKDA
      6399**DCL      9101<<ASSIGN
KQ$DBLK.STAMP
      6393**DCL      9092<<ASSIGN   9098<<ASSIGN
KQ$DGRAN
      6445**DCL      9090--ASSIGN   9096--ASSIGN   9103--ASSIGN
KQ$FWP
      8120**DCL      8530<<ASSIGN   8822<>CALL     8899<>CALL     8979<>CALL
KQ$FWP.CRITERIA_$
      8201**DCL      8581<<ASSIGN
KQ$FWP.DATA$
      8193**DCL      9102<<ASSIGN   9103>>ASSIGN
KQ$FWP.DBLK$
      8185**DCL      8187--REDEF    9091<>CALL     9092>>ASSIGN   9093>>ASSIGN   9094<>CALL     9097<>CALL
      9098>>ASSIGN   9099>>ASSIGN   9101>>ASSIGN   9102>>ASSIGN   9145>>IF       9147<>CALL     9148<<ASSIGN
KQ$FWP.DDA
      8189**DCL      9096<<ASSIGN   9097<>CALL     9100>>ASSIGN
KQ$FWP.DI
      8177**DCL      8935>>IF
KQ$FWP.EXMPTSTAR
      8171**DCL      8582<<ASSIGN
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:130  
KQ$FWP.FC
      8141**DCL      8683<<ASSIGN   8686<<ASSIGN   8688<<ASSIGN   8977<<ASSIGN
KQ$FWP.FOUND
      8181**DCL      8810<<ASSIGN   8810>>ASSIGN   8894<<ASSIGN   8894>>ASSIGN   9144>>ASSIGN   9150>>IF
KQ$FWP.FWCGS$
      8138**DCL      8659<<ASSIGN   8661>>CALL     8663>>ASSIGN   8664>>ASSIGN   8665>>ASSIGN   8667>>CALL
      9160>>CALL
KQ$FWP.GETFIRST
      8173**DCL      8556<<ASSIGN
KQ$FWP.INFORM
      8175**DCL      8537<<ASSIGN   8689>>IF       8692>>IF       8740>>IF       8769>>IF       8861>>IF
      8975>>IF       9152>>IF       9168>>IF
KQ$FWP.MAXDATA$
      8195**DCL      9103<<ASSIGN
KQ$FWP.MSGIDXT
      8183**DCL      8589<<ASSIGN   8590>>IF       8689>>IF
KQ$FWP.MYSTA$
      8128**DCL      8532<<ASSIGN
KQ$FWP.NEXTDDA
      8191**DCL      9087<<ASSIGN   9090<<ASSIGN   9091<>CALL     9101>>ASSIGN   9108>>ASSIGN
KQ$FWP.NODE$
      8131**DCL      8821<<ASSIGN   8898<<ASSIGN
KQ$FWP.ONEATTR_$
      8203**DCL      8557<<ASSIGN
KQ$FWP.RBLK$
      8135**DCL      8533<<ASSIGN
KQ$FWP.REATTR_$
      8199**DCL      8640<<ASSIGN
KQ$FWP.SRA_$
      8197**DCL      8641<<ASSIGN
KQ$FWP.TELLME
      8146**DCL      8691<<ASSIGN
KQ$FWP.TIMCHK
      8126**DCL      8531<>CALL
KQ$MBLK
      6592**DCL      8979<>CALL
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:131  
KQ$MBLK.DDA
      6657**DCL      9100<<ASSIGN   9108<<ASSIGN
KQ$MBLK.DVE.EOMCHAR
      6694**DCL      6696--REDEF
KQ$MBLK.KEY1
      6620**DCL      6622--REDEF
KQ$MBLK.KEY2
      6629**DCL      6647--REDEF
KQ$MBLK.LNK$
      6594**DCL      6596--REDEF    6602--REDEF    6606--REDEF
KQ$MBLK.STAMP
      6614**DCL      9092>>ASSIGN   9098>>ASSIGN
KQ$MBLK.TYC
      6743**DCL      6745--REDEF
KQ$MBLK.XSP.MREQ$
      6649**DCL      6653--REDEF
KQ$QTN.MLH
      7266**DCL      8895--CALL
KQ$QTN.MLH.COUNT
      7311**DCL      8890>>IF       8894>>ASSIGN
KQ$QTN.MXACT
      7208**DCL      7210--REDEF
KQ$QTN.STA.ACTTYC
      6930**DCL      6934--REDEF
KQ$QTN.STA.BTN.FLINK$
      6912**DCL      8880>>ASSIGN   8906>>ASSIGN
KQ$QTN.STA.BTN.KEY
      6914**DCL      8878>>IF       8888--DOWHILE  8889>>ASSIGN   8913>>IF
KQ$QTN.STA.DCBLNK$
      6937**DCL      6940--REDEF    6944--REDEF
KQ$QTN.STA.EVCNT
      7023**DCL      7026--REDEF
KQ$QTN.STA.EVNT
      6989**DCL      6993--REDEF    6996--REDEF
KQ$QTN.STA.OPNBLKED
      7050**DCL      7053--REDEF
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:132  
KQ$QTN.STA.OPNREJ
      7056**DCL      7058--REDEF
KQ$QTN.STA.SUCCREAD
      6979**DCL      6983--REDEF
KQ$QTN.STA.TCOUNT
      7108**DCL      7114--REDEF
KQ$QTN.STA.VGOT$
      7093**DCL      7097--REDEF    7101--REDEF
KQ$RBLK.BUF$
      7457**DCL      7459--REDEF
KQ$RBLK.CNACTD
      7371**DCL      7380--REDEF
KQ$RBLK.CS
      7362**DCL      8967>>IF
KQ$RBLK.DBLKX
      7477**DCL      7481--REDEF
KQ$RBLK.EOFNONE
      7349**DCL      7352--REDEF
KQ$RBLK.FROMQ
      7355**DCL      7358--REDEF
KQ$RBLK.KEY1R
      7396**DCL      7397--REDEF
KQ$RBLK.KEY2R
      7401**DCL      7402--REDEF
KQ$RBLK.LATCH
      7344**DCL      7346--REDEF    8967>>IF
KQ$RBLK.LWRITES$
      7488**DCL      7492--REDEF
KQ$RBLK.MBLK$
      7336**DCL      8967>>IF       8978>>ASSIGN
KQ$RBLK.STATE
      7341**DCL      8967>>IF
KQ$STA
      7522**DCL      8826<>CALL     8872<>CALL     8919<>CALL     8930<>CALL     8933<>CALL     9111<>CALL
      9154<>CALL     9160<>CALL     9170<>CALL
KQ$STA.ACTTYC
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:133  
      7574**DCL      7578--REDEF
KQ$STA.AU
      7604**DCL      8679>>IF
KQ$STA.AUP
      7676**DCL      8664<<ASSIGN
KQ$STA.BTN.FLINK$
      7556**DCL      8791>>ASSIGN   8833>>ASSIGN
KQ$STA.BTN.KEY
      7558**DCL      8789>>IF       8799--DOWHILE  8800>>ASSIGN   8840>>IF
KQ$STA.CG$
      7561**DCL      8522>>ASSIGN
KQ$STA.DCBLNK$
      7581**DCL      7584--REDEF    7588--REDEF
KQ$STA.EVCNT
      7667**DCL      7670--REDEF
KQ$STA.EVNT
      7633**DCL      7637--REDEF    7640--REDEF
KQ$STA.GATE
      7600**DCL      8661<>CALL     8667<>CALL     8806<>CALL     8813<>CALL     8963<>CALL     8973<>CALL
      8986<>CALL
KQ$STA.LOCKCNT
      7656**DCL      8817<<ASSIGN   8817>>ASSIGN
KQ$STA.MBLK$
      7567**DCL      9081>>ASSIGN   9082<<ASSIGN   9112<<ASSIGN   9157<<ASSIGN   9171<<ASSIGN
KQ$STA.MLH
      7790**DCL      8811--CALL
KQ$STA.MLH.COUNT
      7835**DCL      8803>>IF       8810>>ASSIGN
KQ$STA.MREQ
      7647**DCL      8709>>IF
KQ$STA.OPNBLKED
      7694**DCL      7697--REDEF
KQ$STA.OPNREJ
      7700**DCL      7702--REDEF
KQ$STA.RBLK$
      7565**DCL      8965>>IF       8967>>IF       8967>>IF       8967>>IF       8967>>IF       8978>>ASSIGN
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:134  
KQ$STA.RQLNK$
      7758**DCL      8711<<ASSIGN   8717>>DOWHILE  8718>>ASSIGN   8720<<ASSIGN   9202>>ASSIGN
KQ$STA.SPECIAL
      7681**DCL      8665<<ASSIGN
KQ$STA.SUCCREAD
      7623**DCL      7627--REDEF
KQ$STA.TCOUNT
      7752**DCL      7758--REDEF
KQ$STA.USR#
      7653**DCL      8663<<ASSIGN   9203>>ASSIGN   9207<>CALL
KQ$STA.VGOT$
      7737**DCL      7741--REDEF    7745--REDEF
KQ$THDR
      7861**DCL      8873<>CALL     8903<>CALL
KQB$SRCH
      8426**DCL-ENT  8784--CALL     8830--CALL     8873--CALL     8903--CALL
KQD$GETR
      8428**DCL-ENT  9091--CALL     9097--CALL
KQD$UNLOCK
      8427**DCL-ENT  9094--CALL     9147--CALL
KQF$GOTMSG
      8429**DCL-ENT  8979--CALL
KQF_FWCGT
      8320**DCL      8658<>CALL
KQF_IFWP
      8232**DCL      8530>>ASSIGN
KQF_IFWP.DBLK$
      8297**DCL      8299--REDEF
KQL$DELMLH
      8430**DCL-ENT  8811--CALL     8895--CALL
KQL$DFFIND
      8431**DCL-ENT  8822--CALL
KQL$QFFIND
      8432**DCL-ENT  8899--CALL
KQL$QXFDUN
      8433**DCL-ENT  8919--CALL     8933--CALL
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:135  
KQM$GETBR
      8434**DCL-ENT  9080--CALL
KQP$UNLOCK
      8435**DCL-ENT  8826--CALL     8930--CALL
KQR$FWCGF
      8436**DCL-ENT  9160--CALL
KQR$GETQUEUE
      8437**DCL-ENT  8872--CALL
KQT$GETSTA
      8438**DCL-ENT  8658--CALL
KQU$DELETE
      8439**DCL-ENT  9111--CALL     9170--CALL
KQX$SETTIME
      8440**DCL-ENT  8531--CALL
KQ_IMBLK.DVE.EOMCHAR
      4869**DCL      4871--REDEF
KQ_IMBLK.KEY1
      4795**DCL      4797--REDEF
KQ_IMBLK.KEY2
      4804**DCL      4822--REDEF
KQ_IMBLK.LNK$
      4769**DCL      4771--REDEF    4777--REDEF    4781--REDEF
KQ_IMBLK.TYC
      4918**DCL      4920--REDEF
KQ_IMBLK.XSP.MREQ$
      4824**DCL      4828--REDEF
KQ_IRBLK
      4251**DCL      8565>>ASSIGN
KQ_IRBLK.BUF$
      4373**DCL      4375--REDEF
KQ_IRBLK.CNACTD
      4287**DCL      4296--REDEF
KQ_IRBLK.DBLKX
      4393**DCL      4397--REDEF
KQ_IRBLK.EOFNONE
      4265**DCL      4268--REDEF
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:136  
KQ_IRBLK.FROMQ
      4271**DCL      4274--REDEF
KQ_IRBLK.KEY1R
      4312**DCL      4313--REDEF
KQ_IRBLK.KEY2R
      4317**DCL      4318--REDEF
KQ_IRBLK.LATCH
      4260**DCL      4262--REDEF
KQ_IRBLK.LWRITES$
      4404**DCL      4408--REDEF
KQ_IRBLKT.CNACTD
      4473**DCL      4482--REDEF
KQ_IRBLKT.DBLK$
      4536**DCL      4540--REDEF    4543--REDEF
KQ_IRBLKT.EOFNONE
      4451**DCL      4454--REDEF
KQ_IRBLKT.FROMQ
      4457**DCL      4460--REDEF
KQ_IRBLKT.KEY1R
      4498**DCL      4499--REDEF
KQ_IRBLKT.KEY2R
      4503**DCL      4504--REDEF
KQ_IRBLKT.LATCH
      4446**DCL      4448--REDEF
MBLK$
      8208**DCL      9079<<ASSIGN   9080<>CALL     9082>>ASSIGN   9092>>ASSIGN   9098>>ASSIGN   9100>>ASSIGN
      9108>>ASSIGN
MSGID IN PROCEDURE CLEANUP
      9141**DCL      9154<>CALL     9156>>ASSIGN
MYSTA$
      5625**DCL        44--PROC     8522>>ASSIGN   8532>>ASSIGN   8654>>ASSIGN   8679>>IF       8709>>IF
      8711>>ASSIGN   8713>>ASSIGN   8720>>ASSIGN   8872>>CALL     8919>>CALL     8933>>CALL     8963>>CALL
      8965>>IF       8967>>IF       8967>>IF       8967>>IF       8967>>IF       8973>>CALL     8978>>ASSIGN
      8986>>CALL     9079>>ASSIGN   9081>>ASSIGN   9082>>ASSIGN   9111>>CALL     9112>>ASSIGN   9154>>CALL
      9157>>ASSIGN   9170>>CALL     9171>>ASSIGN
NOACC_CRITERIA
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:137  
      9230**LABEL    8578--CALLALT
NOACC_ONEATTR
      9257**LABEL    8554--CALLALT
NOACC_REATTR
      9241**LABEL    8637--CALLALT
NOACC_RESULTS
      9252**LABEL    8543--CALLALT
NOACC_SCA
      9235**LABEL    8579--CALLALT
NOACC_SRA
      9246**LABEL    8638--CALLALT
NOACC_V
      9225**LABEL    8526--CALLALT
NOLATCHED
      9282**LABEL    8988--GOTO
NOLATCHED0
      8986**LABEL    8966--GOTO
NO_DBLK0 IN PROCEDURE SETUP_AUEV
      9111**LABEL    9091--CALLALT
NO_DBLK1 IN PROCEDURE SETUP_AUEV
      9108**LABEL    9097--CALLALT
NO_MBLK IN PROCEDURE SETUP_AUEV
      9115**LABEL    9080--CALLALT
NO_ONEATTR
      8560**LABEL    8553--CALLALT
NO_REATTR
      8675**LABEL    8636--CALLALT
NO_RESULTS
      8548**LABEL    8542--CALLALT
ONEATTR
      8209**DCL      8555<<ASSIGN   8560<<ASSIGN   8689>>IF       8769>>IF       8861>>IF
ONEATTR_$
      8459**DCL      8553<>CALL     8554<>CALL     8557>>ASSIGN
ONLY_ONE IN PROCEDURE SETUP_AUEV
      9060**DCL      9062<<ASSIGN   9073<<ASSIGN   9086>>IF
P$
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:138  
      8210**DCL      8716<<ASSIGN   8717>>DOWHILE  8718<<ASSIGN   8718>>ASSIGN   8720>>ASSIGN   9199<<ASSIGN
      9200>>IF       9202>>ASSIGN   9203>>ASSIGN   9207>>CALL
PARAM$ IN PROCEDURE READ_ACCESS
      9008**DCL      9006--PROC     9012<>CALL     9015<>CALL     9025--ENTRY    9027<>CALL     9030<>CALL
PSIZE IN PROCEDURE READ_ACCESS
      9009**DCL      9006--PROC     9013>>IF       9025--ENTRY    9028>>IF
QFA0
      8876**LABEL    8873--CALLALT
QFA1
      8911**LABEL    8903--CALLALT
QFC0
      8905**LABEL    8896--GOTO     8914--GOTO
QFND
      8919**LABEL    8877--GOTO     8882--GOTO     8908--GOTO     8912--GOTO
QTN$
      8211**DCL      8873<>CALL     8876>>IF       8878>>IF       8880<<ASSIGN   8880>>ASSIGN   8881>>IF
      8888>>DOWHILE  8889>>ASSIGN   8890>>IF       8894>>ASSIGN   8895>>CALL     8898>>ASSIGN   8903<>CALL
      8906<<ASSIGN   8906>>ASSIGN   8907>>IF       8911>>IF       8913>>IF
READ_ACCESS
      9006**PROC     8526--CALL     8578--CALL     8579--CALL     8637--CALL     8638--CALL
REATTR
      8212**DCL      8570<<ASSIGN   8639<<ASSIGN   8675<<ASSIGN   8679>>IF       8685>>IF       8689>>IF
      9159>>IF
REATTR_$
      8451**DCL      8636<>CALL     8637<>CALL     8640>>ASSIGN   8644>>IF       8645>>CALLBLT  8647>>CALLBLT
      8649>>IF       8650>>CALLBLT
RELEASE_FWCG
      9193**PROC     8749--CALL     8947--CALL
RESULTS
      8213**DCL      8544<<ASSIGN   8548<<ASSIGN   8689>>IF       9143>>IF       9155>>IF
RESULTS_$
      8457**DCL      7906--IMP-PTR  8542<>CALL     8543<>CALL     8545>>ASSIGN   9144>>ASSIGN   9156>>ASSIGN
SAVE_MBLK$
      8214**DCL      9081<<ASSIGN   9112>>ASSIGN   9157>>ASSIGN   9171>>ASSIGN
SCA_$
      8453**DCL      8579<>CALL     8582>>ASSIGN   8583>>IF       8586>>IF       8589>>ASSIGN   8594>>IF
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:139  
      8601>>IF       8763>>IF       8769>>IF       8769>>IF       8861>>IF
SC_CGFWST
      8441**DCL-ENT  8710--CALL     8728--CALL
SETUP_AUEV
      9058**PROC     8693--CALL
SETUP_AUEV1 IN PROCEDURE SETUP_AUEV
      9071**ENTRY    8976--CALL
SRA_$
      8455**DCL      8638<>CALL     8641>>ASSIGN   8643>>IF       8646>>IF       8648>>IF
SSR$REG
      8442**DCL-ENT  8725--CALL
SSR$RUE
      8443**DCL-ENT  9207--CALL
STA$
      8215**DCL      8654<<ASSIGN   8658<>CALL     8659>>ASSIGN   8784<>CALL     8787>>IF       8789>>IF
      8791<<ASSIGN   8791>>ASSIGN   8792>>IF       8799>>DOWHILE  8800>>ASSIGN   8803>>IF       8806>>CALL
      8810>>ASSIGN   8811>>CALL     8813>>CALL     8817>>ASSIGN   8817>>ASSIGN   8821>>ASSIGN   8826>>CALL
      8830<>CALL     8833<<ASSIGN   8833>>ASSIGN   8834>>IF       8838>>IF       8840>>IF       8930>>CALL
S_CUN
      8462**DCL      8663>>ASSIGN   8702>>ASSIGN   8727>>IF
UDB$PMMEXIT
      8444**DCL-ENT  9295--CALL
UDB_EXIT
      9295**LABEL    8750--GOTO     9225--GOTO     9230--GOTO     9235--GOTO     9241--GOTO     9246--GOTO
      9252--GOTO     9257--GOTO     9262--GOTO     9267--GOTO     9272--GOTO     9277--GOTO     9282--GOTO
      9290--GOTO
VLP$CGMA
      7891**DCL      8554--CALL     8578--CALL     8637--CALL     9090--ASSIGN   9090--ASSIGN   9096--ASSIGN
      9096--ASSIGN   9103--ASSIGN   9103--ASSIGN
VLP$CGMA.DEST
      7896**DCL      8644>>IF       8645>>CALLBLT  8764>>CALLBLT  8768>>ASSIGN
VLP$CGMA.MSGID
      7897**DCL      8585>>ASSIGN   8769>>IF       8861>>IF
VLP$CGMA.MSGIDXT
      7897**DCL      7898--REDEF
VLP$CGMA.MSGTYP
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:140  
      7895**DCL      8603>>IF       8603>>IF       8605>>CALLBLT  8606>>CALLBLT  8608>>CALLBLT  8649>>IF
      8650>>CALLBLT
VLP$CGMA.ORIGIN
      7895**DCL      8596>>CALLBLT  8597>>CALLBLT  8599>>CALLBLT  8647>>CALLBLT
VLP$SCGMA
      7902**DCL      8579--CALL     8638--CALL
VLP$SCGMA.DEST
      7902**DCL      8643>>IF       8763>>IF
VLP$SCGMA.EXMPTSTAR
      7903**DCL      8582>>ASSIGN   8769>>IF
VLP$SCGMA.MSGID
      7902**DCL      8583>>IF       8769>>IF       8861>>IF
VLP$SCGMA.MSGIDXT
      7903**DCL      8586>>IF       8589>>ASSIGN
VLP$SCGMA.MSGTYP
      7902**DCL      8601>>IF       8648>>IF
VLP$SCGMA.ORIGIN
      7902**DCL      8594>>IF       8646>>IF
VLR$FWCG
      7906**DCL      8543--CALL     8545<<ASSIGN
VLR$FWCG.FOUND
      7906**DCL      9144<<ASSIGN
VLR$FWCG.MSGID
      7906**DCL      9156<<ASSIGN
V_$
      8447**DCL      7886--IMP-PTR  8526<>CALL     8537>>ASSIGN   8538>>ASSIGN   8622>>DOCASE
WRITE_ACCESS IN PROCEDURE READ_ACCESS
      9025**ENTRY    8543--CALL     8554--CALL
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:141  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KQF$FWCG File=KQF$FWCG.:E05TSI                                WED 07/30/97 01:27 Page:142  
              MINI UREF LISTING

KC_NOCG$    1596**DCL
KQF$FWCG      44**PROC
KQ_BASEDELAY    4205**DCL
KQ_CGLGATE    4206**DCL
KQ_CLKCNT    4210**DCL
KQ_CURLOG$    4235**DCL
KQ_DEBUG    4207**DCL
KQ_ERRLOG_GATE    4237**DCL
KQ_HDLOG$    4234**DCL
KQ_IMLH    4698**DCL
KQ_IMTYP    4623**DCL
KQ_LOG    4220**DCL
KQ_LOGCG    4231**DCL
KQ_LOGCNT    4232**DCL
KQ_LOGENT#    4233**DCL
KQ_LOGGATE    4219**DCL
KQ_LOGSTRT    4236**DCL
KQ_MONTIMR    4208**DCL
KQ_SQUEEZE    4209**DCL
KQ_STATS    4212**DCL
KQ_XFGATE    4211**DCL
