VERSION E05

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:1    
        1        1        /*M* KQR$READ IOQ read from COMGROUP */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KQR$READ
       10       10             PURPOSE:      To provide COMGROUP READ functions for entities
       11       11                           which come through IOQ (i.e. DCBs, and monitor
       12       12                           stations such as MONKEY).
       13       13             DESCRIPTION:  Contains all routines to implement read of COMGROUP
       14       14                           via NIO$QUE.  Is the complement of KQW$WRITE, which
       15       15                           handles write thru IOQ.
       16       16        */
       17       17        /*F* NAME:         KQR$READ
       18       18             PURPOSE:      To receive non-write NIO$QUE requests for DCTs
       19       19                           whose RESCOD is CGDCB.
       20       20             DESCRIPTION:  NIO$QUE calls here for non-write functions issued
       21       21                           for a DCT with RESCOD CGDCB (this includes true
       22       22                           user DCBs, as well as monitor stations such as
       23       23                           MONKEY).
       24       24
       25       25                           First, the function code is checked to make certain
       26       26                           it is a valid COMGROUP read fcn.
       27       27
       28       28                           If the station has a read pending, or is deactivated,
       29       29                           an error is returned.
       30       30
       31       31                           If the station posesses an RBLK, it is examined.
       32       32                           If the RBLK state is PENDing, an error is returned.
       33       33                           Otherwise, it represents a completed read, and
       34       34                           contains an MBLK pointer.  If the reader is
       35       35                           requesting CONT, then we leap into the data
       36       36                           transfer cycle if there's any unread data, and
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:2    
       37       37                           otherwise give him ARS=0, terminating the read.
       38       38
       39       39                           If CONT isn't requested, then if the message
       40       40                           was read with LATCH, then if any data remains
       41       41                           unread, we start to transfer data from the
       42       42                           start of the message.  Else (all data has
       43       43                           been read), we unlatch the message.  Else
       44       44                           (not latch) we delete the message and re-init
       45       45                           the RBLK.  Note that if an RBLK exists and has
       46       46                           LATCH set, then LATCH on the M$READ is ignored.
       47       47
       48       48                           In the first case (no RBLK, or completed read), the
       49       49                           RBLK is inited from the current operation's parameters,
       50       50                           and an appropriate message is searched for.  This
       51       51                           involves first searching the list of messages writ-
       52       52                           ten to this station, and, if none and the operation
       53       53                           specifies queue search, the QUEUE is searched.
       54       54                           If nothing is found and EOFNONE is specified, EOF
       55       55                           is returned.  Otherwise, the RBLK state is changed
       56       56                           to PENDing, and we exit appropriately (i.e. block
       57       57                           the user if he specified wait, or exit).  Before
       58       58                           this is done, the buffer address is translated so
       59       59                           that it can be stored thru 'unmapped'.  Also, if
       60       60                           queue search is desired, the RBLK is left in the
       61       61                           QUEUE in such a way that a write into the queue will
       62       62                           find it.  Either way, this read will be completed
       63       63                           by some write coming thru KQW$WRITE or KQP$PUT
       64       64                           later, at which time NIO$COMP will be called for the
       65       65                           reader's request.
       66       66
       67       67
       68       68                           If, on the other hand, a message is found immed-
       69       69                           iately, the transfer begins now.  The MBLK is
       70       70                           removed from the chain on which it was found, and
       71       71                           pointed to by the RBLK.  Data is extracted from the
       72       72                           data cache (since the MBLK always points to a DBLK
       73       73                           in the data cache), one DBLK at a time if the message
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:3    
       74       74                           was written in CONTINUEd chunks.  If I/O must occur
       75       75                           in order to get a DBLK into the cache, then if the
       76       76                           user specified WAIT he is blocked, or if not we
       77       77                           return, but in either case the buffer address is
       78       78                           converted and the rest of the transfer takes place
       79       79                           'unmapped' driven off cache availability, and COMP
       80       80                           is called when transfer is complete.
       81       81        */
       82       82        /**/
       83       83        KQR$READ: PROC (N$RREQ) ALTRET;
       84       84        /**/
       85       85
       86       86
       87       87
       88       88        /**/
       89       89        /* INCLUDES */
       90       90        /**/
       91       91        %INCLUDE KQ_SUBS_C;
       92      391        %INCLUDE KQ_MAC_C;
       93     2941        %INCLUDE HF_LOCK_C;
       94     2955        %INCLUDE KQ_DATA_R;
       95     3787        %INCLUDE KQ_ERRORS_C;
       96     3835        %INCLUDE NK$LDCT;
       97     3937        %INCLUDE N$REQ;
       98     4011        %INCLUDE NK_LDCT_R;
       99     4020        %INCLUDE CP_6_SUBS;
      100     4560        %INCLUDE SS_SCHED_C;
      101     4793        %INCLUDE F$DCB;
      102     4842        %INCLUDE N_FC_C;
      103     4879        %INCLUDE KC$CP6V_C;
      104     4999        %INCLUDE B_STRINGS_C;
      105     5128        %INCLUDE KC_CP6;
      106     5688        %INCLUDE EL$TABLES;
      107     6011        %INCLUDE F_CODE_R;
      108     6021        %INCLUDE B$JIT;
      109     6624        %INCLUDE KI_ERRORS_C;
      110     6709
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:4    
      111     6710
      112     6711
      113     6712        /**/
      114     6713        /* PARAMETERS */
      115     6714        /**/
      116     6715        %N$REQ (NAME=N$RREQ,STCLASS="");
      117     6773
      118     6774
      119     6775
      120     6776        /**/
      121     6777        /* BASED STRUCTURES */
      122     6778        /**/
      123     6779    1   DCL B$$PTR PTR BASED ALIGNED;
      124     6780    1   DCL 1 B$$PTRR REDEF B$$PTR ALIGNED,
      125     6781    1         2 PG UBIN(8) UNAL,
      126     6782    1         2 WRD UBIN(10) UNAL,
      127     6783    1         2 CB UBIN(6) UNAL,
      128     6784    1         2 SEGID UBIN(12) UNAL;
      129     6785    1   DCL 1 B$$XFPTW BASED DALIGNED,
      130     6786    1         2 * (0:1) UBIN;
      131     6787        %N$REQ (STCLASS="BASED(IOQ$)");
      132     6845        %NK$LDCT (STCLASS="BASED(LDCT$)");
      133     6891        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
      134     7630        %KQ_STA  (FPTN=KQ$STA ,STCLASS="BASED(STA$)");
      135     7969        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS="BASED(RBLK$)");
      136     8155        %KQ_RBLK (FPTN=KQ$RBLKT,STCLASS=BASED,TERM=1);
      137     8341        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED(MBLK$)");
      138     8611        %KQ_MLH  (FPTN=KQ$MLH ,STCLASS="BASED(MLH$)");
      139     8681        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
      140     8719        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS="BASED(DBLK$)");
      141     8772        %KQ_QTN  (FPTN=KQ$QTN ,STCLASS="BASED(QTN$)");
      142     9245        %KQ_DFRPARM (FPTN=KQ$DFRPARM,STCLASS="BASED(DFRP$)");
      143     9274        %KQ_DFRBLK (FPTN=KQ$DFRBLK,STCLASS="BASED(DBLK$)");
      144     9324        %VLP$STATION_V (FPTN=VLP$STATION);
      145     9336    1   DCL B$$KEY1 CHAR(KEY1L) BASED ALIGNED;
      146     9337    1   DCL B$$KEY2 CHAR(KEY2L) BASED ALIGNED;
      147     9338    1   DCL B$$CHARS CHAR(I) BASED CALIGNED;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:5    
      148     9339    1   DCL B$$CHAR8 CHAR(8) BASED CALIGNED;
      149     9340    1   DCL B$$UBIN UBIN WORD BASED ALIGNED;
      150     9341    1   DCL B$$HALF UBIN HALF BASED HALIGNED;
      151     9342    1   DCL 1 B$$MIDEXT BASED ALIGNED,
      152     9343    1         2 EXTS (0:5) UBIN(6) UNAL;
      153     9344    1   DCL 1 B$$BITS BASED ALIGNED,
      154     9345    1         2 B (0:0) BIT(1) UNAL;
      155     9346        %B$CGAURD;
      156     9365
      157     9366
      158     9367
      159     9368        /**/
      160     9369        /* AUTO */
      161     9370        /**/
      162     9371    1   DCL IOQ$ PTR;
      163     9372    1   DCL LDCT$ PTR;
      164     9373    1   DCL STA$ PTR;
      165     9374    1   DCL RBLK$ PTR;
      166     9375    1   DCL MBLK$ PTR;
      167     9376    1   DCL MBLK$R REDEF MBLK$ SBIN;
      168     9377    1   DCL CG$ PTR;
      169     9378        %VLP$STATION_V (FPTN=VLP_STATION,BASED=AUTO);
      170     9390    1   DCL 1 CGAURD REDEF VLP_STATION ALIGNED,
      171     9391              %B$CGAURD (FPTN=X,LAST=",",LVL=2);
      172     9410    1         2 * (0:3) UBIN;
      173     9411    1   DCL KEY CHAR(8);
      174     9412    1   DCL ACTQTN$ PTR;
      175     9413    1   DCL KEY1L UBIN;
      176     9414    1   DCL KEY2L UBIN;
      177     9415    1   DCL P$ PTR;
      178     9416    1   DCL DFRP$ PTR;
      179     9417    1   DCL DBLK$ PTR;
      180     9418    1   DCL DBLK$R REDEF DBLK$ UBIN;
      181     9419    1   DCL I UBIN;
      182     9420    1   DCL 1 I_ERR REDEF I,
      183     9421    1         2 * BIT(18) UNAL,
      184     9422    1         2 CODE UBIN(15) UNAL,
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:6    
      185     9423    1         2 * UBIN(3) UNAL;
      186     9424    1   DCL DDA UBIN;
      187     9425    1   DCL QTN$ PTR;
      188     9426    1   DCL MLH$ PTR;
      189     9427    1   DCL MTYP$ PTR;
      190     9428    1   DCL QACTCNT UBIN;
      191     9429    1   DCL TYC BIT(36) ALIGNED;
      192     9430    1   DCL QKNFND UBIN;
      193     9431    1   DCL BADCLS REDEF QKNFND UBIN;
      194     9432    1   DCL QUEUE$ PTR;
      195     9433    1   DCL ATFLG UBIN;
      196     9434    1   DCL TIMCHK BIT(72) DALIGNED;
      197     9435
      198     9436
      199     9437
      200     9438        /**/
      201     9439        /* CONSTANT */
      202     9440        /**/
      203     9441        %FPT_UNLATCH                          (FPTN=DUFPT,
      204     9442                 INPUT     = DELETE,
      205     9443                 OUTPUT    = SEND,
      206     9444                 STCLASS   = CONSTANT);
      207     9461        %FPT_UNLATCH                          (FPTN=RUFPT,
      208     9462                 INPUT     = RERUN,
      209     9463                 OUTPUT    = DELETE,
      210     9464                 STCLASS   = CONSTANT);
      211     9481        %FPT_UNLATCH                          (FPTN=HUFPT,
      212     9482                 INPUT     = HOLD,
      213     9483                 TELLAU    = YES,
      214     9484                 OUTPUT    = DELETE,
      215     9485                 STCLASS   = CONSTANT);
      216     9502    1   DCL 1 ERR_NODAT CONSTANT,
      217     9503    1         2 FCG BIT(12) UNAL INIT('1322'O), /* 'KQ' */
      218     9504    1         2 MID BIT(6)  UNAL INIT('22'O),   /* 'R'  */
      219     9505    1         2 MON BIT(1)  UNAL INIT('1'B),
      220     9506    1         2 CODE UBIN(14) UNAL INIT(%E$NODAT),
      221     9507    1         2 SEV  UBIN(3) UNAL INIT(4);     /* SEVERITY 4 */
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:7    
      222     9508
      223     9509
      224     9510
      225     9511        /**/
      226     9512        /* REFS */
      227     9513        /**/
      228     9514    1   DCL HFC$ASSOCCLR  ENTRY(3);
      229     9515    1   DCL HFF$TRAPALT   ENTRY    ALTRET;
      230     9516    1   DCL HFF$WRITE1    ENTRY(1) ALTRET;
      231     9517    1   DCL KQB$SRCH      ENTRY(3) ALTRET;
      232     9518    1   DCL KQD$DEFERGO   ENTRY(3) ALTRET;
      233     9519    1   DCL KQD$DELETE    ENTRY(2) ALTRET;
      234     9520    1   DCL KQD$ERRLOG    ENTRY(1) ALTRET;
      235     9521    1   DCL KQD$FETCH     ENTRY(3) ALTRET;
      236     9522    1   DCL KQD$FETCHR    ENTRY(3) ALTRET;
      237     9523    1   DCL KQD$LREL      ENTRY(3) ALTRET;
      238     9524    1   DCL KQD$RENEGE    ENTRY(3) ALTRET;
      239     9525    1   DCL KQD$UNLOCK    ENTRY(2) ALTRET;
      240     9526    1   DCL KQL$DDFDUN    ENTRY(1) ALTRET;
      241     9527    1   DCL KQL$DDFDUNL   ENTRY(1) ALTRET;
      242     9528    1   DCL KQL$DDFIND    ENTRY(2) ALTRET;
      243     9529    1   DCL KQL$QDELAYR   ENTRY(2) ALTRET;
      244     9530    1   DCL KQL$QDFDUN    ENTRY(1) ALTRET;
      245     9531    1   DCL KQL$QDFIND    ENTRY(2) ALTRET;
      246     9532    1   DCL KQM$GETBR     ENTRY(3) ALTRET;
      247     9533    1   DCL KQM$GETRBLK   ENTRY(3) ALTRET;
      248     9534    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      249     9535    1   DCL KQM$RELRBLK   ENTRY(2) ALTRET;
      250     9536    1   DCL KQP$UNLOCK    ENTRY(1) ALTRET;
      251     9537    1   DCL KQQ$ACT       ENTRY(2) ALTRET;
      252     9538    1   DCL KQQ$DEQUEUE   ENTRY(2) ALTRET;
      253     9539    1   DCL KQQ$DQEOFTIME ENTRY(2) ALTRET;
      254     9540    1   DCL KQT$GETSTA    ENTRY(3) ALTRET;
      255     9541    1   DCL KQT$GETTYP    ENTRY(3) ALTRET;
      256     9542    1   DCL KQT$LBT       ENTRY(1) ALTRET;
      257     9543    1   DCL KQT$UBT       ENTRY(1) ALTRET;
      258     9544    1   DCL KQU$DELETE    ENTRY(1) ALTRET;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:8    
      259     9545    1   DCL KQU$DELMSG    ENTRY(2) ALTRET;
      260     9546    1   DCL KQU$DELREAD   ENTRY(1) ALTRET;
      261     9547    1   DCL KQU$UNLATCH   ENTRY(3) ALTRET;
      262     9548    1   DCL KQU$UNLATCHF  ENTRY(3) ALTRET;
      263     9549    1   DCL KQW$SENDAUP   ENTRY(1) ALTRET;
      264     9550    1   DCL KQX$CHKTIME   ENTRY(1) ALTRET;
      265     9551    1   DCL KQX$LDASR     ENTRY(1);
      266     9552    1   DCL KQX$SETTIME   ENTRY(1);
      267     9553    1   DCL KQY$YC        ENTRY(1);
      268     9554    1   DCL KQZ$LOG       ENTRY(8) ALTRET;
      269     9555    1   DCL MMS$SETUP_BUF ENTRY(5) ALTRET;
      270     9556    1   DCL NIO$COMPC     ENTRY(1);
      271     9557    1   DCL NIO$COMPCNS   ENTRY(1);
      272     9558    1   DCL SSR$REG       ENTRY(3) ALTRET;
      273     9559    1   DCL SC_BCGIOF     ENTRY    CONV(2,0);
      274     9560    1   DCL SC_BCGRBS     ENTRY    CONV(2,0);
      275     9561    1   DCL SC_CGNOTIMP   ENTRY    CONV(2,0);
      276     9562    1   DCL SC_CGCALZ     ENTRY    CONV(2,0);
      277     9563    1   DCL B$CGPT$ PTR SYMREF;
      278     9564    1   DCL S_CUN UBIN WORD SYMREF;
      279     9565    1   DCL B$JIT$ PTR SYMREF;
      280     9566        %VLP_STATION (FPTN=KC_VLPSTATION,STCLASS=SYMREF);
      281     9593        %EL$CGERR (NAME=KQ_ERRLOG_BFR,STCLASS=SYMREF,N=50);
      282     9597
      283     9598
      284     9599
      285     9600        /**/
      286     9601        /* SUBS */
      287     9602        /**/
      288     9603        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
      289     9604        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      290     9605        %SUB KQ$QUEUE="CG$->KQ$CG.QUEUE";
      291     9606        %EQU_CG;
      292     9654        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:9    
      293     9655
      294     9656    1         CALL SETUP;
      295     9657    2           DO CASE (N$REQ.FC);
      296     9658
      297     9659
      298     9660        /**
      299     9661         **
      300     9662         **
      301     9663         **       BAD FUNCTION CODE
      302     9664         **
      303     9665         **
      304     9666         **/
      305     9667    2             CASE (ELSE);
      306     9668    2               CALL SC_BCGIOF;
      307     9669        /*S* SCREECH_CODE: KQR-S$BCGIOF
      308     9670             TYPE:         SCREECH
      309     9671             MESSAGE:      Bad fcn code passed from IOQ to COMGROUP
      310     9672             REMARKS:      This SCREECH occurs when KQR$READ receives an IOQ
      311     9673                           packet with an unknown N$REQ.FC.  The IOQ packet
      312     9674                           may be clobbered or someone is calling NIO$QUE
      313     9675                           incorrectly. */
      314     9676
      315     9677
      316     9678        /**
      317     9679         **
      318     9680         **
      319     9681         **      READ
      320     9682         **
      321     9683         **
      322     9684         **/
      323     9685    2             CASE (%N_RDASC,%N_RDBIN,%N_READ);
      324     9686
      325     9687    2           END; /* CASE N$REQ.FCN */
      326     9688    1         CG$->KQ$CG.STATS.READS=CG$->KQ$CG.STATS.READS+1;
      327     9689    1         IF KQ_LOG.DSIO THEN
      328     9690    1          CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_READ,0,0,0,
      329     9691    1          SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:10   
      330     9692    1          SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
      331     9693        /**/
      332     9694    1         ATFLG=0;
      333     9695              %LOCK (G=STA$->KQ$STA.GATE);
      334     9698    1         RBLK$=STA$->KQ$STA.RBLK$;
      335     9699    1         CALL CHKACT
      336     9700    2         WHENALTRETURN DO;
      337     9701    2           IF ATFLG = 1 AND RBLK$ ~= ADDR(NIL) THEN
      338     9702    2            IF RBLK$->KQ$RBLK.STATE = %KQRS_COMP# THEN
      339     9703    2             IF RBLK$->KQ$RBLK.LATCH AND RBLK$->KQ$RBLK.CS THEN
      340     9704    2              GOTO UNLATCHRD;
      341     9705    2           GOTO BADCOMPUNL;
      342     9706    2           END;
      343     9707
      344     9708        /**************************************************
      345     9709         **                                              **
      346     9710         **                                              **
      347     9711         **      See if the station already has an       **
      348     9712         **      RBLK, and act appropriately if so       **
      349     9713         **                                              **
      350     9714         **************************************************/
      351     9715
      352     9716    1         IF RBLK$ ~= ADDR(NIL) THEN
      353     9717    2           DO;
      354     9718    3             DO CASE (RBLK$->KQ$RBLK.STATE);
      355     9719
      356     9720    3               CASE (ELSE);
      357     9721    3                 CALL SC_BCGRBS;
      358     9722        /*S* SCREECH_CODE: KQR-S$BCGRBS
      359     9723             TYPE:         SCREECH
      360     9724             MESSAGE:      Bad COMGROUP RBLK state
      361     9725             REMARKS:      This screech occurs when KQR$READ discovers that
      362     9726                           a station has a read in an impossible state given
      363     9727                           the way in which he was entered.  The mode of
      364     9728                           entry and RBLK state must be investigated to
      365     9729                           discover why the inconsistency occurred.
      366     9730        */
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:11   
      367     9731
      368     9732    3               CASE (KQRS_PEND#,KQRS_XFIP#,KQRS_XFDN#,KQRS_RSIP#);
      369     9733                       /* RSIP is for case of cancelling reads to disconnecting station */
      370     9734    3                 N$REQ.TYC=%TYC_XTRARD;
      371     9735    3                 GOTO BADCOMPUNL;
      372     9736
      373     9737    3               CASE (KQRS_COMP#);
      374     9738    3                 IF N$REQ.DVE.DVBYTE.CONT THEN
      375     9739    4                   DO;
      376     9740    4                   IF NOT RBLK$->KQ$RBLK.CS THEN
      377     9741    5                     DO;
      378     9742    5   RERDCH:           ;
      379     9743    5                     MBLK$=RBLK$->KQ$RBLK.MBLK$;
      380     9744    5                     RBLK$->KQ$RBLK.STATE=KQRS_XFIP#;
      381     9745    5                     IF N$REQ.BUFSIZE <= KQ_RDMAX# THEN
      382     9746    5                      RBLK$->KQ$RBLK.BUFSIZE=N$REQ.BUFSIZE;
      383     9747    5                     ELSE RBLK$->KQ$RBLK.BUFSIZE=KQ_RDMAX#;
      384     9748    5                     RBLK$->KQ$RBLK.BUF$=N$REQ.BUF$;
      385     9749    5                     RBLK$->KQ$RBLK.MAPD='0'B;
      386     9750                          %UNLOCK (G=STA$->KQ$STA.GATE);
      387     9753    5                     GOTO XFERRD0;
      388     9754    5                     END;
      389     9755    4                   N$REQ.ARSIZE=0;
      390     9756    4                   N$REQ.TYC='0'B;
      391     9757                        %UNLOCK (G=STA$->KQ$STA.GATE);
      392     9760    4                   MBLK$=RBLK$->KQ$RBLK.MBLK$;
      393     9761    4                   GOTO RDDUN0;
      394     9762    4                   END;
      395     9763        /**/
      396     9764    3                 IF RBLK$->KQ$RBLK.LATCH THEN
      397     9765    4                   DO;
      398     9766    4                   IF NOT RBLK$->KQ$RBLK.CS THEN
      399     9767    5                     DO;
      400     9768    5                     MBLK$=RBLK$->KQ$RBLK.MBLK$;
      401     9769    5                     IF RBLK$->KQ$RBLK.NCDDA ~= MBLK$->KQ$MBLK.DDA THEN
      402     9770    6                       DO;
      403     9771                            %UNLOCK (G=STA$->KQ$STA.GATE);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:12   
      404     9774    6                       DBLK$R=MBLK$->KQ$MBLK.STAMP;
      405     9775    6                       CALL KQD$RENEGE (CG$->KQ$CG,DBLK$,MBLK$->KQ$MBLK.DDA);
      406     9776    6                       RBLK$->KQ$RBLK.NCDDA=MBLK$->KQ$MBLK.DDA;
      407     9777                            %LOCK (G=STA$->KQ$STA.GATE);
      408     9780    6                       END;
      409     9781    5                     RBLK$->KQ$RBLK.DBLKX=0;
      410     9782    5                     RBLK$->KQ$RBLK.AUXFDN='0'B;
      411     9783    5                     GOTO RERDCH;
      412     9784    5                     END;
      413     9785    4   UNLATCHRD:      ;
      414     9786                        %UNLOCK (G=STA$->KQ$STA.GATE);
      415     9789    4                   CALL KQU$UNLATCHF (STA$->KQ$STA,DUFPT.V,I) ALTRET(BRCCRCW);
      416     9790                        %LOCK (G=STA$->KQ$STA.GATE);
      417     9793    4                   STA$->KQ$STA.LATCHCNT=STA$->KQ$STA.LATCHCNT+1;
      418     9794    4                   IF NOT RBLK$->KQ$RBLK.CNACTD THEN
      419     9795    4                    ACTQTN$=RBLK$->KQ$RBLK.QTN$;
      420     9796                                /* KQU$UNLATCHF does not change CNACT in the
      421     9797                                Q-tree node this read came from (if it did).
      422     9798                                This means we give the current reader first
      423     9799                                crack at more messages of that type if indeed
      424     9800                                he's trying to read another.  If he isn't or
      425     9801                                can't read one for some reason, we must call
      426     9802                                KQQ$ACT before exiting. */
      427     9803    4                   IF ATFLG = 1 THEN
      428     9804    4                    GOTO BADATCOMPUNL;
      429     9805    4                   END;
      430     9806    3                 ELSE
      431     9807    4                   DO;
      432     9808    4                   MBLK$=RBLK$->KQ$RBLK.MBLK$;
      433     9809    4                   IF MBLK$ ~= ADDR(NIL) THEN
      434     9810    4                    IF RBLK$->KQ$RBLK.NCDDA ~= 0
      435     9811    4                    OR MBLK$->KQ$MBLK.JRNLD THEN CALL KQU$DELREAD (STA$->KQ$STA);
      436     9812    4                    ELSE
      437     9813    5                      DO INHIBIT;
      438     9814    5                      RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);
      439     9815    5                      CALL KQM$RELMBLK (CG$->KQ$CG,MBLK$);
      440     9816    5                      END;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:13   
      441     9817    4                   END;
      442     9818    3             END;
      443     9819    2           RBLK$->KQ$RBLK=KQ_IRBLK;
      444     9820    2           END;
      445     9821
      446     9822    1         ELSE
      447     9823    2           DO;
      448     9824    2           IF N$REQ.DVE.DVBYTE.CONT THEN
      449     9825    2            GOTO BRCCWRV;
      450     9826    2           CALL GETRBLK ALTRET(BRCFULL);
      451     9827    2           END;
      452     9828        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:14   
      453     9829
      454     9830        /**************************************************
      455     9831         **                                              **
      456     9832         **                                              **
      457     9833         **      Now have fresh new RBLK for this        **
      458     9834         **      fresh new read.  Fill in params.        **
      459     9835         **                                              **
      460     9836         **************************************************/
      461     9837
      462     9838    1         VLP_STATION=N$REQ.STATION.LSTA$->VLP$STATION;
      463     9839    1         IF  STA$->KQ$STA.SUCCREAD
      464     9840    1         AND VLP_STATION.CTL.EOFONE THEN GOTO BRCEOFUNL;
      465     9841    1         RBLK$->KQ$RBLK.LATCH=VLP_STATION.CTL.LATCH;
      466     9842    1         IF N$REQ.BUFSIZE <= KQ_RDMAX# THEN
      467     9843    1          RBLK$->KQ$RBLK.BUFSIZE=N$REQ.BUFSIZE;
      468     9844    1         ELSE RBLK$->KQ$RBLK.BUFSIZE=KQ_RDMAX#;
      469     9845    1         RBLK$->KQ$RBLK.BUF$=N$REQ.BUF$;
      470     9846    1         RBLK$->KQ$RBLK.MID.PRIMARY = VLP_STATION.MSGID;
      471     9847    1         IF VLP_STATION.MSGTYP = ' ' THEN KEY1L=0;
      472     9848    1         ELSE
      473     9849    2           DO;
      474     9850    2           CALL INDEX (KEY1L,'?',VLP_STATION.MSGTYP);
      475     9851    2           ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1=ADDR(VLP_STATION.MSGTYP)->B$$KEY1;
      476     9852    2           RBLK$->KQ$RBLK.KEY1L=KEY1L;
      477     9853    2           IF SUBSTR (RBLK$->KQ$RBLK.KEY1,0,1) = '*' THEN
      478     9854    2            RBLK$->KQ$RBLK.HONK='1'B;
      479     9855    2           END;
      480     9856    1         IF VLP_STATION.STATION = ' ' THEN KEY2L=0;
      481     9857    1         ELSE
      482     9858    2           DO;
      483     9859    2           CALL INDEX (KEY2L,'?',VLP_STATION.STATION);
      484     9860    2           ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2=ADDR(VLP_STATION.STATION)->B$$KEY2;
      485     9861    2           RBLK$->KQ$RBLK.KEY2L=KEY2L;
      486     9862    2           END;
      487     9863    1         IF CG$->KQ$CG.QISS THEN
      488     9864    2           DO;
      489     9865    2           KEY=RBLK$->KQ$RBLK.KEY1;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:15   
      490     9866    2           RBLK$->KQ$RBLK.KEY1=RBLK$->KQ$RBLK.KEY2;
      491     9867    2           RBLK$->KQ$RBLK.KEY1L=KEY2L;
      492     9868    2           RBLK$->KQ$RBLK.KEY2=KEY;
      493     9869    2           RBLK$->KQ$RBLK.KEY2L=KEY1L;
      494     9870    2           KEY2L=KEY1L;
      495     9871    2           KEY1L=RBLK$->KQ$RBLK.KEY1L;
      496     9872    2           END;
      497     9873        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:16   
      498     9874        /**************************************************
      499     9875         **                                              **
      500     9876         **                                              **
      501     9877         **      Try to find a message to satisfy the    **
      502     9878         **      read.  Look @ directed messages first   **
      503     9879         **      then at the queue                       **
      504     9880         **                                              **
      505     9881         **************************************************/
      506     9882
      507     9883    1         CALL KQL$DDFIND (STA$->KQ$STA,MBLK$) ALTRET(XFERRD);
      508     9884    1         IF RBLK$->KQ$RBLK.ERR ~= 0 THEN GOTO BRCRERR;
      509     9885    1         IF VLP_STATION.CTL.DIRONLY
      510     9886    1         OR (SUBSTR(RBLK$->KQ$RBLK.KEY1,0,1)='*' AND CG$->KQ$CG.QISS='0'B)
      511     9887    1         OR (SUBSTR(RBLK$->KQ$RBLK.KEY2,0,1)='*' AND CG$->KQ$CG.QISS='1'B)
      512     9888    1         THEN GOTO DIRONLY;       /* Msgtyp=*? messages may only be directed */
      513     9889              %UNLOCK (G=STA$->KQ$STA.GATE);
      514     9892    1         CALL GETQUEUE;
      515     9893    1   QTS0: ;
      516     9894    1         QACTCNT=KQ$QTREE.ACTCNT;
      517     9895    1         IF KEY1L = 8 THEN
      518     9896    2           DO;
      519     9897                                /**********************************
      520     9898                                 *                                *
      521     9899                                 *        SPECIFIC Q-KEY          *
      522     9900                                 *                                *
      523     9901                                 **********************************/
      524     9902    2           CALL KQB$SRCH (KQ$QTREE,RBLK$->KQ$RBLK.KEY1,QTN$) ALTRET(QTS1);
      525     9903    2           GOTO QTS4;
      526     9904    2   QTS1:   IF VLP_STATION.CTL.EOFNONE THEN
      527     9905    3             DO;
      528     9906    3   QTS2:     CALL KQL$QDFDUN (STA$->KQ$STA);
      529     9907    3             GOTO BRCEOF;
      530     9908    3             END;
      531     9909    2           IF N$REQ.DVE.DVBYTE.NODAT THEN
      532     9910    3             DO;
      533     9911    3   QTS25:    CALL KQL$QDFDUN (STA$->KQ$STA);
      534     9912    3             GOTO BRCNODAT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:17   
      535     9913    3             END;
      536     9914    2           IF CG$->KQ$CG.XQTNLGL = '0'B
      537     9915    3           THEN DO;
      538     9916    3   QTS3:     CALL KQL$QDFDUN (STA$->KQ$STA);
      539     9917    3             GOTO BRCKEY;
      540     9918    3             END;
      541     9919    2           IF (CG$->KQ$CG.QISS AND CG$->KQ$CG.AUCTL.RAS = '0'B)
      542     9920    3           THEN DO;
      543     9921    3   QTS305:   CALL KQL$QDFDUN (STA$->KQ$STA);
      544     9922    3             GOTO BRDISC;
      545     9923    3             END;
      546     9924    2           QTN$=STA$;
      547     9925    2           IF CG$->KQ$CG.QISS='0'B
      548     9926    2           THEN CALL KQT$GETTYP(CG$->KQ$CG,QTN$,RBLK$->KQ$RBLK.KEY1) ALTRET(QTS31);
      549     9927    2           ELSE CALL KQT$GETSTA(CG$->KQ$CG,QTN$,RBLK$->KQ$RBLK.KEY1) ALTRET(QTS31);
      550     9928    2           GOTO QTS45;
      551     9929    2   QTS31:  ;
      552     9930                %LOCK (G=KQ$QTREE.GATE);
      553     9933    2           CALL KQL$QDFDUN(STA$->KQ$STA);
      554     9934    2           GOTO BRCFUL;
      555     9935    2   QTS4:   IF QTN$->KQ$QTN.CNACT < QTN$->KQ$QTN.MXACT
      556     9936    2           OR QTN$ = ACTQTN$ THEN
      557     9937    3             DO;
      558     9938    3             MBLK$=QTN$;
      559     9939    3             CALL KQL$QDFIND (STA$->KQ$STA,MBLK$) ALTRET(GOTQMSG);
      560     9940    3             IF RBLK$->KQ$RBLK.ERR ~= 0 THEN GOTO BRCRERR0;
      561     9941    3             END;
      562     9942    2           IF VLP_STATION.CTL.EOFNONE THEN
      563     9943    2            GOTO QTS2;
      564     9944    2           IF N$REQ.DVE.DVBYTE.NODAT THEN
      565     9945    2            GOTO QTS25;
      566     9946    2   QTS45:  CALL CHKSTA  ALTRET(QTS305);
      567     9947    2           RBLK$->KQ$RBLK.QTN$=QTN$;
      568     9948    2           QUEUE$=ADDR(QTN$->KQ$QTN.READS$);
      569     9949    2   QTS5:   CALL VRNQKEY ALTRET(BRCTYCQ);
      570     9950    2           RBLK$->KQ$RBLK.STA$=STA$;
      571     9951    2           CALL MAPBUF ALTRET(BRCBUFQ);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:18   
      572     9952    2           P$=QUEUE$->B$$PTR;
      573     9953    3             DO WHILE(P$~=ADDR(NIL));
      574     9954    3             QUEUE$=ADDR(P$->KQ$RBLK.QRLNK$);
      575     9955    3             P$=QUEUE$->B$$PTR;
      576     9956    3             END;
      577     9957    2           RBLK$->KQ$RBLK.QRLNK$=ADDR(NIL);
      578     9958    2           QUEUE$->B$$PTR=RBLK$;
      579     9959    2           LDCT$->NK$LDCT.IOQ$=IOQ$;
      580     9960    2           IF VLP_STATION.EOFTIME~=0 THEN
      581     9961    3             DO;
      582     9962    3             IF CG$->KQ$CG.QISS THEN
      583     9963                    /* STREE is already locked since it is the QTREE */
      584     9964    3              CALL QEOFTIMENL;
      585     9965    3             ELSE
      586     9966    3              CALL QEOFTIME;
      587     9967    3             END;
      588     9968    2           RBLK$->KQ$RBLK.STATE=KQRS_PEND#;
      589     9969    2           CALL KQL$QDFDUN (STA$->KQ$STA);
      590     9970                %LOCK (G=STA$->KQ$STA.GATE);
      591     9973    2           IF RBLK$->KQ$RBLK.STATE = KQRS_COMP#
      592     9974    2           OR N$REQ.OPFLG.WAIT = '0'B THEN
      593     9975    3             DO;
      594     9976                  %UNLOCK (G=STA$->KQ$STA.GATE);
      595     9979    3             IF ACTQTN$ ~= ADDR(NIL) THEN CALL ACTQTN;
      596     9980    3             RETURN;
      597     9981    3             END;
      598     9982                %UNLOCK (G=STA$->KQ$STA.GATE);
      599     9985    2           IF ACTQTN$ ~= ADDR(NIL) THEN CALL ACTQTN;
      600     9986    2           GOTO REGIMA;
      601     9987    2           END;
      602     9988
      603     9989                                /**********************************
      604     9990                                 *                                *
      605     9991                                 *       WILD-CARDED Q-KEY        *
      606     9992                                 *                                *
      607     9993                                 **********************************/
      608     9994    2         ELSE DO;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:19   
      609     9995    2           CALL KQX$SETTIME(TIMCHK);
      610     9996    2           IF KEY1L = 0 THEN
      611     9997    3             DO;
      612     9998                           /* Accelerate read with just '?' */
      613     9999    3             QTN$=CG$->KQ$CG.QUEUE.PLHD$;
      614    10000    4               DO WHILE (QTN$ ~= ADDR(NIL));
      615    10001    4               IF QTN$->KQ$QTN.CNACT < QTN$->KQ$QTN.MXACT
      616    10002    4               OR QTN$ = ACTQTN$ THEN
      617    10003    5                 DO;
      618    10004    5                 MBLK$=QTN$;
      619    10005    5                 CALL KQL$QDFIND (STA$->KQ$STA,MBLK$) ALTRET(GOTQMSG);
      620    10006    5                 IF RBLK$->KQ$RBLK.ERR ~= 0 THEN GOTO BRCRERR0;
      621    10007                          /* If we muck around in here for too long, we will SCREECH */
      622    10008                          /* because we left the QTREE gate locked too long.         */
      623    10009                          /* KQL$QDFIND will not leave it locked for over .5 secs    */
      624    10010                          /* and we must not leave it locked in case of several      */
      625    10011                          /* less-than-.5-sec calls to KQL$QDFIND.                   */
      626    10012    6                 CALL KQX$CHKTIME(TIMCHK) WHENRETURN DO;
      627    10013                        %UNLOCK (G=KQ$QTREE.GATE);
      628    10016    6                   CALL SSR$REG(%SS_QE);
      629    10017                        %LOCK (G=KQ$QTREE.GATE);
      630    10020    6                   CALL KQX$SETTIME(TIMCHK);
      631    10021    6                   END;
      632    10022    5                 IF QACTCNT ~= KQ$QTREE.ACTCNT THEN GOTO QTS0;
      633    10023    5                 END;
      634    10024    4               QTN$=QTN$->KQ$QTN.PLINK$;
      635    10025    4               END;
      636    10026    3             QKNFND=0;
      637    10027    3             END;
      638    10028    2           ELSE
      639    10029    3             DO;
      640    10030    3             QKNFND=1;
      641    10031    3             QTN$=CG$->KQ$CG.QUEUE.PLHD$;
      642    10032    4               DO WHILE (QTN$ ~= ADDR(NIL));
      643    10033    4               IF ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1 = ADDR(QTN$->KQ$QTN.STA.BTN.KEY)->
             10033                        B$$KEY1 THEN
      644    10034    4                IF QTN$->KQ$QTN.CNACT < QTN$->KQ$QTN.MXACT
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:20   
      645    10035    4                OR QTN$ = ACTQTN$ THEN
      646    10036    5                  DO;
      647    10037    5                  MBLK$=QTN$;
      648    10038    5                  CALL KQL$QDFIND (STA$->KQ$STA,MBLK$) ALTRET(GOTQMSG);
      649    10039    5                  IF RBLK$->KQ$RBLK.ERR ~= 0 THEN GOTO BRCRERR0;
      650    10040    6                  CALL KQX$CHKTIME(TIMCHK) WHENRETURN DO;
      651    10041                         %UNLOCK (G=KQ$QTREE.GATE);
      652    10044    6                    CALL SSR$REG (%SS_QE);
      653    10045                         %LOCK (G=KQ$QTREE.GATE);
      654    10048    6                    CALL KQX$SETTIME(TIMCHK);
      655    10049    6                    END;
      656    10050    5                  IF QACTCNT ~= KQ$QTREE.ACTCNT THEN GOTO QTS0;
      657    10051    5                  CALL CHKSTA ALTRET(QTS11);
      658    10052    5                  QKNFND=0;
      659    10053    5   QTS11:         ;
      660    10054    5                  END;
      661    10055    4               QTN$=QTN$->KQ$QTN.PLINK$;
      662    10056    4               END;
      663    10057    3             END;
      664    10058    2           END;
      665    10059    1         IF VLP_STATION.CTL.EOFNONE THEN
      666    10060    1          GOTO QTS2;
      667    10061    1         IF N$REQ.DVE.DVBYTE.NODAT THEN
      668    10062    1          GOTO QTS25;
      669    10063    1         IF QKNFND ~= 0 THEN
      670    10064    2           DO;
      671    10065    2           IF CG$->KQ$CG.XQTNLGL = '0'B
      672    10066    2           OR (CG$->KQ$CG.QISS AND CG$->KQ$CG.AUCTL.RAS = '0'B) THEN
      673    10067    2            GOTO QTS3;
      674    10068    2           END;
      675    10069    1   QTS12:;
      676    10070    1         QUEUE$=ADDR(CG$->KQ$CG.QUEUE.WCRL$);
      677    10071    1         RBLK$->KQ$RBLK.QTN$=ADDR(NIL);
      678    10072    1         GOTO QTS5;
      679    10073        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:21   
      680    10074        /**************************************************
      681    10075         **                                              **
      682    10076         **                                              **
      683    10077         **    Searched directed writes only, found none **
      684    10078         **                                              **
      685    10079         **************************************************/
      686    10080
      687    10081    1   DIRONLY:;
      688    10082    1         IF VLP_STATION.CTL.EOFNONE THEN
      689    10083    2           DO;
      690    10084    2           CALL KQL$DDFDUN (STA$->KQ$STA);
      691    10085    2           GOTO BRCEOF;
      692    10086    2           END;
      693    10087    1         IF N$REQ.DVE.DVBYTE.NODAT THEN
      694    10088    2           DO;
      695    10089    2           CALL KQL$DDFDUN (STA$->KQ$STA);
      696    10090    2           GOTO BRCNODAT;
      697    10091    2           END;
      698    10092    1         IF KEY1L+KEY2L ~= 0 THEN
      699    10093    2           DO;
      700    10094                %UNLOCK (G=STA$->KQ$STA.GATE);
      701    10097    2           CALL VRQKEY ALTRET(BRCTYCD);
      702    10098    2           CALL VRNQKEY ALTRET(BRCTYCD);
      703    10099                %LOCK (G=STA$->KQ$STA.GATE);
      704    10102    2           END;
      705    10103    1         CALL MAPBUF ALTRET(BRCBUF);
      706    10104    1         RBLK$->KQ$RBLK.STA$=ADDR(NIL);
      707    10105    1         IF RBLK$->KQ$RBLK.MBLK$~=ADDR(NIL) THEN
      708    10106    1          RBLK$->KQ$RBLK.MBLK$->KQ$MBLK.RBLK = '0'B;
      709    10107    1         RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);
      710    10108    1         LDCT$->NK$LDCT.IOQ$=IOQ$;
      711    10109    1         IF VLP_STATION.EOFTIME~=0 THEN
      712    10110    2           DO;
      713    10111    2           RBLK$->KQ$RBLK.STA$=STA$;
      714    10112                %UNLOCK(G=STA$->KQ$STA.GATE);
      715    10115    2           CALL QEOFTIME;
      716    10116                %LOCK(G=STA$->KQ$STA.GATE);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:22   
      717    10119    2           END;
      718    10120    1         RBLK$->KQ$RBLK.STATE=KQRS_PEND#;
      719    10121    1         CALL KQL$DDFDUN (STA$->KQ$STA);
      720    10122    1         IF ACTQTN$ ~= ADDR(NIL) THEN CALL ACTQTN;
      721    10123    1         IF N$REQ.OPFLG.WAIT='0'B THEN RETURN;
      722    10124    1   REGIMA: I=%SS_IIPCA;                  /* This REG may ALTRET immediately if */
      723    10125                                               /* the ASYNCH flags are set.          */
      724    10126    2           DO WHILE('0'B);
      725    10127    2   REGIM:  I=%SS_IIPC;                 /* This REG will NOT ALTRET           */
      726    10128                                               /* immediately but, like %SS_IIPCA,   */
      727    10129                                               /* it may be broken out of by a       */
      728    10130                                               /* subsequent async event             */
      729    10131    2           END;
      730    10132    1         CALL SSR$REG (I,N$REQ.DCB$->F$DCB.FCN(1)) ALTRET(BRKREG);
      731    10133    1         RETURN;
      732    10134    1   BRKREG: ;
      733    10135    1         IF LDCT$->NK$LDCT.IOQ$ ~= ADDR(NIL) THEN
      734    10136    2           DO;
      735    10137                %LOCK (G=STA$->KQ$STA.GATE);
      736    10140    2           RBLK$=STA$->KQ$STA.RBLK$;
      737    10141    2           IF RBLK$ ~= ADDR(NIL) THEN
      738    10142    3             DO INHIBIT;
      739    10143    4               DO CASE (RBLK$->KQ$RBLK.STATE);
      740    10144
      741    10145    4                 CASE (KQRS_PEND#);
      742    10146    4                   RBLK$->KQ$RBLK.STATE=KQRS_RSIP#;
      743    10147                        %UNLOCK (G=STA$->KQ$STA.GATE);
      744    10150    4                   CALL DEQUEUE;
      745    10151    4                   CALL KQQ$DQEOFTIME(KQ$CG,RBLK$);
      746    10152    4                   CALL KQY$YC (LDCT$->NK$LDCT);
      747    10153    4                   STA$->KQ$STA.RBLK$=ADDR(NIL);
      748    10154    4                   CALL DUMPRBLK;
      749    10155
      750    10156    4                 CASE (KQRS_COMP#);
      751    10157                        %UNLOCK (G=STA$->KQ$STA.GATE);
      752    10160
      753    10161    4                 CASE (KQRS_XFIP#,KQRS_XFDN#);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:23   
      754    10162                        %UNLOCK (G=STA$->KQ$STA.GATE);
      755    10165    4                   GOTO REGIM;
      756    10166
      757    10167    4                 CASE (ELSE);
      758    10168    4                   CALL SC_BCGRBS;
      759    10169
      760    10170    4               END;
      761    10171    3             END;
      762    10172    2           END;
      763    10173    1         RETURN;
      764    10174        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:24   
      765    10175
      766    10176        /**************************************************
      767    10177         **                                              **
      768    10178         **                                              **
      769    10179         **      Got a message to satisfy the read.      **
      770    10180         **      Transfer the data right now.            **
      771    10181         **                                              **
      772    10182         **************************************************/
      773    10183
      774    10184    1   GOTQMSG: ;
      775    10185    2           DO INHIBIT;
      776    10186    2           IF RBLK$->KQ$RBLK.LATCH THEN
      777    10187    3             DO;
      778    10188    3             RBLK$->KQ$RBLK.FROMQ='1'B;
      779    10189    3             RBLK$->KQ$RBLK.QTN$=QTN$;
      780    10190    3             IF QTN$ = ACTQTN$ THEN
      781    10191    4               DO;
      782    10192    4               ACTQTN$=ADDR(NIL);
      783    10193    4               QTN$->KQ$QTN.CRASHACT=QTN$->KQ$QTN.CRASHACT-1;
      784    10194    4               END;
      785    10195    3             ELSE QTN$->KQ$QTN.CNACT=QTN$->KQ$QTN.CNACT+1;
      786    10196    3             END;
      787    10197    2           CALL KQL$QDFDUN (STA$->KQ$STA);
      788    10198    2           END;
      789    10199    1   XFERRD:;
      790    10200    1         IF ACTQTN$ ~= ADDR(NIL) THEN CALL ACTQTN;
      791    10201    1   XFERRD0: ;
      792    10202    1         N$REQ.TYC='0'B;
      793    10203    1         N$REQ.ARSIZE=0;
      794    10204            /*********************************************
      795    10205             *                                           *
      796    10206             *         Give special msg to AU            *
      797    10207             *                                           *
      798    10208             *********************************************/
      799    10209              /**/
      800    10210    1         IF MBLK$->KQ$MBLK.KEY1 = '*FPABT' THEN
      801    10211    2           DO ; /* Lower prio now so this message is treated normally; for TPA */
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:25   
      802    10212    2           MBLK$->KQ$MBLK.PRIO = MBLK$->KQ$MBLK.PRIO - 1;
      803    10213    2           END;
      804    10214              /**/
      805    10215    1         IF MBLK$->KQ$MBLK.PRIO >= %KQ_AUEP# THEN
      806    10216    2           DO;
      807    10217    2           CALL HFF$TRAPALT ALTRET(BRCBUFAU);
      808    10218    2           CALL XFAUEV ALTRET(RDDUN0);
      809    10219    2           CALL HFF$TRAPALT;
      810    10220    2           END;
      811    10221            /*********************************************
      812    10222             *                                           *
      813    10223             *         Chk for no data/no buffer         *
      814    10224             *                                           *
      815    10225             *********************************************/
      816    10226
      817    10227    1         IF MBLK$->KQ$MBLK.DDA = 0 THEN
      818    10228    1          IF MBLK$->KQ$MBLK.MSGSIZE = 0 THEN
      819    10229    2            DO; /* Really no data */
      820    10230    2   XFERRD01: ;
      821    10231    2            IF RBLK$->KQ$RBLK.BUFSIZE = 0 THEN
      822    10232    2             IF RBLK$->KQ$RBLK.LATCH THEN
      823    10233    2   LDTYC:     N$REQ.TYC=%TYC_LD; /* BUF=NIL & LATCH gets error even if no data */
      824    10234    2            GOTO RDDUN;
      825    10235    2            END;
      826    10236    1          ELSE
      827    10237    2            DO; /* Prev error fetching the DBLK */
      828    10238    2            N$REQ.TYC=%TYC_DI;
      829    10239    2            GOTO RDDUN0;
      830    10240    2            END;
      831    10241    1         ELSE /* Data present */ IF RBLK$->KQ$RBLK.BUFSIZE = 0 THEN
      832    10242    1           GOTO LDTYC; /* No fetch if no buffer; speeds TPCP */
      833    10243            /*********************************************
      834    10244             *                                           *
      835    10245             *         Loop for 1 chunk of msg           *
      836    10246             *                                           *
      837    10247             *********************************************/
      838    10248    1   XFERRD1: ;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:26   
      839    10249    1         DBLK$R=MBLK$->KQ$MBLK.STAMP;
      840    10250    1         DDA=RBLK$->KQ$RBLK.NCDDA;
      841    10251    1         CALL KQD$FETCH (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOFETCH);
      842    10252    1   XFERRD10:;
      843    10253    1         I=DBLK$->KQ$DBLK.DSIZE-RBLK$->KQ$RBLK.DBLKX;
      844    10254    1         IF I > RBLK$->KQ$RBLK.BUFSIZE THEN
      845    10255    2           DO;
      846    10256    2           N$REQ.TYC=%TYC_LD;
      847    10257    2           I=RBLK$->KQ$RBLK.BUFSIZE;
      848    10258    2           END;
      849    10259    1         CALL HFF$TRAPALT ALTRET(BRCBUFU);
      850    10260    1         RBLK$->KQ$RBLK.BUF$->B$$CHARS=PINCRC(DBLK$,LENGTHC(KQ$DBLK)+RBLK$->KQ$RBLK.
             10260                  DBLKX)->B$$CHARS;
      851    10261    1         CALL HFF$TRAPALT;
      852    10262    1         N$REQ.ARSIZE=N$REQ.ARSIZE+I;
      853    10263    1         IF NOT N$REQ.TYC THEN
      854    10264        /**/
      855    10265    2           DO; /* No error on this chunk */
      856    10266    2           CALL CHUNKOK ALTRET(RDDUN);
      857    10267    2           GOTO XFERRD1;
      858    10268    2           END;
      859    10269    1   CHERR: /* Error on this chunk */
      860    10270    1         RBLK$->KQ$RBLK.DBLKX=RBLK$->KQ$RBLK.DBLKX+I;
      861    10271    1         CALL KQD$UNLOCK (CG$->KQ$CG,DBLK$);
      862    10272    1         GOTO RDDUN0;
      863    10273            /*********************************************
      864    10274             *                                           *
      865    10275             *         Problems FETCHing the DBLK        *
      866    10276             *                                           *
      867    10277             *********************************************/
      868    10278    1   NOFETCH:;
      869    10279    1         IF DBLK$ = ADDR(NIL) THEN
      870    10280    2           DO;
      871    10281    2           IF DDA = %KQDE_NDFRBLK THEN
      872    10282    3             DO; /* No DEFER blks */
      873    10283    3             DBLK$R=MBLK$->KQ$MBLK.STAMP;
      874    10284    3             DDA=RBLK$->KQ$RBLK.NCDDA;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:27   
      875    10285    3             CALL KQD$FETCHR (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOFETCH1);
      876    10286    3             GOTO XFERRD10;
      877    10287    3   NOFETCH1: ;
      878    10288    3             IF DDA = %KQDE_CREG THEN
      879    10289    4               DO;
      880    10290    4               CALL MAPBUF ALTRET(BRCBUFAU1);
      881    10291    4               LDCT$->NK$LDCT.IOQ$=IOQ$;
      882    10292    4               GOTO FDELAY;
      883    10293    4               END;
      884    10294    3             END;
      885    10295    2   NOFETCHERR:;
      886    10296    3             DO CASE (DDA);
      887    10297
      888    10298    3               CASE (%KQDE_IOERR);
      889    10299    3                 CALL LOGERR (0);
      890    10300    3                 N$REQ.TYC=%TYC_IOERR;
      891    10301
      892    10302    3               CASE (%KQDE_STMP,%KQDE_STATE,%KQDE_BDDA);
      893    10303    3                 CALL LOGERR (0);
      894    10304    3                 N$REQ.TYC=%TYC_DI;
      895    10305
      896    10306    3               CASE (ELSE);
      897    10307    3                 CALL SC_BCGRBS;
      898    10308
      899    10309    3             END;
      900    10310    2   NOFETCH2: ;
      901    10311    2           RBLK$->KQ$RBLK.NCDDA=0;
      902    10312    2           MBLK$->KQ$MBLK.DDA=0; /* Signal fetch err: MSGSIZE ~= 0 and DDA = 0 */
      903    10313    2           RBLK$->KQ$RBLK.CS='1'B;
      904    10314    2           GOTO RDDUN0;
      905    10315    2           END;
      906    10316
      907    10317    1   NOFETCH3:;
      908    10318    1         CALL MAPBUF ALTRET(BRCBUFF);
      909    10319    1         LDCT$->NK$LDCT.IOQ$=IOQ$;
      910    10320    1         DBLK$->KQ$DFRBLK.INFO$=IOQ$;
      911    10321    1         CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQR$FCONT));
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:28   
      912    10322    1         IF N$REQ.OPFLG.WAIT THEN GOTO REGIM;
      913    10323    1         RETURN;
      914    10324        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:29   
      915    10325        /*F* NAME:         KQR$FCONT
      916    10326             PURPOSE:      To continue a READ after a deferred FETCH
      917    10327             CALL:         KQR$FCONT (KQ$DFRPARM)
      918    10328             DESCRIPTION:  The defer params contain the request packet
      919    10329                           pointer, and the results of the FETCH.
      920    10330                           The user buffer has been mapped so as to be
      921    10331                           accessible, and we continue to move the data
      922    10332                           into it.
      923    10333        */
      924    10334    1   KQR$FCONT: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */
      925    10335        /**/
      926    10336    1         DFRP$=ADDR(N$RREQ);
      927    10337    1         IOQ$=DFRP$->KQ$DFRPARM.INFO$;
      928    10338    1         CALL SETUP1;
      929    10339    1         IF RBLK$->KQ$RBLK.STATE ~= KQRS_XFIP# THEN CALL SC_BCGRBS;
      930    10340    1         MBLK$=RBLK$->KQ$RBLK.MBLK$;
      931    10341    1         DBLK$=DFRP$->KQ$DFRPARM.DBLK$;
      932    10342    1         DDA=DFRP$->KQ$DFRPARM.ERR;
      933    10343    1         IF DBLK$ = ADDR(NIL) THEN GOTO NOFETCHERR;
      934    10344    1         GOTO MOVERD2;
      935    10345        /**/
      936    10346        /*F* NAME:         KQR$GOTMSG
      937    10347             PURPOSE:      To satisfy a read with a message from the comgroup
      938    10348             CALL:         KQR$GOTMSG (N$REQ)
      939    10349             DESCRIPTION:  Called from SENDMSG in KQW$WRITE when a message
      940    10350                           contained in DBLKs (as opposed to a writer's buffer)
      941    10351                           satisfies a pending read.
      942    10352
      943    10353                           Entered with the MBLK pointed to by the reading
      944    10354                           RBLK (which has been removed from the queue if it
      945    10355                           was in it), the RBLK state set to KQRS_XFIP, and
      946    10356                           RBLK.NCDDA set to MBLK.DDA, and
      947    10357                           the reader's station unlocked.
      948    10358
      949    10359                           The data is transferred to the reader's buffer
      950    10360                           and the reader is COMPed.
      951    10361        */
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:30   
      952    10362    1   KQR$GOTMSG: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */
      953    10363        /**/
      954    10364    1         CALL SETUP;
      955    10365    1         N$REQ.OPFLG.CLR='1'B;
      956    10366    1         MBLK$=RBLK$->KQ$RBLK.MBLK$;
      957    10367    1         N$REQ.TYC='0'B;
      958    10368    1         N$REQ.ARSIZE=0;
      959    10369            /*********************************************
      960    10370             *                                           *
      961    10371             *         Give special msg to AU            *
      962    10372             *                                           *
      963    10373             *********************************************/
      964    10374              /**/
      965    10375    1         IF MBLK$->KQ$MBLK.KEY1 = '*FPABT' THEN
      966    10376    2           DO ; /* Lower prio now so this message is treated normally; for TPA */
      967    10377    2           MBLK$->KQ$MBLK.PRIO = MBLK$->KQ$MBLK.PRIO - 1;
      968    10378    2           END;
      969    10379              /**/
      970    10380    1         IF MBLK$->KQ$MBLK.PRIO >= %KQ_AUEP# THEN
      971    10381    2           DO;
      972    10382                %LOCK (G=KQ_XFGATE);
      973    10385    2           B$CGPT$->B$$XFPTW=RBLK$->KQ$RBLK.PTW;
      974    10386    2           CALL HFC$ASSOCCLR (%CGWSQ,0,2);
      975    10387    2           CALL XFAUEV;
      976    10388    2           B$CGPT$->B$$XFPTW='0'B;
      977    10389    2           CALL HFC$ASSOCCLR (%CGWSQ,0,2);
      978    10390                %UNLOCK (G=KQ_XFGATE);
      979    10393    2           IF N$REQ.TYC THEN GOTO RDDUN0;
      980    10394    2           END;
      981    10395            /*********************************************
      982    10396             *                                           *
      983    10397             *         Chk for no data/no buffer         *
      984    10398             *                                           *
      985    10399             *********************************************/
      986    10400
      987    10401    1         IF MBLK$->KQ$MBLK.DDA = 0 THEN
      988    10402    1          IF MBLK$->KQ$MBLK.MSGSIZE ~= 0 THEN
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:31   
      989    10403    1           CALL SC_BCGRBS; /* Howcum no DDA? */
      990    10404    1          ELSE GOTO XFERRD01;
      991    10405    1         ELSE /* Data present */ IF RBLK$->KQ$RBLK.BUFSIZE = 0 THEN
      992    10406    1           GOTO LDTYC; /* No fetch if no buffer; speeds TPCP */
      993    10407            /*********************************************
      994    10408             *                                           *
      995    10409             *         Loop for 1 chunk of msg           *
      996    10410             *                                           *
      997    10411             *********************************************/
      998    10412    1   MOVERD1: ;
      999    10413    1         DBLK$R=MBLK$->KQ$MBLK.STAMP;
     1000    10414    1         DDA=RBLK$->KQ$RBLK.NCDDA;
     1001    10415    1         CALL KQD$FETCH (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOFETCHU);
     1002    10416    1   MOVERD2:;
     1003    10417    1         I=DBLK$->KQ$DBLK.DSIZE-RBLK$->KQ$RBLK.DBLKX;
     1004    10418    1         IF I > RBLK$->KQ$RBLK.BUFSIZE THEN
     1005    10419    2           DO;
     1006    10420    2           N$REQ.TYC=%TYC_LD;
     1007    10421    2           I=RBLK$->KQ$RBLK.BUFSIZE;
     1008    10422    2           END;
     1009    10423              %LOCK (G=KQ_XFGATE);
     1010    10426    1         B$CGPT$->B$$XFPTW=RBLK$->KQ$RBLK.PTW;
     1011    10427    1         CALL HFC$ASSOCCLR (%CGWSQ,0,2);
     1012    10428    1         RBLK$->KQ$RBLK.BUF$->B$$CHARS=PINCRC(DBLK$,LENGTHC(KQ$DBLK)+RBLK$->KQ$RBLK.
             10428                  DBLKX)->B$$CHARS;
     1013    10429    1         B$CGPT$->B$$XFPTW='0'B;
     1014    10430    1         CALL HFC$ASSOCCLR (%CGWSQ,0,2);
     1015    10431              %UNLOCK (G=KQ_XFGATE);
     1016    10434    1         N$REQ.ARSIZE=N$REQ.ARSIZE+I;
     1017    10435    1         IF N$REQ.TYC THEN GOTO CHERR;
     1018    10436                                /* No error on this chunk */
     1019    10437    1         CALL CHUNKOK ALTRET(RDDUN);
     1020    10438    1         GOTO MOVERD1;
     1021    10439            /*********************************************
     1022    10440             *                                           *
     1023    10441             *         Problems FETCHing the DBLK        *
     1024    10442             *                                           *
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:32   
     1025    10443             *********************************************/
     1026    10444    1   NOFETCHU:;
     1027    10445    1         IF DBLK$ ~= ADDR(NIL) THEN
     1028    10446    2           DO;
     1029    10447    2           DBLK$->KQ$DFRBLK.INFO$=IOQ$;
     1030    10448    2           CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQR$FCONT));
     1031    10449    2           RETURN;
     1032    10450    2           END;
     1033    10451    1         IF DDA=%KQDE_NDFRBLK
     1034    10452    1         THEN GOTO FDELAY; /* No DEFER blks */
     1035    10453    1         ELSE GOTO NOFETCHERR;
     1036    10454        /**/
     1037    10455        /*F* NAME:         KQR$FDELAY
     1038    10456             PURPOSE:      To delay for no defer blocks
     1039    10457             CALL:         KQR$FDELAY (KQ$STA)
     1040    10458             DESCRIPTION:  Puts the station on the list of guys waiting
     1041    10459                           for defer blocks...to be re-awakened off the
     1042    10460                           clock.
     1043    10461        */
     1044    10462    1   KQR$FDELAY: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */
     1045    10463        /**/
     1046    10464    1         STA$=ADDR(N$RREQ);
     1047    10465    1         CG$=STA$->KQ$STA.CG$;
     1048    10466    1         RBLK$=STA$->KQ$STA.RBLK$;
     1049    10467    1   FDELAY:;
     1050    10468    1         RBLK$->KQ$RBLK.STATE=KQRS_NFET#;
     1051    10469              %LOCK (G=STA$->KQ$STA.GATE);
     1052    10472    1         STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
     1053    10473              %UNLOCK (G=STA$->KQ$STA.GATE);
     1054    10476              %LOCK (G=CG$->KQ$CG.GATE.CG);
     1055    10479    1         RBLK$->KQ$RBLK.MBLK$->KQ$MBLK.DFLNK$=CG$->KQ$CG.DFHD$;
     1056    10480    1         CG$->KQ$CG.DFHD$=STA$;
     1057    10481              %UNLOCK (G=CG$->KQ$CG.GATE.CG);
     1058    10484    1         RETURN;
     1059    10485        /**/
     1060    10486        /*F* NAME:         KQR$DFETCH
     1061    10487             PURPOSE:      To re-try a fetch which failed due to no
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:33   
     1062    10488                           defer blocks.
     1063    10489             CALL:         KQR$DFETCH (N$REQ)
     1064    10490             DESCRIPTION:  Called off the clock every once in a while
     1065    10491                           to try the fetch again.
     1066    10492        */
     1067    10493    1   KQR$DFETCH: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */
     1068    10494        /**/
     1069    10495    1         CALL SETUP;
     1070    10496    1         N$REQ.OPFLG.CLR='1'B;
     1071    10497    1         IF RBLK$->KQ$RBLK.STATE ~= KQRS_NFET# THEN CALL SC_BCGRBS;
     1072    10498    1         RBLK$->KQ$RBLK.STATE=KQRS_XFIP#;
     1073    10499    1         CALL KQP$UNLOCK (STA$->KQ$STA);
     1074    10500    1         MBLK$=RBLK$->KQ$RBLK.MBLK$;
     1075    10501    1         DFRP$=ADDR(NIL);
     1076    10502    1         GOTO MOVERD1;
     1077    10503        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:34   
     1078    10504        /***
     1079    10505         ***
     1080    10506         ***               FINISH UP THE READ HERE
     1081    10507         ***
     1082    10508         ***
     1083    10509         ***/
     1084    10510
     1085    10511    1   RDDUN: ;
     1086    10512    1         IF N$REQ.TYC = '0'B THEN
     1087    10513    1          IF RBLK$->KQ$RBLK.NCDDA = 0 THEN
     1088    10514    2            DO;
     1089    10515                                /* SET COMPLETED SUCCESSFULLY */
     1090    10516    2            RBLK$->KQ$RBLK.CS='1'B;
     1091    10517    2            IF RBLK$->KQ$RBLK.LATCH THEN
     1092    10518    3              DO;
     1093    10519    3              IF NOT STA$->KQ$STA.SUCCREAD THEN
     1094    10520    4                DO;
     1095    10521                     %LOCK (G=STA$->KQ$STA.GATE);
     1096    10524    4                STA$->KQ$STA.SUCCREAD='1'B;
     1097    10525                     %UNLOCK (G=STA$->KQ$STA.GATE);
     1098    10528    4                END;
     1099    10529                                /* ASSIGN MIDEXTX FOR THIS LATCHED MSG,
     1100    10530                                   FOR USE IN LATCHED WRITES. */
     1101    10531    3              IF MBLK$->KQ$MBLK.PRIO >= %KQ_AUEP# THEN
     1102    10532    4                DO;
     1103    10533    4                RBLK$->KQ$RBLK.MIDEXTX=0;
     1104    10534    4                RBLK$->KQ$RBLK.MIDEXTV=0;
     1105    10535    4                GOTO RDDUN0;
     1106    10536    4                END;
     1107    10537    3              ELSE
     1108    10538    3               IF NOT CG$->KQ$CG.AUCTL.BIGMXT THEN
     1109    10539    4                 DO;
     1110    10540    5                   DO I = 0 TO 5;
     1111    10541    5                   IF ADDR(MBLK$->KQ$MBLK.MID.XT)->B$$MIDEXT.EXTS(I) = 0 THEN
     1112    10542    6                     DO;
     1113    10543    6                     RBLK$->KQ$RBLK.MIDEXTX=I;
     1114    10544    6                     RBLK$->KQ$RBLK.MIDEXTV=0;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:35   
     1115    10545    6                     GOTO RDDUN0;
     1116    10546    6                     END;
     1117    10547    5                   END;
     1118    10548                                  /* SPAWN-ABILITY USED UP.  SET SO HE CAN'T
     1119    10549                                     LATCH A WRITE TO IT. */
     1120    10550    4                 RBLK$->KQ$RBLK.MIDEXTV=63;
     1121    10551    4                 END;
     1122    10552    3               ELSE    /* BIGMXT is set, start counting at 0 */
     1123    10553    3                RBLK$->KQ$RBLK.MIDEXTV=0;
     1124    10554    3              END;
     1125    10555    2            END;
     1126    10556    1   RDDUN0:;
     1127    10557    1         CALL SETRCOMP;
     1128    10558    1   READCOMP:;
     1129    10559    1         STA$->KQ$STA.READS=STA$->KQ$STA.READS+1;
     1130    10560    1         RBLK$->KQ$RBLK.STATE=KQRS_COMP#;
     1131    10561    1         IF KQ_LOG.DSIO THEN
     1132    10562    1          CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_READC,0,
     1133    10563    1          VLP_STATION.MSGID,
     1134    10564    1          ADDR(VLP_STATION.MSGID)->B$$HALF,
     1135    10565    1          SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
     1136    10566    1          SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
     1137    10567    1         CALL NIO$COMPC (N$REQ);
     1138    10568    1         RETURN;
     1139    10569
     1140    10570        /**/
     1141    10571    1   BRCBUFAU:;
     1142    10572    1         CALL HFF$TRAPALT;
     1143    10573    1   BRCBUFAU1:;
     1144    10574    1         N$REQ.TYC=%TYC_MTRAP;
     1145    10575    1         GOTO RDDUN0;
     1146    10576    1   BRCBUFU:;
     1147    10577    1         CALL HFF$TRAPALT;
     1148    10578    1         N$REQ.TYC=%TYC_MTRAP;
     1149    10579    1         CALL KQD$UNLOCK (CG$->KQ$CG,DBLK$);
     1150    10580    1         GOTO RDDUN0;
     1151    10581        /**/
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:36   
     1152    10582    1   COMPBAD: PROC;
     1153    10583        /**/
     1154    10584    2         IF KQ_LOG.DSIO THEN
     1155    10585    3           DO;
     1156    10586    3           KEY1L=0;
     1157    10587    4             DO I = 1 TO 35;
     1158    10588    4             IF ADDR(N$REQ.TYC)->B$$BITS.B(I) THEN
     1159    10589    5               DO;
     1160    10590    5               KEY1L=I;
     1161    10591    5               GOTO CB1;
     1162    10592    5               END;
     1163    10593    4             END;
     1164    10594    3   CB1:    ;
     1165    10595    3           CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_READC,KEY1L,
     1166    10596    3           VLP_STATION.MSGID,
     1167    10597    3           ADDR(VLP_STATION.MSGID)->B$$HALF,
     1168    10598    3           SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
     1169    10599    3           SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
     1170    10600    3           END;
     1171    10601    2         CALL NIO$COMPCNS (N$REQ);
     1172    10602    2         RETURN;
     1173    10603    2   END COMPBAD;
     1174    10604    1   BRCCRCW:;
     1175    10605    1         N$REQ.TYC=%TYC_CGCRCW;
     1176    10606    1         GOTO BADCOMP;
     1177    10607    1   BRCBUFQ:;
     1178    10608    1         CALL KQL$QDFDUN (STA$->KQ$STA);
     1179    10609    1         GOTO BRCBUF0;
     1180    10610    1   BRCBUF:;
     1181    10611    1         CALL KQL$DDFDUN (STA$->KQ$STA);
     1182    10612    1   BRCBUF0:;
     1183    10613    1         N$REQ.TYC=%TYC_MTRAP;
     1184    10614    1         GOTO BRCOMP;
     1185    10615    1   BRCBUFF:;
     1186    10616    1         CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(NIL));
     1187    10617    1         GOTO BRCBUFAU1;
     1188    10618    1   BRCTYCQ:;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:37   
     1189    10619    1         CALL KQL$QDFDUN (STA$->KQ$STA);
     1190    10620    1         GOTO BRCTYC;
     1191    10621    1   BRCTYCD:;
     1192    10622              %LOCK (G=STA$->KQ$STA.GATE);
     1193    10625    1         CALL KQL$DDFDUN (STA$->KQ$STA);
     1194    10626    1   BRCTYC:;
     1195    10627    1         N$REQ.TYC=TYC;
     1196    10628    1         GOTO BRCOMP;
     1197    10629    1   BRCKEY:;
     1198    10630    1         N$REQ.TYC=%TYC_CGKEYV;
     1199    10631    1         GOTO BRCOMP;
     1200    10632    1   BRDISC:;
     1201    10633    1         N$REQ.TYC=%TYC_DISC;
     1202    10634    1         GOTO BRCOMP;
     1203    10635    1   BRCFUL:;
     1204    10636    1         N$REQ.TYC=%TYC_CGFULL;
     1205    10637    1         GOTO BRCOMP;
     1206    10638    1   BRCRERR0:;
     1207    10639    1         CALL KQL$QDFDUN (STA$->KQ$STA);
     1208    10640    1         GOTO BRCRERR1;
     1209    10641    1   BRCRERR:;
     1210    10642    1         CALL KQL$DDFDUN (STA$->KQ$STA);
     1211    10643    1   BRCRERR1:;
     1212    10644    2           DO CASE (RBLK$->KQ$RBLK.ERR);
     1213    10645    2             CASE (KQGE_QFUL#);
     1214    10646    2               N$REQ.TYC=%TYC_CGFULL;
     1215    10647    2               GOTO BRCOMP;
     1216    10648    2             CASE (ELSE);
     1217    10649    2               CALL SC_BCGRBS;
     1218    10650    2           END;
     1219    10651    1   BRCFULL:;
     1220    10652    1         N$REQ.TYC=%TYC_CGFULL;
     1221    10653    1         GOTO BADCOMP;
     1222    10654    1   BRCCWRV:;
     1223    10655              %UNLOCK (G=STA$->KQ$STA.GATE);
     1224    10658    1         N$REQ.TYC=%TYC_CGCWRV;
     1225    10659    1         GOTO BADCOMP;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:38   
     1226    10660    1   BRCEOFUNL:;
     1227    10661              %UNLOCK (G=STA$->KQ$STA.GATE);
     1228    10664    1   BRCEOF:;
     1229    10665    1         N$REQ.TYC=%TYC_EOF;
     1230    10666    1         GOTO BRCOMP;
     1231    10667    1   BRCNODAT:;
     1232    10668    1         B$JIT$->B$JIT.ERR = ERR_NODAT;
     1233    10669    1   BRCOMP:;
     1234    10670    2           DO INHIBIT;
     1235    10671                %LOCK (G=STA$->KQ$STA.GATE);
     1236    10674    2           STA$->KQ$STA.RBLK$=ADDR(NIL);
     1237    10675    2           CALL DUMPRBLK;
     1238    10676    2           LDCT$->NK$LDCT.IOQ$=ADDR(NIL);
     1239    10677    2           GOTO BADCOMPUNL;
     1240    10678    2   BADATCOMPUNL:;
     1241    10679    2           STA$->KQ$STA.RBLK$=ADDR(NIL);
     1242    10680    2           CALL DUMPRBLK;
     1243    10681    2   BADCOMPUNL:;
     1244    10682                %UNLOCK (G=STA$->KQ$STA.GATE);
     1245    10685    2           GOTO BADCOMP1;
     1246    10686    2           END;
     1247    10687    1   BADCOMP: ;
     1248    10688    1         LDCT$->NK$LDCT.IOQ$=ADDR(NIL);
     1249    10689    1   BADCOMP1:;
     1250    10690    1         IF ACTQTN$ ~= ADDR(NIL) THEN CALL ACTQTN;
     1251    10691    1         CALL COMPBAD;
     1252    10692    1   ALTRT:;
     1253    10693    1         ALTRETURN;
     1254    10694        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:39   
     1255    10695        /**/
     1256    10696        /*F* NAME:         KQR$VALIDATE
     1257    10697             PURPOSE:      To validate an outstanding read, and if no longer
     1258    10698                           valid, abort it
     1259    10699             CALL:         KQR$VALIDATE (N$REQ)
     1260    10700             DESCRIPTION:  Called when something has happened which may in-
     1261    10701                           validate a read request (e.g. his station is de-
     1262    10702                           activated, or the station he is reading has dis-
     1263    10703                           connected).  Entered with the reading station
     1264    10704                           locked, and the current read definitely pending.
     1265    10705                           Both trees are locked, and are not to be unlocked
     1266    10706                           unless the read gets aborted.  This is to allow
     1267    10707                           checking the read without allowing a writer to
     1268    10708                           slip thru, or the user to close the DCB.
     1269    10709                           If the read is no longer valid, it is aborted
     1270    10710                           by calling NIO$COMP with the appropriate TYC,
     1271    10711                           and we ALTRET, unlocking the station block and
     1272    10712                           then both trees.  Else we RETURN.
     1273    10713        */
     1274    10714    1   KQR$VALIDATE: ENTRY(N$RREQ) ALTRET;
     1275    10715        /**/
     1276    10716    1         CALL SETUP;
     1277    10717    1         CALL CHKACT ALTRET(VAL0);
     1278    10718    1         KEY1L=RBLK$->KQ$RBLK.KEY1L;
     1279    10719    1         KEY2L=RBLK$->KQ$RBLK.KEY2L;
     1280    10720    1         CALL VRQKEYNL ALTRET(NTVALID);
     1281    10721    1         CALL VRNQKEYNL ALTRET(NTVALID);
     1282    10722    1         RETURN;
     1283    10723    1   NTVALID:;
     1284    10724    1         N$REQ.TYC=TYC;
     1285    10725    1   VAL0: ;
     1286    10726    1         RBLK$->KQ$RBLK.STATE=KQRS_RSIP#;
     1287    10727              %UNLOCK (G=STA$->KQ$STA.GATE);
     1288    10730    1         CALL KQT$UBT (CG$->KQ$CG);
     1289    10731    1         CALL DEQUEUE;
     1290    10732    1         CALL KQQ$DQEOFTIME(CG$->KQ$CG,RBLK$);
     1291    10733    1         N$REQ.OPFLG.CLR='1'B;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:40   
     1292    10734    1         GOTO BRCOMP;
     1293    10735        /**/
     1294    10736        /*F* NAME:         KQR$COMP
     1295    10737             PURPOSE:      To I/O COMP a read
     1296    10738             CALL:         KQR$COMP (N$REQ)
     1297    10739             DESCRIPTION:  Called from KQW$WRITE when a write direct from
     1298    10740                           the writer's buffer satisfies a read.  In this
     1299    10741                           case reader's buffer is stuffed, the MBLK is
     1300    10742                           pointed to by the RBLK (which is removed from
     1301    10743                           the queue if it was in it), and the RBLK state
     1302    10744                           set to KQRS_XFDN (xfer done).  Then we enter
     1303    10745                           here to call NIO$COMP after stuffing the request
     1304    10746                           packet with the params of the message.  The
     1305    10747                           reading station is not locked.
     1306    10748
     1307    10749                           The read is guaranteed not to have specified
     1308    10750                           LATCH, nor was the write continued.
     1309    10751        */
     1310    10752    1   KQR$COMP: ENTRY(N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */
     1311    10753        /**/
     1312    10754    1         CALL SETUP;
     1313    10755    1         N$REQ.OPFLG.CLR='1'B;
     1314    10756    1         RBLK$->KQ$RBLK.CS='1'B;
     1315    10757    1         MBLK$=RBLK$->KQ$RBLK.MBLK$;
     1316    10758    1         CALL SETRCOMP;
     1317    10759    1         GOTO READCOMP;
     1318    10760        /**/
     1319    10761        /*F* NAME:         KQR$TRUNC
     1320    10762             PURPOSE:      To 'trunc' a DCB station's RBLK
     1321    10763             CALL:         KQR$TRUNC (KQ$STA)
     1322    10764             INPUT:        Station gate locked
     1323    10765                           Does not unlock station.
     1324    10766        */
     1325    10767    1   KQR$TRUNC: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */
     1326    10768        /**/
     1327    10769    1         STA$=ADDR(N$RREQ);
     1328    10770    1         CG$=STA$->KQ$STA.CG$;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:41   
     1329    10771    1         RBLK$=STA$->KQ$STA.RBLK$;
     1330    10772    1         IF RBLK$ ~= ADDR(NIL) THEN
     1331    10773    1          IF  RBLK$->KQ$RBLK.STATE = KQRS_COMP#
     1332    10774    1          AND RBLK$->KQ$RBLK.NCDDA = 0
     1333    10775    1          AND RBLK$->KQ$RBLK.MBLK$ = ADDR(NIL)
     1334    10776    1          AND RBLK$->KQ$RBLK.LATCH = '0'B THEN
     1335    10777    2            DO INHIBIT;
     1336    10778    2            STA$->KQ$STA.RBLK$=ADDR(NIL);
     1337    10779    2            CALL DUMPRBLK;
     1338    10780    2            END;
     1339    10781    1         RETURN;
     1340    10782        /**/
     1341    10783        /*F* NAME:         KQR$GETQUEUE
     1342    10784             PURPOSE:      To acquire the queue for read
     1343    10785             CALL:         KQR$GETQUEUE (KQ$STA)
     1344    10786             DESCRIPTION:  See GETQUEUE
     1345    10787        */
     1346    10788    1   KQR$GETQUEUE: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */
     1347    10789        /**/
     1348    10790    1         STA$=ADDR(N$RREQ);
     1349    10791    1         CG$=STA$->KQ$STA.CG$;
     1350    10792    1         CALL GETQUEUE;
     1351    10793    1         RETURN;
     1352    10794        /**/
     1353    10795        /*F* NAME:         KQR$GETRBLK
     1354    10796             PURPOSE:      To acquire an RBLK for a station
     1355    10797             CALL:         KQR$GETRBLK (KQ$STA);
     1356    10798             INPUT:        Nothing locked
     1357    10799             DESCRIPTION:  ALTRETs if none, else returns with an RBLK
     1358    10800                           in KQ$STA.RBLK$
     1359    10801        */
     1360    10802    1   KQR$GETRBLK: ENTRY (N$RREQ) ALTRET;
     1361    10803        /**/
     1362    10804    1         STA$=ADDR(N$RREQ);
     1363    10805    1         CG$=STA$->KQ$STA.CG$;
     1364    10806              %LOCK (G=STA$->KQ$STA.GATE);
     1365    10809    1         CALL GETRBLK ALTRET(ALTRT);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:42   
     1366    10810              %UNLOCK (G=STA$->KQ$STA.GATE);
     1367    10813    1         RETURN;
     1368    10814        /**/
     1369    10815        /*F* NAME:         KQR$LOGERR
     1370    10816             PURPOSE:      To log an error encountered while reading a
     1371    10817                           message's DBLK for a TERM
     1372    10818             CALL:         KQR$LOGERR (KQ$STA)
     1373    10819             DESCRIPTION:  The station's RBLK and MBLK are logged.
     1374    10820        */
     1375    10821    1   KQR$LOGERR: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */
     1376    10822        /**/
     1377    10823    1         STA$=ADDR(N$RREQ);
     1378    10824    1         CG$=STA$->KQ$STA.CG$;
     1379    10825    1         CALL LOGERR (1);
     1380    10826    1         RETURN;
     1381    10827        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:43   
     1382    10828        /**/
     1383    10829        /*F* NAME:         KQR$CLEANUP
     1384    10830             PURPOSE:      To clean up a DCB station during close
     1385    10831             CALL:         KQR$CLEANUP (KQ$STA)
     1386    10832             DESCRIPTION:  Called with the station deactivated.  Aborts the
     1387    10833                           current write if any via KQU$DELETE.  Aborts the
     1388    10834                           current read if any.  Disposes of the current
     1389    10835                           latched read if any via UNLATCH DELETE.
     1390    10836                           Disposes of a completed (unlatched)
     1391    10837                           read by dumping the RBLK and its MBLK (if any).
     1392    10838
     1393    10839                           Sets DSID to infinity.
     1394    10840                           Does special processing of AU-event messages
     1395    10841                           in the station's queue if this is the AU.
     1396    10842
     1397    10843                           If this is the AU, events that need to be saved
     1398    10844                           are sent to the '*GORGO' station.
     1399    10845                           Called only for DCBs, and on user behalf.
     1400    10846                           Nothing is locked upon entry.
     1401    10847                           ALTRETs if comgroup is full.
     1402    10848        */
     1403    10849    1   KQR$CLEANUP: ENTRY (N$RREQ) ALTRET;
     1404    10850        /**/
     1405    10851    1         BADCLS=0;
     1406    10852    1         GOTO CLEANUP;
     1407    10853        /**/
     1408    10854        /*F* NAME:         KQR$CLEANUPB
     1409    10855             PURPOSE:      To clean up a station's read during a 'bad'
     1410    10856                           close
     1411    10857             DESCRIPTION:  Just like KQR$CLEANUP, but latched inputs are
     1412    10858                           RERUN, not deleted.
     1413    10859        */
     1414    10860    1   KQR$CLEANUPB: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */
     1415    10861        /**/
     1416    10862    1         BADCLS=1;
     1417    10863    1   CLEANUP:;
     1418    10864    1         STA$=ADDR(N$RREQ);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:44   
     1419    10865    1         LDCT$=STA$->KQ$STA.LDCT$;
     1420    10866    1         CG$=STA$->KQ$STA.CG$;
     1421    10867    1   CL0:  ;
     1422    10868    1         CALL KQT$LBT (CG$->KQ$CG);
     1423    10869              %LOCK (G=STA$->KQ$STA.GATE);
     1424    10872    1         RBLK$=STA$->KQ$STA.RBLK$;
     1425    10873    1         IOQ$=LDCT$->NK$LDCT.IOQ$;
     1426    10874    1         IF RBLK$ ~= ADDR(NIL) THEN
     1427    10875    2           DO CASE (RBLK$->KQ$RBLK.STATE);
     1428    10876
     1429    10877    2             CASE (KQRS_PEND#);
     1430    10878    2               CALL CHKACT;
     1431    10879    2               RBLK$->KQ$RBLK.STATE=KQRS_RSIP#;
     1432    10880                    %UNLOCK (G=STA$->KQ$STA.GATE);
     1433    10883    2               CALL KQT$UBT (CG$->KQ$CG);
     1434    10884    2               CALL DEQUEUE;
     1435    10885    2               CALL KQQ$DQEOFTIME(CG$->KQ$CG,RBLK$);
     1436    10886    2               LDCT$->NK$LDCT.IOQ$=ADDR(NIL);
     1437    10887    2               CALL COMPBAD;
     1438    10888    2               GOTO CL10;
     1439    10889
     1440    10890    2             CASE (ELSE);
     1441    10891                    %UNLOCK (G=STA$->KQ$STA.GATE);
     1442    10894    2               CALL KQT$UBT (CG$->KQ$CG);
     1443    10895    2               CALL SSR$REG (%SS_SL,,1);
     1444    10896    2               GOTO CL0;
     1445    10897
     1446    10898    2             CASE (KQRS_COMP#);
     1447    10899                    %UNLOCK (G=STA$->KQ$STA.GATE);
     1448    10902    2               CALL KQT$UBT (CG$->KQ$CG);
     1449    10903    2               IF RBLK$->KQ$RBLK.LATCH THEN
     1450    10904    3                 DO;
     1451    10905    3                 IF BADCLS = 1 THEN
     1452    10906    3                  IF (CG$->KQ$CG.HOLDSTA$ = ADDR(NIL))
     1453    10907    3                  THEN
     1454    10908    3                   CALL KQU$UNLATCH (STA$->KQ$STA,RUFPT.V,I) ALTRET(UNLALT);
     1455    10909    3                  ELSE
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:45   
     1456    10910    3                   CALL KQU$UNLATCH (STA$->KQ$STA,HUFPT.V,I)
     1457    10911    4                   WHENALTRETURN DO;
     1458    10912    4   UNLALT:           IF I_ERR.CODE=%E$CULRAUEVR THEN
             10912            /* LATCHED READ IS A *AUEV MSG - CAN'T RERUN */
     1459    10913    4                      GOTO CL5;
     1460    10914    4                     END;
     1461    10915    3                 ELSE
     1462    10916    3   CL5:           CALL KQU$UNLATCH (STA$->KQ$STA,DUFPT.V,I)
     1463    10917    4                  WHENALTRETURN DO;
     1464    10918    4                    IF I_ERR.CODE=%E$CULUSR THEN
             10918                             /* LATCHED READ NOT SUCCESSFUL - CAN'T DELETE */
     1465    10919    4                     CALL KQU$UNLATCH (STA$->KQ$STA,RUFPT.V,I);
     1466    10920    4                    END;
     1467    10921    3                 END;
     1468    10922    2               ELSE
     1469    10923    3                 DO INHIBIT;
     1470    10924    3                 IF RBLK$->KQ$RBLK.MBLK$ ~= ADDR(NIL) THEN
     1471    10925    3                  CALL KQU$DELREAD (STA$->KQ$STA);
     1472    10926    3   CL10:         STA$->KQ$STA.RBLK$=ADDR(NIL);
     1473    10927    3                 CALL DUMPRBLK;
     1474    10928    3                 END;
     1475    10929
     1476    10930    2             CASE (KQRS_UNLA#);
     1477    10931                    %UNLOCK (G=STA$->KQ$STA.GATE);
     1478    10934    2               CALL KQT$UBT (CG$->KQ$CG);
     1479    10935    2               CALL KQU$UNLATCH (STA$->KQ$STA,DUFPT.V,I);
     1480    10936    2           END;
     1481    10937    1         ELSE
     1482    10938    2           DO;
     1483    10939                %UNLOCK (G=STA$->KQ$STA.GATE);
     1484    10942    2           CALL KQT$UBT (CG$->KQ$CG);
     1485    10943    2           END;
     1486    10944    1   CL20: ;
     1487    10945                          /*    Delete any unfinished
     1488    10946                           *    writes
     1489    10947                           */
     1490    10948    1         IF STA$->KQ$STA.MBLK$ ~= ADDR(NIL) THEN
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:46   
     1491    10949    2           DO;
     1492    10950    2           MBLK$=STA$->KQ$STA.MBLK$;
     1493    10951    2           STA$->KQ$STA.MBLK$=ADDR(NIL);
     1494    10952    3             DO WHILE (MBLK$ ~= ADDR(NIL));
     1495    10953    3             P$=MBLK$->KQ$MBLK.LNK$;
     1496    10954    3             CALL KQU$DELMSG (CG$->KQ$CG,MBLK$->KQ$MBLK);
     1497    10955    3             MBLK$=P$;
     1498    10956    3             END;
     1499    10957    2           END;
     1500    10958    1   CLSTARS:;
     1501    10959    1         IF  STA$ ~= CG$->KQ$CG.JRNLSTA$
     1502    10960    1         AND STA$ ~= CG$->KQ$CG.GORGOSTA$ THEN
     1503    10961    2           DO;
     1504    10962    2           CALL KQX$SETTIME (TIMCHK);
     1505    10963    2           IF STA$->KQ$STA.BTN.KEY = '*FWCG' THEN GOTO CLS25;
     1506    10964    2           STA$->KQ$STA.DSID=BITBIN('777777777777'O);
     1507    10965    2           IF STA$->KQ$STA.AU THEN
     1508    10966    3   CLS25:    DO;
     1509    10967                  %LOCK (G=STA$->KQ$STA.GATE);
     1510    10970    3             CALL GETRBLK ALTRET(ALTRT);
     1511    10971                  %UNLOCK (G=STA$->KQ$STA.GATE);
     1512    10974    3             IF STA$->KQ$STA.BTN.KEY = '*FWCG' THEN
     1513    10975    4               DO;
     1514    10976    4               RBLK$->KQ$RBLK.KEY1L=0;
     1515    10977    4               RBLK$->KQ$RBLK.KEY2L=0;
     1516    10978    4               END;
     1517    10979    3             ELSE
     1518    10980    4               DO;
     1519    10981    4               IF CG$->KQ$CG.QISS THEN
     1520    10982    5                 DO;
     1521    10983    5                 RBLK$->KQ$RBLK.KEY1L=0;
     1522    10984    5                 RBLK$->KQ$RBLK.KEY2L=1;
     1523    10985    5                 RBLK$->KQ$RBLK.KEY2='*';
     1524    10986    5                 END;
     1525    10987    4               ELSE
     1526    10988    5                 DO;
     1527    10989    5                 RBLK$->KQ$RBLK.KEY1L=1;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:47   
     1528    10990    5                 RBLK$->KQ$RBLK.KEY1='*';
     1529    10991    5                 RBLK$->KQ$RBLK.KEY2L=0;
     1530    10992    5                 END;
     1531    10993    4               END;
     1532    10994    3   CLS10:    ;
     1533    10995    3             CALL KQX$CHKTIME (TIMCHK) ALTRET(CLS15);
     1534    10996    3             CALL SSR$REG (%SS_QE);
     1535    10997    3             CALL KQX$SETTIME (TIMCHK);
     1536    10998    3   CLS15:    ;
     1537    10999                  %LOCK (G=STA$->KQ$STA.GATE);
     1538    11002    3             RBLK$->KQ$RBLK.STATE=KQRS_RSIP#;
     1539    11003    3             CALL KQL$DDFIND (STA$->KQ$STA,MBLK$) ALTRET(CLS20);
     1540    11004    3             CALL KQL$DDFDUN (STA$->KQ$STA);
     1541    11005    3             STA$->KQ$STA.RBLK$=ADDR(NIL);
     1542    11006    3             I=RBLK$->KQ$RBLK.ERR;
     1543    11007    3             CALL DUMPRBLK;
     1544    11008    3             IF I = KQGE_QFUL# THEN ALTRETURN;
     1545    11009    3             RETURN;
     1546    11010    3   CLS20:    ;
     1547    11011    3             RBLK$->KQ$RBLK.STATE=KQRS_COMP#;
     1548    11012    3             MBLK$=RBLK$->KQ$RBLK.MBLK$;
     1549    11013    3             IF STA$->KQ$STA.BTN.KEY = '*FWCG' THEN GOTO CLS24;
     1550    11014    3             IF MBLK$->KQ$MBLK.PRIO >= %KQ_AUEP# THEN
     1551    11015    4               DO CASE (MBLK$->KQ$MBLK.FC);
     1552    11016
     1553    11017    4                 CASE (%CG_TBRK#);
     1554    11018    4                   CALL GETTERM ALTRET(CLS22);
     1555    11019    4                   IF P$->KQ$STA.EVNT = '0'B THEN
     1556    11020    5                     DO;
     1557    11021    5                     P$->KQ$STA.EVNT='1'B;
     1558    11022    5                     P$->KQ$STA.EVSC=MBLK$->KQ$MBLK.MID.XT;
     1559    11023    5                     END;
     1560    11024                        %UNLOCK (G=P$->KQ$STA.GATE);
     1561    11027                        %UNLOCK (G=KQ$STREE.GATE);
     1562    11030    4   CLS22:          ;
     1563    11031
     1564    11032    4                 CASE (%CG_UNLR#,%CG_UNLH#,%CG_UNLD#,%CG_WARN#);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:48   
     1565    11033    4                   MBLK$->KQ$MBLK.DSTA='*GORGO';
     1566    11034    4   CLS24:          MBLK$->KQ$MBLK.RBLK = '0'B;
     1567    11035    4                   RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);
     1568    11036    4                   STA$->KQ$STA.MBLK$=MBLK$;
     1569    11037    4                   CALL KQW$SENDAUP (STA$->KQ$STA);
     1570    11038    4                   GOTO CLS10;
     1571    11039
     1572    11040    4               END;
     1573    11041
     1574    11042    3             CALL KQU$DELREAD (STA$->KQ$STA);
     1575    11043    3             GOTO CLS10;
     1576    11044    3             END;
     1577    11045    2           END;
     1578    11046    1         RETURN;
     1579    11047        /**/
     1580    11048        /*F* NAME:         KQR$RECOVER
     1581    11049             PURPOSE:      To clean up a DCB station when a crashed
     1582    11050                           comgroup is being reopened.
     1583    11051             CALL:         KQR$RECOVER (KQ$STA)
     1584    11052             DESCRIPTION:  Just like KQR$CLEANUP, but care must be excercised
     1585    11053                           ALTRETs if comgroup full.
     1586    11054        */
     1587    11055    1   KQR$RECOVER: ENTRY (N$RREQ) ALTRET;
     1588    11056        /**/
     1589    11057    1         STA$=ADDR(N$RREQ);
     1590    11058    1         CG$=STA$->KQ$STA.CG$;
     1591    11059    1         LDCT$=ADDR(NIL);
     1592    11060    1         IOQ$=ADDR(NIL);
     1593    11061    1         STA$->KQ$STA.MREQ=0;
     1594    11062    1         RBLK$=STA$->KQ$STA.RBLK$;
     1595    11063    1         IF RBLK$ ~= ADDR(NIL) THEN
     1596    11064    2           DO;
     1597    11065    3             DO CASE (RBLK$->KQ$RBLK.STATE);
     1598    11066
     1599    11067    3               CASE (KQRS_PEND#,KQRS_RSIP#);
     1600    11068    3                 GOTO RCVR1;
     1601    11069
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:49   
     1602    11070    3               CASE (KQRS_COMP#,KQRS_XFIP#,KQRS_XFDN#,KQRS_NFET#);
     1603    11071    3                 IF RBLK$->KQ$RBLK.LATCH THEN
     1604    11072    4                   DO;
     1605    11073    4                   IF  RBLK$->KQ$RBLK.FROMQ
     1606    11074    4                   AND STA$ ~= CG$->KQ$CG.JRNLSTA$ THEN
     1607    11075    5                     DO;
     1608    11076    5                     IF RBLK$->KQ$RBLK.QTN$->KQ$QTN.AUTORCVR = '0'B THEN
     1609    11077    6                       DO;
     1610    11078                                /* If AUTORCVR off, HOLD it */
     1611    11079    6                       RBLK$->KQ$RBLK.QTN$->KQ$QTN.MXACT=0;
     1612    11080    6                       CALL KQU$UNLATCH (STA$->KQ$STA,HUFPT.V,I);
     1613    11081    6                       END;
     1614    11082    5                     ELSE GOTO RCVR0;
     1615    11083    5                     END;
     1616    11084    4                   ELSE
     1617    11085                                /* else RERUN */
     1618    11086    4   RCVR0:           CALL KQU$UNLATCH (STA$->KQ$STA,RUFPT.V,I);
     1619    11087    4                   END;
     1620    11088    3                 ELSE /* not LATCHed */
     1621    11089    4                   DO;
     1622    11090    4                   CALL KQU$DELREAD (STA$->KQ$STA);
     1623    11091    4   RCVR1:          STA$->KQ$STA.RBLK$=ADDR(NIL);
     1624    11092    4                   CALL DUMPRBLK;
     1625    11093    4                   END;
     1626    11094
     1627    11095    3               CASE (KQRS_UNLA#); /* In middle of normal UNLATCH; continue it */
     1628    11096    3                 CALL KQU$UNLATCH (STA$->KQ$STA,DUFPT.V,I);
     1629    11097
     1630    11098    3             END;
     1631    11099
     1632    11100    2           RBLK$=ADDR(NIL);
     1633    11101    2           END;
     1634    11102    1         GOTO CL20;
     1635    11103        /**/
     1636    11104        /*F* NAME:         KQR$FWCGF
     1637    11105             PURPOSE:      To finish M$FWCG REATTR
     1638    11106             CALL:         KQR$FWCGF (KQ$STA)    <---- *FWCG station
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:50   
     1639    11107             DESCRIPTION:  Called at the end of M$FWCG.  All reattred messages
     1640    11108                           have been written to the *FWCG station.  They
     1641    11109                           are to be removed from there and sent to their
     1642    11110                           proper destination. */
     1643    11111    1   KQR$FWCGF: ENTRY (N$RREQ) ALTRET;
     1644    11112        /**/
     1645    11113    1         STA$=ADDR(N$RREQ);
     1646    11114    1         CG$=STA$->KQ$STA.CG$;
     1647    11115    1         LDCT$=ADDR(NIL);
     1648    11116    1         IOQ$=ADDR(NIL);
     1649    11117    1         GOTO CLSTARS;
     1650    11118        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:51   
     1651    11119        /**/
     1652    11120        /******************************************************************************
     1653    11121        *                                                                             *
     1654    11122        *  SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS  *
     1655    11123        * S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S *
     1656    11124        * S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S     *
     1657    11125        *  SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS  *
     1658    11126        *     S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S *
     1659    11127        * S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S *
     1660    11128        *  SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS  *
     1661    11129        *                                                                             *
     1662    11130        ******************************************************************************/
     1663    11131
     1664    11132        /****************************************************************
     1665    11133        *****************************************************************/
     1666    11134        /*D* NAME:         GETTERM
     1667    11135             PURPOSE:      To find a terminal station from an MBLK
     1668    11136             DESCRIPTION:  Called during rundown of AU message list.
     1669    11137                           MBLK$ points to an MBLK whose origin was
     1670    11138                           at one time a terminal station.  If the
     1671    11139                           station is still connected and still a
     1672    11140                           terminal then we RETURN with the STREE
     1673    11141                           and station gate locked.  Else ALTRET.
     1674    11142        */
     1675    11143    1   GETTERM: PROC ALTRET;
     1676    11144        /**/
     1677    11145              %LOCK (G=KQ$STREE.GATE);
     1678    11148    2         IF CG$->KQ$CG.QISS THEN KEY=MBLK$->KQ$MBLK.KEY1;
     1679    11149    2         ELSE KEY=MBLK$->KQ$MBLK.KEY2;
     1680    11150    2         CALL KQB$SRCH (KQ$STREE,KEY,P$) ALTRET(ALT1);
     1681    11151              %LOCK (G=P$->KQ$STA.GATE);
     1682    11154    2         IF  P$->KQ$STA.TERM
     1683    11155    2         AND P$->KQ$STA.LDCT$ ~= ADDR(NIL) THEN RETURN;
     1684    11156              %UNLOCK (G=P$->KQ$STA.GATE);
     1685    11159    2   ALT1: ;
     1686    11160              %UNLOCK (G=KQ$STREE.GATE);
     1687    11163    2         ALTRETURN;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:52   
     1688    11164    2   END GETTERM;
     1689    11165        /****************************************************************
     1690    11166        *****************************************************************/
     1691    11167        /*D* NAME:         LOGERR
     1692    11168             PURPOSE:      To log an error encountered while reading
     1693    11169                           a message's DBLK
     1694    11170             DESCRIPTION:  The station's RBLK and MBLK are errlogged
     1695    11171        */
     1696    11172    1   LOGERR: PROC (CODE);
     1697    11173        /**/
     1698    11174    2   DCL CODE UBIN;
     1699    11175        /**/
     1700    11176              %LOCK (G=KQ_ERRLOG_GATE);
     1701    11179    2         KQ_ERRLOG_BFR.CODE=%KQELOG_KQR_FTCH;
     1702    11180    2         P$=ADDR(KQ_ERRLOG_BFR.INFO);
     1703    11181    2         KQ_ERRLOG_BFR.INFO='0'B;
     1704    11182    2         P$->B$$CHAR8=STA$->KQ$STA.BTN.KEY;
     1705    11183    2         P$=PINCRW(P$,2);
     1706    11184    2         P$->B$$UBIN=CODE;
     1707    11185    2         P$=PINCRW(P$,1);
     1708    11186    2         P$->KQ$MBLK=STA$->KQ$STA.RBLK$->KQ$RBLK.MBLK$->KQ$MBLK;
     1709    11187    2         P$=PINCRW(P$,SIZEW(KQ$MBLK));
     1710    11188    2         IF CODE ~= 0 THEN
     1711    11189    3           DO;
     1712    11190    3           P$->KQ$RBLKT=STA$->KQ$STA.RBLK$->KQ$RBLKT;
     1713    11191    3           KQ_ERRLOG_BFR.SIZ=3+SIZEW(KQ$MBLK)+SIZEW(KQ$RBLKT);
     1714    11192    3           END;
     1715    11193    2         ELSE
     1716    11194    3           DO;
     1717    11195    3           P$->KQ$RBLK=STA$->KQ$STA.RBLK$->KQ$RBLK;
     1718    11196    3           KQ_ERRLOG_BFR.SIZ=3+SIZEW(KQ$MBLK)+SIZEW(KQ$RBLK);
     1719    11197    3           END;
     1720    11198    2         CALL KQD$ERRLOG (CG$->KQ$CG);
     1721    11199    2         RETURN;
     1722    11200    2   END LOGERR;
     1723    11201        /****************************************************************
     1724    11202        *****************************************************************/
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:53   
     1725    11203        /*D* NAME:         GETQUEUE
     1726    11204             PURPOSE:      To become the reader of the queue
     1727    11205             DESCRIPTION:  If the queue is not busy, makes us
     1728    11206                           the current reader.  Else blocks us for
     1729    11207                           the queue.
     1730    11208                           Returns Q gate locked.
     1731    11209        */
     1732    11210    1   GETQUEUE: PROC;
     1733    11211        /**/
     1734    11212              %LOCK (G=KQ$QTREE.GATE);
     1735    11215    2         IF NOT KQ$QUEUE.BUSY THEN
     1736    11216    3           DO;
     1737    11217    3           KQ$QUEUE.BUSY.RIP='1'B;
     1738    11218    3           KQ$QUEUE.RUSR#=S_CUN;
     1739    11219    3           RETURN;
     1740    11220    3           END;
     1741    11221    2         IF S_CUN = KQ$QUEUE.RUSR# THEN CALL SC_BCGRBS;
     1742    11222    2         CALL KQL$QDELAYR (CG$->KQ$CG,STA$->KQ$STA);
     1743    11223              %UNLOCK (G=KQ$QTREE.GATE);
     1744    11226    2         CALL SSR$REG (%SS_QA);
     1745    11227              %LOCK (G=KQ$QTREE.GATE);
     1746    11230    2         IF S_CUN ~= KQ$QUEUE.RUSR# THEN CALL SC_BCGRBS;
     1747    11231    2         RETURN;
     1748    11232    2   END GETQUEUE;
     1749    11233        /****************************************************************
     1750    11234        *****************************************************************/
     1751    11235        /*D* NAME:         GETRBLK
     1752    11236             PURPOSE:      To get an RBLK
     1753    11237             INPUT:        Station locked
     1754    11238             DESCRIPTION:  Gets one if possible, and returns with
     1755    11239                           RBLK$ and KQ$STA.RBLK$ set up.  Else
     1756    11240                           ALTRETs with station unlocked.
     1757    11241        */
     1758    11242    1   GETRBLK: PROC ALTRET;
     1759    11243        /**/
     1760    11244    2   DCL T$ PTR;
     1761    11245        /**/
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:54   
     1762    11246    2         CALL KQM$GETRBLK (CG$->KQ$CG,T$,I) ALTRET(GR0);
     1763    11247    2         GOTO GR1;
     1764    11248    2   GR0:  ;
     1765    11249              %UNLOCK (G=STA$->KQ$STA.GATE);
     1766    11252    2         IF STA$->KQ$STA.MONDCB THEN ALTRETURN;
     1767    11253    2         T$=STA$;
     1768    11254    2         I=KQMR_RBLK#;
     1769    11255    2         CALL KQM$GETBR (CG$->KQ$CG,T$,I) ALTRET(ALTRT);
     1770    11256              %LOCK (G=STA$->KQ$STA.GATE);
     1771    11259    2   GR1:  STA$->KQ$STA.RBLK$=T$;
     1772    11260    2         RBLK$=T$;
     1773    11261    2         RETURN;
     1774    11262    2   ALTRT:;
     1775    11263    2         ALTRETURN;
     1776    11264        /**/
     1777    11265    2   DUMPRBLK: ENTRY ALTRET; /* !!Doesn't ALTRET!! */
     1778    11266        /**/
     1779    11267    3           DO INHIBIT;
     1780    11268    3           T$=RBLK$;
     1781    11269    3           CALL KQM$RELRBLK (CG$->KQ$CG,T$);
     1782    11270    3           END;
     1783    11271    2         RETURN;
     1784    11272        /**/
     1785    11273    2   DEQUEUE: ENTRY ALTRET; /* !!Doesn't ALTRET!! */
     1786    11274        /**/
     1787    11275    2         T$=RBLK$;
     1788    11276    2         CALL KQQ$DEQUEUE (CG$->KQ$CG,T$);
     1789    11277    2         RETURN;
     1790    11278    2   END GETRBLK;
     1791    11279        /****************************************************************
     1792    11280        *****************************************************************/
     1793    11281        /*D* NAME:        QEOFTIME
     1794    11282             PURPOSE:     To place the current READ on the KQ$CG.EOFTIMEHD$ list
     1795    11283             DESCRIPTION: RBLK$->KQ$RBLK is placed on the KQ$CG.EOFTIMEHD$ list
     1796    11284                          in order of expiration by KQ$RBLK.EOFTIME.
     1797    11285                          The KQ$CG.EOFTIMEHD$ list is gated by KQ$STREE.GATE
     1798    11286                          so that gate is locked on entry and unlocked on exit.
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:55   
     1799    11287        */
     1800    11288    1   QEOFTIME: PROC;
     1801    11289        /**/
     1802    11290              %LOCK(G=KQ$STREE.GATE);
     1803    11293    2         CALL QEOFT;
     1804    11294              %UNLOCK(G=KQ$STREE.GATE);
     1805    11297    2         RETURN;
     1806    11298    2   END QEOFTIME;
     1807    11299        /**/
     1808    11300        /*D* NAME:        QEOFTIMENL
     1809    11301             PURPOSE:     To place the current READ on the KQ$CG.EOFTIMEHD$ list
     1810    11302             DESCRIPTION: Same as QEOFTIME except the STREE gate is not locked or
     1811    11303                          unlocked.
     1812    11304        */
     1813    11305    1   QEOFTIMENL: PROC;
     1814    11306        /**/
     1815    11307    2         CALL QEOFT;
     1816    11308    2         RETURN;
     1817    11309    2   END QEOFTIMENL;
     1818    11310        /**/
     1819    11311    1   QEOFT: PROC;
     1820    11312        /**/
     1821    11313    2   DCL SECS UBIN;
     1822    11314    2   DCL P$ PTR;
     1823    11315    2   DCL R$ PTR;
     1824    11316    2         SECS=VLP_STATION.EOFTIME+CG$->KQ$CG.EOFTIME;
     1825    11317    2         RBLK$->KQ$RBLK.EOFTIME=SECS;
     1826    11318    2         P$=ADDR(CG$->KQ$CG.EOFTIMEHD$);
     1827    11319    2         R$=P$->B$$PTR;
     1828    11320    3           DO WHILE(R$~=ADDR(NIL));
     1829    11321    3           IF R$->KQ$RBLK.EOFTIME>SECS THEN GOTO FOUNDIT;
     1830    11322    3           P$=ADDR(R$->KQ$RBLK.EOFTIMELNK$);
     1831    11323    3           R$=P$->B$$PTR;
     1832    11324    3           END;
     1833    11325    2   FOUNDIT:;
     1834    11326    2         RBLK$->KQ$RBLK.EOFTIMELNK$=P$->B$$PTR;
     1835    11327    2         P$->B$$PTR=RBLK$;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:56   
     1836    11328    2         RETURN;
     1837    11329    2   END QEOFT;
     1838    11330        /****************************************************************
     1839    11331        *****************************************************************/
     1840    11332        /*D* NAME:         CHUNKOK
     1841    11333             PURPOSE:      To finish the read of a message chunk
     1842    11334             INPUT:        I = # bytes actually xferred.
     1843    11335             DESCRIPTION:  ALTRETs if the next chunk is not to be read,
     1844    11336                           RETURNs else.
     1845    11337        */
     1846    11338    1   CHUNKOK: PROC ALTRET;
     1847    11339        /**/
     1848    11340    2   DCL FLNKDA UBIN;
     1849    11341    2   DCL T$ PTR;
     1850    11342        /**/
     1851    11343    2         RBLK$->KQ$RBLK.BUFSIZE=RBLK$->KQ$RBLK.BUFSIZE-I;
     1852    11344    2         RBLK$->KQ$RBLK.BUF$=PINCRC(RBLK$->KQ$RBLK.BUF$,I);
     1853    11345    2         RBLK$->KQ$RBLK.DBLKX=0;
     1854    11346    2         RBLK$->KQ$RBLK.NCDDA=DBLK$->KQ$DBLK.FLNKDA;
     1855    11347    2         FLNKDA = DBLK$->KQ$DBLK.FLNKDA;
     1856    11348    2         IF RBLK$->KQ$RBLK.LATCH THEN
     1857    11349    3           DO;
     1858    11350    3           T$=STA$;
     1859    11351    3           CALL KQD$LREL (CG$->KQ$CG,DBLK$,T$);
     1860    11352    3           END;
     1861    11353    2         ELSE CALL KQD$DELETE (CG$->KQ$CG,DBLK$);
     1862    11354    2         IF FLNKDA=0 THEN ALTRETURN;
     1863    11355    2         RETURN;
     1864    11356    2   END CHUNKOK;
     1865    11357        /****************************************************************
     1866    11358        *****************************************************************/
     1867    11359        /*D* NAME:         XFAUEV
     1868    11360             PURPOSE:      To transfer an AU event to his buffer
     1869    11361             DESCRIPTION:  B$CGAURD frames his buffer, and the goodies
     1870    11362                           are extracted from the MBLK and stuffed therein.
     1871    11363
     1872    11364                           Xfers RBLK.BUFSIZE bytes of the B$CGAURD
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:57   
     1873    11365                           into his buffer.  If his buffer is too
     1874    11366                           short, sets N$REQ.TYC.LD and RBLK.DBLKX
     1875    11367                           to his buffer size, and ALTRETs.  On
     1876    11368                           entry, RBLK.DBLKX is expected to be the
     1877    11369                           index into his buffer.  If his buffer
     1878    11370                           is long enough, RETURNs.
     1879    11371
     1880    11372                           Special action is taken for some events.
     1881    11373        */
     1882    11374    1   XFAUEV: PROC ALTRET;
     1883    11375        /**/
     1884    11376    2   DCL T$ PTR;
     1885    11377        /**/
     1886    11378    2         IF RBLK$->KQ$RBLK.AUXFDN THEN RETURN;
     1887    11379    2         CGAURD.X.EVENT=MBLK$->KQ$MBLK.FC;
     1888    11380    2         IF CG$->KQ$CG.QISS THEN
     1889    11381    2          CGAURD.X.STATION=MBLK$->KQ$MBLK.KEY1;
     1890    11382    2         ELSE CGAURD.X.STATION=MBLK$->KQ$MBLK.KEY2;
     1891    11383    2         CGAURD.X.INFO=MBLK$->KQ$MBLK.MID.XT;
     1892    11384        /**/
     1893    11385    3           DO CASE (CGAURD.X.EVENT);
     1894    11386    3             CASE (%CG_TBRK#);
     1895    11387                    %LOCK (G=KQ$STREE.GATE);
     1896    11390    3               CALL KQB$SRCH (KQ$STREE,CGAURD.X.STATION,T$) ALTRET(TBRK1);
     1897    11391                    %LOCK (G=T$->KQ$STA.GATE);
     1898    11394    3               IF T$->KQ$STA.TERM THEN
     1899    11395    3                IF T$->KQ$STA.EVCNT > 0 THEN
     1900    11396    3                 T$->KQ$STA.EVCNT=T$->KQ$STA.EVCNT-1;
     1901    11397                    %UNLOCK (G=T$->KQ$STA.GATE);
     1902    11400    3   TBRK1:      ;
     1903    11401                    %UNLOCK (G=KQ$STREE.GATE);
     1904    11404
     1905    11405    3           END;
     1906    11406        /**/
     1907    11407    2         I=SIZEC(B$CGAURD)-RBLK$->KQ$RBLK.DBLKX;
     1908    11408    2         IF I > RBLK$->KQ$RBLK.BUFSIZE THEN
     1909    11409    3           DO;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:58   
     1910    11410    3           N$REQ.TYC=%TYC_LD;
     1911    11411    3           I=RBLK$->KQ$RBLK.BUFSIZE;
     1912    11412    3           END;
     1913    11413    2         RBLK$->KQ$RBLK.BUF$->B$$CHARS=PINCRC(ADDR(CGAURD.X),RBLK$->KQ$RBLK.DBLKX)->
             11413                  B$$CHARS;
     1914    11414    2         RBLK$->KQ$RBLK.BUFSIZE=RBLK$->KQ$RBLK.BUFSIZE-I;
     1915    11415    2         RBLK$->KQ$RBLK.BUF$=PINCRC(RBLK$->KQ$RBLK.BUF$,I);
     1916    11416    2         N$REQ.ARSIZE=I;
     1917    11417    2         IF N$REQ.TYC
     1918    11418    3         THEN DO;
     1919    11419    3           RBLK$->KQ$RBLK.DBLKX=RBLK$->KQ$RBLK.DBLKX+I;
     1920    11420    3           ALTRETURN;
     1921    11421    3           END;
     1922    11422    3         ELSE DO;
     1923    11423    3           RBLK$->KQ$RBLK.DBLKX=0;
     1924    11424    3           RBLK$->KQ$RBLK.AUXFDN='1'B;
     1925    11425    3           END;
     1926    11426    2         RETURN;
     1927    11427    2   END XFAUEV;
     1928    11428        /****************************************************************
     1929    11429        *****************************************************************/
     1930    11430        /*D* NAME:         ACTQTN
     1931    11431             PURPOSE:      To call KQQ$ACT
     1932    11432             DESCRIPTION:  A read which causes KQU$UNLATCHF to be called
     1933    11433                           must decr CNACT in the Q-tree node where the
     1934    11434                           prev msg came from if it does not take another
     1935    11435                           message from that same node.
     1936    11436        */
     1937    11437    1   ACTQTN: PROC;
     1938    11438        /**/
     1939    11439        %LOCK (G=KQ$QTREE.GATE);
     1940    11442    2         ACTQTN$->KQ$QTN.CNACT=ACTQTN$->KQ$QTN.CNACT-1;
     1941    11443    2         ACTQTN$->KQ$QTN.CRASHACT=ACTQTN$->KQ$QTN.CRASHACT-1;
     1942    11444    2         IF ACTQTN$->KQ$QTN.CNACT < 0 THEN
     1943    11445    2          CALL SC_CGCALZ; /* SEE S* IN KQU$UNLATCH */
     1944    11446    2         IF ACTQTN$->KQ$QTN.CNACT = ACTQTN$->KQ$QTN.MXACT-1 THEN
     1945    11447    2          CALL KQQ$ACT (CG$->KQ$CG,ACTQTN$);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:59   
     1946    11448    2         ELSE
     1947    11449    3           DO;
     1948    11450                %UNLOCK (G=KQ$QTREE.GATE);
     1949    11453    3           END;
     1950    11454    2         ACTQTN$=ADDR(NIL);
     1951    11455    2         RETURN;
     1952    11456    2   END ACTQTN;
     1953    11457        /****************************************************************
     1954    11458        *****************************************************************/
     1955    11459        /*D* NAME:         VRQKEY
     1956    11460             PURPOSE:      To verify the Q-key for a read
     1957    11461             DESCRIPTION:  The read key (MSGTYP or STATION) that keys the
     1958    11462                           Q-tree is verified.  ALTRET if the key is illegal,
     1959    11463                           with TYC set appropriately, else return.
     1960    11464                           N$REQ is the reading req packet.
     1961    11465                           KEY1L, KEY2L are the key lengths.
     1962    11466        */
     1963    11467    1   VRQKEY: PROC ALTRET;
     1964    11468        /**/
     1965    11469    2   DCL TREE$ PTR;
     1966    11470        /**/
     1967    11471    2         IF KEY1L = 0 THEN RETURN;
     1968    11472    2         TREE$=CG$->KQ$CG.QUEUE.QTREE$;
     1969    11473              %LOCK (G=KQ$QTREE.GATE);
     1970    11476    2         CALL VRQ ALTRET(ALTRT);
     1971    11477    2   RTN:  ;
     1972    11478              %UNLOCK (G=TREE$->KQ$THDR.GATE);
     1973    11481    2         RETURN;
     1974    11482    2   ALTRT:;
     1975    11483              %UNLOCK (G=TREE$->KQ$THDR.GATE);
     1976    11486    2   ALTRTNL:;
     1977    11487    2         ALTRETURN;
     1978    11488        /*D* NAME:         VRQKEYNL
     1979    11489             PURPOSE:      To verify the Q-key for a read
     1980    11490             DESCRIPTION:  Like VRQKEY; does not lock or unlock Q-tree
     1981    11491        */
     1982    11492    2   VRQKEYNL: ENTRY ALTRET;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:60   
     1983    11493        /**/
     1984    11494    2         IF KEY1L = 0 THEN RETURN;
     1985    11495    2         TREE$=CG$->KQ$CG.QUEUE.QTREE$;
     1986    11496    2         CALL VRQ ALTRET(ALTRTNL);
     1987    11497    2         RETURN;
     1988    11498        /*D* NAME:         VRNQKEY
     1989    11499             PURPOSE:      To verify the non Q-key for a read
     1990    11500             DESCRIPTION:  The read key (MSGTYP or STATION) that does not
     1991    11501                           key the Q-tree is verified, as in VRQKEY.
     1992    11502        */
     1993    11503    2   VRNQKEY: ENTRY ALTRET;
     1994    11504        /**/
     1995    11505    2         IF KEY2L = 0 THEN RETURN;
     1996    11506    2         IF CG$->KQ$CG.QISS THEN TREE$=ADDR(CG$->KQ$CG.TTREE);
     1997    11507    2         ELSE TREE$=ADDR(CG$->KQ$CG.STREE);
     1998    11508              %LOCK (G=TREE$->KQ$THDR.GATE);
     1999    11511    2         CALL VRNQ ALTRET(ALTRT);
     2000    11512    2         GOTO RTN;
     2001    11513        /*D* NAME:         VRNQKEYNL
     2002    11514             PURPOSE:      To verify the non Q-key for a read
     2003    11515             DESCRIPTION:  Like VRNQKEY; does not lock or unlock non Q-tree
     2004    11516        */
     2005    11517    2   VRNQKEYNL: ENTRY ALTRET;
     2006    11518    2         IF KEY2L = 0 THEN RETURN;
     2007    11519    2         IF CG$->KQ$CG.QISS THEN TREE$=ADDR(CG$->KQ$CG.TTREE);
     2008    11520    2         ELSE TREE$=ADDR(CG$->KQ$CG.STREE);
     2009    11521    2         CALL VRNQ ALTRET(ALTRTNL);
     2010    11522    2         RETURN;
     2011    11523        /**/
     2012    11524    2   VRQ:  PROC ALTRET;
     2013    11525        /**/
     2014    11526    3         IF KEY1L = 8 THEN
     2015    11527    4           DO;
     2016    11528                           /* SPECIFIC Q-KEY */
     2017    11529    4           CALL KQB$SRCH (KQ$QTREE,RBLK$->KQ$RBLK.KEY1,QTN$) ALTRET(VR1);
     2018    11530    4           CALL CHKSTA ALTRET(VR8);
     2019    11531    4           RETURN;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:61   
     2020    11532    4   VR1:    ;
     2021    11533    4           IF CG$->KQ$CG.XQTNLGL = '0'B
     2022    11534    5           THEN DO;
     2023    11535    5             IF KEY1L >= 1
     2024    11536    5             AND SUBSTR(RBLK$->KQ$RBLK.KEY1,0,1) = '*'
     2025    11537    5             AND CG$->KQ$CG.QISS = '0'B
     2026    11538    5             THEN RETURN;
     2027    11539    5             GOTO VR7;
     2028    11540    5             END;
     2029    11541    4           IF (CG$->KQ$CG.QISS AND CG$->KQ$CG.AUCTL.RAS = '0'B)
     2030    11542    4           THEN GOTO VR8;
     2031    11543    4           RETURN;
     2032    11544    4           END;
     2033    11545                           /* WILD-CARDED Q-KEY */
     2034    11546    3         CALL KQB$SRCH (KQ$QTREE,RBLK$->KQ$RBLK.KEY1,QTN$) ALTRET(VR2);
     2035    11547    3         GOTO VR5;
     2036    11548    3   VR2:  ;
     2037    11549    3         IF QTN$ = ADDR(NIL) THEN GOTO VR1;
     2038    11550    3         IF ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1 <=
     2039    11551    3         ADDR(QTN$->KQ$QTN.STA.BTN.KEY)->B$$KEY1 THEN GOTO VR4;
     2040    11552    3   VR3:  ;
     2041    11553    3         QTN$=QTN$->KQ$QTN.STA.BTN.FLINK$;
     2042    11554    3         IF QTN$ = ADDR(NIL) THEN GOTO VR1;
     2043    11555    3   VR4:  ;
     2044    11556    3         IF ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1 =
     2045    11557    3         ADDR(QTN$->KQ$QTN.STA.BTN.KEY)->B$$KEY1 THEN
     2046    11558    3   VR5:   CALL CHKSTA ALTRET(VR3);
     2047    11559    3         RETURN;
     2048    11560    3   VR7:  ;
     2049    11561    3         TYC=%TYC_CGKEYV;
     2050    11562    3         ALTRETURN;
     2051    11563    3   VR8:  ;
     2052    11564    3         TYC=%TYC_DISC;
     2053    11565    3         ALTRETURN;
     2054    11566        /**/
     2055    11567    3   VRNQ: ENTRY ALTRET;
     2056    11568        /**/
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:62   
     2057    11569    3         IF KEY2L = 8 THEN
     2058    11570    4           DO;
     2059    11571                                /* SPECIFIC KEY */
     2060    11572    4           CALL KQB$SRCH (TREE$->KQ$THDR,RBLK$->KQ$RBLK.KEY2,QTN$) ALTRET(VRNQ1);
     2061    11573    4           CALL CHKSTANQ ALTRET(VR8);
     2062    11574    4           RETURN;
     2063    11575    4   VRNQ1:  ;
     2064    11576    4           IF CG$->KQ$CG.XOTNLGL = '0'B
     2065    11577    5           THEN DO;
     2066    11578    5             IF KEY2L >= 1
     2067    11579    5             AND SUBSTR(RBLK$->KQ$RBLK.KEY2,0,1) = '*'
     2068    11580    5             AND CG$->KQ$CG.QISS
     2069    11581    5             THEN RETURN;
     2070    11582    5             GOTO VR7;
     2071    11583    5             END;
     2072    11584    4           IF (CG$->KQ$CG.QISS = '0'B AND CG$->KQ$CG.AUCTL.RAS = '0'B)
     2073    11585    4           THEN GOTO VR8;
     2074    11586    4           RETURN;
     2075    11587    4           END;
     2076    11588                                /* WILD-CARDED KEY */
     2077    11589    3         CALL KQB$SRCH (TREE$->KQ$THDR,RBLK$->KQ$RBLK.KEY2,QTN$) ALTRET(VRNQ2);
     2078    11590    3         GOTO VRNQ5;
     2079    11591    3   VRNQ2:;
     2080    11592    3         IF QTN$ = ADDR(NIL) THEN GOTO VRNQ1;
     2081    11593    3         IF ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2 <=
     2082    11594    3         ADDR(QTN$->KQ$QTN.STA.BTN.KEY)->B$$KEY2 THEN GOTO VRNQ4;
     2083    11595    3   VRNQ3:;
     2084    11596    3         QTN$=QTN$->KQ$QTN.STA.BTN.FLINK$;
     2085    11597    3         IF QTN$ = ADDR(NIL) THEN GOTO VRNQ1;
     2086    11598    3   VRNQ4:;
     2087    11599    3         IF ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2 =
     2088    11600    3         ADDR(QTN$->KQ$QTN.STA.BTN.KEY)->B$$KEY2 THEN
     2089    11601    4           DO;
     2090    11602    4   VRNQ5:  ;
     2091    11603    4           CALL CHKSTANQ ALTRET(VRNQ3);
     2092    11604    4           RETURN;
     2093    11605    4           END;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:63   
     2094    11606    3         GOTO VRNQ1;
     2095    11607    3   END VRQ;
     2096    11608    2   END VRQKEY;
     2097    11609        /****************************************************************
     2098    11610        *****************************************************************/
     2099    11611        /*D* NAME:         CHKSTA
     2100    11612             PURPOSE:      To check if a node is legal if it's a station
     2101    11613             DESCRIPTION:  QTN$ points to a node in the Q-tree (CHKSTA)
     2102    11614                           or the other tree (CHKSTANQ).  If the tree involved
     2103    11615                           is the station tree, then if the station pointed
     2104    11616                           to is disconnected or deactivated, we ALTRET,
     2105    11617                           if RAS is illegal, or the other key begins with
     2106    11618                           '*' (i.e. the message type begins with '*'
     2107    11619                           - this is required in order to make M$GLINEATTR
     2108    11620                           and M$SETFP work).
     2109    11621                           In all other cases, normal return.
     2110    11622                           The tree must be locked.
     2111    11623        */
     2112    11624    1   CHKSTA: PROC ALTRET;
     2113    11625        /**/
     2114    11626    2         IF CG$->KQ$CG.QISS = '0'B THEN RETURN;
     2115    11627    2         IF CG$->KQ$CG.AUCTL.RAS THEN
     2116    11628    3           DO;
     2117    11629    3           IF KEY2L = 0 THEN RETURN;
     2118    11630    3           IF SUBSTR (RBLK$->KQ$RBLK.KEY2,0,1) ~= '*' THEN RETURN;
     2119    11631    3           END;
     2120    11632    2         GOTO CHK;
     2121    11633    2   CHKSTANQ: ENTRY ALTRET;
     2122    11634    2         IF CG$->KQ$CG.QISS THEN RETURN;
     2123    11635    2         IF CG$->KQ$CG.AUCTL.RAS THEN
     2124    11636    3           DO;
     2125    11637    3           IF KEY1L = 0 THEN RETURN;
     2126    11638    3           IF SUBSTR(RBLK$->KQ$RBLK.KEY1,0,1) ~= '*' THEN RETURN;
     2127    11639    3           END;
     2128    11640    2   CHK:  ;
     2129    11641    2         IF QTN$->KQ$STA.LDCT$ = ADDR(NIL) THEN ALTRETURN;
     2130    11642    2         IF QTN$->KQ$STA.LDCT$->NK$LDCT.LKFLG.ACTIVE = '0'B THEN ALTRETURN;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:64   
     2131    11643    2         RETURN;
     2132    11644    2   END CHKSTA;
     2133    11645        /****************************************************************
     2134    11646        *****************************************************************/
     2135    11647        /*D* NAME:         SETRCOMP
     2136    11648             PURPOSE:      To set up for COMPing a read
     2137    11649             DESCRIPTION:  RBLK$ points to the RBLK, N$REQ is the
     2138    11650                           request packet, LDCT$ points to the reader's
     2139    11651                           LDCT, MBLK$ points to the MBLK.
     2140    11652
     2141    11653                           NILs out the LDCT.IOQ$, sets the
     2142    11654                           VLP_STATION in auto with the params for the
     2143    11655                           COMP, and sets the reader's N$REQ.DVE up
     2144    11656                           (setting DVE.DVBYTE.CONT zero).
     2145    11657        */
     2146    11658    1   SETRCOMP: PROC;
     2147    11659        /**/
     2148    11660    2         LDCT$->NK$LDCT.IOQ$=ADDR(NIL);
     2149    11661    2         N$REQ.STATION.LSTA$=ADDR(VLP_STATION);
     2150    11662    2         VLP_STATION.CTL=KC_VLPSTATION.CTL;
     2151    11663    2         VLP_STATION.MSGID=MBLK$->KQ$MBLK.MID.PRIMARY;
     2152    11664    2         VLP_STATION.MSGIDXT=BINBIT(MBLK$->KQ$MBLK.MID.XT,36);
     2153    11665    2         IF CG$->KQ$CG.QISS THEN
     2154    11666    3           DO;
     2155    11667    3           VLP_STATION.STATION=MBLK$->KQ$MBLK.KEY1;
     2156    11668    3           VLP_STATION.MSGTYP =MBLK$->KQ$MBLK.KEY2;
     2157    11669    3           END;
     2158    11670    2         ELSE
     2159    11671    3           DO;
     2160    11672    3           VLP_STATION.STATION=MBLK$->KQ$MBLK.KEY2;
     2161    11673    3           VLP_STATION.MSGTYP =MBLK$->KQ$MBLK.KEY1;
     2162    11674    3           END;
     2163    11675    2         N$REQ.DVE        =MBLK$->KQ$MBLK.DVE;
     2164    11676    2         N$REQ.DVE.DVBYTE.CONT='0'B;
     2165    11677    2         N$REQ.TYC=N$REQ.TYC|MBLK$->KQ$MBLK.TYC;
     2166    11678    2         RETURN;
     2167    11679    2   END SETRCOMP;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:65   
     2168    11680        /****************************************************************
     2169    11681        *****************************************************************/
     2170    11682        /*D* NAME:         SETUP
     2171    11683             PURPOSE:      To set up goodies common to most entry points.
     2172    11684        */
     2173    11685    1   SETUP: PROC;
     2174    11686        /**/
     2175    11687    2         IOQ$=ADDR(N$RREQ);
     2176    11688    2   SETUP1: ENTRY;
     2177    11689    2         LDCT$=NK$LDCT$(N$REQ.DLA.DCTX);
     2178    11690    2         STA$=LDCT$->NK$LDCT.STA$;
     2179    11691    2         CG$=LDCT$->NK$LDCT.CG$;
     2180    11692    2         CALL KQX$LDASR (CG$->KQ$CG);
     2181    11693    2         RBLK$=STA$->KQ$STA.RBLK$;
     2182    11694    2         ACTQTN$=ADDR(NIL);
     2183    11695    2         RETURN;
     2184    11696    2   END SETUP;
     2185    11697        /****************************************************************
     2186    11698        *****************************************************************/
     2187    11699        /*D* NAME:         CHKACT
     2188    11700             PURPOSE:      To error a read if the station has been
     2189    11701                           deactivated, or activated with a TYC
     2190    11702             DESCRIPTION:  ALTRETs with N$REQ.TYC set appropriately if
     2191    11703                           either is true.  Else returns.
     2192    11704        */
     2193    11705    1   CHKACT: PROC ALTRET;
     2194    11706        /**/
     2195    11707    2         IF LDCT$->NK$LDCT.LKFLG.ACTIVE = '0'B THEN
     2196    11708    3           DO;
     2197    11709    3           N$REQ.TYC=%TYC_DACT;
     2198    11710    3           ALTRETURN;
     2199    11711    3           END;
     2200    11712    2         IF STA$->KQ$STA.ACTTYC THEN
     2201    11713    3           DO;
     2202    11714    3           ATFLG = 1;
     2203    11715    3           N$REQ.TYC=STA$->KQ$STA.ACTTYC;
     2204    11716    3           IF NOT STA$->KQ$STA.ABTET THEN
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:66   
     2205    11717    3            STA$->KQ$STA.ACTTYC='0'B;
     2206    11718    3           ALTRETURN;
     2207    11719    3           END;
     2208    11720    2         RETURN;
     2209    11721    2   END CHKACT;
     2210    11722        /****************************************************************
     2211    11723        *****************************************************************/
     2212    11724        /*D* NAME:         MAPBUF
     2213    11725             PURPOSE:      To map a read buffer for later transfer
     2214    11726             DESCRIPTION:  The reading buffer specification is translated
     2215    11727                           into a pointer, a bufsize, and 2 page table
     2216    11728                           words, such that if the latter 2 are stuffed
     2217    11729                           into words 0,1 of the comgroup page table,
     2218    11730                           the pointer will access the buffer.  This
     2219    11731                           info is used later when the read is satisfied
     2220    11732                           and the data is being moved.  ALTRETs if the
     2221    11733                           buffer is bad.
     2222    11734        */
     2223    11735    1   MAPBUF: PROC ALTRET;
     2224    11736        /**/
     2225    11737    2   DCL UB$ PTR;
     2226    11738    2   DCL PSTMP UBIN WORD;
     2227    11739        /**/
     2228    11740    2         IF RBLK$->KQ$RBLK.MAPD THEN RETURN;
     2229    11741    2         UB$=RBLK$->KQ$RBLK.BUF$;
     2230    11742    2         IF N$REQ.OPFLG.USER THEN
     2231    11743    3           DO;
     2232    11744    3           PSTMP=ADDR(UB$)->B$$PTRR.SEGID;
     2233    11745    3           IF PSTMP <= BITBIN('1777'O) THEN
     2234    11746    3            CALL HFF$WRITE1 (PSTMP) ALTRET(BADBUF);
     2235    11747    3           END;
     2236    11748    2         CALL MMS$SETUP_BUF (,UB$,RBLK$->KQ$RBLK.BUFSIZE,RBLK$->KQ$RBLK.BUF$,RBLK$->
             11748                  KQ$RBLK.PTW);
     2237    11749    2         RBLK$->KQ$RBLK.MAPD='1'B;
     2238    11750    2         RETURN;
     2239    11751    2   BADBUF:;
     2240    11752    2         ALTRETURN;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:67   
     2241    11753    2   END MAPBUF;
     2242    11754    1   END KQR$READ;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:68   
--  Include file information  --

   KI_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   F_CODE_R.:E05TOU  cannot be made into a system file and is referenced.
   EL$TABLES.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KQ_ERRORS_C.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQR$READ.

   Procedure KQR$READ requires 3501 words for executable code.
   Procedure KQR$READ requires 52 words of local(AUTO) storage.

    No errors detected in file KQR$READ.:E05TSI    .

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:69   

 Object Unit name= KQR$READ                                   File name= KQR$READ.:E05TOU
 UTS= JUL 30 '97 01:35:03.68 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     48     60  KQR$READ
    1   Proc  even  none  3501   6655  KQR$READ
    2  RoData even  none    37     45  KQR$READ

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KQR$READ
     1   2333          yes     yes      Std        1  KQR$FCONT
     1   2365          yes     yes      Std        1  KQR$GOTMSG
     1   2635          yes     yes      Std        1  KQR$FDELAY
     1   2721          yes     yes      Std        1  KQR$DFETCH
     1   3460          yes     yes      Std        1  KQR$VALIDATE
     1   3542          yes     yes      Std        1  KQR$COMP
     1   3562          yes     yes      Std        1  KQR$TRUNC
     1   3616          yes     yes      Std        1  KQR$GETQUEUE
     1   3630          yes     yes      Std        1  KQR$GETRBLK
     1   3660          yes     yes      Std        1  KQR$LOGERR
     1   3674          yes     yes      Std        1  KQR$CLEANUP
     1   3700          yes     yes      Std        1  KQR$CLEANUPB
     1   4573          yes     yes      Std        1  KQR$RECOVER
     1   4722          yes     yes      Std        1  KQR$FWCGF
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:70   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 SSR$REG
 yes     yes           Std       1 KQL$QDFDUN
 yes     yes           Std       8 KQZ$LOG
 yes     yes           Std       1 KQP$UNLOCK
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       1 KQT$LBT
 yes     yes           Std       3 KQT$GETTYP
 yes     yes           Std       1 KQL$DDFDUN
 yes     yes           Std       2 KQD$UNLOCK
 yes     yes           Std       3 KQD$FETCHR
         yes           Std       1 NIO$COMPC
         yes           Std       3 HFC$ASSOCCLR
 yes     yes           Std       1 KQT$UBT
 yes     yes           Std       3 KQU$UNLATCHF
 yes     yes           Std       1 KQU$DELREAD
 yes     yes           Std       2 KQL$DDFIND
 yes     yes           Std       3 KQT$GETSTA
 yes     yes           Std       3 KQD$DEFERGO
 yes     yes           Std       3 KQB$SRCH
 yes     yes           Std       2 KQQ$DQEOFTIME
 yes     yes           Std       1 KQW$SENDAUP
         yes           Std       1 KQX$SETTIME
 yes     yes           Std       0 HFF$TRAPALT
 yes     yes           Std       3 KQU$UNLATCH
 yes     yes           Std       1 KQX$CHKTIME
         yes           Std       1 KQY$YC
 yes     yes           Std       3 KQD$RENEGE
 yes     yes           Std       2 KQM$RELMBLK
 yes     yes           Std       2 KQU$DELMSG
 yes     yes           Std       2 KQL$QDFIND
 yes     yes           Std       3 KQD$FETCH
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:71   
         yes           Std       1 NIO$COMPCNS
 yes     yes           Std       1 KQD$ERRLOG
 yes     yes           Std       2 KQL$QDELAYR
 yes     yes           Std       3 KQM$GETRBLK
 yes     yes           Std       3 KQM$GETBR
 yes     yes           Std       2 KQM$RELRBLK
 yes     yes           Std       2 KQQ$DEQUEUE
 yes     yes           Std       3 KQD$LREL
 yes     yes           Std       2 KQD$DELETE
 yes     yes           Std       2 KQQ$ACT
         yes           Std       1 KQX$LDASR
 yes     yes           Std       1 HFF$WRITE1
 yes     yes           Std       5 MMS$SETUP_BUF
                       Std       0 B_CONSPOOL_D
 yes     yes           Std       1 KQR$FCONT
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BCGIOF                             SC_BCGRBS                             SC_CGCALZ
     KQ_XFGATE                             KQ_LOG                                KQ_ERRLOG_GATE
     KQ_IRBLK                              N$DCT$$                               B$CGPT$
     S_CUN                                 B$JIT$                                KC_VLPSTATION
     KQ_ERRLOG_BFR                         B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ASLENTSID
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:72   


        1        1        /*M* KQR$READ IOQ read from COMGROUP */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KQR$READ
       10       10             PURPOSE:      To provide COMGROUP READ functions for entities
       11       11                           which come through IOQ (i.e. DCBs, and monitor
       12       12                           stations such as MONKEY).
       13       13             DESCRIPTION:  Contains all routines to implement read of COMGROUP
       14       14                           via NIO$QUE.  Is the complement of KQW$WRITE, which
       15       15                           handles write thru IOQ.
       16       16        */
       17       17        /*F* NAME:         KQR$READ
       18       18             PURPOSE:      To receive non-write NIO$QUE requests for DCTs
       19       19                           whose RESCOD is CGDCB.
       20       20             DESCRIPTION:  NIO$QUE calls here for non-write functions issued
       21       21                           for a DCT with RESCOD CGDCB (this includes true
       22       22                           user DCBs, as well as monitor stations such as
       23       23                           MONKEY).
       24       24
       25       25                           First, the function code is checked to make certain
       26       26                           it is a valid COMGROUP read fcn.
       27       27
       28       28                           If the station has a read pending, or is deactivated,
       29       29                           an error is returned.
       30       30
       31       31                           If the station posesses an RBLK, it is examined.
       32       32                           If the RBLK state is PENDing, an error is returned.
       33       33                           Otherwise, it represents a completed read, and
       34       34                           contains an MBLK pointer.  If the reader is
       35       35                           requesting CONT, then we leap into the data
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:73   
       36       36                           transfer cycle if there's any unread data, and
       37       37                           otherwise give him ARS=0, terminating the read.
       38       38
       39       39                           If CONT isn't requested, then if the message
       40       40                           was read with LATCH, then if any data remains
       41       41                           unread, we start to transfer data from the
       42       42                           start of the message.  Else (all data has
       43       43                           been read), we unlatch the message.  Else
       44       44                           (not latch) we delete the message and re-init
       45       45                           the RBLK.  Note that if an RBLK exists and has
       46       46                           LATCH set, then LATCH on the M$READ is ignored.
       47       47
       48       48                           In the first case (no RBLK, or completed read), the
       49       49                           RBLK is inited from the current operation's parameters,
       50       50                           and an appropriate message is searched for.  This
       51       51                           involves first searching the list of messages writ-
       52       52                           ten to this station, and, if none and the operation
       53       53                           specifies queue search, the QUEUE is searched.
       54       54                           If nothing is found and EOFNONE is specified, EOF
       55       55                           is returned.  Otherwise, the RBLK state is changed
       56       56                           to PENDing, and we exit appropriately (i.e. block
       57       57                           the user if he specified wait, or exit).  Before
       58       58                           this is done, the buffer address is translated so
       59       59                           that it can be stored thru 'unmapped'.  Also, if
       60       60                           queue search is desired, the RBLK is left in the
       61       61                           QUEUE in such a way that a write into the queue will
       62       62                           find it.  Either way, this read will be completed
       63       63                           by some write coming thru KQW$WRITE or KQP$PUT
       64       64                           later, at which time NIO$COMP will be called for the
       65       65                           reader's request.
       66       66
       67       67
       68       68                           If, on the other hand, a message is found immed-
       69       69                           iately, the transfer begins now.  The MBLK is
       70       70                           removed from the chain on which it was found, and
       71       71                           pointed to by the RBLK.  Data is extracted from the
       72       72                           data cache (since the MBLK always points to a DBLK
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:74   
       73       73                           in the data cache), one DBLK at a time if the message
       74       74                           was written in CONTINUEd chunks.  If I/O must occur
       75       75                           in order to get a DBLK into the cache, then if the
       76       76                           user specified WAIT he is blocked, or if not we
       77       77                           return, but in either case the buffer address is
       78       78                           converted and the rest of the transfer takes place
       79       79                           'unmapped' driven off cache availability, and COMP
       80       80                           is called when transfer is complete.
       81       81        */
       82       82        /**/
       83       83        KQR$READ: PROC (N$RREQ) ALTRET;

     83  1 000000   000000 700200 xent  KQR$READ     TSX0  ! X66_AUTO_1
         1 000001   000064 000001                    ZERO    52,1

       84       84        /**/
       85       85
       86       86
       87       87
       88       88        /**/
       89       89        /* INCLUDES */
       90       90        /**/
       91       91        %INCLUDE KQ_SUBS_C;
       92      391        %INCLUDE KQ_MAC_C;
       93     2941        %INCLUDE HF_LOCK_C;
       94     2955        %INCLUDE KQ_DATA_R;
       95     3787        %INCLUDE KQ_ERRORS_C;
       96     3835        %INCLUDE NK$LDCT;
       97     3937        %INCLUDE N$REQ;
       98     4011        %INCLUDE NK_LDCT_R;
       99     4020        %INCLUDE CP_6_SUBS;
      100     4560        %INCLUDE SS_SCHED_C;
      101     4793        %INCLUDE F$DCB;
      102     4842        %INCLUDE N_FC_C;
      103     4879        %INCLUDE KC$CP6V_C;
      104     4999        %INCLUDE B_STRINGS_C;
      105     5128        %INCLUDE KC_CP6;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:75   
      106     5688        %INCLUDE EL$TABLES;
      107     6011        %INCLUDE F_CODE_R;
      108     6021        %INCLUDE B$JIT;
      109     6624        %INCLUDE KI_ERRORS_C;
      110     6709
      111     6710
      112     6711
      113     6712        /**/
      114     6713        /* PARAMETERS */
      115     6714        /**/
      116     6715        %N$REQ (NAME=N$RREQ,STCLASS="");
      117     6773
      118     6774
      119     6775
      120     6776        /**/
      121     6777        /* BASED STRUCTURES */
      122     6778        /**/
      123     6779    1   DCL B$$PTR PTR BASED ALIGNED;
      124     6780    1   DCL 1 B$$PTRR REDEF B$$PTR ALIGNED,
      125     6781    1         2 PG UBIN(8) UNAL,
      126     6782    1         2 WRD UBIN(10) UNAL,
      127     6783    1         2 CB UBIN(6) UNAL,
      128     6784    1         2 SEGID UBIN(12) UNAL;
      129     6785    1   DCL 1 B$$XFPTW BASED DALIGNED,
      130     6786    1         2 * (0:1) UBIN;
      131     6787        %N$REQ (STCLASS="BASED(IOQ$)");
      132     6845        %NK$LDCT (STCLASS="BASED(LDCT$)");
      133     6891        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
      134     7630        %KQ_STA  (FPTN=KQ$STA ,STCLASS="BASED(STA$)");
      135     7969        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS="BASED(RBLK$)");
      136     8155        %KQ_RBLK (FPTN=KQ$RBLKT,STCLASS=BASED,TERM=1);
      137     8341        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED(MBLK$)");
      138     8611        %KQ_MLH  (FPTN=KQ$MLH ,STCLASS="BASED(MLH$)");
      139     8681        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
      140     8719        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS="BASED(DBLK$)");
      141     8772        %KQ_QTN  (FPTN=KQ$QTN ,STCLASS="BASED(QTN$)");
      142     9245        %KQ_DFRPARM (FPTN=KQ$DFRPARM,STCLASS="BASED(DFRP$)");
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:76   
      143     9274        %KQ_DFRBLK (FPTN=KQ$DFRBLK,STCLASS="BASED(DBLK$)");
      144     9324        %VLP$STATION_V (FPTN=VLP$STATION);
      145     9336    1   DCL B$$KEY1 CHAR(KEY1L) BASED ALIGNED;
      146     9337    1   DCL B$$KEY2 CHAR(KEY2L) BASED ALIGNED;
      147     9338    1   DCL B$$CHARS CHAR(I) BASED CALIGNED;
      148     9339    1   DCL B$$CHAR8 CHAR(8) BASED CALIGNED;
      149     9340    1   DCL B$$UBIN UBIN WORD BASED ALIGNED;
      150     9341    1   DCL B$$HALF UBIN HALF BASED HALIGNED;
      151     9342    1   DCL 1 B$$MIDEXT BASED ALIGNED,
      152     9343    1         2 EXTS (0:5) UBIN(6) UNAL;
      153     9344    1   DCL 1 B$$BITS BASED ALIGNED,
      154     9345    1         2 B (0:0) BIT(1) UNAL;
      155     9346        %B$CGAURD;
      156     9365
      157     9366
      158     9367
      159     9368        /**/
      160     9369        /* AUTO */
      161     9370        /**/
      162     9371    1   DCL IOQ$ PTR;
      163     9372    1   DCL LDCT$ PTR;
      164     9373    1   DCL STA$ PTR;
      165     9374    1   DCL RBLK$ PTR;
      166     9375    1   DCL MBLK$ PTR;
      167     9376    1   DCL MBLK$R REDEF MBLK$ SBIN;
      168     9377    1   DCL CG$ PTR;
      169     9378        %VLP$STATION_V (FPTN=VLP_STATION,BASED=AUTO);
      170     9390    1   DCL 1 CGAURD REDEF VLP_STATION ALIGNED,
      171     9391              %B$CGAURD (FPTN=X,LAST=",",LVL=2);
      172     9410    1         2 * (0:3) UBIN;
      173     9411    1   DCL KEY CHAR(8);
      174     9412    1   DCL ACTQTN$ PTR;
      175     9413    1   DCL KEY1L UBIN;
      176     9414    1   DCL KEY2L UBIN;
      177     9415    1   DCL P$ PTR;
      178     9416    1   DCL DFRP$ PTR;
      179     9417    1   DCL DBLK$ PTR;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:77   
      180     9418    1   DCL DBLK$R REDEF DBLK$ UBIN;
      181     9419    1   DCL I UBIN;
      182     9420    1   DCL 1 I_ERR REDEF I,
      183     9421    1         2 * BIT(18) UNAL,
      184     9422    1         2 CODE UBIN(15) UNAL,
      185     9423    1         2 * UBIN(3) UNAL;
      186     9424    1   DCL DDA UBIN;
      187     9425    1   DCL QTN$ PTR;
      188     9426    1   DCL MLH$ PTR;
      189     9427    1   DCL MTYP$ PTR;
      190     9428    1   DCL QACTCNT UBIN;
      191     9429    1   DCL TYC BIT(36) ALIGNED;
      192     9430    1   DCL QKNFND UBIN;
      193     9431    1   DCL BADCLS REDEF QKNFND UBIN;
      194     9432    1   DCL QUEUE$ PTR;
      195     9433    1   DCL ATFLG UBIN;
      196     9434    1   DCL TIMCHK BIT(72) DALIGNED;
      197     9435
      198     9436
      199     9437
      200     9438        /**/
      201     9439        /* CONSTANT */
      202     9440        /**/
      203     9441        %FPT_UNLATCH                          (FPTN=DUFPT,
      204     9442                 INPUT     = DELETE,
      205     9443                 OUTPUT    = SEND,
      206     9444                 STCLASS   = CONSTANT);
      207     9461        %FPT_UNLATCH                          (FPTN=RUFPT,
      208     9462                 INPUT     = RERUN,
      209     9463                 OUTPUT    = DELETE,
      210     9464                 STCLASS   = CONSTANT);
      211     9481        %FPT_UNLATCH                          (FPTN=HUFPT,
      212     9482                 INPUT     = HOLD,
      213     9483                 TELLAU    = YES,
      214     9484                 OUTPUT    = DELETE,
      215     9485                 STCLASS   = CONSTANT);
      216     9502    1   DCL 1 ERR_NODAT CONSTANT,
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:78   
      217     9503    1         2 FCG BIT(12) UNAL INIT('1322'O), /* 'KQ' */
      218     9504    1         2 MID BIT(6)  UNAL INIT('22'O),   /* 'R'  */
      219     9505    1         2 MON BIT(1)  UNAL INIT('1'B),
      220     9506    1         2 CODE UBIN(14) UNAL INIT(%E$NODAT),
      221     9507    1         2 SEV  UBIN(3) UNAL INIT(4);     /* SEVERITY 4 */
      222     9508
      223     9509
      224     9510
      225     9511        /**/
      226     9512        /* REFS */
      227     9513        /**/
      228     9514    1   DCL HFC$ASSOCCLR  ENTRY(3);
      229     9515    1   DCL HFF$TRAPALT   ENTRY    ALTRET;
      230     9516    1   DCL HFF$WRITE1    ENTRY(1) ALTRET;
      231     9517    1   DCL KQB$SRCH      ENTRY(3) ALTRET;
      232     9518    1   DCL KQD$DEFERGO   ENTRY(3) ALTRET;
      233     9519    1   DCL KQD$DELETE    ENTRY(2) ALTRET;
      234     9520    1   DCL KQD$ERRLOG    ENTRY(1) ALTRET;
      235     9521    1   DCL KQD$FETCH     ENTRY(3) ALTRET;
      236     9522    1   DCL KQD$FETCHR    ENTRY(3) ALTRET;
      237     9523    1   DCL KQD$LREL      ENTRY(3) ALTRET;
      238     9524    1   DCL KQD$RENEGE    ENTRY(3) ALTRET;
      239     9525    1   DCL KQD$UNLOCK    ENTRY(2) ALTRET;
      240     9526    1   DCL KQL$DDFDUN    ENTRY(1) ALTRET;
      241     9527    1   DCL KQL$DDFDUNL   ENTRY(1) ALTRET;
      242     9528    1   DCL KQL$DDFIND    ENTRY(2) ALTRET;
      243     9529    1   DCL KQL$QDELAYR   ENTRY(2) ALTRET;
      244     9530    1   DCL KQL$QDFDUN    ENTRY(1) ALTRET;
      245     9531    1   DCL KQL$QDFIND    ENTRY(2) ALTRET;
      246     9532    1   DCL KQM$GETBR     ENTRY(3) ALTRET;
      247     9533    1   DCL KQM$GETRBLK   ENTRY(3) ALTRET;
      248     9534    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      249     9535    1   DCL KQM$RELRBLK   ENTRY(2) ALTRET;
      250     9536    1   DCL KQP$UNLOCK    ENTRY(1) ALTRET;
      251     9537    1   DCL KQQ$ACT       ENTRY(2) ALTRET;
      252     9538    1   DCL KQQ$DEQUEUE   ENTRY(2) ALTRET;
      253     9539    1   DCL KQQ$DQEOFTIME ENTRY(2) ALTRET;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:79   
      254     9540    1   DCL KQT$GETSTA    ENTRY(3) ALTRET;
      255     9541    1   DCL KQT$GETTYP    ENTRY(3) ALTRET;
      256     9542    1   DCL KQT$LBT       ENTRY(1) ALTRET;
      257     9543    1   DCL KQT$UBT       ENTRY(1) ALTRET;
      258     9544    1   DCL KQU$DELETE    ENTRY(1) ALTRET;
      259     9545    1   DCL KQU$DELMSG    ENTRY(2) ALTRET;
      260     9546    1   DCL KQU$DELREAD   ENTRY(1) ALTRET;
      261     9547    1   DCL KQU$UNLATCH   ENTRY(3) ALTRET;
      262     9548    1   DCL KQU$UNLATCHF  ENTRY(3) ALTRET;
      263     9549    1   DCL KQW$SENDAUP   ENTRY(1) ALTRET;
      264     9550    1   DCL KQX$CHKTIME   ENTRY(1) ALTRET;
      265     9551    1   DCL KQX$LDASR     ENTRY(1);
      266     9552    1   DCL KQX$SETTIME   ENTRY(1);
      267     9553    1   DCL KQY$YC        ENTRY(1);
      268     9554    1   DCL KQZ$LOG       ENTRY(8) ALTRET;
      269     9555    1   DCL MMS$SETUP_BUF ENTRY(5) ALTRET;
      270     9556    1   DCL NIO$COMPC     ENTRY(1);
      271     9557    1   DCL NIO$COMPCNS   ENTRY(1);
      272     9558    1   DCL SSR$REG       ENTRY(3) ALTRET;
      273     9559    1   DCL SC_BCGIOF     ENTRY    CONV(2,0);
      274     9560    1   DCL SC_BCGRBS     ENTRY    CONV(2,0);
      275     9561    1   DCL SC_CGNOTIMP   ENTRY    CONV(2,0);
      276     9562    1   DCL SC_CGCALZ     ENTRY    CONV(2,0);
      277     9563    1   DCL B$CGPT$ PTR SYMREF;
      278     9564    1   DCL S_CUN UBIN WORD SYMREF;
      279     9565    1   DCL B$JIT$ PTR SYMREF;
      280     9566        %VLP_STATION (FPTN=KC_VLPSTATION,STCLASS=SYMREF);
      281     9593        %EL$CGERR (NAME=KQ_ERRLOG_BFR,STCLASS=SYMREF,N=50);
      282     9597
      283     9598
      284     9599
      285     9600        /**/
      286     9601        /* SUBS */
      287     9602        /**/
      288     9603        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
      289     9604        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      290     9605        %SUB KQ$QUEUE="CG$->KQ$CG.QUEUE";
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:80   
      291     9606        %EQU_CG;
      292     9654        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:81   
      293     9655
      294     9656    1         CALL SETUP;

   9656  1 000002   006512 701000 1                  TSX1    SETUP
         1 000003   000000 011000                    NOP     0

      295     9657    2           DO CASE (N$REQ.FC);

   9657  1 000004   200004 470500                    LDP0    IOQ$,,AUTO
         1 000005   000003 720100                    LXL0    3,,PR0
         1 000006   000777 360003                    ANX0    511,DU
         1 000007   000015 100003                    CMPX0   13,DU
         1 000010   000012 602010 1                  TNC     s:9657+6,X0
         1 000011   000027 710000 1                  TRA     s:9668
         1 000012   000027 710000 1                  TRA     s:9668
         1 000013   000027 710000 1                  TRA     s:9668
         1 000014   000032 710000 1                  TRA     s:9688
         1 000015   000027 710000 1                  TRA     s:9668
         1 000016   000032 710000 1                  TRA     s:9688
         1 000017   000027 710000 1                  TRA     s:9668
         1 000020   000027 710000 1                  TRA     s:9668
         1 000021   000027 710000 1                  TRA     s:9668
         1 000022   000027 710000 1                  TRA     s:9668
         1 000023   000027 710000 1                  TRA     s:9668
         1 000024   000027 710000 1                  TRA     s:9668
         1 000025   000027 710000 1                  TRA     s:9668
         1 000026   000032 710000 1                  TRA     s:9688

      296     9658
      297     9659
      298     9660        /**
      299     9661         **
      300     9662         **
      301     9663         **       BAD FUNCTION CODE
      302     9664         **
      303     9665         **
      304     9666         **/
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:82   
      305     9667    2             CASE (ELSE);

      306     9668    2               CALL SC_BCGIOF;

   9668  1 000027   000000 713400 xsym               CLIMB   SC_BCGIOF
         1 000030   000000 600000 xsid               climb   nvectors=         0
         1 000031   000032 710000 1                  TRA     s:9688

      307     9669        /*S* SCREECH_CODE: KQR-S$BCGIOF
      308     9670             TYPE:         SCREECH
      309     9671             MESSAGE:      Bad fcn code passed from IOQ to COMGROUP
      310     9672             REMARKS:      This SCREECH occurs when KQR$READ receives an IOQ
      311     9673                           packet with an unknown N$REQ.FC.  The IOQ packet
      312     9674                           may be clobbered or someone is calling NIO$QUE
      313     9675                           incorrectly. */
      314     9676
      315     9677
      316     9678        /**
      317     9679         **
      318     9680         **
      319     9681         **      READ
      320     9682         **
      321     9683         **
      322     9684         **/
      323     9685    2             CASE (%N_RDASC,%N_RDBIN,%N_READ);

      324     9686
      325     9687    2           END; /* CASE N$REQ.FCN */

      326     9688    1         CG$->KQ$CG.STATS.READS=CG$->KQ$CG.STATS.READS+1;

   9688  1 000032   200011 470500                    LDP0    CG$,,AUTO
         1 000033   000165 054100                    AOS     117,,PR0

      327     9689    1         IF KQ_LOG.DSIO THEN

   9689  1 000034   000000 236000 xsym               LDQ     KQ_LOG
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:83   
         1 000035   002000 316003                    CANQ    1024,DU
         1 000036   000057 600000 1                  TZE     s:9694

      328     9690    1          CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_READ,0,0,0,

   9690  1 000037   200006 236100                    LDQ     STA$,,AUTO
         1 000040   000006 036003                    ADLQ    6,DU
         1 000041   200062 756100                    STQ     R$+7,,AUTO
         1 000042   200006 236100                    LDQ     STA$,,AUTO
         1 000043   000005 036003                    ADLQ    5,DU
         1 000044   000001 235000 2                  LDA     1
         1 000045   200060 757100                    STAQ    R$+5,,AUTO
         1 000046   000002 237000 2                  LDAQ    2
         1 000047   200056 757100                    STAQ    R$+3,,AUTO
         1 000050   000004 236000 2                  LDQ     4
         1 000051   200011 235100                    LDA     CG$,,AUTO
         1 000052   200054 757100                    STAQ    R$+1,,AUTO
         1 000053   200054 630500                    EPPR0   R$+1,,AUTO
         1 000054   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 000055   000000 701000 xent               TSX1    KQZ$LOG
         1 000056   000000 011000                    NOP     0

      329     9691    1          SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
      330     9692    1          SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
      331     9693        /**/
      332     9694    1         ATFLG=0;

   9694  1 000057   200043 450100                    STZ     ATFLG,,AUTO

      333     9695              %LOCK (G=STA$->KQ$STA.GATE);

   9696  1 000060   200006 236100                    LDQ     STA$,,AUTO
         1 000061   000016 036003                    ADLQ    14,DU
         1 000062   200054 756100                    STQ     R$+1,,AUTO
         1 000063   200054 630500                    EPPR0   R$+1,,AUTO
         1 000064   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000065   000000 701000 xent               TSX1    HFC$LOCK
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:84   
         1 000066   000000 011000                    NOP     0

      334     9698    1         RBLK$=STA$->KQ$STA.RBLK$;

   9698  1 000067   200006 470500                    LDP0    STA$,,AUTO
         1 000070   000011 236100                    LDQ     9,,PR0
         1 000071   200007 756100                    STQ     RBLK$,,AUTO

      335     9699    1         CALL CHKACT

   9699  1 000072   006545 701000 1                  TSX1    CHKACT
         1 000073   000075 702000 1                  TSX2    s:9701
         1 000074   000115 710000 1                  TRA     s:9716

      336     9700    2         WHENALTRETURN DO;

      337     9701    2           IF ATFLG = 1 AND RBLK$ ~= ADDR(NIL) THEN

   9701  1 000075   200043 235100                    LDA     ATFLG,,AUTO
         1 000076   000001 115007                    CMPA    1,DL
         1 000077   000114 601000 1                  TNZ     s:9705
         1 000100   200007 236100                    LDQ     RBLK$,,AUTO
         1 000101   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000102   000114 600000 1                  TZE     s:9705

      338     9702    2            IF RBLK$->KQ$RBLK.STATE = %KQRS_COMP# THEN

   9702  1 000103   200007 470500                    LDP0    RBLK$,,AUTO
         1 000104   000001 220100                    LDX0    1,,PR0
         1 000105   000001 100003                    CMPX0   1,DU
         1 000106   000114 601000 1                  TNZ     s:9705

      339     9703    2             IF RBLK$->KQ$RBLK.LATCH AND RBLK$->KQ$RBLK.CS THEN

   9703  1 000107   000001 236100                    LDQ     1,,PR0
         1 000110   400000 316007                    CANQ    -131072,DL
         1 000111   000114 600000 1                  TZE     s:9705
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:85   
         1 000112   040000 316007                    CANQ    16384,DL
         1 000113   000306 601000 1                  TNZ     UNLATCHRD

      340     9704    2              GOTO UNLATCHRD;
      341     9705    2           GOTO BADCOMPUNL;

   9705  1 000114   003435 710000 1                  TRA     BADCOMPUNL

      342     9706    2           END;
      343     9707
      344     9708        /**************************************************
      345     9709         **                                              **
      346     9710         **                                              **
      347     9711         **      See if the station already has an       **
      348     9712         **      RBLK, and act appropriately if so       **
      349     9713         **                                              **
      350     9714         **************************************************/
      351     9715
      352     9716    1         IF RBLK$ ~= ADDR(NIL) THEN

   9716  1 000115   200007 236100                    LDQ     RBLK$,,AUTO
         1 000116   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000117   000411 600000 1                  TZE     s:9824

      353     9717    2           DO;

      354     9718    3             DO CASE (RBLK$->KQ$RBLK.STATE);

   9718  1 000120   200007 470500                    LDP0    RBLK$,,AUTO
         1 000121   000001 220100                    LDX0    1,,PR0
         1 000122   000006 100003                    CMPX0   6,DU
         1 000123   000125 602010 1                  TNC     s:9718+5,X0
         1 000124   000133 710000 1                  TRA     s:9721
         1 000125   000136 710000 1                  TRA     s:9734
         1 000126   000142 710000 1                  TRA     s:9738
         1 000127   000136 710000 1                  TRA     s:9734
         1 000130   000136 710000 1                  TRA     s:9734
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:86   
         1 000131   000133 710000 1                  TRA     s:9721
         1 000132   000136 710000 1                  TRA     s:9734

      355     9719
      356     9720    3               CASE (ELSE);

      357     9721    3                 CALL SC_BCGRBS;

   9721  1 000133   000000 713400 xsym               CLIMB   SC_BCGRBS
         1 000134   000000 600000 xsid               climb   nvectors=         0
         1 000135   000404 710000 1                  TRA     s:9819

      358     9722        /*S* SCREECH_CODE: KQR-S$BCGRBS
      359     9723             TYPE:         SCREECH
      360     9724             MESSAGE:      Bad COMGROUP RBLK state
      361     9725             REMARKS:      This screech occurs when KQR$READ discovers that
      362     9726                           a station has a read in an impossible state given
      363     9727                           the way in which he was entered.  The mode of
      364     9728                           entry and RBLK state must be investigated to
      365     9729                           discover why the inconsistency occurred.
      366     9730        */
      367     9731
      368     9732    3               CASE (KQRS_PEND#,KQRS_XFIP#,KQRS_XFDN#,KQRS_RSIP#);

      369     9733                       /* RSIP is for case of cancelling reads to disconnecting station */
      370     9734    3                 N$REQ.TYC=%TYC_XTRARD;

   9734  1 000136   000037 236000 0                  LDQ     ERR_NODAT+1
         1 000137   200004 471500                    LDP1    IOQ$,,AUTO
         1 000140   100021 756100                    STQ     17,,PR1

      371     9735    3                 GOTO BADCOMPUNL;

   9735  1 000141   003435 710000 1                  TRA     BADCOMPUNL

      372     9736
      373     9737    3               CASE (KQRS_COMP#);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:87   

      374     9738    3                 IF N$REQ.DVE.DVBYTE.CONT THEN

   9738  1 000142   200004 471500                    LDP1    IOQ$,,AUTO
         1 000143   100031 430100                    FSZN    25,,PR1
         1 000144   000224 605000 1                  TPL     s:9764

      375     9739    4                   DO;

      376     9740    4                   IF NOT RBLK$->KQ$RBLK.CS THEN

   9740  1 000145   000001 236100                    LDQ     1,,PR0
         1 000146   040000 316007                    CANQ    16384,DL
         1 000147   000206 601000 1                  TNZ     s:9755

      377     9741    5                     DO;

      378     9742    5   RERDCH:           ;

   9742  1 000150                       RERDCH       null
      379     9743    5                     MBLK$=RBLK$->KQ$RBLK.MBLK$;

   9743  1 000150   200007 470500                    LDP0    RBLK$,,AUTO
         1 000151   000000 236100                    LDQ     0,,PR0
         1 000152   200010 756100                    STQ     MBLK$,,AUTO

      380     9744    5                     RBLK$->KQ$RBLK.STATE=KQRS_XFIP#;

   9744  1 000153   000003 220003                    LDX0    3,DU
         1 000154   000001 740100                    STX0    1,,PR0

      381     9745    5                     IF N$REQ.BUFSIZE <= KQ_RDMAX# THEN

   9745  1 000155   200004 470500                    LDP0    IOQ$,,AUTO
         1 000156   000004 236100                    LDQ     4,,PR0
         1 000157   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 000160   000005 116000 2                  CMPQ    5
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:88   
         1 000161   000167 603000 1                  TRC     s:9747

      382     9746    5                      RBLK$->KQ$RBLK.BUFSIZE=N$REQ.BUFSIZE;

   9746  1 000162   200007 471500                    LDP1    RBLK$,,AUTO
         1 000163   000004 236100                    LDQ     4,,PR0
         1 000164   000020 772000                    QRL     16
         1 000165   100016 756100                    STQ     14,,PR1
         1 000166   000172 710000 1                  TRA     s:9748

      383     9747    5                     ELSE RBLK$->KQ$RBLK.BUFSIZE=KQ_RDMAX#;

   9747  1 000167   010000 235007                    LDA     4096,DL
         1 000170   200007 471500                    LDP1    RBLK$,,AUTO
         1 000171   100016 755100                    STA     14,,PR1

      384     9748    5                     RBLK$->KQ$RBLK.BUF$=N$REQ.BUF$;

   9748  1 000172   000005 236100                    LDQ     5,,PR0
         1 000173   100013 756100                    STQ     11,,PR1

      385     9749    5                     RBLK$->KQ$RBLK.MAPD='0'B;

   9749  1 000174   000006 236000 2                  LDQ     6
         1 000175   100001 356100                    ANSQ    1,,PR1

      386     9750                          %UNLOCK (G=STA$->KQ$STA.GATE);

   9751  1 000176   200006 236100                    LDQ     STA$,,AUTO
         1 000177   000016 036003                    ADLQ    14,DU
         1 000200   200054 756100                    STQ     R$+1,,AUTO
         1 000201   200054 630500                    EPPR0   R$+1,,AUTO
         1 000202   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000203   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000204   000000 011000                    NOP     0

      387     9753    5                     GOTO XFERRD0;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:89   

   9753  1 000205   002002 710000 1                  TRA     XFERRD0

      388     9754    5                     END;
      389     9755    4                   N$REQ.ARSIZE=0;

   9755  1 000206   177777 236007                    LDQ     65535,DL
         1 000207   100027 356100                    ANSQ    23,,PR1

      390     9756    4                   N$REQ.TYC='0'B;

   9756  1 000210   100021 450100                    STZ     17,,PR1

      391     9757                        %UNLOCK (G=STA$->KQ$STA.GATE);

   9758  1 000211   200006 236100                    LDQ     STA$,,AUTO
         1 000212   000016 036003                    ADLQ    14,DU
         1 000213   200054 756100                    STQ     R$+1,,AUTO
         1 000214   200054 630500                    EPPR0   R$+1,,AUTO
         1 000215   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000216   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000217   000000 011000                    NOP     0

      392     9760    4                   MBLK$=RBLK$->KQ$RBLK.MBLK$;

   9760  1 000220   200007 470500                    LDP0    RBLK$,,AUTO
         1 000221   000000 236100                    LDQ     0,,PR0
         1 000222   200010 756100                    STQ     MBLK$,,AUTO

      393     9761    4                   GOTO RDDUN0;

   9761  1 000223   003064 710000 1                  TRA     RDDUN0

      394     9762    4                   END;
      395     9763        /**/
      396     9764    3                 IF RBLK$->KQ$RBLK.LATCH THEN

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:90   
   9764  1 000224   000001 236100                    LDQ     1,,PR0
         1 000225   400000 316007                    CANQ    -131072,DL
         1 000226   000353 600000 1                  TZE     s:9808

      397     9765    4                   DO;

      398     9766    4                   IF NOT RBLK$->KQ$RBLK.CS THEN

   9766  1 000227   040000 316007                    CANQ    16384,DL
         1 000230   000306 601000 1                  TNZ     UNLATCHRD

      399     9767    5                     DO;

      400     9768    5                     MBLK$=RBLK$->KQ$RBLK.MBLK$;

   9768  1 000231   000000 236100                    LDQ     0,,PR0
         1 000232   200010 756100                    STQ     MBLK$,,AUTO

      401     9769    5                     IF RBLK$->KQ$RBLK.NCDDA ~= MBLK$->KQ$MBLK.DDA THEN

   9769  1 000233   200010 473500                    LDP3    MBLK$,,AUTO
         1 000234   000011 236100                    LDQ     9,,PR0
         1 000235   300006 116100                    CMPQ    6,,PR3
         1 000236   000300 600000 1                  TZE     s:9781

      402     9770    6                       DO;

      403     9771                            %UNLOCK (G=STA$->KQ$STA.GATE);

   9772  1 000237   200006 236100                    LDQ     STA$,,AUTO
         1 000240   000016 036003                    ADLQ    14,DU
         1 000241   200054 756100                    STQ     R$+1,,AUTO
         1 000242   200054 630500                    EPPR0   R$+1,,AUTO
         1 000243   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000244   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000245   000000 011000                    NOP     0

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:91   
      404     9774    6                       DBLK$R=MBLK$->KQ$MBLK.STAMP;

   9774  1 000246   200010 470500                    LDP0    MBLK$,,AUTO
         1 000247   000001 236100                    LDQ     1,,PR0
         1 000250   777777 376007                    ANQ     -1,DL
         1 000251   200031 756100                    STQ     DBLK$,,AUTO

      405     9775    6                       CALL KQD$RENEGE (CG$->KQ$CG,DBLK$,MBLK$->KQ$MBLK.DDA);

   9775  1 000252   200010 236100                    LDQ     MBLK$,,AUTO
         1 000253   000006 036003                    ADLQ    6,DU
         1 000254   200056 756100                    STQ     R$+3,,AUTO
         1 000255   200031 631500                    EPPR1   DBLK$,,AUTO
         1 000256   200055 451500                    STP1    R$+2,,AUTO
         1 000257   200011 236100                    LDQ     CG$,,AUTO
         1 000260   200054 756100                    STQ     R$+1,,AUTO
         1 000261   200054 630500                    EPPR0   R$+1,,AUTO
         1 000262   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000263   000000 701000 xent               TSX1    KQD$RENEGE
         1 000264   000000 011000                    NOP     0

      406     9776    6                       RBLK$->KQ$RBLK.NCDDA=MBLK$->KQ$MBLK.DDA;

   9776  1 000265   200010 470500                    LDP0    MBLK$,,AUTO
         1 000266   200007 471500                    LDP1    RBLK$,,AUTO
         1 000267   000006 235100                    LDA     6,,PR0
         1 000270   100011 755100                    STA     9,,PR1

      407     9777                            %LOCK (G=STA$->KQ$STA.GATE);

   9778  1 000271   200006 236100                    LDQ     STA$,,AUTO
         1 000272   000016 036003                    ADLQ    14,DU
         1 000273   200054 756100                    STQ     R$+1,,AUTO
         1 000274   200054 630500                    EPPR0   R$+1,,AUTO
         1 000275   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000276   000000 701000 xent               TSX1    HFC$LOCK
         1 000277   000000 011000                    NOP     0
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:92   

      408     9780    6                       END;

      409     9781    5                     RBLK$->KQ$RBLK.DBLKX=0;

   9781  1 000300   000000 220003                    LDX0    0,DU
         1 000301   200007 470500                    LDP0    RBLK$,,AUTO
         1 000302   000017 440100                    SXL0    15,,PR0

      410     9782    5                     RBLK$->KQ$RBLK.AUXFDN='0'B;

   9782  1 000303   000007 236000 2                  LDQ     7
         1 000304   000001 356100                    ANSQ    1,,PR0

      411     9783    5                     GOTO RERDCH;

   9783  1 000305   000150 710000 1                  TRA     RERDCH

   9783  1 000306                       UNLATCHRD    null
      412     9784    5                     END;
      413     9785    4   UNLATCHRD:      ;
      414     9786                        %UNLOCK (G=STA$->KQ$STA.GATE);

   9787  1 000306   200006 236100                    LDQ     STA$,,AUTO
         1 000307   000016 036003                    ADLQ    14,DU
         1 000310   200054 756100                    STQ     R$+1,,AUTO
         1 000311   200054 630500                    EPPR0   R$+1,,AUTO
         1 000312   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000313   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000314   000000 011000                    NOP     0

      415     9789    4                   CALL KQU$UNLATCHF (STA$->KQ$STA,DUFPT.V,I) ALTRET(BRCCRCW);

   9789  1 000315   200032 630500                    EPPR0   I,,AUTO
         1 000316   200056 450500                    STP0    R$+3,,AUTO
         1 000317   000010 236000 2                  LDQ     8
         1 000320   200006 235100                    LDA     STA$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:93   
         1 000321   200054 757100                    STAQ    R$+1,,AUTO
         1 000322   200054 630500                    EPPR0   R$+1,,AUTO
         1 000323   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000324   000000 701000 xent               TSX1    KQU$UNLATCHF
         1 000325   003230 702000 1                  TSX2    BRCCRCW

      416     9790                        %LOCK (G=STA$->KQ$STA.GATE);

   9791  1 000326   200006 236100                    LDQ     STA$,,AUTO
         1 000327   000016 036003                    ADLQ    14,DU
         1 000330   200054 756100                    STQ     R$+1,,AUTO
         1 000331   200054 630500                    EPPR0   R$+1,,AUTO
         1 000332   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000333   000000 701000 xent               TSX1    HFC$LOCK
         1 000334   000000 011000                    NOP     0

      417     9793    4                   STA$->KQ$STA.LATCHCNT=STA$->KQ$STA.LATCHCNT+1;

   9793  1 000335   200006 470500                    LDP0    STA$,,AUTO
         1 000336   000015 236100                    LDQ     13,,PR0
         1 000337   001000 036003                    ADLQ    512,DU
         1 000340   000015 552140                    STBQ    13,'40'O,PR0

      418     9794    4                   IF NOT RBLK$->KQ$RBLK.CNACTD THEN

   9794  1 000341   200007 471500                    LDP1    RBLK$,,AUTO
         1 000342   100001 236100                    LDQ     1,,PR1
         1 000343   010000 316007                    CANQ    4096,DL
         1 000344   000347 601000 1                  TNZ     s:9803

      419     9795    4                    ACTQTN$=RBLK$->KQ$RBLK.QTN$;

   9795  1 000345   100021 236100                    LDQ     17,,PR1
         1 000346   200024 756100                    STQ     ACTQTN$,,AUTO

      420     9796                                /* KQU$UNLATCHF does not change CNACT in the
      421     9797                                Q-tree node this read came from (if it did).
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:94   
      422     9798                                This means we give the current reader first
      423     9799                                crack at more messages of that type if indeed
      424     9800                                he's trying to read another.  If he isn't or
      425     9801                                can't read one for some reason, we must call
      426     9802                                KQQ$ACT before exiting. */
      427     9803    4                   IF ATFLG = 1 THEN

   9803  1 000347   200043 235100                    LDA     ATFLG,,AUTO
         1 000350   000001 115007                    CMPA    1,DL
         1 000351   003431 600000 1                  TZE     BADATCOMPUNL

      428     9804    4                    GOTO BADATCOMPUNL;
      429     9805    4                   END;

   9805  1 000352   000404 710000 1                  TRA     s:9819

      430     9806    3                 ELSE
      431     9807    4                   DO;

      432     9808    4                   MBLK$=RBLK$->KQ$RBLK.MBLK$;

   9808  1 000353   000000 236100                    LDQ     0,,PR0
         1 000354   200010 756100                    STQ     MBLK$,,AUTO

      433     9809    4                   IF MBLK$ ~= ADDR(NIL) THEN

   9809  1 000355   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000356   000404 600000 1                  TZE     s:9819

      434     9810    4                    IF RBLK$->KQ$RBLK.NCDDA ~= 0

   9810  1 000357   000011 235100                    LDA     9,,PR0
         1 000360   000365 601000 1                  TNZ     s:9811
         1 000361   200010 473500                    LDP3    MBLK$,,AUTO
         1 000362   300010 236100                    LDQ     8,,PR3
         1 000363   040000 316003                    CANQ    16384,DU
         1 000364   000372 600000 1                  TZE     s:9814
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:95   

      435     9811    4                    OR MBLK$->KQ$MBLK.JRNLD THEN CALL KQU$DELREAD (STA$->KQ$STA);

   9811  1 000365   200006 630500                    EPPR0   STA$,,AUTO
         1 000366   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000367   000000 701000 xent               TSX1    KQU$DELREAD
         1 000370   000000 011000                    NOP     0
         1 000371   000404 710000 1                  TRA     s:9819

      436     9812    4                    ELSE
      437     9813    5                      DO INHIBIT;

      438     9814    5                      RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);

   9814  1 000372   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 000373   000000 756300                    STQ   ! 0,,PR0

      439     9815    5                      CALL KQM$RELMBLK (CG$->KQ$CG,MBLK$);

   9815  1 000374   200010 630700                    EPPR0 ! MBLK$,,AUTO
         1 000375   200055 450700                    STP0  ! R$+2,,AUTO
         1 000376   200011 236300                    LDQ   ! CG$,,AUTO
         1 000377   200054 756300                    STQ   ! R$+1,,AUTO
         1 000400   200054 630700                    EPPR0 ! R$+1,,AUTO
         1 000401   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 000402   000000 701200 xent               TSX1  ! KQM$RELMBLK
         1 000403   000000 011200                    NOP   ! 0

      440     9816    5                      END;

      441     9817    4                   END;

      442     9818    3             END;

      443     9819    2           RBLK$->KQ$RBLK=KQ_IRBLK;

   9819  1 000404   200007 470500                    LDP0    RBLK$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:96   
         1 000405   000100 100400                    MLR     fill='000'O
         1 000406   000000 000110 xsym               ADSC9   KQ_IRBLK                 cn=0,n=72
         1 000407   000000 000110                    ADSC9   0,,PR0                   cn=0,n=72

      444     9820    2           END;

   9820  1 000410   000416 710000 1                  TRA     s:9838

      445     9821
      446     9822    1         ELSE
      447     9823    2           DO;

      448     9824    2           IF N$REQ.DVE.DVBYTE.CONT THEN

   9824  1 000411   200004 470500                    LDP0    IOQ$,,AUTO
         1 000412   000031 430100                    FSZN    25,,PR0
         1 000413   003360 604000 1                  TMI     BRCCWRV

      449     9825    2            GOTO BRCCWRV;
      450     9826    2           CALL GETRBLK ALTRET(BRCFULL);

   9826  1 000414   005220 701000 1                  TSX1    GETRBLK
         1 000415   003354 702000 1                  TSX2    BRCFULL

      451     9827    2           END;

      452     9828        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:97   
      453     9829
      454     9830        /**************************************************
      455     9831         **                                              **
      456     9832         **                                              **
      457     9833         **      Now have fresh new RBLK for this        **
      458     9834         **      fresh new read.  Fill in params.        **
      459     9835         **                                              **
      460     9836         **************************************************/
      461     9837
      462     9838    1         VLP_STATION=N$REQ.STATION.LSTA$->VLP$STATION;

   9838  1 000416   200004 470500                    LDP0    IOQ$,,AUTO
         1 000417   000013 471500                    LDP1    11,,PR0
         1 000420   000100 100500                    MLR     fill='000'O
         1 000421   100000 000040                    ADSC9   0,,PR1                   cn=0,n=32
         1 000422   200012 000040                    ADSC9   VLP_STATION,,AUTO        cn=0,n=32

      463     9839    1         IF  STA$->KQ$STA.SUCCREAD

   9839  1 000423   200006 471500                    LDP1    STA$,,AUTO
         1 000424   100020 236100                    LDQ     16,,PR1
         1 000425   010000 316003                    CANQ    4096,DU
         1 000426   000432 600000 1                  TZE     s:9841
         1 000427   200016 236100                    LDQ     VLP_STATION+4,,AUTO
         1 000430   100000 316003                    CANQ    32768,DU
         1 000431   003373 601000 1                  TNZ     BRCEOFUNL

      464     9840    1         AND VLP_STATION.CTL.EOFONE THEN GOTO BRCEOFUNL;
      465     9841    1         RBLK$->KQ$RBLK.LATCH=VLP_STATION.CTL.LATCH;

   9841  1 000432   200007 473500                    LDP3    RBLK$,,AUTO
         1 000433   200016 236100                    LDQ     VLP_STATION+4,,AUTO
         1 000434   000021 772000                    QRL     17
         1 000435   300001 676100                    ERQ     1,,PR3
         1 000436   400000 376007                    ANQ     -131072,DL
         1 000437   300001 656100                    ERSQ    1,,PR3

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:98   
      466     9842    1         IF N$REQ.BUFSIZE <= KQ_RDMAX# THEN

   9842  1 000440   000004 236100                    LDQ     4,,PR0
         1 000441   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 000442   000005 116000 2                  CMPQ    5
         1 000443   000451 603000 1                  TRC     s:9844

      467     9843    1          RBLK$->KQ$RBLK.BUFSIZE=N$REQ.BUFSIZE;

   9843  1 000444   200007 473500                    LDP3    RBLK$,,AUTO
         1 000445   000004 236100                    LDQ     4,,PR0
         1 000446   000020 772000                    QRL     16
         1 000447   300016 756100                    STQ     14,,PR3
         1 000450   000454 710000 1                  TRA     s:9845

      468     9844    1         ELSE RBLK$->KQ$RBLK.BUFSIZE=KQ_RDMAX#;

   9844  1 000451   010000 235007                    LDA     4096,DL
         1 000452   200007 473500                    LDP3    RBLK$,,AUTO
         1 000453   300016 755100                    STA     14,,PR3

      469     9845    1         RBLK$->KQ$RBLK.BUF$=N$REQ.BUF$;

   9845  1 000454   000005 236100                    LDQ     5,,PR0
         1 000455   300013 756100                    STQ     11,,PR3

      470     9846    1         RBLK$->KQ$RBLK.MID.PRIMARY = VLP_STATION.MSGID;

   9846  1 000456   200017 235100                    LDA     VLP_STATION+5,,AUTO
         1 000457   300006 755100                    STA     6,,PR3

      471     9847    1         IF VLP_STATION.MSGTYP = ' ' THEN KEY1L=0;

   9847  1 000460   200014 237100                    LDAQ    VLP_STATION+2,,AUTO
         1 000461   000012 117000 2                  CMPAQ   10
         1 000462   000465 601000 1                  TNZ     s:9850

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:99   
   9847  1 000463   200025 450100                    STZ     KEY1L,,AUTO
         1 000464   000513 710000 1                  TRA     s:9856

      472     9848    1         ELSE
      473     9849    2           DO;

      474     9850    2           CALL INDEX (KEY1L,'?',VLP_STATION.MSGTYP);

   9850  1 000465   000000 124500                    SCM     mask='000'O
         1 000466   200014 000010                    ADSC9   VLP_STATION+2,,AUTO      cn=0,n=8
         1 000467   000014 000001 2                  ADSC9   12                       cn=0,n=1
         1 000470   200025 000100                    ARG     KEY1L,,AUTO

      475     9851    2           ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1=ADDR(VLP_STATION.MSGTYP)->B$$KEY1;

   9851  1 000471   200025 720100                    LXL0    KEY1L,,AUTO
         1 000472   200007 473500                    LDP3    RBLK$,,AUTO
         1 000473   040140 100540                    MLR     fill='040'O
         1 000474   200014 000010                    ADSC9   VLP_STATION+2,,AUTO      cn=0,n=*X0
         1 000475   300002 000010                    ADSC9   2,,PR3                   cn=0,n=*X0

      476     9852    2           RBLK$->KQ$RBLK.KEY1L=KEY1L;

   9852  1 000476   200007 473500                    LDP3    RBLK$,,AUTO
         1 000477   200025 236100                    LDQ     KEY1L,,AUTO
         1 000500   000004 736000                    QLS     4
         1 000501   300001 676100                    ERQ     1,,PR3
         1 000502   000360 376007                    ANQ     240,DL
         1 000503   300001 656100                    ERSQ    1,,PR3

      477     9853    2           IF SUBSTR (RBLK$->KQ$RBLK.KEY1,0,1) = '*' THEN

   9853  1 000504   200007 473500                    LDP3    RBLK$,,AUTO
         1 000505   300002 236100                    LDQ     2,,PR3
         1 000506   777000 376003                    ANQ     -512,DU
         1 000507   052000 116003                    CMPQ    21504,DU
         1 000510   000513 601000 1                  TNZ     s:9856
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:100  

      478     9854    2            RBLK$->KQ$RBLK.HONK='1'B;

   9854  1 000511   000400 236007                    LDQ     256,DL
         1 000512   300001 256100                    ORSQ    1,,PR3

      479     9855    2           END;

      480     9856    1         IF VLP_STATION.STATION = ' ' THEN KEY2L=0;

   9856  1 000513   200012 237100                    LDAQ    VLP_STATION,,AUTO
         1 000514   000012 117000 2                  CMPAQ   10
         1 000515   000520 601000 1                  TNZ     s:9859

   9856  1 000516   200026 450100                    STZ     KEY2L,,AUTO
         1 000517   000536 710000 1                  TRA     s:9863

      481     9857    1         ELSE
      482     9858    2           DO;

      483     9859    2           CALL INDEX (KEY2L,'?',VLP_STATION.STATION);

   9859  1 000520   000000 124500                    SCM     mask='000'O
         1 000521   200012 000010                    ADSC9   VLP_STATION,,AUTO        cn=0,n=8
         1 000522   000014 000001 2                  ADSC9   12                       cn=0,n=1
         1 000523   200026 000100                    ARG     KEY2L,,AUTO

      484     9860    2           ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2=ADDR(VLP_STATION.STATION)->B$$KEY2;

   9860  1 000524   200026 720100                    LXL0    KEY2L,,AUTO
         1 000525   200007 473500                    LDP3    RBLK$,,AUTO
         1 000526   040140 100540                    MLR     fill='040'O
         1 000527   200012 000010                    ADSC9   VLP_STATION,,AUTO        cn=0,n=*X0
         1 000530   300004 000010                    ADSC9   4,,PR3                   cn=0,n=*X0

      485     9861    2           RBLK$->KQ$RBLK.KEY2L=KEY2L;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:101  
   9861  1 000531   200007 473500                    LDP3    RBLK$,,AUTO
         1 000532   200026 236100                    LDQ     KEY2L,,AUTO
         1 000533   300001 676100                    ERQ     1,,PR3
         1 000534   000017 376007                    ANQ     15,DL
         1 000535   300001 656100                    ERSQ    1,,PR3

      486     9862    2           END;

      487     9863    1         IF CG$->KQ$CG.QISS THEN

   9863  1 000536   200011 473500                    LDP3    CG$,,AUTO
         1 000537   300106 235100                    LDA     70,,PR3
         1 000540   000573 600000 1                  TZE     s:9883

      488     9864    2           DO;

      489     9865    2           KEY=RBLK$->KQ$RBLK.KEY1;

   9865  1 000541   200007 474500                    LDP4    RBLK$,,AUTO
         1 000542   400002 237100                    LDAQ    2,,PR4
         1 000543   200022 757100                    STAQ    KEY,,AUTO

      490     9866    2           RBLK$->KQ$RBLK.KEY1=RBLK$->KQ$RBLK.KEY2;

   9866  1 000544   400004 237100                    LDAQ    4,,PR4
         1 000545   400002 757100                    STAQ    2,,PR4

      491     9867    2           RBLK$->KQ$RBLK.KEY1L=KEY2L;

   9867  1 000546   200007 474500                    LDP4    RBLK$,,AUTO
         1 000547   200026 236100                    LDQ     KEY2L,,AUTO
         1 000550   000004 736000                    QLS     4
         1 000551   400001 676100                    ERQ     1,,PR4
         1 000552   000360 376007                    ANQ     240,DL
         1 000553   400001 656100                    ERSQ    1,,PR4

      492     9868    2           RBLK$->KQ$RBLK.KEY2=KEY;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:102  

   9868  1 000554   200022 237100                    LDAQ    KEY,,AUTO
         1 000555   200007 474500                    LDP4    RBLK$,,AUTO
         1 000556   400004 757100                    STAQ    4,,PR4

      493     9869    2           RBLK$->KQ$RBLK.KEY2L=KEY1L;

   9869  1 000557   200007 474500                    LDP4    RBLK$,,AUTO
         1 000560   200025 236100                    LDQ     KEY1L,,AUTO
         1 000561   400001 676100                    ERQ     1,,PR4
         1 000562   000017 376007                    ANQ     15,DL
         1 000563   400001 656100                    ERSQ    1,,PR4

      494     9870    2           KEY2L=KEY1L;

   9870  1 000564   200025 235100                    LDA     KEY1L,,AUTO
         1 000565   200026 755100                    STA     KEY2L,,AUTO

      495     9871    2           KEY1L=RBLK$->KQ$RBLK.KEY1L;

   9871  1 000566   200007 474500                    LDP4    RBLK$,,AUTO
         1 000567   400001 236100                    LDQ     1,,PR4
         1 000570   000004 772000                    QRL     4
         1 000571   000017 376007                    ANQ     15,DL
         1 000572   200025 756100                    STQ     KEY1L,,AUTO

      496     9872    2           END;

      497     9873        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:103  
      498     9874        /**************************************************
      499     9875         **                                              **
      500     9876         **                                              **
      501     9877         **      Try to find a message to satisfy the    **
      502     9878         **      read.  Look @ directed messages first   **
      503     9879         **      then at the queue                       **
      504     9880         **                                              **
      505     9881         **************************************************/
      506     9882
      507     9883    1         CALL KQL$DDFIND (STA$->KQ$STA,MBLK$) ALTRET(XFERRD);

   9883  1 000573   200010 634500                    EPPR4   MBLK$,,AUTO
         1 000574   200055 454500                    STP4    R$+2,,AUTO
         1 000575   200006 236100                    LDQ     STA$,,AUTO
         1 000576   200054 756100                    STQ     R$+1,,AUTO
         1 000577   200054 630500                    EPPR0   R$+1,,AUTO
         1 000600   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000601   000000 701000 xent               TSX1    KQL$DDFIND
         1 000602   001775 702000 1                  TSX2    XFERRD

      508     9884    1         IF RBLK$->KQ$RBLK.ERR ~= 0 THEN GOTO BRCRERR;

   9884  1 000603   200007 470500                    LDP0    RBLK$,,AUTO
         1 000604   000001 236100                    LDQ     1,,PR0
         1 000605   007000 316007                    CANQ    3584,DL
         1 000606   003331 601000 1                  TNZ     BRCRERR

      509     9885    1         IF VLP_STATION.CTL.DIRONLY

   9885  1 000607   200016 236100                    LDQ     VLP_STATION+4,,AUTO
         1 000610   004000 316003                    CANQ    2048,DU
         1 000611   001454 601000 1                  TNZ     DIRONLY
         1 000612   000002 236100                    LDQ     2,,PR0
         1 000613   777000 376003                    ANQ     -512,DU
         1 000614   052000 116003                    CMPQ    21504,DU
         1 000615   000621 601000 1                  TNZ     s:9885+10
         1 000616   200011 471500                    LDP1    CG$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:104  
         1 000617   100106 235100                    LDA     70,,PR1
         1 000620   001454 600000 1                  TZE     DIRONLY
         1 000621   000004 236100                    LDQ     4,,PR0
         1 000622   777000 376003                    ANQ     -512,DU
         1 000623   052000 116003                    CMPQ    21504,DU
         1 000624   000631 601000 1                  TNZ     s:9890
         1 000625   200011 471500                    LDP1    CG$,,AUTO
         1 000626   100106 236100                    LDQ     70,,PR1
         1 000627   400000 116003                    CMPQ    -131072,DU
         1 000630   001454 600000 1                  TZE     DIRONLY

      510     9886    1         OR (SUBSTR(RBLK$->KQ$RBLK.KEY1,0,1)='*' AND CG$->KQ$CG.QISS='0'B)
      511     9887    1         OR (SUBSTR(RBLK$->KQ$RBLK.KEY2,0,1)='*' AND CG$->KQ$CG.QISS='1'B)
      512     9888    1         THEN GOTO DIRONLY;       /* Msgtyp=*? messages may only be directed */
      513     9889              %UNLOCK (G=STA$->KQ$STA.GATE);

   9890  1 000631   200006 236100                    LDQ     STA$,,AUTO
         1 000632   000016 036003                    ADLQ    14,DU
         1 000633   200054 756100                    STQ     R$+1,,AUTO
         1 000634   200054 630500                    EPPR0   R$+1,,AUTO
         1 000635   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000636   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000637   000000 011000                    NOP     0

      514     9892    1         CALL GETQUEUE;

   9892  1 000640   005125 701000 1                  TSX1    GETQUEUE
         1 000641   000000 011000                    NOP     0

   9887  1 000642                       QTS0         null
      515     9893    1   QTS0: ;
      516     9894    1         QACTCNT=KQ$QTREE.ACTCNT;

   9894  1 000642   200011 470500                    LDP0    CG$,,AUTO
         1 000643   000057 471500                    LDP1    47,,PR0
         1 000644   100005 236100                    LDQ     5,,PR1
         1 000645   000022 772000                    QRL     18
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:105  
         1 000646   200037 756100                    STQ     QACTCNT,,AUTO

      517     9895    1         IF KEY1L = 8 THEN

   9895  1 000647   200025 235100                    LDA     KEY1L,,AUTO
         1 000650   000010 115007                    CMPA    8,DL
         1 000651   001172 601000 1                  TNZ     s:9995

      518     9896    2           DO;

      519     9897                                /**********************************
      520     9898                                 *                                *
      521     9899                                 *        SPECIFIC Q-KEY          *
      522     9900                                 *                                *
      523     9901                                 **********************************/
      524     9902    2           CALL KQB$SRCH (KQ$QTREE,RBLK$->KQ$RBLK.KEY1,QTN$) ALTRET(QTS1);

   9902  1 000652   200034 633500                    EPPR3   QTN$,,AUTO
         1 000653   200056 453500                    STP3    R$+3,,AUTO
         1 000654   200007 236100                    LDQ     RBLK$,,AUTO
         1 000655   000002 036003                    ADLQ    2,DU
         1 000656   200055 756100                    STQ     R$+2,,AUTO
         1 000657   200054 451500                    STP1    R$+1,,AUTO
         1 000660   200054 630500                    EPPR0   R$+1,,AUTO
         1 000661   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000662   000000 701000 xent               TSX1    KQB$SRCH
         1 000663   000665 702000 1                  TSX2    QTS1

      525     9903    2           GOTO QTS4;

   9903  1 000664   001001 710000 1                  TRA     QTS4

      526     9904    2   QTS1:   IF VLP_STATION.CTL.EOFNONE THEN

   9904  1 000665   200016 236100       QTS1         LDQ     VLP_STATION+4,,AUTO
         1 000666   040000 316003                    CANQ    16384,DU
         1 000667   000675 600000 1                  TZE     s:9909
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:106  

      527     9905    3             DO;

      528     9906    3   QTS2:     CALL KQL$QDFDUN (STA$->KQ$STA);

   9906  1 000670   200006 630500       QTS2         EPPR0   STA$,,AUTO
         1 000671   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000672   000000 701000 xent               TSX1    KQL$QDFDUN
         1 000673   000000 011000                    NOP     0

      529     9907    3             GOTO BRCEOF;

   9907  1 000674   003402 710000 1                  TRA     BRCEOF

      530     9908    3             END;
      531     9909    2           IF N$REQ.DVE.DVBYTE.NODAT THEN

   9909  1 000675   200004 470500                    LDP0    IOQ$,,AUTO
         1 000676   000031 236100                    LDQ     25,,PR0
         1 000677   004000 316003                    CANQ    2048,DU
         1 000700   000706 600000 1                  TZE     s:9914

      532     9910    3             DO;

      533     9911    3   QTS25:    CALL KQL$QDFDUN (STA$->KQ$STA);

   9911  1 000701   200006 630500       QTS25        EPPR0   STA$,,AUTO
         1 000702   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000703   000000 701000 xent               TSX1    KQL$QDFDUN
         1 000704   000000 011000                    NOP     0

      534     9912    3             GOTO BRCNODAT;

   9912  1 000705   003406 710000 1                  TRA     BRCNODAT

      535     9913    3             END;
      536     9914    2           IF CG$->KQ$CG.XQTNLGL = '0'B
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:107  

   9914  1 000706   200011 471500                    LDP1    CG$,,AUTO
         1 000707   100105 236100                    LDQ     69,,PR1
         1 000710   000002 316007                    CANQ    2,DL
         1 000711   000717 601000 1                  TNZ     s:9919

      537     9915    3           THEN DO;

      538     9916    3   QTS3:     CALL KQL$QDFDUN (STA$->KQ$STA);

   9916  1 000712   200006 630500       QTS3         EPPR0   STA$,,AUTO
         1 000713   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000714   000000 701000 xent               TSX1    KQL$QDFDUN
         1 000715   000000 011000                    NOP     0

      539     9917    3             GOTO BRCKEY;

   9917  1 000716   003310 710000 1                  TRA     BRCKEY

      540     9918    3             END;
      541     9919    2           IF (CG$->KQ$CG.QISS AND CG$->KQ$CG.AUCTL.RAS = '0'B)

   9919  1 000717   100106 235100                    LDA     70,,PR1
         1 000720   000731 600000 1                  TZE     s:9924
         1 000721   100133 236100                    LDQ     91,,PR1
         1 000722   000004 316007                    CANQ    4,DL
         1 000723   000731 601000 1                  TNZ     s:9924

      542     9920    3           THEN DO;

      543     9921    3   QTS305:   CALL KQL$QDFDUN (STA$->KQ$STA);

   9921  1 000724   200006 630500       QTS305       EPPR0   STA$,,AUTO
         1 000725   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000726   000000 701000 xent               TSX1    KQL$QDFDUN
         1 000727   000000 011000                    NOP     0

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:108  
      544     9922    3             GOTO BRDISC;

   9922  1 000730   003314 710000 1                  TRA     BRDISC

      545     9923    3             END;
      546     9924    2           QTN$=STA$;

   9924  1 000731   200006 236100                    LDQ     STA$,,AUTO
         1 000732   200034 756100                    STQ     QTN$,,AUTO

      547     9925    2           IF CG$->KQ$CG.QISS='0'B

   9925  1 000733   000000 115003                    CMPA    0,DU
         1 000734   000751 601000 1                  TNZ     s:9927

      548     9926    2           THEN CALL KQT$GETTYP(CG$->KQ$CG,QTN$,RBLK$->KQ$RBLK.KEY1) ALTRET(QTS31);

   9926  1 000735   200007 236100                    LDQ     RBLK$,,AUTO
         1 000736   000002 036003                    ADLQ    2,DU
         1 000737   200056 756100                    STQ     R$+3,,AUTO
         1 000740   200034 633500                    EPPR3   QTN$,,AUTO
         1 000741   200055 453500                    STP3    R$+2,,AUTO
         1 000742   200011 236100                    LDQ     CG$,,AUTO
         1 000743   200054 756100                    STQ     R$+1,,AUTO
         1 000744   200054 630500                    EPPR0   R$+1,,AUTO
         1 000745   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000746   000000 701000 xent               TSX1    KQT$GETTYP
         1 000747   000765 702000 1                  TSX2    QTS31
         1 000750   000764 710000 1                  TRA     s:9928

      549     9927    2           ELSE CALL KQT$GETSTA(CG$->KQ$CG,QTN$,RBLK$->KQ$RBLK.KEY1) ALTRET(QTS31);

   9927  1 000751   200007 236100                    LDQ     RBLK$,,AUTO
         1 000752   000002 036003                    ADLQ    2,DU
         1 000753   200056 756100                    STQ     R$+3,,AUTO
         1 000754   200034 633500                    EPPR3   QTN$,,AUTO
         1 000755   200055 453500                    STP3    R$+2,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:109  
         1 000756   200011 236100                    LDQ     CG$,,AUTO
         1 000757   200054 756100                    STQ     R$+1,,AUTO
         1 000760   200054 630500                    EPPR0   R$+1,,AUTO
         1 000761   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000762   000000 701000 xent               TSX1    KQT$GETSTA
         1 000763   000765 702000 1                  TSX2    QTS31

      550     9928    2           GOTO QTS45;

   9928  1 000764   001035 710000 1                  TRA     QTS45

   9928  1 000765                       QTS31        null
      551     9929    2   QTS31:  ;
      552     9930                %LOCK (G=KQ$QTREE.GATE);

   9931  1 000765   200011 470500                    LDP0    CG$,,AUTO
         1 000766   000057 471500                    LDP1    47,,PR0
         1 000767   200054 451500                    STP1    R$+1,,AUTO
         1 000770   200054 630500                    EPPR0   R$+1,,AUTO
         1 000771   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000772   000000 701000 xent               TSX1    HFC$LOCK
         1 000773   000000 011000                    NOP     0

      553     9933    2           CALL KQL$QDFDUN(STA$->KQ$STA);

   9933  1 000774   200006 630500                    EPPR0   STA$,,AUTO
         1 000775   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000776   000000 701000 xent               TSX1    KQL$QDFDUN
         1 000777   000000 011000                    NOP     0

      554     9934    2           GOTO BRCFUL;

   9934  1 001000   003320 710000 1                  TRA     BRCFUL

      555     9935    2   QTS4:   IF QTN$->KQ$QTN.CNACT < QTN$->KQ$QTN.MXACT

   9935  1 001001   200034 470500       QTS4         LDP0    QTN$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:110  
         1 001002   000044 236100                    LDQ     36,,PR0
         1 001003   000045 116100                    CMPQ    37,,PR0
         1 001004   001010 604000 1                  TMI     s:9938
         1 001005   200034 236100                    LDQ     QTN$,,AUTO
         1 001006   200024 116100                    CMPQ    ACTQTN$,,AUTO
         1 001007   001026 601000 1                  TNZ     s:9942

      556     9936    2           OR QTN$ = ACTQTN$ THEN
      557     9937    3             DO;

      558     9938    3             MBLK$=QTN$;

   9938  1 001010   200034 236100                    LDQ     QTN$,,AUTO
         1 001011   200010 756100                    STQ     MBLK$,,AUTO

      559     9939    3             CALL KQL$QDFIND (STA$->KQ$STA,MBLK$) ALTRET(GOTQMSG);

   9939  1 001012   200010 631500                    EPPR1   MBLK$,,AUTO
         1 001013   200055 451500                    STP1    R$+2,,AUTO
         1 001014   200006 236100                    LDQ     STA$,,AUTO
         1 001015   200054 756100                    STQ     R$+1,,AUTO
         1 001016   200054 630500                    EPPR0   R$+1,,AUTO
         1 001017   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001020   000000 701000 xent               TSX1    KQL$QDFIND
         1 001021   001744 702000 1                  TSX2    GOTQMSG

      560     9940    3             IF RBLK$->KQ$RBLK.ERR ~= 0 THEN GOTO BRCRERR0;

   9940  1 001022   200007 470500                    LDP0    RBLK$,,AUTO
         1 001023   000001 236100                    LDQ     1,,PR0
         1 001024   007000 316007                    CANQ    3584,DL
         1 001025   003324 601000 1                  TNZ     BRCRERR0

      561     9941    3             END;

      562     9942    2           IF VLP_STATION.CTL.EOFNONE THEN

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:111  
   9942  1 001026   200016 236100                    LDQ     VLP_STATION+4,,AUTO
         1 001027   040000 316003                    CANQ    16384,DU
         1 001030   000670 601000 1                  TNZ     QTS2

      563     9943    2            GOTO QTS2;
      564     9944    2           IF N$REQ.DVE.DVBYTE.NODAT THEN

   9944  1 001031   200004 470500                    LDP0    IOQ$,,AUTO
         1 001032   000031 236100                    LDQ     25,,PR0
         1 001033   004000 316003                    CANQ    2048,DU
         1 001034   000701 601000 1                  TNZ     QTS25

      565     9945    2            GOTO QTS25;
      566     9946    2   QTS45:  CALL CHKSTA  ALTRET(QTS305);

   9946  1 001035   006364 701000 1     QTS45        TSX1    CHKSTA
         1 001036   000724 702000 1                  TSX2    QTS305

      567     9947    2           RBLK$->KQ$RBLK.QTN$=QTN$;

   9947  1 001037   200034 236100                    LDQ     QTN$,,AUTO
         1 001040   200007 470500                    LDP0    RBLK$,,AUTO
         1 001041   000021 756100                    STQ     17,,PR0

      568     9948    2           QUEUE$=ADDR(QTN$->KQ$QTN.READS$);

   9948  1 001042   200034 236100                    LDQ     QTN$,,AUTO
         1 001043   000046 036003                    ADLQ    38,DU
         1 001044   200042 756100                    STQ     QUEUE$,,AUTO

      569     9949    2   QTS5:   CALL VRNQKEY ALTRET(BRCTYCQ);

   9949  1 001045   006044 701000 1     QTS5         TSX1    VRNQKEY
         1 001046   003264 702000 1                  TSX2    BRCTYCQ

      570     9950    2           RBLK$->KQ$RBLK.STA$=STA$;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:112  
   9950  1 001047   200006 236100                    LDQ     STA$,,AUTO
         1 001050   200007 470500                    LDP0    RBLK$,,AUTO
         1 001051   000012 756100                    STQ     10,,PR0

      571     9951    2           CALL MAPBUF ALTRET(BRCBUFQ);

   9951  1 001052   006576 701000 1                  TSX1    MAPBUF
         1 001053   003234 702000 1                  TSX2    BRCBUFQ

      572     9952    2           P$=QUEUE$->B$$PTR;

   9952  1 001054   200042 470500                    LDP0    QUEUE$,,AUTO
         1 001055   000000 236100                    LDQ     0,,PR0
         1 001056   200027 756100                    STQ     P$,,AUTO

      573     9953    3             DO WHILE(P$~=ADDR(NIL));

   9953  1 001057   001066 710000 1                  TRA     s:9956

      574     9954    3             QUEUE$=ADDR(P$->KQ$RBLK.QRLNK$);

   9954  1 001060   200027 236100                    LDQ     P$,,AUTO
         1 001061   000020 036003                    ADLQ    16,DU
         1 001062   200042 756100                    STQ     QUEUE$,,AUTO

      575     9955    3             P$=QUEUE$->B$$PTR;

   9955  1 001063   200042 470500                    LDP0    QUEUE$,,AUTO
         1 001064   000000 236100                    LDQ     0,,PR0
         1 001065   200027 756100                    STQ     P$,,AUTO

      576     9956    3             END;

   9956  1 001066   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001067   001060 601000 1                  TNZ     s:9954

      577     9957    2           RBLK$->KQ$RBLK.QRLNK$=ADDR(NIL);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:113  

   9957  1 001070   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001071   200007 471500                    LDP1    RBLK$,,AUTO
         1 001072   100020 756100                    STQ     16,,PR1

      578     9958    2           QUEUE$->B$$PTR=RBLK$;

   9958  1 001073   200007 236100                    LDQ     RBLK$,,AUTO
         1 001074   000000 756100                    STQ     0,,PR0

      579     9959    2           LDCT$->NK$LDCT.IOQ$=IOQ$;

   9959  1 001075   200004 236100                    LDQ     IOQ$,,AUTO
         1 001076   200005 471500                    LDP1    LDCT$,,AUTO
         1 001077   100001 756100                    STQ     1,,PR1

      580     9960    2           IF VLP_STATION.EOFTIME~=0 THEN

   9960  1 001100   200016 720100                    LXL0    VLP_STATION+4,,AUTO
         1 001101   001112 600000 1                  TZE     s:9968

      581     9961    3             DO;

      582     9962    3             IF CG$->KQ$CG.QISS THEN

   9962  1 001102   200011 473500                    LDP3    CG$,,AUTO
         1 001103   300106 235100                    LDA     70,,PR3
         1 001104   001110 600000 1                  TZE     s:9966

      583     9963                    /* STREE is already locked since it is the QTREE */
      584     9964    3              CALL QEOFTIMENL;

   9964  1 001105   005364 701000 1                  TSX1    QEOFTIMENL
         1 001106   000000 011000                    NOP     0
         1 001107   001112 710000 1                  TRA     s:9968

      585     9965    3             ELSE
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:114  
      586     9966    3              CALL QEOFTIME;

   9966  1 001110   005341 701000 1                  TSX1    QEOFTIME
         1 001111   000000 011000                    NOP     0

      587     9967    3             END;

      588     9968    2           RBLK$->KQ$RBLK.STATE=KQRS_PEND#;

   9968  1 001112   000002 220003                    LDX0    2,DU
         1 001113   200007 470500                    LDP0    RBLK$,,AUTO
         1 001114   000001 740100                    STX0    1,,PR0

      589     9969    2           CALL KQL$QDFDUN (STA$->KQ$STA);

   9969  1 001115   200006 630500                    EPPR0   STA$,,AUTO
         1 001116   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001117   000000 701000 xent               TSX1    KQL$QDFDUN
         1 001120   000000 011000                    NOP     0

      590     9970                %LOCK (G=STA$->KQ$STA.GATE);

   9971  1 001121   200006 236100                    LDQ     STA$,,AUTO
         1 001122   000016 036003                    ADLQ    14,DU
         1 001123   200054 756100                    STQ     R$+1,,AUTO
         1 001124   200054 630500                    EPPR0   R$+1,,AUTO
         1 001125   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001126   000000 701000 xent               TSX1    HFC$LOCK
         1 001127   000000 011000                    NOP     0

      591     9973    2           IF RBLK$->KQ$RBLK.STATE = KQRS_COMP#

   9973  1 001130   200007 470500                    LDP0    RBLK$,,AUTO
         1 001131   000001 220100                    LDX0    1,,PR0
         1 001132   000001 100003                    CMPX0   1,DU
         1 001133   001140 600000 1                  TZE     s:9977
         1 001134   200004 471500                    LDP1    IOQ$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:115  
         1 001135   100004 236100                    LDQ     4,,PR1
         1 001136   000020 316007                    CANQ    16,DL
         1 001137   001155 601000 1                  TNZ     s:9983

      592     9974    2           OR N$REQ.OPFLG.WAIT = '0'B THEN
      593     9975    3             DO;

      594     9976                  %UNLOCK (G=STA$->KQ$STA.GATE);

   9977  1 001140   200006 236100                    LDQ     STA$,,AUTO
         1 001141   000016 036003                    ADLQ    14,DU
         1 001142   200054 756100                    STQ     R$+1,,AUTO
         1 001143   200054 630500                    EPPR0   R$+1,,AUTO
         1 001144   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001145   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001146   000000 011000                    NOP     0

      595     9979    3             IF ACTQTN$ ~= ADDR(NIL) THEN CALL ACTQTN;

   9979  1 001147   200024 236100                    LDQ     ACTQTN$,,AUTO
         1 001150   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001151   001154 600000 1                  TZE     s:9980

   9979  1 001152   005723 701000 1                  TSX1    ACTQTN
         1 001153   000000 011000                    NOP     0

      596     9980    3             RETURN;

   9980  1 001154   000000 702200 xent               TSX2  ! X66_ARET

      597     9981    3             END;
      598     9982                %UNLOCK (G=STA$->KQ$STA.GATE);

   9983  1 001155   200006 236100                    LDQ     STA$,,AUTO
         1 001156   000016 036003                    ADLQ    14,DU
         1 001157   200054 756100                    STQ     R$+1,,AUTO
         1 001160   200054 630500                    EPPR0   R$+1,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:116  
         1 001161   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001162   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001163   000000 011000                    NOP     0

      599     9985    2           IF ACTQTN$ ~= ADDR(NIL) THEN CALL ACTQTN;

   9985  1 001164   200024 236100                    LDQ     ACTQTN$,,AUTO
         1 001165   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001166   001171 600000 1                  TZE     s:9986

   9985  1 001167   005723 701000 1                  TSX1    ACTQTN
         1 001170   000000 011000                    NOP     0

      600     9986    2           GOTO REGIMA;

   9986  1 001171   001607 710000 1                  TRA     REGIMA

      601     9987    2           END;
      602     9988
      603     9989                                /**********************************
      604     9990                                 *                                *
      605     9991                                 *       WILD-CARDED Q-KEY        *
      606     9992                                 *                                *
      607     9993                                 **********************************/
      608     9994    2         ELSE DO;

      609     9995    2           CALL KQX$SETTIME(TIMCHK);

   9995  1 001172   200044 633500                    EPPR3   TIMCHK,,AUTO
         1 001173   200054 453500                    STP3    R$+1,,AUTO
         1 001174   200054 630500                    EPPR0   R$+1,,AUTO
         1 001175   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001176   000000 701000 xent               TSX1    KQX$SETTIME
         1 001177   000000 011000                    NOP     0

      610     9996    2           IF KEY1L = 0 THEN

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:117  
   9996  1 001200   200025 235100                    LDA     KEY1L,,AUTO
         1 001201   001306 601000 1                  TNZ     s:10030

      611     9997    3             DO;

      612     9998                           /* Accelerate read with just '?' */
      613     9999    3             QTN$=CG$->KQ$CG.QUEUE.PLHD$;

   9999  1 001202   200011 470500                    LDP0    CG$,,AUTO
         1 001203   000061 236100                    LDQ     49,,PR0
         1 001204   200034 756100                    STQ     QTN$,,AUTO

      614    10000    4               DO WHILE (QTN$ ~= ADDR(NIL));

  10000  1 001205   001302 710000 1                  TRA     s:10025

      615    10001    4               IF QTN$->KQ$QTN.CNACT < QTN$->KQ$QTN.MXACT

  10001  1 001206   200034 470500                    LDP0    QTN$,,AUTO
         1 001207   000044 236100                    LDQ     36,,PR0
         1 001210   000045 116100                    CMPQ    37,,PR0
         1 001211   001215 604000 1                  TMI     s:10004
         1 001212   200034 236100                    LDQ     QTN$,,AUTO
         1 001213   200024 116100                    CMPQ    ACTQTN$,,AUTO
         1 001214   001277 601000 1                  TNZ     s:10024

      616    10002    4               OR QTN$ = ACTQTN$ THEN
      617    10003    5                 DO;

      618    10004    5                 MBLK$=QTN$;

  10004  1 001215   200034 236100                    LDQ     QTN$,,AUTO
         1 001216   200010 756100                    STQ     MBLK$,,AUTO

      619    10005    5                 CALL KQL$QDFIND (STA$->KQ$STA,MBLK$) ALTRET(GOTQMSG);

  10005  1 001217   200010 631500                    EPPR1   MBLK$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:118  
         1 001220   200055 451500                    STP1    R$+2,,AUTO
         1 001221   200006 236100                    LDQ     STA$,,AUTO
         1 001222   200054 756100                    STQ     R$+1,,AUTO
         1 001223   200054 630500                    EPPR0   R$+1,,AUTO
         1 001224   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001225   000000 701000 xent               TSX1    KQL$QDFIND
         1 001226   001744 702000 1                  TSX2    GOTQMSG

      620    10006    5                 IF RBLK$->KQ$RBLK.ERR ~= 0 THEN GOTO BRCRERR0;

  10006  1 001227   200007 470500                    LDP0    RBLK$,,AUTO
         1 001230   000001 236100                    LDQ     1,,PR0
         1 001231   007000 316007                    CANQ    3584,DL
         1 001232   003324 601000 1                  TNZ     BRCRERR0

      621    10007                          /* If we muck around in here for too long, we will SCREECH */
      622    10008                          /* because we left the QTREE gate locked too long.         */
      623    10009                          /* KQL$QDFIND will not leave it locked for over .5 secs    */
      624    10010                          /* and we must not leave it locked in case of several      */
      625    10011                          /* less-than-.5-sec calls to KQL$QDFIND.                   */
      626    10012    6                 CALL KQX$CHKTIME(TIMCHK) WHENRETURN DO;

  10012  1 001233   200044 631500                    EPPR1   TIMCHK,,AUTO
         1 001234   200054 451500                    STP1    R$+1,,AUTO
         1 001235   200054 630500                    EPPR0   R$+1,,AUTO
         1 001236   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001237   000000 701000 xent               TSX1    KQX$CHKTIME
         1 001240   001271 702000 1                  TSX2    s:10022

      627    10013                        %UNLOCK (G=KQ$QTREE.GATE);

  10014  1 001241   200011 470500                    LDP0    CG$,,AUTO
         1 001242   000057 471500                    LDP1    47,,PR0
         1 001243   200054 451500                    STP1    R$+1,,AUTO
         1 001244   200054 630500                    EPPR0   R$+1,,AUTO
         1 001245   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001246   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:119  
         1 001247   000000 011000                    NOP     0

      628    10016    6                   CALL SSR$REG(%SS_QE);

  10016  1 001250   000016 630400 2                  EPPR0   14
         1 001251   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001252   000000 701000 xent               TSX1    SSR$REG
         1 001253   000000 011000                    NOP     0

      629    10017                        %LOCK (G=KQ$QTREE.GATE);

  10018  1 001254   200011 470500                    LDP0    CG$,,AUTO
         1 001255   000057 471500                    LDP1    47,,PR0
         1 001256   200054 451500                    STP1    R$+1,,AUTO
         1 001257   200054 630500                    EPPR0   R$+1,,AUTO
         1 001260   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001261   000000 701000 xent               TSX1    HFC$LOCK
         1 001262   000000 011000                    NOP     0

      630    10020    6                   CALL KQX$SETTIME(TIMCHK);

  10020  1 001263   200044 630500                    EPPR0   TIMCHK,,AUTO
         1 001264   200054 450500                    STP0    R$+1,,AUTO
         1 001265   200054 630500                    EPPR0   R$+1,,AUTO
         1 001266   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001267   000000 701000 xent               TSX1    KQX$SETTIME
         1 001270   000000 011000                    NOP     0

      631    10021    6                   END;

      632    10022    5                 IF QACTCNT ~= KQ$QTREE.ACTCNT THEN GOTO QTS0;

  10022  1 001271   200011 470500                    LDP0    CG$,,AUTO
         1 001272   000057 471500                    LDP1    47,,PR0
         1 001273   100005 236100                    LDQ     5,,PR1
         1 001274   000022 772000                    QRL     18
         1 001275   200037 116100                    CMPQ    QACTCNT,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:120  
         1 001276   000642 601000 1                  TNZ     QTS0

      633    10023    5                 END;

      634    10024    4               QTN$=QTN$->KQ$QTN.PLINK$;

  10024  1 001277   200034 470500                    LDP0    QTN$,,AUTO
         1 001300   000047 236100                    LDQ     39,,PR0
         1 001301   200034 756100                    STQ     QTN$,,AUTO

      635    10025    4               END;

  10025  1 001302   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001303   001206 601000 1                  TNZ     s:10001

      636    10026    3             QKNFND=0;

  10026  1 001304   200041 450100                    STZ     QKNFND,,AUTO

      637    10027    3             END;

  10027  1 001305   001423 710000 1                  TRA     s:10059

      638    10028    2           ELSE
      639    10029    3             DO;

      640    10030    3             QKNFND=1;

  10030  1 001306   000001 236007                    LDQ     1,DL
         1 001307   200041 756100                    STQ     QKNFND,,AUTO

      641    10031    3             QTN$=CG$->KQ$CG.QUEUE.PLHD$;

  10031  1 001310   200011 470500                    LDP0    CG$,,AUTO
         1 001311   000061 236100                    LDQ     49,,PR0
         1 001312   200034 756100                    STQ     QTN$,,AUTO

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:121  
      642    10032    4               DO WHILE (QTN$ ~= ADDR(NIL));

  10032  1 001313   001421 710000 1                  TRA     s:10056

      643    10033    4              IF ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1 = ADDR(QTN$->KQ$QTN.STA.BTN.KEY)->
             10033                        B$$KEY1 THEN

  10033  1 001314   200007 470500                    LDP0    RBLK$,,AUTO
         1 001315   200025 720100                    LXL0    KEY1L,,AUTO
         1 001316   200034 471500                    LDP1    QTN$,,AUTO
         1 001317   040140 106540                    CMPC    fill='040'O
         1 001320   000002 000010                    ADSC9   2,,PR0                   cn=0,n=*X0
         1 001321   100005 000010                    ADSC9   5,,PR1                   cn=0,n=*X0
         1 001322   001416 601000 1                  TNZ     QTS11

      644    10034    4                IF QTN$->KQ$QTN.CNACT < QTN$->KQ$QTN.MXACT

  10034  1 001323   100044 236100                    LDQ     36,,PR1
         1 001324   100045 116100                    CMPQ    37,,PR1
         1 001325   001331 604000 1                  TMI     s:10037
         1 001326   200034 236100                    LDQ     QTN$,,AUTO
         1 001327   200024 116100                    CMPQ    ACTQTN$,,AUTO
         1 001330   001416 601000 1                  TNZ     QTS11

      645    10035    4                OR QTN$ = ACTQTN$ THEN
      646    10036    5                  DO;

      647    10037    5                  MBLK$=QTN$;

  10037  1 001331   200034 236100                    LDQ     QTN$,,AUTO
         1 001332   200010 756100                    STQ     MBLK$,,AUTO

      648    10038    5                  CALL KQL$QDFIND (STA$->KQ$STA,MBLK$) ALTRET(GOTQMSG);

  10038  1 001333   200010 633500                    EPPR3   MBLK$,,AUTO
         1 001334   200055 453500                    STP3    R$+2,,AUTO
         1 001335   200006 236100                    LDQ     STA$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:122  
         1 001336   200054 756100                    STQ     R$+1,,AUTO
         1 001337   200054 630500                    EPPR0   R$+1,,AUTO
         1 001340   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001341   000000 701000 xent               TSX1    KQL$QDFIND
         1 001342   001744 702000 1                  TSX2    GOTQMSG

      649    10039    5                  IF RBLK$->KQ$RBLK.ERR ~= 0 THEN GOTO BRCRERR0;

  10039  1 001343   200007 470500                    LDP0    RBLK$,,AUTO
         1 001344   000001 236100                    LDQ     1,,PR0
         1 001345   007000 316007                    CANQ    3584,DL
         1 001346   003324 601000 1                  TNZ     BRCRERR0

      650    10040    6                  CALL KQX$CHKTIME(TIMCHK) WHENRETURN DO;

  10040  1 001347   200044 631500                    EPPR1   TIMCHK,,AUTO
         1 001350   200054 451500                    STP1    R$+1,,AUTO
         1 001351   200054 630500                    EPPR0   R$+1,,AUTO
         1 001352   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001353   000000 701000 xent               TSX1    KQX$CHKTIME
         1 001354   001405 702000 1                  TSX2    s:10050

      651    10041                         %UNLOCK (G=KQ$QTREE.GATE);

  10042  1 001355   200011 470500                    LDP0    CG$,,AUTO
         1 001356   000057 471500                    LDP1    47,,PR0
         1 001357   200054 451500                    STP1    R$+1,,AUTO
         1 001360   200054 630500                    EPPR0   R$+1,,AUTO
         1 001361   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001362   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001363   000000 011000                    NOP     0

      652    10044    6                    CALL SSR$REG (%SS_QE);

  10044  1 001364   000016 630400 2                  EPPR0   14
         1 001365   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001366   000000 701000 xent               TSX1    SSR$REG
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:123  
         1 001367   000000 011000                    NOP     0

      653    10045                         %LOCK (G=KQ$QTREE.GATE);

  10046  1 001370   200011 470500                    LDP0    CG$,,AUTO
         1 001371   000057 471500                    LDP1    47,,PR0
         1 001372   200054 451500                    STP1    R$+1,,AUTO
         1 001373   200054 630500                    EPPR0   R$+1,,AUTO
         1 001374   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001375   000000 701000 xent               TSX1    HFC$LOCK
         1 001376   000000 011000                    NOP     0

      654    10048    6                    CALL KQX$SETTIME(TIMCHK);

  10048  1 001377   200044 630500                    EPPR0   TIMCHK,,AUTO
         1 001400   200054 450500                    STP0    R$+1,,AUTO
         1 001401   200054 630500                    EPPR0   R$+1,,AUTO
         1 001402   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001403   000000 701000 xent               TSX1    KQX$SETTIME
         1 001404   000000 011000                    NOP     0

      655    10049    6                    END;

      656    10050    5                  IF QACTCNT ~= KQ$QTREE.ACTCNT THEN GOTO QTS0;

  10050  1 001405   200011 470500                    LDP0    CG$,,AUTO
         1 001406   000057 471500                    LDP1    47,,PR0
         1 001407   100005 236100                    LDQ     5,,PR1
         1 001410   000022 772000                    QRL     18
         1 001411   200037 116100                    CMPQ    QACTCNT,,AUTO
         1 001412   000642 601000 1                  TNZ     QTS0

      657    10051    5                  CALL CHKSTA ALTRET(QTS11);

  10051  1 001413   006364 701000 1                  TSX1    CHKSTA
         1 001414   001416 702000 1                  TSX2    QTS11

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:124  
      658    10052    5                  QKNFND=0;

  10052  1 001415   200041 450100                    STZ     QKNFND,,AUTO

  10052  1 001416                       QTS11        null
      659    10053    5   QTS11:         ;
      660    10054    5                  END;

      661    10055    4               QTN$=QTN$->KQ$QTN.PLINK$;

  10055  1 001416   200034 470500                    LDP0    QTN$,,AUTO
         1 001417   000047 236100                    LDQ     39,,PR0
         1 001420   200034 756100                    STQ     QTN$,,AUTO

      662    10056    4               END;

  10056  1 001421   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001422   001314 601000 1                  TNZ     s:10033

      663    10057    3             END;

      664    10058    2           END;

      665    10059    1         IF VLP_STATION.CTL.EOFNONE THEN

  10059  1 001423   200016 236100                    LDQ     VLP_STATION+4,,AUTO
         1 001424   040000 316003                    CANQ    16384,DU
         1 001425   000670 601000 1                  TNZ     QTS2

      666    10060    1          GOTO QTS2;
      667    10061    1         IF N$REQ.DVE.DVBYTE.NODAT THEN

  10061  1 001426   200004 470500                    LDP0    IOQ$,,AUTO
         1 001427   000031 236100                    LDQ     25,,PR0
         1 001430   004000 316003                    CANQ    2048,DU
         1 001431   000701 601000 1                  TNZ     QTS25

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:125  
      668    10062    1          GOTO QTS25;
      669    10063    1         IF QKNFND ~= 0 THEN

  10063  1 001432   200041 235100                    LDA     QKNFND,,AUTO
         1 001433   001445 600000 1                  TZE     QTS12

      670    10064    2           DO;

      671    10065    2           IF CG$->KQ$CG.XQTNLGL = '0'B

  10065  1 001434   200011 471500                    LDP1    CG$,,AUTO
         1 001435   100105 236100                    LDQ     69,,PR1
         1 001436   000002 316007                    CANQ    2,DL
         1 001437   000712 600000 1                  TZE     QTS3
         1 001440   100106 235100                    LDA     70,,PR1
         1 001441   001445 600000 1                  TZE     QTS12
         1 001442   100133 236100                    LDQ     91,,PR1
         1 001443   000004 316007                    CANQ    4,DL
         1 001444   000712 600000 1                  TZE     QTS3

      672    10066    2           OR (CG$->KQ$CG.QISS AND CG$->KQ$CG.AUCTL.RAS = '0'B) THEN
      673    10067    2            GOTO QTS3;
      674    10068    2           END;

  10063  1 001445                       QTS12        null
      675    10069    1   QTS12:;
      676    10070    1         QUEUE$=ADDR(CG$->KQ$CG.QUEUE.WCRL$);

  10070  1 001445   200011 236100                    LDQ     CG$,,AUTO
         1 001446   000060 036003                    ADLQ    48,DU
         1 001447   200042 756100                    STQ     QUEUE$,,AUTO

      677    10071    1         RBLK$->KQ$RBLK.QTN$=ADDR(NIL);

  10071  1 001450   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001451   200007 471500                    LDP1    RBLK$,,AUTO
         1 001452   100021 756100                    STQ     17,,PR1
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:126  

      678    10072    1         GOTO QTS5;

  10072  1 001453   001045 710000 1                  TRA     QTS5

  10071  1 001454                       DIRONLY      null
      679    10073        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:127  
      680    10074        /**************************************************
      681    10075         **                                              **
      682    10076         **                                              **
      683    10077         **    Searched directed writes only, found none **
      684    10078         **                                              **
      685    10079         **************************************************/
      686    10080
      687    10081    1   DIRONLY:;
      688    10082    1         IF VLP_STATION.CTL.EOFNONE THEN

  10082  1 001454   200016 236100                    LDQ     VLP_STATION+4,,AUTO
         1 001455   040000 316003                    CANQ    16384,DU
         1 001456   001464 600000 1                  TZE     s:10087

      689    10083    2           DO;

      690    10084    2           CALL KQL$DDFDUN (STA$->KQ$STA);

  10084  1 001457   200006 630500                    EPPR0   STA$,,AUTO
         1 001460   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001461   000000 701000 xent               TSX1    KQL$DDFDUN
         1 001462   000000 011000                    NOP     0

      691    10085    2           GOTO BRCEOF;

  10085  1 001463   003402 710000 1                  TRA     BRCEOF

      692    10086    2           END;
      693    10087    1         IF N$REQ.DVE.DVBYTE.NODAT THEN

  10087  1 001464   200004 471500                    LDP1    IOQ$,,AUTO
         1 001465   100031 236100                    LDQ     25,,PR1
         1 001466   004000 316003                    CANQ    2048,DU
         1 001467   001475 600000 1                  TZE     s:10092

      694    10088    2           DO;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:128  
      695    10089    2           CALL KQL$DDFDUN (STA$->KQ$STA);

  10089  1 001470   200006 630500                    EPPR0   STA$,,AUTO
         1 001471   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001472   000000 701000 xent               TSX1    KQL$DDFDUN
         1 001473   000000 011000                    NOP     0

      696    10090    2           GOTO BRCNODAT;

  10090  1 001474   003406 710000 1                  TRA     BRCNODAT

      697    10091    2           END;
      698    10092    1         IF KEY1L+KEY2L ~= 0 THEN

  10092  1 001475   200025 236100                    LDQ     KEY1L,,AUTO
         1 001476   200026 036100                    ADLQ    KEY2L,,AUTO
         1 001477   001522 600000 1                  TZE     s:10103

      699    10093    2           DO;

      700    10094                %UNLOCK (G=STA$->KQ$STA.GATE);

  10095  1 001500   200006 236100                    LDQ     STA$,,AUTO
         1 001501   000016 036003                    ADLQ    14,DU
         1 001502   200054 756100                    STQ     R$+1,,AUTO
         1 001503   200054 630500                    EPPR0   R$+1,,AUTO
         1 001504   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001505   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001506   000000 011000                    NOP     0

      701    10097    2           CALL VRQKEY ALTRET(BRCTYCD);

  10097  1 001507   005776 701000 1                  TSX1    VRQKEY
         1 001510   003271 702000 1                  TSX2    BRCTYCD

      702    10098    2           CALL VRNQKEY ALTRET(BRCTYCD);

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:129  
  10098  1 001511   006044 701000 1                  TSX1    VRNQKEY
         1 001512   003271 702000 1                  TSX2    BRCTYCD

      703    10099                %LOCK (G=STA$->KQ$STA.GATE);

  10100  1 001513   200006 236100                    LDQ     STA$,,AUTO
         1 001514   000016 036003                    ADLQ    14,DU
         1 001515   200054 756100                    STQ     R$+1,,AUTO
         1 001516   200054 630500                    EPPR0   R$+1,,AUTO
         1 001517   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001520   000000 701000 xent               TSX1    HFC$LOCK
         1 001521   000000 011000                    NOP     0

      704    10102    2           END;

      705    10103    1         CALL MAPBUF ALTRET(BRCBUF);

  10103  1 001522   006576 701000 1                  TSX1    MAPBUF
         1 001523   003241 702000 1                  TSX2    BRCBUF

      706    10104    1         RBLK$->KQ$RBLK.STA$=ADDR(NIL);

  10104  1 001524   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001525   200007 470500                    LDP0    RBLK$,,AUTO
         1 001526   000012 756100                    STQ     10,,PR0

      707    10105    1         IF RBLK$->KQ$RBLK.MBLK$~=ADDR(NIL) THEN

  10105  1 001527   000000 236100                    LDQ     0,,PR0
         1 001530   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001531   001535 600000 1                  TZE     s:10107

      708    10106    1          RBLK$->KQ$RBLK.MBLK$->KQ$MBLK.RBLK = '0'B;

  10106  1 001532   000000 471500                    LDP1    0,,PR0
         1 001533   000017 236000 2                  LDQ     15
         1 001534   100010 356100                    ANSQ    8,,PR1
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:130  

      709    10107    1         RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);

  10107  1 001535   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001536   000000 756100                    STQ     0,,PR0

      710    10108    1         LDCT$->NK$LDCT.IOQ$=IOQ$;

  10108  1 001537   200004 236100                    LDQ     IOQ$,,AUTO
         1 001540   200005 470500                    LDP0    LDCT$,,AUTO
         1 001541   000001 756100                    STQ     1,,PR0

      711    10109    1         IF VLP_STATION.EOFTIME~=0 THEN

  10109  1 001542   200016 720100                    LXL0    VLP_STATION+4,,AUTO
         1 001543   001566 600000 1                  TZE     s:10120

      712    10110    2           DO;

      713    10111    2           RBLK$->KQ$RBLK.STA$=STA$;

  10111  1 001544   200006 236100                    LDQ     STA$,,AUTO
         1 001545   200007 471500                    LDP1    RBLK$,,AUTO
         1 001546   100012 756100                    STQ     10,,PR1

      714    10112                %UNLOCK(G=STA$->KQ$STA.GATE);

  10113  1 001547   000016 036003                    ADLQ    14,DU
         1 001550   200054 756100                    STQ     R$+1,,AUTO
         1 001551   200054 630500                    EPPR0   R$+1,,AUTO
         1 001552   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001553   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001554   000000 011000                    NOP     0

      715    10115    2           CALL QEOFTIME;

  10115  1 001555   005341 701000 1                  TSX1    QEOFTIME
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:131  
         1 001556   000000 011000                    NOP     0

      716    10116                %LOCK(G=STA$->KQ$STA.GATE);

  10117  1 001557   200006 236100                    LDQ     STA$,,AUTO
         1 001560   000016 036003                    ADLQ    14,DU
         1 001561   200054 756100                    STQ     R$+1,,AUTO
         1 001562   200054 630500                    EPPR0   R$+1,,AUTO
         1 001563   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001564   000000 701000 xent               TSX1    HFC$LOCK
         1 001565   000000 011000                    NOP     0

      717    10119    2           END;

      718    10120    1         RBLK$->KQ$RBLK.STATE=KQRS_PEND#;

  10120  1 001566   000002 220003                    LDX0    2,DU
         1 001567   200007 470500                    LDP0    RBLK$,,AUTO
         1 001570   000001 740100                    STX0    1,,PR0

      719    10121    1         CALL KQL$DDFDUN (STA$->KQ$STA);

  10121  1 001571   200006 630500                    EPPR0   STA$,,AUTO
         1 001572   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001573   000000 701000 xent               TSX1    KQL$DDFDUN
         1 001574   000000 011000                    NOP     0

      720    10122    1         IF ACTQTN$ ~= ADDR(NIL) THEN CALL ACTQTN;

  10122  1 001575   200024 236100                    LDQ     ACTQTN$,,AUTO
         1 001576   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001577   001602 600000 1                  TZE     s:10123

  10122  1 001600   005723 701000 1                  TSX1    ACTQTN
         1 001601   000000 011000                    NOP     0

      721    10123    1         IF N$REQ.OPFLG.WAIT='0'B THEN RETURN;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:132  

  10123  1 001602   200004 470500                    LDP0    IOQ$,,AUTO
         1 001603   000004 236100                    LDQ     4,,PR0
         1 001604   000020 316007                    CANQ    16,DL
         1 001605   001607 601000 1                  TNZ     REGIMA

  10123  1 001606   000000 702200 xent               TSX2  ! X66_ARET

      722    10124    1   REGIMA: I=%SS_IIPCA;                  /* This REG may ALTRET immediately if */

  10124  1 001607   000052 235007       REGIMA       LDA     42,DL
         1 001610   200032 755100                    STA     I,,AUTO

      723    10125                                               /* the ASYNCH flags are set.          */
      724    10126    2           DO WHILE('0'B);

  10126  1 001611   001614 710000 1                  TRA     s:10132

      725    10127    2   REGIM:  I=%SS_IIPC;                 /* This REG will NOT ALTRET           */

  10127  1 001612   000002 235007       REGIM        LDA     2,DL
         1 001613   200032 755100                    STA     I,,AUTO

      726    10128                                               /* immediately but, like %SS_IIPCA,   */
      727    10129                                               /* it may be broken out of by a       */
      728    10130                                               /* subsequent async event             */
      729    10131    2           END;

      730    10132    1         CALL SSR$REG (I,N$REQ.DCB$->F$DCB.FCN(1)) ALTRET(BRKREG);

  10132  1 001614   200004 470500                    LDP0    IOQ$,,AUTO
         1 001615   000022 471500                    LDP1    18,,PR0
         1 001616   200056 451500                    STP1    R$+3,,AUTO
         1 001617   200056 236100                    LDQ     R$+3,,AUTO
         1 001620   000020 036000 2                  ADLQ    16
         1 001621   200055 756100                    STQ     R$+2,,AUTO
         1 001622   200032 633500                    EPPR3   I,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:133  
         1 001623   200054 453500                    STP3    R$+1,,AUTO
         1 001624   200054 630500                    EPPR0   R$+1,,AUTO
         1 001625   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001626   000000 701000 xent               TSX1    SSR$REG
         1 001627   001631 702000 1                  TSX2    BRKREG

      731    10133    1         RETURN;

  10133  1 001630   000000 702200 xent               TSX2  ! X66_ARET

  10127  1 001631                       BRKREG       null
      732    10134    1   BRKREG: ;
      733    10135    1         IF LDCT$->NK$LDCT.IOQ$ ~= ADDR(NIL) THEN

  10135  1 001631   200005 470500                    LDP0    LDCT$,,AUTO
         1 001632   000001 236100                    LDQ     1,,PR0
         1 001633   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001634   001743 600000 1                  TZE     s:10173

      734    10136    2           DO;

      735    10137                %LOCK (G=STA$->KQ$STA.GATE);

  10138  1 001635   200006 236100                    LDQ     STA$,,AUTO
         1 001636   000016 036003                    ADLQ    14,DU
         1 001637   200054 756100                    STQ     R$+1,,AUTO
         1 001640   200054 630500                    EPPR0   R$+1,,AUTO
         1 001641   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001642   000000 701000 xent               TSX1    HFC$LOCK
         1 001643   000000 011000                    NOP     0

      736    10140    2           RBLK$=STA$->KQ$STA.RBLK$;

  10140  1 001644   200006 470500                    LDP0    STA$,,AUTO
         1 001645   000011 236100                    LDQ     9,,PR0
         1 001646   200007 756100                    STQ     RBLK$,,AUTO

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:134  
      737    10141    2           IF RBLK$ ~= ADDR(NIL) THEN

  10141  1 001647   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001650   001743 600000 1                  TZE     s:10173

      738    10142    3             DO INHIBIT;

      739    10143    4               DO CASE (RBLK$->KQ$RBLK.STATE);

  10143  1 001651   200007 471700                    LDP1  ! RBLK$,,AUTO
         1 001652   100001 220300                    LDX0  ! 1,,PR1
         1 001653   000006 100203                    CMPX0 ! 6,DU
         1 001654   001656 602210 1                  TNC   ! s:10143+5,X0
         1 001655   001741 710200 1                  TRA   ! s:10168
         1 001656   001741 710200 1                  TRA   ! s:10168
         1 001657   001721 710200 1                  TRA   ! s:10158
         1 001660   001664 710200 1                  TRA   ! s:10146
         1 001661   001731 710200 1                  TRA   ! s:10163
         1 001662   001741 710200 1                  TRA   ! s:10168
         1 001663   001731 710200 1                  TRA   ! s:10163

      740    10144
      741    10145    4                 CASE (KQRS_PEND#);

      742    10146    4                   RBLK$->KQ$RBLK.STATE=KQRS_RSIP#;

  10146  1 001664   000000 221203                    LDX1  ! 0,DU
         1 001665   100001 741300                    STX1  ! 1,,PR1

      743    10147                        %UNLOCK (G=STA$->KQ$STA.GATE);

  10148  1 001666   200006 236300                    LDQ   ! STA$,,AUTO
         1 001667   000016 036203                    ADLQ  ! 14,DU
         1 001670   200054 756300                    STQ   ! R$+1,,AUTO
         1 001671   200054 630700                    EPPR0 ! R$+1,,AUTO
         1 001672   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001673   000000 701200 xent               TSX1  ! HFC$UNLOCK
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:135  
         1 001674   000000 011200                    NOP   ! 0

      744    10150    4                   CALL DEQUEUE;

  10150  1 001675   005324 701200 1                  TSX1  ! DEQUEUE
         1 001676   000000 011200                    NOP   ! 0

      745    10151    4                   CALL KQQ$DQEOFTIME(KQ$CG,RBLK$);

  10151  1 001677   200007 630700                    EPPR0 ! RBLK$,,AUTO
         1 001700   200055 450700                    STP0  ! R$+2,,AUTO
         1 001701   200011 236300                    LDQ   ! CG$,,AUTO
         1 001702   200054 756300                    STQ   ! R$+1,,AUTO
         1 001703   200054 630700                    EPPR0 ! R$+1,,AUTO
         1 001704   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 001705   000000 701200 xent               TSX1  ! KQQ$DQEOFTIME
         1 001706   000000 011200                    NOP   ! 0

      746    10152    4                   CALL KQY$YC (LDCT$->NK$LDCT);

  10152  1 001707   200005 630700                    EPPR0 ! LDCT$,,AUTO
         1 001710   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001711   000000 701200 xent               TSX1  ! KQY$YC
         1 001712   000000 011200                    NOP   ! 0

      747    10153    4                   STA$->KQ$STA.RBLK$=ADDR(NIL);

  10153  1 001713   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 001714   200006 470700                    LDP0  ! STA$,,AUTO
         1 001715   000011 756300                    STQ   ! 9,,PR0

      748    10154    4                   CALL DUMPRBLK;

  10154  1 001716   005307 701200 1                  TSX1  ! DUMPRBLK
         1 001717   000000 011200                    NOP   ! 0
         1 001720   001743 710200 1                  TRA   ! s:10173

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:136  
      749    10155
      750    10156    4                 CASE (KQRS_COMP#);

      751    10157                        %UNLOCK (G=STA$->KQ$STA.GATE);

  10158  1 001721   200006 236300                    LDQ   ! STA$,,AUTO
         1 001722   000016 036203                    ADLQ  ! 14,DU
         1 001723   200054 756300                    STQ   ! R$+1,,AUTO
         1 001724   200054 630700                    EPPR0 ! R$+1,,AUTO
         1 001725   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001726   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 001727   000000 011200                    NOP   ! 0
         1 001730   001743 710200 1                  TRA   ! s:10173

      752    10160
      753    10161    4                 CASE (KQRS_XFIP#,KQRS_XFDN#);

      754    10162                        %UNLOCK (G=STA$->KQ$STA.GATE);

  10163  1 001731   200006 236300                    LDQ   ! STA$,,AUTO
         1 001732   000016 036203                    ADLQ  ! 14,DU
         1 001733   200054 756300                    STQ   ! R$+1,,AUTO
         1 001734   200054 630700                    EPPR0 ! R$+1,,AUTO
         1 001735   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001736   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 001737   000000 011200                    NOP   ! 0

      755    10165    4                   GOTO REGIM;

  10165  1 001740   001612 710200 1                  TRA   ! REGIM

      756    10166
      757    10167    4                 CASE (ELSE);

      758    10168    4                   CALL SC_BCGRBS;

  10168  1 001741   000000 713600 xsym               CLIMB ! SC_BCGRBS
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:137  
         1 001742   000000 600000 xsid               climb   nvectors=         0

      759    10169
      760    10170    4               END;

      761    10171    3             END;

      762    10172    2           END;

      763    10173    1         RETURN;

  10173  1 001743   000000 702200 xent               TSX2  ! X66_ARET

  10171  1 001744                       GOTQMSG      null
      764    10174        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:138  
      765    10175
      766    10176        /**************************************************
      767    10177         **                                              **
      768    10178         **                                              **
      769    10179         **      Got a message to satisfy the read.      **
      770    10180         **      Transfer the data right now.            **
      771    10181         **                                              **
      772    10182         **************************************************/
      773    10183
      774    10184    1   GOTQMSG: ;
      775    10185    2           DO INHIBIT;

      776    10186    2           IF RBLK$->KQ$RBLK.LATCH THEN

  10186  1 001744   200007 470700                    LDP0  ! RBLK$,,AUTO
         1 001745   000001 236300                    LDQ   ! 1,,PR0
         1 001746   400000 316207                    CANQ  ! -131072,DL
         1 001747   001771 600200 1                  TZE   ! s:10197

      777    10187    3             DO;

      778    10188    3             RBLK$->KQ$RBLK.FROMQ='1'B;

  10188  1 001750   100000 236207                    LDQ   ! 32768,DL
         1 001751   000001 256300                    ORSQ  ! 1,,PR0

      779    10189    3             RBLK$->KQ$RBLK.QTN$=QTN$;

  10189  1 001752   200034 236300                    LDQ   ! QTN$,,AUTO
         1 001753   200007 470700                    LDP0  ! RBLK$,,AUTO
         1 001754   000021 756300                    STQ   ! 17,,PR0

      780    10190    3             IF QTN$ = ACTQTN$ THEN

  10190  1 001755   200034 236300                    LDQ   ! QTN$,,AUTO
         1 001756   200024 116300                    CMPQ  ! ACTQTN$,,AUTO
         1 001757   001767 601200 1                  TNZ   ! s:10195
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:139  

      781    10191    4               DO;

      782    10192    4               ACTQTN$=ADDR(NIL);

  10192  1 001760   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 001761   200024 756300                    STQ   ! ACTQTN$,,AUTO

      783    10193    4               QTN$->KQ$QTN.CRASHACT=QTN$->KQ$QTN.CRASHACT-1;

  10193  1 001762   200034 471700                    LDP1  ! QTN$,,AUTO
         1 001763   100050 720300                    LXL0  ! 40,,PR1
         1 001764   777777 621210                    EAX1  ! -1,X0
         1 001765   100050 441300                    SXL1  ! 40,,PR1

      784    10194    4               END;

  10194  1 001766   001771 710200 1                  TRA   ! s:10197

      785    10195    3             ELSE QTN$->KQ$QTN.CNACT=QTN$->KQ$QTN.CNACT+1;

  10195  1 001767   200034 471700                    LDP1  ! QTN$,,AUTO
         1 001770   100044 054300                    AOS   ! 36,,PR1

      786    10196    3             END;

      787    10197    2           CALL KQL$QDFDUN (STA$->KQ$STA);

  10197  1 001771   200006 630700                    EPPR0 ! STA$,,AUTO
         1 001772   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001773   000000 701200 xent               TSX1  ! KQL$QDFDUN
         1 001774   000000 011200                    NOP   ! 0

      788    10198    2           END;

  10193  1 001775                       XFERRD       null
      789    10199    1   XFERRD:;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:140  
      790    10200    1         IF ACTQTN$ ~= ADDR(NIL) THEN CALL ACTQTN;

  10200  1 001775   200024 236100                    LDQ     ACTQTN$,,AUTO
         1 001776   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001777   002002 600000 1                  TZE     XFERRD0

  10200  1 002000   005723 701000 1                  TSX1    ACTQTN
         1 002001   000000 011000                    NOP     0

  10200  1 002002                       XFERRD0      null
      791    10201    1   XFERRD0: ;
      792    10202    1         N$REQ.TYC='0'B;

  10202  1 002002   200004 470500                    LDP0    IOQ$,,AUTO
         1 002003   000021 450100                    STZ     17,,PR0

      793    10203    1         N$REQ.ARSIZE=0;

  10203  1 002004   177777 236007                    LDQ     65535,DL
         1 002005   000027 356100                    ANSQ    23,,PR0

      794    10204            /*********************************************
      795    10205             *                                           *
      796    10206             *         Give special msg to AU            *
      797    10207             *                                           *
      798    10208             *********************************************/
      799    10209              /**/
      800    10210    1         IF MBLK$->KQ$MBLK.KEY1 = '*FPABT' THEN

  10210  1 002006   200010 471500                    LDP1    MBLK$,,AUTO
         1 002007   040000 106500                    CMPC    fill='040'O
         1 002010   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         1 002011   000040 000006 0                  ADSC9   ERR_NODAT+2              cn=0,n=6
         1 002012   002016 601000 1                  TNZ     s:10215

      801    10211    2           DO ; /* Lower prio now so this message is treated normally; for TPA */

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:141  
      802    10212    2           MBLK$->KQ$MBLK.PRIO = MBLK$->KQ$MBLK.PRIO - 1;

  10212  1 002013   100001 220100                    LDX0    1,,PR1
         1 002014   777777 621010                    EAX1    -1,X0
         1 002015   100001 741100                    STX1    1,,PR1

      803    10213    2           END;

      804    10214              /**/
      805    10215    1         IF MBLK$->KQ$MBLK.PRIO >= %KQ_AUEP# THEN

  10215  1 002016   200010 471500                    LDP1    MBLK$,,AUTO
         1 002017   100001 220100                    LDX0    1,,PR1
         1 002020   765000 100003                    CMPX0   -5632,DU
         1 002021   002032 602000 1                  TNC     s:10227

      806    10216    2           DO;

      807    10217    2           CALL HFF$TRAPALT ALTRET(BRCBUFAU);

  10217  1 002022   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002023   000000 701000 xent               TSX1    HFF$TRAPALT
         1 002024   003126 702000 1                  TSX2    BRCBUFAU

      808    10218    2           CALL XFAUEV ALTRET(RDDUN0);

  10218  1 002025   005522 701000 1                  TSX1    XFAUEV
         1 002026   003064 702000 1                  TSX2    RDDUN0

      809    10219    2           CALL HFF$TRAPALT;

  10219  1 002027   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002030   000000 701000 xent               TSX1    HFF$TRAPALT
         1 002031   000000 011000                    NOP     0

      810    10220    2           END;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:142  
      811    10221            /*********************************************
      812    10222             *                                           *
      813    10223             *         Chk for no data/no buffer         *
      814    10224             *                                           *
      815    10225             *********************************************/
      816    10226
      817    10227    1         IF MBLK$->KQ$MBLK.DDA = 0 THEN

  10227  1 002032   200010 470500                    LDP0    MBLK$,,AUTO
         1 002033   000006 235100                    LDA     6,,PR0
         1 002034   002055 601000 1                  TNZ     s:10241

      818    10228    1          IF MBLK$->KQ$MBLK.MSGSIZE = 0 THEN

  10228  1 002035   000016 235100                    LDA     14,,PR0
         1 002036   002051 601000 1                  TNZ     s:10238

      819    10229    2            DO; /* Really no data */

  10218  1 002037                       XFERRD01     null
      820    10230    2   XFERRD01: ;
      821    10231    2            IF RBLK$->KQ$RBLK.BUFSIZE = 0 THEN

  10231  1 002037   200007 470500                    LDP0    RBLK$,,AUTO
         1 002040   000016 235100                    LDA     14,,PR0
         1 002041   002050 601000 1                  TNZ     s:10234

      822    10232    2             IF RBLK$->KQ$RBLK.LATCH THEN

  10232  1 002042   000001 236100                    LDQ     1,,PR0
         1 002043   400000 316007                    CANQ    -131072,DL
         1 002044   002050 600000 1                  TZE     s:10234

      823    10233    2   LDTYC:     N$REQ.TYC=%TYC_LD; /* BUF=NIL & LATCH gets error even if no data */

  10233  1 002045   000042 236000 0     LDTYC        LDQ     ERR_NODAT+4
         1 002046   200004 470500                    LDP0    IOQ$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:143  
         1 002047   000021 756100                    STQ     17,,PR0

      824    10234    2            GOTO RDDUN;

  10234  1 002050   002753 710000 1                  TRA     RDDUN

      825    10235    2            END;
      826    10236    1          ELSE
      827    10237    2            DO; /* Prev error fetching the DBLK */

      828    10238    2            N$REQ.TYC=%TYC_DI;

  10238  1 002051   000043 236000 0                  LDQ     ERR_NODAT+5
         1 002052   200004 471500                    LDP1    IOQ$,,AUTO
         1 002053   100021 756100                    STQ     17,,PR1

      829    10239    2            GOTO RDDUN0;

  10239  1 002054   003064 710000 1                  TRA     RDDUN0

      830    10240    2            END;
      831    10241    1         ELSE /* Data present */ IF RBLK$->KQ$RBLK.BUFSIZE = 0 THEN

  10241  1 002055   200007 471500                    LDP1    RBLK$,,AUTO
         1 002056   100016 235100                    LDA     14,,PR1
         1 002057   002045 600000 1                  TZE     LDTYC

  10236  1 002060                       XFERRD1      null
      832    10242    1           GOTO LDTYC; /* No fetch if no buffer; speeds TPCP */
      833    10243            /*********************************************
      834    10244             *                                           *
      835    10245             *         Loop for 1 chunk of msg           *
      836    10246             *                                           *
      837    10247             *********************************************/
      838    10248    1   XFERRD1: ;
      839    10249    1         DBLK$R=MBLK$->KQ$MBLK.STAMP;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:144  
  10249  1 002060   200010 470500                    LDP0    MBLK$,,AUTO
         1 002061   000001 236100                    LDQ     1,,PR0
         1 002062   777777 376007                    ANQ     -1,DL
         1 002063   200031 756100                    STQ     DBLK$,,AUTO

      840    10250    1         DDA=RBLK$->KQ$RBLK.NCDDA;

  10250  1 002064   200007 471500                    LDP1    RBLK$,,AUTO
         1 002065   100011 235100                    LDA     9,,PR1
         1 002066   200033 755100                    STA     DDA,,AUTO

      841    10251    1         CALL KQD$FETCH (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOFETCH);

  10251  1 002067   200033 633500                    EPPR3   DDA,,AUTO
         1 002070   200056 453500                    STP3    R$+3,,AUTO
         1 002071   200031 634500                    EPPR4   DBLK$,,AUTO
         1 002072   200055 454500                    STP4    R$+2,,AUTO
         1 002073   200011 236100                    LDQ     CG$,,AUTO
         1 002074   200054 756100                    STQ     R$+1,,AUTO
         1 002075   200054 630500                    EPPR0   R$+1,,AUTO
         1 002076   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002077   000000 701000 xent               TSX1    KQD$FETCH
         1 002100   002175 702000 1                  TSX2    NOFETCH

  10250  1 002101                       XFERRD10     null
      842    10252    1   XFERRD10:;
      843    10253    1         I=DBLK$->KQ$DBLK.DSIZE-RBLK$->KQ$RBLK.DBLKX;

  10253  1 002101   200007 470500                    LDP0    RBLK$,,AUTO
         1 002102   000017 236100                    LDQ     15,,PR0
         1 002103   777777 376007                    ANQ     -1,DL
         1 002104   200054 756100                    STQ     R$+1,,AUTO
         1 002105   200031 471500                    LDP1    DBLK$,,AUTO
         1 002106   100000 236100                    LDQ     0,,PR1
         1 002107   777777 376007                    ANQ     -1,DL
         1 002110   200054 136100                    SBLQ    R$+1,,AUTO
         1 002111   200032 756100                    STQ     I,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:145  

      844    10254    1         IF I > RBLK$->KQ$RBLK.BUFSIZE THEN

  10254  1 002112   000016 116100                    CMPQ    14,,PR0
         1 002113   002122 602000 1                  TNC     s:10259
         1 002114   002122 600000 1                  TZE     s:10259

      845    10255    2           DO;

      846    10256    2           N$REQ.TYC=%TYC_LD;

  10256  1 002115   000042 236000 0                  LDQ     ERR_NODAT+4
         1 002116   200004 473500                    LDP3    IOQ$,,AUTO
         1 002117   300021 756100                    STQ     17,,PR3

      847    10257    2           I=RBLK$->KQ$RBLK.BUFSIZE;

  10257  1 002120   000016 235100                    LDA     14,,PR0
         1 002121   200032 755100                    STA     I,,AUTO

      848    10258    2           END;

      849    10259    1         CALL HFF$TRAPALT ALTRET(BRCBUFU);

  10259  1 002122   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002123   000000 701000 xent               TSX1    HFF$TRAPALT
         1 002124   003135 702000 1                  TSX2    BRCBUFU

      850    10260    1         RBLK$->KQ$RBLK.BUF$->B$$CHARS=PINCRC(DBLK$,LENGTHC(KQ$DBLK)+RBLK$->KQ$RBLK.
             10260                  DBLKX)->B$$CHARS;

  10260  1 002125   200007 470500                    LDP0    RBLK$,,AUTO
         1 002126   000013 471500                    LDP1    11,,PR0
         1 002127   000017 236100                    LDQ     15,,PR0
         1 002130   777777 376007                    ANQ     -1,DL
         1 002131   200031 473500                    LDP3    DBLK$,,AUTO
         1 002132   200032 720100                    LXL0    I,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:146  
         1 002133   040140 100546                    MLR     fill='040'O
         1 002134   300006 000010                    ADSC9   6,Q,PR3                  cn=0,n=*X0
         1 002135   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

      851    10261    1         CALL HFF$TRAPALT;

  10261  1 002136   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002137   000000 701000 xent               TSX1    HFF$TRAPALT
         1 002140   000000 011000                    NOP     0

      852    10262    1         N$REQ.ARSIZE=N$REQ.ARSIZE+I;

  10262  1 002141   200004 470500                    LDP0    IOQ$,,AUTO
         1 002142   000027 236100                    LDQ     23,,PR0
         1 002143   000020 772000                    QRL     16
         1 002144   200032 036100                    ADLQ    I,,AUTO
         1 002145   000020 736000                    QLS     16
         1 002146   000027 676100                    ERQ     23,,PR0
         1 002147   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 002150   000027 656100                    ERSQ    23,,PR0

      853    10263    1         IF NOT N$REQ.TYC THEN

  10263  1 002151   000021 235100                    LDA     17,,PR0
         1 002152   002156 601000 1                  TNZ     CHERR

      854    10264        /**/
      855    10265    2           DO; /* No error on this chunk */

      856    10266    2           CALL CHUNKOK ALTRET(RDDUN);

  10266  1 002153   005442 701000 1                  TSX1    CHUNKOK
         1 002154   002753 702000 1                  TSX2    RDDUN

      857    10267    2           GOTO XFERRD1;

  10267  1 002155   002060 710000 1                  TRA     XFERRD1
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:147  

      858    10268    2           END;
      859    10269    1   CHERR: /* Error on this chunk */
      860    10270    1         RBLK$->KQ$RBLK.DBLKX=RBLK$->KQ$RBLK.DBLKX+I;

  10270  1 002156   200007 470500       CHERR        LDP0    RBLK$,,AUTO
         1 002157   000017 236100                    LDQ     15,,PR0
         1 002160   777777 376007                    ANQ     -1,DL
         1 002161   200032 036100                    ADLQ    I,,AUTO
         1 002162   000000 620006                    EAX0    0,QL
         1 002163   000017 440100                    SXL0    15,,PR0

      861    10271    1         CALL KQD$UNLOCK (CG$->KQ$CG,DBLK$);

  10271  1 002164   200031 631500                    EPPR1   DBLK$,,AUTO
         1 002165   200055 451500                    STP1    R$+2,,AUTO
         1 002166   200011 236100                    LDQ     CG$,,AUTO
         1 002167   200054 756100                    STQ     R$+1,,AUTO
         1 002170   200054 630500                    EPPR0   R$+1,,AUTO
         1 002171   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002172   000000 701000 xent               TSX1    KQD$UNLOCK
         1 002173   000000 011000                    NOP     0

      862    10272    1         GOTO RDDUN0;

  10272  1 002174   003064 710000 1                  TRA     RDDUN0

  10263  1 002175                       NOFETCH      null
      863    10273            /*********************************************
      864    10274             *                                           *
      865    10275             *         Problems FETCHing the DBLK        *
      866    10276             *                                           *
      867    10277             *********************************************/
      868    10278    1   NOFETCH:;
      869    10279    1         IF DBLK$ = ADDR(NIL) THEN

  10279  1 002175   200031 236100                    LDQ     DBLK$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:148  
         1 002176   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002177   002303 601000 1                  TNZ     NOFETCH3

      870    10280    2           DO;

      871    10281    2           IF DDA = %KQDE_NDFRBLK THEN

  10281  1 002200   200033 235100                    LDA     DDA,,AUTO
         1 002201   000012 115007                    CMPA    10,DL
         1 002202   002236 601000 1                  TNZ     NOFETCHERR

      872    10282    3             DO; /* No DEFER blks */

      873    10283    3             DBLK$R=MBLK$->KQ$MBLK.STAMP;

  10283  1 002203   200010 470500                    LDP0    MBLK$,,AUTO
         1 002204   000001 236100                    LDQ     1,,PR0
         1 002205   777777 376007                    ANQ     -1,DL
         1 002206   200031 756100                    STQ     DBLK$,,AUTO

      874    10284    3             DDA=RBLK$->KQ$RBLK.NCDDA;

  10284  1 002207   200007 471500                    LDP1    RBLK$,,AUTO
         1 002210   100011 235100                    LDA     9,,PR1
         1 002211   200033 755100                    STA     DDA,,AUTO

      875    10285    3             CALL KQD$FETCHR (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOFETCH1);

  10285  1 002212   200033 633500                    EPPR3   DDA,,AUTO
         1 002213   200056 453500                    STP3    R$+3,,AUTO
         1 002214   200031 634500                    EPPR4   DBLK$,,AUTO
         1 002215   200055 454500                    STP4    R$+2,,AUTO
         1 002216   200011 236100                    LDQ     CG$,,AUTO
         1 002217   200054 756100                    STQ     R$+1,,AUTO
         1 002220   200054 630500                    EPPR0   R$+1,,AUTO
         1 002221   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002222   000000 701000 xent               TSX1    KQD$FETCHR
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:149  
         1 002223   002225 702000 1                  TSX2    NOFETCH1

      876    10286    3             GOTO XFERRD10;

  10286  1 002224   002101 710000 1                  TRA     XFERRD10

  10284  1 002225                       NOFETCH1     null
      877    10287    3   NOFETCH1: ;
      878    10288    3             IF DDA = %KQDE_CREG THEN

  10288  1 002225   200033 235100                    LDA     DDA,,AUTO
         1 002226   000001 115007                    CMPA    1,DL
         1 002227   002236 601000 1                  TNZ     NOFETCHERR

      879    10289    4               DO;

      880    10290    4               CALL MAPBUF ALTRET(BRCBUFAU1);

  10290  1 002230   006576 701000 1                  TSX1    MAPBUF
         1 002231   003131 702000 1                  TSX2    BRCBUFAU1

      881    10291    4               LDCT$->NK$LDCT.IOQ$=IOQ$;

  10291  1 002232   200004 236100                    LDQ     IOQ$,,AUTO
         1 002233   200005 470500                    LDP0    LDCT$,,AUTO
         1 002234   000001 756100                    STQ     1,,PR0

      882    10292    4               GOTO FDELAY;

  10292  1 002235   002646 710000 1                  TRA     FDELAY

  10290  1 002236                       NOFETCHERR   null
      883    10293    4               END;
      884    10294    3             END;
      885    10295    2   NOFETCHERR:;
      886    10296    3             DO CASE (DDA);

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:150  
  10296  1 002236   200033 235100                    LDA     DDA,,AUTO
         1 002237   000007 115007                    CMPA    7,DL
         1 002240   002242 602005 1                  TNC     NOFETCHERR+4,AL
         1 002241   002271 710000 1                  TRA     s:10307
         1 002242   002271 710000 1                  TRA     s:10307
         1 002243   002271 710000 1                  TRA     s:10307
         1 002244   002271 710000 1                  TRA     s:10307
         1 002245   002261 710000 1                  TRA     s:10303
         1 002246   002261 710000 1                  TRA     s:10303
         1 002247   002261 710000 1                  TRA     s:10303
         1 002250   002251 710000 1                  TRA     s:10299

      887    10297
      888    10298    3               CASE (%KQDE_IOERR);

      889    10299    3                 CALL LOGERR (0);

  10299  1 002251   000001 236000 2                  LDQ     1
         1 002252   200047 756100                    STQ     TIMCHK+3,,AUTO
         1 002253   005032 701000 1                  TSX1    LOGERR
         1 002254   000000 011000                    NOP     0

      890    10300    3                 N$REQ.TYC=%TYC_IOERR;

  10300  1 002255   000033 236000 xsym               LDQ     B_VECTNIL+27
         1 002256   200004 470500                    LDP0    IOQ$,,AUTO
         1 002257   000021 756100                    STQ     17,,PR0
         1 002260   002273 710000 1                  TRA     NOFETCH2

      891    10301
      892    10302    3               CASE (%KQDE_STMP,%KQDE_STATE,%KQDE_BDDA);

      893    10303    3                 CALL LOGERR (0);

  10303  1 002261   000001 236000 2                  LDQ     1
         1 002262   200047 756100                    STQ     TIMCHK+3,,AUTO
         1 002263   005032 701000 1                  TSX1    LOGERR
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:151  
         1 002264   000000 011000                    NOP     0

      894    10304    3                 N$REQ.TYC=%TYC_DI;

  10304  1 002265   000043 236000 0                  LDQ     ERR_NODAT+5
         1 002266   200004 470500                    LDP0    IOQ$,,AUTO
         1 002267   000021 756100                    STQ     17,,PR0
         1 002270   002273 710000 1                  TRA     NOFETCH2

      895    10305
      896    10306    3               CASE (ELSE);

      897    10307    3                 CALL SC_BCGRBS;

  10307  1 002271   000000 713400 xsym               CLIMB   SC_BCGRBS
         1 002272   000000 600000 xsid               climb   nvectors=         0

      898    10308
      899    10309    3             END;

  10309  1 002273                       NOFETCH2     null
      900    10310    2   NOFETCH2: ;
      901    10311    2           RBLK$->KQ$RBLK.NCDDA=0;

  10311  1 002273   200007 470500                    LDP0    RBLK$,,AUTO
         1 002274   000011 450100                    STZ     9,,PR0

      902    10312    2           MBLK$->KQ$MBLK.DDA=0; /* Signal fetch err: MSGSIZE ~= 0 and DDA = 0 */

  10312  1 002275   200010 471500                    LDP1    MBLK$,,AUTO
         1 002276   100006 450100                    STZ     6,,PR1

      903    10313    2           RBLK$->KQ$RBLK.CS='1'B;

  10313  1 002277   200007 470500                    LDP0    RBLK$,,AUTO
         1 002300   040000 236007                    LDQ     16384,DL
         1 002301   000001 256100                    ORSQ    1,,PR0
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:152  

      904    10314    2           GOTO RDDUN0;

  10314  1 002302   003064 710000 1                  TRA     RDDUN0

  10312  1 002303                       NOFETCH3     null
      905    10315    2           END;
      906    10316
      907    10317    1   NOFETCH3:;
      908    10318    1         CALL MAPBUF ALTRET(BRCBUFF);

  10318  1 002303   006576 701000 1                  TSX1    MAPBUF
         1 002304   003251 702000 1                  TSX2    BRCBUFF

      909    10319    1         LDCT$->NK$LDCT.IOQ$=IOQ$;

  10319  1 002305   200004 236100                    LDQ     IOQ$,,AUTO
         1 002306   200005 470500                    LDP0    LDCT$,,AUTO
         1 002307   000001 756100                    STQ     1,,PR0

      910    10320    1         DBLK$->KQ$DFRBLK.INFO$=IOQ$;

  10320  1 002310   200031 471500                    LDP1    DBLK$,,AUTO
         1 002311   100006 756100                    STQ     6,,PR1

      911    10321    1         CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQR$FCONT));

  10321  1 002312   002333 636000 1                  EAQ     s:10334
         1 002313   200054 756100                    STQ     R$+1,,AUTO
         1 002314   200054 631500                    EPPR1   R$+1,,AUTO
         1 002315   200057 451500                    STP1    R$+4,,AUTO
         1 002316   200031 633500                    EPPR3   DBLK$,,AUTO
         1 002317   200056 453500                    STP3    R$+3,,AUTO
         1 002320   200011 236100                    LDQ     CG$,,AUTO
         1 002321   200055 756100                    STQ     R$+2,,AUTO
         1 002322   200055 630500                    EPPR0   R$+2,,AUTO
         1 002323   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:153  
         1 002324   000000 701000 xent               TSX1    KQD$DEFERGO
         1 002325   000000 011000                    NOP     0

      912    10322    1         IF N$REQ.OPFLG.WAIT THEN GOTO REGIM;

  10322  1 002326   200004 470500                    LDP0    IOQ$,,AUTO
         1 002327   000004 236100                    LDQ     4,,PR0
         1 002330   000020 316007                    CANQ    16,DL
         1 002331   001612 601000 1                  TNZ     REGIM

      913    10323    1         RETURN;

  10323  1 002332   000000 702200 xent               TSX2  ! X66_ARET

      914    10324        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:154  
      915    10325        /*F* NAME:         KQR$FCONT
      916    10326             PURPOSE:      To continue a READ after a deferred FETCH
      917    10327             CALL:         KQR$FCONT (KQ$DFRPARM)
      918    10328             DESCRIPTION:  The defer params contain the request packet
      919    10329                           pointer, and the results of the FETCH.
      920    10330                           The user buffer has been mapped so as to be
      921    10331                           accessible, and we continue to move the data
      922    10332                           into it.
      923    10333        */
      924    10334    1   KQR$FCONT: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */

  10334  1 002333   000000 700200 xent  KQR$FCONT    TSX0  ! X66_AUTO_1
         1 002334   000064 000001                    ZERO    52,1

      925    10335        /**/
      926    10336    1         DFRP$=ADDR(N$RREQ);

  10336  1 002335   200003 236100                    LDQ     @N$RREQ,,AUTO
         1 002336   200030 756100                    STQ     DFRP$,,AUTO

      927    10337    1         IOQ$=DFRP$->KQ$DFRPARM.INFO$;

  10337  1 002337   200030 470500                    LDP0    DFRP$,,AUTO
         1 002340   000000 236100                    LDQ     0,,PR0
         1 002341   200004 756100                    STQ     IOQ$,,AUTO

      928    10338    1         CALL SETUP1;

  10338  1 002342   006516 701000 1                  TSX1    SETUP1
         1 002343   000000 011000                    NOP     0

      929    10339    1         IF RBLK$->KQ$RBLK.STATE ~= KQRS_XFIP# THEN CALL SC_BCGRBS;

  10339  1 002344   200007 470500                    LDP0    RBLK$,,AUTO
         1 002345   000001 220100                    LDX0    1,,PR0
         1 002346   000003 100003                    CMPX0   3,DU
         1 002347   002352 600000 1                  TZE     s:10340
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:155  

  10339  1 002350   000000 713400 xsym               CLIMB   SC_BCGRBS
         1 002351   000000 600000 xsid               climb   nvectors=         0

      930    10340    1         MBLK$=RBLK$->KQ$RBLK.MBLK$;

  10340  1 002352   200007 470500                    LDP0    RBLK$,,AUTO
         1 002353   000000 236100                    LDQ     0,,PR0
         1 002354   200010 756100                    STQ     MBLK$,,AUTO

      931    10341    1         DBLK$=DFRP$->KQ$DFRPARM.DBLK$;

  10341  1 002355   200030 471500                    LDP1    DFRP$,,AUTO
         1 002356   100001 236100                    LDQ     1,,PR1
         1 002357   200031 756100                    STQ     DBLK$,,AUTO

      932    10342    1         DDA=DFRP$->KQ$DFRPARM.ERR;

  10342  1 002360   100004 235100                    LDA     4,,PR1
         1 002361   200033 755100                    STA     DDA,,AUTO

      933    10343    1         IF DBLK$ = ADDR(NIL) THEN GOTO NOFETCHERR;

  10343  1 002362   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002363   002236 600000 1                  TZE     NOFETCHERR

      934    10344    1         GOTO MOVERD2;

  10344  1 002364   002507 710000 1                  TRA     MOVERD2

      935    10345        /**/
      936    10346        /*F* NAME:         KQR$GOTMSG
      937    10347             PURPOSE:      To satisfy a read with a message from the comgroup
      938    10348             CALL:         KQR$GOTMSG (N$REQ)
      939    10349             DESCRIPTION:  Called from SENDMSG in KQW$WRITE when a message
      940    10350                           contained in DBLKs (as opposed to a writer's buffer)
      941    10351                           satisfies a pending read.
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:156  
      942    10352
      943    10353                           Entered with the MBLK pointed to by the reading
      944    10354                           RBLK (which has been removed from the queue if it
      945    10355                           was in it), the RBLK state set to KQRS_XFIP, and
      946    10356                           RBLK.NCDDA set to MBLK.DDA, and
      947    10357                           the reader's station unlocked.
      948    10358
      949    10359                           The data is transferred to the reader's buffer
      950    10360                           and the reader is COMPed.
      951    10361        */
      952    10362    1   KQR$GOTMSG: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */

  10362  1 002365   000000 700200 xent  KQR$GOTMSG   TSX0  ! X66_AUTO_1
         1 002366   000064 000001                    ZERO    52,1

      953    10363        /**/
      954    10364    1         CALL SETUP;

  10364  1 002367   006512 701000 1                  TSX1    SETUP
         1 002370   000000 011000                    NOP     0

      955    10365    1         N$REQ.OPFLG.CLR='1'B;

  10365  1 002371   200004 470500                    LDP0    IOQ$,,AUTO
         1 002372   000001 236007                    LDQ     1,DL
         1 002373   000004 256100                    ORSQ    4,,PR0

      956    10366    1         MBLK$=RBLK$->KQ$RBLK.MBLK$;

  10366  1 002374   200007 471500                    LDP1    RBLK$,,AUTO
         1 002375   100000 236100                    LDQ     0,,PR1
         1 002376   200010 756100                    STQ     MBLK$,,AUTO

      957    10367    1         N$REQ.TYC='0'B;

  10367  1 002377   000021 450100                    STZ     17,,PR0

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:157  
      958    10368    1         N$REQ.ARSIZE=0;

  10368  1 002400   177777 236007                    LDQ     65535,DL
         1 002401   000027 356100                    ANSQ    23,,PR0

      959    10369            /*********************************************
      960    10370             *                                           *
      961    10371             *         Give special msg to AU            *
      962    10372             *                                           *
      963    10373             *********************************************/
      964    10374              /**/
      965    10375    1         IF MBLK$->KQ$MBLK.KEY1 = '*FPABT' THEN

  10375  1 002402   200010 473500                    LDP3    MBLK$,,AUTO
         1 002403   040000 106500                    CMPC    fill='040'O
         1 002404   300002 000010                    ADSC9   2,,PR3                   cn=0,n=8
         1 002405   000040 000006 0                  ADSC9   ERR_NODAT+2              cn=0,n=6
         1 002406   002412 601000 1                  TNZ     s:10380

      966    10376    2           DO ; /* Lower prio now so this message is treated normally; for TPA */

      967    10377    2           MBLK$->KQ$MBLK.PRIO = MBLK$->KQ$MBLK.PRIO - 1;

  10377  1 002407   300001 220100                    LDX0    1,,PR3
         1 002410   777777 621010                    EAX1    -1,X0
         1 002411   300001 741100                    STX1    1,,PR3

      968    10378    2           END;

      969    10379              /**/
      970    10380    1         IF MBLK$->KQ$MBLK.PRIO >= %KQ_AUEP# THEN

  10380  1 002412   200010 471500                    LDP1    MBLK$,,AUTO
         1 002413   100001 220100                    LDX0    1,,PR1
         1 002414   765000 100003                    CMPX0   -5632,DU
         1 002415   002453 602000 1                  TNC     s:10401

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:158  
      971    10381    2           DO;

      972    10382                %LOCK (G=KQ_XFGATE);

  10383  1 002416   000021 630400 2                  EPPR0   17
         1 002417   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002420   000000 701000 xent               TSX1    HFC$LOCK
         1 002421   000000 011000                    NOP     0

      973    10385    2           B$CGPT$->B$$XFPTW=RBLK$->KQ$RBLK.PTW;

  10385  1 002422   200007 470500                    LDP0    RBLK$,,AUTO
         1 002423   000014 237100                    LDAQ    12,,PR0
         1 002424   000000 471400 xsym               LDP1    B$CGPT$
         1 002425   100000 757100                    STAQ    0,,PR1

      974    10386    2           CALL HFC$ASSOCCLR (%CGWSQ,0,2);

  10386  1 002426   000023 630400 2                  EPPR0   19
         1 002427   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002430   000000 701000 xent               TSX1    HFC$ASSOCCLR
         1 002431   000000 011000                    NOP     0

      975    10387    2           CALL XFAUEV;

  10387  1 002432   005522 701000 1                  TSX1    XFAUEV
         1 002433   000000 011000                    NOP     0

      976    10388    2           B$CGPT$->B$$XFPTW='0'B;

  10388  1 002434   000000 235003                    LDA     0,DU
         1 002435   000000 236003                    LDQ     0,DU
         1 002436   000000 470400 xsym               LDP0    B$CGPT$
         1 002437   000000 757100                    STAQ    0,,PR0

      977    10389    2           CALL HFC$ASSOCCLR (%CGWSQ,0,2);

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:159  
  10389  1 002440   000023 630400 2                  EPPR0   19
         1 002441   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002442   000000 701000 xent               TSX1    HFC$ASSOCCLR
         1 002443   000000 011000                    NOP     0

      978    10390                %UNLOCK (G=KQ_XFGATE);

  10391  1 002444   000021 630400 2                  EPPR0   17
         1 002445   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002446   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002447   000000 011000                    NOP     0

      979    10393    2           IF N$REQ.TYC THEN GOTO RDDUN0;

  10393  1 002450   200004 470500                    LDP0    IOQ$,,AUTO
         1 002451   000021 235100                    LDA     17,,PR0
         1 002452   003064 601000 1                  TNZ     RDDUN0

      980    10394    2           END;

      981    10395            /*********************************************
      982    10396             *                                           *
      983    10397             *         Chk for no data/no buffer         *
      984    10398             *                                           *
      985    10399             *********************************************/
      986    10400
      987    10401    1         IF MBLK$->KQ$MBLK.DDA = 0 THEN

  10401  1 002453   200010 471500                    LDP1    MBLK$,,AUTO
         1 002454   100006 235100                    LDA     6,,PR1
         1 002455   002463 601000 1                  TNZ     s:10405

      988    10402    1          IF MBLK$->KQ$MBLK.MSGSIZE ~= 0 THEN

  10402  1 002456   100016 235100                    LDA     14,,PR1
         1 002457   002037 600000 1                  TZE     XFERRD01

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:160  
      989    10403    1           CALL SC_BCGRBS; /* Howcum no DDA? */

  10403  1 002460   000000 713400 xsym               CLIMB   SC_BCGRBS
         1 002461   000000 600000 xsid               climb   nvectors=         0
         1 002462   002466 710000 1                  TRA     MOVERD1

      990    10404    1          ELSE GOTO XFERRD01;
      991    10405    1         ELSE /* Data present */ IF RBLK$->KQ$RBLK.BUFSIZE = 0 THEN

  10405  1 002463   200007 473500                    LDP3    RBLK$,,AUTO
         1 002464   300016 235100                    LDA     14,,PR3
         1 002465   002045 600000 1                  TZE     LDTYC

  10401  1 002466                       MOVERD1      null
      992    10406    1           GOTO LDTYC; /* No fetch if no buffer; speeds TPCP */
      993    10407            /*********************************************
      994    10408             *                                           *
      995    10409             *         Loop for 1 chunk of msg           *
      996    10410             *                                           *
      997    10411             *********************************************/
      998    10412    1   MOVERD1: ;
      999    10413    1         DBLK$R=MBLK$->KQ$MBLK.STAMP;

  10413  1 002466   200010 470500                    LDP0    MBLK$,,AUTO
         1 002467   000001 236100                    LDQ     1,,PR0
         1 002470   777777 376007                    ANQ     -1,DL
         1 002471   200031 756100                    STQ     DBLK$,,AUTO

     1000    10414    1         DDA=RBLK$->KQ$RBLK.NCDDA;

  10414  1 002472   200007 471500                    LDP1    RBLK$,,AUTO
         1 002473   100011 235100                    LDA     9,,PR1
         1 002474   200033 755100                    STA     DDA,,AUTO

     1001    10415    1         CALL KQD$FETCH (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOFETCHU);

  10415  1 002475   200033 633500                    EPPR3   DDA,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:161  
         1 002476   200056 453500                    STP3    R$+3,,AUTO
         1 002477   200031 634500                    EPPR4   DBLK$,,AUTO
         1 002500   200055 454500                    STP4    R$+2,,AUTO
         1 002501   200011 236100                    LDQ     CG$,,AUTO
         1 002502   200054 756100                    STQ     R$+1,,AUTO
         1 002503   200054 630500                    EPPR0   R$+1,,AUTO
         1 002504   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002505   000000 701000 xent               TSX1    KQD$FETCH
         1 002506   002606 702000 1                  TSX2    NOFETCHU

  10414  1 002507                       MOVERD2      null
     1002    10416    1   MOVERD2:;
     1003    10417    1         I=DBLK$->KQ$DBLK.DSIZE-RBLK$->KQ$RBLK.DBLKX;

  10417  1 002507   200007 470500                    LDP0    RBLK$,,AUTO
         1 002510   000017 236100                    LDQ     15,,PR0
         1 002511   777777 376007                    ANQ     -1,DL
         1 002512   200054 756100                    STQ     R$+1,,AUTO
         1 002513   200031 471500                    LDP1    DBLK$,,AUTO
         1 002514   100000 236100                    LDQ     0,,PR1
         1 002515   777777 376007                    ANQ     -1,DL
         1 002516   200054 136100                    SBLQ    R$+1,,AUTO
         1 002517   200032 756100                    STQ     I,,AUTO

     1004    10418    1         IF I > RBLK$->KQ$RBLK.BUFSIZE THEN

  10418  1 002520   000016 116100                    CMPQ    14,,PR0
         1 002521   002530 602000 1                  TNC     s:10424
         1 002522   002530 600000 1                  TZE     s:10424

     1005    10419    2           DO;

     1006    10420    2           N$REQ.TYC=%TYC_LD;

  10420  1 002523   000042 236000 0                  LDQ     ERR_NODAT+4
         1 002524   200004 473500                    LDP3    IOQ$,,AUTO
         1 002525   300021 756100                    STQ     17,,PR3
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:162  

     1007    10421    2           I=RBLK$->KQ$RBLK.BUFSIZE;

  10421  1 002526   000016 235100                    LDA     14,,PR0
         1 002527   200032 755100                    STA     I,,AUTO

     1008    10422    2           END;

     1009    10423              %LOCK (G=KQ_XFGATE);

  10424  1 002530   000021 630400 2                  EPPR0   17
         1 002531   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002532   000000 701000 xent               TSX1    HFC$LOCK
         1 002533   000000 011000                    NOP     0

     1010    10426    1         B$CGPT$->B$$XFPTW=RBLK$->KQ$RBLK.PTW;

  10426  1 002534   200007 470500                    LDP0    RBLK$,,AUTO
         1 002535   000014 237100                    LDAQ    12,,PR0
         1 002536   000000 471400 xsym               LDP1    B$CGPT$
         1 002537   100000 757100                    STAQ    0,,PR1

     1011    10427    1         CALL HFC$ASSOCCLR (%CGWSQ,0,2);

  10427  1 002540   000023 630400 2                  EPPR0   19
         1 002541   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002542   000000 701000 xent               TSX1    HFC$ASSOCCLR
         1 002543   000000 011000                    NOP     0

     1012    10428    1         RBLK$->KQ$RBLK.BUF$->B$$CHARS=PINCRC(DBLK$,LENGTHC(KQ$DBLK)+RBLK$->KQ$RBLK.
             10428                  DBLKX)->B$$CHARS;

  10428  1 002544   200007 470500                    LDP0    RBLK$,,AUTO
         1 002545   000013 471500                    LDP1    11,,PR0
         1 002546   000017 236100                    LDQ     15,,PR0
         1 002547   777777 376007                    ANQ     -1,DL
         1 002550   200031 473500                    LDP3    DBLK$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:163  
         1 002551   200032 720100                    LXL0    I,,AUTO
         1 002552   040140 100546                    MLR     fill='040'O
         1 002553   300006 000010                    ADSC9   6,Q,PR3                  cn=0,n=*X0
         1 002554   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

     1013    10429    1         B$CGPT$->B$$XFPTW='0'B;

  10429  1 002555   000000 235003                    LDA     0,DU
         1 002556   000000 236003                    LDQ     0,DU
         1 002557   000000 470400 xsym               LDP0    B$CGPT$
         1 002560   000000 757100                    STAQ    0,,PR0

     1014    10430    1         CALL HFC$ASSOCCLR (%CGWSQ,0,2);

  10430  1 002561   000023 630400 2                  EPPR0   19
         1 002562   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002563   000000 701000 xent               TSX1    HFC$ASSOCCLR
         1 002564   000000 011000                    NOP     0

     1015    10431              %UNLOCK (G=KQ_XFGATE);

  10432  1 002565   000021 630400 2                  EPPR0   17
         1 002566   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002567   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002570   000000 011000                    NOP     0

     1016    10434    1         N$REQ.ARSIZE=N$REQ.ARSIZE+I;

  10434  1 002571   200004 470500                    LDP0    IOQ$,,AUTO
         1 002572   000027 236100                    LDQ     23,,PR0
         1 002573   000020 772000                    QRL     16
         1 002574   200032 036100                    ADLQ    I,,AUTO
         1 002575   000020 736000                    QLS     16
         1 002576   000027 676100                    ERQ     23,,PR0
         1 002577   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 002600   000027 656100                    ERSQ    23,,PR0

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:164  
     1017    10435    1         IF N$REQ.TYC THEN GOTO CHERR;

  10435  1 002601   000021 235100                    LDA     17,,PR0
         1 002602   002156 601000 1                  TNZ     CHERR

     1018    10436                                /* No error on this chunk */
     1019    10437    1         CALL CHUNKOK ALTRET(RDDUN);

  10437  1 002603   005442 701000 1                  TSX1    CHUNKOK
         1 002604   002753 702000 1                  TSX2    RDDUN

     1020    10438    1         GOTO MOVERD1;

  10438  1 002605   002466 710000 1                  TRA     MOVERD1

  10435  1 002606                       NOFETCHU     null
     1021    10439            /*********************************************
     1022    10440             *                                           *
     1023    10441             *         Problems FETCHing the DBLK        *
     1024    10442             *                                           *
     1025    10443             *********************************************/
     1026    10444    1   NOFETCHU:;
     1027    10445    1         IF DBLK$ ~= ADDR(NIL) THEN

  10445  1 002606   200031 236100                    LDQ     DBLK$,,AUTO
         1 002607   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002610   002631 600000 1                  TZE     s:10451

     1028    10446    2           DO;

     1029    10447    2           DBLK$->KQ$DFRBLK.INFO$=IOQ$;

  10447  1 002611   200004 236100                    LDQ     IOQ$,,AUTO
         1 002612   200031 470500                    LDP0    DBLK$,,AUTO
         1 002613   000006 756100                    STQ     6,,PR0

     1030    10448    2           CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQR$FCONT));
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:165  

  10448  1 002614   002333 636000 1                  EAQ     s:10334
         1 002615   200054 756100                    STQ     R$+1,,AUTO
         1 002616   200054 630500                    EPPR0   R$+1,,AUTO
         1 002617   200057 450500                    STP0    R$+4,,AUTO
         1 002620   200031 631500                    EPPR1   DBLK$,,AUTO
         1 002621   200056 451500                    STP1    R$+3,,AUTO
         1 002622   200011 236100                    LDQ     CG$,,AUTO
         1 002623   200055 756100                    STQ     R$+2,,AUTO
         1 002624   200055 630500                    EPPR0   R$+2,,AUTO
         1 002625   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002626   000000 701000 xent               TSX1    KQD$DEFERGO
         1 002627   000000 011000                    NOP     0

     1031    10449    2           RETURN;

  10449  1 002630   000000 702200 xent               TSX2  ! X66_ARET

     1032    10450    2           END;
     1033    10451    1         IF DDA=%KQDE_NDFRBLK

  10451  1 002631   200033 235100                    LDA     DDA,,AUTO
         1 002632   000012 115007                    CMPA    10,DL
         1 002633   002646 600000 1                  TZE     FDELAY

     1034    10452    1         THEN GOTO FDELAY; /* No DEFER blks */
     1035    10453    1         ELSE GOTO NOFETCHERR;

  10453  1 002634   002236 710000 1                  TRA     NOFETCHERR

     1036    10454        /**/
     1037    10455        /*F* NAME:         KQR$FDELAY
     1038    10456             PURPOSE:      To delay for no defer blocks
     1039    10457             CALL:         KQR$FDELAY (KQ$STA)
     1040    10458             DESCRIPTION:  Puts the station on the list of guys waiting
     1041    10459                           for defer blocks...to be re-awakened off the
     1042    10460                           clock.
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:166  
     1043    10461        */
     1044    10462    1   KQR$FDELAY: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */

  10462  1 002635   000000 700200 xent  KQR$FDELAY   TSX0  ! X66_AUTO_1
         1 002636   000064 000001                    ZERO    52,1

     1045    10463        /**/
     1046    10464    1         STA$=ADDR(N$RREQ);

  10464  1 002637   200003 236100                    LDQ     @N$RREQ,,AUTO
         1 002640   200006 756100                    STQ     STA$,,AUTO

     1047    10465    1         CG$=STA$->KQ$STA.CG$;

  10465  1 002641   200006 470500                    LDP0    STA$,,AUTO
         1 002642   000007 236100                    LDQ     7,,PR0
         1 002643   200011 756100                    STQ     CG$,,AUTO

     1048    10466    1         RBLK$=STA$->KQ$STA.RBLK$;

  10466  1 002644   000011 236100                    LDQ     9,,PR0
         1 002645   200007 756100                    STQ     RBLK$,,AUTO

  10466  1 002646                       FDELAY       null
     1049    10467    1   FDELAY:;
     1050    10468    1         RBLK$->KQ$RBLK.STATE=KQRS_NFET#;

  10468  1 002646   000011 220003                    LDX0    9,DU
         1 002647   200007 470500                    LDP0    RBLK$,,AUTO
         1 002650   000001 740100                    STX0    1,,PR0

     1051    10469              %LOCK (G=STA$->KQ$STA.GATE);

  10470  1 002651   200006 236100                    LDQ     STA$,,AUTO
         1 002652   000016 036003                    ADLQ    14,DU
         1 002653   200054 756100                    STQ     R$+1,,AUTO
         1 002654   200054 630500                    EPPR0   R$+1,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:167  
         1 002655   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002656   000000 701000 xent               TSX1    HFC$LOCK
         1 002657   000000 011000                    NOP     0

     1052    10472    1         STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

  10472  1 002660   200006 470500                    LDP0    STA$,,AUTO
         1 002661   000020 236100                    LDQ     16,,PR0
         1 002662   000001 036007                    ADLQ    1,DL
         1 002663   000020 552104                    STBQ    16,'04'O,PR0

     1053    10473              %UNLOCK (G=STA$->KQ$STA.GATE);

  10474  1 002664   200006 236100                    LDQ     STA$,,AUTO
         1 002665   000016 036003                    ADLQ    14,DU
         1 002666   200054 756100                    STQ     R$+1,,AUTO
         1 002667   200054 630500                    EPPR0   R$+1,,AUTO
         1 002670   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002671   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002672   000000 011000                    NOP     0

     1054    10476              %LOCK (G=CG$->KQ$CG.GATE.CG);

  10477  1 002673   200011 236100                    LDQ     CG$,,AUTO
         1 002674   000107 036003                    ADLQ    71,DU
         1 002675   200054 756100                    STQ     R$+1,,AUTO
         1 002676   200054 630500                    EPPR0   R$+1,,AUTO
         1 002677   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002700   000000 701000 xent               TSX1    HFC$LOCK
         1 002701   000000 011000                    NOP     0

     1055    10479    1         RBLK$->KQ$RBLK.MBLK$->KQ$MBLK.DFLNK$=CG$->KQ$CG.DFHD$;

  10479  1 002702   200007 470500                    LDP0    RBLK$,,AUTO
         1 002703   000000 471500                    LDP1    0,,PR0
         1 002704   200011 473500                    LDP3    CG$,,AUTO
         1 002705   300024 236100                    LDQ     20,,PR3
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:168  
         1 002706   100000 756100                    STQ     0,,PR1

     1056    10480    1         CG$->KQ$CG.DFHD$=STA$;

  10480  1 002707   200006 236100                    LDQ     STA$,,AUTO
         1 002710   300024 756100                    STQ     20,,PR3

     1057    10481              %UNLOCK (G=CG$->KQ$CG.GATE.CG);

  10482  1 002711   200011 236100                    LDQ     CG$,,AUTO
         1 002712   000107 036003                    ADLQ    71,DU
         1 002713   200054 756100                    STQ     R$+1,,AUTO
         1 002714   200054 630500                    EPPR0   R$+1,,AUTO
         1 002715   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002716   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002717   000000 011000                    NOP     0

     1058    10484    1         RETURN;

  10484  1 002720   000000 702200 xent               TSX2  ! X66_ARET

     1059    10485        /**/
     1060    10486        /*F* NAME:         KQR$DFETCH
     1061    10487             PURPOSE:      To re-try a fetch which failed due to no
     1062    10488                           defer blocks.
     1063    10489             CALL:         KQR$DFETCH (N$REQ)
     1064    10490             DESCRIPTION:  Called off the clock every once in a while
     1065    10491                           to try the fetch again.
     1066    10492        */
     1067    10493    1   KQR$DFETCH: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */

  10493  1 002721   000000 700200 xent  KQR$DFETCH   TSX0  ! X66_AUTO_1
         1 002722   000064 000001                    ZERO    52,1

     1068    10494        /**/
     1069    10495    1         CALL SETUP;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:169  
  10495  1 002723   006512 701000 1                  TSX1    SETUP
         1 002724   000000 011000                    NOP     0

     1070    10496    1         N$REQ.OPFLG.CLR='1'B;

  10496  1 002725   200004 470500                    LDP0    IOQ$,,AUTO
         1 002726   000001 236007                    LDQ     1,DL
         1 002727   000004 256100                    ORSQ    4,,PR0

     1071    10497    1         IF RBLK$->KQ$RBLK.STATE ~= KQRS_NFET# THEN CALL SC_BCGRBS;

  10497  1 002730   200007 471500                    LDP1    RBLK$,,AUTO
         1 002731   100001 220100                    LDX0    1,,PR1
         1 002732   000011 100003                    CMPX0   9,DU
         1 002733   002736 600000 1                  TZE     s:10498

  10497  1 002734   000000 713400 xsym               CLIMB   SC_BCGRBS
         1 002735   000000 600000 xsid               climb   nvectors=         0

     1072    10498    1         RBLK$->KQ$RBLK.STATE=KQRS_XFIP#;

  10498  1 002736   000003 220003                    LDX0    3,DU
         1 002737   200007 470500                    LDP0    RBLK$,,AUTO
         1 002740   000001 740100                    STX0    1,,PR0

     1073    10499    1         CALL KQP$UNLOCK (STA$->KQ$STA);

  10499  1 002741   200006 630500                    EPPR0   STA$,,AUTO
         1 002742   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002743   000000 701000 xent               TSX1    KQP$UNLOCK
         1 002744   000000 011000                    NOP     0

     1074    10500    1         MBLK$=RBLK$->KQ$RBLK.MBLK$;

  10500  1 002745   200007 470500                    LDP0    RBLK$,,AUTO
         1 002746   000000 236100                    LDQ     0,,PR0
         1 002747   200010 756100                    STQ     MBLK$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:170  

     1075    10501    1         DFRP$=ADDR(NIL);

  10501  1 002750   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002751   200030 756100                    STQ     DFRP$,,AUTO

     1076    10502    1         GOTO MOVERD1;

  10502  1 002752   002466 710000 1                  TRA     MOVERD1

  10501  1 002753                       RDDUN        null
     1077    10503        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:171  
     1078    10504        /***
     1079    10505         ***
     1080    10506         ***               FINISH UP THE READ HERE
     1081    10507         ***
     1082    10508         ***
     1083    10509         ***/
     1084    10510
     1085    10511    1   RDDUN: ;
     1086    10512    1         IF N$REQ.TYC = '0'B THEN

  10512  1 002753   200004 470500                    LDP0    IOQ$,,AUTO
         1 002754   000021 235100                    LDA     17,,PR0
         1 002755   003064 601000 1                  TNZ     RDDUN0

     1087    10513    1          IF RBLK$->KQ$RBLK.NCDDA = 0 THEN

  10513  1 002756   200007 471500                    LDP1    RBLK$,,AUTO
         1 002757   100011 235100                    LDA     9,,PR1
         1 002760   003064 601000 1                  TNZ     RDDUN0

     1088    10514    2            DO;

     1089    10515                                /* SET COMPLETED SUCCESSFULLY */
     1090    10516    2            RBLK$->KQ$RBLK.CS='1'B;

  10516  1 002761   040000 236007                    LDQ     16384,DL
         1 002762   100001 256100                    ORSQ    1,,PR1

     1091    10517    2            IF RBLK$->KQ$RBLK.LATCH THEN

  10517  1 002763   200007 471500                    LDP1    RBLK$,,AUTO
         1 002764   100001 236100                    LDQ     1,,PR1
         1 002765   400000 316007                    CANQ    -131072,DL
         1 002766   003064 600000 1                  TZE     RDDUN0

     1092    10518    3              DO;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:172  
     1093    10519    3              IF NOT STA$->KQ$STA.SUCCREAD THEN

  10519  1 002767   200006 473500                    LDP3    STA$,,AUTO
         1 002770   300020 236100                    LDQ     16,,PR3
         1 002771   010000 316003                    CANQ    4096,DU
         1 002772   003014 601000 1                  TNZ     s:10531

     1094    10520    4                DO;

     1095    10521                     %LOCK (G=STA$->KQ$STA.GATE);

  10522  1 002773   200006 236100                    LDQ     STA$,,AUTO
         1 002774   000016 036003                    ADLQ    14,DU
         1 002775   200054 756100                    STQ     R$+1,,AUTO
         1 002776   200054 630500                    EPPR0   R$+1,,AUTO
         1 002777   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003000   000000 701000 xent               TSX1    HFC$LOCK
         1 003001   000000 011000                    NOP     0

     1096    10524    4                STA$->KQ$STA.SUCCREAD='1'B;

  10524  1 003002   200006 470500                    LDP0    STA$,,AUTO
         1 003003   010000 236003                    LDQ     4096,DU
         1 003004   000020 256100                    ORSQ    16,,PR0

     1097    10525                     %UNLOCK (G=STA$->KQ$STA.GATE);

  10526  1 003005   200006 236100                    LDQ     STA$,,AUTO
         1 003006   000016 036003                    ADLQ    14,DU
         1 003007   200054 756100                    STQ     R$+1,,AUTO
         1 003010   200054 630500                    EPPR0   R$+1,,AUTO
         1 003011   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003012   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003013   000000 011000                    NOP     0

     1098    10528    4                END;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:173  
     1099    10529                                /* ASSIGN MIDEXTX FOR THIS LATCHED MSG,
     1100    10530                                   FOR USE IN LATCHED WRITES. */
     1101    10531    3              IF MBLK$->KQ$MBLK.PRIO >= %KQ_AUEP# THEN

  10531  1 003014   200010 470500                    LDP0    MBLK$,,AUTO
         1 003015   000001 220100                    LDX0    1,,PR0
         1 003016   765000 100003                    CMPX0   -5632,DU
         1 003017   003025 602000 1                  TNC     s:10538

     1102    10532    4                DO;

     1103    10533    4                RBLK$->KQ$RBLK.MIDEXTX=0;

  10533  1 003020   200007 471500                    LDP1    RBLK$,,AUTO
         1 003021   000000 236003                    LDQ     0,DU
         1 003022   100017 552140                    STBQ    15,'40'O,PR1

     1104    10534    4                RBLK$->KQ$RBLK.MIDEXTV=0;

  10534  1 003023   100017 552120                    STBQ    15,'20'O,PR1

     1105    10535    4                GOTO RDDUN0;

  10535  1 003024   003064 710000 1                  TRA     RDDUN0

     1106    10536    4                END;
     1107    10537    3              ELSE
     1108    10538    3               IF NOT CG$->KQ$CG.AUCTL.BIGMXT THEN

  10538  1 003025   200011 471500                    LDP1    CG$,,AUTO
         1 003026   100136 236100                    LDQ     94,,PR1
         1 003027   010000 316003                    CANQ    4096,DU
         1 003030   003061 601000 1                  TNZ     s:10553

     1109    10539    4                 DO;

     1110    10540    5                   DO I = 0 TO 5;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:174  

  10540  1 003031   200032 450100                    STZ     I,,AUTO

     1111    10541    5                   IF ADDR(MBLK$->KQ$MBLK.MID.XT)->B$$MIDEXT.EXTS(I) = 0 THEN

  10541  1 003032   200010 470500                    LDP0    MBLK$,,AUTO
         1 003033   200032 235100                    LDA     I,,AUTO
         1 003034   000100 101505                    MRL     fill='000'O
         1 003035   000015 020001                    ADSC6   13,A,PR0                 cn=0,n=1
         1 003036   200054 020006                    ADSC6   R$+1,,AUTO               cn=0,n=6
         1 003037   200054 236100                    LDQ     R$+1,,AUTO
         1 003040   000000 116003                    CMPQ    0,DU
         1 003041   003051 601000 1                  TNZ     s:10547

     1112    10542    6                     DO;

     1113    10543    6                     RBLK$->KQ$RBLK.MIDEXTX=I;

  10543  1 003042   200007 471500                    LDP1    RBLK$,,AUTO
         1 003043   200032 236100                    LDQ     I,,AUTO
         1 003044   000033 736000                    QLS     27
         1 003045   100017 552140                    STBQ    15,'40'O,PR1

     1114    10544    6                     RBLK$->KQ$RBLK.MIDEXTV=0;

  10544  1 003046   000000 236003                    LDQ     0,DU
         1 003047   100017 552120                    STBQ    15,'20'O,PR1

     1115    10545    6                     GOTO RDDUN0;

  10545  1 003050   003064 710000 1                  TRA     RDDUN0

     1116    10546    6                     END;
     1117    10547    5                   END;

  10547  1 003051   000001 035007                    ADLA    1,DL
         1 003052   200032 755100                    STA     I,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:175  
         1 003053   000006 115007                    CMPA    6,DL
         1 003054   003032 602000 1                  TNC     s:10541

     1118    10548                                  /* SPAWN-ABILITY USED UP.  SET SO HE CAN'T
     1119    10549                                     LATCH A WRITE TO IT. */
     1120    10550    4                 RBLK$->KQ$RBLK.MIDEXTV=63;

  10550  1 003055   200007 471500                    LDP1    RBLK$,,AUTO
         1 003056   000077 236003                    LDQ     63,DU
         1 003057   100017 552120                    STBQ    15,'20'O,PR1

     1121    10551    4                 END;

  10551  1 003060   003064 710000 1                  TRA     RDDUN0

     1122    10552    3               ELSE    /* BIGMXT is set, start counting at 0 */
     1123    10553    3                RBLK$->KQ$RBLK.MIDEXTV=0;

  10553  1 003061   200007 473500                    LDP3    RBLK$,,AUTO
         1 003062   000000 236003                    LDQ     0,DU
         1 003063   300017 552120                    STBQ    15,'20'O,PR3

     1124    10554    3              END;

     1125    10555    2            END;

  10543  1 003064                       RDDUN0       null
     1126    10556    1   RDDUN0:;
     1127    10557    1         CALL SETRCOMP;

  10557  1 003064   006442 701000 1                  TSX1    SETRCOMP
         1 003065   000000 011000                    NOP     0

  10543  1 003066                       READCOMP     null
     1128    10558    1   READCOMP:;
     1129    10559    1         STA$->KQ$STA.READS=STA$->KQ$STA.READS+1;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:176  
  10559  1 003066   200006 470500                    LDP0    STA$,,AUTO
         1 003067   000026 054100                    AOS     22,,PR0

     1130    10560    1         RBLK$->KQ$RBLK.STATE=KQRS_COMP#;

  10560  1 003070   000001 220003                    LDX0    1,DU
         1 003071   200007 471500                    LDP1    RBLK$,,AUTO
         1 003072   100001 740100                    STX0    1,,PR1

     1131    10561    1         IF KQ_LOG.DSIO THEN

  10561  1 003073   000000 236000 xsym               LDQ     KQ_LOG
         1 003074   002000 316003                    CANQ    1024,DU
         1 003075   003121 600000 1                  TZE     s:10567

     1132    10562    1          CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_READC,0,
     1133    10563    1          VLP_STATION.MSGID,
     1134    10564    1          ADDR(VLP_STATION.MSGID)->B$$HALF,
     1135    10565    1          SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
     1136    10566    1          SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));

  10566  1 003076   200006 236100                    LDQ     STA$,,AUTO
         1 003077   000006 036003                    ADLQ    6,DU
         1 003100   200062 756100                    STQ     R$+7,,AUTO
         1 003101   200006 236100                    LDQ     STA$,,AUTO
         1 003102   000005 036003                    ADLQ    5,DU
         1 003103   200061 756100                    STQ     R$+6,,AUTO
         1 003104   200017 631500                    EPPR1   VLP_STATION+5,,AUTO
         1 003105   200060 451500                    STP1    R$+5,,AUTO
         1 003106   200017 633500                    EPPR3   VLP_STATION+5,,AUTO
         1 003107   200057 453500                    STP3    R$+4,,AUTO
         1 003110   000001 236000 2                  LDQ     1
         1 003111   200056 756100                    STQ     R$+3,,AUTO
         1 003112   000027 236000 2                  LDQ     23
         1 003113   200011 235100                    LDA     CG$,,AUTO
         1 003114   200054 757100                    STAQ    R$+1,,AUTO
         1 003115   200054 630500                    EPPR0   R$+1,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:177  
         1 003116   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 003117   000000 701000 xent               TSX1    KQZ$LOG
         1 003120   000000 011000                    NOP     0

     1137    10567    1         CALL NIO$COMPC (N$REQ);

  10567  1 003121   200004 630500                    EPPR0   IOQ$,,AUTO
         1 003122   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003123   000000 701000 xent               TSX1    NIO$COMPC
         1 003124   000000 011000                    NOP     0

     1138    10568    1         RETURN;

  10568  1 003125   000000 702200 xent               TSX2  ! X66_ARET

  10566  1 003126                       BRCBUFAU     null
     1139    10569
     1140    10570        /**/
     1141    10571    1   BRCBUFAU:;
     1142    10572    1         CALL HFF$TRAPALT;

  10572  1 003126   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003127   000000 701000 xent               TSX1    HFF$TRAPALT
         1 003130   000000 011000                    NOP     0

  10566  1 003131                       BRCBUFAU1    null
     1143    10573    1   BRCBUFAU1:;
     1144    10574    1         N$REQ.TYC=%TYC_MTRAP;

  10574  1 003131   000044 236000 0                  LDQ     ERR_NODAT+6
         1 003132   200004 470500                    LDP0    IOQ$,,AUTO
         1 003133   000021 756100                    STQ     17,,PR0

     1145    10575    1         GOTO RDDUN0;

  10575  1 003134   003064 710000 1                  TRA     RDDUN0

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:178  
  10574  1 003135                       BRCBUFU      null
     1146    10576    1   BRCBUFU:;
     1147    10577    1         CALL HFF$TRAPALT;

  10577  1 003135   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003136   000000 701000 xent               TSX1    HFF$TRAPALT
         1 003137   000000 011000                    NOP     0

     1148    10578    1         N$REQ.TYC=%TYC_MTRAP;

  10578  1 003140   000044 236000 0                  LDQ     ERR_NODAT+6
         1 003141   200004 470500                    LDP0    IOQ$,,AUTO
         1 003142   000021 756100                    STQ     17,,PR0

     1149    10579    1         CALL KQD$UNLOCK (CG$->KQ$CG,DBLK$);

  10579  1 003143   200031 631500                    EPPR1   DBLK$,,AUTO
         1 003144   200055 451500                    STP1    R$+2,,AUTO
         1 003145   200011 236100                    LDQ     CG$,,AUTO
         1 003146   200054 756100                    STQ     R$+1,,AUTO
         1 003147   200054 630500                    EPPR0   R$+1,,AUTO
         1 003150   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003151   000000 701000 xent               TSX1    KQD$UNLOCK
         1 003152   000000 011000                    NOP     0

     1150    10580    1         GOTO RDDUN0;

  10580  1 003153   003064 710000 1                  TRA     RDDUN0

     1151    10581        /**/
     1152    10582    1   COMPBAD: PROC;

  10582  1 003154   200046 741300       COMPBAD      STX1  ! TIMCHK+2,,AUTO

     1153    10583        /**/
     1154    10584    2         IF KQ_LOG.DSIO THEN

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:179  
  10584  1 003155   000000 236000 xsym               LDQ     KQ_LOG
         1 003156   002000 316003                    CANQ    1024,DU
         1 003157   003222 600000 1                  TZE     s:10601

     1155    10585    3           DO;

     1156    10586    3           KEY1L=0;

  10586  1 003160   200025 450100                    STZ     KEY1L,,AUTO

     1157    10587    4             DO I = 1 TO 35;

  10587  1 003161   000001 235007                    LDA     1,DL
         1 003162   200032 755100                    STA     I,,AUTO

     1158    10588    4             IF ADDR(N$REQ.TYC)->B$$BITS.B(I) THEN

  10588  1 003163   200004 470500                    LDP0    IOQ$,,AUTO
         1 003164   200032 235100                    LDA     I,,AUTO
         1 003165   000000 066505                    CMPB    filb='0'B
         1 003166   000021 000001                    BDSC    17,A,PR0                 by=0,bit=0,n=1
         1 003167   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 003170   003173 600000 1                  TZE     s:10593

     1159    10589    5               DO;

     1160    10590    5               KEY1L=I;

  10590  1 003171   200025 755100                    STA     KEY1L,,AUTO

     1161    10591    5               GOTO CB1;

  10591  1 003172   003177 710000 1                  TRA     CB1

     1162    10592    5               END;
     1163    10593    4             END;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:180  
  10593  1 003173   000001 035007                    ADLA    1,DL
         1 003174   200032 755100                    STA     I,,AUTO
         1 003175   000044 115007                    CMPA    36,DL
         1 003176   003163 602000 1                  TNC     s:10588

  10587  1 003177                       CB1          null
     1164    10594    3   CB1:    ;
     1165    10595    3           CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_READC,KEY1L,
     1166    10596    3           VLP_STATION.MSGID,
     1167    10597    3           ADDR(VLP_STATION.MSGID)->B$$HALF,
     1168    10598    3           SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
     1169    10599    3           SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));

  10599  1 003177   200006 236100                    LDQ     STA$,,AUTO
         1 003200   000006 036003                    ADLQ    6,DU
         1 003201   200062 756100                    STQ     R$+7,,AUTO
         1 003202   200006 236100                    LDQ     STA$,,AUTO
         1 003203   000005 036003                    ADLQ    5,DU
         1 003204   200061 756100                    STQ     R$+6,,AUTO
         1 003205   200017 631500                    EPPR1   VLP_STATION+5,,AUTO
         1 003206   200060 451500                    STP1    R$+5,,AUTO
         1 003207   200017 633500                    EPPR3   VLP_STATION+5,,AUTO
         1 003210   200057 453500                    STP3    R$+4,,AUTO
         1 003211   200025 634500                    EPPR4   KEY1L,,AUTO
         1 003212   200056 454500                    STP4    R$+3,,AUTO
         1 003213   000027 236000 2                  LDQ     23
         1 003214   200011 235100                    LDA     CG$,,AUTO
         1 003215   200054 757100                    STAQ    R$+1,,AUTO
         1 003216   200054 630500                    EPPR0   R$+1,,AUTO
         1 003217   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 003220   000000 701000 xent               TSX1    KQZ$LOG
         1 003221   000000 011000                    NOP     0

     1170    10600    3           END;

     1171    10601    2         CALL NIO$COMPCNS (N$REQ);

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:181  
  10601  1 003222   200004 630500                    EPPR0   IOQ$,,AUTO
         1 003223   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003224   000000 701000 xent               TSX1    NIO$COMPCNS
         1 003225   000000 011000                    NOP     0

     1172    10602    2         RETURN;

  10602  1 003226   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 003227   000001 702211                    TSX2  ! 1,X1

  10602  1 003230                       BRCCRCW      null
     1173    10603    2   END COMPBAD;
     1174    10604    1   BRCCRCW:;
     1175    10605    1         N$REQ.TYC=%TYC_CGCRCW;

  10605  1 003230   000045 236000 0                  LDQ     ERR_NODAT+7
         1 003231   200004 470500                    LDP0    IOQ$,,AUTO
         1 003232   000021 756100                    STQ     17,,PR0

     1176    10606    1         GOTO BADCOMP;

  10606  1 003233   003445 710000 1                  TRA     BADCOMP

  10605  1 003234                       BRCBUFQ      null
     1177    10607    1   BRCBUFQ:;
     1178    10608    1         CALL KQL$QDFDUN (STA$->KQ$STA);

  10608  1 003234   200006 630500                    EPPR0   STA$,,AUTO
         1 003235   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003236   000000 701000 xent               TSX1    KQL$QDFDUN
         1 003237   000000 011000                    NOP     0

     1179    10609    1         GOTO BRCBUF0;

  10609  1 003240   003245 710000 1                  TRA     BRCBUF0

  10605  1 003241                       BRCBUF       null
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:182  
     1180    10610    1   BRCBUF:;
     1181    10611    1         CALL KQL$DDFDUN (STA$->KQ$STA);

  10611  1 003241   200006 630500                    EPPR0   STA$,,AUTO
         1 003242   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003243   000000 701000 xent               TSX1    KQL$DDFDUN
         1 003244   000000 011000                    NOP     0

  10605  1 003245                       BRCBUF0      null
     1182    10612    1   BRCBUF0:;
     1183    10613    1         N$REQ.TYC=%TYC_MTRAP;

  10613  1 003245   000044 236000 0                  LDQ     ERR_NODAT+6
         1 003246   200004 470500                    LDP0    IOQ$,,AUTO
         1 003247   000021 756100                    STQ     17,,PR0

     1184    10614    1         GOTO BRCOMP;

  10614  1 003250   003411 710000 1                  TRA     BRCOMP

  10613  1 003251                       BRCBUFF      null
     1185    10615    1   BRCBUFF:;
     1186    10616    1         CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(NIL));

  10616  1 003251   000001 236000 2                  LDQ     1
         1 003252   200056 756100                    STQ     R$+3,,AUTO
         1 003253   200031 630500                    EPPR0   DBLK$,,AUTO
         1 003254   200055 450500                    STP0    R$+2,,AUTO
         1 003255   200011 236100                    LDQ     CG$,,AUTO
         1 003256   200054 756100                    STQ     R$+1,,AUTO
         1 003257   200054 630500                    EPPR0   R$+1,,AUTO
         1 003260   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003261   000000 701000 xent               TSX1    KQD$DEFERGO
         1 003262   000000 011000                    NOP     0

     1187    10617    1         GOTO BRCBUFAU1;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:183  
  10617  1 003263   003131 710000 1                  TRA     BRCBUFAU1

  10613  1 003264                       BRCTYCQ      null
     1188    10618    1   BRCTYCQ:;
     1189    10619    1         CALL KQL$QDFDUN (STA$->KQ$STA);

  10619  1 003264   200006 630500                    EPPR0   STA$,,AUTO
         1 003265   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003266   000000 701000 xent               TSX1    KQL$QDFDUN
         1 003267   000000 011000                    NOP     0

     1190    10620    1         GOTO BRCTYC;

  10620  1 003270   003304 710000 1                  TRA     BRCTYC

  10613  1 003271                       BRCTYCD      null
     1191    10621    1   BRCTYCD:;
     1192    10622              %LOCK (G=STA$->KQ$STA.GATE);

  10623  1 003271   200006 236100                    LDQ     STA$,,AUTO
         1 003272   000016 036003                    ADLQ    14,DU
         1 003273   200054 756100                    STQ     R$+1,,AUTO
         1 003274   200054 630500                    EPPR0   R$+1,,AUTO
         1 003275   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003276   000000 701000 xent               TSX1    HFC$LOCK
         1 003277   000000 011000                    NOP     0

     1193    10625    1         CALL KQL$DDFDUN (STA$->KQ$STA);

  10625  1 003300   200006 630500                    EPPR0   STA$,,AUTO
         1 003301   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003302   000000 701000 xent               TSX1    KQL$DDFDUN
         1 003303   000000 011000                    NOP     0

  10623  1 003304                       BRCTYC       null
     1194    10626    1   BRCTYC:;
     1195    10627    1         N$REQ.TYC=TYC;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:184  

  10627  1 003304   200040 236100                    LDQ     TYC,,AUTO
         1 003305   200004 470500                    LDP0    IOQ$,,AUTO
         1 003306   000021 756100                    STQ     17,,PR0

     1196    10628    1         GOTO BRCOMP;

  10628  1 003307   003411 710000 1                  TRA     BRCOMP

  10627  1 003310                       BRCKEY       null
     1197    10629    1   BRCKEY:;
     1198    10630    1         N$REQ.TYC=%TYC_CGKEYV;

  10630  1 003310   000046 236000 0                  LDQ     ERR_NODAT+8
         1 003311   200004 470500                    LDP0    IOQ$,,AUTO
         1 003312   000021 756100                    STQ     17,,PR0

     1199    10631    1         GOTO BRCOMP;

  10631  1 003313   003411 710000 1                  TRA     BRCOMP

  10630  1 003314                       BRDISC       null
     1200    10632    1   BRDISC:;
     1201    10633    1         N$REQ.TYC=%TYC_DISC;

  10633  1 003314   000047 236000 0                  LDQ     ERR_NODAT+9
         1 003315   200004 470500                    LDP0    IOQ$,,AUTO
         1 003316   000021 756100                    STQ     17,,PR0

     1202    10634    1         GOTO BRCOMP;

  10634  1 003317   003411 710000 1                  TRA     BRCOMP

  10633  1 003320                       BRCFUL       null
     1203    10635    1   BRCFUL:;
     1204    10636    1         N$REQ.TYC=%TYC_CGFULL;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:185  
  10636  1 003320   000050 236000 0                  LDQ     ERR_NODAT+10
         1 003321   200004 470500                    LDP0    IOQ$,,AUTO
         1 003322   000021 756100                    STQ     17,,PR0

     1205    10637    1         GOTO BRCOMP;

  10637  1 003323   003411 710000 1                  TRA     BRCOMP

  10636  1 003324                       BRCRERR0     null
     1206    10638    1   BRCRERR0:;
     1207    10639    1         CALL KQL$QDFDUN (STA$->KQ$STA);

  10639  1 003324   200006 630500                    EPPR0   STA$,,AUTO
         1 003325   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003326   000000 701000 xent               TSX1    KQL$QDFDUN
         1 003327   000000 011000                    NOP     0

     1208    10640    1         GOTO BRCRERR1;

  10640  1 003330   003335 710000 1                  TRA     BRCRERR1

  10636  1 003331                       BRCRERR      null
     1209    10641    1   BRCRERR:;
     1210    10642    1         CALL KQL$DDFDUN (STA$->KQ$STA);

  10642  1 003331   200006 630500                    EPPR0   STA$,,AUTO
         1 003332   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003333   000000 701000 xent               TSX1    KQL$DDFDUN
         1 003334   000000 011000                    NOP     0

  10636  1 003335                       BRCRERR1     null
     1211    10643    1   BRCRERR1:;
     1212    10644    2           DO CASE (RBLK$->KQ$RBLK.ERR);

  10644  1 003335   200007 470500                    LDP0    RBLK$,,AUTO
         1 003336   000001 236100                    LDQ     1,,PR0
         1 003337   000011 772000                    QRL     9
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:186  
         1 003340   000007 376007                    ANQ     7,DL
         1 003341   000002 116007                    CMPQ    2,DL
         1 003342   003344 602006 1                  TNC     BRCRERR1+7,QL
         1 003343   003352 710000 1                  TRA     s:10649
         1 003344   003352 710000 1                  TRA     s:10649
         1 003345   003346 710000 1                  TRA     s:10646

     1213    10645    2             CASE (KQGE_QFUL#);

     1214    10646    2               N$REQ.TYC=%TYC_CGFULL;

  10646  1 003346   000050 236000 0                  LDQ     ERR_NODAT+10
         1 003347   200004 471500                    LDP1    IOQ$,,AUTO
         1 003350   100021 756100                    STQ     17,,PR1

     1215    10647    2               GOTO BRCOMP;

  10647  1 003351   003411 710000 1                  TRA     BRCOMP

     1216    10648    2             CASE (ELSE);

     1217    10649    2               CALL SC_BCGRBS;

  10649  1 003352   000000 713400 xsym               CLIMB   SC_BCGRBS
         1 003353   000000 600000 xsid               climb   nvectors=         0

     1218    10650    2           END;

  10644  1 003354                       BRCFULL      null
     1219    10651    1   BRCFULL:;
     1220    10652    1         N$REQ.TYC=%TYC_CGFULL;

  10652  1 003354   000050 236000 0                  LDQ     ERR_NODAT+10
         1 003355   200004 470500                    LDP0    IOQ$,,AUTO
         1 003356   000021 756100                    STQ     17,,PR0

     1221    10653    1         GOTO BADCOMP;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:187  

  10653  1 003357   003445 710000 1                  TRA     BADCOMP

  10652  1 003360                       BRCCWRV      null
     1222    10654    1   BRCCWRV:;
     1223    10655              %UNLOCK (G=STA$->KQ$STA.GATE);

  10656  1 003360   200006 236100                    LDQ     STA$,,AUTO
         1 003361   000016 036003                    ADLQ    14,DU
         1 003362   200054 756100                    STQ     R$+1,,AUTO
         1 003363   200054 630500                    EPPR0   R$+1,,AUTO
         1 003364   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003365   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003366   000000 011000                    NOP     0

     1224    10658    1         N$REQ.TYC=%TYC_CGCWRV;

  10658  1 003367   000051 236000 0                  LDQ     ERR_NODAT+11
         1 003370   200004 470500                    LDP0    IOQ$,,AUTO
         1 003371   000021 756100                    STQ     17,,PR0

     1225    10659    1         GOTO BADCOMP;

  10659  1 003372   003445 710000 1                  TRA     BADCOMP

  10658  1 003373                       BRCEOFUNL    null
     1226    10660    1   BRCEOFUNL:;
     1227    10661              %UNLOCK (G=STA$->KQ$STA.GATE);

  10662  1 003373   200006 236100                    LDQ     STA$,,AUTO
         1 003374   000016 036003                    ADLQ    14,DU
         1 003375   200054 756100                    STQ     R$+1,,AUTO
         1 003376   200054 630500                    EPPR0   R$+1,,AUTO
         1 003377   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003400   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003401   000000 011000                    NOP     0

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:188  
  10658  1 003402                       BRCEOF       null
     1228    10664    1   BRCEOF:;
     1229    10665    1         N$REQ.TYC=%TYC_EOF;

  10665  1 003402   000052 236000 0                  LDQ     ERR_NODAT+12
         1 003403   200004 470500                    LDP0    IOQ$,,AUTO
         1 003404   000021 756100                    STQ     17,,PR0

     1230    10666    1         GOTO BRCOMP;

  10666  1 003405   003411 710000 1                  TRA     BRCOMP

  10665  1 003406                       BRCNODAT     null
     1231    10667    1   BRCNODAT:;
     1232    10668    1         B$JIT$->B$JIT.ERR = ERR_NODAT;

  10668  1 003406   000036 236000 0                  LDQ     ERR_NODAT
         1 003407   000000 470400 xsym               LDP0    B$JIT$
         1 003410   000012 756100                    STQ     10,,PR0

  10668  1 003411                       BRCOMP       null
     1233    10669    1   BRCOMP:;
     1234    10670    2           DO INHIBIT;

     1235    10671                %LOCK (G=STA$->KQ$STA.GATE);

  10672  1 003411   200006 236300                    LDQ   ! STA$,,AUTO
         1 003412   000016 036203                    ADLQ  ! 14,DU
         1 003413   200054 756300                    STQ   ! R$+1,,AUTO
         1 003414   200054 630700                    EPPR0 ! R$+1,,AUTO
         1 003415   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 003416   000000 701200 xent               TSX1  ! HFC$LOCK
         1 003417   000000 011200                    NOP   ! 0

     1236    10674    2           STA$->KQ$STA.RBLK$=ADDR(NIL);

  10674  1 003420   000001 236200 xsym               LDQ   ! B_VECTNIL+1
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:189  
         1 003421   200006 470700                    LDP0  ! STA$,,AUTO
         1 003422   000011 756300                    STQ   ! 9,,PR0

     1237    10675    2           CALL DUMPRBLK;

  10675  1 003423   005307 701200 1                  TSX1  ! DUMPRBLK
         1 003424   000000 011200                    NOP   ! 0

     1238    10676    2           LDCT$->NK$LDCT.IOQ$=ADDR(NIL);

  10676  1 003425   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 003426   200005 470700                    LDP0  ! LDCT$,,AUTO
         1 003427   000001 756300                    STQ   ! 1,,PR0

     1239    10677    2           GOTO BADCOMPUNL;

  10677  1 003430   003435 710200 1                  TRA   ! BADCOMPUNL

  10676  1 003431                       BADATCOMPUNL null
     1240    10678    2   BADATCOMPUNL:;
     1241    10679    2           STA$->KQ$STA.RBLK$=ADDR(NIL);

  10679  1 003431   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 003432   000011 756300                    STQ   ! 9,,PR0

     1242    10680    2           CALL DUMPRBLK;

  10680  1 003433   005307 701200 1                  TSX1  ! DUMPRBLK
         1 003434   000000 011200                    NOP   ! 0

  10679  1 003435                       BADCOMPUNL   null
     1243    10681    2   BADCOMPUNL:;
     1244    10682                %UNLOCK (G=STA$->KQ$STA.GATE);

  10683  1 003435   200006 236300                    LDQ   ! STA$,,AUTO
         1 003436   000016 036203                    ADLQ  ! 14,DU
         1 003437   200054 756300                    STQ   ! R$+1,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:190  
         1 003440   200054 630700                    EPPR0 ! R$+1,,AUTO
         1 003441   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 003442   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 003443   000000 011200                    NOP   ! 0

     1245    10685    2           GOTO BADCOMP1;

  10685  1 003444   003450 710200 1                  TRA   ! BADCOMP1

     1246    10686    2           END;

  10679  1 003445                       BADCOMP      null
     1247    10687    1   BADCOMP: ;
     1248    10688    1         LDCT$->NK$LDCT.IOQ$=ADDR(NIL);

  10688  1 003445   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003446   200005 470500                    LDP0    LDCT$,,AUTO
         1 003447   000001 756100                    STQ     1,,PR0

  10688  1 003450                       BADCOMP1     null
     1249    10689    1   BADCOMP1:;
     1250    10690    1         IF ACTQTN$ ~= ADDR(NIL) THEN CALL ACTQTN;

  10690  1 003450   200024 236100                    LDQ     ACTQTN$,,AUTO
         1 003451   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003452   003455 600000 1                  TZE     s:10691

  10690  1 003453   005723 701000 1                  TSX1    ACTQTN
         1 003454   000000 011000                    NOP     0

     1251    10691    1         CALL COMPBAD;

  10691  1 003455   003154 701000 1                  TSX1    COMPBAD
         1 003456   000000 011000                    NOP     0

  10690  1 003457                       ALTRT        null
     1252    10692    1   ALTRT:;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:191  
     1253    10693    1         ALTRETURN;

  10693  1 003457   000000 702200 xent               TSX2  ! X66_AALT

     1254    10694        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:192  
     1255    10695        /**/
     1256    10696        /*F* NAME:         KQR$VALIDATE
     1257    10697             PURPOSE:      To validate an outstanding read, and if no longer
     1258    10698                           valid, abort it
     1259    10699             CALL:         KQR$VALIDATE (N$REQ)
     1260    10700             DESCRIPTION:  Called when something has happened which may in-
     1261    10701                           validate a read request (e.g. his station is de-
     1262    10702                           activated, or the station he is reading has dis-
     1263    10703                           connected).  Entered with the reading station
     1264    10704                           locked, and the current read definitely pending.
     1265    10705                           Both trees are locked, and are not to be unlocked
     1266    10706                           unless the read gets aborted.  This is to allow
     1267    10707                           checking the read without allowing a writer to
     1268    10708                           slip thru, or the user to close the DCB.
     1269    10709                           If the read is no longer valid, it is aborted
     1270    10710                           by calling NIO$COMP with the appropriate TYC,
     1271    10711                           and we ALTRET, unlocking the station block and
     1272    10712                           then both trees.  Else we RETURN.
     1273    10713        */
     1274    10714    1   KQR$VALIDATE: ENTRY(N$RREQ) ALTRET;

  10714  1 003460   000000 700200 xent  KQR$VALIDATE TSX0  ! X66_AUTO_1
         1 003461   000064 000001                    ZERO    52,1

     1275    10715        /**/
     1276    10716    1         CALL SETUP;

  10716  1 003462   006512 701000 1                  TSX1    SETUP
         1 003463   000000 011000                    NOP     0

     1277    10717    1         CALL CHKACT ALTRET(VAL0);

  10717  1 003464   006545 701000 1                  TSX1    CHKACT
         1 003465   003506 702000 1                  TSX2    VAL0

     1278    10718    1         KEY1L=RBLK$->KQ$RBLK.KEY1L;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:193  
  10718  1 003466   200007 470500                    LDP0    RBLK$,,AUTO
         1 003467   000001 236100                    LDQ     1,,PR0
         1 003470   000004 772000                    QRL     4
         1 003471   000017 376007                    ANQ     15,DL
         1 003472   200025 756100                    STQ     KEY1L,,AUTO

     1279    10719    1         KEY2L=RBLK$->KQ$RBLK.KEY2L;

  10719  1 003473   000001 236100                    LDQ     1,,PR0
         1 003474   000017 376007                    ANQ     15,DL
         1 003475   200026 756100                    STQ     KEY2L,,AUTO

     1280    10720    1         CALL VRQKEYNL ALTRET(NTVALID);

  10720  1 003476   006031 701000 1                  TSX1    VRQKEYNL
         1 003477   003503 702000 1                  TSX2    NTVALID

     1281    10721    1         CALL VRNQKEYNL ALTRET(NTVALID);

  10721  1 003500   006071 701000 1                  TSX1    VRNQKEYNL
         1 003501   003503 702000 1                  TSX2    NTVALID

     1282    10722    1         RETURN;

  10722  1 003502   000000 702200 xent               TSX2  ! X66_ARET

  10719  1 003503                       NTVALID      null
     1283    10723    1   NTVALID:;
     1284    10724    1         N$REQ.TYC=TYC;

  10724  1 003503   200040 236100                    LDQ     TYC,,AUTO
         1 003504   200004 470500                    LDP0    IOQ$,,AUTO
         1 003505   000021 756100                    STQ     17,,PR0

  10724  1 003506                       VAL0         null
     1285    10725    1   VAL0: ;
     1286    10726    1         RBLK$->KQ$RBLK.STATE=KQRS_RSIP#;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:194  

  10726  1 003506   000000 220003                    LDX0    0,DU
         1 003507   200007 470500                    LDP0    RBLK$,,AUTO
         1 003510   000001 740100                    STX0    1,,PR0

     1287    10727              %UNLOCK (G=STA$->KQ$STA.GATE);

  10728  1 003511   200006 236100                    LDQ     STA$,,AUTO
         1 003512   000016 036003                    ADLQ    14,DU
         1 003513   200054 756100                    STQ     R$+1,,AUTO
         1 003514   200054 630500                    EPPR0   R$+1,,AUTO
         1 003515   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003516   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003517   000000 011000                    NOP     0

     1288    10730    1         CALL KQT$UBT (CG$->KQ$CG);

  10730  1 003520   200011 630500                    EPPR0   CG$,,AUTO
         1 003521   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003522   000000 701000 xent               TSX1    KQT$UBT
         1 003523   000000 011000                    NOP     0

     1289    10731    1         CALL DEQUEUE;

  10731  1 003524   005324 701000 1                  TSX1    DEQUEUE
         1 003525   000000 011000                    NOP     0

     1290    10732    1         CALL KQQ$DQEOFTIME(CG$->KQ$CG,RBLK$);

  10732  1 003526   200007 630500                    EPPR0   RBLK$,,AUTO
         1 003527   200055 450500                    STP0    R$+2,,AUTO
         1 003530   200011 236100                    LDQ     CG$,,AUTO
         1 003531   200054 756100                    STQ     R$+1,,AUTO
         1 003532   200054 630500                    EPPR0   R$+1,,AUTO
         1 003533   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003534   000000 701000 xent               TSX1    KQQ$DQEOFTIME
         1 003535   000000 011000                    NOP     0
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:195  

     1291    10733    1         N$REQ.OPFLG.CLR='1'B;

  10733  1 003536   200004 470500                    LDP0    IOQ$,,AUTO
         1 003537   000001 236007                    LDQ     1,DL
         1 003540   000004 256100                    ORSQ    4,,PR0

     1292    10734    1         GOTO BRCOMP;

  10734  1 003541   003411 710000 1                  TRA     BRCOMP

     1293    10735        /**/
     1294    10736        /*F* NAME:         KQR$COMP
     1295    10737             PURPOSE:      To I/O COMP a read
     1296    10738             CALL:         KQR$COMP (N$REQ)
     1297    10739             DESCRIPTION:  Called from KQW$WRITE when a write direct from
     1298    10740                           the writer's buffer satisfies a read.  In this
     1299    10741                           case reader's buffer is stuffed, the MBLK is
     1300    10742                           pointed to by the RBLK (which is removed from
     1301    10743                           the queue if it was in it), and the RBLK state
     1302    10744                           set to KQRS_XFDN (xfer done).  Then we enter
     1303    10745                           here to call NIO$COMP after stuffing the request
     1304    10746                           packet with the params of the message.  The
     1305    10747                           reading station is not locked.
     1306    10748
     1307    10749                           The read is guaranteed not to have specified
     1308    10750                           LATCH, nor was the write continued.
     1309    10751        */
     1310    10752    1   KQR$COMP: ENTRY(N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */

  10752  1 003542   000000 700200 xent  KQR$COMP     TSX0  ! X66_AUTO_1
         1 003543   000064 000001                    ZERO    52,1

     1311    10753        /**/
     1312    10754    1         CALL SETUP;

  10754  1 003544   006512 701000 1                  TSX1    SETUP
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:196  
         1 003545   000000 011000                    NOP     0

     1313    10755    1         N$REQ.OPFLG.CLR='1'B;

  10755  1 003546   200004 470500                    LDP0    IOQ$,,AUTO
         1 003547   000001 236007                    LDQ     1,DL
         1 003550   000004 256100                    ORSQ    4,,PR0

     1314    10756    1         RBLK$->KQ$RBLK.CS='1'B;

  10756  1 003551   200007 471500                    LDP1    RBLK$,,AUTO
         1 003552   040000 236007                    LDQ     16384,DL
         1 003553   100001 256100                    ORSQ    1,,PR1

     1315    10757    1         MBLK$=RBLK$->KQ$RBLK.MBLK$;

  10757  1 003554   200007 471500                    LDP1    RBLK$,,AUTO
         1 003555   100000 236100                    LDQ     0,,PR1
         1 003556   200010 756100                    STQ     MBLK$,,AUTO

     1316    10758    1         CALL SETRCOMP;

  10758  1 003557   006442 701000 1                  TSX1    SETRCOMP
         1 003560   000000 011000                    NOP     0

     1317    10759    1         GOTO READCOMP;

  10759  1 003561   003066 710000 1                  TRA     READCOMP

     1318    10760        /**/
     1319    10761        /*F* NAME:         KQR$TRUNC
     1320    10762             PURPOSE:      To 'trunc' a DCB station's RBLK
     1321    10763             CALL:         KQR$TRUNC (KQ$STA)
     1322    10764             INPUT:        Station gate locked
     1323    10765                           Does not unlock station.
     1324    10766        */
     1325    10767    1   KQR$TRUNC: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:197  

  10767  1 003562   000000 700200 xent  KQR$TRUNC    TSX0  ! X66_AUTO_1
         1 003563   000064 000001                    ZERO    52,1

     1326    10768        /**/
     1327    10769    1         STA$=ADDR(N$RREQ);

  10769  1 003564   200003 236100                    LDQ     @N$RREQ,,AUTO
         1 003565   200006 756100                    STQ     STA$,,AUTO

     1328    10770    1         CG$=STA$->KQ$STA.CG$;

  10770  1 003566   200006 470500                    LDP0    STA$,,AUTO
         1 003567   000007 236100                    LDQ     7,,PR0
         1 003570   200011 756100                    STQ     CG$,,AUTO

     1329    10771    1         RBLK$=STA$->KQ$STA.RBLK$;

  10771  1 003571   000011 236100                    LDQ     9,,PR0
         1 003572   200007 756100                    STQ     RBLK$,,AUTO

     1330    10772    1         IF RBLK$ ~= ADDR(NIL) THEN

  10772  1 003573   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003574   003615 600000 1                  TZE     s:10781

     1331    10773    1          IF  RBLK$->KQ$RBLK.STATE = KQRS_COMP#

  10773  1 003575   200007 471500                    LDP1    RBLK$,,AUTO
         1 003576   100001 220100                    LDX0    1,,PR1
         1 003577   000001 100003                    CMPX0   1,DU
         1 003600   003615 601000 1                  TNZ     s:10781
         1 003601   100011 235100                    LDA     9,,PR1
         1 003602   003615 601000 1                  TNZ     s:10781
         1 003603   100000 236100                    LDQ     0,,PR1
         1 003604   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003605   003615 601000 1                  TNZ     s:10781
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:198  
         1 003606   100001 236100                    LDQ     1,,PR1
         1 003607   400000 316007                    CANQ    -131072,DL
         1 003610   003615 601000 1                  TNZ     s:10781

     1332    10774    1          AND RBLK$->KQ$RBLK.NCDDA = 0
     1333    10775    1          AND RBLK$->KQ$RBLK.MBLK$ = ADDR(NIL)
     1334    10776    1          AND RBLK$->KQ$RBLK.LATCH = '0'B THEN
     1335    10777    2            DO INHIBIT;

     1336    10778    2            STA$->KQ$STA.RBLK$=ADDR(NIL);

  10778  1 003611   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 003612   000011 756300                    STQ   ! 9,,PR0

     1337    10779    2            CALL DUMPRBLK;

  10779  1 003613   005307 701200 1                  TSX1  ! DUMPRBLK
         1 003614   000000 011200                    NOP   ! 0

     1338    10780    2            END;

     1339    10781    1         RETURN;

  10781  1 003615   000000 702200 xent               TSX2  ! X66_ARET

     1340    10782        /**/
     1341    10783        /*F* NAME:         KQR$GETQUEUE
     1342    10784             PURPOSE:      To acquire the queue for read
     1343    10785             CALL:         KQR$GETQUEUE (KQ$STA)
     1344    10786             DESCRIPTION:  See GETQUEUE
     1345    10787        */
     1346    10788    1   KQR$GETQUEUE: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */

  10788  1 003616   000000 700200 xent  KQR$GETQUEUE TSX0  ! X66_AUTO_1
         1 003617   000064 000001                    ZERO    52,1

     1347    10789        /**/
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:199  
     1348    10790    1         STA$=ADDR(N$RREQ);

  10790  1 003620   200003 236100                    LDQ     @N$RREQ,,AUTO
         1 003621   200006 756100                    STQ     STA$,,AUTO

     1349    10791    1         CG$=STA$->KQ$STA.CG$;

  10791  1 003622   200006 470500                    LDP0    STA$,,AUTO
         1 003623   000007 236100                    LDQ     7,,PR0
         1 003624   200011 756100                    STQ     CG$,,AUTO

     1350    10792    1         CALL GETQUEUE;

  10792  1 003625   005125 701000 1                  TSX1    GETQUEUE
         1 003626   000000 011000                    NOP     0

     1351    10793    1         RETURN;

  10793  1 003627   000000 702200 xent               TSX2  ! X66_ARET

     1352    10794        /**/
     1353    10795        /*F* NAME:         KQR$GETRBLK
     1354    10796             PURPOSE:      To acquire an RBLK for a station
     1355    10797             CALL:         KQR$GETRBLK (KQ$STA);
     1356    10798             INPUT:        Nothing locked
     1357    10799             DESCRIPTION:  ALTRETs if none, else returns with an RBLK
     1358    10800                           in KQ$STA.RBLK$
     1359    10801        */
     1360    10802    1   KQR$GETRBLK: ENTRY (N$RREQ) ALTRET;

  10802  1 003630   000000 700200 xent  KQR$GETRBLK  TSX0  ! X66_AUTO_1
         1 003631   000064 000001                    ZERO    52,1

     1361    10803        /**/
     1362    10804    1         STA$=ADDR(N$RREQ);

  10804  1 003632   200003 236100                    LDQ     @N$RREQ,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:200  
         1 003633   200006 756100                    STQ     STA$,,AUTO

     1363    10805    1         CG$=STA$->KQ$STA.CG$;

  10805  1 003634   200006 470500                    LDP0    STA$,,AUTO
         1 003635   000007 236100                    LDQ     7,,PR0
         1 003636   200011 756100                    STQ     CG$,,AUTO

     1364    10806              %LOCK (G=STA$->KQ$STA.GATE);

  10807  1 003637   200006 236100                    LDQ     STA$,,AUTO
         1 003640   000016 036003                    ADLQ    14,DU
         1 003641   200054 756100                    STQ     R$+1,,AUTO
         1 003642   200054 630500                    EPPR0   R$+1,,AUTO
         1 003643   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003644   000000 701000 xent               TSX1    HFC$LOCK
         1 003645   000000 011000                    NOP     0

     1365    10809    1         CALL GETRBLK ALTRET(ALTRT);

  10809  1 003646   005220 701000 1                  TSX1    GETRBLK
         1 003647   003457 702000 1                  TSX2    ALTRT

     1366    10810              %UNLOCK (G=STA$->KQ$STA.GATE);

  10811  1 003650   200006 236100                    LDQ     STA$,,AUTO
         1 003651   000016 036003                    ADLQ    14,DU
         1 003652   200054 756100                    STQ     R$+1,,AUTO
         1 003653   200054 630500                    EPPR0   R$+1,,AUTO
         1 003654   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003655   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003656   000000 011000                    NOP     0

     1367    10813    1         RETURN;

  10813  1 003657   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:201  
     1368    10814        /**/
     1369    10815        /*F* NAME:         KQR$LOGERR
     1370    10816             PURPOSE:      To log an error encountered while reading a
     1371    10817                           message's DBLK for a TERM
     1372    10818             CALL:         KQR$LOGERR (KQ$STA)
     1373    10819             DESCRIPTION:  The station's RBLK and MBLK are logged.
     1374    10820        */
     1375    10821    1   KQR$LOGERR: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */

  10821  1 003660   000000 700200 xent  KQR$LOGERR   TSX0  ! X66_AUTO_1
         1 003661   000064 000001                    ZERO    52,1

     1376    10822        /**/
     1377    10823    1         STA$=ADDR(N$RREQ);

  10823  1 003662   200003 236100                    LDQ     @N$RREQ,,AUTO
         1 003663   200006 756100                    STQ     STA$,,AUTO

     1378    10824    1         CG$=STA$->KQ$STA.CG$;

  10824  1 003664   200006 470500                    LDP0    STA$,,AUTO
         1 003665   000007 236100                    LDQ     7,,PR0
         1 003666   200011 756100                    STQ     CG$,,AUTO

     1379    10825    1         CALL LOGERR (1);

  10825  1 003667   000030 236000 2                  LDQ     24
         1 003670   200047 756100                    STQ     TIMCHK+3,,AUTO
         1 003671   005032 701000 1                  TSX1    LOGERR
         1 003672   000000 011000                    NOP     0

     1380    10826    1         RETURN;

  10826  1 003673   000000 702200 xent               TSX2  ! X66_ARET

     1381    10827        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:202  
     1382    10828        /**/
     1383    10829        /*F* NAME:         KQR$CLEANUP
     1384    10830             PURPOSE:      To clean up a DCB station during close
     1385    10831             CALL:         KQR$CLEANUP (KQ$STA)
     1386    10832             DESCRIPTION:  Called with the station deactivated.  Aborts the
     1387    10833                           current write if any via KQU$DELETE.  Aborts the
     1388    10834                           current read if any.  Disposes of the current
     1389    10835                           latched read if any via UNLATCH DELETE.
     1390    10836                           Disposes of a completed (unlatched)
     1391    10837                           read by dumping the RBLK and its MBLK (if any).
     1392    10838
     1393    10839                           Sets DSID to infinity.
     1394    10840                           Does special processing of AU-event messages
     1395    10841                           in the station's queue if this is the AU.
     1396    10842
     1397    10843                           If this is the AU, events that need to be saved
     1398    10844                           are sent to the '*GORGO' station.
     1399    10845                           Called only for DCBs, and on user behalf.
     1400    10846                           Nothing is locked upon entry.
     1401    10847                           ALTRETs if comgroup is full.
     1402    10848        */
     1403    10849    1   KQR$CLEANUP: ENTRY (N$RREQ) ALTRET;

  10849  1 003674   000000 700200 xent  KQR$CLEANUP  TSX0  ! X66_AUTO_1
         1 003675   000064 000001                    ZERO    52,1

     1404    10850        /**/
     1405    10851    1         BADCLS=0;

  10851  1 003676   200041 450100                    STZ     QKNFND,,AUTO

     1406    10852    1         GOTO CLEANUP;

  10852  1 003677   003704 710000 1                  TRA     CLEANUP

     1407    10853        /**/
     1408    10854        /*F* NAME:         KQR$CLEANUPB
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:203  
     1409    10855             PURPOSE:      To clean up a station's read during a 'bad'
     1410    10856                           close
     1411    10857             DESCRIPTION:  Just like KQR$CLEANUP, but latched inputs are
     1412    10858                           RERUN, not deleted.
     1413    10859        */
     1414    10860    1   KQR$CLEANUPB: ENTRY (N$RREQ) ALTRET; /* !!Doesn't ALTRET!! */

  10860  1 003700   000000 700200 xent  KQR$CLEANUPB TSX0  ! X66_AUTO_1
         1 003701   000064 000001                    ZERO    52,1

     1415    10861        /**/
     1416    10862    1         BADCLS=1;

  10862  1 003702   000001 235007                    LDA     1,DL
         1 003703   200041 755100                    STA     QKNFND,,AUTO

  10862  1 003704                       CLEANUP      null
     1417    10863    1   CLEANUP:;
     1418    10864    1         STA$=ADDR(N$RREQ);

  10864  1 003704   200003 236100                    LDQ     @N$RREQ,,AUTO
         1 003705   200006 756100                    STQ     STA$,,AUTO

     1419    10865    1         LDCT$=STA$->KQ$STA.LDCT$;

  10865  1 003706   200006 470500                    LDP0    STA$,,AUTO
         1 003707   000010 236100                    LDQ     8,,PR0
         1 003710   200005 756100                    STQ     LDCT$,,AUTO

     1420    10866    1         CG$=STA$->KQ$STA.CG$;

  10866  1 003711   000007 236100                    LDQ     7,,PR0
         1 003712   200011 756100                    STQ     CG$,,AUTO

  10866  1 003713                       CL0          null
     1421    10867    1   CL0:  ;
     1422    10868    1         CALL KQT$LBT (CG$->KQ$CG);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:204  

  10868  1 003713   200011 630500                    EPPR0   CG$,,AUTO
         1 003714   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003715   000000 701000 xent               TSX1    KQT$LBT
         1 003716   000000 011000                    NOP     0

     1423    10869              %LOCK (G=STA$->KQ$STA.GATE);

  10870  1 003717   200006 236100                    LDQ     STA$,,AUTO
         1 003720   000016 036003                    ADLQ    14,DU
         1 003721   200054 756100                    STQ     R$+1,,AUTO
         1 003722   200054 630500                    EPPR0   R$+1,,AUTO
         1 003723   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003724   000000 701000 xent               TSX1    HFC$LOCK
         1 003725   000000 011000                    NOP     0

     1424    10872    1         RBLK$=STA$->KQ$STA.RBLK$;

  10872  1 003726   200006 470500                    LDP0    STA$,,AUTO
         1 003727   000011 236100                    LDQ     9,,PR0
         1 003730   200007 756100                    STQ     RBLK$,,AUTO

     1425    10873    1         IOQ$=LDCT$->NK$LDCT.IOQ$;

  10873  1 003731   200005 471500                    LDP1    LDCT$,,AUTO
         1 003732   100001 236100                    LDQ     1,,PR1
         1 003733   200004 756100                    STQ     IOQ$,,AUTO

     1426    10874    1         IF RBLK$ ~= ADDR(NIL) THEN

  10874  1 003734   200007 236100                    LDQ     RBLK$,,AUTO
         1 003735   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003736   004212 600000 1                  TZE     s:10940

     1427    10875    2           DO CASE (RBLK$->KQ$RBLK.STATE);

  10875  1 003737   200007 473500                    LDP3    RBLK$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:205  
         1 003740   300001 220100                    LDX0    1,,PR3
         1 003741   000010 100003                    CMPX0   8,DU
         1 003742   003744 602010 1                  TNC     s:10875+5,X0
         1 003743   004014 710000 1                  TRA     s:10892
         1 003744   004014 710000 1                  TRA     s:10892
         1 003745   004041 710000 1                  TRA     s:10900
         1 003746   003754 710000 1                  TRA     s:10878
         1 003747   004014 710000 1                  TRA     s:10892
         1 003750   004014 710000 1                  TRA     s:10892
         1 003751   004014 710000 1                  TRA     s:10892
         1 003752   004014 710000 1                  TRA     s:10892
         1 003753   004165 710000 1                  TRA     s:10932

     1428    10876
     1429    10877    2             CASE (KQRS_PEND#);

     1430    10878    2               CALL CHKACT;

  10878  1 003754   006545 701000 1                  TSX1    CHKACT
         1 003755   000000 011000                    NOP     0

     1431    10879    2               RBLK$->KQ$RBLK.STATE=KQRS_RSIP#;

  10879  1 003756   000000 220003                    LDX0    0,DU
         1 003757   200007 470500                    LDP0    RBLK$,,AUTO
         1 003760   000001 740100                    STX0    1,,PR0

     1432    10880                    %UNLOCK (G=STA$->KQ$STA.GATE);

  10881  1 003761   200006 236100                    LDQ     STA$,,AUTO
         1 003762   000016 036003                    ADLQ    14,DU
         1 003763   200054 756100                    STQ     R$+1,,AUTO
         1 003764   200054 630500                    EPPR0   R$+1,,AUTO
         1 003765   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003766   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003767   000000 011000                    NOP     0

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:206  
     1433    10883    2               CALL KQT$UBT (CG$->KQ$CG);

  10883  1 003770   200011 630500                    EPPR0   CG$,,AUTO
         1 003771   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003772   000000 701000 xent               TSX1    KQT$UBT
         1 003773   000000 011000                    NOP     0

     1434    10884    2               CALL DEQUEUE;

  10884  1 003774   005324 701000 1                  TSX1    DEQUEUE
         1 003775   000000 011000                    NOP     0

     1435    10885    2               CALL KQQ$DQEOFTIME(CG$->KQ$CG,RBLK$);

  10885  1 003776   200007 630500                    EPPR0   RBLK$,,AUTO
         1 003777   200055 450500                    STP0    R$+2,,AUTO
         1 004000   200011 236100                    LDQ     CG$,,AUTO
         1 004001   200054 756100                    STQ     R$+1,,AUTO
         1 004002   200054 630500                    EPPR0   R$+1,,AUTO
         1 004003   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004004   000000 701000 xent               TSX1    KQQ$DQEOFTIME
         1 004005   000000 011000                    NOP     0

     1436    10886    2               LDCT$->NK$LDCT.IOQ$=ADDR(NIL);

  10886  1 004006   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004007   200005 470500                    LDP0    LDCT$,,AUTO
         1 004010   000001 756100                    STQ     1,,PR0

     1437    10887    2               CALL COMPBAD;

  10887  1 004011   003154 701000 1                  TSX1    COMPBAD
         1 004012   000000 011000                    NOP     0

     1438    10888    2               GOTO CL10;

  10888  1 004013   004157 710000 1                  TRA     CL10
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:207  

     1439    10889
     1440    10890    2             CASE (ELSE);

     1441    10891                    %UNLOCK (G=STA$->KQ$STA.GATE);

  10892  1 004014   200006 236100                    LDQ     STA$,,AUTO
         1 004015   000016 036003                    ADLQ    14,DU
         1 004016   200054 756100                    STQ     R$+1,,AUTO
         1 004017   200054 630500                    EPPR0   R$+1,,AUTO
         1 004020   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004021   000000 701000 xent               TSX1    HFC$UNLOCK
         1 004022   000000 011000                    NOP     0

     1442    10894    2               CALL KQT$UBT (CG$->KQ$CG);

  10894  1 004023   200011 630500                    EPPR0   CG$,,AUTO
         1 004024   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004025   000000 701000 xent               TSX1    KQT$UBT
         1 004026   000000 011000                    NOP     0

     1443    10895    2               CALL SSR$REG (%SS_SL,,1);

  10895  1 004027   000030 236000 2                  LDQ     24
         1 004030   200056 756100                    STQ     R$+3,,AUTO
         1 004031   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004032   000032 235000 2                  LDA     26
         1 004033   200054 757100                    STAQ    R$+1,,AUTO
         1 004034   200054 630500                    EPPR0   R$+1,,AUTO
         1 004035   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004036   000000 701000 xent               TSX1    SSR$REG
         1 004037   000000 011000                    NOP     0

     1444    10896    2               GOTO CL0;

  10896  1 004040   003713 710000 1                  TRA     CL0

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:208  
     1445    10897
     1446    10898    2             CASE (KQRS_COMP#);

     1447    10899                    %UNLOCK (G=STA$->KQ$STA.GATE);

  10900  1 004041   200006 236100                    LDQ     STA$,,AUTO
         1 004042   000016 036003                    ADLQ    14,DU
         1 004043   200054 756100                    STQ     R$+1,,AUTO
         1 004044   200054 630500                    EPPR0   R$+1,,AUTO
         1 004045   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004046   000000 701000 xent               TSX1    HFC$UNLOCK
         1 004047   000000 011000                    NOP     0

     1448    10902    2               CALL KQT$UBT (CG$->KQ$CG);

  10902  1 004050   200011 630500                    EPPR0   CG$,,AUTO
         1 004051   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004052   000000 701000 xent               TSX1    KQT$UBT
         1 004053   000000 011000                    NOP     0

     1449    10903    2               IF RBLK$->KQ$RBLK.LATCH THEN

  10903  1 004054   200007 470500                    LDP0    RBLK$,,AUTO
         1 004055   000001 236100                    LDQ     1,,PR0
         1 004056   400000 316007                    CANQ    -131072,DL
         1 004057   004150 600000 1                  TZE     s:10924

     1450    10904    3                 DO;

     1451    10905    3                 IF BADCLS = 1 THEN

  10905  1 004060   200041 235100                    LDA     QKNFND,,AUTO
         1 004061   000001 115007                    CMPA    1,DL
         1 004062   004120 601000 1                  TNZ     CL5

     1452    10906    3                  IF (CG$->KQ$CG.HOLDSTA$ = ADDR(NIL))

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:209  
  10906  1 004063   200011 471500                    LDP1    CG$,,AUTO
         1 004064   100124 236100                    LDQ     84,,PR1
         1 004065   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004066   004101 601000 1                  TNZ     s:10910

     1453    10907    3                  THEN
     1454    10908    3                   CALL KQU$UNLATCH (STA$->KQ$STA,RUFPT.V,I) ALTRET(UNLALT);

  10908  1 004067   200032 633500                    EPPR3   I,,AUTO
         1 004070   200056 453500                    STP3    R$+3,,AUTO
         1 004071   000033 236000 2                  LDQ     27
         1 004072   200006 235100                    LDA     STA$,,AUTO
         1 004073   200054 757100                    STAQ    R$+1,,AUTO
         1 004074   200054 630500                    EPPR0   R$+1,,AUTO
         1 004075   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004076   000000 701000 xent               TSX1    KQU$UNLATCH
         1 004077   004113 702000 1                  TSX2    UNLALT
         1 004100   004225 710000 1                  TRA     CL20

     1455    10909    3                  ELSE
     1456    10910    3                   CALL KQU$UNLATCH (STA$->KQ$STA,HUFPT.V,I)

  10910  1 004101   200032 633500                    EPPR3   I,,AUTO
         1 004102   200056 453500                    STP3    R$+3,,AUTO
         1 004103   000034 236000 2                  LDQ     28
         1 004104   200006 235100                    LDA     STA$,,AUTO
         1 004105   200054 757100                    STAQ    R$+1,,AUTO
         1 004106   200054 630500                    EPPR0   R$+1,,AUTO
         1 004107   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004110   000000 701000 xent               TSX1    KQU$UNLATCH
         1 004111   004113 702000 1                  TSX2    UNLALT
         1 004112   004117 710000 1                  TRA     s:10914

     1457    10911    4                   WHENALTRETURN DO;

     1458    10912    4   UNLALT:           IF I_ERR.CODE=%E$CULRAUEVR THEN
             10912            /* LATCHED READ IS A *AUEV MSG - CAN'T RERUN */
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:210  

  10912  1 004113   200032 236100       UNLALT       LDQ     I,,AUTO
         1 004114   777770 376007                    ANQ     -8,DL
         1 004115   022500 116007                    CMPQ    9536,DL
         1 004116   004120 600000 1                  TZE     CL5

     1459    10913    4                      GOTO CL5;
     1460    10914    4                     END;

  10914  1 004117   004225 710000 1                  TRA     CL20

     1461    10915    3                 ELSE
     1462    10916    3   CL5:           CALL KQU$UNLATCH (STA$->KQ$STA,DUFPT.V,I)

  10916  1 004120   200032 630500       CL5          EPPR0   I,,AUTO
         1 004121   200056 450500                    STP0    R$+3,,AUTO
         1 004122   000010 236000 2                  LDQ     8
         1 004123   200006 235100                    LDA     STA$,,AUTO
         1 004124   200054 757100                    STAQ    R$+1,,AUTO
         1 004125   200054 630500                    EPPR0   R$+1,,AUTO
         1 004126   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004127   000000 701000 xent               TSX1    KQU$UNLATCH
         1 004130   004132 702000 1                  TSX2    s:10918
         1 004131   004147 710000 1                  TRA     s:10921

     1463    10917    4                  WHENALTRETURN DO;

     1464    10918    4                    IF I_ERR.CODE=%E$CULUSR THEN
             10918                             /* LATCHED READ NOT SUCCESSFUL - CAN'T DELETE */

  10918  1 004132   200032 236100                    LDQ     I,,AUTO
         1 004133   777770 376007                    ANQ     -8,DL
         1 004134   021650 116007                    CMPQ    9128,DL
         1 004135   004147 601000 1                  TNZ     s:10921

     1465    10919    4                     CALL KQU$UNLATCH (STA$->KQ$STA,RUFPT.V,I);

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:211  
  10919  1 004136   200032 630500                    EPPR0   I,,AUTO
         1 004137   200056 450500                    STP0    R$+3,,AUTO
         1 004140   000033 236000 2                  LDQ     27
         1 004141   200006 235100                    LDA     STA$,,AUTO
         1 004142   200054 757100                    STAQ    R$+1,,AUTO
         1 004143   200054 630500                    EPPR0   R$+1,,AUTO
         1 004144   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004145   000000 701000 xent               TSX1    KQU$UNLATCH
         1 004146   000000 011000                    NOP     0

     1466    10920    4                    END;

     1467    10921    3                 END;

  10921  1 004147   004225 710000 1                  TRA     CL20

     1468    10922    2               ELSE
     1469    10923    3                 DO INHIBIT;

     1470    10924    3                 IF RBLK$->KQ$RBLK.MBLK$ ~= ADDR(NIL) THEN

  10924  1 004150   000000 236300                    LDQ   ! 0,,PR0
         1 004151   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 004152   004157 600200 1                  TZE   ! CL10

     1471    10925    3                  CALL KQU$DELREAD (STA$->KQ$STA);

  10925  1 004153   200006 630700                    EPPR0 ! STA$,,AUTO
         1 004154   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 004155   000000 701200 xent               TSX1  ! KQU$DELREAD
         1 004156   000000 011200                    NOP   ! 0

     1472    10926    3   CL10:         STA$->KQ$STA.RBLK$=ADDR(NIL);

  10926  1 004157   000001 236200 xsym  CL10         LDQ   ! B_VECTNIL+1
         1 004160   200006 470700                    LDP0  ! STA$,,AUTO
         1 004161   000011 756300                    STQ   ! 9,,PR0
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:212  

     1473    10927    3                 CALL DUMPRBLK;

  10927  1 004162   005307 701200 1                  TSX1  ! DUMPRBLK
         1 004163   000000 011200                    NOP   ! 0

     1474    10928    3                 END;

  10928  1 004164   004225 710000 1                  TRA     CL20

     1475    10929
     1476    10930    2             CASE (KQRS_UNLA#);

     1477    10931                    %UNLOCK (G=STA$->KQ$STA.GATE);

  10932  1 004165   200006 236100                    LDQ     STA$,,AUTO
         1 004166   000016 036003                    ADLQ    14,DU
         1 004167   200054 756100                    STQ     R$+1,,AUTO
         1 004170   200054 630500                    EPPR0   R$+1,,AUTO
         1 004171   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004172   000000 701000 xent               TSX1    HFC$UNLOCK
         1 004173   000000 011000                    NOP     0

     1478    10934    2               CALL KQT$UBT (CG$->KQ$CG);

  10934  1 004174   200011 630500                    EPPR0   CG$,,AUTO
         1 004175   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004176   000000 701000 xent               TSX1    KQT$UBT
         1 004177   000000 011000                    NOP     0

     1479    10935    2               CALL KQU$UNLATCH (STA$->KQ$STA,DUFPT.V,I);

  10935  1 004200   200032 630500                    EPPR0   I,,AUTO
         1 004201   200056 450500                    STP0    R$+3,,AUTO
         1 004202   000010 236000 2                  LDQ     8
         1 004203   200006 235100                    LDA     STA$,,AUTO
         1 004204   200054 757100                    STAQ    R$+1,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:213  
         1 004205   200054 630500                    EPPR0   R$+1,,AUTO
         1 004206   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004207   000000 701000 xent               TSX1    KQU$UNLATCH
         1 004210   000000 011000                    NOP     0

     1480    10936    2           END;

  10936  1 004211   004225 710000 1                  TRA     CL20

     1481    10937    1         ELSE
     1482    10938    2           DO;

     1483    10939                %UNLOCK (G=STA$->KQ$STA.GATE);

  10940  1 004212   200006 236100                    LDQ     STA$,,AUTO
         1 004213   000016 036003                    ADLQ    14,DU
         1 004214   200054 756100                    STQ     R$+1,,AUTO
         1 004215   200054 630500                    EPPR0   R$+1,,AUTO
         1 004216   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004217   000000 701000 xent               TSX1    HFC$UNLOCK
         1 004220   000000 011000                    NOP     0

     1484    10942    2           CALL KQT$UBT (CG$->KQ$CG);

  10942  1 004221   200011 630500                    EPPR0   CG$,,AUTO
         1 004222   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004223   000000 701000 xent               TSX1    KQT$UBT
         1 004224   000000 011000                    NOP     0

     1485    10943    2           END;

  10942  1 004225                       CL20         null
     1486    10944    1   CL20: ;
     1487    10945                          /*    Delete any unfinished
     1488    10946                           *    writes
     1489    10947                           */
     1490    10948    1         IF STA$->KQ$STA.MBLK$ ~= ADDR(NIL) THEN
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:214  

  10948  1 004225   200006 470500                    LDP0    STA$,,AUTO
         1 004226   000012 236100                    LDQ     10,,PR0
         1 004227   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004230   004254 600000 1                  TZE     CLSTARS

     1491    10949    2           DO;

     1492    10950    2           MBLK$=STA$->KQ$STA.MBLK$;

  10950  1 004231   200010 756100                    STQ     MBLK$,,AUTO

     1493    10951    2           STA$->KQ$STA.MBLK$=ADDR(NIL);

  10951  1 004232   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004233   000012 756100                    STQ     10,,PR0

     1494    10952    3             DO WHILE (MBLK$ ~= ADDR(NIL));

  10952  1 004234   004251 710000 1                  TRA     s:10956

     1495    10953    3             P$=MBLK$->KQ$MBLK.LNK$;

  10953  1 004235   200010 470500                    LDP0    MBLK$,,AUTO
         1 004236   000000 236100                    LDQ     0,,PR0
         1 004237   200027 756100                    STQ     P$,,AUTO

     1496    10954    3             CALL KQU$DELMSG (CG$->KQ$CG,MBLK$->KQ$MBLK);

  10954  1 004240   200010 236100                    LDQ     MBLK$,,AUTO
         1 004241   200011 235100                    LDA     CG$,,AUTO
         1 004242   200054 757100                    STAQ    R$+1,,AUTO
         1 004243   200054 630500                    EPPR0   R$+1,,AUTO
         1 004244   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004245   000000 701000 xent               TSX1    KQU$DELMSG
         1 004246   000000 011000                    NOP     0

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:215  
     1497    10955    3             MBLK$=P$;

  10955  1 004247   200027 236100                    LDQ     P$,,AUTO
         1 004250   200010 756100                    STQ     MBLK$,,AUTO

     1498    10956    3             END;

  10956  1 004251   200010 236100                    LDQ     MBLK$,,AUTO
         1 004252   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004253   004235 601000 1                  TNZ     s:10953

     1499    10957    2           END;

  10954  1 004254                       CLSTARS      null
     1500    10958    1   CLSTARS:;
     1501    10959    1         IF  STA$ ~= CG$->KQ$CG.JRNLSTA$

  10959  1 004254   200011 470500                    LDP0    CG$,,AUTO
         1 004255   200006 236100                    LDQ     STA$,,AUTO
         1 004256   000210 116100                    CMPQ    136,,PR0
         1 004257   004572 600000 1                  TZE     s:11046
         1 004260   000207 116100                    CMPQ    135,,PR0
         1 004261   004572 600000 1                  TZE     s:11046

     1502    10960    1         AND STA$ ~= CG$->KQ$CG.GORGOSTA$ THEN
     1503    10961    2           DO;

     1504    10962    2           CALL KQX$SETTIME (TIMCHK);

  10962  1 004262   200044 631500                    EPPR1   TIMCHK,,AUTO
         1 004263   200054 451500                    STP1    R$+1,,AUTO
         1 004264   200054 630500                    EPPR0   R$+1,,AUTO
         1 004265   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004266   000000 701000 xent               TSX1    KQX$SETTIME
         1 004267   000000 011000                    NOP     0

     1505    10963    2           IF STA$->KQ$STA.BTN.KEY = '*FWCG' THEN GOTO CLS25;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:216  

  10963  1 004270   200006 470500                    LDP0    STA$,,AUTO
         1 004271   040000 106500                    CMPC    fill='040'O
         1 004272   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 004273   000053 000005 0                  ADSC9   ERR_NODAT+13             cn=0,n=5
         1 004274   004302 600000 1                  TZE     CLS25

     1506    10964    2           STA$->KQ$STA.DSID=BITBIN('777777777777'O);

  10964  1 004275   000027 235000 xsym               LDA     B_VECTNIL+23
         1 004276   000022 755100                    STA     18,,PR0

     1507    10965    2           IF STA$->KQ$STA.AU THEN

  10965  1 004277   000020 236100                    LDQ     16,,PR0
         1 004300   200000 316003                    CANQ    65536,DU
         1 004301   004572 600000 1                  TZE     s:11046

     1508    10966    3   CLS25:    DO;

  10966  1 004302                       CLS25        null
     1509    10967                  %LOCK (G=STA$->KQ$STA.GATE);

  10968  1 004302   200006 236100                    LDQ     STA$,,AUTO
         1 004303   000016 036003                    ADLQ    14,DU
         1 004304   200054 756100                    STQ     R$+1,,AUTO
         1 004305   200054 630500                    EPPR0   R$+1,,AUTO
         1 004306   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004307   000000 701000 xent               TSX1    HFC$LOCK
         1 004310   000000 011000                    NOP     0

     1510    10970    3             CALL GETRBLK ALTRET(ALTRT);

  10970  1 004311   005220 701000 1                  TSX1    GETRBLK
         1 004312   003457 702000 1                  TSX2    ALTRT

     1511    10971                  %UNLOCK (G=STA$->KQ$STA.GATE);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:217  

  10972  1 004313   200006 236100                    LDQ     STA$,,AUTO
         1 004314   000016 036003                    ADLQ    14,DU
         1 004315   200054 756100                    STQ     R$+1,,AUTO
         1 004316   200054 630500                    EPPR0   R$+1,,AUTO
         1 004317   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004320   000000 701000 xent               TSX1    HFC$UNLOCK
         1 004321   000000 011000                    NOP     0

     1512    10974    3             IF STA$->KQ$STA.BTN.KEY = '*FWCG' THEN

  10974  1 004322   200006 470500                    LDP0    STA$,,AUTO
         1 004323   040000 106500                    CMPC    fill='040'O
         1 004324   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 004325   000053 000005 0                  ADSC9   ERR_NODAT+13             cn=0,n=5
         1 004326   004336 601000 1                  TNZ     s:10981

     1513    10975    4               DO;

     1514    10976    4               RBLK$->KQ$RBLK.KEY1L=0;

  10976  1 004327   200007 471500                    LDP1    RBLK$,,AUTO
         1 004330   000035 236000 2                  LDQ     29
         1 004331   100001 356100                    ANSQ    1,,PR1

     1515    10977    4               RBLK$->KQ$RBLK.KEY2L=0;

  10977  1 004332   200007 471500                    LDP1    RBLK$,,AUTO
         1 004333   000036 236000 2                  LDQ     30
         1 004334   100001 356100                    ANSQ    1,,PR1

     1516    10978    4               END;

  10978  1 004335   004372 710000 1                  TRA     CLS10

     1517    10979    3             ELSE
     1518    10980    4               DO;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:218  

     1519    10981    4               IF CG$->KQ$CG.QISS THEN

  10981  1 004336   200011 471500                    LDP1    CG$,,AUTO
         1 004337   100106 235100                    LDA     70,,PR1
         1 004340   004356 600000 1                  TZE     s:10989

     1520    10982    5                 DO;

     1521    10983    5                 RBLK$->KQ$RBLK.KEY1L=0;

  10983  1 004341   200007 473500                    LDP3    RBLK$,,AUTO
         1 004342   000035 236000 2                  LDQ     29
         1 004343   300001 356100                    ANSQ    1,,PR3

     1522    10984    5                 RBLK$->KQ$RBLK.KEY2L=1;

  10984  1 004344   200007 473500                    LDP3    RBLK$,,AUTO
         1 004345   300001 236100                    LDQ     1,,PR3
         1 004346   000036 376000 2                  ANQ     30
         1 004347   000001 276007                    ORQ     1,DL
         1 004350   300001 756100                    STQ     1,,PR3

     1523    10985    5                 RBLK$->KQ$RBLK.KEY2='*';

  10985  1 004351   000037 235000 2                  LDA     31
         1 004352   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 004353   200007 473500                    LDP3    RBLK$,,AUTO
         1 004354   300004 757100                    STAQ    4,,PR3

     1524    10986    5                 END;

  10986  1 004355   004372 710000 1                  TRA     CLS10

     1525    10987    4               ELSE
     1526    10988    5                 DO;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:219  
     1527    10989    5                 RBLK$->KQ$RBLK.KEY1L=1;

  10989  1 004356   200007 473500                    LDP3    RBLK$,,AUTO
         1 004357   300001 236100                    LDQ     1,,PR3
         1 004360   000035 376000 2                  ANQ     29
         1 004361   000020 276007                    ORQ     16,DL
         1 004362   300001 756100                    STQ     1,,PR3

     1528    10990    5                 RBLK$->KQ$RBLK.KEY1='*';

  10990  1 004363   000037 235000 2                  LDA     31
         1 004364   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 004365   200007 473500                    LDP3    RBLK$,,AUTO
         1 004366   300002 757100                    STAQ    2,,PR3

     1529    10991    5                 RBLK$->KQ$RBLK.KEY2L=0;

  10991  1 004367   200007 473500                    LDP3    RBLK$,,AUTO
         1 004370   000036 236000 2                  LDQ     30
         1 004371   300001 356100                    ANSQ    1,,PR3

     1530    10992    5                 END;

     1531    10993    4               END;

  10984  1 004372                       CLS10        null
     1532    10994    3   CLS10:    ;
     1533    10995    3             CALL KQX$CHKTIME (TIMCHK) ALTRET(CLS15);

  10995  1 004372   200044 630500                    EPPR0   TIMCHK,,AUTO
         1 004373   200054 450500                    STP0    R$+1,,AUTO
         1 004374   200054 630500                    EPPR0   R$+1,,AUTO
         1 004375   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004376   000000 701000 xent               TSX1    KQX$CHKTIME
         1 004377   004412 702000 1                  TSX2    CLS15

     1534    10996    3             CALL SSR$REG (%SS_QE);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:220  

  10996  1 004400   000016 630400 2                  EPPR0   14
         1 004401   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004402   000000 701000 xent               TSX1    SSR$REG
         1 004403   000000 011000                    NOP     0

     1535    10997    3             CALL KQX$SETTIME (TIMCHK);

  10997  1 004404   200044 630500                    EPPR0   TIMCHK,,AUTO
         1 004405   200054 450500                    STP0    R$+1,,AUTO
         1 004406   200054 630500                    EPPR0   R$+1,,AUTO
         1 004407   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004410   000000 701000 xent               TSX1    KQX$SETTIME
         1 004411   000000 011000                    NOP     0

  10995  1 004412                       CLS15        null
     1536    10998    3   CLS15:    ;
     1537    10999                  %LOCK (G=STA$->KQ$STA.GATE);

  11000  1 004412   200006 236100                    LDQ     STA$,,AUTO
         1 004413   000016 036003                    ADLQ    14,DU
         1 004414   200054 756100                    STQ     R$+1,,AUTO
         1 004415   200054 630500                    EPPR0   R$+1,,AUTO
         1 004416   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004417   000000 701000 xent               TSX1    HFC$LOCK
         1 004420   000000 011000                    NOP     0

     1538    11002    3             RBLK$->KQ$RBLK.STATE=KQRS_RSIP#;

  11002  1 004421   000000 220003                    LDX0    0,DU
         1 004422   200007 470500                    LDP0    RBLK$,,AUTO
         1 004423   000001 740100                    STX0    1,,PR0

     1539    11003    3             CALL KQL$DDFIND (STA$->KQ$STA,MBLK$) ALTRET(CLS20);

  11003  1 004424   200010 630500                    EPPR0   MBLK$,,AUTO
         1 004425   200055 450500                    STP0    R$+2,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:221  
         1 004426   200006 236100                    LDQ     STA$,,AUTO
         1 004427   200054 756100                    STQ     R$+1,,AUTO
         1 004430   200054 630500                    EPPR0   R$+1,,AUTO
         1 004431   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004432   000000 701000 xent               TSX1    KQL$DDFIND
         1 004433   004457 702000 1                  TSX2    CLS20

     1540    11004    3             CALL KQL$DDFDUN (STA$->KQ$STA);

  11004  1 004434   200006 630500                    EPPR0   STA$,,AUTO
         1 004435   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004436   000000 701000 xent               TSX1    KQL$DDFDUN
         1 004437   000000 011000                    NOP     0

     1541    11005    3             STA$->KQ$STA.RBLK$=ADDR(NIL);

  11005  1 004440   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004441   200006 470500                    LDP0    STA$,,AUTO
         1 004442   000011 756100                    STQ     9,,PR0

     1542    11006    3             I=RBLK$->KQ$RBLK.ERR;

  11006  1 004443   200007 471500                    LDP1    RBLK$,,AUTO
         1 004444   100001 236100                    LDQ     1,,PR1
         1 004445   000011 772000                    QRL     9
         1 004446   000007 376007                    ANQ     7,DL
         1 004447   200032 756100                    STQ     I,,AUTO

     1543    11007    3             CALL DUMPRBLK;

  11007  1 004450   005307 701000 1                  TSX1    DUMPRBLK
         1 004451   000000 011000                    NOP     0

     1544    11008    3             IF I = KQGE_QFUL# THEN ALTRETURN;

  11008  1 004452   200032 235100                    LDA     I,,AUTO
         1 004453   000001 115007                    CMPA    1,DL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:222  
         1 004454   004456 601000 1                  TNZ     s:11009

  11008  1 004455   000000 702200 xent               TSX2  ! X66_AALT

     1545    11009    3             RETURN;

  11009  1 004456   000000 702200 xent               TSX2  ! X66_ARET

  11008  1 004457                       CLS20        null
     1546    11010    3   CLS20:    ;
     1547    11011    3             RBLK$->KQ$RBLK.STATE=KQRS_COMP#;

  11011  1 004457   000001 220003                    LDX0    1,DU
         1 004460   200007 470500                    LDP0    RBLK$,,AUTO
         1 004461   000001 740100                    STX0    1,,PR0

     1548    11012    3             MBLK$=RBLK$->KQ$RBLK.MBLK$;

  11012  1 004462   200007 470500                    LDP0    RBLK$,,AUTO
         1 004463   000000 236100                    LDQ     0,,PR0
         1 004464   200010 756100                    STQ     MBLK$,,AUTO

     1549    11013    3             IF STA$->KQ$STA.BTN.KEY = '*FWCG' THEN GOTO CLS24;

  11013  1 004465   200006 471500                    LDP1    STA$,,AUTO
         1 004466   040000 106500                    CMPC    fill='040'O
         1 004467   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 004470   000053 000005 0                  ADSC9   ERR_NODAT+13             cn=0,n=5
         1 004471   004551 600000 1                  TZE     CLS24

     1550    11014    3             IF MBLK$->KQ$MBLK.PRIO >= %KQ_AUEP# THEN

  11014  1 004472   200010 473500                    LDP3    MBLK$,,AUTO
         1 004473   300001 221100                    LDX1    1,,PR3
         1 004474   765000 101003                    CMPX1   -5632,DU
         1 004475   004565 602000 1                  TNC     s:11042

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:223  
     1551    11015    4               DO CASE (MBLK$->KQ$MBLK.FC);

  11015  1 004476   300010 236100                    LDQ     8,,PR3
         1 004477   000033 772000                    QRL     27
         1 004500   000037 376007                    ANQ     31,DL
         1 004501   000004 136007                    SBLQ    4,DL
         1 004502   000006 116007                    CMPQ    6,DL
         1 004503   004505 602006 1                  TNC     s:11015+7,QL
         1 004504   004565 710000 1                  TRA     s:11042
         1 004505   004513 710000 1                  TRA     s:11018
         1 004506   004565 710000 1                  TRA     s:11042
         1 004507   004546 710000 1                  TRA     s:11033
         1 004510   004546 710000 1                  TRA     s:11033
         1 004511   004546 710000 1                  TRA     s:11033
         1 004512   004546 710000 1                  TRA     s:11033

     1552    11016
     1553    11017    4                 CASE (%CG_TBRK#);

     1554    11018    4                   CALL GETTERM ALTRET(CLS22);

  11018  1 004513   004735 701000 1                  TSX1    GETTERM
         1 004514   004545 702000 1                  TSX2    CLS22

     1555    11019    4                   IF P$->KQ$STA.EVNT = '0'B THEN

  11019  1 004515   200027 470500                    LDP0    P$,,AUTO
         1 004516   000020 236100                    LDQ     16,,PR0
         1 004517   002000 316003                    CANQ    1024,DU
         1 004520   004527 601000 1                  TNZ     s:11025

     1556    11020    5                     DO;

     1557    11021    5                     P$->KQ$STA.EVNT='1'B;

  11021  1 004521   002000 236003                    LDQ     1024,DU
         1 004522   000020 256100                    ORSQ    16,,PR0
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:224  

     1558    11022    5                     P$->KQ$STA.EVSC=MBLK$->KQ$MBLK.MID.XT;

  11022  1 004523   200010 470500                    LDP0    MBLK$,,AUTO
         1 004524   200027 471500                    LDP1    P$,,AUTO
         1 004525   000015 235100                    LDA     13,,PR0
         1 004526   100013 755100                    STA     11,,PR1

     1559    11023    5                     END;

     1560    11024                        %UNLOCK (G=P$->KQ$STA.GATE);

  11025  1 004527   200027 236100                    LDQ     P$,,AUTO
         1 004530   000016 036003                    ADLQ    14,DU
         1 004531   200054 756100                    STQ     R$+1,,AUTO
         1 004532   200054 630500                    EPPR0   R$+1,,AUTO
         1 004533   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004534   000000 701000 xent               TSX1    HFC$UNLOCK
         1 004535   000000 011000                    NOP     0

     1561    11027                        %UNLOCK (G=KQ$STREE.GATE);

  11028  1 004536   200011 236100                    LDQ     CG$,,AUTO
         1 004537   000075 036003                    ADLQ    61,DU
         1 004540   200054 756100                    STQ     R$+1,,AUTO
         1 004541   200054 630500                    EPPR0   R$+1,,AUTO
         1 004542   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004543   000000 701000 xent               TSX1    HFC$UNLOCK
         1 004544   000000 011000                    NOP     0

  11028  1 004545   004565 710000 1     CLS22        TRA     s:11042

     1562    11030    4   CLS22:          ;
     1563    11031
     1564    11032    4                 CASE (%CG_UNLR#,%CG_UNLH#,%CG_UNLD#,%CG_WARN#);

     1565    11033    4                   MBLK$->KQ$MBLK.DSTA='*GORGO';
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:225  

  11033  1 004546   040100 100400                    MLR     fill='040'O
         1 004547   000055 000006 0                  ADSC9   ERR_NODAT+15             cn=0,n=6
         1 004550   300011 000010                    ADSC9   9,,PR3                   cn=0,n=8

     1566    11034    4   CLS24:          MBLK$->KQ$MBLK.RBLK = '0'B;

  11034  1 004551   200010 473500       CLS24        LDP3    MBLK$,,AUTO
         1 004552   000017 236000 2                  LDQ     15
         1 004553   300010 356100                    ANSQ    8,,PR3

     1567    11035    4                   RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);

  11035  1 004554   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004555   000000 756100                    STQ     0,,PR0

     1568    11036    4                   STA$->KQ$STA.MBLK$=MBLK$;

  11036  1 004556   200010 236100                    LDQ     MBLK$,,AUTO
         1 004557   100012 756100                    STQ     10,,PR1

     1569    11037    4                   CALL KQW$SENDAUP (STA$->KQ$STA);

  11037  1 004560   200006 630500                    EPPR0   STA$,,AUTO
         1 004561   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004562   000000 701000 xent               TSX1    KQW$SENDAUP
         1 004563   000000 011000                    NOP     0

     1570    11038    4                   GOTO CLS10;

  11038  1 004564   004372 710000 1                  TRA     CLS10

     1571    11039
     1572    11040    4               END;

     1573    11041
     1574    11042    3             CALL KQU$DELREAD (STA$->KQ$STA);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:226  

  11042  1 004565   200006 630500                    EPPR0   STA$,,AUTO
         1 004566   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004567   000000 701000 xent               TSX1    KQU$DELREAD
         1 004570   000000 011000                    NOP     0

     1575    11043    3             GOTO CLS10;

  11043  1 004571   004372 710000 1                  TRA     CLS10

     1576    11044    3             END;
     1577    11045    2           END;
     1578    11046    1         RETURN;

  11046  1 004572   000000 702200 xent               TSX2  ! X66_ARET

     1579    11047        /**/
     1580    11048        /*F* NAME:         KQR$RECOVER
     1581    11049             PURPOSE:      To clean up a DCB station when a crashed
     1582    11050                           comgroup is being reopened.
     1583    11051             CALL:         KQR$RECOVER (KQ$STA)
     1584    11052             DESCRIPTION:  Just like KQR$CLEANUP, but care must be excercised
     1585    11053                           ALTRETs if comgroup full.
     1586    11054        */
     1587    11055    1   KQR$RECOVER: ENTRY (N$RREQ) ALTRET;

  11055  1 004573   000000 700200 xent  KQR$RECOVER  TSX0  ! X66_AUTO_1
         1 004574   000064 000001                    ZERO    52,1

     1588    11056        /**/
     1589    11057    1         STA$=ADDR(N$RREQ);

  11057  1 004575   200003 236100                    LDQ     @N$RREQ,,AUTO
         1 004576   200006 756100                    STQ     STA$,,AUTO

     1590    11058    1         CG$=STA$->KQ$STA.CG$;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:227  
  11058  1 004577   200006 470500                    LDP0    STA$,,AUTO
         1 004600   000007 236100                    LDQ     7,,PR0
         1 004601   200011 756100                    STQ     CG$,,AUTO

     1591    11059    1         LDCT$=ADDR(NIL);

  11059  1 004602   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004603   200005 756100                    STQ     LDCT$,,AUTO

     1592    11060    1         IOQ$=ADDR(NIL);

  11060  1 004604   200004 756100                    STQ     IOQ$,,AUTO

     1593    11061    1         STA$->KQ$STA.MREQ=0;

  11061  1 004605   000000 236003                    LDQ     0,DU
         1 004606   000020 552120                    STBQ    16,'20'O,PR0

     1594    11062    1         RBLK$=STA$->KQ$STA.RBLK$;

  11062  1 004607   000011 236100                    LDQ     9,,PR0
         1 004610   200007 756100                    STQ     RBLK$,,AUTO

     1595    11063    1         IF RBLK$ ~= ADDR(NIL) THEN

  11063  1 004611   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004612   004721 600000 1                  TZE     s:11102

     1596    11064    2           DO;

     1597    11065    3             DO CASE (RBLK$->KQ$RBLK.STATE);

  11065  1 004613   200007 471500                    LDP1    RBLK$,,AUTO
         1 004614   100001 220100                    LDX0    1,,PR1
         1 004615   000012 100003                    CMPX0   10,DU
         1 004616   004620 602010 1                  TNC     s:11065+5,X0
         1 004617   004717 710000 1                  TRA     s:11100
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:228  
         1 004620   004632 710000 1                  TRA     s:11068
         1 004621   004633 710000 1                  TRA     s:11071
         1 004622   004632 710000 1                  TRA     s:11068
         1 004623   004633 710000 1                  TRA     s:11071
         1 004624   004717 710000 1                  TRA     s:11100
         1 004625   004633 710000 1                  TRA     s:11071
         1 004626   004717 710000 1                  TRA     s:11100
         1 004627   004706 710000 1                  TRA     s:11096
         1 004630   004717 710000 1                  TRA     s:11100
         1 004631   004633 710000 1                  TRA     s:11071

     1598    11066
     1599    11067    3               CASE (KQRS_PEND#,KQRS_RSIP#);

     1600    11068    3                 GOTO RCVR1;

  11068  1 004632   004700 710000 1                  TRA     RCVR1

     1601    11069
     1602    11070    3               CASE (KQRS_COMP#,KQRS_XFIP#,KQRS_XFDN#,KQRS_NFET#);

     1603    11071    3                 IF RBLK$->KQ$RBLK.LATCH THEN

  11071  1 004633   100001 236100                    LDQ     1,,PR1
         1 004634   400000 316007                    CANQ    -131072,DL
         1 004635   004674 600000 1                  TZE     s:11090

     1604    11072    4                   DO;

     1605    11073    4                   IF  RBLK$->KQ$RBLK.FROMQ

  11073  1 004636   100000 316007                    CANQ    32768,DL
         1 004637   004662 600000 1                  TZE     RCVR0
         1 004640   200011 473500                    LDP3    CG$,,AUTO
         1 004641   200006 236100                    LDQ     STA$,,AUTO
         1 004642   300210 116100                    CMPQ    136,,PR3
         1 004643   004662 600000 1                  TZE     RCVR0
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:229  

     1606    11074    4                   AND STA$ ~= CG$->KQ$CG.JRNLSTA$ THEN
     1607    11075    5                     DO;

     1608    11076    5                     IF RBLK$->KQ$RBLK.QTN$->KQ$QTN.AUTORCVR = '0'B THEN

  11076  1 004644   100021 474500                    LDP4    17,,PR1
         1 004645   400050 234100                    SZN     40,,PR4
         1 004646   004662 604000 1                  TMI     RCVR0

     1609    11077    6                       DO;

     1610    11078                                /* If AUTORCVR off, HOLD it */
     1611    11079    6                       RBLK$->KQ$RBLK.QTN$->KQ$QTN.MXACT=0;

  11079  1 004647   400045 450100                    STZ     37,,PR4

     1612    11080    6                       CALL KQU$UNLATCH (STA$->KQ$STA,HUFPT.V,I);

  11080  1 004650   200032 634500                    EPPR4   I,,AUTO
         1 004651   200056 454500                    STP4    R$+3,,AUTO
         1 004652   000034 236000 2                  LDQ     28
         1 004653   200006 235100                    LDA     STA$,,AUTO
         1 004654   200054 757100                    STAQ    R$+1,,AUTO
         1 004655   200054 630500                    EPPR0   R$+1,,AUTO
         1 004656   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004657   000000 701000 xent               TSX1    KQU$UNLATCH
         1 004660   000000 011000                    NOP     0

     1613    11081    6                       END;

  11081  1 004661   004717 710000 1                  TRA     s:11100

     1614    11082    5                     ELSE GOTO RCVR0;
     1615    11083    5                     END;
     1616    11084    4                   ELSE
     1617    11085                                /* else RERUN */
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:230  
     1618    11086    4   RCVR0:           CALL KQU$UNLATCH (STA$->KQ$STA,RUFPT.V,I);

  11086  1 004662   200032 633500       RCVR0        EPPR3   I,,AUTO
         1 004663   200056 453500                    STP3    R$+3,,AUTO
         1 004664   000033 236000 2                  LDQ     27
         1 004665   200006 235100                    LDA     STA$,,AUTO
         1 004666   200054 757100                    STAQ    R$+1,,AUTO
         1 004667   200054 630500                    EPPR0   R$+1,,AUTO
         1 004670   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004671   000000 701000 xent               TSX1    KQU$UNLATCH
         1 004672   000000 011000                    NOP     0

     1619    11087    4                   END;

  11087  1 004673   004717 710000 1                  TRA     s:11100

     1620    11088    3                 ELSE /* not LATCHed */
     1621    11089    4                   DO;

     1622    11090    4                   CALL KQU$DELREAD (STA$->KQ$STA);

  11090  1 004674   200006 630500                    EPPR0   STA$,,AUTO
         1 004675   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004676   000000 701000 xent               TSX1    KQU$DELREAD
         1 004677   000000 011000                    NOP     0

     1623    11091    4   RCVR1:          STA$->KQ$STA.RBLK$=ADDR(NIL);

  11091  1 004700   000001 236000 xsym  RCVR1        LDQ     B_VECTNIL+1
         1 004701   200006 470500                    LDP0    STA$,,AUTO
         1 004702   000011 756100                    STQ     9,,PR0

     1624    11092    4                   CALL DUMPRBLK;

  11092  1 004703   005307 701000 1                  TSX1    DUMPRBLK
         1 004704   000000 011000                    NOP     0

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:231  
     1625    11093    4                   END;

  11093  1 004705   004717 710000 1                  TRA     s:11100

     1626    11094
     1627    11095    3               CASE (KQRS_UNLA#); /* In middle of normal UNLATCH; continue it */

     1628    11096    3                 CALL KQU$UNLATCH (STA$->KQ$STA,DUFPT.V,I);

  11096  1 004706   200032 633500                    EPPR3   I,,AUTO
         1 004707   200056 453500                    STP3    R$+3,,AUTO
         1 004710   000010 236000 2                  LDQ     8
         1 004711   200006 235100                    LDA     STA$,,AUTO
         1 004712   200054 757100                    STAQ    R$+1,,AUTO
         1 004713   200054 630500                    EPPR0   R$+1,,AUTO
         1 004714   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004715   000000 701000 xent               TSX1    KQU$UNLATCH
         1 004716   000000 011000                    NOP     0

     1629    11097
     1630    11098    3             END;

     1631    11099
     1632    11100    2           RBLK$=ADDR(NIL);

  11100  1 004717   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004720   200007 756100                    STQ     RBLK$,,AUTO

     1633    11101    2           END;

     1634    11102    1         GOTO CL20;

  11102  1 004721   004225 710000 1                  TRA     CL20

     1635    11103        /**/
     1636    11104        /*F* NAME:         KQR$FWCGF
     1637    11105             PURPOSE:      To finish M$FWCG REATTR
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:232  
     1638    11106             CALL:         KQR$FWCGF (KQ$STA)    <---- *FWCG station
     1639    11107             DESCRIPTION:  Called at the end of M$FWCG.  All reattred messages
     1640    11108                           have been written to the *FWCG station.  They
     1641    11109                           are to be removed from there and sent to their
     1642    11110                           proper destination. */
     1643    11111    1   KQR$FWCGF: ENTRY (N$RREQ) ALTRET;

  11111  1 004722   000000 700200 xent  KQR$FWCGF    TSX0  ! X66_AUTO_1
         1 004723   000064 000001                    ZERO    52,1

     1644    11112        /**/
     1645    11113    1         STA$=ADDR(N$RREQ);

  11113  1 004724   200003 236100                    LDQ     @N$RREQ,,AUTO
         1 004725   200006 756100                    STQ     STA$,,AUTO

     1646    11114    1         CG$=STA$->KQ$STA.CG$;

  11114  1 004726   200006 470500                    LDP0    STA$,,AUTO
         1 004727   000007 236100                    LDQ     7,,PR0
         1 004730   200011 756100                    STQ     CG$,,AUTO

     1647    11115    1         LDCT$=ADDR(NIL);

  11115  1 004731   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004732   200005 756100                    STQ     LDCT$,,AUTO

     1648    11116    1         IOQ$=ADDR(NIL);

  11116  1 004733   200004 756100                    STQ     IOQ$,,AUTO

     1649    11117    1         GOTO CLSTARS;

  11117  1 004734   004254 710000 1                  TRA     CLSTARS

     1650    11118        %EJECT;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:233  
     1651    11119        /**/
     1652    11120        /******************************************************************************
     1653    11121        *                                                                             *
     1654    11122        *  SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS  *
     1655    11123        * S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S *
     1656    11124        * S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S     *
     1657    11125        *  SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS  *
     1658    11126        *     S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S *
     1659    11127        * S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S *
     1660    11128        *  SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS  *
     1661    11129        *                                                                             *
     1662    11130        ******************************************************************************/
     1663    11131
     1664    11132        /****************************************************************
     1665    11133        *****************************************************************/
     1666    11134        /*D* NAME:         GETTERM
     1667    11135             PURPOSE:      To find a terminal station from an MBLK
     1668    11136             DESCRIPTION:  Called during rundown of AU message list.
     1669    11137                           MBLK$ points to an MBLK whose origin was
     1670    11138                           at one time a terminal station.  If the
     1671    11139                           station is still connected and still a
     1672    11140                           terminal then we RETURN with the STREE
     1673    11141                           and station gate locked.  Else ALTRET.
     1674    11142        */
     1675    11143    1   GETTERM: PROC ALTRET;

  11143  1 004735   200046 741300       GETTERM      STX1  ! TIMCHK+2,,AUTO

     1676    11144        /**/
     1677    11145              %LOCK (G=KQ$STREE.GATE);

  11146  1 004736   200011 236100                    LDQ     CG$,,AUTO
         1 004737   000075 036003                    ADLQ    61,DU
         1 004740   200054 756100                    STQ     R$+1,,AUTO
         1 004741   200054 630500                    EPPR0   R$+1,,AUTO
         1 004742   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004743   000000 701000 xent               TSX1    HFC$LOCK
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:234  
         1 004744   000000 011000                    NOP     0

     1678    11148    2         IF CG$->KQ$CG.QISS THEN KEY=MBLK$->KQ$MBLK.KEY1;

  11148  1 004745   200011 470500                    LDP0    CG$,,AUTO
         1 004746   000106 235100                    LDA     70,,PR0
         1 004747   004754 600000 1                  TZE     s:11149

  11148  1 004750   200010 471500                    LDP1    MBLK$,,AUTO
         1 004751   100002 237100                    LDAQ    2,,PR1
         1 004752   200022 757100                    STAQ    KEY,,AUTO
         1 004753   004757 710000 1                  TRA     s:11150

     1679    11149    2         ELSE KEY=MBLK$->KQ$MBLK.KEY2;

  11149  1 004754   200010 471500                    LDP1    MBLK$,,AUTO
         1 004755   100004 237100                    LDAQ    4,,PR1
         1 004756   200022 757100                    STAQ    KEY,,AUTO

     1680    11150    2         CALL KQB$SRCH (KQ$STREE,KEY,P$) ALTRET(ALT1);

  11150  1 004757   200027 633500                    EPPR3   P$,,AUTO
         1 004760   200056 453500                    STP3    R$+3,,AUTO
         1 004761   200022 634500                    EPPR4   KEY,,AUTO
         1 004762   200055 454500                    STP4    R$+2,,AUTO
         1 004763   200011 236100                    LDQ     CG$,,AUTO
         1 004764   000075 036003                    ADLQ    61,DU
         1 004765   200054 756100                    STQ     R$+1,,AUTO
         1 004766   200054 630500                    EPPR0   R$+1,,AUTO
         1 004767   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004770   000000 701000 xent               TSX1    KQB$SRCH
         1 004771   005021 702000 1                  TSX2    ALT1

     1681    11151              %LOCK (G=P$->KQ$STA.GATE);

  11152  1 004772   200027 236100                    LDQ     P$,,AUTO
         1 004773   000016 036003                    ADLQ    14,DU
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:235  
         1 004774   200054 756100                    STQ     R$+1,,AUTO
         1 004775   200054 630500                    EPPR0   R$+1,,AUTO
         1 004776   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004777   000000 701000 xent               TSX1    HFC$LOCK
         1 005000   000000 011000                    NOP     0

     1682    11154    2         IF  P$->KQ$STA.TERM

  11154  1 005001   200027 470500                    LDP0    P$,,AUTO
         1 005002   000020 236100                    LDQ     16,,PR0
         1 005003   040000 316003                    CANQ    16384,DU
         1 005004   005012 600000 1                  TZE     s:11157
         1 005005   000010 236100                    LDQ     8,,PR0
         1 005006   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005007   005012 600000 1                  TZE     s:11157

     1683    11155    2         AND P$->KQ$STA.LDCT$ ~= ADDR(NIL) THEN RETURN;

  11155  1 005010   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005011   000001 702211                    TSX2  ! 1,X1

     1684    11156              %UNLOCK (G=P$->KQ$STA.GATE);

  11157  1 005012   200027 236100                    LDQ     P$,,AUTO
         1 005013   000016 036003                    ADLQ    14,DU
         1 005014   200054 756100                    STQ     R$+1,,AUTO
         1 005015   200054 630500                    EPPR0   R$+1,,AUTO
         1 005016   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005017   000000 701000 xent               TSX1    HFC$UNLOCK
         1 005020   000000 011000                    NOP     0

  11154  1 005021                       ALT1         null
     1685    11159    2   ALT1: ;
     1686    11160              %UNLOCK (G=KQ$STREE.GATE);

  11161  1 005021   200011 236100                    LDQ     CG$,,AUTO
         1 005022   000075 036003                    ADLQ    61,DU
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:236  
         1 005023   200054 756100                    STQ     R$+1,,AUTO
         1 005024   200054 630500                    EPPR0   R$+1,,AUTO
         1 005025   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005026   000000 701000 xent               TSX1    HFC$UNLOCK
         1 005027   000000 011000                    NOP     0

     1687    11163    2         ALTRETURN;

  11163  1 005030   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005031   000000 702211                    TSX2  ! 0,X1

     1688    11164    2   END GETTERM;
     1689    11165        /****************************************************************
     1690    11166        *****************************************************************/
     1691    11167        /*D* NAME:         LOGERR
     1692    11168             PURPOSE:      To log an error encountered while reading
     1693    11169                           a message's DBLK
     1694    11170             DESCRIPTION:  The station's RBLK and MBLK are errlogged
     1695    11171        */
     1696    11172    1   LOGERR: PROC (CODE);

  11172  1 005032   200046 741300       LOGERR       STX1  ! TIMCHK+2,,AUTO

     1697    11173        /**/
     1698    11174    2   DCL CODE UBIN;
     1699    11175        /**/
     1700    11176              %LOCK (G=KQ_ERRLOG_GATE);

  11177  1 005033   000040 630400 2                  EPPR0   32
         1 005034   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005035   000000 701000 xent               TSX1    HFC$LOCK
         1 005036   000000 011000                    NOP     0

     1701    11179    2         KQ_ERRLOG_BFR.CODE=%KQELOG_KQR_FTCH;

  11179  1 005037   011000 236003                    LDQ     4608,DU
         1 005040   000000 552040 xsym               STBQ    KQ_ERRLOG_BFR,'40'O
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:237  

     1702    11180    2         P$=ADDR(KQ_ERRLOG_BFR.INFO);

  11180  1 005041   000041 236000 2                  LDQ     33
         1 005042   200027 756100                    STQ     P$,,AUTO

     1703    11181    2         KQ_ERRLOG_BFR.INFO='0'B;

  11181  1 005043   000000 100400                    MLR     fill='000'O
         1 005044   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 005045   000016 000310 xsym               ADSC9   KQ_ERRLOG_BFR+14         cn=0,n=200

     1704    11182    2         P$->B$$CHAR8=STA$->KQ$STA.BTN.KEY;

  11182  1 005046   200006 470500                    LDP0    STA$,,AUTO
         1 005047   200027 471500                    LDP1    P$,,AUTO
         1 005050   040100 100500                    MLR     fill='040'O
         1 005051   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 005052   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8

     1705    11183    2         P$=PINCRW(P$,2);

  11183  1 005053   200027 236100                    LDQ     P$,,AUTO
         1 005054   000002 036003                    ADLQ    2,DU
         1 005055   200027 756100                    STQ     P$,,AUTO

     1706    11184    2         P$->B$$UBIN=CODE;

  11184  1 005056   200047 471500                    LDP1    @CODE,,AUTO
         1 005057   200027 473500                    LDP3    P$,,AUTO
         1 005060   100000 235100                    LDA     0,,PR1
         1 005061   300000 755100                    STA     0,,PR3

     1707    11185    2         P$=PINCRW(P$,1);

  11185  1 005062   200027 236100                    LDQ     P$,,AUTO
         1 005063   000001 036003                    ADLQ    1,DU
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:238  
         1 005064   200027 756100                    STQ     P$,,AUTO

     1708    11186    2         P$->KQ$MBLK=STA$->KQ$STA.RBLK$->KQ$RBLK.MBLK$->KQ$MBLK;

  11186  1 005065   000011 473500                    LDP3    9,,PR0
         1 005066   300000 474500                    LDP4    0,,PR3
         1 005067   200027 475500                    LDP5    P$,,AUTO
         1 005070   000100 100500                    MLR     fill='000'O
         1 005071   400000 000100                    ADSC9   0,,PR4                   cn=0,n=64
         1 005072   500000 000100                    ADSC9   0,,PR5                   cn=0,n=64

     1709    11187    2         P$=PINCRW(P$,SIZEW(KQ$MBLK));

  11187  1 005073   200027 236100                    LDQ     P$,,AUTO
         1 005074   000020 036003                    ADLQ    16,DU
         1 005075   200027 756100                    STQ     P$,,AUTO

     1710    11188    2         IF CODE ~= 0 THEN

  11188  1 005076   100000 235100                    LDA     0,,PR1
         1 005077   005110 600000 1                  TZE     s:11195

     1711    11189    3           DO;

     1712    11190    3           P$->KQ$RBLKT=STA$->KQ$STA.RBLK$->KQ$RBLKT;

  11190  1 005100   000011 473500                    LDP3    9,,PR0
         1 005101   200027 474500                    LDP4    P$,,AUTO
         1 005102   000100 100500                    MLR     fill='000'O
         1 005103   300000 000070                    ADSC9   0,,PR3                   cn=0,n=56
         1 005104   400000 000070                    ADSC9   0,,PR4                   cn=0,n=56

     1713    11191    3           KQ_ERRLOG_BFR.SIZ=3+SIZEW(KQ$MBLK)+SIZEW(KQ$RBLKT);

  11191  1 005105   000041 235007                    LDA     33,DL
         1 005106   000015 755000 xsym               STA     KQ_ERRLOG_BFR+13

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:239  
     1714    11192    3           END;

  11192  1 005107   005117 710000 1                  TRA     s:11198

     1715    11193    2         ELSE
     1716    11194    3           DO;

     1717    11195    3           P$->KQ$RBLK=STA$->KQ$STA.RBLK$->KQ$RBLK;

  11195  1 005110   000011 473500                    LDP3    9,,PR0
         1 005111   200027 474500                    LDP4    P$,,AUTO
         1 005112   000100 100500                    MLR     fill='000'O
         1 005113   300000 000110                    ADSC9   0,,PR3                   cn=0,n=72
         1 005114   400000 000110                    ADSC9   0,,PR4                   cn=0,n=72

     1718    11196    3           KQ_ERRLOG_BFR.SIZ=3+SIZEW(KQ$MBLK)+SIZEW(KQ$RBLK);

  11196  1 005115   000045 235007                    LDA     37,DL
         1 005116   000015 755000 xsym               STA     KQ_ERRLOG_BFR+13

     1719    11197    3           END;

     1720    11198    2         CALL KQD$ERRLOG (CG$->KQ$CG);

  11198  1 005117   200011 630500                    EPPR0   CG$,,AUTO
         1 005120   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005121   000000 701000 xent               TSX1    KQD$ERRLOG
         1 005122   000000 011000                    NOP     0

     1721    11199    2         RETURN;

  11199  1 005123   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005124   000001 702211                    TSX2  ! 1,X1

     1722    11200    2   END LOGERR;
     1723    11201        /****************************************************************
     1724    11202        *****************************************************************/
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:240  
     1725    11203        /*D* NAME:         GETQUEUE
     1726    11204             PURPOSE:      To become the reader of the queue
     1727    11205             DESCRIPTION:  If the queue is not busy, makes us
     1728    11206                           the current reader.  Else blocks us for
     1729    11207                           the queue.
     1730    11208                           Returns Q gate locked.
     1731    11209        */
     1732    11210    1   GETQUEUE: PROC;

  11210  1 005125   200046 741300       GETQUEUE     STX1  ! TIMCHK+2,,AUTO

     1733    11211        /**/
     1734    11212              %LOCK (G=KQ$QTREE.GATE);

  11213  1 005126   200011 470500                    LDP0    CG$,,AUTO
         1 005127   000057 471500                    LDP1    47,,PR0
         1 005130   200054 451500                    STP1    R$+1,,AUTO
         1 005131   200054 630500                    EPPR0   R$+1,,AUTO
         1 005132   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005133   000000 701000 xent               TSX1    HFC$LOCK
         1 005134   000000 011000                    NOP     0

     1735    11215    2         IF NOT KQ$QUEUE.BUSY THEN

  11215  1 005135   200011 470500                    LDP0    CG$,,AUTO
         1 005136   000063 236100                    LDQ     51,,PR0
         1 005137   000600 316003                    CANQ    384,DU
         1 005140   005150 601000 1                  TNZ     s:11221

     1736    11216    3           DO;

     1737    11217    3           KQ$QUEUE.BUSY.RIP='1'B;

  11217  1 005141   000400 236003                    LDQ     256,DU
         1 005142   000063 256100                    ORSQ    51,,PR0

     1738    11218    3           KQ$QUEUE.RUSR#=S_CUN;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:241  

  11218  1 005143   000000 236000 xsym               LDQ     S_CUN
         1 005144   000033 736000                    QLS     27
         1 005145   000063 552140                    STBQ    51,'40'O,PR0

     1739    11219    3           RETURN;

  11219  1 005146   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005147   000001 702211                    TSX2  ! 1,X1

     1740    11220    3           END;
     1741    11221    2         IF S_CUN = KQ$QUEUE.RUSR# THEN CALL SC_BCGRBS;

  11221  1 005150   000063 236100                    LDQ     51,,PR0
         1 005151   000033 772000                    QRL     27
         1 005152   000000 116000 xsym               CMPQ    S_CUN
         1 005153   005156 601000 1                  TNZ     s:11222

  11221  1 005154   000000 713400 xsym               CLIMB   SC_BCGRBS
         1 005155   000000 600000 xsid               climb   nvectors=         0

     1742    11222    2         CALL KQL$QDELAYR (CG$->KQ$CG,STA$->KQ$STA);

  11222  1 005156   200006 236100                    LDQ     STA$,,AUTO
         1 005157   200011 235100                    LDA     CG$,,AUTO
         1 005160   200054 757100                    STAQ    R$+1,,AUTO
         1 005161   200054 630500                    EPPR0   R$+1,,AUTO
         1 005162   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 005163   000000 701000 xent               TSX1    KQL$QDELAYR
         1 005164   000000 011000                    NOP     0

     1743    11223              %UNLOCK (G=KQ$QTREE.GATE);

  11224  1 005165   200011 470500                    LDP0    CG$,,AUTO
         1 005166   000057 471500                    LDP1    47,,PR0
         1 005167   200054 451500                    STP1    R$+1,,AUTO
         1 005170   200054 630500                    EPPR0   R$+1,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:242  
         1 005171   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005172   000000 701000 xent               TSX1    HFC$UNLOCK
         1 005173   000000 011000                    NOP     0

     1744    11226    2         CALL SSR$REG (%SS_QA);

  11226  1 005174   000043 630400 2                  EPPR0   35
         1 005175   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005176   000000 701000 xent               TSX1    SSR$REG
         1 005177   000000 011000                    NOP     0

     1745    11227              %LOCK (G=KQ$QTREE.GATE);

  11228  1 005200   200011 470500                    LDP0    CG$,,AUTO
         1 005201   000057 471500                    LDP1    47,,PR0
         1 005202   200054 451500                    STP1    R$+1,,AUTO
         1 005203   200054 630500                    EPPR0   R$+1,,AUTO
         1 005204   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005205   000000 701000 xent               TSX1    HFC$LOCK
         1 005206   000000 011000                    NOP     0

     1746    11230    2         IF S_CUN ~= KQ$QUEUE.RUSR# THEN CALL SC_BCGRBS;

  11230  1 005207   200011 470500                    LDP0    CG$,,AUTO
         1 005210   000063 236100                    LDQ     51,,PR0
         1 005211   000033 772000                    QRL     27
         1 005212   000000 116000 xsym               CMPQ    S_CUN
         1 005213   005216 600000 1                  TZE     s:11231

  11230  1 005214   000000 713400 xsym               CLIMB   SC_BCGRBS
         1 005215   000000 600000 xsid               climb   nvectors=         0

     1747    11231    2         RETURN;

  11231  1 005216   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005217   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:243  
     1748    11232    2   END GETQUEUE;
     1749    11233        /****************************************************************
     1750    11234        *****************************************************************/
     1751    11235        /*D* NAME:         GETRBLK
     1752    11236             PURPOSE:      To get an RBLK
     1753    11237             INPUT:        Station locked
     1754    11238             DESCRIPTION:  Gets one if possible, and returns with
     1755    11239                           RBLK$ and KQ$STA.RBLK$ set up.  Else
     1756    11240                           ALTRETs with station unlocked.
     1757    11241        */
     1758    11242    1   GETRBLK: PROC ALTRET;

  11242  1 005220   200046 741300       GETRBLK      STX1  ! TIMCHK+2,,AUTO

     1759    11243        /**/
     1760    11244    2   DCL T$ PTR;
     1761    11245        /**/
     1762    11246    2         CALL KQM$GETRBLK (CG$->KQ$CG,T$,I) ALTRET(GR0);

  11246  1 005221   200032 630500                    EPPR0   I,,AUTO
         1 005222   200056 450500                    STP0    R$+3,,AUTO
         1 005223   200047 631500                    EPPR1   T$,,AUTO
         1 005224   200055 451500                    STP1    R$+2,,AUTO
         1 005225   200011 236100                    LDQ     CG$,,AUTO
         1 005226   200054 756100                    STQ     R$+1,,AUTO
         1 005227   200054 630500                    EPPR0   R$+1,,AUTO
         1 005230   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 005231   000000 701000 xent               TSX1    KQM$GETRBLK
         1 005232   005234 702000 1                  TSX2    GR0

     1763    11247    2         GOTO GR1;

  11247  1 005233   005276 710000 1                  TRA     GR1

  11246  1 005234                       GR0          null
     1764    11248    2   GR0:  ;
     1765    11249              %UNLOCK (G=STA$->KQ$STA.GATE);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:244  

  11250  1 005234   200006 236100                    LDQ     STA$,,AUTO
         1 005235   000016 036003                    ADLQ    14,DU
         1 005236   200054 756100                    STQ     R$+1,,AUTO
         1 005237   200054 630500                    EPPR0   R$+1,,AUTO
         1 005240   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005241   000000 701000 xent               TSX1    HFC$UNLOCK
         1 005242   000000 011000                    NOP     0

     1766    11252    2         IF STA$->KQ$STA.MONDCB THEN ALTRETURN;

  11252  1 005243   200006 470500                    LDP0    STA$,,AUTO
         1 005244   000020 236100                    LDQ     16,,PR0
         1 005245   100000 316003                    CANQ    32768,DU
         1 005246   005251 600000 1                  TZE     s:11253

  11252  1 005247   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005250   000000 702211                    TSX2  ! 0,X1

     1767    11253    2         T$=STA$;

  11253  1 005251   200006 236100                    LDQ     STA$,,AUTO
         1 005252   200047 756100                    STQ     T$,,AUTO

     1768    11254    2         I=KQMR_RBLK#;

  11254  1 005253   000002 235007                    LDA     2,DL
         1 005254   200032 755100                    STA     I,,AUTO

     1769    11255    2         CALL KQM$GETBR (CG$->KQ$CG,T$,I) ALTRET(ALTRT);

  11255  1 005255   200032 631500                    EPPR1   I,,AUTO
         1 005256   200056 451500                    STP1    R$+3,,AUTO
         1 005257   200047 633500                    EPPR3   T$,,AUTO
         1 005260   200055 453500                    STP3    R$+2,,AUTO
         1 005261   200011 236100                    LDQ     CG$,,AUTO
         1 005262   200054 756100                    STQ     R$+1,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:245  
         1 005263   200054 630500                    EPPR0   R$+1,,AUTO
         1 005264   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 005265   000000 701000 xent               TSX1    KQM$GETBR
         1 005266   005305 702000 1                  TSX2    ALTRT

     1770    11256              %LOCK (G=STA$->KQ$STA.GATE);

  11257  1 005267   200006 236100                    LDQ     STA$,,AUTO
         1 005270   000016 036003                    ADLQ    14,DU
         1 005271   200054 756100                    STQ     R$+1,,AUTO
         1 005272   200054 630500                    EPPR0   R$+1,,AUTO
         1 005273   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005274   000000 701000 xent               TSX1    HFC$LOCK
         1 005275   000000 011000                    NOP     0

     1771    11259    2   GR1:  STA$->KQ$STA.RBLK$=T$;

  11259  1 005276   200047 236100       GR1          LDQ     T$,,AUTO
         1 005277   200006 470500                    LDP0    STA$,,AUTO
         1 005300   000011 756100                    STQ     9,,PR0

     1772    11260    2         RBLK$=T$;

  11260  1 005301   200047 236100                    LDQ     T$,,AUTO
         1 005302   200007 756100                    STQ     RBLK$,,AUTO

     1773    11261    2         RETURN;

  11261  1 005303   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005304   000001 702211                    TSX2  ! 1,X1

  11260  1 005305                       ALTRT        null
     1774    11262    2   ALTRT:;
     1775    11263    2         ALTRETURN;

  11263  1 005305   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005306   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:246  

     1776    11264        /**/
     1777    11265    2   DUMPRBLK: ENTRY ALTRET; /* !!Doesn't ALTRET!! */

  11265  1 005307   200046 741300       DUMPRBLK     STX1  ! TIMCHK+2,,AUTO

     1778    11266        /**/
     1779    11267    3           DO INHIBIT;

     1780    11268    3           T$=RBLK$;

  11268  1 005310   200007 236300                    LDQ   ! RBLK$,,AUTO
         1 005311   200047 756300                    STQ   ! T$,,AUTO

     1781    11269    3           CALL KQM$RELRBLK (CG$->KQ$CG,T$);

  11269  1 005312   200047 630700                    EPPR0 ! T$,,AUTO
         1 005313   200055 450700                    STP0  ! R$+2,,AUTO
         1 005314   200011 236300                    LDQ   ! CG$,,AUTO
         1 005315   200054 756300                    STQ   ! R$+1,,AUTO
         1 005316   200054 630700                    EPPR0 ! R$+1,,AUTO
         1 005317   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 005320   000000 701200 xent               TSX1  ! KQM$RELRBLK
         1 005321   000000 011200                    NOP   ! 0

     1782    11270    3           END;

     1783    11271    2         RETURN;

  11271  1 005322   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005323   000001 702211                    TSX2  ! 1,X1

     1784    11272        /**/
     1785    11273    2   DEQUEUE: ENTRY ALTRET; /* !!Doesn't ALTRET!! */

  11273  1 005324   200046 741300       DEQUEUE      STX1  ! TIMCHK+2,,AUTO

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:247  
     1786    11274        /**/
     1787    11275    2         T$=RBLK$;

  11275  1 005325   200007 236100                    LDQ     RBLK$,,AUTO
         1 005326   200047 756100                    STQ     T$,,AUTO

     1788    11276    2         CALL KQQ$DEQUEUE (CG$->KQ$CG,T$);

  11276  1 005327   200047 630500                    EPPR0   T$,,AUTO
         1 005330   200055 450500                    STP0    R$+2,,AUTO
         1 005331   200011 236100                    LDQ     CG$,,AUTO
         1 005332   200054 756100                    STQ     R$+1,,AUTO
         1 005333   200054 630500                    EPPR0   R$+1,,AUTO
         1 005334   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 005335   000000 701000 xent               TSX1    KQQ$DEQUEUE
         1 005336   000000 011000                    NOP     0

     1789    11277    2         RETURN;

  11277  1 005337   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005340   000001 702211                    TSX2  ! 1,X1

     1790    11278    2   END GETRBLK;
     1791    11279        /****************************************************************
     1792    11280        *****************************************************************/
     1793    11281        /*D* NAME:        QEOFTIME
     1794    11282             PURPOSE:     To place the current READ on the KQ$CG.EOFTIMEHD$ list
     1795    11283             DESCRIPTION: RBLK$->KQ$RBLK is placed on the KQ$CG.EOFTIMEHD$ list
     1796    11284                          in order of expiration by KQ$RBLK.EOFTIME.
     1797    11285                          The KQ$CG.EOFTIMEHD$ list is gated by KQ$STREE.GATE
     1798    11286                          so that gate is locked on entry and unlocked on exit.
     1799    11287        */
     1800    11288    1   QEOFTIME: PROC;

  11288  1 005341   200046 741300       QEOFTIME     STX1  ! TIMCHK+2,,AUTO

     1801    11289        /**/
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:248  
     1802    11290              %LOCK(G=KQ$STREE.GATE);

  11291  1 005342   200011 236100                    LDQ     CG$,,AUTO
         1 005343   000075 036003                    ADLQ    61,DU
         1 005344   200054 756100                    STQ     R$+1,,AUTO
         1 005345   200054 630500                    EPPR0   R$+1,,AUTO
         1 005346   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005347   000000 701000 xent               TSX1    HFC$LOCK
         1 005350   000000 011000                    NOP     0

     1803    11293    2         CALL QEOFT;

  11293  1 005351   005371 701000 1                  TSX1    QEOFT
         1 005352   000000 011000                    NOP     0

     1804    11294              %UNLOCK(G=KQ$STREE.GATE);

  11295  1 005353   200011 236100                    LDQ     CG$,,AUTO
         1 005354   000075 036003                    ADLQ    61,DU
         1 005355   200054 756100                    STQ     R$+1,,AUTO
         1 005356   200054 630500                    EPPR0   R$+1,,AUTO
         1 005357   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005360   000000 701000 xent               TSX1    HFC$UNLOCK
         1 005361   000000 011000                    NOP     0

     1805    11297    2         RETURN;

  11297  1 005362   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005363   000001 702211                    TSX2  ! 1,X1

     1806    11298    2   END QEOFTIME;
     1807    11299        /**/
     1808    11300        /*D* NAME:        QEOFTIMENL
     1809    11301             PURPOSE:     To place the current READ on the KQ$CG.EOFTIMEHD$ list
     1810    11302             DESCRIPTION: Same as QEOFTIME except the STREE gate is not locked or
     1811    11303                          unlocked.
     1812    11304        */
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:249  
     1813    11305    1   QEOFTIMENL: PROC;

  11305  1 005364   200046 741300       QEOFTIMENL   STX1  ! TIMCHK+2,,AUTO

     1814    11306        /**/
     1815    11307    2         CALL QEOFT;

  11307  1 005365   005371 701000 1                  TSX1    QEOFT
         1 005366   000000 011000                    NOP     0

     1816    11308    2         RETURN;

  11308  1 005367   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005370   000001 702211                    TSX2  ! 1,X1

     1817    11309    2   END QEOFTIMENL;
     1818    11310        /**/
     1819    11311    1   QEOFT: PROC;

  11311  1 005371   200050 741300       QEOFT        STX1  ! UB$+1,,AUTO

     1820    11312        /**/
     1821    11313    2   DCL SECS UBIN;
     1822    11314    2   DCL P$ PTR;
     1823    11315    2   DCL R$ PTR;
     1824    11316    2         SECS=VLP_STATION.EOFTIME+CG$->KQ$CG.EOFTIME;

  11316  1 005372   200011 470500                    LDP0    CG$,,AUTO
         1 005373   000030 236100                    LDQ     24,,PR0
         1 005374   000022 772000                    QRL     18
         1 005375   200054 756100                    STQ     R$+1,,AUTO
         1 005376   200016 236100                    LDQ     VLP_STATION+4,,AUTO
         1 005377   777777 376007                    ANQ     -1,DL
         1 005400   200054 036100                    ADLQ    R$+1,,AUTO
         1 005401   200051 756100                    STQ     SECS,,AUTO

     1825    11317    2         RBLK$->KQ$RBLK.EOFTIME=SECS;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:250  

  11317  1 005402   000000 620006                    EAX0    0,QL
         1 005403   200007 471500                    LDP1    RBLK$,,AUTO
         1 005404   100017 440100                    SXL0    15,,PR1

     1826    11318    2         P$=ADDR(CG$->KQ$CG.EOFTIMEHD$);

  11318  1 005405   200011 236100                    LDQ     CG$,,AUTO
         1 005406   000027 036003                    ADLQ    23,DU
         1 005407   200052 756100                    STQ     P$,,AUTO

     1827    11319    2         R$=P$->B$$PTR;

  11319  1 005410   200052 473500                    LDP3    P$,,AUTO
         1 005411   300000 236100                    LDQ     0,,PR3
         1 005412   200053 756100                    STQ     R$,,AUTO

     1828    11320    3           DO WHILE(R$~=ADDR(NIL));

  11320  1 005413   005430 710000 1                  TRA     s:11324

     1829    11321    3           IF R$->KQ$RBLK.EOFTIME>SECS THEN GOTO FOUNDIT;

  11321  1 005414   200053 470500                    LDP0    R$,,AUTO
         1 005415   000017 236100                    LDQ     15,,PR0
         1 005416   777777 376007                    ANQ     -1,DL
         1 005417   200051 116100                    CMPQ    SECS,,AUTO
         1 005420   005422 600000 1                  TZE     s:11322
         1 005421   005432 603000 1                  TRC     FOUNDIT

     1830    11322    3           P$=ADDR(R$->KQ$RBLK.EOFTIMELNK$);

  11322  1 005422   200053 236100                    LDQ     R$,,AUTO
         1 005423   000010 036003                    ADLQ    8,DU
         1 005424   200052 756100                    STQ     P$,,AUTO

     1831    11323    3           R$=P$->B$$PTR;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:251  

  11323  1 005425   200052 471500                    LDP1    P$,,AUTO
         1 005426   100000 236100                    LDQ     0,,PR1
         1 005427   200053 756100                    STQ     R$,,AUTO

     1832    11324    3           END;

  11324  1 005430   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005431   005414 601000 1                  TNZ     s:11321

  11320  1 005432                       FOUNDIT      null
     1833    11325    2   FOUNDIT:;
     1834    11326    2         RBLK$->KQ$RBLK.EOFTIMELNK$=P$->B$$PTR;

  11326  1 005432   200052 470500                    LDP0    P$,,AUTO
         1 005433   000000 236100                    LDQ     0,,PR0
         1 005434   200007 471500                    LDP1    RBLK$,,AUTO
         1 005435   100010 756100                    STQ     8,,PR1

     1835    11327    2         P$->B$$PTR=RBLK$;

  11327  1 005436   200007 236100                    LDQ     RBLK$,,AUTO
         1 005437   000000 756100                    STQ     0,,PR0

     1836    11328    2         RETURN;

  11328  1 005440   200050 221300                    LDX1  ! UB$+1,,AUTO
         1 005441   000001 702211                    TSX2  ! 1,X1

     1837    11329    2   END QEOFT;
     1838    11330        /****************************************************************
     1839    11331        *****************************************************************/
     1840    11332        /*D* NAME:         CHUNKOK
     1841    11333             PURPOSE:      To finish the read of a message chunk
     1842    11334             INPUT:        I = # bytes actually xferred.
     1843    11335             DESCRIPTION:  ALTRETs if the next chunk is not to be read,
     1844    11336                           RETURNs else.
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:252  
     1845    11337        */
     1846    11338    1   CHUNKOK: PROC ALTRET;

  11338  1 005442   200046 741300       CHUNKOK      STX1  ! TIMCHK+2,,AUTO

     1847    11339        /**/
     1848    11340    2   DCL FLNKDA UBIN;
     1849    11341    2   DCL T$ PTR;
     1850    11342        /**/
     1851    11343    2         RBLK$->KQ$RBLK.BUFSIZE=RBLK$->KQ$RBLK.BUFSIZE-I;

  11343  1 005443   200007 470500                    LDP0    RBLK$,,AUTO
         1 005444   000016 236100                    LDQ     14,,PR0
         1 005445   200032 136100                    SBLQ    I,,AUTO
         1 005446   000016 756100                    STQ     14,,PR0

     1852    11344    2         RBLK$->KQ$RBLK.BUF$=PINCRC(RBLK$->KQ$RBLK.BUF$,I);

  11344  1 005447   000013 471500                    LDP1    11,,PR0
         1 005450   200032 236100                    LDQ     I,,AUTO
         1 005451   000011 402007                    MPY     9,DL
         1 005452   100000 503506                    ABD     0,QL,PR1
         1 005453   000013 451500                    STP1    11,,PR0

     1853    11345    2         RBLK$->KQ$RBLK.DBLKX=0;

  11345  1 005454   000000 220003                    LDX0    0,DU
         1 005455   000017 440100                    SXL0    15,,PR0

     1854    11346    2         RBLK$->KQ$RBLK.NCDDA=DBLK$->KQ$DBLK.FLNKDA;

  11346  1 005456   200031 473500                    LDP3    DBLK$,,AUTO
         1 005457   300001 235100                    LDA     1,,PR3
         1 005460   000011 755100                    STA     9,,PR0

     1855    11347    2         FLNKDA = DBLK$->KQ$DBLK.FLNKDA;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:253  
  11347  1 005461   200031 473500                    LDP3    DBLK$,,AUTO
         1 005462   300001 235100                    LDA     1,,PR3
         1 005463   200047 755100                    STA     FLNKDA,,AUTO

     1856    11348    2         IF RBLK$->KQ$RBLK.LATCH THEN

  11348  1 005464   000001 236100                    LDQ     1,,PR0
         1 005465   400000 316007                    CANQ    -131072,DL
         1 005466   005504 600000 1                  TZE     s:11353

     1857    11349    3           DO;

     1858    11350    3           T$=STA$;

  11350  1 005467   200006 236100                    LDQ     STA$,,AUTO
         1 005470   200050 756100                    STQ     T$,,AUTO

     1859    11351    3           CALL KQD$LREL (CG$->KQ$CG,DBLK$,T$);

  11351  1 005471   200050 631500                    EPPR1   T$,,AUTO
         1 005472   200056 451500                    STP1    R$+3,,AUTO
         1 005473   200031 634500                    EPPR4   DBLK$,,AUTO
         1 005474   200055 454500                    STP4    R$+2,,AUTO
         1 005475   200011 236100                    LDQ     CG$,,AUTO
         1 005476   200054 756100                    STQ     R$+1,,AUTO
         1 005477   200054 630500                    EPPR0   R$+1,,AUTO
         1 005500   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 005501   000000 701000 xent               TSX1    KQD$LREL
         1 005502   000000 011000                    NOP     0

     1860    11352    3           END;

  11352  1 005503   005514 710000 1                  TRA     s:11354

     1861    11353    2         ELSE CALL KQD$DELETE (CG$->KQ$CG,DBLK$);

  11353  1 005504   200031 634500                    EPPR4   DBLK$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:254  
         1 005505   200055 454500                    STP4    R$+2,,AUTO
         1 005506   200011 236100                    LDQ     CG$,,AUTO
         1 005507   200054 756100                    STQ     R$+1,,AUTO
         1 005510   200054 630500                    EPPR0   R$+1,,AUTO
         1 005511   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 005512   000000 701000 xent               TSX1    KQD$DELETE
         1 005513   000000 011000                    NOP     0

     1862    11354    2         IF FLNKDA=0 THEN ALTRETURN;

  11354  1 005514   200047 235100                    LDA     FLNKDA,,AUTO
         1 005515   005520 601000 1                  TNZ     s:11355

  11354  1 005516   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005517   000000 702211                    TSX2  ! 0,X1

     1863    11355    2         RETURN;

  11355  1 005520   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005521   000001 702211                    TSX2  ! 1,X1

     1864    11356    2   END CHUNKOK;
     1865    11357        /****************************************************************
     1866    11358        *****************************************************************/
     1867    11359        /*D* NAME:         XFAUEV
     1868    11360             PURPOSE:      To transfer an AU event to his buffer
     1869    11361             DESCRIPTION:  B$CGAURD frames his buffer, and the goodies
     1870    11362                           are extracted from the MBLK and stuffed therein.
     1871    11363
     1872    11364                           Xfers RBLK.BUFSIZE bytes of the B$CGAURD
     1873    11365                           into his buffer.  If his buffer is too
     1874    11366                           short, sets N$REQ.TYC.LD and RBLK.DBLKX
     1875    11367                           to his buffer size, and ALTRETs.  On
     1876    11368                           entry, RBLK.DBLKX is expected to be the
     1877    11369                           index into his buffer.  If his buffer
     1878    11370                           is long enough, RETURNs.
     1879    11371
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:255  
     1880    11372                           Special action is taken for some events.
     1881    11373        */
     1882    11374    1   XFAUEV: PROC ALTRET;

  11374  1 005522   200046 741300       XFAUEV       STX1  ! TIMCHK+2,,AUTO

     1883    11375        /**/
     1884    11376    2   DCL T$ PTR;
     1885    11377        /**/
     1886    11378    2         IF RBLK$->KQ$RBLK.AUXFDN THEN RETURN;

  11378  1 005523   200007 470500                    LDP0    RBLK$,,AUTO
         1 005524   000001 236100                    LDQ     1,,PR0
         1 005525   020000 316007                    CANQ    8192,DL
         1 005526   005530 600000 1                  TZE     s:11379

  11378  1 005527   000001 702211                    TSX2  ! 1,X1

     1887    11379    2         CGAURD.X.EVENT=MBLK$->KQ$MBLK.FC;

  11379  1 005530   200010 471500                    LDP1    MBLK$,,AUTO
         1 005531   100010 236100                    LDQ     8,,PR1
         1 005532   000033 772000                    QRL     27
         1 005533   000037 376007                    ANQ     31,DL
         1 005534   200012 756100                    STQ     VLP_STATION,,AUTO

     1888    11380    2         IF CG$->KQ$CG.QISS THEN

  11380  1 005535   200011 473500                    LDP3    CG$,,AUTO
         1 005536   300106 235100                    LDA     70,,PR3
         1 005537   005544 600000 1                  TZE     s:11382

     1889    11381    2          CGAURD.X.STATION=MBLK$->KQ$MBLK.KEY1;

  11381  1 005540   100002 237100                    LDAQ    2,,PR1
         1 005541   200013 755100                    STA     VLP_STATION+1,,AUTO
         1 005542   200014 756100                    STQ     VLP_STATION+2,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:256  
         1 005543   005547 710000 1                  TRA     s:11383

     1890    11382    2         ELSE CGAURD.X.STATION=MBLK$->KQ$MBLK.KEY2;

  11382  1 005544   100004 237100                    LDAQ    4,,PR1
         1 005545   200013 755100                    STA     VLP_STATION+1,,AUTO
         1 005546   200014 756100                    STQ     VLP_STATION+2,,AUTO

     1891    11383    2         CGAURD.X.INFO=MBLK$->KQ$MBLK.MID.XT;

  11383  1 005547   100015 235100                    LDA     13,,PR1
         1 005550   200015 755100                    STA     VLP_STATION+3,,AUTO

     1892    11384        /**/
     1893    11385    3           DO CASE (CGAURD.X.EVENT);

  11385  1 005551   200012 235100                    LDA     VLP_STATION,,AUTO
         1 005552   000004 135007                    SBLA    4,DL
         1 005553   000001 115007                    CMPA    1,DL
         1 005554   005556 602005 1                  TNC     s:11385+5,AL
         1 005555   005640 710000 1                  TRA     s:11407
         1 005556   005557 710000 1                  TRA     s:11388

     1894    11386    3             CASE (%CG_TBRK#);

     1895    11387                    %LOCK (G=KQ$STREE.GATE);

  11388  1 005557   200011 236100                    LDQ     CG$,,AUTO
         1 005560   000075 036003                    ADLQ    61,DU
         1 005561   200054 756100                    STQ     R$+1,,AUTO
         1 005562   200054 630500                    EPPR0   R$+1,,AUTO
         1 005563   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005564   000000 701000 xent               TSX1    HFC$LOCK
         1 005565   000000 011000                    NOP     0

     1896    11390    3               CALL KQB$SRCH (KQ$STREE,CGAURD.X.STATION,T$) ALTRET(TBRK1);

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:257  
  11390  1 005566   200047 630500                    EPPR0   T$,,AUTO
         1 005567   200056 450500                    STP0    R$+3,,AUTO
         1 005570   200013 631500                    EPPR1   VLP_STATION+1,,AUTO
         1 005571   200055 451500                    STP1    R$+2,,AUTO
         1 005572   200011 236100                    LDQ     CG$,,AUTO
         1 005573   000075 036003                    ADLQ    61,DU
         1 005574   200054 756100                    STQ     R$+1,,AUTO
         1 005575   200054 630500                    EPPR0   R$+1,,AUTO
         1 005576   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 005577   000000 701000 xent               TSX1    KQB$SRCH
         1 005600   005631 702000 1                  TSX2    TBRK1

     1897    11391                    %LOCK (G=T$->KQ$STA.GATE);

  11392  1 005601   200047 236100                    LDQ     T$,,AUTO
         1 005602   000016 036003                    ADLQ    14,DU
         1 005603   200054 756100                    STQ     R$+1,,AUTO
         1 005604   200054 630500                    EPPR0   R$+1,,AUTO
         1 005605   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005606   000000 701000 xent               TSX1    HFC$LOCK
         1 005607   000000 011000                    NOP     0

     1898    11394    3               IF T$->KQ$STA.TERM THEN

  11394  1 005610   200047 470500                    LDP0    T$,,AUTO
         1 005611   000020 236100                    LDQ     16,,PR0
         1 005612   040000 316003                    CANQ    16384,DU
         1 005613   005622 600000 1                  TZE     s:11398

     1899    11395    3                IF T$->KQ$STA.EVCNT > 0 THEN

  11395  1 005614   000023 236100                    LDQ     19,,PR0
         1 005615   777000 376003                    ANQ     -512,DU
         1 005616   000000 116003                    CMPQ    0,DU
         1 005617   005622 604400 1                  TMOZ    s:11398

     1900    11396    3                 T$->KQ$STA.EVCNT=T$->KQ$STA.EVCNT-1;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:258  

  11396  1 005620   777000 236003                    LDQ     -512,DU
         1 005621   000023 056100                    ASQ     19,,PR0

     1901    11397                    %UNLOCK (G=T$->KQ$STA.GATE);

  11398  1 005622   200047 236100                    LDQ     T$,,AUTO
         1 005623   000016 036003                    ADLQ    14,DU
         1 005624   200054 756100                    STQ     R$+1,,AUTO
         1 005625   200054 630500                    EPPR0   R$+1,,AUTO
         1 005626   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005627   000000 701000 xent               TSX1    HFC$UNLOCK
         1 005630   000000 011000                    NOP     0

  11394  1 005631                       TBRK1        null
     1902    11400    3   TBRK1:      ;
     1903    11401                    %UNLOCK (G=KQ$STREE.GATE);

  11402  1 005631   200011 236100                    LDQ     CG$,,AUTO
         1 005632   000075 036003                    ADLQ    61,DU
         1 005633   200054 756100                    STQ     R$+1,,AUTO
         1 005634   200054 630500                    EPPR0   R$+1,,AUTO
         1 005635   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005636   000000 701000 xent               TSX1    HFC$UNLOCK
         1 005637   000000 011000                    NOP     0

     1904    11404
     1905    11405    3           END;

     1906    11406        /**/
     1907    11407    2         I=SIZEC(B$CGAURD)-RBLK$->KQ$RBLK.DBLKX;

  11407  1 005640   200007 470500                    LDP0    RBLK$,,AUTO
         1 005641   000017 236100                    LDQ     15,,PR0
         1 005642   777777 376007                    ANQ     -1,DL
         1 005643   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 005644   000021 036007                    ADLQ    17,DL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:259  
         1 005645   200032 756100                    STQ     I,,AUTO

     1908    11408    2         IF I > RBLK$->KQ$RBLK.BUFSIZE THEN

  11408  1 005646   000016 116100                    CMPQ    14,,PR0
         1 005647   005656 602000 1                  TNC     s:11413
         1 005650   005656 600000 1                  TZE     s:11413

     1909    11409    3           DO;

     1910    11410    3           N$REQ.TYC=%TYC_LD;

  11410  1 005651   000042 236000 0                  LDQ     ERR_NODAT+4
         1 005652   200004 471500                    LDP1    IOQ$,,AUTO
         1 005653   100021 756100                    STQ     17,,PR1

     1911    11411    3           I=RBLK$->KQ$RBLK.BUFSIZE;

  11411  1 005654   000016 235100                    LDA     14,,PR0
         1 005655   200032 755100                    STA     I,,AUTO

     1912    11412    3           END;

     1913    11413    2         RBLK$->KQ$RBLK.BUF$->B$$CHARS=PINCRC(ADDR(CGAURD.X),RBLK$->KQ$RBLK.DBLKX)->
             11413                  B$$CHARS;

  11413  1 005656   000013 471500                    LDP1    11,,PR0
         1 005657   000017 236100                    LDQ     15,,PR0
         1 005660   777777 376007                    ANQ     -1,DL
         1 005661   200032 720100                    LXL0    I,,AUTO
         1 005662   040140 100546                    MLR     fill='040'O
         1 005663   200012 000010                    ADSC9   VLP_STATION,Q,AUTO       cn=0,n=*X0
         1 005664   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

     1914    11414    2         RBLK$->KQ$RBLK.BUFSIZE=RBLK$->KQ$RBLK.BUFSIZE-I;

  11414  1 005665   200007 470500                    LDP0    RBLK$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:260  
         1 005666   000016 236100                    LDQ     14,,PR0
         1 005667   200032 136100                    SBLQ    I,,AUTO
         1 005670   000016 756100                    STQ     14,,PR0

     1915    11415    2         RBLK$->KQ$RBLK.BUF$=PINCRC(RBLK$->KQ$RBLK.BUF$,I);

  11415  1 005671   000013 471500                    LDP1    11,,PR0
         1 005672   200032 236100                    LDQ     I,,AUTO
         1 005673   000011 402007                    MPY     9,DL
         1 005674   100000 503506                    ABD     0,QL,PR1
         1 005675   000013 451500                    STP1    11,,PR0

     1916    11416    2         N$REQ.ARSIZE=I;

  11416  1 005676   200004 473500                    LDP3    IOQ$,,AUTO
         1 005677   200032 236100                    LDQ     I,,AUTO
         1 005700   000020 736000                    QLS     16
         1 005701   300027 676100                    ERQ     23,,PR3
         1 005702   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 005703   300027 656100                    ERSQ    23,,PR3

     1917    11417    2         IF N$REQ.TYC

  11417  1 005704   300021 235100                    LDA     17,,PR3
         1 005705   005715 600000 1                  TZE     s:11423

     1918    11418    3         THEN DO;

     1919    11419    3           RBLK$->KQ$RBLK.DBLKX=RBLK$->KQ$RBLK.DBLKX+I;

  11419  1 005706   000017 236100                    LDQ     15,,PR0
         1 005707   777777 376007                    ANQ     -1,DL
         1 005710   200032 036100                    ADLQ    I,,AUTO
         1 005711   000000 620006                    EAX0    0,QL
         1 005712   000017 440100                    SXL0    15,,PR0

     1920    11420    3           ALTRETURN;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:261  

  11420  1 005713   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005714   000000 702211                    TSX2  ! 0,X1

     1921    11421    3           END;
     1922    11422    3         ELSE DO;

     1923    11423    3           RBLK$->KQ$RBLK.DBLKX=0;

  11423  1 005715   000000 220003                    LDX0    0,DU
         1 005716   000017 440100                    SXL0    15,,PR0

     1924    11424    3           RBLK$->KQ$RBLK.AUXFDN='1'B;

  11424  1 005717   020000 236007                    LDQ     8192,DL
         1 005720   000001 256100                    ORSQ    1,,PR0

     1925    11425    3           END;

     1926    11426    2         RETURN;

  11426  1 005721   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005722   000001 702211                    TSX2  ! 1,X1

     1927    11427    2   END XFAUEV;
     1928    11428        /****************************************************************
     1929    11429        *****************************************************************/
     1930    11430        /*D* NAME:         ACTQTN
     1931    11431             PURPOSE:      To call KQQ$ACT
     1932    11432             DESCRIPTION:  A read which causes KQU$UNLATCHF to be called
     1933    11433                           must decr CNACT in the Q-tree node where the
     1934    11434                           prev msg came from if it does not take another
     1935    11435                           message from that same node.
     1936    11436        */
     1937    11437    1   ACTQTN: PROC;

  11437  1 005723   200046 741300       ACTQTN       STX1  ! TIMCHK+2,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:262  

     1938    11438        /**/
     1939    11439        %LOCK (G=KQ$QTREE.GATE);

  11440  1 005724   200011 470500                    LDP0    CG$,,AUTO
         1 005725   000057 471500                    LDP1    47,,PR0
         1 005726   200054 451500                    STP1    R$+1,,AUTO
         1 005727   200054 630500                    EPPR0   R$+1,,AUTO
         1 005730   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005731   000000 701000 xent               TSX1    HFC$LOCK
         1 005732   000000 011000                    NOP     0

     1940    11442    2         ACTQTN$->KQ$QTN.CNACT=ACTQTN$->KQ$QTN.CNACT-1;

  11442  1 005733   200024 470500                    LDP0    ACTQTN$,,AUTO
         1 005734   000001 336007                    LCQ     1,DL
         1 005735   000044 056100                    ASQ     36,,PR0

     1941    11443    2         ACTQTN$->KQ$QTN.CRASHACT=ACTQTN$->KQ$QTN.CRASHACT-1;

  11443  1 005736   000050 720100                    LXL0    40,,PR0
         1 005737   777777 621010                    EAX1    -1,X0
         1 005740   000050 441100                    SXL1    40,,PR0

     1942    11444    2         IF ACTQTN$->KQ$QTN.CNACT < 0 THEN

  11444  1 005741   000044 235100                    LDA     36,,PR0
         1 005742   005745 605000 1                  TPL     s:11446

     1943    11445    2          CALL SC_CGCALZ; /* SEE S* IN KQU$UNLATCH */

  11445  1 005743   000000 713400 xsym               CLIMB   SC_CGCALZ
         1 005744   000000 600000 xsid               climb   nvectors=         0

     1944    11446    2         IF ACTQTN$->KQ$QTN.CNACT = ACTQTN$->KQ$QTN.MXACT-1 THEN

  11446  1 005745   200024 470500                    LDP0    ACTQTN$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:263  
         1 005746   000045 236100                    LDQ     37,,PR0
         1 005747   000001 136007                    SBLQ    1,DL
         1 005750   000044 116100                    CMPQ    36,,PR0
         1 005751   005763 601000 1                  TNZ     s:11451

     1945    11447    2          CALL KQQ$ACT (CG$->KQ$CG,ACTQTN$);

  11447  1 005752   200024 631500                    EPPR1   ACTQTN$,,AUTO
         1 005753   200055 451500                    STP1    R$+2,,AUTO
         1 005754   200011 236100                    LDQ     CG$,,AUTO
         1 005755   200054 756100                    STQ     R$+1,,AUTO
         1 005756   200054 630500                    EPPR0   R$+1,,AUTO
         1 005757   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 005760   000000 701000 xent               TSX1    KQQ$ACT
         1 005761   000000 011000                    NOP     0
         1 005762   005772 710000 1                  TRA     s:11454

     1946    11448    2         ELSE
     1947    11449    3           DO;

     1948    11450                %UNLOCK (G=KQ$QTREE.GATE);

  11451  1 005763   200011 471500                    LDP1    CG$,,AUTO
         1 005764   100057 473500                    LDP3    47,,PR1
         1 005765   200054 453500                    STP3    R$+1,,AUTO
         1 005766   200054 630500                    EPPR0   R$+1,,AUTO
         1 005767   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005770   000000 701000 xent               TSX1    HFC$UNLOCK
         1 005771   000000 011000                    NOP     0

     1949    11453    3           END;

     1950    11454    2         ACTQTN$=ADDR(NIL);

  11454  1 005772   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 005773   200024 756100                    STQ     ACTQTN$,,AUTO

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:264  
     1951    11455    2         RETURN;

  11455  1 005774   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 005775   000001 702211                    TSX2  ! 1,X1

     1952    11456    2   END ACTQTN;
     1953    11457        /****************************************************************
     1954    11458        *****************************************************************/
     1955    11459        /*D* NAME:         VRQKEY
     1956    11460             PURPOSE:      To verify the Q-key for a read
     1957    11461             DESCRIPTION:  The read key (MSGTYP or STATION) that keys the
     1958    11462                           Q-tree is verified.  ALTRET if the key is illegal,
     1959    11463                           with TYC set appropriately, else return.
     1960    11464                           N$REQ is the reading req packet.
     1961    11465                           KEY1L, KEY2L are the key lengths.
     1962    11466        */
     1963    11467    1   VRQKEY: PROC ALTRET;

  11467  1 005776   200046 741300       VRQKEY       STX1  ! TIMCHK+2,,AUTO

     1964    11468        /**/
     1965    11469    2   DCL TREE$ PTR;
     1966    11470        /**/
     1967    11471    2         IF KEY1L = 0 THEN RETURN;

  11471  1 005777   200025 235100                    LDA     KEY1L,,AUTO
         1 006000   006002 601000 1                  TNZ     s:11472

  11471  1 006001   000001 702211                    TSX2  ! 1,X1

     1968    11472    2         TREE$=CG$->KQ$CG.QUEUE.QTREE$;

  11472  1 006002   200011 470500                    LDP0    CG$,,AUTO
         1 006003   000057 236100                    LDQ     47,,PR0
         1 006004   200047 756100                    STQ     TREE$,,AUTO

     1969    11473              %LOCK (G=KQ$QTREE.GATE);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:265  

  11474  1 006005   000057 471500                    LDP1    47,,PR0
         1 006006   200054 451500                    STP1    R$+1,,AUTO
         1 006007   200054 630500                    EPPR0   R$+1,,AUTO
         1 006010   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 006011   000000 701000 xent               TSX1    HFC$LOCK
         1 006012   000000 011000                    NOP     0

     1970    11476    2         CALL VRQ ALTRET(ALTRT);

  11476  1 006013   006113 701000 1                  TSX1    VRQ
         1 006014   006023 702000 1                  TSX2    ALTRT

  11472  1 006015                       RTN          null
     1971    11477    2   RTN:  ;
     1972    11478              %UNLOCK (G=TREE$->KQ$THDR.GATE);

  11479  1 006015   200047 630500                    EPPR0   TREE$,,AUTO
         1 006016   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 006017   000000 701000 xent               TSX1    HFC$UNLOCK
         1 006020   000000 011000                    NOP     0

     1973    11481    2         RETURN;

  11481  1 006021   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 006022   000001 702211                    TSX2  ! 1,X1

  11472  1 006023                       ALTRT        null
     1974    11482    2   ALTRT:;
     1975    11483              %UNLOCK (G=TREE$->KQ$THDR.GATE);

  11484  1 006023   200047 630500                    EPPR0   TREE$,,AUTO
         1 006024   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 006025   000000 701000 xent               TSX1    HFC$UNLOCK
         1 006026   000000 011000                    NOP     0

  11484  1 006027                       ALTRTNL      null
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:266  
     1976    11486    2   ALTRTNL:;
     1977    11487    2         ALTRETURN;

  11487  1 006027   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 006030   000000 702211                    TSX2  ! 0,X1

     1978    11488        /*D* NAME:         VRQKEYNL
     1979    11489             PURPOSE:      To verify the Q-key for a read
     1980    11490             DESCRIPTION:  Like VRQKEY; does not lock or unlock Q-tree
     1981    11491        */
     1982    11492    2   VRQKEYNL: ENTRY ALTRET;

  11492  1 006031   200046 741300       VRQKEYNL     STX1  ! TIMCHK+2,,AUTO

     1983    11493        /**/
     1984    11494    2         IF KEY1L = 0 THEN RETURN;

  11494  1 006032   200025 235100                    LDA     KEY1L,,AUTO
         1 006033   006035 601000 1                  TNZ     s:11495

  11494  1 006034   000001 702211                    TSX2  ! 1,X1

     1985    11495    2         TREE$=CG$->KQ$CG.QUEUE.QTREE$;

  11495  1 006035   200011 470500                    LDP0    CG$,,AUTO
         1 006036   000057 236100                    LDQ     47,,PR0
         1 006037   200047 756100                    STQ     TREE$,,AUTO

     1986    11496    2         CALL VRQ ALTRET(ALTRTNL);

  11496  1 006040   006113 701000 1                  TSX1    VRQ
         1 006041   006027 702000 1                  TSX2    ALTRTNL

     1987    11497    2         RETURN;

  11497  1 006042   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 006043   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:267  

     1988    11498        /*D* NAME:         VRNQKEY
     1989    11499             PURPOSE:      To verify the non Q-key for a read
     1990    11500             DESCRIPTION:  The read key (MSGTYP or STATION) that does not
     1991    11501                           key the Q-tree is verified, as in VRQKEY.
     1992    11502        */
     1993    11503    2   VRNQKEY: ENTRY ALTRET;

  11503  1 006044   200046 741300       VRNQKEY      STX1  ! TIMCHK+2,,AUTO

     1994    11504        /**/
     1995    11505    2         IF KEY2L = 0 THEN RETURN;

  11505  1 006045   200026 235100                    LDA     KEY2L,,AUTO
         1 006046   006050 601000 1                  TNZ     s:11506

  11505  1 006047   000001 702211                    TSX2  ! 1,X1

     1996    11506    2         IF CG$->KQ$CG.QISS THEN TREE$=ADDR(CG$->KQ$CG.TTREE);

  11506  1 006050   200011 470500                    LDP0    CG$,,AUTO
         1 006051   000106 235100                    LDA     70,,PR0
         1 006052   006057 600000 1                  TZE     s:11507

  11506  1 006053   200011 236100                    LDQ     CG$,,AUTO
         1 006054   000067 036003                    ADLQ    55,DU
         1 006055   200047 756100                    STQ     TREE$,,AUTO
         1 006056   006062 710000 1                  TRA     s:11509

     1997    11507    2         ELSE TREE$=ADDR(CG$->KQ$CG.STREE);

  11507  1 006057   200011 236100                    LDQ     CG$,,AUTO
         1 006060   000075 036003                    ADLQ    61,DU
         1 006061   200047 756100                    STQ     TREE$,,AUTO

     1998    11508              %LOCK (G=TREE$->KQ$THDR.GATE);

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:268  
  11509  1 006062   200047 630500                    EPPR0   TREE$,,AUTO
         1 006063   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 006064   000000 701000 xent               TSX1    HFC$LOCK
         1 006065   000000 011000                    NOP     0

     1999    11511    2         CALL VRNQ ALTRET(ALTRT);

  11511  1 006066   006245 701000 1                  TSX1    VRNQ
         1 006067   006023 702000 1                  TSX2    ALTRT

     2000    11512    2         GOTO RTN;

  11512  1 006070   006015 710000 1                  TRA     RTN

     2001    11513        /*D* NAME:         VRNQKEYNL
     2002    11514             PURPOSE:      To verify the non Q-key for a read
     2003    11515             DESCRIPTION:  Like VRNQKEY; does not lock or unlock non Q-tree
     2004    11516        */
     2005    11517    2   VRNQKEYNL: ENTRY ALTRET;

  11517  1 006071   200046 741300       VRNQKEYNL    STX1  ! TIMCHK+2,,AUTO

     2006    11518    2         IF KEY2L = 0 THEN RETURN;

  11518  1 006072   200026 235100                    LDA     KEY2L,,AUTO
         1 006073   006075 601000 1                  TNZ     s:11519

  11518  1 006074   000001 702211                    TSX2  ! 1,X1

     2007    11519    2         IF CG$->KQ$CG.QISS THEN TREE$=ADDR(CG$->KQ$CG.TTREE);

  11519  1 006075   200011 470500                    LDP0    CG$,,AUTO
         1 006076   000106 235100                    LDA     70,,PR0
         1 006077   006104 600000 1                  TZE     s:11520

  11519  1 006100   200011 236100                    LDQ     CG$,,AUTO
         1 006101   000067 036003                    ADLQ    55,DU
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:269  
         1 006102   200047 756100                    STQ     TREE$,,AUTO
         1 006103   006107 710000 1                  TRA     s:11521

     2008    11520    2         ELSE TREE$=ADDR(CG$->KQ$CG.STREE);

  11520  1 006104   200011 236100                    LDQ     CG$,,AUTO
         1 006105   000075 036003                    ADLQ    61,DU
         1 006106   200047 756100                    STQ     TREE$,,AUTO

     2009    11521    2         CALL VRNQ ALTRET(ALTRTNL);

  11521  1 006107   006245 701000 1                  TSX1    VRNQ
         1 006110   006027 702000 1                  TSX2    ALTRTNL

     2010    11522    2         RETURN;

  11522  1 006111   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 006112   000001 702211                    TSX2  ! 1,X1

     2011    11523        /**/
     2012    11524    2   VRQ:  PROC ALTRET;

  11524  1 006113   200050 741300       VRQ          STX1  ! T$,,AUTO

     2013    11525        /**/
     2014    11526    3         IF KEY1L = 8 THEN

  11526  1 006114   200025 235100                    LDA     KEY1L,,AUTO
         1 006115   000010 115007                    CMPA    8,DL
         1 006116   006166 601000 1                  TNZ     s:11546

     2015    11527    4           DO;

     2016    11528                           /* SPECIFIC Q-KEY */
     2017    11529    4           CALL KQB$SRCH (KQ$QTREE,RBLK$->KQ$RBLK.KEY1,QTN$) ALTRET(VR1);

  11529  1 006117   200011 470500                    LDP0    CG$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:270  
         1 006120   000057 471500                    LDP1    47,,PR0
         1 006121   200034 633500                    EPPR3   QTN$,,AUTO
         1 006122   200056 453500                    STP3    R$+3,,AUTO
         1 006123   200007 236100                    LDQ     RBLK$,,AUTO
         1 006124   000002 036003                    ADLQ    2,DU
         1 006125   200055 756100                    STQ     R$+2,,AUTO
         1 006126   200054 451500                    STP1    R$+1,,AUTO
         1 006127   200054 630500                    EPPR0   R$+1,,AUTO
         1 006130   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 006131   000000 701000 xent               TSX1    KQB$SRCH
         1 006132   006137 702000 1                  TSX2    VR1

     2018    11530    4           CALL CHKSTA ALTRET(VR8);

  11530  1 006133   006364 701000 1                  TSX1    CHKSTA
         1 006134   006241 702000 1                  TSX2    VR8

     2019    11531    4           RETURN;

  11531  1 006135   200050 221300                    LDX1  ! T$,,AUTO
         1 006136   000001 702211                    TSX2  ! 1,X1

  11529  1 006137                       VR1          null
     2020    11532    4   VR1:    ;
     2021    11533    4           IF CG$->KQ$CG.XQTNLGL = '0'B

  11533  1 006137   200011 470500                    LDP0    CG$,,AUTO
         1 006140   000105 236100                    LDQ     69,,PR0
         1 006141   000002 316007                    CANQ    2,DL
         1 006142   006157 601000 1                  TNZ     s:11541

     2022    11534    5           THEN DO;

     2023    11535    5             IF KEY1L >= 1

  11535  1 006143   200025 235100                    LDA     KEY1L,,AUTO
         1 006144   006156 600000 1                  TZE     s:11539
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:271  
         1 006145   200007 471500                    LDP1    RBLK$,,AUTO
         1 006146   100002 236100                    LDQ     2,,PR1
         1 006147   777000 376003                    ANQ     -512,DU
         1 006150   052000 116003                    CMPQ    21504,DU
         1 006151   006156 601000 1                  TNZ     s:11539
         1 006152   000106 235100                    LDA     70,,PR0
         1 006153   006156 601000 1                  TNZ     s:11539

     2024    11536    5             AND SUBSTR(RBLK$->KQ$RBLK.KEY1,0,1) = '*'
     2025    11537    5             AND CG$->KQ$CG.QISS = '0'B
     2026    11538    5             THEN RETURN;

  11538  1 006154   200050 221300                    LDX1  ! T$,,AUTO
         1 006155   000001 702211                    TSX2  ! 1,X1

     2027    11539    5             GOTO VR7;

  11539  1 006156   006235 710000 1                  TRA     VR7

     2028    11540    5             END;
     2029    11541    4           IF (CG$->KQ$CG.QISS AND CG$->KQ$CG.AUCTL.RAS = '0'B)

  11541  1 006157   000106 235100                    LDA     70,,PR0
         1 006160   006164 600000 1                  TZE     s:11543
         1 006161   000133 236100                    LDQ     91,,PR0
         1 006162   000004 316007                    CANQ    4,DL
         1 006163   006241 600000 1                  TZE     VR8

     2030    11542    4           THEN GOTO VR8;
     2031    11543    4           RETURN;

  11543  1 006164   200050 221300                    LDX1  ! T$,,AUTO
         1 006165   000001 702211                    TSX2  ! 1,X1

     2032    11544    4           END;
     2033    11545                           /* WILD-CARDED Q-KEY */
     2034    11546    3         CALL KQB$SRCH (KQ$QTREE,RBLK$->KQ$RBLK.KEY1,QTN$) ALTRET(VR2);
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:272  

  11546  1 006166   200011 470500                    LDP0    CG$,,AUTO
         1 006167   000057 471500                    LDP1    47,,PR0
         1 006170   200034 633500                    EPPR3   QTN$,,AUTO
         1 006171   200056 453500                    STP3    R$+3,,AUTO
         1 006172   200007 236100                    LDQ     RBLK$,,AUTO
         1 006173   000002 036003                    ADLQ    2,DU
         1 006174   200055 756100                    STQ     R$+2,,AUTO
         1 006175   200054 451500                    STP1    R$+1,,AUTO
         1 006176   200054 630500                    EPPR0   R$+1,,AUTO
         1 006177   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 006200   000000 701000 xent               TSX1    KQB$SRCH
         1 006201   006203 702000 1                  TSX2    VR2

     2035    11547    3         GOTO VR5;

  11547  1 006202   006231 710000 1                  TRA     VR5

  11541  1 006203                       VR2          null
     2036    11548    3   VR2:  ;
     2037    11549    3         IF QTN$ = ADDR(NIL) THEN GOTO VR1;

  11549  1 006203   200034 236100                    LDQ     QTN$,,AUTO
         1 006204   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006205   006137 600000 1                  TZE     VR1

     2038    11550    3         IF ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1 <=

  11550  1 006206   200034 470500                    LDP0    QTN$,,AUTO
         1 006207   200025 720100                    LXL0    KEY1L,,AUTO
         1 006210   200007 471500                    LDP1    RBLK$,,AUTO
         1 006211   040140 106540                    CMPC    fill='040'O
         1 006212   000005 000010                    ADSC9   5,,PR0                   cn=0,n=*X0
         1 006213   100002 000010                    ADSC9   2,,PR1                   cn=0,n=*X0
         1 006214   006222 603000 1                  TRC     VR4

  11550  1 006215                       VR3          null
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:273  
     2039    11551    3         ADDR(QTN$->KQ$QTN.STA.BTN.KEY)->B$$KEY1 THEN GOTO VR4;
     2040    11552    3   VR3:  ;
     2041    11553    3         QTN$=QTN$->KQ$QTN.STA.BTN.FLINK$;

  11553  1 006215   200034 470500                    LDP0    QTN$,,AUTO
         1 006216   000004 236100                    LDQ     4,,PR0
         1 006217   200034 756100                    STQ     QTN$,,AUTO

     2042    11554    3         IF QTN$ = ADDR(NIL) THEN GOTO VR1;

  11554  1 006220   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006221   006137 600000 1                  TZE     VR1

  11554  1 006222                       VR4          null
     2043    11555    3   VR4:  ;
     2044    11556    3         IF ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1 =

  11556  1 006222   200007 470500                    LDP0    RBLK$,,AUTO
         1 006223   200025 720100                    LXL0    KEY1L,,AUTO
         1 006224   200034 471500                    LDP1    QTN$,,AUTO
         1 006225   040140 106540                    CMPC    fill='040'O
         1 006226   000002 000010                    ADSC9   2,,PR0                   cn=0,n=*X0
         1 006227   100005 000010                    ADSC9   5,,PR1                   cn=0,n=*X0
         1 006230   006233 601000 1                  TNZ     s:11559

     2045    11557    3         ADDR(QTN$->KQ$QTN.STA.BTN.KEY)->B$$KEY1 THEN
     2046    11558    3   VR5:   CALL CHKSTA ALTRET(VR3);

  11558  1 006231   006364 701000 1     VR5          TSX1    CHKSTA
         1 006232   006215 702000 1                  TSX2    VR3

     2047    11559    3         RETURN;

  11559  1 006233   200050 221300                    LDX1  ! T$,,AUTO
         1 006234   000001 702211                    TSX2  ! 1,X1

  11556  1 006235                       VR7          null
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:274  
     2048    11560    3   VR7:  ;
     2049    11561    3         TYC=%TYC_CGKEYV;

  11561  1 006235   000046 236000 0                  LDQ     ERR_NODAT+8
         1 006236   200040 756100                    STQ     TYC,,AUTO

     2050    11562    3         ALTRETURN;

  11562  1 006237   200050 221300                    LDX1  ! T$,,AUTO
         1 006240   000000 702211                    TSX2  ! 0,X1

  11561  1 006241                       VR8          null
     2051    11563    3   VR8:  ;
     2052    11564    3         TYC=%TYC_DISC;

  11564  1 006241   000047 236000 0                  LDQ     ERR_NODAT+9
         1 006242   200040 756100                    STQ     TYC,,AUTO

     2053    11565    3         ALTRETURN;

  11565  1 006243   200050 221300                    LDX1  ! T$,,AUTO
         1 006244   000000 702211                    TSX2  ! 0,X1

     2054    11566        /**/
     2055    11567    3   VRNQ: ENTRY ALTRET;

  11567  1 006245   200050 741300       VRNQ         STX1  ! T$,,AUTO

     2056    11568        /**/
     2057    11569    3         IF KEY2L = 8 THEN

  11569  1 006246   200026 235100                    LDA     KEY2L,,AUTO
         1 006247   000010 115007                    CMPA    8,DL
         1 006250   006316 601000 1                  TNZ     s:11589

     2058    11570    4           DO;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:275  
     2059    11571                                /* SPECIFIC KEY */
     2060    11572    4           CALL KQB$SRCH (TREE$->KQ$THDR,RBLK$->KQ$RBLK.KEY2,QTN$) ALTRET(VRNQ1);

  11572  1 006251   200034 630500                    EPPR0   QTN$,,AUTO
         1 006252   200056 450500                    STP0    R$+3,,AUTO
         1 006253   200007 236100                    LDQ     RBLK$,,AUTO
         1 006254   000004 036003                    ADLQ    4,DU
         1 006255   200047 235100                    LDA     TREE$,,AUTO
         1 006256   200054 757100                    STAQ    R$+1,,AUTO
         1 006257   200054 630500                    EPPR0   R$+1,,AUTO
         1 006260   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 006261   000000 701000 xent               TSX1    KQB$SRCH
         1 006262   006267 702000 1                  TSX2    VRNQ1

     2061    11573    4           CALL CHKSTANQ ALTRET(VR8);

  11573  1 006263   006406 701000 1                  TSX1    CHKSTANQ
         1 006264   006241 702000 1                  TSX2    VR8

     2062    11574    4           RETURN;

  11574  1 006265   200050 221300                    LDX1  ! T$,,AUTO
         1 006266   000001 702211                    TSX2  ! 1,X1

  11572  1 006267                       VRNQ1        null
     2063    11575    4   VRNQ1:  ;
     2064    11576    4           IF CG$->KQ$CG.XOTNLGL = '0'B

  11576  1 006267   200011 470500                    LDP0    CG$,,AUTO
         1 006270   000105 236100                    LDQ     69,,PR0
         1 006271   000001 316007                    CANQ    1,DL
         1 006272   006307 601000 1                  TNZ     s:11584

     2065    11577    5           THEN DO;

     2066    11578    5             IF KEY2L >= 1

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:276  
  11578  1 006273   200026 235100                    LDA     KEY2L,,AUTO
         1 006274   006306 600000 1                  TZE     s:11582
         1 006275   200007 471500                    LDP1    RBLK$,,AUTO
         1 006276   100004 236100                    LDQ     4,,PR1
         1 006277   777000 376003                    ANQ     -512,DU
         1 006300   052000 116003                    CMPQ    21504,DU
         1 006301   006306 601000 1                  TNZ     s:11582
         1 006302   000106 235100                    LDA     70,,PR0
         1 006303   006306 600000 1                  TZE     s:11582

     2067    11579    5             AND SUBSTR(RBLK$->KQ$RBLK.KEY2,0,1) = '*'
     2068    11580    5             AND CG$->KQ$CG.QISS
     2069    11581    5             THEN RETURN;

  11581  1 006304   200050 221300                    LDX1  ! T$,,AUTO
         1 006305   000001 702211                    TSX2  ! 1,X1

     2070    11582    5             GOTO VR7;

  11582  1 006306   006235 710000 1                  TRA     VR7

     2071    11583    5             END;
     2072    11584    4           IF (CG$->KQ$CG.QISS = '0'B AND CG$->KQ$CG.AUCTL.RAS = '0'B)

  11584  1 006307   000106 235100                    LDA     70,,PR0
         1 006310   006314 601000 1                  TNZ     s:11586
         1 006311   000133 236100                    LDQ     91,,PR0
         1 006312   000004 316007                    CANQ    4,DL
         1 006313   006241 600000 1                  TZE     VR8

     2073    11585    4           THEN GOTO VR8;
     2074    11586    4           RETURN;

  11586  1 006314   200050 221300                    LDX1  ! T$,,AUTO
         1 006315   000001 702211                    TSX2  ! 1,X1

     2075    11587    4           END;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:277  
     2076    11588                                /* WILD-CARDED KEY */
     2077    11589    3         CALL KQB$SRCH (TREE$->KQ$THDR,RBLK$->KQ$RBLK.KEY2,QTN$) ALTRET(VRNQ2);

  11589  1 006316   200034 630500                    EPPR0   QTN$,,AUTO
         1 006317   200056 450500                    STP0    R$+3,,AUTO
         1 006320   200007 236100                    LDQ     RBLK$,,AUTO
         1 006321   000004 036003                    ADLQ    4,DU
         1 006322   200047 235100                    LDA     TREE$,,AUTO
         1 006323   200054 757100                    STAQ    R$+1,,AUTO
         1 006324   200054 630500                    EPPR0   R$+1,,AUTO
         1 006325   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 006326   000000 701000 xent               TSX1    KQB$SRCH
         1 006327   006331 702000 1                  TSX2    VRNQ2

     2078    11590    3         GOTO VRNQ5;

  11590  1 006330   006357 710000 1                  TRA     VRNQ5

  11585  1 006331                       VRNQ2        null
     2079    11591    3   VRNQ2:;
     2080    11592    3         IF QTN$ = ADDR(NIL) THEN GOTO VRNQ1;

  11592  1 006331   200034 236100                    LDQ     QTN$,,AUTO
         1 006332   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006333   006267 600000 1                  TZE     VRNQ1

     2081    11593    3         IF ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2 <=

  11593  1 006334   200034 470500                    LDP0    QTN$,,AUTO
         1 006335   200026 720100                    LXL0    KEY2L,,AUTO
         1 006336   200007 471500                    LDP1    RBLK$,,AUTO
         1 006337   040140 106540                    CMPC    fill='040'O
         1 006340   000005 000010                    ADSC9   5,,PR0                   cn=0,n=*X0
         1 006341   100004 000010                    ADSC9   4,,PR1                   cn=0,n=*X0
         1 006342   006350 603000 1                  TRC     VRNQ4

  11593  1 006343                       VRNQ3        null
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:278  
     2082    11594    3         ADDR(QTN$->KQ$QTN.STA.BTN.KEY)->B$$KEY2 THEN GOTO VRNQ4;
     2083    11595    3   VRNQ3:;
     2084    11596    3         QTN$=QTN$->KQ$QTN.STA.BTN.FLINK$;

  11596  1 006343   200034 470500                    LDP0    QTN$,,AUTO
         1 006344   000004 236100                    LDQ     4,,PR0
         1 006345   200034 756100                    STQ     QTN$,,AUTO

     2085    11597    3         IF QTN$ = ADDR(NIL) THEN GOTO VRNQ1;

  11597  1 006346   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006347   006267 600000 1                  TZE     VRNQ1

  11597  1 006350                       VRNQ4        null
     2086    11598    3   VRNQ4:;
     2087    11599    3         IF ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2 =

  11599  1 006350   200007 470500                    LDP0    RBLK$,,AUTO
         1 006351   200026 720100                    LXL0    KEY2L,,AUTO
         1 006352   200034 471500                    LDP1    QTN$,,AUTO
         1 006353   040140 106540                    CMPC    fill='040'O
         1 006354   000004 000010                    ADSC9   4,,PR0                   cn=0,n=*X0
         1 006355   100005 000010                    ADSC9   5,,PR1                   cn=0,n=*X0
         1 006356   006363 601000 1                  TNZ     s:11606

     2088    11600    3         ADDR(QTN$->KQ$QTN.STA.BTN.KEY)->B$$KEY2 THEN
     2089    11601    4           DO;

  11599  1 006357                       VRNQ5        null
     2090    11602    4   VRNQ5:  ;
     2091    11603    4           CALL CHKSTANQ ALTRET(VRNQ3);

  11603  1 006357   006406 701000 1                  TSX1    CHKSTANQ
         1 006360   006343 702000 1                  TSX2    VRNQ3

     2092    11604    4           RETURN;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:279  
  11604  1 006361   200050 221300                    LDX1  ! T$,,AUTO
         1 006362   000001 702211                    TSX2  ! 1,X1

     2093    11605    4           END;
     2094    11606    3         GOTO VRNQ1;

  11606  1 006363   006267 710000 1                  TRA     VRNQ1

     2095    11607    3   END VRQ;
     2096    11608    2   END VRQKEY;
     2097    11609        /****************************************************************
     2098    11610        *****************************************************************/
     2099    11611        /*D* NAME:         CHKSTA
     2100    11612             PURPOSE:      To check if a node is legal if it's a station
     2101    11613             DESCRIPTION:  QTN$ points to a node in the Q-tree (CHKSTA)
     2102    11614                           or the other tree (CHKSTANQ).  If the tree involved
     2103    11615                           is the station tree, then if the station pointed
     2104    11616                           to is disconnected or deactivated, we ALTRET,
     2105    11617                           if RAS is illegal, or the other key begins with
     2106    11618                           '*' (i.e. the message type begins with '*'
     2107    11619                           - this is required in order to make M$GLINEATTR
     2108    11620                           and M$SETFP work).
     2109    11621                           In all other cases, normal return.
     2110    11622                           The tree must be locked.
     2111    11623        */
     2112    11624    1   CHKSTA: PROC ALTRET;

  11624  1 006364   200052 741300       CHKSTA       STX1  ! P$,,AUTO

     2113    11625        /**/
     2114    11626    2         IF CG$->KQ$CG.QISS = '0'B THEN RETURN;

  11626  1 006365   200011 470500                    LDP0    CG$,,AUTO
         1 006366   000106 235100                    LDA     70,,PR0
         1 006367   006371 601000 1                  TNZ     s:11627

  11626  1 006370   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:280  

     2115    11627    2         IF CG$->KQ$CG.AUCTL.RAS THEN

  11627  1 006371   000133 236100                    LDQ     91,,PR0
         1 006372   000004 316007                    CANQ    4,DL
         1 006373   006405 600000 1                  TZE     s:11632

     2116    11628    3           DO;

     2117    11629    3           IF KEY2L = 0 THEN RETURN;

  11629  1 006374   200026 235100                    LDA     KEY2L,,AUTO
         1 006375   006377 601000 1                  TNZ     s:11630

  11629  1 006376   000001 702211                    TSX2  ! 1,X1

     2118    11630    3           IF SUBSTR (RBLK$->KQ$RBLK.KEY2,0,1) ~= '*' THEN RETURN;

  11630  1 006377   200007 471500                    LDP1    RBLK$,,AUTO
         1 006400   100004 236100                    LDQ     4,,PR1
         1 006401   777000 376003                    ANQ     -512,DU
         1 006402   052000 116003                    CMPQ    21504,DU
         1 006403   006405 600000 1                  TZE     s:11632

  11630  1 006404   000001 702211                    TSX2  ! 1,X1

     2119    11631    3           END;
     2120    11632    2         GOTO CHK;

  11632  1 006405   006427 710000 1                  TRA     CHK

     2121    11633    2   CHKSTANQ: ENTRY ALTRET;

  11633  1 006406   200052 741300       CHKSTANQ     STX1  ! P$,,AUTO

     2122    11634    2         IF CG$->KQ$CG.QISS THEN RETURN;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:281  
  11634  1 006407   200011 470500                    LDP0    CG$,,AUTO
         1 006410   000106 235100                    LDA     70,,PR0
         1 006411   006413 600000 1                  TZE     s:11635

  11634  1 006412   000001 702211                    TSX2  ! 1,X1

     2123    11635    2         IF CG$->KQ$CG.AUCTL.RAS THEN

  11635  1 006413   000133 236100                    LDQ     91,,PR0
         1 006414   000004 316007                    CANQ    4,DL
         1 006415   006427 600000 1                  TZE     CHK

     2124    11636    3           DO;

     2125    11637    3           IF KEY1L = 0 THEN RETURN;

  11637  1 006416   200025 235100                    LDA     KEY1L,,AUTO
         1 006417   006421 601000 1                  TNZ     s:11638

  11637  1 006420   000001 702211                    TSX2  ! 1,X1

     2126    11638    3           IF SUBSTR(RBLK$->KQ$RBLK.KEY1,0,1) ~= '*' THEN RETURN;

  11638  1 006421   200007 471500                    LDP1    RBLK$,,AUTO
         1 006422   100002 236100                    LDQ     2,,PR1
         1 006423   777000 376003                    ANQ     -512,DU
         1 006424   052000 116003                    CMPQ    21504,DU
         1 006425   006427 600000 1                  TZE     CHK

  11638  1 006426   000001 702211                    TSX2  ! 1,X1

  11635  1 006427                       CHK          null
     2127    11639    3           END;
     2128    11640    2   CHK:  ;
     2129    11641    2         IF QTN$->KQ$STA.LDCT$ = ADDR(NIL) THEN ALTRETURN;

  11641  1 006427   200034 471500                    LDP1    QTN$,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:282  
         1 006430   100010 236100                    LDQ     8,,PR1
         1 006431   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006432   006434 601000 1                  TNZ     s:11642

  11641  1 006433   000000 702211                    TSX2  ! 0,X1

     2130    11642    2         IF QTN$->KQ$STA.LDCT$->NK$LDCT.LKFLG.ACTIVE = '0'B THEN ALTRETURN;

  11642  1 006434   100010 473500                    LDP3    8,,PR1
         1 006435   300011 236100                    LDQ     9,,PR3
         1 006436   000040 316003                    CANQ    32,DU
         1 006437   006441 601000 1                  TNZ     s:11643

  11642  1 006440   000000 702211                    TSX2  ! 0,X1

     2131    11643    2         RETURN;

  11643  1 006441   000001 702211                    TSX2  ! 1,X1

     2132    11644    2   END CHKSTA;
     2133    11645        /****************************************************************
     2134    11646        *****************************************************************/
     2135    11647        /*D* NAME:         SETRCOMP
     2136    11648             PURPOSE:      To set up for COMPing a read
     2137    11649             DESCRIPTION:  RBLK$ points to the RBLK, N$REQ is the
     2138    11650                           request packet, LDCT$ points to the reader's
     2139    11651                           LDCT, MBLK$ points to the MBLK.
     2140    11652
     2141    11653                           NILs out the LDCT.IOQ$, sets the
     2142    11654                           VLP_STATION in auto with the params for the
     2143    11655                           COMP, and sets the reader's N$REQ.DVE up
     2144    11656                           (setting DVE.DVBYTE.CONT zero).
     2145    11657        */
     2146    11658    1   SETRCOMP: PROC;

  11658  1 006442   200046 741300       SETRCOMP     STX1  ! TIMCHK+2,,AUTO

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:283  
     2147    11659        /**/
     2148    11660    2         LDCT$->NK$LDCT.IOQ$=ADDR(NIL);

  11660  1 006443   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 006444   200005 470500                    LDP0    LDCT$,,AUTO
         1 006445   000001 756100                    STQ     1,,PR0

     2149    11661    2         N$REQ.STATION.LSTA$=ADDR(VLP_STATION);

  11661  1 006446   200012 631500                    EPPR1   VLP_STATION,,AUTO
         1 006447   200004 473500                    LDP3    IOQ$,,AUTO
         1 006450   300013 451500                    STP1    11,,PR3

     2150    11662    2         VLP_STATION.CTL=KC_VLPSTATION.CTL;

  11662  1 006451   000004 236000 xsym               LDQ     KC_VLPSTATION+4
         1 006452   200016 676100                    ERQ     VLP_STATION+4,,AUTO
         1 006453   777400 376003                    ANQ     -256,DU
         1 006454   200016 656100                    ERSQ    VLP_STATION+4,,AUTO

     2151    11663    2         VLP_STATION.MSGID=MBLK$->KQ$MBLK.MID.PRIMARY;

  11663  1 006455   200010 471500                    LDP1    MBLK$,,AUTO
         1 006456   100014 235100                    LDA     12,,PR1
         1 006457   200017 755100                    STA     VLP_STATION+5,,AUTO

     2152    11664    2         VLP_STATION.MSGIDXT=BINBIT(MBLK$->KQ$MBLK.MID.XT,36);

  11664  1 006460   100015 236100                    LDQ     13,,PR1
         1 006461   200020 756100                    STQ     VLP_STATION+6,,AUTO

     2153    11665    2         IF CG$->KQ$CG.QISS THEN

  11665  1 006462   200011 474500                    LDP4    CG$,,AUTO
         1 006463   400106 235100                    LDA     70,,PR4
         1 006464   006472 600000 1                  TZE     s:11672

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:284  
     2154    11666    3           DO;

     2155    11667    3           VLP_STATION.STATION=MBLK$->KQ$MBLK.KEY1;

  11667  1 006465   100002 237100                    LDAQ    2,,PR1
         1 006466   200012 757100                    STAQ    VLP_STATION,,AUTO

     2156    11668    3           VLP_STATION.MSGTYP =MBLK$->KQ$MBLK.KEY2;

  11668  1 006467   100004 237100                    LDAQ    4,,PR1
         1 006470   200014 757100                    STAQ    VLP_STATION+2,,AUTO

     2157    11669    3           END;

  11669  1 006471   006476 710000 1                  TRA     s:11675

     2158    11670    2         ELSE
     2159    11671    3           DO;

     2160    11672    3           VLP_STATION.STATION=MBLK$->KQ$MBLK.KEY2;

  11672  1 006472   100004 237100                    LDAQ    4,,PR1
         1 006473   200012 757100                    STAQ    VLP_STATION,,AUTO

     2161    11673    3           VLP_STATION.MSGTYP =MBLK$->KQ$MBLK.KEY1;

  11673  1 006474   100002 237100                    LDAQ    2,,PR1
         1 006475   200014 757100                    STAQ    VLP_STATION+2,,AUTO

     2162    11674    3           END;

     2163    11675    2         N$REQ.DVE        =MBLK$->KQ$MBLK.DVE;

  11675  1 006476   000100 100500                    MLR     fill='000'O
         1 006477   100010 200002                    ADSC9   8,,PR1                   cn=1,n=2
         1 006500   200054 000004                    ADSC9   R$+1,,AUTO               cn=0,n=4
         1 006501   200054 220100                    LDX0    R$+1,,AUTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:285  
         1 006502   300031 740100                    STX0    25,,PR3

     2164    11676    2         N$REQ.DVE.DVBYTE.CONT='0'B;

  11676  1 006503   000044 236000 2                  LDQ     36
         1 006504   300031 356100                    ANSQ    25,,PR3

     2165    11677    2         N$REQ.TYC=N$REQ.TYC|MBLK$->KQ$MBLK.TYC;

  11677  1 006505   300021 236100                    LDQ     17,,PR3
         1 006506   100013 276100                    ORQ     11,,PR1
         1 006507   300021 756100                    STQ     17,,PR3

     2166    11678    2         RETURN;

  11678  1 006510   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 006511   000001 702211                    TSX2  ! 1,X1

     2167    11679    2   END SETRCOMP;
     2168    11680        /****************************************************************
     2169    11681        *****************************************************************/
     2170    11682        /*D* NAME:         SETUP
     2171    11683             PURPOSE:      To set up goodies common to most entry points.
     2172    11684        */
     2173    11685    1   SETUP: PROC;

  11685  1 006512   200046 741300       SETUP        STX1  ! TIMCHK+2,,AUTO

     2174    11686        /**/
     2175    11687    2         IOQ$=ADDR(N$RREQ);

  11687  1 006513   200003 236100                    LDQ     @N$RREQ,,AUTO
         1 006514   200004 756100                    STQ     IOQ$,,AUTO
         1 006515   006517 710000 1                  TRA     s:11689

     2176    11688    2   SETUP1: ENTRY;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:286  
  11688  1 006516   200046 741300       SETUP1       STX1  ! TIMCHK+2,,AUTO

     2177    11689    2         LDCT$=NK$LDCT$(N$REQ.DLA.DCTX);

  11689  1 006517   200004 470500                    LDP0    IOQ$,,AUTO
         1 006520   000001 236100                    LDQ     1,,PR0
         1 006521   000025 772000                    QRL     21
         1 006522   000000 471400 xsym               LDP1    N$DCT$$
         1 006523   100000 236106                    LDQ     0,QL,PR1
         1 006524   200005 756100                    STQ     LDCT$,,AUTO

     2178    11690    2         STA$=LDCT$->NK$LDCT.STA$;

  11690  1 006525   200005 473500                    LDP3    LDCT$,,AUTO
         1 006526   300012 236100                    LDQ     10,,PR3
         1 006527   200006 756100                    STQ     STA$,,AUTO

     2179    11691    2         CG$=LDCT$->NK$LDCT.CG$;

  11691  1 006530   300027 236100                    LDQ     23,,PR3
         1 006531   200011 756100                    STQ     CG$,,AUTO

     2180    11692    2         CALL KQX$LDASR (CG$->KQ$CG);

  11692  1 006532   200011 630500                    EPPR0   CG$,,AUTO
         1 006533   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 006534   000000 701000 xent               TSX1    KQX$LDASR
         1 006535   000000 011000                    NOP     0

     2181    11693    2         RBLK$=STA$->KQ$STA.RBLK$;

  11693  1 006536   200006 470500                    LDP0    STA$,,AUTO
         1 006537   000011 236100                    LDQ     9,,PR0
         1 006540   200007 756100                    STQ     RBLK$,,AUTO

     2182    11694    2         ACTQTN$=ADDR(NIL);

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:287  
  11694  1 006541   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 006542   200024 756100                    STQ     ACTQTN$,,AUTO

     2183    11695    2         RETURN;

  11695  1 006543   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 006544   000001 702211                    TSX2  ! 1,X1

     2184    11696    2   END SETUP;
     2185    11697        /****************************************************************
     2186    11698        *****************************************************************/
     2187    11699        /*D* NAME:         CHKACT
     2188    11700             PURPOSE:      To error a read if the station has been
     2189    11701                           deactivated, or activated with a TYC
     2190    11702             DESCRIPTION:  ALTRETs with N$REQ.TYC set appropriately if
     2191    11703                           either is true.  Else returns.
     2192    11704        */
     2193    11705    1   CHKACT: PROC ALTRET;

  11705  1 006545   200046 741300       CHKACT       STX1  ! TIMCHK+2,,AUTO

     2194    11706        /**/
     2195    11707    2         IF LDCT$->NK$LDCT.LKFLG.ACTIVE = '0'B THEN

  11707  1 006546   200005 470500                    LDP0    LDCT$,,AUTO
         1 006547   000011 236100                    LDQ     9,,PR0
         1 006550   000040 316003                    CANQ    32,DU
         1 006551   006557 601000 1                  TNZ     s:11712

     2196    11708    3           DO;

     2197    11709    3           N$REQ.TYC=%TYC_DACT;

  11709  1 006552   000057 236000 0                  LDQ     ERR_NODAT+17
         1 006553   200004 471500                    LDP1    IOQ$,,AUTO
         1 006554   100021 756100                    STQ     17,,PR1

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:288  
     2198    11710    3           ALTRETURN;

  11710  1 006555   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 006556   000000 702211                    TSX2  ! 0,X1

     2199    11711    3           END;
     2200    11712    2         IF STA$->KQ$STA.ACTTYC THEN

  11712  1 006557   200006 471500                    LDP1    STA$,,AUTO
         1 006560   100013 235100                    LDA     11,,PR1
         1 006561   006575 600000 1                  TZE     s:11720

     2201    11713    3           DO;

     2202    11714    3           ATFLG = 1;

  11714  1 006562   000001 235007                    LDA     1,DL
         1 006563   200043 755100                    STA     ATFLG,,AUTO

     2203    11715    3           N$REQ.TYC=STA$->KQ$STA.ACTTYC;

  11715  1 006564   100013 236100                    LDQ     11,,PR1
         1 006565   200004 473500                    LDP3    IOQ$,,AUTO
         1 006566   300021 756100                    STQ     17,,PR3

     2204    11716    3           IF NOT STA$->KQ$STA.ABTET THEN

  11716  1 006567   100020 236100                    LDQ     16,,PR1
         1 006570   002000 316003                    CANQ    1024,DU
         1 006571   006573 601000 1                  TNZ     s:11718

     2205    11717    3            STA$->KQ$STA.ACTTYC='0'B;

  11717  1 006572   100013 450100                    STZ     11,,PR1

     2206    11718    3           ALTRETURN;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:289  
  11718  1 006573   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 006574   000000 702211                    TSX2  ! 0,X1

     2207    11719    3           END;
     2208    11720    2         RETURN;

  11720  1 006575   000001 702211                    TSX2  ! 1,X1

     2209    11721    2   END CHKACT;
     2210    11722        /****************************************************************
     2211    11723        *****************************************************************/
     2212    11724        /*D* NAME:         MAPBUF
     2213    11725             PURPOSE:      To map a read buffer for later transfer
     2214    11726             DESCRIPTION:  The reading buffer specification is translated
     2215    11727                           into a pointer, a bufsize, and 2 page table
     2216    11728                           words, such that if the latter 2 are stuffed
     2217    11729                           into words 0,1 of the comgroup page table,
     2218    11730                           the pointer will access the buffer.  This
     2219    11731                           info is used later when the read is satisfied
     2220    11732                           and the data is being moved.  ALTRETs if the
     2221    11733                           buffer is bad.
     2222    11734        */
     2223    11735    1   MAPBUF: PROC ALTRET;

  11735  1 006576   200046 741300       MAPBUF       STX1  ! TIMCHK+2,,AUTO

     2224    11736        /**/
     2225    11737    2   DCL UB$ PTR;
     2226    11738    2   DCL PSTMP UBIN WORD;
     2227    11739        /**/
     2228    11740    2         IF RBLK$->KQ$RBLK.MAPD THEN RETURN;

  11740  1 006577   200007 470500                    LDP0    RBLK$,,AUTO
         1 006600   000001 236100                    LDQ     1,,PR0
         1 006601   200000 316007                    CANQ    65536,DL
         1 006602   006604 600000 1                  TZE     s:11741

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:290  
  11740  1 006603   000001 702211                    TSX2  ! 1,X1

     2229    11741    2         UB$=RBLK$->KQ$RBLK.BUF$;

  11741  1 006604   000013 236100                    LDQ     11,,PR0
         1 006605   200047 756100                    STQ     UB$,,AUTO

     2230    11742    2         IF N$REQ.OPFLG.USER THEN

  11742  1 006606   200004 471500                    LDP1    IOQ$,,AUTO
         1 006607   100004 236100                    LDQ     4,,PR1
         1 006610   000400 316007                    CANQ    256,DL
         1 006611   006625 600000 1                  TZE     s:11748

     2231    11743    3           DO;

     2232    11744    3           PSTMP=ADDR(UB$)->B$$PTRR.SEGID;

  11744  1 006612   200047 236100                    LDQ     UB$,,AUTO
         1 006613   007777 376007                    ANQ     4095,DL
         1 006614   200050 756100                    STQ     PSTMP,,AUTO

     2233    11745    3           IF PSTMP <= BITBIN('1777'O) THEN

  11745  1 006615   002000 116007                    CMPQ    1024,DL
         1 006616   006625 603000 1                  TRC     s:11748

     2234    11746    3            CALL HFF$WRITE1 (PSTMP) ALTRET(BADBUF);

  11746  1 006617   200050 633500                    EPPR3   PSTMP,,AUTO
         1 006620   200054 453500                    STP3    R$+1,,AUTO
         1 006621   200054 630500                    EPPR0   R$+1,,AUTO
         1 006622   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 006623   000000 701000 xent               TSX1    HFF$WRITE1
         1 006624   006653 702000 1                  TSX2    BADBUF

     2235    11747    3           END;
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:291  

     2236    11748    2         CALL MMS$SETUP_BUF (,UB$,RBLK$->KQ$RBLK.BUFSIZE,RBLK$->KQ$RBLK.BUF$,RBLK$->
             11748                  KQ$RBLK.PTW);

  11748  1 006625   200007 236100                    LDQ     RBLK$,,AUTO
         1 006626   000014 036003                    ADLQ    12,DU
         1 006627   200060 756100                    STQ     R$+5,,AUTO
         1 006630   200007 236100                    LDQ     RBLK$,,AUTO
         1 006631   000013 036003                    ADLQ    11,DU
         1 006632   200057 756100                    STQ     R$+4,,AUTO
         1 006633   200007 236100                    LDQ     RBLK$,,AUTO
         1 006634   000016 036003                    ADLQ    14,DU
         1 006635   200056 756100                    STQ     R$+3,,AUTO
         1 006636   200047 630500                    EPPR0   UB$,,AUTO
         1 006637   200055 450500                    STP0    R$+2,,AUTO
         1 006640   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 006641   200054 756100                    STQ     R$+1,,AUTO
         1 006642   200054 630500                    EPPR0   R$+1,,AUTO
         1 006643   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 006644   000000 701000 xent               TSX1    MMS$SETUP_BUF
         1 006645   000000 011000                    NOP     0

     2237    11749    2         RBLK$->KQ$RBLK.MAPD='1'B;

  11749  1 006646   200007 470500                    LDP0    RBLK$,,AUTO
         1 006647   200000 236007                    LDQ     65536,DL
         1 006650   000001 256100                    ORSQ    1,,PR0

     2238    11750    2         RETURN;

  11750  1 006651   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 006652   000001 702211                    TSX2  ! 1,X1

  11749  1 006653                       BADBUF       null
     2239    11751    2   BADBUF:;
     2240    11752    2         ALTRETURN;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:292  
  11752  1 006653   200046 221300                    LDX1  ! TIMCHK+2,,AUTO
         1 006654   000000 702211                    TSX2  ! 0,X1

DUFPT
 Sect OctLoc
   0     000   000003 777640   000006 006000   000000 177640   000000 006014    ................
   0     004   000000 177640   000000 006014   000000 002001   240000 000000    ................
   0     010   000000 000000   ****** ******                                    ........

RUFPT
 Sect OctLoc
   0     012   000003 777640   000020 006000   000000 177640   000000 006014    ................
   0     016   000000 177640   000000 006014   000000 003002   240000 000000    ................
   0     022   000000 000000   ****** ******                                    ........

HUFPT
 Sect OctLoc
   0     024   000003 777640   000032 006000   000000 177640   000000 006014    ................
   0     030   000000 177640   000000 006014   000000 001002   440000 000000    ................
   0     034   000000 000000   ****** ******                                    ........

ERR_NODAT
 Sect OctLoc
   0     036   132222 421004                                                    Z...

(unnamed)
 Sect OctLoc
   0     037   000000 200000   052106 120101   102124 040040   002000 000000    ....*FPABT  ....
   0     043   000400 000000   000100 000000   000000 010000   000000 100000    .....@........@.
   0     047   000040 000000   000000 020000   000000 004000   004000 000000    . ..............
   0     053   052106 127103   107040 040040   052107 117122   107117 040040    *FWCG   *GORGO
   0     057   000020 000000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000000 000023   000002 006000   000002 006000   000002 006000    ................
   2     004   000000 006000   002000 200000   777777 577777   777777 757777    ................
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:293  
   2     010   000006 006000   000000 000000   040040 040040   040040 040040    ........
   2     014   077040 040040   000000 000035   000015 006000   777777 777677    ?   ............
   2     020   000074 200000   000000 006000   000000 000014   000022 006000    .<..............
   2     024   000002 006000   000004 006000   000000 000024   000026 006000    ................
   2     030   000003 006000   000000 000031   000031 006000   000020 006000    ................
   2     034   000032 006000   777777 777417   777777 777760   052040 040040    ............*
   2     040   000000 006000   000016 006000   000000 000033   000042 006000    ............."..
   2     044   776777 777777                                                    ....
     2241    11753    2   END MAPBUF;
     2242    11754    1   END KQR$READ;

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:294  
--  Include file information  --

   KI_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   F_CODE_R.:E05TOU  cannot be made into a system file and is referenced.
   EL$TABLES.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KQ_ERRORS_C.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQR$READ.
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:295  

 **** Variables and constants ****

  ****  Section 000 RoData KQR$READ

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(360)   r     1 DUFPT                     36-0-0/b STRC        r     1 ERR_NODAT
    24-0-0/d STRC(360)   r     1 HUFPT                     12-0-0/d STRC(360)   r     1 RUFPT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    47-0-0/w PTR         r     1 @CODE                      3-0-0/w PTR         r     1 @N$RREQ
    24-0-0/w PTR         r     1 ACTQTN$                   43-0-0/w UBIN        r     1 ATFLG
    41-0-0/w UBIN        r     1 BADCLS                    11-0-0/w PTR         r     1 CG$
    12-0-0/w STRC(288)   r     1 CGAURD                    *0-0-0/w UBIN        r     1 CODE
    31-0-0/w PTR         r     1 DBLK$                     31-0-0/w UBIN        r     1 DBLK$R
    33-0-0/w UBIN        r     1 DDA                       30-0-0/w PTR         r     1 DFRP$
    47-0-0/w UBIN        r     1 FLNKDA                    32-0-0/w UBIN        r     1 I
     4-0-0/w PTR         r     1 IOQ$                      32-0-0/w STRC        r     1 I_ERR
    22-0-0/c CHAR(8)     r     1 KEY                       25-0-0/w UBIN        r     1 KEY1L
    26-0-0/w UBIN        r     1 KEY2L                      5-0-0/w PTR         r     1 LDCT$
    10-0-0/w PTR         r     1 MBLK$                     35-0-0/w PTR         r     1 MLH$
    *0-0-0/d STRC(1080)  r     1 N$RREQ                    27-0-0/w PTR         r     1 P$
    52-0-0/w PTR         r     1 P$                        50-0-0/w UBIN        r     1 PSTMP
    37-0-0/w UBIN        r     1 QACTCNT                   41-0-0/w UBIN        r     1 QKNFND
    34-0-0/w PTR         r     1 QTN$                      42-0-0/w PTR         r     1 QUEUE$
    53-0-0/w PTR         r     1 R$                         7-0-0/w PTR         r     1 RBLK$
    51-0-0/w UBIN        r     1 SECS                       6-0-0/w PTR         r     1 STA$
    47-0-0/w PTR         r     1 T$                        50-0-0/w PTR         r     1 T$
    47-0-0/w PTR         r     1 T$                        44-0-0/d BIT (72)    r     1 TIMCHK
    47-0-0/w PTR         r     1 TREE$                     40-0-0/w BIT         r     1 TYC
    47-0-0/w PTR         r     1 UB$                       12-0-0/w STRC(288)   r     1 VLP_STATION

PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:296  
  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$CGPT$                    0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w STRC(288)   r     1 KC_VLPSTATION              0-0-0/w STRC(2304)  r     1 KQ_ERRLOG_BFR
     0-0-0/b BIT (72)    r     1 KQ_ERRLOG_GATE             0-0-0/d STRC(648)   r     1 KQ_IRBLK
     0-0-0/b STRC        r     1 KQ_LOG                     0-0-0/w BIT (72)    r     1 KQ_XFGATE
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 B$$BITS                    0-0-0/c CHAR(8)     r     1 B$$CHAR8
     0-0-0/c ACHR        r     1 B$$CHARS                   0-0-0/h UBIN(18)    r     1 B$$HALF
     0-0-0/w ACHR        r     1 B$$KEY1                    0-0-0/w ACHR        r     1 B$$KEY2
     0-0-0/w STRC        r     1 B$$MIDEXT                  0-0-0/w PTR         r     1 B$$PTR
     0-0-0/w STRC        r     1 B$$PTRR                    0-0-0/w UBIN        r     1 B$$UBIN
     0-0-0/d STRC(72)    r     1 B$$XFPTW                   0-0-0/w STRC(144)   r     1 B$CGAURD
     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/d STRC(6516)  r     1 KQ$CG                      0-0-0/d STRC(216)   r     1 KQ$DBLK
     0-0-0/d STRC(288)   r     1 KQ$DFRBLK                  0-0-0/w STRC(180)   r     1 KQ$DFRPARM
     0-0-0/d STRC(576)   r     1 KQ$MBLK                    0-0-0/d STRC(1908)  r     1 KQ$QTN
     0-0-0/d STRC(648)   r     1 KQ$RBLK                    0-0-0/d STRC(504)   r     1 KQ$RBLKT
     0-0-0/d STRC(1296)  r     1 KQ$STA                     0-0-0/w STRC(216)   r     1 KQ$THDR
     0-0-0/d STRC(1080)  r     1 N$REQ                      0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/w STRC(288)   r     1 VLP$STATION


   Procedure KQR$READ requires 3501 words for executable code.
   Procedure KQR$READ requires 52 words of local(AUTO) storage.
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:297  

    No errors detected in file KQR$READ.:E05TSI    .
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:298  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:299  
          MINI XREF LISTING

ACTQTN
     11437**PROC     9979--CALL     9985--CALL    10122--CALL    10200--CALL    10690--CALL
ACTQTN$
      9412**DCL      9795<<ASSIGN   9935>>IF       9979>>IF       9985>>IF      10001>>IF      10034>>IF
     10122>>IF      10190>>IF      10192<<ASSIGN  10200>>IF      10690>>IF      11442>>ASSIGN  11442>>ASSIGN
     11443>>ASSIGN  11443>>ASSIGN  11444>>IF      11446>>IF      11446>>IF      11447<>CALL    11454<<ASSIGN
     11694<<ASSIGN
ALT1 IN PROCEDURE GETTERM
     11154**LABEL   11150--CALLALT
ALTRT
     10690**LABEL   10809--CALLALT 10970--CALLALT
ALTRT IN PROCEDURE GETRBLK
     11260**LABEL   11255--CALLALT
ALTRT IN PROCEDURE VRQKEY
     11472**LABEL   11476--CALLALT 11511--CALLALT
ALTRTNL IN PROCEDURE VRQKEY
     11484**LABEL   11496--CALLALT 11521--CALLALT
ATFLG
      9433**DCL      9694<<ASSIGN   9701>>IF       9803>>IF      11714<<ASSIGN
B$$BITS.B
      9345**DCL     10588>>IF
B$$CHAR8
      9339**DCL     11182<<ASSIGN
B$$CHARS
      9338**DCL     10260<<ASSIGN  10260>>ASSIGN  10428<<ASSIGN  10428>>ASSIGN  11413<<ASSIGN  11413>>ASSIGN
B$$HALF
      9341**DCL     10566<>CALL    10599<>CALL
B$$KEY1
      9336**DCL      9851<<ASSIGN   9851>>ASSIGN  10033>>IF      10033>>IF      11550>>IF      11550>>IF
     11556>>IF      11556>>IF
B$$KEY2
      9337**DCL      9860<<ASSIGN   9860>>ASSIGN  11593>>IF      11593>>IF      11599>>IF      11599>>IF
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:300  
B$$MIDEXT.EXTS
      9343**DCL     10541>>IF
B$$PTR
      6779**DCL      6780--REDEF    9952>>ASSIGN   9955>>ASSIGN   9958<<ASSIGN  11319>>ASSIGN  11323>>ASSIGN
     11326>>ASSIGN  11327<<ASSIGN
B$$PTRR.SEGID
      6784**DCL     11744>>ASSIGN
B$$UBIN
      9340**DCL     11184<<ASSIGN
B$$XFPTW
      6785**DCL     10385<<ASSIGN  10388<<ASSIGN  10426<<ASSIGN  10429<<ASSIGN
B$CGAURD
      9358**DCL     11407--ASSIGN
B$CGAURD.STATION
      9362**DCL      9362--REDEF
B$CGPT$
      9563**DCL     10385>>ASSIGN  10388>>ASSIGN  10426>>ASSIGN  10429>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      6442**DCL      6442--REDEF
B$JIT.ERR
      6348**DCL     10668<<ASSIGN
B$JIT.ERR.MID
      6349**DCL      6349--REDEF
B$JIT.JRESPEAK
      6510**DCL      6511--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
      6619**DCL      6619--REDEF    6620--REDEF
B$JIT.PNR
      6523**DCL      6523--REDEF
B$JIT.TSLINE
      6617**DCL      6618--REDEF
B$JIT$
      9565**DCL      6343--IMP-PTR 10668>>ASSIGN
BADATCOMPUNL
     10676**LABEL    9804--GOTO
BADBUF IN PROCEDURE MAPBUF
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:301  
     11749**LABEL   11746--CALLALT
BADCLS
      9431**DCL     10851<<ASSIGN  10862<<ASSIGN  10905>>IF
BADCOMP
     10679**LABEL   10606--GOTO    10653--GOTO    10659--GOTO
BADCOMP1
     10688**LABEL   10685--GOTO
BADCOMPUNL
     10679**LABEL    9705--GOTO     9735--GOTO    10677--GOTO
BRCBUF
     10605**LABEL   10103--CALLALT
BRCBUF0
     10605**LABEL   10609--GOTO
BRCBUFAU
     10566**LABEL   10217--CALLALT
BRCBUFAU1
     10566**LABEL   10290--CALLALT 10617--GOTO
BRCBUFF
     10613**LABEL   10318--CALLALT
BRCBUFQ
     10605**LABEL    9951--CALLALT
BRCBUFU
     10574**LABEL   10259--CALLALT
BRCCRCW
     10602**LABEL    9789--CALLALT
BRCCWRV
     10652**LABEL    9825--GOTO
BRCEOF
     10658**LABEL    9907--GOTO    10085--GOTO
BRCEOFUNL
     10658**LABEL    9840--GOTO
BRCFUL
     10633**LABEL    9934--GOTO
BRCFULL
     10644**LABEL    9826--CALLALT
BRCKEY
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:302  
     10627**LABEL    9917--GOTO
BRCNODAT
     10665**LABEL    9912--GOTO    10090--GOTO
BRCOMP
     10668**LABEL   10614--GOTO    10628--GOTO    10631--GOTO    10634--GOTO    10637--GOTO    10647--GOTO
     10666--GOTO    10734--GOTO
BRCRERR
     10636**LABEL    9884--GOTO
BRCRERR0
     10636**LABEL    9940--GOTO    10006--GOTO    10039--GOTO
BRCRERR1
     10636**LABEL   10640--GOTO
BRCTYC
     10623**LABEL   10620--GOTO
BRCTYCD
     10613**LABEL   10097--CALLALT 10098--CALLALT
BRCTYCQ
     10613**LABEL    9949--CALLALT
BRDISC
     10630**LABEL    9922--GOTO
BRKREG
     10127**LABEL   10132--CALLALT
CB1 IN PROCEDURE COMPBAD
     10587**LABEL   10591--GOTO
CG$
      9377**DCL      6906--IMP-PTR  9688>>ASSIGN   9688>>ASSIGN   9690>>CALL     9775>>CALL     9815>>CALL
      9863>>IF       9885>>IF       9885>>IF       9894>>ASSIGN   9902>>CALL     9914>>IF       9919>>IF
      9919>>IF       9925>>IF       9926>>CALL     9927>>CALL     9931>>CALL     9962>>IF       9999>>ASSIGN
     10014>>CALL    10018>>CALL    10022>>IF      10031>>ASSIGN  10042>>CALL    10046>>CALL    10050>>IF
     10065>>IF      10065>>IF      10065>>IF      10070>>ASSIGN  10151>>CALL    10251>>CALL    10271>>CALL
     10285>>CALL    10321>>CALL    10415>>CALL    10448>>CALL    10465<<ASSIGN  10477>>CALL    10479>>ASSIGN
     10480>>ASSIGN  10482>>CALL    10538>>IF      10566>>CALL    10579>>CALL    10599>>CALL    10616>>CALL
     10730>>CALL    10732>>CALL    10770<<ASSIGN  10791<<ASSIGN  10805<<ASSIGN  10824<<ASSIGN  10866<<ASSIGN
     10868>>CALL    10883>>CALL    10885>>CALL    10894>>CALL    10902>>CALL    10906>>IF      10934>>CALL
     10942>>CALL    10954>>CALL    10959>>IF      10959>>IF      10981>>IF      11028>>CALL    11058<<ASSIGN
     11073>>IF      11114<<ASSIGN  11146>>CALL    11148>>IF      11150>>CALL    11161>>CALL    11198>>CALL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:303  
     11213>>CALL    11215>>IF      11217>>ASSIGN  11218>>ASSIGN  11221>>IF      11222>>CALL    11224>>CALL
     11228>>CALL    11230>>IF      11246>>CALL    11255>>CALL    11269>>CALL    11276>>CALL    11291>>CALL
     11295>>CALL    11316>>ASSIGN  11318>>ASSIGN  11351>>CALL    11353>>CALL    11380>>IF      11388>>CALL
     11390>>CALL    11402>>CALL    11440>>CALL    11447>>CALL    11451>>CALL    11472>>ASSIGN  11474>>CALL
     11495>>ASSIGN  11506>>IF      11506>>ASSIGN  11507>>ASSIGN  11519>>IF      11519>>ASSIGN  11520>>ASSIGN
     11529>>CALL    11533>>IF      11535>>IF      11541>>IF      11541>>IF      11546>>CALL    11576>>IF
     11578>>IF      11584>>IF      11584>>IF      11626>>IF      11627>>IF      11634>>IF      11635>>IF
     11665>>IF      11691<<ASSIGN  11692>>CALL
CGAURD.X
      9405**DCL     11413--ASSIGN
CGAURD.X.EVENT
      9407**DCL     11379<<ASSIGN  11385>>DOCASE
CGAURD.X.INFO
      9408**DCL     11383<<ASSIGN
CGAURD.X.STATION
      9407**DCL      9407--REDEF   11381<<ASSIGN  11382<<ASSIGN  11390<>CALL
CHERR
     10270**LABEL   10435--GOTO
CHK IN PROCEDURE CHKSTA
     11635**LABEL   11632--GOTO
CHKACT
     11705**PROC     9699--CALL    10717--CALL    10878--CALL
CHKSTA
     11624**PROC     9946--CALL    10051--CALL    11530--CALL    11558--CALL
CHKSTANQ IN PROCEDURE CHKSTA
     11633**ENTRY   11573--CALL    11603--CALL
CHUNKOK
     11338**PROC    10266--CALL    10437--CALL
CL0
     10866**LABEL   10896--GOTO
CL10
     10926**LABEL   10888--GOTO
CL20
     10942**LABEL   11102--GOTO
CL5
     10916**LABEL   10913--GOTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:304  
CLEANUP
     10862**LABEL   10852--GOTO
CLS10
     10984**LABEL   11038--GOTO    11043--GOTO
CLS15
     10995**LABEL   10995--CALLALT
CLS20
     11008**LABEL   11003--CALLALT
CLS22
     11028**LABEL   11018--CALLALT
CLS24
     11034**LABEL   11013--GOTO
CLS25
     10966**LABEL   10963--GOTO
CLSTARS
     10954**LABEL   11117--GOTO
CODE IN PROCEDURE LOGERR
     11174**DCL     11172--PROC    11184>>ASSIGN  11188>>IF
COMPBAD
     10582**PROC    10691--CALL    10887--CALL
DBLK$
      9417**DCL      8732--IMP-PTR  9287--IMP-PTR  9418--REDEF    9775<>CALL    10251<>CALL    10253>>ASSIGN
     10260>>ASSIGN  10271<>CALL    10279>>IF      10285<>CALL    10320>>ASSIGN  10321<>CALL    10341<<ASSIGN
     10343>>IF      10415<>CALL    10417>>ASSIGN  10428>>ASSIGN  10445>>IF      10447>>ASSIGN  10448<>CALL
     10579<>CALL    10616<>CALL    11346>>ASSIGN  11347>>ASSIGN  11351<>CALL    11353<>CALL
DBLK$R
      9418**DCL      9774<<ASSIGN  10249<<ASSIGN  10283<<ASSIGN  10413<<ASSIGN
DDA
      9424**DCL     10250<<ASSIGN  10251<>CALL    10281>>IF      10284<<ASSIGN  10285<>CALL    10288>>IF
     10296>>DOCASE  10342<<ASSIGN  10414<<ASSIGN  10415<>CALL    10451>>IF
DEQUEUE IN PROCEDURE GETRBLK
     11273**ENTRY   10150--CALL    10731--CALL    10884--CALL
DFRP$
      9416**DCL      9258--IMP-PTR 10336<<ASSIGN  10337>>ASSIGN  10341>>ASSIGN  10342>>ASSIGN  10501<<ASSIGN
DIRONLY
     10071**LABEL    9888--GOTO
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:305  
DUFPT.V
      9455**DCL      9455--DCLINIT  9789<>CALL    10916<>CALL    10935<>CALL    11096<>CALL
DUMPRBLK IN PROCEDURE GETRBLK
     11265**ENTRY   10154--CALL    10675--CALL    10680--CALL    10779--CALL    10927--CALL    11007--CALL
     11092--CALL
ERR_NODAT
      9502**DCL     10668>>ASSIGN
F$DCB.ACTPOS
      4819**DCL      4819--REDEF
F$DCB.ARS
      4794**DCL      4794--REDEF
F$DCB.ATTR
      4812**DCL      4813--REDEF
F$DCB.BORROW
      4827**DCL      4827--REDEF    4827--REDEF    4827--REDEF
F$DCB.DCBNAME.L
      4841**DCL      4841--IMP-SIZ
F$DCB.EOMCHAR
      4798**DCL      4798--REDEF
F$DCB.FCN
      4831**DCL     10132<>CALL
F$DCB.FLDID
      4822**DCL      4822--REDEF
F$DCB.FORM$
      4816**DCL      4816--REDEF
F$DCB.FSECT
      4832**DCL      4832--REDEF
F$DCB.FSN
      4809**DCL      4809--REDEF    4809--REDEF    4810--REDEF
F$DCB.HEADER$
      4815**DCL      4815--REDEF
F$DCB.IXTNSIZE
      4813**DCL      4813--REDEF
F$DCB.LASTSTA$
      4803**DCL      4803--REDEF
F$DCB.LVL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:306  
      4828**DCL      4828--REDEF
F$DCB.NAME.C
      4803**DCL      4803--REDEF
F$DCB.NOEOF
      4824**DCL      4824--REDEF
F$DCB.NRECS
      4814**DCL      4814--REDEF
F$DCB.NRECX
      4833**DCL      4833--REDEF
F$DCB.OHDR
      4825**DCL      4825--REDEF
F$DCB.ORG
      4808**DCL      4808--REDEF
F$DCB.PRECNO
      4831**DCL      4831--REDEF
F$DCB.RCSZ
      4836**DCL      4836--REDEF
F$DCB.RES
      4804**DCL      4804--REDEF
F$DCB.SETX
      4816**DCL      4816--REDEF
F$DCB.TAB$
      4815**DCL      4816--REDEF
F$DCB.TDA
      4830**DCL      4830--REDEF
F$DCB.WSN
      4805**DCL      4805--REDEF
FDELAY
     10466**LABEL   10292--GOTO    10452--GOTO
FLNKDA IN PROCEDURE CHUNKOK
     11340**DCL     11347<<ASSIGN  11354>>IF
FOUNDIT IN PROCEDURE QEOFT
     11320**LABEL   11321--GOTO
GETQUEUE
     11210**PROC     9892--CALL    10792--CALL
GETRBLK
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:307  
     11242**PROC     9826--CALL    10809--CALL    10970--CALL
GETTERM
     11143**PROC    11018--CALL
GOTQMSG
     10171**LABEL    9939--CALLALT 10005--CALLALT 10038--CALLALT
GR0 IN PROCEDURE GETRBLK
     11246**LABEL   11246--CALLALT
GR1 IN PROCEDURE GETRBLK
     11259**LABEL   11247--GOTO
HFC$ASSOCCLR
      9514**DCL-ENT 10386--CALL    10389--CALL    10427--CALL    10430--CALL
HFC$LOCK
      2954**DCL-ENT  9696--CALL     9778--CALL     9791--CALL     9931--CALL     9971--CALL    10018--CALL
     10046--CALL    10100--CALL    10117--CALL    10138--CALL    10383--CALL    10424--CALL    10470--CALL
     10477--CALL    10522--CALL    10623--CALL    10672--CALL    10807--CALL    10870--CALL    10968--CALL
     11000--CALL    11146--CALL    11152--CALL    11177--CALL    11213--CALL    11228--CALL    11257--CALL
     11291--CALL    11388--CALL    11392--CALL    11440--CALL    11474--CALL    11509--CALL
HFC$UNLOCK
      2954**DCL-ENT  9751--CALL     9758--CALL     9772--CALL     9787--CALL     9890--CALL     9977--CALL
      9983--CALL    10014--CALL    10042--CALL    10095--CALL    10113--CALL    10148--CALL    10158--CALL
     10163--CALL    10391--CALL    10432--CALL    10474--CALL    10482--CALL    10526--CALL    10656--CALL
     10662--CALL    10683--CALL    10728--CALL    10811--CALL    10881--CALL    10892--CALL    10900--CALL
     10932--CALL    10940--CALL    10972--CALL    11025--CALL    11028--CALL    11157--CALL    11161--CALL
     11224--CALL    11250--CALL    11295--CALL    11398--CALL    11402--CALL    11451--CALL    11479--CALL
     11484--CALL
HFF$TRAPALT
      9515**DCL-ENT 10217--CALL    10219--CALL    10259--CALL    10261--CALL    10572--CALL    10577--CALL
HFF$WRITE1
      9516**DCL-ENT 11746--CALL
HUFPT.V
      9496**DCL      9496--DCLINIT 10910<>CALL    11080<>CALL
I
      9419**DCL      9338--IMP-SIZ  9420--REDEF    9789<>CALL    10124<<ASSIGN  10127<<ASSIGN  10132<>CALL
     10253<<ASSIGN  10254>>IF      10257<<ASSIGN  10260>>ASSIGN  10260>>ASSIGN  10262>>ASSIGN  10270>>ASSIGN
     10417<<ASSIGN  10418>>IF      10421<<ASSIGN  10428>>ASSIGN  10428>>ASSIGN  10434>>ASSIGN  10540<<DOINDEX
     10541>>IF      10543>>ASSIGN  10587<<DOINDEX 10588>>IF      10590>>ASSIGN  10908<>CALL    10910<>CALL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:308  
     10916<>CALL    10919<>CALL    10935<>CALL    11006<<ASSIGN  11008>>IF      11080<>CALL    11086<>CALL
     11096<>CALL    11246<>CALL    11254<<ASSIGN  11255<>CALL    11343>>ASSIGN  11344>>ASSIGN  11407<<ASSIGN
     11408>>IF      11411<<ASSIGN  11413>>ASSIGN  11413>>ASSIGN  11414>>ASSIGN  11415>>ASSIGN  11416>>ASSIGN
     11419>>ASSIGN
IOQ$
      9371**DCL      6796--IMP-PTR  9657>>DOCASE   9734>>ASSIGN   9738>>IF       9745>>IF       9746>>ASSIGN
      9748>>ASSIGN   9755>>ASSIGN   9756>>ASSIGN   9824>>IF       9838>>ASSIGN   9842>>IF       9843>>ASSIGN
      9845>>ASSIGN   9909>>IF       9944>>IF       9959>>ASSIGN   9973>>IF      10061>>IF      10087>>IF
     10108>>ASSIGN  10123>>IF      10132>>CALL    10202>>ASSIGN  10203>>ASSIGN  10233>>ASSIGN  10238>>ASSIGN
     10256>>ASSIGN  10262>>ASSIGN  10262>>ASSIGN  10263>>IF      10291>>ASSIGN  10300>>ASSIGN  10304>>ASSIGN
     10319>>ASSIGN  10320>>ASSIGN  10322>>IF      10337<<ASSIGN  10365>>ASSIGN  10367>>ASSIGN  10368>>ASSIGN
     10393>>IF      10420>>ASSIGN  10434>>ASSIGN  10434>>ASSIGN  10435>>IF      10447>>ASSIGN  10496>>ASSIGN
     10512>>IF      10567>>CALL    10574>>ASSIGN  10578>>ASSIGN  10588>>IF      10601>>CALL    10605>>ASSIGN
     10613>>ASSIGN  10627>>ASSIGN  10630>>ASSIGN  10633>>ASSIGN  10636>>ASSIGN  10646>>ASSIGN  10652>>ASSIGN
     10658>>ASSIGN  10665>>ASSIGN  10724>>ASSIGN  10733>>ASSIGN  10755>>ASSIGN  10873<<ASSIGN  11060<<ASSIGN
     11116<<ASSIGN  11410>>ASSIGN  11416>>ASSIGN  11417>>IF      11661>>ASSIGN  11675>>ASSIGN  11676>>ASSIGN
     11677>>ASSIGN  11677>>ASSIGN  11687<<ASSIGN  11689>>ASSIGN  11709>>ASSIGN  11715>>ASSIGN  11742>>IF
I_ERR.CODE
      9422**DCL     10912>>IF      10918>>IF
KC_VLPSTATION.CTL
      9582**DCL     11662>>ASSIGN
KC_VLPSTATION.MSGIDXT
      9588**DCL      9591--REDEF
KEY
      9411**DCL      9865<<ASSIGN   9868>>ASSIGN  11148<<ASSIGN  11149<<ASSIGN  11150<>CALL
KEY1L
      9413**DCL      9336--IMP-SIZ  9847<<ASSIGN   9850<<CALLBLT  9851>>ASSIGN   9851>>ASSIGN   9852>>ASSIGN
      9869>>ASSIGN   9870>>ASSIGN   9871<<ASSIGN   9895>>IF       9996>>IF      10033>>IF      10033>>IF
     10092>>IF      10586<<ASSIGN  10590<<ASSIGN  10599<>CALL    10718<<ASSIGN  11471>>IF      11494>>IF
     11526>>IF      11535>>IF      11550>>IF      11550>>IF      11556>>IF      11556>>IF      11637>>IF
KEY2L
      9414**DCL      9337--IMP-SIZ  9856<<ASSIGN   9859<<CALLBLT  9860>>ASSIGN   9860>>ASSIGN   9861>>ASSIGN
      9867>>ASSIGN   9870<<ASSIGN  10092>>IF      10719<<ASSIGN  11505>>IF      11518>>IF      11569>>IF
     11578>>IF      11593>>IF      11593>>IF      11599>>IF      11599>>IF      11629>>IF
KQ$CG
      6906**DCL      9690<>CALL     9775<>CALL     9815<>CALL     9926<>CALL     9927<>CALL    10151<>CALL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:309  
     10251<>CALL    10271<>CALL    10285<>CALL    10321<>CALL    10415<>CALL    10448<>CALL    10566<>CALL
     10579<>CALL    10599<>CALL    10616<>CALL    10730<>CALL    10732<>CALL    10868<>CALL    10883<>CALL
     10885<>CALL    10894<>CALL    10902<>CALL    10934<>CALL    10942<>CALL    10954<>CALL    11198<>CALL
     11222<>CALL    11246<>CALL    11255<>CALL    11269<>CALL    11276<>CALL    11351<>CALL    11353<>CALL
     11447<>CALL    11692<>CALL
KQ$CG.AUCTL.BIGMXT
      7352**DCL     10538>>IF
KQ$CG.AUCTL.DVBYTE.REREAD
      7349**DCL      7350--REDEF
KQ$CG.AUCTL.RAS
      7348**DCL      9919>>IF      10065>>IF      11541>>IF      11584>>IF      11627>>IF      11635>>IF
KQ$CG.DFHD$
      7011**DCL     10479>>ASSIGN  10480<<ASSIGN
KQ$CG.EOFTIME
      7027**DCL     11316>>ASSIGN
KQ$CG.EOFTIMEHD$
      7023**DCL     11318--ASSIGN
KQ$CG.GATE.CG
      7296**DCL     10477<>CALL    10482<>CALL
KQ$CG.GORGOSTA$
      7405**DCL     10959>>IF
KQ$CG.HOLDSTA$
      7336**DCL     10906>>IF
KQ$CG.JRNLSTA$
      7409**DCL     10959>>IF      11073>>IF
KQ$CG.QISS
      7292**DCL      9863>>IF       9885>>IF       9885>>IF       9919>>IF       9925>>IF       9962>>IF
     10065>>IF      10981>>IF      11148>>IF      11380>>IF      11506>>IF      11519>>IF      11535>>IF
     11541>>IF      11578>>IF      11584>>IF      11626>>IF      11634>>IF      11665>>IF
KQ$CG.QUEUE.BUSY
      7151**DCL     11215>>IF
KQ$CG.QUEUE.BUSY.RIP
      7154**DCL     11217<<ASSIGN
KQ$CG.QUEUE.PLHD$
      7139**DCL      9999>>ASSIGN  10031>>ASSIGN
KQ$CG.QUEUE.QTREE$
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:310  
      7128**DCL      9894>>ASSIGN   9902>>CALL     9931>>CALL    10014>>CALL    10018>>CALL    10022>>IF
     10042>>CALL    10046>>CALL    10050>>IF      11213>>CALL    11224>>CALL    11228>>CALL    11440>>CALL
     11451>>CALL    11472>>ASSIGN  11474>>CALL    11495>>ASSIGN  11529>>CALL    11546>>CALL
KQ$CG.QUEUE.RUSR#
      7148**DCL     11218<<ASSIGN  11221>>IF      11230>>IF
KQ$CG.QUEUE.WCRL$
      7131**DCL     10070--ASSIGN
KQ$CG.STATS.READS
      7398**DCL      9688<<ASSIGN   9688>>ASSIGN
KQ$CG.STREE
      7238**DCL     11150<>CALL    11390<>CALL    11507--ASSIGN  11520--ASSIGN
KQ$CG.STREE.GATE
      7240**DCL     11028<>CALL    11146<>CALL    11161<>CALL    11291<>CALL    11295<>CALL    11388<>CALL
     11402<>CALL
KQ$CG.TTREE
      7199**DCL     11506--ASSIGN  11519--ASSIGN
KQ$CG.XOTNLGL
      7289**DCL     11576>>IF
KQ$CG.XQTNLGL
      7285**DCL      9914>>IF      10065>>IF      11533>>IF
KQ$DBLK
      8732**DCL     10260--ASSIGN  10428--ASSIGN
KQ$DBLK.DSIZE
      8737**DCL     10253>>ASSIGN  10417>>ASSIGN
KQ$DBLK.FLNKDA
      8739**DCL     11346>>ASSIGN  11347>>ASSIGN
KQ$DFRBLK.DBLK$
      9309**DCL      9311--REDEF
KQ$DFRBLK.INFO
      9317**DCL      9319--REDEF
KQ$DFRBLK.INFO$
      9319**DCL     10320<<ASSIGN  10447<<ASSIGN
KQ$DFRPARM.DBLK$
      9263**DCL      9265--REDEF   10341>>ASSIGN
KQ$DFRPARM.ERR
      9271**DCL     10342>>ASSIGN
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:311  
KQ$DFRPARM.INFO
      9259**DCL      9261--REDEF
KQ$DFRPARM.INFO$
      9261**DCL     10337>>ASSIGN
KQ$MBLK
      8354**DCL     10954<>CALL    11186<<ASSIGN  11186>>ASSIGN  11187--ASSIGN  11191--ASSIGN  11196--ASSIGN
KQ$MBLK.DDA
      8419**DCL      9769>>IF       9775<>CALL     9776>>ASSIGN  10227>>IF      10312<<ASSIGN  10401>>IF
KQ$MBLK.DFLNK$
      8364**DCL     10479<<ASSIGN
KQ$MBLK.DSTA
      8503**DCL     11033<<ASSIGN
KQ$MBLK.DVE
      8452**DCL     11675>>ASSIGN
KQ$MBLK.DVE.EOMCHAR
      8456**DCL      8458--REDEF
KQ$MBLK.FC
      8449**DCL     11015>>DOCASE  11379>>ASSIGN
KQ$MBLK.JRNLD
      8446**DCL      9810>>IF
KQ$MBLK.KEY1
      8382**DCL      8384--REDEF   10210>>IF      10375>>IF      11148>>ASSIGN  11381>>ASSIGN  11667>>ASSIGN
     11673>>ASSIGN
KQ$MBLK.KEY2
      8391**DCL      8409--REDEF   11149>>ASSIGN  11382>>ASSIGN  11668>>ASSIGN  11672>>ASSIGN
KQ$MBLK.LNK$
      8356**DCL      8358--REDEF    8364--REDEF    8368--REDEF   10953>>ASSIGN
KQ$MBLK.MID.PRIMARY
      8515**DCL     11663>>ASSIGN
KQ$MBLK.MID.XT
      8516**DCL     10541--IF      11022>>ASSIGN  11383>>ASSIGN  11664>>ASSIGN
KQ$MBLK.MSGSIZE
      8517**DCL     10228>>IF      10402>>IF
KQ$MBLK.PRIO
      8372**DCL     10212<<ASSIGN  10212>>ASSIGN  10215>>IF      10377<<ASSIGN  10377>>ASSIGN  10380>>IF
     10531>>IF      11014>>IF
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:312  
KQ$MBLK.RBLK
      8495**DCL     10106<<ASSIGN  11034<<ASSIGN
KQ$MBLK.STAMP
      8376**DCL      9774>>ASSIGN  10249>>ASSIGN  10283>>ASSIGN  10413>>ASSIGN
KQ$MBLK.TYC
      8505**DCL      8507--REDEF   11677>>ASSIGN
KQ$MBLK.XSP.MREQ$
      8411**DCL      8415--REDEF
KQ$QTN.AUTORCVR
      9142**DCL     11076>>IF
KQ$QTN.CNACT
      9128**DCL      9935>>IF      10001>>IF      10034>>IF      10195<<ASSIGN  10195>>ASSIGN  11442<<ASSIGN
     11442>>ASSIGN  11444>>IF      11446>>IF
KQ$QTN.CRASHACT
      9163**DCL     10193<<ASSIGN  10193>>ASSIGN  11443<<ASSIGN  11443>>ASSIGN
KQ$QTN.MXACT
      9131**DCL      9133--REDEF    9935>>IF      10001>>IF      10034>>IF      11079<<ASSIGN  11446>>IF
KQ$QTN.PLINK$
      9140**DCL     10024>>ASSIGN  10055>>ASSIGN
KQ$QTN.READS$
      9134**DCL      9948--ASSIGN
KQ$QTN.STA.ACTTYC
      8853**DCL      8857--REDEF
KQ$QTN.STA.BTN.FLINK$
      8835**DCL     11553>>ASSIGN  11596>>ASSIGN
KQ$QTN.STA.BTN.KEY
      8837**DCL     10033--IF      11550--IF      11556--IF      11593--IF      11599--IF
KQ$QTN.STA.DCBLNK$
      8860**DCL      8863--REDEF    8867--REDEF
KQ$QTN.STA.EVCNT
      8946**DCL      8949--REDEF
KQ$QTN.STA.EVNT
      8912**DCL      8916--REDEF    8919--REDEF
KQ$QTN.STA.OPNBLKED
      8973**DCL      8976--REDEF
KQ$QTN.STA.OPNREJ
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:313  
      8979**DCL      8981--REDEF
KQ$QTN.STA.SUCCREAD
      8902**DCL      8906--REDEF
KQ$QTN.STA.TCOUNT
      9031**DCL      9037--REDEF
KQ$QTN.STA.VGOT$
      9016**DCL      9020--REDEF    9024--REDEF
KQ$RBLK
      7982**DCL      9819<<ASSIGN  11195<<ASSIGN  11195>>ASSIGN  11196--ASSIGN
KQ$RBLK.AUXFDN
      8012**DCL      9782<<ASSIGN  11378>>IF      11424<<ASSIGN
KQ$RBLK.BUF$
      8104**DCL      8106--REDEF    9748<<ASSIGN   9845<<ASSIGN  10260>>ASSIGN  10428>>ASSIGN  11344<<ASSIGN
     11344>>ASSIGN  11413>>ASSIGN  11415<<ASSIGN  11415>>ASSIGN  11741>>ASSIGN  11748<>CALL
KQ$RBLK.BUFSIZE
      8114**DCL      9746<<ASSIGN   9747<<ASSIGN   9843<<ASSIGN   9844<<ASSIGN  10231>>IF      10241>>IF
     10254>>IF      10257>>ASSIGN  10405>>IF      10418>>IF      10421>>ASSIGN  11343<<ASSIGN  11343>>ASSIGN
     11408>>IF      11411>>ASSIGN  11414<<ASSIGN  11414>>ASSIGN  11748<>CALL
KQ$RBLK.CNACTD
      8018**DCL      8027--REDEF    9794>>IF
KQ$RBLK.CS
      8009**DCL      9703>>IF       9740>>IF       9766>>IF      10313<<ASSIGN  10516<<ASSIGN  10756<<ASSIGN
KQ$RBLK.DBLKX
      8124**DCL      8128--REDEF    9781<<ASSIGN  10253>>ASSIGN  10260>>ASSIGN  10270<<ASSIGN  10270>>ASSIGN
     10417>>ASSIGN  10428>>ASSIGN  11345<<ASSIGN  11407>>ASSIGN  11413>>ASSIGN  11419<<ASSIGN  11419>>ASSIGN
     11423<<ASSIGN
KQ$RBLK.EOFNONE
      7996**DCL      7999--REDEF
KQ$RBLK.EOFTIME
      8128**DCL     11317<<ASSIGN  11321>>IF
KQ$RBLK.EOFTIMELNK$
      8061**DCL     11322--ASSIGN  11326<<ASSIGN
KQ$RBLK.ERR
      8030**DCL      9884>>IF       9940>>IF      10006>>IF      10039>>IF      10644>>DOCASE  11006>>ASSIGN
KQ$RBLK.FROMQ
      8002**DCL      8005--REDEF   10188<<ASSIGN  11073>>IF
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:314  
KQ$RBLK.HONK
      8033**DCL      9854<<ASSIGN
KQ$RBLK.KEY1
      8044**DCL      9851--ASSIGN   9853>>IF       9865>>ASSIGN   9866<<ASSIGN   9885>>IF       9902<>CALL
      9926<>CALL     9927<>CALL    10033--IF      10990<<ASSIGN  11529<>CALL    11535>>IF      11546<>CALL
     11550--IF      11556--IF      11638>>IF
KQ$RBLK.KEY1L
      8039**DCL      9852<<ASSIGN   9867<<ASSIGN   9871>>ASSIGN  10718>>ASSIGN  10976<<ASSIGN  10983<<ASSIGN
     10989<<ASSIGN
KQ$RBLK.KEY1R
      8043**DCL      8044--REDEF
KQ$RBLK.KEY2
      8049**DCL      9860--ASSIGN   9866>>ASSIGN   9868<<ASSIGN   9885>>IF      10985<<ASSIGN  11572<>CALL
     11578>>IF      11589<>CALL    11593--IF      11599--IF      11630>>IF
KQ$RBLK.KEY2L
      8041**DCL      9861<<ASSIGN   9869<<ASSIGN  10719>>ASSIGN  10977<<ASSIGN  10984<<ASSIGN  10991<<ASSIGN
KQ$RBLK.KEY2R
      8048**DCL      8049--REDEF
KQ$RBLK.LATCH
      7991**DCL      7993--REDEF    9703>>IF       9764>>IF       9841<<ASSIGN  10186>>IF      10232>>IF
     10517>>IF      10773>>IF      10903>>IF      11071>>IF      11348>>IF
KQ$RBLK.LWRITES$
      8135**DCL      8139--REDEF
KQ$RBLK.MAPD
      7999**DCL      9749<<ASSIGN  11740>>IF      11749<<ASSIGN
KQ$RBLK.MBLK$
      7983**DCL      9743>>ASSIGN   9760>>ASSIGN   9768>>ASSIGN   9808>>ASSIGN   9814<<ASSIGN  10105>>IF
     10106>>ASSIGN  10107<<ASSIGN  10340>>ASSIGN  10366>>ASSIGN  10479>>ASSIGN  10500>>ASSIGN  10757>>ASSIGN
     10773>>IF      10924>>IF      11012>>ASSIGN  11035<<ASSIGN  11186>>ASSIGN
KQ$RBLK.MID.PRIMARY
      8059**DCL      9846<<ASSIGN
KQ$RBLK.MIDEXTV
      8121**DCL     10534<<ASSIGN  10544<<ASSIGN  10550<<ASSIGN  10553<<ASSIGN
KQ$RBLK.MIDEXTX
      8116**DCL     10533<<ASSIGN  10543<<ASSIGN
KQ$RBLK.NCDDA
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:315  
      8065**DCL      9769>>IF       9776<<ASSIGN   9810>>IF      10250>>ASSIGN  10284>>ASSIGN  10311<<ASSIGN
     10414>>ASSIGN  10513>>IF      10773>>IF      11346<<ASSIGN
KQ$RBLK.PTW
      8109**DCL     10385>>ASSIGN  10426>>ASSIGN  11748<>CALL
KQ$RBLK.QRLNK$
      8139**DCL      9954--ASSIGN   9957<<ASSIGN
KQ$RBLK.QTN$
      8142**DCL      9795>>ASSIGN   9947<<ASSIGN  10071<<ASSIGN  10189<<ASSIGN  11076>>IF      11079>>ASSIGN
KQ$RBLK.STA$
      8070**DCL      9950<<ASSIGN  10104<<ASSIGN  10111<<ASSIGN
KQ$RBLK.STATE
      7988**DCL      9702>>IF       9718>>DOCASE   9744<<ASSIGN   9968<<ASSIGN   9973>>IF      10120<<ASSIGN
     10143>>DOCASE  10146<<ASSIGN  10339>>IF      10468<<ASSIGN  10497>>IF      10498<<ASSIGN  10560<<ASSIGN
     10726<<ASSIGN  10773>>IF      10875>>DOCASE  10879<<ASSIGN  11002<<ASSIGN  11011<<ASSIGN  11065>>DOCASE
KQ$RBLKT
      8168**DCL     11190<<ASSIGN  11190>>ASSIGN  11191--ASSIGN
KQ$RBLKT.CNACTD
      8204**DCL      8213--REDEF
KQ$RBLKT.DBLK$
      8267**DCL      8271--REDEF    8274--REDEF
KQ$RBLKT.EOFNONE
      8182**DCL      8185--REDEF
KQ$RBLKT.FROMQ
      8188**DCL      8191--REDEF
KQ$RBLKT.KEY1R
      8229**DCL      8230--REDEF
KQ$RBLKT.KEY2R
      8234**DCL      8235--REDEF
KQ$RBLKT.LATCH
      8177**DCL      8179--REDEF
KQ$STA
      7644**DCL      9789<>CALL     9811<>CALL     9883<>CALL     9906<>CALL     9911<>CALL     9916<>CALL
      9921<>CALL     9933<>CALL     9939<>CALL     9969<>CALL    10005<>CALL    10038<>CALL    10084<>CALL
     10089<>CALL    10121<>CALL    10197<>CALL    10499<>CALL    10608<>CALL    10611<>CALL    10619<>CALL
     10625<>CALL    10639<>CALL    10642<>CALL    10908<>CALL    10910<>CALL    10916<>CALL    10919<>CALL
     10925<>CALL    10935<>CALL    11003<>CALL    11004<>CALL    11037<>CALL    11042<>CALL    11080<>CALL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:316  
     11086<>CALL    11090<>CALL    11096<>CALL    11222<>CALL
KQ$STA.ABTET
      7762**DCL     11716>>IF
KQ$STA.ACTTYC
      7696**DCL      7700--REDEF   11712>>IF      11715>>ASSIGN  11717<<ASSIGN
KQ$STA.AU
      7726**DCL     10965>>IF
KQ$STA.BTN.KEY
      7680**DCL      9690<>CALL     9690<>CALL    10566<>CALL    10566<>CALL    10599<>CALL    10599<>CALL
     10963>>IF      10974>>IF      11013>>IF      11182>>ASSIGN
KQ$STA.CG$
      7683**DCL     10465>>ASSIGN  10770>>ASSIGN  10791>>ASSIGN  10805>>ASSIGN  10824>>ASSIGN  10866>>ASSIGN
     11058>>ASSIGN  11114>>ASSIGN
KQ$STA.DCBLNK$
      7703**DCL      7706--REDEF    7710--REDEF
KQ$STA.DSID
      7783**DCL     10964<<ASSIGN
KQ$STA.EVCNT
      7789**DCL      7792--REDEF   11395>>IF      11396<<ASSIGN  11396>>ASSIGN
KQ$STA.EVNT
      7755**DCL      7759--REDEF    7762--REDEF   11019>>IF      11021<<ASSIGN
KQ$STA.EVSC
      7700**DCL     11022<<ASSIGN
KQ$STA.GATE
      7722**DCL      9696<>CALL     9751<>CALL     9758<>CALL     9772<>CALL     9778<>CALL     9787<>CALL
      9791<>CALL     9890<>CALL     9971<>CALL     9977<>CALL     9983<>CALL    10095<>CALL    10100<>CALL
     10113<>CALL    10117<>CALL    10138<>CALL    10148<>CALL    10158<>CALL    10163<>CALL    10470<>CALL
     10474<>CALL    10522<>CALL    10526<>CALL    10623<>CALL    10656<>CALL    10662<>CALL    10672<>CALL
     10683<>CALL    10728<>CALL    10807<>CALL    10811<>CALL    10870<>CALL    10881<>CALL    10892<>CALL
     10900<>CALL    10932<>CALL    10940<>CALL    10968<>CALL    10972<>CALL    11000<>CALL    11025<>CALL
     11152<>CALL    11157<>CALL    11250<>CALL    11257<>CALL    11392<>CALL    11398<>CALL
KQ$STA.LATCHCNT
      7714**DCL      9793<<ASSIGN   9793>>ASSIGN
KQ$STA.LDCT$
      7685**DCL     10865>>ASSIGN  11154>>IF      11641>>IF      11642>>IF
KQ$STA.LOCKCNT
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:317  
      7778**DCL     10472<<ASSIGN  10472>>ASSIGN
KQ$STA.MBLK$
      7689**DCL     10948>>IF      10950>>ASSIGN  10951<<ASSIGN  11036<<ASSIGN
KQ$STA.MONDCB
      7728**DCL     11252>>IF
KQ$STA.MREQ
      7769**DCL     11061<<ASSIGN
KQ$STA.OPNBLKED
      7816**DCL      7819--REDEF
KQ$STA.OPNREJ
      7822**DCL      7824--REDEF
KQ$STA.RBLK$
      7687**DCL      9698>>ASSIGN  10140>>ASSIGN  10153<<ASSIGN  10466>>ASSIGN  10674<<ASSIGN  10679<<ASSIGN
     10771>>ASSIGN  10778<<ASSIGN  10872>>ASSIGN  10926<<ASSIGN  11005<<ASSIGN  11062>>ASSIGN  11091<<ASSIGN
     11186>>ASSIGN  11190>>ASSIGN  11195>>ASSIGN  11259<<ASSIGN  11693>>ASSIGN
KQ$STA.READS
      7870**DCL     10559<<ASSIGN  10559>>ASSIGN
KQ$STA.SUCCREAD
      7745**DCL      7749--REDEF    9839>>IF      10519>>IF      10524<<ASSIGN
KQ$STA.TCOUNT
      7874**DCL      7880--REDEF
KQ$STA.TERM
      7740**DCL     11154>>IF      11394>>IF
KQ$STA.VGOT$
      7859**DCL      7863--REDEF    7867--REDEF
KQ$THDR
      8695**DCL      9902<>CALL    11529<>CALL    11546<>CALL    11572<>CALL    11589<>CALL
KQ$THDR.ACTCNT
      8712**DCL      9894>>ASSIGN  10022>>IF      10050>>IF
KQ$THDR.GATE
      8699**DCL      9931<>CALL    10014<>CALL    10018<>CALL    10042<>CALL    10046<>CALL    11213<>CALL
     11224<>CALL    11228<>CALL    11440<>CALL    11451<>CALL    11474<>CALL    11479<>CALL    11484<>CALL
     11509<>CALL
KQB$SRCH
      9517**DCL-ENT  9902--CALL    11150--CALL    11390--CALL    11529--CALL    11546--CALL    11572--CALL
     11589--CALL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:318  
KQD$DEFERGO
      9518**DCL-ENT 10321--CALL    10448--CALL    10616--CALL
KQD$DELETE
      9519**DCL-ENT 11353--CALL
KQD$ERRLOG
      9520**DCL-ENT 11198--CALL
KQD$FETCH
      9521**DCL-ENT 10251--CALL    10415--CALL
KQD$FETCHR
      9522**DCL-ENT 10285--CALL
KQD$LREL
      9523**DCL-ENT 11351--CALL
KQD$RENEGE
      9524**DCL-ENT  9775--CALL
KQD$UNLOCK
      9525**DCL-ENT 10271--CALL    10579--CALL
KQL$DDFDUN
      9526**DCL-ENT 10084--CALL    10089--CALL    10121--CALL    10611--CALL    10625--CALL    10642--CALL
     11004--CALL
KQL$DDFIND
      9528**DCL-ENT  9883--CALL    11003--CALL
KQL$QDELAYR
      9529**DCL-ENT 11222--CALL
KQL$QDFDUN
      9530**DCL-ENT  9906--CALL     9911--CALL     9916--CALL     9921--CALL     9933--CALL     9969--CALL
     10197--CALL    10608--CALL    10619--CALL    10639--CALL
KQL$QDFIND
      9531**DCL-ENT  9939--CALL    10005--CALL    10038--CALL
KQM$GETBR
      9532**DCL-ENT 11255--CALL
KQM$GETRBLK
      9533**DCL-ENT 11246--CALL
KQM$RELMBLK
      9534**DCL-ENT  9815--CALL
KQM$RELRBLK
      9535**DCL-ENT 11269--CALL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:319  
KQP$UNLOCK
      9536**DCL-ENT 10499--CALL
KQQ$ACT
      9537**DCL-ENT 11447--CALL
KQQ$DEQUEUE
      9538**DCL-ENT 11276--CALL
KQQ$DQEOFTIME
      9539**DCL-ENT 10151--CALL    10732--CALL    10885--CALL
KQR$FCONT
     10334**ENTRY   10321--CALL    10448--CALL
KQT$GETSTA
      9540**DCL-ENT  9927--CALL
KQT$GETTYP
      9541**DCL-ENT  9926--CALL
KQT$LBT
      9542**DCL-ENT 10868--CALL
KQT$UBT
      9543**DCL-ENT 10730--CALL    10883--CALL    10894--CALL    10902--CALL    10934--CALL    10942--CALL
KQU$DELMSG
      9545**DCL-ENT 10954--CALL
KQU$DELREAD
      9546**DCL-ENT  9811--CALL    10925--CALL    11042--CALL    11090--CALL
KQU$UNLATCH
      9547**DCL-ENT 10908--CALL    10910--CALL    10916--CALL    10919--CALL    10935--CALL    11080--CALL
     11086--CALL    11096--CALL
KQU$UNLATCHF
      9548**DCL-ENT  9789--CALL
KQW$SENDAUP
      9549**DCL-ENT 11037--CALL
KQX$CHKTIME
      9550**DCL-ENT 10012--CALL    10040--CALL    10995--CALL
KQX$LDASR
      9551**DCL-ENT 11692--CALL
KQX$SETTIME
      9552**DCL-ENT  9995--CALL    10020--CALL    10048--CALL    10962--CALL    10997--CALL
KQY$YC
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:320  
      9553**DCL-ENT 10152--CALL
KQZ$LOG
      9554**DCL-ENT  9690--CALL    10566--CALL    10599--CALL
KQ_ERRLOG_BFR.CODE
      9594**DCL     11179<<ASSIGN
KQ_ERRLOG_BFR.INFO
      9595**DCL     11180--ASSIGN  11181<<ASSIGN
KQ_ERRLOG_BFR.SIZ
      9595**DCL     11191<<ASSIGN  11196<<ASSIGN
KQ_ERRLOG_GATE
      2997**DCL     11177<>CALL
KQ_IMBLK.DVE.EOMCHAR
      3629**DCL      3631--REDEF
KQ_IMBLK.KEY1
      3555**DCL      3557--REDEF
KQ_IMBLK.KEY2
      3564**DCL      3582--REDEF
KQ_IMBLK.LNK$
      3529**DCL      3531--REDEF    3537--REDEF    3541--REDEF
KQ_IMBLK.TYC
      3678**DCL      3680--REDEF
KQ_IMBLK.XSP.MREQ$
      3584**DCL      3588--REDEF
KQ_IRBLK
      3011**DCL      9819>>ASSIGN
KQ_IRBLK.BUF$
      3133**DCL      3135--REDEF
KQ_IRBLK.CNACTD
      3047**DCL      3056--REDEF
KQ_IRBLK.DBLKX
      3153**DCL      3157--REDEF
KQ_IRBLK.EOFNONE
      3025**DCL      3028--REDEF
KQ_IRBLK.FROMQ
      3031**DCL      3034--REDEF
KQ_IRBLK.KEY1R
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:321  
      3072**DCL      3073--REDEF
KQ_IRBLK.KEY2R
      3077**DCL      3078--REDEF
KQ_IRBLK.LATCH
      3020**DCL      3022--REDEF
KQ_IRBLK.LWRITES$
      3164**DCL      3168--REDEF
KQ_IRBLKT.CNACTD
      3233**DCL      3242--REDEF
KQ_IRBLKT.DBLK$
      3296**DCL      3300--REDEF    3303--REDEF
KQ_IRBLKT.EOFNONE
      3211**DCL      3214--REDEF
KQ_IRBLKT.FROMQ
      3217**DCL      3220--REDEF
KQ_IRBLKT.KEY1R
      3258**DCL      3259--REDEF
KQ_IRBLKT.KEY2R
      3263**DCL      3264--REDEF
KQ_IRBLKT.LATCH
      3206**DCL      3208--REDEF
KQ_LOG.DSIO
      2988**DCL      9689>>IF      10561>>IF      10584>>IF
KQ_XFGATE
      2971**DCL     10383<>CALL    10391<>CALL    10424<>CALL    10432<>CALL
LDCT$
      9372**DCL      6858--IMP-PTR  9959>>ASSIGN  10108>>ASSIGN  10135>>IF      10152>>CALL    10291>>ASSIGN
     10319>>ASSIGN  10676>>ASSIGN  10688>>ASSIGN  10865<<ASSIGN  10873>>ASSIGN  10886>>ASSIGN  11059<<ASSIGN
     11115<<ASSIGN  11660>>ASSIGN  11689<<ASSIGN  11690>>ASSIGN  11691>>ASSIGN  11707>>IF
LDTYC
     10233**LABEL   10242--GOTO    10406--GOTO
LOGERR
     11172**PROC    10299--CALL    10303--CALL    10825--CALL
MAPBUF
     11735**PROC     9951--CALL    10103--CALL    10290--CALL    10318--CALL
MBLK$
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:322  
      9375**DCL      8354--IMP-PTR  9376--REDEF    9743<<ASSIGN   9760<<ASSIGN   9768<<ASSIGN   9769>>IF
      9774>>ASSIGN   9775>>CALL     9776>>ASSIGN   9808<<ASSIGN   9809>>IF       9810>>IF       9815<>CALL
      9883<>CALL     9938<<ASSIGN   9939<>CALL    10004<<ASSIGN  10005<>CALL    10037<<ASSIGN  10038<>CALL
     10210>>IF      10212>>ASSIGN  10212>>ASSIGN  10215>>IF      10227>>IF      10228>>IF      10249>>ASSIGN
     10283>>ASSIGN  10312>>ASSIGN  10340<<ASSIGN  10366<<ASSIGN  10375>>IF      10377>>ASSIGN  10377>>ASSIGN
     10380>>IF      10401>>IF      10402>>IF      10413>>ASSIGN  10500<<ASSIGN  10531>>IF      10541>>IF
     10757<<ASSIGN  10950<<ASSIGN  10952>>DOWHILE 10953>>ASSIGN  10954>>CALL    10955<<ASSIGN  11003<>CALL
     11012<<ASSIGN  11014>>IF      11015>>DOCASE  11022>>ASSIGN  11033>>ASSIGN  11034>>ASSIGN  11036>>ASSIGN
     11148>>ASSIGN  11149>>ASSIGN  11379>>ASSIGN  11381>>ASSIGN  11382>>ASSIGN  11383>>ASSIGN  11663>>ASSIGN
     11664>>ASSIGN  11667>>ASSIGN  11668>>ASSIGN  11672>>ASSIGN  11673>>ASSIGN  11675>>ASSIGN  11677>>ASSIGN
MLH$
      9426**DCL      8625--IMP-PTR
MMS$SETUP_BUF
      9555**DCL-ENT 11748--CALL
MOVERD1
     10401**LABEL   10438--GOTO    10502--GOTO
MOVERD2
     10414**LABEL   10344--GOTO
N$DCT$$
      4018**DCL      4018--IMP-PTR 11689>>ASSIGN
N$REQ
      6796**DCL     10567<>CALL    10601<>CALL
N$REQ.ARSIZE
      6829**DCL      9755<<ASSIGN  10203<<ASSIGN  10262<<ASSIGN  10262>>ASSIGN  10368<<ASSIGN  10434<<ASSIGN
     10434>>ASSIGN  11416<<ASSIGN
N$REQ.BUF$
      6805**DCL      9748>>ASSIGN   9845>>ASSIGN
N$REQ.BUFADDR
      6805**DCL      6806--REDEF    6806--REDEF
N$REQ.BUFSIZE
      6799**DCL      9745>>IF       9746>>ASSIGN   9842>>IF       9843>>ASSIGN
N$REQ.DCB$
      6827**DCL     10132>>CALL
N$REQ.DLA.DCTX
      6796**DCL     11689>>ASSIGN
N$REQ.DLA.DRELADDR
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:323  
      6797**DCL      6797--REDEF
N$REQ.DVE
      6831**DCL     11675<<ASSIGN
N$REQ.DVE.DVBYTE.CONT
      6834**DCL      9738>>IF       9824>>IF      11676<<ASSIGN
N$REQ.DVE.DVBYTE.NODAT
      6833**DCL      9909>>IF       9944>>IF      10061>>IF      10087>>IF
N$REQ.DVE.EOMCHAR
      6834**DCL      6835--REDEF
N$REQ.EAINFO
      6828**DCL      6828--REDEF
N$REQ.EAINFOX
      6828**DCL      6829--REDEF
N$REQ.EVNTINFO
      6829**DCL      6829--REDEF
N$REQ.FC
      6799**DCL      9657>>DOCASE
N$REQ.OPFLG.CLR
      6805**DCL     10365<<ASSIGN  10496<<ASSIGN  10733<<ASSIGN  10755<<ASSIGN
N$REQ.OPFLG.USER
      6802**DCL     11742>>IF
N$REQ.OPFLG.WAIT
      6803**DCL      9973>>IF      10123>>IF      10322>>IF
N$REQ.STATION.LSTA$
      6809**DCL      9838>>ASSIGN  11661<<ASSIGN
N$REQ.STATUS
      6810**DCL      6816--REDEF
N$REQ.TYC
      6818**DCL      9734<<ASSIGN   9756<<ASSIGN  10202<<ASSIGN  10233<<ASSIGN  10238<<ASSIGN  10256<<ASSIGN
     10263>>IF      10300<<ASSIGN  10304<<ASSIGN  10367<<ASSIGN  10393>>IF      10420<<ASSIGN  10435>>IF
     10512>>IF      10574<<ASSIGN  10578<<ASSIGN  10588--IF      10605<<ASSIGN  10613<<ASSIGN  10627<<ASSIGN
     10630<<ASSIGN  10633<<ASSIGN  10636<<ASSIGN  10646<<ASSIGN  10652<<ASSIGN  10658<<ASSIGN  10665<<ASSIGN
     10724<<ASSIGN  11410<<ASSIGN  11417>>IF      11677<<ASSIGN  11677>>ASSIGN  11709<<ASSIGN  11715<<ASSIGN
N$RREQ
      6724**DCL        83--PROC    10334--ENTRY   10336--ASSIGN  10362--ENTRY   10462--ENTRY   10464--ASSIGN
     10493--ENTRY   10714--ENTRY   10752--ENTRY   10767--ENTRY   10769--ASSIGN  10788--ENTRY   10790--ASSIGN
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:324  
     10802--ENTRY   10804--ASSIGN  10821--ENTRY   10823--ASSIGN  10849--ENTRY   10860--ENTRY   10864--ASSIGN
     11055--ENTRY   11057--ASSIGN  11111--ENTRY   11113--ASSIGN  11687--ASSIGN
N$RREQ.BUFADDR
      6733**DCL      6734--REDEF    6734--REDEF
N$RREQ.DLA.DRELADDR
      6725**DCL      6725--REDEF
N$RREQ.DVE.EOMCHAR
      6762**DCL      6763--REDEF
N$RREQ.EAINFO
      6756**DCL      6756--REDEF
N$RREQ.EAINFOX
      6756**DCL      6757--REDEF
N$RREQ.EVNTINFO
      6757**DCL      6757--REDEF
N$RREQ.STATUS
      6738**DCL      6744--REDEF
NIO$COMPC
      9556**DCL-ENT 10567--CALL
NIO$COMPCNS
      9557**DCL-ENT 10601--CALL
NK$LDCT
      6858**DCL     10152<>CALL
NK$LDCT.CG$
      6889**DCL     11691>>ASSIGN
NK$LDCT.DDT$
      6860**DCL      6860--REDEF
NK$LDCT.IOQ$
      6859**DCL      6860--REDEF    9959<<ASSIGN  10108<<ASSIGN  10135>>IF      10291<<ASSIGN  10319<<ASSIGN
     10676<<ASSIGN  10688<<ASSIGN  10873>>ASSIGN  10886<<ASSIGN  11660<<ASSIGN
NK$LDCT.LDCTX
      6861**DCL      6861--REDEF
NK$LDCT.LKFLG.ABORTED
      6873**DCL      6874--REDEF
NK$LDCT.LKFLG.ACTIVE
      6877**DCL     11642>>IF      11707>>IF
NK$LDCT.RLCID.LDCTX
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:325  
      6883**DCL      6883--REDEF
NK$LDCT.STA$
      6879**DCL      6880--REDEF   11690>>ASSIGN
NK$LDCT.SYMB$
      6858**DCL      6858--REDEF    6858--REDEF    6859--REDEF
NK$LDCT$
      4018**DCL     11689>>ASSIGN
NOFETCH
     10263**LABEL   10251--CALLALT
NOFETCH1
     10284**LABEL   10285--CALLALT
NOFETCHERR
     10290**LABEL   10343--GOTO    10453--GOTO
NOFETCHU
     10435**LABEL   10415--CALLALT
NTVALID
     10719**LABEL   10720--CALLALT 10721--CALLALT
P$
      9415**DCL      9952<<ASSIGN   9953>>DOWHILE  9954>>ASSIGN   9955<<ASSIGN  10953<<ASSIGN  10955>>ASSIGN
     11019>>IF      11021>>ASSIGN  11022>>ASSIGN  11025>>CALL    11150<>CALL    11152>>CALL    11154>>IF
     11154>>IF      11157>>CALL    11180<<ASSIGN  11182>>ASSIGN  11183<<ASSIGN  11183>>ASSIGN  11184>>ASSIGN
     11185<<ASSIGN  11185>>ASSIGN  11186>>ASSIGN  11187<<ASSIGN  11187>>ASSIGN  11190>>ASSIGN  11195>>ASSIGN
P$ IN PROCEDURE QEOFT
     11314**DCL     11318<<ASSIGN  11319>>ASSIGN  11322<<ASSIGN  11323>>ASSIGN  11326>>ASSIGN  11327>>ASSIGN
PSTMP IN PROCEDURE MAPBUF
     11738**DCL     11744<<ASSIGN  11745>>IF      11746<>CALL
QACTCNT
      9428**DCL      9894<<ASSIGN  10022>>IF      10050>>IF
QEOFT
     11311**PROC    11293--CALL    11307--CALL
QEOFTIME
     11288**PROC     9966--CALL    10115--CALL
QEOFTIMENL
     11305**PROC     9964--CALL
QKNFND
      9430**DCL      9431--REDEF   10026<<ASSIGN  10030<<ASSIGN  10052<<ASSIGN  10063>>IF
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:326  
QTN$
      9425**DCL      8785--IMP-PTR  9902<>CALL     9924<<ASSIGN   9926<>CALL     9927<>CALL     9935>>IF
      9935>>IF       9935>>IF       9938>>ASSIGN   9947>>ASSIGN   9948>>ASSIGN   9999<<ASSIGN  10000>>DOWHILE
     10001>>IF      10001>>IF      10001>>IF      10004>>ASSIGN  10024<<ASSIGN  10024>>ASSIGN  10031<<ASSIGN
     10032>>DOWHILE 10033>>IF      10034>>IF      10034>>IF      10034>>IF      10037>>ASSIGN  10055<<ASSIGN
     10055>>ASSIGN  10189>>ASSIGN  10190>>IF      10193>>ASSIGN  10193>>ASSIGN  10195>>ASSIGN  10195>>ASSIGN
     11529<>CALL    11546<>CALL    11549>>IF      11550>>IF      11553<<ASSIGN  11553>>ASSIGN  11554>>IF
     11556>>IF      11572<>CALL    11589<>CALL    11592>>IF      11593>>IF      11596<<ASSIGN  11596>>ASSIGN
     11597>>IF      11599>>IF      11641>>IF      11642>>IF
QTS0
      9887**LABEL   10022--GOTO    10050--GOTO
QTS1
      9904**LABEL    9902--CALLALT
QTS11
     10052**LABEL   10051--CALLALT
QTS2
      9906**LABEL    9943--GOTO    10060--GOTO
QTS25
      9911**LABEL    9945--GOTO    10062--GOTO
QTS3
      9916**LABEL   10067--GOTO
QTS305
      9921**LABEL    9946--CALLALT
QTS31
      9928**LABEL    9926--CALLALT  9927--CALLALT
QTS4
      9935**LABEL    9903--GOTO
QTS45
      9946**LABEL    9928--GOTO
QTS5
      9949**LABEL   10072--GOTO
QUEUE$
      9432**DCL      9948<<ASSIGN   9952>>ASSIGN   9954<<ASSIGN   9955>>ASSIGN   9958>>ASSIGN  10070<<ASSIGN
R$ IN PROCEDURE QEOFT
     11315**DCL     11319<<ASSIGN  11320>>DOWHILE 11321>>IF      11322>>ASSIGN  11323<<ASSIGN
RBLK$
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:327  
      9374**DCL      7982--IMP-PTR  9698<<ASSIGN   9701>>IF       9702>>IF       9703>>IF       9703>>IF
      9716>>IF       9718>>DOCASE   9740>>IF       9743>>ASSIGN   9744>>ASSIGN   9746>>ASSIGN   9747>>ASSIGN
      9748>>ASSIGN   9749>>ASSIGN   9760>>ASSIGN   9764>>IF       9766>>IF       9768>>ASSIGN   9769>>IF
      9776>>ASSIGN   9781>>ASSIGN   9782>>ASSIGN   9794>>IF       9795>>ASSIGN   9808>>ASSIGN   9810>>IF
      9814>>ASSIGN   9819>>ASSIGN   9841>>ASSIGN   9843>>ASSIGN   9844>>ASSIGN   9845>>ASSIGN   9846>>ASSIGN
      9851>>ASSIGN   9852>>ASSIGN   9853>>IF       9854>>ASSIGN   9860>>ASSIGN   9861>>ASSIGN   9865>>ASSIGN
      9866>>ASSIGN   9866>>ASSIGN   9867>>ASSIGN   9868>>ASSIGN   9869>>ASSIGN   9871>>ASSIGN   9884>>IF
      9885>>IF       9885>>IF       9902>>CALL     9926>>CALL     9927>>CALL     9940>>IF       9947>>ASSIGN
      9950>>ASSIGN   9957>>ASSIGN   9958>>ASSIGN   9968>>ASSIGN   9973>>IF      10006>>IF      10033>>IF
     10039>>IF      10071>>ASSIGN  10104>>ASSIGN  10105>>IF      10106>>ASSIGN  10107>>ASSIGN  10111>>ASSIGN
     10120>>ASSIGN  10140<<ASSIGN  10141>>IF      10143>>DOCASE  10146>>ASSIGN  10151<>CALL    10186>>IF
     10188>>ASSIGN  10189>>ASSIGN  10231>>IF      10232>>IF      10241>>IF      10250>>ASSIGN  10253>>ASSIGN
     10254>>IF      10257>>ASSIGN  10260>>ASSIGN  10260>>ASSIGN  10270>>ASSIGN  10270>>ASSIGN  10284>>ASSIGN
     10311>>ASSIGN  10313>>ASSIGN  10339>>IF      10340>>ASSIGN  10366>>ASSIGN  10385>>ASSIGN  10405>>IF
     10414>>ASSIGN  10417>>ASSIGN  10418>>IF      10421>>ASSIGN  10426>>ASSIGN  10428>>ASSIGN  10428>>ASSIGN
     10466<<ASSIGN  10468>>ASSIGN  10479>>ASSIGN  10497>>IF      10498>>ASSIGN  10500>>ASSIGN  10513>>IF
     10516>>ASSIGN  10517>>IF      10533>>ASSIGN  10534>>ASSIGN  10543>>ASSIGN  10544>>ASSIGN  10550>>ASSIGN
     10553>>ASSIGN  10560>>ASSIGN  10644>>DOCASE  10718>>ASSIGN  10719>>ASSIGN  10726>>ASSIGN  10732<>CALL
     10756>>ASSIGN  10757>>ASSIGN  10771<<ASSIGN  10772>>IF      10773>>IF      10773>>IF      10773>>IF
     10773>>IF      10872<<ASSIGN  10874>>IF      10875>>DOCASE  10879>>ASSIGN  10885<>CALL    10903>>IF
     10924>>IF      10976>>ASSIGN  10977>>ASSIGN  10983>>ASSIGN  10984>>ASSIGN  10985>>ASSIGN  10989>>ASSIGN
     10990>>ASSIGN  10991>>ASSIGN  11002>>ASSIGN  11006>>ASSIGN  11011>>ASSIGN  11012>>ASSIGN  11035>>ASSIGN
     11062<<ASSIGN  11063>>IF      11065>>DOCASE  11071>>IF      11073>>IF      11076>>IF      11079>>ASSIGN
     11100<<ASSIGN  11260<<ASSIGN  11268>>ASSIGN  11275>>ASSIGN  11317>>ASSIGN  11326>>ASSIGN  11327>>ASSIGN
     11343>>ASSIGN  11343>>ASSIGN  11344>>ASSIGN  11344>>ASSIGN  11345>>ASSIGN  11346>>ASSIGN  11348>>IF
     11378>>IF      11407>>ASSIGN  11408>>IF      11411>>ASSIGN  11413>>ASSIGN  11413>>ASSIGN  11414>>ASSIGN
     11414>>ASSIGN  11415>>ASSIGN  11415>>ASSIGN  11419>>ASSIGN  11419>>ASSIGN  11423>>ASSIGN  11424>>ASSIGN
     11529>>CALL    11535>>IF      11546>>CALL    11550>>IF      11556>>IF      11572>>CALL    11578>>IF
     11589>>CALL    11593>>IF      11599>>IF      11630>>IF      11638>>IF      11693<<ASSIGN  11740>>IF
     11741>>ASSIGN  11748>>CALL    11748>>CALL    11748>>CALL    11749>>ASSIGN
RCVR0
     11086**LABEL   11082--GOTO
RCVR1
     11091**LABEL   11068--GOTO
RDDUN
     10501**LABEL   10234--GOTO    10266--CALLALT 10437--CALLALT
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:328  
RDDUN0
     10543**LABEL    9761--GOTO    10218--CALLALT 10239--GOTO    10272--GOTO    10314--GOTO    10393--GOTO
     10535--GOTO    10545--GOTO    10575--GOTO    10580--GOTO
READCOMP
     10543**LABEL   10759--GOTO
REGIM
     10127**LABEL   10165--GOTO    10322--GOTO
REGIMA
     10124**LABEL    9986--GOTO
RERDCH
      9742**LABEL    9783--GOTO
RTN IN PROCEDURE VRQKEY
     11472**LABEL   11512--GOTO
RUFPT.V
      9475**DCL      9475--DCLINIT 10908<>CALL    10919<>CALL    11086<>CALL
SC_BCGIOF
      9559**DCL-ENT  9668--CALL
SC_BCGRBS
      9560**DCL-ENT  9721--CALL    10168--CALL    10307--CALL    10339--CALL    10403--CALL    10497--CALL
     10649--CALL    11221--CALL    11230--CALL
SC_CGCALZ
      9562**DCL-ENT 11445--CALL
SECS IN PROCEDURE QEOFT
     11313**DCL     11316<<ASSIGN  11317>>ASSIGN  11321>>IF
SETRCOMP
     11658**PROC    10557--CALL    10758--CALL
SETUP
     11685**PROC     9656--CALL    10364--CALL    10495--CALL    10716--CALL    10754--CALL
SETUP1 IN PROCEDURE SETUP
     11688**ENTRY   10338--CALL
SSR$REG
      9558**DCL-ENT 10016--CALL    10044--CALL    10132--CALL    10895--CALL    10996--CALL    11226--CALL
STA$
      9373**DCL      7644--IMP-PTR  9690>>CALL     9690>>CALL     9696>>CALL     9698>>ASSIGN   9751>>CALL
      9758>>CALL     9772>>CALL     9778>>CALL     9787>>CALL     9789>>CALL     9791>>CALL     9793>>ASSIGN
      9793>>ASSIGN   9811>>CALL     9839>>IF       9883>>CALL     9890>>CALL     9906>>CALL     9911>>CALL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:329  
      9916>>CALL     9921>>CALL     9924>>ASSIGN   9933>>CALL     9939>>CALL     9950>>ASSIGN   9969>>CALL
      9971>>CALL     9977>>CALL     9983>>CALL    10005>>CALL    10038>>CALL    10084>>CALL    10089>>CALL
     10095>>CALL    10100>>CALL    10111>>ASSIGN  10113>>CALL    10117>>CALL    10121>>CALL    10138>>CALL
     10140>>ASSIGN  10148>>CALL    10153>>ASSIGN  10158>>CALL    10163>>CALL    10197>>CALL    10464<<ASSIGN
     10465>>ASSIGN  10466>>ASSIGN  10470>>CALL    10472>>ASSIGN  10472>>ASSIGN  10474>>CALL    10480>>ASSIGN
     10499>>CALL    10519>>IF      10522>>CALL    10524>>ASSIGN  10526>>CALL    10559>>ASSIGN  10559>>ASSIGN
     10566>>CALL    10566>>CALL    10599>>CALL    10599>>CALL    10608>>CALL    10611>>CALL    10619>>CALL
     10623>>CALL    10625>>CALL    10639>>CALL    10642>>CALL    10656>>CALL    10662>>CALL    10672>>CALL
     10674>>ASSIGN  10679>>ASSIGN  10683>>CALL    10728>>CALL    10769<<ASSIGN  10770>>ASSIGN  10771>>ASSIGN
     10778>>ASSIGN  10790<<ASSIGN  10791>>ASSIGN  10804<<ASSIGN  10805>>ASSIGN  10807>>CALL    10811>>CALL
     10823<<ASSIGN  10824>>ASSIGN  10864<<ASSIGN  10865>>ASSIGN  10866>>ASSIGN  10870>>CALL    10872>>ASSIGN
     10881>>CALL    10892>>CALL    10900>>CALL    10908>>CALL    10910>>CALL    10916>>CALL    10919>>CALL
     10925>>CALL    10926>>ASSIGN  10932>>CALL    10935>>CALL    10940>>CALL    10948>>IF      10950>>ASSIGN
     10951>>ASSIGN  10959>>IF      10959>>IF      10963>>IF      10964>>ASSIGN  10965>>IF      10968>>CALL
     10972>>CALL    10974>>IF      11000>>CALL    11003>>CALL    11004>>CALL    11005>>ASSIGN  11013>>IF
     11036>>ASSIGN  11037>>CALL    11042>>CALL    11057<<ASSIGN  11058>>ASSIGN  11061>>ASSIGN  11062>>ASSIGN
     11073>>IF      11080>>CALL    11086>>CALL    11090>>CALL    11091>>ASSIGN  11096>>CALL    11113<<ASSIGN
     11114>>ASSIGN  11182>>ASSIGN  11186>>ASSIGN  11190>>ASSIGN  11195>>ASSIGN  11222>>CALL    11250>>CALL
     11252>>IF      11253>>ASSIGN  11257>>CALL    11259>>ASSIGN  11350>>ASSIGN  11690<<ASSIGN  11693>>ASSIGN
     11712>>IF      11715>>ASSIGN  11716>>IF      11717>>ASSIGN
S_CUN
      9564**DCL     11218>>ASSIGN  11221>>IF      11230>>IF
T$ IN PROCEDURE CHUNKOK
     11341**DCL     11350<<ASSIGN  11351<>CALL
T$ IN PROCEDURE GETRBLK
     11244**DCL     11246<>CALL    11253<<ASSIGN  11255<>CALL    11259>>ASSIGN  11260>>ASSIGN  11268<<ASSIGN
     11269<>CALL    11275<<ASSIGN  11276<>CALL
T$ IN PROCEDURE XFAUEV
     11376**DCL     11390<>CALL    11392>>CALL    11394>>IF      11395>>IF      11396>>ASSIGN  11396>>ASSIGN
     11398>>CALL
TBRK1 IN PROCEDURE XFAUEV
     11394**LABEL   11390--CALLALT
TIMCHK
      9434**DCL      9995<>CALL    10012<>CALL    10020<>CALL    10040<>CALL    10048<>CALL    10962<>CALL
     10995<>CALL    10997<>CALL
TREE$ IN PROCEDURE VRQKEY
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:330  
     11469**DCL     11472<<ASSIGN  11479>>CALL    11484>>CALL    11495<<ASSIGN  11506<<ASSIGN  11507<<ASSIGN
     11509>>CALL    11519<<ASSIGN  11520<<ASSIGN  11572>>CALL    11589>>CALL
TYC
      9429**DCL     10627>>ASSIGN  10724>>ASSIGN  11561<<ASSIGN  11564<<ASSIGN
UB$ IN PROCEDURE MAPBUF
     11737**DCL     11741<<ASSIGN  11744--ASSIGN  11748<>CALL
UNLALT
     10912**LABEL   10908--CALLALT
UNLATCHRD
      9783**LABEL    9704--GOTO
VAL0
     10724**LABEL   10717--CALLALT
VLP$STATION
      9326**DCL      9838>>ASSIGN
VLP$STATION.MSGIDXT
      9332**DCL      9334--REDEF
VLP_STATION
      9380**DCL      9390--REDEF    9838<<ASSIGN  11661--ASSIGN
VLP_STATION.CTL
      9384**DCL     11662<<ASSIGN
VLP_STATION.CTL.DIRONLY
      9385**DCL      9885>>IF
VLP_STATION.CTL.EOFNONE
      9385**DCL      9904>>IF       9942>>IF      10059>>IF      10082>>IF
VLP_STATION.CTL.EOFONE
      9384**DCL      9839>>IF
VLP_STATION.CTL.LATCH
      9384**DCL      9841>>ASSIGN
VLP_STATION.EOFTIME
      9386**DCL      9960>>IF      10109>>IF      11316>>ASSIGN
VLP_STATION.MSGID
      9386**DCL      9846>>ASSIGN  10566<>CALL    10566--CALL    10599<>CALL    10599--CALL    11663<<ASSIGN
VLP_STATION.MSGIDXT
      9386**DCL      9388--REDEF   11664<<ASSIGN
VLP_STATION.MSGTYP
      9384**DCL      9847>>IF       9850>>CALLBLT  9851--ASSIGN  11668<<ASSIGN  11673<<ASSIGN
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:331  
VLP_STATION.STATION
      9384**DCL      9856>>IF       9859>>CALLBLT  9860--ASSIGN  11667<<ASSIGN  11672<<ASSIGN
VR1 IN PROCEDURE VRQ
     11529**LABEL   11529--CALLALT 11549--GOTO    11554--GOTO
VR2 IN PROCEDURE VRQ
     11541**LABEL   11546--CALLALT
VR3 IN PROCEDURE VRQ
     11550**LABEL   11558--CALLALT
VR4 IN PROCEDURE VRQ
     11554**LABEL   11551--GOTO
VR5 IN PROCEDURE VRQ
     11558**LABEL   11547--GOTO
VR7 IN PROCEDURE VRQ
     11556**LABEL   11539--GOTO    11582--GOTO
VR8 IN PROCEDURE VRQ
     11561**LABEL   11530--CALLALT 11542--GOTO    11573--CALLALT 11585--GOTO
VRNQ IN PROCEDURE VRQ
     11567**ENTRY   11511--CALL    11521--CALL
VRNQ1 IN PROCEDURE VRQ
     11572**LABEL   11572--CALLALT 11592--GOTO    11597--GOTO    11606--GOTO
VRNQ2 IN PROCEDURE VRQ
     11585**LABEL   11589--CALLALT
VRNQ3 IN PROCEDURE VRQ
     11593**LABEL   11603--CALLALT
VRNQ4 IN PROCEDURE VRQ
     11597**LABEL   11594--GOTO
VRNQ5 IN PROCEDURE VRQ
     11599**LABEL   11590--GOTO
VRNQKEY IN PROCEDURE VRQKEY
     11503**ENTRY    9949--CALL    10098--CALL
VRNQKEYNL IN PROCEDURE VRQKEY
     11517**ENTRY   10721--CALL
VRQ IN PROCEDURE VRQKEY
     11524**PROC    11476--CALL    11496--CALL
VRQKEY
     11467**PROC    10097--CALL
PL6.E3A0      #001=KQR$READ File=KQR$READ.:E05TSI                                WED 07/30/97 01:35 Page:332  
VRQKEYNL IN PROCEDURE VRQKEY
     11492**ENTRY   10720--CALL
XFAUEV
     11374**PROC    10218--CALL    10387--CALL
XFERRD
     10193**LABEL    9883--CALLALT
XFERRD0
     10200**LABEL    9753--GOTO
XFERRD01
     10218**LABEL   10404--GOTO
XFERRD1
     10236**LABEL   10267--GOTO
XFERRD10
     10250**LABEL   10286--GOTO
