VERSION E05

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:1    
        1        1        /*M* IGS$SYSMAK - Driver module for SYSMAK phase of GHOST1         */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0    */
        8        8        /*P*    NAME:   IGS$SYSMAK
        9        9                PURPOSE: To install all of the shared processors whose
       10       10                        names are currently in the processor tables.
       11       11                DESCRIPTION: The processor tables are scanned between
       12       12                        entries #1 and P_NPROCS for active processor names
       13       13                        (i.e. not ':FREE', ':OLDPROC', or a processor
       14       14                        overlay).  For all those found, SYSMAK will attempt
       15       15                        to open a run unit in :SYS of the same name, and
       16       16                        install it as a shared processor in the mode indi-
       17       17                        cated by the processor flags associated with the
       18       18                        name found in the processor tables.  SYSMAK assumes
       19       19                        that the first three special descriptor slots have
       20       20                        been M$SAD-ed as follows:
       21       21                                SPCL1SID: Monitor instruction segment.
       22       22                                SPCL2SID: TIGR-built tables.
       23       23                                SPCL3SID: Physical page usage table (MM$PPUT).
       24       24        */
       25       25        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:2    
       26       26        IGS$SYSMAK: PROC;
       27       27        %INCLUDE B_ERRORS_C;
       28     1154        %INCLUDE B_SEGIDS_C;
       29     1693        %INCLUDE B$OBJECT_C;
       30     5123        %INCLUDE B$P;
       31     5207        %INCLUDE CP_6;
       32     5288        %INCLUDE CP_6_SUBS;
       33     5828        %F$DCB;
       34     5885        %INCLUDE FM$FIT;
       35     6106        %INCLUDE I_SUBS_C;
       36     6130        %INCLUDE IP_PERR_C;
       37     6158        %INCLUDE IPS_SUBS_C;
       38     6195        %INCLUDE M$JIT_C;
       39     6402        /**/
       40     6403        /* STATIC DATA */
       41     6404    1   DCL FITBUF(0:1023) UBIN STATIC DALIGNED;
       42     6405    1   DCL HEADBUF(0:24) UBIN STATIC DALIGNED;
       43     6406    1   DCL 1 STLVEC STATIC DALIGNED,
       44     6407    1         2 * UBIN WORD,
       45     6408    1         2 PNO UBIN WORD;
       46     6409    1   DCL 1 PCNTRL_INIT STATIC,
       47     6410    1         2 CMD# UBIN WORD INIT(I_ICMD),
       48     6411    1         2 PNAME$ PTR INIT(ADDR(NIL)),
       49     6412    1         2 PACCT$ PTR INIT(ADDR(SYS_ACCT)),
       50     6413    1         2 PTYPE UBIN HALF UNAL INIT(0),
       51     6414    1         2 PERM BIT(1) UNAL INIT('0'B),
       52     6415    1         2 * UBIN(8) UNAL INIT(0),
       53     6416    1         2 OVRLNUM UBIN BYTE UNAL INIT(0),
       54     6417    1         2 FID$ PTR INIT(ADDR(NIL)),
       55     6418    1         2 MODTIME UBIN WORD INIT(0),
       56     6419    1         2 PNUM UBIN HALF UNAL INIT(0),
       57     6420    1         2 * UBIN(18) UNAL INIT(0),
       58     6421    1         2 PFLGS BIT(36) UNAL INIT('0'B);
       59     6422    1   DCL 1 HEAD_KEY STATIC,
       60     6423    1         2 S UBIN(9) UNAL INIT(4),
       61     6424    1         2 T CHAR(4) UNAL INIT('HEAD');
       62     6425    1   DCL T_CRLF(0:1) CHAR(1) STATIC UNAL INIT(BITASC('015'O),BITASC('012'O));
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:3    
       63     6426    1   DCL 1 JITERR STATIC,
       64     6427    1         2 FCG BIT(12) UNAL,
       65     6428    1         2 MID BIT(6) UNAL,
       66     6429    1         2 M BIT(1) UNAL,
       67     6430    1         2 CODE UBIN(14) UNAL,
       68     6431    1         2 SEV UBIN(3) UNAL;
       69     6432    1   DCL 1 JITERR_INIT CONSTANT,
       70     6433    1         2 FCG BIT(12) UNAL INIT('1107'O),
       71     6434    1         2 MID BIT(6) UNAL INIT('23'O),
       72     6435    1         2 M BIT(1) UNAL INIT('0'B),
       73     6436    1         2 CODE UBIN(14) UNAL INIT(0),
       74     6437    1         2 SEV UBIN(3) UNAL INIT(0);
       75     6438    1   DCL FIT$ PTR STATIC INIT(ADDR(FITBUF));
       76     6439    1   DCL PREVXCON BIT(72) STATIC DALIGNED;
       77     6440        /* GLOBAL (SYMDEF) DATA */
       78     6441    1   DCL IGS_UNWIND REMEMBER STATIC SYMDEF DALIGNED;
       79     6442    1   DCL ERRMSGBUF CHAR(120) STATIC SYMDEF DALIGNED;
       80     6443    1   DCL ERRMSG(0:119) REDEF ERRMSGBUF CHAR(1) UNAL;
       81     6444    1   DCL BUF$ PTR STATIC SYMDEF;
       82     6445    1   DCL WSPTD$ PTR STATIC SYMDEF;
       83     6446    1   DCL ROSEG$ PTR STATIC SYMDEF;
       84     6447    1   DCL PGTBL$ PTR STATIC SYMDEF;
       85     6448    1   DCL EI$ PTR STATIC SYMDEF;
       86     6449    1   DCL HEAD$ PTR STATIC SYMDEF INIT(ADDR(HEADBUF));
       87     6450    1   DCL P$ PTR STATIC SYMDEF;
       88     6451    1   DCL AUTO_START UBIN STATIC SYMDEF;
       89     6452    1   DCL NPROCS UBIN STATIC SYMDEF;
       90     6453    1   DCL MAXPROCS UBIN STATIC SYMDEF;
       91     6454    1   DCL NSCPU UBIN STATIC SYMDEF;
       92     6455    1   DCL SCPUWSPTD(0:7) UBIN STATIC SYMDEF;
       93     6456    1   DCL IPA_RESTART BIT(72) STATIC SYMDEF;
       94     6457    1   DCL 1 RUM_CMD STATIC,
       95     6458    1         2 * CHAR(5) UNAL INIT('READ '),
       96     6459    1         2 FID CHAR(4) UNAL,
       97     6460    1         2 * CHAR(5) UNAL INIT('.:SYS');
       98     6461        /* AUTO */
       99     6462    1   DCL I SBIN;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:4    
      100     6463    1   DCL J SBIN;
      101     6464    1   DCL PNUM UBIN WORD;
      102     6465    1   DCL PTYPE UBIN WORD;
      103     6466    1   DCL PFLGS BIT(36);
      104     6467    1   DCL PROC_SLOT UBIN;
      105     6468    1   DCL 1 PCNTRL,
      106     6469    1         2 CMD# UBIN WORD,
      107     6470    1         2 PNAME$ PTR,
      108     6471    1         2 PACCT$ PTR,
      109     6472    1         2 PTYPE UBIN HALF UNAL,
      110     6473    1         2 PERM BIT(1) UNAL,
      111     6474    1         2 * UBIN(8) UNAL,
      112     6475    1         2 OVRLNUM UBIN BYTE UNAL,
      113     6476    1         2 FID$ PTR,
      114     6477    1         2 MODTIME UBIN WORD,
      115     6478    1         2 PNUM UBIN HALF UNAL,
      116     6479    1         2 * UBIN(18) UNAL,
      117     6480    1         2 PFLGS BIT(36) UNAL;
      118     6481        /* BASED */
      119     6482    1   DCL B$CHAR8 CHAR(8) BASED UNAL;
      120     6483    1   DCL 1 B$TEXTC BASED ALIGNED,
      121     6484    1         2 COUNT UBIN(9) UNAL,
      122     6485    1         2 TEXT CHAR(B$TEXTC.COUNT) UNAL;
      123     6486        %B$TCB;
      124     6489        %B$ALT;
      125     6497        %B$XCON;
      126     6507        /* SYMREF */
      127     6508    1   DCL B$JIT$ PTR SYMREF;
      128     6509    1   DCL B$IS$ PTR SYMREF;
      129     6510    1   DCL B$TCB$ PTR SYMREF;
      130     6511    1   DCL S_NSCPU UBIN SYMREF;
      131     6512    1   DCL IT_SCPUWSPTD(0:3) UBIN SYMREF;
      132     6513    1   DCL IG_BOOTFLAG UBIN SYMREF;
      133     6514
      134     6515    1   DCL 1 P_NAME SYMREF,
      135     6516    1         2 L UBIN(9) UNAL,
      136     6517    1         2 TEXT CHAR(6) UNAL;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:5    
      137     6518    1   DCL 1 RF_NAME SYMREF,
      138     6519    1         2 L UBIN(9) UNAL,
      139     6520    1         2 TEXT CHAR(4) UNAL;
      140     6521        /* DCB */
      141     6522    1   DCL M$EI DCB;
      142     6523        /* EXTERNAL ROUTINES */
      143     6524    1   DCL IPC$ADD_SPCL ENTRY(3) ALTRET;
      144     6525    1   DCL IPC$ADD_LIB ENTRY(3) ALTRET;
      145     6526    1   DCL IPD$FREE_PROC ENTRY(2) ALTRET;
      146     6527    1   DCL IPD$MON_VALUE ENTRY(2);
      147     6528    1   DCL IPD$MON_STORE ENTRY(2);
      148     6529    1   DCL IPD$SETSEG ENTRY(2);
      149     6530    1   DCL IGS$XCON ENTRY ASYNC;
      150     6531        /**/
      151     6532        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:6    
      152     6533        /**/
      153     6534        /* MACROS */
      154     6535        /**/
      155     6536        %MACRO TXTSTR(NAME=TXTSTR,TEXT=' ');
      156     6537        DCL NAME CHAR(0) STATIC INIT(TEXT);
      157     6538        %MEND;
      158     6539        /**/
      159     6540        %MACRO TEXTC(NAME=TEXTC,STRING=' ');
      160     6541        DCL 1 NAME STATIC SYMDEF,
      161     6542              2 COUNT UBIN(9) UNAL INIT(SIZEC(STRING)),
      162     6543              2 TEXT CHAR(0) UNAL INIT(STRING);
      163     6544        %MEND;
      164     6545        /**/
      165     6546        /* MACRO INVOCATIONS */
      166     6547                %B$HEAD;
      167     6747                %RU_FLAVORS;
      168     6753                %CODE04;
      169     6761                %FM$FIT;
      170     6764        /**/
      171     6765        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:7    
      172     6766        /**/
      173     6767        /* %SUBs */
      174     6768                %SUB B$HEAD=HEAD$->B$HEAD;
      175     6769                %SUB B$P=P$->B$P;
      176     6770                %SUB FM$FIT=FIT$->FM$FIT;
      177     6771        %SUB B$ALT=B$TCB$->B$TCB.ALT$->B$ALT;
      178     6772        %SUB B$XCON=B$TCB$->B$TCB.STK$->B$XCON;
      179     6773        /**/
      180     6774        /* TEXT STRINGS */
      181     6775        %TXTSTR(NAME=T_PROCMSG,TEXT='WHILE INSTALLING PROCESSOR: ');
      182     6778        %TXTSTR(NAME=T_NORUMS,
      183     6779                TEXT='No RUM file for processors');
      184     6782        %TXTSTR(NAME=T_NODELTA,
      185     6783                TEXT='No DELTA - cant apply RUMs for processors');
      186     6786        /* This message alone means not in the processor tables */
      187     6787        %TXTSTR(NAME=T_XCON,
      188     6788                TEXT='IGS Exit Control Entry');
      189     6791        %TXTSTR(NAME=T_RUMMSG,
      190     6792                TEXT='Beginning RUM for processors');
      191     6795        %TXTSTR(NAME=T_DONERUMMSG,
      192     6796                TEXT='RUM completed for system processors.');
      193     6799        %TXTSTR(NAME=T_DELTAERR,
      194     6800                TEXT='Error in one or more RUMs consult :PF file for more info');
      195     6803        %TEXTC(NAME=TC_OLDPROC,STRING=':OLDPROC');
      196     6808        %TEXTC(NAME=TC_FREE,STRING=':FREE');
      197     6813        %TEXTC(NAME=TC_BUSY,STRING=':BUSY');
      198     6818        %TEXTC(NAME=TC_DELTA,STRING='DELTA');
      199     6823        /**/
      200     6824        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:8    
      201     6825        /**/
      202     6826        /* FPT's */
      203     6827                %FPT_TEMPWROC(FPTN=WRITE_OC);
      204     6843                %FPT_TEMPWROC(FPTN=OC_CRLF,
      205     6844                              BUFW=T_CRLF);
      206     6860                %FPT_ERRMSG(CODE=JITERR,
      207     6861                  DCB=M$EI,
      208     6862                  INCLCODE=NO,
      209     6863                  FLAGLEV=3,
      210     6864                SUBMESS=YES,
      211     6865                  BUF=ERRMSGBUF);
      212     6892        %FPT_XCON(FPTN=IGS_XCON,
      213     6893                  UENTRY=IGS$XCON,
      214     6894                  PXCON=PREVXCON);
      215     6908                %FPT_OPEN(FPTN=OPEN_EI,
      216     6909                  NAME=RU_NAME,
      217     6910                  ACCT=SYS_ACCT,
      218     6911                  DCB=M$EI,
      219     6912                  ASN=FILE,
      220     6913                  FUN=IN,
      221     6914                  ACS=DIRECT,
      222     6915                  ORG=KEYED,
      223     6916                  FPARAM=FITBUF,
      224     6917                  SCRUB=YES);
      225     7026                %FPT_OPEN(FPTN=FIND_RUM,
      226     7027                NAME=RF_NAME,
      227     7028                  ACCT=SYS_ACCT,
      228     7029                  DCB=M$EI,
      229     7030                  TEST=YES,
      230     7031                  ASN=FILE,
      231     7032                  FUN=IN,
      232     7033                  SCRUB=YES);
      233     7142
      234     7143                %FPT_OPEN(FPTN=DELETE_RUM,
      235     7144                 NAME=PF_NEW_NAME,
      236     7145                  ACCT=SYS_ACCT,
      237     7146                  DCB=M$EI,
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:9    
      238     7147                  DELETE=YES,
      239     7148                  ASN=FILE,
      240     7149                  FUN=IN,
      241     7150                  SCRUB=YES);
      242     7259
      243     7260                %FPT_OPEN(FPTN=UPDATE_RUM,
      244     7261                  NAME=P_NAME,
      245     7262                  ACCT=SYS_ACCT,
      246     7263                  DCB=M$EI,
      247     7264                  ASN=FILE,
      248     7265                  FUN=UPDATE,
      249     7266                  SCRUB=YES);
      250     7375
      251     7376                %FPT_CLOSE(FPTN=RENAME_RUM,
      252     7377                  DCB=M$EI,
      253     7378                  NAME=PF_NEW_NAME,
      254     7379                  ACCESS=NEW_ACCESS,
      255     7380                  CHGATT=YES,
      256     7381                  DISP=SAVE);
      257     7423
      258     7424        %VLP_ATTR (FPTN=NEW_ACCESS);
      259     7438        %VLP_ACCESS (READ=YES,ACCT='?',LAST=";");
      260     7455
      261     7456    1   DCL 1 PF_NEW_NAME STATIC ALIGNED,
      262     7457    1         2 L UBIN(9) UNAL INIT(7),
      263     7458    1         2 N1 CHAR(7) UNAL INIT('::PATCH');
      264     7459
      265     7460    1   DCL 1 RF_NEW_NAME STATIC ALIGNED,
      266     7461    1         2 L UBIN(9) UNAL INIT(5),
      267     7462    1         2 N1 CHAR(5) UNAL INIT('::RUM');
      268     7463
      269     7464                %VLP_NAME(FPTN=RU_NAME);
      270     7491                %VLP_ACCT(FPTN=SYS_ACCT,
      271     7492                  ACCT=':SYS');
      272     7505
      273     7506                %FPT_READ(FPTN=READ_HEAD,
      274     7507                  KEY=HEAD_KEY,
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:10   
      275     7508                  DCB=M$EI,
      276     7509                  KEYS=YES,
      277     7510                  BUF=HEADBUF);
      278     7549                %FPT_CLOSE(FPTN=CLOSE_EI,
      279     7550                  DCB=M$EI,
      280     7551                  DISP=SAVE);
      281     7593                %FPT_STLPP(RESULTS=STLVEC);
      282     7606                %FPT_ALIB(FPTN=ALIB_DELTA,
      283     7607                  LIBNAME=TC_DELTA,
      284     7608                  CMD=RUM_CMD,
      285     7609                  RETRN=NO,
      286     7610                  DLIB=YES);
      287     7627                %FPT_DLIB(FPTN=DLIB_DELTA,
      288     7628                  LIBNAME=TC_DELTA);
      289     7641                %FPT_LDEV(FPTN=PRINT_DO,
      290     7642                  REMOVE=YES,
      291     7643                  STREAMNAME='LP01');
      292     7668        /**/
      293     7669        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:11   
      294     7670        /**/
      295     7671        /* Initialize SYSMAK to begin installing shared processors.        */
      296     7672        /**/
      297     7673    1      JITERR = JITERR_INIT;
      298     7674        /* Pick up some monitor values */
      299     7675    1      CALL IPD$MON_VALUE(P_NPROCS,NPROCS);
      300     7676    1      CALL IPD$MON_VALUE(P_MAXPROCS,MAXPROCS);
      301     7677    1      CALL IPD$MON_VALUE(S_NSCPU,NSCPU);
      302     7678    2      DO I = 0 TO NSCPU;
      303     7679    2           CALL IPD$MON_VALUE(IT_SCPUWSPTD(I),SCPUWSPTD(I));
      304     7680    2           END;
      305     7681    1      CALL IPD$MON_VALUE(B$P$,P$);
      306     7682    1      CALL IPD$SETSEG(P$,%SPCL2SID);
      307     7683        /* Initialize some SYSMAK global pointers */
      308     7684    1      BUF$ = PINCRW(B$IS$,VP_BUF*1024);
      309     7685    1      WSPTD$ = PINCRW(B$IS$,VP_WSPTD*1024);
      310     7686    1      ROSEG$ = PINCRW(B$IS$,VP_ROSEG*1024);
      311     7687    1      PGTBL$ = PINCRW(B$IS$,VP_PGTBL*1024);
      312     7688    1      EI$ = DCBADDR(DCBNUM(M$EI));
      313     7689        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:12   
      314     7690
      315     7691    1      IF (IG_BOOTFLAG > I_VOLONLY) AND
      316     7692    1        (IG_BOOTFLAG < I_DISKBOOT)
      317     7693    2      THEN DO;
      318     7694        /* Because the FPTs are here we rename :PATCH to ::PATCH in this module. */
      319     7695    2           CALL M$OPEN(DELETE_RUM) ALTRET(FIRST_PATCH);
      320     7696    2   FIRST_PATCH: ;
      321     7697    2           CALL M$OPEN(UPDATE_RUM) ALTRET(WHO_CARES);
      322     7698    2           CALL M$CLOSE(RENAME_RUM) ALTRET(WHO_CARES);
      323     7699    2   WHO_CARES: ;
      324     7700
      325     7701        /* If there's a :RUM file, then we want to bring DELTA in first,   */
      326     7702        /* use it to apply all of the RUM patches to the processors in     */
      327     7703        /* :SYS, and then install them, along with DELTA again (in case it */
      328     7704        /* was the target of some updates itself).                         */
      329     7705    2           REMEMBER DELTA_XCON IN IGS_UNWIND;
      330     7706    2           CALL M$XCON(IGS_XCON) ALTRET(SKIP_IT);
      331     7707    2   SKIP_IT:
      332     7708    2           JITERR = JITERR_INIT;
      333     7709    2           RUM_CMD.FID = RF_NAME.TEXT;
      334     7710    2           CALL M$OPEN(FIND_RUM) ALTRET(NO_RUMF);
      335     7711    3           DO PNUM = 1 TO 2;               /* Install first three processors     */
      336     7712    3                CALL BUILD_PCNTRL(PNUM);
      337     7713    3                CALL GET_PTYPE(PNUM,PTYPE);
      338     7714    3                PCNTRL.PTYPE = PTYPE;
      339     7715    3                CALL OPEN_FID(PCNTRL.FID$) ALTRET(NO_DELTA2);
      340     7716    3                CALL GET_MODTIME(PCNTRL.MODTIME) ALTRET(NO_DELTA2);
      341     7717    3                CALL M$READ(READ_HEAD) ALTRET(NO_DELTA);
      342     7718    3                IF PNUM = 2                /* DELTA                              */
      343     7719    3                THEN CALL IPC$ADD_SPCL(PCNTRL,PNUM,JITERR) ALTRET(BLACK_WIDOW);
      344     7720    3                ELSE CALL IPC$ADD_LIB(PCNTRL,PNUM,JITERR) ALTRET(BLACK_WIDOW);
      345     7721    3                CALL M$CLOSE(CLOSE_EI) ALTRET(NO_DELTA);
      346     7722    3                END;
      347     7723        /*  Print 'Rumming' on OC */
      348     7724    2           CALL M$TEMPWROC(OC_CRLF);
      349     7725    2           WRITE_OC.BUFW_ = VECTOR(T_RUMMSG);
      350     7726    2           CALL M$TEMPWROC(WRITE_OC);
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:13   
      351     7727    3           CALL M$ALIB(ALIB_DELTA) WHENALTRETURN DO;
      352     7728    3                IF B$ALT.ERR.ERR# ~= %E$DLTALT THEN GOTO NO_DELTA;
      353     7729    3                CALL M$TEMPWROC (OC_CRLF);
      354     7730    3                WRITE_OC.BUFW_ = VECTOR(T_DELTAERR);
      355     7731    3                CALL M$TEMPWROC (WRITE_OC);
      356     7732    3                END;
      357     7733    2           CALL M$DLIB(DLIB_DELTA) ALTRET(EH);
      358     7734    3   EH:     DO PNUM = 1 TO 2;
      359     7735                                           /* Second parameter says dont release slot */
      360     7736    3                CALL IPD$FREE_PROC(PNUM,1);
      361     7737    3                END;
      362     7738        /* Print 'Done Rumming' on OC */
      363     7739    2           CALL M$TEMPWROC(OC_CRLF);
      364     7740    2           WRITE_OC.BUFW_ = VECTOR(T_DONERUMMSG);
      365     7741    2           CALL M$TEMPWROC(WRITE_OC);
      366     7742        /* Rename :RUM to ::RUM   */
      367     7743    2           DELETE_RUM.NAME_ = VECTOR(RF_NEW_NAME);
      368     7744    2           UPDATE_RUM.NAME_ = VECTOR(RF_NAME);
      369     7745    2           RENAME_RUM.NAME_ = VECTOR(RF_NEW_NAME);
      370     7746    2           CALL M$OPEN(DELETE_RUM) ALTRET(FIRST_RUM);
      371     7747    2   FIRST_RUM: ;
      372     7748    2           CALL M$OPEN(UPDATE_RUM) ALTRET(INSTALL_EM);
      373     7749    2           CALL M$CLOSE(RENAME_RUM) ALTRET(INSTALL_EM);
      374     7750    2           GOTO INSTALL_EM;
      375     7751
      376     7752    2   NO_RUMF:
      377     7753    2           IF B$ALT.ERR.CODE=%E$NOFILE
      378     7754    3           THEN DO;
      379     7755        /* Print 'No RUM file for processors' */
      380     7756    3                CALL M$TEMPWROC(OC_CRLF);
      381     7757    3                WRITE_OC.BUFW_ = VECTOR(T_NORUMS);
      382     7758    3                CALL M$TEMPWROC(WRITE_OC);
      383     7759    3                GOTO INSTALL_EM;
      384     7760    3                END;
      385     7761    3           ELSE DO;
      386     7762    3                JITERR=B$ALT.ERR;
      387     7763    3                GOTO PRINT_ERR;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:14   
      388     7764    3                END;
      389     7765    2   NO_DELTA: ;
      390     7766    2           JITERR=B$ALT.ERR;
      391     7767    2   NO_DELTA2:
      392     7768        /* Print 'No DELTA-cant apply RUMs'  */
      393     7769    2           CALL M$TEMPWROC(OC_CRLF);
      394     7770    2           WRITE_OC.BUFW_ = VECTOR(T_NODELTA);
      395     7771    2           CALL M$TEMPWROC(WRITE_OC);
      396     7772    2           GOTO PRINT_ERR;
      397     7773    2   DELTA_XCON:
      398     7774    2           JITERR=B$XCON.ERR;
      399     7775    2           CALL M$CLRSTK ALTRET(DELTA_XCON2);
      400     7776    2   DELTA_XCON2:
      401     7777    2           CALL M$TEMPWROC(OC_CRLF);
      402     7778    2           WRITE_OC.BUFW_ = VECTOR(T_XCON);
      403     7779        /* Print 'IGS Exit Control' */
      404     7780    2           CALL M$TEMPWROC(WRITE_OC);
      405     7781    2           CALL DUMPTCB;                   /* DUMP THE TCB ON THE CONSOLE        */
      406     7782    2   PRINT_ERR:
      407     7783    2           IF JITERR.CODE ~= 0 THEN
      408     7784    3           DO;
      409     7785    3                CALL M$ERRMSG(FPT_ERRMSG) ALTRET(WOOPS);
      410     7786    3   WOOPS:
      411     7787    3                WRITE_OC.BUFW_ = VECTOR(ERRMSGBUF);
      412     7788    3                CALL M$TEMPWROC(OC_CRLF);
      413     7789    3                CALL M$TEMPWROC(WRITE_OC);
      414     7790    3                JITERR=JITERR_INIT;
      415     7791    3                END;
      416     7792    2   INSTALL_EM:;
      417     7793    2           IGS_XCON.V_ = VECTOR(PREVXCON);
      418     7794    2           IGS_XCON.PXCON_ = VECTOR(NIL);
      419     7795    2           CALL M$XCON(IGS_XCON) ALTRET(SKIP_IT2);
      420     7796    2   SKIP_IT2: CALL M$LDEV(PRINT_DO) ALTRET(BORSCHT);
      421     7797    2   BORSCHT:;
      422     7798    2           END;
      423     7799        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:15   
      424     7800        /**/
      425     7801        /* Enter the processor-installing loop:                            */
      426     7802        /**/
      427     7803    2      DO PNUM = 1 TO NPROCS;
      428     7804    2           JITERR = JITERR_INIT;
      429     7805    2           IF (B$P.NAME.TEXT(PNUM) ~= TC_FREE.TEXT)
      430     7806    2           THEN
      431     7807    3           DO;
      432     7808    3                CALL BUILD_PCNTRL(PNUM);
      433     7809    3                CALL GET_PTYPE(PNUM,PTYPE);
      434     7810    3                PCNTRL.PTYPE = PTYPE;
      435     7811    3                CALL OPEN_FID(PCNTRL.FID$) ALTRET(BLACK_WIDOW);
      436     7812    3                CALL GET_MODTIME(PCNTRL.MODTIME) ALTRET(BLACK_WIDOW);
      437     7813    3                CALL M$READ(READ_HEAD) ALTRET(NO_HEAD);
      438     7814    3                IF DCBADDR(DCBNUM(M$EI))->F$DCB.ARS# < SIZEC(B$HEAD)
      439     7815    4                THEN DO;
      440     7816        /*E*    ERROR: IGS-E$IP_OLDRU-2
      441     7817               MESSAGE: The head record size is invald for this version.
      442     7818                MESSAGE1: The head record size for this run unit does not
      443     7819                            match the head record size for the current running
      444     7820                            system.
      445     7821              */
      446     7822    4                     JITERR.CODE = E$IP_OLDRU;
      447     7823    4                     GOTO BLACK_WIDOW;
      448     7824    4                     END;
      449     7825
      450     7826    3                IF B$HEAD.FLAVOR ~= %HOST_RU
      451     7827    4                THEN DO;
      452     7828        /*E*    ERROR: IGS-E$IP_BADFLAVOR-2
      453     7829                MESSAGE: This run unit is not a host run unit.
      454     7830        */
      455     7831    4                     JITERR.CODE = E$IP_BADFLAVOR;
      456     7832    4                     GOTO BLACK_WIDOW;
      457     7833    4                     END;
      458     7834
      459     7835    3                IF ((PCNTRL.PTYPE >= I_CP) AND (PCNTRL.PTYPE <= I_ASL)) AND
      460     7836    3                  ((B$HEAD.RDATA > 0) OR (B$HEAD.ROSIZE > 0) OR B$HEAD.OVRL)
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:16   
      461     7837    4                THEN DO;
      462     7838        /*E*    ERROR:  IGS-E$IP_BADSSP-0
      463     7839                MESSAGE: Special shared processors can't have data or ROSEG.
      464     7840        */
      465     7841    4                     JITERR.CODE = E$IP_BADSSP;
      466     7842    4                     GOTO BLACK_WIDOW;
      467     7843    4                     END;
      468     7844    3                IF ((PCNTRL.PTYPE = I_ASL) AND NOT B$HEAD.ASL) OR
      469     7845    3                  ((PCNTRL.PTYPE = I_LIB) AND NOT B$HEAD.LIB)
      470     7846    4                THEN DO;
      471     7847        /*E*    ERROR:  IGS-E$IP_MISMATCH-0
      472     7848                MESSAGE: Run unit type does not match intended processor type.
      473     7849        */
      474     7850    4                     JITERR.CODE = E$IP_MISMATCH;
      475     7851    4                     GOTO BLACK_WIDOW;
      476     7852    4                     END;
      477     7853        /* Now, let's actually try to install it... */
      478     7854    3                IF (PCNTRL.PTYPE >= I_CP) AND (PCNTRL.PTYPE <= I_ASL)
      479     7855    3                THEN CALL IPC$ADD_SPCL(PCNTRL,PNUM,JITERR) ALTRET(BLACK_WIDOW);
      480     7856    3                ELSE IF PCNTRL.PTYPE = I_LIB
      481     7857    3                     THEN CALL IPC$ADD_LIB(PCNTRL,PNUM,JITERR) ALTRET(BLACK_WIDOW);
      482     7858    4                     ELSE DO;
      483     7859        /*E*    ERROR:  IGS-E$IP_NOTYPE-0
      484     7860                MESSAGE: Processor type wasn't specified in processor tables. */
      485     7861    4                          JITERR.CODE = E$IP_NOTYPE;
      486     7862    4                          END;
      487     7863    3   BLACK_WIDOW:
      488     7864    3                IF JITERR.CODE ~= 0 THEN
      489     7865    4                DO;
      490     7866    4                     CALL M$ERRMSG(FPT_ERRMSG) ALTRET(LOOP_END);
      491     7867    4                     WRITE_OC.BUFW_ = VECTOR(ERRMSGBUF);
      492     7868        /* Dont print the trailing blanks */
      493     7869    4                     I = 120;
      494     7870    4   NXTB:             I = I - 1;
      495     7871    4                     IF I = 0 THEN GOTO DONE;
      496     7872    4                     IF ERRMSG(I) ~= ' ' THEN GOTO DONE;
      497     7873    4                     GOTO NXTB;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:17   
      498     7874    4   DONE:             WRITE_OC.BUFW_.BOUND = I;
      499     7875    4                     CALL M$TEMPWROC(OC_CRLF);
      500     7876    4                     CALL M$TEMPWROC(WRITE_OC);
      501     7877        /* Write a CRLF, then 'WHILE INSTALLING PROCESSOR: "pname"' message. */
      502     7878    4                     IF (JITERR.FCG = '1120'O) OR (JITERR.FCG = '1107'O) THEN
      503     7879    5                     DO;
      504     7880    5                          CALL M$TEMPWROC(OC_CRLF);
      505     7881    5                          WRITE_OC.BUFW_ = VECTOR(T_PROCMSG);
      506     7882    5                          CALL M$TEMPWROC(WRITE_OC);
      507     7883    5                          WRITE_OC.BUFW_ = VECTOR(B$P.NAME.TEXT(PNUM));
      508     7884    5                          CALL M$TEMPWROC(WRITE_OC);
      509     7885    5                          END;
      510     7886    4                     END;
      511     7887    3                GOTO LOOP_END;
      512     7888        /**/
      513     7889    3   NO_HEAD:     ;
      514     7890        /*E*    ERROR:  IGS-E$IP_BADRU-0
      515     7891                MESSAGE: The file for this processor name is not a run unit. */
      516     7892    3                JITERR.CODE = E$IP_BADRU;
      517     7893    3                GOTO BLACK_WIDOW;
      518     7894        /**/
      519     7895    3   LOOP_END:
      520     7896    3                CALL M$CLOSE(CLOSE_EI) ALTRET(CONT);
      521     7897    3                END;                       /* End of DO IF NOT :FREE             */
      522     7898    2   CONT:   END;                            /* End of the installer loop          */
      523     7899    1      RETURN;
      524     7900        /**/
      525     7901        /**/
      526     7902        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:18   
      527     7903        /***************************************************************/
      528     7904        /*                 INTERNAL PROCEDURES                         */
      529     7905        /***************************************************************/
      530     7906        /**/
      531     7907        /* This procedure builds the control block used to drive the       */
      532     7908        /* installer routines based upon information in the processor      */
      533     7909        /* table entries.  PTYPE and MODTIME will be filled in later.      */
      534     7910    1   BUILD_PCNTRL: PROC(PNUM);
      535     7911    2   DCL PNUM UBIN;
      536     7912        /**/
      537     7913    2      PCNTRL = PCNTRL_INIT;
      538     7914    2      PCNTRL.PNAME$ = ADDR(B$P.NAME(PNUM));
      539     7915    2      PCNTRL.FID$ = ADDR(B$P.NAME(PNUM));
      540     7916    2      PCNTRL.PFLGS = B$P.FLGS(PNUM);
      541     7917    2      PCNTRL.PNUM = PNUM;
      542     7918    2      RETURN;
      543     7919    2   END BUILD_PCNTRL;
      544     7920        /**/
      545     7921        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:19   
      546     7922    1   DUMPTCB: PROC;
      547     7923
      548     7924    2   DCL OUTBUF CHAR(80) CALIGNED;
      549     7925
      550     7926    2   DCL TEMPW BIT(36);
      551     7927    2   DCL TEMPWU REDEF TEMPW UBIN WORD;
      552     7928    2   DCL TEMPWB BIT(36) BASED;
      553     7929    2   DCL DPOSN UBIN;
      554     7930    2   DCL I SBIN;
      555     7931    2   DCL J SBIN;
      556     7932
      557     7933    2      DPOSN = 0;
      558     7934    2      I = 0;
      559     7935    2      OUTBUF=' ';
      560     7936    2      WRITE_OC.BUFW_ = VECTOR (OUTBUF);
      561     7937
      562     7938    3      DO WHILE (I<294);
      563     7939    3           TEMPW = PINCRW(B$TCB$,I) -> TEMPWB;
      564     7940    3           IF (DPOSN+13) > 80              /* ROOM TO INSERT?                    */
      565     7941    4           THEN DO;
      566     7942    4                CALL M$TEMPWROC (WRITE_OC);
      567     7943    4                OUTBUF = ' ';
      568     7944    4                DPOSN = 0;
      569     7945    4                END;
      570     7946    3           CALL INSERT (OUTBUF,DPOSN,1,' ');
      571     7947    3           DPOSN = DPOSN + 12;
      572     7948    4           DO J=0 TO 11;
      573     7949    4                CALL INSERT (OUTBUF,DPOSN-J,1,
      574     7950    4                  BINASC(BITBIN(TEMPW & '000000000007'O) + 48));
      575     7951    4                TEMPWU = TEMPWU / 8;
      576     7952    4                END;                       /* DO WHILE CONVERTING EACH DIGIT     */
      577     7953    3           DPOSN = DPOSN + 1;
      578     7954
      579     7955    3           I = I+1;
      580     7956
      581     7957    3           END;                            /* DO WHILE DUMPING TCB               */
      582     7958
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:20   
      583     7959    2      IF DPOSN>0
      584     7960    3      THEN DO;
      585     7961    3           CALL M$TEMPWROC (WRITE_OC);
      586     7962    3           END;
      587     7963
      588     7964    2      RETURN;
      589     7965
      590     7966    2   END DUMPTCB;
      591     7967
      592     7968        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:21   
      593     7969        /**/
      594     7970        /* This routine returns our internal processor type value, based   */
      595     7971        /* on the processor flags for the indicated processor.             */
      596     7972    1   GET_PTYPE: PROC(PNUM,PTYPE);
      597     7973    2   DCL PNUM UBIN;
      598     7974    2   DCL PTYPE UBIN;
      599     7975        /**/
      600     7976    2      PTYPE = 0;
      601     7977    2      IF B$P.FLGS(PNUM) & %P_CP THEN PTYPE = I_CP;
      602     7978    2      IF B$P.FLGS(PNUM) & %P_DB THEN PTYPE = I_DB;
      603     7979    2      IF B$P.FLGS(PNUM) & %P_ASL THEN PTYPE = I_ASL;
      604     7980    2      IF B$P.FLGS(PNUM) & %P_LIB THEN PTYPE = I_LIB;
      605     7981    2      RETURN;
      606     7982    2   END GET_PTYPE;
      607     7983        /**/
      608     7984        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:22   
      609     7985        /**/
      610     7986        /* Procedure for parsing the specified FID and opening M$EI to it. */
      611     7987    1   OPEN_FID: PROC(FID$) ALTRET;
      612     7988    2   DCL FID$ PTR;
      613     7989        /**/
      614     7990    2      OPEN_EI.NAME_ = VECTOR(FID$->B$TEXTC);
      615     7991    2      CALL M$OPEN(OPEN_EI) ALTRET(NOW_WHAT);
      616     7992    2      RETURN;
      617     7993    2   NOW_WHAT:
      618     7994    2      JITERR=B$ALT.ERR;
      619     7995    2      ALTRETURN;
      620     7996    2   END OPEN_FID;
      621     7997        /**/
      622     7998        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:23   
      623     7999        /* Routine to get the processor's modification date from the FIT. */
      624     8000    1   GET_MODTIME: PROC(DATE) ALTRET;
      625     8001    2   DCL DATE UBIN;
      626     8002    2   DCL J SBIN;
      627     8003    2   DCL CODE4$ PTR;
      628     8004        /**/
      629     8005    3      DO J = 1 TO FM$FIT.CODES.CODE(0);
      630     8006    3           IF FM$FIT.CODES.CODE(J) = 4 THEN
      631     8007    4           DO;
      632     8008    4                CODE4$ = PINCRW(FIT$,FM$FIT.CODES.ITEMX(J));
      633     8009    4                DATE = CODE4$->CODE04.MODIFY.TIME;
      634     8010    4                RETURN;
      635     8011    4                END;
      636     8012    3           END;
      637     8013        /*E*    ERROR:  IGS-E$IP_BADFIT-0
      638     8014                MESSAGE: Unable to locate creation date/time in file's FIT. */
      639     8015    2      JITERR.CODE = E$IP_BADFIT;
      640     8016    2      ALTRETURN;
      641     8017    2   END GET_MODTIME;
      642     8018        /**/
      643     8019        /**/
      644     8020    1   END IGS$SYSMAK;
      645     8021        %EOD;

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:24   
--  Include file information  --

   M$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   IPS_SUBS_C.:E05TOU  is referenced.
   IP_PERR_C.:E05TOU  is referenced.
   I_SUBS_C.:E05TOU  is referenced.
   FM$FIT.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$OBJECT_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure IGS$SYSMAK.

   Procedure IGS$SYSMAK requires 697 words for executable code.
   Procedure IGS$SYSMAK requires 48 words of local(AUTO) storage.

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:25   

 Object Unit name= IGS$SYSMAK                                 File name= IPS$SYSMAK.:E05TOU
 UTS= JUL 29 '97 22:41:59.36 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none  2650   5132  IGS$SYSMAK
    2  RoData even  UTS      1      1  IGS$SYSMAK
    3   DCB   even  none     0      0  M$EI
    4   Proc  even  none   697   1271  IGS$SYSMAK
    5  RoData even  none    46     56  IGS$SYSMAK

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes            yes      Std        0  IGS$SYSMAK
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:26   

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1   4104  IGS_UNWIND                         1   4106  ERRMSGBUF
    1   4144  BUF$                               1   4145  WSPTD$
    1   4146  ROSEG$                             1   4147  PGTBL$
    1   4150  EI$                                1   4151  HEAD$
    1   4152  P$                                 1   4153  AUTO_START
    1   4154  NPROCS                             1   4155  MAXPROCS
    1   4156  NSCPU                              1   4157  SCPUWSPTD
    1   4167  IPA_RESTART                        1   4272  TC_OLDPROC
    1   4275  TC_FREE                            1   4277  TC_BUSY
    1   4301  TC_DELTA

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          Async      0 IGS$XCON
         yes           Std       2 IPD$SETSEG
         yes           Std       2 IPD$MON_VALUE
 yes     yes           Std       3 IPC$ADD_LIB
 yes     yes           Std       3 IPC$ADD_SPCL
 yes     yes           Std       2 IPD$FREE_PROC
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:27   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     P_NPROCS                              P_MAXPROCS                            B$P$
     M$UC                                  B$JIT$                                B$IS$
     B$TCB$                                S_NSCPU                               IT_SCPUWSPTD
     IG_BOOTFLAG                           P_NAME                                RF_NAME
     M$EI                                  B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:28   


        1        1        /*M* IGS$SYSMAK - Driver module for SYSMAK phase of GHOST1         */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0    */
        8        8        /*P*    NAME:   IGS$SYSMAK
        9        9                PURPOSE: To install all of the shared processors whose
       10       10                        names are currently in the processor tables.
       11       11                DESCRIPTION: The processor tables are scanned between
       12       12                        entries #1 and P_NPROCS for active processor names
       13       13                        (i.e. not ':FREE', ':OLDPROC', or a processor
       14       14                        overlay).  For all those found, SYSMAK will attempt
       15       15                        to open a run unit in :SYS of the same name, and
       16       16                        install it as a shared processor in the mode indi-
       17       17                        cated by the processor flags associated with the
       18       18                        name found in the processor tables.  SYSMAK assumes
       19       19                        that the first three special descriptor slots have
       20       20                        been M$SAD-ed as follows:
       21       21                                SPCL1SID: Monitor instruction segment.
       22       22                                SPCL2SID: TIGR-built tables.
       23       23                                SPCL3SID: Physical page usage table (MM$PPUT).
       24       24        */
       25       25        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:29   
       26       26        IGS$SYSMAK: PROC;

     26  4 000000   000000 700200 xent  IGS$SYSMAK   TSX0  ! X66_AUTO_0
         4 000001   000060 000000                    ZERO    48,0

       27       27        %INCLUDE B_ERRORS_C;
       28     1154        %INCLUDE B_SEGIDS_C;
       29     1693        %INCLUDE B$OBJECT_C;
       30     5123        %INCLUDE B$P;
       31     5207        %INCLUDE CP_6;
       32     5288        %INCLUDE CP_6_SUBS;
       33     5828        %F$DCB;
       34     5885        %INCLUDE FM$FIT;
       35     6106        %INCLUDE I_SUBS_C;
       36     6130        %INCLUDE IP_PERR_C;
       37     6158        %INCLUDE IPS_SUBS_C;
       38     6195        %INCLUDE M$JIT_C;
       39     6402        /**/
       40     6403        /* STATIC DATA */
       41     6404    1   DCL FITBUF(0:1023) UBIN STATIC DALIGNED;
       42     6405    1   DCL HEADBUF(0:24) UBIN STATIC DALIGNED;
       43     6406    1   DCL 1 STLVEC STATIC DALIGNED,
       44     6407    1         2 * UBIN WORD,
       45     6408    1         2 PNO UBIN WORD;
       46     6409    1   DCL 1 PCNTRL_INIT STATIC,
       47     6410    1         2 CMD# UBIN WORD INIT(I_ICMD),
       48     6411    1         2 PNAME$ PTR INIT(ADDR(NIL)),
       49     6412    1         2 PACCT$ PTR INIT(ADDR(SYS_ACCT)),
       50     6413    1         2 PTYPE UBIN HALF UNAL INIT(0),
       51     6414    1         2 PERM BIT(1) UNAL INIT('0'B),
       52     6415    1         2 * UBIN(8) UNAL INIT(0),
       53     6416    1         2 OVRLNUM UBIN BYTE UNAL INIT(0),
       54     6417    1         2 FID$ PTR INIT(ADDR(NIL)),
       55     6418    1         2 MODTIME UBIN WORD INIT(0),
       56     6419    1         2 PNUM UBIN HALF UNAL INIT(0),
       57     6420    1         2 * UBIN(18) UNAL INIT(0),
       58     6421    1         2 PFLGS BIT(36) UNAL INIT('0'B);
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:30   
       59     6422    1   DCL 1 HEAD_KEY STATIC,
       60     6423    1         2 S UBIN(9) UNAL INIT(4),
       61     6424    1         2 T CHAR(4) UNAL INIT('HEAD');
       62     6425    1   DCL T_CRLF(0:1) CHAR(1) STATIC UNAL INIT(BITASC('015'O),BITASC('012'O));
       63     6426    1   DCL 1 JITERR STATIC,
       64     6427    1         2 FCG BIT(12) UNAL,
       65     6428    1         2 MID BIT(6) UNAL,
       66     6429    1         2 M BIT(1) UNAL,
       67     6430    1         2 CODE UBIN(14) UNAL,
       68     6431    1         2 SEV UBIN(3) UNAL;
       69     6432    1   DCL 1 JITERR_INIT CONSTANT,
       70     6433    1         2 FCG BIT(12) UNAL INIT('1107'O),
       71     6434    1         2 MID BIT(6) UNAL INIT('23'O),
       72     6435    1         2 M BIT(1) UNAL INIT('0'B),
       73     6436    1         2 CODE UBIN(14) UNAL INIT(0),
       74     6437    1         2 SEV UBIN(3) UNAL INIT(0);
       75     6438    1   DCL FIT$ PTR STATIC INIT(ADDR(FITBUF));
       76     6439    1   DCL PREVXCON BIT(72) STATIC DALIGNED;
       77     6440        /* GLOBAL (SYMDEF) DATA */
       78     6441    1   DCL IGS_UNWIND REMEMBER STATIC SYMDEF DALIGNED;
       79     6442    1   DCL ERRMSGBUF CHAR(120) STATIC SYMDEF DALIGNED;
       80     6443    1   DCL ERRMSG(0:119) REDEF ERRMSGBUF CHAR(1) UNAL;
       81     6444    1   DCL BUF$ PTR STATIC SYMDEF;
       82     6445    1   DCL WSPTD$ PTR STATIC SYMDEF;
       83     6446    1   DCL ROSEG$ PTR STATIC SYMDEF;
       84     6447    1   DCL PGTBL$ PTR STATIC SYMDEF;
       85     6448    1   DCL EI$ PTR STATIC SYMDEF;
       86     6449    1   DCL HEAD$ PTR STATIC SYMDEF INIT(ADDR(HEADBUF));
       87     6450    1   DCL P$ PTR STATIC SYMDEF;
       88     6451    1   DCL AUTO_START UBIN STATIC SYMDEF;
       89     6452    1   DCL NPROCS UBIN STATIC SYMDEF;
       90     6453    1   DCL MAXPROCS UBIN STATIC SYMDEF;
       91     6454    1   DCL NSCPU UBIN STATIC SYMDEF;
       92     6455    1   DCL SCPUWSPTD(0:7) UBIN STATIC SYMDEF;
       93     6456    1   DCL IPA_RESTART BIT(72) STATIC SYMDEF;
       94     6457    1   DCL 1 RUM_CMD STATIC,
       95     6458    1         2 * CHAR(5) UNAL INIT('READ '),
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:31   
       96     6459    1         2 FID CHAR(4) UNAL,
       97     6460    1         2 * CHAR(5) UNAL INIT('.:SYS');
       98     6461        /* AUTO */
       99     6462    1   DCL I SBIN;
      100     6463    1   DCL J SBIN;
      101     6464    1   DCL PNUM UBIN WORD;
      102     6465    1   DCL PTYPE UBIN WORD;
      103     6466    1   DCL PFLGS BIT(36);
      104     6467    1   DCL PROC_SLOT UBIN;
      105     6468    1   DCL 1 PCNTRL,
      106     6469    1         2 CMD# UBIN WORD,
      107     6470    1         2 PNAME$ PTR,
      108     6471    1         2 PACCT$ PTR,
      109     6472    1         2 PTYPE UBIN HALF UNAL,
      110     6473    1         2 PERM BIT(1) UNAL,
      111     6474    1         2 * UBIN(8) UNAL,
      112     6475    1         2 OVRLNUM UBIN BYTE UNAL,
      113     6476    1         2 FID$ PTR,
      114     6477    1         2 MODTIME UBIN WORD,
      115     6478    1         2 PNUM UBIN HALF UNAL,
      116     6479    1         2 * UBIN(18) UNAL,
      117     6480    1         2 PFLGS BIT(36) UNAL;
      118     6481        /* BASED */
      119     6482    1   DCL B$CHAR8 CHAR(8) BASED UNAL;
      120     6483    1   DCL 1 B$TEXTC BASED ALIGNED,
      121     6484    1         2 COUNT UBIN(9) UNAL,
      122     6485    1         2 TEXT CHAR(B$TEXTC.COUNT) UNAL;
      123     6486        %B$TCB;
      124     6489        %B$ALT;
      125     6497        %B$XCON;
      126     6507        /* SYMREF */
      127     6508    1   DCL B$JIT$ PTR SYMREF;
      128     6509    1   DCL B$IS$ PTR SYMREF;
      129     6510    1   DCL B$TCB$ PTR SYMREF;
      130     6511    1   DCL S_NSCPU UBIN SYMREF;
      131     6512    1   DCL IT_SCPUWSPTD(0:3) UBIN SYMREF;
      132     6513    1   DCL IG_BOOTFLAG UBIN SYMREF;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:32   
      133     6514
      134     6515    1   DCL 1 P_NAME SYMREF,
      135     6516    1         2 L UBIN(9) UNAL,
      136     6517    1         2 TEXT CHAR(6) UNAL;
      137     6518    1   DCL 1 RF_NAME SYMREF,
      138     6519    1         2 L UBIN(9) UNAL,
      139     6520    1         2 TEXT CHAR(4) UNAL;
      140     6521        /* DCB */
      141     6522    1   DCL M$EI DCB;
      142     6523        /* EXTERNAL ROUTINES */
      143     6524    1   DCL IPC$ADD_SPCL ENTRY(3) ALTRET;
      144     6525    1   DCL IPC$ADD_LIB ENTRY(3) ALTRET;
      145     6526    1   DCL IPD$FREE_PROC ENTRY(2) ALTRET;
      146     6527    1   DCL IPD$MON_VALUE ENTRY(2);
      147     6528    1   DCL IPD$MON_STORE ENTRY(2);
      148     6529    1   DCL IPD$SETSEG ENTRY(2);
      149     6530    1   DCL IGS$XCON ENTRY ASYNC;
      150     6531        /**/
      151     6532        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:33   
      152     6533        /**/
      153     6534        /* MACROS */
      154     6535        /**/
      155     6536        %MACRO TXTSTR(NAME=TXTSTR,TEXT=' ');
      156     6537        DCL NAME CHAR(0) STATIC INIT(TEXT);
      157     6538        %MEND;
      158     6539        /**/
      159     6540        %MACRO TEXTC(NAME=TEXTC,STRING=' ');
      160     6541        DCL 1 NAME STATIC SYMDEF,
      161     6542              2 COUNT UBIN(9) UNAL INIT(SIZEC(STRING)),
      162     6543              2 TEXT CHAR(0) UNAL INIT(STRING);
      163     6544        %MEND;
      164     6545        /**/
      165     6546        /* MACRO INVOCATIONS */
      166     6547                %B$HEAD;
      167     6747                %RU_FLAVORS;
      168     6753                %CODE04;
      169     6761                %FM$FIT;
      170     6764        /**/
      171     6765        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:34   
      172     6766        /**/
      173     6767        /* %SUBs */
      174     6768                %SUB B$HEAD=HEAD$->B$HEAD;
      175     6769                %SUB B$P=P$->B$P;
      176     6770                %SUB FM$FIT=FIT$->FM$FIT;
      177     6771        %SUB B$ALT=B$TCB$->B$TCB.ALT$->B$ALT;
      178     6772        %SUB B$XCON=B$TCB$->B$TCB.STK$->B$XCON;
      179     6773        /**/
      180     6774        /* TEXT STRINGS */
      181     6775        %TXTSTR(NAME=T_PROCMSG,TEXT='WHILE INSTALLING PROCESSOR: ');
      182     6778        %TXTSTR(NAME=T_NORUMS,
      183     6779                TEXT='No RUM file for processors');
      184     6782        %TXTSTR(NAME=T_NODELTA,
      185     6783                TEXT='No DELTA - cant apply RUMs for processors');
      186     6786        /* This message alone means not in the processor tables */
      187     6787        %TXTSTR(NAME=T_XCON,
      188     6788                TEXT='IGS Exit Control Entry');
      189     6791        %TXTSTR(NAME=T_RUMMSG,
      190     6792                TEXT='Beginning RUM for processors');
      191     6795        %TXTSTR(NAME=T_DONERUMMSG,
      192     6796                TEXT='RUM completed for system processors.');
      193     6799        %TXTSTR(NAME=T_DELTAERR,
      194     6800                TEXT='Error in one or more RUMs consult :PF file for more info');
      195     6803        %TEXTC(NAME=TC_OLDPROC,STRING=':OLDPROC');
      196     6808        %TEXTC(NAME=TC_FREE,STRING=':FREE');
      197     6813        %TEXTC(NAME=TC_BUSY,STRING=':BUSY');
      198     6818        %TEXTC(NAME=TC_DELTA,STRING='DELTA');
      199     6823        /**/
      200     6824        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:35   
      201     6825        /**/
      202     6826        /* FPT's */
      203     6827                %FPT_TEMPWROC(FPTN=WRITE_OC);
      204     6843                %FPT_TEMPWROC(FPTN=OC_CRLF,
      205     6844                              BUFW=T_CRLF);
      206     6860                %FPT_ERRMSG(CODE=JITERR,
      207     6861                  DCB=M$EI,
      208     6862                  INCLCODE=NO,
      209     6863                  FLAGLEV=3,
      210     6864                SUBMESS=YES,
      211     6865                  BUF=ERRMSGBUF);
      212     6892        %FPT_XCON(FPTN=IGS_XCON,
      213     6893                  UENTRY=IGS$XCON,
      214     6894                  PXCON=PREVXCON);
      215     6908                %FPT_OPEN(FPTN=OPEN_EI,
      216     6909                  NAME=RU_NAME,
      217     6910                  ACCT=SYS_ACCT,
      218     6911                  DCB=M$EI,
      219     6912                  ASN=FILE,
      220     6913                  FUN=IN,
      221     6914                  ACS=DIRECT,
      222     6915                  ORG=KEYED,
      223     6916                  FPARAM=FITBUF,
      224     6917                  SCRUB=YES);
      225     7026                %FPT_OPEN(FPTN=FIND_RUM,
      226     7027                NAME=RF_NAME,
      227     7028                  ACCT=SYS_ACCT,
      228     7029                  DCB=M$EI,
      229     7030                  TEST=YES,
      230     7031                  ASN=FILE,
      231     7032                  FUN=IN,
      232     7033                  SCRUB=YES);
      233     7142
      234     7143                %FPT_OPEN(FPTN=DELETE_RUM,
      235     7144                 NAME=PF_NEW_NAME,
      236     7145                  ACCT=SYS_ACCT,
      237     7146                  DCB=M$EI,
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:36   
      238     7147                  DELETE=YES,
      239     7148                  ASN=FILE,
      240     7149                  FUN=IN,
      241     7150                  SCRUB=YES);
      242     7259
      243     7260                %FPT_OPEN(FPTN=UPDATE_RUM,
      244     7261                  NAME=P_NAME,
      245     7262                  ACCT=SYS_ACCT,
      246     7263                  DCB=M$EI,
      247     7264                  ASN=FILE,
      248     7265                  FUN=UPDATE,
      249     7266                  SCRUB=YES);
      250     7375
      251     7376                %FPT_CLOSE(FPTN=RENAME_RUM,
      252     7377                  DCB=M$EI,
      253     7378                  NAME=PF_NEW_NAME,
      254     7379                  ACCESS=NEW_ACCESS,
      255     7380                  CHGATT=YES,
      256     7381                  DISP=SAVE);
      257     7423
      258     7424        %VLP_ATTR (FPTN=NEW_ACCESS);
      259     7438        %VLP_ACCESS (READ=YES,ACCT='?',LAST=";");
      260     7455
      261     7456    1   DCL 1 PF_NEW_NAME STATIC ALIGNED,
      262     7457    1         2 L UBIN(9) UNAL INIT(7),
      263     7458    1         2 N1 CHAR(7) UNAL INIT('::PATCH');
      264     7459
      265     7460    1   DCL 1 RF_NEW_NAME STATIC ALIGNED,
      266     7461    1         2 L UBIN(9) UNAL INIT(5),
      267     7462    1         2 N1 CHAR(5) UNAL INIT('::RUM');
      268     7463
      269     7464                %VLP_NAME(FPTN=RU_NAME);
      270     7491                %VLP_ACCT(FPTN=SYS_ACCT,
      271     7492                  ACCT=':SYS');
      272     7505
      273     7506                %FPT_READ(FPTN=READ_HEAD,
      274     7507                  KEY=HEAD_KEY,
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:37   
      275     7508                  DCB=M$EI,
      276     7509                  KEYS=YES,
      277     7510                  BUF=HEADBUF);
      278     7549                %FPT_CLOSE(FPTN=CLOSE_EI,
      279     7550                  DCB=M$EI,
      280     7551                  DISP=SAVE);
      281     7593                %FPT_STLPP(RESULTS=STLVEC);
      282     7606                %FPT_ALIB(FPTN=ALIB_DELTA,
      283     7607                  LIBNAME=TC_DELTA,
      284     7608                  CMD=RUM_CMD,
      285     7609                  RETRN=NO,
      286     7610                  DLIB=YES);
      287     7627                %FPT_DLIB(FPTN=DLIB_DELTA,
      288     7628                  LIBNAME=TC_DELTA);
      289     7641                %FPT_LDEV(FPTN=PRINT_DO,
      290     7642                  REMOVE=YES,
      291     7643                  STREAMNAME='LP01');
      292     7668        /**/
      293     7669        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:38   
      294     7670        /**/
      295     7671        /* Initialize SYSMAK to begin installing shared processors.        */
      296     7672        /**/
      297     7673    1      JITERR = JITERR_INIT;

   7673  4 000002   000000 236000 2                  LDQ     JITERR_INIT
         4 000003   004077 756000 1                  STQ     JITERR

      298     7674        /* Pick up some monitor values */
      299     7675    1      CALL IPD$MON_VALUE(P_NPROCS,NPROCS);

   7675  4 000004   000000 630400 5                  EPPR0   0
         4 000005   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000006   000000 701000 xent               TSX1    IPD$MON_VALUE
         4 000007   000000 011000                    NOP     0

      300     7676    1      CALL IPD$MON_VALUE(P_MAXPROCS,MAXPROCS);

   7676  4 000010   000002 630400 5                  EPPR0   2
         4 000011   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000012   000000 701000 xent               TSX1    IPD$MON_VALUE
         4 000013   000000 011000                    NOP     0

      301     7677    1      CALL IPD$MON_VALUE(S_NSCPU,NSCPU);

   7677  4 000014   000004 630400 5                  EPPR0   4
         4 000015   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000016   000000 701000 xent               TSX1    IPD$MON_VALUE
         4 000017   000000 011000                    NOP     0

      302     7678    2      DO I = 0 TO NSCPU;

   7678  4 000020   200003 450100                    STZ     I,,AUTO
         4 000021   000034 710000 4                  TRA     s:7680+1

      303     7679    2           CALL IPD$MON_VALUE(IT_SCPUWSPTD(I),SCPUWSPTD(I));

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:39   
   7679  4 000022   200003 720100                    LXL0    I,,AUTO
         4 000023   004157 630410 1                  EPPR0   SCPUWSPTD,X0
         4 000024   200055 450500                    STP0    J+3,,AUTO
         4 000025   000000 631410 xsym               EPPR1   IT_SCPUWSPTD,X0
         4 000026   200054 451500                    STP1    J+2,,AUTO
         4 000027   200054 630500                    EPPR0   J+2,,AUTO
         4 000030   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000031   000000 701000 xent               TSX1    IPD$MON_VALUE
         4 000032   000000 011000                    NOP     0

      304     7680    2           END;

   7680  4 000033   200003 054100                    AOS     I,,AUTO
         4 000034   004156 236000 1                  LDQ     NSCPU
         4 000035   000022 604000 4                  TMI     s:7679
         4 000036   200003 116100                    CMPQ    I,,AUTO
         4 000037   000022 605000 4                  TPL     s:7679

      305     7681    1      CALL IPD$MON_VALUE(B$P$,P$);

   7681  4 000040   000006 630400 5                  EPPR0   6
         4 000041   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000042   000000 701000 xent               TSX1    IPD$MON_VALUE
         4 000043   000000 011000                    NOP     0

      306     7682    1      CALL IPD$SETSEG(P$,%SPCL2SID);

   7682  4 000044   000011 630400 5                  EPPR0   9
         4 000045   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000046   000000 701000 xent               TSX1    IPD$SETSEG
         4 000047   000000 011000                    NOP     0

      307     7683        /* Initialize some SYSMAK global pointers */
      308     7684    1      BUF$ = PINCRW(B$IS$,VP_BUF*1024);

   7684  4 000050   000000 236000 xsym               LDQ     B$IS$
         4 000051   314000 036003                    ADLQ    104448,DU
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:40   
         4 000052   004144 756000 1                  STQ     BUF$

      309     7685    1      WSPTD$ = PINCRW(B$IS$,VP_WSPTD*1024);

   7685  4 000053   000000 236000 xsym               LDQ     B$IS$
         4 000054   354000 036003                    ADLQ    120832,DU
         4 000055   004145 756000 1                  STQ     WSPTD$

      310     7686    1      ROSEG$ = PINCRW(B$IS$,VP_ROSEG*1024);

   7686  4 000056   000000 236000 xsym               LDQ     B$IS$
         4 000057   356000 036003                    ADLQ    121856,DU
         4 000060   004146 756000 1                  STQ     ROSEG$

      311     7687    1      PGTBL$ = PINCRW(B$IS$,VP_PGTBL*1024);

   7687  4 000061   000000 236000 xsym               LDQ     B$IS$
         4 000062   310000 036003                    ADLQ    102400,DU
         4 000063   004147 756000 1                  STQ     PGTBL$

      312     7688    1      EI$ = DCBADDR(DCBNUM(M$EI));

   7688  4 000064   000000 236007 xsym               LDQ     M$EI,DL
         4 000065   000013 470400 5                  LDP0    11
         4 000066   000000 471500                    LDP1    0,,PR0
         4 000067   100000 236106                    LDQ     0,QL,PR1
         4 000070   004150 756000 1                  STQ     EI$

      313     7689        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:41   
      314     7690
      315     7691    1      IF (IG_BOOTFLAG > I_VOLONLY) AND

   7691  4 000071   000000 235000 xsym               LDA     IG_BOOTFLAG
         4 000072   000002 115007                    CMPA    2,DL
         4 000073   000453 602000 4                  TNC     BORSCHT
         4 000074   000007 115007                    CMPA    7,DL
         4 000075   000453 603000 4                  TRC     BORSCHT

      316     7692    1        (IG_BOOTFLAG < I_DISKBOOT)
      317     7693    2      THEN DO;

      318     7694        /* Because the FPTs are here we rename :PATCH to ::PATCH in this module. */
      319     7695    2           CALL M$OPEN(DELETE_RUM) ALTRET(FIRST_PATCH);

   7695  4 000076   004550 630400 1                  EPPR0   DELETE_RUM
         4 000077   450000 713400                    CLIMB   alt,open
         4 000100   410400 401760                    pmme    nvectors=18
         4 000101   000102 702000 4                  TSX2    FIRST_PATCH

   7695  4 000102                       FIRST_PATCH  null
      320     7696    2   FIRST_PATCH: ;
      321     7697    2           CALL M$OPEN(UPDATE_RUM) ALTRET(WHO_CARES);

   7697  4 000102   004642 630400 1                  EPPR0   UPDATE_RUM
         4 000103   450000 713400                    CLIMB   alt,open
         4 000104   410400 401760                    pmme    nvectors=18
         4 000105   000112 702000 4                  TSX2    WHO_CARES

      322     7698    2           CALL M$CLOSE(RENAME_RUM) ALTRET(WHO_CARES);

   7698  4 000106   004734 630400 1                  EPPR0   RENAME_RUM
         4 000107   450001 713400                    CLIMB   alt,close
         4 000110   406000 401760                    pmme    nvectors=13
         4 000111   000112 702000 4                  TSX2    WHO_CARES

   7695  4 000112                       WHO_CARES    null
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:42   
      323     7699    2   WHO_CARES: ;
      324     7700
      325     7701        /* If there's a :RUM file, then we want to bring DELTA in first,   */
      326     7702        /* use it to apply all of the RUM patches to the processors in     */
      327     7703        /* :SYS, and then install them, along with DELTA again (in case it */
      328     7704        /* was the target of some updates itself).                         */
      329     7705    2           REMEMBER DELTA_XCON IN IGS_UNWIND;

   7705  4 000112   000375 635000 4                  EAA     DELTA_XCON
         4 000113   004104 452400 1                  STP2    IGS_UNWIND
         4 000114   004105 755000 1                  STA     IGS_UNWIND+1

      330     7706    2           CALL M$XCON(IGS_XCON) ALTRET(SKIP_IT);

   7706  4 000115   004356 630400 1                  EPPR0   IGS_XCON
         4 000116   410003 713400                    CLIMB   alt,+4099
         4 000117   400400 401760                    pmme    nvectors=2
         4 000120   000121 702000 4                  TSX2    SKIP_IT

      331     7707    2   SKIP_IT:
      332     7708    2           JITERR = JITERR_INIT;

   7708  4 000121   000000 236000 2     SKIP_IT      LDQ     JITERR_INIT
         4 000122   004077 756000 1                  STQ     JITERR

      333     7709    2           RUM_CMD.FID = RF_NAME.TEXT;

   7709  4 000123   040000 100400                    MLR     fill='040'O
         4 000124   000000 200004 xsym               ADSC9   RF_NAME                  cn=1,n=4
         4 000125   004172 200004 1                  ADSC9   RUM_CMD+1                cn=1,n=4

      334     7710    2           CALL M$OPEN(FIND_RUM) ALTRET(NO_RUMF);

   7710  4 000126   004456 630400 1                  EPPR0   FIND_RUM
         4 000127   450000 713400                    CLIMB   alt,open
         4 000130   410400 401760                    pmme    nvectors=18
         4 000131   000336 702000 4                  TSX2    NO_RUMF
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:43   

      335     7711    3           DO PNUM = 1 TO 2;               /* Install first three processors     */

   7711  4 000132   000001 235007                    LDA     1,DL
         4 000133   200005 755100                    STA     PNUM,,AUTO

      336     7712    3                CALL BUILD_PCNTRL(PNUM);

   7712  4 000134   200005 630500                    EPPR0   PNUM,,AUTO
         4 000135   200023 450500                    STP0    PCNTRL+10,,AUTO
         4 000136   000761 701000 4                  TSX1    BUILD_PCNTRL
         4 000137   000000 011000                    NOP     0

      337     7713    3                CALL GET_PTYPE(PNUM,PTYPE);

   7713  4 000140   200006 630500                    EPPR0   PTYPE,,AUTO
         4 000141   200024 450500                    STP0    @DATE+1,,AUTO
         4 000142   200005 631500                    EPPR1   PNUM,,AUTO
         4 000143   200023 451500                    STP1    PCNTRL+10,,AUTO
         4 000144   001126 701000 4                  TSX1    GET_PTYPE
         4 000145   000000 011000                    NOP     0

      338     7714    3                PCNTRL.PTYPE = PTYPE;

   7714  4 000146   200006 720100                    LXL0    PTYPE,,AUTO
         4 000147   200014 740100                    STX0    PCNTRL+3,,AUTO

      339     7715    3                CALL OPEN_FID(PCNTRL.FID$) ALTRET(NO_DELTA2);

   7715  4 000150   200015 630500                    EPPR0   PCNTRL+4,,AUTO
         4 000151   200023 450500                    STP0    PCNTRL+10,,AUTO
         4 000152   001200 701000 4                  TSX1    OPEN_FID
         4 000153   000364 702000 4                  TSX2    NO_DELTA2

      340     7716    3                CALL GET_MODTIME(PCNTRL.MODTIME) ALTRET(NO_DELTA2);

   7716  4 000154   200016 630500                    EPPR0   PCNTRL+5,,AUTO
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:44   
         4 000155   200023 450500                    STP0    PCNTRL+10,,AUTO
         4 000156   001230 701000 4                  TSX1    GET_MODTIME
         4 000157   000364 702000 4                  TSX2    NO_DELTA2

      341     7717    3                CALL M$READ(READ_HEAD) ALTRET(NO_DELTA);

   7717  4 000160   005014 630400 1                  EPPR0   READ_HEAD
         4 000161   440000 713400                    CLIMB   alt,read
         4 000162   401400 401760                    pmme    nvectors=4
         4 000163   000360 702000 4                  TSX2    NO_DELTA

      342     7718    3                IF PNUM = 2                /* DELTA                              */

   7718  4 000164   200005 235100                    LDA     PNUM,,AUTO
         4 000165   000002 115007                    CMPA    2,DL
         4 000166   000202 601000 4                  TNZ     s:7720

      343     7719    3                THEN CALL IPC$ADD_SPCL(PCNTRL,PNUM,JITERR) ALTRET(BLACK_WIDOW);

   7719  4 000167   000014 236000 5                  LDQ     12
         4 000170   200056 756100                    STQ     J+4,,AUTO
         4 000171   200005 630500                    EPPR0   PNUM,,AUTO
         4 000172   200055 450500                    STP0    J+3,,AUTO
         4 000173   200011 631500                    EPPR1   PCNTRL,,AUTO
         4 000174   200054 451500                    STP1    J+2,,AUTO
         4 000175   200054 630500                    EPPR0   J+2,,AUTO
         4 000176   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 000177   000000 701000 xent               TSX1    IPC$ADD_SPCL
         4 000200   000646 702000 4                  TSX2    BLACK_WIDOW
         4 000201   000214 710000 4                  TRA     s:7721

      344     7720    3                ELSE CALL IPC$ADD_LIB(PCNTRL,PNUM,JITERR) ALTRET(BLACK_WIDOW);

   7720  4 000202   000014 236000 5                  LDQ     12
         4 000203   200056 756100                    STQ     J+4,,AUTO
         4 000204   200005 630500                    EPPR0   PNUM,,AUTO
         4 000205   200055 450500                    STP0    J+3,,AUTO
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:45   
         4 000206   200011 631500                    EPPR1   PCNTRL,,AUTO
         4 000207   200054 451500                    STP1    J+2,,AUTO
         4 000210   200054 630500                    EPPR0   J+2,,AUTO
         4 000211   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 000212   000000 701000 xent               TSX1    IPC$ADD_LIB
         4 000213   000646 702000 4                  TSX2    BLACK_WIDOW

      345     7721    3                CALL M$CLOSE(CLOSE_EI) ALTRET(NO_DELTA);

   7721  4 000214   005032 630400 1                  EPPR0   CLOSE_EI
         4 000215   450001 713400                    CLIMB   alt,close
         4 000216   406000 401760                    pmme    nvectors=13
         4 000217   000360 702000 4                  TSX2    NO_DELTA

      346     7722    3                END;

   7722  4 000220   200005 235100                    LDA     PNUM,,AUTO
         4 000221   000001 035007                    ADLA    1,DL
         4 000222   200005 755100                    STA     PNUM,,AUTO
         4 000223   000003 115007                    CMPA    3,DL
         4 000224   000134 602000 4                  TNC     s:7712

      347     7723        /*  Print 'Rumming' on OC */
      348     7724    2           CALL M$TEMPWROC(OC_CRLF);

   7724  4 000225   004314 630400 1                  EPPR0   OC_CRLF
         4 000226   110000 713400                    CLIMB   36864
         4 000227   401000 401760                    pmme    nvectors=3

      349     7725    2           WRITE_OC.BUFW_ = VECTOR(T_RUMMSG);

   7725  4 000230   000016 237000 5                  LDAQ    14
         4 000231   004306 757000 1                  STAQ    WRITE_OC+2

      350     7726    2           CALL M$TEMPWROC(WRITE_OC);

   7726  4 000232   004304 630400 1                  EPPR0   WRITE_OC
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:46   
         4 000233   110000 713400                    CLIMB   36864
         4 000234   401000 401760                    pmme    nvectors=3

      351     7727    3           CALL M$ALIB(ALIB_DELTA) WHENALTRETURN DO;

   7727  4 000235   005072 630400 1                  EPPR0   ALIB_DELTA
         4 000236   400007 713400                    CLIMB   alt,+7
         4 000237   401400 401760                    pmme    nvectors=4
         4 000240   000242 702000 4                  TSX2    s:7728
         4 000241   000260 710000 4                  TRA     s:7733

      352     7728    3                IF B$ALT.ERR.ERR# ~= %E$DLTALT THEN GOTO NO_DELTA;

   7728  4 000242   000000 470400 xsym               LDP0    B$TCB$
         4 000243   000000 471500                    LDP1    0,,PR0
         4 000244   100102 236100                    LDQ     66,,PR1
         4 000245   377770 376007                    ANQ     131064,DL
         4 000246   007530 116007                    CMPQ    3928,DL
         4 000247   000360 601000 4                  TNZ     NO_DELTA

      353     7729    3                CALL M$TEMPWROC (OC_CRLF);

   7729  4 000250   004314 630400 1                  EPPR0   OC_CRLF
         4 000251   110000 713400                    CLIMB   36864
         4 000252   401000 401760                    pmme    nvectors=3

      354     7730    3                WRITE_OC.BUFW_ = VECTOR(T_DELTAERR);

   7730  4 000253   000020 237000 5                  LDAQ    16
         4 000254   004306 757000 1                  STAQ    WRITE_OC+2

      355     7731    3                CALL M$TEMPWROC (WRITE_OC);

   7731  4 000255   004304 630400 1                  EPPR0   WRITE_OC
         4 000256   110000 713400                    CLIMB   36864
         4 000257   401000 401760                    pmme    nvectors=3

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:47   
      356     7732    3                END;

      357     7733    2           CALL M$DLIB(DLIB_DELTA) ALTRET(EH);

   7733  4 000260   005104 630400 1                  EPPR0   DLIB_DELTA
         4 000261   400010 713400                    CLIMB   alt,+8
         4 000262   400000 401760                    pmme    nvectors=1
         4 000263   000264 702000 4                  TSX2    EH

      358     7734    3   EH:     DO PNUM = 1 TO 2;

   7734  4 000264   000001 235007       EH           LDA     1,DL
         4 000265   200005 755100                    STA     PNUM,,AUTO

      359     7735                                           /* Second parameter says dont release slot */
      360     7736    3                CALL IPD$FREE_PROC(PNUM,1);

   7736  4 000266   000022 236000 5                  LDQ     18
         4 000267   200055 756100                    STQ     J+3,,AUTO
         4 000270   200005 630500                    EPPR0   PNUM,,AUTO
         4 000271   200054 450500                    STP0    J+2,,AUTO
         4 000272   200054 630500                    EPPR0   J+2,,AUTO
         4 000273   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000274   000000 701000 xent               TSX1    IPD$FREE_PROC
         4 000275   000000 011000                    NOP     0

      361     7737    3                END;

   7737  4 000276   200005 235100                    LDA     PNUM,,AUTO
         4 000277   000001 035007                    ADLA    1,DL
         4 000300   200005 755100                    STA     PNUM,,AUTO
         4 000301   000003 115007                    CMPA    3,DL
         4 000302   000266 602000 4                  TNC     s:7736

      362     7738        /* Print 'Done Rumming' on OC */
      363     7739    2           CALL M$TEMPWROC(OC_CRLF);

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:48   
   7739  4 000303   004314 630400 1                  EPPR0   OC_CRLF
         4 000304   110000 713400                    CLIMB   36864
         4 000305   401000 401760                    pmme    nvectors=3

      364     7740    2           WRITE_OC.BUFW_ = VECTOR(T_DONERUMMSG);

   7740  4 000306   000024 237000 5                  LDAQ    20
         4 000307   004306 757000 1                  STAQ    WRITE_OC+2

      365     7741    2           CALL M$TEMPWROC(WRITE_OC);

   7741  4 000310   004304 630400 1                  EPPR0   WRITE_OC
         4 000311   110000 713400                    CLIMB   36864
         4 000312   401000 401760                    pmme    nvectors=3

      366     7742        /* Rename :RUM to ::RUM   */
      367     7743    2           DELETE_RUM.NAME_ = VECTOR(RF_NEW_NAME);

   7743  4 000313   000026 237000 5                  LDAQ    22
         4 000314   004556 757000 1                  STAQ    DELETE_RUM+6

      368     7744    2           UPDATE_RUM.NAME_ = VECTOR(RF_NAME);

   7744  4 000315   000030 237000 5                  LDAQ    24
         4 000316   004650 757000 1                  STAQ    UPDATE_RUM+6

      369     7745    2           RENAME_RUM.NAME_ = VECTOR(RF_NEW_NAME);

   7745  4 000317   000026 237000 5                  LDAQ    22
         4 000320   004742 757000 1                  STAQ    RENAME_RUM+6

      370     7746    2           CALL M$OPEN(DELETE_RUM) ALTRET(FIRST_RUM);

   7746  4 000321   004550 630400 1                  EPPR0   DELETE_RUM
         4 000322   450000 713400                    CLIMB   alt,open
         4 000323   410400 401760                    pmme    nvectors=18
         4 000324   000325 702000 4                  TSX2    FIRST_RUM
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:49   

   7745  4 000325                       FIRST_RUM    null
      371     7747    2   FIRST_RUM: ;
      372     7748    2           CALL M$OPEN(UPDATE_RUM) ALTRET(INSTALL_EM);

   7748  4 000325   004642 630400 1                  EPPR0   UPDATE_RUM
         4 000326   450000 713400                    CLIMB   alt,open
         4 000327   410400 401760                    pmme    nvectors=18
         4 000330   000437 702000 4                  TSX2    INSTALL_EM

      373     7749    2           CALL M$CLOSE(RENAME_RUM) ALTRET(INSTALL_EM);

   7749  4 000331   004734 630400 1                  EPPR0   RENAME_RUM
         4 000332   450001 713400                    CLIMB   alt,close
         4 000333   406000 401760                    pmme    nvectors=13
         4 000334   000437 702000 4                  TSX2    INSTALL_EM

      374     7750    2           GOTO INSTALL_EM;

   7750  4 000335   000437 710000 4                  TRA     INSTALL_EM

      375     7751
      376     7752    2   NO_RUMF:
      377     7753    2           IF B$ALT.ERR.CODE=%E$NOFILE

   7753  4 000336   000000 470400 xsym  NO_RUMF      LDP0    B$TCB$
         4 000337   000000 471500                    LDP1    0,,PR0
         4 000340   100102 236100                    LDQ     66,,PR1
         4 000341   377770 376007                    ANQ     131064,DL
         4 000342   001610 116007                    CMPQ    904,DL
         4 000343   000355 601000 4                  TNZ     s:7762

      378     7754    3           THEN DO;

      379     7755        /* Print 'No RUM file for processors' */
      380     7756    3                CALL M$TEMPWROC(OC_CRLF);

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:50   
   7756  4 000344   004314 630400 1                  EPPR0   OC_CRLF
         4 000345   110000 713400                    CLIMB   36864
         4 000346   401000 401760                    pmme    nvectors=3

      381     7757    3                WRITE_OC.BUFW_ = VECTOR(T_NORUMS);

   7757  4 000347   000032 237000 5                  LDAQ    26
         4 000350   004306 757000 1                  STAQ    WRITE_OC+2

      382     7758    3                CALL M$TEMPWROC(WRITE_OC);

   7758  4 000351   004304 630400 1                  EPPR0   WRITE_OC
         4 000352   110000 713400                    CLIMB   36864
         4 000353   401000 401760                    pmme    nvectors=3

      383     7759    3                GOTO INSTALL_EM;

   7759  4 000354   000437 710000 4                  TRA     INSTALL_EM

      384     7760    3                END;
      385     7761    3           ELSE DO;

      386     7762    3                JITERR=B$ALT.ERR;

   7762  4 000355   100102 236100                    LDQ     66,,PR1
         4 000356   004077 756000 1                  STQ     JITERR

      387     7763    3                GOTO PRINT_ERR;

   7763  4 000357   000416 710000 4                  TRA     PRINT_ERR

   7762  4 000360                       NO_DELTA     null
      388     7764    3                END;
      389     7765    2   NO_DELTA: ;
      390     7766    2           JITERR=B$ALT.ERR;

   7766  4 000360   000000 470400 xsym               LDP0    B$TCB$
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:51   
         4 000361   000000 471500                    LDP1    0,,PR0
         4 000362   100102 236100                    LDQ     66,,PR1
         4 000363   004077 756000 1                  STQ     JITERR

      391     7767    2   NO_DELTA2:
      392     7768        /* Print 'No DELTA-cant apply RUMs'  */
      393     7769    2           CALL M$TEMPWROC(OC_CRLF);

   7769  4 000364   004314 630400 1     NO_DELTA2    EPPR0   OC_CRLF
         4 000365   110000 713400                    CLIMB   36864
         4 000366   401000 401760                    pmme    nvectors=3

      394     7770    2           WRITE_OC.BUFW_ = VECTOR(T_NODELTA);

   7770  4 000367   000034 237000 5                  LDAQ    28
         4 000370   004306 757000 1                  STAQ    WRITE_OC+2

      395     7771    2           CALL M$TEMPWROC(WRITE_OC);

   7771  4 000371   004304 630400 1                  EPPR0   WRITE_OC
         4 000372   110000 713400                    CLIMB   36864
         4 000373   401000 401760                    pmme    nvectors=3

      396     7772    2           GOTO PRINT_ERR;

   7772  4 000374   000416 710000 4                  TRA     PRINT_ERR

      397     7773    2   DELTA_XCON:
      398     7774    2           JITERR=B$XCON.ERR;

   7774  4 000375   000000 470400 xsym  DELTA_XCON   LDP0    B$TCB$
         4 000376   000001 471500                    LDP1    1,,PR0
         4 000377   100102 236100                    LDQ     66,,PR1
         4 000400   004077 756000 1                  STQ     JITERR

      399     7775    2           CALL M$CLRSTK ALTRET(DELTA_XCON2);

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:52   
   7775  4 000401   410013 713400                    CLIMB   alt,+4107
         4 000402   000000 401760                    pmme    nvectors=0
         4 000403   000404 702000 4                  TSX2    DELTA_XCON2

      400     7776    2   DELTA_XCON2:
      401     7777    2           CALL M$TEMPWROC(OC_CRLF);

   7777  4 000404   004314 630400 1     DELTA_XCON2  EPPR0   OC_CRLF
         4 000405   110000 713400                    CLIMB   36864
         4 000406   401000 401760                    pmme    nvectors=3

      402     7778    2           WRITE_OC.BUFW_ = VECTOR(T_XCON);

   7778  4 000407   000036 237000 5                  LDAQ    30
         4 000410   004306 757000 1                  STAQ    WRITE_OC+2

      403     7779        /* Print 'IGS Exit Control' */
      404     7780    2           CALL M$TEMPWROC(WRITE_OC);

   7780  4 000411   004304 630400 1                  EPPR0   WRITE_OC
         4 000412   110000 713400                    CLIMB   36864
         4 000413   401000 401760                    pmme    nvectors=3

      405     7781    2           CALL DUMPTCB;                   /* DUMP THE TCB ON THE CONSOLE        */

   7781  4 000414   001014 701000 4                  TSX1    DUMPTCB
         4 000415   000000 011000                    NOP     0

      406     7782    2   PRINT_ERR:
      407     7783    2           IF JITERR.CODE ~= 0 THEN

   7783  4 000416   004077 236000 1     PRINT_ERR    LDQ     JITERR
         4 000417   377770 316007                    CANQ    131064,DL
         4 000420   000437 600000 4                  TZE     INSTALL_EM

      408     7784    3           DO;

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:53   
      409     7785    3                CALL M$ERRMSG(FPT_ERRMSG) ALTRET(WOOPS);

   7785  4 000421   004324 630400 1                  EPPR0   FPT_ERRMSG
         4 000422   420000 713400                    CLIMB   alt,+8192
         4 000423   405000 401760                    pmme    nvectors=11
         4 000424   000425 702000 4                  TSX2    WOOPS

      410     7786    3   WOOPS:
      411     7787    3                WRITE_OC.BUFW_ = VECTOR(ERRMSGBUF);

   7787  4 000425   000040 237000 5     WOOPS        LDAQ    32
         4 000426   004306 757000 1                  STAQ    WRITE_OC+2

      412     7788    3                CALL M$TEMPWROC(OC_CRLF);

   7788  4 000427   004314 630400 1                  EPPR0   OC_CRLF
         4 000430   110000 713400                    CLIMB   36864
         4 000431   401000 401760                    pmme    nvectors=3

      413     7789    3                CALL M$TEMPWROC(WRITE_OC);

   7789  4 000432   004304 630400 1                  EPPR0   WRITE_OC
         4 000433   110000 713400                    CLIMB   36864
         4 000434   401000 401760                    pmme    nvectors=3

      414     7790    3                JITERR=JITERR_INIT;

   7790  4 000435   000000 236000 2                  LDQ     JITERR_INIT
         4 000436   004077 756000 1                  STQ     JITERR

      415     7791    3                END;

   7783  4 000437                       INSTALL_EM   null
      416     7792    2   INSTALL_EM:;
      417     7793    2           IGS_XCON.V_ = VECTOR(PREVXCON);

   7793  4 000437   000042 237000 5                  LDAQ    34
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:54   
         4 000440   004356 757000 1                  STAQ    IGS_XCON

      418     7794    2           IGS_XCON.PXCON_ = VECTOR(NIL);

   7794  4 000441   000044 237000 5                  LDAQ    36
         4 000442   004360 757000 1                  STAQ    IGS_XCON+2

      419     7795    2           CALL M$XCON(IGS_XCON) ALTRET(SKIP_IT2);

   7795  4 000443   004356 630400 1                  EPPR0   IGS_XCON
         4 000444   410003 713400                    CLIMB   alt,+4099
         4 000445   400400 401760                    pmme    nvectors=2
         4 000446   000447 702000 4                  TSX2    SKIP_IT2

      420     7796    2   SKIP_IT2: CALL M$LDEV(PRINT_DO) ALTRET(BORSCHT);

   7796  4 000447   005106 630400 1     SKIP_IT2     EPPR0   PRINT_DO
         4 000450   460004 713400                    CLIMB   alt,+24580
         4 000451   403000 401760                    pmme    nvectors=7
         4 000452   000453 702000 4                  TSX2    BORSCHT

   7794  4 000453                       BORSCHT      null
      421     7797    2   BORSCHT:;
      422     7798    2           END;

      423     7799        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:55   
      424     7800        /**/
      425     7801        /* Enter the processor-installing loop:                            */
      426     7802        /**/
      427     7803    2      DO PNUM = 1 TO NPROCS;

   7803  4 000453   000001 235007                    LDA     1,DL
         4 000454   200005 755100                    STA     PNUM,,AUTO
         4 000455   000755 710000 4                  TRA     CONT+3

      428     7804    2           JITERR = JITERR_INIT;

   7804  4 000456   000000 236000 2                  LDQ     JITERR_INIT
         4 000457   004077 756000 1                  STQ     JITERR

      429     7805    2           IF (B$P.NAME.TEXT(PNUM) ~= TC_FREE.TEXT)

   7805  4 000460   200005 236100                    LDQ     PNUM,,AUTO
         4 000461   000210 402007                    MPY     136,DL
         4 000462   004152 470400 1                  LDP0    P$
         4 000463   040000 106506                    CMPC    fill='040'O
         4 000464   000032 200037                    ADSC9   26,Q,PR0                 cn=1,n=31
         4 000465   004275 200005 1                  ADSC9   TC_FREE                  cn=1,n=5
         4 000466   000752 600000 4                  TZE     CONT

      430     7806    2           THEN
      431     7807    3           DO;

      432     7808    3                CALL BUILD_PCNTRL(PNUM);

   7808  4 000467   200005 631500                    EPPR1   PNUM,,AUTO
         4 000470   200023 451500                    STP1    PCNTRL+10,,AUTO
         4 000471   000761 701000 4                  TSX1    BUILD_PCNTRL
         4 000472   000000 011000                    NOP     0

      433     7809    3                CALL GET_PTYPE(PNUM,PTYPE);

   7809  4 000473   200006 630500                    EPPR0   PTYPE,,AUTO
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:56   
         4 000474   200024 450500                    STP0    @DATE+1,,AUTO
         4 000475   200005 631500                    EPPR1   PNUM,,AUTO
         4 000476   200023 451500                    STP1    PCNTRL+10,,AUTO
         4 000477   001126 701000 4                  TSX1    GET_PTYPE
         4 000500   000000 011000                    NOP     0

      434     7810    3                PCNTRL.PTYPE = PTYPE;

   7810  4 000501   200006 720100                    LXL0    PTYPE,,AUTO
         4 000502   200014 740100                    STX0    PCNTRL+3,,AUTO

      435     7811    3                CALL OPEN_FID(PCNTRL.FID$) ALTRET(BLACK_WIDOW);

   7811  4 000503   200015 630500                    EPPR0   PCNTRL+4,,AUTO
         4 000504   200023 450500                    STP0    PCNTRL+10,,AUTO
         4 000505   001200 701000 4                  TSX1    OPEN_FID
         4 000506   000646 702000 4                  TSX2    BLACK_WIDOW

      436     7812    3                CALL GET_MODTIME(PCNTRL.MODTIME) ALTRET(BLACK_WIDOW);

   7812  4 000507   200016 630500                    EPPR0   PCNTRL+5,,AUTO
         4 000510   200023 450500                    STP0    PCNTRL+10,,AUTO
         4 000511   001230 701000 4                  TSX1    GET_MODTIME
         4 000512   000646 702000 4                  TSX2    BLACK_WIDOW

      437     7813    3                CALL M$READ(READ_HEAD) ALTRET(NO_HEAD);

   7813  4 000513   005014 630400 1                  EPPR0   READ_HEAD
         4 000514   440000 713400                    CLIMB   alt,read
         4 000515   401400 401760                    pmme    nvectors=4
         4 000516   000741 702000 4                  TSX2    NO_HEAD

      438     7814    3                IF DCBADDR(DCBNUM(M$EI))->F$DCB.ARS# < SIZEC(B$HEAD)

   7814  4 000517   000000 236007 xsym               LDQ     M$EI,DL
         4 000520   000013 470400 5                  LDP0    11
         4 000521   000000 471500                    LDP1    0,,PR0
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:57   
         4 000522   100000 473506                    LDP3    0,QL,PR1
         4 000523   300000 235100                    LDA     0,,PR3
         4 000524   000240 115007                    CMPA    160,DL
         4 000525   000533 605000 4                  TPL     s:7826

      439     7815    4                THEN DO;

      440     7816        /*E*    ERROR: IGS-E$IP_OLDRU-2
      441     7817               MESSAGE: The head record size is invald for this version.
      442     7818                MESSAGE1: The head record size for this run unit does not
      443     7819                            match the head record size for the current running
      444     7820                            system.
      445     7821              */
      446     7822    4                     JITERR.CODE = E$IP_OLDRU;

   7822  4 000526   004077 236000 1                  LDQ     JITERR
         4 000527   000046 376000 5                  ANQ     38
         4 000530   001700 276007                    ORQ     960,DL
         4 000531   004077 756000 1                  STQ     JITERR

      447     7823    4                     GOTO BLACK_WIDOW;

   7823  4 000532   000646 710000 4                  TRA     BLACK_WIDOW

      448     7824    4                     END;
      449     7825
      450     7826    3                IF B$HEAD.FLAVOR ~= %HOST_RU

   7826  4 000533   004151 473400 1                  LDP3    HEAD$
         4 000534   300022 236100                    LDQ     18,,PR3
         4 000535   777000 376003                    ANQ     -512,DU
         4 000536   001000 116003                    CMPQ    512,DU
         4 000537   000545 600000 4                  TZE     s:7835

      451     7827    4                THEN DO;

      452     7828        /*E*    ERROR: IGS-E$IP_BADFLAVOR-2
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:58   
      453     7829                MESSAGE: This run unit is not a host run unit.
      454     7830        */
      455     7831    4                     JITERR.CODE = E$IP_BADFLAVOR;

   7831  4 000540   004077 236000 1                  LDQ     JITERR
         4 000541   000046 376000 5                  ANQ     38
         4 000542   001710 276007                    ORQ     968,DL
         4 000543   004077 756000 1                  STQ     JITERR

      456     7832    4                     GOTO BLACK_WIDOW;

   7832  4 000544   000646 710000 4                  TRA     BLACK_WIDOW

      457     7833    4                     END;
      458     7834
      459     7835    3                IF ((PCNTRL.PTYPE >= I_CP) AND (PCNTRL.PTYPE <= I_ASL)) AND

   7835  4 000545   200014 220100                    LDX0    PCNTRL+3,,AUTO
         4 000546   000024 100003                    CMPX0   20,DU
         4 000547   000567 602000 4                  TNC     s:7844
         4 000550   000027 100003                    CMPX0   23,DU
         4 000551   000567 603000 4                  TRC     s:7844
         4 000552   300002 236100                    LDQ     2,,PR3
         4 000553   000047 316000 5                  CANQ    39
         4 000554   000562 601000 4                  TNZ     s:7841
         4 000555   300010 721100                    LXL1    8,,PR3
         4 000556   000562 601000 4                  TNZ     s:7841
         4 000557   300022 236100                    LDQ     18,,PR3
         4 000560   000010 316003                    CANQ    8,DU
         4 000561   000567 600000 4                  TZE     s:7844

      460     7836    3                  ((B$HEAD.RDATA > 0) OR (B$HEAD.ROSIZE > 0) OR B$HEAD.OVRL)
      461     7837    4                THEN DO;

      462     7838        /*E*    ERROR:  IGS-E$IP_BADSSP-0
      463     7839                MESSAGE: Special shared processors can't have data or ROSEG.
      464     7840        */
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:59   
      465     7841    4                     JITERR.CODE = E$IP_BADSSP;

   7841  4 000562   004077 236000 1                  LDQ     JITERR
         4 000563   000046 376000 5                  ANQ     38
         4 000564   001510 276007                    ORQ     840,DL
         4 000565   004077 756000 1                  STQ     JITERR

      466     7842    4                     GOTO BLACK_WIDOW;

   7842  4 000566   000646 710000 4                  TRA     BLACK_WIDOW

      467     7843    4                     END;
      468     7844    3                IF ((PCNTRL.PTYPE = I_ASL) AND NOT B$HEAD.ASL) OR

   7844  4 000567   000026 100003                    CMPX0   22,DU
         4 000570   000574 601000 4                  TNZ     s:7844+5
         4 000571   300022 236100                    LDQ     18,,PR3
         4 000572   000100 316003                    CANQ    64,DU
         4 000573   000601 600000 4                  TZE     s:7850
         4 000574   000027 100003                    CMPX0   23,DU
         4 000575   000606 601000 4                  TNZ     s:7854
         4 000576   300022 236100                    LDQ     18,,PR3
         4 000577   000200 316003                    CANQ    128,DU
         4 000600   000606 601000 4                  TNZ     s:7854

      469     7845    3                  ((PCNTRL.PTYPE = I_LIB) AND NOT B$HEAD.LIB)
      470     7846    4                THEN DO;

      471     7847        /*E*    ERROR:  IGS-E$IP_MISMATCH-0
      472     7848                MESSAGE: Run unit type does not match intended processor type.
      473     7849        */
      474     7850    4                     JITERR.CODE = E$IP_MISMATCH;

   7850  4 000601   004077 236000 1                  LDQ     JITERR
         4 000602   000046 376000 5                  ANQ     38
         4 000603   001520 276007                    ORQ     848,DL
         4 000604   004077 756000 1                  STQ     JITERR
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:60   

      475     7851    4                     GOTO BLACK_WIDOW;

   7851  4 000605   000646 710000 4                  TRA     BLACK_WIDOW

      476     7852    4                     END;
      477     7853        /* Now, let's actually try to install it... */
      478     7854    3                IF (PCNTRL.PTYPE >= I_CP) AND (PCNTRL.PTYPE <= I_ASL)

   7854  4 000606   000024 100003                    CMPX0   20,DU
         4 000607   000625 602000 4                  TNC     s:7856
         4 000610   000027 100003                    CMPX0   23,DU
         4 000611   000625 603000 4                  TRC     s:7856

      479     7855    3                THEN CALL IPC$ADD_SPCL(PCNTRL,PNUM,JITERR) ALTRET(BLACK_WIDOW);

   7855  4 000612   000014 236000 5                  LDQ     12
         4 000613   200056 756100                    STQ     J+4,,AUTO
         4 000614   200005 634500                    EPPR4   PNUM,,AUTO
         4 000615   200055 454500                    STP4    J+3,,AUTO
         4 000616   200011 635500                    EPPR5   PCNTRL,,AUTO
         4 000617   200054 455500                    STP5    J+2,,AUTO
         4 000620   200054 630500                    EPPR0   J+2,,AUTO
         4 000621   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 000622   000000 701000 xent               TSX1    IPC$ADD_SPCL
         4 000623   000646 702000 4                  TSX2    BLACK_WIDOW
         4 000624   000646 710000 4                  TRA     BLACK_WIDOW

      480     7856    3                ELSE IF PCNTRL.PTYPE = I_LIB

   7856  4 000625   000027 100003                    CMPX0   23,DU
         4 000626   000642 601000 4                  TNZ     s:7861

      481     7857    3                     THEN CALL IPC$ADD_LIB(PCNTRL,PNUM,JITERR) ALTRET(BLACK_WIDOW);

   7857  4 000627   000014 236000 5                  LDQ     12
         4 000630   200056 756100                    STQ     J+4,,AUTO
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:61   
         4 000631   200005 634500                    EPPR4   PNUM,,AUTO
         4 000632   200055 454500                    STP4    J+3,,AUTO
         4 000633   200011 635500                    EPPR5   PCNTRL,,AUTO
         4 000634   200054 455500                    STP5    J+2,,AUTO
         4 000635   200054 630500                    EPPR0   J+2,,AUTO
         4 000636   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 000637   000000 701000 xent               TSX1    IPC$ADD_LIB
         4 000640   000646 702000 4                  TSX2    BLACK_WIDOW
         4 000641   000646 710000 4                  TRA     BLACK_WIDOW

      482     7858    4                     ELSE DO;

      483     7859        /*E*    ERROR:  IGS-E$IP_NOTYPE-0
      484     7860                MESSAGE: Processor type wasn't specified in processor tables. */
      485     7861    4                          JITERR.CODE = E$IP_NOTYPE;

   7861  4 000642   004077 236000 1                  LDQ     JITERR
         4 000643   000046 376000 5                  ANQ     38
         4 000644   001620 276007                    ORQ     912,DL
         4 000645   004077 756000 1                  STQ     JITERR

      486     7862    4                          END;

      487     7863    3   BLACK_WIDOW:
      488     7864    3                IF JITERR.CODE ~= 0 THEN

   7864  4 000646   004077 236000 1     BLACK_WIDOW  LDQ     JITERR
         4 000647   377770 316007                    CANQ    131064,DL
         4 000650   000740 600000 4                  TZE     s:7887

      489     7865    4                DO;

      490     7866    4                     CALL M$ERRMSG(FPT_ERRMSG) ALTRET(LOOP_END);

   7866  4 000651   004324 630400 1                  EPPR0   FPT_ERRMSG
         4 000652   420000 713400                    CLIMB   alt,+8192
         4 000653   405000 401760                    pmme    nvectors=11
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:62   
         4 000654   000746 702000 4                  TSX2    LOOP_END

      491     7867    4                     WRITE_OC.BUFW_ = VECTOR(ERRMSGBUF);

   7867  4 000655   000040 237000 5                  LDAQ    32
         4 000656   004306 757000 1                  STAQ    WRITE_OC+2

      492     7868        /* Dont print the trailing blanks */
      493     7869    4                     I = 120;

   7869  4 000657   000170 235007                    LDA     120,DL
         4 000660   200003 755100                    STA     I,,AUTO

      494     7870    4   NXTB:             I = I - 1;

   7870  4 000661   000001 336007       NXTB         LCQ     1,DL
         4 000662   200003 056100                    ASQ     I,,AUTO

      495     7871    4                     IF I = 0 THEN GOTO DONE;

   7871  4 000663   000672 600000 4                  TZE     DONE

      496     7872    4                     IF ERRMSG(I) ~= ' ' THEN GOTO DONE;

   7872  4 000664   200003 235100                    LDA     I,,AUTO
         4 000665   040000 106405                    CMPC    fill='040'O
         4 000666   004106 000001 1                  ADSC9   ERRMSGBUF,A              cn=0,n=1
         4 000667   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 000670   000672 601000 4                  TNZ     DONE

      497     7873    4                     GOTO NXTB;

   7873  4 000671   000661 710000 4                  TRA     NXTB

      498     7874    4   DONE:             WRITE_OC.BUFW_.BOUND = I;

   7874  4 000672   200003 236100       DONE         LDQ     I,,AUTO
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:63   
         4 000673   000020 736000                    QLS     16
         4 000674   004306 676000 1                  ERQ     WRITE_OC+2
         4 000675   000034 376000 xsym               ANQ     B_VECTNIL+28
         4 000676   004306 656000 1                  ERSQ    WRITE_OC+2

      499     7875    4                     CALL M$TEMPWROC(OC_CRLF);

   7875  4 000677   004314 630400 1                  EPPR0   OC_CRLF
         4 000700   110000 713400                    CLIMB   36864
         4 000701   401000 401760                    pmme    nvectors=3

      500     7876    4                     CALL M$TEMPWROC(WRITE_OC);

   7876  4 000702   004304 630400 1                  EPPR0   WRITE_OC
         4 000703   110000 713400                    CLIMB   36864
         4 000704   401000 401760                    pmme    nvectors=3

      501     7877        /* Write a CRLF, then 'WHILE INSTALLING PROCESSOR: "pname"' message. */
      502     7878    4                     IF (JITERR.FCG = '1120'O) OR (JITERR.FCG = '1107'O) THEN

   7878  4 000705   004077 236000 1                  LDQ     JITERR
         4 000706   777700 376003                    ANQ     -64,DU
         4 000707   112000 116003                    CMPQ    37888,DU
         4 000710   000715 600000 4                  TZE     s:7880
         4 000711   004077 236000 1                  LDQ     JITERR
         4 000712   777700 376003                    ANQ     -64,DU
         4 000713   110700 116003                    CMPQ    37312,DU
         4 000714   000740 601000 4                  TNZ     s:7887

      503     7879    5                     DO;

      504     7880    5                          CALL M$TEMPWROC(OC_CRLF);

   7880  4 000715   004314 630400 1                  EPPR0   OC_CRLF
         4 000716   110000 713400                    CLIMB   36864
         4 000717   401000 401760                    pmme    nvectors=3

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:64   
      505     7881    5                          WRITE_OC.BUFW_ = VECTOR(T_PROCMSG);

   7881  4 000720   000050 237000 5                  LDAQ    40
         4 000721   004306 757000 1                  STAQ    WRITE_OC+2

      506     7882    5                          CALL M$TEMPWROC(WRITE_OC);

   7882  4 000722   004304 630400 1                  EPPR0   WRITE_OC
         4 000723   110000 713400                    CLIMB   36864
         4 000724   401000 401760                    pmme    nvectors=3

      507     7883    5                          WRITE_OC.BUFW_ = VECTOR(B$P.NAME.TEXT(PNUM));

   7883  4 000725   000052 235000 5                  LDA     42
         4 000726   200005 236100                    LDQ     PNUM,,AUTO
         4 000727   200054 755100                    STA     J+2,,AUTO
         4 000730   000042 402003                    MPY     34,DU
         4 000731   000053 036000 5                  ADLQ    43
         4 000732   004152 036000 1                  ADLQ    P$
         4 000733   200054 235100                    LDA     J+2,,AUTO
         4 000734   004306 757000 1                  STAQ    WRITE_OC+2

      508     7884    5                          CALL M$TEMPWROC(WRITE_OC);

   7884  4 000735   004304 630400 1                  EPPR0   WRITE_OC
         4 000736   110000 713400                    CLIMB   36864
         4 000737   401000 401760                    pmme    nvectors=3

      509     7885    5                          END;

      510     7886    4                     END;

      511     7887    3                GOTO LOOP_END;

   7887  4 000740   000746 710000 4                  TRA     LOOP_END

   7887  4 000741                       NO_HEAD      null
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:65   
      512     7888        /**/
      513     7889    3   NO_HEAD:     ;
      514     7890        /*E*    ERROR:  IGS-E$IP_BADRU-0
      515     7891                MESSAGE: The file for this processor name is not a run unit. */
      516     7892    3                JITERR.CODE = E$IP_BADRU;

   7892  4 000741   004077 236000 1                  LDQ     JITERR
         4 000742   000046 376000 5                  ANQ     38
         4 000743   001630 276007                    ORQ     920,DL
         4 000744   004077 756000 1                  STQ     JITERR

      517     7893    3                GOTO BLACK_WIDOW;

   7893  4 000745   000646 710000 4                  TRA     BLACK_WIDOW

      518     7894        /**/
      519     7895    3   LOOP_END:
      520     7896    3                CALL M$CLOSE(CLOSE_EI) ALTRET(CONT);

   7896  4 000746   005032 630400 1     LOOP_END     EPPR0   CLOSE_EI
         4 000747   450001 713400                    CLIMB   alt,close
         4 000750   406000 401760                    pmme    nvectors=13
         4 000751   000752 702000 4                  TSX2    CONT

      521     7897    3                END;                       /* End of DO IF NOT :FREE             */

      522     7898    2   CONT:   END;                            /* End of the installer loop          */

   7898  4 000752   200005 235100       CONT         LDA     PNUM,,AUTO
         4 000753   000001 035007                    ADLA    1,DL
         4 000754   200005 755100                    STA     PNUM,,AUTO
         4 000755   004154 236000 1                  LDQ     NPROCS
         4 000756   200005 116100                    CMPQ    PNUM,,AUTO
         4 000757   000456 603000 4                  TRC     s:7804

      523     7899    1      RETURN;

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:66   
   7899  4 000760   000000 702200 xent               TSX2  ! X66_ARET

      524     7900        /**/
      525     7901        /**/
      526     7902        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:67   
      527     7903        /***************************************************************/
      528     7904        /*                 INTERNAL PROCEDURES                         */
      529     7905        /***************************************************************/
      530     7906        /**/
      531     7907        /* This procedure builds the control block used to drive the       */
      532     7908        /* installer routines based upon information in the processor      */
      533     7909        /* table entries.  PTYPE and MODTIME will be filled in later.      */
      534     7910    1   BUILD_PCNTRL: PROC(PNUM);

   7910  4 000761   200022 741300       BUILD_PCNTRL STX1  ! PCNTRL+9,,AUTO

      535     7911    2   DCL PNUM UBIN;
      536     7912        /**/
      537     7913    2      PCNTRL = PCNTRL_INIT;

   7913  4 000762   000100 100400                    MLR     fill='000'O
         4 000763   004064 000040 1                  ADSC9   PCNTRL_INIT              cn=0,n=32
         4 000764   200011 000040                    ADSC9   PCNTRL,,AUTO             cn=0,n=32

      538     7914    2      PCNTRL.PNAME$ = ADDR(B$P.NAME(PNUM));

   7914  4 000765   200023 470500                    LDP0    @PNUM,,AUTO
         4 000766   000000 236100                    LDQ     0,,PR0
         4 000767   000021 402007                    MPY     17,DL
         4 000770   000023 736000                    QLS     19
         4 000771   000032 036003                    ADLQ    26,DU
         4 000772   004152 036000 1                  ADLQ    P$
         4 000773   200012 756100                    STQ     PCNTRL+1,,AUTO

      539     7915    2      PCNTRL.FID$ = ADDR(B$P.NAME(PNUM));

   7915  4 000774   000000 236100                    LDQ     0,,PR0
         4 000775   000021 402007                    MPY     17,DL
         4 000776   000023 736000                    QLS     19
         4 000777   000032 036003                    ADLQ    26,DU
         4 001000   004152 036000 1                  ADLQ    P$
         4 001001   200015 756100                    STQ     PCNTRL+4,,AUTO
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:68   

      540     7916    2      PCNTRL.PFLGS = B$P.FLGS(PNUM);

   7916  4 001002   000000 236100                    LDQ     0,,PR0
         4 001003   000021 402007                    MPY     17,DL
         4 001004   000001 736000                    QLS     1
         4 001005   004152 471400 1                  LDP1    P$
         4 001006   100027 236106                    LDQ     23,QL,PR1
         4 001007   777777 376003                    ANQ     -1,DU
         4 001010   200020 756100                    STQ     PCNTRL+7,,AUTO

      541     7917    2      PCNTRL.PNUM = PNUM;

   7917  4 001011   000000 720100                    LXL0    0,,PR0
         4 001012   200017 740100                    STX0    PCNTRL+6,,AUTO

      542     7918    2      RETURN;

   7918  4 001013   000001 702211                    TSX2  ! 1,X1

      543     7919    2   END BUILD_PCNTRL;
      544     7920        /**/
      545     7921        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:69   
      546     7922    1   DUMPTCB: PROC;

   7922  4 001014   200022 741300       DUMPTCB      STX1  ! PCNTRL+9,,AUTO

      547     7923
      548     7924    2   DCL OUTBUF CHAR(80) CALIGNED;
      549     7925
      550     7926    2   DCL TEMPW BIT(36);
      551     7927    2   DCL TEMPWU REDEF TEMPW UBIN WORD;
      552     7928    2   DCL TEMPWB BIT(36) BASED;
      553     7929    2   DCL DPOSN UBIN;
      554     7930    2   DCL I SBIN;
      555     7931    2   DCL J SBIN;
      556     7932
      557     7933    2      DPOSN = 0;

   7933  4 001015   200050 450100                    STZ     DPOSN,,AUTO

      558     7934    2      I = 0;

   7934  4 001016   200051 450100                    STZ     I,,AUTO

      559     7935    2      OUTBUF=' ';

   7935  4 001017   040100 100400                    MLR     fill='040'O
         4 001020   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 001021   200023 000120                    ADSC9   OUTBUF,,AUTO             cn=0,n=80

      560     7936    2      WRITE_OC.BUFW_ = VECTOR (OUTBUF);

   7936  4 001022   000054 235000 5                  LDA     44
         4 001023   200054 452500                    STP2    J+2,,AUTO
         4 001024   200054 236100                    LDQ     J+2,,AUTO
         4 001025   000023 036003                    ADLQ    19,DU
         4 001026   004306 757000 1                  STAQ    WRITE_OC+2

      561     7937
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:70   
      562     7938    3      DO WHILE (I<294);

   7938  4 001027   200051 235100                    LDA     I,,AUTO
         4 001030   000446 115007                    CMPA    294,DL
         4 001031   001117 605000 4                  TPL     s:7959

      563     7939    3           TEMPW = PINCRW(B$TCB$,I) -> TEMPWB;

   7939  4 001032   200051 236100                    LDQ     I,,AUTO
         4 001033   000044 402007                    MPY     36,DL
         4 001034   000000 116003                    CMPQ    0,DU
         4 001035   001037 605000 4                  TPL     s:7939+5
         4 001036   000044 036003                    ADLQ    36,DU
         4 001037   000000 470400 xsym               LDP0    B$TCB$
         4 001040   003100 060506                    CSL     bolr='003'O
         4 001041   000000 000044                    BDSC    0,Q,PR0                  by=0,bit=0,n=36
         4 001042   200047 000044                    BDSC    TEMPW,,AUTO              by=0,bit=0,n=36

      564     7940    3           IF (DPOSN+13) > 80              /* ROOM TO INSERT?                    */

   7940  4 001043   200050 235100                    LDA     DPOSN,,AUTO
         4 001044   000104 115007                    CMPA    68,DL
         4 001045   001055 602000 4                  TNC     s:7946

      565     7941    4           THEN DO;

      566     7942    4                CALL M$TEMPWROC (WRITE_OC);

   7942  4 001046   004304 630400 1                  EPPR0   WRITE_OC
         4 001047   110000 713400                    CLIMB   36864
         4 001050   401000 401760                    pmme    nvectors=3

      567     7943    4                OUTBUF = ' ';

   7943  4 001051   040100 100400                    MLR     fill='040'O
         4 001052   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 001053   200023 000120                    ADSC9   OUTBUF,,AUTO             cn=0,n=80
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:71   

      568     7944    4                DPOSN = 0;

   7944  4 001054   200050 450100                    STZ     DPOSN,,AUTO

      569     7945    4                END;

      570     7946    3           CALL INSERT (OUTBUF,DPOSN,1,' ');

   7946  4 001055   200050 235100                    LDA     DPOSN,,AUTO
         4 001056   040105 100400                    MLR     fill='040'O
         4 001057   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 001060   200023 000001                    ADSC9   OUTBUF,A,AUTO            cn=0,n=1

      571     7947    3           DPOSN = DPOSN + 12;

   7947  4 001061   000014 035007                    ADLA    12,DL
         4 001062   200050 755100                    STA     DPOSN,,AUTO

      572     7948    4           DO J=0 TO 11;

   7948  4 001063   200052 450100                    STZ     J,,AUTO

      573     7949    4                CALL INSERT (OUTBUF,DPOSN-J,1,

   7949  4 001064   200050 236100                    LDQ     DPOSN,,AUTO
         4 001065   200052 136100                    SBLQ    J,,AUTO
         4 001066   200054 756100                    STQ     J+2,,AUTO
         4 001067   200047 236100                    LDQ     TEMPW,,AUTO
         4 001070   000011 376000 xsym               ANQ     B_VECTNIL+9
         4 001071   000060 036007                    ADLQ    48,DL
         4 001072   000033 736000                    QLS     27
         4 001073   000055 276000 5                  ORQ     45
         4 001074   200055 756100                    STQ     J+3,,AUTO
         4 001075   200054 235100                    LDA     J+2,,AUTO
         4 001076   040105 100500                    MLR     fill='040'O
         4 001077   200055 000004                    ADSC9   J+3,,AUTO                cn=0,n=4
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:72   
         4 001100   200023 000001                    ADSC9   OUTBUF,A,AUTO            cn=0,n=1

      574     7950    4                  BINASC(BITBIN(TEMPW & '000000000007'O) + 48));
      575     7951    4                TEMPWU = TEMPWU / 8;

   7951  4 001101   200047 236100                    LDQ     TEMPW,,AUTO
         4 001102   000003 772000                    QRL     3
         4 001103   200047 756100                    STQ     TEMPW,,AUTO

      576     7952    4                END;                       /* DO WHILE CONVERTING EACH DIGIT     */

   7952  4 001104   200052 054100                    AOS     J,,AUTO
         4 001105   200052 235100                    LDA     J,,AUTO
         4 001106   000013 115007                    CMPA    11,DL
         4 001107   001064 604400 4                  TMOZ    s:7949

      577     7953    3           DPOSN = DPOSN + 1;

   7953  4 001110   200050 235100                    LDA     DPOSN,,AUTO
         4 001111   000001 035007                    ADLA    1,DL
         4 001112   200050 755100                    STA     DPOSN,,AUTO

      578     7954
      579     7955    3           I = I+1;

   7955  4 001113   200051 054100                    AOS     I,,AUTO

      580     7956
      581     7957    3           END;                            /* DO WHILE DUMPING TCB               */

   7957  4 001114   200051 235100                    LDA     I,,AUTO
         4 001115   000446 115007                    CMPA    294,DL
         4 001116   001032 604000 4                  TMI     s:7939

      582     7958
      583     7959    2      IF DPOSN>0

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:73   
   7959  4 001117   200050 236100                    LDQ     DPOSN,,AUTO
         4 001120   001124 600000 4                  TZE     s:7964

      584     7960    3      THEN DO;

      585     7961    3           CALL M$TEMPWROC (WRITE_OC);

   7961  4 001121   004304 630400 1                  EPPR0   WRITE_OC
         4 001122   110000 713400                    CLIMB   36864
         4 001123   401000 401760                    pmme    nvectors=3

      586     7962    3           END;

      587     7963
      588     7964    2      RETURN;

   7964  4 001124   200022 221300                    LDX1  ! PCNTRL+9,,AUTO
         4 001125   000001 702211                    TSX2  ! 1,X1

      589     7965
      590     7966    2   END DUMPTCB;
      591     7967
      592     7968        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:74   
      593     7969        /**/
      594     7970        /* This routine returns our internal processor type value, based   */
      595     7971        /* on the processor flags for the indicated processor.             */
      596     7972    1   GET_PTYPE: PROC(PNUM,PTYPE);

   7972  4 001126   200022 741300       GET_PTYPE    STX1  ! PCNTRL+9,,AUTO

      597     7973    2   DCL PNUM UBIN;
      598     7974    2   DCL PTYPE UBIN;
      599     7975        /**/
      600     7976    2      PTYPE = 0;

   7976  4 001127   200024 470500                    LDP0    @PTYPE,,AUTO
         4 001130   000000 450100                    STZ     0,,PR0

      601     7977    2      IF B$P.FLGS(PNUM) & %P_CP THEN PTYPE = I_CP;

   7977  4 001131   200023 471500                    LDP1    @PNUM,,AUTO
         4 001132   100000 236100                    LDQ     0,,PR1
         4 001133   000021 402007                    MPY     17,DL
         4 001134   000001 736000                    QLS     1
         4 001135   004152 473400 1                  LDP3    P$
         4 001136   300027 220106                    LDX0    23,QL,PR3
         4 001137   400000 360003                    ANX0    -131072,DU
         4 001140   001143 600000 4                  TZE     s:7978

   7977  4 001141   000024 235007                    LDA     20,DL
         4 001142   000000 755100                    STA     0,,PR0

      602     7978    2      IF B$P.FLGS(PNUM) & %P_DB THEN PTYPE = I_DB;

   7978  4 001143   100000 236100                    LDQ     0,,PR1
         4 001144   000021 402007                    MPY     17,DL
         4 001145   000001 736000                    QLS     1
         4 001146   004152 473400 1                  LDP3    P$
         4 001147   300027 220106                    LDX0    23,QL,PR3
         4 001150   020000 360003                    ANX0    8192,DU
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:75   
         4 001151   001154 600000 4                  TZE     s:7979

   7978  4 001152   000025 235007                    LDA     21,DL
         4 001153   000000 755100                    STA     0,,PR0

      603     7979    2      IF B$P.FLGS(PNUM) & %P_ASL THEN PTYPE = I_ASL;

   7979  4 001154   100000 236100                    LDQ     0,,PR1
         4 001155   000021 402007                    MPY     17,DL
         4 001156   000001 736000                    QLS     1
         4 001157   004152 473400 1                  LDP3    P$
         4 001160   300027 220106                    LDX0    23,QL,PR3
         4 001161   200000 360003                    ANX0    65536,DU
         4 001162   001165 600000 4                  TZE     s:7980

   7979  4 001163   000026 235007                    LDA     22,DL
         4 001164   000000 755100                    STA     0,,PR0

      604     7980    2      IF B$P.FLGS(PNUM) & %P_LIB THEN PTYPE = I_LIB;

   7980  4 001165   100000 236100                    LDQ     0,,PR1
         4 001166   000021 402007                    MPY     17,DL
         4 001167   000001 736000                    QLS     1
         4 001170   004152 473400 1                  LDP3    P$
         4 001171   300027 220106                    LDX0    23,QL,PR3
         4 001172   100000 360003                    ANX0    32768,DU
         4 001173   001176 600000 4                  TZE     s:7981

   7980  4 001174   000027 235007                    LDA     23,DL
         4 001175   000000 755100                    STA     0,,PR0

      605     7981    2      RETURN;

   7981  4 001176   200022 221300                    LDX1  ! PCNTRL+9,,AUTO
         4 001177   000001 702211                    TSX2  ! 1,X1

      606     7982    2   END GET_PTYPE;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:76   
      607     7983        /**/
      608     7984        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:77   
      609     7985        /**/
      610     7986        /* Procedure for parsing the specified FID and opening M$EI to it. */
      611     7987    1   OPEN_FID: PROC(FID$) ALTRET;

   7987  4 001200   200022 741300       OPEN_FID     STX1  ! PCNTRL+9,,AUTO

      612     7988    2   DCL FID$ PTR;
      613     7989        /**/
      614     7990    2      OPEN_EI.NAME_ = VECTOR(FID$->B$TEXTC);

   7990  4 001201   200023 470500                    LDP0    @FID$,,AUTO
         4 001202   000000 471500                    LDP1    0,,PR0
         4 001203   100000 236100                    LDQ     0,,PR1
         4 001204   000033 772000                    QRL     27
         4 001205   000001 620006                    EAX0    1,QL
         4 001206   000000 635010                    EAA     0,X0
         4 001207   000002 771000                    ARL     2
         4 001210   000140 135007                    SBLA    96,DL
         4 001211   200054 451500                    STP1    J+2,,AUTO
         4 001212   200054 236100                    LDQ     J+2,,AUTO
         4 001213   004372 757000 1                  STAQ    OPEN_EI+6

      615     7991    2      CALL M$OPEN(OPEN_EI) ALTRET(NOW_WHAT);

   7991  4 001214   004364 630400 1                  EPPR0   OPEN_EI
         4 001215   450000 713400                    CLIMB   alt,open
         4 001216   410400 401760                    pmme    nvectors=18
         4 001217   001222 702000 4                  TSX2    NOW_WHAT

      616     7992    2      RETURN;

   7992  4 001220   200022 221300                    LDX1  ! PCNTRL+9,,AUTO
         4 001221   000001 702211                    TSX2  ! 1,X1

      617     7993    2   NOW_WHAT:
      618     7994    2      JITERR=B$ALT.ERR;

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:78   
   7994  4 001222   000000 470400 xsym  NOW_WHAT     LDP0    B$TCB$
         4 001223   000000 471500                    LDP1    0,,PR0
         4 001224   100102 236100                    LDQ     66,,PR1
         4 001225   004077 756000 1                  STQ     JITERR

      619     7995    2      ALTRETURN;

   7995  4 001226   200022 221300                    LDX1  ! PCNTRL+9,,AUTO
         4 001227   000000 702211                    TSX2  ! 0,X1

      620     7996    2   END OPEN_FID;
      621     7997        /**/
      622     7998        %EJECT;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:79   
      623     7999        /* Routine to get the processor's modification date from the FIT. */
      624     8000    1   GET_MODTIME: PROC(DATE) ALTRET;

   8000  4 001230   200022 741300       GET_MODTIME  STX1  ! PCNTRL+9,,AUTO

      625     8001    2   DCL DATE UBIN;
      626     8002    2   DCL J SBIN;
      627     8003    2   DCL CODE4$ PTR;
      628     8004        /**/
      629     8005    3      DO J = 1 TO FM$FIT.CODES.CODE(0);

   8005  4 001231   000001 235007                    LDA     1,DL
         4 001232   200024 755100                    STA     J,,AUTO
         4 001233   001256 710000 4                  TRA     s:8012+1

      630     8006    3           IF FM$FIT.CODES.CODE(J) = 4 THEN

   8006  4 001234   004100 470400 1                  LDP0    FIT$
         4 001235   200024 720100                    LXL0    J,,AUTO
         4 001236   000000 236110                    LDQ     0,X0,PR0
         4 001237   760000 376003                    ANQ     -8192,DU
         4 001240   100000 116003                    CMPQ    32768,DU
         4 001241   001255 601000 4                  TNZ     s:8012

      631     8007    4           DO;

      632     8008    4                CODE4$ = PINCRW(FIT$,FM$FIT.CODES.ITEMX(J));

   8008  4 001242   000000 721110                    LXL1    0,X0,PR0
         4 001243   001777 361003                    ANX1    1023,DU
         4 001244   000000 636011                    EAQ     0,X1
         4 001245   004100 036000 1                  ADLQ    FIT$
         4 001246   200025 756100                    STQ     CODE4$,,AUTO

      633     8009    4                DATE = CODE4$->CODE04.MODIFY.TIME;

   8009  4 001247   200025 471500                    LDP1    CODE4$,,AUTO
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:80   
         4 001250   200023 473500                    LDP3    @DATE,,AUTO
         4 001251   100001 235100                    LDA     1,,PR1
         4 001252   300000 755100                    STA     0,,PR3

      634     8010    4                RETURN;

   8010  4 001253   200022 221300                    LDX1  ! PCNTRL+9,,AUTO
         4 001254   000001 702211                    TSX2  ! 1,X1

      635     8011    4                END;
      636     8012    3           END;

   8012  4 001255   200024 054100                    AOS     J,,AUTO
         4 001256   004100 470400 1                  LDP0    FIT$
         4 001257   000000 236100                    LDQ     0,,PR0
         4 001260   000037 772000                    QRL     31
         4 001261   200024 116100                    CMPQ    J,,AUTO
         4 001262   001234 605000 4                  TPL     s:8006

      637     8013        /*E*    ERROR:  IGS-E$IP_BADFIT-0
      638     8014                MESSAGE: Unable to locate creation date/time in file's FIT. */
      639     8015    2      JITERR.CODE = E$IP_BADFIT;

   8015  4 001263   004077 236000 1                  LDQ     JITERR
         4 001264   000046 376000 5                  ANQ     38
         4 001265   001640 276007                    ORQ     928,DL
         4 001266   004077 756000 1                  STQ     JITERR

      640     8016    2      ALTRETURN;

   8016  4 001267   200022 221300                    LDX1  ! PCNTRL+9,,AUTO
         4 001270   000000 702211                    TSX2  ! 0,X1
      641     8017    2   END GET_MODTIME;
      642     8018        /**/
      643     8019        /**/
      644     8020    1   END IGS$SYSMAK;
      645     8021        %EOD;
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:81   

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:82   
--  Include file information  --

   M$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   IPS_SUBS_C.:E05TOU  is referenced.
   IP_PERR_C.:E05TOU  is referenced.
   I_SUBS_C.:E05TOU  is referenced.
   FM$FIT.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$OBJECT_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure IGS$SYSMAK.
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:83   

 **** Variables and constants ****

  ****  Section 001  Data  IGS$SYSMAK

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  5072-0-0/d STRC(360)   r     1 ALIB_DELTA              4144-0-0/w PTR         r     1 BUF$
  5032-0-0/d STRC(1080)  r     1 CLOSE_EI                4550-0-0/d STRC(2088)  r     1 DELETE_RUM
  5104-0-0/d STRC(72)    r     1 DLIB_DELTA              4150-0-0/w PTR         r     1 EI$
  4106-0-0/d CHAR        r     1 ERRMSG(0:119)           4106-0-0/d CHAR(120)   r     1 ERRMSGBUF
  4456-0-0/d STRC(2088)  r     1 FIND_RUM                4100-0-0/w PTR         r     1 FIT$
     0-0-0/d UBIN        r     1 FITBUF(0:1023)          4324-0-0/d STRC(936)   r     1 FPT_ERRMSG
  4151-0-0/w PTR         r     1 HEAD$                   4000-0-0/d UBIN        r     1 HEADBUF(0:24)
  4074-0-0/c STRC(45)    r     1 HEAD_KEY                4104-0-0/d REMB        r     1 IGS_UNWIND
  4356-0-0/d STRC(216)   r     1 IGS_XCON                4077-0-0/b STRC        r     1 JITERR
  4155-0-0/w UBIN        r     1 MAXPROCS                4772-0-0/w STRC(126)   r     1 NEW_ACCESS
  4154-0-0/w UBIN        r     1 NPROCS                  4156-0-0/w UBIN        r     1 NSCPU
  4314-0-0/d STRC(288)   r     1 OC_CRLF                 4364-0-0/d STRC(2088)  r     1 OPEN_EI
  4152-0-0/w PTR         r     1 P$                      4064-0-0/w STRC(288)   r     1 PCNTRL_INIT
  4776-0-0/w STRC(72)    r     1 PF_NEW_NAME             4147-0-0/w PTR         r     1 PGTBL$
  4102-0-0/d BIT (72)    r     1 PREVXCON                5106-0-0/d STRC(720)   r     1 PRINT_DO
  5014-0-0/d STRC(504)   r     1 READ_HEAD               4734-0-0/d STRC(1080)  r     1 RENAME_RUM
  5000-0-0/w STRC(54)    r     1 RF_NEW_NAME             4146-0-0/w PTR         r     1 ROSEG$
  4171-0-0/c STRC(126)   r     1 RUM_CMD                 5002-0-0/c STRC(288)   r     1 RU_NAME
  4157-0-0/w UBIN        r     1 SCPUWSPTD(0:7)
  4062-0-0/d STRC(72)    r     1 STLVEC                  5012-0-0/c STRC(72)    r     1 SYS_ACCT
  4301-0-0/c STRC(54)    r     1 TC_DELTA                4275-0-0/c STRC(54)    r     1 TC_FREE
  4076-0-0/c CHAR        r     1 T_CRLF(0:1)             4254-0-0/c CHAR(56)    r     1 T_DELTAERR
  4243-0-0/c CHAR        r     1 T_DONERUMMSG            4213-0-0/c CHAR(41)    r     1 T_NODELTA
  4204-0-0/c CHAR(26)    r     1 T_NORUMS                4175-0-0/c CHAR(28)    r     1 T_PROCMSG
  4234-0-0/c CHAR(28)    r     1 T_RUMMSG                4226-0-0/c CHAR(22)    r     1 T_XCON
  4642-0-0/d STRC(2088)  r     1 UPDATE_RUM              4304-0-0/d STRC(288)   r     1 WRITE_OC
  4145-0-0/w PTR         r     1 WSPTD$

  ****  Section 002 RoData IGS$SYSMAK

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:84   
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 JITERR_INIT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    23-0-0/w PTR         r     1 @DATE                     23-0-0/w PTR         r     1 @FID$
    23-0-0/w PTR         r     1 @PNUM                     23-0-0/w PTR         r     1 @PNUM
    24-0-0/w PTR         r     1 @PTYPE                    25-0-0/w PTR         r     1 CODE4$
    *0-0-0/w UBIN        r     1 DATE                      50-0-0/w UBIN        r     1 DPOSN
    *0-0-0/w PTR         r     1 FID$                       3-0-0/w SBIN        r     1 I
    51-0-0/w SBIN        r     1 I                         52-0-0/w SBIN        r     1 J
    24-0-0/w SBIN        r     1 J                         23-0-0/c CHAR(80)    r     1 OUTBUF
    11-0-0/w STRC(288)   r     1 PCNTRL                     5-0-0/w UBIN        r     1 PNUM
    *0-0-0/w UBIN        r     1 PNUM                      *0-0-0/w UBIN        r     1 PNUM
     6-0-0/w UBIN        r     1 PTYPE                     *0-0-0/w UBIN        r     1 PTYPE
    47-0-0/b BIT         r     1 TEMPW                     47-0-0/w UBIN        r     1 TEMPWU

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$IS$                      0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 B$P$                       0-0-0/w PTR         r     1 B$TCB$
     0-0-0/w UBIN        r     1 IG_BOOTFLAG
     0-0-0/w UBIN        r     1 IT_SCPUWSPTD(0:3)
     0-0-0/w UBIN        r     1 P_MAXPROCS                 0-0-0/c STRC(63)    r     1 P_NAME
     0-0-0/w UBIN        r     1 P_NPROCS                   0-0-0/c STRC(45)    r     1 RF_NAME
     0-0-0/w UBIN        r     1 S_NSCPU

  ****  BASED and DCB variables  ****

PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:85   
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(1440)  r     1 B$HEAD
     0-0-0/d STRC(1224)  r     1 B$P(0:0)                   0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/w ASTR(9)     r     1 B$TEXTC                    0-0-0/w STRC(2448)  r     1 B$XCON
     0-0-0/w STRC(396)   r     1 CODE04                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(1116)  r     1 FM$FIT                     0-0-0N  NULL        r     1 M$EI
     0-0-0/b BIT         r     1 TEMPWB


   Procedure IGS$SYSMAK requires 697 words for executable code.
   Procedure IGS$SYSMAK requires 48 words of local(AUTO) storage.
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:86   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:87   
          MINI XREF LISTING

ALIB_DELTA
      7621**DCL      7727<>CALL
ALIB_DELTA.V
      7622**DCL      7622--DCLINIT
B$ALT.CODE
      6491**DCL      6491--REDEF    6492--REDEF    6492--REDEF
B$ALT.ERR
      6492**DCL      7762>>ASSIGN   7766>>ASSIGN   7994>>ASSIGN
B$ALT.ERR.CODE
      6493**DCL      7753>>IF
B$ALT.ERR.ERR#
      6493**DCL      6493--REDEF    7728>>IF
B$ALT.EVID
      6492**DCL      6492--REDEF    6492--REDEF
B$HEAD
      6548**DCL      7814--IF
B$HEAD.ASL
      6680**DCL      7844>>IF
B$HEAD.FLAVOR
      6673**DCL      7826>>IF
B$HEAD.LIB
      6678**DCL      7844>>IF
B$HEAD.OVRL
      6687**DCL      7835>>IF
B$HEAD.RDATA
      6567**DCL      7835>>IF
B$HEAD.ROSIZE
      6626**DCL      7835>>IF
B$IS$
      6509**DCL      7684>>ASSIGN   7685>>ASSIGN   7686>>ASSIGN   7687>>ASSIGN
B$JIT.ERR.MID
      6210**DCL      6210--REDEF
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:88   
B$JIT.JRESPEAK
      6300**DCL      6301--REDEF
B$JIT$
      6508**DCL      6204--IMP-PTR
B$P.FLGS
      5152**DCL      7916>>ASSIGN   7977>>IF       7978>>IF       7979>>IF       7980>>IF
B$P.NAME
      5155**DCL      7914--ASSIGN   7915--ASSIGN
B$P.NAME.TEXT
      5157**DCL      7805>>IF       7883--ASSIGN
B$P$
      5185**DCL      7681<>CALL
B$TCB.ALT$
      6487**DCL      7728>>IF       7753>>IF       7762>>ASSIGN   7766>>ASSIGN   7994>>ASSIGN
B$TCB.STK$
      6487**DCL      7774>>ASSIGN
B$TCB$
      6510**DCL      7728>>IF       7753>>IF       7762>>ASSIGN   7766>>ASSIGN   7774>>ASSIGN   7939>>ASSIGN
      7994>>ASSIGN
B$TEXTC
      6483**DCL      7990--ASSIGN
B$TEXTC.COUNT
      6484**DCL      6485--IMP-SIZ  7990>>ASSIGN
B$XCON.ERR
      6504**DCL      7774>>ASSIGN
B$XCON.ERR.ERR#
      6504**DCL      6504--REDEF
B$XCON.LIMIT.MEM
      6502**DCL      6502--REDEF
BLACK_WIDOW
      7864**LABEL    7719--CALLALT  7720--CALLALT  7811--CALLALT  7812--CALLALT  7823--GOTO     7832--GOTO
      7842--GOTO     7851--GOTO     7855--CALLALT  7857--CALLALT  7893--GOTO
BORSCHT
      7794**LABEL    7796--CALLALT
BUF$
      6444**DCL      7684<<ASSIGN
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:89   
BUILD_PCNTRL
      7910**PROC     7712--CALL     7808--CALL
CLOSE_EI
      7574**DCL      7721<>CALL     7896<>CALL
CLOSE_EI.SN_
      7574**DCL      7574--REDEF
CLOSE_EI.UTL_
      7575**DCL      7575--REDEF
CLOSE_EI.V
      7579**DCL      7574--DCLINIT
CLOSE_EI.V.EXPIRE#
      7589**DCL      7589--REDEF
CLOSE_EI.V.TYPE#
      7587**DCL      7587--REDEF
CLOSE_EI.V.XTNSIZE#
      7584**DCL      7584--REDEF    7586--REDEF
CODE04.MODIFY.TIME
      6758**DCL      8009>>ASSIGN
CODE4$ IN PROCEDURE GET_MODTIME
      8003**DCL      8008<<ASSIGN   8009>>ASSIGN
CONT
      7898**LABEL    7896--CALLALT
DATE IN PROCEDURE GET_MODTIME
      8001**DCL      8000--PROC     8009<<ASSIGN
DELETE_RUM
      7215**DCL      7695<>CALL     7746<>CALL
DELETE_RUM.ACSVEH_
      7217**DCL      7218--REDEF
DELETE_RUM.ALTKEYS_
      7223**DCL      7224--REDEF    7224--REDEF
DELETE_RUM.HDR_
      7222**DCL      7223--REDEF
DELETE_RUM.NAME_
      7216**DCL      7743<<ASSIGN
DELETE_RUM.TAB_
      7221**DCL      7222--REDEF
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:90   
DELETE_RUM.UHL_
      7215**DCL      7216--REDEF    7216--REDEF
DELETE_RUM.V
      7224**DCL      7215--DCLINIT
DELETE_RUM.V.FSN#
      7255**DCL      7255--REDEF    7255--REDEF
DELETE_RUM.WSN_
      7221**DCL      7221--REDEF
DELTA_XCON
      7774**LABEL    7705--REMEMBR
DELTA_XCON2
      7777**LABEL    7775--CALLALT
DLIB_DELTA
      7639**DCL      7733<>CALL
DONE
      7874**LABEL    7871--GOTO     7872--GOTO
DPOSN IN PROCEDURE DUMPTCB
      7929**DCL      7933<<ASSIGN   7940>>IF       7944<<ASSIGN   7946>>CALLBLT  7947<<ASSIGN   7947>>ASSIGN
      7949>>CALLBLT  7953<<ASSIGN   7953>>ASSIGN   7959>>IF
DUMPTCB
      7922**PROC     7781--CALL
EH
      7734**LABEL    7733--CALLALT
EI$
      6448**DCL      7688<<ASSIGN
ERRMSG
      6443**DCL      7872>>IF
ERRMSGBUF
      6442**DCL      6443--REDEF    6877--DCLINIT  7787--ASSIGN   7867--ASSIGN
F$DCB.ACTPOS
      5861**DCL      5861--REDEF
F$DCB.ARS#
      5835**DCL      5835--REDEF    7814>>IF
F$DCB.ATTR
      5854**DCL      5855--REDEF
F$DCB.BORROW
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:91   
      5869**DCL      5869--REDEF    5869--REDEF    5869--REDEF
F$DCB.DCBNAME.L
      5883**DCL      5883--IMP-SIZ
F$DCB.EOMCHAR#
      5839**DCL      5839--REDEF
F$DCB.FLDID
      5864**DCL      5864--REDEF
F$DCB.FORM$
      5858**DCL      5858--REDEF
F$DCB.FSECT
      5874**DCL      5874--REDEF
F$DCB.FSN#
      5851**DCL      5851--REDEF    5851--REDEF    5852--REDEF
F$DCB.HEADER$
      5857**DCL      5857--REDEF
F$DCB.IXTNSIZE#
      5855**DCL      5855--REDEF
F$DCB.LASTSTA$
      5844**DCL      5844--REDEF
F$DCB.LVL
      5870**DCL      5870--REDEF
F$DCB.NAME#.C
      5845**DCL      5845--REDEF
F$DCB.NOEOF
      5867**DCL      5867--REDEF
F$DCB.NRECS#
      5856**DCL      5856--REDEF
F$DCB.NRECX
      5875**DCL      5875--REDEF
F$DCB.OHDR
      5867**DCL      5867--REDEF
F$DCB.ORG#
      5850**DCL      5850--REDEF
F$DCB.PRECNO
      5873**DCL      5873--REDEF
F$DCB.RCSZ
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:92   
      5879**DCL      5879--REDEF
F$DCB.RES#
      5846**DCL      5846--REDEF
F$DCB.SETX
      5858**DCL      5858--REDEF
F$DCB.TAB$
      5858**DCL      5858--REDEF
F$DCB.TDA
      5872**DCL      5873--REDEF
F$DCB.WSN#
      5846**DCL      5846--REDEF
FID$ IN PROCEDURE OPEN_FID
      7988**DCL      7987--PROC     7990>>ASSIGN   7990>>ASSIGN
FIND_RUM
      7098**DCL      7710<>CALL
FIND_RUM.ACSVEH_
      7100**DCL      7101--REDEF
FIND_RUM.ALTKEYS_
      7106**DCL      7107--REDEF    7107--REDEF
FIND_RUM.HDR_
      7105**DCL      7106--REDEF
FIND_RUM.TAB_
      7104**DCL      7105--REDEF
FIND_RUM.UHL_
      7098**DCL      7099--REDEF    7099--REDEF
FIND_RUM.V
      7107**DCL      7098--DCLINIT
FIND_RUM.V.FSN#
      7138**DCL      7138--REDEF    7138--REDEF
FIND_RUM.WSN_
      7104**DCL      7104--REDEF
FIRST_PATCH
      7695**LABEL    7695--CALLALT
FIRST_RUM
      7745**LABEL    7746--CALLALT
FIT$
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:93   
      6438**DCL      8005>>DOINDEX  8006>>IF       8008>>ASSIGN   8008>>ASSIGN
FITBUF
      6404**DCL      6438--DCLINIT  6987--DCLINIT
FM$FIT.CODES.CODE
      6762**DCL      8005>>DOINDEX  8006>>IF
FM$FIT.CODES.ITEMX
      6762**DCL      8008>>ASSIGN
FPT_ERRMSG
      6876**DCL      7785<>CALL     7866<>CALL
FPT_ERRMSG.V
      6880**DCL      6876--DCLINIT
GET_MODTIME
      8000**PROC     7716--CALL     7812--CALL
GET_PTYPE
      7972**PROC     7713--CALL     7809--CALL
HEAD$
      6449**DCL      7814>>IF       7826>>IF       7835>>IF       7835>>IF       7835>>IF       7844>>IF
      7844>>IF
HEADBUF
      6405**DCL      6449--DCLINIT  7529--DCLINIT  7530--DCLINIT
HEAD_KEY
      6422**DCL      7527--DCLINIT  7528--DCLINIT
I
      6462**DCL      7678<<DOINDEX  7679>>CALL     7679>>CALL     7869<<ASSIGN   7870<<ASSIGN   7870>>ASSIGN
      7871>>IF       7872>>IF       7874>>ASSIGN
I IN PROCEDURE DUMPTCB
      7930**DCL      7934<<ASSIGN   7938>>DOWHILE  7939>>ASSIGN   7955<<ASSIGN   7955>>ASSIGN
IGS$XCON
      6530**DCL-ENT  6906--DCLINIT
IGS_UNWIND
      6441**DCL      7705<<REMEMBR
IGS_XCON
      6905**DCL      7706<>CALL     7795<>CALL
IGS_XCON.PXCON_
      6905**DCL      7794<<ASSIGN
IGS_XCON.V
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:94   
      6906**DCL      6905--DCLINIT
IGS_XCON.V_
      6905**DCL      7793<<ASSIGN
IG_BOOTFLAG
      6513**DCL      7691>>IF       7691>>IF
INSTALL_EM
      7783**LABEL    7748--CALLALT  7749--CALLALT  7750--GOTO     7759--GOTO
IPC$ADD_LIB
      6525**DCL-ENT  7720--CALL     7857--CALL
IPC$ADD_SPCL
      6524**DCL-ENT  7719--CALL     7855--CALL
IPD$FREE_PROC
      6526**DCL-ENT  7736--CALL
IPD$MON_VALUE
      6527**DCL-ENT  7675--CALL     7676--CALL     7677--CALL     7679--CALL     7681--CALL
IPD$SETSEG
      6529**DCL-ENT  7682--CALL
IT_SCPUWSPTD
      6512**DCL      7679<>CALL
J IN PROCEDURE DUMPTCB
      7931**DCL      7948<<DOINDEX  7949>>CALLBLT
J IN PROCEDURE GET_MODTIME
      8002**DCL      8005<<DOINDEX  8006>>IF       8008>>ASSIGN
JITERR
      6426**DCL      6876--DCLINIT  7673<<ASSIGN   7708<<ASSIGN   7719<>CALL     7720<>CALL     7762<<ASSIGN
      7766<<ASSIGN   7774<<ASSIGN   7790<<ASSIGN   7804<<ASSIGN   7855<>CALL     7857<>CALL     7994<<ASSIGN
JITERR.CODE
      6430**DCL      7783>>IF       7822<<ASSIGN   7831<<ASSIGN   7841<<ASSIGN   7850<<ASSIGN   7861<<ASSIGN
      7864>>IF       7892<<ASSIGN   8015<<ASSIGN
JITERR.FCG
      6427**DCL      7878>>IF       7878>>IF
JITERR_INIT
      6432**DCL      7673>>ASSIGN   7708>>ASSIGN   7790>>ASSIGN   7804>>ASSIGN
LOOP_END
      7896**LABEL    7866--CALLALT  7887--GOTO
M$ALIB
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:95   
      5229**DCL-ENT  7727--CALL
M$CLOSE
      5216**DCL-ENT  7698--CALL     7721--CALL     7749--CALL     7896--CALL
M$CLRSTK
      5274**DCL-ENT  7775--CALL
M$DLIB
      5229**DCL-ENT  7733--CALL
M$EI
      6522**DCL      7688--ASSIGN   7814--IF
M$ERRMSG
      5279**DCL-ENT  7785--CALL     7866--CALL
M$LDEV
      5216**DCL-ENT  7796--CALL
M$OPEN
      5216**DCL-ENT  7695--CALL     7697--CALL     7710--CALL     7746--CALL     7748--CALL     7991--CALL
M$READ
      5217**DCL-ENT  7717--CALL     7813--CALL
M$TEMPWROC
      5260**DCL-ENT  7724--CALL     7726--CALL     7729--CALL     7731--CALL     7739--CALL     7741--CALL
      7756--CALL     7758--CALL     7769--CALL     7771--CALL     7777--CALL     7780--CALL     7788--CALL
      7789--CALL     7875--CALL     7876--CALL     7880--CALL     7882--CALL     7884--CALL     7942--CALL
      7961--CALL
M$XCON
      5271**DCL-ENT  7706--CALL     7795--CALL
MAXPROCS
      6453**DCL      7676<>CALL
NEW_ACCESS
      7435**DCL      7406--DCLINIT
NEW_ACCESS.Q
      7436**DCL      7435--DCLINIT
NOW_WHAT IN PROCEDURE OPEN_FID
      7994**LABEL    7991--CALLALT
NO_DELTA
      7762**LABEL    7717--CALLALT  7721--CALLALT  7728--GOTO
NO_DELTA2
      7769**LABEL    7715--CALLALT  7716--CALLALT
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:96   
NO_HEAD
      7887**LABEL    7813--CALLALT
NO_RUMF
      7753**LABEL    7710--CALLALT
NPROCS
      6452**DCL      7675<>CALL     7803>>DOINDEX
NSCPU
      6454**DCL      7677<>CALL     7678>>DOINDEX
NXTB
      7870**LABEL    7873--GOTO
OC_CRLF
      6855**DCL      7724<>CALL     7729<>CALL     7739<>CALL     7756<>CALL     7769<>CALL     7777<>CALL
      7788<>CALL     7875<>CALL     7880<>CALL
OC_CRLF.V
      6858**DCL      6855--DCLINIT
OPEN_EI
      6982**DCL      7991<>CALL
OPEN_EI.ACSVEH_
      6984**DCL      6985--REDEF
OPEN_EI.ALTKEYS_
      6990**DCL      6991--REDEF    6991--REDEF
OPEN_EI.HDR_
      6989**DCL      6990--REDEF
OPEN_EI.NAME_
      6983**DCL      7990<<ASSIGN
OPEN_EI.TAB_
      6988**DCL      6989--REDEF
OPEN_EI.UHL_
      6982**DCL      6983--REDEF    6983--REDEF
OPEN_EI.V
      6991**DCL      6982--DCLINIT
OPEN_EI.V.FSN#
      7022**DCL      7022--REDEF    7022--REDEF
OPEN_EI.WSN_
      6988**DCL      6988--REDEF
OPEN_FID
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:97   
      7987**PROC     7715--CALL     7811--CALL
OUTBUF IN PROCEDURE DUMPTCB
      7924**DCL      7935<<ASSIGN   7936--ASSIGN   7943<<ASSIGN   7946<<CALLBLT  7949<<CALLBLT
P$
      6450**DCL      7681<>CALL     7682<>CALL     7805>>IF       7883>>ASSIGN   7914>>ASSIGN   7915>>ASSIGN
      7916>>ASSIGN   7977>>IF       7978>>IF       7979>>IF       7980>>IF
PCNTRL
      6468**DCL      7719<>CALL     7720<>CALL     7855<>CALL     7857<>CALL     7913<<ASSIGN
PCNTRL.FID$
      6476**DCL      7715<>CALL     7811<>CALL     7915<<ASSIGN
PCNTRL.MODTIME
      6477**DCL      7716<>CALL     7812<>CALL
PCNTRL.PFLGS
      6480**DCL      7916<<ASSIGN
PCNTRL.PNAME$
      6470**DCL      7914<<ASSIGN
PCNTRL.PNUM
      6478**DCL      7917<<ASSIGN
PCNTRL.PTYPE
      6472**DCL      7714<<ASSIGN   7810<<ASSIGN   7835>>IF       7835>>IF       7844>>IF       7844>>IF
      7854>>IF       7854>>IF       7856>>IF
PCNTRL_INIT
      6409**DCL      7913>>ASSIGN
PF_NEW_NAME
      7456**DCL      7216--DCLINIT  7406--DCLINIT
PGTBL$
      6447**DCL      7687<<ASSIGN
PNUM
      6464**DCL      7711<<DOINDEX  7712<>CALL     7713<>CALL     7718>>IF       7719<>CALL     7720<>CALL
      7734<<DOINDEX  7736<>CALL     7803<<DOINDEX  7805>>IF       7808<>CALL     7809<>CALL     7855<>CALL
      7857<>CALL     7883>>ASSIGN
PNUM IN PROCEDURE BUILD_PCNTRL
      7911**DCL      7910--PROC     7914>>ASSIGN   7915>>ASSIGN   7916>>ASSIGN   7917>>ASSIGN
PNUM IN PROCEDURE GET_PTYPE
      7973**DCL      7972--PROC     7977>>IF       7978>>IF       7979>>IF       7980>>IF
PREVXCON
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:98   
      6439**DCL      6905--DCLINIT  7793--ASSIGN
PRINT_DO
      7655**DCL      7796<>CALL
PRINT_DO.V
      7657**DCL      7655--DCLINIT
PRINT_ERR
      7783**LABEL    7763--GOTO     7772--GOTO
PTYPE
      6465**DCL      7713<>CALL     7714>>ASSIGN   7809<>CALL     7810>>ASSIGN
PTYPE IN PROCEDURE GET_PTYPE
      7974**DCL      7972--PROC     7976<<ASSIGN   7977<<ASSIGN   7978<<ASSIGN   7979<<ASSIGN   7980<<ASSIGN
P_MAXPROCS
      5179**DCL      7676<>CALL
P_NAME
      6515**DCL      7332--DCLINIT
P_NPROCS
      5178**DCL      7675<>CALL
READ_HEAD
      7527**DCL      7717<>CALL     7813<>CALL
READ_HEAD.STATION_
      7530**DCL      7531--REDEF
READ_HEAD.V
      7531**DCL      7527--DCLINIT
READ_HEAD.V.DVBYTE.REREAD#
      7542**DCL      7542--REDEF
READ_HEAD.V.INDX#
      7540**DCL      7540--REDEF
RENAME_RUM
      7404**DCL      7698<>CALL     7749<>CALL
RENAME_RUM.NAME_
      7405**DCL      7745<<ASSIGN
RENAME_RUM.SN_
      7404**DCL      7404--REDEF
RENAME_RUM.UTL_
      7405**DCL      7405--REDEF
RENAME_RUM.V
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:99   
      7409**DCL      7404--DCLINIT
RENAME_RUM.V.EXPIRE#
      7419**DCL      7419--REDEF
RENAME_RUM.V.TYPE#
      7417**DCL      7417--REDEF
RENAME_RUM.V.XTNSIZE#
      7414**DCL      7414--REDEF    7416--REDEF
RF_NAME
      6518**DCL      7099--DCLINIT  7744--ASSIGN
RF_NAME.TEXT
      6520**DCL      7709>>ASSIGN
RF_NEW_NAME
      7460**DCL      7743--ASSIGN   7745--ASSIGN
ROSEG$
      6446**DCL      7686<<ASSIGN
RUM_CMD
      6457**DCL      7621--DCLINIT
RUM_CMD.FID
      6459**DCL      7709<<ASSIGN
RU_NAME
      7489**DCL      6983--DCLINIT
SCPUWSPTD
      6455**DCL      7679<>CALL
SKIP_IT
      7708**LABEL    7706--CALLALT
SKIP_IT2
      7796**LABEL    7795--CALLALT
STLVEC
      6406**DCL      7604--DCLINIT
SYS_ACCT
      7503**DCL      6412--DCLINIT  6987--DCLINIT  7103--DCLINIT  7220--DCLINIT  7336--DCLINIT
S_NSCPU
      6511**DCL      7677<>CALL
TC_DELTA
      6819**DCL      7621--DCLINIT  7639--DCLINIT
TC_FREE.TEXT
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:100  
      6811**DCL      7805>>IF
TEMPW IN PROCEDURE DUMPTCB
      7926**DCL      7927--REDEF    7939<<ASSIGN   7949>>CALLBLT
TEMPWB IN PROCEDURE DUMPTCB
      7928**DCL      7939>>ASSIGN
TEMPWU IN PROCEDURE DUMPTCB
      7927**DCL      7951<<ASSIGN   7951>>ASSIGN
T_CRLF
      6425**DCL      6855--DCLINIT  6856--DCLINIT
T_DELTAERR
      6801**DCL      7730--ASSIGN
T_DONERUMMSG
      6797**DCL      7740--ASSIGN
T_NODELTA
      6784**DCL      7770--ASSIGN
T_NORUMS
      6780**DCL      7757--ASSIGN
T_PROCMSG
      6776**DCL      7881--ASSIGN
T_RUMMSG
      6793**DCL      7725--ASSIGN
T_XCON
      6789**DCL      7778--ASSIGN
UPDATE_RUM
      7331**DCL      7697<>CALL     7748<>CALL
UPDATE_RUM.ACSVEH_
      7333**DCL      7334--REDEF
UPDATE_RUM.ALTKEYS_
      7339**DCL      7340--REDEF    7340--REDEF
UPDATE_RUM.HDR_
      7338**DCL      7339--REDEF
UPDATE_RUM.NAME_
      7332**DCL      7744<<ASSIGN
UPDATE_RUM.TAB_
      7337**DCL      7338--REDEF
UPDATE_RUM.UHL_
PL6.E3A0      #001=IGS$SYSMAK File=IPS$SYSMAK.:E05TSI                            TUE 07/29/97 22:41 Page:101  
      7331**DCL      7332--REDEF    7332--REDEF
UPDATE_RUM.V
      7340**DCL      7331--DCLINIT
UPDATE_RUM.V.FSN#
      7371**DCL      7371--REDEF    7371--REDEF
UPDATE_RUM.WSN_
      7337**DCL      7337--REDEF
WHO_CARES
      7695**LABEL    7697--CALLALT  7698--CALLALT
WOOPS
      7787**LABEL    7785--CALLALT
WRITE_OC
      6838**DCL      7726<>CALL     7731<>CALL     7741<>CALL     7758<>CALL     7771<>CALL     7780<>CALL
      7789<>CALL     7876<>CALL     7882<>CALL     7884<>CALL     7942<>CALL     7961<>CALL
WRITE_OC.BUFW_
      6838**DCL      7725<<ASSIGN   7730<<ASSIGN   7740<<ASSIGN   7757<<ASSIGN   7770<<ASSIGN   7778<<ASSIGN
      7787<<ASSIGN   7867<<ASSIGN   7881<<ASSIGN   7883<<ASSIGN   7936<<ASSIGN
WRITE_OC.BUFW_.BOUND
      6838**DCL      7874<<ASSIGN
WRITE_OC.V
      6841**DCL      6838--DCLINIT
WSPTD$
      6445**DCL      7685<<ASSIGN

PL6.E3A0      #002=IGS$XCON File=IPS$SYSMAK.:E05TSI                              TUE 07/29/97 22:42 Page:102  
      646        1        /*T***********************************************************/
      647        2        /*T*                                                         */
      648        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      649        4        /*T*                                                         */
      650        5        /*T***********************************************************/
      651        6        IGS$XCON: PROC ASYNC;
      652        7    1   DCL IGS_UNWIND REMEMBER DALIGNED SYMREF;
      653        8    1      UNWIND TO IGS_UNWIND;
      654        9    1   END IGS$XCON;

PL6.E3A0      #002=IGS$XCON File=IPS$SYSMAK.:E05TSI                              TUE 07/29/97 22:42 Page:103  
--  Include file information  --

   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure IGS$XCON.

   Procedure IGS$XCON requires 5 words for executable code.
   Procedure IGS$XCON requires 4 words of local(AUTO) storage.

    No errors detected in file IPS$SYSMAK.:E05TSI    .

PL6.E3A0      #002=IGS$XCON File=IPS$SYSMAK.:E05TSI                              TUE 07/29/97 22:42 Page:104  

 Object Unit name= IGS$XCON                                   File name= IPS$SYSMAK.:E05TOU
 UTS= JUL 29 '97 22:42:33.08 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none     5      5  IGS$XCON

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes     Async       0  IGS$XCON

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AAUTO
                       nStd      0 X66_AAUNWIND

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     IGS_UNWIND
PL6.E3A0      #002=IGS$XCON File=IPS$SYSMAK.:E05TSI                              TUE 07/29/97 22:42 Page:105  


      646        1        /*T***********************************************************/
      647        2        /*T*                                                         */
      648        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      649        4        /*T*                                                         */
      650        5        /*T***********************************************************/
      651        6        IGS$XCON: PROC ASYNC;

      6  0 000000   000000 700200 xent  IGS$XCON     TSX0  ! X66_AAUTO
         0 000001   000004 000000                    ZERO    4,0

      652        7    1   DCL IGS_UNWIND REMEMBER DALIGNED SYMREF;
      653        8    1      UNWIND TO IGS_UNWIND;

      8  0 000002   000000 237200 xsym               LDAQ  ! IGS_UNWIND
         0 000003   000000 700200 xent               TSX0  ! X66_AAUNWIND
         0 000004   000000 000200                    ZERO    0,128
      654        9    1   END IGS$XCON;

PL6.E3A0      #002=IGS$XCON File=IPS$SYSMAK.:E05TSI                              TUE 07/29/97 22:42 Page:106  
--  Include file information  --

   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure IGS$XCON.
PL6.E3A0      #002=IGS$XCON File=IPS$SYSMAK.:E05TSI                              TUE 07/29/97 22:42 Page:107  

 **** Variables and constants ****

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d REMB        r     1 IGS_UNWIND


   Procedure IGS$XCON requires 5 words for executable code.
   Procedure IGS$XCON requires 4 words of local(AUTO) storage.

    No errors detected in file IPS$SYSMAK.:E05TSI    .
PL6.E3A0      #002=IGS$XCON File=IPS$SYSMAK.:E05TSI                              TUE 07/29/97 22:42 Page:108  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=IGS$XCON File=IPS$SYSMAK.:E05TSI                              TUE 07/29/97 22:42 Page:109  
          MINI XREF LISTING

IGS_UNWIND
         7**DCL         8>>UNWIND
