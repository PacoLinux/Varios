VERSION E05

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:1    
        1        1        /*T***********************************************************/
        2        2        /*T*                                                         */
        3        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        4        4        /*T*                                                         */
        5        5        /*T***********************************************************/
        6        6        /*P*
        7        7             NAME: KXV$VCVDH
        8        8             PURPOSE: Pcket level interface code.
        9        9                      Basically it is a transparent data transfer service
       10       10                      over an x.25 virtual circuit for host applications.
       11       11        */
       12       12        /*X*   PLM = 4, IND=3, CTI=3, DCI=6, IAD=0, DTI=6, AND=Y, CSI=3, THI=3, STI=3, DMC=Y
                12         */
       13       13        KXV$VCVDH: PROC ( FPT_X25 ) ALTRET;
       14       14
       15       15        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:2    
       16       16
       17       17        /*****************************************************************
       18       18        *                                                                *
       19       19        *                           Include files                        *
       20       20        *                                                                *
       21       21        *****************************************************************/
       22       22
       23       23        %INCLUDE LCP_6;
       24     4302        %INCLUDE G_JIT_M;
       25     4567        %INCLUDE KHA_FNC_E;
       26     4667        %INCLUDE KH_MACRO_C;
       27     5410        %INCLUDE KX_DATA_C;
       28     5478        %INCLUDE KX_PERR_C;
       29     5607        %INCLUDE KX_SCODE_C;
       30     5673        %INCLUDE KX_MACROS_M;
       31     6444        %INCLUDE KXX_MACROS_M;
       32     6786        %INCLUDE KX_EQUS_E;
       33     7225        %INCLUDE KV$GLB;
       34     7644        %INCLUDE KV$GLBCTX;
       35     8089        %INCLUDE KV$VDH;
       36     8520        %INCLUDE KV$VDO;
       37     9535        %KV_DATMOD_E;
       38     9541        %KV_DATCTRCHRTYP_E;
       39     9547        %KV_VDOVLP_E;
       40     9561        %INCLUDE KV$SND;
       41     9980        %KV_SND_FNC_E;
       42     9996        %INCLUDE KV_GLB_M;
       43    10118        %INCLUDE KV_GLBCNS_E;
       44    10459        %KV_STRTYP_E;
       45    10497        %KV_BFRRLSDSP_E;
       46    10503        %KV_VDH_EVT_ID_E;
       47    10509        %KV_SCHRSN_E;
       48    10516        %KV_DSCRSN_E;
       49    10525        %KV#CQ_HNDID_E;
       50    10530        %KV#DATMOD_E;
       51    10536        %INCLUDE KH$CHN;
       52    10658        %INCLUDE KH_CHN;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:3    
       53    10698        %INCLUDE K_ID_E;
       54    10748        %K#ENTID_E;
       55    10767        %K#LYRID_E;
       56    10774        %INCLUDE KL_MACRO_C;
       57    14126        %INCLUDE KL_AFCN_C;
       58    14227        %INCLUDE KL_SUPER_C;
       59    17129        %INCLUDE KH$STT;
       60    17159
       61    17160        %INCLUDE CP_6_SUBS;
       62    17700        %INCLUDE KV_ASCCHR_E;
       63    17837        %INCLUDE K_ADDRESS_M;
       64    18340        %INCLUDE KNH_MACRO_C;
       65    18623        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:4    
       66    18624        /*****************************************************************
       67    18625        *                                                                *
       68    18626        *                           Auto                                 *
       69    18627        *                                                                *
       70    18628        *****************************************************************/
       71    18629
       72    18630        %FPT_X25 ( STCLASS = );
       73    18674        %FPT_X25 ( FPTN = CALL_FPT, STCLASS = AUTO );
       74    18718    1   DCL L3$ PTR;
       75    18719    1   DCL VC$ PTR;
       76    18720    1   DCL VDI$ PTR;
       77    18721    1   DCL Y@BYTSIZ UBIN;
       78    18722    1   DCL BYTX UBIN;
       79    18723    1   DCL PRM_INDEX UBIN;
       80    18724    1   DCL KVBSIZ UBIN;
       81    18725    1   DCL DAT$ PTR;
       82    18726        %KV$VDH_DSC ( NAME = KV@VDH_DSC, STCLASS = AUTO );
       83    18762        %KV@USRENT;
       84    18782        %KV$VDH_DAT ( NAME = KV@SND_DAT, VDOVLPARY = KX_VDOVLPARY, STCLASS = AUTO );
       85    18862
       86    18863        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:5    
       87    18864        /*****************************************************************
       88    18865        *                                                                *
       89    18866        *                           Based                                *
       90    18867        *                                                                *
       91    18868        *****************************************************************/
       92    18869
       93    18870        %KX$VC_OTPBFR ( STCLASS = "BASED (DAT$)" );
       94    18897        %KX$VC ( STCLASS = "BASED (VC$)" );
       95    18988        %KV$VDI ( STCLASS = "BASED (VDI$)" );
       96    19059        %EQU KV_VDI = CHARTEXT('KV$VDI');
       97    19060        %KV$STR;
       98    19147        %EQU KVSTR = CHARTEXT('KV$VDI.ASNINPPTR$->KV$PTR.STR$->KV$STR');
       99    19148        %KH$CHN;
      100    19272        %G$JIT ( STCLASS = "BASED(G$JIT$)" );
      101    19686
      102    19687    1   DCL IN_STR CHAR(2000) ALIGNED BASED (FPT_X25.V_.ADR$);
      103    19688    1   DCL BYT_ARY(0:2000) UBIN BYTE CALIGNED BASED (FPT_X25.V_.ADR$);
      104    19689    1   DCL DSTR CHAR(2000) ALIGNED BASED ( DAT$ );
      105    19690        %KV$USRPRM;
      106    19741        %KV$STT;
      107    20135        %KV$PTR;
      108    20178        %KX$L2;
      109    20545        %KX$L3 ( STCLASS = "BASED ( L3$ )" );
      110    20948        %KX$LINKDEV ( STCLASS = "BASED(FPT_X25.PRM1$)" );
      111    20975        %VLP_SCODE ( FPTN=B$SCODE, STCLASS=BASED );
      112    21036        %KX$DATA ( STCLASS = BASED );
      113    21056        %VLP_ERRCODE ( STCLASS = AUTO, FPTN = ERCOD );
      114    21102        /*
      115    21103          Some based fpts.
      116    21104        */
      117    21105        %VC$CAL;
      118    21151        %VC$DAT;
      119    21172        %VC$INT;
      120    21193        %VC$RST;
      121    21214        %VC$CLR;
      122    21243        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:6    
      123    21244        /*****************************************************************
      124    21245        *                                                                *
      125    21246        *                           Constant/Symref                      *
      126    21247        *                                                                *
      127    21248        *****************************************************************/
      128    21249
      129    21250        %KH_CHNDAT;
      130    21268    1   DCL Y_POWER_OF_2(0:15) UBIN WORD CONSTANT INIT(1,2,4,8,16,32,64,128,
      131    21269    1    256,512,1024,2048,4096,8192,16384,32768);
      132    21270        %KX$VC ( FPTN = KX_VC, STCLASS = CONSTANT );
      133    21361
      134    21362        %KX_DATA;
      135    22052    1   DCL G$JIT$ PTR SYMREF;
      136    22053        %KV$USRPRM ( NAME = KX_USRPRM, STCLASS = SYMREF );
      137    22104        %KX_STATS_X29;
      138    22445        %KV$VDH_DSC ( NAME = KXX_VDH_DSC, STCLASS = SYMREF );
      139    22481        %KV$VDH_EVT ( ID = KV_VDH_EVT_ID_RLSVDI, NAME = KV_VDH_EVT_RLSVDI, STCLASS = SYMREF
             22481            );
      140    22516        %KV$VDH_EVT ( ID = KV_VDH_EVT_ID_RQSOTP, NAME = KV_VDH_EVT_RQSOTP, STCLASS = SYMREF
             22516            );
      141    22551        %KV$VDH_EVT ( ID = KV_VDH_EVT_ID_ATN, NAME = KX_VDH_EVT_ATN, STCLASS =
             22551            "STATIC SYMDEF" );
      142    22586        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_INFO#,
      143    22587                      FPTN = BAD_PAD_MSG,
      144    22588                      ERR# = %E_KXX_BAD_PAD_MSG# );
      145    22634        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_INFO#,
      146    22635                      FPTN = BAD_SET_X3_MSG,
      147    22636                      ERR# = %E_KXX_BAD_SET_X3_MSG# );
      148    22682        /*E*   ERROR: KXX-E_KXX_BAD_SET_X3_MSG#-0
      149    22683             MESSAGE: A bad x.29 read, or set, or set-and-read message
      150    22684                      was received.
      151    22685        */
      152    22686
      153    22687        %VLP_SCODE (FPTN=Y_NO_VCCTX,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_NO_VCCTX#);
      154    22748        %VLP_SCODE (FPTN=Y_BADRMTDCL,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_BADRMTDCL#);
      155    22809        %VLP_SCODE (FPTN=Y_UNKEVT,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_X29_UNKEVT#);
      156    22870        %VLP_SCODE (FPTN=Y_UNKSCHRSN,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKSCHRSN#);
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:7    
      157    22931        %VLP_SCODE (FPTN=Y_BADSTT,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_BADVCSTT#);
      158    22992        %VLP_SCODE (FPTN=Y_NO_MEM,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_NO_GET#);
      159    23053        %VLP_SCODE (FPTN=Y_ILG_EVT,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_ILG_EVT#);
      160    23114        /*
      161    23115          Some fpts and vdovlp_key.
      162    23116        */
      163    23117        %VC$CAL ( FPTN = VC_CAL, FUNCTION = CAL_IND, STCLASS = STATIC SYMDEF );
      164    23163        %VC$DAT ( FPTN = VC_DAT, FUNCTION = DAT_IND, STCLASS = STATIC SYMDEF );
      165    23184        %VC$INT ( FPTN = VC_INT, FUNCTION = INT_IND, STCLASS = STATIC SYMDEF );
      166    23205        %VC$RST ( FPTN = VC_RST, FUNCTION = RST_IND, STCLASS = STATIC SYMDEF );
      167    23226        %VC$CLR ( FPTN = VC_CLR, FUNCTION = CLR_IND, STCLASS = STATIC SYMDEF );
      168    23255        %KV$VDOVLP_KEY ( NAME = KX_KEY_CAL_IND, STCLASS = CONSTANT SYMDEF, LST = YES,
      169    23256           BYTSIZ = 8, LAST = "," );
      170    23306    1       2 DAT CHAR(8) CALIGNED INIT('NCAL_IND');
      171    23307        %KV$VDOVLP_KEY ( NAME = KX_KEY_CAL_CNF, STCLASS = CONSTANT SYMDEF, LST = YES ,
      172    23308           BYTSIZ = 8, LAST = "," );
      173    23358    1       2 DAT CHAR(8) CALIGNED INIT('NCAL_CNF');
      174    23359        %KV$VDOVLP_KEY ( NAME = KX_KEY_DAT_IND, STCLASS = CONSTANT SYMDEF, LST = YES,
      175    23360           BYTSIZ = 8, LAST = "," );
      176    23410    1       2 DAT CHAR(8) CALIGNED INIT('ADAT_IND');
      177    23411        %KV$VDOVLP_KEY ( NAME = KX_KEY_INT_IND, STCLASS = CONSTANT SYMDEF, LST = YES,
      178    23412           BYTSIZ = 8, LAST = "," );
      179    23462    1       2 DAT CHAR(8) CALIGNED INIT('AINT_IND');
      180    23463        %KV$VDOVLP_KEY ( NAME = KX_KEY_INT_CNF, STCLASS = CONSTANT SYMDEF, LST = YES,
      181    23464           BYTSIZ = 8, LAST = "," );
      182    23514    1       2 DAT CHAR(8) CALIGNED INIT('AINT_CNF');
      183    23515        %KV$VDOVLP_KEY ( NAME = KX_KEY_RST_IND, STCLASS = CONSTANT SYMDEF, LST = YES,
      184    23516           BYTSIZ = 8, LAST = "," );
      185    23566    1       2 DAT CHAR(8) CALIGNED INIT('ARST_IND');
      186    23567        %KV$VDOVLP_KEY ( NAME = KX_KEY_RST_CNF, STCLASS = CONSTANT SYMDEF, LST = YES,
      187    23568           BYTSIZ = 8, LAST = "," );
      188    23618    1       2 DAT CHAR(8) CALIGNED INIT('ARST_CNF');
      189    23619        %KV$VDOVLP_KEY ( NAME = KX_KEY_CLR_IND, STCLASS = CONSTANT SYMDEF, LST = YES,
      190    23620           BYTSIZ = 8, LAST = "," );
      191    23670    1       2 DAT CHAR(8) CALIGNED INIT('NCLR_IND');
      192    23671        %KV$VDOVLP_KEY ( NAME = KX_KEY_INDX3, STCLASS = CONSTANT SYMDEF, LST = YES,
      193    23672           BYTSIZ = 8, LAST = "," );
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:8    
      194    23722    1       2 DAT CHAR(8) CALIGNED INIT('AX3S_IND');
      195    23723        %KV$VDH_DAT ( NAME = KX_SND_DAT, STCLASS = STATIC SYMDEF,
      196    23724           VDOVLPARY = KX_VDOVLPARY, DATMOD = %KV#DATMOD_TRN );
      197    23804        %KV$SND ( NAME = KX_VDOVLPARY, HDR = NO, VLP = YES, STCLASS = STATIC SYMDEF );
      198    23837        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:9    
      199    23838        /*****************************************************************
      200    23839        *                                                                *
      201    23840        *                           Entry references                     *
      202    23841        *                                                                *
      203    23842        *****************************************************************/
      204    23843
      205    23844    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      206    23845    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      207    23846    1   DCL KVB$GET2NSYS ENTRY(2) ALTRET;
      208    23847    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
      209    23848    1   DCL KHD$SCREECH ENTRY (1) ;
      210    23849    1   DCL KXX$MRK ENTRY(1);
      211    23850    1   DCL KXX$RLSCTX ENTRY(1);
      212    23851    1   DCL KXX$INTCNC ENTRY (2) ALTRET;
      213    23852    1   DCL KXP$PACKET ENTRY(1) ALTRET;
      214    23853    1   DCL KVV$VDI ENTRY(1) ALTRET;
      215    23854    1   DCL KVV$INT ENTRY(1) ALTRET;
      216    23855    1   DCL KHA$DVCADM ENTRY(6) ALTRET;
      217    23856    1   DCL KHA$ERRLOG ENTRY (2) ALTRET;
      218    23857    1   DCL KXS$Q_SYSLOG ENTRY (1);
      219    23858    1   DCL KXS$SYSLOG ENTRY (7);
      220    23859    1   DCL DWORD UBIN(32) CONSTANT SYMDEF INIT(%BITBIN('EDA78'X));
      221    23860    1   DCL KVM$SND REDEF DWORD EPTR;
      222    23861    1   DCL KXX$SNDX29MSG ENTRY(2) ALTRET;
      223    23862
      224    23863        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:10   
      225    23864
      226    23865        /*****************************************************************
      227    23866        *                                                                *
      228    23867        *                           Procedure                            *
      229    23868        *                                                                *
      230    23869        *****************************************************************/
      231    23870
      232    23871
      233    23872    1       L3$ = FPT_X25.CAL$;
      234    23873    1       VC$ = FPT_X25.RCV$;
      235    23874    1       IF VC$ ~= ADDR(NIL)
      236    23875    1          THEN
      237    23876    2             DO;
      238    23877    2                VDI$ = KX$VC.VDI$;
      239    23878    2             END;
      240    23879    1          ELSE
      241    23880    2             DO;
      242    23881    2                VDI$ = ADDR(NIL);
      243    23882    2             END;
      244    23883
      245    23884        /*
      246    23885           The only legal call to this interface without passing VC$ is RMTDCL.
      247    23886        */
      248    23887    1       IF VC$ = ADDR(NIL) AND FPT_X25.EVN ~= %KX_CM_EV_RMTDCL#
      249    23888    1          THEN
      250    23889    2             DO;
      251    23890        /*S* SCREECH_CODE: KXV-S$KX_NO_VCCTX#
      252    23891             MESSAGE: Illegal call without passing VC context.
      253    23892        */
      254    23893    2                CALL KHD$SCREECH ( Y_NO_VCCTX );
      255    23894    2             END;
      256    23895    1       CALL_FPT = '0'B;
      257    23896    1       CALL_FPT.RCV$ = L3$;
      258    23897    1       CALL_FPT.CAL$ = VC$;
      259    23898
      260    23899    2       DO CASE ( FPT_X25.EVN );
      261    23900
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:11   
      262    23901        /*
      263    23902           EVENT DCL - An outbound circuit is requested. We would also get here
      264    23903                       when a circuit is attempting to call after a call delay.
      265    23904        */
      266    23905    2          CASE ( %KX_CM_EV_DCL# );
      267    23906
      268    23907    2             IF KX$VC.STATE = %KX_VC_ST_WCC#
      269    23908    2                THEN
      270    23909    3                   DO;
      271    23910    3                      CALL_FPT.EVN = %KX_P_EV_VCUP#;
      272    23911    3                      IF KX$VC.CALMSGBYTSIZ > 0
      273    23912    3                         THEN
      274    23913    4                            DO;
      275    23914    4                               CALL_FPT.V_.ADR$ = KX$VC.CALPKT$;
      276    23915    4                               CALL_FPT.V_.BYTX = 0;
      277    23916    4                               CALL_FPT.V_.BYTSIZ = KX$VC.CALMSGBYTSIZ;
      278    23917    4                            END;
      279    23918    3                      CALL KXP$PACKET ( CALL_FPT ) ALTRET ( SCREECH_KXP );
      280    23919    3                      RETURN;
      281    23920    3                   END;
      282    23921    2             IF KX$VC.STATE ~= %KX_VC_ST_DCL#
      283    23922    2                THEN
      284    23923        /*S* SCREECH_CODE: KXV-S$KX_ILG_EVT#
      285    23924             MESSAGE: Illegal event for this state.
      286    23925        */
      287    23926    2   L_ILG_EVT:      CALL KHD$SCREECH ( Y_ILG_EVT );
      288    23927
      289    23928    2             KX$VC.L3$ = FPT_X25.CAL$;
      290    23929    2             KX$VC.CHN$ = FPT_X25.PRM2$;
      291    23930    2             KX$VC.CHN$->KH$CHN.TERMID.TTYP = %KLTY_TTY#;
      292    23931    2             CALL KXX$INTCNC ( KX$VC, KX$VC.RLCID ) ALTRET ( L_ILG_EVT );
      293    23932    2             FPT_X25.PRM1 = %KX_L3_TOACT_RSTRTR#;
      294    23933
      295    23934        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:12   
      296    23935
      297    23936        /*
      298    23937           EVENT DATIN - pass it up to the application.
      299    23938                         The V_ L3 pass us always have a few bytes of room before
      300    23939                         the user data. We'll use that to place our VC$DAT fpt.
      301    23940        */
      302    23941    2          CASE ( %KX_CM_EV_DATIN# );
      303    23942
      304    23943    2             IF KX$VC.X28
      305    23944    2                THEN
      306    23945    3                   DO;
      307    23946    3                      IF FPT_X25.PRS.PRM1    /* x29 packet */
      308    23947    3                         THEN
      309    23948    4                            DO;
      310    23949    4                               CALL Y$DECODE_X29;
      311    23950    4                               RETURN;
      312    23951    4                            END;
      313    23952    3                      IF KX$VC.X3PRM(%KX_X3PRMX_DSCOTP#) = 1
      314    23953    3                         THEN
      315    23954    3                            RETURN;  /* we were told to discard input */
      316    23955    3                   END;
      317    23956    2             IF VDI$ ~= ADDR(NIL) AND KV$VDI.USRRQSDAT.RED
      318    23957    2                THEN
      319    23958    3                   DO;
      320    23959    3                      IF NOT KX$VC.VDHENTERED
      321    23960    3                         THEN
      322    23961    4                            DO;
      323    23962                                    %KV$USRENT ( VDI$ = VDI$, DFR$ = BLK_L3,
      324    23963                                    SCHRSN = %KV_SCHRSN_DFR1 );
             23976    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             23976                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             23977    5           IF NOT VDI$->KV$VDI.BSY THEN DO;
             23978    5              VDI$->KV$VDI.BSY = '1'B;
             23979    5              KV@USRENT.SVDPTR$ = KV$PTR$;
             23980    5              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;
             23981    5              END;                         /* ELSE IF ~BSY                       */
             23982    5           ELSE DO;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:13   
             23983    5              VDI$->KV$VDI.DFR.USR(1) = '1'B;
             23984    5           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             23984                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             23985    5              GOTO BLK_L3;
             23986    5              END;                         /* END IF                             */
      325    23989    4                            END;
      326    23990    3                      VC_DAT.Q = FPT_X25.PRS.PRM1;
      327    23991    3                      VC_DAT.M = FPT_X25.PRS.PRM2;
      328    23992    3                      SUBSTR(FPT_X25.V_.ADR$->DSTR,FPT_X25.V_.BYTX-LENGTHC(VC_DAT),
             23992                               LENGTHC(VC_DAT))
      329    23993    3                         = SUBSTR(ADDR(VC_DAT)->DSTR,0,LENGTHC(VC_DAT));
      330    23994    3                      KV@SND_DAT = KX_SND_DAT;
      331    23995    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_DAT_IND);
      332    23996    3                      KV@SND_DAT.DAT__.ADR$ = FPT_X25.V_.ADR$;
      333    23997    3                      KV@SND_DAT.DAT__.BYTX = FPT_X25.V_.BYTX - LENGTHC(VC_DAT);
      334    23998    3                      KV@SND_DAT.DAT__.DATBYTSIZ = FPT_X25.V_.BYTSIZ + LENGTHC(VC_DAT);
      335    23999    3                      CALL KVV$VDI ( KV@SND_DAT ) ALTRET ( BLK_L3 );
      336    24000    3                      IF NOT KX$VC.VDHENTERED
      337    24001    3                         THEN
      338    24002    4                            DO;
      339    24003                                    %KV$USREXT;
             24009    4           KV$VDI.BSY = '0'B;
             24011    4           KV$PTR$ = KV@USRENT.SVDPTR$;
      340    24013    4                            END;
      341    24014    3   L_RET:             RETURN;
      342    24015    3                   END;
      343    24016    2   BLK_L3:   KX$VC.BLK_L3 = '1'B;
      344    24017    2             ALTRETURN;  /* leave the data with L3 */
      345    24018        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:14   
      346    24019
      347    24020        /*
      348    24021           EVENT DATRQS - release transmitted output buffers. Send
      349    24022                          queued messages.
      350    24023        */
      351    24024    2          CASE ( %KX_CM_EV_DATRQS# );
      352    24025
      353    24026        /*
      354    24027           Do we have anything to send ?
      355    24028        */
      356    24029    2             IF KX$VC.SND.HED$ = ADDR(NIL)
      357    24030    2                THEN
      358    24031    3                   DO;
      359    24032    3   Y@DFR1:            KX$VC.RPRDAT = '1'B;
      360    24033    3                      RETURN;
      361    24034    3                   END;
      362    24035        /*
      363    24036        */
      364    24037    2             IF VDI$ ~= ADDR(NIL)
      365    24038    2                THEN
      366    24039    3                   DO;
      367    24040    3                      IF NOT KX$VC.VDHENTERED
      368    24041    3                         THEN
      369    24042    4                            DO;
      370    24043                                    %KV$USRENT ( VDI$ = VDI$, DFR$ = Y@DFR1,
      371    24044                                    SCHRSN = %KV_SCHRSN_DFR0 );
             24057    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24057                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24058    5           IF NOT VDI$->KV$VDI.BSY THEN DO;
             24059    5              VDI$->KV$VDI.BSY = '1'B;
             24060    5              KV@USRENT.SVDPTR$ = KV$PTR$;
             24061    5              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;
             24062    5              END;                         /* ELSE IF ~BSY                       */
             24063    5           ELSE DO;
             24064    5              VDI$->KV$VDI.DFR.USR(0) = '1'B;
             24065    5           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24065                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:15   
             24066    5              GOTO Y@DFR1;
             24067    5              END;                         /* END IF                             */
      372    24070    4                            END;
      373    24071    4                      DO WHILE ( KX$VC.SND.HED$ ~= KX$VC.SND.NXTLOD$ );
      374    24072    4                         DAT$ = KX$VC.SND.HED$;
      375    24073    4                         KX$VC.SND.HED$ = KX$VC_OTPBFR.LNK$;
      376    24074    4                         Y@BYTSIZ = KX$VC_OTPBFR.BFRBYTSIZ;
      377    24075    4                         KX$VC.OTPBFRBYTCNT = KX$VC.OTPBFRBYTCNT - Y@BYTSIZ;
      378    24076    4                         CALL KVB$RLS2NSYS ( KX$VC_OTPBFR.RLSWRDSIZ, DAT$ );
      379    24077    4                         KX_STATS_X29.KHSTT.OTPBFRBYTUTL = KX_STATS_X29.KHSTT.
             24077                                  OTPBFRBYTUTL - Y@BYTSIZ;
      380    24078    4                      END;
      381    24079        /*
      382    24080           Let's unblock.
      383    24081        */
      384    24082    3                      IF KX$VC.OTPBFRBYTCNT <= KX$VC.MAXOTPBYT
      385    24083    3                         THEN
      386    24084                                 %KV$RQSOTP ( RQSOTP = YES );
             24096    4           IF NOT KV$VDI.RQSOTP  THEN DO;
             24097    4              KV$VDI.RQSOTP = '1'B;
             24098    4              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);
             24099    4              END;                         /* END IF                             */
      387    24102    3                      IF %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RLSVDI)
      388    24103    3                         AND KX$VC.SND.HED$ = ADDR(NIL)
      389    24104    3                         THEN
      390    24105        /* complete the releasing of VDI.                                */
      391    24106    3                            CALL KVV$VDI(KV_VDH_EVT_RLSVDI) ;
      392    24107    3                   END;
      393    24108    2             IF KX$VC.SND.HED$ = ADDR(NIL)
      394    24109    2                THEN
      395    24110    3                   DO;
      396    24111    3                      KX$VC.SND.NXTLOD$ = ADDR(NIL);
      397    24112    3                      KX$VC.SND.TAL$ = ADDR(NIL);
      398    24113    3                      KX$VC.RPRDAT = '1'B;
      399    24114    3                   END;
      400    24115    2                ELSE
      401    24116    3                   DO;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:16   
      402    24117    3                      DAT$ = KX$VC.SND.NXTLOD$;
      403    24118    3                      KX$VC.SND.NXTLOD$ = KX$VC_OTPBFR.LNK$;
      404    24119    3                      FPT_X25.V_.ADR$ = DAT$;
      405    24120    3                      FPT_X25.V_.BYTX = LENGTHC ( KX$VC_OTPBFR );
      406    24121    3                      FPT_X25.V_.BYTSIZ = KX$VC_OTPBFR.BFRBYTSIZ - FPT_X25.V_.BYTX;
      407    24122    3                      FPT_X25.PRS.PRM1 = KX$VC_OTPBFR.Q;
      408    24123    3                      FPT_X25.PRS.PRM2 = KX$VC_OTPBFR.M;
      409    24124    3                   END;
      410    24125    2             IF VDI$ ~= ADDR(NIL) AND NOT KX$VC.VDHENTERED
      411    24126    2                THEN
      412    24127    3                   DO;
      413    24128                           %KV$USREXT;
             24134    3           KV$VDI.BSY = '0'B;
             24136    3           KV$PTR$ = KV@USRENT.SVDPTR$;
      414    24138    3                   END;
      415    24139    2             RETURN;
      416    24140        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:17   
      417    24141
      418    24142        /*
      419    24143           EVENT INT - interrupt packet received. Pass it up to the application.
      420    24144        */
      421    24145    2          CASE ( %KX_CM_EV_INT# );
      422    24146
      423    24147    2             IF KX$VC.STATE ~= %KX_VC_ST_NRM#
      424    24148    2                THEN
      425    24149    2                   RETURN;
      426    24150    2             KX$VC.INTINDPND = '1'B;
      427    24151    2             VC_INT.FUNCTION = %KX_VCFNC_INT_IND#;
      428    24152    2             VC_INT.INTDATLNG = FPT_X25.V_.BYTSIZ;
      429    24153    2             Y@BYTSIZ = LENGTHC(VC_INT) + FPT_X25.V_.BYTSIZ;
      430    24154    2             KX$VC.INTMSGBYTSIZ = Y@BYTSIZ;
      431    24155    2             CALL KVB$GETSYS ( (Y@BYTSIZ+1)/2, KX$VC.INTPKT$ ) WHENALTRETURN
      432    24156    3                   DO;
      433    24157    3   NO_MEM:            CALL KHD$SCREECH ( Y_NO_MEM );
      434    24158    3                   END;
      435    24159    2             KX$VC.INTPKT$->VC$INT = VC_INT;
      436    24160    2             SUBSTR (KX$VC.INTPKT$->DSTR,LENGTHC(VC_INT),FPT_X25.V_.BYTSIZ) =
      437    24161    2                SUBSTR (FPT_X25.V_.ADR$->DSTR,FPT_X25.V_.BYTX,FPT_X25.V_.BYTSIZ);
      438    24162    2             IF NOT KV$VDI.USRRQSDAT.RED
      439    24163    2                THEN
      440    24164    2                   GOTO L_RET;   /* wait for next read from host */
      441    24165    2             IF NOT KX$VC.VDHENTERED
      442    24166    2                THEN
      443    24167    3                   DO;
      444    24168                           %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET,
      445    24169                           SCHRSN = %KV_SCHRSN_DFR1 );
             24182    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24182                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24183    4           IF NOT VDI$->KV$VDI.BSY THEN DO;
             24184    4              VDI$->KV$VDI.BSY = '1'B;
             24185    4              KV@USRENT.SVDPTR$ = KV$PTR$;
             24186    4              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;
             24187    4              END;                         /* ELSE IF ~BSY                       */
             24188    4           ELSE DO;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:18   
             24189    4              VDI$->KV$VDI.DFR.USR(1) = '1'B;
             24190    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24190                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             24191    4              GOTO L_RET;
             24192    4              END;                         /* END IF                             */
      446    24195    3                   END;
      447    24196    2             KV@SND_DAT = KX_SND_DAT;
      448    24197    2             KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INT_IND);
      449    24198    2             KV@SND_DAT.DAT__.ADR$ = KX$VC.INTPKT$;
      450    24199    2             KV@SND_DAT.DAT__.BYTX = 0;
      451    24200    2             KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.INTMSGBYTSIZ;
      452    24201    2             CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN
      453    24202    3                   DO;
      454    24203    3                      KX$VC.INTINDPND = '0'B;
      455    24204    3                      CALL KVB$RLSSYS ( (KX$VC.INTMSGBYTSIZ+1)/2, KX$VC.INTPKT$ );
      456    24205    3                      KX$VC.INTPKT$ = ADDR(NIL);
      457    24206    3                      KX$VC.INTMSGBYTSIZ = 0;
      458    24207    3                   END;
      459    24208    2             IF NOT KX$VC.VDHENTERED
      460    24209    2                THEN
      461    24210    3                   DO;
      462    24211                           %KV$USREXT;
             24217    3           KV$VDI.BSY = '0'B;
             24219    3           KV$PTR$ = KV@USRENT.SVDPTR$;
      463    24221    3                   END;
      464    24222        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:19   
      465    24223        /*
      466    24224           EVENT INTACK - pass the interrupt acknowledgement to the application
      467    24225        */
      468    24226    2          CASE ( %KX_CM_EV_INTACK# );
      469    24227
      470    24228    2             IF KX$VC.STATE ~= %KX_VC_ST_NRM#
      471    24229    2                THEN
      472    24230    2                   RETURN;
      473    24231    2             KX$VC.INTCNFPND = '1'B;
      474    24232    2             IF NOT KV$VDI.USRRQSDAT.RED
      475    24233    2                THEN
      476    24234    2                   GOTO L_RET;
      477    24235    2             IF NOT KX$VC.VDHENTERED
      478    24236    2                THEN
      479    24237    3                   DO;
      480    24238                           %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET,
      481    24239                           SCHRSN = %KV_SCHRSN_DFR1 );
             24252    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24252                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24253    4           IF NOT VDI$->KV$VDI.BSY THEN DO;
             24254    4              VDI$->KV$VDI.BSY = '1'B;
             24255    4              KV@USRENT.SVDPTR$ = KV$PTR$;
             24256    4              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;
             24257    4              END;                         /* ELSE IF ~BSY                       */
             24258    4           ELSE DO;
             24259    4              VDI$->KV$VDI.DFR.USR(1) = '1'B;
             24260    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24260                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             24261    4              GOTO L_RET;
             24262    4              END;                         /* END IF                             */
      482    24265    3                   END;
      483    24266    2             VC_INT.FUNCTION = %KX_VCFNC_INT_CNF#;
      484    24267    2             KV@SND_DAT = KX_SND_DAT;
      485    24268    2             KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INT_CNF);
      486    24269    2             KV@SND_DAT.DAT__.ADR$ = ADDR(VC_INT);
      487    24270    2             KV@SND_DAT.DAT__.BYTX = 0;
      488    24271    2             KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_INT);
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:20   
      489    24272    2             CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN
      490    24273    3                   DO;
      491    24274    3                      KX$VC.INTCNFPND = '0'B;
      492    24275    3                   END;
      493    24276    2             IF NOT KX$VC.VDHENTERED
      494    24277    2                THEN
      495    24278    3                   DO;
      496    24279                           %KV$USREXT;
             24285    3           KV$VDI.BSY = '0'B;
             24287    3           KV$PTR$ = KV@USRENT.SVDPTR$;
      497    24289    3                   END;
      498    24290        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:21   
      499    24291
      500    24292        /*
      501    24293           EVENT RMTDCL - received a new circuit call.
      502    24294        */
      503    24295    2          CASE ( %KX_CM_EV_RMTDCL# );
      504    24296
      505    24297    2             IF VC$ ~= ADDR(NIL)
      506    24298    2                THEN
      507    24299    3                   DO;
      508    24300    3                      CALL KHD$SCREECH ( Y_BADRMTDCL );
      509    24301    3                   END;
      510    24302
      511    24303    2             CALL KVB$GETSYS(SIZEW(KX$VC),VC$) WHENALTRETURN
      512    24304    3                   DO;
      513    24305    3   L_CLRVC:           CALL_FPT.EVN = %KX_P_EV_VCLST#;
      514    24306    3                      CALL_FPT.PRM1 = %KX_DIAG_CALPRB#; /* call setup problem  */
      515    24307    3                      CALL_FPT.PRS.PRM1 = '1'B;
      516    24308    3                      CALL KXP$PACKET ( CALL_FPT ) ALTRET ( SCREECH_KXP );
      517    24309    3                      IF VC$ ~= ADDR(NIL)
      518    24310    3                         THEN
      519    24311    3                            CALL KXX$RLSCTX ( KX$VC );
      520    24312    3                      RETURN;
      521    24313    3                   END;
      522    24314    2             KX$VC = KX_VC;
      523    24315    2             Y@BYTSIZ = FPT_X25.V_.BYTX + FPT_X25.V_.BYTSIZ - LENGTHC(KX$DATA);
      524    24316    2             KX$VC.CALMSGBYTSIZ = Y@BYTSIZ + LENGTHC(VC_CAL);
      525    24317    2             CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ ) ALTRET (
             24317                      L_CLRVC );
      526    24318    2             VC_CAL.FUNCTION = %KX_VCFNC_CAL_IND#;
      527    24319    2             VC_CAL.CLGADRLNG = KX$L3.CALL_OPTS.RCVADR.SIZ;
      528    24320    2             VC_CAL.CLGADRSTRING = KX$L3.CALL_OPTS.RCVADR.ADR_STRING;
      529    24321    2             VC_CAL.CLDADRLNG = KX$L3.L2$->KX$L2.NTWADR.LNG;
      530    24322    2             VC_CAL.CLDADRSTRING = KX$L3.L2$->KX$L2.NTWADR.ADR_STRING;
      531    24323    2             VC_CAL.FSTSLC = KX$L3.FSTSLC;
      532    24324    2             VC_CAL.RVS = KX$L3.RVS;
      533    24325    2             VC_CAL.USRDATLNG = FPT_X25.V_.BYTSIZ;
      534    24326    2             VC_CAL.USRDATBYTX = FPT_X25.V_.BYTX - LENGTHC(KX$DATA);
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:22   
      535    24327    2             KX$VC.CALPKT$->VC$CAL = VC_CAL;
      536    24328    2             SUBSTR (KX$VC.CALPKT$->DSTR,LENGTHC(VC_CAL),Y@BYTSIZ) =
      537    24329    2                SUBSTR (IN_STR,LENGTHC(KX$DATA),Y@BYTSIZ);
      538    24330
      539    24331    2             KX_STATS_X29.KHSTT.CTXBYTUTL =
      540    24332    2                SIZEC(KX$VC) + KX_STATS_X29.KHSTT.CTXBYTUTL;
      541    24333    2             KX_STATS_X29.LINSPDDST(15) = KX_STATS_X29.LINSPDDST(15) + 1;
      542    24334    2             KX_STATS_X29.CIRCUITS = KX_STATS_X29.CIRCUITS + 1;
      543    24335
      544    24336    2             KX$VC.BLNK$ = KX$LINKDEV.L4_TAIL$;
      545    24337    2             IF KX$LINKDEV.L4_TAIL$ = ADDR(NIL)
      546    24338    2                THEN
      547    24339    2                   KX$LINKDEV.L4_HEAD$ = VC$;
      548    24340    2                ELSE
      549    24341    2                   KX$LINKDEV.L4_TAIL$->KX$VC.FLNK$ = VC$;
      550    24342    2             KX$LINKDEV.L4_TAIL$ = VC$;
      551    24343        /*
      552    24344                  KX$LINKDEV.CRCCNT = KX$LINKDEV.CRCCNT + 1;
      553    24345           Always pass back the ctx$ in the fpt.
      554    24346        */
      555    24347    2             FPT_X25.RCV$ = VC$;
      556    24348    2             FPT_X25.PRM1 = %KX_L3_TOACT_RSTRTR#;
      557    24349
      558    24350    2             KX$VC.STATE = %KX_VC_ST_RMTDCL#;
      559    24351    2             KX$VC.CHN$ = FPT_X25.PRM2$;
      560    24352    2             KX$VC.CHN$->KH$CHN.TERMID.TTYP = %KLTY_TTY#;
      561    24353    2             KX$VC.L3$ = FPT_X25.CAL$;
      562    24354    2             KX$VC.CNTL$ = FPT_X25.PRM1$;
      563    24355        /*   event the AU about incoming circuit through control connection.
      564    24356             FPT_X25.PRM1$ is the control connection context pointer. */
      565    24357
      566    24358    2             VDI$ = KX$LINKDEV.VDI$;
      567    24359                  %KV$USRENT ( VDI$ = VDI$, DFR$ = Y@DFR4,
      568    24360                  SCHRSN = %KV_SCHRSN_DFR2 );
             24373    2           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24373                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24374    3           IF NOT VDI$->KV$VDI.BSY THEN DO;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:23   
             24375    3              VDI$->KV$VDI.BSY = '1'B;
             24376    3              KV@USRENT.SVDPTR$ = KV$PTR$;
             24377    3              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;
             24378    3              END;                         /* ELSE IF ~BSY                       */
             24379    3           ELSE DO;
             24380    3              VDI$->KV$VDI.DFR.USR(2) = '1'B;
             24381    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24381                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             24382    3              GOTO Y@DFR4;
             24383    3              END;                         /* END IF                             */
      569    24386    2             KX_VDH_EVT_ATN.PRM = 1;
      570    24387    2             CALL KVV$VDI ( KX_VDH_EVT_ATN );
      571    24388                  %KV$USREXT ( VDI$ = VDI$ );
             24394    2           KV$VDI.BSY = '0'B;
             24396    2           KV$PTR$ = KV@USRENT.SVDPTR$;
      572    24398    2             RETURN;
      573    24399    2   Y@DFR4:   KX$LINKDEV.PNDEVTCNT = KX$LINKDEV.PNDEVTCNT + 1;
      574    24400        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:24   
      575    24401        /*
      576    24402            EVENT RSTIND - Pass the reset packet up to the application.
      577    24403        */
      578    24404    2          CASE ( %KX_CM_EV_RSTIND# );
      579    24405
      580    24406    2             IF KX$VC.STATE ~= %KX_VC_ST_NRM#
      581    24407    2                THEN
      582    24408    2                   RETURN;
      583    24409    2             VC_RST.FUNCTION = %KX_VCFNC_RST_IND#;
      584    24410    2             VC_RST.CAUSE = FPT_X25.PRM1;
      585    24411    2             KX$VC.RST_CAUSE = FPT_X25.PRM1;
      586    24412    2             VC_RST.DIAG = FPT_X25.PRM2;
      587    24413    2             KX$VC.RST_DIAG = FPT_X25.PRM2;
      588    24414    2             KX$VC.RSTINDPND = '1'B;
      589    24415    2             IF NOT KV$VDI.USRRQSDAT.RED
      590    24416    2                THEN
      591    24417    2                   GOTO L_RET;
      592    24418    2             IF NOT KX$VC.VDHENTERED
      593    24419    2                THEN
      594    24420    3                   DO;
      595    24421                           %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET,
      596    24422                           SCHRSN = %KV_SCHRSN_DFR1 );
             24435    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24435                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24436    4           IF NOT VDI$->KV$VDI.BSY THEN DO;
             24437    4              VDI$->KV$VDI.BSY = '1'B;
             24438    4              KV@USRENT.SVDPTR$ = KV$PTR$;
             24439    4              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;
             24440    4              END;                         /* ELSE IF ~BSY                       */
             24441    4           ELSE DO;
             24442    4              VDI$->KV$VDI.DFR.USR(1) = '1'B;
             24443    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24443                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             24444    4              GOTO L_RET;
             24445    4              END;                         /* END IF                             */
      597    24448    3                   END;
      598    24449    2             KV@SND_DAT = KX_SND_DAT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:25   
      599    24450    2             KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_RST_IND);
      600    24451    2             KV@SND_DAT.DAT__.ADR$ = ADDR(VC_RST);
      601    24452    2             KV@SND_DAT.DAT__.BYTX = 0;
      602    24453    2             KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_RST);
      603    24454    2             CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN
      604    24455    3                   DO;
      605    24456    3                      KX$VC.RSTINDPND = '0'B;
      606    24457    3                   END;
      607    24458    2             IF NOT KX$VC.VDHENTERED
      608    24459    2                THEN
      609    24460    3                   DO;
      610    24461                           %KV$USREXT;
             24467    3           KV$VDI.BSY = '0'B;
             24469    3           KV$PTR$ = KV@USRENT.SVDPTR$;
      611    24471    3                   END;
      612    24472        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:26   
      613    24473        /*
      614    24474           EVENT VCRST - A reset confirmation was received. Inform the application.
      615    24475        */
      616    24476    2          CASE ( %KX_CM_EV_VCRST# );
      617    24477
      618    24478    2             IF KX$VC.STATE ~= %KX_VC_ST_NRM#
      619    24479    2                THEN
      620    24480    2                   RETURN;
      621    24481    2             KX$VC.RSTCNFPND = '1'B;
      622    24482    2             IF NOT KV$VDI.USRRQSDAT.RED
      623    24483    2                THEN
      624    24484    2                   GOTO L_RET;
      625    24485    2             IF NOT KX$VC.VDHENTERED
      626    24486    2                THEN
      627    24487    3                   DO;
      628    24488                           %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET, SCHRSN = %KV_SCHRSN_DFR1
             24488                               );
             24501    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24501                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24502    4           IF NOT VDI$->KV$VDI.BSY THEN DO;
             24503    4              VDI$->KV$VDI.BSY = '1'B;
             24504    4              KV@USRENT.SVDPTR$ = KV$PTR$;
             24505    4              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;
             24506    4              END;                         /* ELSE IF ~BSY                       */
             24507    4           ELSE DO;
             24508    4              VDI$->KV$VDI.DFR.USR(1) = '1'B;
             24509    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24509                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             24510    4              GOTO L_RET;
             24511    4              END;                         /* END IF                             */
      629    24514    3                   END;
      630    24515    2             VC_RST.FUNCTION = %KX_VCFNC_RST_CNF#;
      631    24516    2             KV@SND_DAT = KX_SND_DAT;
      632    24517    2             KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_RST_CNF);
      633    24518    2             KV@SND_DAT.DAT__.ADR$ = ADDR(VC_RST);
      634    24519    2             KV@SND_DAT.DAT__.BYTX = 0;
      635    24520    2             KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_RST);
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:27   
      636    24521    2             CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN
      637    24522    3                   DO;
      638    24523    3                      KX$VC.RSTCNFPND = '0'B;
      639    24524    3                   END;
      640    24525    2             IF NOT KX$VC.VDHENTERED
      641    24526    2                THEN
      642    24527    3                   DO;
      643    24528                           %KV$USREXT;
             24534    3           KV$VDI.BSY = '0'B;
             24536    3           KV$PTR$ = KV@USRENT.SVDPTR$;
      644    24538    3                   END;
      645    24539        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:28   
      646    24540
      647    24541        /*
      648    24542           EVENT VCDWN/VCLST - VC down or lost. This could be the result of L3
      649    24543                         receiving a clear or a clear_c packet from the other side.
      650    24544                         KX$VC.STATE is the clue to what should be happening.
      651    24545        */
      652    24546    2          CASE ( %KX_CM_EV_VCDWN#, %KX_CM_EV_VCLST#, %KX_CM_EV_VCLST_PRM# );
      653    24547
      654    24548    2             KX$VC.INV2CLR = '0'B;
      655    24549    3             DO CASE ( KX$VC.STATE );
      656    24550    3                CASE ( %KX_VC_ST_WCC# );
      657    24551    3                   IF FPT_X25.EVN = %KX_CM_EV_VCDWN#
      658    24552    3                      THEN
      659    24553    3                         RETURN;   /* will attempt to call again after delay */
      660    24554    3                CASE ( %KX_VC_ST_BGNPHSDSC#, %KX_VC_ST_ENDPHSDSC# );
      661    24555    3                   KX$VC.STATE = %KX_VC_ST_ENDPHSDSC#;
      662    24556    3                   RETURN;
      663    24557    3                CASE ( %KX_VC_ST_RMTDCL# );
      664    24558    3                   CALL KXX$RLSCTX ( KX$VC );
      665    24559    3                   RETURN;
      666    24560    3             END;
      667    24561    2             KX$VC.VDI$->KV$VDI.PHSDSC = '1'B;
      668    24562        /*
      669    24563           Pass the clear packet up to the application.
      670    24564        */
      671    24565    2             IF KX$VC.CLRPKT$ = ADDR(NIL) AND FPT_X25.PRS.V
      672    24566    2                THEN
      673    24567    3                   DO;
      674    24568    3                      Y@BYTSIZ = FPT_X25.V_.BYTX + FPT_X25.V_.BYTSIZ - LENGTHC(KX$DATA)
             24568                               ;
      675    24569    3                      KX$VC.CLRMSGBYTSIZ = Y@BYTSIZ + LENGTHC(VC_CLR);
      676    24570    3                      CALL KVB$GETSYS ( (KX$VC.CLRMSGBYTSIZ+1)/2, KX$VC.CLRPKT$ )
             24570                               ALTRET ( NO_MEM );
      677    24571    3                      VC_CLR.FUNCTION = %KX_VCFNC_CLR_IND#;
      678    24572    3                      VC_CLR.USRDATLNG = FPT_X25.V_.BYTSIZ;
      679    24573    3                      VC_CLR.USRDATBYTX = FPT_X25.V_.BYTX - LENGTHC(KX$DATA);
      680    24574    3                      VC_CLR.CAUSE = FPT_X25.PRM1;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:29   
      681    24575    3                      VC_CLR.DIAG = FPT_X25.PRM2;
      682    24576    3                      KX$VC.CLRPKT$->VC$CLR = VC_CLR;
      683    24577    3                      SUBSTR (KX$VC.CLRPKT$->DSTR,LENGTHC(VC_CLR),Y@BYTSIZ) =
      684    24578    3                         SUBSTR (IN_STR,LENGTHC(KX$DATA),Y@BYTSIZ);
      685    24579    3                      KX$VC.CLRINDPND = '1'B;
      686    24580    3                   END;
      687    24581    2             IF NOT KX$VC.VDHENTERED
      688    24582    2                THEN
      689    24583    3                   DO;
      690    24584                           %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET,
      691    24585                           SCHRSN = %KV_SCHRSN_DFR3 );
             24598    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24598                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24599    4           IF NOT VDI$->KV$VDI.BSY THEN DO;
             24600    4              VDI$->KV$VDI.BSY = '1'B;
             24601    4              KV@USRENT.SVDPTR$ = KV$PTR$;
             24602    4              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;
             24603    4              END;                         /* ELSE IF ~BSY                       */
             24604    4           ELSE DO;
             24605    4              VDI$->KV$VDI.DFR.USR(3) = '1'B;
             24606    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24606                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             24607    4              GOTO L_RET;
             24608    4              END;                         /* END IF                             */
      692    24611    3                   END;
      693    24612    2             IF KX$VC.CLRPKT$ ~= ADDR(NIL) AND KV$VDI.USRRQSDAT.RED
      694    24613    2                THEN
      695    24614    3                   DO;
      696    24615    3                      KV@SND_DAT = KX_SND_DAT;
      697    24616    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CLR_IND);
      698    24617    3                      KV@SND_DAT.DAT__.ADR$ = KX$VC.CLRPKT$;
      699    24618    3                      KV@SND_DAT.DAT__.BYTX = 0;
      700    24619    3                      KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CLRMSGBYTSIZ;
      701    24620    3                      CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN
      702    24621    4                            DO;
      703    24622    4                               KX$VC.CLRINDPND = '0'B;
      704    24623    4                               CALL KVB$RLSSYS ( (KX$VC.CLRMSGBYTSIZ+1)/2, KX$VC.
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:30   
             24623                                        CLRPKT$ );
      705    24624    4                               KX$VC.CLRPKT$ = ADDR(NIL);
      706    24625    4                               KX$VC.CLRMSGBYTSIZ = 0;
      707    24626    4                            END;
      708    24627    3                   END;
      709    24628    2   VDH_DSC:  KV@VDH_DSC = KXX_VDH_DSC;
      710    24629    2             CALL KVV$VDI ( KV@VDH_DSC );
      711    24630    2             KX$VC.STATE = %KX_VC_ST_ENDPHSDSC#;
      712    24631                  /* takes care of purging output */
      713    24632    3             DO WHILE ( KX$VC.SND.HED$ ~= ADDR(NIL) );
      714    24633    3                DAT$ = KX$VC.SND.HED$;
      715    24634    3                KX$VC.SND.HED$ = KX$VC_OTPBFR.LNK$;
      716    24635    3                Y@BYTSIZ = KX$VC_OTPBFR.BFRBYTSIZ;
      717    24636    3                CALL KVB$RLS2NSYS ( KX$VC_OTPBFR.RLSWRDSIZ, DAT$ );
      718    24637    3                KX_STATS_X29.KHSTT.OTPBFRBYTUTL = KX_STATS_X29.KHSTT.OTPBFRBYTUTL -
             24637                         Y@BYTSIZ;
      719    24638    3             END; /*  DO WHILE ...  */
      720    24639
      721    24640    2             KX$VC.OTPBFRBYTCNT = 0;
      722    24641                  %KV$RQSOTP ( RQSOTP = YES );
             24653    3           IF NOT KV$VDI.RQSOTP  THEN DO;
             24654    3              KV$VDI.RQSOTP = '1'B;
             24655    3              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);
             24656    3              END;                         /* END IF                             */
      723    24659    2             IF %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RLSVDI)
      724    24660    2                THEN
      725    24661        /* complete the releasing of VDI.                                   */
      726    24662    2                   CALL KVV$VDI(KV_VDH_EVT_RLSVDI) ;
      727    24663    2             IF NOT KX$VC.VDHENTERED
      728    24664    2                THEN
      729    24665    3                   DO;
      730    24666                           %KV$USREXT;
             24672    3           KV$VDI.BSY = '0'B;
             24674    3           KV$PTR$ = KV@USRENT.SVDPTR$;
      731    24676    3                   END;
      732    24677    2             KX$VC.SND.NXTLOD$ = ADDR(NIL);
      733    24678    2             KX$VC.SND.TAL$ = ADDR(NIL);
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:31   
      734    24679
      735    24680        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:32   
      736    24681        /*
      737    24682           EVENT RLSL3 - L3 context is about to go away. We still have to wait
      738    24683                         until the disconnect procedure with VDH is done. Just
      739    24684                         clear the L3$.
      740    24685        */
      741    24686    2          CASE ( %KX_CM_EV_RLSL3# );
      742    24687
      743    24688    2             KX$VC.L3$ = ADDR(NIL);
      744    24689    2             KX$VC.PHSDSC = '1'B;
      745    24690        /*N* Some more code may be needed.  */
      746    24691        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:33   
      747    24692
      748    24693        /*
      749    24694           EVENT VCUP - VC established.
      750    24695        */
      751    24696
      752    24697    2          CASE ( %KX_CM_EV_VCUP# );
      753    24698
      754    24699    2             IF KX$VC.STATE ~= %KX_VC_ST_WCC# AND KX$VC.STATE ~= %KX_VC_ST_WCA#
      755    24700    2                THEN
      756    24701    2                   CALL KHD$SCREECH ( Y_BADSTT );
      757    24702    2             KX$VC.STATE = %KX_VC_ST_NRM#;   /* We're now in data xfer state */
      758    24703    2             KX$VC.MAXOTPBYT = KX_BUF.SIZ(KX$L3.CALL_OPTS.SNDPCKSIZ) *
      759    24704    2                ( KX$L3.CALL_OPTS.SNDWND + 1 );
      760    24705    2             IF KX$VC.CHN$->KH$CHN.TERMID.LEV = %TERMINAL_ID_LEV_SUBCHAN#
      761    24706    2                THEN
      762    24707    3                   DO;
      763    24708        /*
      764    24709           Pass the call_c information up to the application.
      765    24710        */
      766    24711    3                      IF KX$VC.CALMSGBYTSIZ > 0
      767    24712    3                         THEN
      768    24713        /* Get rid of the call user data */
      769    24714    3                            CALL KVB$RLSSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )
             24714                                     ;
      770    24715    3                      Y@BYTSIZ = FPT_X25.V_.BYTX + FPT_X25.V_.BYTSIZ - LENGTHC(KX$DATA)
             24715                               ;
      771    24716    3                      KX$VC.CALMSGBYTSIZ = Y@BYTSIZ + LENGTHC(VC_CAL);
      772    24717    3                      CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )
      773    24718    3                         ALTRET ( NO_MEM );
      774    24719    3                      VC_CAL.FUNCTION = %KX_VCFNC_CAL_CNF#;
      775    24720    3                      VC_CAL.CLDADRLNG = KX$L3.CALL_OPTS.RCVADR.SIZ;
      776    24721    3                      VC_CAL.CLDADRSTRING = KX$L3.CALL_OPTS.RCVADR.ADR_STRING;
      777    24722    3                      VC_CAL.CLGADRLNG = KX$L3.L2$->KX$L2.NTWADR.LNG;
      778    24723    3                      VC_CAL.CLGADRSTRING = KX$L3.L2$->KX$L2.NTWADR.ADR_STRING;
      779    24724    3                      VC_CAL.FSTSLC = KX$L3.FSTSLC;
      780    24725    3                      VC_CAL.USRDATLNG = FPT_X25.V_.BYTSIZ;
      781    24726    3                      VC_CAL.USRDATBYTX = FPT_X25.V_.BYTX - LENGTHC(KX$DATA);
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:34   
      782    24727    3                      VC_CAL.X3 = KX$VC.X3PRM;
      783    24728    3                      KX$VC.CALPKT$->VC$CAL = VC_CAL;
      784    24729    3                      SUBSTR (KX$VC.CALPKT$->DSTR,LENGTHC(VC_CAL),Y@BYTSIZ) =
      785    24730    3                         SUBSTR (IN_STR,LENGTHC(KX$DATA),Y@BYTSIZ);
      786    24731    3                      KX$VC.CALCNFPND = '1'B;
      787    24732    3                      IF NOT KV$VDI.USRRQSDAT.RED
      788    24733    3                         THEN
      789    24734    3                            GOTO L_RET;
      790    24735    3                      IF NOT KX$VC.VDHENTERED
      791    24736    3                         THEN
      792    24737    4                            DO;
      793    24738                                    %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET,
      794    24739                                    SCHRSN = %KV_SCHRSN_DFR1 );
             24752    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24752                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24753    5           IF NOT VDI$->KV$VDI.BSY THEN DO;
             24754    5              VDI$->KV$VDI.BSY = '1'B;
             24755    5              KV@USRENT.SVDPTR$ = KV$PTR$;
             24756    5              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;
             24757    5              END;                         /* ELSE IF ~BSY                       */
             24758    5           ELSE DO;
             24759    5              VDI$->KV$VDI.DFR.USR(1) = '1'B;
             24760    5           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24760                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             24761    5              GOTO L_RET;
             24762    5              END;                         /* END IF                             */
      795    24765    4                            END;
      796    24766    3                      KV@SND_DAT = KX_SND_DAT;
      797    24767    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_CNF);
      798    24768    3                      KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;
      799    24769    3                      KV@SND_DAT.DAT__.BYTX = 0;
      800    24770    3                      KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ;
      801    24771    3                      CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN
      802    24772    4                            DO;
      803    24773    4                               KX$VC.CALCNFPND = '0'B;
      804    24774    4                               CALL KVB$RLSSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.
             24774                                        CALPKT$ );
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:35   
      805    24775    4                               KX$VC.CALPKT$ = ADDR(NIL);
      806    24776    4                               KX$VC.CALMSGBYTSIZ = 0;
      807    24777    4                            END;
      808    24778    3                      IF NOT KX$VC.VDHENTERED
      809    24779    3                         THEN
      810    24780    4                            DO;
      811    24781                                    %KV$USREXT;
             24787    4           KV$VDI.BSY = '0'B;
             24789    4           KV$PTR$ = KV@USRENT.SVDPTR$;
      812    24791    4                            END;
      813    24792    3                   END;
      814    24793        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:36   
      815    24794    2          CASE ( ELSE );
      816    24795
      817    24796    2             CALL KHD$SCREECH ( Y_UNKEVT );
      818    24797
      819    24798    2       END; /* DO CASE */
      820    24799    1       RETURN;
      821    24800
      822    24801    1   SCREECH_KXP: CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );
      823    24802
      824    24803
      825    24804        /*I*
      826    24805             NAME: Y$DECODE_X29
      827    24806             PURPOSE: The received packet has the Q-bit on and is thus an
      828    24807                      X.29 message. This routine decodes the X.29 protocol
      829    24808                      and changes the state and causes some actions, where
      830    24809                      appropriate.
      831    24810        */
      832    24811    1   Y$DECODE_X29: PROC;
      833    24812    2   DCL KX_X3_OK2SET(0:%KX_X3PRMX_HI#) BIT(1) CONSTANT
      834    24813    2     INIT ( '1'B,'0'B,'1'B*4,'0'B,'1'B*3,'0'B,'1'B*0 );
      835    24814    2   DCL X3_SET BIT(1);
      836    24815    2   DCL X29MSGTYP UBIN BYTE;
      837    24816
      838    24817    2       KX$VC.X3_PRM_BITS = '0'B;
      839    24818    2       BYTX = FPT_X25.V_.BYTX;
      840    24819    2       X29MSGTYP = BYT_ARY(BYTX);
      841    24820    2       IF ( X29MSGTYP = %KX_X29MSGTYP_SETX3# OR
      842    24821    2          X29MSGTYP = %KX_X29MSGTYP_SETREDX3# )
      843    24822    2          THEN
      844    24823    2             X3_SET = '1'B;
      845    24824    2          ELSE
      846    24825    2             X3_SET = '0'B;
      847    24826
      848    24827    3       DO CASE ( X29MSGTYP );
      849    24828
      850    24829        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:37   
      851    24830        /*
      852    24831           Set X.3 parameter PAD message.
      853    24832        */
      854    24833
      855    24834    3          CASE (%KX_X29MSGTYP_SETX3#,%KX_X29MSGTYP_SETREDX3#,%KX_X29MSGTYP_REDX3#);
      856    24835
      857    24836        /*
      858    24837           If set or set/read, copy these parameter values into the X.28 context block.
      859    24838        */
      860    24839    3             BYTX = BYTX + 1;
      861    24840    3             IF ( BYTX >= FPT_X25.V_.BYTSIZ+ FPT_X25.V_.BYTX )
      862    24841    3                THEN
      863    24842    3                   KX$VC.X3_PRM_ALL = '1'B;
      864    24843    4             DO WHILE ( BYTX < FPT_X25.V_.BYTSIZ+ FPT_X25.V_.BYTX );
      865    24844    4                PRM_INDEX = BYT_ARY (BYTX);
      866    24845    4                IF ( PRM_INDEX > %KX_X3PRMX_HI# + 1 ) OR
      867    24846    4                   ( NOT X3_SET AND BYT_ARY(BYTX+1)~=0 )
      868    24847    4                   THEN
      869    24848    5                      DO;
      870    24849    5                         ERCOD = BAD_SET_X3_MSG;
      871    24850    5                         KX$VC.ERRPADTYP = %KX_X29_ERRPADTYP_INC#;
      872    24851    5                         GOTO ERR_PAD;
      873    24852    5                      END;
      874    24853    4                KX$VC.X3_PRM_BIT ( PRM_INDEX - 1 ) = '1'B;
      875    24854    4                IF X3_SET AND KX_X3_OK2SET ( PRM_INDEX - 1 )
      876    24855    4                   THEN
      877    24856    4                      KX$VC.X3PRM ( PRM_INDEX - 1 ) = BYT_ARY ( BYTX + 1 );
      878    24857    4                BYTX = BYTX + 2;
      879    24858    4             END; /*  DO WHILE  */
      880    24859
      881    24860    3             IF ( X29MSGTYP = %KX_X29MSGTYP_REDX3# OR
      882    24861    3                X29MSGTYP = %KX_X29MSGTYP_SETREDX3# )
      883    24862    3                THEN
      884    24863    3                   CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_PRMIND#, KX$VC );
      885    24864        /*
      886    24865           Invitation to clear PAD message.
      887    24866        */
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:38   
      888    24867    3          CASE ( %KX_X29MSGTYP_INV2CLR# );
      889    24868
      890    24869        /*
      891    24870           Clear the circuit if all input data has been forwarded to VDH
      892    24871        */
      893    24872    3             IF NOT KX$VC.BLK_L3
      894    24873    3                THEN
      895    24874    4                   DO;
      896    24875    4                      CALL_FPT.EVN = %KX_P_EV_VCLST#;
      897    24876    4                      CALL KXP$PACKET ( CALL_FPT ) WHENALTRETURN
      898    24877    5                            DO;
      899    24878    5                               CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );
      900    24879    5                            END;
      901    24880    4                   END;
      902    24881    3                ELSE
      903    24882    4                   DO;
      904    24883    4                      KX$VC.INV2CLR = '1'B;
      905    24884    4                   END;
      906    24885        /*
      907    24886           The only other valid X.29 messages are:
      908    24887             Parameter indication PAD message,
      909    24888             Error PAD message,
      910    24889             Break indication PAD message,
      911    24890           Or the message code is invalid.
      912    24891           We do not expect any of these and should clear the circuit.
      913    24892        */
      914    24893    3          CASE (ELSE);
      915    24894    3             KX$VC.ERRPADTYP = %KX_X29_ERRPADTYP_BADCOD#;
      916    24895    3             ERCOD = BAD_PAD_MSG;
      917    24896    3   ERR_PAD:
      918    24897                  %WRSYSLOG ( ERRCOD = ERCOD,
      919    24898                  TRMID = "KX$VC.CHN$->KH$CHN.TERMID",
      920    24899                  BFR = "FPT_X25.V_.ADR$->KX$DATA" );
      921    24917    3             KX$VC.ERRPADCOD = X29MSGTYP;
      922    24918    3             CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_ERRPAD#, KX$VC );
      923    24919    3       END; /*  DO CASE  */
      924    24920
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:39   
      925    24921    2       IF X3_SET AND KX$VC.RPRX3  /* we have to tell the host */
      926    24922    2          THEN
      927    24923    3             DO;
      928    24924    3                KV@SND_DAT = KX_SND_DAT;
      929    24925    3                IF NOT KX$VC.X3PND
      930    24926    3                   THEN
      931    24927    4                      DO;
      932    24928    4                         KX$VC.CALMSGBYTSIZ = LENGTHC(VC_CAL);
      933    24929    4                         CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )
      934    24930    4                            WHENALTRETURN
      935    24931    5                               DO;
      936    24932    5                                  CALL KHD$SCREECH ( Y_NO_MEM );
      937    24933    5                               END;
      938    24934    4                         KX$VC.CALPKT$->VC$CAL = '0'B;
      939    24935    4                         KX$VC.CALPKT$->VC$CAL.FUNCTION = %KX_VCFNC_INDX3#;
      940    24936    4                         KX$VC.X3PND = '1'B;
      941    24937    4                         KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INDX3);
      942    24938    4                      END;
      943    24939    3                   ELSE
      944    24940    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_CNF);
      945    24941    3                KX$VC.CALPKT$->VC$CAL.X3 = KX$VC.X3PRM;
      946    24942    3                IF NOT KV$VDI.USRRQSDAT.RED
      947    24943    3                   THEN
      948    24944    3                      GOTO L_RETURN;
      949    24945    3                IF NOT KX$VC.VDHENTERED
      950    24946    3                   THEN
      951    24947    4                      DO;
      952    24948                              %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RETURN,
      953    24949                              SCHRSN = %KV_SCHRSN_DFR1 );
             24962    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24962                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24963    5           IF NOT VDI$->KV$VDI.BSY THEN DO;
             24964    5              VDI$->KV$VDI.BSY = '1'B;
             24965    5              KV@USRENT.SVDPTR$ = KV$PTR$;
             24966    5              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;
             24967    5              END;                         /* ELSE IF ~BSY                       */
             24968    5           ELSE DO;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:40   
             24969    5              VDI$->KV$VDI.DFR.USR(1) = '1'B;
             24970    5           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24970                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             24971    5              GOTO L_RETURN;
             24972    5              END;                         /* END IF                             */
      954    24975    4                      END;
      955    24976    3                KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;
      956    24977    3                KV@SND_DAT.DAT__.BYTX = 0;
      957    24978    3                KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ;
      958    24979    3                CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN
      959    24980    4                      DO;
      960    24981    4                         KX$VC.CALCNFPND = '0'B;
      961    24982    4                         CALL KVB$RLSSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ );
      962    24983    4                         KX$VC.CALPKT$ = ADDR(NIL);
      963    24984    4                         KX$VC.CALMSGBYTSIZ = 0;
      964    24985    4                      END;
      965    24986    3                IF NOT KX$VC.VDHENTERED
      966    24987    3                   THEN
      967    24988    4                      DO;
      968    24989                              %KV$USREXT;
             24995    4           KV$VDI.BSY = '0'B;
             24997    4           KV$PTR$ = KV@USRENT.SVDPTR$;
      969    24999    4                      END;
      970    25000    3             END;
      971    25001    2   L_RETURN:
      972    25002    2       RETURN;
      973    25003    2   END Y$DECODE_X29;
      974    25004
      975    25005    1   END KXV$VCVDH;

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:41   
--  Include file information  --

   KNH_MACRO_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV$SND.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KV$VDH.:E05TOU  is referenced.
   KV$GLBCTX.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KX_EQUS_E.:E05TOU  is referenced.
   KXX_MACROS_M.:E05TOU  is referenced.
   KX_MACROS_M.:E05TOU  is referenced.
   KX_SCODE_C.:E05TOU  is referenced.
   KX_PERR_C.:E05TOU  is referenced.
   KX_DATA_C.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:42   
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KXV$VCVDH.

   Procedure KXV$VCVDH requires 3016 words for executable code.
   Procedure KXV$VCVDH requires 60 words of local(AUTO) storage.

    No errors detected in file KXV$VCVDH.:E05TSI    .

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:43   

 Object Unit name= KXV$VCVDH                                  File name= KXV$VCVDH.:E05TOU
 UTS= JUL 30 '97 02:31:39.12 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    142     8E  KXV$VCVDH
    1   Data  even  none    63     3F  KXV$VCVDH
    2   Proc  even  none  3016    BC8  KXV$VCVDH
    3  RoData even  none    18     12  KXV$VCVDH

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  KXV$VCVDH
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:44   

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    1      0  KX_VDH_EVT_ATN                     1      2  VC_CAL
    1     19  VC_DAT                             1     1A  VC_INT
    1     1B  VC_RST                             1     1D  VC_CLR
    0     5D  KX_KEY_CAL_IND                     0     62  KX_KEY_CAL_CNF
    0     67  KX_KEY_DAT_IND                     0     6C  KX_KEY_INT_IND
    0     71  KX_KEY_INT_CNF                     0     76  KX_KEY_RST_IND
    0     7B  KX_KEY_RST_CNF                     0     80  KX_KEY_CLR_IND
    0     85  KX_KEY_INDX3                       1     27  KX_SND_DAT
    1     31  KX_VDOVLPARY                       0     8A  DWORD

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KXP$PACKET
 yes     yes           Std       2 KVB$RLS2NSYS
 yes     yes           Std       2 KVB$GETSYS
         yes           Std       1 KHD$SCREECH
 yes     yes           Std       2 KXX$INTCNC
 yes     yes           Std       1 KVV$VDI
 yes     yes           Std       2 KVB$RLSSYS
         yes           Std       1 KXX$RLSCTX
 yes     yes           Std       2 KXX$SNDX29MSG
         yes           Std       7 KXS$SYSLOG
 yes     yes           Std       1 KXV$VCVDH
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:45   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                          r    KH_CHNHI                         r    KH_CHNLOW
     KX_BUF                                KX_PM$                                G$JIT$
     KX_STATS_X29                          KXX_VDH_DSC                           KV_VDH_EVT_RLSVDI
     KV_VDH_EVT_RQSOTP                r    G$ROS$
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:46   


        1        1        /*T***********************************************************/
        2        2        /*T*                                                         */
        3        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        4        4        /*T*                                                         */
        5        5        /*T***********************************************************/
        6        6        /*P*
        7        7             NAME: KXV$VCVDH
        8        8             PURPOSE: Pcket level interface code.
        9        9                      Basically it is a transparent data transfer service
       10       10                      over an x.25 virtual circuit for host applications.
       11       11        */
       12       12        /*X*  PLM = 4, IND=3, CTI=3, DCI=6, IAD=0, DTI=6, AND=Y, CSI=3, THI=3, STI=3, DMC=Y
                12         */
       13       13        KXV$VCVDH: PROC ( FPT_X25 ) ALTRET;

     13   2 000000  D380 0000 0000  xent KXV$VCVDH       LNJ,B5   X6A_AUTO_1
          2 000003       003C 0001                       DC       60,1

       14       14
       15       15        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:47   
       16       16
       17       17        /*****************************************************************
       18       18        *                                                                *
       19       19        *                           Include files                        *
       20       20        *                                                                *
       21       21        *****************************************************************/
       22       22
       23       23        %INCLUDE LCP_6;
       24     4302        %INCLUDE G_JIT_M;
       25     4567        %INCLUDE KHA_FNC_E;
       26     4667        %INCLUDE KH_MACRO_C;
       27     5410        %INCLUDE KX_DATA_C;
       28     5478        %INCLUDE KX_PERR_C;
       29     5607        %INCLUDE KX_SCODE_C;
       30     5673        %INCLUDE KX_MACROS_M;
       31     6444        %INCLUDE KXX_MACROS_M;
       32     6786        %INCLUDE KX_EQUS_E;
       33     7225        %INCLUDE KV$GLB;
       34     7644        %INCLUDE KV$GLBCTX;
       35     8089        %INCLUDE KV$VDH;
       36     8520        %INCLUDE KV$VDO;
       37     9535        %KV_DATMOD_E;
       38     9541        %KV_DATCTRCHRTYP_E;
       39     9547        %KV_VDOVLP_E;
       40     9561        %INCLUDE KV$SND;
       41     9980        %KV_SND_FNC_E;
       42     9996        %INCLUDE KV_GLB_M;
       43    10118        %INCLUDE KV_GLBCNS_E;
       44    10459        %KV_STRTYP_E;
       45    10497        %KV_BFRRLSDSP_E;
       46    10503        %KV_VDH_EVT_ID_E;
       47    10509        %KV_SCHRSN_E;
       48    10516        %KV_DSCRSN_E;
       49    10525        %KV#CQ_HNDID_E;
       50    10530        %KV#DATMOD_E;
       51    10536        %INCLUDE KH$CHN;
       52    10658        %INCLUDE KH_CHN;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:48   
       53    10698        %INCLUDE K_ID_E;
       54    10748        %K#ENTID_E;
       55    10767        %K#LYRID_E;
       56    10774        %INCLUDE KL_MACRO_C;
       57    14126        %INCLUDE KL_AFCN_C;
       58    14227        %INCLUDE KL_SUPER_C;
       59    17129        %INCLUDE KH$STT;
       60    17159
       61    17160        %INCLUDE CP_6_SUBS;
       62    17700        %INCLUDE KV_ASCCHR_E;
       63    17837        %INCLUDE K_ADDRESS_M;
       64    18340        %INCLUDE KNH_MACRO_C;
       65    18623        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:49   
       66    18624        /*****************************************************************
       67    18625        *                                                                *
       68    18626        *                           Auto                                 *
       69    18627        *                                                                *
       70    18628        *****************************************************************/
       71    18629
       72    18630        %FPT_X25 ( STCLASS = );
       73    18674        %FPT_X25 ( FPTN = CALL_FPT, STCLASS = AUTO );
       74    18718    1   DCL L3$ PTR;
       75    18719    1   DCL VC$ PTR;
       76    18720    1   DCL VDI$ PTR;
       77    18721    1   DCL Y@BYTSIZ UBIN;
       78    18722    1   DCL BYTX UBIN;
       79    18723    1   DCL PRM_INDEX UBIN;
       80    18724    1   DCL KVBSIZ UBIN;
       81    18725    1   DCL DAT$ PTR;
       82    18726        %KV$VDH_DSC ( NAME = KV@VDH_DSC, STCLASS = AUTO );
       83    18762        %KV@USRENT;
       84    18782        %KV$VDH_DAT ( NAME = KV@SND_DAT, VDOVLPARY = KX_VDOVLPARY, STCLASS = AUTO );
       85    18862
       86    18863        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:50   
       87    18864        /*****************************************************************
       88    18865        *                                                                *
       89    18866        *                           Based                                *
       90    18867        *                                                                *
       91    18868        *****************************************************************/
       92    18869
       93    18870        %KX$VC_OTPBFR ( STCLASS = "BASED (DAT$)" );
       94    18897        %KX$VC ( STCLASS = "BASED (VC$)" );
       95    18988        %KV$VDI ( STCLASS = "BASED (VDI$)" );
       96    19059        %EQU KV_VDI = CHARTEXT('KV$VDI');
       97    19060        %KV$STR;
       98    19147        %EQU KVSTR = CHARTEXT('KV$VDI.ASNINPPTR$->KV$PTR.STR$->KV$STR');
       99    19148        %KH$CHN;
      100    19272        %G$JIT ( STCLASS = "BASED(G$JIT$)" );
      101    19686
      102    19687    1   DCL IN_STR CHAR(2000) ALIGNED BASED (FPT_X25.V_.ADR$);
      103    19688    1   DCL BYT_ARY(0:2000) UBIN BYTE CALIGNED BASED (FPT_X25.V_.ADR$);
      104    19689    1   DCL DSTR CHAR(2000) ALIGNED BASED ( DAT$ );
      105    19690        %KV$USRPRM;
      106    19741        %KV$STT;
      107    20135        %KV$PTR;
      108    20178        %KX$L2;
      109    20545        %KX$L3 ( STCLASS = "BASED ( L3$ )" );
      110    20948        %KX$LINKDEV ( STCLASS = "BASED(FPT_X25.PRM1$)" );
      111    20975        %VLP_SCODE ( FPTN=B$SCODE, STCLASS=BASED );
      112    21036        %KX$DATA ( STCLASS = BASED );
      113    21056        %VLP_ERRCODE ( STCLASS = AUTO, FPTN = ERCOD );
      114    21102        /*
      115    21103          Some based fpts.
      116    21104        */
      117    21105        %VC$CAL;
      118    21151        %VC$DAT;
      119    21172        %VC$INT;
      120    21193        %VC$RST;
      121    21214        %VC$CLR;
      122    21243        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:51   
      123    21244        /*****************************************************************
      124    21245        *                                                                *
      125    21246        *                           Constant/Symref                      *
      126    21247        *                                                                *
      127    21248        *****************************************************************/
      128    21249
      129    21250        %KH_CHNDAT;
      130    21268    1   DCL Y_POWER_OF_2(0:15) UBIN WORD CONSTANT INIT(1,2,4,8,16,32,64,128,
      131    21269    1    256,512,1024,2048,4096,8192,16384,32768);
      132    21270        %KX$VC ( FPTN = KX_VC, STCLASS = CONSTANT );
      133    21361
      134    21362        %KX_DATA;
      135    22052    1   DCL G$JIT$ PTR SYMREF;
      136    22053        %KV$USRPRM ( NAME = KX_USRPRM, STCLASS = SYMREF );
      137    22104        %KX_STATS_X29;
      138    22445        %KV$VDH_DSC ( NAME = KXX_VDH_DSC, STCLASS = SYMREF );
      139    22481        %KV$VDH_EVT ( ID = KV_VDH_EVT_ID_RLSVDI, NAME = KV_VDH_EVT_RLSVDI, STCLASS = SYMREF
             22481            );
      140    22516        %KV$VDH_EVT ( ID = KV_VDH_EVT_ID_RQSOTP, NAME = KV_VDH_EVT_RQSOTP, STCLASS = SYMREF
             22516            );
      141    22551        %KV$VDH_EVT ( ID = KV_VDH_EVT_ID_ATN, NAME = KX_VDH_EVT_ATN, STCLASS =
             22551            "STATIC SYMDEF" );
      142    22586        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_INFO#,
      143    22587                      FPTN = BAD_PAD_MSG,
      144    22588                      ERR# = %E_KXX_BAD_PAD_MSG# );
      145    22634        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_INFO#,
      146    22635                      FPTN = BAD_SET_X3_MSG,
      147    22636                      ERR# = %E_KXX_BAD_SET_X3_MSG# );
      148    22682        /*E*   ERROR: KXX-E_KXX_BAD_SET_X3_MSG#-0
      149    22683             MESSAGE: A bad x.29 read, or set, or set-and-read message
      150    22684                      was received.
      151    22685        */
      152    22686
      153    22687        %VLP_SCODE (FPTN=Y_NO_VCCTX,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_NO_VCCTX#);
      154    22748        %VLP_SCODE (FPTN=Y_BADRMTDCL,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_BADRMTDCL#);
      155    22809        %VLP_SCODE (FPTN=Y_UNKEVT,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_X29_UNKEVT#);
      156    22870        %VLP_SCODE (FPTN=Y_UNKSCHRSN,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKSCHRSN#);
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:52   
      157    22931        %VLP_SCODE (FPTN=Y_BADSTT,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_BADVCSTT#);
      158    22992        %VLP_SCODE (FPTN=Y_NO_MEM,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_NO_GET#);
      159    23053        %VLP_SCODE (FPTN=Y_ILG_EVT,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_ILG_EVT#);
      160    23114        /*
      161    23115          Some fpts and vdovlp_key.
      162    23116        */
      163    23117        %VC$CAL ( FPTN = VC_CAL, FUNCTION = CAL_IND, STCLASS = STATIC SYMDEF );
      164    23163        %VC$DAT ( FPTN = VC_DAT, FUNCTION = DAT_IND, STCLASS = STATIC SYMDEF );
      165    23184        %VC$INT ( FPTN = VC_INT, FUNCTION = INT_IND, STCLASS = STATIC SYMDEF );
      166    23205        %VC$RST ( FPTN = VC_RST, FUNCTION = RST_IND, STCLASS = STATIC SYMDEF );
      167    23226        %VC$CLR ( FPTN = VC_CLR, FUNCTION = CLR_IND, STCLASS = STATIC SYMDEF );
      168    23255        %KV$VDOVLP_KEY ( NAME = KX_KEY_CAL_IND, STCLASS = CONSTANT SYMDEF, LST = YES,
      169    23256           BYTSIZ = 8, LAST = "," );
      170    23306    1       2 DAT CHAR(8) CALIGNED INIT('NCAL_IND');
      171    23307        %KV$VDOVLP_KEY ( NAME = KX_KEY_CAL_CNF, STCLASS = CONSTANT SYMDEF, LST = YES ,
      172    23308           BYTSIZ = 8, LAST = "," );
      173    23358    1       2 DAT CHAR(8) CALIGNED INIT('NCAL_CNF');
      174    23359        %KV$VDOVLP_KEY ( NAME = KX_KEY_DAT_IND, STCLASS = CONSTANT SYMDEF, LST = YES,
      175    23360           BYTSIZ = 8, LAST = "," );
      176    23410    1       2 DAT CHAR(8) CALIGNED INIT('ADAT_IND');
      177    23411        %KV$VDOVLP_KEY ( NAME = KX_KEY_INT_IND, STCLASS = CONSTANT SYMDEF, LST = YES,
      178    23412           BYTSIZ = 8, LAST = "," );
      179    23462    1       2 DAT CHAR(8) CALIGNED INIT('AINT_IND');
      180    23463        %KV$VDOVLP_KEY ( NAME = KX_KEY_INT_CNF, STCLASS = CONSTANT SYMDEF, LST = YES,
      181    23464           BYTSIZ = 8, LAST = "," );
      182    23514    1       2 DAT CHAR(8) CALIGNED INIT('AINT_CNF');
      183    23515        %KV$VDOVLP_KEY ( NAME = KX_KEY_RST_IND, STCLASS = CONSTANT SYMDEF, LST = YES,
      184    23516           BYTSIZ = 8, LAST = "," );
      185    23566    1       2 DAT CHAR(8) CALIGNED INIT('ARST_IND');
      186    23567        %KV$VDOVLP_KEY ( NAME = KX_KEY_RST_CNF, STCLASS = CONSTANT SYMDEF, LST = YES,
      187    23568           BYTSIZ = 8, LAST = "," );
      188    23618    1       2 DAT CHAR(8) CALIGNED INIT('ARST_CNF');
      189    23619        %KV$VDOVLP_KEY ( NAME = KX_KEY_CLR_IND, STCLASS = CONSTANT SYMDEF, LST = YES,
      190    23620           BYTSIZ = 8, LAST = "," );
      191    23670    1       2 DAT CHAR(8) CALIGNED INIT('NCLR_IND');
      192    23671        %KV$VDOVLP_KEY ( NAME = KX_KEY_INDX3, STCLASS = CONSTANT SYMDEF, LST = YES,
      193    23672           BYTSIZ = 8, LAST = "," );
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:53   
      194    23722    1       2 DAT CHAR(8) CALIGNED INIT('AX3S_IND');
      195    23723        %KV$VDH_DAT ( NAME = KX_SND_DAT, STCLASS = STATIC SYMDEF,
      196    23724           VDOVLPARY = KX_VDOVLPARY, DATMOD = %KV#DATMOD_TRN );
      197    23804        %KV$SND ( NAME = KX_VDOVLPARY, HDR = NO, VLP = YES, STCLASS = STATIC SYMDEF );
      198    23837        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:54   
      199    23838        /*****************************************************************
      200    23839        *                                                                *
      201    23840        *                           Entry references                     *
      202    23841        *                                                                *
      203    23842        *****************************************************************/
      204    23843
      205    23844    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      206    23845    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      207    23846    1   DCL KVB$GET2NSYS ENTRY(2) ALTRET;
      208    23847    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
      209    23848    1   DCL KHD$SCREECH ENTRY (1) ;
      210    23849    1   DCL KXX$MRK ENTRY(1);
      211    23850    1   DCL KXX$RLSCTX ENTRY(1);
      212    23851    1   DCL KXX$INTCNC ENTRY (2) ALTRET;
      213    23852    1   DCL KXP$PACKET ENTRY(1) ALTRET;
      214    23853    1   DCL KVV$VDI ENTRY(1) ALTRET;
      215    23854    1   DCL KVV$INT ENTRY(1) ALTRET;
      216    23855    1   DCL KHA$DVCADM ENTRY(6) ALTRET;
      217    23856    1   DCL KHA$ERRLOG ENTRY (2) ALTRET;
      218    23857    1   DCL KXS$Q_SYSLOG ENTRY (1);
      219    23858    1   DCL KXS$SYSLOG ENTRY (7);
      220    23859    1   DCL DWORD UBIN(32) CONSTANT SYMDEF INIT(%BITBIN('EDA78'X));
      221    23860    1   DCL KVM$SND REDEF DWORD EPTR;
      222    23861    1   DCL KXX$SNDX29MSG ENTRY(2) ALTRET;
      223    23862
      224    23863        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:55   
      225    23864
      226    23865        /*****************************************************************
      227    23866        *                                                                *
      228    23867        *                           Procedure                            *
      229    23868        *                                                                *
      230    23869        *****************************************************************/
      231    23870
      232    23871
      233    23872    1       L3$ = FPT_X25.CAL$;

  23872   2 000005  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          2 000007  DCC6 0001                            LDB,B5   1,B6
          2 000009  DFC7 0016                            STB,B5   L3$,AUTO

      234    23873    1       VC$ = FPT_X25.RCV$;

  23873   2 00000B  CCC6 0003                            LDB,B4   3,B6
          2 00000D  CFC7 0018                            STB,B4   VC$,AUTO

      235    23874    1       IF VC$ ~= ADDR(NIL)

  23874   2 00000F  8DC7 0018                            CMN      VC$,AUTO
          2 000011  0901 0007                            BE       s:23881,PREL

      236    23875    1          THEN
      237    23876    2             DO;

      238    23877    2                VDI$ = KX$VC.VDI$;

  23877   2 000013  BCC4 0002                            LDB,B3   2,B4
          2 000015  BFC7 001A                            STB,B3   VDI$,AUTO

      239    23878    2             END;

  23878   2 000017  0F81 0006                            B        s:23887,PREL

      240    23879    1          ELSE
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:56   
      241    23880    2             DO;

      242    23881    2                VDI$ = ADDR(NIL);

  23881   2 000019  BB80 0000 0000                       LAB,B3   0
          2 00001C  BFC7 001A                            STB,B3   VDI$,AUTO

      243    23882    2             END;

      244    23883
      245    23884        /*
      246    23885           The only legal call to this interface without passing VC$ is RMTDCL.
      247    23886        */
      248    23887    1       IF VC$ = ADDR(NIL) AND FPT_X25.EVN ~= %KX_CM_EV_RMTDCL#

  23887   2 00001E  8DC7 0018                            CMN      VC$,AUTO
          2 000020  0981 000E                            BNE      s:23895,PREL
          2 000022  E806                                 LDR,R6   ,B6
          2 000023  6D02                                 CMV,R6   2
          2 000024  0901 000A                            BE       s:23895,PREL

      249    23888    1          THEN
      250    23889    2             DO;

      251    23890        /*S* SCREECH_CODE: KXV-S$KX_NO_VCCTX#
      252    23891             MESSAGE: Illegal call without passing VC context.
      253    23892        */
      254    23893    2                CALL KHD$SCREECH ( Y_NO_VCCTX );

  23893   2 000026  BB80 0000 0000  03                   LAB,B3   0
          2 000029  CBF0 0100                            LAB,B4   256,IMO
          2 00002B  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 00002E       0001                            DC       s:23895,PREL

      255    23894    2             END;

      256    23895    1       CALL_FPT = '0'B;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:57   

  23895   2 00002F  5C20                                 LDV,R5   32
          2 000030  0021                                 ALR      ;
          2 000031       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 000033       4007 0006                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

      257    23896    1       CALL_FPT.RCV$ = L3$;

  23896   2 000035  437F                                 CSYNC    s:23895+5,SPREL
          2 000036  ECC7 0016                            LDB,B6   L3$,AUTO
          2 000038  EFC7 0009                            STB,B6   CALL_FPT+3,AUTO

      258    23897    1       CALL_FPT.CAL$ = VC$;

  23897   2 00003A  DCC7 0018                            LDB,B5   VC$,AUTO
          2 00003C  DFC7 0007                            STB,B5   CALL_FPT+1,AUTO

      259    23898
      260    23899    2       DO CASE ( FPT_X25.EVN );

  23899   2 00003E  CCC7 0004                            LDB,B4   @FPT_X25,AUTO
          2 000040  B804                                 LDR,R3   ,B4
          2 000041  3D11                                 CMV,R3   17
          2 000042  0281 096E                            BGE      s:24796,PREL
          2 000044  A830 0000 004A  02                   LDR,R2   s:23899+12,R3
          2 000047  83A0 0000 005B  02                   JMP      s:23907,R2
          2 00004A       0956                            DC       s:24796,PREL
          2 00004B       0000                            DC       s:23907,PREL
          2 00004C       0396                            DC       s:24297,PREL
          2 00004D       07EE                            DC       s:24699,PREL
          2 00004E       0629                            DC       s:24548,PREL
          2 00004F       0629                            DC       s:24548,PREL
          2 000050       05A7                            DC       s:24478,PREL
          2 000051       021F                            DC       s:24147,PREL
          2 000052       0956                            DC       s:24796,PREL
          2 000053       005B                            DC       s:23943,PREL
          2 000054       0314                            DC       s:24228,PREL
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:58   
          2 000055       0956                            DC       s:24796,PREL
          2 000056       0110                            DC       s:24029,PREL
          2 000057       0956                            DC       s:24796,PREL
          2 000058       07E2                            DC       s:24688,PREL
          2 000059       0629                            DC       s:24548,PREL
          2 00005A       0511                            DC       s:24406,PREL

      261    23900
      262    23901        /*
      263    23902           EVENT DCL - An outbound circuit is requested. We would also get here
      264    23903                       when a circuit is attempting to call after a call delay.
      265    23904        */
      266    23905    2          CASE ( %KX_CM_EV_DCL# );

      267    23906
      268    23907    2             IF KX$VC.STATE = %KX_VC_ST_WCC#

  23907   2 00005B  E2C5 0033                            LLH,R6   51,B5
          2 00005D  6D04                                 CMV,R6   4
          2 00005E  0981 001F                            BNE      s:23921,PREL

      269    23908    2                THEN
      270    23909    3                   DO;

      271    23910    3                      CALL_FPT.EVN = %KX_P_EV_VCUP#;

  23910   2 000060  4C04                                 LDV,R4   4
          2 000061  CF47 0006                            STR,R4   CALL_FPT,AUTO

      272    23911    3                      IF KX$VC.CALMSGBYTSIZ > 0

  23911   2 000063  B845 0028                            LDR,R3   40,B5
          2 000065  3901 0009                            BEZ,R3   s:23918,PREL

      273    23912    3                         THEN
      274    23913    4                            DO;

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:59   
      275    23914    4                               CALL_FPT.V_.ADR$ = KX$VC.CALPKT$;

  23914   2 000067  BCC5 0026                            LDB,B3   38,B5
          2 000069  BFC7 0011                            STB,B3   CALL_FPT+11,AUTO

      276    23915    4                               CALL_FPT.V_.BYTX = 0;

  23915   2 00006B  8747 0013                            CL       CALL_FPT+13,AUTO

      277    23916    4                               CALL_FPT.V_.BYTSIZ = KX$VC.CALMSGBYTSIZ;

  23916   2 00006D  BF47 0014                            STR,R3   CALL_FPT+14,AUTO

      278    23917    4                            END;

      279    23918    3                      CALL KXP$PACKET ( CALL_FPT ) ALTRET ( SCREECH_KXP );

  23918   2 00006F  BBC7 0006                            LAB,B3   CALL_FPT,AUTO
          2 000071  BFC7 0036                            STB,B3   X29MSGTYP+1,AUTO
          2 000073  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000075  CBF0 0100                            LAB,B4   256,IMO
          2 000077  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 00007A       0943                            DC       s:24801,PREL

      280    23919    3                      RETURN;

  23919   2 00007B  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      281    23920    3                   END;
      282    23921    2             IF KX$VC.STATE ~= %KX_VC_ST_DCL#

  23921   2 00007E  6D01                                 CMV,R6   1
          2 00007F  0901 000A                            BE       s:23928,PREL

      283    23922    2                THEN
      284    23923        /*S* SCREECH_CODE: KXV-S$KX_ILG_EVT#
      285    23924             MESSAGE: Illegal event for this state.
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:60   
      286    23925        */
      287    23926    2   L_ILG_EVT:      CALL KHD$SCREECH ( Y_ILG_EVT );

  23926   2 000081  BB80 0000 0002  03   L_ILG_EVT       LAB,B3   +2
          2 000084  CBF0 0100                            LAB,B4   256,IMO
          2 000086  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000089       0001                            DC       s:23928,PREL

      288    23927
      289    23928    2             KX$VC.L3$ = FPT_X25.CAL$;

  23928   2 00008A  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          2 00008C  DCC6 0001                            LDB,B5   1,B6
          2 00008E  CCC7 0018                            LDB,B4   VC$,AUTO
          2 000090  DFC4 0006                            STB,B5   6,B4

      290    23929    2             KX$VC.CHN$ = FPT_X25.PRM2$;

  23929   2 000092  DCC6 0009                            LDB,B5   9,B6
          2 000094  CCC7 0018                            LDB,B4   VC$,AUTO
          2 000096  DFC4 0004                            STB,B5   4,B4

      291    23930    2             KX$VC.CHN$->KH$CHN.TERMID.TTYP = %KLTY_TTY#;

  23930   2 000098  DCC7 0018                            LDB,B5   VC$,AUTO
          2 00009A  CCC5 0004                            LDB,B4   4,B5
          2 00009C  6C02                                 LDV,R6   2
          2 00009D  E7C4 0012                            STH,R6   18,B4

      292    23931    2             CALL KXX$INTCNC ( KX$VC, KX$VC.RLCID ) ALTRET ( L_ILG_EVT );

  23931   2 00009F  DCC7 0018                            LDB,B5   VC$,AUTO
          2 0000A1  CBC5 002F                            LAB,B4   47,B5
          2 0000A3  CFC7 0038                            STB,B4   X29MSGTYP+3,AUTO
          2 0000A5  DFC7 0036                            STB,B5   X29MSGTYP+1,AUTO
          2 0000A7  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 0000A9  CBF0 0200                            LAB,B4   512,IMO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:61   
          2 0000AB  E380 0000 0000  xent                 LNJ,B6   KXX$INTCNC
          2 0000AE       FFD3                            DC       s:23926,PREL

      293    23932    2             FPT_X25.PRM1 = %KX_L3_TOACT_RSTRTR#;

  23932   2 0000AF  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          2 0000B1  6C03                                 LDV,R6   3
          2 0000B2  EF46 0005                            STR,R6   5,B6
          2 0000B4  0F81 0905                            B        s:24799,PREL

      294    23933
      295    23934        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:62   
      296    23935
      297    23936        /*
      298    23937           EVENT DATIN - pass it up to the application.
      299    23938                         The V_ L3 pass us always have a few bytes of room before
      300    23939                         the user data. We'll use that to place our VC$DAT fpt.
      301    23940        */
      302    23941    2          CASE ( %KX_CM_EV_DATIN# );

      303    23942
      304    23943    2             IF KX$VC.X28

  23943   2 0000B6  82C5 0016                            LB,'0010'X        22,B5
  23943   2 0000B8       0010
          2 0000B9  0581 0013                            BBF      s:23956,PREL

      305    23944    2                THEN
      306    23945    3                   DO;

      307    23946    3                      IF FPT_X25.PRS.PRM1    /* x29 packet */

  23946   2 0000BB  89C4 000F                            CMZ      15,B4
          2 0000BD  0881 0007                            BAGE     s:23952,PREL

      308    23947    3                         THEN
      309    23948    4                            DO;

      310    23949    4                               CALL Y$DECODE_X29;

  23949   2 0000BF  E3C0 0907                            LNJ,B6   s:0,PREL
          2 0000C1       0001                            DC       s:23950,PREL

      311    23950    4                               RETURN;

  23950   2 0000C2  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      312    23951    4                            END;
      313    23952    3                      IF KX$VC.X3PRM(%KX_X3PRMX_DSCOTP#) = 1
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:63   

  23952   2 0000C5  E2C5 001C                            LLH,R6   28,B5
          2 0000C7  6D01                                 CMV,R6   1
          2 0000C8  0981 0004                            BNE      s:23956,PREL

      314    23953    3                         THEN
      315    23954    3                            RETURN;  /* we were told to discard input */

  23954   2 0000CA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      316    23955    3                   END;
      317    23956    2             IF VDI$ ~= ADDR(NIL) AND KV$VDI.USRRQSDAT.RED

  23956   2 0000CD  8DC7 001A                            CMN      VDI$,AUTO
          2 0000CF  0901 0093                            BE       s:24016,PREL
          2 0000D1  BCC7 001A                            LDB,B3   VDI$,AUTO
          2 0000D3  82C3 001D                            LB,'0010'X        29,B3
          2 0000D5       0010
          2 0000D6  0581 008C                            BBF      s:24016,PREL

      318    23957    2                THEN
      319    23958    3                   DO;

      320    23959    3                      IF NOT KX$VC.VDHENTERED

  23959   2 0000D8  82C5 0016                            LB,'2000'X        22,B5
  23959   2 0000DA       2000
          2 0000DB  0501 002A                            BBT      s:23990,PREL

      321    23960    3                         THEN
      322    23961    4                            DO;

      323    23962                                    %KV$USRENT ( VDI$ = VDI$, DFR$ = BLK_L3,
      324    23963                                    SCHRSN = %KV_SCHRSN_DFR1 );
             23976    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             23976                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:64   
  23976   2 0000DD  ACC3 0008                            LDB,B2   8,B3
          2 0000DF  9CC2 0033                            LDB,B1   51,B2
          2 0000E1  8AC1 0039                            INC      57,B1
          2 0000E3  8EC1 0038                            CAD      56,B1

             23977    5           IF NOT VDI$->KV$VDI.BSY THEN DO;

  23977   2 0000E5  82C3 0019                            LB,'0080'X        25,B3
  23977   2 0000E7       0080
          2 0000E8  0501 0010                            BBT      s:23983,PREL

             23978    5              VDI$->KV$VDI.BSY = '1'B;

  23978   2 0000EA  8943 0019                            LBT,'0080'X       25,B3
  23978   2 0000EC       0080

             23979    5              KV@USRENT.SVDPTR$ = KV$PTR$;

  23979   2 0000ED  AC80 0000 0000  xsym                 LDB,B2   KV$PTR$
          2 0000F0  AFC7 0024                            STB,B2   KV@USRENT,AUTO

             23980    5              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;

  23980   2 0000F2  9CC3 0006                            LDB,B1   6,B3
          2 0000F4  9F80 0000 0000  xsym                 STB,B1   KV$PTR$

             23981    5              END;                         /* ELSE IF ~BSY                       */

  23981   2 0000F7  0F81 000E                            B        s:23990,PREL

             23982    5           ELSE DO;

             23983    5              VDI$->KV$VDI.DFR.USR(1) = '1'B;

  23983   2 0000F9  8943 0018                            LBT,'4000'X       24,B3
  23983   2 0000FB       4000

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:65   
             23984    5           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             23984                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  23984   2 0000FC  ACC3 0008                            LDB,B2   8,B3
          2 0000FE  9CC2 0033                            LDB,B1   51,B2
          2 000100  8AC1 003B                            INC      59,B1
          2 000102  8EC1 003A                            CAD      58,B1

             23985    5              GOTO BLK_L3;

  23985   2 000104  0F81 005E                            B        s:24016,PREL

             23986    5              END;                         /* END IF                             */
      325    23989    4                            END;
      326    23990    3                      VC_DAT.Q = FPT_X25.PRS.PRM1;

  23990   2 000106  E844 000F                            LDR,R6   15,B4
          2 000108  6048                                 SOR,R6   8
          2 000109  EA80 0000 0019  01                   SRM,R6,'0080'X    VC_DAT
          2 00010C       0080

      327    23991    3                      VC_DAT.M = FPT_X25.PRS.PRM2;

  23991   2 00010D  E844 000F                            LDR,R6   15,B4
          2 00010F  6048                                 SOR,R6   8
          2 000110  EA80 0000 0019  01                   SRM,R6,'0040'X    VC_DAT
          2 000113       0040

      328    23992    3                      SUBSTR(FPT_X25.V_.ADR$->DSTR,FPT_X25.V_.BYTX-LENGTHC(VC_DAT),
             23992                               LENGTHC(VC_DAT))

  23992   2 000114  ACC4 000B                            LDB,B2   11,B4
          2 000116  E844 000D                            LDR,R6   13,B4
          2 000118  AFC7 0036                            STB,B2   X29MSGTYP+1,AUTO
          2 00011A  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 00011D  2C32                                 LDV,R2   50
          2 00011E  EF47 0038                            STR,R6   X29MSGTYP+3,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:66   
          2 000120  6C02                                 LDV,R6   2
          2 000121  BCC7 0036                            LDB,B3   X29MSGTYP+1,AUTO
          2 000123  B847 0038                            LDR,R3   X29MSGTYP+3,AUTO
          2 000125  3EFE                                 ADV,R3   -2
          2 000126  0008                                 MMM

      329    23993    3                         = SUBSTR(ADDR(VC_DAT)->DSTR,0,LENGTHC(VC_DAT));
      330    23994    3                      KV@SND_DAT = KX_SND_DAT;

  23994   2 000127  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 00012A  2C4E                                 LDV,R2   78
          2 00012B  6C14                                 LDV,R6   20
          2 00012C  BB87                                 LAB,B3   ,AUTO
          2 00012D  3C4C                                 LDV,R3   76
          2 00012E  0008                                 MMM

      331    23995    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_DAT_IND);

  23995   2 00012F  EB80 0000 0067  00                   LAB,B6   KX_KEY_DAT_IND
          2 000132  EF80 0000 003B  01                   STB,B6   KX_VDOVLPARY+10

      332    23996    3                      KV@SND_DAT.DAT__.ADR$ = FPT_X25.V_.ADR$;

  23996   2 000135  DCC4 000B                            LDB,B5   11,B4
          2 000137  DFC7 0027                            STB,B5   KV@SND_DAT+1,AUTO

      333    23997    3                      KV@SND_DAT.DAT__.BYTX = FPT_X25.V_.BYTX - LENGTHC(VC_DAT);

  23997   2 000139  E844 000D                            LDR,R6   13,B4
          2 00013B  6EFE                                 ADV,R6   -2
          2 00013C  EF47 0029                            STR,R6   KV@SND_DAT+3,AUTO

      334    23998    3                     KV@SND_DAT.DAT__.DATBYTSIZ = FPT_X25.V_.BYTSIZ + LENGTHC(VC_DAT);

  23998   2 00013E  C844 000E                            LDR,R4   14,B4
          2 000140  4E02                                 ADV,R4   2
          2 000141  CF47 002A                            STR,R4   KV@SND_DAT+4,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:67   

      335    23999    3                      CALL KVV$VDI ( KV@SND_DAT ) ALTRET ( BLK_L3 );

  23999   2 000143  ABC7 0026                            LAB,B2   KV@SND_DAT,AUTO
          2 000145  AFC7 0036                            STB,B2   X29MSGTYP+1,AUTO
          2 000147  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000149  CBF0 0100                            LAB,B4   256,IMO
          2 00014B  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00014E       0015                            DC       s:24016,PREL

      336    24000    3                      IF NOT KX$VC.VDHENTERED

  24000   2 00014F  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000151  82C6 0016                            LB,'2000'X        22,B6
          2 000153       2000
          2 000154  0501 000B                            BBT      s:24013,PREL

      337    24001    3                         THEN
      338    24002    4                            DO;

      339    24003                                    %KV$USREXT;
             24009    4           KV$VDI.BSY = '0'B;

  24009   2 000156  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 000158  8845 0019                            LBF,'0080'X       25,B5
          2 00015A       0080

             24011    4           KV$PTR$ = KV@USRENT.SVDPTR$;

  24011   2 00015B  ECC7 0024                            LDB,B6   KV@USRENT,AUTO
          2 00015D  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      340    24013    4                            END;

      341    24014    3   L_RET:             RETURN;

  24014   2 000160  C380 0000 0000  xent L_RET           LNJ,B4   X6A_ARET
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:68   

      342    24015    3                   END;
      343    24016    2   BLK_L3:   KX$VC.BLK_L3 = '1'B;

  24016   2 000163  ECC7 0018            BLK_L3          LDB,B6   VC$,AUTO
          2 000165  8946 0016                            LBT,'4000'X       22,B6
          2 000167       4000

      344    24017    2             ALTRETURN;  /* leave the data with L3 */

  24017   2 000168  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      345    24018        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:69   
      346    24019
      347    24020        /*
      348    24021           EVENT DATRQS - release transmitted output buffers. Send
      349    24022                          queued messages.
      350    24023        */
      351    24024    2          CASE ( %KX_CM_EV_DATRQS# );

      352    24025
      353    24026        /*
      354    24027           Do we have anything to send ?
      355    24028        */
      356    24029    2             IF KX$VC.SND.HED$ = ADDR(NIL)

  24029   2 00016B  8DC5 000C                            CMN      12,B5
          2 00016D  0981 0009                            BNE      s:24037,PREL

      357    24030    2                THEN
      358    24031    3                   DO;

      359    24032    3   Y@DFR1:            KX$VC.RPRDAT = '1'B;

  24032   2 00016F  ECC7 0018            Y@DFR1          LDB,B6   VC$,AUTO
          2 000171  8946 0016                            LBT,'8000'X       22,B6
          2 000173       8000

      360    24033    3                      RETURN;

  24033   2 000174  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      361    24034    3                   END;
      362    24035        /*
      363    24036        */
      364    24037    2             IF VDI$ ~= ADDR(NIL)

  24037   2 000177  8DC7 001A                            CMN      VDI$,AUTO
          2 000179  0901 00A8                            BE       s:24108,PREL

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:70   
      365    24038    2                THEN
      366    24039    3                   DO;

      367    24040    3                      IF NOT KX$VC.VDHENTERED

  24040   2 00017B  82C5 0016                            LB,'2000'X        22,B5
  24040   2 00017D       2000
          2 00017E  0501 002B                            BBT      s:24071,PREL

      368    24041    3                         THEN
      369    24042    4                            DO;

      370    24043                                    %KV$USRENT ( VDI$ = VDI$, DFR$ = Y@DFR1,
      371    24044                                    SCHRSN = %KV_SCHRSN_DFR0 );
             24057    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24057                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24057   2 000180  BCC7 001A                            LDB,B3   VDI$,AUTO
          2 000182  ACC3 0008                            LDB,B2   8,B3
          2 000184  9CC2 0033                            LDB,B1   51,B2
          2 000186  8AC1 0039                            INC      57,B1
          2 000188  8EC1 0038                            CAD      56,B1

             24058    5           IF NOT VDI$->KV$VDI.BSY THEN DO;

  24058   2 00018A  82C3 0019                            LB,'0080'X        25,B3
  24058   2 00018C       0080
          2 00018D  0501 0010                            BBT      s:24064,PREL

             24059    5              VDI$->KV$VDI.BSY = '1'B;

  24059   2 00018F  8943 0019                            LBT,'0080'X       25,B3
  24059   2 000191       0080

             24060    5              KV@USRENT.SVDPTR$ = KV$PTR$;

  24060   2 000192  AC80 0000 0000  xsym                 LDB,B2   KV$PTR$
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:71   
          2 000195  AFC7 0024                            STB,B2   KV@USRENT,AUTO

             24061    5              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;

  24061   2 000197  9CC3 0006                            LDB,B1   6,B3
          2 000199  9F80 0000 0000  xsym                 STB,B1   KV$PTR$

             24062    5              END;                         /* ELSE IF ~BSY                       */

  24062   2 00019C  0F81 000D                            B        s:24071,PREL

             24063    5           ELSE DO;

             24064    5              VDI$->KV$VDI.DFR.USR(0) = '1'B;

  24064   2 00019E  8943 0018                            LBT,'8000'X       24,B3
  24064   2 0001A0       8000

             24065    5           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24065                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24065   2 0001A1  ACC3 0008                            LDB,B2   8,B3
          2 0001A3  9CC2 0033                            LDB,B1   51,B2
          2 0001A5  8AC1 003B                            INC      59,B1
          2 0001A7  8EC1 003A                            CAD      58,B1

             24066    5              GOTO Y@DFR1;

  24066   2 0001A9  0FC6                                 B        s:24031,SPREL

             24067    5              END;                         /* END IF                             */
      372    24070    4                            END;
      373    24071    4                      DO WHILE ( KX$VC.SND.HED$ ~= KX$VC.SND.NXTLOD$ );

  24071   2 0001AA  BCC7 0018                            LDB,B3   VC$,AUTO
          2 0001AC  ACC3 000C                            LDB,B2   12,B3
          2 0001AE  ADC3 000E                            CMB,B2   14,B3
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:72   
          2 0001B0  0901 0040                            BE       s:24082,PREL

      374    24072    4                         DAT$ = KX$VC.SND.HED$;

  24072   2 0001B2  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0001B4  DCC6 000C                            LDB,B5   12,B6
          2 0001B6  DFC7 0020                            STB,B5   DAT$,AUTO

      375    24073    4                         KX$VC.SND.HED$ = KX$VC_OTPBFR.LNK$;

  24073   2 0001B8  CC85                                 LDB,B4   ,B5
          2 0001B9  CFC6 000C                            STB,B4   12,B6

      376    24074    4                         Y@BYTSIZ = KX$VC_OTPBFR.BFRBYTSIZ;

  24074   2 0001BB  ECC7 0020                            LDB,B6   DAT$,AUTO
          2 0001BD  E846 0002                            LDR,R6   2,B6
          2 0001BF  E570 3FFF                            AND,R6   16383,IMO
          2 0001C1  EF47 001C                            STR,R6   Y@BYTSIZ,AUTO

      377    24075    4                         KX$VC.OTPBFRBYTCNT = KX$VC.OTPBFRBYTCNT - Y@BYTSIZ;

  24075   2 0001C3  DCC7 0018                            LDB,B5   VC$,AUTO
          2 0001C5  E245 0014                            SUB,R6   20,B5
          2 0001C7  8256                                 NEG      R6
          2 0001C8  EF45 0014                            STR,R6   20,B5

      378    24076    4                         CALL KVB$RLS2NSYS ( KX$VC_OTPBFR.RLSWRDSIZ, DAT$ );

  24076   2 0001CA  EBC7 0020                            LAB,B6   DAT$,AUTO
          2 0001CC  EFC7 0038                            STB,B6   X29MSGTYP+3,AUTO
          2 0001CE  DCC7 0020                            LDB,B5   DAT$,AUTO
          2 0001D0  CBC5 0004                            LAB,B4   4,B5
          2 0001D2  CFC7 0036                            STB,B4   X29MSGTYP+1,AUTO
          2 0001D4  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 0001D6  CBF0 0200                            LAB,B4   512,IMO
          2 0001D8  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:73   
          2 0001DB       0001                            DC       s:24077,PREL

      379    24077    4                         KX_STATS_X29.KHSTT.OTPBFRBYTUTL = KX_STATS_X29.KHSTT.
             24077                                  OTPBFRBYTUTL - Y@BYTSIZ;

  24077   2 0001DC  F847 001C                            LDR,R7   Y@BYTSIZ,AUTO
          2 0001DE  6C00                                 LDV,R6   0
          2 0001DF  8480 0000 001E  xsym                 SID      KX_STATS_X29+30
          2 0001E2  8656                                 CPL      R6
          2 0001E3  8657                                 CPL      R7
          2 0001E4  8470 0000 0001                       AID      1,IMO
          2 0001E7  8D00 0000 001E  xsym                 SDI      KX_STATS_X29+30

      380    24078    4                      END;

  24078   2 0001EA  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0001EC  DCC6 000C                            LDB,B5   12,B6
          2 0001EE  DDC6 000E                            CMB,B5   14,B6
          2 0001F0  09C2                                 BNE      s:24072,SPREL

      381    24079        /*
      382    24080           Let's unblock.
      383    24081        */
      384    24082    3                      IF KX$VC.OTPBFRBYTCNT <= KX$VC.MAXOTPBYT

  24082   2 0001F1  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0001F3  E846 0014                            LDR,R6   20,B6
          2 0001F5  E946 0015                            CMR,R6   21,B6
          2 0001F7  0301 0014                            BG       s:24102,PREL

      385    24083    3                         THEN
      386    24084                                 %KV$RQSOTP ( RQSOTP = YES );
             24096    4           IF NOT KV$VDI.RQSOTP  THEN DO;

  24096   2 0001F9  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 0001FB  82C5 0019                            LB,'0008'X        25,B5
          2 0001FD       0008
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:74   
          2 0001FE  0501 000D                            BBT      s:24102,PREL

             24097    4              KV$VDI.RQSOTP = '1'B;

  24097   2 000200  8945 0019                            LBT,'0008'X       25,B5
  24097   2 000202       0008

             24098    4              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);

  24098   2 000203  BB80 0000 0004  03                   LAB,B3   +4
          2 000206  CBF0 0100                            LAB,B4   256,IMO
          2 000208  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00020B       0001                            DC       s:24102,PREL

             24099    4              END;                         /* END IF                             */

      387    24102    3                      IF %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RLSVDI)

  24102   2 00020C  ECC7 001A                            LDB,B6   VDI$,AUTO
          2 00020E  82C6 001F                            LB,'0002'X        31,B6
          2 000210       0002
          2 000211  0581 0010                            BBF      s:24108,PREL
          2 000213  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000215  8DC5 000C                            CMN      12,B5
          2 000217  0981 000A                            BNE      s:24108,PREL

      388    24103    3                         AND KX$VC.SND.HED$ = ADDR(NIL)
      389    24104    3                         THEN
      390    24105        /* complete the releasing of VDI.                                */
      391    24106    3                            CALL KVV$VDI(KV_VDH_EVT_RLSVDI) ;

  24106   2 000219  BB80 0000 0006  03                   LAB,B3   +6
          2 00021C  CBF0 0100                            LAB,B4   256,IMO
          2 00021E  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000221       0001                            DC       s:24108,PREL

      392    24107    3                   END;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:75   

      393    24108    2             IF KX$VC.SND.HED$ = ADDR(NIL)

  24108   2 000222  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000224  8DC6 000C                            CMN      12,B6
          2 000226  0981 0014                            BNE      s:24117,PREL

      394    24109    2                THEN
      395    24110    3                   DO;

      396    24111    3                      KX$VC.SND.NXTLOD$ = ADDR(NIL);

  24111   2 000228  DB80 0000 0000                       LAB,B5   0
          2 00022B  DFC6 000E                            STB,B5   14,B6

      397    24112    3                      KX$VC.SND.TAL$ = ADDR(NIL);

  24112   2 00022D  EB80 0000 0000                       LAB,B6   0
          2 000230  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000232  EFC5 0010                            STB,B6   16,B5

      398    24113    3                      KX$VC.RPRDAT = '1'B;

  24113   2 000234  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000236  8946 0016                            LBT,'8000'X       22,B6
          2 000238       8000

      399    24114    3                   END;

  24114   2 000239  0F81 0028                            B        s:24125,PREL

      400    24115    2                ELSE
      401    24116    3                   DO;

      402    24117    3                      DAT$ = KX$VC.SND.NXTLOD$;

  24117   2 00023B  DCC6 000E                            LDB,B5   14,B6
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:76   
          2 00023D  DFC7 0020                            STB,B5   DAT$,AUTO

      403    24118    3                      KX$VC.SND.NXTLOD$ = KX$VC_OTPBFR.LNK$;

  24118   2 00023F  CC85                                 LDB,B4   ,B5
          2 000240  CFC6 000E                            STB,B4   14,B6

      404    24119    3                      FPT_X25.V_.ADR$ = DAT$;

  24119   2 000242  ECC7 0020                            LDB,B6   DAT$,AUTO
          2 000244  DCC7 0004                            LDB,B5   @FPT_X25,AUTO
          2 000246  EFC5 000B                            STB,B6   11,B5

      405    24120    3                      FPT_X25.V_.BYTX = LENGTHC ( KX$VC_OTPBFR );

  24120   2 000248  6C0A                                 LDV,R6   10
          2 000249  EF45 000D                            STR,R6   13,B5

      406    24121    3                      FPT_X25.V_.BYTSIZ = KX$VC_OTPBFR.BFRBYTSIZ - FPT_X25.V_.BYTX;

  24121   2 00024B  CCC7 0020                            LDB,B4   DAT$,AUTO
          2 00024D  D844 0002                            LDR,R5   2,B4
          2 00024F  D570 3FFF                            AND,R5   16383,IMO
          2 000251  D256                                 SUB,R5   R6
          2 000252  DF45 000E                            STR,R5   14,B5

      407    24122    3                      FPT_X25.PRS.PRM1 = KX$VC_OTPBFR.Q;

  24122   2 000254  CCC7 0020                            LDB,B4   DAT$,AUTO
          2 000256  C844 0002                            LDR,R4   2,B4
          2 000258  CAC5 000F                            SRM,R4,'8000'X    15,B5
          2 00025A       8000

      408    24123    3                      FPT_X25.PRS.PRM2 = KX$VC_OTPBFR.M;

  24123   2 00025B  CCC7 0020                            LDB,B4   DAT$,AUTO
          2 00025D  C844 0002                            LDR,R4   2,B4
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:77   
          2 00025F  CAC5 000F                            SRM,R4,'4000'X    15,B5
          2 000261       4000

      409    24124    3                   END;

      410    24125    2             IF VDI$ ~= ADDR(NIL) AND NOT KX$VC.VDHENTERED

  24125   2 000262  8DC7 001A                            CMN      VDI$,AUTO
          2 000264  0901 0012                            BE       s:24139,PREL
          2 000266  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000268  82C6 0016                            LB,'2000'X        22,B6
          2 00026A       2000
          2 00026B  0501 000B                            BBT      s:24139,PREL

      411    24126    2                THEN
      412    24127    3                   DO;

      413    24128                           %KV$USREXT;
             24134    3           KV$VDI.BSY = '0'B;

  24134   2 00026D  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 00026F  8845 0019                            LBF,'0080'X       25,B5
          2 000271       0080

             24136    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  24136   2 000272  ECC7 0024                            LDB,B6   KV@USRENT,AUTO
          2 000274  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      414    24138    3                   END;

      415    24139    2             RETURN;

  24139   2 000277  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      416    24140        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:78   
      417    24141
      418    24142        /*
      419    24143           EVENT INT - interrupt packet received. Pass it up to the application.
      420    24144        */
      421    24145    2          CASE ( %KX_CM_EV_INT# );

      422    24146
      423    24147    2             IF KX$VC.STATE ~= %KX_VC_ST_NRM#

  24147   2 00027A  E2C5 0033                            LLH,R6   51,B5
          2 00027C  6D06                                 CMV,R6   6
          2 00027D  0901 0004                            BE       s:24150,PREL

      424    24148    2                THEN
      425    24149    2                   RETURN;

  24149   2 00027F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      426    24150    2             KX$VC.INTINDPND = '1'B;

  24150   2 000282  8945 0016                            LBT,'0400'X       22,B5
  24150   2 000284       0400

      427    24151    2             VC_INT.FUNCTION = %KX_VCFNC_INT_IND#;

  24151   2 000285  4C08                                 LDV,R4   8
          2 000286  C780 0000 001A  01                   STH,R4   VC_INT

      428    24152    2             VC_INT.INTDATLNG = FPT_X25.V_.BYTSIZ;

  24152   2 000289  B844 000E                            LDR,R3   14,B4
          2 00028B  BA80 0000 001A  01                   SRM,R3,'00FF'X    VC_INT
          2 00028E       00FF

      429    24153    2             Y@BYTSIZ = LENGTHC(VC_INT) + FPT_X25.V_.BYTSIZ;

  24153   2 00028F  B844 000E                            LDR,R3   14,B4
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:79   
          2 000291  3E02                                 ADV,R3   2
          2 000292  BF47 001C                            STR,R3   Y@BYTSIZ,AUTO

      430    24154    2             KX$VC.INTMSGBYTSIZ = Y@BYTSIZ;

  24154   2 000294  BCC7 0018                            LDB,B3   VC$,AUTO
          2 000296  BF43 002E                            STR,R3   46,B3

      431    24155    2             CALL KVB$GETSYS ( (Y@BYTSIZ+1)/2, KX$VC.INTPKT$ ) WHENALTRETURN

  24155   2 000298  3E01                                 ADV,R3   1
          2 000299  3041                                 SOR,R3   1
          2 00029A  BF47 0036                            STR,R3   X29MSGTYP+1,AUTO
          2 00029C  ABC3 002C                            LAB,B2   44,B3
          2 00029E  AFC7 0039                            STB,B2   X29MSGTYP+4,AUTO
          2 0002A0  9BC7 0036                            LAB,B1   X29MSGTYP+1,AUTO
          2 0002A2  9FC7 0037                            STB,B1   X29MSGTYP+2,AUTO
          2 0002A4  BBC7 0037                            LAB,B3   X29MSGTYP+2,AUTO
          2 0002A6  CBF0 0200                            LAB,B4   512,IMO
          2 0002A8  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 0002AB       0003                            DC       s:24156,PREL
          2 0002AC  0F81 000A                            B        s:24159,PREL

      432    24156    3                   DO;

      433    24157    3   NO_MEM:            CALL KHD$SCREECH ( Y_NO_MEM );

  24157   2 0002AE  BB80 0000 0008  03   NO_MEM          LAB,B3   +8
          2 0002B1  CBF0 0100                            LAB,B4   256,IMO
          2 0002B3  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 0002B6       0001                            DC       s:24159,PREL

      434    24158    3                   END;

      435    24159    2             KX$VC.INTPKT$->VC$INT = VC_INT;

  24159   2 0002B7  ECC7 0018                            LDB,B6   VC$,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:80   
          2 0002B9  DCC6 002C                            LDB,B5   44,B6
          2 0002BB  E800 0000 001A  01                   LDR,R6   VC_INT
          2 0002BE  EF05                                 STR,R6   ,B5

      436    24160    2             SUBSTR (KX$VC.INTPKT$->DSTR,LENGTHC(VC_INT),FPT_X25.V_.BYTSIZ) =

  24160   2 0002BF  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0002C1  DCC6 002C                            LDB,B5   44,B6
          2 0002C3  CCC7 0004                            LDB,B4   @FPT_X25,AUTO
          2 0002C5  E844 000E                            LDR,R6   14,B4
          2 0002C7  BCC4 000B                            LDB,B3   11,B4
          2 0002C9  D844 000D                            LDR,R5   13,B4
          2 0002CB  AB83                                 LAB,B2   ,B3
          2 0002CC  A855                                 LDR,R2   R5
          2 0002CD  BB85                                 LAB,B3   ,B5
          2 0002CE  3C02                                 LDV,R3   2
          2 0002CF  0008                                 MMM

      437    24161    2                SUBSTR (FPT_X25.V_.ADR$->DSTR,FPT_X25.V_.BYTX,FPT_X25.V_.BYTSIZ);
      438    24162    2             IF NOT KV$VDI.USRRQSDAT.RED

  24162   2 0002D0  ECC7 001A                            LDB,B6   VDI$,AUTO
          2 0002D2  82C6 001D                            LB,'0010'X        29,B6
          2 0002D4       0010
          2 0002D5  0581 FE8A                            BBF      s:24013,PREL

      439    24163    2                THEN
      440    24164    2                   GOTO L_RET;   /* wait for next read from host */
      441    24165    2             IF NOT KX$VC.VDHENTERED

  24165   2 0002D7  ACC7 0018                            LDB,B2   VC$,AUTO
          2 0002D9  82C2 0016                            LB,'2000'X        22,B2
          2 0002DB       2000
          2 0002DC  0501 0033                            BBT      s:24196,PREL

      442    24166    2                THEN
      443    24167    3                   DO;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:81   

      444    24168                           %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET,
      445    24169                           SCHRSN = %KV_SCHRSN_DFR1 );
             24182    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24182                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24182   2 0002DE  9CC6 0008                            LDB,B1   8,B6
          2 0002E0  ECC1 0033                            LDB,B6   51,B1
          2 0002E2  9CC7 001A                            LDB,B1   VDI$,AUTO
          2 0002E4  DCC1 0008                            LDB,B5   8,B1
          2 0002E6  BCC5 0033                            LDB,B3   51,B5
          2 0002E8  8CC3 0038                            LDI      56,B3
          2 0002EA  8470 0000 0001                       AID      1,IMO
          2 0002ED  8D46 0038                            SDI      56,B6

             24183    4           IF NOT VDI$->KV$VDI.BSY THEN DO;

  24183   2 0002EF  82C1 0019                            LB,'0080'X        25,B1
  24183   2 0002F1       0080
          2 0002F2  0501 0010                            BBT      s:24189,PREL

             24184    4              VDI$->KV$VDI.BSY = '1'B;

  24184   2 0002F4  8941 0019                            LBT,'0080'X       25,B1
  24184   2 0002F6       0080

             24185    4              KV@USRENT.SVDPTR$ = KV$PTR$;

  24185   2 0002F7  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 0002FA  EFC7 0024                            STB,B6   KV@USRENT,AUTO

             24186    4              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;

  24186   2 0002FC  DCC1 0006                            LDB,B5   6,B1
          2 0002FE  DF80 0000 0000  xsym                 STB,B5   KV$PTR$

             24187    4              END;                         /* ELSE IF ~BSY                       */
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:82   

  24187   2 000301  0F81 000E                            B        s:24196,PREL

             24188    4           ELSE DO;

             24189    4              VDI$->KV$VDI.DFR.USR(1) = '1'B;

  24189   2 000303  8941 0018                            LBT,'4000'X       24,B1
  24189   2 000305       4000

             24190    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24190                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24190   2 000306  ECC1 0008                            LDB,B6   8,B1
          2 000308  DCC6 0033                            LDB,B5   51,B6
          2 00030A  8AC5 003B                            INC      59,B5
          2 00030C  8EC5 003A                            CAD      58,B5

             24191    4              GOTO L_RET;

  24191   2 00030E  0F81 FE51                            B        s:24013,PREL

             24192    4              END;                         /* END IF                             */
      446    24195    3                   END;
      447    24196    2             KV@SND_DAT = KX_SND_DAT;

  24196   2 000310  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 000313  2C4E                                 LDV,R2   78
          2 000314  6C14                                 LDV,R6   20
          2 000315  BB87                                 LAB,B3   ,AUTO
          2 000316  3C4C                                 LDV,R3   76
          2 000317  0008                                 MMM

      448    24197    2             KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INT_IND);

  24197   2 000318  EB80 0000 006C  00                   LAB,B6   KX_KEY_INT_IND
          2 00031B  EF80 0000 003B  01                   STB,B6   KX_VDOVLPARY+10
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:83   

      449    24198    2             KV@SND_DAT.DAT__.ADR$ = KX$VC.INTPKT$;

  24198   2 00031E  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000320  ACC5 002C                            LDB,B2   44,B5
          2 000322  AFC7 0027                            STB,B2   KV@SND_DAT+1,AUTO

      450    24199    2             KV@SND_DAT.DAT__.BYTX = 0;

  24199   2 000324  8747 0029                            CL       KV@SND_DAT+3,AUTO

      451    24200    2             KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.INTMSGBYTSIZ;

  24200   2 000326  E845 002E                            LDR,R6   46,B5
          2 000328  EF47 002A                            STR,R6   KV@SND_DAT+4,AUTO

      452    24201    2             CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN

  24201   2 00032A  9BC7 0026                            LAB,B1   KV@SND_DAT,AUTO
          2 00032C  9FC7 0036                            STB,B1   X29MSGTYP+1,AUTO
          2 00032E  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000330  CBF0 0100                            LAB,B4   256,IMO
          2 000332  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000335       0027                            DC       s:24208,PREL

      453    24202    3                   DO;

      454    24203    3                      KX$VC.INTINDPND = '0'B;

  24203   2 000336  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000338  8846 0016                            LBF,'0400'X       22,B6
          2 00033A       0400

      455    24204    3                      CALL KVB$RLSSYS ( (KX$VC.INTMSGBYTSIZ+1)/2, KX$VC.INTPKT$ );

  24204   2 00033B  ECC7 0018                            LDB,B6   VC$,AUTO
          2 00033D  E846 002E                            LDR,R6   46,B6
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:84   
          2 00033F  6E01                                 ADV,R6   1
          2 000340  6041                                 SOR,R6   1
          2 000341  EF47 0036                            STR,R6   X29MSGTYP+1,AUTO
          2 000343  DBC6 002C                            LAB,B5   44,B6
          2 000345  DFC7 0039                            STB,B5   X29MSGTYP+4,AUTO
          2 000347  CBC7 0036                            LAB,B4   X29MSGTYP+1,AUTO
          2 000349  CFC7 0037                            STB,B4   X29MSGTYP+2,AUTO
          2 00034B  BBC7 0037                            LAB,B3   X29MSGTYP+2,AUTO
          2 00034D  CBF0 0200                            LAB,B4   512,IMO
          2 00034F  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000352       0001                            DC       s:24205,PREL

      456    24205    3                      KX$VC.INTPKT$ = ADDR(NIL);

  24205   2 000353  EB80 0000 0000                       LAB,B6   0
          2 000356  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000358  EFC5 002C                            STB,B6   44,B5

      457    24206    3                      KX$VC.INTMSGBYTSIZ = 0;

  24206   2 00035A  8745 002E                            CL       46,B5

      458    24207    3                   END;

      459    24208    2             IF NOT KX$VC.VDHENTERED

  24208   2 00035C  ECC7 0018                            LDB,B6   VC$,AUTO
          2 00035E  82C6 0016                            LB,'2000'X        22,B6
          2 000360       2000
          2 000361  0501 0658                            BBT      s:24799,PREL

      460    24209    2                THEN
      461    24210    3                   DO;

      462    24211                           %KV$USREXT;
             24217    3           KV$VDI.BSY = '0'B;

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:85   
  24217   2 000363  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 000365  8845 0019                            LBF,'0080'X       25,B5
          2 000367       0080

             24219    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  24219   2 000368  ECC7 0024                            LDB,B6   KV@USRENT,AUTO
          2 00036A  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      463    24221    3                   END;

  24221   2 00036D  0F81 064C                            B        s:24799,PREL

      464    24222        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:86   
      465    24223        /*
      466    24224           EVENT INTACK - pass the interrupt acknowledgement to the application
      467    24225        */
      468    24226    2          CASE ( %KX_CM_EV_INTACK# );

      469    24227
      470    24228    2             IF KX$VC.STATE ~= %KX_VC_ST_NRM#

  24228   2 00036F  E2C5 0033                            LLH,R6   51,B5
          2 000371  6D06                                 CMV,R6   6
          2 000372  0901 0004                            BE       s:24231,PREL

      471    24229    2                THEN
      472    24230    2                   RETURN;

  24230   2 000374  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      473    24231    2             KX$VC.INTCNFPND = '1'B;

  24231   2 000377  8945 0016                            LBT,'0200'X       22,B5
  24231   2 000379       0200

      474    24232    2             IF NOT KV$VDI.USRRQSDAT.RED

  24232   2 00037A  BCC7 001A                            LDB,B3   VDI$,AUTO
          2 00037C  82C3 001D                            LB,'0010'X        29,B3
          2 00037E       0010
          2 00037F  0581 FDE0                            BBF      s:24013,PREL

      475    24233    2                THEN
      476    24234    2                   GOTO L_RET;
      477    24235    2             IF NOT KX$VC.VDHENTERED

  24235   2 000381  ACC7 0018                            LDB,B2   VC$,AUTO
          2 000383  82C2 0016                            LB,'2000'X        22,B2
          2 000385       2000
          2 000386  0501 002A                            BBT      s:24266,PREL
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:87   

      478    24236    2                THEN
      479    24237    3                   DO;

      480    24238                           %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET,
      481    24239                           SCHRSN = %KV_SCHRSN_DFR1 );
             24252    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24252                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24252   2 000388  9CC3 0008                            LDB,B1   8,B3
          2 00038A  ECC1 0033                            LDB,B6   51,B1
          2 00038C  8AC6 0039                            INC      57,B6
          2 00038E  8EC6 0038                            CAD      56,B6

             24253    4           IF NOT VDI$->KV$VDI.BSY THEN DO;

  24253   2 000390  82C3 0019                            LB,'0080'X        25,B3
  24253   2 000392       0080
          2 000393  0501 0010                            BBT      s:24259,PREL

             24254    4              VDI$->KV$VDI.BSY = '1'B;

  24254   2 000395  8943 0019                            LBT,'0080'X       25,B3
  24254   2 000397       0080

             24255    4              KV@USRENT.SVDPTR$ = KV$PTR$;

  24255   2 000398  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 00039B  EFC7 0024                            STB,B6   KV@USRENT,AUTO

             24256    4              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;

  24256   2 00039D  ACC3 0006                            LDB,B2   6,B3
          2 00039F  AF80 0000 0000  xsym                 STB,B2   KV$PTR$

             24257    4              END;                         /* ELSE IF ~BSY                       */

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:88   
  24257   2 0003A2  0F81 000E                            B        s:24266,PREL

             24258    4           ELSE DO;

             24259    4              VDI$->KV$VDI.DFR.USR(1) = '1'B;

  24259   2 0003A4  8943 0018                            LBT,'4000'X       24,B3
  24259   2 0003A6       4000

             24260    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24260                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24260   2 0003A7  ECC3 0008                            LDB,B6   8,B3
          2 0003A9  ACC6 0033                            LDB,B2   51,B6
          2 0003AB  8AC2 003B                            INC      59,B2
          2 0003AD  8EC2 003A                            CAD      58,B2

             24261    4              GOTO L_RET;

  24261   2 0003AF  0F81 FDB0                            B        s:24013,PREL

             24262    4              END;                         /* END IF                             */
      482    24265    3                   END;
      483    24266    2             VC_INT.FUNCTION = %KX_VCFNC_INT_CNF#;

  24266   2 0003B1  6C09                                 LDV,R6   9
          2 0003B2  E780 0000 001A  01                   STH,R6   VC_INT

      484    24267    2             KV@SND_DAT = KX_SND_DAT;

  24267   2 0003B5  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 0003B8  2C4E                                 LDV,R2   78
          2 0003B9  6C14                                 LDV,R6   20
          2 0003BA  BB87                                 LAB,B3   ,AUTO
          2 0003BB  3C4C                                 LDV,R3   76
          2 0003BC  0008                                 MMM

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:89   
      485    24268    2             KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INT_CNF);

  24268   2 0003BD  EB80 0000 0071  00                   LAB,B6   KX_KEY_INT_CNF
          2 0003C0  EF80 0000 003B  01                   STB,B6   KX_VDOVLPARY+10

      486    24269    2             KV@SND_DAT.DAT__.ADR$ = ADDR(VC_INT);

  24269   2 0003C3  DB80 0000 001A  01                   LAB,B5   VC_INT
          2 0003C6  DFC7 0027                            STB,B5   KV@SND_DAT+1,AUTO

      487    24270    2             KV@SND_DAT.DAT__.BYTX = 0;

  24270   2 0003C8  8747 0029                            CL       KV@SND_DAT+3,AUTO

      488    24271    2             KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_INT);

  24271   2 0003CA  6C02                                 LDV,R6   2
          2 0003CB  EF47 002A                            STR,R6   KV@SND_DAT+4,AUTO

      489    24272    2             CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN

  24272   2 0003CD  ABC7 0026                            LAB,B2   KV@SND_DAT,AUTO
          2 0003CF  AFC7 0036                            STB,B2   X29MSGTYP+1,AUTO
          2 0003D1  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 0003D3  CBF0 0100                            LAB,B4   256,IMO
          2 0003D5  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0003D8       0006                            DC       s:24276,PREL

      490    24273    3                   DO;

      491    24274    3                      KX$VC.INTCNFPND = '0'B;

  24274   2 0003D9  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0003DB  8846 0016                            LBF,'0200'X       22,B6
          2 0003DD       0200

      492    24275    3                   END;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:90   

      493    24276    2             IF NOT KX$VC.VDHENTERED

  24276   2 0003DE  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0003E0  82C6 0016                            LB,'2000'X        22,B6
          2 0003E2       2000
          2 0003E3  0501 05D6                            BBT      s:24799,PREL

      494    24277    2                THEN
      495    24278    3                   DO;

      496    24279                           %KV$USREXT;
             24285    3           KV$VDI.BSY = '0'B;

  24285   2 0003E5  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 0003E7  8845 0019                            LBF,'0080'X       25,B5
          2 0003E9       0080

             24287    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  24287   2 0003EA  ECC7 0024                            LDB,B6   KV@USRENT,AUTO
          2 0003EC  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      497    24289    3                   END;

  24289   2 0003EF  0F81 05CA                            B        s:24799,PREL

      498    24290        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:91   
      499    24291
      500    24292        /*
      501    24293           EVENT RMTDCL - received a new circuit call.
      502    24294        */
      503    24295    2          CASE ( %KX_CM_EV_RMTDCL# );

      504    24296
      505    24297    2             IF VC$ ~= ADDR(NIL)

  24297   2 0003F1  8DC7 0018                            CMN      VC$,AUTO
          2 0003F3  0901 000A                            BE       s:24303,PREL

      506    24298    2                THEN
      507    24299    3                   DO;

      508    24300    3                      CALL KHD$SCREECH ( Y_BADRMTDCL );

  24300   2 0003F5  BB80 0000 000A  03                   LAB,B3   +10
          2 0003F8  CBF0 0100                            LAB,B4   256,IMO
          2 0003FA  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 0003FD       0001                            DC       s:24303,PREL

      509    24301    3                   END;

      510    24302
      511    24303    2             CALL KVB$GETSYS(SIZEW(KX$VC),VC$) WHENALTRETURN

  24303   2 0003FE  EBF0 0034                            LAB,B6   52,IMO
          2 000400  DBC7 0018                            LAB,B5   VC$,AUTO
          2 000402  DFC7 0038                            STB,B5   X29MSGTYP+3,AUTO
          2 000404  EFC7 0036                            STB,B6   X29MSGTYP+1,AUTO
          2 000406  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000408  CBF0 0200                            LAB,B4   512,IMO
          2 00040A  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 00040D       0003                            DC       s:24304,PREL
          2 00040E  0F81 0025                            B        s:24314,PREL

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:92   
      512    24304    3                   DO;

      513    24305    3   L_CLRVC:           CALL_FPT.EVN = %KX_P_EV_VCLST#;

  24305   2 000410  6C09                 L_CLRVC         LDV,R6   9
          2 000411  EF47 0006                            STR,R6   CALL_FPT,AUTO

      514    24306    3                      CALL_FPT.PRM1 = %KX_DIAG_CALPRB#; /* call setup problem  */

  24306   2 000413  5C40                                 LDV,R5   64
          2 000414  DF47 000B                            STR,R5   CALL_FPT+5,AUTO

      515    24307    3                      CALL_FPT.PRS.PRM1 = '1'B;

  24307   2 000416  8947 0015                            LBT,'8000'X       CALL_FPT+15,AUTO
  24307   2 000418       8000

      516    24308    3                      CALL KXP$PACKET ( CALL_FPT ) ALTRET ( SCREECH_KXP );

  24308   2 000419  EBC7 0006                            LAB,B6   CALL_FPT,AUTO
          2 00041B  EFC7 0036                            STB,B6   X29MSGTYP+1,AUTO
          2 00041D  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 00041F  CBF0 0100                            LAB,B4   256,IMO
          2 000421  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 000424       0599                            DC       s:24801,PREL

      517    24309    3                      IF VC$ ~= ADDR(NIL)

  24309   2 000425  8DC7 0018                            CMN      VC$,AUTO
          2 000427  0901 0009                            BE       s:24312,PREL

      518    24310    3                         THEN
      519    24311    3                            CALL KXX$RLSCTX ( KX$VC );

  24311   2 000429  BBC7 0018                            LAB,B3   VC$,AUTO
          2 00042B  CBF0 0100                            LAB,B4   256,IMO
          2 00042D  E380 0000 0000  xent                 LNJ,B6   KXX$RLSCTX
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:93   
          2 000430       0001                            DC       s:24312,PREL

      520    24312    3                      RETURN;

  24312   2 000431  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      521    24313    3                   END;
      522    24314    2             KX$VC = KX_VC;

  24314   2 000434  AB80 0000 0000  00                   LAB,B2   0
          2 000437  2C20                                 LDV,R2   32
          2 000438  6C67                                 LDV,R6   103
          2 000439  BCC7 0018                            LDB,B3   VC$,AUTO
          2 00043B  3C00                                 LDV,R3   0
          2 00043C  0008                                 MMM

      523    24315    2             Y@BYTSIZ = FPT_X25.V_.BYTX + FPT_X25.V_.BYTSIZ - LENGTHC(KX$DATA);

  24315   2 00043D  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          2 00043F  E846 000D                            LDR,R6   13,B6
          2 000441  EA46 000E                            ADD,R6   14,B6
          2 000443  6EF0                                 ADV,R6   -16
          2 000444  EF47 001C                            STR,R6   Y@BYTSIZ,AUTO

      524    24316    2             KX$VC.CALMSGBYTSIZ = Y@BYTSIZ + LENGTHC(VC_CAL);

  24316   2 000446  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000448  6E2E                                 ADV,R6   46
          2 000449  EF45 0028                            STR,R6   40,B5

      525    24317    2             CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ ) ALTRET (
             24317                      L_CLRVC );

  24317   2 00044B  6E01                                 ADV,R6   1
          2 00044C  6041                                 SOR,R6   1
          2 00044D  EF47 0036                            STR,R6   X29MSGTYP+1,AUTO
          2 00044F  CBC5 0026                            LAB,B4   38,B5
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:94   
          2 000451  CFC7 0039                            STB,B4   X29MSGTYP+4,AUTO
          2 000453  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000455  BFC7 0037                            STB,B3   X29MSGTYP+2,AUTO
          2 000457  BBC7 0037                            LAB,B3   X29MSGTYP+2,AUTO
          2 000459  CBF0 0200                            LAB,B4   512,IMO
          2 00045B  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 00045E       FFB2                            DC       s:24304,PREL

      526    24318    2             VC_CAL.FUNCTION = %KX_VCFNC_CAL_IND#;

  24318   2 00045F  6C02                                 LDV,R6   2
          2 000460  E780 0000 0002  01                   STH,R6   VC_CAL

      527    24319    2             VC_CAL.CLGADRLNG = KX$L3.CALL_OPTS.RCVADR.SIZ;

  24319   2 000463  ECC7 0016                            LDB,B6   L3$,AUTO
          2 000465  D2C6 0017                            LLH,R5   23,B6
          2 000467  5004                                 SOL,R5   4
          2 000468  DA80 0000 0002  01                   SRM,R5,'00F0'X    VC_CAL
          2 00046B       00F0

      528    24320    2             VC_CAL.CLGADRSTRING = KX$L3.CALL_OPTS.RCVADR.ADR_STRING;

  24320   2 00046C  AB86                                 LAB,B2   ,B6
          2 00046D  2C2F                                 LDV,R2   47
          2 00046E  6C07                                 LDV,R6   7
          2 00046F  BB80 0000 0000  01                   LAB,B3   KX_VDH_EVT_ATN
          2 000472  3C06                                 LDV,R3   6
          2 000473  0008                                 MMM

      529    24321    2             VC_CAL.CLDADRLNG = KX$L3.L2$->KX$L2.NTWADR.LNG;

  24321   2 000474  DCC7 0016                            LDB,B5   L3$,AUTO
          2 000476  CCC5 0002                            LDB,B4   2,B5
          2 000478  E844 0039                            LDR,R6   57,B4
          2 00047A  EA80 0000 0002  01                   SRM,R6,'000F'X    VC_CAL
          2 00047D       000F
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:95   

      530    24322    2             VC_CAL.CLDADRSTRING = KX$L3.L2$->KX$L2.NTWADR.ADR_STRING;

  24322   2 00047E  CCC5 0002                            LDB,B4   2,B5
          2 000480  AB84                                 LAB,B2   ,B4
          2 000481  2C74                                 LDV,R2   116
          2 000482  6C07                                 LDV,R6   7
          2 000483  BB80 0000 0000  01                   LAB,B3   KX_VDH_EVT_ATN
          2 000486  3C0D                                 LDV,R3   13
          2 000487  0008                                 MMM

      531    24323    2             VC_CAL.FSTSLC = KX$L3.FSTSLC;

  24323   2 000488  DCC7 0016                            LDB,B5   L3$,AUTO
          2 00048A  E845 0029                            LDR,R6   41,B5
          2 00048C  6008                                 SOL,R6   8
          2 00048D  EA80 0000 000B  01                   SRM,R6,'C000'X    VC_CAL+9
          2 000490       C000

      532    24324    2             VC_CAL.RVS = KX$L3.RVS;

  24324   2 000491  E845 0029                            LDR,R6   41,B5
          2 000493  600C                                 SOL,R6   12
          2 000494  EA80 0000 000B  01                   SRM,R6,'1000'X    VC_CAL+9
          2 000497       1000

      533    24325    2             VC_CAL.USRDATLNG = FPT_X25.V_.BYTSIZ;

  24325   2 000498  BCC7 0004                            LDB,B3   @FPT_X25,AUTO
          2 00049A  E843 000E                            LDR,R6   14,B3
          2 00049C  EF00 0000 0017  01                   STR,R6   VC_CAL+21

      534    24326    2             VC_CAL.USRDATBYTX = FPT_X25.V_.BYTX - LENGTHC(KX$DATA);

  24326   2 00049F  D843 000D                            LDR,R5   13,B3
          2 0004A1  5EF0                                 ADV,R5   -16
          2 0004A2  DF00 0000 0018  01                   STR,R5   VC_CAL+22
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:96   

      535    24327    2             KX$VC.CALPKT$->VC$CAL = VC_CAL;

  24327   2 0004A5  9CC7 0018                            LDB,B1   VC$,AUTO
          2 0004A7  ECC1 0026                            LDB,B6   38,B1
          2 0004A9  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 0004AC  2C04                                 LDV,R2   4
          2 0004AD  6C2E                                 LDV,R6   46
          2 0004AE  BB86                                 LAB,B3   ,B6
          2 0004AF  3C00                                 LDV,R3   0
          2 0004B0  0008                                 MMM

      536    24328    2             SUBSTR (KX$VC.CALPKT$->DSTR,LENGTHC(VC_CAL),Y@BYTSIZ) =

  24328   2 0004B1  DCC7 0018                            LDB,B5   VC$,AUTO
          2 0004B3  ACC5 0026                            LDB,B2   38,B5
          2 0004B5  9CC7 0004                            LDB,B1   @FPT_X25,AUTO
          2 0004B7  ECC1 000B                            LDB,B6   11,B1
          2 0004B9  AFC7 0036                            STB,B2   X29MSGTYP+1,AUTO
          2 0004BB  AB86                                 LAB,B2   ,B6
          2 0004BC  2C10                                 LDV,R2   16
          2 0004BD  E847 001C                            LDR,R6   Y@BYTSIZ,AUTO
          2 0004BF  BCC7 0036                            LDB,B3   X29MSGTYP+1,AUTO
          2 0004C1  3C2E                                 LDV,R3   46
          2 0004C2  0008                                 MMM

      537    24329    2                SUBSTR (IN_STR,LENGTHC(KX$DATA),Y@BYTSIZ);
      538    24330
      539    24331    2             KX_STATS_X29.KHSTT.CTXBYTUTL =

  24331   2 0004C3  8C80 0000 0020  xsym                 LDI      KX_STATS_X29+32
          2 0004C6  8470 0000 0068                       AID      104,IMO
          2 0004C9  8D00 0000 0020  xsym                 SDI      KX_STATS_X29+32

      540    24332    2                SIZEC(KX$VC) + KX_STATS_X29.KHSTT.CTXBYTUTL;
      541    24333    2             KX_STATS_X29.LINSPDDST(15) = KX_STATS_X29.LINSPDDST(15) + 1;

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:97   
  24333   2 0004CC  8A80 0000 0041  xsym                 INC      KX_STATS_X29+65
          2 0004CF  8E80 0000 0040  xsym                 CAD      KX_STATS_X29+64

      542    24334    2             KX_STATS_X29.CIRCUITS = KX_STATS_X29.CIRCUITS + 1;

  24334   2 0004D2  8A80 0000 004B  xsym                 INC      KX_STATS_X29+75
          2 0004D5  8E80 0000 004A  xsym                 CAD      KX_STATS_X29+74

      543    24335
      544    24336    2             KX$VC.BLNK$ = KX$LINKDEV.L4_TAIL$;

  24336   2 0004D8  ECC1 0007                            LDB,B6   7,B1
          2 0004DA  DCC6 000E                            LDB,B5   14,B6
          2 0004DC  ACC7 0018                            LDB,B2   VC$,AUTO
          2 0004DE  DFC2 000A                            STB,B5   10,B2

      545    24337    2             IF KX$LINKDEV.L4_TAIL$ = ADDR(NIL)

  24337   2 0004E0  ECC1 0007                            LDB,B6   7,B1
          2 0004E2  8DC6 000E                            CMN      14,B6
          2 0004E4  0981 0007                            BNE      s:24341,PREL

      546    24338    2                THEN
      547    24339    2                   KX$LINKDEV.L4_HEAD$ = VC$;

  24339   2 0004E6  DCC7 0018                            LDB,B5   VC$,AUTO
          2 0004E8  DFC6 000C                            STB,B5   12,B6
          2 0004EA  0F81 0007                            B        s:24342,PREL

      548    24340    2                ELSE
      549    24341    2                   KX$LINKDEV.L4_TAIL$->KX$VC.FLNK$ = VC$;

  24341   2 0004EC  DCC6 000E                            LDB,B5   14,B6
          2 0004EE  ACC7 0018                            LDB,B2   VC$,AUTO
          2 0004F0  AFC5 0008                            STB,B2   8,B5

      550    24342    2             KX$LINKDEV.L4_TAIL$ = VC$;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:98   

  24342   2 0004F2  ECC1 0007                            LDB,B6   7,B1
          2 0004F4  DCC7 0018                            LDB,B5   VC$,AUTO
          2 0004F6  DFC6 000E                            STB,B5   14,B6

      551    24343        /*
      552    24344                  KX$LINKDEV.CRCCNT = KX$LINKDEV.CRCCNT + 1;
      553    24345           Always pass back the ctx$ in the fpt.
      554    24346        */
      555    24347    2             FPT_X25.RCV$ = VC$;

  24347   2 0004F8  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0004FA  EFC1 0003                            STB,B6   3,B1

      556    24348    2             FPT_X25.PRM1 = %KX_L3_TOACT_RSTRTR#;

  24348   2 0004FC  6C03                                 LDV,R6   3
          2 0004FD  EF41 0005                            STR,R6   5,B1

      557    24349
      558    24350    2             KX$VC.STATE = %KX_VC_ST_RMTDCL#;

  24350   2 0004FF  5C02                                 LDV,R5   2
          2 000500  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000502  D7C5 0033                            STH,R5   51,B5

      559    24351    2             KX$VC.CHN$ = FPT_X25.PRM2$;

  24351   2 000504  ECC1 0009                            LDB,B6   9,B1
          2 000506  EFC5 0004                            STB,B6   4,B5

      560    24352    2             KX$VC.CHN$->KH$CHN.TERMID.TTYP = %KLTY_TTY#;

  24352   2 000508  ECC7 0018                            LDB,B6   VC$,AUTO
          2 00050A  DCC6 0004                            LDB,B5   4,B6
          2 00050C  D7C5 0012                            STH,R5   18,B5

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:99   
      561    24353    2             KX$VC.L3$ = FPT_X25.CAL$;

  24353   2 00050E  ECC1 0001                            LDB,B6   1,B1
          2 000510  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000512  EFC5 0006                            STB,B6   6,B5

      562    24354    2             KX$VC.CNTL$ = FPT_X25.PRM1$;

  24354   2 000514  ECC1 0007                            LDB,B6   7,B1
          2 000516  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000518  EFC5 0012                            STB,B6   18,B5

      563    24355        /*   event the AU about incoming circuit through control connection.
      564    24356             FPT_X25.PRM1$ is the control connection context pointer. */
      565    24357
      566    24358    2             VDI$ = KX$LINKDEV.VDI$;

  24358   2 00051A  ECC1 0007                            LDB,B6   7,B1
          2 00051C  DCC6 0002                            LDB,B5   2,B6
          2 00051E  DFC7 001A                            STB,B5   VDI$,AUTO

      567    24359                  %KV$USRENT ( VDI$ = VDI$, DFR$ = Y@DFR4,
      568    24360                  SCHRSN = %KV_SCHRSN_DFR2 );
             24373    2           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24373                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24373   2 000520  ACC5 0008                            LDB,B2   8,B5
          2 000522  ECC2 0033                            LDB,B6   51,B2
          2 000524  8AC6 0039                            INC      57,B6
          2 000526  8EC6 0038                            CAD      56,B6

             24374    3           IF NOT VDI$->KV$VDI.BSY THEN DO;

  24374   2 000528  82C5 0019                            LB,'0080'X        25,B5
  24374   2 00052A       0080
          2 00052B  0501 0010                            BBT      s:24380,PREL

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:100  
             24375    3              VDI$->KV$VDI.BSY = '1'B;

  24375   2 00052D  8945 0019                            LBT,'0080'X       25,B5
  24375   2 00052F       0080

             24376    3              KV@USRENT.SVDPTR$ = KV$PTR$;

  24376   2 000530  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 000533  EFC7 0024                            STB,B6   KV@USRENT,AUTO

             24377    3              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;

  24377   2 000535  ACC5 0006                            LDB,B2   6,B5
          2 000537  AF80 0000 0000  xsym                 STB,B2   KV$PTR$

             24378    3              END;                         /* ELSE IF ~BSY                       */

  24378   2 00053A  0F81 000E                            B        s:24386,PREL

             24379    3           ELSE DO;

             24380    3              VDI$->KV$VDI.DFR.USR(2) = '1'B;

  24380   2 00053C  8945 0018                            LBT,'2000'X       24,B5
  24380   2 00053E       2000

             24381    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24381                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24381   2 00053F  ECC5 0008                            LDB,B6   8,B5
          2 000541  ACC6 0033                            LDB,B2   51,B6
          2 000543  8AC2 003B                            INC      59,B2
          2 000545  8EC2 003A                            CAD      58,B2

             24382    3              GOTO Y@DFR4;

  24382   2 000547  0F81 001B                            B        s:24399,PREL
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:101  

             24383    3              END;                         /* END IF                             */
      569    24386    2             KX_VDH_EVT_ATN.PRM = 1;

  24386   2 000549  4C01                                 LDV,R4   1
          2 00054A  CF00 0000 0001  01                   STR,R4   KX_VDH_EVT_ATN+1

      570    24387    2             CALL KVV$VDI ( KX_VDH_EVT_ATN );

  24387   2 00054D  BB80 0000 000C  03                   LAB,B3   +12
          2 000550  CBF0 0100                            LAB,B4   256,IMO
          2 000552  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000555       0001                            DC       s:24394,PREL

      571    24388                  %KV$USREXT ( VDI$ = VDI$ );
             24394    2           KV$VDI.BSY = '0'B;

  24394   2 000556  ECC7 001A                            LDB,B6   VDI$,AUTO
          2 000558  8846 0019                            LBF,'0080'X       25,B6
          2 00055A       0080

             24396    2           KV$PTR$ = KV@USRENT.SVDPTR$;

  24396   2 00055B  DCC7 0024                            LDB,B5   KV@USRENT,AUTO
          2 00055D  DF80 0000 0000  xsym                 STB,B5   KV$PTR$

      572    24398    2             RETURN;

  24398   2 000560  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      573    24399    2   Y@DFR4:   KX$LINKDEV.PNDEVTCNT = KX$LINKDEV.PNDEVTCNT + 1;

  24399   2 000563  ECC1 0007            Y@DFR4          LDB,B6   7,B1
          2 000565  C2C6 0017                            LLH,R4   23,B6
          2 000567  4E01                                 ADV,R4   1
          2 000568  C7C6 0017                            STH,R4   23,B6
          2 00056A  0F81 044F                            B        s:24799,PREL
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:102  

      574    24400        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:103  
      575    24401        /*
      576    24402            EVENT RSTIND - Pass the reset packet up to the application.
      577    24403        */
      578    24404    2          CASE ( %KX_CM_EV_RSTIND# );

      579    24405
      580    24406    2             IF KX$VC.STATE ~= %KX_VC_ST_NRM#

  24406   2 00056C  E2C5 0033                            LLH,R6   51,B5
          2 00056E  6D06                                 CMV,R6   6
          2 00056F  0901 0004                            BE       s:24409,PREL

      581    24407    2                THEN
      582    24408    2                   RETURN;

  24408   2 000571  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      583    24409    2             VC_RST.FUNCTION = %KX_VCFNC_RST_IND#;

  24409   2 000574  4C0B                                 LDV,R4   11
          2 000575  C780 0000 001B  01                   STH,R4   VC_RST

      584    24410    2             VC_RST.CAUSE = FPT_X25.PRM1;

  24410   2 000578  B844 0005                            LDR,R3   5,B4
          2 00057A  BA80 0000 001B  01                   SRM,R3,'00FF'X    VC_RST
          2 00057D       00FF

      585    24411    2             KX$VC.RST_CAUSE = FPT_X25.PRM1;

  24411   2 00057E  B844 0005                            LDR,R3   5,B4
          2 000580  BAC5 0024                            SRM,R3,'00FF'X    36,B5
          2 000582       00FF

      586    24412    2             VC_RST.DIAG = FPT_X25.PRM2;

  24412   2 000583  B844 0006                            LDR,R3   6,B4
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:104  
          2 000585  B780 0000 001C  01                   STH,R3   VC_RST+1

      587    24413    2             KX$VC.RST_DIAG = FPT_X25.PRM2;

  24413   2 000588  B844 0006                            LDR,R3   6,B4
          2 00058A  B7C5 0025                            STH,R3   37,B5

      588    24414    2             KX$VC.RSTINDPND = '1'B;

  24414   2 00058C  8945 0016                            LBT,'0100'X       22,B5
  24414   2 00058E       0100

      589    24415    2             IF NOT KV$VDI.USRRQSDAT.RED

  24415   2 00058F  BCC7 001A                            LDB,B3   VDI$,AUTO
          2 000591  82C3 001D                            LB,'0010'X        29,B3
          2 000593       0010
          2 000594  0581 FBCB                            BBF      s:24013,PREL

      590    24416    2                THEN
      591    24417    2                   GOTO L_RET;
      592    24418    2             IF NOT KX$VC.VDHENTERED

  24418   2 000596  ACC7 0018                            LDB,B2   VC$,AUTO
          2 000598  82C2 0016                            LB,'2000'X        22,B2
          2 00059A       2000
          2 00059B  0501 002A                            BBT      s:24449,PREL

      593    24419    2                THEN
      594    24420    3                   DO;

      595    24421                           %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET,
      596    24422                           SCHRSN = %KV_SCHRSN_DFR1 );
             24435    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24435                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24435   2 00059D  9CC3 0008                            LDB,B1   8,B3
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:105  
          2 00059F  ECC1 0033                            LDB,B6   51,B1
          2 0005A1  8AC6 0039                            INC      57,B6
          2 0005A3  8EC6 0038                            CAD      56,B6

             24436    4           IF NOT VDI$->KV$VDI.BSY THEN DO;

  24436   2 0005A5  82C3 0019                            LB,'0080'X        25,B3
  24436   2 0005A7       0080
          2 0005A8  0501 0010                            BBT      s:24442,PREL

             24437    4              VDI$->KV$VDI.BSY = '1'B;

  24437   2 0005AA  8943 0019                            LBT,'0080'X       25,B3
  24437   2 0005AC       0080

             24438    4              KV@USRENT.SVDPTR$ = KV$PTR$;

  24438   2 0005AD  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 0005B0  EFC7 0024                            STB,B6   KV@USRENT,AUTO

             24439    4              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;

  24439   2 0005B2  ACC3 0006                            LDB,B2   6,B3
          2 0005B4  AF80 0000 0000  xsym                 STB,B2   KV$PTR$

             24440    4              END;                         /* ELSE IF ~BSY                       */

  24440   2 0005B7  0F81 000E                            B        s:24449,PREL

             24441    4           ELSE DO;

             24442    4              VDI$->KV$VDI.DFR.USR(1) = '1'B;

  24442   2 0005B9  8943 0018                            LBT,'4000'X       24,B3
  24442   2 0005BB       4000

             24443    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:106  
             24443                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24443   2 0005BC  ECC3 0008                            LDB,B6   8,B3
          2 0005BE  ACC6 0033                            LDB,B2   51,B6
          2 0005C0  8AC2 003B                            INC      59,B2
          2 0005C2  8EC2 003A                            CAD      58,B2

             24444    4              GOTO L_RET;

  24444   2 0005C4  0F81 FB9B                            B        s:24013,PREL

             24445    4              END;                         /* END IF                             */
      597    24448    3                   END;
      598    24449    2             KV@SND_DAT = KX_SND_DAT;

  24449   2 0005C6  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 0005C9  2C4E                                 LDV,R2   78
          2 0005CA  6C14                                 LDV,R6   20
          2 0005CB  BB87                                 LAB,B3   ,AUTO
          2 0005CC  3C4C                                 LDV,R3   76
          2 0005CD  0008                                 MMM

      599    24450    2             KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_RST_IND);

  24450   2 0005CE  EB80 0000 0076  00                   LAB,B6   KX_KEY_RST_IND
          2 0005D1  EF80 0000 003B  01                   STB,B6   KX_VDOVLPARY+10

      600    24451    2             KV@SND_DAT.DAT__.ADR$ = ADDR(VC_RST);

  24451   2 0005D4  DB80 0000 001B  01                   LAB,B5   VC_RST
          2 0005D7  DFC7 0027                            STB,B5   KV@SND_DAT+1,AUTO

      601    24452    2             KV@SND_DAT.DAT__.BYTX = 0;

  24452   2 0005D9  8747 0029                            CL       KV@SND_DAT+3,AUTO

      602    24453    2             KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_RST);
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:107  

  24453   2 0005DB  6C03                                 LDV,R6   3
          2 0005DC  EF47 002A                            STR,R6   KV@SND_DAT+4,AUTO

      603    24454    2             CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN

  24454   2 0005DE  ABC7 0026                            LAB,B2   KV@SND_DAT,AUTO
          2 0005E0  AFC7 0036                            STB,B2   X29MSGTYP+1,AUTO
          2 0005E2  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 0005E4  CBF0 0100                            LAB,B4   256,IMO
          2 0005E6  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0005E9       0006                            DC       s:24458,PREL

      604    24455    3                   DO;

      605    24456    3                      KX$VC.RSTINDPND = '0'B;

  24456   2 0005EA  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0005EC  8846 0016                            LBF,'0100'X       22,B6
          2 0005EE       0100

      606    24457    3                   END;

      607    24458    2             IF NOT KX$VC.VDHENTERED

  24458   2 0005EF  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0005F1  82C6 0016                            LB,'2000'X        22,B6
          2 0005F3       2000
          2 0005F4  0501 03C5                            BBT      s:24799,PREL

      608    24459    2                THEN
      609    24460    3                   DO;

      610    24461                           %KV$USREXT;
             24467    3           KV$VDI.BSY = '0'B;

  24467   2 0005F6  DCC7 001A                            LDB,B5   VDI$,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:108  
          2 0005F8  8845 0019                            LBF,'0080'X       25,B5
          2 0005FA       0080

             24469    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  24469   2 0005FB  ECC7 0024                            LDB,B6   KV@USRENT,AUTO
          2 0005FD  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      611    24471    3                   END;

  24471   2 000600  0F81 03B9                            B        s:24799,PREL

      612    24472        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:109  
      613    24473        /*
      614    24474           EVENT VCRST - A reset confirmation was received. Inform the application.
      615    24475        */
      616    24476    2          CASE ( %KX_CM_EV_VCRST# );

      617    24477
      618    24478    2             IF KX$VC.STATE ~= %KX_VC_ST_NRM#

  24478   2 000602  E2C5 0033                            LLH,R6   51,B5
          2 000604  6D06                                 CMV,R6   6
          2 000605  0901 0004                            BE       s:24481,PREL

      619    24479    2                THEN
      620    24480    2                   RETURN;

  24480   2 000607  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      621    24481    2             KX$VC.RSTCNFPND = '1'B;

  24481   2 00060A  8945 0016                            LBT,'0080'X       22,B5
  24481   2 00060C       0080

      622    24482    2             IF NOT KV$VDI.USRRQSDAT.RED

  24482   2 00060D  BCC7 001A                            LDB,B3   VDI$,AUTO
          2 00060F  82C3 001D                            LB,'0010'X        29,B3
          2 000611       0010
          2 000612  0581 FB4D                            BBF      s:24013,PREL

      623    24483    2                THEN
      624    24484    2                   GOTO L_RET;
      625    24485    2             IF NOT KX$VC.VDHENTERED

  24485   2 000614  ACC7 0018                            LDB,B2   VC$,AUTO
          2 000616  82C2 0016                            LB,'2000'X        22,B2
          2 000618       2000
          2 000619  0501 002A                            BBT      s:24515,PREL
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:110  

      626    24486    2                THEN
      627    24487    3                   DO;

      628    24488                           %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET, SCHRSN = %KV_SCHRSN_DFR1
             24488                               );
             24501    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24501                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24501   2 00061B  9CC3 0008                            LDB,B1   8,B3
          2 00061D  ECC1 0033                            LDB,B6   51,B1
          2 00061F  8AC6 0039                            INC      57,B6
          2 000621  8EC6 0038                            CAD      56,B6

             24502    4           IF NOT VDI$->KV$VDI.BSY THEN DO;

  24502   2 000623  82C3 0019                            LB,'0080'X        25,B3
  24502   2 000625       0080
          2 000626  0501 0010                            BBT      s:24508,PREL

             24503    4              VDI$->KV$VDI.BSY = '1'B;

  24503   2 000628  8943 0019                            LBT,'0080'X       25,B3
  24503   2 00062A       0080

             24504    4              KV@USRENT.SVDPTR$ = KV$PTR$;

  24504   2 00062B  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 00062E  EFC7 0024                            STB,B6   KV@USRENT,AUTO

             24505    4              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;

  24505   2 000630  ACC3 0006                            LDB,B2   6,B3
          2 000632  AF80 0000 0000  xsym                 STB,B2   KV$PTR$

             24506    4              END;                         /* ELSE IF ~BSY                       */

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:111  
  24506   2 000635  0F81 000E                            B        s:24515,PREL

             24507    4           ELSE DO;

             24508    4              VDI$->KV$VDI.DFR.USR(1) = '1'B;

  24508   2 000637  8943 0018                            LBT,'4000'X       24,B3
  24508   2 000639       4000

             24509    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24509                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24509   2 00063A  ECC3 0008                            LDB,B6   8,B3
          2 00063C  ACC6 0033                            LDB,B2   51,B6
          2 00063E  8AC2 003B                            INC      59,B2
          2 000640  8EC2 003A                            CAD      58,B2

             24510    4              GOTO L_RET;

  24510   2 000642  0F81 FB1D                            B        s:24013,PREL

             24511    4              END;                         /* END IF                             */
      629    24514    3                   END;
      630    24515    2             VC_RST.FUNCTION = %KX_VCFNC_RST_CNF#;

  24515   2 000644  6C0C                                 LDV,R6   12
          2 000645  E780 0000 001B  01                   STH,R6   VC_RST

      631    24516    2             KV@SND_DAT = KX_SND_DAT;

  24516   2 000648  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 00064B  2C4E                                 LDV,R2   78
          2 00064C  6C14                                 LDV,R6   20
          2 00064D  BB87                                 LAB,B3   ,AUTO
          2 00064E  3C4C                                 LDV,R3   76
          2 00064F  0008                                 MMM

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:112  
      632    24517    2             KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_RST_CNF);

  24517   2 000650  EB80 0000 007B  00                   LAB,B6   KX_KEY_RST_CNF
          2 000653  EF80 0000 003B  01                   STB,B6   KX_VDOVLPARY+10

      633    24518    2             KV@SND_DAT.DAT__.ADR$ = ADDR(VC_RST);

  24518   2 000656  DB80 0000 001B  01                   LAB,B5   VC_RST
          2 000659  DFC7 0027                            STB,B5   KV@SND_DAT+1,AUTO

      634    24519    2             KV@SND_DAT.DAT__.BYTX = 0;

  24519   2 00065B  8747 0029                            CL       KV@SND_DAT+3,AUTO

      635    24520    2             KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_RST);

  24520   2 00065D  6C03                                 LDV,R6   3
          2 00065E  EF47 002A                            STR,R6   KV@SND_DAT+4,AUTO

      636    24521    2             CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN

  24521   2 000660  ABC7 0026                            LAB,B2   KV@SND_DAT,AUTO
          2 000662  AFC7 0036                            STB,B2   X29MSGTYP+1,AUTO
          2 000664  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000666  CBF0 0100                            LAB,B4   256,IMO
          2 000668  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00066B       0006                            DC       s:24525,PREL

      637    24522    3                   DO;

      638    24523    3                      KX$VC.RSTCNFPND = '0'B;

  24523   2 00066C  ECC7 0018                            LDB,B6   VC$,AUTO
          2 00066E  8846 0016                            LBF,'0080'X       22,B6
          2 000670       0080

      639    24524    3                   END;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:113  

      640    24525    2             IF NOT KX$VC.VDHENTERED

  24525   2 000671  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000673  82C6 0016                            LB,'2000'X        22,B6
          2 000675       2000
          2 000676  0501 0343                            BBT      s:24799,PREL

      641    24526    2                THEN
      642    24527    3                   DO;

      643    24528                           %KV$USREXT;
             24534    3           KV$VDI.BSY = '0'B;

  24534   2 000678  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 00067A  8845 0019                            LBF,'0080'X       25,B5
          2 00067C       0080

             24536    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  24536   2 00067D  ECC7 0024                            LDB,B6   KV@USRENT,AUTO
          2 00067F  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      644    24538    3                   END;

  24538   2 000682  0F81 0337                            B        s:24799,PREL

      645    24539        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:114  
      646    24540
      647    24541        /*
      648    24542           EVENT VCDWN/VCLST - VC down or lost. This could be the result of L3
      649    24543                         receiving a clear or a clear_c packet from the other side.
      650    24544                         KX$VC.STATE is the clue to what should be happening.
      651    24545        */
      652    24546    2          CASE ( %KX_CM_EV_VCDWN#, %KX_CM_EV_VCLST#, %KX_CM_EV_VCLST_PRM# );

      653    24547
      654    24548    2             KX$VC.INV2CLR = '0'B;

  24548   2 000684  8845 0016                            LBF,'0008'X       22,B5
  24548   2 000686       0008

      655    24549    3             DO CASE ( KX$VC.STATE );

  24549   2 000687  BCC7 0018                            LDB,B3   VC$,AUTO
          2 000689  B2C3 0033                            LLH,R3   51,B3
          2 00068B  3D09                                 CMV,R3   9
          2 00068C  0281 0028                            BGE      s:24561,PREL
          2 00068E  A830 0000 0694  02                   LDR,R2   s:24549+13,R3
          2 000691  83A0 0000 069D  02                   JMP      s:24551,R2
          2 000694       0018                            DC       s:24561,PREL
          2 000695       0018                            DC       s:24561,PREL
          2 000696       000D                            DC       s:24558,PREL
          2 000697       0018                            DC       s:24561,PREL
          2 000698       0000                            DC       s:24551,PREL
          2 000699       0018                            DC       s:24561,PREL
          2 00069A       0018                            DC       s:24561,PREL
          2 00069B       0007                            DC       s:24555,PREL
          2 00069C       0007                            DC       s:24555,PREL

      656    24550    3                CASE ( %KX_VC_ST_WCC# );

      657    24551    3                   IF FPT_X25.EVN = %KX_CM_EV_VCDWN#

  24551   2 00069D  E804                                 LDR,R6   ,B4
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:115  
          2 00069E  6D05                                 CMV,R6   5
          2 00069F  0981 0015                            BNE      s:24561,PREL

      658    24552    3                      THEN
      659    24553    3                         RETURN;   /* will attempt to call again after delay */

  24553   2 0006A1  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      660    24554    3                CASE ( %KX_VC_ST_BGNPHSDSC#, %KX_VC_ST_ENDPHSDSC# );

      661    24555    3                   KX$VC.STATE = %KX_VC_ST_ENDPHSDSC#;

  24555   2 0006A4  6C08                                 LDV,R6   8
          2 0006A5  E7C3 0033                            STH,R6   51,B3

      662    24556    3                   RETURN;

  24556   2 0006A7  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      663    24557    3                CASE ( %KX_VC_ST_RMTDCL# );

      664    24558    3                   CALL KXX$RLSCTX ( KX$VC );

  24558   2 0006AA  BBC7 0018                            LAB,B3   VC$,AUTO
          2 0006AC  CBF0 0100                            LAB,B4   256,IMO
          2 0006AE  E380 0000 0000  xent                 LNJ,B6   KXX$RLSCTX
          2 0006B1       0001                            DC       s:24559,PREL

      665    24559    3                   RETURN;

  24559   2 0006B2  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      666    24560    3             END;

      667    24561    2             KX$VC.VDI$->KV$VDI.PHSDSC = '1'B;

  24561   2 0006B5  ACC3 0002                            LDB,B2   2,B3
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:116  
          2 0006B7  8942 0019                            LBT,'0040'X       25,B2
          2 0006B9       0040

      668    24562        /*
      669    24563           Pass the clear packet up to the application.
      670    24564        */
      671    24565    2             IF KX$VC.CLRPKT$ = ADDR(NIL) AND FPT_X25.PRS.V

  24565   2 0006BA  BCC7 0018                            LDB,B3   VC$,AUTO
          2 0006BC  8DC3 0029                            CMN      41,B3
          2 0006BE  0981 0061                            BNE      s:24581,PREL
          2 0006C0  82C4 000F                            LB,'0800'X        15,B4
          2 0006C2       0800
          2 0006C3  0581 005C                            BBF      s:24581,PREL

      672    24566    2                THEN
      673    24567    3                   DO;

      674    24568    3                     Y@BYTSIZ = FPT_X25.V_.BYTX + FPT_X25.V_.BYTSIZ - LENGTHC(KX$DATA)
             24568                               ;

  24568   2 0006C5  E844 000D                            LDR,R6   13,B4
          2 0006C7  EA44 000E                            ADD,R6   14,B4
          2 0006C9  6EF0                                 ADV,R6   -16
          2 0006CA  EF47 001C                            STR,R6   Y@BYTSIZ,AUTO

      675    24569    3                      KX$VC.CLRMSGBYTSIZ = Y@BYTSIZ + LENGTHC(VC_CLR);

  24569   2 0006CC  6E14                                 ADV,R6   20
          2 0006CD  EF43 002B                            STR,R6   43,B3

      676    24570    3                      CALL KVB$GETSYS ( (KX$VC.CLRMSGBYTSIZ+1)/2, KX$VC.CLRPKT$ )
             24570                               ALTRET ( NO_MEM );

  24570   2 0006CF  6E01                                 ADV,R6   1
          2 0006D0  6041                                 SOR,R6   1
          2 0006D1  EF47 0036                            STR,R6   X29MSGTYP+1,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:117  
          2 0006D3  ABC3 0029                            LAB,B2   41,B3
          2 0006D5  AFC7 0039                            STB,B2   X29MSGTYP+4,AUTO
          2 0006D7  9BC7 0036                            LAB,B1   X29MSGTYP+1,AUTO
          2 0006D9  9FC7 0037                            STB,B1   X29MSGTYP+2,AUTO
          2 0006DB  BBC7 0037                            LAB,B3   X29MSGTYP+2,AUTO
          2 0006DD  CBF0 0200                            LAB,B4   512,IMO
          2 0006DF  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 0006E2       FBCC                            DC       s:24156,PREL

      677    24571    3                      VC_CLR.FUNCTION = %KX_VCFNC_CLR_IND#;

  24571   2 0006E3  6C0E                                 LDV,R6   14
          2 0006E4  E780 0000 001D  01                   STH,R6   VC_CLR

      678    24572    3                      VC_CLR.USRDATLNG = FPT_X25.V_.BYTSIZ;

  24572   2 0006E7  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          2 0006E9  D846 000E                            LDR,R5   14,B6
          2 0006EB  DF00 0000 0025  01                   STR,R5   VC_CLR+8

      679    24573    3                      VC_CLR.USRDATBYTX = FPT_X25.V_.BYTX - LENGTHC(KX$DATA);

  24573   2 0006EE  C846 000D                            LDR,R4   13,B6
          2 0006F0  4EF0                                 ADV,R4   -16
          2 0006F1  CF00 0000 0026  01                   STR,R4   VC_CLR+9

      680    24574    3                      VC_CLR.CAUSE = FPT_X25.PRM1;

  24574   2 0006F4  B846 0005                            LDR,R3   5,B6
          2 0006F6  BA80 0000 001D  01                   SRM,R3,'00FF'X    VC_CLR
          2 0006F9       00FF

      681    24575    3                      VC_CLR.DIAG = FPT_X25.PRM2;

  24575   2 0006FA  B846 0006                            LDR,R3   6,B6
          2 0006FC  B780 0000 001E  01                   STH,R3   VC_CLR+1

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:118  
      682    24576    3                      KX$VC.CLRPKT$->VC$CLR = VC_CLR;

  24576   2 0006FF  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000701  CCC5 0029                            LDB,B4   41,B5
          2 000703  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 000706  2C3A                                 LDV,R2   58
          2 000707  6C14                                 LDV,R6   20
          2 000708  BB84                                 LAB,B3   ,B4
          2 000709  3C00                                 LDV,R3   0
          2 00070A  0008                                 MMM

      683    24577    3                      SUBSTR (KX$VC.CLRPKT$->DSTR,LENGTHC(VC_CLR),Y@BYTSIZ) =

  24577   2 00070B  DCC7 0018                            LDB,B5   VC$,AUTO
          2 00070D  ACC5 0029                            LDB,B2   41,B5
          2 00070F  9CC6 000B                            LDB,B1   11,B6
          2 000711  AFC7 0036                            STB,B2   X29MSGTYP+1,AUTO
          2 000713  AB81                                 LAB,B2   ,B1
          2 000714  2C10                                 LDV,R2   16
          2 000715  E847 001C                            LDR,R6   Y@BYTSIZ,AUTO
          2 000717  BCC7 0036                            LDB,B3   X29MSGTYP+1,AUTO
          2 000719  3C14                                 LDV,R3   20
          2 00071A  0008                                 MMM

      684    24578    3                         SUBSTR (IN_STR,LENGTHC(KX$DATA),Y@BYTSIZ);
      685    24579    3                      KX$VC.CLRINDPND = '1'B;

  24579   2 00071B  DCC7 0018                            LDB,B5   VC$,AUTO
          2 00071D  8945 0016                            LBT,'0040'X       22,B5
          2 00071F       0040

      686    24580    3                   END;

      687    24581    2             IF NOT KX$VC.VDHENTERED

  24581   2 000720  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000722  82C6 0016                            LB,'2000'X        22,B6
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:119  
          2 000724       2000
          2 000725  0501 002C                            BBT      s:24612,PREL

      688    24582    2                THEN
      689    24583    3                   DO;

      690    24584                           %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET,
      691    24585                           SCHRSN = %KV_SCHRSN_DFR3 );
             24598    3           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24598                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24598   2 000727  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 000729  CCC5 0008                            LDB,B4   8,B5
          2 00072B  BCC4 0033                            LDB,B3   51,B4
          2 00072D  8AC3 0039                            INC      57,B3
          2 00072F  8EC3 0038                            CAD      56,B3

             24599    4           IF NOT VDI$->KV$VDI.BSY THEN DO;

  24599   2 000731  82C5 0019                            LB,'0080'X        25,B5
  24599   2 000733       0080
          2 000734  0501 0010                            BBT      s:24605,PREL

             24600    4              VDI$->KV$VDI.BSY = '1'B;

  24600   2 000736  8945 0019                            LBT,'0080'X       25,B5
  24600   2 000738       0080

             24601    4              KV@USRENT.SVDPTR$ = KV$PTR$;

  24601   2 000739  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 00073C  EFC7 0024                            STB,B6   KV@USRENT,AUTO

             24602    4              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;

  24602   2 00073E  CCC5 0006                            LDB,B4   6,B5
          2 000740  CF80 0000 0000  xsym                 STB,B4   KV$PTR$
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:120  

             24603    4              END;                         /* ELSE IF ~BSY                       */

  24603   2 000743  0F81 000E                            B        s:24612,PREL

             24604    4           ELSE DO;

             24605    4              VDI$->KV$VDI.DFR.USR(3) = '1'B;

  24605   2 000745  8945 0018                            LBT,'1000'X       24,B5
  24605   2 000747       1000

             24606    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24606                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24606   2 000748  ECC5 0008                            LDB,B6   8,B5
          2 00074A  CCC6 0033                            LDB,B4   51,B6
          2 00074C  8AC4 003B                            INC      59,B4
          2 00074E  8EC4 003A                            CAD      58,B4

             24607    4              GOTO L_RET;

  24607   2 000750  0F81 FA0F                            B        s:24013,PREL

             24608    4              END;                         /* END IF                             */
      692    24611    3                   END;
      693    24612    2             IF KX$VC.CLRPKT$ ~= ADDR(NIL) AND KV$VDI.USRRQSDAT.RED

  24612   2 000752  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000754  8DC6 0029                            CMN      41,B6
          2 000756  0901 0054                            BE       s:24627,PREL
          2 000758  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 00075A  82C5 001D                            LB,'0010'X        29,B5
          2 00075C       0010
          2 00075D  0581 004D                            BBF      s:24627,PREL

      694    24613    2                THEN
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:121  
      695    24614    3                   DO;

      696    24615    3                      KV@SND_DAT = KX_SND_DAT;

  24615   2 00075F  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 000762  2C4E                                 LDV,R2   78
          2 000763  6C14                                 LDV,R6   20
          2 000764  BB87                                 LAB,B3   ,AUTO
          2 000765  3C4C                                 LDV,R3   76
          2 000766  0008                                 MMM

      697    24616    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CLR_IND);

  24616   2 000767  EB80 0000 0080  00                   LAB,B6   KX_KEY_CLR_IND
          2 00076A  EF80 0000 003B  01                   STB,B6   KX_VDOVLPARY+10

      698    24617    3                      KV@SND_DAT.DAT__.ADR$ = KX$VC.CLRPKT$;

  24617   2 00076D  DCC7 0018                            LDB,B5   VC$,AUTO
          2 00076F  CCC5 0029                            LDB,B4   41,B5
          2 000771  CFC7 0027                            STB,B4   KV@SND_DAT+1,AUTO

      699    24618    3                      KV@SND_DAT.DAT__.BYTX = 0;

  24618   2 000773  8747 0029                            CL       KV@SND_DAT+3,AUTO

      700    24619    3                      KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CLRMSGBYTSIZ;

  24619   2 000775  E845 002B                            LDR,R6   43,B5
          2 000777  EF47 002A                            STR,R6   KV@SND_DAT+4,AUTO

      701    24620    3                      CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN

  24620   2 000779  ABC7 0026                            LAB,B2   KV@SND_DAT,AUTO
          2 00077B  AFC7 0036                            STB,B2   X29MSGTYP+1,AUTO
          2 00077D  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 00077F  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:122  
          2 000781  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000784       0027                            DC       s:24627,PREL

      702    24621    4                            DO;

      703    24622    4                               KX$VC.CLRINDPND = '0'B;

  24622   2 000785  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000787  8846 0016                            LBF,'0040'X       22,B6
          2 000789       0040

      704    24623    4                               CALL KVB$RLSSYS ( (KX$VC.CLRMSGBYTSIZ+1)/2, KX$VC.
             24623                                        CLRPKT$ );

  24623   2 00078A  ECC7 0018                            LDB,B6   VC$,AUTO
          2 00078C  E846 002B                            LDR,R6   43,B6
          2 00078E  6E01                                 ADV,R6   1
          2 00078F  6041                                 SOR,R6   1
          2 000790  EF47 0036                            STR,R6   X29MSGTYP+1,AUTO
          2 000792  DBC6 0029                            LAB,B5   41,B6
          2 000794  DFC7 0039                            STB,B5   X29MSGTYP+4,AUTO
          2 000796  CBC7 0036                            LAB,B4   X29MSGTYP+1,AUTO
          2 000798  CFC7 0037                            STB,B4   X29MSGTYP+2,AUTO
          2 00079A  BBC7 0037                            LAB,B3   X29MSGTYP+2,AUTO
          2 00079C  CBF0 0200                            LAB,B4   512,IMO
          2 00079E  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 0007A1       0001                            DC       s:24624,PREL

      705    24624    4                               KX$VC.CLRPKT$ = ADDR(NIL);

  24624   2 0007A2  EB80 0000 0000                       LAB,B6   0
          2 0007A5  DCC7 0018                            LDB,B5   VC$,AUTO
          2 0007A7  EFC5 0029                            STB,B6   41,B5

      706    24625    4                               KX$VC.CLRMSGBYTSIZ = 0;

  24625   2 0007A9  8745 002B                            CL       43,B5
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:123  

      707    24626    4                            END;

      708    24627    3                   END;

      709    24628    2   VDH_DSC:  KV@VDH_DSC = KXX_VDH_DSC;

  24628   2 0007AB  8C80 0000 0000  xsym VDH_DSC         LDI      KXX_VDH_DSC
          2 0007AE  8D47 0022                            SDI      KV@VDH_DSC,AUTO

      710    24629    2             CALL KVV$VDI ( KV@VDH_DSC );

  24629   2 0007B0  EBC7 0022                            LAB,B6   KV@VDH_DSC,AUTO
          2 0007B2  EFC7 0036                            STB,B6   X29MSGTYP+1,AUTO
          2 0007B4  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 0007B6  CBF0 0100                            LAB,B4   256,IMO
          2 0007B8  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0007BB       0001                            DC       s:24630,PREL

      711    24630    2             KX$VC.STATE = %KX_VC_ST_ENDPHSDSC#;

  24630   2 0007BC  6C08                                 LDV,R6   8
          2 0007BD  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0007BF  E7C6 0033                            STH,R6   51,B6

      712    24631                  /* takes care of purging output */
      713    24632    3             DO WHILE ( KX$VC.SND.HED$ ~= ADDR(NIL) );

  24632   2 0007C1  0F81 0030                            B        s:24638,PREL

      714    24633    3                DAT$ = KX$VC.SND.HED$;

  24633   2 0007C3  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0007C5  DCC6 000C                            LDB,B5   12,B6
          2 0007C7  DFC7 0020                            STB,B5   DAT$,AUTO

      715    24634    3                KX$VC.SND.HED$ = KX$VC_OTPBFR.LNK$;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:124  

  24634   2 0007C9  CC85                                 LDB,B4   ,B5
          2 0007CA  CFC6 000C                            STB,B4   12,B6

      716    24635    3                Y@BYTSIZ = KX$VC_OTPBFR.BFRBYTSIZ;

  24635   2 0007CC  ECC7 0020                            LDB,B6   DAT$,AUTO
          2 0007CE  E846 0002                            LDR,R6   2,B6
          2 0007D0  E570 3FFF                            AND,R6   16383,IMO
          2 0007D2  EF47 001C                            STR,R6   Y@BYTSIZ,AUTO

      717    24636    3                CALL KVB$RLS2NSYS ( KX$VC_OTPBFR.RLSWRDSIZ, DAT$ );

  24636   2 0007D4  DBC7 0020                            LAB,B5   DAT$,AUTO
          2 0007D6  DFC7 0038                            STB,B5   X29MSGTYP+3,AUTO
          2 0007D8  CBC6 0004                            LAB,B4   4,B6
          2 0007DA  CFC7 0036                            STB,B4   X29MSGTYP+1,AUTO
          2 0007DC  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 0007DE  CBF0 0200                            LAB,B4   512,IMO
          2 0007E0  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
          2 0007E3       0001                            DC       s:24637,PREL

      718    24637    3                KX_STATS_X29.KHSTT.OTPBFRBYTUTL = KX_STATS_X29.KHSTT.OTPBFRBYTUTL -
             24637                         Y@BYTSIZ;

  24637   2 0007E4  F847 001C                            LDR,R7   Y@BYTSIZ,AUTO
          2 0007E6  6C00                                 LDV,R6   0
          2 0007E7  8480 0000 001E  xsym                 SID      KX_STATS_X29+30
          2 0007EA  8656                                 CPL      R6
          2 0007EB  8657                                 CPL      R7
          2 0007EC  8470 0000 0001                       AID      1,IMO
          2 0007EF  8D00 0000 001E  xsym                 SDI      KX_STATS_X29+30

      719    24638    3             END; /*  DO WHILE ...  */

  24638   2 0007F2  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0007F4  8DC6 000C                            CMN      12,B6
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:125  
          2 0007F6  09CD                                 BNE      s:24633,SPREL

      720    24639
      721    24640    2             KX$VC.OTPBFRBYTCNT = 0;

  24640   2 0007F7  8746 0014                            CL       20,B6

      722    24641                  %KV$RQSOTP ( RQSOTP = YES );
             24653    3           IF NOT KV$VDI.RQSOTP  THEN DO;

  24653   2 0007F9  ECC7 001A                            LDB,B6   VDI$,AUTO
          2 0007FB  82C6 0019                            LB,'0008'X        25,B6
          2 0007FD       0008
          2 0007FE  0501 000D                            BBT      s:24659,PREL

             24654    3              KV$VDI.RQSOTP = '1'B;

  24654   2 000800  8946 0019                            LBT,'0008'X       25,B6
  24654   2 000802       0008

             24655    3              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);

  24655   2 000803  BB80 0000 0004  03                   LAB,B3   +4
          2 000806  CBF0 0100                            LAB,B4   256,IMO
          2 000808  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00080B       0001                            DC       s:24659,PREL

             24656    3              END;                         /* END IF                             */

      723    24659    2             IF %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RLSVDI)

  24659   2 00080C  ECC7 001A                            LDB,B6   VDI$,AUTO
          2 00080E  82C6 001F                            LB,'0002'X        31,B6
          2 000810       0002
          2 000811  0581 000A                            BBF      s:24663,PREL

      724    24660    2                THEN
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:126  
      725    24661        /* complete the releasing of VDI.                                   */
      726    24662    2                   CALL KVV$VDI(KV_VDH_EVT_RLSVDI) ;

  24662   2 000813  BB80 0000 0006  03                   LAB,B3   +6
          2 000816  CBF0 0100                            LAB,B4   256,IMO
          2 000818  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00081B       0001                            DC       s:24663,PREL

      727    24663    2             IF NOT KX$VC.VDHENTERED

  24663   2 00081C  ECC7 0018                            LDB,B6   VC$,AUTO
          2 00081E  82C6 0016                            LB,'2000'X        22,B6
          2 000820       2000
          2 000821  0501 000B                            BBT      s:24677,PREL

      728    24664    2                THEN
      729    24665    3                   DO;

      730    24666                           %KV$USREXT;
             24672    3           KV$VDI.BSY = '0'B;

  24672   2 000823  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 000825  8845 0019                            LBF,'0080'X       25,B5
          2 000827       0080

             24674    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  24674   2 000828  ECC7 0024                            LDB,B6   KV@USRENT,AUTO
          2 00082A  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      731    24676    3                   END;

      732    24677    2             KX$VC.SND.NXTLOD$ = ADDR(NIL);

  24677   2 00082D  EB80 0000 0000                       LAB,B6   0
          2 000830  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000832  EFC5 000E                            STB,B6   14,B5
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:127  

      733    24678    2             KX$VC.SND.TAL$ = ADDR(NIL);

  24678   2 000834  EB80 0000 0000                       LAB,B6   0
          2 000837  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000839  EFC5 0010                            STB,B6   16,B5
          2 00083B  0F81 017E                            B        s:24799,PREL

      734    24679
      735    24680        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:128  
      736    24681        /*
      737    24682           EVENT RLSL3 - L3 context is about to go away. We still have to wait
      738    24683                         until the disconnect procedure with VDH is done. Just
      739    24684                         clear the L3$.
      740    24685        */
      741    24686    2          CASE ( %KX_CM_EV_RLSL3# );

      742    24687
      743    24688    2             KX$VC.L3$ = ADDR(NIL);

  24688   2 00083D  BB80 0000 0000                       LAB,B3   0
          2 000840  BFC5 0006                            STB,B3   6,B5

      744    24689    2             KX$VC.PHSDSC = '1'B;

  24689   2 000842  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000844  8945 0016                            LBT,'0020'X       22,B5
          2 000846       0020
          2 000847  0F81 0172                            B        s:24799,PREL

      745    24690        /*N* Some more code may be needed.  */
      746    24691        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:129  
      747    24692
      748    24693        /*
      749    24694           EVENT VCUP - VC established.
      750    24695        */
      751    24696
      752    24697    2          CASE ( %KX_CM_EV_VCUP# );

      753    24698
      754    24699    2             IF KX$VC.STATE ~= %KX_VC_ST_WCC# AND KX$VC.STATE ~= %KX_VC_ST_WCA#

  24699   2 000849  E2C5 0033                            LLH,R6   51,B5
          2 00084B  6D04                                 CMV,R6   4
          2 00084C  0901 000D                            BE       s:24702,PREL
          2 00084E  6D05                                 CMV,R6   5
          2 00084F  0901 000A                            BE       s:24702,PREL

      755    24700    2                THEN
      756    24701    2                   CALL KHD$SCREECH ( Y_BADSTT );

  24701   2 000851  BB80 0000 000E  03                   LAB,B3   +14
          2 000854  CBF0 0100                            LAB,B4   256,IMO
          2 000856  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000859       0001                            DC       s:24702,PREL

      757    24702    2             KX$VC.STATE = %KX_VC_ST_NRM#;   /* We're now in data xfer state */

  24702   2 00085A  6C06                                 LDV,R6   6
          2 00085B  ECC7 0018                            LDB,B6   VC$,AUTO
          2 00085D  E7C6 0033                            STH,R6   51,B6

      758    24703    2             KX$VC.MAXOTPBYT = KX_BUF.SIZ(KX$L3.CALL_OPTS.SNDPCKSIZ) *

  24703   2 00085F  DCC7 0016                            LDB,B5   L3$,AUTO
          2 000861  B845 0015                            LDR,R3   21,B5
          2 000863  B570 00FF                            AND,R3   255,IMO
          2 000865  F845 0016                            LDR,R7   22,B5
          2 000867  F570 00FF                            AND,R7   255,IMO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:130  
          2 000869  7E01                                 ADV,R7   1
          2 00086A  FB30 0000 001E  xsym                 MUL,R7   KX_BUF+30,R3
          2 00086D  E857                                 LDR,R6   R7
          2 00086E  EF46 0015                            STR,R6   21,B6

      759    24704    2                ( KX$L3.CALL_OPTS.SNDWND + 1 );
      760    24705    2             IF KX$VC.CHN$->KH$CHN.TERMID.LEV = %TERMINAL_ID_LEV_SUBCHAN#

  24705   2 000870  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000872  CCC6 0004                            LDB,B4   4,B6
          2 000874  E844 0012                            LDR,R6   18,B4
          2 000876  E570 00FF                            AND,R6   255,IMO
          2 000878  6D02                                 CMV,R6   2
          2 000879  0981 0140                            BNE      s:24799,PREL

      761    24706    2                THEN
      762    24707    3                   DO;

      763    24708        /*
      764    24709           Pass the call_c information up to the application.
      765    24710        */
      766    24711    3                      IF KX$VC.CALMSGBYTSIZ > 0

  24711   2 00087B  D846 0028                            LDR,R5   40,B6
          2 00087D  5901 0015                            BEZ,R5   s:24715,PREL

      767    24712    3                         THEN
      768    24713        /* Get rid of the call user data */
      769    24714    3                           CALL KVB$RLSSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )
             24714                                     ;

  24714   2 00087F  5E01                                 ADV,R5   1
          2 000880  5041                                 SOR,R5   1
          2 000881  DF47 0036                            STR,R5   X29MSGTYP+1,AUTO
          2 000883  CBC6 0026                            LAB,B4   38,B6
          2 000885  CFC7 0039                            STB,B4   X29MSGTYP+4,AUTO
          2 000887  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:131  
          2 000889  BFC7 0037                            STB,B3   X29MSGTYP+2,AUTO
          2 00088B  BBC7 0037                            LAB,B3   X29MSGTYP+2,AUTO
          2 00088D  CBF0 0200                            LAB,B4   512,IMO
          2 00088F  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000892       0001                            DC       s:24715,PREL

      770    24715    3                     Y@BYTSIZ = FPT_X25.V_.BYTX + FPT_X25.V_.BYTSIZ - LENGTHC(KX$DATA)
             24715                               ;

  24715   2 000893  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          2 000895  E846 000D                            LDR,R6   13,B6
          2 000897  EA46 000E                            ADD,R6   14,B6
          2 000899  6EF0                                 ADV,R6   -16
          2 00089A  EF47 001C                            STR,R6   Y@BYTSIZ,AUTO

      771    24716    3                      KX$VC.CALMSGBYTSIZ = Y@BYTSIZ + LENGTHC(VC_CAL);

  24716   2 00089C  DCC7 0018                            LDB,B5   VC$,AUTO
          2 00089E  6E2E                                 ADV,R6   46
          2 00089F  EF45 0028                            STR,R6   40,B5

      772    24717    3                      CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )

  24717   2 0008A1  6E01                                 ADV,R6   1
          2 0008A2  6041                                 SOR,R6   1
          2 0008A3  EF47 0036                            STR,R6   X29MSGTYP+1,AUTO
          2 0008A5  CBC5 0026                            LAB,B4   38,B5
          2 0008A7  CFC7 0039                            STB,B4   X29MSGTYP+4,AUTO
          2 0008A9  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 0008AB  BFC7 0037                            STB,B3   X29MSGTYP+2,AUTO
          2 0008AD  BBC7 0037                            LAB,B3   X29MSGTYP+2,AUTO
          2 0008AF  CBF0 0200                            LAB,B4   512,IMO
          2 0008B1  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 0008B4       F9FA                            DC       s:24156,PREL

      773    24718    3                         ALTRET ( NO_MEM );
      774    24719    3                      VC_CAL.FUNCTION = %KX_VCFNC_CAL_CNF#;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:132  

  24719   2 0008B5  6C04                                 LDV,R6   4
          2 0008B6  E780 0000 0002  01                   STH,R6   VC_CAL

      775    24720    3                      VC_CAL.CLDADRLNG = KX$L3.CALL_OPTS.RCVADR.SIZ;

  24720   2 0008B9  ECC7 0016                            LDB,B6   L3$,AUTO
          2 0008BB  D2C6 0017                            LLH,R5   23,B6
          2 0008BD  DA80 0000 0002  01                   SRM,R5,'000F'X    VC_CAL
          2 0008C0       000F

      776    24721    3                      VC_CAL.CLDADRSTRING = KX$L3.CALL_OPTS.RCVADR.ADR_STRING;

  24721   2 0008C1  AB86                                 LAB,B2   ,B6
          2 0008C2  2C2F                                 LDV,R2   47
          2 0008C3  6C07                                 LDV,R6   7
          2 0008C4  BB80 0000 0000  01                   LAB,B3   KX_VDH_EVT_ATN
          2 0008C7  3C0D                                 LDV,R3   13
          2 0008C8  0008                                 MMM

      777    24722    3                      VC_CAL.CLGADRLNG = KX$L3.L2$->KX$L2.NTWADR.LNG;

  24722   2 0008C9  DCC7 0016                            LDB,B5   L3$,AUTO
          2 0008CB  CCC5 0002                            LDB,B4   2,B5
          2 0008CD  E844 0039                            LDR,R6   57,B4
          2 0008CF  6004                                 SOL,R6   4
          2 0008D0  EA80 0000 0002  01                   SRM,R6,'00F0'X    VC_CAL
          2 0008D3       00F0

      778    24723    3                      VC_CAL.CLGADRSTRING = KX$L3.L2$->KX$L2.NTWADR.ADR_STRING;

  24723   2 0008D4  CCC5 0002                            LDB,B4   2,B5
          2 0008D6  AB84                                 LAB,B2   ,B4
          2 0008D7  2C74                                 LDV,R2   116
          2 0008D8  6C07                                 LDV,R6   7
          2 0008D9  BB80 0000 0000  01                   LAB,B3   KX_VDH_EVT_ATN
          2 0008DC  3C06                                 LDV,R3   6
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:133  
          2 0008DD  0008                                 MMM

      779    24724    3                      VC_CAL.FSTSLC = KX$L3.FSTSLC;

  24724   2 0008DE  DCC7 0016                            LDB,B5   L3$,AUTO
          2 0008E0  E845 0029                            LDR,R6   41,B5
          2 0008E2  6008                                 SOL,R6   8
          2 0008E3  EA80 0000 000B  01                   SRM,R6,'C000'X    VC_CAL+9
          2 0008E6       C000

      780    24725    3                      VC_CAL.USRDATLNG = FPT_X25.V_.BYTSIZ;

  24725   2 0008E7  BCC7 0004                            LDB,B3   @FPT_X25,AUTO
          2 0008E9  E843 000E                            LDR,R6   14,B3
          2 0008EB  EF00 0000 0017  01                   STR,R6   VC_CAL+21

      781    24726    3                      VC_CAL.USRDATBYTX = FPT_X25.V_.BYTX - LENGTHC(KX$DATA);

  24726   2 0008EE  D843 000D                            LDR,R5   13,B3
          2 0008F0  5EF0                                 ADV,R5   -16
          2 0008F1  DF00 0000 0018  01                   STR,R5   VC_CAL+22

      782    24727    3                      VC_CAL.X3 = KX$VC.X3PRM;

  24727   2 0008F4  ACC7 0018                            LDB,B2   VC$,AUTO
          2 0008F6  2C31                                 LDV,R2   49
          2 0008F7  6C16                                 LDV,R6   22
          2 0008F8  BB80 0000 0000  01                   LAB,B3   KX_VDH_EVT_ATN
          2 0008FB  3C17                                 LDV,R3   23
          2 0008FC  0008                                 MMM

      783    24728    3                      KX$VC.CALPKT$->VC$CAL = VC_CAL;

  24728   2 0008FD  DCC7 0018                            LDB,B5   VC$,AUTO
          2 0008FF  BCC5 0026                            LDB,B3   38,B5
          2 000901  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 000904  2C04                                 LDV,R2   4
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:134  
          2 000905  6C2E                                 LDV,R6   46
          2 000906  3C00                                 LDV,R3   0
          2 000907  0008                                 MMM

      784    24729    3                      SUBSTR (KX$VC.CALPKT$->DSTR,LENGTHC(VC_CAL),Y@BYTSIZ) =

  24729   2 000908  DCC7 0018                            LDB,B5   VC$,AUTO
          2 00090A  BCC5 0026                            LDB,B3   38,B5
          2 00090C  ACC7 0004                            LDB,B2   @FPT_X25,AUTO
          2 00090E  9CC2 000B                            LDB,B1   11,B2
          2 000910  AB81                                 LAB,B2   ,B1
          2 000911  2C10                                 LDV,R2   16
          2 000912  E847 001C                            LDR,R6   Y@BYTSIZ,AUTO
          2 000914  3C2E                                 LDV,R3   46
          2 000915  0008                                 MMM

      785    24730    3                         SUBSTR (IN_STR,LENGTHC(KX$DATA),Y@BYTSIZ);
      786    24731    3                      KX$VC.CALCNFPND = '1'B;

  24731   2 000916  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000918  8945 0016                            LBT,'0800'X       22,B5
          2 00091A       0800

      787    24732    3                      IF NOT KV$VDI.USRRQSDAT.RED

  24732   2 00091B  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 00091D  82C5 001D                            LB,'0010'X        29,B5
          2 00091F       0010
          2 000920  0581 F83F                            BBF      s:24013,PREL

      788    24733    3                         THEN
      789    24734    3                            GOTO L_RET;
      790    24735    3                      IF NOT KX$VC.VDHENTERED

  24735   2 000922  BCC7 0018                            LDB,B3   VC$,AUTO
          2 000924  82C3 0016                            LB,'2000'X        22,B3
          2 000926       2000
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:135  
          2 000927  0501 002A                            BBT      s:24766,PREL

      791    24736    3                         THEN
      792    24737    4                            DO;

      793    24738                                    %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RET,
      794    24739                                    SCHRSN = %KV_SCHRSN_DFR1 );
             24752    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24752                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24752   2 000929  ACC5 0008                            LDB,B2   8,B5
          2 00092B  9CC2 0033                            LDB,B1   51,B2
          2 00092D  8AC1 0039                            INC      57,B1
          2 00092F  8EC1 0038                            CAD      56,B1

             24753    5           IF NOT VDI$->KV$VDI.BSY THEN DO;

  24753   2 000931  82C5 0019                            LB,'0080'X        25,B5
  24753   2 000933       0080
          2 000934  0501 0010                            BBT      s:24759,PREL

             24754    5              VDI$->KV$VDI.BSY = '1'B;

  24754   2 000936  8945 0019                            LBT,'0080'X       25,B5
  24754   2 000938       0080

             24755    5              KV@USRENT.SVDPTR$ = KV$PTR$;

  24755   2 000939  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          2 00093C  BFC7 0024                            STB,B3   KV@USRENT,AUTO

             24756    5              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;

  24756   2 00093E  ACC5 0006                            LDB,B2   6,B5
          2 000940  AF80 0000 0000  xsym                 STB,B2   KV$PTR$

             24757    5              END;                         /* ELSE IF ~BSY                       */
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:136  

  24757   2 000943  0F81 000E                            B        s:24766,PREL

             24758    5           ELSE DO;

             24759    5              VDI$->KV$VDI.DFR.USR(1) = '1'B;

  24759   2 000945  8945 0018                            LBT,'4000'X       24,B5
  24759   2 000947       4000

             24760    5           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24760                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24760   2 000948  BCC5 0008                            LDB,B3   8,B5
          2 00094A  ACC3 0033                            LDB,B2   51,B3
          2 00094C  8AC2 003B                            INC      59,B2
          2 00094E  8EC2 003A                            CAD      58,B2

             24761    5              GOTO L_RET;

  24761   2 000950  0F81 F80F                            B        s:24013,PREL

             24762    5              END;                         /* END IF                             */
      795    24765    4                            END;
      796    24766    3                      KV@SND_DAT = KX_SND_DAT;

  24766   2 000952  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 000955  2C4E                                 LDV,R2   78
          2 000956  6C14                                 LDV,R6   20
          2 000957  BB87                                 LAB,B3   ,AUTO
          2 000958  3C4C                                 LDV,R3   76
          2 000959  0008                                 MMM

      797    24767    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_CNF);

  24767   2 00095A  DB80 0000 0062  00                   LAB,B5   KX_KEY_CAL_CNF
          2 00095D  DF80 0000 003B  01                   STB,B5   KX_VDOVLPARY+10
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:137  

      798    24768    3                      KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;

  24768   2 000960  ACC7 0018                            LDB,B2   VC$,AUTO
          2 000962  9CC2 0026                            LDB,B1   38,B2
          2 000964  9FC7 0027                            STB,B1   KV@SND_DAT+1,AUTO

      799    24769    3                      KV@SND_DAT.DAT__.BYTX = 0;

  24769   2 000966  8747 0029                            CL       KV@SND_DAT+3,AUTO

      800    24770    3                      KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ;

  24770   2 000968  E842 0028                            LDR,R6   40,B2
          2 00096A  EF47 002A                            STR,R6   KV@SND_DAT+4,AUTO

      801    24771    3                      CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN

  24771   2 00096C  EBC7 0026                            LAB,B6   KV@SND_DAT,AUTO
          2 00096E  EFC7 0036                            STB,B6   X29MSGTYP+1,AUTO
          2 000970  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000972  CBF0 0100                            LAB,B4   256,IMO
          2 000974  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000977       0027                            DC       s:24778,PREL

      802    24772    4                            DO;

      803    24773    4                               KX$VC.CALCNFPND = '0'B;

  24773   2 000978  ECC7 0018                            LDB,B6   VC$,AUTO
          2 00097A  8846 0016                            LBF,'0800'X       22,B6
          2 00097C       0800

      804    24774    4                               CALL KVB$RLSSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.
             24774                                        CALPKT$ );

  24774   2 00097D  ECC7 0018                            LDB,B6   VC$,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:138  
          2 00097F  E846 0028                            LDR,R6   40,B6
          2 000981  6E01                                 ADV,R6   1
          2 000982  6041                                 SOR,R6   1
          2 000983  EF47 0036                            STR,R6   X29MSGTYP+1,AUTO
          2 000985  DBC6 0026                            LAB,B5   38,B6
          2 000987  DFC7 0039                            STB,B5   X29MSGTYP+4,AUTO
          2 000989  CBC7 0036                            LAB,B4   X29MSGTYP+1,AUTO
          2 00098B  CFC7 0037                            STB,B4   X29MSGTYP+2,AUTO
          2 00098D  BBC7 0037                            LAB,B3   X29MSGTYP+2,AUTO
          2 00098F  CBF0 0200                            LAB,B4   512,IMO
          2 000991  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000994       0001                            DC       s:24775,PREL

      805    24775    4                               KX$VC.CALPKT$ = ADDR(NIL);

  24775   2 000995  EB80 0000 0000                       LAB,B6   0
          2 000998  DCC7 0018                            LDB,B5   VC$,AUTO
          2 00099A  EFC5 0026                            STB,B6   38,B5

      806    24776    4                               KX$VC.CALMSGBYTSIZ = 0;

  24776   2 00099C  8745 0028                            CL       40,B5

      807    24777    4                            END;

      808    24778    3                      IF NOT KX$VC.VDHENTERED

  24778   2 00099E  ECC7 0018                            LDB,B6   VC$,AUTO
          2 0009A0  82C6 0016                            LB,'2000'X        22,B6
          2 0009A2       2000
          2 0009A3  0501 0016                            BBT      s:24799,PREL

      809    24779    3                         THEN
      810    24780    4                            DO;

      811    24781                                    %KV$USREXT;
             24787    4           KV$VDI.BSY = '0'B;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:139  

  24787   2 0009A5  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 0009A7  8845 0019                            LBF,'0080'X       25,B5
          2 0009A9       0080

             24789    4           KV$PTR$ = KV@USRENT.SVDPTR$;

  24789   2 0009AA  ECC7 0024                            LDB,B6   KV@USRENT,AUTO
          2 0009AC  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      812    24791    4                            END;

      813    24792    3                   END;

  24792   2 0009AF  0F81 000A                            B        s:24799,PREL

      814    24793        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:140  
      815    24794    2          CASE ( ELSE );

      816    24795
      817    24796    2             CALL KHD$SCREECH ( Y_UNKEVT );

  24796   2 0009B1  BB80 0000 0010  03                   LAB,B3   +16
          2 0009B4  CBF0 0100                            LAB,B4   256,IMO
          2 0009B6  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 0009B9       0001                            DC       s:24799,PREL

      818    24797
      819    24798    2       END; /* DO CASE */

      820    24799    1       RETURN;

  24799   2 0009BA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      821    24800
      822    24801    1   SCREECH_KXP: CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );

  24801   2 0009BD  BBC7 000D            SCREECH_KXP     LAB,B3   CALL_FPT+7,AUTO
          2 0009BF  CBF0 0100                            LAB,B4   256,IMO
          2 0009C1  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 0009C4       0001                            DC       s:24801+8,PREL
          2 0009C5  0F81 01FF                            B        s:25005,PREL

      823    24802
      824    24803
      825    24804        /*I*
      826    24805             NAME: Y$DECODE_X29
      827    24806             PURPOSE: The received packet has the Q-bit on and is thus an
      828    24807                      X.29 message. This routine decodes the X.29 protocol
      829    24808                      and changes the state and causes some actions, where
      830    24809                      appropriate.
      831    24810        */
      832    24811    1   Y$DECODE_X29: PROC;

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:141  
  24811   2 0009C7  EFC7 0032            Y$DECODE_X29    STB,B6   ERCOD+2,AUTO

      833    24812    2   DCL KX_X3_OK2SET(0:%KX_X3PRMX_HI#) BIT(1) CONSTANT
      834    24813    2     INIT ( '1'B,'0'B,'1'B*4,'0'B,'1'B*3,'0'B,'1'B*0 );
      835    24814    2   DCL X3_SET BIT(1);
      836    24815    2   DCL X29MSGTYP UBIN BYTE;
      837    24816
      838    24817    2       KX$VC.X3_PRM_BITS = '0'B;

  24817   2 0009C9  DCC7 0018                            LDB,B5   VC$,AUTO
          2 0009CB  5C03                                 LDV,R5   3
          2 0009CC  0021                                 ALR      ;
          2 0009CD       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 0009CF       4005 0017                                ALPHANUM(23,B5,,R5,FILL)

      839    24818    2       BYTX = FPT_X25.V_.BYTX;

  24818   2 0009D1  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          2 0009D3  437F                                 CSYNC    s:24818+1,SPREL
          2 0009D4  E846 000D                            LDR,R6   13,B6
          2 0009D6  EF47 001D                            STR,R6   BYTX,AUTO

      840    24819    2       X29MSGTYP = BYT_ARY(BYTX);

  24819   2 0009D8  DCC6 000B                            LDB,B5   11,B6
          2 0009DA  B856                                 LDR,R3   R6
          2 0009DB  C2B5                                 LLH,R4   ,B5,R3
          2 0009DC  C7C7 0035                            STH,R4   X29MSGTYP,AUTO

      841    24820    2       IF ( X29MSGTYP = %KX_X29MSGTYP_SETX3# OR

  24820   2 0009DE  A2C7 0035                            LLH,R2   X29MSGTYP,AUTO
          2 0009E0  2D02                                 CMV,R2   2
          2 0009E1  0901 0004                            BE       s:24823,PREL
          2 0009E3  2D06                                 CMV,R2   6
          2 0009E4  0981 0006                            BNE      s:24825,PREL

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:142  
      842    24821    2          X29MSGTYP = %KX_X29MSGTYP_SETREDX3# )
      843    24822    2          THEN
      844    24823    2             X3_SET = '1'B;

  24823   2 0009E6  8947 0034                            LBT,'8000'X       X3_SET,AUTO
  24823   2 0009E8       8000
          2 0009E9  0F81 0003                            B        s:24827,PREL

      845    24824    2          ELSE
      846    24825    2             X3_SET = '0'B;

  24825   2 0009EB  8747 0034                            CL       X3_SET,AUTO

      847    24826
      848    24827    3       DO CASE ( X29MSGTYP );

  24827   2 0009ED  2D07                                 CMV,R2   7
          2 0009EE  0281 00AB                            BGE      s:24894,PREL
          2 0009F0  9820 0000 09F6  02                   LDR,R1   s:24827+9,R2
          2 0009F3  8390 0000 09FD  02                   JMP      s:24839,R1
          2 0009F6       009D                            DC       s:24894,PREL
          2 0009F7       0076                            DC       s:24872,PREL
          2 0009F8       0000                            DC       s:24839,PREL
          2 0009F9       009D                            DC       s:24894,PREL
          2 0009FA       0000                            DC       s:24839,PREL
          2 0009FB       009D                            DC       s:24894,PREL
          2 0009FC       0000                            DC       s:24839,PREL

      849    24828
      850    24829        %EJECT;
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:143  
      851    24830        /*
      852    24831           Set X.3 parameter PAD message.
      853    24832        */
      854    24833
      855    24834    3          CASE (%KX_X29MSGTYP_SETX3#,%KX_X29MSGTYP_SETREDX3#,%KX_X29MSGTYP_REDX3#);

      856    24835
      857    24836        /*
      858    24837           If set or set/read, copy these parameter values into the X.28 context block.
      859    24838        */
      860    24839    3             BYTX = BYTX + 1;

  24839   2 0009FD  8AC7 001D                            INC      BYTX,AUTO

      861    24840    3             IF ( BYTX >= FPT_X25.V_.BYTSIZ+ FPT_X25.V_.BYTX )

  24840   2 0009FF  BA46 000E                            ADD,R3   14,B6
          2 000A01  3801 0005                            BLZ,R3   s:24842,PREL
          2 000A03  B947 001D                            CMR,R3   BYTX,AUTO
          2 000A05  0301 0006                            BG       s:24843,PREL

      862    24841    3                THEN
      863    24842    3                   KX$VC.X3_PRM_ALL = '1'B;

  24842   2 000A07  CCC7 0018                            LDB,B4   VC$,AUTO
          2 000A09  8944 0016                            LBT,'0002'X       22,B4
          2 000A0B       0002

      864    24843    4             DO WHILE ( BYTX < FPT_X25.V_.BYTSIZ+ FPT_X25.V_.BYTX );

  24843   2 000A0C  0F81 0042                            B        s:24858,PREL

      865    24844    4                PRM_INDEX = BYT_ARY (BYTX);

  24844   2 000A0E  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          2 000A10  DCC6 000B                            LDB,B5   11,B6
          2 000A12  B847 001D                            LDR,R3   BYTX,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:144  
          2 000A14  E2B5                                 LLH,R6   ,B5,R3
          2 000A15  EF47 001E                            STR,R6   PRM_INDEX,AUTO

      866    24845    4                IF ( PRM_INDEX > %KX_X3PRMX_HI# + 1 ) OR

  24845   2 000A17  6D16                                 CMV,R6   22
          2 000A18  0301 0009                            BG       s:24849,PREL
          2 000A1A  89C7 0034                            CMZ      X3_SET,AUTO
          2 000A1C  0801 0012                            BAL      s:24853,PREL
          2 000A1E  3E01                                 ADV,R3   1
          2 000A1F  D2B5                                 LLH,R5   ,B5,R3
          2 000A20  5901 000E                            BEZ,R5   s:24853,PREL

      867    24846    4                   ( NOT X3_SET AND BYT_ARY(BYTX+1)~=0 )
      868    24847    4                   THEN
      869    24848    5                      DO;

      870    24849    5                         ERCOD = BAD_SET_X3_MSG;

  24849   2 000A22  8C80 0000 0046  00                   LDI      BAD_SET_X3_MSG
          2 000A25  8D47 0030                            SDI      ERCOD,AUTO

      871    24850    5                         KX$VC.ERRPADTYP = %KX_X29_ERRPADTYP_INC#;

  24850   2 000A27  5C02                                 LDV,R5   2
          2 000A28  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000A2A  DAC5 0023                            SRM,R5,'00FF'X    35,B5
          2 000A2C       00FF

      872    24851    5                         GOTO ERR_PAD;

  24851   2 000A2D  0F81 0077                            B        s:24915,PREL

      873    24852    5                      END;
      874    24853    4                KX$VC.X3_PRM_BIT ( PRM_INDEX - 1 ) = '1'B;

  24853   2 000A2F  CCC7 0018                            LDB,B4   VC$,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:145  
          2 000A31  BBC4 0016                            LAB,B3   22,B4
          2 000A33  B856                                 LDR,R3   R6
          2 000A34  3E0F                                 ADV,R3   15
          2 000A35  8933                                 LBT      ,B3,R3

      875    24854    4                IF X3_SET AND KX_X3_OK2SET ( PRM_INDEX - 1 )

  24854   2 000A36  89C7 0034                            CMZ      X3_SET,AUTO
          2 000A38  0881 0011                            BAGE     s:24857,PREL
          2 000A3A  82B0 0000 008B  00                   LB       KVM$SND+1,R3
          2 000A3D  0581 000C                            BBF      s:24857,PREL

      876    24855    4                   THEN
      877    24856    4                      KX$VC.X3PRM ( PRM_INDEX - 1 ) = BYT_ARY ( BYTX + 1 );

  24856   2 000A3F  DCC6 000B                            LDB,B5   11,B6
          2 000A41  A847 001D                            LDR,R2   BYTX,AUTO
          2 000A43  2E01                                 ADV,R2   1
          2 000A44  D2A5                                 LLH,R5   ,B5,R2
          2 000A45  CCC7 0018                            LDB,B4   VC$,AUTO
          2 000A47  9856                                 LDR,R1   R6
          2 000A48  1E30                                 ADV,R1   48
          2 000A49  D794                                 STH,R5   ,B4,R1

      878    24857    4                BYTX = BYTX + 2;

  24857   2 000A4A  D847 001D                            LDR,R5   BYTX,AUTO
          2 000A4C  5E02                                 ADV,R5   2
          2 000A4D  DF47 001D                            STR,R5   BYTX,AUTO

      879    24858    4             END; /*  DO WHILE  */

  24858   2 000A4F  D846 000E                            LDR,R5   14,B6
          2 000A51  DA46 000D                            ADD,R5   13,B6
          2 000A53  5801 0005                            BLZ,R5   s:24860,PREL
          2 000A55  D947 001D                            CMR,R5   BYTX,AUTO
          2 000A57  0301 FFB6                            BG       s:24844,PREL
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:146  

      880    24859
      881    24860    3             IF ( X29MSGTYP = %KX_X29MSGTYP_REDX3# OR

  24860   2 000A59  D2C7 0035                            LLH,R5   X29MSGTYP,AUTO
          2 000A5B  5D04                                 CMV,R5   4
          2 000A5C  0901 0004                            BE       s:24863,PREL
          2 000A5E  5D06                                 CMV,R5   6
          2 000A5F  0981 0071                            BNE      s:24921,PREL

      882    24861    3                X29MSGTYP = %KX_X29MSGTYP_SETREDX3# )
      883    24862    3                THEN
      884    24863    3                   CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_PRMIND#, KX$VC );

  24863   2 000A61  DBF0 0000                            LAB,B5   0,IMO
          2 000A63  CCC7 0018                            LDB,B4   VC$,AUTO
          2 000A65  CFC7 0038                            STB,B4   X29MSGTYP+3,AUTO
          2 000A67  DFC7 0036                            STB,B5   X29MSGTYP+1,AUTO
          2 000A69  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000A6B  CBF0 0200                            LAB,B4   512,IMO
          2 000A6D  E380 0000 0000  xent                 LNJ,B6   KXX$SNDX29MSG
          2 000A70       0001                            DC       s:24863+16,PREL
          2 000A71  0F81 005F                            B        s:24921,PREL

      885    24864        /*
      886    24865           Invitation to clear PAD message.
      887    24866        */
      888    24867    3          CASE ( %KX_X29MSGTYP_INV2CLR# );

      889    24868
      890    24869        /*
      891    24870           Clear the circuit if all input data has been forwarded to VDH
      892    24871        */
      893    24872    3             IF NOT KX$VC.BLK_L3

  24872   2 000A73  CCC7 0018                            LDB,B4   VC$,AUTO
          2 000A75  82C4 0016                            LB,'4000'X        22,B4
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:147  
          2 000A77       4000
          2 000A78  0501 001C                            BBT      s:24883,PREL

      894    24873    3                THEN
      895    24874    4                   DO;

      896    24875    4                      CALL_FPT.EVN = %KX_P_EV_VCLST#;

  24875   2 000A7A  6C09                                 LDV,R6   9
          2 000A7B  EF47 0006                            STR,R6   CALL_FPT,AUTO

      897    24876    4                      CALL KXP$PACKET ( CALL_FPT ) WHENALTRETURN

  24876   2 000A7D  BBC7 0006                            LAB,B3   CALL_FPT,AUTO
          2 000A7F  BFC7 0036                            STB,B3   X29MSGTYP+1,AUTO
          2 000A81  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000A83  CBF0 0100                            LAB,B4   256,IMO
          2 000A85  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 000A88       0003                            DC       s:24878,PREL
          2 000A89  0F81 0009                            B        s:24880,PREL

      898    24877    5                            DO;

      899    24878    5                               CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );

  24878   2 000A8B  BBC7 000D                            LAB,B3   CALL_FPT+7,AUTO
          2 000A8D  CBF0 0100                            LAB,B4   256,IMO
          2 000A8F  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000A92       0001                            DC       s:24880,PREL

      900    24879    5                            END;

      901    24880    4                   END;

  24880   2 000A93  0F81 003D                            B        s:24921,PREL

      902    24881    3                ELSE
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:148  
      903    24882    4                   DO;

      904    24883    4                      KX$VC.INV2CLR = '1'B;

  24883   2 000A95  8944 0016                            LBT,'0008'X       22,B4
  24883   2 000A97       0008

      905    24884    4                   END;

  24884   2 000A98  0F81 0038                            B        s:24921,PREL

      906    24885        /*
      907    24886           The only other valid X.29 messages are:
      908    24887             Parameter indication PAD message,
      909    24888             Error PAD message,
      910    24889             Break indication PAD message,
      911    24890           Or the message code is invalid.
      912    24891           We do not expect any of these and should clear the circuit.
      913    24892        */
      914    24893    3          CASE (ELSE);

      915    24894    3             KX$VC.ERRPADTYP = %KX_X29_ERRPADTYP_BADCOD#;

  24894   2 000A9A  1C01                                 LDV,R1   1
          2 000A9B  CCC7 0018                            LDB,B4   VC$,AUTO
          2 000A9D  9AC4 0023                            SRM,R1,'00FF'X    35,B4
          2 000A9F       00FF

      916    24895    3             ERCOD = BAD_PAD_MSG;

  24895   2 000AA0  8C80 0000 0044  00                   LDI      BAD_PAD_MSG
          2 000AA3  8D47 0030                            SDI      ERCOD,AUTO

      917    24896    3   ERR_PAD:
      918    24897                  %WRSYSLOG ( ERRCOD = ERCOD,
      919    24898                  TRMID = "KX$VC.CHN$->KH$CHN.TERMID",
      920    24899                  BFR = "FPT_X25.V_.ADR$->KX$DATA" );
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:149  

  24915   2 000AA5  DCC7 0018            ERR_PAD         LDB,B5   VC$,AUTO
          2 000AA7  CCC5 0004                            LDB,B4   4,B5
          2 000AA9  BCC6 000B                            LDB,B3   11,B6
          2 000AAB  BFC7 003A                            STB,B3   X29MSGTYP+5,AUTO
          2 000AAD  ABC4 0012                            LAB,B2   18,B4
          2 000AAF  AFC7 0038                            STB,B2   X29MSGTYP+3,AUTO
          2 000AB1  CBC7 0030                            LAB,B4   ERCOD,AUTO
          2 000AB3  CFC7 0036                            STB,B4   X29MSGTYP+1,AUTO
          2 000AB5  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000AB7  CBF0 0300                            LAB,B4   768,IMO
          2 000AB9  E380 0000 0000  xent                 LNJ,B6   KXS$SYSLOG
          2 000ABC       0001                            DC       s:24917,PREL

      921    24917    3             KX$VC.ERRPADCOD = X29MSGTYP;

  24917   2 000ABD  E2C7 0035                            LLH,R6   X29MSGTYP,AUTO
          2 000ABF  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000AC1  E7C6 0024                            STH,R6   36,B6

      922    24918    3             CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_ERRPAD#, KX$VC );

  24918   2 000AC3  DBF0 0005                            LAB,B5   5,IMO
          2 000AC5  EFC7 0038                            STB,B6   X29MSGTYP+3,AUTO
          2 000AC7  DFC7 0036                            STB,B5   X29MSGTYP+1,AUTO
          2 000AC9  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000ACB  CBF0 0200                            LAB,B4   512,IMO
          2 000ACD  E380 0000 0000  xent                 LNJ,B6   KXX$SNDX29MSG
          2 000AD0       0001                            DC       s:24921,PREL

      923    24919    3       END; /*  DO CASE  */

      924    24920
      925    24921    2       IF X3_SET AND KX$VC.RPRX3  /* we have to tell the host */

  24921   2 000AD1  89C7 0034                            CMZ      X3_SET,AUTO
          2 000AD3  0881 00ED                            BAGE     s:25000,PREL
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:150  
          2 000AD5  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000AD7  82C6 0016                            LB,'0004'X        22,B6
          2 000AD9       0004
          2 000ADA  0581 00E6                            BBF      s:25000,PREL

      926    24922    2          THEN
      927    24923    3             DO;

      928    24924    3                KV@SND_DAT = KX_SND_DAT;

  24924   2 000ADC  AB80 0000 0000  01                   LAB,B2   KX_VDH_EVT_ATN
          2 000ADF  2C4E                                 LDV,R2   78
          2 000AE0  6C14                                 LDV,R6   20
          2 000AE1  BB87                                 LAB,B3   ,AUTO
          2 000AE2  3C4C                                 LDV,R3   76
          2 000AE3  0008                                 MMM

      929    24925    3                IF NOT KX$VC.X3PND

  24925   2 000AE4  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000AE6  82C6 0016                            LB,'0800'X        22,B6
          2 000AE8       0800
          2 000AE9  0501 0041                            BBT      s:24940,PREL

      930    24926    3                   THEN
      931    24927    4                      DO;

      932    24928    4                         KX$VC.CALMSGBYTSIZ = LENGTHC(VC_CAL);

  24928   2 000AEB  6C2E                                 LDV,R6   46
          2 000AEC  EF46 0028                            STR,R6   40,B6

      933    24929    4                         CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )

  24929   2 000AEE  6E01                                 ADV,R6   1
          2 000AEF  6041                                 SOR,R6   1
          2 000AF0  EF47 0036                            STR,R6   X29MSGTYP+1,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:151  
          2 000AF2  DBC6 0026                            LAB,B5   38,B6
          2 000AF4  DFC7 0039                            STB,B5   X29MSGTYP+4,AUTO
          2 000AF6  CBC7 0036                            LAB,B4   X29MSGTYP+1,AUTO
          2 000AF8  CFC7 0037                            STB,B4   X29MSGTYP+2,AUTO
          2 000AFA  BBC7 0037                            LAB,B3   X29MSGTYP+2,AUTO
          2 000AFC  CBF0 0200                            LAB,B4   512,IMO
          2 000AFE  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000B01       0003                            DC       s:24932,PREL
          2 000B02  0F81 000A                            B        s:24934,PREL

      934    24930    4                            WHENALTRETURN
      935    24931    5                               DO;

      936    24932    5                                  CALL KHD$SCREECH ( Y_NO_MEM );

  24932   2 000B04  BB80 0000 0008  03                   LAB,B3   +8
          2 000B07  CBF0 0100                            LAB,B4   256,IMO
          2 000B09  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000B0C       0001                            DC       s:24934,PREL

      937    24933    5                               END;

      938    24934    4                         KX$VC.CALPKT$->VC$CAL = '0'B;

  24934   2 000B0D  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000B0F  DCC6 0026                            LDB,B5   38,B6
          2 000B11  5C2E                                 LDV,R5   46
          2 000B12  0021                                 ALR      ;
          2 000B13       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 000B15       4005 0000                                ALPHANUM(0,B5,,R5,FILL)

      939    24935    4                         KX$VC.CALPKT$->VC$CAL.FUNCTION = %KX_VCFNC_INDX3#;

  24935   2 000B17  437F                                 CSYNC    s:24934+9,SPREL
          2 000B18  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000B1A  DCC6 0026                            LDB,B5   38,B6
          2 000B1C  6C14                                 LDV,R6   20
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:152  
          2 000B1D  E785                                 STH,R6   ,B5

      940    24936    4                         KX$VC.X3PND = '1'B;

  24936   2 000B1E  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000B20  8946 0016                            LBT,'0800'X       22,B6
          2 000B22       0800

      941    24937    4                         KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INDX3);

  24937   2 000B23  EB80 0000 0085  00                   LAB,B6   KX_KEY_INDX3
          2 000B26  EF80 0000 003B  01                   STB,B6   KX_VDOVLPARY+10

      942    24938    4                      END;

  24938   2 000B29  0F81 0007                            B        s:24941,PREL

      943    24939    3                   ELSE
      944    24940    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_CNF);

  24940   2 000B2B  DB80 0000 0062  00                   LAB,B5   KX_KEY_CAL_CNF
          2 000B2E  DF80 0000 003B  01                   STB,B5   KX_VDOVLPARY+10

      945    24941    3                KX$VC.CALPKT$->VC$CAL.X3 = KX$VC.X3PRM;

  24941   2 000B31  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000B33  DCC6 0026                            LDB,B5   38,B6
          2 000B35  AB86                                 LAB,B2   ,B6
          2 000B36  2C31                                 LDV,R2   49
          2 000B37  6C16                                 LDV,R6   22
          2 000B38  BB85                                 LAB,B3   ,B5
          2 000B39  3C13                                 LDV,R3   19
          2 000B3A  0008                                 MMM

      946    24942    3                IF NOT KV$VDI.USRRQSDAT.RED

  24942   2 000B3B  CCC7 001A                            LDB,B4   VDI$,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:153  
          2 000B3D  82C4 001D                            LB,'0010'X        29,B4
          2 000B3F       0010
          2 000B40  0581 0080                            BBF      s:25000,PREL

      947    24943    3                   THEN
      948    24944    3                      GOTO L_RETURN;
      949    24945    3                IF NOT KX$VC.VDHENTERED

  24945   2 000B42  9CC7 0018                            LDB,B1   VC$,AUTO
          2 000B44  82C1 0016                            LB,'2000'X        22,B1
          2 000B46       2000
          2 000B47  0501 002A                            BBT      s:24976,PREL

      950    24946    3                   THEN
      951    24947    4                      DO;

      952    24948                              %KV$USRENT ( VDI$ = VDI$, DFR$ = L_RETURN,
      953    24949                              SCHRSN = %KV_SCHRSN_DFR1 );
             24962    4           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24962                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24962   2 000B49  ECC4 0008                            LDB,B6   8,B4
          2 000B4B  ACC6 0033                            LDB,B2   51,B6
          2 000B4D  8AC2 0039                            INC      57,B2
          2 000B4F  8EC2 0038                            CAD      56,B2

             24963    5           IF NOT VDI$->KV$VDI.BSY THEN DO;

  24963   2 000B51  82C4 0019                            LB,'0080'X        25,B4
  24963   2 000B53       0080
          2 000B54  0501 0010                            BBT      s:24969,PREL

             24964    5              VDI$->KV$VDI.BSY = '1'B;

  24964   2 000B56  8944 0019                            LBT,'0080'X       25,B4
  24964   2 000B58       0080

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:154  
             24965    5              KV@USRENT.SVDPTR$ = KV$PTR$;

  24965   2 000B59  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 000B5C  EFC7 0024                            STB,B6   KV@USRENT,AUTO

             24966    5              KV$PTR$ = VDI$->KV$VDI.ASNINPPTR$;

  24966   2 000B5E  ACC4 0006                            LDB,B2   6,B4
          2 000B60  AF80 0000 0000  xsym                 STB,B2   KV$PTR$

             24967    5              END;                         /* ELSE IF ~BSY                       */

  24967   2 000B63  0F81 000E                            B        s:24976,PREL

             24968    5           ELSE DO;

             24969    5              VDI$->KV$VDI.DFR.USR(1) = '1'B;

  24969   2 000B65  8944 0018                            LBT,'4000'X       24,B4
  24969   2 000B67       4000

             24970    5           VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24970                    VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24970   2 000B68  ECC4 0008                            LDB,B6   8,B4
          2 000B6A  ACC6 0033                            LDB,B2   51,B6
          2 000B6C  8AC2 003B                            INC      59,B2
          2 000B6E  8EC2 003A                            CAD      58,B2

             24971    5              GOTO L_RETURN;

  24971   2 000B70  0F81 0050                            B        s:25000,PREL

             24972    5              END;                         /* END IF                             */
      954    24975    4                      END;
      955    24976    3                KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:155  
  24976   2 000B72  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000B74  ACC6 0026                            LDB,B2   38,B6
          2 000B76  AFC7 0027                            STB,B2   KV@SND_DAT+1,AUTO

      956    24977    3                KV@SND_DAT.DAT__.BYTX = 0;

  24977   2 000B78  8747 0029                            CL       KV@SND_DAT+3,AUTO

      957    24978    3                KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ;

  24978   2 000B7A  E846 0028                            LDR,R6   40,B6
          2 000B7C  EF47 002A                            STR,R6   KV@SND_DAT+4,AUTO

      958    24979    3                CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN

  24979   2 000B7E  9BC7 0026                            LAB,B1   KV@SND_DAT,AUTO
          2 000B80  9FC7 0036                            STB,B1   X29MSGTYP+1,AUTO
          2 000B82  BBC7 0036                            LAB,B3   X29MSGTYP+1,AUTO
          2 000B84  CBF0 0100                            LAB,B4   256,IMO
          2 000B86  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000B89       0027                            DC       s:24986,PREL

      959    24980    4                      DO;

      960    24981    4                         KX$VC.CALCNFPND = '0'B;

  24981   2 000B8A  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000B8C  8846 0016                            LBF,'0800'X       22,B6
          2 000B8E       0800

      961    24982    4                         CALL KVB$RLSSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ );

  24982   2 000B8F  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000B91  E846 0028                            LDR,R6   40,B6
          2 000B93  6E01                                 ADV,R6   1
          2 000B94  6041                                 SOR,R6   1
          2 000B95  EF47 0036                            STR,R6   X29MSGTYP+1,AUTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:156  
          2 000B97  DBC6 0026                            LAB,B5   38,B6
          2 000B99  DFC7 0039                            STB,B5   X29MSGTYP+4,AUTO
          2 000B9B  CBC7 0036                            LAB,B4   X29MSGTYP+1,AUTO
          2 000B9D  CFC7 0037                            STB,B4   X29MSGTYP+2,AUTO
          2 000B9F  BBC7 0037                            LAB,B3   X29MSGTYP+2,AUTO
          2 000BA1  CBF0 0200                            LAB,B4   512,IMO
          2 000BA3  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000BA6       0001                            DC       s:24983,PREL

      962    24983    4                         KX$VC.CALPKT$ = ADDR(NIL);

  24983   2 000BA7  EB80 0000 0000                       LAB,B6   0
          2 000BAA  DCC7 0018                            LDB,B5   VC$,AUTO
          2 000BAC  EFC5 0026                            STB,B6   38,B5

      963    24984    4                         KX$VC.CALMSGBYTSIZ = 0;

  24984   2 000BAE  8745 0028                            CL       40,B5

      964    24985    4                      END;

      965    24986    3                IF NOT KX$VC.VDHENTERED

  24986   2 000BB0  ECC7 0018                            LDB,B6   VC$,AUTO
          2 000BB2  82C6 0016                            LB,'2000'X        22,B6
          2 000BB4       2000
          2 000BB5  0501 000B                            BBT      s:25000,PREL

      966    24987    3                   THEN
      967    24988    4                      DO;

      968    24989                              %KV$USREXT;
             24995    4           KV$VDI.BSY = '0'B;

  24995   2 000BB7  DCC7 001A                            LDB,B5   VDI$,AUTO
          2 000BB9  8845 0019                            LBF,'0080'X       25,B5
          2 000BBB       0080
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:157  

             24997    4           KV$PTR$ = KV@USRENT.SVDPTR$;

  24997   2 000BBC  ECC7 0024                            LDB,B6   KV@USRENT,AUTO
          2 000BBE  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      969    24999    4                      END;

      970    25000    3             END;

      971    25001    2   L_RETURN:
      972    25002    2       RETURN;

  25002   2 000BC1  ECC7 0032            L_RETURN        LDB,B6   ERCOD+2,AUTO
          2 000BC3  C3C6 0001                            LNJ,B4   1,B6

      973    25003    2   END Y$DECODE_X29;
      974    25004
      975    25005    1   END KXV$VCVDH;

  25005   2 000BC5  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:158  
--  Include file information  --

   KNH_MACRO_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV$SND.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KV$VDH.:E05TOU  is referenced.
   KV$GLBCTX.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KX_EQUS_E.:E05TOU  is referenced.
   KXX_MACROS_M.:E05TOU  is referenced.
   KX_MACROS_M.:E05TOU  is referenced.
   KX_SCODE_C.:E05TOU  is referenced.
   KX_PERR_C.:E05TOU  is referenced.
   KX_DATA_C.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:159  
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KXV$VCVDH.
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:160  

 **** Variables and constants ****

  ****  Section 000 RoData KXV$VCVDH

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    44-0-0/w STRC(32)    r     1 BAD_PAD_MSG               46-0-0/w STRC(32)    r     1 BAD_SET_X3_MSG
    8A-0-0/w EPTR        r     1 KVM$SND                   62-0-0/w STRC(80)    r     1 KX_KEY_CAL_CNF
    80-0-0/w STRC(80)    r     1 KX_KEY_CLR_IND            67-0-0/w STRC(80)    r     1 KX_KEY_DAT_IND
    85-0-0/w STRC(80)    r     1 KX_KEY_INDX3              71-0-0/w STRC(80)    r     1 KX_KEY_INT_CNF
    6C-0-0/w STRC(80)    r     1 KX_KEY_INT_IND            7B-0-0/w STRC(80)    r     1 KX_KEY_RST_CNF
    76-0-0/w STRC(80)    r     1 KX_KEY_RST_IND            10-0-0/w STRC(824)   r     1 KX_VC
    8C-0-0/b BIT         r     1 KX_X3_OK2SET(0:21)
    4B-0-0/w STRC(48)    r     1 Y_BADRMTDCL               54-0-0/w STRC(48)    r     1 Y_BADSTT
    5A-0-0/w STRC(48)    r     1 Y_ILG_EVT                 57-0-0/w STRC(48)    r     1 Y_NO_MEM
    48-0-0/w STRC(48)    r     1 Y_NO_VCCTX                4E-0-0/w STRC(48)    r     1 Y_UNKEVT

  ****  Section 001  Data  KXV$VCVDH

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    27-0-0/w STRC(160)   r     1 KX_SND_DAT                 0-0-0/w STRC(32)    r     1 KX_VDH_EVT_ATN
    31-0-0/w STRC(224)   r     1 KX_VDOVLPARY               2-0-0/w STRC(368)   r     1 VC_CAL
    1D-0-0/w STRC(160)   r     1 VC_CLR                    19-0-0/c STRC(16)    r     1 VC_DAT
    1A-0-0/c STRC(16)    r     1 VC_INT                    1B-0-0/c STRC(24)    r     1 VC_RST

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @FPT_X25                  1D-0-0/w UBIN(16)    r     1 BYTX
     6-0-0/w STRC(256)   r     1 CALL_FPT                  20-0-0/w PTR         r     1 DAT$
    30-0-0/w STRC(32)    r     1 ERCOD                     *0-0-0/w STRC(256)   r     1 FPT_X25
    26-0-0/w STRC(160)   r     1 KV@SND_DAT                24-0-0/w STRC(32)    r     1 KV@USRENT
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:161  
    22-0-0/w STRC(32)    r     1 KV@VDH_DSC                16-0-0/w PTR         r     1 L3$
    1E-0-0/w UBIN(16)    r     1 PRM_INDEX                 18-0-0/w PTR         r     1 VC$
    1A-0-0/w PTR         r     1 VDI$                      35-0-0/w UBIN(8)     r     1 X29MSGTYP
    34-0-0/b BIT         r     1 X3_SET                    1C-0-0/w UBIN(16)    r     1 Y@BYTSIZ

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$JIT$                     0-0-0/w PTR         r     1 KV$PTR$
     0-0-0/w STRC(32)    r     1 KV_VDH_EVT_RLSVDI          0-0-0/w STRC(32)    r     1 KV_VDH_EVT_RQSOTP
     0-0-0/w STRC(32)    r     1 KXX_VDH_DSC                0-0-0/w STRC(672)   r     1 KX_BUF
     0-0-0/b EPTR        r     1 KX_PM$(0:2)                0-0-0/w STRC(1248)  r     1 KX_STATS_X29

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(48)    r     1 B$SCODE                    0-0-0/c UBIN(8)     r     1 BYT_ARY(0:2000)
     0-0-0/w CHAR(2000)  r     1 DSTR                       0-0-0/w CHAR(2000)  r     1 IN_STR
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/w STRC(8960)  r     1 KV$STT
     0-0-0/w STRC(912)   r     1 KV$USRPRM                  0-0-0/w STRC(512)   r     1 KV$VDI
     0-0-0/w STRC(128)   r     1 KX$DATA                    0-0-0/w STRC(4992)  r     1 KX$L2
     0-0-0/w STRC(2320)  r     1 KX$L3                      0-0-0/w STRC(384)   r     1 KX$LINKDEV
     0-0-0/w STRC(824)   r     1 KX$VC                      0-0-0/w STRC(80)    r     1 KX$VC_OTPBFR
     0-0-0/w STRC(368)   r     1 VC$CAL                     0-0-0/w STRC(160)   r     1 VC$CLR
     0-0-0/c STRC(16)    r     1 VC$INT


   Procedure KXV$VCVDH requires 3016 words for executable code.
   Procedure KXV$VCVDH requires 60 words of local(AUTO) storage.

    No errors detected in file KXV$VCVDH.:E05TSI    .
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:162  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:163  
          MINI XREF LISTING

B$SCODE
     21002**DCL     24801<>CALL    24878<>CALL
BAD_PAD_MSG
     22602**DCL     24895>>ASSIGN
BAD_SET_X3_MSG
     22650**DCL     24849>>ASSIGN
BLK_L3
     24016**LABEL   23985--GOTO    23999--CALLALT
BYTX
     18722**DCL     24818<<ASSIGN  24819>>ASSIGN  24839<<ASSIGN  24839>>ASSIGN  24840>>IF      24843>>DOWHILE
     24844>>ASSIGN  24845>>IF      24856>>ASSIGN  24857<<ASSIGN  24857>>ASSIGN
BYT_ARY
     19688**DCL     24819>>ASSIGN  24844>>ASSIGN  24845>>IF      24856>>ASSIGN
CALL_FPT
     18701**DCL     23895<<ASSIGN  23918<>CALL    24308<>CALL    24876<>CALL
CALL_FPT.CAL$
     18705**DCL     23897<<ASSIGN
CALL_FPT.EVN
     18705**DCL     23910<<ASSIGN  24305<<ASSIGN  24875<<ASSIGN
CALL_FPT.PRM1
     18706**DCL     24306<<ASSIGN
CALL_FPT.PRM1$
     18706**DCL     18707--REDEF   24801>>CALL    24878>>CALL
CALL_FPT.PRM2$
     18708**DCL     18708--REDEF
CALL_FPT.PRS.PRM1
     18711**DCL     24307<<ASSIGN
CALL_FPT.RCV$
     18705**DCL     23896<<ASSIGN
CALL_FPT.V_.ADR$
     18709**DCL     23914<<ASSIGN
CALL_FPT.V_.BYTSIZ
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:164  
     18710**DCL     23916<<ASSIGN
CALL_FPT.V_.BYTX
     18710**DCL     23915<<ASSIGN
DAT$
     18725**DCL     18889--IMP-PTR 19689--IMP-PTR 24072<<ASSIGN  24073>>ASSIGN  24074>>ASSIGN  24076>>CALL
     24076<>CALL    24117<<ASSIGN  24118>>ASSIGN  24119>>ASSIGN  24121>>ASSIGN  24122>>ASSIGN  24123>>ASSIGN
     24633<<ASSIGN  24634>>ASSIGN  24635>>ASSIGN  24636>>CALL    24636<>CALL
DSTR
     19689**DCL     23992<<ASSIGN  23992>>ASSIGN  24160<<ASSIGN  24160>>ASSIGN  24328<<ASSIGN  24577<<ASSIGN
     24729<<ASSIGN
DWORD
     23859**DCL     23860--REDEF
ERCOD
     21070**DCL     24849<<ASSIGN  24895<<ASSIGN  24915<>CALL
ERR_PAD IN PROCEDURE Y$DECODE_X29
     24915**LABEL   24851--GOTO
FPT_X25
     18657**DCL        13--PROC
FPT_X25.CAL$
     18661**DCL     23872>>ASSIGN  23928>>ASSIGN  24353>>ASSIGN
FPT_X25.EVN
     18661**DCL     23887>>IF      23899>>DOCASE  24551>>IF
FPT_X25.PRM1
     18662**DCL     23932<<ASSIGN  24348<<ASSIGN  24410>>ASSIGN  24411>>ASSIGN  24574>>ASSIGN
FPT_X25.PRM1$
     18662**DCL     18663--REDEF   20966--IMP-PTR 24336>>ASSIGN  24337>>IF      24339>>ASSIGN  24341>>ASSIGN
     24342>>ASSIGN  24354>>ASSIGN  24358>>ASSIGN  24399>>ASSIGN  24399>>ASSIGN
FPT_X25.PRM2
     18662**DCL     24412>>ASSIGN  24413>>ASSIGN  24575>>ASSIGN
FPT_X25.PRM2$
     18664**DCL     18664--REDEF   23929>>ASSIGN  24351>>ASSIGN
FPT_X25.PRS.PRM1
     18667**DCL     23946>>IF      23990>>ASSIGN  24122<<ASSIGN
FPT_X25.PRS.PRM2
     18667**DCL     23991>>ASSIGN  24123<<ASSIGN
FPT_X25.PRS.V
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:165  
     18668**DCL     24565>>IF
FPT_X25.RCV$
     18661**DCL     23873>>ASSIGN  24347<<ASSIGN
FPT_X25.V_.ADR$
     18665**DCL     19687--IMP-PTR 19688--IMP-PTR 23992>>ASSIGN  23996>>ASSIGN  24119<<ASSIGN  24160>>ASSIGN
     24328>>ASSIGN  24577>>ASSIGN  24729>>ASSIGN  24819>>ASSIGN  24844>>ASSIGN  24845>>IF      24856>>ASSIGN
     24915>>CALL
FPT_X25.V_.BYTSIZ
     18666**DCL     23998>>ASSIGN  24121<<ASSIGN  24152>>ASSIGN  24153>>ASSIGN  24160>>ASSIGN  24160>>ASSIGN
     24315>>ASSIGN  24325>>ASSIGN  24568>>ASSIGN  24572>>ASSIGN  24715>>ASSIGN  24725>>ASSIGN  24840>>IF
     24843>>DOWHILE
FPT_X25.V_.BYTX
     18666**DCL     23992>>ASSIGN  23997>>ASSIGN  24120<<ASSIGN  24121>>ASSIGN  24160>>ASSIGN  24315>>ASSIGN
     24326>>ASSIGN  24568>>ASSIGN  24573>>ASSIGN  24715>>ASSIGN  24726>>ASSIGN  24818>>ASSIGN  24840>>IF
     24843>>DOWHILE
G$JIT.ERRLOG
     19616**DCL     19619--REDEF
G$JIT.JSUNIT
     19355**DCL     19356--REDEF
G$JIT.MCLS
     19354**DCL     19354--REDEF
G$JIT.TMRZ
     19623**DCL     19624--REDEF
G$JIT.USER_EXTIME
     19347**DCL     19348--REDEF
G$JIT.USER_MEMTIME
     19350**DCL     19350--REDEF
G$JIT.USER_SVTIME
     19349**DCL     19349--REDEF
G$JIT$
     22052**DCL     19286--IMP-PTR
IN_STR
     19687**DCL     24328>>ASSIGN  24577>>ASSIGN  24729>>ASSIGN
KH$CHN.TERMID
     19257**DCL     24915<>CALL
KH$CHN.TERMID.LEV
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:166  
     19259**DCL     24705>>IF
KH$CHN.TERMID.TERM
     19259**DCL     19268--REDEF
KH$CHN.TERMID.TTYP
     19259**DCL     23930<<ASSIGN  24352<<ASSIGN
KHD$SCREECH
     23848**DCL-ENT 23893--CALL    23926--CALL    24157--CALL    24300--CALL    24701--CALL    24796--CALL
     24801--CALL    24878--CALL    24932--CALL
KH_CHNHI
     21263**DCL     21264--REDEF
KH_CHNLOW
     21264**DCL     21265--REDEF
KV$PTR.INPCNDPND
     20162**DCL     20171--REDEF   20175--REDEF
KV$PTR.LINLST$
     20158**DCL     20159--REDEF
KV$PTR$
     20150**DCL     20156--IMP-PTR 23979>>ASSIGN  23980<<ASSIGN  24011<<ASSIGN  24060>>ASSIGN  24061<<ASSIGN
     24136<<ASSIGN  24185>>ASSIGN  24186<<ASSIGN  24219<<ASSIGN  24255>>ASSIGN  24256<<ASSIGN  24287<<ASSIGN
     24376>>ASSIGN  24377<<ASSIGN  24396<<ASSIGN  24438>>ASSIGN  24439<<ASSIGN  24469<<ASSIGN  24504>>ASSIGN
     24505<<ASSIGN  24536<<ASSIGN  24601>>ASSIGN  24602<<ASSIGN  24674<<ASSIGN  24755>>ASSIGN  24756<<ASSIGN
     24789<<ASSIGN  24965>>ASSIGN  24966<<ASSIGN  24997<<ASSIGN
KV$STT.REQSTATS.DSPMSK
     20014**DCL     20020--REDEF
KV$STT.REQSTATS.SLCMSK
     20055**DCL     20062--REDEF
KV$STT.USRENTCNT
     20124**DCL     23976<<ASSIGN  23976>>ASSIGN  24057<<ASSIGN  24057>>ASSIGN  24182<<ASSIGN  24182>>ASSIGN
     24252<<ASSIGN  24252>>ASSIGN  24373<<ASSIGN  24373>>ASSIGN  24435<<ASSIGN  24435>>ASSIGN  24501<<ASSIGN
     24501>>ASSIGN  24598<<ASSIGN  24598>>ASSIGN  24752<<ASSIGN  24752>>ASSIGN  24962<<ASSIGN  24962>>ASSIGN
KV$STT.USRENTDFRCNT
     20125**DCL     23984<<ASSIGN  23984>>ASSIGN  24065<<ASSIGN  24065>>ASSIGN  24190<<ASSIGN  24190>>ASSIGN
     24260<<ASSIGN  24260>>ASSIGN  24381<<ASSIGN  24381>>ASSIGN  24443<<ASSIGN  24443>>ASSIGN  24509<<ASSIGN
     24509>>ASSIGN  24606<<ASSIGN  24606>>ASSIGN  24760<<ASSIGN  24760>>ASSIGN  24970<<ASSIGN  24970>>ASSIGN
KV$USRPRM.STT$
     19738**DCL     23976>>ASSIGN  23976>>ASSIGN  23984>>ASSIGN  23984>>ASSIGN  24057>>ASSIGN  24057>>ASSIGN
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:167  
     24065>>ASSIGN  24065>>ASSIGN  24182>>ASSIGN  24182>>ASSIGN  24190>>ASSIGN  24190>>ASSIGN  24252>>ASSIGN
     24252>>ASSIGN  24260>>ASSIGN  24260>>ASSIGN  24373>>ASSIGN  24373>>ASSIGN  24381>>ASSIGN  24381>>ASSIGN
     24435>>ASSIGN  24435>>ASSIGN  24443>>ASSIGN  24443>>ASSIGN  24501>>ASSIGN  24501>>ASSIGN  24509>>ASSIGN
     24509>>ASSIGN  24598>>ASSIGN  24598>>ASSIGN  24606>>ASSIGN  24606>>ASSIGN  24752>>ASSIGN  24752>>ASSIGN
     24760>>ASSIGN  24760>>ASSIGN  24962>>ASSIGN  24962>>ASSIGN  24970>>ASSIGN  24970>>ASSIGN
KV$VDI.ASNINPPTR$
     19010**DCL     23980>>ASSIGN  24061>>ASSIGN  24186>>ASSIGN  24256>>ASSIGN  24377>>ASSIGN  24439>>ASSIGN
     24505>>ASSIGN  24602>>ASSIGN  24756>>ASSIGN  24966>>ASSIGN
KV$VDI.BSY
     19044**DCL     23977>>IF      23978<<ASSIGN  24009<<ASSIGN  24058>>IF      24059<<ASSIGN  24134<<ASSIGN
     24183>>IF      24184<<ASSIGN  24217<<ASSIGN  24253>>IF      24254<<ASSIGN  24285<<ASSIGN  24374>>IF
     24375<<ASSIGN  24394<<ASSIGN  24436>>IF      24437<<ASSIGN  24467<<ASSIGN  24502>>IF      24503<<ASSIGN
     24534<<ASSIGN  24599>>IF      24600<<ASSIGN  24672<<ASSIGN  24753>>IF      24754<<ASSIGN  24787<<ASSIGN
     24963>>IF      24964<<ASSIGN  24995<<ASSIGN
KV$VDI.DFR.USR
     19041**DCL     23983<<ASSIGN  24064<<ASSIGN  24189<<ASSIGN  24259<<ASSIGN  24380<<ASSIGN  24442<<ASSIGN
     24508<<ASSIGN  24605<<ASSIGN  24759<<ASSIGN  24969<<ASSIGN
KV$VDI.PHSDSC
     19044**DCL     24561<<ASSIGN
KV$VDI.RQSOTP
     19045**DCL     24096>>IF      24097<<ASSIGN  24653>>IF      24654<<ASSIGN
KV$VDI.USRPRM$
     19010**DCL     23976>>ASSIGN  23976>>ASSIGN  23984>>ASSIGN  23984>>ASSIGN  24057>>ASSIGN  24057>>ASSIGN
     24065>>ASSIGN  24065>>ASSIGN  24182>>ASSIGN  24182>>ASSIGN  24190>>ASSIGN  24190>>ASSIGN  24252>>ASSIGN
     24252>>ASSIGN  24260>>ASSIGN  24260>>ASSIGN  24373>>ASSIGN  24373>>ASSIGN  24381>>ASSIGN  24381>>ASSIGN
     24435>>ASSIGN  24435>>ASSIGN  24443>>ASSIGN  24443>>ASSIGN  24501>>ASSIGN  24501>>ASSIGN  24509>>ASSIGN
     24509>>ASSIGN  24598>>ASSIGN  24598>>ASSIGN  24606>>ASSIGN  24606>>ASSIGN  24752>>ASSIGN  24752>>ASSIGN
     24760>>ASSIGN  24760>>ASSIGN  24962>>ASSIGN  24962>>ASSIGN  24970>>ASSIGN  24970>>ASSIGN
KV$VDI.USRRQSDAT.RED
     19050**DCL     23956>>IF      24162>>IF      24232>>IF      24415>>IF      24482>>IF      24612>>IF
     24732>>IF      24942>>IF
KV$VDI.VDHEVTENB
     19057**DCL     24102>>IF      24659>>IF
KV@SND_DAT
     18815**DCL     23994<<ASSIGN  23999<>CALL    24196<<ASSIGN  24201<>CALL    24267<<ASSIGN  24272<>CALL
     24449<<ASSIGN  24454<>CALL    24516<<ASSIGN  24521<>CALL    24615<<ASSIGN  24620<>CALL    24766<<ASSIGN
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:168  
     24771<>CALL    24924<<ASSIGN  24979<>CALL
KV@SND_DAT.DAT__.ADR$
     18851**DCL     23996<<ASSIGN  24198<<ASSIGN  24269<<ASSIGN  24451<<ASSIGN  24518<<ASSIGN  24617<<ASSIGN
     24768<<ASSIGN  24976<<ASSIGN
KV@SND_DAT.DAT__.BYTX
     18851**DCL     23997<<ASSIGN  24199<<ASSIGN  24270<<ASSIGN  24452<<ASSIGN  24519<<ASSIGN  24618<<ASSIGN
     24769<<ASSIGN  24977<<ASSIGN
KV@SND_DAT.DAT__.DATBYTSIZ
     18851**DCL     23998<<ASSIGN  24200<<ASSIGN  24271<<ASSIGN  24453<<ASSIGN  24520<<ASSIGN  24619<<ASSIGN
     24770<<ASSIGN  24978<<ASSIGN
KV@USRENT.SVDPTR$
     18780**DCL     23979<<ASSIGN  24011>>ASSIGN  24060<<ASSIGN  24136>>ASSIGN  24185<<ASSIGN  24219>>ASSIGN
     24255<<ASSIGN  24287>>ASSIGN  24376<<ASSIGN  24396>>ASSIGN  24438<<ASSIGN  24469>>ASSIGN  24504<<ASSIGN
     24536>>ASSIGN  24601<<ASSIGN  24674>>ASSIGN  24755<<ASSIGN  24789>>ASSIGN  24965<<ASSIGN  24997>>ASSIGN
KV@VDH_DSC
     18753**DCL     24628<<ASSIGN  24629<>CALL
KVB$GETSYS
     23845**DCL-ENT 24155--CALL    24303--CALL    24317--CALL    24570--CALL    24717--CALL    24929--CALL
KVB$RLS2NSYS
     23847**DCL-ENT 24076--CALL    24636--CALL
KVB$RLSSYS
     23844**DCL-ENT 24204--CALL    24623--CALL    24714--CALL    24774--CALL    24982--CALL
KVV$VDI
     23853**DCL-ENT 23999--CALL    24098--CALL    24106--CALL    24201--CALL    24272--CALL    24387--CALL
     24454--CALL    24521--CALL    24620--CALL    24629--CALL    24655--CALL    24662--CALL    24771--CALL
     24979--CALL
KV_VDH_EVT_RLSVDI
     22508**DCL     24106<>CALL    24662<>CALL
KV_VDH_EVT_RQSOTP
     22543**DCL     24098<>CALL    24655<>CALL
KX$DATA
     21049**DCL     24315--ASSIGN  24326--ASSIGN  24328--ASSIGN  24568--ASSIGN  24573--ASSIGN  24577--ASSIGN
     24715--ASSIGN  24726--ASSIGN  24729--ASSIGN  24915<>CALL
KX$DATA.RLS_STAT
     21051**DCL     21052--REDEF
KX$L2.DFLVCPRF.TRADEL
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:169  
     20336**DCL     20346--REDEF
KX$L2.DSTSNPA.ADR_STRING
     20527**DCL     20527--REDEF
KX$L2.FRMR_NSNR
     20313**DCL     20314--REDEF
KX$L2.NTWADR.ADR_STRING
     20247**DCL     20247--REDEF   24322>>ASSIGN  24723>>ASSIGN
KX$L2.NTWADR.LNG
     20247**DCL     24321>>ASSIGN  24722>>ASSIGN
KX$L2.STATES
     20225**DCL     20225--REDEF
KX$L3.CALL_OPTS.RCVADR.ADR_STRING
     20605**DCL     20605--REDEF   24320>>ASSIGN  24721>>ASSIGN
KX$L3.CALL_OPTS.RCVADR.SIZ
     20605**DCL     24319>>ASSIGN  24720>>ASSIGN
KX$L3.CALL_OPTS.SNDPCKSIZ
     20603**DCL     24703>>ASSIGN
KX$L3.CALL_OPTS.SNDWND
     20604**DCL     24703>>ASSIGN
KX$L3.CM_OPTS.RCVADR.ADR_STRING
     20640**DCL     20640--REDEF
KX$L3.CUG
     20683**DCL     20684--REDEF
KX$L3.DFL_OPTS.RCVADR.ADR_STRING
     20675**DCL     20675--REDEF
KX$L3.FSTSLC
     20680**DCL     24323>>ASSIGN  24724>>ASSIGN
KX$L3.L2$
     20565**DCL     24321>>ASSIGN  24322>>ASSIGN  24722>>ASSIGN  24723>>ASSIGN
KX$L3.LCLADR.ADR_STRING
     20800**DCL     20800--REDEF
KX$L3.LCLNSAP
     20817**DCL     20873--REDEF
KX$L3.LCLNSAP.NSAP.ADDRESS_N
     20868**DCL     20869--REDEF
KX$L3.LCN#
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:170  
     20682**DCL     20683--REDEF
KX$L3.RMTNSAP
     20890**DCL     20946--REDEF
KX$L3.RMTNSAP.NSAP.ADDRESS_N
     20941**DCL     20942--REDEF
KX$L3.RVS
     20681**DCL     24324>>ASSIGN
KX$L3.STATES
     20688**DCL     20688--REDEF
KX$L3.TRNDLY
     20684**DCL     20685--REDEF
KX$L3.TRNDLYIND
     20685**DCL     20686--REDEF
KX$LINKDEV.L4_HEAD$
     20968**DCL     24339<<ASSIGN
KX$LINKDEV.L4_TAIL$
     20968**DCL     24336>>ASSIGN  24337>>IF      24341>>ASSIGN  24342<<ASSIGN
KX$LINKDEV.PNDEVTCNT
     20971**DCL     24399<<ASSIGN  24399>>ASSIGN
KX$LINKDEV.VDI$
     20966**DCL     24358>>ASSIGN
KX$VC
     18916**DCL     23931<>CALL    24303--CALL    24311<>CALL    24314<<ASSIGN  24331--ASSIGN  24558<>CALL
     24863<>CALL    24918<>CALL
KX$VC.BLK_L3
     18925**DCL     24016<<ASSIGN  24872>>IF
KX$VC.BLNK$
     18922**DCL     24336<<ASSIGN
KX$VC.CALCNFPND
     18926**DCL     18927--REDEF   24731<<ASSIGN  24773<<ASSIGN  24981<<ASSIGN
KX$VC.CALMSGBYTSIZ
     18934**DCL     23911>>IF      23916>>ASSIGN  24316<<ASSIGN  24317>>CALL    24711>>IF      24714>>CALL
     24716<<ASSIGN  24717>>CALL    24770>>ASSIGN  24774>>CALL    24776<<ASSIGN  24928<<ASSIGN  24929>>CALL
     24978>>ASSIGN  24982>>CALL    24984<<ASSIGN
KX$VC.CALPKT$
     18934**DCL     23914>>ASSIGN  24317<>CALL    24327>>ASSIGN  24328>>ASSIGN  24714<>CALL    24717<>CALL
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:171  
     24728>>ASSIGN  24729>>ASSIGN  24768>>ASSIGN  24774<>CALL    24775<<ASSIGN  24929<>CALL    24934>>ASSIGN
     24935>>ASSIGN  24941>>ASSIGN  24976>>ASSIGN  24982<>CALL    24983<<ASSIGN
KX$VC.CHN$
     18920**DCL     23929<<ASSIGN  23930>>ASSIGN  24351<<ASSIGN  24352>>ASSIGN  24705>>IF      24915>>CALL
KX$VC.CLRINDPND
     18928**DCL     24579<<ASSIGN  24622<<ASSIGN
KX$VC.CLRMSGBYTSIZ
     18935**DCL     24569<<ASSIGN  24570>>CALL    24619>>ASSIGN  24623>>CALL    24625<<ASSIGN
KX$VC.CLRPKT$
     18935**DCL     24565>>IF      24570<>CALL    24576>>ASSIGN  24577>>ASSIGN  24612>>IF      24617>>ASSIGN
     24623<>CALL    24624<<ASSIGN
KX$VC.CNTL$
     18923**DCL     24354<<ASSIGN
KX$VC.ERRPADCOD
     18932**DCL     24917<<ASSIGN
KX$VC.ERRPADTYP
     18932**DCL     24850<<ASSIGN  24894<<ASSIGN
KX$VC.FLNK$
     18921**DCL     24341<<ASSIGN
KX$VC.INTCNFPND
     18927**DCL     24231<<ASSIGN  24274<<ASSIGN
KX$VC.INTINDPND
     18927**DCL     24150<<ASSIGN  24203<<ASSIGN
KX$VC.INTMSGBYTSIZ
     18936**DCL     24154<<ASSIGN  24200>>ASSIGN  24204>>CALL    24206<<ASSIGN
KX$VC.INTPKT$
     18936**DCL     24155<>CALL    24159>>ASSIGN  24160>>ASSIGN  24198>>ASSIGN  24204<>CALL    24205<<ASSIGN
KX$VC.INV2CLR
     18929**DCL     24548<<ASSIGN  24883<<ASSIGN
KX$VC.L3$
     18921**DCL     23928<<ASSIGN  24353<<ASSIGN  24688<<ASSIGN
KX$VC.MAXOTPBYT
     18924**DCL     24082>>IF      24703<<ASSIGN
KX$VC.OTPBFRBYTCNT
     18924**DCL     24075<<ASSIGN  24075>>ASSIGN  24082>>IF      24640<<ASSIGN
KX$VC.PHSDSC
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:172  
     18929**DCL     24689<<ASSIGN
KX$VC.RLCID
     18937**DCL     18937--REDEF   23931<>CALL
KX$VC.RPRDAT
     18925**DCL     24032<<ASSIGN  24113<<ASSIGN
KX$VC.RPRX3
     18929**DCL     24921>>IF
KX$VC.RSTCNFPND
     18928**DCL     24481<<ASSIGN  24523<<ASSIGN
KX$VC.RSTINDPND
     18928**DCL     24414<<ASSIGN  24456<<ASSIGN
KX$VC.RST_CAUSE
     18933**DCL     24411<<ASSIGN
KX$VC.RST_DIAG
     18933**DCL     24413<<ASSIGN
KX$VC.SND.HED$
     18922**DCL     24029>>IF      24071>>DOWHILE 24072>>ASSIGN  24073<<ASSIGN  24102>>IF      24108>>IF
     24632>>DOWHILE 24633>>ASSIGN  24634<<ASSIGN
KX$VC.SND.NXTLOD$
     18923**DCL     24071>>DOWHILE 24111<<ASSIGN  24117>>ASSIGN  24118<<ASSIGN  24677<<ASSIGN
KX$VC.SND.TAL$
     18923**DCL     24112<<ASSIGN  24678<<ASSIGN
KX$VC.STATE
     18986**DCL     23907>>IF      23921>>IF      24147>>IF      24228>>IF      24350<<ASSIGN  24406>>IF
     24478>>IF      24549>>DOCASE  24555<<ASSIGN  24630<<ASSIGN  24699>>IF      24699>>IF      24702<<ASSIGN
KX$VC.VDHENTERED
     18926**DCL     23959>>IF      24000>>IF      24040>>IF      24125>>IF      24165>>IF      24208>>IF
     24235>>IF      24276>>IF      24418>>IF      24458>>IF      24485>>IF      24525>>IF      24581>>IF
     24663>>IF      24735>>IF      24778>>IF      24945>>IF      24986>>IF
KX$VC.VDI$
     18920**DCL     23877>>ASSIGN  24561>>ASSIGN
KX$VC.X28
     18929**DCL     23943>>IF
KX$VC.X3PND
     18927**DCL     24925>>IF      24936<<ASSIGN
KX$VC.X3PRM
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:173  
     18931**DCL     23952>>IF      24727>>ASSIGN  24856<<ASSIGN  24941>>ASSIGN
KX$VC.X3_PRM_ALL
     18930**DCL     24842<<ASSIGN
KX$VC.X3_PRM_BIT
     18931**DCL     24853<<ASSIGN
KX$VC.X3_PRM_BITS
     18930**DCL     18931--REDEF   24817<<ASSIGN
KX$VC_OTPBFR
     18889**DCL     24120--ASSIGN
KX$VC_OTPBFR.BFRBYTSIZ
     18893**DCL     24074>>ASSIGN  24121>>ASSIGN  24635>>ASSIGN
KX$VC_OTPBFR.LNK$
     18893**DCL     24073>>ASSIGN  24118>>ASSIGN  24634>>ASSIGN
KX$VC_OTPBFR.M
     18893**DCL     24123>>ASSIGN
KX$VC_OTPBFR.Q
     18893**DCL     24122>>ASSIGN
KX$VC_OTPBFR.RLSWRDSIZ
     18894**DCL     24076<>CALL    24636<>CALL
KXP$PACKET
     23852**DCL-ENT 23918--CALL    24308--CALL    24876--CALL
KXS$SYSLOG
     23858**DCL-ENT 24915--CALL
KXV$VCVDH
        13**PROC    21293--DCLINIT
KXX$INTCNC
     23851**DCL-ENT 23931--CALL
KXX$RLSCTX
     23850**DCL-ENT 24311--CALL    24558--CALL
KXX$SNDX29MSG
     23861**DCL-ENT 24863--CALL    24918--CALL
KXX_VDH_DSC
     22472**DCL     24628>>ASSIGN
KX_BUF.SIZ
     21378**DCL     24703>>ASSIGN
KX_KEY_CAL_CNF
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:174  
     23343**DCL     24767--ASSIGN  24940--ASSIGN
KX_KEY_CLR_IND
     23655**DCL     24616--ASSIGN
KX_KEY_DAT_IND
     23395**DCL     23995--ASSIGN
KX_KEY_INDX3
     23707**DCL     24937--ASSIGN
KX_KEY_INT_CNF
     23499**DCL     24268--ASSIGN
KX_KEY_INT_IND
     23447**DCL     24197--ASSIGN
KX_KEY_RST_CNF
     23603**DCL     24517--ASSIGN
KX_KEY_RST_IND
     23551**DCL     24450--ASSIGN
KX_SND_DAT
     23757**DCL     23994>>ASSIGN  24196>>ASSIGN  24267>>ASSIGN  24449>>ASSIGN  24516>>ASSIGN  24615>>ASSIGN
     24766>>ASSIGN  24924>>ASSIGN
KX_STATS_HDLC.REQSTATS.DSPMSK
     21649**DCL     21655--REDEF
KX_STATS_HDLC.REQSTATS.SLCMSK
     21690**DCL     21697--REDEF
KX_STATS_X25.REQSTATS.DSPMSK
     21974**DCL     21980--REDEF
KX_STATS_X25.REQSTATS.SLCMSK
     22015**DCL     22022--REDEF
KX_STATS_X29.CIRCUITS
     22442**DCL     24334<<ASSIGN  24334>>ASSIGN
KX_STATS_X29.KHSTT.CTXBYTUTL
     22438**DCL     24331<<ASSIGN  24331>>ASSIGN
KX_STATS_X29.KHSTT.OTPBFRBYTUTL
     22437**DCL     24077<<ASSIGN  24077>>ASSIGN  24637<<ASSIGN  24637>>ASSIGN
KX_STATS_X29.LINSPDDST
     22440**DCL     24333<<ASSIGN  24333>>ASSIGN
KX_STATS_X29.REQSTATS.DSPMSK
     22365**DCL     22371--REDEF
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:175  
KX_STATS_X29.REQSTATS.SLCMSK
     22406**DCL     22413--REDEF
KX_VC
     21289**DCL     24314>>ASSIGN
KX_VC.CALCNFPND
     21299**DCL     21300--REDEF
KX_VC.RLCID
     21310**DCL     21310--REDEF
KX_VC.X3_PRM_BITS
     21303**DCL     21304--REDEF
KX_VDH_EVT_ATN
     22578**DCL     24387<>CALL
KX_VDH_EVT_ATN.PRM
     22584**DCL     24386<<ASSIGN
KX_VDOVLPARY
     23819**DCL     23801--DCLINIT
KX_VDOVLPARY.VDOVLP
     23831**DCL     23834--REDEF
KX_VDOVLPARY.VDOVLP.KEY$
     23833**DCL     23995<<ASSIGN  24197<<ASSIGN  24268<<ASSIGN  24450<<ASSIGN  24517<<ASSIGN  24616<<ASSIGN
     24767<<ASSIGN  24937<<ASSIGN  24940<<ASSIGN
KX_X3_OK2SET IN PROCEDURE Y$DECODE_X29
     24812**DCL     24854>>IF
L3$
     18718**DCL     20565--IMP-PTR 23872<<ASSIGN  23896>>ASSIGN  24319>>ASSIGN  24320>>ASSIGN  24321>>ASSIGN
     24322>>ASSIGN  24323>>ASSIGN  24324>>ASSIGN  24703>>ASSIGN  24703>>ASSIGN  24720>>ASSIGN  24721>>ASSIGN
     24722>>ASSIGN  24723>>ASSIGN  24724>>ASSIGN
L_CLRVC
     24305**LABEL   24317--CALLALT
L_ILG_EVT
     23926**LABEL   23931--CALLALT
L_RET
     24014**LABEL   24164--GOTO    24191--GOTO    24234--GOTO    24261--GOTO    24417--GOTO    24444--GOTO
     24484--GOTO    24510--GOTO    24607--GOTO    24734--GOTO    24761--GOTO
L_RETURN IN PROCEDURE Y$DECODE_X29
     25002**LABEL   24944--GOTO    24971--GOTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:176  
NO_MEM
     24157**LABEL   24570--CALLALT 24717--CALLALT
PRM_INDEX
     18723**DCL     24844<<ASSIGN  24845>>IF      24853>>ASSIGN  24854>>IF      24856>>ASSIGN
SCREECH_KXP
     24801**LABEL   23918--CALLALT 24308--CALLALT
VC$
     18719**DCL     18916--IMP-PTR 23873<<ASSIGN  23874>>IF      23877>>ASSIGN  23887>>IF      23897>>ASSIGN
     23907>>IF      23911>>IF      23914>>ASSIGN  23916>>ASSIGN  23921>>IF      23928>>ASSIGN  23929>>ASSIGN
     23930>>ASSIGN  23931>>CALL    23931>>CALL    23943>>IF      23952>>IF      23959>>IF      24000>>IF
     24016>>ASSIGN  24029>>IF      24032>>ASSIGN  24040>>IF      24071>>DOWHILE 24071>>DOWHILE 24072>>ASSIGN
     24073>>ASSIGN  24075>>ASSIGN  24075>>ASSIGN  24082>>IF      24082>>IF      24102>>IF      24108>>IF
     24111>>ASSIGN  24112>>ASSIGN  24113>>ASSIGN  24117>>ASSIGN  24118>>ASSIGN  24125>>IF      24147>>IF
     24150>>ASSIGN  24154>>ASSIGN  24155>>CALL    24159>>ASSIGN  24160>>ASSIGN  24165>>IF      24198>>ASSIGN
     24200>>ASSIGN  24203>>ASSIGN  24204>>CALL    24204>>CALL    24205>>ASSIGN  24206>>ASSIGN  24208>>IF
     24228>>IF      24231>>ASSIGN  24235>>IF      24274>>ASSIGN  24276>>IF      24297>>IF      24303<>CALL
     24309>>IF      24311>>CALL    24314>>ASSIGN  24316>>ASSIGN  24317>>CALL    24317>>CALL    24327>>ASSIGN
     24328>>ASSIGN  24336>>ASSIGN  24339>>ASSIGN  24341>>ASSIGN  24342>>ASSIGN  24347>>ASSIGN  24350>>ASSIGN
     24351>>ASSIGN  24352>>ASSIGN  24353>>ASSIGN  24354>>ASSIGN  24406>>IF      24411>>ASSIGN  24413>>ASSIGN
     24414>>ASSIGN  24418>>IF      24456>>ASSIGN  24458>>IF      24478>>IF      24481>>ASSIGN  24485>>IF
     24523>>ASSIGN  24525>>IF      24548>>ASSIGN  24549>>DOCASE  24555>>ASSIGN  24558>>CALL    24561>>ASSIGN
     24565>>IF      24569>>ASSIGN  24570>>CALL    24570>>CALL    24576>>ASSIGN  24577>>ASSIGN  24579>>ASSIGN
     24581>>IF      24612>>IF      24617>>ASSIGN  24619>>ASSIGN  24622>>ASSIGN  24623>>CALL    24623>>CALL
     24624>>ASSIGN  24625>>ASSIGN  24630>>ASSIGN  24632>>DOWHILE 24633>>ASSIGN  24634>>ASSIGN  24640>>ASSIGN
     24663>>IF      24677>>ASSIGN  24678>>ASSIGN  24688>>ASSIGN  24689>>ASSIGN  24699>>IF      24699>>IF
     24702>>ASSIGN  24703>>ASSIGN  24705>>IF      24711>>IF      24714>>CALL    24714>>CALL    24716>>ASSIGN
     24717>>CALL    24717>>CALL    24727>>ASSIGN  24728>>ASSIGN  24729>>ASSIGN  24731>>ASSIGN  24735>>IF
     24768>>ASSIGN  24770>>ASSIGN  24773>>ASSIGN  24774>>CALL    24774>>CALL    24775>>ASSIGN  24776>>ASSIGN
     24778>>IF      24817>>ASSIGN  24842>>ASSIGN  24850>>ASSIGN  24853>>ASSIGN  24856>>ASSIGN  24863>>CALL
     24872>>IF      24883>>ASSIGN  24894>>ASSIGN  24915>>CALL    24917>>ASSIGN  24918>>CALL    24921>>IF
     24925>>IF      24928>>ASSIGN  24929>>CALL    24929>>CALL    24934>>ASSIGN  24935>>ASSIGN  24936>>ASSIGN
     24941>>ASSIGN  24941>>ASSIGN  24945>>IF      24976>>ASSIGN  24978>>ASSIGN  24981>>ASSIGN  24982>>CALL
     24982>>CALL    24983>>ASSIGN  24984>>ASSIGN  24986>>IF
VC$CAL
     21123**DCL     24327<<ASSIGN  24728<<ASSIGN  24934<<ASSIGN
VC$CAL.CLDADR
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:177  
     21129**DCL     21133--REDEF   21133--REDEF
VC$CAL.CLGADR
     21124**DCL     21128--REDEF   21129--REDEF
VC$CAL.FUNCTION
     21123**DCL     24935<<ASSIGN
VC$CAL.X3
     21147**DCL     24941<<ASSIGN
VC$CAL.X3S
     21137**DCL     21147--REDEF
VC$CLR
     21232**DCL     24576<<ASSIGN
VC$CLR.CLDADR
     21234**DCL     21238--REDEF   21238--REDEF
VC$INT
     21190**DCL     24159<<ASSIGN
VC_CAL
     23135**DCL     24316--ASSIGN  24327>>ASSIGN  24328--ASSIGN  24716--ASSIGN  24728>>ASSIGN  24729--ASSIGN
     24928--ASSIGN
VC_CAL.CLDADR
     23141**DCL     23145--REDEF   23145--REDEF
VC_CAL.CLDADRLNG
     23136**DCL     24321<<ASSIGN  24720<<ASSIGN
VC_CAL.CLDADRSTRING
     23145**DCL     24322<<ASSIGN  24721<<ASSIGN
VC_CAL.CLGADR
     23136**DCL     23140--REDEF   23141--REDEF
VC_CAL.CLGADRLNG
     23135**DCL     24319<<ASSIGN  24722<<ASSIGN
VC_CAL.CLGADRSTRING
     23141**DCL     24320<<ASSIGN  24723<<ASSIGN
VC_CAL.FSTSLC
     23147**DCL     24323<<ASSIGN  24724<<ASSIGN
VC_CAL.FUNCTION
     23135**DCL     24318<<ASSIGN  24719<<ASSIGN
VC_CAL.RVS
     23148**DCL     24324<<ASSIGN
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:178  
VC_CAL.USRDATBYTX
     23160**DCL     24326<<ASSIGN  24726<<ASSIGN
VC_CAL.USRDATLNG
     23160**DCL     24325<<ASSIGN  24725<<ASSIGN
VC_CAL.X3
     23159**DCL     24727<<ASSIGN
VC_CAL.X3S
     23149**DCL     23159--REDEF
VC_CLR
     23244**DCL     24569--ASSIGN  24576>>ASSIGN  24577--ASSIGN
VC_CLR.CAUSE
     23244**DCL     24574<<ASSIGN
VC_CLR.CLDADR
     23246**DCL     23250--REDEF   23250--REDEF
VC_CLR.DIAG
     23245**DCL     24575<<ASSIGN
VC_CLR.FUNCTION
     23244**DCL     24571<<ASSIGN
VC_CLR.USRDATBYTX
     23253**DCL     24573<<ASSIGN
VC_CLR.USRDATLNG
     23252**DCL     24572<<ASSIGN
VC_DAT
     23181**DCL     23992--ASSIGN  23992--ASSIGN  23992--ASSIGN  23992--ASSIGN  23997--ASSIGN  23998--ASSIGN
VC_DAT.M
     23182**DCL     23991<<ASSIGN
VC_DAT.Q
     23181**DCL     23990<<ASSIGN
VC_INT
     23202**DCL     24153--ASSIGN  24159>>ASSIGN  24160--ASSIGN  24269--ASSIGN  24271--ASSIGN
VC_INT.FUNCTION
     23202**DCL     24151<<ASSIGN  24266<<ASSIGN
VC_INT.INTDATLNG
     23202**DCL     24152<<ASSIGN
VC_RST
     23223**DCL     24451--ASSIGN  24453--ASSIGN  24518--ASSIGN  24520--ASSIGN
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:179  
VC_RST.CAUSE
     23223**DCL     24410<<ASSIGN
VC_RST.DIAG
     23224**DCL     24412<<ASSIGN
VC_RST.FUNCTION
     23223**DCL     24409<<ASSIGN  24515<<ASSIGN
VDI$
     18720**DCL     19009--IMP-PTR 23877<<ASSIGN  23881<<ASSIGN  23956>>IF      23956>>IF      23976>>ASSIGN
     23976>>ASSIGN  23977>>IF      23978>>ASSIGN  23980>>ASSIGN  23983>>ASSIGN  23984>>ASSIGN  23984>>ASSIGN
     24009>>ASSIGN  24037>>IF      24057>>ASSIGN  24057>>ASSIGN  24058>>IF      24059>>ASSIGN  24061>>ASSIGN
     24064>>ASSIGN  24065>>ASSIGN  24065>>ASSIGN  24096>>IF      24097>>ASSIGN  24102>>IF      24125>>IF
     24134>>ASSIGN  24162>>IF      24182>>ASSIGN  24182>>ASSIGN  24183>>IF      24184>>ASSIGN  24186>>ASSIGN
     24189>>ASSIGN  24190>>ASSIGN  24190>>ASSIGN  24217>>ASSIGN  24232>>IF      24252>>ASSIGN  24252>>ASSIGN
     24253>>IF      24254>>ASSIGN  24256>>ASSIGN  24259>>ASSIGN  24260>>ASSIGN  24260>>ASSIGN  24285>>ASSIGN
     24358<<ASSIGN  24373>>ASSIGN  24373>>ASSIGN  24374>>IF      24375>>ASSIGN  24377>>ASSIGN  24380>>ASSIGN
     24381>>ASSIGN  24381>>ASSIGN  24394>>ASSIGN  24415>>IF      24435>>ASSIGN  24435>>ASSIGN  24436>>IF
     24437>>ASSIGN  24439>>ASSIGN  24442>>ASSIGN  24443>>ASSIGN  24443>>ASSIGN  24467>>ASSIGN  24482>>IF
     24501>>ASSIGN  24501>>ASSIGN  24502>>IF      24503>>ASSIGN  24505>>ASSIGN  24508>>ASSIGN  24509>>ASSIGN
     24509>>ASSIGN  24534>>ASSIGN  24598>>ASSIGN  24598>>ASSIGN  24599>>IF      24600>>ASSIGN  24602>>ASSIGN
     24605>>ASSIGN  24606>>ASSIGN  24606>>ASSIGN  24612>>IF      24653>>IF      24654>>ASSIGN  24659>>IF
     24672>>ASSIGN  24732>>IF      24752>>ASSIGN  24752>>ASSIGN  24753>>IF      24754>>ASSIGN  24756>>ASSIGN
     24759>>ASSIGN  24760>>ASSIGN  24760>>ASSIGN  24787>>ASSIGN  24942>>IF      24962>>ASSIGN  24962>>ASSIGN
     24963>>IF      24964>>ASSIGN  24966>>ASSIGN  24969>>ASSIGN  24970>>ASSIGN  24970>>ASSIGN  24995>>ASSIGN
X29MSGTYP IN PROCEDURE Y$DECODE_X29
     24815**DCL     24819<<ASSIGN  24820>>IF      24820>>IF      24827>>DOCASE  24860>>IF      24860>>IF
     24917>>ASSIGN
X3_SET IN PROCEDURE Y$DECODE_X29
     24814**DCL     24823<<ASSIGN  24825<<ASSIGN  24845>>IF      24854>>IF      24921>>IF
Y$DECODE_X29
     24811**PROC    23949--CALL
Y@BYTSIZ
     18721**DCL     24074<<ASSIGN  24075>>ASSIGN  24077>>ASSIGN  24153<<ASSIGN  24154>>ASSIGN  24155>>CALL
     24315<<ASSIGN  24316>>ASSIGN  24328>>ASSIGN  24328>>ASSIGN  24568<<ASSIGN  24569>>ASSIGN  24577>>ASSIGN
     24577>>ASSIGN  24635<<ASSIGN  24637>>ASSIGN  24715<<ASSIGN  24716>>ASSIGN  24729>>ASSIGN  24729>>ASSIGN
Y@DFR1
     24032**LABEL   24066--GOTO
PL6.E3A0      #001=KXV$VCVDH File=KXV$VCVDH.:E05TSI                              WED 07/30/97 02:31 Page:180  
Y@DFR4
     24399**LABEL   24382--GOTO
Y_BADRMTDCL
     22775**DCL     24300<>CALL
Y_BADSTT
     22958**DCL     24701<>CALL
Y_ILG_EVT
     23080**DCL     23926<>CALL
Y_NO_MEM
     23019**DCL     24157<>CALL    24932<>CALL
Y_NO_VCCTX
     22714**DCL     23893<>CALL
Y_UNKEVT
     22836**DCL     24796<>CALL
