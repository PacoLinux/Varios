VERSION B06

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1    
        1        1        /*M* VMO$MAIL Mail handling main program  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
        8        8        /*P* NAME: VMO$MAIL
        9        9             DESCRIPTION: This module performs the message viewing functions
       10       10                       for the mail system. It gives the user the ablity to
       11       11                        display and maintain the mail files in his accounts.
       12       12             WARNING:  To save time, VMA$OPEN_SRCH_LIST is called only when
       13       13                  address expansion may be pending.  As of 4/83, only USE
       14       14                  and LIST can cause expansion in MAIL.  If new features
       15       15                  are added that may cause expansion, call VMA$OPEN_SRCH_LIST
       16       16                  if VM_SEARCH_INFO.ACTIVE is reset.  You have been warned.  HEP
       17       17
       18       18                  ENQ/DEQ discussion:  On 5/8/83 the comgroup method of
       19       19                  concurrency control was replaced by ENQ/DEQ.  Three things
       20       20                  are enqueued, the PROFILE record, the HEADER record, and
       21       21                  the FILE name.  The discussions below concern MAIL and
       22       22                  MAILMAN.  Send does not need to use this facility.
       23       23
       24       24                  PROFILE - Everyone enqueues this SHARE=NONE.  MAILMAN
       25       25                  uses WAIT_TIME of 2 seconds.  This allows time for a
       26       26                  comgroup nowait read event to get in, and mailman can
       27       27                  give a file name to send.  MAIL waits till he gets the
       28       28                  resource.  MAILMAN only holds it for a very short time,
       29       29                  and another MAIL won't hold it unless he's got exclusive
       30       30                  use of the folder, in which case there is no problem as only
       31       31                  one mail will be using it exclusive at a time.  MAILMAN will
       32       32                  be help up by long operations such as COPY, MOVE and RENUMBER,
       33       33                  but only the delivery of mail will be delayed, not the entry
       34       34                  and exit of every user of MAIL as is currently the case.
       35       35                  The delay will only occur if mailman is attempting to deliver
       36       36                  a message to a user doing one of the above long operations.
       37       37
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:2    
       38       38                  HEADER - MAILMAN enqueues a header SHARE=NONE, MAIL enqueues
       39       39                  it SHARE=ALL.  This is used to keep MAIL from reading
       40       40                  a message while MAILMAN is entering it in the folder.  MAIL
       41       41                  does the enque WAIT_TIME=0, if it altrets a special message
       42       42                  is returned to the user, "Message being delivered".
       43       43                  This method was used instead of a busy bit in the message
       44       44                  header to avoid problems if the system crashes while the
       45       45                  message was being built.
       46       46
       47       47                  FILE - MAILMAN does not use this facility.  MAIL uses it to
       48       48                  avoid multiple updater problems with other MAIL users.  The
       49       49                  file open SHARE option can not be used, since MAIL and MAILMAN
       50       50                  must be able to update the file at the same time all users
       51       51                  must open the file SHARE=ALL.  If a user has update access to
       52       52                  the file, the FILE resource is enqueued SHARE=NONE.  If the
       53       53                  file is read only, SHARE=ALL is used.  This will allow
       54       54                  multiple users on information or bulletin board folders, and
       55       55                  only on user at a time in personal folders residing in multi-user
       56       56                  accounts.
       57       57
       58       58                  Before MAIL writes the profile record into the folder, the
       59       59                  record is first read and the number of messages information
       60       60                  is merged into MAIL's copy of the profile.  Since MAILMAN
       61       61                  changes only this information and dosen't dequeue until the
       62       62                  record is re-written, the most current information is always
       63       63                  maintained in the folder.
       64       64                                                                            */
       65       65        VMO$MAIL: PROC MAIN;
       66       66
       67       67        /***** Include files *****/
       68       68        %INCLUDE B_ERRORS_C;
       69     1195        %INCLUDE B_SEGIDS_C;
       70     1734        %INCLUDE B$JIT;
       71     2337        %INCLUDE CP_6;
       72     7896        %INCLUDE CP_6_SUBS;
       73     8436        %INCLUDE VM_MACRO_C;
       74     9704        %INCLUDE VM_SUBS_C;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:3    
       75     9964        %INCLUDE VM_PERR_C;
       76    10259        %INCLUDE VO_SUBS_C;
       77    10310        %INCLUDE XU_MACRO_C;
       78    13416        %INCLUDE XU_FORMAT_C;
       79    13578        %INCLUDE XUE_MACRO_C;
       80    14322        %INCLUDE XU_PERR_C;
       81    14513        %INCLUDE XUH_MACRO_C;
       82    14597        %INCLUDE XUM_MACRO_C;
       83    14624        %INCLUDE XUR_ENTRY;
       84    14656        %INCLUDE XUW_MACRO_C;
       85    14791        %INCLUDE VM_DATA_R;
       86    15222            %include B$TABLES_C;
       87    15330        %B$XL_UPPER(NAME=LOWER_UPPER);
       88    15334
       89    15335        %F$DCB;
       90    15392        %B$TCB (STCLASS="BASED(B$TCB$)");
       91    15395        %B$ALT;
       92    15403        %PARSE$OUT (NAME=P$B,STCLASS="BASED(BLK$)");
       93    15448        %PARSE$SYM (NAME=P$S,STCLASS="BASED(BLK$)");
       94    15486        %P_PCB (STCLASS=STATIC);
       95    15685
       96    15686        %XUG_GETCMD (NAME=XUG$GETCMD,STCLASS="BASED(XUG_GETCMD$)");
       97    16024    1   DCL XUG_GETCMD$ PTR;
       98    16025
       99    16026        %XUE_ENTRIES;
      100    16050        %XUR_INIT(ABORT=VMO$ABORT,MOREMEM=VMA$MOREMEM,PCB=P_PCB,PREPROCESS=YES,
      101    16051            COMMANDS=YES,INHIBIT_OUTPUT=YES);
      102    16150        /***** Partrge root nodes *****/
      103    16151    1   DCL MAIL_NODES PTR SYMREF;              /* Mail commands */
      104    16152    1   DCL SEND_CMD PTR SYMREF;                /* Mail address */
      105    16153    1   DCL MAIL_CMD PTR SYMREF;                /* Syntax for invoking mail from ibex */
      106    16154    1   DCL MODIFY_LIST PTR SYMREF;             /* Syntax for modify list subcommands */
      107    16155    1   DCL MODIFY_USER PTR SYMREF;             /* Syntax for modify user subcommands */
      108    16156        /*
      109    16157              Addresses of the nodes for the parser.  Ordinarily these will
      110    16158              have the values of the SYMDEFs above.  But with some imaginative
      111    16159              patching, these pointers can obtain values for user modified,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:4    
      112    16160              (foriegn language) nodes.   */
      113    16161    1   DCL   MAIL_NODES$    PTR;
      114    16162    1   DCL   SEND_CMD$      PTR;
      115    16163    1   DCL   MAIL_CMD$      PTR;
      116    16164    1   DCL   MODIFY_LIST$   PTR;
      117    16165    1   DCL   MODIFY_USER$   PTR;
      118    16166    1   DCL   VM_ADDRESS_SPEC$ PTR   STATIC   SYMDEF;/* VME$SUBR needs it */
      119    16167    1   DCL   ADDRESS_SPEC   PTR   SYMREF;
      120    16168
      121    16169    1   DCL   BSD            SBIN  BASED;
      122    16170        /*
      123    16171              The following DCL's are for allowing multiple parse nodes
      124    16172              in different languages.
      125    16173        */
      126    16174        %PARSE_NODES (NAME=VM_DEFAULT_NODES,
      127    16175                    STCLASS="CONSTANT SYMDEF",
      128    16176                    N0=MAIL_NODES,
      129    16177                    N1=MAIL_CMD,
      130    16178                    N2=MODIFY_LIST,
      131    16179                    N3=MODIFY_USER,
      132    16180                    N15=SEND_CMD,
      133    16181                    N26=ADDRESS_SPEC);
      134    16216        %NATL_PAIRS (NAME=VM_NATL_PAIRS,
      135    16217                    STCLASS="CONSTANT SYMDEF",
      136    16218                    NATL_CHARS="' '*0",
      137    16219                    NODES$="ADDR(VM_DEFAULT_NODES), ADDR(NIL)*0");
      138    16237        %PARSE_NODES(NAME=NODES_TO_USE,
      139    16238                    STCLASS="BASED(NODES$)");
      140    16273    1   DCL   NODES$      PTR;
      141    16274
      142    16275    1   dcl 1  VM_NODENAMES   constant symdef
      143    16276
      144    16277                    %BUILD_NODENAMES( N=0, NAME=MAIL_NODES);
      145    16289                    %BUILD_NODENAMES( N=1, NAME=MAIL_CMD);
      146    16301                    %BUILD_NODENAMES( N=2, NAME=MODIFY_LIST);
      147    16313                    %BUILD_NODENAMES( N=3, NAME=MODIFY_USER);
      148    16325                    %BUILD_NODENAMES( N=15, NAME=SEND_CMD);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:5    
      149    16337                    %BUILD_NODENAMES( N=26, NAME=ADDRESS_SPEC);
      150    16349
      151    16350                    %BUILD_NODENAMES( DONE=YES );
      152    16362
      153    16363        %VLP_NAME( FPTN=VM_NODEFID, NAME='VM_NODES', STCLASS="CONSTANT SYMDEF");
      154    16390        /***** External routines *****/
      155    16391    1   DCL VMA$ADD_RENTRY_SORTED ENTRY(6) ALTRET;
      156    16392    1   DCL VMA$ADD_UENTRY_SORTED ENTRY(6) ALTRET;
      157    16393    1   DCL VMA$COMPRESS_BLANKS ENTRY(1);
      158    16394    1   DCL VMA$DEL_LIST ENTRY(3) ALTRET;
      159    16395    1   DCL VMA$DEL_RENTRY ENTRY(6) ALTRET;
      160    16396    1   DCL VMA$DEL_UENTRY ENTRY(6) ALTRET;
      161    16397    1   DCL VMA$ENLARGE_SEGMENT ENTRY(2) ALTRET;
      162    16398    1   DCL VMA$GET_SITE_NAME ENTRY(4) ALTRET;
      163    16399    1   DCL VMA$GET_NEXT_ENTRY ENTRY(4) ALTRET;
      164    16400    1   DCL VMA$GET_LIST ENTRY(3) ALTRET;
      165    16401
      166    16402    1   DCL VMA$GET_LIST_NEXT ENTRY(3) ALTRET;
      167    16403    1   DCL VMA$MOREMEM ENTRY(3) ALTRET;
      168    16404    1   DCL VMA$OPEN_FOLDER ENTRY(5) ALTRET;
      169    16405    1   DCL VMA$OPEN_GLOBAL ENTRY(1) ALTRET;
      170    16406    1   DCL VMA$PUT_LIST ENTRY(3) ALTRET;
      171    16407    1   DCL VMB$FIND_DEFAULT ENTRY(7) ALTRET;
      172    16408    1   DCL VMB$USE_SPECIFIED ENTRY(7) ALTRET;
      173    16409    1   DCL VMB$USE_DEFAULT ENTRY(7) ALTRET;
      174    16410    1   DCL VMD$DI_FOLDER ENTRY(2);
      175    16411    1   DCL VMB$USE_SAME ENTRY(7) ALTRET;
      176    16412    1   dcl VMB$TESTREG entry(1) altret;
      177    16413    1   DCL VMA$OPEN_SRCH_LIST ENTRY(1) ALTRET;
      178    16414    1   DCL VMA$SHRINK_SEGMENT ENTRY(2) ALTRET;
      179    16415    1   DCL VMA$OPEN_ENCL_SEGS ENTRY ALTRET;
      180    16416    1   DCL VMA$PUT_ADD_RECORD ENTRY(4) ALTRET;
      181    16417    1   DCL VMD$DI_HEADER ENTRY(3);
      182    16418    1   DCL VMD$DI_LIST ENTRY(4);
      183    16419    1   DCL VMD$DI_MESSAGE ENTRY(6) ALTRET;
      184    16420    1   DCL VMD$DI_PROFILE ENTRY(1);
      185    16421    1   DCL VMD$DI_USER ENTRY(2);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:6    
      186    16422    1   DCL VMD$DEL_HEADER ENTRY(2) ALTRET;
      187    16423    1   DCL VMD$EJECT ENTRY(1) ALTRET;
      188    16424        %INIT_STR(DODCL=YES);
      189    16447    1   DCL  VMD$GETNODES            ENTRY(4);
      190    16448    1   DCL VMD$GET_HEADER ENTRY(2) ALTRET;
      191    16449    1   DCL VMD$GET_HEADER_NEXT ENTRY(2) ALTRET;
      192    16450    1   DCL VMD$GET_HEADER_PREV ENTRY(2) ALTRET;
      193    16451    1   DCL VMD$PUT_HEADER ENTRY(2) ALTRET;
      194    16452    1   DCL VMD$GET_PROFILE ENTRY(1) ALTRET;
      195    16453    1   DCL VMD$PUT_PROFILE ENTRY(1) ALTRET;
      196    16454    1   DCL VMD$GET_ENCL ENTRY (9) ALTRET;
      197    16455    1   DCL VMD$PUT_ENCL ENTRY (9) ALTRET;
      198    16456    1   DCL VMD$DEL_ENCL ENTRY (9) ALTRET;
      199    16457    1   DCL VMD$PUT_ID ENTRY (3) ALTRET;
      200    16458    1   DCL VMD$WRITE_BUF ENTRY(1);             /* Takes place of X$FORMAT */
      201    16459    1   DCL VME$ACKNOWLEDGE ENTRY(3) ALTRET;
      202    16460    1   DCL VME$ANSWER ENTRY(3) ALTRET;
      203    16461    1   DCL VMF$FROM ENTRY(1) ALTRET;
      204    16462    1   DCL VMF$MAKE_ADDRESS1 ENTRY(2);
      205    16463    1   dcl VMF$MAKE_ADDRESS1PASS entry(2);   /** Adds password if present **/
      206    16464    1   DCL VMM$COPY_MESSAGE ENTRY(6) ALTRET;
      207    16465    1   DCL VMM$DELETE_MESSAGE ENTRY(2) ALTRET;
      208    16466    1   DCL VMM$COMBINE_MESSAGE ENTRY (3) ALTRET;
      209    16467    1   DCL VMM$EDIT_MESSAGE_OUT ENTRY (5) ALTRET;
      210    16468    1   DCL VMO$XCON ENTRY ASYNC;
      211    16469    1   DCL VMO$ABORT ENTRY;
      212    16470    1   DCL VMS$FMT_SELECT ENTRY(2);
      213    16471    1   DCL VMS$SELECT ENTRY(3) ALTRET;
      214    16472    1   DCL VMS$MOVE_SELECT ENTRY(3) ALTRET;
      215    16473    1   DCL VMA$GET_ADD_RECORD ENTRY(4) ALTRET;
      216    16474    1   DCL X$WILDCMP ENTRY(1) ALTRET;
      217    16475    1   DCL VMX$OCTBIN ENTRY(2);
      218    16476    1   DCL X$ALLOCATE ENTRY(1) ALTRET;
      219    16477    1   DCL X$DEALLOCATE ENTRY(1) ALTRET;
      220    16478    1   DCL X$HELP ENTRY(1) ALTRET;
      221    16479        /***** Symdef data *****/
      222    16480    1   DCL VMO_REMEMBER REMEMBER STATIC SYMDEF;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:7    
      223    16481    1   DCL CURRENT_MESSAGE_NUMBER SBIN WORD STATIC SYMDEF INIT(0);
      224    16482    1   DCL NEED_TITLE_BAR BIT (1) SYMREF;
      225    16483        /***** Character data *****/
      226    16484
      227    16485    1   DCL KEY_VALUE CHAR(8) CALIGNED;
      228    16486    1   DCL WILDCARD_PATTERN CHAR(%SIZ_FOLDER);
      229    16487    1   DCL CURRENT_LINE CHAR (P_PCB.NCHARS) CALIGNED BASED (P_PCB.TEXT$);
      230    16488        %VLP_NAME (FPTN=LINK_CCBUF,LEN=256,STCLASS=STATIC);
      231    16515
      232    16516        %VLP_NAME (FPTN=WORK_STRING,LEN=511,STCLASS=STATIC);
      233    16543    1   DCL B_VERSION CHAR(1) SYMREF;           /* Mail version */
      234    16544    1   DCL 1 B$VERSION BASED,
      235    16545    1         2 L# UBIN BYTE CALIGNED,
      236    16546    1         2 NAME# CHAR(B$VERSION.L#) CALIGNED;
      237    16547        /***** Ptrs *****/
      238    16548    1   DCL OUT$ PTR;
      239    16549        %VLP_ERRCODE (FPTN=OUTERR,STCLASS="REDEF OUT$");
      240    16594    1   DCL BLK$ PTR AUTO;
      241    16595    1   DCL PTR1$ PTR AUTO;
      242    16596    1   DCL PTR2$ PTR AUTO;
      243    16597    1   DCL PTR3$ PTR AUTO;
      244    16598    1   DCL PTR4$ PTR AUTO;
      245    16599        %POINTER (NAME=PTR4R$,STCLASS="REDEF PTR4$");
      246    16604    1   DCL PTR5$ PTR AUTO;
      247    16605    1   DCL ENCL$ PTR;
      248    16606    1   DCL PAGESIZE SBIN WORD STATIC INIT(4096);
      249    16607        /***** Index counters *****/
      250    16608    1   DCL INDX1 SBIN WORD AUTO;
      251    16609    1   DCL INDX2 SBIN WORD STATIC SYMDEF;
      252    16610    1   DCL INDX3 SBIN WORD AUTO;
      253    16611    1   DCL INDX4 SBIN WORD AUTO;
      254    16612        /***** Other variables *****/
      255    16613    1   DCL WORK_UTS UBIN WORD STATIC;
      256    16614    1   DCL NEW_FLAG BIT(1) STATIC INIT('0'B);
      257    16615    1   DCL BREAK_TYPE UBIN WORD STATIC SYMDEF INIT(0);
      258    16616    1   DCL DCB# UBIN WORD STATIC;
      259    16617    1   DCL OUTDCB UBIN WORD STATIC INIT(DCBNUM(M$LO));
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:8    
      260    16618    1   DCL M$OUT_NUM UBIN WORD CONSTANT SYMDEF INIT(DCBNUM(M$OUT));
      261    16619    1   DCL SELECT_CURRENT BIT(1) STATIC;       /* Special select mode bit */
      262    16620    1   DCL FOLDER_WAS_OPEN BIT(1) STATIC SYMDEF;
      263    16621    1   DCL REOPENED_FOLDER BIT(1) STATIC;      /* For bad use recovery */
      264    16622    1   DCL COMBINED BIT (1);
      265    16623    1   DCL NONE BIT (1);
      266    16624    1   DCL MADE_OLD BIT(1);
      267    16625    1   DCL WILD BIT(1);
      268    16626        /***** Variables for list and user definitions *****/
      269    16627        %VLP_ACCT (FPTN=ADDRESS_ACCT,STCLASS=AUTO);
      270    16640        %VLP_ACCT (FPTN=ADDRESS_LACCN,STCLASS=AUTO);
      271    16653    1   DCL ADDRESS_LUNAME CHAR(12) AUTO;       /* Same size as B$JIT.UNAME */
      272    16654        %VLP_NAME (FPTN=ADDRESS_NAME,LEN=511,STCLASS=AUTO);
      273    16681        %VLP_PASS (FPTN=ADDRESS_PASS,STCLASS=AUTO);
      274    16694    1   DCL ADDRESS_FOLDER CHAR(%SIZ_FOLDER) AUTO;
      275    16695    1   DCL ADDRESS_SITENAME CHAR(%SIZ_SITENAME) AUTO;
      276    16696    1   DCL DOMAIN$ PTR;
      277    16697    1   DCL MAIL_PROMPT (0:2) CHAR STATIC INIT (BITASC('100000010'B),'p','>');
      278    16698        %VLP_NAME (FPTN=VM_MODIFY_LIST_PROMPT, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      279    16725        %VLP_ERRCODE (FPTN=E_MODIFY_LIST_PROMPT, STCLASS="CONSTANT SYMDEF",
      280    16726                    ERR#=%E$MODIFY_LIST_PROMPT,          FCG=VM,MID=O);
      281    16771        /*E*  ERROR: VMO-E$MODIFY_LIST_PROMPT-0
      282    16772              MESSAGE:pList>
      283    16773        */
      284    16774              %VLP_NAME (FPTN=VM_MODIFY_USER_PROMPT, LEN=15, L=15, NAME=' ', STCLASS=STATIC)
             16774                  ;
      285    16801        %VLP_ERRCODE (FPTN=E_MODIFY_USER_PROMPT, STCLASS="CONSTANT SYMDEF",
      286    16802                    ERR#=%E$MODIFY_USER_PROMPT,          FCG=VM,MID=O);
      287    16847        /*E*  ERROR: VMO-E$MODIFY_USER_PROMPT-0
      288    16848              MESSAGE:pUser>
      289    16849        */
      290    16850    1   DCL EXIT_MAIL# BIT(1) STATIC INIT(%NO#); /* End spec. on invocation */
      291    16851    1   DCL EXIT_MAIL_PEND# BIT(1) STATIC INIT(%NO#); /* allows read as setup command */
      292    16852    1   DCL PRINT_HEADER# BIT(1) STATIC;        /* Header spec. in profile? */
      293    16853    1   DCL OUTBUF CHAR(300) STATIC ;           /* Used as an output buffer */
      294    16854    1   DCL TEMPBUF CHAR(%SIZ_LISTNAME) AUTO;   /* Same size as VM_LISTKEY.TEXT */
      295    16855    1   DCL SIZE UBIN WORD STATIC INIT(0);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:9    
      296    16856    1   DCL EJECT BIT (1);
      297    16857    1   DCL ANSI_TIME CHAR (8) STATIC;
      298    16858    1   DCL ANSI_DATE CHAR (6) STATIC;
      299    16859    1   DCL ID CHAR (511);
      300    16860    1   DCL COUNT SBIN;
      301    16861    1   DCL INDX1_CHARS CHAR(INDX1) BASED;
      302    16862        /***** Command processing variables *****/
      303    16863        %VLP_NAME (FPTN=NEXT_COMMAND_TEXT,LEN=511,STCLASS=AUTO);
      304    16890    1   DCL NEXT_COMMAND_ECHO# BIT(1) STATIC INIT(%NO#); /* Echo NEXT_COMMAND? */
      305    16891    1   DCL CURR_COMMAND_CODE UBIN WORD STATIC INIT(0); /* Current command */
      306    16892    1   DCL LAST_COMMAND_CODE UBIN WORD STATIC INIT(%CMD_LIST_MESSAGE);
      307    16893    1   DCL M$CMNDF_NUM UBIN WORD STATIC INIT(DCBNUM(M$CMNDF));
      308    16894
      309    16895
      310    16896        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:10   
      311    16897        /*
      312    16898             ***** Macros that define mail structures ...
      313    16899        */
      314    16900        %VM_KEYTYPES;
      315    16921
      316    16922        %VM_ADDTYPES;
      317    16926
      318    16927        %VM_PROFILE;
      319    17014
      320    17015        %VM_PROFILE (NAME=CVM_PROFILE,STCLASS=CONSTANT);
      321    17102
      322    17103        %VM_HEADER;
      323    17232
      324    17233        %VM_INFOKEY (NAME=VM_HEADKEY,TYP=%VM_TYPE_HEAD);
      325    17250
      326    17251        %VM_INFOKEY;
      327    17268
      328    17269        %VM_BODYKEY;
      329    17289
      330    17290        %VM_LISTKEY;
      331    17306
      332    17307        %VM_LISTKEY (NAME=VM_LISTKEY2);
      333    17323
      334    17324        %VM_USERKEY;
      335    17340
      336    17341        %VM_USERKEY (NAME=VM_USERKEY2);
      337    17357
      338    17358        %VM_ADD_HEAD;
      339    17387
      340    17388        %VM_RADDRESS (NAME=VM$RADDRESS,STCLASS=BASED);
      341    17423
      342    17424        %VM_UADDRESS (NAME=VM$UADDRESS,STCLASS=BASED);
      343    17461
      344    17462        %VM_ID (NAME=VM_ID, STCLASS="BASED(VM_HEADER$)");
      345    17475
      346    17476        %VM_BODYTYPES;
      347    17482
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:11   
      348    17483
      349    17484        %VM_ADD_HEAD (NAME=VM_ENCL_HEAD,STCLASS="BASED(VM_ENCLLIST$)");
      350    17513
      351    17514        %VM_ENCLOS (STCLASS="BASED(ENCL$)");
      352    17545
      353    17546        %VM_BODYREC (NAME=VM_ENCLREC,VARYLEN=YES,STCLASS="BASED(VM_ENCLREC$)",TYP=
             17546            %VM_BODY_BINARY_ENCL);
      354    17578
      355    17579        %SET LISTMAC = '0'B;
      356    17580        %SET LISTSUB = '0'B;
      357    17581        %VM_RADDRESS (NAME=VM_RADDRESS,STCLASS=AUTO);
      358    17616
      359    17617        %VM_UADDRESS (NAME=VM_UADDRESS,STCLASS=AUTO);
      360    17654        %SET LISTMAC = '1'B;
      361    17655        %SET LISTSUB = '1'B;
      362    17656
      363    17657        %VM_CGBUFFER (STCLASS="STATIC SYMDEF");
             17658        %LSET LISTDIR='0'B;
             17667    1   DCL 1 VM_CGBUFFER STATIC SYMDEF,
             17668    1         2 STATION# CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17669    1         2 COMMAND SBIN WORD CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17670    1         2 FOLDER,
             17671    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17672    1           3 TEXT CHAR(25) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17673    1         2 * SBIN HALF CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17674    1         2 ACCT CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17675    1         2 * CHAR(24) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17676    1         2 FILE_NAME,
             17677    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17678    1           3 TEXT CHAR(31) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17679    1         2 ERROR ,
             17680                      /* Error code returned by MAILMAN */
             17681    1           3 FCG BIT(12) UNAL,
             17682    1           3 MID BIT(6) UNAL,
             17683    1           3 MON BIT(1) UNAL,
             17684    1           3 ERR# UBIN(14) UNAL,
             17685    1           3 SEV UBIN(3) UNAL,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:12   
             17686    1         2 * CHAR(36) CALIGNED %INIT(' ')%CHARTEXT('/**/');
      364    17688
      365    17689                                           /* Information on the users central folder */
      366    17690        %VM_FOLDER_INFO (NAME=VM_CENTRAL_FOLDER);
             17691        %LSET LISTDIR='0'B;
             17700    1   DCL 1 VM_CENTRAL_FOLDER STATIC,
             17701    1         2 PSID CHAR(6) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17702                          /* Packset on which this folder resides */
             17703    1         2 ACCT CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17704                            /* Account where this folder resides */
             17705    1         2 FOLDER CHAR(25) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17706                            /* Name of this folder */
             17707    1         2 PASS CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17708                            /* Password (if any) of this folder */
             17709    1         2 SITENAME CHAR(8) %INIT(' ')%CHARTEXT('/**/'),
             17710                            /* Site where this folder exists */
             17711    1         2 TIME,
             17712                            /* Various times of interest */
             17713    1           3 ACCESS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17714                            /* Time that this file was last accessed */
             17715    1           3 CREATION UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17716                            /* Time that this file was created */
             17717    1           3 MODIFY UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17718                            /* Time that this file was last modified */
             17719    1         2 NRECS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17720                            /* Number of records in this file */
             17721    1         2 UGRANS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17722                            /* Number of granules currently in use */
             17723    1         2 FLAGS,
             17724    1           3 UPDATE BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17725                            /* May the user UPDATE or just READ this folder */
             17726    1           3 OWNER BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17727                            /* Is current user OWNER of this folder? */
             17728    1           3 ACCT_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17729                            /* Was a account specified in the address? */
             17730    1           3 FOLDER_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17731                            /* Was a folder specified in the address? */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:13   
             17732    1           3 SITENAME_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17733                            /* Was a sitename specified in the address? */
             17734    1           3 OPEN BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17735                            /* Has this folder been opened? */
             17736    1           3 RESERVED BIT(30) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17737    1         2 USER_NAME,
             17738                            /* Name that got us to this folder */
             17739    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17740    1           3 TEXT CHAR(200) CALIGNED %INIT(' ')%CHARTEXT('/**/');
      367    17742                                 /* Information on the folder currently being used */
      368    17743        %VM_FOLDER_INFO (NAME=VM_CURRENT_FOLDER,STCLASS="STATIC SYMDEF");
             17744        %LSET LISTDIR='0'B;
             17753    1   DCL 1 VM_CURRENT_FOLDER STATIC SYMDEF,
             17754    1         2 PSID CHAR(6) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17755                          /* Packset on which this folder resides */
             17756    1         2 ACCT CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17757                            /* Account where this folder resides */
             17758    1         2 FOLDER CHAR(25) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17759                            /* Name of this folder */
             17760    1         2 PASS CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17761                            /* Password (if any) of this folder */
             17762    1         2 SITENAME CHAR(8) %INIT(' ')%CHARTEXT('/**/'),
             17763                            /* Site where this folder exists */
             17764    1         2 TIME,
             17765                            /* Various times of interest */
             17766    1           3 ACCESS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17767                            /* Time that this file was last accessed */
             17768    1           3 CREATION UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17769                            /* Time that this file was created */
             17770    1           3 MODIFY UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17771                            /* Time that this file was last modified */
             17772    1         2 NRECS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17773                            /* Number of records in this file */
             17774    1         2 UGRANS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17775                            /* Number of granules currently in use */
             17776    1         2 FLAGS,
             17777    1           3 UPDATE BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:14   
             17778                            /* May the user UPDATE or just READ this folder */
             17779    1           3 OWNER BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17780                            /* Is current user OWNER of this folder? */
             17781    1           3 ACCT_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17782                            /* Was a account specified in the address? */
             17783    1           3 FOLDER_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17784                            /* Was a folder specified in the address? */
             17785    1           3 SITENAME_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17786                            /* Was a sitename specified in the address? */
             17787    1           3 OPEN BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17788                            /* Has this folder been opened? */
             17789    1           3 RESERVED BIT(30) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17790    1         2 USER_NAME,
             17791                            /* Name that got us to this folder */
             17792    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17793    1           3 TEXT CHAR(200) CALIGNED %INIT(' ')%CHARTEXT('/**/');
      369    17795        %VM_FOLDER_INFO (NAME=VM_CURRENT_FOLDER_SAVE,STCLASS=STATIC);
             17796        %LSET LISTDIR='0'B;
             17805    1   DCL 1 VM_CURRENT_FOLDER_SAVE STATIC,
             17806    1         2 PSID CHAR(6) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17807                          /* Packset on which this folder resides */
             17808    1         2 ACCT CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17809                            /* Account where this folder resides */
             17810    1         2 FOLDER CHAR(25) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17811                            /* Name of this folder */
             17812    1         2 PASS CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17813                            /* Password (if any) of this folder */
             17814    1         2 SITENAME CHAR(8) %INIT(' ')%CHARTEXT('/**/'),
             17815                            /* Site where this folder exists */
             17816    1         2 TIME,
             17817                            /* Various times of interest */
             17818    1           3 ACCESS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17819                            /* Time that this file was last accessed */
             17820    1           3 CREATION UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17821                            /* Time that this file was created */
             17822    1           3 MODIFY UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17823                            /* Time that this file was last modified */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:15   
             17824    1         2 NRECS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17825                            /* Number of records in this file */
             17826    1         2 UGRANS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17827                            /* Number of granules currently in use */
             17828    1         2 FLAGS,
             17829    1           3 UPDATE BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17830                            /* May the user UPDATE or just READ this folder */
             17831    1           3 OWNER BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17832                            /* Is current user OWNER of this folder? */
             17833    1           3 ACCT_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17834                            /* Was a account specified in the address? */
             17835    1           3 FOLDER_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17836                            /* Was a folder specified in the address? */
             17837    1           3 SITENAME_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17838                            /* Was a sitename specified in the address? */
             17839    1           3 OPEN BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17840                            /* Has this folder been opened? */
             17841    1           3 RESERVED BIT(30) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17842    1         2 USER_NAME,
             17843                            /* Name that got us to this folder */
             17844    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17845    1           3 TEXT CHAR(200) CALIGNED %INIT(' ')%CHARTEXT('/**/');
      370    17847
      371    17848                                           /* Information on folders temporarily open */
      372    17849        %VM_FOLDER_INFO (NAME=VM_WORK_FOLDER,STCLASS="STATIC SYMDEF");
             17850        %LSET LISTDIR='0'B;
             17859    1   DCL 1 VM_WORK_FOLDER STATIC SYMDEF,
             17860    1         2 PSID CHAR(6) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17861                          /* Packset on which this folder resides */
             17862    1         2 ACCT CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17863                            /* Account where this folder resides */
             17864    1         2 FOLDER CHAR(25) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17865                            /* Name of this folder */
             17866    1         2 PASS CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17867                            /* Password (if any) of this folder */
             17868    1         2 SITENAME CHAR(8) %INIT(' ')%CHARTEXT('/**/'),
             17869                            /* Site where this folder exists */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:16   
             17870    1         2 TIME,
             17871                            /* Various times of interest */
             17872    1           3 ACCESS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17873                            /* Time that this file was last accessed */
             17874    1           3 CREATION UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17875                            /* Time that this file was created */
             17876    1           3 MODIFY UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17877                            /* Time that this file was last modified */
             17878    1         2 NRECS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17879                            /* Number of records in this file */
             17880    1         2 UGRANS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17881                            /* Number of granules currently in use */
             17882    1         2 FLAGS,
             17883    1           3 UPDATE BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17884                            /* May the user UPDATE or just READ this folder */
             17885    1           3 OWNER BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17886                            /* Is current user OWNER of this folder? */
             17887    1           3 ACCT_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17888                            /* Was a account specified in the address? */
             17889    1           3 FOLDER_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17890                            /* Was a folder specified in the address? */
             17891    1           3 SITENAME_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17892                            /* Was a sitename specified in the address? */
             17893    1           3 OPEN BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17894                            /* Has this folder been opened? */
             17895    1           3 RESERVED BIT(30) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17896    1         2 USER_NAME,
             17897                            /* Name that got us to this folder */
             17898    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17899    1           3 TEXT CHAR(200) CALIGNED %INIT(' ')%CHARTEXT('/**/');
      373    17901
      374    17902                            /* Search list info describing how to resolve addresses */
      375    17903        %VM_SEARCH_INFO  (STCLASS=STATIC);
             17904        %LSET LISTDIR='0'B;
             17913    1   DCL 1 VM_SEARCH_INFO STATIC,
             17914    1         2 NUM_ENTRIES UBIN WORD,
             17915                            /* Number of folders to be searched */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:17   
             17916    1         2 DCB# (0:10) UBIN WORD %INIT(0*11)%CHARTEXT('/**/'),
             17917                            /* Number of dcb which points to folder to search */
             17918    1         2 MAP(0:10) UBIN WORD %INIT(0*11)%CHARTEXT('/**/'),
             17919                           /* Maps entry numbers to SEARCH_LIST$ in profile */
             17920    1         2 GETDCB#(0:10) UBIN WORD %INIT(0*11)%CHARTEXT('/**/'),
             17921                            /* DCB number for this slot (via get dcb) */
             17922    1         2 ACTIVE BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17923                            /* All files are open */
             17924    1         2 GLOBAL BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17925                            /* Global folder exists */
             17926    1         2 CURRENT BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17927                            /* Local folder exists */
             17928    1         2 * BIT(33) UNAL;
      376    17930
      377    17931                                                /* Wild card matching info */
      378    17932        %XUW_WILDCARD (FPTN=VM_WILDCARD,STCLASS=STATIC);
             17933        %LSET LISTDIR='0'B;
             17994    1   DCL 1 VM_WILDCARD STATIC DALIGNED,
             17995    1         2 PATTERN_ ALIGNED,
             17996    1           3 BOUND SBIN(20) UNAL INIT(SIZEV(NIL))/**/,
             17997    1           3 * BIT(12) INIT('7772'O)/**/,
             17998    1           3 * BIT(4) INIT('0'B)/**/,
             17999    1           3 PATTERN$ PTR INIT(ADDR(NIL))/**/,
             18000    1         2 INPUT_ ALIGNED,
             18001    1           3 BOUND SBIN(20) UNAL INIT(SIZEV(NIL))/**/,
             18002    1           3 * BIT(12) INIT('7772'O)/**/,
             18003    1           3 * BIT(4) INIT('0'B)/**/,
             18004    1           3 INPUT$ PTR INIT(ADDR(NIL))/**/,
             18005    1         2 TEMPLATE_ ALIGNED,
             18006    1           3 BOUND SBIN(20) UNAL INIT(SIZEV(NIL))/**/,
             18007    1           3 * BIT(12) INIT('7772'O)/**/,
             18008    1           3 * BIT(4) INIT('0'B)/**/,
             18009    1           3 TEMPLATE$ PTR INIT(ADDR(NIL))/**/,
             18010    1         2 OUTPUT_ ALIGNED,
             18011    1           3 BOUND SBIN(20) UNAL INIT(SIZEV(NIL))/**/,
             18012    1           3 * BIT(12) INIT('7772'O)/**/,
             18013    1           3 * BIT(4) INIT('0'B)/**/,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:18   
             18014    1           3 OUTPUT$ PTR INIT(ADDR(NIL))/**/,
             18015    1         2 ERROR ALIGNED,
             18016    1           3 FCG BIT(12) UNAL INIT('0'O)/**/,
             18017    1           3 MID BIT(6) UNAL INIT('0'O)/**/,
             18018    1           3 MON BIT(1) UNAL INIT('0'B)/**/,
             18019    1           3 ERR# UBIN(14) UNAL INIT(0)/**/,
             18020    1           3 SEV UBIN(3) UNAL INIT(0)/**/,
             18021    1         2 WILD_CHAR# CALIGNED CHAR(1) INIT('?')/**/,
             18022    1         2 CONTAINS# BIT(1) UNAL INIT('0'B)/**/,
             18023    1         2 * BIT(8) UNAL INIT('0'B)/**/,
             18024    1         2 * BIT(18) UNAL INIT('0'B)/**/,
             18025    1         2 OUTPUT_LEN UBIN WORD ALIGNED INIT(0)/**/,
             18026    1         2 * BIT(36) ALIGNED INIT('0'B)/**/;
      379    18028        %SET LISTMAC = '0'B;
      380    18029        %SET LISTSUB = '0'B;
      381    18030        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:19   
      382    18031        /***** Selection context information *****/
      383    18032        %SET LISTMAC='1'B;
      384    18033        %SET LISTSUB='1'B;
      385    18034        %VM_CONTEXT (NAME=VM$CONTEXT,STCLASS=BASED);
             18035        %LSET LISTDIR='0'B;
             18044    1   DCL 1 VM$CONTEXT BASED,
             18045    1         2 MESSAGE_POINTER SBIN WORD,
             18046                               /* Number of message currently being processed */
             18047    1         2 TRUTH_TREE$ PTR,
             18048                               /* Ptr to parse tree that contains TRUTH EXPRESSION */
             18049    1         2 NUM_ENTRIES UBIN WORD,
             18050                               /* Number of entries in the MESSAGE SET */
             18051    1         2 SET_INDX SBIN WORD,
             18052                               /* Which MESSAGE SET range is currently active? */
             18053    1         2 FLAGS,
             18054    1           3 INVERSE BIT(1) UNAL,
             18055                               /* Backwards? YES/NO. Default=NO */
             18056    1           3 NEXT BIT(1) UNAL,
             18057                               /* Pickup the NEXT message only */
             18058    1           3 PREV BIT(1) UNAL,
             18059                               /* Pickup the PREVIOUS message only */
             18060    1           3 RESERVED BIT(33) UNAL,
             18061    1         2 MESSAGE_SET (0:0),
             18062    1           3 LOW SBIN WORD,
             18063                               /* Low number in the range specification */
             18064    1           3 HIGH SBIN WORD;
             18065                               /* High number in the range specification */
      386    18067        %VM_SELECT (STCLASS=STATIC);
             18068        %LSET LISTDIR='0'B;
             18077    1   DCL 1 VM_SELECT STATIC,
             18078    1         2 ERROR,
             18079    1           3 FCG BIT(12) UNAL,
             18080    1           3 MID BIT(6) UNAL,
             18081    1           3 MON BIT(1) UNAL,
             18082    1           3 ERR# UBIN (14) UNAL,
             18083    1           3 SEV UBIN(3) UNAL,
             18084                               /* Error code returned from VMS$SELECT. */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:20   
             18085    1         2 ERR_POS# UBIN WORD;
             18086                               /* Position where the error was found. */
      387    18088        %SET LISTMAC='0'B;
      388    18089        %SET LISTSUB='0'B;
      389    18090        %XUM$MCB (NAME=X$MCB,STCLASS=STATIC);
      390    18094    1   DCL CONTEXT_PTR$ (0:3) PTR STATIC;
      391    18095    1   DCL WHICH_CONTEXT UBIN WORD STATIC;
      392    18096        /* Which context is currently active? */
      393    18097          %EQU CONTEXT_CURRENT = 0;             /* The current context */
      394    18098          %EQU CONTEXT_SELECTED = 1;            /* The selected context */
      395    18099        /* Useful subs */
      396    18100          %SUB CURRENT_CONTEXT = "CONTEXT_PTR$(%CONTEXT_CURRENT)->VM$CONTEXT";
      397    18101          %SUB SELECTED_CONTEXT = "CONTEXT_PTR$(%CONTEXT_SELECTED)->VM$CONTEXT";
      398    18102    1   DCL NUM_MESSAGES_PROCESSED UBIN WORD;
      399    18103        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:21   
      400    18104        /*
      401    18105             ***** The following declarations define variables
      402    18106                   that contain option values as set up by the
      403    18107                   INIT$SELECT_OPTS and other routines ...
      404    18108        */
      405    18109
      406    18110    1   DCL TEMP SBIN WORD;
      407    18111    1   DCL OPT_SITE CHAR(8);
      408    18112    1   DCL OPT_BYPASS BIT(1);
      409    18113    1   DCL OPT_NOUPDATE BIT(1);
      410    18114    1   DCL OPT_RECEIVERS BIT(1);
      411    18115    1   DCL OPT_FID CHAR(64) STATIC;
      412    18116    1   DCL OPT_EXIT BIT (1);
      413    18117    1   DCL OPT_QUIT BIT(1);
      414    18118    1   DCL OPT_SEED UBIN WORD STATIC;
      415    18119    1   DCL OPT_SEED$ PTR;
      416    18120    1   DCL OPT$SEED UBIN BASED(OPT_SEED$);
      417    18121
      418    18122        /***** Fpts *****/
      419    18123        %FPT_WAIT (FPTN=WAIT30, UNITS=30, STCLASS=CONSTANT);
      420    18137        %FPT_TIME  (FPTN=GET_ANSI_TIME,
      421    18138                    STCLASS=CONSTANT,
      422    18139                    SOURCE=UTS,
      423    18140                    DEST=ANS,
      424    18141                    TSTAMP=WORK_UTS,
      425    18142                    TIME=ANSI_TIME,
      426    18143                    DATE=ANSI_DATE);
      427    18162        %FPT_ENQ (FPTN=ENQ_PROFILE, STCLASS=STATIC,
      428    18163                  SHARE=NONE,
      429    18164                  WAIT=YES,
      430    18165                  RNAME=VM_PRORES);
      431    18183        %FPT_DEQ (FPTN=DEQ_PROFILE, STCLASS=STATIC,
      432    18184                  RNAME=VM_PRORES);
      433    18201        %VM_PRORES;
      434    18215        %VM_PRORES (NAME=VM_FILERES,RES='FILE');
      435    18229        %FPT_ENQ (FPTN=FILE_SHARE, STCLASS=CONSTANT,
      436    18230                  SHARE=ALL,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:22   
      437    18231                  DCB=M$MAIL_FILE,
      438    18232                  WAIT=YES,
      439    18233                  WAIT_TIME=0,
      440    18234                  RNAME=VM_FILERES);
      441    18252        %FPT_ENQ (FPTN=FILE_NONE, STCLASS=CONSTANT,
      442    18253                  SHARE=NONE,
      443    18254                  DCB=M$MAIL_FILE,
      444    18255                  WAIT=YES,
      445    18256                  WAIT_TIME=0,
      446    18257                  RNAME=VM_FILERES);
      447    18275        %VM_HEADRES;
      448    18289        %FPT_ENQ (FPTN=ENQ_HEAD, STCLASS=CONSTANT,
      449    18290                  DCB=M$MAIL_FILE,
      450    18291                  RNAME=VM_HEADRES,
      451    18292                  WAIT_TIME=0,
      452    18293                  SHARE=ALL);
      453    18311        %FPT_DEQ (FPTN=DEQ_HEAD, STCLASS=CONSTANT,
      454    18312                  DCB=M$MAIL_FILE,
      455    18313                  RNAME=VM_HEADRES);
      456    18330
      457    18331        %FPT_YC (FPTN=RESET_#1,
      458    18332                 CMD=RESET_#1_CMD,
      459    18333                 ECHO=NO,
      460    18334                 NOERR=YES);
      461    18351
      462    18352    1   DCL RESET_#1_CMD CHAR(0) CONSTANT INIT('!RESET #1');
      463    18353
      464    18354        %FPT_YC (FPTN=RESET_#2,
      465    18355                 CMD=RESET_#2_CMD,
      466    18356                 ECHO=NO,
      467    18357                 NOERR=YES);
      468    18374
      469    18375    1   DCL RESET_#2_CMD CHAR(0) CONSTANT INIT('!RESET #2');
      470    18376
      471    18377        %FPT_YC (FPTN=RESET_#3,
      472    18378                 CMD=RESET_#3_CMD,
      473    18379                 ECHO=NO,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:23   
      474    18380                 NOERR=YES);
      475    18397
      476    18398    1   DCL RESET_#3_CMD CHAR(0) CONSTANT INIT('!RESET #3');
      477    18399
      478    18400        %FPT_YC (FPTN=RESET_#4,
      479    18401                 CMD=RESET_#4_CMD,
      480    18402                 ECHO=NO,
      481    18403                 NOERR=YES);
      482    18420
      483    18421    1   DCL RESET_#4_CMD CHAR(0) CONSTANT INIT('!RESET #4');
      484    18422
      485    18423        %XUH_PARAM (NAME=HELP_PARAM,
      486    18424                       PROCACCT=SYSACCT,
      487    18425                       PROCNAME=MAIL_PROG_NAME,
      488    18426                       OUTDCB1=M$ME);
      489    18487
      490    18488              %VLP_NAME (FPTN=MAIL_PROG_NAME,
      491    18489              NAME='MAIL');
      492    18516
      493    18517
      494    18518        %FPT_INT     (UENTRY=XUR$BREAK);
      495    18532
      496    18533        %FPT_XCON (FPTN=SET_XCON,UENTRY=VMO$XCON);
      497    18547
      498    18548        %FPT_CLOSE (FPTN=CLOSE_SAVE,
      499    18549                    DISP=SAVE);
      500    18591        %FPT_CLOSE (FPTN=CLOSE_SCRATCH,
      501    18592                    DISP=SCRATCH);
      502    18634
      503    18635        %VLP_ERRCODE (FPTN=ERROR);
      504    18680
      505    18681              %VLP_NAME (FPTN=FID_NAME);
      506    18708
      507    18709        %VLP_ACCT (FPTN=FID_ACCT);
      508    18722
      509    18723        %VLP_PASS (FPTN=FID_PASS);
      510    18736
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:24   
      511    18737        %VLP_SN (FPTN=FID_SN);
      512    18750
      513    18751        %VLP_WSN (FPTN=FID_WSN);
      514    18764
      515    18765    1   DCL FID_ASN UBIN(9) STATIC;
      516    18766
      517    18767    1   DCL FID_RES CHAR(4) STATIC;
      518    18768
      519    18769        %VLR_FID (FPTN=FID_RESULTS,STCLASS=STATIC);
      520    18788
      521    18789        %FPT_FID  (FPTN=CHECK_FID,              /* Used to check a fid */
      522    18790                       RESULTS=FID_RESULTS,
      523    18791                       ACCT=FID_ACCT,
      524    18792                       ASN=FID_ASN,
      525    18793                       NAME=FID_NAME,
      526    18794                       PASS=FID_PASS,
      527    18795                       RES=FID_RES,
      528    18796                       TEXTFID=OPT_FID,
      529    18797                       SN=FID_SN,
      530    18798                       WSN=FID_WSN);
      531    18821
      532    18822        %FPT_OPEN (FPTN=OPEN_NEXT,
      533    18823                       ACCT=FID_ACCT,
      534    18824                       PASS=FID_PASS,
      535    18825                       ASN=FILE,
      536    18826                       DCB=M$WORK,
      537    18827                       FUN=IN,
      538    18828                       NXTF=YES,
      539    18829                       SHARE=NONE,
      540    18830                       TEST=YES);
      541    18939        /***** Name map fpts *****/
      542    18940        %FPT_OPEN (FPTN=OPEN_NAME_MAP,
      543    18941                        ACCT=VM_MAIL_ACCT,
      544    18942                        ACS=DIRECT,
      545    18943                        ASN=FILE,
      546    18944                        CTG=YES,
      547    18945                        DCB=M$NAME,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:25   
      548    18946                        EXIST=OLDFILE,
      549    18947                        FUN=CREATE,
      550    18948                        NAME=VM_NAME_MAP_NAME,
      551    18949                        ORG=KEYED,
      552    18950                       SHARE=ALL,
      553    18951                       STCLASS=CONSTANT);
      554    19060        %FPT_DELREC (FPTN=DELREC_NAME_MAP,
      555    19061                        DCB=M$NAME,
      556    19062                       KEY=NAME_KEY,
      557    19063                       STCLASS=CONSTANT);
      558    19082
      559    19083
      560    19084        %FPT_WRITE (FPTN=WRITE_NAME_MAP,
      561    19085                        DCB=M$NAME,
      562    19086                        KEY=NAME_KEY);
      563    19117
      564    19118        %FPT_READ (FPTN=READ_NAME_MAP,
      565    19119                      DCB=M$NAME,
      566    19120                      BUF=WORK_STRING.NAME#,
      567    19121                      KEY=NAME_KEY,
      568    19122                      KEYS=YES,
      569    19123                       STCLASS=CONSTANT);
      570    19162
      571    19163        %VLP_NAME (FPTN=NAME_KEY,LEN=20,NAME=' ');
      572    19190
      573    19191        %FPT_CORRES (STCLASS=STATIC);
      574    19205
      575    19206        %FPT_LINK (FPTN=FPT_LINK,
      576    19207                       CMD=LINK_CCBUF);
      577    19225
      578    19226
      579    19227        %VLP_ACCT (FPTN=SYSACCT,ACCT=':SYS');
      580    19240
      581    19241        %FPT_OPEN (FPTN=OPEN_SEND_FILE,
      582    19242                       ACS=DIRECT,
      583    19243                       ASN=FILE,
      584    19244                       DCB=M$WORK,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:26   
      585    19245                       EXIST=NEWFILE,
      586    19246                       FUN=CREATE,
      587    19247                       NAME=VM_SEND_FILE_NAME,
      588    19248                       ORG=KEYED,
      589    19249                       SCRUB=YES,
      590    19250                       STCLASS=CONSTANT);
      591    19359
      592    19360        %FPT_OPEN (FPTN=OPEN_FORWARD_FILE,
      593    19361                       ACS=SEQUEN,
      594    19362                       ASN=FILE,
      595    19363                       DCB=M$WORK,
      596    19364                       EXIST=NEWFILE,
      597    19365                       FUN=CREATE,
      598    19366                       NAME=VM_FORWARD_FILE_NAME,
      599    19367                       PASS=VM_FORWARD_FILE_PASS,
      600    19368                       ORG=CONSEC,
      601    19369                       SCRUB=YES,
      602    19370                       STCLASS=CONSTANT);
      603    19479        %FPT_OPEN (FPTN=OPEN_FORWARD_ENCL_FILE,
      604    19480                       ACS=DIRECT,
      605    19481                       ASN=FILE,
      606    19482                       DCB=M$ENCL,
      607    19483                       EXIST=NEWFILE,
      608    19484                       FUN=CREATE,
      609    19485                       NAME=VM_FORWARD_ENCL_NAME,
      610    19486                       PASS=VM_FORWARD_FILE_PASS,
      611    19487                       ORG=KEYED,
      612    19488                       SCRUB=YES,
      613    19489                       STCLASS=CONSTANT);
      614    19598        %FPT_OPEN (FPTN=REOPEN_FILE,
      615    19599                       FUN=UPDATE);
      616    19708        %FPT_TIME (FPTN=GET_TIME,
      617    19709                       SOURCE=CLOCK,
      618    19710                       DEST=UTS,
      619    19711                       TSTAMP=WORK_UTS);
      620    19730        /***** Fpts for output stream (M$LO) *****/
      621    19731        %FPT_OPEN (FPTN=OPEN_OUTPUT_STREAM_DEFAULT,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:27   
      622    19732                       REASSIGN=YES,
      623    19733                       FUN=CREATE,
      624    19734                       EXIST=OLDFILE,
      625    19735                       SCRUB=YES,
      626    19736                       STCLASS=CONSTANT,
      627    19737                       DCB=M$LO);
      628    19846
      629    19847        /***** Fpts for command stream (M$SI) *****/
      630    19848        %FPT_OPEN (FPTN=OPEN_COMMAND_STREAM_DEFAULT,
      631    19849                       REASSIGN=YES,
      632    19850                       FUN=IN,
      633    19851                       ORG=CONSEC,
      634    19852                       ACS=SEQUEN,
      635    19853                       WSN=ERASE,
      636    19854                       SCRUB=YES,
      637    19855                       STCLASS=CONSTANT,
      638    19856                       DCB=M$SI);
      639    19965
      640    19966        %FPT_OPEN (FPTN=OPEN_COMMAND_STREAM,
      641    19967                       REASSIGN=NO,
      642    19968                       FUN=IN,
      643    19969                       ORG=CONSEC,
      644    19970                       ACS=SEQUEN,
      645    19971                       SCRUB=YES,
      646    19972                       DCB=M$CMNDF);
      647    20081
      648    20082        %FPT_OPEN (FPTN=OPEN_ENCL,
      649    20083                       DCB=M$ENCL,
      650    20084                       ORG=CONSEC,
      651    20085                       ASN=FILE);
      652    20194
      653    20195        %FPT_WRITE (FPTN=WRITE_ENCL,
      654    20196                       DCB=M$ENCL);
      655    20227
      656    20228        %FPT_LDEV (FPTN=PRINT_LDEV, STCLASS=CONSTANT,
      657    20229                  STREAMNAME='ALL');
      658    20254
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:28   
      659    20255        %FPT_PRECORD (STCLASS=CONSTANT,
      660    20256                  N=-1,
      661    20257                  DCB=M$MAIL_FILE);
      662    20278        %F_FDS (NAME=F_FDSME,DCB=M$ME,BUF=OUTBUF,VECTR=VECT_ARRAY);
      663    20391              %F_FDS (NAME=SPACE_LO,BUF=OUTBUF,DCB=M$LO,VECTR=VECT_ARRAY,
      664    20392              FMT=VM_BLANK_LINE_FMT,NVECS=0);
      665    20505              %F_FDS (NAME=F_FDSLO,BUF=OUTBUF,DCB=M$LO,VECTR=VECT_ARRAY);
      666    20618
      667    20619        /***** Misc variables *****/
      668    20620    1   DCL VECT_ARRAY (0:6) BIT(72) DALIGNED STATIC;
      669    20621    1   DCL DELETE_ENCL_FLAG BIT(1);
      670    20622        /***** Dcbs *****/
      671    20623    1   DCL M$NAME DCB;
      672    20624    1   DCL M$CMNDF DCB;
      673    20625    1   DCL M$LM DCB;
      674    20626    1   DCL M$EDIT DCB;
      675    20627    1   DCL M$OUT DCB;
      676    20628    1   DCL M$ENCL DCB;
      677    20629        /***** Formats *****/
      678    20630    1   DCL VM_BLANK_LINE_FMT  CHAR(0)         STATIC INIT('%1X');
      679    20631        %VLP_NAME (FPTN=VM_GREETING_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      680    20658        %VLP_ERRCODE (FPTN=E_GREETING_FMT,   STCLASS="CONSTANT SYMDEF",
      681    20659                    ERR#=%E$GREETING_FMT,      FCG=VM,MID=O);
      682    20704        /*E*  ERROR:VMO-E$GREETING_FMT-0
      683    20705              MESSAGE:Mail "T here
      684    20706        */
      685    20707              %VLP_NAME (FPTN=VM_FOLDER_HEADER1_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             20707                  ;
      686    20734        %VLP_ERRCODE (FPTN=E_FOLDER_HEADER1_FMT, STCLASS="CONSTANT SYMDEF",
      687    20735                    ERR#=%E$FOLDER_HEADER1_FMT,          FCG=VM, MID=O);
      688    20780        /*E*  ERROR:VMO-E$FOLDER_HEADER1_FMT-0
      689    20781              MESSAGE:"15..3U ."A
      690    20782        */
      691    20783              %VLP_NAME (FPTN=VM_FOLDER_HEADER2_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             20783                  ;
      692    20810        %VLP_ERRCODE (FPTN=E_FOLDER_HEADER2_FMT, STCLASS="CONSTANT SYMDEF",
      693    20811                    ERR#=%E$FOLDER_HEADER2_FMT,          FCG=VM,MID=O);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:29   
      694    20856        /*E*  ERROR:VMO-E$FOLDER_HEADER2_FMT-0
      695    20857              MESSAGE:Owner  #Msgs #New Used Gran   Name
      696    20858        */
      697    20859              %VLP_NAME (FPTN=VM_FOLDER_DELETED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             20859                  ;
      698    20886        %VLP_ERRCODE (FPTN=E_FOLDER_DELETED_FMT, STCLASS="CONSTANT SYMDEF",
      699    20887                    ERR#=%E$FOLDER_DELETED_FMT,          FCG=VM,MID=O);
      700    20932        /*E*  ERROR:VMO-E$FOLDER_DELETED_FMT-0
      701    20933              MESSAGE:"D folders deleted
      702    20934        */
      703    20935              %VLP_NAME (FPTN=VM_FOLDER_DISPLAYED_FMT, LEN=80, L=80, NAME=' ', STCLASS=
             20935                  STATIC);
      704    20962        %VLP_ERRCODE(FPTN=E_FOLDER_DISPLAYED_FMT, STCLASS="CONSTANT SYMDEF",
      705    20963                    ERR#=%E$FOLDER_DISPLAYED_FMT,        FCG=VM,MID=O);
      706    21008        /*E*  ERROR:VMO-E$FOLDER_DISPLAYED_FMT-0
      707    21009              MESSAGE:"D folders displayed
      708    21010        */
      709    21011              %VLP_NAME (FPTN=VM_COUNT_FMT, LEN=80, L=80, NAME = ' ', STCLASS=STATIC);
      710    21038        %VLP_ERRCODE (FPTN=E_COUNT_FMT, STCLASS="CONSTANT SYMDEF",
      711    21039                    ERR#=%E$COUNT_FMT,                   FCG=VM,MID=O);
      712    21084        /*E*  ERROR:VMO-E$COUNT_FMT-0
      713    21085              MESSAGE:"D messages found
      714    21086        */
      715    21087              %VLP_NAME (FPTN=VM_NO_MESSAGE_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      716    21114        %VLP_ERRCODE (FPTN=E_NO_MESSAGE_FMT, STCLASS="CONSTANT SYMDEF",
      717    21115                    ERR#=%E$NO_MESSAGE_FMT,              FCG=VM,MID=O);
      718    21160        /*E*  ERROR:VMO-E$NO_MESSAGE_FMT-0
      719    21161              MESSAGE:None found
      720    21162        */
      721    21163              %VLP_NAME (FPTN=VM_TIME_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      722    21190        %VLP_ERRCODE (FPTN=E_TIME_FMT, STCLASS="CONSTANT SYMDEF",
      723    21191                    ERR#=%E$TIME_FMT,                    FCG=VM,MID=O);
      724    21236        /*E*  ERROR:VMO-E$TIME_FMT-0
      725    21237              MESSAGE:"15..3U
      726    21238        */
      727    21239              %VLP_NAME (FPTN=VM_EMPTY_FOLDER_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      728    21266        %VLP_ERRCODE (FPTN=E_EMPTY_FOLDER_FMT, STCLASS="CONSTANT SYMDEF",
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:30   
      729    21267                    ERR#=%E$EMPTY_FOLDER_FMT,            FCG=VM,MID=O);
      730    21312        /*E*  ERROR:VMO-E$EMPTY_FOLDER_FMT-0,                FCG=VM,MID=O);
      731    21313              MESSAGE:Folder "A is empty
      732    21314        */
      733    21315              %VLP_NAME (FPTN=VM_NO_NEW_MESSAGE_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             21315                  ;
      734    21342        %VLP_ERRCODE (FPTN=E_NO_NEW_MESSAGE_FMT, STCLASS="CONSTANT SYMDEF",
      735    21343                    ERR#=%E$NO_NEW_MESSAGE_FMT,           FCG=VM,MID=O);
      736    21388        /*E*  ERROR:VMO-E$NO_NEW_MESSAGE_FMT-0,
      737    21389              MESSAGE:No NEW messages found
      738    21390        */
      739    21391              %VLP_NAME (FPTN=VM_CREATE_MSG_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      740    21418        %VLP_ERRCODE (FPTN=E_CREATE_MSG_FMT,   STCLASS="CONSTANT SYMDEF",
      741    21419                    ERR#=%E$CREATE_MSG_FMT,              FCG=VM,MID=O);
      742    21464        /*E*  ERROR:VMO-E$CREATE_MSG_FMT-0
      743    21465              MESSAGE:Folder %U1 created.
      744    21466        */
      745    21467              %VLP_ERRCODE (FPTN=E_USING_MSG_FMT, STCLASS="CONSTANT SYMDEF",
      746    21468              ERR#=%E$USING_MSG_FMT,                 FCG=VM,MID=O);
      747    21513        /*E*  ERROR:VMO-E$USING_MSG_FMT-0
      748    21514              MESSAGE:Using %U1
      749    21515        */
      750    21516              %VLP_NAME (FPTN=VM_MSGS_DELETED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      751    21543        %VLP_ERRCODE (FPTN=E_MSGS_DELETED_FMT, STCLASS="CONSTANT SYMDEF",
      752    21544                    ERR#=%E$MSGS_DELETED_FMT,             FCG=VM,MID=O);
      753    21589        /*E*  ERROR:VMO-E$MSGS_DELETED_FMT-0,
      754    21590              MESSAGE:"D messages flagged for deletion
      755    21591        */
      756    21592              %VLP_NAME (FPTN=VM_MSGS_UNDELETED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             21592                  ;
      757    21619        %VLP_ERRCODE (FPTN=E_MSGS_UNDELETED_FMT, STCLASS="CONSTANT SYMDEF",
      758    21620                    ERR#=%E$MSGS_UNDELETED_FMT,           FCG=VM,MID=O);
      759    21665        /*E*  ERROR:VMO-E$MSGS_UNDELETED_FMT-0
      760    21666              MESSAGE:"D messages no longer flagged for deletion
      761    21667        */
      762    21668              %VLP_NAME (FPTN=VM_MSGS_MARKED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      763    21695        %VLP_ERRCODE (FPTN=E_MSGS_MARKED_FMT,  STCLASS="CONSTANT SYMDEF",
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:31   
      764    21696                    ERR#=%E$MSGS_MARKED_FMT,             FCG=VM,MID=O);
      765    21741        /*E*  ERROR:VMO-E$MSGS_MARKED_FMT-0
      766    21742              MESSAGE:"D messages marked
      767    21743        */
      768    21744              %VLP_NAME (FPTN=VM_MSGS_UNMARKED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      769    21771        %VLP_ERRCODE (FPTN=E_MSGS_UNMARKED_FMT, STCLASS="CONSTANT SYMDEF",
      770    21772                    ERR#=%E$MSGS_UNMARKED_FMT,           FCG=VM,MID=O);
      771    21817        /*E*  ERROR:VMO-E$MSGS_UNMARKED_FMT-0
      772    21818              MESSAGE:"D messages no longer marked
      773    21819        */
      774    21820              %VLP_NAME (FPTN=VM_MSGS_COPIED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      775    21847        %VLP_ERRCODE (FPTN=E_MSGS_COPIED_FMT,  STCLASS="CONSTANT SYMDEF",
      776    21848                       ERR#=%E$MSGS_COPIED_FMT,          FCG=VM,MID=O);
      777    21893        /*E*  ERROR:VMO-E$MSGS_COPIED_FMT-0
      778    21894              MESSAGE:"D messages copied
      779    21895        */
      780    21896              %VLP_NAME (FPTN=VM_MSGS_DISPLAYED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             21896                  ;
      781    21923        %VLP_ERRCODE (FPTN=E_MSGS_DISPLAYED_FMT, STCLASS="CONSTANT SYMDEF",
      782    21924                    ERR#=%E$MSGS_DISPLAYED_FMT,             FCG=VM,MID=O);
      783    21969        /*E*  ERROR:VMO-E$MSGS_DISPLAYED_FMT-0
      784    21970              MESSAGE:"D messages displayed
      785    21971        */
      786    21972              %VLP_NAME (FPTN=VM_MSGS_LISTED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      787    21999        %VLP_ERRCODE (FPTN=E_MSGS_LISTED_FMT,  STCLASS="CONSTANT SYMDEF",
      788    22000                    ERR#=%E$MSGS_LISTED_FMT,             FCG=VM,MID=O);
      789    22045        /*E*  ERROR:VMO-E$MSGS_LISTED_FMT-0
      790    22046              MESSAGE:"D messages listed
      791    22047        */
      792    22048              %VLP_NAME (FPTN=VM_LISTS_DELETED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      793    22075        %VLP_ERRCODE (FPTN=E_LISTS_DELETED_FMT, STCLASS="CONSTANT SYMDEF",
      794    22076                    ERR#=%E$LISTS_DELETED_FMT,           FCG=VM,MID=O);
      795    22121        /*E*  ERROR:VMO-E$LISTS_DELETED_FMT-0
      796    22122              MESSAGE:"D list definitions deleted
      797    22123        */
      798    22124              %VLP_NAME (FPTN=VM_LISTS_DISPLAYED_FMT, LEN=80, L=80, NAME= ' ',STCLASS=STATIC
             22124                  );
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:32   
      799    22151        %VLP_ERRCODE (FPTN=E_LISTS_DISPLAYED_FMT, STCLASS="CONSTANT SYMDEF",
      800    22152                    ERR#=%E$LISTS_DISPLAYED_FMT,         FCG=VM,MID=O);
      801    22197        /*E*  ERROR:VMO-E$LISTS_DISPLAYED_FMT-0
      802    22198              MESSAGE:"D list definitions displayed
      803    22199        */
      804    22200              %VLP_NAME (FPTN=VM_USERS_DELETED_FMT, LEN=80, L=80, NAME=' ',STCLASS=STATIC);
      805    22227        %VLP_ERRCODE (FPTN=E_USERS_DELETED_FMT, STCLASS="CONSTANT SYMDEF",
      806    22228                    ERR#=%E$USERS_DELETED_FMT,           FCG=VM,MID=O);
      807    22273        /*E*  ERROR:VMO-E$USERS_DELETED_FMT-0
      808    22274              MESSAGE:"D user definitions deleted
      809    22275        */
      810    22276              %VLP_NAME (FPTN=VM_USERS_DISPLAYED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC
             22276                  );
      811    22303        %VLP_ERRCODE (FPTN=E_USERS_DISPLAYED_FMT, STCLASS="CONSTANT SYMDEF",
      812    22304                    ERR#=%E$USERS_DISPLAYED_FMT,         FCG=VM,MID=O);
      813    22349        /*E*  ERROR:VMO-E$USERS_DISPLAYED_FMT-0
      814    22350              MESSAGE:"D user definitions displayed
      815    22351        */
      816    22352              %VLP_NAME (FPTN=VM_STATUS_FOLDER_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      817    22379        %VLP_ERRCODE (FPTN=E_STATUS_FOLDER_FMT, STCLASS="CONSTANT SYMDEF",
      818    22380                    ERR#=%E$STATUS_FOLDER_FMT,           FCG=VM,MID=O);
      819    22425        /*E*  ERROR:VMO-E$STATUS_FOLDER_FMT-0
      820    22426              MESSAGE:"5XCurrent folder is "A
      821    22427        */
      822    22428              %VLP_NAME (FPTN=VM_STATUS_SCONTEXT_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC
             22428                  );
      823    22455        %VLP_ERRCODE (FPTN=E_STATUS_SCONTEXT_FMT, STCLASS="CONSTANT SYMDEF",
      824    22456                    ERR#=%E$STATUS_SCONTEXT_FMT,         FCG=VM,MID=O);
      825    22501        /*E*  ERROR:VMO-E$STATUS_SCONTEXT_FMT-0
      826    22502              MESSAGE:"5XSelected Context is: "A
      827    22503        */
      828    22504              %VLP_NAME (FPTN=VM_STATUS_CCONTEXT_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC
             22504                  );
      829    22531        %VLP_ERRCODE (FPTN=E_STATUS_CCONTEXT_FMT, STCLASS="CONSTANT SYMDEF",
      830    22532                    ERR#=%E$STATUS_CCONTEXT_FMT,         FCG=VM,MID=O);
      831    22577        /*E*  ERROR:VMO-E$STATUS_CCONTEXT_FMT-0
      832    22578              MESSAGE:"5XCurrent Context is: "A
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:33   
      833    22579        */
      834    22580              %VLP_NAME (FPTN=VM_STATUS_POSITION_FMT, LEN=80, L=80, NAME = ' ', STCLASS=
             22580                  STATIC);
      835    22607        %VLP_ERRCODE (FPTN=E_STATUS_POSITION_FMT, STCLASS="CONSTANT SYMDEF",
      836    22608                    ERR#=%E$STATUS_POSITION_FMT,         FCG=VM,MID=O);
      837    22653        /*E*  ERROR:VMO-E$STATUS_POSITION_FMT-0
      838    22654              MESSAGE:"5XMessage within Selected Context is: "D
      839    22655        */
      840    22656              %VLP_NAME (FPTN=VM_STATUS_POSITION_OUTSIDE_FMT, LEN=80, L=80, NAME=' ',
             22656                  STCLASS=STATIC);
      841    22683        %VLP_ERRCODE (FPTN=E_STATUS_POSITION_OUTSIDE_FMT, STCLASS="CONSTANT SYMDEF",
      842    22684                    ERR#=%E$STATUS_POSITION_OUTSIDE_FMT, FCG=VM,MID=O);
      843    22729        /*E*  ERROR:VMO-E$STATUS_POSITION_OUTSIDE_FMT-0
      844    22730              MESSAGE:"5XMessage position within Selected Context is: Outside Selected Range
      845    22731        */
      846    22732              %VLP_NAME (FPTN=VM_STATUS_DMSGS_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      847    22759        %VLP_ERRCODE (FPTN=E_STATUS_DMSGS_FMT, STCLASS="CONSTANT SYMDEF",
      848    22760                    ERR#=%E$STATUS_DMSGS_FMT,            FCG=VM,MID=O);
      849    22805        /*E*  ERROR:VMO-E$STATUS_DMSGS_FMT-0
      850    22806              MESSAGE:"5XNumber of messages  marked for deletion is "D
      851    22807        */
      852    22808              %VLP_NAME (FPTN=VM_STATUS_NMSGS_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      853    22835        %VLP_ERRCODE (FPTN=E_STATUS_NMSGS_FMT, STCLASS="CONSTANT SYMDEF",
      854    22836                    ERR#=%E$STATUS_NMSGS_FMT,            FCG=VM,MID=O);
      855    22881        /*E*  ERROR:VMO-E$STATUS_NMSGS_FMT-0
      856    22882              MESSAGE:"5XNumber of new messages is "D
      857    22883        */
      858    22884              %VLP_NAME (FPTN=VM_STATUS_TMSGS_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      859    22911        %VLP_ERRCODE (FPTN=E_STATUS_TMSGS_FMT, STCLASS="CONSTANT SYMDEF",
      860    22912                    ERR#=%E$STATUS_TMSGS_FMT,            FCG=VM,MID=O);
      861    22957        /*E*  ERROR:VMO-E$STATUS_TMSGS_FMT-0
      862    22958              MESSAGE:"5XTotal number of messages is "D
      863    22959        */
      864    22960              %VLP_NAME (FPTN=VM_STATUS_HMSGS_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      865    22987        %VLP_ERRCODE (FPTN=E_STATUS_HMSGS_FMT, STCLASS="CONSTANT SYMDEF",
      866    22988                    ERR#=%E$STATUS_HMSGS_FMT,            FCG=VM,MID=O);
      867    23033        /*E*  ERROR:VMO-E$STATUS_HMSGS_FMT-0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:34   
      868    23034              MESSAGE:"5XHighest message number is "D
      869    23035        */
      870    23036              %VLP_NAME (FPTN=VM_USE_FULL_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      871    23063        %VLP_ERRCODE (FPTN=E_USE_FULL_FMT,     STCLASS="CONSTANT SYMDEF",
      872    23064                    ERR#=%E$USE_FULL_FMT,                FCG=VM,MID=O);
      873    23109        /*E*  ERROR:VMO-E$USE_FULL_FMT-0
      874    23110              MESSAGE:Folder "A is full
      875    23111        */
      876    23112              %VLP_NAME (FPTN=VM_USE_LOST_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      877    23139        %VLP_ERRCODE (FPTN=E_USE_LOST_FMT,     STCLASS="CONSTANT SYMDEF",
      878    23140                    ERR#=%E$USE_LOST_FMT,                FCG=VM,MID=O);
      879    23185        /*E*  ERROR:VMO-E$USE_LOST_FMT-0
      880    23186              MESSAGE:Warning: "D messages lost due to insufficient disk space.
      881    23187        */
      882    23188              %VLP_NAME (FPTN=VM_NEW_MESSAGE_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      883    23215        %VLP_ERRCODE (FPTN=E_NEW_MESSAGE_FMT,  STCLASS="CONSTANT SYMDEF",
      884    23216                    ERR#=%E$NEW_MESSAGE_FMT,             FCG=VM,MID=O);
      885    23261        /*E*  ERROR:VMO-E$NEW_MESSAGE_FMT-0
      886    23262              MESSAGE:A new message has been received.
      887    23263        */
      888    23264
      889    23265              %VLP_NAME (FPTN=USER_NAME,LEN=256,NAME=' ',STCLASS=STATIC);
      890    23292        %VLP_NAME (FPTN=VM_DETACH_OK_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      891    23319        %VLP_ERRCODE (FPTN=E_DETACH_OK_FMT,STCLASS="CONSTANT SYMDEF",
      892    23320                      ERR#=%E$DETACH_OK_FMT,        FCG="VM",MID="O");
      893    23365        /*E* ERROR:VMO-E$DETACH_OK_FMT
      894    23366             MESSAGE:Enclosure "D detached.
      895    23367        */
      896    23368              %VLP_NAME (FPTN=VM_DETACH_DELETE_OK_FMT, LEN=80, L=80, NAME=' ', STCLASS=
             23368                  STATIC);
      897    23395        %VLP_ERRCODE (FPTN=E_DETACH_DELETE_OK_FMT,STCLASS="CONSTANT SYMDEF",
      898    23396                      ERR#=%E$DETACH_DELETE_OK_FMT,        FCG="VM",MID="O");
      899    23441        /*E* ERROR:VMO-E$DETACH_DELETE_OK_FMT
      900    23442             MESSAGE:Enclosure "D detached and deleted.
      901    23443        */
      902    23444        /***** Embedded commands *****/
      903    23445              %VLP_NAME (FPTN=VM_END_NOUPDATE_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:35   
      904    23472        %VLP_ERRCODE (FPTN=E_END_NOUPDATE_CMD, STCLASS="CONSTANT SYMDEF",
      905    23473                    ERR#=%E$END_NOUPDATE_CMD,            FCG=VM,MID=O);
      906    23518        /*E*  ERROR:VMO-E$END_NOUPDATE_CMD-0
      907    23519              MESSAGE:END NOUPDATE
      908    23520        */
      909    23521              %VLP_NAME (FPTN=VM_NEXT_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      910    23548        %VLP_ERRCODE (FPTN=E_NEXT_CMD,         STCLASS="CONSTANT SYMDEF",
      911    23549                    ERR#=%E$NEXT_CMD,                    FCG=VM,MID=O);
      912    23594        /*E*  ERROR:VMO-E$NEXT_CMD-0
      913    23595              MESSAGE:NEXT
      914    23596        */
      915    23597              %VLP_NAME (FPTN=VM_DI_NEXT_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      916    23624        %VLP_ERRCODE (FPTN=E_DI_NEXT_CMD,      STCLASS="CONSTANT SYMDEF",
      917    23625                    ERR#=%E$DI_NEXT_CMD,                 FCG=VM,MID=O);
      918    23670        /*E*  ERROR:VMO-E$DI_NEXT_CMD-0
      919    23671              MESSAGE:DI NEXT
      920    23672        */
      921    23673              %VLP_NAME (FPTN=VM_LIST_NEXT_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      922    23700        %VLP_ERRCODE (FPTN=E_LIST_NEXT_CMD,    STCLASS="CONSTANT SYMDEF",
      923    23701                    ERR#=%E$LIST_NEXT_CMD,               FCG=VM,MID=O);
      924    23746        /*E*  ERROR:VMO-E$LIST_NEXT_CMD-0
      925    23747              MESSAGE:LIST NEXT
      926    23748        */
      927    23749              %VLP_NAME (FPTN=VM_PREVIOUS_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      928    23776        %VLP_ERRCODE (FPTN=E_PREVIOUS_CMD,     STCLASS="CONSTANT SYMDEF",
      929    23777                    ERR#=%E$PREVIOUS_CMD,                FCG=VM,MID=O);
      930    23822        /*E*  ERROR:VMO-E$PREVIOUS_CMD-0
      931    23823              MESSAGE:PREVIOUS
      932    23824        */
      933    23825              %VLP_NAME (FPTN=VM_DI_PREVIOUS_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      934    23852        %VLP_ERRCODE (FPTN=E_DI_PREVIOUS_CMD,  STCLASS="CONSTANT SYMDEF",
      935    23853                    ERR#=%E$DI_PREVIOUS_CMD,            FCG=VM,MID=O);
      936    23898        /*E*  ERROR:VMO-E$DI_PREVIOUS_CMD-0
      937    23899              MESSAGE:DI PREVIOUS
      938    23900        */
      939    23901              %VLP_NAME (FPTN=VM_LIST_PREVIOUS_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      940    23928        %VLP_ERRCODE (FPTN=E_LIST_PREVIOUS_CMD, STCLASS="CONSTANT SYMDEF",
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:36   
      941    23929                    ERR#=%E$LIST_PREVIOUS_CMD,           FCG=VM,MID=O);
      942    23974        /*E*  ERROR:VMO-E$LIST_PREVIOUS_CMD-0
      943    23975              MESSAGE:LIST PREVIOUS
      944    23976        */
      945    23977              %VLP_NAME (FPTN=VM_DI_FIRST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      946    24004        %VLP_ERRCODE (FPTN=E_DI_FIRST_CMD,     STCLASS="CONSTANT SYMDEF",
      947    24005                    ERR#=%E$DI_FIRST_CMD,                FCG=VM,MID=O);
      948    24050        /*E*  ERROR:VMO-E$DI_FIRST_CMD-0
      949    24051              MESSAGE:DI FIRST
      950    24052        */
      951    24053              %VLP_NAME (FPTN=VM_LIST_FIRST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      952    24080        %VLP_ERRCODE (FPTN=E_LIST_FIRST_CMD,   STCLASS="CONSTANT SYMDEF",
      953    24081                    ERR#=%E$LIST_FIRST_CMD,              FCG=VM,MID=O);
      954    24126        /*E*  ERROR:VMO-E$LIST_FIRST_CMD-0
      955    24127              MESSAGE:LIST FIRST
      956    24128        */
      957    24129              %VLP_NAME (FPTN=VM_DI_THIS_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      958    24156        %VLP_ERRCODE (FPTN=E_DI_THIS_CMD,      STCLASS="CONSTANT SYMDEF",
      959    24157                    ERR#=%E$DI_THIS_CMD,                 FCG=VM,MID=O);
      960    24202        /*E*  ERROR:VMO-E$DI_THIS_CMD-0
      961    24203              MESSAGE:DI THIS
      962    24204        */
      963    24205              %VLP_NAME (FPTN=VM_LIST_THIS_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      964    24232        %VLP_ERRCODE (FPTN=E_LIST_THIS_CMD,    STCLASS="CONSTANT SYMDEF",
      965    24233                    ERR#=%E$LIST_THIS_CMD,               FCG=VM,MID=O);
      966    24278        /*E*  ERROR:VMO-E$LIST_THIS_CMD-0
      967    24279              MESSAGE:LIST THIS
      968    24280        */
      969    24281              %VLP_NAME (FPTN=VM_DI_LAST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      970    24308        %VLP_ERRCODE (FPTN=E_DI_LAST_CMD,    STCLASS="CONSTANT SYMDEF",
      971    24309                    ERR#=%E$DI_LAST_CMD,               FCG=VM,MID=O);
      972    24354        /*E*  ERROR:VMO-E$DI_LAST_CMD-0,
      973    24355              MESSAGE:DI LAST
      974    24356        */
      975    24357              %VLP_NAME (FPTN=VM_LIST_LAST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      976    24384        %VLP_ERRCODE (FPTN=E_LIST_LAST_CMD,    STCLASS="CONSTANT SYMDEF",
      977    24385                    ERR#=%E$LIST_LAST_CMD,               FCG=VM,MID=O);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:37   
      978    24430        /*E*  ERROR:VMO-E$LIST_LAST_CMD-0
      979    24431              MESSAGE:LIST LAST
      980    24432        */
      981    24433              %VLP_NAME (FPTN=VM_DI_REST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      982    24460        %VLP_ERRCODE (FPTN=E_DI_REST_CMD,      STCLASS="CONSTANT SYMDEF",
      983    24461                    ERR#=%E$DI_REST_CMD,                 FCG=VM,MID=O);
      984    24506        /*E*  ERROR:VMO-E$DI_REST_CMD-0
      985    24507              MESSAGE:DI REST
      986    24508        */
      987    24509              %VLP_NAME (FPTN=VM_LIST_REST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      988    24536        %VLP_ERRCODE (FPTN=E_LIST_REST_CMD,    STCLASS="CONSTANT SYMDEF",
      989    24537                    ERR#=%E$LIST_REST_CMD,               FCG=VM,MID=O);
      990    24582        /*E*  ERROR:VMO-E$LIST_REST_CMD-0
      991    24583              MESSAGE:LIST REST
      992    24584        */
      993    24585              %VLP_NAME (FPTN=VM_END_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      994    24612        %VLP_ERRCODE (FPTN=E_END_CMD,          STCLASS="CONSTANT SYMDEF",
      995    24613                    ERR#=%E$END_CMD,                     FCG=VM,MID=O);
      996    24658        /*E*  ERROR:VMO-E$END_CMD-0
      997    24659              MESSAGE:END
      998    24660        */
      999    24661              %VLP_NAME (FPTN=VM_SEND_ANSWER, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
     1000    24688        %VLP_ERRCODE (FPTN=E_SEND_ANSWER,      STCLASS="CONSTANT SYMDEF",
     1001    24689                    ERR#=%E$SEND_ANSWER,                 FCG=VM,MID=O);
     1002    24734        /*E*  ERROR:VMO-E$SEND_ANSWER-0
     1003    24735              MESSAGE:ANSWER
     1004    24736        */
     1005    24737              %VLP_NAME (FPTN=VM_SEND_ACKNOWLEDGE, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
     1006    24764        %VLP_ERRCODE (FPTN=E_SEND_ACKNOWLEDGE, STCLASS="CONSTANT SYMDEF",
     1007    24765                    ERR#=%E$SEND_ACKNOWLEDGE,            FCG=VM,MID=O);
     1008    24810        /*E*  ERROR:VMO-E$SEND_ACKNOWLEDGE-0
     1009    24811              MESSAGE:ACKNOWLEDGE
     1010    24812        */
     1011    24813              %VLP_NAME (FPTN=VM_SEND_FORWARD, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
     1012    24840        %VLP_ERRCODE (FPTN=E_SEND_FORWARD,     STCLASS="CONSTANT SYMDEF",
     1013    24841                    ERR#=%E$SEND_FORWARD,                FCG=VM,MID=O);
     1014    24886        /*E*  ERROR:VMO-E$SEND_FORWARD-0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:38   
     1015    24887              MESSAGE:FORWARD
     1016    24888        */
     1017    24889              %VLP_NAME (FPTN=VM_SEND_FORWARD_ENCL, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
     1018    24916        %VLP_ERRCODE (FPTN=E_SEND_FORWARD_ENCL,    STCLASS="CONSTANT SYMDEF",
     1019    24917                    ERR#=%E$SEND_FORWARD_ENCL,            FCG=VM,MID=O);
     1020    24962        /*E*   ERROR:VMO-E$SEND_FORWARD_ENCL-0
     1021    24963               MESSAGE:FORWARD ENCLOSURE
     1022    24964        */
     1023    24965              %VLP_NAME (FPTN=VM_SEND_MAIL, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
     1024    24992        %VLP_ERRCODE (FPTN=E_SEND_MAIL,        STCLASS="CONSTANT SYMDEF",
     1025    24993                    ERR#=%E$SEND_MAIL,                   FCG=VM,MID=O);
     1026    25038        /*E*  ERROR:VMO-E$SEND_MAIL-0
     1027    25039              MESSAGE: (MAIL=
     1028    25040        */
     1029    25041              %VLP_NAME (FPTN=VM_SEND_NAME, STCLASS="STATIC SYMDEF", STCLASS=STATIC);
     1030    25068        %VLP_ERRCODE (FPTN=E_SEND_NAME,        STCLASS="CONSTANT SYMDEF",
     1031    25069                    ERR#=%E$SEND_NAME,                   FCG=VM,MID=O);
     1032    25114        /*E*  ERROR:VMO-E$SEND_NAME-0
     1033    25115              MESSAGE:SEND
     1034    25116        */
     1035    25117              %VLP_NAME (FPTN=VM_RESEND_NAME, STCLASS="STATIC SYMDEF", STCLASS=STATIC);
     1036    25144        %VLP_ERRCODE (FPTN=E_RESEND_NAME,        STCLASS="CONSTANT SYMDEF",
     1037    25145                    ERR#=%E$RESEND_NAME,                   FCG=VM,MID=O);
     1038    25190        /*E*  ERROR:VMO-E$RESEND_NAME-0
     1039    25191              MESSAGE:RESEND
     1040    25192        */
     1041    25193              %VLP_NAME (FPTN=VM_MAIL_SETUP, LEN=255, L=255, NAME=' ', STCLASS=STATIC);
     1042    25220        %VLP_ERRCODE (FPTN=E_MAIL_SETUP,       STCLASS="CONSTANT SYMDEF",
     1043    25221                    ERR#=%E$MAIL_SETUP,                  FCG=VM,MID=O);
     1044    25266        /*E*  ERROR:VMO-E$MAIL_SETUP-0
     1045    25267              MESSAGE:LIST NEW
     1046    25268        */
     1047    25269        /***** Error codes *****/
     1048    25270              %VLP_ERRCODE (FPTN=E_LISTEXISTS,FCG="VM",MID="O",
     1049    25271              ERR#=%E$LISTEXISTS,STCLASS=CONSTANT);
     1050    25316              %VLP_ERRCODE (FPTN=E_USEREXISTS,FCG="VM",MID="O",
     1051    25317              ERR#=%E$USEREXISTS,STCLASS=CONSTANT);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:39   
     1052    25362              %VLP_ERRCODE (FPTN=E_NOTMCENTRAL,FCG="VM",MID="O",
     1053    25363              ERR#=%E$NOTMCENTRAL,STCLASS=CONSTANT);
     1054    25408              %VLP_ERRCODE (FPTN=E_FOLDERBUSY,FCG="VM",MID="O",
     1055    25409              ERR#=%E$FOLDERBUSY,STCLASS=CONSTANT);
     1056    25454        /*E*    ERROR: VMO-E$FOLDERBUSY-0
     1057    25455                MESSAGE: Folder %U1 is busy. Try again later.
     1058    25456        */
     1059    25457              %VLP_ERRCODE (FPTN=E_FOLDEROLD,FCG="VM",MID="O",
     1060    25458              ERR#=%E$FOLDEROLD,STCLASS=CONSTANT);
     1061    25503        /*E* ERROR: VMO-E$FOLDEROLD-0
     1062    25504             MESSAGE: Error encountered trying to use the %FN folder.
     1063    25505             MESSAGE1: This may not be a folder or it may be a pre-A00 folder that
     1064    25506                     is incompatible with the current version of MAIL. Delete or rename
     1065    25507                     the %FN file and recreate the folder using MAIL.
     1066    25508        */
     1067    25509              %VLP_ERRCODE (FPTN=E_NAMENTALLOWED,FCG="VM",MID="O",
     1068    25510              ERR#=%E$NAMENTALLOWED,STCLASS=CONSTANT);
     1069    25555        /*E*    ERROR: VMO-E$NAMENTALLOWED-0
     1070    25556                MESSAGE: Names are not allowed here.
     1071    25557        */
     1072    25558              %VLP_ERRCODE (FPTN=E_CRFERR,FCG="VM",MID="O",
     1073    25559              ERR#=%E$CRFERR,STCLASS=CONSTANT);
     1074    25604        /*E*    ERROR: VMO-E$CRFERR-0
     1075    25605                MESSAGE: Error encountered trying to create folder.
     1076    25606        */
     1077    25607              %VLP_ERRCODE (FPTN=E_DELFERR,FCG="VM",MID="O",
     1078    25608              ERR#=%E$DELFERR,STCLASS=CONSTANT);
     1079    25653        /*E*    ERROR: VMO-E$DELFERR-0
     1080    25654                MESSAGE: Error encountered trying to delete folder.
     1081    25655        */
     1082    25656              %VLP_ERRCODE (FPTN=E_NOTALLOW,FCG="VM",MID="O",
     1083    25657              ERR#=%E$NOTALLOW,STCLASS=CONSTANT);
     1084    25702              %VLP_ERRCODE (FPTN=E_UNDEFENTRY,FCG="VM",MID="O",
     1085    25703              ERR#=%E$UNDEFENTRY,STCLASS=CONSTANT);
     1086    25748        /*E* ERROR: VMO-E$UNDEFENTRY-0
     1087    25749             MESSAGE: That name is undefined.
     1088    25750        */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:40   
     1089    25751              %VLP_ERRCODE (FPTN=E_NMENTRYEXISTS,FCG="VM",MID="O",
     1090    25752              ERR#=%E$NMENTRYEXISTS,STCLASS=CONSTANT);
     1091    25797        /*E* ERROR: VMO-E$NMENTRYEXISTS-0
     1092    25798             MESSAGE: User map entry %U1 points to user %U2.
     1093    25799        */
     1094    25800              %VLP_ERRCODE (FPTN=E_BLANKUSER,FCG="VM",MID="O",
     1095    25801              ERR#=%E$BLANKUSER,STCLASS=CONSTANT);
     1096    25846        /*E*    ERROR: VMO-E$BLANKUSER-0
     1097    25847                MESSAGE: User name can't be blank.
     1098    25848        */
     1099    25849              %VLP_ERRCODE (FPTN=E_CANTDELCUR,FCG="VM",MID="O",
     1100    25850              ERR#=%E$CANTDELCUR,STCLASS=CONSTANT);
     1101    25895        /*E*    ERROR: VMO-E$CANTDELCUR-0
     1102    25896                MESSAGE: Can't delete current folder
     1103    25897                MESSAGE1: You can't delete the folder you are currently USEing.
     1104    25898        */
     1105    25899              %VLP_ERRCODE (FPTN=E_CANTDELF,FCG="VM",MID="O",
     1106    25900              ERR#=%E$CANTDELF,STCLASS=CONSTANT);
     1107    25945        /*E*    ERROR: VMO-E$CANTDELF-0
     1108    25946                MESSAGE: Can't delete folder:
     1109    25947        */
     1110    25948              %VLP_ERRCODE (FPTN=E_TOOMANYSRCH,FCG="VM",MID="O",
     1111    25949              ERR#=%E$TOOMANYSRCH,STCLASS=CONSTANT);
     1112    25994        /*E*     ERROR: VMO-E$TOOMANYSRCH
     1113    25995                 MESSAGE: No more than 4 folders may be specified.
     1114    25996        */
     1115    25997              %VLP_ERRCODE (FPTN=E_NOCURFOLD,FCG="VM",MID="O",
     1116    25998              ERR#=%E$NOCURFOLD,STCLASS=CONSTANT);
     1117    26043        /*E*      ERROR: VMO-E$NOCURFOLD-0
     1118    26044                  MESSAGE: You currently have no folder open
     1119    26045        */
     1120    26046              %VLP_ERRCODE (FPTN=E_INPROG,FCG="VM",MID="O",
     1121    26047              ERR#=%E$INPROG,STCLASS=CONSTANT);
     1122    26092        /*E* ERROR: VMO-E$INPROG-0
     1123    26093             MESSAGE: This message is still being delivered.
     1124    26094             MESSAGE1: The MAILMAN ghost is currently moving the text of this
     1125    26095                     message into the folder.  None of the text can be accessed until
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:41   
     1126    26096                     the process is complete.  Try again later.
     1127    26097        */
     1128    26098              %VLP_ERRCODE (FPTN=E_CANTREN,FCG="VM",MID="O",
     1129    26099              ERR#=%E$CANTREN,STCLASS=CONSTANT);
     1130    26144        /*E* ERROR: VMO-E$CANTREN-0
     1131    26145             MESSAGE: Can't renumber now, MAILMAN is delivering a message.
     1132    26146        */
     1133    26147              %VLP_ERRCODE (FPTN=E_COMPACT,FCG="VM",MID="O",
     1134    26148              ERR#=%E$COMPACT,STCLASS=CONSTANT);
     1135    26193        /*E* ERROR: VMO-E$COMPACT-0
     1136    26194             MESSAGE: Compacting...
     1137    26195        */
     1138    26196              %VLP_ERRCODE (FPTN=E_RENFAILED,FCG="VM",MID="O",
     1139    26197              ERR#=%E$RENFAILED,STCLASS=CONSTANT);
     1140    26242        /*E* ERROR: VMO-E$RENFAILED-0
     1141    26243             MESSAGE: Renumber aborted
     1142    26244        */
     1143    26245              %VLP_ERRCODE (FPTN=E_CANTCOMPACT,FCG="VM",MID="O",
     1144    26246              ERR#=%E$CANTCOMPACT,STCLASS=CONSTANT);
     1145    26291        /*E* ERROR: VMO-E$CANTCOMPACT-0
     1146    26292             MESSAGE: Can't compact, file is busy or MAILMAN is delivering a message
     1147    26293        */
     1148    26294              %VLP_ERRCODE (FPTN=E_NOLIST,FCG="VM",MID="O",
     1149    26295              ERR#=%E$NOLIST,STCLASS=CONSTANT);
     1150    26340        /*E* ERROR: VMO-E$NOLIST-0
     1151    26341             MESSAGE: List does not exist.
     1152    26342        */
     1153    26343              %VLP_ERRCODE (FPTN=E_BADDOMAIN, FCG="VM", MID="O",
     1154    26344              ERR#=%E$BADDOMAIN, STCLASS=CONSTANT);
     1155    26389        /*E*  ERROR: VMO-E$BADDOMAIN-0
     1156    26390              MESSAGE: Domain %U1 is illegal.
     1157    26391        */
     1158    26392              %VLP_ERRCODE( FPTN=E_ANSBROAD,FCG="VM",MID="O",
     1159    26393              ERR#=%E$ANSBROAD,STCLASS=CONSTANT);
     1160    26438        /*E* ERROR:   VMO-E$ANSBROAD-0
     1161    26439             MESSAGE: It is not possible to ANSWER RECIEVERS a message
     1162    26440                      created with the BROADCAST option.
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:42   
     1163    26441        */
     1164    26442              %VLP_ERRCODE (FPTN=E_MEMERR,FCG="VM",MID="O",
     1165    26443              ERR#=%E$MEMERR,STCLASS=CONSTANT);
     1166    26488              %VLP_ERRCODE (FPTN=E_NEEDMID,FCG="VM",MID="O",
     1167    26489              ERR#=%E$NEEDMID,STCLASS=CONSTANT);
     1168    26534              %VLP_ERRCODE (FPTN=E_NOMORE,FCG="VM",MID="O",
     1169    26535              ERR#=%E$NOMORE,STCLASS=CONSTANT);
     1170    26580              %VLP_ERRCODE (FPTN=E_NOUPDATE,FCG="VM",MID="O",
     1171    26581              ERR#=%E$NOUPDATE,STCLASS=CONSTANT);
     1172    26626              %VLP_ERRCODE (FPTN=E_WERR,FCG="VM",MID="O",
     1173    26627              ERR#=%E$WERR,STCLASS=CONSTANT);
     1174    26672              %VLP_ERRCODE (FPTN=E_NOFILE,FCG="FM",MID="N",MON='1'B,
     1175    26673              ERR#=%E$NOFILE,STCLASS=CONSTANT);
     1176    26718              %VLP_ERRCODE (FPTN=E_BADRANGE,FCG="VM",MID="O",
     1177    26719              ERR#=%E$BADRANGE,STCLASS=CONSTANT);
     1178    26764        /*E* ERROR: VMO-E$BADRANGE
     1179    26765             MESSAGE: End of range is less than start.
     1180    26766        */
     1181    26767              %VLP_ERRCODE (FPTN=E_BIGNUM,FCG="VM",MID="O",
     1182    26768              ERR#=%E$BIGNUM,STCLASS=CONSTANT);
     1183    26813        /*E* ERROR: VMO-E$BIGNUM
     1184    26814             MESSAGE: Message number is too large.
     1185    26815        */
     1186    26816              %VLP_ERRCODE (FPTN=E_NEEDSEED,FCG="VM",MID="O",
     1187    26817              ERR#=%E$NEEDSEED,STCLASS=CONSTANT);
     1188    26862        /*E* ERROR: VMO-E$NEEDSEED
     1189    26863             MESSAGE:CRPT option must be specified for an encrypted message.
     1190    26864        */
     1191    26865              %VLP_ERRCODE (FPTN=E_DI_BADSEED,FCG="VM",MID="O",
     1192    26866              ERR#=%E$DI_BADSEED,STCLASS=CONSTANT);
     1193    26911        /*E* ERROR: VMO-E$DI_BADSEED
     1194    26912             MESSAGE:Incorrect decryption seed supplied; message body omitted.
     1195    26913        */
     1196    26914              %VLP_ERRCODE (FPTN=E_FWD_BADSEED,FCG="VM",MID="O",
     1197    26915              ERR#=%E$FWD_BADSEED,STCLASS=CONSTANT);
     1198    26960              %VLP_ERRCODE (FPTN=E_NOENCLS,FCG="VM",MID="O",
     1199    26961              ERR#=%E$NOENCLS,STCLASS=CONSTANT);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:43   
     1200    27006        /*E* ERROR: VMO-%E$NOENCLS
     1201    27007             MESSAGE:No enclosures are attached to this message.
     1202    27008        */
     1203    27009              %VLP_ERRCODE (FPTN=E_DETALLOWSONE,FCG="VM",MID="O",
     1204    27010              ERR#=%E$DETALLOWSONE,STCLASS=CONSTANT);
     1205    27055        /*E* ERROR: VMO-%E$DETALLOWSONE
     1206    27056             MESSAGE:Can't detach. Too many messages in the current context.
     1207    27057             MESSAGE1:The DETACH command operates on a single message and more
     1208    27058                       than one is in the current selection context. Set the context
     1209    27059                       using LIST, DISPLAY, or SELECT and try again.
     1210    27060        */
     1211    27061              %VLP_ERRCODE (FPTN=E_ENCLNOTFOUND,FCG="VM",MID="O",
     1212    27062              ERR#=%E$ENCLNOTFOUND,STCLASS=CONSTANT);
     1213    27107        /*E* ERROR: VMO-%E$ENCLNOTFOUND
     1214    27108             MESSAGE:Enclosure not found.
     1215    27109        */
     1216    27110              %VLP_ERRCODE (FPTN=E_ENCLDELETED,FCG="VM",MID="O",
     1217    27111              ERR#=%E$ENCLDELETED,STCLASS=CONSTANT);
     1218    27156        /*E* ERROR: VMO-%E$ENCLDELETED
     1219    27157             MESSAGE:Enclosure has already been deleted.
     1220    27158        */
     1221    27159              %VLP_ERRCODE (FPTN=E_ENCLBROKEN,FCG="VM",MID="O",
     1222    27160              ERR#=%E$ENCLBROKEN,STCLASS=CONSTANT);
     1223    27205        /*E* ERROR: VMO-%E$ENCLBROKEN
     1224    27206             MESSAGE:Wrong number of records. This enclosure may be broken.
     1225    27207             MESSAGE1: The number of enclosure records found is less than the
     1226    27208                       number specified. The data in this enclosure may be
     1227    27209                       unreliable.
     1228    27210        */
     1229    27211        /*E* ERROR: VMO-E$FWD_BADSEED
     1230    27212             MESSAGE:Incorrect decryption seed supplied.
     1231    27213        */
     1232    27214        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:44   
     1233    27215        /*
     1234    27216             ***** Initialize VM_CURRENT_FOLDER flags so
     1235    27217                   it is possible to report to mailman the
     1236    27218                   status of the current folder if we trap ...
     1237    27219        */
     1238    27220    1         VM_CURRENT_FOLDER.FLAGS = %NO#;
     1239    27221        /*
     1240    27222             ***** Reset dcbs #1 - #4
     1241    27223                   they cause problems later when M$LINKing
     1242    27224                   to other processors ...
     1243    27225        */
     1244    27226    1       IF B$JIT.PRFLAGS.SI
     1245    27227    1       THEN
     1246    27228    1           CALL M$YC (RESET_#1) ALTRET(IGNORE_YC1);
     1247    27229    1   IGNORE_YC1:
     1248    27230
     1249    27231    1       IF B$JIT.PRFLAGS.UI
     1250    27232    1       THEN
     1251    27233    1           CALL M$YC (RESET_#2) ALTRET(IGNORE_YC2);
     1252    27234    1   IGNORE_YC2:
     1253    27235
     1254    27236    1       IF B$JIT.PRFLAGS.OU
     1255    27237    1       THEN
     1256    27238    1           CALL M$YC (RESET_#3) ALTRET(IGNORE_YC3);
     1257    27239    1   IGNORE_YC3:
     1258    27240
     1259    27241    1       IF B$JIT.PRFLAGS.LS
     1260    27242    1       THEN
     1261    27243    1           CALL M$YC (RESET_#4) ALTRET(IGNORE_YC4);
     1262    27244    1   IGNORE_YC4: ;
     1263    27245
     1264    27246        /*
     1265    27247             ***** How data segments are used in mail/send/mailman ...
     1266    27248
     1267    27249                   Segments used in all modules
     1268    27250                   ----------------------------
     1269    27251                   VM_ADDLIST
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:45   
     1270    27252                      - used for building new address list (VMA$EXPAND_LIST).
     1271    27253
     1272    27254                   VM_HEADER
     1273    27255                      - used to contain the header of a message.
     1274    27256
     1275    27257                   VM_PROFILE
     1276    27258                      - used to contain the profile of a folder.
     1277    27259
     1278    27260                   VM_WORK
     1279    27261                      - used to contain list and user definitions when
     1280    27262                        expanding an address list.
     1281    27263
     1282    27264                   Segments used by only mail and send
     1283    27265                   -----------------------------------
     1284    27266                   VM_PARSEAREA
     1285    27267                      - used to contain input and parse info (XUR$GETCMD)
     1286    27268
     1287    27269                   VM_SELECT
     1288    27270                      - used to contain message selection contexts
     1289    27271                        Note: VM_SELECT shares a data segment with VM_PARSEAREA.
     1290    27272                        VM_SELECT occupies the first 1024 words and VM_PARSEAREA
     1291    27273                        the subsequent 2048 words (more if ADAPT needs memory).
     1292    27274
     1293    27275        */
     1294    27276    1       CALL VMA$ENLARGE_SEGMENT (VM_HEADER_,1024) ALTRET(E_PMME);
     1295    27277    1       CALL VMA$ENLARGE_SEGMENT (VM_PROFILE_,1024) ALTRET(E_PMME);
     1296    27278    1       CALL VMA$ENLARGE_SEGMENT (VM_ADDLIST_,1024) ALTRET(E_PMME);
     1297    27279    1       CALL VMA$ENLARGE_SEGMENT (VM_WORK_,1024) ALTRET(E_PMME);
     1298    27280    1       CALL VMA$ENLARGE_SEGMENT (VM_SELECT_,1024) ALTRET(E_PMME);
     1299    27281    1       CALL VMA$ENLARGE_SEGMENT (VM_PARSEAREA_,2048) ALTRET(E_PMME);
     1300    27282    1       VBASE(VM_PARSEAREA_) = PINCRW(VBASE(VM_PARSEAREA_),(VBOUND(VM_SELECT_)+3)/4);
     1301    27283    1       VBOUND(VM_PARSEAREA_) = VBOUND(VM_PARSEAREA_) - (VBOUND(VM_SELECT_) + 1);
     1302    27284    1       CALL VMA$OPEN_ENCL_SEGS ALTRET(E_PMME);
     1303    27285
     1304    27286        /*
     1305    27287             ***** Initilization of XUR$GETCMD data ...
     1306    27288        */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:46   
     1307    27289    1       XUR_INIT.WORK_ = VM_PARSEAREA_;
     1308    27290    1       CALL XUR$INIT(XUR_INIT,,XUG_GETCMD$)
     1309    27291    2       WHENALTRETURN DO;
     1310    27292    2           CALL M$XXX;
     1311    27293    2       END;
     1312    27294    1       CALL XUR$SETERRMSG (ERRMSG_FID) ALTRET(E_PMME);
     1313    27295        /*
     1314    27296              Setup parse nodes for users native language.
     1315    27297        */
     1316    27298
     1317    27299    1       CALL VMD$GETNODES(VM_NATL_PAIRS,NODES$,VM_NODEFID,VM_NODENAMES);
     1318    27300    1       MAIL_NODES$ = NODES_TO_USE (%PN_MAIL_NODES);
     1319    27301    1       MAIL_CMD$ = NODES_TO_USE (%PN_MAIL_CMD);
     1320    27302    1       MODIFY_LIST$ = NODES_TO_USE (%PN_MODIFY_LIST);
     1321    27303    1       MODIFY_USER$ = NODES_TO_USE (%PN_MODIFY_USER);
     1322    27304    1       SEND_CMD$ = NODES_TO_USE (%PN_SEND_CMD);
     1323    27305    1       VM_ADDRESS_SPEC$ = NODES_TO_USE (%PN_ADDRESS_SPEC);
     1324    27306
     1325    27307        /*
     1326    27308             ***** Setup command input and echo dcbs ...
     1327    27309        */
     1328    27310    1       CALL M$OPEN (OPEN_COMMAND_STREAM_DEFAULT) ALTRET(E_PMME);
     1329    27311    1       CALL XUR$SETDCBS (M$SI_NUM,M$ME_NUM);
     1330    27312    1       CALL M$XCON(SET_XCON) ALTRET(E_PMME);
     1331    27313    1       CALL M$INT (FPT_INT) ALTRET(E_PMME);
     1332    27314    1       CALL XUR$DISABLE;
     1333    27315        /*
     1334    27316             ***** Open output stream (M$LO).
     1335    27317        */
     1336    27318    1       CALL M$OPEN (OPEN_OUTPUT_STREAM_DEFAULT) ALTRET(E_PMME);
     1337    27319
     1338    27320        /*
     1339    27321             ***** Get the user name of this user ...
     1340    27322        */
     1341    27323    1       USER_NAME.L# = LENGTHC(USER_NAME.NAME#);
     1342    27324    1       CALL VMF$FROM (USER_NAME) ALTRET(E_PMME);
     1343    27325        /*
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:47   
     1344    27326             ***** Get the name of this site ...
     1345    27327        */
     1346    27328    1       KEY_VALUE='*IAM';
     1347    27329    1       CALL VMA$GET_SITE_NAME (KEY_VALUE,VM_SITENAME) ALTRET(E_PMME);
     1348    27330
     1349    27331        /*
     1350    27332             ***** Open mailcg so we can talk to mailman ...
     1351    27333        */
     1352    27334    1       CALL BINCHAR(VM_MAILCG_SETSTA.MYSTATION#,B$JIT.SYSID);
     1353    27335    1       CALL INSERT(VM_MAILCG_SETSTA.MYSTATION#,0,4,'MAIL');
     1354    27336    1       REMEMBER END_LOOP IN VMO_REMEMBER;
     1355    27337        /*
     1356    27338             ***** Setup the default search list.
     1357    27339                   Therefore, open :MAIL_CENTRAL.:MAIL
     1358    27340                   if it exists. Otherwise, an unregistered system ...
     1359    27341        */
     1360    27342    1       CALL VMA$OPEN_GLOBAL (M$MAIL_GLOBAL_NUM)
     1361    27343    1       WHENRETURN
     1362    27344    2       DO;
     1363    27345    2           VM_SEARCH_INFO.NUM_ENTRIES = 1;
     1364    27346    2           VM_SEARCH_INFO.DCB#(0) = M$MAIL_GLOBAL_NUM;
     1365    27347    2           VM_SEARCH_INFO.GLOBAL = '1'B;
     1366    27348    2       END;
     1367    27349    1       WHENALTRETURN
     1368    27350    2       DO;
     1369    27351    2           VM_SEARCH_INFO.NUM_ENTRIES = 0;
     1370    27352    2           VM_SEARCH_INFO.GLOBAL = '0'B;
     1371    27353    2       END;
     1372    27354        /*
     1373    27355             ***** Open the user's central folder ...
     1374    27356        */
     1375    27357    1       CALL VMB$FIND_DEFAULT (,USER_NAME,VM_CENTRAL_FOLDER,
     1376    27358    1         M$MAIL_CENTRAL_NUM,VM_SEARCH_INFO)
     1377    27359    2       WHENRETURN DO;
     1378    27360    2           CALL VMB$USE_DEFAULT (,USER_NAME,VM_CURRENT_FOLDER,M$MAIL_FILE_NUM,
             27360                    VM_SEARCH_INFO,,'1'B)
     1379    27361    3           WHENRETURN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:48   
     1380    27362                            /* get profile, for srch list address resolution only */
     1381    27363    3               CALL VMD$GET_PROFILE(M$MAIL_FILE_NUM)
     1382    27364    4               WHENALTRETURN DO;
     1383    27365    5                   DO INDX1=0 TO %VM_MAX_SRCH-1;
     1384    27366    5                       VM_PROFILE.SEARCH_LIST$(INDX1)=ADDR(NIL);
     1385    27367    5                   END;
     1386    27368    4               END;
     1387    27369    3               VM_RADDRESS.NOMAD.FOLDER = VM_CURRENT_FOLDER.FOLDER;
     1388    27370    3               IF VM_PROFILE.FILE_FOLDER$ ~= ADDR(NIL)
     1389    27371    3                 AND (VM_PROFILE.FILE_FOLDER$->VM$RADDRESS.FOLDER='CENTRAL')
     1390    27372    3                 AND (VM_PROFILE.FILE_FOLDER$->VM$RADDRESS.ACCT=B$JIT.ACCN)
     1391    27373    4               THEN DO;
     1392    27374    4                   VM_PROFILE.FILE_FOLDER$ = ADDR(NIL);
     1393    27375    4                   CALL VMD$PUT_PROFILE(M$MAIL_FILE_NUM);
     1394    27376    4               END;
     1395    27377    3               VM_SEARCH_INFO.CURRENT = '1'B;
     1396    27378    3               IF VM_CURRENT_FOLDER.ACCT ~= VM_MAIL_ACCT.ACCT#
     1397    27379    3                 AND VM_CURRENT_FOLDER.FOLDER ~= 'CENTRAL'
     1398    27380    3                 AND VM_SEARCH_INFO.NUM_ENTRIES > 0
     1399    27381    4               THEN DO;
     1400    27382    4                   VM_SEARCH_INFO.NUM_ENTRIES = VM_SEARCH_INFO.NUM_ENTRIES+1;
     1401    27383    4                   VM_SEARCH_INFO.DCB#(1) = VM_SEARCH_INFO.DCB#(0);
     1402    27384    4               END;
     1403    27385    3               VM_SEARCH_INFO.DCB#(0) = M$MAIL_FILE_NUM;
     1404    27386        /* Only open for command line use resolution, so make it look closed */
     1405    27387    3               VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B;
     1406    27388    3           END;
     1407    27389    3           WHENALTRETURN DO;
     1408    27390    3               VM_SEARCH_INFO.CURRENT = '0'B;
     1409    27391    3           END;
     1410    27392    2       END;
     1411    27393    1       WHENALTRETURN
     1412    27394    2       DO;
     1413    27395    2           VM_SEARCH_INFO.CURRENT = '0'B;
     1414    27396                                                /* ??? */
     1415    27397    2       END;
     1416    27398    1       IF ~ VM_SEARCH_INFO.CURRENT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:49   
     1417    27399    2       THEN DO;
     1418    27400    3           DO INDX1=0 TO %VM_MAX_SRCH-1;
     1419    27401    3               VM_PROFILE.SEARCH_LIST$(INDX1)=ADDR(NIL);
     1420    27402    3           END;
     1421    27403    2       END;
     1422    27404        /*
     1423    27405             ***** Parse the invocation line ...
     1424    27406        */
     1425    27407    1       OUTBUF = B$JIT.CCBUF;
     1426    27408    1       SIZE = B$JIT.CCARS;
     1427    27409    1       CALL XUR$GETCMD(MAIL_CMD$->BSD,OUT$,MAIL_PROMPT,OUTBUF,SIZE) ALTRET(E_INVOKE);
     1428    27410    2       DO NEVER;
     1429    27411    2   E_INVOKE:
     1430    27412    2           CALL XUR$ERRPTR;
     1431    27413    2           CALL XUR$ERRMSG (OUTERR);
     1432    27414    2           CALL M$EXIT;
     1433    27415    2       END;                            /* Do never ... end */
     1434    27416    1       CURR_COMMAND_CODE = OUT$ -> P$B.CODE;
     1435    27417        /*
     1436    27418          ***** Write greeting thru(M$ME).
     1437    27419        */
     1438    27420    1       IF B$JIT.NEXTCC = %CC_FROMUC#
     1439    27421    1       THEN                            /* Greet the user */
     1440    27422    2       DO;
     1441    27423    2           F_FDSME.NVECS# = 1;
     1442    27424    2           VECT_ARRAY(0) = VECTOR (ADDR(B_VERSION) -> B$VERSION);
     1443    27425                %INIT_STR (CODE=E_GREETING_FMT, STR=VM_GREETING_FMT,
     1444    27426                VECT="F_FDSME.FMT_" );
     1445    27449    2           CALL VMD$WRITE_BUF (F_FDSME);
     1446    27450    2       END;
     1447    27451        /*
     1448    27452             ***** Initialize the selection criteria contexts ...
     1449    27453        */
     1450    27454    1       CALL INIT_CONTEXT (%CONTEXT_CURRENT);
     1451    27455    1       CALL INIT_CONTEXT (%CONTEXT_SELECTED);
     1452    27456        /*
     1453    27457             ***** Init other variables, flags ...
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:50   
     1454    27458        */
     1455    27459    1       EXIT_MAIL# = %NO#;
     1456    27460    1       OPT_NOUPDATE = %NO#;
     1457    27461    1       OPT_BYPASS = %NO#;
     1458    27462    1       MADE_OLD = %NO#;
     1459    27463    1       DELETE_ENCL_FLAG = %NO#;
     1460    27464        /*
     1461    27465             ***** Enable breaks now ...
     1462    27466        */
     1463    27467    1       CALL XUR$CLRENABLE;
     1464    27468    1       CALL PROCESS_CMD (CURR_COMMAND_CODE);
     1465    27469        /*
     1466    27470             ***** Now prompt the user for commands ...
     1467    27471        */
     1468    27472
     1469    27473    2       DO FOREVER;
     1470    27474        /*
     1471    27475             ***** Get the next command ...
     1472    27476        */
     1473    27477    2           IF NEXT_COMMAND_TEXT.L# ~= 0 /* An internal command */
     1474    27478    2           THEN
     1475    27479    3           DO;
     1476    27480    3               INDX1 = NEXT_COMMAND_TEXT.L#;
     1477    27481    3               CALL XUR$GETCMD (MAIL_NODES$->BSD,OUT$,,NEXT_COMMAND_TEXT.NAME#,
     1478    27482    4                 INDX1) WHENALTRETURN DO;
     1479    27483    4                   CALL XUR$ECHO (M$ME_NUM);
     1480    27484    4                   NEXT_COMMAND_ECHO# = %NO#;
     1481    27485    4                   NEXT_COMMAND_TEXT.L# = 0;
     1482    27486    4                   GOTO XUR_ERROR;
     1483    27487    4               END;
     1484    27488    3               IF NEXT_COMMAND_ECHO#
     1485    27489    3               THEN
     1486    27490    3                   CALL XUR$ECHO (M$ME_NUM);
     1487    27491    3               NEXT_COMMAND_ECHO# = %NO#;
     1488    27492    3               NEXT_COMMAND_TEXT.L# = 0;
     1489    27493
     1490    27494    3           END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:51   
     1491    27495    2           ELSE
     1492    27496    3           DO;
     1493    27497        /* Check for new mail */
     1494    27498    3               IF VM_CURRENT_FOLDER.FLAGS.OPEN
     1495    27499    4               THEN DO;
     1496    27500    4                   CALL CHECK_NEW (M$MAIL_FILE_NUM);
     1497    27501    5                   IF NEW_FLAG THEN DO;
     1498    27502    5                       CALL XUR$INFOMSG (E_NEW_MESSAGE_FMT,,M$ME_NUM);
     1499    27503    5                       NEW_FLAG = '0'B;
     1500    27504    5                   END;
     1501    27505    4               END;
     1502    27506    3               CALL XUR$GETCMD(MAIL_NODES$->BSD,OUT$,MAIL_PROMPT)ALTRET(XUR_ERROR);
     1503    27507    3           END;
     1504    27508    2           IF OUT$ = ADDR(NIL) THEN GOTO END_LOOP;
     1505    27509    2           CURR_COMMAND_CODE = OUT$ -> P$B.CODE;
     1506    27510
     1507    27511    2           CALL PROCESS_CMD (CURR_COMMAND_CODE);
     1508    27512    3           DO NEVER;
     1509    27513    3   XUR_ERROR :                             /* Error parsing command */
     1510    27514    4               DO SELECT (OUTERR.ERR#);
     1511    27515
     1512    27516    4                   SELECT (%E$EOF, %E$LDSC);
     1513    27517        /*
     1514    27518             ***** If an end-of-file is found, and we were reading from a command
     1515    27519                    file (M$CMNDF is open), close the file and commence reading
     1516    27520                   from the command stream (M$SI).  If line disconnects, and we're
     1517    27521                   reading from the terminal, then act like user entered 'END'.
     1518    27522        */
     1519    27523    4                   IF DCBADDR(M$CMNDF_NUM) -> F$DCB.FCD# = %NO#
     1520    27524    4                   THEN
     1521    27525    5                   DO;   /* Exit */
     1522    27526                            %INIT_STR (CODE=E_END_CMD, STR=VM_END_CMD, NEXT_CMD=
             27526                                NEXT_COMMAND_TEXT);
     1523    27549    5                       GOTO END_LOOP;
     1524    27550    5                   END;
     1525    27551    4                   ELSE
     1526    27552    5                   DO;   /* Connect back to command stream */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:52   
     1527    27553    5                       CLOSE_SAVE.V.DCB# = M$CMNDF_NUM;
     1528    27554    5                       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     1529    27555    5                       CALL XUR$SETDCBS (M$SI_NUM);
     1530    27556    5                       IF EXIT_MAIL_PEND#
     1531    27557    6                       THEN DO;
     1532    27558    6                           EXIT_MAIL_PEND# = '0'B;
     1533    27559    6                           EXIT_MAIL# = '1'B;
     1534    27560    6                           GOTO END_LOOP;
     1535    27561    6                       END;
     1536    27562    5                   END;
     1537    27563
     1538    27564    4                   SELECT (ELSE);   /* Report the error */
     1539    27565    4               CALL XUR$ERRPTR;
     1540    27566    4               CALL XUR$ERRMSG (OUTERR);
     1541    27567    4               END;
     1542    27568    3           END;                       /* Do never ... end */
     1543    27569    2   END_LOOP:
     1544    27570        /*
     1545    27571             *****  Reset output DCB for display and list commands ...
     1546    27572        */
     1547    27573    2           F_FDSLO.DCB# = M$LO_NUM;
     1548    27574    2           IF OUTDCB ~= M$LO_NUM
     1549    27575    3           THEN DO;
     1550    27576    3               IF DCBADDR(OUTDCB) -> F$DCB.FCD#
     1551    27577    4               THEN DO;
     1552    27578    4                   CLOSE_SAVE.V.DCB# = OUTDCB;
     1553    27579    5                   CALL M$CLOSE (CLOSE_SAVE) WHENALTRETURN DO; END;
     1554    27580    4               END;
     1555    27581    3               OUTDCB = M$LO_NUM;
     1556    27582    3           END;
     1557    27583        /*
     1558    27584             ***** If EXIT_MAIL# is set and no messages have
     1559    27585                   been processed, then get out of here ...
     1560    27586        */
     1561    27587    2           IF EXIT_MAIL#
     1562    27588    2           THEN
     1563    27589    3           DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:53   
     1564    27590    3               EXIT_MAIL# = %NO#;
     1565    27591    3               IF NUM_MESSAGES_PROCESSED = 0
     1566    27592    3               THEN
     1567    27593    4               DO;
     1568    27594                        %INIT_STR (CODE=E_END_CMD, STR=VM_END_CMD, NEXT_CMD=
             27594                            NEXT_COMMAND_TEXT);
     1569    27617    4               END;
     1570    27618    3               IF OPT_NOUPDATE
     1571    27619    3               THEN
     1572    27620    4               DO;
     1573    27621                        %INIT_STR (CODE=E_END_NOUPDATE_CMD, STR=VM_END_NOUPDATE_CMD,
             27621                            NEXT_CMD=NEXT_COMMAND_TEXT);
     1574    27644    4               END;
     1575    27645    3           END;
     1576    27646    2           CALL XUR$ENABLE;
     1577    27647    2       END;                            /* Do forever */
     1578    27648    1   E_PMME:
     1579    27649    1       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     1580    27650    1       DCB# = B$TCB.ALT$ -> B$ALT.DCB#;
     1581    27651    1       CALL XUR$ERRMSG (ERROR,DCB#);
     1582    27652        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:54   
     1583    27653        /********************************************************************/
     1584    27654        /*F*    NAME:        PROCESS_CMD
     1585    27655                PURPOSE:     To process all MAIL commands.
     1586    27656                DESCRIPTION: This routine processes all MAIL commands.
     1587    27657                             The command to be processed is in CURR_COMMAND_CODE.
     1588    27658                             If there are any options for this command then
     1589    27659                             OUT$ will be non-nil. If there are no options
     1590    27660                             specified then use any options remaining from
     1591    27661                             previous commands. This mainly applies only to
     1592    27662                             SELECTION CLAUSES.
     1593    27663        */
     1594    27664        /********************************************************************/
     1595    27665    1   PROCESS_CMD: PROC (CURR_COMMAND_CODE);
     1596    27666
     1597    27667    2   DCL CURR_COMMAND_CODE UBIN WORD;
     1598    27668        /*
     1599    27669             ***** Initialization needed for each command ...
     1600    27670        */
     1601    27671    2       WHICH_CONTEXT = %CONTEXT_CURRENT; /* Default context to use */
     1602    27672    2       CURRENT_CONTEXT%.SET_INDX = -1;
     1603    27673    2       SELECTED_CONTEXT%.SET_INDX = -1;
     1604    27674    2       NEED_TITLE_BAR = %YES#;
     1605    27675        /*
     1606    27676             ***** Process the command ...
     1607    27677        */
     1608    27678    3       DO CASE(CURR_COMMAND_CODE);       /* Command number */
     1609    27679        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:55   
     1610    27680        /* Acknowledge command */
     1611    27681    3       CASE (%CMD_ACKNOWLEDGE_MESSAGE);
     1612    27682    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     1613    27683
     1614    27684    3           IF OUT$ -> P$B.NSUBLKS > 0
     1615    27685    3           THEN                       /* There are options */
     1616    27686    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_ACKNOWLEDGE_MESSAGE)
             27686                        ALTRET(CONTINUE);
     1617    27687    3           CALL FIX_CONTEXT;
     1618    27688    3           INDX1 = 0;
     1619    27689        /*
     1620    27690             ***** Acknowledge all the messages ...
     1621    27691        */
     1622    27692    4           DO FOREVER;
     1623    27693    4               CALL GET$MESSAGE ALTRET(END_ACK);
     1624    27694    4               CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);
     1625    27695    4               CALL DO$ACK (%YES#) ALTRET(E_PMME);
     1626    27696    4               INDX1 = INDX1 + 1;
     1627    27697    4           END;                       /* Do forever ... end */
     1628    27698    3   END_ACK:
     1629    27699    3           IF INDX1 = 0
     1630    27700    3           THEN
     1631    27701    3               CALL REPORT_ACTIVITY (INDX1,VM_NO_MESSAGE_FMT,%YES#,E_NO_MESSAGE_FMT);
     1632    27702        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:56   
     1633    27703        /* Answer command */
     1634    27704    3       CASE (%CMD_ANSWER_MESSAGE);
     1635    27705    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     1636    27706
     1637    27707    3           IF OUT$ -> P$B.NSUBLKS > 0
     1638    27708    3           THEN                       /* There are options */
     1639    27709    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_ANSWER_MESSAGE) ALTRET(
             27709                        CONTINUE);
     1640    27710    3           CALL FIX_CONTEXT;
     1641    27711    3           INDX1 = 0;                  /* Used as counter */
     1642    27712        /*
     1643    27713            ***** Determine if 'RECEIVERS' was specified. (default = no)
     1644    27714        */
     1645    27715    3           OPT_RECEIVERS = VM_PROFILE.OPT.ANS_RECEIVERS;
     1646    27716    3           IF OUT$ -> P$B.NSUBLKS > 1
     1647    27717    3           THEN                       /* Receivers or sender specified */
     1648    27718    4           DO CASE (OUT$ -> P$B.SUBLK$(1) -> P$B.CODE);
     1649    27719    4           CASE (%OPT_RECEIVERS);
     1650    27720    4               OPT_RECEIVERS = %YES#;
     1651    27721    4           CASE (%OPT_SENDER);
     1652    27722    4               OPT_RECEIVERS = %NO#;
     1653    27723    4           END;                   /* Do case ... end */
     1654    27724        /*
     1655    27725             ***** Build the command buffer to pass to send ...
     1656    27726        */
     1657    27727                %INIT_STR (CODE=E_SEND_ANSWER, STR=VM_SEND_ANSWER, TEST=YES);
     1658    27750    3           CALL BUILD_LINK_TO_SEND_CMD (VM_SEND_ANSWER);
     1659    27751        /*
     1660    27752             ***** Acknowledge all the messages ...
     1661    27753        */
     1662    27754    4           DO FOREVER;
     1663    27755    4               CALL GET$MESSAGE ALTRET(END_ANSWER);
     1664    27756    4               CALL M$OPEN (OPEN_SEND_FILE) ALTRET(E_PMME);
     1665    27757    4               CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);
     1666    27758    4               if OPT_RECEIVERS='1'b and VM_HEADER.STATUS.BROADCAST='1'b then
     1667    27759    5               do;
     1668    27760    5                   CALL XUR$ERRMSG (E_ANSBROAD);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:57   
     1669    27761    5                   goto E_ANSWER;
     1670    27762    5               end;
     1671    27763    4               CALL VME$ANSWER (CURRENT_MESSAGE_NUMBER,USER_NAME,
     1672    27764    4                 OPT_RECEIVERS) ALTRET(E_ANSWER);
     1673    27765    4               CLOSE_SAVE.V.DCB# = M$WORK_NUM;
     1674    27766    4               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     1675    27767    4               CALL LINK_RUNIT
     1676    27768    4               WHENRETURN
     1677    27769    5               DO;
     1678    27770    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,
     1679    27771    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     1680    27772    5               END;
     1681    27773    4               WHENALTRETURN
     1682    27774    5               DO;
     1683    27775    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,
     1684    27776    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     1685    27777    5                   GOTO END_ANSWER;
     1686    27778    5               END;
     1687    27779    5               DO NEVER;
     1688    27780    5   E_ANSWER:                               /* Cleanup */
     1689    27781    5                   CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;
     1690    27782    5                   CALL M$CLOSE (CLOSE_SCRATCH) ALTRET(E_PMME);
     1691    27783    5               END;                  /* Do never ... end */
     1692    27784    4               INDX1 = INDX1 + 1;
     1693    27785    4           END;                       /* Do forever ... end */
     1694    27786    3   END_ANSWER:
     1695    27787    3           IF INDX1 = 0
     1696    27788    3           THEN
     1697    27789    3               CALL REPORT_ACTIVITY (INDX1,VM_NO_MESSAGE_FMT,%YES#,E_NO_MESSAGE_FMT);
     1698    27790        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:58   
     1699    27791        /* Null command.  Look for <lf> and <eod> */
     1700    27792    3       CASE(%CMD_BLANK);
     1701    27793    3           if dcbaddr(M$CMNDF_NUM)->F$DCB.FCD# = '1'B
     1702    27794    3           then substr(NEXT_COMMAND_TEXT.NAME#,2,1) = dcbaddr(M$CMNDF_NUM)->F$DCB.
             27794                    EOMCHAR#;
     1703    27795    3           else substr(NEXT_COMMAND_TEXT.NAME#,2,1) = dcbaddr(M$SI_NUM   )->F$DCB.
             27795                    EOMCHAR#;
     1704    27796
     1705    27797    3           if substr(NEXT_COMMAND_TEXT.NAME#,2,1) = BITASC('012'O) /* Lf */
     1706    27798    4           THEN DO;
     1707    27799                    %INIT_STR (CODE=E_NEXT_CMD, STR=VM_NEXT_CMD, NEXT_CMD=NEXT_COMMAND_TEXT,
             27799                        TEST=YES);
     1708    27822    4           END;
     1709    27823    3           else
     1710    27824    3               if substr(NEXT_COMMAND_TEXT.NAME#,2,1) = BITASC('004'O) /* Eod */
     1711    27825    4               then do;
     1712    27826                        %INIT_STR (CODE=E_PREVIOUS_CMD, STR=VM_PREVIOUS_CMD, NEXT_CMD=
             27826                            NEXT_COMMAND_TEXT, TEST=YES);
     1713    27849    4               END;
     1714    27850                                                /* Otherwise do nothing */
     1715    27851        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:59   
     1716    27852        /* Copy and move commands */
     1717    27853    3       CASE (%CMD_COPY_MESSAGE);
     1718    27854    3           CALL NEED_FOLDER ALTRET(CONTINUE);
     1719    27855    3           GOTO COPY_MOVE;
     1720    27856    3       CASE (%CMD_MOVE_MESSAGE);
     1721    27857    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     1722    27858    3   COPY_MOVE:
     1723    27859
     1724    27860    3           INDX1 = 0;                  /* Number of messages moved */
     1725    27861    3           INDX2 = 0;             /* Number of messages marked for deletion */
     1726    27862    3           IF NOT VM_SEARCH_INFO.ACTIVE THEN CALL VMA$OPEN_SRCH_LIST(VM_SEARCH_INFO);
     1727    27863    3           IF OUT$->P$B.NSUBLKS > 1
     1728    27864    4           THEN DO;
     1729    27865    4               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_COPY_MESSAGE) ALTRET(
             27865                        CONTINUE);
     1730    27866    4           END;
     1731    27867        /*
     1732    27868            ***** Set break type so that break control routine can perform cleanup
     1733    27869            ***** in case a break is hit.
     1734    27870        */
     1735    27871    3           FOLDER_WAS_OPEN = %YES#;
     1736    27872    3           BREAK_TYPE = CURR_COMMAND_CODE;
     1737    27873        /*
     1738    27874             ***** Open the destination ...
     1739    27875        */
     1740    27876    3           IF OUT$->P$B.NSUBLKS = 1
     1741    27877    4           THEN DO;
     1742    27878    4               CALL VMB$USE_SPECIFIED (OUT$->P$B.SUBLK$(0),USER_NAME,
     1743    27879    4                 VM_WORK_FOLDER,M$WORK_NUM,
     1744    27880    4                 VM_SEARCH_INFO,%UPDATE#) ALTRET(CANT_COPY);
     1745    27881    4           END;
     1746    27882    4           ELSE DO;
     1747    27883    4               CALL VMB$USE_SPECIFIED (OUT$->P$B.SUBLK$(1),
     1748    27884    4                 USER_NAME,VM_WORK_FOLDER,M$WORK_NUM,VM_SEARCH_INFO,
     1749    27885    4                 %UPDATE#) ALTRET(CANT_COPY);
     1750    27886    4           END;
     1751    27887    3           IF VM_WORK_FOLDER.FLAGS.UPDATE = %NO#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:60   
     1752    27888    4           THEN DO;
     1753    27889    4               CALL XUR$ERRMSG(E_NOTALLOW);
     1754    27890    4               GOTO CANT_COPY;
     1755    27891    4           END;
     1756    27892        /*
     1757    27893             ***** Stash the profile for the current folder and
     1758    27894                   get the profile for the destination folder ...
     1759    27895        */
     1760    27896    3           PRINT_HEADER# = VM_PROFILE.OPT.HEADERS;
     1761    27897    3           IF VM_CURRENT_FOLDER.FLAGS.UPDATE = %YES#
     1762    27898    3           THEN
     1763    27899    3               CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(E_PMME);
     1764    27900    3           VM_CURRENT_FOLDER.FLAGS.OPEN = %NO#; /* This keeps
     1765    27901                                           a bad profile record being written if we get
     1766    27902                                           ctl-y or otherwise xconed. */
     1767    27903    3           CALL VMD$GET_PROFILE (M$WORK_NUM) ALTRET(E_COPY);
     1768    27904        /*
     1769    27905             ***** Now move the messages ...
     1770    27906        */
     1771    27907    3           ENQ_PROFILE.V.DCB# = M$WORK_NUM;
     1772    27908    3           DEQ_PROFILE.V.DCB# = M$WORK_NUM;
     1773    27909    4           DO FOREVER;
     1774    27910    4               CALL M$ENQ (ENQ_PROFILE);
     1775    27911    4               CALL VMD$GET_PROFILE(M$WORK_NUM) ALTRET(E_COPY);
     1776    27912    4               CALL GET$MESSAGE ALTRET(END_COPY);
     1777    27913        /*
     1778    27914             ***** Display the header of the message if necessary ...
     1779    27915        */
     1780    27916    4               IF PRINT_HEADER#
     1781    27917    4               THEN
     1782    27918    4                   CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);
     1783    27919    4               CALL XUR$DISABLE;
     1784    27920    4               INDX1 = INDX1 + 1;
     1785    27921    4               COMBINED = %YES#;
     1786    27922    4               CALL VMM$COMBINE_MESSAGE (M$MAIL_FILE_NUM, CURRENT_MESSAGE_NUMBER,
             27922                        M$WORK_NUM)
     1787    27923    5               WHENALTRETURN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:61   
     1788    27924    5                   COMBINED = %NO#;
     1789    27925    5               END;
     1790    27926    4               CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER, M$MAIL_FILE_NUM);
     1791    27927    4               IF NOT COMBINED OR NOT VM_PROFILE.OPT.COMBINE
     1792    27928    4                 OR NOT (VM_HEADER.STATUS.ACK OR VM_HEADER.STATUS.RRACK
     1793    27929    4                 OR VM_HEADER.STATUS.DELIVERY)
     1794    27930    5               THEN DO;
     1795    27931    5                   VM_PROFILE.HI_MESSAGE_NUMBER = VM_PROFILE.HI_MESSAGE_NUMBER + 1;
     1796    27932    5                   VM_PROFILE.NUM_MESSAGES = VM_PROFILE.NUM_MESSAGES + 1;
     1797    27933    5                   IF CURR_COMMAND_CODE = %CMD_COPY_MESSAGE
     1798    27934    5                   THEN
     1799    27935    5                       VM_HEADER.STATUS.RR = %NO#;
     1800    27936    5                   VM_HEADER.STATUS.DEL = %NO#;
     1801    27937    5                   IF VM_HEADER.STATUS.MAKE_OLD
     1802    27938    6                   THEN DO;
     1803    27939    6                       VM_HEADER.STATUS.OLD = %YES#;
     1804    27940    6                       VM_HEADER.STATUS.MAKE_OLD = %NO#;
     1805    27941    6                   END;
     1806    27942    5                   IF NOT VM_HEADER.STATUS.OLD
     1807    27943    5                   THEN
     1808    27944    5                       VM_PROFILE.NUM_NEW_MESSAGES = VM_PROFILE.NUM_NEW_MESSAGES + 1;
     1809    27945    5                   CALL VMM$COPY_MESSAGE (CURRENT_MESSAGE_NUMBER, VM_PROFILE.
             27945                            HI_MESSAGE_NUMBER, M$MAIL_FILE_NUM, M$WORK_NUM) ALTRET (E_COPY);
     1810    27946    5               END;
     1811    27947        /*
     1812    27948             ***** If move command, then delete the current message ...
     1813    27949        */
     1814    27950    4               IF CURR_COMMAND_CODE = %CMD_MOVE_MESSAGE
     1815    27951    4               THEN
     1816    27952    5               DO;              /* Special move processing */
     1817    27953    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,
     1818    27954    5                     M$MAIL_FILE_NUM) ALTRET(E_COPY);
     1819    27955    5                   IF VM_HEADER.STATUS.DEL = %NO#
     1820    27956    5                   THEN      /* Not yet marked for deletion */
     1821    27957    6                   DO;   /* Mark for deletion */
     1822    27958    6                       VM_HEADER.STATUS.DEL = %YES#;
     1823    27959    6                       CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:62   
     1824    27960    6                         M$MAIL_FILE_NUM) ALTRET(E_COPY);
     1825    27961    6                       INDX2 = INDX2 + 1;
     1826    27962    6                   END;
     1827    27963    5               END;             /* Special move processing */
     1828    27964                  /* write profile and deq to give mailman a change to deliver, just
     1829    27965                     in case he's been waiting */
     1830    27966    4               CALL VMD$PUT_PROFILE(M$WORK_NUM) ALTRET(E_COPY);
     1831    27967    4               CALL M$DEQ (DEQ_PROFILE) ALTRET (E_COPY);
     1832    27968    4               CALL XUR$ENABLE;
     1833    27969    4           END;                       /* Do forever ... end */
     1834    27970        /*
     1835    27971             ***** Update the profile in the destination folder ...
     1836    27972        */
     1837    27973    3   END_COPY:
     1838    27974        /*
     1839    27975             ***** Report how many messages were copied or moved ...
     1840    27976        */
     1841    27977    3           CALL REPORT_ACTIVITY (INDX1,VM_MSGS_COPIED_FMT,%YES#,E_MSGS_COPIED_FMT);
     1842    27978    3           IF INDX2 > 0
     1843    27979    4           THEN DO;         /* Tell how many messages marked for deletion */
     1844    27980    4               CALL REPORT_ACTIVITY (INDX2,VM_MSGS_DELETED_FMT,%YES#,E_MSGS_DELETED_FMT
             27980                        );
     1845    27981    4           END;
     1846    27982        /*
     1847    27983             ***** Report any unexpected error ...
     1848    27984        */
     1849    27985    4           DO NEVER;
     1850    27986    4   E_COPY:
     1851    27987    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     1852    27988    4               CALL XUR$ERRMSG(ERROR,M$WORK_NUM);
     1853    27989    4               CALL XUR$ERRMSG(E_FOLDEROLD,M$WORK_NUM);
     1854    27990    4           END;
     1855    27991    3   CANT_COPY:
     1856    27992        /*
     1857    27993             ***** Make sure the destination folder is closed ...
     1858    27994        */
     1859    27995    3           IF DCBADDR(M$WORK_NUM) -> F$DCB.FCD#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:63   
     1860    27996    4           THEN DO;
     1861    27997    4               CLOSE_SAVE.V.DCB# = M$WORK_NUM;
     1862    27998    4               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     1863    27999    4           END;
     1864    28000    3           VM_WORK_FOLDER.FLAGS.OPEN = %NO#;
     1865    28001        /*
     1866    28002             ***** Restore the profile for the current folder ...
     1867    28003        */
     1868    28004    3           CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);
     1869    28005    3           VM_PROFILE.NUM_DEL_MESSAGES = VM_PROFILE.NUM_DEL_MESSAGES + INDX2;
     1870    28006        /*
     1871    28007             ***** Reset special break controls ...
     1872    28008        */
     1873    28009    3           BREAK_TYPE = 0;
     1874    28010    3           VM_CURRENT_FOLDER.FLAGS.OPEN = %YES#;
     1875    28011        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:64   
     1876    28012        /* Count command */
     1877    28013    3       CASE (%CMD_COUNT_MESSAGE);
     1878    28014    3           CALL NEED_FOLDER ALTRET(CONTINUE);
     1879    28015    3           IF OUT$ -> P$B.NSUBLKS > 0
     1880    28016    3           THEN                       /* There are options */
     1881    28017    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_COUNT_MESSAGE) ALTRET(
             28017                        CONTINUE);
     1882    28018    3           INDX1 = 0;
     1883    28019
     1884    28020    4           DO FOREVER;
     1885    28021
     1886    28022    4               CALL GET$MESSAGE ALTRET(END_COUNT);
     1887    28023    4               INDX1 = INDX1 + 1;
     1888    28024    4           END;                       /* Do forever */
     1889    28025    3   END_COUNT:
     1890    28026    3           CALL REPORT_ACTIVITY (INDX1,VM_COUNT_FMT,%YES#,E_COUNT_FMT);
     1891    28027        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:65   
     1892    28028        /* Create folder command */
     1893    28029    3       CASE(%CMD_CREATE_FOLDER);
     1894    28030    3           CALL XUR$DISABLE;
     1895    28031        /*
     1896    28032             ***** Initialize the address variables ...
     1897    28033        */
     1898    28034    3           VM_RADDRESS.ACCT = VM_CENTRAL_FOLDER.ACCT;
     1899    28035    3           VM_RADDRESS.FOLDER = VM_CENTRAL_FOLDER.FOLDER;
     1900    28036    3           VM_RADDRESS.PASS = ' ';
     1901    28037    3           VM_RADDRESS.SITENAME = ' ';
     1902    28038                                                /*
     1903    28039                       ***** Repeat this loop once for each piece of the address ...
     1904    28040                       */
     1905    28041    3           IF OUT$ -> P$B.NSUBLKS > 0
     1906    28042    3           THEN
     1907    28043    4           DO;
     1908    28044    4               BLK$ = OUT$ -> P$B.SUBLK$(0);
     1909    28045    5               DO INDX1 = 0 TO BLK$ -> P$B.NSUBLKS - 1;
     1910    28046    5                   PTR1$ = BLK$ -> P$B.SUBLK$(INDX1);
     1911    28047    6                   DO CASE (PTR1$ -> P$B.CODE);
     1912    28048    6                   CASE (%ADD_ACCT);
     1913    28049    6                       VM_RADDRESS.ACCT = PTR1$ -> P$S.TEXT;
     1914    28050    6                   CASE (%ADD_FOLDER);
     1915    28051    6                       VM_RADDRESS.FOLDER = PTR1$ -> P$S.TEXT;
     1916    28052    6                   CASE (%ADD_NAME);
     1917    28053    6                       CALL XUR$ERRMSG (E_NAMENTALLOWED);
     1918    28054    6                       GOTO CONTINUE;
     1919    28055    6                   CASE (%ADD_PASS);
     1920    28056    6                       VM_RADDRESS.PASS = PTR1$ -> P$S.TEXT;
     1921    28057    6                   END;       /* Do case ... end */
     1922    28058    5               END;             /* Do INDX1 = ... end */
     1923    28059    4           END;
     1924    28060        /*
     1925    28061             ***** Now create the folder ...
     1926    28062        */
     1927    28063    3           VM_WORK_FOLDER.FLAGS = %NO#;
     1928    28064    3           CALL VMA$OPEN_FOLDER (VM_WORK_FOLDER,ADDR(VM_RADDRESS),
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:66   
     1929    28065    3             M$WORK_NUM,%ERROR#,%CREATE#) ALTRET(CANT_CREATE_FOLDER);
     1930    28066    3           VM_WORK_FOLDER.FLAGS.FOLDER_SPEC = '1'B;
     1931    28067    3           VM_WORK_FOLDER.SITENAME=' ';
     1932    28068    3           WORK_STRING.L#=SIZEC(WORK_STRING.NAME#);
     1933    28069    3           CALL GET_FOLDERNAME (VM_WORK_FOLDER);
     1934    28070    3           CALL XUR$INFOMSG (E_CREATE_MSG_FMT,, M$ME_NUM,VECTOR(WORK_STRING));
     1935    28071        /*
     1936    28072             ***** Give this folder a profile.
     1937    28073                   First store away our current profile,
     1938    28074                   reset important fields, write this profile
     1939    28075                   into the newly created folder, and then get
     1940    28076                   back the profile for our current folder ...
     1941    28077        */
     1942    28078    3           IF VM_CURRENT_FOLDER.FLAGS.UPDATE
     1943    28079    3           THEN                       /* Ok to stash profile */
     1944    28080    3               CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(E_PMME);
     1945    28081    3           VM_PROFILE = CVM_PROFILE;
     1946    28082    3           VM_PROFILE.FREE$ = ADDR(NIL);
     1947    28083    3           VM_PROFILE.NEXT$ = ADDR(VM_PROFILE.WORK_AREA);
     1948    28084    3           CALL CONCAT (VM_PROFILE.NAME_KEY,B$JIT.ACCN,B$JIT.UNAME);
     1949    28085                %INIT_STR (CODE=E_MAIL_SETUP, STR=VM_MAIL_SETUP, TEST=YES);
     1950    28108    3           VM_PROFILE.SETUP.COUNT = VM_MAIL_SETUP.L#;
     1951    28109    3           VM_PROFILE.SETUP.TEXT = VM_MAIL_SETUP.NAME#;
     1952    28110    3           CALL VMD$PUT_PROFILE (M$WORK_NUM) ALTRET(E_PMME);
     1953    28111        /*
     1954    28112             ***** Close the file with disp=save so that the
     1955    28113                   file will be entered into the catalog. ...
     1956    28114        */
     1957    28115    3           CLOSE_SAVE.V.DCB# = M$WORK_NUM;
     1958    28116    3           CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     1959    28117        /**/
     1960    28118    4           DO NEVER;
     1961    28119    4   CANT_CREATE_FOLDER:
     1962    28120    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     1963    28121    4               CALL XUR$ERRMSG(E_CRFERR);
     1964    28122    4               CALL XUR$ERRMSG (ERROR,M$WORK_NUM);
     1965    28123    4           END;                       /* Do never ... end */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:67   
     1966    28124        /*
     1967    28125             ***** Get profile for the current folder back ...
     1968    28126        */
     1969    28127    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN
     1970    28128    3           THEN                       /* A folder is open */
     1971    28129    3               CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);
     1972    28130        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:68   
     1973    28131        /* Create list command */
     1974    28132    3       CASE(%CMD_CREATE_LIST);
     1975    28133    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     1976    28134        /*E*    ERROR: VMO-E$LISTEXISTS-0
     1977    28135                MESSAGE: List %U1 already exists.
     1978    28136        */
     1979    28137        /*
     1980    28138             ***** Repeat this loop once for each list name defined ...
     1981    28139        */
     1982    28140    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;
     1983    28141    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);
     1984    28142        /*
     1985    28143             ***** Check if a list with this name exists ...
     1986    28144        */
     1987    28145    4               VM_LISTKEY.TEXT = BLK$ -> P$B.SUBLK$(0) -> P$S.TEXT;
     1988    28146    4               CALL VMA$GET_LIST (VM_LISTKEY,VM_ADDLIST$,
     1989    28147    4                 M$MAIL_FILE_NUM) ALTRET(E_CRLIST1);
     1990    28148        /*
     1991    28149             ***** It does exist...
     1992    28150                   Bug!!!
     1993    28151        */
     1994    28152    4               CALL XUR$ERRMSG (E_LISTEXISTS,,,
     1995    28153    4                 VECTOR(BLK$->P$B.SUBLK$(0)->P$S.TEXTC$->X$STRING));
     1996    28154    4               GOTO CREATE_LIST_END;
     1997    28155        /*
     1998    28156             ***** If attempting to create a global list,
     1999    28157                   first check to see if a user with this
     2000    28158                   name already exists. If so, then error ...
     2001    28159        */
     2002    28160    4   E_CRLIST1:  ;
     2003    28161    4               FPT_CORRES.V.DCB1# = M$MAIL_FILE_NUM;
     2004    28162    4               FPT_CORRES.V.DCB2# = M$MAIL_GLOBAL_NUM;
     2005    28163    4               CALL M$CORRES (FPT_CORRES) ALTRET(E_CRLIST2);
     2006    28164    4               GOTO E_CRLIST3;       /* Not same file */
     2007    28165    4   E_CRLIST2:  ;
     2008    28166    4               VM_USERKEY.TEXT = VM_LISTKEY.TEXT;
     2009    28167    4               CALL VMA$GET_LIST (VM_USERKEY,VM_ADDLIST$,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:69   
     2010    28168    4                 M$MAIL_FILE_NUM) ALTRET(E_CRLIST3);
     2011    28169        /*
     2012    28170             ***** It does exist...
     2013    28171                   Bug!!!
     2014    28172        */
     2015    28173    4               CALL XUR$ERRMSG (E_USEREXISTS,,,
     2016    28174    4                 VECTOR(BLK$->P$B.SUBLK$(0)->P$S.TEXTC$->X$STRING));
     2017    28175    4               GOTO CREATE_LIST_END;
     2018    28176        /*
     2019    28177             ***** Ok to create the list ...
     2020    28178        */
     2021    28179    4   E_CRLIST3:  ;
     2022    28180        /*
     2023    28181             ***** Initialize VM_ADD_HEAD ...
     2024    28182        */
     2025    28183    4               VM_ADD_HEAD.NUM_ENTRIES = 0;
     2026    28184        /*
     2027    28185             ***** Repeat this loop once for each address in the definition ...
     2028    28186        */
     2029    28187    5               DO INDX2 = 1 TO BLK$ -> P$B.NSUBLKS - 1;
     2030    28188    5                   PTR2$ = BLK$ -> P$B.SUBLK$(INDX2);
     2031    28189        /*
     2032    28190             ***** Initialize the address variables ...
     2033    28191        */
     2034    28192    5                   ADDRESS_ACCT.ACCT# = ' ';
     2035    28193    5                   ADDRESS_NAME.L# = 0;
     2036    28194    5                   ADDRESS_NAME.NAME# = ' ';
     2037    28195    5                   ADDRESS_FOLDER = ' ';
     2038    28196    5                   ADDRESS_PASS.PASS# = ' ';
     2039    28197    5                   ADDRESS_SITENAME = ' ';
     2040    28198    5                   DOMAIN$ = ADDR(NIL);
     2041    28199                                                /*
     2042    28200                       ***** Repeat this loop once for each piece of the address ...
     2043    28201                       */
     2044    28202    6                   DO INDX3 = 0 TO PTR2$ -> P$B.NSUBLKS - 1;
     2045    28203    6                       PTR3$ = PTR2$ -> P$B.SUBLK$(INDX3);
     2046    28204    7                       DO CASE (PTR3$ -> P$B.CODE);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:70   
     2047    28205    7                       CASE (%ADD_ACCT);
     2048    28206    7                           ADDRESS_ACCT.ACCT# = PTR3$ -> P$S.TEXT;
     2049    28207    7                       CASE (%ADD_FOLDER);
     2050    28208    7                           ADDRESS_FOLDER = PTR3$ -> P$S.TEXT;
     2051    28209    7                       CASE (%ADD_NAME);
     2052    28210    7                           ADDRESS_NAME.NAME# = PTR3$ -> P$S.TEXT;
     2053    28211    7                           ADDRESS_NAME.L# = PTR3$ -> P$S.COUNT;
     2054    28212    7                       CASE (%ADD_PASS);
     2055    28213    7                           ADDRESS_PASS.PASS# = PTR3$ -> P$S.TEXT;
     2056    28214    7                       CASE (%ADD_SITE);
     2057    28215    7                           ADDRESS_SITENAME = PTR3$ -> P$S.TEXT;
     2058    28216    7                       CASE (%ADD_DOMAIN);
     2059    28217    7                           DOMAIN$ = PTR3$;
     2060    28218    7                       END;      /* Do case ... end */
     2061    28219    6                   END;            /* Do INDX3 = ... end */
     2062    28220    5                   CALL TRANSFORM_DOMAIN (DOMAIN$, ADDRESS_SITENAME, ADDRESS_NAME)
     2063    28221    5                     ALTRET (CREATE_LIST_END);
     2064    28222        /*
     2065    28223             ***** Add this entry to the address list ...
     2066    28224        */
     2067    28225    5                   IF ADDRESS_ACCT.ACCT# = ' '
     2068    28226    5                     AND ADDRESS_NAME.NAME# = ' '
     2069    28227    5                   THEN           /* Fill in default */
     2070    28228    6                   DO;
     2071    28229    6                       IF SUBSTR(USER_NAME.NAME#,0,1) = '.'
     2072    28230    6                       THEN /* User is not registered */
     2073    28231    7                       DO;
     2074    28232    7                           ADDRESS_ACCT.ACCT# = SUBSTR(USER_NAME.NAME#,1);
     2075    28233    7                           ADDRESS_NAME.L# = 0;
     2076    28234    7                       END;
     2077    28235    6                       ELSE /* User is registered */
     2078    28236    7                       DO;
     2079    28237    7                           ADDRESS_NAME.L# = USER_NAME.L#;
     2080    28238    7                           ADDRESS_NAME.NAME# = USER_NAME.NAME#;
     2081    28239    7                       END;
     2082    28240    6                   END;
     2083    28241    5                   IF ADDRESS_NAME.L# ~= 0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:71   
     2084    28242    5                   THEN           /* Store as unresolved address */
     2085    28243    6                   DO;
     2086    28244    6                       CALL VMA$ADD_UENTRY_SORTED (ADDRESS_NAME,ADDRESS_FOLDER,
     2087    28245    6                         ADDRESS_PASS,ADDRESS_SITENAME) ALTRET(E_PMME);
     2088    28246    6                   END;
     2089    28247    5                   ELSE           /* Store as resolved address */
     2090    28248    6                   DO;
     2091    28249    6                       CALL VMA$ADD_RENTRY_SORTED (ADDRESS_ACCT,ADDRESS_FOLDER,
     2092    28250    6                         ADDRESS_PASS,ADDRESS_SITENAME) ALTRET(E_PMME);
     2093    28251    6                   END;
     2094    28252    5               END;                  /* Do INDX2 = ... End */
     2095    28253        /*
     2096    28254             ***** Store the completed list ...
     2097    28255        */
     2098    28256    4               CALL VMA$PUT_LIST (VM_LISTKEY,VM_ADDLIST$,
     2099    28257    4                 M$MAIL_FILE_NUM) ALTRET(E_PMME);
     2100    28258    4   CREATE_LIST_END:
     2101    28259    4           END;                       /* Do INDX1 = ... end */
     2102    28260        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:72   
     2103    28261        /* Create user command */
     2104    28262    3       CASE(%CMD_CREATE_USER);
     2105    28263        /*
     2106    28264             ***** A user definition consists of two parts:
     2107    28265                   1) a definition of where the user's mailbox resides.
     2108    28266                   2) the logon (accn,uname) that uniquely identifies this user.
     2109    28267
     2110    28268                   The first part is stored just as a list definition,
     2111    28269                   except for a different key to identify it as a user
     2112    28270                   rather than a list. The second part is stored in a
     2113    28271                   seperate file, i.e. :NAME.:MAIL ...
     2114    28272
     2115    28273                   The address spec (part one) is stored in the global
     2116    28274                   folder. The user must use this folder in order to
     2117    28275                   create a user definition. Otherwise, error!!!
     2118    28276        */
     2119    28277        /*E*    ERROR: VMO-E$USEREXISTS-0
     2120    28278                MESSAGE: User %U1 already exists.
     2121    28279        */
     2122    28280    3           CALL NEED_GLOBAL ALTRET(CONTINUE);
     2123    28281        /*
     2124    28282             ***** Check if this user already exists ...
     2125    28283        */
     2126    28284    3           VM_USERKEY.TEXT = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;
     2127    28285        /*
     2128    28286             First see if the name is blank, blow him away is it is
     2129    28287        */
     2130    28288    3           IF VM_USERKEY.TEXT = ' '
     2131    28289    4           THEN DO;
     2132    28290    4               CALL XUR$ERRMSG(E_BLANKUSER);
     2133    28291    4               GOTO CONTINUE;
     2134    28292    4           END;
     2135    28293    3           CALL VMA$GET_LIST (VM_USERKEY,VM_ADDLIST$,
     2136    28294    3             M$MAIL_FILE_NUM) ALTRET(E_CRUSER1);
     2137    28295        /*
     2138    28296             ***** It does exist...
     2139    28297                   Bug!!!
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:73   
     2140    28298        */
     2141    28299    3           CALL XUR$ERRMSG (E_USEREXISTS,,,
     2142    28300    3             VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXTC$->X$STRING));
     2143    28301    3           GOTO CREATE_USER_END2;
     2144    28302    3   E_CRUSER1: ;
     2145    28303        /*
     2146    28304             ***** Check if a list with this name exists ...
     2147    28305        */
     2148    28306    3           VM_LISTKEY.TEXT = VM_USERKEY.TEXT;
     2149    28307    3           CALL VMA$GET_LIST (VM_LISTKEY,VM_ADDLIST$,
     2150    28308    3             M$MAIL_FILE_NUM) ALTRET(E_CRUSER2);
     2151    28309        /*
     2152    28310             ***** It does exist...
     2153    28311                   Bug!!!
     2154    28312        */
     2155    28313    3           CALL XUR$ERRMSG (E_LISTEXISTS,,,
     2156    28314    3             VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXTC$->X$STRING));
     2157    28315    3           GOTO CREATE_USER_END2;
     2158    28316        /*
     2159    28317             ***** Ok to create the user ...
     2160    28318        */
     2161    28319    3   E_CRUSER2: ;
     2162    28320        /*
     2163    28321             ***** Open the reverse name map file ...
     2164    28322        */
     2165    28323    3           CALL XUR$DISABLE;
     2166    28324    3           CALL M$OPEN (OPEN_NAME_MAP) ALTRET(E_PMME);
     2167    28325        /*
     2168    28326             ***** Initialize VM_ADD_HEAD ...
     2169    28327        */
     2170    28328    3           VM_ADD_HEAD.NUM_ENTRIES = 0;
     2171    28329    4           DO INDX1 = 1 TO OUT$ -> P$B.NSUBLKS - 1;
     2172    28330    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);
     2173    28331        /*
     2174    28332             ***** Initialize the address variables ...
     2175    28333        */
     2176    28334    4               ADDRESS_ACCT.ACCT# = ' ';
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:74   
     2177    28335    4               ADDRESS_NAME.L# = 0;
     2178    28336    4               ADDRESS_NAME.NAME# = ' ';
     2179    28337    4               ADDRESS_FOLDER = ' ';
     2180    28338    4               ADDRESS_PASS.PASS# = ' ';
     2181    28339    4               ADDRESS_SITENAME = VM_SITENAME;
     2182    28340    4               ADDRESS_LACCN.ACCT# = ' '; /* Logon accn */
     2183    28341    4               ADDRESS_LUNAME = ' '; /* Logon uname */
     2184    28342    4               DOMAIN$ = ADDR(NIL);
     2185    28343        /*
     2186    28344             ***** Repeat this loop once for each part of the definition ...
     2187    28345        */
     2188    28346    5               DO INDX2 = 0 TO BLK$ -> P$B.NSUBLKS - 1;
     2189    28347    5                   PTR2$ = BLK$ -> P$B.SUBLK$(INDX2);
     2190    28348    6                   DO CASE (PTR2$ -> P$B.CODE);
     2191    28349    6                   CASE (%ADD_ACCT);
     2192    28350    6                       ADDRESS_LACCN.ACCT# = PTR2$ -> P$S.TEXT;
     2193    28351    6                   CASE (%ADD_UNAME);
     2194    28352    6                       ADDRESS_LUNAME = PTR2$ -> P$S.TEXT;
     2195    28353    6                   CASE (%ADD_ADDRESS);
     2196    28354                                                /*
     2197    28355                       ***** Repeat this loop once for each piece of the address ...
     2198    28356                       */
     2199    28357    7                       DO INDX3 = 0 TO PTR2$ -> P$B.NSUBLKS - 1;
     2200    28358    7                           PTR3$ = PTR2$ -> P$B.SUBLK$(INDX3);
     2201    28359    8                           DO CASE (PTR3$ -> P$B.CODE);
     2202    28360    8                           CASE (%ADD_ACCT);
     2203    28361    8                               ADDRESS_ACCT.ACCT# = PTR3$ -> P$S.TEXT;
     2204    28362    8                           CASE (%ADD_FOLDER);
     2205    28363    8                               ADDRESS_FOLDER = PTR3$ -> P$S.TEXT;
     2206    28364    8                           CASE (%ADD_NAME);
     2207    28365    8                               ADDRESS_NAME.NAME# = PTR3$ -> P$S.TEXT;
     2208    28366    8                               ADDRESS_NAME.L# = PTR3$ -> P$S.COUNT;
     2209    28367    8                           CASE (%ADD_PASS);
     2210    28368    8                               ADDRESS_PASS.PASS# = PTR3$ -> P$S.TEXT;
     2211    28369    8                           CASE (%ADD_SITE);
     2212    28370    8                               ADDRESS_SITENAME = PTR3$ -> P$S.TEXT;
     2213    28371    8                           CASE (%ADD_DOMAIN);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:75   
     2214    28372    8                               DOMAIN$ = PTR3$;
     2215    28373    8                           END; /* Do case ... end */
     2216    28374    7                       END;      /* Do INDX3 = ... end */
     2217    28375    6                   END;            /* Do CASE(PTR2$) */
     2218    28376    5               END;                  /* Do INDX2 */
     2219    28377    4               CALL TRANSFORM_DOMAIN (DOMAIN$, ADDRESS_SITENAME, ADDRESS_NAME)
     2220    28378    4                 ALTRET (CREATE_USER_END);
     2221    28379        /*
     2222    28380             ***** Fill in default values ...
     2223    28381        */
     2224    28382    4               IF ADDRESS_ACCT.ACCT# = ' '
     2225    28383    4               THEN
     2226    28384    4                   ADDRESS_ACCT.ACCT# = ADDRESS_LACCN.ACCT#;
     2227    28385    4               ELSE IF ADDRESS_LACCN.ACCT# = ' ' THEN
     2228    28386    4                       ADDRESS_LACCN.ACCT# = ADDRESS_ACCT.ACCT#;
     2229    28387        /*
     2230    28388             ***** Store the reverse name map info if available ...
     2231    28389        */
     2232    28390    4               IF ADDRESS_LACCN.ACCT# ~= ' '
     2233    28391    4                 AND (ADDRESS_SITENAME = VM_SITENAME
     2234    28392    4                 OR ADDRESS_SITENAME = ' ')
     2235    28393    4               THEN                 /* Info avail */
     2236    28394    5               DO;
     2237    28395    5                   CALL CONCAT (NAME_KEY.NAME#,ADDRESS_LACCN.ACCT#,
     2238    28396    5                     ADDRESS_LUNAME);
     2239    28397    5                   NAME_KEY.L# = 20;
     2240    28398    5                   WRITE_NAME_MAP.BUF_ = VECTOR(OUT$ -> P$B.SUBLK$(0)
     2241    28399    5                     -> P$S.TEXT);
     2242    28400        /*
     2243    28401             ***** Check if this NAME_MAP entry already exists.
     2244    28402                   If it does, then error!!!
     2245    28403        */
     2246    28404    5                   CALL M$READ (READ_NAME_MAP)
     2247    28405    5                   WHENRETURN
     2248    28406    6                   DO;
     2249    28407    6                       IF OUT$->P$B.SUBLK$(0)->P$S.TEXT ~= SUBSTR(WORK_STRING.NAME#,
     2250    28408    6                         0, DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS#)
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:76   
     2251    28409    7                       THEN DO;
     2252    28410    7                           IF DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS# <= 31
     2253    28411    7                           THEN
     2254    28412    7                               WORK_STRING.L# = DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS#;
     2255    28413    8                           ELSE DO;
     2256    28414    8                               WORK_STRING.L# = 31;
     2257    28415    8                               SUBSTR (WORK_STRING.NAME#,28,3) = '...';
     2258    28416    8                           END;
     2259    28417    7                           CALL XUR$ERRMSG (E_NMENTRYEXISTS,,,
     2260    28418    7                             VECTOR(NAME_KEY),VECTOR(WORK_STRING));
     2261    28419    7                           GOTO CREATE_USER_END;
     2262    28420    7                       END;
     2263    28421    6                   END;
     2264    28422    5                   CALL M$WRITE (WRITE_NAME_MAP) ALTRET(E_PMME);
     2265    28423    5               END;
     2266    28424    4               ELSE
     2267    28425    5               DO;
     2268    28426    5                   NAME_KEY.L# = 0;
     2269    28427    5                   NAME_KEY.NAME# = ' ';
     2270    28428    5               END;
     2271    28429        /*
     2272    28430             ***** Add this entry to the user list ...
     2273    28431        */
     2274    28432    4   ITS_OK:     IF ADDRESS_NAME.L# ~= 0
     2275    28433    4               THEN                 /* Store as unresolved address */
     2276    28434    5               DO;
     2277    28435    5                   CALL VMA$ADD_UENTRY_SORTED (ADDRESS_NAME,
     2278    28436    5                     ADDRESS_FOLDER,
     2279    28437    5                     ADDRESS_PASS,ADDRESS_SITENAME,%NO#,NAME_KEY.
     2280    28438    5                     NAME#) ALTRET(E_PMME);
     2281    28439    5               END;
     2282    28440    4               ELSE                 /* Store as resolved address */
     2283    28441    5               DO;
     2284    28442    5                   CALL VMA$ADD_RENTRY_SORTED (ADDRESS_ACCT,
     2285    28443    5                     ADDRESS_FOLDER,
     2286    28444    5                     ADDRESS_PASS,ADDRESS_SITENAME,%NO#,NAME_KEY.
     2287    28445    5                     NAME#) ALTRET(E_PMME);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:77   
     2288    28446    5               END;
     2289    28447        /*
     2290    28448             ***** Store the completed list ...
     2291    28449        */
     2292    28450    4           END;
     2293    28451    3           CALL VMA$PUT_LIST (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)
     2294    28452    3             ALTRET(E_PMME);
     2295    28453    3   CREATE_USER_END:
     2296    28454    3           CLOSE_SAVE.V.DCB# = DCBNUM(M$NAME);
     2297    28455    3           CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     2298    28456    3   CREATE_USER_END2:
     2299    28457    3           CALL XUR$ENABLE;
     2300    28458        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:78   
     2301    28459        /* Delete folder command */
     2302    28460    3       CASE (%CMD_DELETE_FOLDER);
     2303    28461        /*
     2304    28462             ***** Look at folders in the user's file directory acct ...
     2305    28463        */
     2306    28464    3           INDX2 = 0;                  /* Used as counter */
     2307    28465    3           VM_RADDRESS.ACCT = VM_CENTRAL_FOLDER.ACCT;
     2308    28466    3           VM_RADDRESS.FOLDER = 'CENTRAL';   /* Default is CENTRAL folder */
     2309    28467    3           VM_RADDRESS.PASS = ' ';
     2310    28468    3           VM_RADDRESS.SITENAME = ' ';
     2311    28469    3           VM_RADDRESS.TYPE = %VM_ADD_RESOLVED;
     2312    28470    3           IF OUT$ -> P$B.NSUBLKS ~= 0
     2313    28471    3           THEN
     2314    28472    4           DO;                    /* Pick up options */
     2315    28473    4               BLK$ = OUT$ -> P$B.SUBLK$(0);
     2316    28474        /*
     2317    28475             ***** Repeat this loop once for each piece of the address ...
     2318    28476        */
     2319    28477    5               DO INDX1 = 0 TO BLK$ -> P$B.NSUBLKS - 1;
     2320    28478    5                   PTR1$ = BLK$ -> P$B.SUBLK$(INDX1);
     2321    28479    6                   DO CASE (PTR1$ -> P$B.CODE);
     2322    28480    6                   CASE (%ADD_ACCT);
     2323    28481    6                       VM_RADDRESS.ACCT = PTR1$ -> P$S.TEXT;
     2324    28482    6                   CASE (%ADD_FOLDER);
     2325    28483    6                       VM_RADDRESS.FOLDER = PTR1$ -> P$S.TEXT;
     2326    28484    6                   CASE (%ADD_NAME);
     2327    28485    6                       CALL XUR$ERRMSG (E_NAMENTALLOWED);
     2328    28486    6                       GOTO CONTINUE;
     2329    28487    6                   CASE (%ADD_PASS);
     2330    28488    6                       VM_RADDRESS.PASS = PTR1$ -> P$S.TEXT;
     2331    28489    6                   END;       /* Do case ... end */
     2332    28490    5               END;             /* Do INDX1 = ... end */
     2333    28491    4           END;                  /* Pick up options */
     2334    28492        /**/
     2335    28493    3           IF VM_CURRENT_FOLDER.ACCT = VM_RADDRESS.ACCT
     2336    28494    3             AND VM_CURRENT_FOLDER.FOLDER = VM_RADDRESS.FOLDER
     2337    28495    4           THEN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:79   
     2338    28496    4               CALL XUR$ERRMSG (E_CANTDELCUR);
     2339    28497    4               GOTO CONTINUE;
     2340    28498    4           END;
     2341    28499    3           FID_ACCT.ACCT# = VM_RADDRESS.ACCT;
     2342    28500    3           FID_PASS.PASS# = VM_RADDRESS.PASS;
     2343    28501    3           CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;
     2344    28502        /*
     2345    28503             ***** Wildcard specified ???
     2346    28504        */
     2347    28505    3           IF VM_RADDRESS.FOLDER = 'CENTRAL'
     2348    28506    3           THEN                       /* Supply name of central folder */
     2349    28507    3               VM_RADDRESS.FOLDER = VM_CENTRAL_FOLDER.FOLDER;
     2350    28508    3           WILDCARD_PATTERN = VM_RADDRESS.FOLDER;
     2351    28509    3           CALL INDEX(INDX1,'?',WILDCARD_PATTERN)
     2352    28510    4           WHENRETURN DO;
     2353    28511    4               WILD = %YES#;
     2354    28512    4           END;
     2355    28513    4           WHENALTRETURN DO;
     2356    28514    4               WILD = %NO#;
     2357    28515    4           END;
     2358    28516    3           CALL INDEX(INDX1,' ',WILDCARD_PATTERN);
     2359    28517    3           VM_WILDCARD.PATTERN_ = VECTOR(SUBSTR(WILDCARD_PATTERN,0,INDX1));
     2360    28518    3           OPEN_NEXT.NAME_ = VECTOR(FID_NAME);
     2361    28519    3           FID_NAME.NAME# = ':MAIL_';
     2362    28520    3           FID_NAME.L# = LENGTHC(':MAIL_');
     2363    28521    3           CALL GET_WILD_FOLDER ALTRET(END_DEL_FOLDER);
     2364    28522    3           OPEN_NEXT.NAME_ = VECTOR(NIL);
     2365    28523    4           DO FOREVER;
     2366    28524    4               CALL M$CLOSE (CLOSE_SCRATCH)
     2367    28525    5               WHENRETURN DO;
     2368    28526    5                   INDX2 = INDX2 + 1;
     2369    28527    5               END;
     2370    28528    5               WHENALTRETURN DO;
     2371    28529    5                   ERROR = B$TCB.ALT$->B$ALT.ERR;
     2372    28530    5                   CALL XUR$ERRMSG (E_CANTDELF);
     2373    28531    5                   CALL XUR$ERRMSG (ERROR,M$WORK_NUM);
     2374    28532    5               END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:80   
     2375    28533        /*
     2376    28534             ***** If wildcard specified, loop to process other matches ...
     2377    28535        */
     2378    28536    4               IF NOT WILD
     2379    28537    4               THEN
     2380    28538    4                   GOTO END_DEL_FOLDER;
     2381    28539    4               CALL GET_WILD_FOLDER ALTRET(END_DEL_FOLDER);
     2382    28540    4           END;                       /* Do forever ... end */
     2383    28541        /*
     2384    28542             ***** Get the profile for the current folder ...
     2385    28543        */
     2386    28544    3   END_DEL_FOLDER:
     2387    28545    3           CALL REPORT_ACTIVITY (INDX2,VM_FOLDER_DELETED_FMT,%NO#,E_FOLDER_DELETED_FMT)
             28545                    ;
     2388    28546        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:81   
     2389    28547        /* Delete list command */
     2390    28548    3       CASE (%CMD_DELETE_LIST);
     2391    28549    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     2392    28550    3           INDX2 = 0;                  /* Used as counter */
     2393    28551    3           CALL INDEX(INDX1,'?',OUT$->P$B.SUBLK$(0)->P$S.TEXT) ALTRET(
     2394    28552    3             NON_WILD_DEL_LIST);
     2395    28553    3           VM_WILDCARD.PATTERN_ = VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2396    28554    3           CALL XLATE (OUT$->P$B.SUBLK$(0)->P$S.TEXT, LOWER_UPPER,
     2397    28555    3             OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2398    28556    3           VM_LISTKEY.TEXT = ' ';      /* Start at first entry */
     2399    28557    3           VM_LISTKEY2 = VM_LISTKEY;   /* Remember previous entry */
     2400    28558    3           CALL VMA$GET_LIST_NEXT (VM_LISTKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(
     2401    28559    3             END_DEL_LIST);
     2402    28560    4           DO FOREVER;
     2403    28561    4               VM_WILDCARD.INPUT_ = VECTOR(SUBSTR(VM_LISTKEY.TEXT,0,
     2404    28562    4                 VM_LISTKEY.COUNT-1)); /* One less for type */
     2405    28563    4               CALL X$WILDCMP (VM_WILDCARD)
     2406    28564    4               WHENRETURN
     2407    28565    5               DO;
     2408    28566    5                   CALL VMA$DEL_LIST (VM_LISTKEY,,M$MAIL_FILE_NUM) ALTRET(E_PMME);
     2409    28567    5                   INDX2 = INDX2 + 1;
     2410    28568    5               END;
     2411    28569    4               WHENALTRETURN
     2412    28570    5               DO;
     2413    28571    5                   VM_LISTKEY2 = VM_LISTKEY; /* New previous entry */
     2414    28572    5               END;
     2415    28573    4               VM_LISTKEY = VM_LISTKEY2; /* Previous needed to find next */
     2416    28574    4               CALL VMA$GET_LIST_NEXT (VM_LISTKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)
     2417    28575    4                 ALTRET(END_DEL_LIST);
     2418    28576    4           END;                       /* Do forever ... end */
     2419    28577        /*
     2420    28578             ***** Handle non-wild case ...
     2421    28579        */
     2422    28580    4           DO NEVER;
     2423    28581    4   NON_WILD_DEL_LIST:
     2424    28582    4               VM_LISTKEY.TEXT = OUT$->P$B.SUBLK$(0)->P$S.TEXT;
     2425    28583    4               CALL VMA$DEL_LIST (VM_LISTKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:82   
     2426    28584    4               WHENALTRETURN
     2427    28585    5               DO;
     2428    28586    5                   IF B$TCB.ALT$ -> B$ALT.ERR.CODE = %E$NOKEY
     2429    28587    5                   THEN
     2430    28588    6                   DO;
     2431    28589    6                       CALL XUR$ERRMSG(E_NOLIST);
     2432    28590    6                       GOTO CONTINUE;
     2433    28591    6                   END;
     2434    28592    5                   ELSE
     2435    28593    5                       GOTO E_PMME;
     2436    28594    5               END;
     2437    28595    4               INDX2 = INDX2 + 1;
     2438    28596    4           END;                       /* Do never ... end */
     2439    28597    3   END_DEL_LIST: ;
     2440    28598    3           CALL REPORT_ACTIVITY (INDX2,VM_LISTS_DELETED_FMT,%NO#,E_LISTS_DELETED_FMT);
     2441    28599        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:83   
     2442    28600        /* Delete user command */
     2443    28601    3       CASE (%CMD_DELETE_USER);
     2444    28602    3           CALL NEED_GLOBAL ALTRET(CONTINUE);
     2445    28603        /*
     2446    28604             ***** Open the reverse name map file ...
     2447    28605        */
     2448    28606    3           CALL XUR$DISABLE;
     2449    28607    3           CALL M$OPEN (OPEN_NAME_MAP) ALTRET(E_PMME);
     2450    28608    3           INDX2 = 0;                  /* Used as counter */
     2451    28609    3           CALL INDEX(INDX1,'?',OUT$->P$B.SUBLK$(0)->P$S.TEXT) ALTRET(
     2452    28610    3             NON_WILD_DEL_USER);
     2453    28611    3           VM_WILDCARD.PATTERN_ = VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2454    28612    3           CALL XLATE (OUT$->P$B.SUBLK$(0)->P$S.TEXT, LOWER_UPPER,
     2455    28613    3             OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2456    28614    3           VM_USERKEY.TEXT = ' ';      /* Start at first entry */
     2457    28615    3           VM_USERKEY2 = VM_USERKEY;   /* Remember previous entry */
     2458    28616    3           CALL VMA$GET_LIST_NEXT (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(
     2459    28617    3             END_DEL_USER);
     2460    28618    4           DO FOREVER;
     2461    28619    4               VM_WILDCARD.INPUT_ = VECTOR(SUBSTR(VM_USERKEY.TEXT,0,
     2462    28620    4                 VM_USERKEY.COUNT-1)); /* One less for type */
     2463    28621    4               CALL X$WILDCMP (VM_WILDCARD)
     2464    28622    4               WHENRETURN
     2465    28623    5               DO;
     2466    28624        /*
     2467    28625             ***** Delete all reverse name map records for this user ...
     2468    28626        */
     2469    28627    5                   CALL DEL_NAMEMAP_ENTRIES ALTRET(END_DEL_USER);
     2470    28628        /*
     2471    28629             ***** Now delete the record ...
     2472    28630        */
     2473    28631    5                   CALL VMA$DEL_LIST (VM_USERKEY,,M$MAIL_FILE_NUM) ALTRET(E_PMME);
     2474    28632    5                   INDX2 = INDX2 + 1;
     2475    28633    5               END;
     2476    28634    4               WHENALTRETURN
     2477    28635    5               DO;
     2478    28636    5                   VM_USERKEY2 = VM_USERKEY; /* New previous entry */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:84   
     2479    28637    5               END;
     2480    28638    4               VM_USERKEY = VM_USERKEY2; /* Previous needed to find next */
     2481    28639    4               CALL VMA$GET_LIST_NEXT (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)
     2482    28640    4                 ALTRET(END_DEL_USER);
     2483    28641    4           END;                       /* Do forever ... end */
     2484    28642        /*
     2485    28643             ***** Handle non-wild case ...
     2486    28644        */
     2487    28645    4           DO NEVER;
     2488    28646    4   NON_WILD_DEL_USER:
     2489    28647    4               VM_USERKEY.TEXT = OUT$->P$B.SUBLK$(0)->P$S.TEXT;
     2490    28648    4               CALL VMA$GET_LIST (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(
     2491    28649    4                 END_DEL_USER);
     2492    28650    4               CALL DEL_NAMEMAP_ENTRIES;
     2493    28651    4               CALL VMA$DEL_LIST (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(
     2494    28652    4                 E_PMME);
     2495    28653    4               INDX2 = INDX2 + 1;
     2496    28654    4           END;                       /* Do never ... end */
     2497    28655    3   END_DEL_USER: ;
     2498    28656        /*
     2499    28657             ***** Close the reverse name map ...
     2500    28658        */
     2501    28659    3           CLOSE_SAVE.V.DCB# = DCBNUM(M$NAME);
     2502    28660    3           CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     2503    28661    3           CALL XUR$ENABLE;
     2504    28662    3           CALL REPORT_ACTIVITY (INDX2,VM_USERS_DELETED_FMT,%NO#,E_USERS_DELETED_FMT);
     2505    28663        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:85   
     2506    28664        /* Delete message command */
     2507    28665    3       CASE (%CMD_DELETE_MESSAGE);
     2508    28666    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     2509    28667    3           CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_DELETE_MESSAGE) ALTRET(
     2510    28668    3             CONTINUE);
     2511    28669    3           INDX1 = 0;                  /* Used as counter */
     2512    28670    3           NONE = %YES#;
     2513    28671    4           DO FOREVER;
     2514    28672    4               CALL GET$MESSAGE ALTRET(END_DELETE);
     2515    28673    4               NONE = %NO#;
     2516    28674        /*
     2517    28675             ***** Only delete messages that have been listed before
     2518    28676                   and that have not already been deleted.
     2519    28677        */
     2520    28678    4               IF (VM_HEADER.STATUS.OLD = %YES#
     2521    28679    4                 OR VM_HEADER.STATUS.MAKE_OLD = %YES#)
     2522    28680    4                 AND VM_HEADER.STATUS.DEL ~= %YES#
     2523    28681    5               THEN DO;             /* Message has been listed */
     2524    28682    5                   IF VM_PROFILE.OPT.HEADERS
     2525    28683    5                   THEN
     2526    28684    5                       CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);
     2527    28685    5                   CALL XUR$DISABLE;
     2528    28686    5                   VM_HEADER.STATUS.DEL = %YES#;
     2529    28687    5                   IF VM_PROFILE.LOW_DEL_NUM > CURRENT_MESSAGE_NUMBER
     2530    28688    5                   THEN VM_PROFILE.LOW_DEL_NUM = CURRENT_MESSAGE_NUMBER;
     2531    28689    5                   CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM)
     2532    28690    5                     ;
     2533    28691    5                   VM_PROFILE.NUM_DEL_MESSAGES = VM_PROFILE.NUM_DEL_MESSAGES +
     2534    28692    5                     1;
     2535    28693    5                   CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(WRITE_ERROR);
     2536    28694    5                   CALL XUR$ENABLE;
     2537    28695    5                   INDX1 = INDX1 + 1; /* Deletions */
     2538    28696    5               END;             /* Do ... end */
     2539    28697    4           END;                       /* Do forever ... end  */
     2540    28698
     2541    28699    3   END_DELETE: ;
     2542    28700    3           CALL REPORT_ACTIVITY (INDX1,VM_MSGS_DELETED_FMT,NONE,E_MSGS_DELETED_FMT);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:86   
     2543    28701        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:87   
     2544    28702        /* Detach command */
     2545    28703    3       CASE (%CMD_DETACH);
     2546    28704    3           CALL NEED_FOLDER
     2547    28705    4           WHENALTRETURN DO;
     2548    28706    4               CALL XUR$ERRMSG (E_NOCURFOLD);
     2549    28707    4               GOTO CONTINUE;
     2550    28708    4           END;
     2551    28709    3           CALL GET$MESSAGE ALTRET (END_DETACH);
     2552    28710                /* Make sure there are nclosure for this mailgram */
     2553    28711    4           IF VM_HEADER.STATUS.ENCL = %NO# THEN DO;
     2554    28712    4               CALL XUR$ERRMSG (E_NOENCLS);
     2555    28713    4               GOTO CONTINUE;
     2556    28714    4           END;
     2557    28715
     2558    28716    3           IF NOT ( CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) - CURRENT_CONTEXT%.MESSAGE_SET
             28716                    .LOW(0) = 0 AND
     2559    28717    4             CURRENT_CONTEXT%.TRUTH_TREE$ = ADDR(NIL)) THEN DO;
     2560    28718                   /* some message about only one message may
     2561    28719                      be selected when using the DETACH command */
     2562    28720    4               CALL XUR$ERRMSG (E_DETALLOWSONE);
     2563    28721    4               GOTO CONTINUE;
     2564    28722    4           END;
     2565    28723    4           ELSE DO;
     2566    28724
     2567    28725                   /* Loop thru the parse nodes */
     2568    28726
     2569    28727    5               DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;
     2570    28728    5                   PTR1$ = OUT$ -> P$B.SUBLK$(INDX1);
     2571    28729    6                   DO CASE (PTR1$ -> P$B.CODE);
     2572    28730    6                   CASE (%DET_ENCLNUM);
     2573    28731    6                       CALL CHARBIN(INDX2,PTR1$->P$S.TEXTC$->X$STRING.TEXT);
     2574    28732    6   GET_ENCL:           CALL VMA$GET_ADD_RECORD(%VM_TYPE_ENCL, VM_ENCLLIST_,
             28732            M$MAIL_FILE_NUM,CURRENT_MESSAGE_NUMBER)
     2575    28733    7                       WHENALTRETURN DO;
     2576    28734    8                           IF B$TCB.ALT$->B$ALT.ERR.CODE=%E$LD THEN DO;
     2577    28735    8                               VBOUND(VM_ENCLREC_) = VBOUND(VM_ENCLREC_) + PAGESIZE;
     2578    28736    8                               GOTO GET_ENCL;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:88   
     2579    28737    8                           END;
     2580    28738    7                       END;
     2581    28739    6                       ENCL$ = VM_ENCL_HEAD.HEAD$;
     2582    28740    7   FIND_ENCL:          DO FOREVER;
     2583    28741    8                           IF VM_ENCLOS.TYPE - %VM_TYPE_ENCL = INDX2 THEN DO;
     2584    28742    9                               IF VM_ENCLOS.FLAGS.DELETED THEN DO;
     2585    28743    9                                   CALL XUR$ERRMSG (E_ENCLDELETED);
     2586    28744    9                                   GOTO CONTINUE;
     2587    28745    9                               END;
     2588    28746    8                               ELSE
     2589    28747    8                                   EXIT FIND_ENCL;
     2590    28748    8                           END;
     2591    28749    8                           ELSE IF VM_ENCLOS.NEXT$ = ADDR(NIL) THEN DO;
     2592    28750    8                                   CALL XUR$ERRMSG (E_ENCLNOTFOUND);
     2593    28751    8                                   GOTO CONTINUE;
     2594    28752    8                               END;
     2595    28753    7                           ENCL$ = VM_ENCLOS.NEXT$;
     2596    28754    7                       END;
     2597    28755    6                   CASE (%DET_DELETE);
     2598    28756    6                       DELETE_ENCL_FLAG = %YES#;
     2599    28757    6                   CASE (%DET_OPTS);
     2600    28758    6                       CALL XUR$OPENOUT (DCBNUM(M$ENCL),PTR1$->P$B,OPEN_ENCL)
     2601    28759    7                       WHENALTRETURN DO;
     2602    28760    7                           CALL XUR$ERRMSG(XUG$GETCMD.ERR#,M$OUT_NUM);
     2603    28761    7                           GOTO CONTINUE;
     2604    28762    7                       END;
     2605    28763    6                   END;
     2606    28764    5               END;  /* INDX1 */
     2607    28765
     2608    28766    5               DO INDX3 = 0 TO VM_ENCLOS.NRECS - 1;
     2609    28767    5                   CALL VMD$GET_ENCL(CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM,INDX3,COUNT
             28767                            ,,,,INDX2,VM_ENCLREC$)
     2610    28768    6                   WHENALTRETURN DO;
     2611    28769    6                       CALL XUR$ERRMSG(E_ENCLBROKEN);
     2612    28770    6                       EXIT;
     2613    28771    6                   END;
     2614    28772    5                   WRITE_ENCL.BUF_.BUF$ = PINCRW(VM_ENCLREC$,2);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:89   
     2615    28773    5                   WRITE_ENCL.BUF_.BOUND = COUNT - 1;
     2616    28774    5                   IF (COUNT = 0) THEN WRITE_ENCL.BUF_.BOUND = 0;
     2617    28775    5                   CALL M$WRITE (WRITE_ENCL)
     2618    28776    6                   WHENALTRETURN DO;
     2619    28777    6                       CALL XUR$ERRMSG(B$TCB.ALT$->B$ALT.ERR, M$OUT_NUM);
     2620    28778    6                       GOTO CONTINUE;
     2621    28779    6                   END;
     2622    28780    5               END;
     2623    28781
     2624    28782    4               CLOSE_SAVE.V.DCB# = DCBNUM(M$ENCL);
     2625    28783    4               CALL M$CLOSE (CLOSE_SAVE);
     2626    28784
     2627    28785                    /* if the delete option was used or del_on_detach is
     2628    28786                       set then delete the enclosure, set the delete flag
     2629    28787                       and save the context record */
     2630    28788
     2631    28789    5               IF VM_PROFILE.OPT.DEL_ON_DETACH OR DELETE_ENCL_FLAG THEN DO;
     2632    28790    5                   CALL VMD$DEL_ENCL(CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM,0,VM_ENCLOS
             28790                            .NRECS,,,,INDX2,VM_ENCLREC$);
     2633    28791    5                   VM_ENCLOS.FLAGS.DELETED = %YES#;
     2634    28792    5                   CALL VMA$PUT_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,M$MAIL_FILE_NUM,
             28792                            CURRENT_MESSAGE_NUMBER);
     2635    28793    5               END;
     2636    28794
     2637    28795    4           END;
     2638    28796    3   END_DETACH:;
     2639    28797    3           IF VM_ENCLOS.FLAGS.DELETED THEN
     2640    28798    3               CALL REPORT_ACTIVITY (INDX2,VM_DETACH_DELETE_OK_FMT,%YES#,
             28798                        E_DETACH_DELETE_OK_FMT);
     2641    28799    3           ELSE
     2642    28800    3               CALL REPORT_ACTIVITY (INDX2,VM_DETACH_OK_FMT,%YES#,E_DETACH_OK_FMT);
     2643    28801        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:90   
     2644    28802        /* Display list command */
     2645    28803    3       CASE (%CMD_DISPLAY_LIST);
     2646    28804    3           CALL NEED_FOLDER ALTRET(CONTINUE);
     2647    28805    3           IF NOT VM_SEARCH_INFO.ACTIVE THEN CALL VMA$OPEN_SRCH_LIST(VM_SEARCH_INFO);
     2648    28806    3           INDX2 = 0;                  /* Used as counter */
     2649    28807    3           IF OUT$ -> P$B.NSUBLKS = 0
     2650    28808    4           THEN DO;    /* Display all lists in current folder */
     2651    28809    4   DI_LIST_ALL:
     2652    28810    4               VM_LISTKEY.TEXT = ' ';
     2653    28811    5               DO FOREVER;
     2654    28812    5                   CALL VMA$GET_LIST_NEXT (VM_LISTKEY,VM_ADDLIST$,
     2655    28813    5                     M$MAIL_FILE_NUM) ALTRET(END_DI_LIST);
     2656    28814    5                   CALL VMD$DI_LIST (VM_LISTKEY,OUTDCB);
     2657    28815    5                   INDX2 = INDX2 + 1;
     2658    28816    5               END;
     2659    28817    4           END;
     2660    28818    4           ELSE DO;
     2661    28819        /*
     2662    28820                ***** Handle output clause, if any ...
     2663    28821        */
     2664    28822    4               BLK$ = OUT$ -> P$B.SUBLK$ (OUT$ -> P$B.NSUBLKS - 1);
     2665    28823    4               IF BLK$ -> P$B.CODE = %OPT_OUTPUT
     2666    28824    5               THEN DO;
     2667    28825    5                   CALL XUR$OPENOUT (M$OUT_NUM, BLK$ -> P$B)
     2668    28826    6                   WHENRETURN DO;
     2669    28827    6                       OUTDCB = M$OUT_NUM;
     2670    28828    6                   END;
     2671    28829    6                   WHENALTRETURN DO;
     2672    28830    6                       CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);
     2673    28831    6                       GOTO CONTINUE;
     2674    28832    6                   END;
     2675    28833    5                   IF OUT$ -> P$B.NSUBLKS = 1
     2676    28834    5                   THEN            /* No listname specified */
     2677    28835    5                       GOTO DI_LIST_ALL;
     2678    28836    5               END;
     2679    28837        /*
     2680    28838                ***** Handle wildcarded list ...
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:91   
     2681    28839        */
     2682    28840    4               CALL INDEX(INDX1,'?',OUT$->P$B.SUBLK$(0)->P$S.TEXT) ALTRET(
     2683    28841    4                 NON_WILD_DI_LIST);
     2684    28842    4               VM_WILDCARD.PATTERN_ = VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2685    28843    4               CALL XLATE(OUT$->P$B.SUBLK$(0)->P$S.TEXT, LOWER_UPPER,
     2686    28844    4                 OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2687    28845    5               DO INDX3=0 TO VM_SEARCH_INFO.NUM_ENTRIES-1;
     2688    28846    5                   IF INDX1 = 0
     2689    28847    5                   THEN
     2690    28848    5                       VM_LISTKEY.TEXT = ' '; /* Start at first entry */
     2691    28849    6                   ELSE DO;
     2692    28850    6                       VM_LISTKEY.TEXT = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;
     2693    28851    6                       SUBSTR (VM_LISTKEY.TEXT, INDX1) = ' ';
     2694    28852    6                       SUBSTR (VM_LISTKEY.TEXT, INDX1-1, 1) = BINASC(ASCBIN(SUBSTR(
             28852                                VM_LISTKEY.TEXT, INDX1-1, 1)) - 1);
     2695    28853    6                   END;
     2696    28854    5   LIST_LOOP:
     2697    28855    5                   CALL VMA$GET_LIST_NEXT (VM_LISTKEY,VM_ADDLIST$,
     2698    28856    5                     VM_SEARCH_INFO.DCB#(INDX3)) ALTRET(NO_MATCH_DI_LIST);
     2699    28857    5                   IF INDX1 > 0
     2700    28858    5                     AND SUBSTR(VM_LISTKEY.TEXT, 0, INDX1) > SUBSTR(OUT$ -> P$B.SUBLK$(
             28858                              0) -> P$S.TEXT, 0, INDX1)
     2701    28859    5                   THEN
     2702    28860    5                       GOTO NO_MATCH_DI_LIST;
     2703    28861    5                   VM_WILDCARD.INPUT_ = VECTOR(SUBSTR(VM_LISTKEY.TEXT,0,
     2704    28862    5                     VM_LISTKEY.COUNT-1)); /* One less for type */
     2705    28863    5                   CALL X$WILDCMP (VM_WILDCARD) ALTRET(LIST_LOOP);
     2706    28864    5                   CALL VMD$DI_LIST (VM_LISTKEY,OUTDCB,INDX3,VM_SEARCH_INFO);
     2707    28865    5                   INDX2 = INDX2 + 1;
     2708    28866    5                   GOTO LIST_LOOP;
     2709    28867    5   NO_MATCH_DI_LIST:
     2710    28868    5               END;
     2711    28869        /*
     2712    28870             ***** Handle non-wild case ...
     2713    28871        */
     2714    28872    5               DO NEVER;
     2715    28873    5   NON_WILD_DI_LIST:
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:92   
     2716    28874    5                   VM_LISTKEY.TEXT = OUT$->P$B.SUBLK$(0)->P$S.TEXT;
     2717    28875    6                   DO INDX3=0 TO VM_SEARCH_INFO.NUM_ENTRIES-1;
     2718    28876    6                       CALL VMA$GET_LIST (VM_LISTKEY,VM_ADDLIST$,
     2719    28877    6                         VM_SEARCH_INFO.DCB#(INDX3))
     2720    28878    7                       WHENRETURN DO;
     2721    28879    7                           INDX2 = INDX2 + 1;
     2722    28880    7                           CALL VMD$DI_LIST (VM_LISTKEY,OUTDCB,INDX3,VM_SEARCH_INFO);
     2723    28881    7                           GOTO END_DI_LIST;
     2724    28882    7                       END;
     2725    28883    6                   END;
     2726    28884    5               END;             /* Do never ... end */
     2727    28885    4           END;
     2728    28886    3   END_DI_LIST: ;
     2729    28887    3           IF INDX2 ~= 1 OR NOT DCBADDR(OUTDCB) -> F$DCB.DDEV.UCOUT#
     2730    28888    3           THEN
     2731    28889    3               CALL REPORT_ACTIVITY (INDX2,VM_LISTS_DISPLAYED_FMT,%NO#,
             28889                        E_LISTS_DISPLAYED_FMT);
     2732    28890        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:93   
     2733    28891        /* Display message command */
     2734    28892    3       CASE (%CMD_DISPLAY_MESSAGE);
     2735    28893    3           CALL NEED_FOLDER ALTRET(CONTINUE);
     2736    28894    3           OPT_SEED = 0;
     2737    28895    3           OPT_SEED$ = ADDR(OPT_SEED);
     2738    28896    3           LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE;
     2739    28897    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;
     2740    28898    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);
     2741    28899    5               DO CASE (BLK$ -> P$B.CODE);
     2742    28900    5               CASE (%OPT_CRPT);
     2743    28901    5                   CALL VMX$OCTBIN (BLK$->P$B.SUBLK$(0)->P$S,OPT_SEED);
     2744    28902    5                   IF OPT_SEED = 0
     2745    28903    5                   THEN /* allow display w/o decryption */
     2746    28904    5                       OPT_SEED$ = ADDR(NIL);
     2747    28905    5               CASE (%OPT_OUTPUT);
     2748    28906    5                   CALL XUR$OPENOUT (M$OUT_NUM, BLK$ -> P$B)
     2749    28907    6                   WHENRETURN DO;
     2750    28908    6                       OUTDCB = M$OUT_NUM;
     2751    28909    6                   END;
     2752    28910    6                   WHENALTRETURN DO;
     2753    28911    6                       CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);
     2754    28912    6                       GOTO CONTINUE;
     2755    28913    6                   END;
     2756    28914    5               CASE (%OPT_SELECT);
     2757    28915    5                   CALL INIT$SELECT_OPTS (BLK$,%CMD_DISPLAY_MESSAGE) ALTRET(
     2758    28916    5                     CONTINUE);
     2759    28917    5               END;             /* Do case ... end */
     2760    28918    4           END;                  /* Do INDX1 = ... end */
     2761    28919
     2762    28920    3           INDX2 = 0;                  /* Used as counter */
     2763    28921    3           NONE = %YES#;
     2764    28922    4           DO FOREVER;
     2765    28923    4   DI_NEXT:
     2766    28924    4               CALL GET$MESSAGE ALTRET(END_DISP);
     2767    28925    4               NONE = %NO#;
     2768    28926    4               VM_PROFILE.HI_MESSAGE_NUMBER =
     2769    28927    4                 MAXIMUM( VM_PROFILE.HI_MESSAGE_NUMBER , CURRENT_MESSAGE_NUMBER );
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:94   
     2770    28928    4               IF VM_HEADER.STATUS.CRYPT
     2771    28929    4                 AND OPT_SEED = 0
     2772    28930    4                 AND OPT_SEED$ ~= ADDR(NIL)
     2773    28931    5               THEN DO;
     2774    28932    5                   CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,OUTDCB);
     2775    28933    5                   CALL XUR$ERRMSG (E_NEEDSEED);
     2776    28934    5                   GOTO DI_NEXT;
     2777    28935    5               END;
     2778    28936    4               IF VM_PROFILE.OPT.PAGE
     2779    28937    4               THEN                 /* Go to top of page */
     2780    28938    4                   CALL VMD$EJECT(OUTDCB) ALTRET(E_PMME);
     2781    28939    4               CALL VMD$DI_MESSAGE(CURRENT_MESSAGE_NUMBER,
     2782    28940    4                 OUTDCB,M$MAIL_FILE_NUM,OPT$SEED,%NO#)
     2783    28941    5               WHENALTRETURN DO;
     2784    28942    5                   CALL XUR$ERRMSG (E_DI_BADSEED);
     2785    28943    5                   GOTO DI_NEXT;
     2786    28944    5               END;
     2787    28945    4               INDX2 = INDX2 + 1;
     2788    28946    4               IF VM_CURRENT_FOLDER.FLAGS.UPDATE
     2789    28947    4               THEN
     2790    28948    5               DO;
     2791    28949    5                   IF VM_HEADER.STATUS.EXAM = %NO#
     2792    28950    5                     OR VM_HEADER.STATUS.OLD = %NO#
     2793    28951    5                   THEN      /* Must set these flags */
     2794    28952    6                   DO;
     2795    28953    6                       CALL XUR$DISABLE;
     2796    28954    6                       IF NOT VM_HEADER.STATUS.OLD
     2797    28955    6                         AND NOT VM_HEADER.STATUS.MAKE_OLD
     2798    28956    6                       THEN
     2799    28957    6                           MADE_OLD = %YES#;
     2800    28958    6                       VM_HEADER.STATUS.EXAM = %YES#;
     2801    28959    6                       VM_HEADER.STATUS.MAKE_OLD = %YES#;
     2802    28960    6                       CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,
     2803    28961    6                         M$MAIL_FILE_NUM);
     2804    28962    6                       VM_PROFILE.NUM_MOLD_MESSAGES = VM_PROFILE.NUM_MOLD_MESSAGES + 1;
     2805    28963    6                       CALL PUT_PROFILE (M$MAIL_FILE_NUM)
     2806    28964    6                         ALTRET(WRITE_ERROR);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:95   
     2807    28965    6                       CALL XUR$ENABLE;
     2808    28966    6                   END;
     2809    28967    5                   ELSE
     2810    28968        /*
     2811    28969          **** This code should never get excercised. Profile record may not get
     2812    28970          **** updated if the system crashes. This will set the num_mold_messages
     2813    28971          **** so that updating occurs at exit which sets vm_header.status.old.
     2814    28972        */
     2815    28973    6                   DO;
     2816    28974    6                       IF VM_HEADER.STATUS.EXAM = %YES#
     2817    28975    6                         AND VM_HEADER.STATUS.MAKE_OLD = %YES#
     2818    28976    6                         AND VM_PROFILE.NUM_MOLD_MESSAGES = 0 THEN
     2819    28977    7                       DO;
     2820    28978    7                           VM_PROFILE.NUM_MOLD_MESSAGES =
     2821    28979    7                             VM_PROFILE.NUM_MESSAGES;
     2822    28980    7                           CALL XUR$DISABLE;
     2823    28981    7                           CALL PUT_PROFILE (M$MAIL_FILE_NUM)
     2824    28982    7                             ALTRET(WRITE_ERROR);
     2825    28983    7                           CALL XUR$ENABLE;
     2826    28984    7                       END;
     2827    28985    6                   END;
     2828    28986    5                   IF VM_HEADER.STATUS.RR
     2829    28987    5                   THEN
     2830    28988    6                   DO;
     2831    28989    6                       IF VM_HEADER.FROM$ -> X$STRING.TEXT ~=
     2832    28990    6                         USER_NAME.NAME#
     2833    28991    7                       THEN DO;
     2834    28992    7                           CALL DO$ACK (%NO#)
     2835    28993    8                           WHENRETURN DO;
     2836    28994    8                               VM_HEADER.STATUS.RR = %NO#;
     2837    28995    8                               CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,
             28995                                        M$MAIL_FILE_NUM);
     2838    28996    8                           END;
     2839    28997    7                       END;
     2840    28998    6                   END;
     2841    28999    5               END;
     2842    29000    4           END;                       /* Do forever ... end  */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:96   
     2843    29001
     2844    29002    3   END_DISP: ;
     2845    29003    3           IF INDX2 ~= 1 OR NOT DCBADDR(OUTDCB) -> F$DCB.DDEV.UCOUT#
     2846    29004    3           THEN
     2847    29005    3               CALL REPORT_ACTIVITY (INDX2,VM_MSGS_DISPLAYED_FMT,NONE,
     2848    29006    3                 E_MSGS_DISPLAYED_FMT);
     2849    29007        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:97   
     2850    29008        /* Display profile */
     2851    29009    3       CASE (%CMD_DISPLAY_PROFILE);
     2852    29010    3           CALL NEED_FOLDER ALTRET(CONTINUE);
     2853    29011    3           IF OUT$ -> P$B.NSUBLKS > 0
     2854    29012    4           THEN DO;
     2855    29013    4               CALL XUR$OPENOUT (M$OUT_NUM, OUT$ -> P$B.SUBLK$(0) -> P$B)
     2856    29014    5               WHENRETURN DO;
     2857    29015    5                   OUTDCB = M$OUT_NUM;
     2858    29016    5               END;
     2859    29017    5               WHENALTRETURN DO;
     2860    29018    5                   CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);
     2861    29019    5                   GOTO CONTINUE;
     2862    29020    5               END;
     2863    29021    4           END;
     2864    29022    3           CALL VMD$DI_PROFILE (OUTDCB);
     2865    29023        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:98   
     2866    29024        /* Display status command */
     2867    29025    3       CASE (%CMD_DISPLAY_STATUS);
     2868    29026    3           CALL NEED_FOLDER ALTRET(CONTINUE);
     2869    29027    3           IF OUT$ -> P$B.NSUBLKS > 0
     2870    29028    4           THEN DO;
     2871    29029    4               CALL XUR$OPENOUT (M$OUT_NUM, OUT$ -> P$B.SUBLK$(0) -> P$B)
     2872    29030    5               WHENRETURN DO;
     2873    29031    5                   OUTDCB = M$OUT_NUM;
     2874    29032    5               END;
     2875    29033    5               WHENALTRETURN DO;
     2876    29034    5                   CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);
     2877    29035    5                   GOTO CONTINUE;
     2878    29036    5               END;
     2879    29037    4           END;
     2880    29038    3           F_FDSLO.DCB# = OUTDCB;
     2881    29039    3           F_FDSLO.NVECS# = 0;
     2882    29040        /**/
     2883    29041    3           WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);
     2884    29042    3           CALL VMF$MAKE_ADDRESS1 (WORK_STRING,VM_CURRENT_FOLDER);
     2885    29043    3           VECT_ARRAY(0) = VECTOR(SUBSTR(WORK_STRING.NAME#,0,
     2886    29044    3             WORK_STRING.L#));
     2887    29045                %INIT_STR (CODE=E_STATUS_FOLDER_FMT, STR=VM_STATUS_FOLDER_FMT,
     2888    29046                VECT="F_FDSLO.FMT_", TEST=YES);
     2889    29069    3           F_FDSLO.NVECS# = 1;
     2890    29070    3           CALL VMD$WRITE_BUF (F_FDSLO);
     2891    29071        /**/
     2892    29072    3           WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);
     2893    29073    3           CALL VMS$FMT_SELECT (CURRENT_CONTEXT%,WORK_STRING);
     2894    29074                %INIT_STR (CODE=E_STATUS_CCONTEXT_FMT, STR=VM_STATUS_CCONTEXT_FMT,
     2895    29075                VECT="F_FDSLO.FMT_", TEST=YES);
     2896    29098    3           VECT_ARRAY(0) = VECTOR(SUBSTR(WORK_STRING.NAME#,0,WORK_STRING.L#));
     2897    29099    3           CALL VMD$WRITE_BUF (F_FDSLO);
     2898    29100        /**/
     2899    29101    3           WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);
     2900    29102    3           CALL VMS$FMT_SELECT (SELECTED_CONTEXT%,WORK_STRING);
     2901    29103                %INIT_STR (CODE=E_STATUS_SCONTEXT_FMT, STR=VM_STATUS_SCONTEXT_FMT,
     2902    29104                VECT="F_FDSLO.FMT_", TEST=YES);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:99   
     2903    29127    3           VECT_ARRAY(0) = VECTOR(SUBSTR(WORK_STRING.NAME#,0,WORK_STRING.L#));
     2904    29128    3           CALL VMD$WRITE_BUF (F_FDSLO);
     2905    29129        /**/
     2906    29130    3           IF SELECTED_CONTEXT%.MESSAGE_POINTER = -1
     2907    29131    3           THEN
     2908    29132    4           DO;
     2909    29133                    %INIT_STR (CODE=E_STATUS_POSITION_OUTSIDE_FMT, STR=
             29133                        VM_STATUS_POSITION_OUTSIDE_FMT,
     2910    29134                    VECT="F_FDSLO.FMT_", TEST=YES);
     2911    29157    4               F_FDSLO.NVECS# = 0;
     2912    29158    4           END;
     2913    29159    3           ELSE
     2914    29160    4           DO;
     2915    29161    4               VECT_ARRAY(0) = VECTOR(SELECTED_CONTEXT%.MESSAGE_POINTER);
     2916    29162                    %INIT_STR (CODE=E_STATUS_POSITION_FMT, STR=VM_STATUS_POSITION_FMT,
     2917    29163                    VECT="F_FDSLO.FMT_", TEST=YES);
     2918    29186    4               F_FDSLO.NVECS# = 1;
     2919    29187    4           END;
     2920    29188    3           CALL VMD$WRITE_BUF (F_FDSLO);
     2921    29189        /**/
     2922    29190    3           F_FDSLO.NVECS# = 1;
     2923    29191                %INIT_STR (CODE=E_STATUS_DMSGS_FMT, STR=VM_STATUS_DMSGS_FMT,
     2924    29192                VECT="F_FDSLO.FMT_", TEST=YES);
     2925    29215    3           VECT_ARRAY(0) = VECTOR(VM_PROFILE.NUM_DEL_MESSAGES);
     2926    29216    3           CALL VMD$WRITE_BUF (F_FDSLO);
     2927    29217        /**/
     2928    29218                %INIT_STR (CODE=E_STATUS_NMSGS_FMT, STR=VM_STATUS_NMSGS_FMT,
     2929    29219                VECT="F_FDSLO.FMT_", TEST=YES);
     2930    29242    3           VECT_ARRAY(0) = VECTOR(VM_PROFILE.NUM_NEW_MESSAGES);
     2931    29243    3           CALL VMD$WRITE_BUF (F_FDSLO);
     2932    29244        /**/
     2933    29245                %INIT_STR (CODE=E_STATUS_TMSGS_FMT, STR=VM_STATUS_TMSGS_FMT,
     2934    29246                VECT="F_FDSLO.FMT_", TEST=YES);
     2935    29269    3           VECT_ARRAY(0) = VECTOR(VM_PROFILE.NUM_MESSAGES);
     2936    29270    3           CALL VMD$WRITE_BUF (F_FDSLO);
     2937    29271        /**/
     2938    29272                %INIT_STR (CODE=E_STATUS_HMSGS_FMT, STR=VM_STATUS_HMSGS_FMT,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:100  
     2939    29273                VECT="F_FDSLO.FMT_", TEST=YES);
     2940    29296    3           VECT_ARRAY(0) = VECTOR(VM_PROFILE.HI_MESSAGE_NUMBER);
     2941    29297    3           CALL VMD$WRITE_BUF (F_FDSLO);
     2942    29298        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:101  
     2943    29299        /* Display user command */
     2944    29300    3       CASE (%CMD_DISPLAY_USER);
     2945    29301    3           INDX2 = 0;                  /* Used as counter */
     2946    29302    3           IF OUT$ -> P$B.NSUBLKS = 0
     2947    29303    4           THEN DO;    /* Display all user definitions */
     2948    29304    4   DI_USER_ALL:
     2949    29305    4               VM_USERKEY.TEXT = ' ';
     2950    29306    5               DO FOREVER;
     2951    29307    5                   CALL VMA$GET_LIST_NEXT (VM_USERKEY,VM_ADDLIST$,
     2952    29308    5                     M$MAIL_GLOBAL_NUM) ALTRET(END_DI_USER);
     2953    29309    5                   CALL VMD$DI_USER (VM_USERKEY,OUTDCB);
     2954    29310    5                   INDX2 = INDX2 + 1;
     2955    29311    5               END;
     2956    29312    4           END;
     2957    29313    4           ELSE DO;
     2958    29314        /*
     2959    29315                ***** Handle output clause, if any ...
     2960    29316        */
     2961    29317    4               BLK$ = OUT$ -> P$B.SUBLK$ (OUT$ -> P$B.NSUBLKS - 1);
     2962    29318    4               IF BLK$ -> P$B.CODE = %OPT_OUTPUT
     2963    29319    5               THEN DO;
     2964    29320    5                   CALL XUR$OPENOUT (M$OUT_NUM, BLK$ -> P$B)
     2965    29321    6                   WHENRETURN DO;
     2966    29322    6                       OUTDCB = M$OUT_NUM;
     2967    29323    6                   END;
     2968    29324    6                   WHENALTRETURN DO;
     2969    29325    6                       CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);
     2970    29326    6                       GOTO CONTINUE;
     2971    29327    6                   END;
     2972    29328    5                   IF OUT$ -> P$B.NSUBLKS = 1
     2973    29329    5                   THEN            /* No name specified */
     2974    29330    5                       GOTO DI_USER_ALL;
     2975    29331    5               END;
     2976    29332        /*
     2977    29333                ***** Handle wildcarded name ...
     2978    29334        */
     2979    29335    4               CALL INDEX(INDX1,'?',OUT$->P$B.SUBLK$(0)->P$S.TEXT) ALTRET(
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:102  
     2980    29336    4                 NON_WILD_DI_USER);
     2981    29337    4               VM_WILDCARD.PATTERN_ = VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2982    29338    4               CALL XLATE(OUT$->P$B.SUBLK$(0)->P$S.TEXT, LOWER_UPPER,
     2983    29339    4                 OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2984    29340    4               IF INDX1 = 0
     2985    29341    4               THEN
     2986    29342    4                   VM_USERKEY.TEXT = ' '; /* Start at first entry */
     2987    29343    5               ELSE DO;
     2988    29344    5                   VM_USERKEY.TEXT = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;
     2989    29345    5                   SUBSTR (VM_USERKEY.TEXT, INDX1) = ' ';
     2990    29346    5                   SUBSTR (VM_USERKEY.TEXT, INDX1-1, 1) = BINASC(ASCBIN(SUBSTR(
             29346                            VM_USERKEY.TEXT, INDX1-1, 1)) - 1);
     2991    29347    5               END;
     2992    29348    5               DO FOREVER;
     2993    29349    5                   CALL VMA$GET_LIST_NEXT (VM_USERKEY,VM_ADDLIST$,
     2994    29350    5                     M$MAIL_GLOBAL_NUM) ALTRET(END_DI_USER);
     2995    29351    5                   IF INDX1 > 0
     2996    29352    5                     AND SUBSTR(VM_USERKEY.TEXT, 0, INDX1) > SUBSTR(OUT$ -> P$B.SUBLK$(
             29352                              0) -> P$S.TEXT, 0, INDX1)
     2997    29353    5                   THEN
     2998    29354    5                       EXIT;
     2999    29355    5                   VM_WILDCARD.INPUT_ = VECTOR(SUBSTR(VM_USERKEY.TEXT,0,
     3000    29356    5                     VM_USERKEY.COUNT-1)); /* One less for type */
     3001    29357    5                   CALL X$WILDCMP (VM_WILDCARD) ALTRET(NO_MATCH_DI_USER);
     3002    29358    5                   CALL VMD$DI_USER (VM_USERKEY,OUTDCB);
     3003    29359    5                   INDX2 = INDX2 + 1;
     3004    29360    5   NO_MATCH_DI_USER:
     3005    29361    5               END;             /* Do forever ... end */
     3006    29362        /*
     3007    29363             ***** Handle non-wild case ...
     3008    29364        */
     3009    29365    5               DO NEVER;
     3010    29366    5   NON_WILD_DI_USER:
     3011    29367    5                   VM_USERKEY.TEXT = OUT$->P$B.SUBLK$(0)->P$S.TEXT;
     3012    29368    5                   CALL VMA$GET_LIST (VM_USERKEY,VM_ADDLIST$,
     3013    29369    5                     M$MAIL_GLOBAL_NUM) ALTRET(END_DI_USER);
     3014    29370    5                   CALL VMD$DI_USER (VM_USERKEY,OUTDCB);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:103  
     3015    29371    5                   INDX2 = INDX2 + 1;
     3016    29372    5               END;             /* Do never ... end */
     3017    29373    4           END;
     3018    29374    3   END_DI_USER: ;
     3019    29375    3           IF INDX2 ~= 1 OR NOT DCBADDR(OUTDCB) -> F$DCB.DDEV.UCOUT#
     3020    29376    3           THEN
     3021    29377    3               CALL REPORT_ACTIVITY (INDX2,VM_USERS_DISPLAYED_FMT,%NO#,
             29377                        E_USERS_DISPLAYED_FMT);
     3022    29378        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:104  
     3023    29379    3       CASE (%CMD_END);
     3024    29380    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN
     3025    29381    3           THEN
     3026    29382    4           DO;
     3027    29383    4               IF OUT$ -> P$B.NSUBLKS = 0
     3028    29384    4               THEN            /* Noupdate not specified */
     3029    29385    4                   CALL UPDATE$MAIL (VM_PROFILE.OPT.RENUMBER);
     3030    29386    4               IF VM_CURRENT_FOLDER.FLAGS.UPDATE
     3031    29387    4               THEN            /* Ok to write profile */
     3032    29388    4                   CALL PUT_PROFILE (M$MAIL_FILE_NUM)
     3033    29389    5                   WHENALTRETURN DO;
     3034    29390    5                       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     3035    29391    5                       CALL XUR$ERRMSG(E_WERR);
     3036    29392    5                       CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);
     3037    29393    5                   END;
     3038    29394    4               CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;
     3039    29395    4               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     3040    29396    4               VM_CURRENT_FOLDER.FLAGS = %NO#;
     3041    29397    4           END;
     3042    29398    3           CALL M$EXIT;
     3043    29399        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:105  
     3044    29400        /* First message command */
     3045    29401    3       CASE(%CMD_FIRST_MESSAGE);
     3046    29402    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE
     3047    29403    3           THEN
     3048    29404                    %INIT_STR (CODE=E_DI_FIRST_CMD, STR=VM_DI_FIRST_CMD,
     3049    29405                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     3050    29428    3           ELSE
     3051    29429                  %INIT_STR (CODE=E_LIST_FIRST_CMD, STR=VM_LIST_FIRST_CMD,
     3052    29430                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     3053    29453    3           NEXT_COMMAND_TEXT.L# = LENGTHC('DI FIRST');
     3054    29454        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:106  
     3055    29455        /* Forward command */
     3056    29456    3       CASE (%CMD_FORWARD_MESSAGE);
     3057    29457    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     3058    29458    3           OPT_SEED = 0;
     3059    29459    3           OPT_SEED$ = ADDR(OPT_SEED);
     3060    29460    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;
     3061    29461    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);
     3062    29462    5               DO CASE (BLK$ -> P$B.CODE);
     3063    29463    5               CASE (%OPT_CRPT);
     3064    29464    5                   CALL VMX$OCTBIN (BLK$->P$B.SUBLK$(0)->P$S,OPT_SEED);
     3065    29465    5                   IF OPT_SEED = 0
     3066    29466    5                   THEN /* allow display w/o decryption */
     3067    29467    5                       OPT_SEED$ = ADDR(NIL);
     3068    29468    5               CASE (%OPT_SELECT);
     3069    29469    5                   CALL INIT$SELECT_OPTS (BLK$,%CMD_FORWARD_MESSAGE) ALTRET(CONTINUE);
     3070    29470    5               END;             /* Do case ... end */
     3071    29471    4           END;
     3072    29472    3           CALL FIX_CONTEXT;
     3073    29473    3           INDX1 = 0;
     3074    29474        /*
     3075    29475             ***** Build the command buffer to pass to send ...
     3076    29476        */
     3077    29477                %INIT_STR (CODE=E_SEND_FORWARD, STR=VM_SEND_FORWARD, TEST=YES);
     3078    29500    3           CALL BUILD_LINK_TO_SEND_CMD(VM_SEND_FORWARD);
     3079    29501        /*
     3080    29502             ***** Forward all the messages ...
     3081    29503        */
     3082    29504    4           DO FOREVER;
     3083    29505    4   FWD_NEXT:   ;
     3084    29506    4               CALL GET$MESSAGE ALTRET(END_FORWARD);
     3085    29507    4               INDX1 = INDX1 + 1;
     3086    29508    4               IF VM_HEADER.STATUS.CRYPT
     3087    29509    4                 AND OPT_SEED = 0
     3088    29510    4                 AND OPT_SEED$ ~= ADDR(NIL)
     3089    29511    5               THEN DO;
     3090    29512    5                   CALL XUR$ERRMSG (E_NEEDSEED);
     3091    29513    5                   GOTO CONTINUE;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:107  
     3092    29514    5               END;
     3093    29515    4               CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);
     3094    29516        /*
     3095    29517             ***** Create the file to contain the message being forwarded ...
     3096    29518        */
     3097    29519    4               CALL M$OPEN (OPEN_FORWARD_FILE) ALTRET(E_PMME);
     3098    29520    4               CLOSE_SAVE.V.DCB# = M$WORK_NUM;
     3099    29521        /*
     3100    29522             ***** Now move the text into the file.
     3101    29523                   No vfc!!!
     3102    29524        */
     3103    29525    5               IF VM_HEADER.STATUS.ENCL = %NO# THEN DO;
     3104    29526    5                   CALL VMD$DI_MESSAGE (CURRENT_MESSAGE_NUMBER,M$WORK_NUM,
     3105    29527    5                     M$MAIL_FILE_NUM,OPT$SEED)
     3106    29528    6                   WHENALTRETURN DO;
     3107    29529    6                       CALL XUR$ERRMSG (E_FWD_BADSEED);
     3108    29530    6                       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     3109    29531    6                       GOTO FWD_NEXT;
     3110    29532    6                   END;
     3111    29533    5               END;
     3112    29534    5               ELSE IF VM_HEADER.STATUS.ENCL = %YES# THEN DO;
     3113    29535    5                       CALL VMD$DI_MESSAGE (CURRENT_MESSAGE_NUMBER,M$WORK_NUM,
     3114    29536    5                         M$MAIL_FILE_NUM,OPT$SEED,,%MAIL_FORWARD_ENCL)
     3115    29537    6                       WHENALTRETURN DO;
     3116    29538    6                           CALL XUR$ERRMSG (E_FWD_BADSEED);
     3117    29539    6                           CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     3118    29540    6                           GOTO FWD_NEXT;
     3119    29541    6                       END;
     3120    29542    5                   END;
     3121    29543    4               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     3122    29544        /*
     3123    29545             ***** Now move enclosure records, if there are any ...
     3124    29546        */
     3125    29547    5               IF VM_HEADER.STATUS.ENCL = %YES# THEN DO;
     3126    29548                        %INIT_STR (CODE=E_SEND_FORWARD_ENCL, STR=VM_SEND_FORWARD_ENCL, TEST=
             29548                            YES);
     3127    29571    5                   CALL BUILD_LINK_TO_SEND_CMD(VM_SEND_FORWARD_ENCL);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:108  
     3128    29572
     3129    29573    5                   CALL M$OPEN (OPEN_FORWARD_ENCL_FILE) ALTRET (E_PMME);
     3130    29574    5                   CLOSE_SAVE.V.DCB# = DCBNUM(M$ENCL);
     3131    29575
     3132    29576    5                   ENCL$ = VM_ENCL_HEAD.HEAD$;
     3133    29577    6                   DO INDX1 = 0 TO VM_ENCL_HEAD.NUM_ENTRIES - 1;
     3134    29578    7                       DO INDX3 = 0 TO VM_ENCLOS.NRECS - 1;
     3135    29579    7   GET_ENCL_REC:           CALL VMD$GET_ENCL(CURRENT_MESSAGE_NUMBER,
     3136    29580    7                             M$MAIL_FILE_NUM,INDX3,COUNT,,,,VM_ENCLOS.TYPE-%
             29580                                      VM_TYPE_ENCL,
     3137    29581    7                             VM_ENCLREC$)
     3138    29582    8                           WHENALTRETURN DO;
     3139    29583    9                               IF B$TCB.ALT$->B$ALT.ERR.CODE=%E$LD THEN DO;
     3140    29584    9                                   VBOUND(VM_ENCLREC_) = VBOUND(VM_ENCLREC_) + PAGESIZE
             29584                                            ;
     3141    29585    9                                   GOTO GET_ENCL_REC;
     3142    29586    9                               END;
     3143    29587    8                           END;
     3144    29588    7                           CALL VMD$PUT_ENCL (0,DCBNUM(M$ENCL),INDX3,COUNT,
     3145    29589    7                             0, ,DCBADDR(DCBNUM(M$ENCL))->F$DCB.DVBYTE,
     3146    29590    7                             VM_ENCLOS.TYPE-%VM_TYPE_ENCL,VM_ENCLREC$);
     3147    29591    7                       END; /* J */
     3148    29592    6                       ENCL$ = VM_ENCLOS.NEXT$;
     3149    29593    6                   END; /* I */
     3150    29594    5                   CALL VMA$PUT_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,
     3151    29595    5                     DCBNUM(M$ENCL));
     3152    29596
     3153    29597    5                   CALL M$CLOSE (CLOSE_SAVE) ALTRET (E_PMME);
     3154    29598
     3155    29599    5               END; /* IF ENCL */
     3156    29600        /*
     3157    29601             ***** Link to SEND ...
     3158    29602        */
     3159    29603    4               CALL LINK_RUNIT
     3160    29604    4               WHENRETURN
     3161    29605    5               DO;
     3162    29606    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:109  
     3163    29607    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     3164    29608    5               END;
     3165    29609    4               WHENALTRETURN
     3166    29610    5               DO;
     3167    29611    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,
     3168    29612    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     3169    29613    5                   GOTO END_FORWARD;
     3170    29614    5               END;
     3171    29615    4           END;                       /* Do forever ... end */
     3172    29616    3   END_FORWARD:
     3173    29617    3           REOPEN_FILE.V.DCB# = M$WORK_NUM;
     3174    29618    3           CALL M$OPEN (REOPEN_FILE)
     3175    29619    4           WHENRETURN DO;
     3176    29620    4               CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;
     3177    29621    5               CALL M$CLOSE (CLOSE_SCRATCH) WHENALTRETURN DO; END;
     3178    29622    4           END;
     3179    29623    3           IF INDX1 = 0
     3180    29624    3           THEN
     3181    29625    3               CALL REPORT_ACTIVITY (INDX1,VM_NO_MESSAGE_FMT,%YES#,E_NO_MESSAGE_FMT);
     3182    29626    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN
     3183    29627    3           THEN                       /* Ok to read profile */
     3184    29628    3               CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);
     3185    29629        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:110  
     3186    29630        /* Goto command */
     3187    29631    3       CASE (%CMD_GOTO_MESSAGE);
     3188    29632    3           CALL NEED_FOLDER ALTRET(CONTINUE);
     3189    29633    3           CALL CHARBIN (INDX3,OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT);
     3190    29634        /*
     3191    29635             ***** Determine if this message number is valid
     3192    29636                   according to the selected context info ...
     3193    29637        */
     3194    29638                                      /* $$$$$$$$$$$$$ code to be added $$$$$$$$$$$$$ */
     3195    29639    3           SELECTED_CONTEXT%.MESSAGE_POINTER = INDX3;
     3196    29640        /*
     3197    29641             ***** Now list or display this message ...
     3198    29642        */
     3199    29643    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE
     3200    29644    3           THEN
     3201    29645                    %INIT_STR (CODE=E_DI_THIS_CMD, STR=VM_DI_THIS_CMD,
     3202    29646                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     3203    29669    3           ELSE
     3204    29670                  %INIT_STR (CODE=E_LIST_THIS_CMD, STR=VM_LIST_THIS_CMD,
     3205    29671                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     3206    29694    3           NEXT_COMMAND_TEXT.L# = LENGTHC('DI THIS');
     3207    29695        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:111  
     3208    29696        /* Help commands */
     3209    29697
     3210    29698    3       CASE(%CMD_HELP);
     3211    29699    3           HELP_PARAM.HELP$ = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXTC$;
     3212    29700    3           HELP_PARAM.MORE# = %NO#;
     3213    29701    3           CALL XUR$HELP (HELP_PARAM);
     3214    29702
     3215    29703    3       CASE (%CMD_QUES1);
     3216    29704    3           CALL XUR$MOREMSG (HELP_PARAM) ALTRET(NO_MORE);
     3217    29705    3       CASE (%CMD_QUES2);
     3218    29706    3           CALL XUR$ALLMSG (HELP_PARAM) ALTRET(NO_MORE);
     3219    29707        /**/
     3220    29708    4           DO NEVER;
     3221    29709    4   NO_MORE:
     3222    29710        /*E*    ERROR: VMO-E$NOMORE-0
     3223    29711                MESSAGE: No messages available. */
     3224    29712    4               CALL XUR$ERRMSG (E_NOMORE);
     3225    29713    4           END;                       /* Do never ... end */
     3226    29714
     3227    29715
     3228    29716        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:112  
     3229    29717        /* Last message command */
     3230    29718    3       CASE(%CMD_LAST_MESSAGE);
     3231    29719    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE
     3232    29720    3           THEN
     3233    29721                    %INIT_STR (CODE=E_DI_LAST_CMD, STR=VM_DI_LAST_CMD,
     3234    29722                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     3235    29745    3           ELSE
     3236    29746                  %INIT_STR (CODE=E_LIST_LAST_CMD, STR=VM_LIST_LAST_CMD,
     3237    29747                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     3238    29770        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:113  
     3239    29771    3       CASE(%CMD_LINK);
     3240    29772    3           BLK$ = OUT$->P$B.SUBLK$(0);
     3241    29773    3           OPT_FID = BLK$->P$S.TEXT;
     3242    29774    3           IF OUT$->P$B.NSUBLKS = 2 THEN
     3243    29775    4           DO;                    /* Process the cc buffer for link     */
     3244    29776    4               LINK_CCBUF.L# = BLK$->P$S.COUNT;
     3245    29777    4               LINK_CCBUF.NAME# = BLK$->P$S.TEXT;
     3246    29778    4               BLK$ = OUT$->P$B.SUBLK$(1);
     3247    29779    4               IF BLK$ -> P$S.COUNT > 0
     3248    29780    4               THEN
     3249    29781    5               DO;
     3250    29782    5                   INDX4 = BLK$ -> P$S.COUNT + 1;
     3251    29783    5                   INDX3 = LINK_CCBUF.L#;
     3252    29784    5                   LINK_CCBUF.L# = LINK_CCBUF.L# + INDX4;
     3253    29785    5                   CALL INSERT(LINK_CCBUF.NAME#,INDX3,INDX4,' ',BLK$->P$S.TEXT);
     3254    29786    5               END;
     3255    29787    4               FPT_LINK.CP_CMD_ = VECTOR(LINK_CCBUF);
     3256    29788    4           END;
     3257    29789    3           ELSE
     3258    29790    3               FPT_LINK.CP_CMD_ = VECTOR(NIL);
     3259    29791
     3260    29792    3           CALL LINK_RUNIT;
     3261    29793    3           FPT_LINK.PSID_ = VECTOR(NIL);
     3262    29794    3           FPT_LINK.PASS_ = VECTOR(NIL);
     3263    29795    3           FPT_LINK.CP_CMD_ = VECTOR(NIL);
     3264    29796        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:114  
     3265    29797        /* List folder command */
     3266    29798    3       CASE (%CMD_LIST_FOLDER,%CMD_DISPLAY_FOLDER);
     3267    29799        /*
     3268    29800             ***** Stash the profile for the current folder.
     3269    29801                   Need to get the profile for each folder to display ...
     3270    29802        */
     3271    29803    3           IF VM_CURRENT_FOLDER.FLAGS.UPDATE
     3272    29804    3           THEN
     3273    29805    4           DO;
     3274    29806    4               CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(WRITE_ERROR);
     3275    29807    4           END;
     3276    29808    3           FOLDER_WAS_OPEN = VM_CURRENT_FOLDER.FLAGS.OPEN;
     3277    29809    3           VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B; /* This keeps
     3278    29810                                           a bad profile record being written if we get
     3279    29811                                           ctl-y or otherwise xconed. */
     3280    29812    3           BREAK_TYPE = CURR_COMMAND_CODE;
     3281    29813        /*
     3282    29814             ***** Look at folders in the user's file directory acct ...
     3283    29815        */
     3284    29816    3           INDX2 = 0;                  /* Used as counter */
     3285    29817    3           VM_RADDRESS.ACCT = VM_CENTRAL_FOLDER.ACCT;
     3286    29818    3           VM_RADDRESS.FOLDER = '?';   /* Default is everything */
     3287    29819    3           VM_RADDRESS.PASS = ' ';
     3288    29820    3           VM_RADDRESS.SITENAME = ' ';
     3289    29821    3           VM_RADDRESS.TYPE = %VM_ADD_RESOLVED;
     3290    29822    3           IF OUT$ -> P$B.NSUBLKS ~= 0
     3291    29823    4           THEN DO;
     3292    29824        /*
     3293    29825                ***** Handle output clause, if any ...
     3294    29826        */
     3295    29827    4               BLK$ = OUT$ -> P$B.SUBLK$ (OUT$ -> P$B.NSUBLKS - 1);
     3296    29828    4               IF BLK$ -> P$B.CODE = %OPT_OUTPUT
     3297    29829    5               THEN DO;
     3298    29830    5                   CALL XUR$OPENOUT (M$OUT_NUM, BLK$ -> P$B)
     3299    29831    6                   WHENRETURN DO;
     3300    29832    6                       OUTDCB = M$OUT_NUM;
     3301    29833    6                   END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:115  
     3302    29834    6                   WHENALTRETURN DO;
     3303    29835    6                       CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);
     3304    29836    6                       GOTO END_LI_FOLDER;
     3305    29837    6                   END;
     3306    29838    5                   IF OUT$ -> P$B.NSUBLKS = 1
     3307    29839    5                   THEN            /* No listname specified */
     3308    29840    5                       GOTO LI_FOLD_ALL;
     3309    29841    5               END;
     3310    29842    4               BLK$ = OUT$ -> P$B.SUBLK$(0);
     3311    29843        /*
     3312    29844             ***** Repeat this loop once for each piece of the address ...
     3313    29845        */
     3314    29846    5               DO INDX1 = 0 TO BLK$ -> P$B.NSUBLKS - 1;
     3315    29847    5                   PTR1$ = BLK$ -> P$B.SUBLK$(INDX1);
     3316    29848    6                   DO CASE (PTR1$ -> P$B.CODE);
     3317    29849    6                   CASE (%ADD_ACCT);
     3318    29850    6                       VM_RADDRESS.ACCT = PTR1$ -> P$S.TEXT;
     3319    29851    6                   CASE (%ADD_FOLDER);
     3320    29852    6                       VM_RADDRESS.FOLDER = PTR1$ -> P$S.TEXT;
     3321    29853    6                   CASE (%ADD_NAME);
     3322    29854    6                       CALL XUR$ERRMSG (E_NAMENTALLOWED);
     3323    29855    6                       GOTO CONTINUE;
     3324    29856    6                   CASE (%ADD_PASS);
     3325    29857    6                       VM_RADDRESS.PASS = PTR1$ -> P$S.TEXT;
     3326    29858    6                   END;       /* Do case ... end */
     3327    29859    5               END;             /* Do INDX1 = ... end */
     3328    29860    4           END;                  /* Pick up options */
     3329    29861    3   LI_FOLD_ALL:
     3330    29862    3           FID_ACCT.ACCT# = VM_RADDRESS.ACCT;
     3331    29863    3           FID_PASS.PASS# = VM_RADDRESS.PASS;
     3332    29864    3           CLOSE_SAVE.V.DCB# = M$WORK_NUM;
     3333    29865        /*
     3334    29866             ***** Wildcard specified ???
     3335    29867        */
     3336    29868    3           IF VM_RADDRESS.FOLDER = 'CENTRAL'
     3337    29869    3           THEN                       /* Supply name of central folder */
     3338    29870    3               VM_RADDRESS.FOLDER = VM_CENTRAL_FOLDER.FOLDER;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:116  
     3339    29871    3           WILDCARD_PATTERN = VM_RADDRESS.FOLDER;
     3340    29872    3           CALL INDEX(INDX1,'?',WILDCARD_PATTERN)
     3341    29873    4           WHENRETURN DO;
     3342    29874    4               WILD = %YES#;
     3343    29875    4           END;
     3344    29876    4           WHENALTRETURN DO;
     3345    29877    4               WILD = %NO#;
     3346    29878    4           END;
     3347    29879    3           CALL INDEX(INDX1,' ',WILDCARD_PATTERN);
     3348    29880    3           VM_WILDCARD.PATTERN_ = VECTOR(SUBSTR(WILDCARD_PATTERN,0,INDX1));
     3349    29881    3           OPEN_NEXT.NAME_ = VECTOR(FID_NAME);
     3350    29882    3           FID_NAME.NAME# = ':MAIL_';
     3351    29883    3           FID_NAME.L# = LENGTHC(':MAIL_');
     3352    29884    4           DO NEVER;
     3353    29885    4   LI_FOLD_ERR1:
     3354    29886    4               CALL XUR$ERRMSG (E_FOLDEROLD, M$WORK_NUM);
     3355    29887    4           END/*NEVER*/;
     3356    29888    3           CALL GET_WILD_FOLDER ALTRET(END_LI_FOLDER);
     3357    29889    3           CALL VMD$GET_PROFILE (M$WORK_NUM) ALTRET(LI_FOLD_ERR1);
     3358    29890        /*
     3359    29891             ***** Print the header ...
     3360    29892        */
     3361    29893    3           CALL M$TIME (GET_TIME);
     3362    29894                %INIT_STR (CODE=E_FOLDER_HEADER1_FMT, STR=VM_FOLDER_HEADER1_FMT,
     3363    29895                VECT="F_FDSLO.FMT_", TEST=YES);
     3364    29918    3           VECT_ARRAY(0) = VECTOR(WORK_UTS);
     3365    29919    3           VECT_ARRAY(1) = VECTOR(FID_ACCT.ACCT#);
     3366    29920    3           F_FDSLO.NVECS# = 2;
     3367    29921    3           F_FDSLO.DCB# = OUTDCB;
     3368    29922    3           CALL VMD$WRITE_BUF (F_FDSLO);
     3369    29923    3           F_FDSLO.NVECS# = 0;
     3370    29924                %INIT_STR (CODE=E_FOLDER_HEADER2_FMT, STR= VM_FOLDER_HEADER2_FMT,
     3371    29925                VECT="F_FDSLO.FMT_", TEST=YES);
     3372    29948    3           CALL VMD$WRITE_BUF (F_FDSLO);
     3373    29949    3           CALL VMD$DI_FOLDER (VM_WORK_FOLDER,OUTDCB);
     3374    29950    3           OPEN_NEXT.NAME_ = VECTOR(NIL);
     3375    29951    3           INDX2 = 1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:117  
     3376    29952        /*
     3377    29953             ***** If wildcard specified, loop to process other matches ...
     3378    29954        */
     3379    29955    4           DO WHILE WILD;
     3380    29956    5               DO NEVER;
     3381    29957    5   LI_FOLD_ERR2:   ;
     3382    29958    5                   CALL XUR$ERRMSG (E_FOLDEROLD, M$WORK_NUM);
     3383    29959    5               END/*NEVER*/;
     3384    29960    4               CALL GET_WILD_FOLDER ALTRET(END_LI_FOLDER);
     3385    29961    4               CALL VMD$GET_PROFILE (M$WORK_NUM) ALTRET(LI_FOLD_ERR2);
     3386    29962    4               CALL VMD$DI_FOLDER (VM_WORK_FOLDER,OUTDCB);
     3387    29963    4               INDX2 = INDX2 + 1;
     3388    29964    4           END/*WHILE WILD*/;
     3389    29965        /*
     3390    29966             ***** Get the profile for the current folder ...
     3391    29967        */
     3392    29968    3   END_LI_FOLDER:
     3393    29969    3           VM_CURRENT_FOLDER.FLAGS.OPEN = FOLDER_WAS_OPEN;
     3394    29970    3           IF DCBADDR(M$WORK_NUM) -> F$DCB.FCD#
     3395    29971    3           THEN                       /* Close it */
     3396    29972    3               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     3397    29973    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN
     3398    29974    3           THEN
     3399    29975    3               CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);
     3400    29976    3           BREAK_TYPE = 0;
     3401    29977    3           CALL REPORT_ACTIVITY (INDX2,VM_FOLDER_DISPLAYED_FMT,%NO#,
             29977                    E_FOLDER_DISPLAYED_FMT);
     3402    29978        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:118  
     3403    29979        /* List command */
     3404    29980    3       CASE (%CMD_LIST_MESSAGE);
     3405    29981    3           CALL NEED_FOLDER ALTRET(CONTINUE);
     3406    29982    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;
     3407    29983    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);
     3408    29984    5               DO CASE (BLK$ -> P$B.CODE);
     3409    29985    5               CASE (%OPT_SELECT);
     3410    29986    5                   CALL INIT$SELECT_OPTS (BLK$,%CMD_LIST_MESSAGE) ALTRET(CONTINUE);
     3411    29987    5               CASE (%OPT_OUTPUT);
     3412    29988    5                   CALL XUR$OPENOUT (M$OUT_NUM, BLK$ -> P$B)
     3413    29989    6                   WHENRETURN DO;
     3414    29990    6                       OUTDCB = M$OUT_NUM;
     3415    29991    6                   END;
     3416    29992    6                   WHENALTRETURN DO;
     3417    29993    6                       CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);
     3418    29994    6                       GOTO CONTINUE;
     3419    29995    6                   END;
     3420    29996    5               END;
     3421    29997    4           END;
     3422    29998    3           LAST_COMMAND_CODE = %CMD_LIST_MESSAGE;
     3423    29999
     3424    30000    3           INDX1 = 0;                  /* Used as counter */
     3425    30001    3           EJECT = VM_PROFILE.OPT.PAGE;
     3426    30002
     3427    30003    4           DO FOREVER;
     3428    30004
     3429    30005    4               CALL GET$MESSAGE ALTRET(END_LIST);
     3430    30006    4               IF EJECT
     3431    30007    5               THEN DO;
     3432    30008    5                   CALL VMD$EJECT (OUTDCB);
     3433    30009    5                   EJECT = %NO#;
     3434    30010    5               END;
     3435    30011    4               VM_PROFILE.HI_MESSAGE_NUMBER =
     3436    30012    4                 MAXIMUM( VM_PROFILE.HI_MESSAGE_NUMBER , CURRENT_MESSAGE_NUMBER );
     3437    30013    4               CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,OUTDCB);
     3438    30014    4               INDX1 = INDX1 + 1;
     3439    30015    4               IF VM_CURRENT_FOLDER.FLAGS.UPDATE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:119  
     3440    30016    4                 AND VM_HEADER.STATUS.MAKE_OLD = %NO#
     3441    30017    4                 AND VM_HEADER.STATUS.OLD = %NO#
     3442    30018    4               THEN
     3443    30019    5               DO;
     3444    30020    5                   CALL XUR$DISABLE;
     3445    30021    5                   VM_HEADER.STATUS.MAKE_OLD = %YES#;
     3446    30022    5                   CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM)
     3447    30023    5                     ;
     3448    30024    5                   VM_PROFILE.NUM_MOLD_MESSAGES = VM_PROFILE.NUM_MOLD_MESSAGES + 1;
     3449    30025    5                   MADE_OLD = %YES#;
     3450    30026    5                   CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(WRITE_ERROR);
     3451    30027    5                   CALL XUR$ENABLE;
     3452    30028    5               END;
     3453    30029    4           END;                       /* Do forever ... end */
     3454    30030    3   END_LIST:
     3455    30031    3           IF INDX1 ~= 1 OR NOT DCBADDR(OUTDCB) -> F$DCB.DDEV.UCOUT#
     3456    30032    3           THEN
     3457    30033    3               CALL REPORT_ACTIVITY (INDX1,VM_MSGS_LISTED_FMT,%YES#,E_MSGS_LISTED_FMT);
     3458    30034        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:120  
     3459    30035        /* Mark command */
     3460    30036    3       CASE(%CMD_MARK_MESSAGE);
     3461    30037    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     3462    30038    3           IF OUT$ -> P$B.NSUBLKS > 0
     3463    30039    3           THEN                       /* There are options */
     3464    30040    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_MARK_MESSAGE) ALTRET(
             30040                        CONTINUE);
     3465    30041    3           INDX1 = 0;                  /* Used as counter */
     3466    30042    3           NONE = %YES#;
     3467    30043    4           DO FOREVER;
     3468    30044    4               CALL GET$MESSAGE ALTRET(END_MARK);
     3469    30045    4               NONE = %NO#;
     3470    30046
     3471    30047    4               IF VM_PROFILE.OPT.HEADERS
     3472    30048    4               THEN
     3473    30049    4                   CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,M$LO_NUM);
     3474    30050
     3475    30051    4               IF VM_HEADER.STATUS.MARK = %NO#
     3476    30052    4               THEN                 /* Mark it now */
     3477    30053    5               DO;
     3478    30054    5                   CALL XUR$DISABLE;
     3479    30055    5                   VM_HEADER.STATUS.MARK = %YES#;
     3480    30056    5                   CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM);
     3481    30057    5                   CALL XUR$ENABLE;
     3482    30058    5                   INDX1 = INDX1 + 1;
     3483    30059    5               END;
     3484    30060    4           END;                       /* Do forever ... end  */
     3485    30061
     3486    30062    3   END_MARK: ;
     3487    30063    3           CALL REPORT_ACTIVITY (INDX1,VM_MSGS_MARKED_FMT,NONE,E_MSGS_MARKED_FMT);
     3488    30064
     3489    30065        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:121  
     3490    30066        /* Modify list command */
     3491    30067    3       CASE (%CMD_MODIFY_LIST);
     3492    30068    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     3493    30069        /*
     3494    30070             ***** Pickup the name of the list to modify ...
     3495    30071        */
     3496    30072    3           VM_LISTKEY.TEXT = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;
     3497    30073    3           CALL VMA$GET_LIST (VM_LISTKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)
     3498    30074    3           WHENALTRETURN
     3499    30075    4           DO;
     3500    30076    4               CALL XUR$ERRMSG(E_UNDEFENTRY);
     3501    30077    4               GOTO MOD_CASE_END;
     3502    30078        /*
     3503    30079             ***** Report that the specified list does not exist ...
     3504    30080        */
     3505    30081    4           END;
     3506    30082        /*
     3507    30083             ***** Now prompt for sub-commands ...
     3508    30084        */
     3509    30085    4           DO FOREVER;
     3510    30086    4   REPARSE:
     3511    30087                    %INIT_STR (CODE=E_MODIFY_LIST_PROMPT, STR=VM_MODIFY_LIST_PROMPT, TEST=
             30087                        YES);
     3512    30110    4               CALL XUR$GETCMD(MODIFY_LIST$->BSD,OUT$,
     3513    30111    4                 VECTOR(SUBSTR(VM_MODIFY_LIST_PROMPT.NAME#,0,VM_MODIFY_LIST_PROMPT.L#))
             30111                          )
     3514    30112    5               WHENALTRETURN DO;
     3515    30113    5                   CALL XUR$ERRPTR;
     3516    30114    5                   CALL XUR$ERRMSG (OUTERR);
     3517    30115    5                   GOTO REPARSE;
     3518    30116    5               END;
     3519    30117        /*
     3520    30118             ***** Initialize ...
     3521    30119        */
     3522    30120    4               ADDRESS_ACCT.ACCT# = ' ';
     3523    30121    4               ADDRESS_NAME.L# = 0;
     3524    30122    4               ADDRESS_NAME.NAME# = ' ';
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:122  
     3525    30123    4               ADDRESS_FOLDER = ' ';
     3526    30124    4               ADDRESS_PASS.PASS# = ' ';
     3527    30125    4               ADDRESS_SITENAME = ' ';
     3528    30126    4               DOMAIN$ = ADDR(NIL);
     3529    30127    4               IF OUT$ -> P$B.NSUBLKS = 0
     3530    30128    4               THEN
     3531    30129    4                   GOTO PROCESS_MODLIST_SUBC;
     3532    30130        /*
     3533    30131             ***** Repeat this loop once for each piece of the address ...
     3534    30132        */
     3535    30133    4               PTR2$ = OUT$ -> P$B.SUBLK$(0); /* Ptr to OPT_ADDRESS */
     3536    30134    5               DO INDX3 = 0 TO PTR2$ -> P$B.NSUBLKS - 1;
     3537    30135    5                   PTR3$ = PTR2$ -> P$B.SUBLK$(INDX3);
     3538    30136    6                   DO CASE (PTR3$ -> P$B.CODE);
     3539    30137    6                   CASE (%ADD_ACCT);
     3540    30138    6                       ADDRESS_ACCT.ACCT# = PTR3$ -> P$S.TEXT;
     3541    30139    6                   CASE (%ADD_FOLDER);
     3542    30140    6                       ADDRESS_FOLDER = PTR3$ -> P$S.TEXT;
     3543    30141    6                   CASE (%ADD_NAME);
     3544    30142    6                       ADDRESS_NAME.NAME# = PTR3$ -> P$S.TEXT;
     3545    30143    6                       ADDRESS_NAME.L# = PTR3$ -> P$S.COUNT;
     3546    30144    6                   CASE (%ADD_PASS);
     3547    30145    6                       ADDRESS_PASS.PASS# = PTR3$ -> P$S.TEXT;
     3548    30146    6                   CASE (%ADD_SITE);
     3549    30147    6                       ADDRESS_SITENAME = PTR3$ -> P$S.TEXT;
     3550    30148    6                   CASE (%ADD_DOMAIN);
     3551    30149    6                       DOMAIN$ = PTR3$;
     3552    30150    6                   END;            /* Do case ... end */
     3553    30151    5               END;                  /* Do INDX3 = ... end */
     3554    30152    4               CALL TRANSFORM_DOMAIN (DOMAIN$, ADDRESS_SITENAME, ADDRESS_NAME)
     3555    30153    4                 ALTRET (REPARSE);
     3556    30154        /*
     3557    30155             ***** Now process the sub-command ...
     3558    30156        */
     3559    30157    4   PROCESS_MODLIST_SUBC:
     3560    30158    5               DO CASE (OUT$ -> P$B.CODE);
     3561    30159    5               CASE(%MODIFY_BLANK);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:123  
     3562    30160    5               CASE (%MODIFY_ADD);
     3563    30161    5                   IF ADDRESS_NAME.L# ~= 0
     3564    30162    5                   THEN           /* Store as unresolved address */
     3565    30163    5                       CALL VMA$ADD_UENTRY_SORTED (ADDRESS_NAME,
     3566    30164    5                         ADDRESS_FOLDER,ADDRESS_PASS,ADDRESS_SITENAME) ALTRET(E_PMME);
     3567    30165    5                   ELSE           /* Store as resolved address */
     3568    30166    5                       CALL VMA$ADD_RENTRY_SORTED (ADDRESS_ACCT,
     3569    30167    5                         ADDRESS_FOLDER,ADDRESS_PASS,ADDRESS_SITENAME) ALTRET(E_PMME);
     3570    30168    5               CASE (%MODIFY_DEL);
     3571    30169    5                   IF ADDRESS_NAME.L# ~= 0
     3572    30170    5                   THEN           /* Store as unresolved address */
     3573    30171    6                   DO;
     3574    30172    6                       SUBSTR(WORK_STRING.NAME#,0,ADDRESS_NAME.L#) =
     3575    30173    6                         SUBSTR(ADDRESS_NAME.NAME#,0,ADDRESS_NAME.L#);
     3576    30174    6                       CALL XLATE(SUBSTR(ADDRESS_NAME.NAME#,0,ADDRESS_NAME.L#),
     3577    30175    6                         LOWER_UPPER,SUBSTR(WORK_STRING.NAME#,0,ADDRESS_NAME.L#));
     3578    30176    6                       CALL VMA$DEL_UENTRY (ADDRESS_NAME,
     3579    30177    6                         ADDRESS_FOLDER,ADDRESS_PASS,ADDRESS_SITENAME) ALTRET(
             30177                                  E_MODLIST_DEL);
     3580    30178    6                   END;
     3581    30179    5                   ELSE           /* Store as resolved address */
     3582    30180    5                       CALL VMA$DEL_RENTRY (ADDRESS_ACCT,
     3583    30181    5                         ADDRESS_FOLDER,ADDRESS_PASS,ADDRESS_SITENAME)
     3584    30182    5                       WHENALTRETURN
     3585    30183    6                       DO;
     3586    30184    6   E_MODLIST_DEL:
     3587    30185    6                           CALL XUR$ERRMSG (E_UNDEFENTRY);
     3588    30186    6                       END;
     3589    30187    5               CASE (%MODIFY_DI);
     3590    30188    5                   CALL VMD$DI_LIST (VM_LISTKEY,M$ME_NUM);
     3591    30189    5               CASE (%MODIFY_END);
     3592    30190    5                   GOTO END_MOD_LIST;
     3593    30191    5               END;                  /* Do case ... end */
     3594    30192    4           END;                       /* Do forever ... end */
     3595    30193    3   END_MOD_LIST:
     3596    30194    3           CALL VMA$PUT_LIST (VM_LISTKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(E_PMME);
     3597    30195    3   MOD_CASE_END:;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:124  
     3598    30196        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:125  
     3599    30197        /* Modify user command */
     3600    30198    3       CASE (%CMD_MODIFY_USER);
     3601    30199    3           CALL NEED_GLOBAL ALTRET(CONTINUE);
     3602    30200        /*
     3603    30201             ***** Pickup the name of the user to modify ...
     3604    30202        */
     3605    30203    3           TEMPBUF = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;
     3606    30204    3           SIZE = OUT$ -> P$B.SUBLK$(0) -> P$S.COUNT;
     3607    30205    3           VM_USERKEY.TEXT = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;
     3608    30206    3           CALL VMA$GET_LIST (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)
     3609    30207    4           WHENALTRETURN DO;
     3610    30208    4               CALL XUR$ERRMSG(E_UNDEFENTRY);
     3611    30209    4               GOTO CONTINUE;
     3612    30210    4           END;
     3613    30211        /*
     3614    30212             ***** Now prompt for sub-commands ...
     3615    30213        */
     3616    30214    3           CLOSE_SAVE.V.DCB# = DCBNUM(M$NAME);
     3617    30215                %INIT_STR (CODE=E_MODIFY_USER_PROMPT, STR=VM_MODIFY_USER_PROMPT, TEST=YES);
     3618    30238    4           DO FOREVER;
     3619    30239    4   REPARSE_USER:
     3620    30240    4               CALL XUR$GETCMD(MODIFY_USER$->BSD,OUT$,
     3621    30241    4                 VECTOR(SUBSTR(VM_MODIFY_USER_PROMPT.NAME#,0,VM_MODIFY_USER_PROMPT.L#))
             30241                          )
     3622    30242    5               WHENALTRETURN DO;
     3623    30243    5                   CALL XUR$ERRPTR;
     3624    30244    5                   CALL XUR$ERRMSG (OUTERR);
     3625    30245    5                   GOTO REPARSE_USER;
     3626    30246    5               END;
     3627    30247        /*
     3628    30248             ***** Get address parts for subcommand, if any ...
     3629    30249        */
     3630    30250    4               IF OUT$ -> P$B.NSUBLKS > 0
     3631    30251    5               THEN DO;
     3632    30252    5                   ADDRESS_ACCT.ACCT# = ' ';
     3633    30253    5                   ADDRESS_NAME.L# = 0;
     3634    30254    5                   ADDRESS_NAME.NAME# = ' ';
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:126  
     3635    30255    5                   ADDRESS_FOLDER = ' ';
     3636    30256    5                   ADDRESS_PASS.PASS# = ' ';
     3637    30257    5                   ADDRESS_LACCN.ACCT# = ' ';
     3638    30258    5                   ADDRESS_LUNAME = ' ';
     3639    30259    5                   ADDRESS_SITENAME = VM_SITENAME;
     3640    30260    5                   DOMAIN$ = ADDR(NIL);
     3641    30261        /*
     3642    30262             ***** Repeat this loop once for each piece of the address ...
     3643    30263        */
     3644    30264    5                   BLK$ = OUT$ -> P$B.SUBLK$(0);
     3645    30265    6                   DO INDX2 = 0 TO BLK$ -> P$B.NSUBLKS - 1;
     3646    30266    6                       PTR2$ = BLK$ -> P$B.SUBLK$(INDX2);
     3647    30267    7                       DO CASE (PTR2$ -> P$B.CODE);
     3648    30268    7                       CASE (%ADD_ACCT);
     3649    30269    7                           ADDRESS_LACCN.ACCT# = PTR2$ -> P$S.TEXT;
     3650    30270    7                       CASE (%ADD_UNAME);
     3651    30271    7                           ADDRESS_LUNAME = PTR2$ -> P$S.TEXT;
     3652    30272    7                       CASE (%ADD_ADDRESS);
     3653    30273    8                           DO INDX3 = 0 TO PTR2$ -> P$B.NSUBLKS - 1;
     3654    30274    8                               PTR3$ = PTR2$ -> P$B.SUBLK$(INDX3);
     3655    30275    9                               DO CASE (PTR3$ -> P$B.CODE);
     3656    30276    9                               CASE (%ADD_ACCT);
     3657    30277    9                                   ADDRESS_ACCT.ACCT# = PTR3$ -> P$S.TEXT;
     3658    30278    9                               CASE (%ADD_FOLDER);
     3659    30279    9                                   ADDRESS_FOLDER = PTR3$ -> P$S.TEXT;
     3660    30280    9                               CASE (%ADD_NAME);
     3661    30281    9                                   ADDRESS_NAME.NAME# = PTR3$ -> P$S.TEXT;
     3662    30282    9                                   ADDRESS_NAME.L# = PTR3$ -> P$S.COUNT;
     3663    30283    9                               CASE (%ADD_PASS);
     3664    30284    9                                   ADDRESS_PASS.PASS# = PTR3$ -> P$S.TEXT;
     3665    30285    9                               CASE (%ADD_SITE);
     3666    30286    9                                   ADDRESS_SITENAME = PTR3$ -> P$S.TEXT;
     3667    30287    9                               CASE (%ADD_DOMAIN);
     3668    30288    9                                   DOMAIN$ = PTR3$;
     3669    30289    9                               END;
     3670    30290    8                           END;
     3671    30291    7                       END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:127  
     3672    30292    6                   END;
     3673    30293    5                   CALL TRANSFORM_DOMAIN (DOMAIN$, ADDRESS_SITENAME, ADDRESS_NAME)
     3674    30294    5                     ALTRET (REPARSE_USER);
     3675    30295    5                   IF ADDRESS_ACCT.ACCT# = ' '
     3676    30296    5                   THEN
     3677    30297    5                       ADDRESS_ACCT.ACCT# = ADDRESS_LACCN.ACCT#;
     3678    30298    5                   ELSE
     3679    30299    5                       IF ADDRESS_LACCN.ACCT# = ' '
     3680    30300    5                       THEN
     3681    30301    5                           ADDRESS_LACCN.ACCT# = ADDRESS_ACCT.ACCT#;
     3682    30302    5               END;
     3683    30303        /*
     3684    30304             ***** Now process the sub-command ...
     3685    30305        */
     3686    30306    5               DO CASE (OUT$ -> P$B.CODE);
     3687    30307    5               CASE(%MODIFY_BLANK);
     3688    30308    5               CASE (%MODIFY_ADD);
     3689    30309        /*
     3690    30310             ***** Store the reverse name map info if available ...
     3691    30311        */
     3692    30312    5                   IF ADDRESS_LACCN.ACCT# ~= ' '
     3693    30313    5                     AND (ADDRESS_SITENAME = VM_SITENAME OR ADDRESS_SITENAME = ' ')
     3694    30314    6                   THEN DO;              /* Info avail */
     3695    30315    6                       CALL XUR$DISABLE;
     3696    30316    6                       CALL M$OPEN (OPEN_NAME_MAP) ALTRET(E_PMME);
     3697    30317    6                       CALL CONCAT (NAME_KEY.NAME#,ADDRESS_LACCN.ACCT#,
     3698    30318    6                         ADDRESS_LUNAME);
     3699    30319    6                       NAME_KEY.L# = 20;
     3700    30320    6                       WRITE_NAME_MAP.BUF_ = VECTOR (SUBSTR(TEMPBUF,0,SIZE));
     3701    30321        /*
     3702    30322             ***** Check if this NAME_MAP entry already exists.
     3703    30323                   If it does, then error!!!
     3704    30324        */
     3705    30325    6                       CALL M$READ (READ_NAME_MAP)
     3706    30326    7                       WHENRETURN DO;
     3707    30327    7                           IF VM_USERKEY.TEXT ~= SUBSTR (WORK_STRING.NAME#, 0,
     3708    30328    7                             DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS#)
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:128  
     3709    30329    8                           THEN DO;
     3710    30330    8                               IF DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS# <= 21
     3711    30331    8                               THEN
     3712    30332    8                                   WORK_STRING.L# =
     3713    30333    8                                     DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS#;
     3714    30334    9                               ELSE DO;
     3715    30335    9                                   WORK_STRING.L# = 31;
     3716    30336    9                                   SUBSTR (WORK_STRING.NAME#,28,3) = '...';
     3717    30337    9                               END;
     3718    30338    8                               CALL XUR$ERRMSG (E_NMENTRYEXISTS,,,
     3719    30339    8                                 VECTOR(NAME_KEY),VECTOR(WORK_STRING));
     3720    30340    8                               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     3721    30341    8                               CALL XUR$ENABLE;
     3722    30342    8                               GOTO REPARSE_USER;
     3723    30343    8                           END;
     3724    30344    7                       END;
     3725    30345    6                       CALL M$WRITE (WRITE_NAME_MAP) ALTRET(E_PMME);
     3726    30346    6                       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     3727    30347    6                       CALL XUR$ENABLE;
     3728    30348    6                   END;
     3729    30349    6                   ELSE DO;
     3730    30350    6                       NAME_KEY.L# = 0;
     3731    30351    6                       NAME_KEY.NAME# = ' ';
     3732    30352    6                   END;
     3733    30353        /*
     3734    30354             ***** Add this entry to the user list ...
     3735    30355        */
     3736    30356    5                   IF ADDRESS_NAME.L# ~= 0
     3737    30357    6                   THEN DO;              /* Store as unresolved address */
     3738    30358    6                       CALL VMA$ADD_UENTRY_SORTED (ADDRESS_NAME,ADDRESS_FOLDER,
     3739    30359    6                         ADDRESS_PASS,ADDRESS_SITENAME,%NO#,NAME_KEY.NAME#)
     3740    30360    6                         ALTRET(E_PMME);
     3741    30361    6                   END;
     3742    30362    6                   ELSE DO;              /* Store as resolved address */
     3743    30363    6                       CALL VMA$ADD_RENTRY_SORTED (ADDRESS_ACCT,ADDRESS_FOLDER,
     3744    30364    6                         ADDRESS_PASS,ADDRESS_SITENAME,%NO#,NAME_KEY.NAME#)
     3745    30365    6                         ALTRET(E_PMME);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:129  
     3746    30366    6                   END;
     3747    30367    5               CASE (%MODIFY_DEL);
     3748    30368    5                   CALL CONCAT (NAME_KEY.NAME#,ADDRESS_LACCN.ACCT#,ADDRESS_LUNAME);
     3749    30369    5                   IF ADDRESS_NAME.L# ~= 0
     3750    30370    6                   THEN DO;         /* Delete unresolved address */
     3751    30371    6                       SUBSTR(WORK_STRING.NAME#,0,ADDRESS_NAME.L#) =
     3752    30372    6                         SUBSTR(ADDRESS_NAME.NAME#,0,ADDRESS_NAME.L#);
     3753    30373    6                       CALL XLATE(SUBSTR(ADDRESS_NAME.NAME#,0,ADDRESS_NAME.L#),
     3754    30374    6                         LOWER_UPPER,SUBSTR(WORK_STRING.NAME#,0,ADDRESS_NAME.L#));
     3755    30375    6                       CALL VMA$DEL_UENTRY (ADDRESS_NAME,ADDRESS_FOLDER,ADDRESS_PASS,
     3756    30376    6                         ADDRESS_SITENAME,%NO#,NAME_KEY.NAME#) ALTRET(E_MODUSER_DEL);
     3757    30377    6                   END;
     3758    30378    5                   ELSE             /* Delete resolved address */
     3759    30379    5                       CALL VMA$DEL_RENTRY (ADDRESS_ACCT,ADDRESS_FOLDER,ADDRESS_PASS,
     3760    30380    5                         ADDRESS_SITENAME,%NO#,NAME_KEY.NAME#)
     3761    30381    6                       WHENALTRETURN DO;
     3762    30382    6   E_MODUSER_DEL:
     3763    30383    6                           CALL XUR$ERRMSG (E_UNDEFENTRY);
     3764    30384    6                           GOTO REPARSE_USER;
     3765    30385    6                       END;
     3766    30386        /*
     3767    30387             ***** Delete the reverse name map info if present ...
     3768    30388        */
     3769    30389    5                   IF ADDRESS_LACCN.ACCT# ~= ' '
     3770    30390    5                     AND (ADDRESS_SITENAME = VM_SITENAME OR ADDRESS_SITENAME = ' ')
     3771    30391    6                   THEN DO;              /* Info avail */
     3772    30392    6                       CALL XUR$DISABLE;
     3773    30393    6                       CALL M$OPEN (OPEN_NAME_MAP) ALTRET(E_PMME);
     3774    30394    6                       CALL CONCAT (NAME_KEY.NAME#,ADDRESS_LACCN.ACCT#,
     3775    30395    6                         ADDRESS_LUNAME);
     3776    30396    6                       NAME_KEY.L# = 20;
     3777    30397    7                       CALL M$DELREC (DELREC_NAME_MAP) WHENALTRETURN DO; END;
     3778    30398    6                       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     3779    30399    6                       CALL XUR$ENABLE;
     3780    30400    6                   END;
     3781    30401    5               CASE (%MODIFY_DI);
     3782    30402    5                   CALL VMD$DI_USER (VM_USERKEY,M$ME_NUM);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:130  
     3783    30403    5               CASE (%MODIFY_END);
     3784    30404    5                   GOTO END_MOD_USER;
     3785    30405    5               END;
     3786    30406    4           END;
     3787    30407    3   END_MOD_USER:
     3788    30408    3           CALL VMA$PUT_LIST (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(E_PMME);
     3789    30409        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:131  
     3790    30410        /* Next command */
     3791    30411    3       CASE (%CMD_NEXT_MESSAGE);
     3792    30412
     3793    30413    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE
     3794    30414    3           THEN
     3795    30415                    %INIT_STR (CODE=E_DI_NEXT_CMD, STR=VM_DI_NEXT_CMD,
     3796    30416                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     3797    30439    3           ELSE
     3798    30440                  %INIT_STR (CODE=E_LIST_NEXT_CMD, STR=VM_LIST_NEXT_CMD,
     3799    30441                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     3800    30464
     3801    30465        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:132  
     3802    30466        /* Output command */
     3803    30467    3       CASE (%CMD_OUTPUT);
     3804    30468    3           CALL XUR$OPENOUT (M$LO_NUM, OUT$ -> P$B)
     3805    30469    4           WHENALTRETURN DO;
     3806    30470    4               CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$LO_NUM);
     3807    30471    4           END;
     3808    30472        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:133  
     3809    30473        /* Page command */
     3810    30474    3       CASE (%CMD_PAGE);
     3811    30475    3           CALL VMD$EJECT(M$LO_NUM) ALTRET(E_PMME);
     3812    30476        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:134  
     3813    30477                                                /* Print command */
     3814    30478    3       CASE (%CMD_PRINT);
     3815    30479    3           CALL M$LDEV (PRINT_LDEV) ALTRET(E_PMME);
     3816    30480        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:135  
     3817    30481        /* Previous message command */
     3818    30482    3       CASE(%CMD_PREVIOUS_MESSAGE);
     3819    30483    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE
     3820    30484    3           THEN
     3821    30485                    %INIT_STR (CODE=E_DI_PREVIOUS_CMD, STR=VM_DI_PREVIOUS_CMD,
     3822    30486                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     3823    30509    3           ELSE
     3824    30510                  %INIT_STR (CODE=E_LIST_PREVIOUS_CMD, STR=VM_LIST_PREVIOUS_CMD,
     3825    30511                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     3826    30534        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:136  
     3827    30535        /* Profile command */
     3828    30536    3       CASE (%CMD_PROFILE);
     3829    30537    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     3830    30538        /*
     3831    30539             ***** Copy current profile to work segment so it can be restored
     3832    30540                   if new record won't fit ...
     3833    30541        */
     3834    30542    3           IF VBOUND (VM_PROFILE_) > VBOUND (VM_WORK_)
     3835    30543    4           THEN DO;
     3836    30544    4               INDX1 = (VBOUND (VM_PROFILE_) - VBOUND (VM_WORK_)) / 4;
     3837    30545    4               CALL VMA$ENLARGE_SEGMENT (VM_WORK_,INDX1) ALTRET(E_PMME);
     3838    30546    4           END;
     3839    30547    3           INDX1 = VM_PROFILE.PROFILE_SIZE * 4;
     3840    30548    3           VM_WORK$ -> INDX1_CHARS = VM_PROFILE$ -> INDX1_CHARS;
     3841    30549        /*
     3842    30550             ***** Setup for dynamic allocation of WORK_AREA ...
     3843    30551        */
     3844    30552    3           X$MCB.WKSZ = VM_PROFILE.PROFILE_SIZE -
     3845    30553    3             POFFW(ADDR(VM_PROFILE.WORK_AREA),ADDR(VM_PROFILE));
     3846    30554    3           X$MCB.FREE_HEAD$ = VM_PROFILE.FREE$;
     3847    30555    3           X$MCB.SEGMENT_BASE$ = ADDR(VM_PROFILE.WORK_AREA);
     3848    30556    3           X$MCB.HI_SEGMENT$ = VM_PROFILE.NEXT$;
     3849    30557    3           X$MCB.TYPE = 0;
     3850    30558        /**/
     3851    30559    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;
     3852    30560
     3853    30561    4               BLK$ = OUT$ -> P$B.SUBLK$ (INDX1);
     3854    30562
     3855    30563    5               DO CASE (P$S.CODE);
     3856    30564
     3857    30565    5               CASE (%POPT_ANSWER);
     3858    30566    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_RECEIVERS
     3859    30567    5                   THEN
     3860    30568    5                       VM_PROFILE.OPT.ANS_RECEIVERS = %YES#;
     3861    30569    5                   ELSE
     3862    30570    5                       VM_PROFILE.OPT.ANS_RECEIVERS = %NO#;
     3863    30571
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:137  
     3864    30572    5               CASE (%POPT_DELATTACH);
     3865    30573    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3866    30574    5                   THEN          /* Yes specified */
     3867    30575    5                       VM_PROFILE.OPT.DEL_ON_DETACH = %YES#;
     3868    30576    5                   ELSE          /* No specified */
     3869    30577    5                       VM_PROFILE.OPT.DEL_ON_DETACH = %NO#;
     3870    30578
     3871    30579    5               CASE (%POPT_EXTADDRDISP);
     3872    30580    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3873    30581    5                   THEN          /* Yes specified */
     3874    30582    5                       VM_PROFILE.OPT.EXT_ADDR_DISP = %YES#;
     3875    30583    5                   ELSE          /* No specified */
     3876    30584    5                       VM_PROFILE.OPT.EXT_ADDR_DISP = %NO#;
     3877    30585
     3878    30586    5               CASE (%POPT_AUTOEDIT);
     3879    30587    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3880    30588    5                   THEN           /* Yes specified */
     3881    30589    5                       VM_PROFILE.OPT.AUTO_EDIT = %YES#;
     3882    30590    5                   ELSE           /* No specified */
     3883    30591    5                       VM_PROFILE.OPT.AUTO_EDIT = %NO#;
     3884    30592
     3885    30593    5               CASE (%POPT_COMBINE);
     3886    30594    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3887    30595    5                   THEN           /* Yes specified */
     3888    30596    5                       VM_PROFILE.OPT.COMBINE = %YES#;
     3889    30597    5                   ELSE           /* No specified */
     3890    30598    5                       VM_PROFILE.OPT.COMBINE = %NO#;
     3891    30599
     3892    30600    5               CASE (%POPT_DR);
     3893    30601    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3894    30602    5                   THEN           /* Yes specified */
     3895    30603    5                       VM_PROFILE.OPT.DELIVERY_RECEIPT = %YES#;
     3896    30604    5                   ELSE           /* No specified */
     3897    30605    5                       VM_PROFILE.OPT.DELIVERY_RECEIPT = %NO#;
     3898    30606
     3899    30607    5               CASE (%POPT_DISPTRACE);
     3900    30608    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:138  
     3901    30609    5                   THEN           /* Yes specified */
     3902    30610    5                       VM_PROFILE.OPT.DISPTRACE = %YES#;
     3903    30611    5                   ELSE           /* No specified */
     3904    30612    5                       VM_PROFILE.OPT.DISPTRACE = %NO#;
     3905    30613
     3906    30614    5               CASE (%POPT_GRANULES) ;
     3907    30615    5                   CALL CHARBIN(TEMP,P$B.SUBLK$(0)->P$S.TEXT);
     3908    30616    5                   VM_PROFILE.GRANULES = TEMP;
     3909    30617
     3910    30618    5               CASE (%POPT_HEADERS);
     3911    30619    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3912    30620    5                   THEN           /* Yes specified */
     3913    30621    5                       VM_PROFILE.OPT.HEADERS = %YES#;
     3914    30622    5                   ELSE           /* No specified */
     3915    30623    5                       VM_PROFILE.OPT.HEADERS = %NO#;
     3916    30624
     3917    30625    5               CASE (%POPT_FCOPY);
     3918    30626    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3919    30627    5                   THEN           /* Yes specified */
     3920    30628    5                       VM_PROFILE.OPT.FCOPY = %YES#;
     3921    30629    5                   ELSE           /* No specified */
     3922    30630    5                       VM_PROFILE.OPT.FCOPY = %NO#;
     3923    30631
     3924    30632    5               CASE (%POPT_PAGE);
     3925    30633    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3926    30634    5                   THEN           /* Yes specified */
     3927    30635    5                       VM_PROFILE.OPT.PAGE = %YES#;
     3928    30636    5                   ELSE           /* No specified */
     3929    30637    5                       VM_PROFILE.OPT.PAGE = %NO#;
     3930    30638
     3931    30639    5               CASE (%POPT_PREP);
     3932    30640    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3933    30641    5                   THEN           /* Yes specified */
     3934    30642    5                       VM_PROFILE.OPT.PREPROCESS = %YES#;
     3935    30643    5                   ELSE           /* No specified */
     3936    30644    5                       VM_PROFILE.OPT.PREPROCESS = %NO#;
     3937    30645
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:139  
     3938    30646    5               CASE (%POPT_RENUMBER);
     3939    30647    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3940    30648    5                   THEN           /* Yes specified */
     3941    30649    5                       VM_PROFILE.OPT.RENUMBER = %YES#;
     3942    30650    5                   ELSE           /* No specified */
     3943    30651    5                       VM_PROFILE.OPT.RENUMBER = %NO#;
     3944    30652    5               CASE (%POPT_FFOLDER);
     3945    30653    5                   IF VM_PROFILE.FILE_FOLDER$ = ADDR(NIL)
     3946    30654    5                   THEN
     3947    30655    6                   DO;        /* Allocate space */
     3948    30656    6                       X$MCB.SIZE = SIZEC(VM$RADDRESS);
     3949    30657    6                       CALL X$ALLOCATE (X$MCB) ALTRET(E_ALLOCATE);
     3950    30658    6                       VM_PROFILE.FILE_FOLDER$ = X$MCB.ADDRESS$;
     3951    30659    6                   END;
     3952    30660    5                   BLK$ = BLK$ -> P$B.SUBLK$(0); /* To account for OPT_MID */
     3953    30661    5                   IF BLK$->P$B.CODE = %OPT_NONE
     3954    30662    6                   THEN DO;
     3955    30663    6                       X$MCB.ADDRESS$ = VM_PROFILE.FILE_FOLDER$;
     3956    30664    6                       CALL X$DEALLOCATE (X$MCB) ALTRET(E_ALLOCATE);
     3957    30665    6                       VM_PROFILE.FILE_FOLDER$ = ADDR(NIL);
     3958    30666    6                   END;
     3959    30667    6                   ELSE DO;
     3960    30668    6                       VM_RADDRESS.ACCT = VM_CURRENT_FOLDER.ACCT;
     3961    30669    6                       VM_RADDRESS.FOLDER = VM_CURRENT_FOLDER.FOLDER;
     3962    30670    6                       VM_RADDRESS.PASS = VM_CURRENT_FOLDER.PASS;
     3963    30671    6                       VM_RADDRESS.SITENAME = VM_CURRENT_FOLDER.SITENAME;
     3964    30672    6                       VM_RADDRESS.NEXT$ = ADDR(NIL);
     3965    30673    6                       VM_RADDRESS.PREV$ = ADDR(NIL);
     3966    30674    6                       VM_RADDRESS.FLAGS = %NO#;
     3967    30675    6                       VM_RADDRESS.TYPE = %VM_ADD_RESOLVED;
     3968    30676    7                       DO INDX2 = 0 TO BLK$ -> P$B.NSUBLKS - 1;
     3969    30677    7                           PTR1$ = BLK$ -> P$B.SUBLK$(INDX2);
     3970    30678    8                           DO CASE (PTR1$ -> P$B.CODE);
     3971    30679    8                           CASE (%ADD_ACCT);
     3972    30680    8                               VM_RADDRESS.ACCT = PTR1$ -> P$S.TEXT;
     3973    30681    8                           CASE (%ADD_FOLDER);
     3974    30682    8                               VM_RADDRESS.FOLDER = PTR1$ -> P$S.TEXT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:140  
     3975    30683    8                           CASE (%ADD_NAME);
     3976    30684    8                               CALL XUR$ERRMSG (E_NAMENTALLOWED);
     3977    30685    8                           CASE (%ADD_PASS);
     3978    30686    8                               VM_RADDRESS.PASS = PTR1$ -> P$S.TEXT;
     3979    30687    8                           END; /* Do case ... end */
     3980    30688    7                       END; /* Do INDX1 = ... end */
     3981    30689    6                       IF (VM_RADDRESS.FOLDER='CENTRAL') AND
     3982    30690    6                         (VM_RADDRESS.ACCT=B$JIT.ACCN)
     3983    30691    6                       THEN
     3984    30692    6                           VM_PROFILE.FILE_FOLDER$ = ADDR(NIL);
     3985    30693    6                       ELSE
     3986    30694    6                           VM_PROFILE.FILE_FOLDER$ -> VM$RADDRESS = VM_RADDRESS;
     3987    30695    6                   END;       /* If not none */
     3988    30696    5               CASE (%POPT_RR);
     3989    30697    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES
     3990    30698    5                   THEN           /* Yes specified */
     3991    30699    5                       VM_PROFILE.OPT.RETURN_RECEIPT = %YES#;
     3992    30700    5                   ELSE           /* No specified */
     3993    30701    5                       VM_PROFILE.OPT.RETURN_RECEIPT = %NO#;
     3994    30702
     3995    30703    5               CASE (%POPT_RTO);
     3996    30704        /*
     3997    30705             ***** Release any allocated space ...
     3998    30706        */
     3999    30707    5                   IF VM_PROFILE.REPLY_TO$ ~= ADDR(NIL)
     4000    30708    5                   THEN
     4001    30709    6                   DO;
     4002    30710    6                       X$MCB.ADDRESS$ = VM_PROFILE.REPLY_TO$;
     4003    30711    6                       CALL X$DEALLOCATE (X$MCB) ALTRET(E_ALLOCATE);
     4004    30712    6                       VM_PROFILE.REPLY_TO$ = ADDR(NIL);
     4005    30713    6                   END;
     4006    30714        /* Check if none or null string was specified */
     4007    30715    5                   IF P$B.SUBLK$(0) -> P$B.CODE ~= %OPT_NONE AND P$B.SUBLK$(0)->P$B.
             30715                            SUBLK$(0) -> P$S.COUNT > 0
     4008    30716    5                   THEN
     4009    30717    6                   DO;
     4010    30718    6                       BLK$ = OUT$ -> P$B.SUBLK$(INDX1) -> P$B.SUBLK$(0);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:141  
     4011    30719    6                       INDX2 = P$B.CPOS;
     4012    30720    6                       X$MCB.SIZE = (P_PCB.NCHARS - INDX2) + 1;
     4013    30721    6                       X$MCB.TYPE = 0; /* Bytes */
     4014    30722    6                       CALL X$ALLOCATE (X$MCB) ALTRET(E_ALLOCATE);
     4015    30723    6                       VM_PROFILE.REPLY_TO$ = X$MCB.ADDRESS$;
     4016    30724    6                       VM_PROFILE.REPLY_TO$ -> X$STRING.SIZ = X$MCB.SIZE - 1;
     4017    30725    6                       VM_PROFILE.REPLY_TO$ -> X$STRING.TEXT = SUBSTR(CURRENT_LINE,
             30725                                INDX2,P_PCB.NCHARS - INDX2);
     4018    30726    6                   END;
     4019    30727    5               CASE (%POPT_SETUP);
     4020    30728    5                   IF P$B.SUBLK$(0)->P$B.CODE = %OPT_NONE THEN VM_PROFILE.SETUP.COUNT =
             30728                            0;
     4021    30729    6                   ELSE DO;
     4022    30730    6                       VM_PROFILE.SETUP.COUNT = P$B.SUBLK$(0) -> P$S.COUNT;
     4023    30731    6                       VM_PROFILE.SETUP.TEXT = P$B.SUBLK$(0) -> P$S.TEXT;
     4024    30732    6                   END;
     4025    30733    5               CASE (%POPT_SIGNED);
     4026    30734        /*
     4027    30735             ***** Release any allocated space ...
     4028    30736        */
     4029    30737    5                   IF VM_PROFILE.SIGNED$ ~= ADDR(NIL)
     4030    30738    5                   THEN
     4031    30739    6                   DO;
     4032    30740    6                       X$MCB.ADDRESS$ = VM_PROFILE.SIGNED$;
     4033    30741    6                       CALL X$DEALLOCATE (X$MCB) ALTRET(E_ALLOCATE);
     4034    30742    6                       VM_PROFILE.SIGNED$ = ADDR(NIL);
     4035    30743    6                   END;
     4036    30744    5                   IF P$B.SUBLK$(0)->P$B.CODE ~= %OPT_NONE AND P$B.SUBLK$(0)->P$S.COUNT
             30744                            > 0
     4037    30745    5                   THEN
     4038    30746    6                   DO;
     4039    30747    6                       X$MCB.SIZE = P$B.SUBLK$(0)->P$S.COUNT + 1;
     4040    30748    6                       X$MCB.TYPE = 0; /* Bytes */
     4041    30749    6                       CALL X$ALLOCATE (X$MCB) ALTRET(E_ALLOCATE);
     4042    30750    6                       VM_PROFILE.SIGNED$ = X$MCB.ADDRESS$;
     4043    30751    6                       VM_PROFILE.SIGNED$ -> X$STRING.SIZ = P$B.SUBLK$(0) -> P$S.COUNT;
     4044    30752    6                       VM_PROFILE.SIGNED$ -> X$STRING.TEXT = P$B.SUBLK$(0) -> P$S.TEXT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:142  
     4045    30753    6                   END;
     4046    30754    5               CASE (%POPT_EDITOR);
     4047    30755        /*
     4048    30756             ***** Release any allocated space ...
     4049    30757        */
     4050    30758    5                   PTR4$ = VM_PROFILE.EDITOR$;
     4051    30759    5                   IF PTR4$ ~= ADDR(NIL) AND PTR4R$.SEGID = %DS3SID
     4052    30760    5                   THEN
     4053    30761    6                   DO;
     4054    30762    6                       X$MCB.ADDRESS$ = VM_PROFILE.EDITOR$;
     4055    30763    6                       CALL X$DEALLOCATE (X$MCB) ALTRET(E_ALLOCATE);
     4056    30764    6                       VM_PROFILE.EDITOR$ = ADDR(NIL);
     4057    30765    6                   END;
     4058    30766    5                   IF P$B.SUBLK$(0)->P$B.CODE ~= %OPT_NONE AND P$B.SUBLK$(0)->P$S.COUNT
             30766                            > 0
     4059    30767    5                   THEN
     4060    30768    6                   DO;
     4061    30769    6                       X$MCB.SIZE = P$B.SUBLK$(0)->P$S.COUNT + 1;
     4062    30770    6                       X$MCB.TYPE = 0; /* Bytes */
     4063    30771    6                       CALL X$ALLOCATE (X$MCB) ALTRET(E_ALLOCATE);
     4064    30772    6                       VM_PROFILE.EDITOR$ = X$MCB.ADDRESS$;
     4065    30773    6                       VM_PROFILE.EDITOR$ -> X$STRING.SIZ = P$B.SUBLK$(0) -> P$S.COUNT;
     4066    30774    6                       VM_PROFILE.EDITOR$ -> X$STRING.TEXT = P$B.SUBLK$(0) -> P$S.TEXT;
     4067    30775    6                   END;
     4068    30776    5               CASE (%POPT_SRCH);
     4069    30777    5                   IF BLK$->P$B.NSUBLKS > %VM_MAX_SRCH
     4070    30778    6                   THEN DO;
     4071    30779    6                       CALL XUR$ERRMSG (E_TOOMANYSRCH);
     4072    30780    6                       GOTO CONTINUE; /* abort processing */
     4073    30781    6                   END;
     4074    30782        /* An arbitary limit of 4 has been set on the number of srch folders. */
     4075    30783    6                   DO INDX4 = %VM_MAX_SRCH-1 DOWNTO 0;
     4076    30784    6                       IF VM_PROFILE.SEARCH_LIST$(INDX4) ~= ADDR(NIL)
     4077    30785    6                       THEN
     4078    30786    7                       DO;  /* Deallocate space */
     4079    30787    7                           X$MCB.ADDRESS$ = VM_PROFILE.SEARCH_LIST$(INDX4);
     4080    30788    7                           CALL X$DEALLOCATE (X$MCB);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:143  
     4081    30789    7                           VM_PROFILE.SEARCH_LIST$(INDX4) = ADDR(NIL);
     4082    30790    7                       END;
     4083    30791    6                   END;
     4084    30792    5                   IF BLK$->P$B.SUBLK$(0)->P$B.CODE ~= %OPT_NONE
     4085    30793    6                   THEN DO;
     4086    30794    6                       PTR4$ = BLK$;
     4087    30795    7                       DO INDX4 = 0 TO PTR4$->P$B.NSUBLKS-1;
     4088    30796    7                           BLK$ = PTR4$ -> P$B.SUBLK$(INDX4);
             30796                                    /* To account for OPT_MID */
     4089    30797    7                           VM_RADDRESS.ACCT = ' ';
     4090    30798    7                           VM_RADDRESS.FOLDER = ' ';
     4091    30799    7                           VM_RADDRESS.PASS = ' ';
     4092    30800    7                           VM_RADDRESS.SITENAME = ' ';
     4093    30801    7                           VM_RADDRESS.NEXT$ = ADDR(NIL);
     4094    30802    7                           VM_RADDRESS.PREV$ = ADDR(NIL);
     4095    30803    7                           VM_RADDRESS.FLAGS = %NO#;
     4096    30804    7                           VM_RADDRESS.TYPE = %VM_ADD_RESOLVED;
     4097    30805    7                           VM_UADDRESS.USER_NAME.COUNT = 0;
     4098    30806    8                           DO INDX2 = 0 TO BLK$ -> P$B.NSUBLKS - 1;
     4099    30807    8                               PTR1$ = BLK$ -> P$B.SUBLK$(INDX2);
     4100    30808    9                               DO CASE (PTR1$ -> P$B.CODE);
     4101    30809    9                               CASE (%ADD_ACCT);
     4102    30810    9                                   VM_RADDRESS.ACCT = PTR1$ -> P$S.TEXT;
     4103    30811    9                               CASE (%ADD_FOLDER);
     4104    30812    9                                   VM_RADDRESS.FOLDER = PTR1$ -> P$S.TEXT;
     4105    30813    9                               CASE (%ADD_NAME);
     4106    30814    9                                   VM_UADDRESS.USER_NAME.COUNT = PTR1$ -> P$S.COUNT;
     4107    30815    9                                   VM_UADDRESS.USER_NAME.TEXT = PTR1$ -> P$S.TEXT;
     4108    30816    9                                   IF VM_UADDRESS.USER_NAME.COUNT = 0 THEN GOTO
             30816                                            NULL_ENTRY;
     4109    30817    9                               CASE (%ADD_PASS);
     4110    30818    9                                   VM_RADDRESS.PASS = PTR1$ -> P$S.TEXT;
     4111    30819    9                               END; /* Do case ... end */
     4112    30820    8                           END; /* Do INDX2 = ... end */
     4113    30821    7                           IF VM_UADDRESS.USER_NAME.COUNT > 0
     4114    30822    7                           THEN /* Store as unresolved address */
     4115    30823    8                           DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:144  
     4116    30824    8                               X$MCB.SIZE = SIZEC(VM_UADDRESS) -
     4117    30825    8                                 SIZEC(VM_UADDRESS.USER_NAME.TEXT) +
     4118    30826    8                                 VM_UADDRESS.USER_NAME.COUNT;
     4119    30827    8                           END;
     4120    30828    7                           ELSE /* Store as resolved address */
     4121    30829    8                           DO;
     4122    30830    8                               X$MCB.SIZE = SIZEC(VM_RADDRESS);
     4123    30831    8                           END;
     4124    30832    7                           CALL X$ALLOCATE (X$MCB)
     4125    30833    7                           WHENALTRETURN
     4126    30834    8                           DO;
     4127    30835    8                               CALL VMA$ENLARGE_SEGMENT (VM_PROFILE_,
     4128    30836    8                                 1024) ALTRET(E_PMME);
     4129    30837    8                               X$MCB.WKSZ = X$MCB.WKSZ + 1024;
     4130    30838    8                               CALL X$ALLOCATE (X$MCB) ALTRET(E_ALLOCATE);
     4131    30839    8                           END;
     4132    30840    7                           VM_PROFILE.SEARCH_LIST$(INDX4) = X$MCB.ADDRESS$;
     4133    30841    7                           VM_PROFILE.SEARCH_LIST$(INDX4) -> VM$RADDRESS = VM_RADDRESS;
     4134    30842    7                           IF VM_UADDRESS.USER_NAME.COUNT > 0
     4135    30843    7                           THEN
     4136    30844    8                           DO;
     4137    30845    8                               VM_PROFILE.SEARCH_LIST$(INDX4) -> VM$UADDRESS.TYPE
     4138    30846    8                                 = %VM_ADD_UNRESOLVED;
     4139    30847    8                               VM_PROFILE.SEARCH_LIST$(INDX4) -> VM$UADDRESS.USER_NAME.
             30847                                        COUNT
     4140    30848    8                                 = VM_UADDRESS.USER_NAME.COUNT;
     4141    30849    8                               CALL INSERT (VM_PROFILE.SEARCH_LIST$(INDX4) ->
     4142    30850    8                                 VM$UADDRESS.USER_NAME.TEXT,0,VM_UADDRESS.USER_NAME.
             30850                                          COUNT,
     4143    30851    8                                 VM_UADDRESS.USER_NAME.TEXT);
     4144    30852    8                           END;
     4145    30853    7   NULL_ENTRY:
     4146    30854    7                       END; /* Do INDX4 */
     4147    30855                                 /* Close out current search list.  The new ones will be
     4148    30856                                    reopened if needed. */
     4149    30857    6                   END;       /* If not none */
     4150    30858    5                   CALL CLOSE_SEARCH;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:145  
     4151    30859    5               END;                  /* End cases */
     4152    30860    4           END;                       /* Do INDX1 = ... end */
     4153    30861        /*
     4154    30862             ***** Store the profile (if allowed) ...
     4155    30863        */
     4156    30864    3           VM_PROFILE.NEXT$ = X$MCB.HI_SEGMENT$;
     4157    30865    3           VM_PROFILE.FREE$ = X$MCB.FREE_HEAD$;
     4158    30866    3           CALL PUT_PROFILE (M$MAIL_FILE_NUM)
     4159    30867    4           WHENALTRETURN DO;
     4160    30868    4               INDX1 = VM_WORK$ -> VM_PROFILE.PROFILE_SIZE * 4;
     4161    30869    4               VM_PROFILE$ -> INDX1_CHARS = VM_WORK$ -> INDX1_CHARS;
     4162    30870    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     4163    30871    4               CALL XUR$ERRMSG(E_WERR);
     4164    30872    4               CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);
     4165    30873    4               CALL PUT_PROFILE (M$MAIL_FILE_NUM);
     4166    30874    4           END;
     4167    30875        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:146  
     4168    30876        /* Read command */
     4169    30877    3       CASE (%CMD_READ);
     4170    30878        /*
     4171    30879             ***** Open M$CMNDF dcb to the specified command file.
     4172    30880        */
     4173    30881    3           IF OUT$ -> P$B.NSUBLKS > 0
     4174    30882    3           THEN
     4175    30883    4           DO;                    /* Get options, and open M$CMNDF */
     4176    30884    4               IF DCBADDR(M$CMNDF_NUM) -> F$DCB.FCD# /* Close if open */
     4177    30885    4               THEN
     4178    30886    5               DO;
     4179    30887    5                   CLOSE_SAVE.V.DCB# = M$CMNDF_NUM;
     4180    30888    5                   CALL M$CLOSE (CLOSE_SAVE);
     4181    30889    5               END;
     4182    30890    4               FID_NAME.NAME# = ' ';
     4183    30891    4               FID_NAME.L# = 0;
     4184    30892    4               FID_ACCT.ACCT# = B$JIT.FACCN;
     4185    30893    4               FID_PASS.PASS# = ' ';
     4186    30894    4               FID_WSN.WSN# = ' ';
     4187    30895    4               FID_RESULTS = '0'B;                /* Zap all flags */
     4188    30896
     4189    30897    4               OPT_FID = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;
     4190    30898    4               CALL M$FID (CHECK_FID)
     4191    30899    5               WHENALTRETURN DO;
     4192    30900    5                   ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     4193    30901    5                   CALL XUR$ERRPTR (OUT$ -> P$B.SUBLK$(0) -> P$S.CPOS);
     4194    30902    5                   CALL XUR$ERRMSG (ERROR);
     4195    30903    5                   GOTO CONTINUE;
     4196    30904    5               END;
     4197    30905        /*
     4198    30906             ***** Stuff the information into the open fpt ...
     4199    30907        */
     4200    30908    4               IF FID_RESULTS.ACCT = %NO#
     4201    30909    4               THEN            /* Default to current account */
     4202    30910    4                   FID_ACCT.ACCT# = B$JIT.FACCN;
     4203    30911    4               OPEN_COMMAND_STREAM.NAME_=VECTOR(FID_NAME);
     4204    30912    4               OPEN_COMMAND_STREAM.ACCT_=VECTOR(FID_ACCT);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:147  
     4205    30913    4               IF FID_RESULTS.PASS
     4206    30914    4               THEN
     4207    30915    4                   OPEN_COMMAND_STREAM.PASS_=VECTOR(FID_PASS);
     4208    30916    4               IF FID_RESULTS.SN
     4209    30917    4               THEN
     4210    30918    4                   OPEN_COMMAND_STREAM.SN_=VECTOR(FID_SN);
     4211    30919    4               IF FID_RESULTS.WSN
     4212    30920    4               THEN
     4213    30921    4                   OPEN_COMMAND_STREAM.WSN_=VECTOR(FID_WSN);
     4214    30922    4               IF FID_RESULTS.RES
     4215    30923    4               THEN
     4216    30924    4                   OPEN_COMMAND_STREAM.V.RES#=FID_RES;
     4217    30925    4               OPEN_COMMAND_STREAM.V.ASN#=FID_ASN;
     4218    30926        /*      Prevent unauthorized access to :NODES and files in .:MAIL. */
     4219    30927    4               IF (FID_NAME.NAME# = ':NODES'
     4220    30928    4                 AND FID_ACCT.ACCT# = DCBADDR(DCBNUM(M$LM)) -> F$DCB.ACCT#)
     4221    30929    4                 OR DCBADDR(DCBNUM(M$LM)) -> F$DCB.ACCT# = ':MAIL'
     4222    30930    4               THEN
     4223    30931    4                   OPEN_COMMAND_STREAM.V.SETDCB# = %YES#;
     4224    30932    4               ELSE
     4225    30933    4                   OPEN_COMMAND_STREAM.V.SETDCB# = %NO#;
     4226    30934    4               OPEN_COMMAND_STREAM.V.INITZ.SCRUB# = %YES#;
     4227    30935    4               CALL M$OPEN(OPEN_COMMAND_STREAM)
     4228    30936    5               WHENRETURN DO;
     4229    30937    5                   IF OPEN_COMMAND_STREAM.V.SETDCB#
     4230    30938    6                   THEN DO;
     4231    30939    6                       ERROR = E_NOFILE;
     4232    30940    6                       GOTO READCMD_ERR;
     4233    30941    6                   END;
     4234    30942    5                   IF EXIT_MAIL#
     4235    30943    6                   THEN DO;
     4236    30944    6                       EXIT_MAIL# = '0'B;
     4237    30945    6                       EXIT_MAIL_PEND# = '1'B;
     4238    30946    6                   END;
     4239    30947    5                   CALL XUR$SETDCBS (M$CMNDF_NUM);
     4240    30948    5               END;
     4241    30949    5               WHENALTRETURN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:148  
     4242    30950    5                   ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     4243    30951    5   READCMD_ERR:
     4244    30952    5                   DCB# = M$CMNDF_NUM;
     4245    30953    5                   IF EXIT_MAIL_PEND#
     4246    30954    6                   THEN DO;
     4247    30955    6                       EXIT_MAIL# = '1'B;
     4248    30956    6                       EXIT_MAIL_PEND# = '0'B;
     4249    30957    6                   END;
     4250    30958    5                   CALL XUR$ERRMSG (ERROR,DCB#);
     4251    30959    5                   CALL XUR$SETDCBS (M$SI_NUM);
     4252    30960    5               END;
     4253    30961    4           END;
     4254    30962    3           ELSE                       /* Open back to ME# */
     4255    30963    4           DO;
     4256    30964    4               IF EXIT_MAIL_PEND#
     4257    30965    5               THEN DO;
     4258    30966    5                   EXIT_MAIL# = '1'B;
     4259    30967    5                   EXIT_MAIL_PEND# = '0'B;
     4260    30968    5               END;
     4261    30969    4           END;
     4262    30970        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:149  
     4263    30971        /* Resend message command */
     4264    30972    3       CASE (%CMD_RESEND_MESSAGE);
     4265    30973    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     4266    30974    3           OPT_SEED = 0;
     4267    30975    3           OPT_SEED$ = ADDR(OPT_SEED);
     4268    30976    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;
     4269    30977    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);
     4270    30978    5               DO CASE (BLK$ -> P$B.CODE);
     4271    30979    5               CASE (%OPT_CRPT);
     4272    30980    5                   CALL VMX$OCTBIN (BLK$->P$B.SUBLK$(0)->P$S,OPT_SEED);
     4273    30981    5                   IF OPT_SEED = 0
     4274    30982    5                   THEN /* allow display w/o decryption */
     4275    30983    5                       OPT_SEED$ = ADDR(NIL);
     4276    30984    5               CASE (%OPT_SELECT);
     4277    30985    5                   CALL INIT$SELECT_OPTS (BLK$,%CMD_RESEND_MESSAGE) ALTRET(CONTINUE);
     4278    30986    5               END;             /* Do case ... end */
     4279    30987    4           END;
     4280    30988    3           CALL FIX_CONTEXT;
     4281    30989    3           INDX1 = 0;
     4282    30990        /*
     4283    30991             ***** Build the command buffer to pass to send ...
     4284    30992        */
     4285    30993                %INIT_STR (CODE=E_RESEND_NAME, STR=VM_RESEND_NAME, TEST=YES);
     4286    31016    3           WORK_STRING.L# = VM_RESEND_NAME.L# + 6;
     4287    31017    3           CALL CONCAT (WORK_STRING.NAME#, ADDR(VM_RESEND_NAME) -> X$STRING.TEXT,
     4288    31018    3             ' *BODY');
     4289    31019    3           CALL BUILD_LINK_TO_SEND_CMD(WORK_STRING);
     4290    31020        /*
     4291    31021             ***** Resend all the messages ...
     4292    31022        */
     4293    31023    4           DO FOREVER;
     4294    31024    4   RESEND_NEXT: ;
     4295    31025    4               CALL GET$MESSAGE ALTRET(END_RESEND);
     4296    31026    4               INDX1 = INDX1 + 1;
     4297    31027    4               IF VM_HEADER.STATUS.CRYPT
     4298    31028    4                 AND OPT_SEED = 0
     4299    31029    4                 AND OPT_SEED$ ~= ADDR(NIL)
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:150  
     4300    31030    5               THEN DO;
     4301    31031    5                   CALL XUR$ERRMSG (E_NEEDSEED);
     4302    31032    5                   GOTO CONTINUE;
     4303    31033    5               END;
     4304    31034    4               CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);
     4305    31035        /*
     4306    31036             ***** Create the file to contain the message being resent ...
     4307    31037        */
     4308    31038    4               CALL VMM$EDIT_MESSAGE_OUT (CURRENT_MESSAGE_NUMBER,OPT$SEED,
     4309    31039    4                 M$MAIL_FILE_NUM,%NO#) ALTRET(E_PMME);
     4310    31040        /*
     4311    31041             ***** Link to SEND ...
     4312    31042        */
     4313    31043    4               CALL LINK_RUNIT
     4314    31044    4               WHENRETURN
     4315    31045    5               DO;
     4316    31046    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,
     4317    31047    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     4318    31048    5               END;
     4319    31049    4               WHENALTRETURN
     4320    31050    5               DO;
     4321    31051    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,
     4322    31052    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     4323    31053    5                   GOTO END_RESEND;
     4324    31054    5               END;
     4325    31055    4           END;                       /* Do forever ... end */
     4326    31056    3   END_RESEND:
     4327    31057    3           REOPEN_FILE.V.DCB# = DCBNUM(M$EDIT);
     4328    31058    3           CALL M$OPEN (REOPEN_FILE)
     4329    31059    4           WHENRETURN DO;
     4330    31060    4               CLOSE_SCRATCH.V.DCB# = DCBNUM(M$EDIT);
     4331    31061    5               CALL M$CLOSE (CLOSE_SCRATCH) WHENALTRETURN DO; END;
     4332    31062    4           END;
     4333    31063    3           IF INDX1 = 0
     4334    31064    3           THEN
     4335    31065    3               CALL REPORT_ACTIVITY (INDX1,VM_NO_MESSAGE_FMT,%YES#,E_NO_MESSAGE_FMT);
     4336    31066    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:151  
     4337    31067    3           THEN                       /* Ok to read profile */
     4338    31068    3               CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);
     4339    31069        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:152  
     4340    31070        /* Rest message command */
     4341    31071    3       CASE(%CMD_REST_MESSAGE);
     4342    31072    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE
     4343    31073    3           THEN
     4344    31074                    %INIT_STR (CODE=E_DI_REST_CMD, STR=VM_DI_REST_CMD,
     4345    31075                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     4346    31098    3           ELSE
     4347    31099                  %INIT_STR (CODE=E_LIST_REST_CMD, STR=VM_LIST_REST_CMD,
     4348    31100                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     4349    31123        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:153  
     4350    31124        /* Renumber command */
     4351    31125    3       CASE (%CMD_RENUMBER);
     4352    31126    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     4353    31127    3           IF OUT$ -> P$B.NSUBLKS = 0 THEN /* Check for renumber options */
     4354    31128
     4355    31129    3               CALL UPDATE$MAIL (%YES#); /* Plain renumber */
     4356    31130    3           ELSE
     4357    31131    3               CALL UPDATE$MAIL (%YES#,OUT$->P$B.SUBLK$(0)->P$B.CODE);
     4358    31132        /*
     4359    31133             ***** Reinitialize the selection contexts ...
     4360    31134        */
     4361    31135    3           CALL INIT_CONTEXT (%CONTEXT_CURRENT);
     4362    31136    3           CALL INIT_CONTEXT (%CONTEXT_SELECTED);
     4363    31137    3           IF VM_PROFILE.NUM_MESSAGES > 0
     4364    31138    3           THEN                       /* Select all */
     4365    31139    4           DO;
     4366    31140    4               SELECTED_CONTEXT%.MESSAGE_SET.LOW(0) = 1;
     4367    31141    4               SELECTED_CONTEXT%.MESSAGE_SET.HIGH(0) = %MAX_MSGNO;
     4368    31142    4               SELECTED_CONTEXT%.NUM_ENTRIES = 1;
     4369    31143    4               SELECTED_CONTEXT%.MESSAGE_POINTER = -1;
     4370    31144    4               SELECT_CURRENT = '1'B;
     4371    31145    4           END;
     4372    31146        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:154  
     4373    31147        /* Select message command */
     4374    31148    3       CASE (%CMD_SELECT_MESSAGE);
     4375    31149    3           CALL NEED_FOLDER ALTRET(CONTINUE);
     4376    31150    3           SELECT_CURRENT = '0'B;
     4377    31151    3           CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_SELECT_MESSAGE) ALTRET(
             31151                    CONTINUE);
     4378    31152        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:155  
     4379    31153        /* Send command */
     4380    31154    3       CASE (%CMD_SEND);
     4381    31155    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     4382    31156        /*
     4383    31157             ***** Build the command buffer to pass to send ...
     4384    31158        */
     4385    31159    3           WORK_STRING.L# = P_PCB.NCHARS;
     4386    31160    3           WORK_STRING.NAME# =CURRENT_LINE;
     4387    31161    3           CALL BUILD_LINK_TO_SEND_CMD (WORK_STRING);
     4388    31162        /*
     4389    31163             ***** Do it...
     4390    31164        */
     4391    31165    3           CALL LINK_RUNIT;
     4392    31166        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:156  
     4393    31167        /* This message command */
     4394    31168    3       CASE(%CMD_THIS_MESSAGE);
     4395    31169    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE
     4396    31170    3           THEN
     4397    31171                    %INIT_STR (CODE=E_DI_THIS_CMD, STR=VM_DI_THIS_CMD,
     4398    31172                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     4399    31195    3           ELSE
     4400    31196                  %INIT_STR (CODE=E_LIST_THIS_CMD, STR=VM_LIST_THIS_CMD,
     4401    31197                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);
     4402    31220        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:157  
     4403    31221        /* Time command */
     4404    31222    3       CASE (%CMD_TIME);
     4405    31223    3           CALL M$TIME(GET_TIME);
     4406    31224                %INIT_STR (CODE=E_TIME_FMT, STR=VM_TIME_FMT,
     4407    31225                VECT="F_FDSME.FMT_", TEST=YES);
     4408    31248    3           VECT_ARRAY(0) = VECTOR(WORK_UTS);
     4409    31249    3           F_FDSME.NVECS# = 1;
     4410    31250    3           CALL VMD$WRITE_BUF(F_FDSME);
     4411    31251        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:158  
     4412    31252        /* Undelete command */
     4413    31253    3       CASE (%CMD_UNDELETE_MESSAGE);
     4414    31254    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     4415    31255    3           IF OUT$ -> P$B.NSUBLKS > 0
     4416    31256    3           THEN                       /* There are options */
     4417    31257    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_UNDELETE_MESSAGE) ALTRET
             31257                        (CONTINUE);
     4418    31258    3           INDX1 = 0;                  /* Used as counter */
     4419    31259    3           NONE = %YES#;
     4420    31260    4           DO FOREVER;
     4421    31261    4               CALL GET$MESSAGE ALTRET(END_UNDELETE);
     4422    31262    4               NONE = %NO#;
     4423    31263
     4424    31264    4               IF VM_PROFILE.OPT.HEADERS
     4425    31265    4               THEN
     4426    31266    4                   CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);
     4427    31267
     4428    31268    4               IF VM_HEADER.STATUS.DEL
     4429    31269    4               THEN
     4430    31270    5               DO;              /* Remove the delete mark */
     4431    31271    5                   CALL XUR$DISABLE;
     4432    31272    5                   VM_HEADER.STATUS.DEL = %NO#;
     4433    31273    5                   CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM);
     4434    31274    5                   VM_PROFILE.NUM_DEL_MESSAGES = VM_PROFILE.NUM_DEL_MESSAGES - 1;
     4435    31275    5                   INDX1 = INDX1 + 1; /* Keep track of how many messages undeleted */
     4436    31276    5                   CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(WRITE_ERROR);
     4437    31277    5               END;             /* Remove the delete mark */
     4438    31278    4               CALL XUR$ENABLE;
     4439    31279    4           END;                       /* Do forever ... end  */
     4440    31280
     4441    31281    3   END_UNDELETE: ;
     4442    31282    3           CALL REPORT_ACTIVITY (INDX1,VM_MSGS_UNDELETED_FMT,NONE,E_MSGS_UNDELETED_FMT)
             31282                    ;
     4443    31283
     4444    31284        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:159  
     4445    31285        /* Unmark command */
     4446    31286    3       CASE(%CMD_UNMARK_MESSAGE);
     4447    31287    3           CALL NEED_UPDATE ALTRET(CONTINUE);
     4448    31288    3           IF OUT$ -> P$B.NSUBLKS > 0
     4449    31289    3           THEN                       /* There are options */
     4450    31290    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_UNMARK_MESSAGE) ALTRET(
             31290                        CONTINUE);
     4451    31291    3           INDX1 = 0;                  /* Used as counter */
     4452    31292    3           NONE = %YES#;
     4453    31293    4           DO FOREVER;
     4454    31294    4               CALL GET$MESSAGE ALTRET(END_UNMARK);
     4455    31295    4               NONE = %NO#;
     4456    31296
     4457    31297    4               IF VM_PROFILE.OPT.HEADERS
     4458    31298    4               THEN
     4459    31299    4                   CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,M$LO_NUM);
     4460    31300    4               IF VM_HEADER.STATUS.MARK
     4461    31301    4               THEN
     4462    31302    5               DO;              /* Remove the mark */
     4463    31303
     4464    31304    5                   CALL XUR$DISABLE;
     4465    31305    5                   VM_HEADER.STATUS.MARK = %NO#;
     4466    31306    5                   CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM);
     4467    31307    5                   CALL XUR$ENABLE;
     4468    31308    5                   INDX1 = INDX1 + 1;
     4469    31309    5               END;             /* Remove the mark */
     4470    31310    4           END;                       /* Do forever ... end  */
     4471    31311
     4472    31312    3   END_UNMARK: ;
     4473    31313    3           CALL REPORT_ACTIVITY (INDX1,VM_MSGS_UNMARKED_FMT,NONE,E_MSGS_UNMARKED_FMT);
     4474    31314
     4475    31315        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:160  
     4476    31316        /* Use command */
     4477    31317    3       CASE (%CMD_USE);
     4478    31318        /*
     4479    31319             ***** Process ...
     4480    31320        */
     4481    31321    3           NEXT_COMMAND_TEXT.L# = 0;
     4482    31322    3           REOPENED_FOLDER = '0'B;
     4483    31323    3           EXIT_MAIL# = %NO#;
     4484    31324    3           OPT_NOUPDATE = %NO#;
     4485    31325    3           OPT_BYPASS = %NO#;
     4486    31326        /*
     4487    31327             ***** Disable breaks ...
     4488    31328        */
     4489    31329    3           CALL XUR$DISABLE;
     4490    31330    3           NEXT_COMMAND_ECHO# = %NO#;
     4491    31331    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN /* Check if file already open */
     4492    31332    3           THEN
     4493    31333    4           DO;
     4494    31334    5               DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;
     4495    31335    6                   DO CASE (OUT$ -> P$B.SUBLK$(INDX1) -> P$B.CODE);
     4496    31336    6                   CASE (%OPT_NOUPDATE);
     4497    31337    6                       OPT_NOUPDATE = %YES#;
     4498    31338    6                   CASE (ELSE);
     4499    31339    6                   END;
     4500    31340    5               END;
     4501    31341    4               IF NOT OPT_NOUPDATE
     4502    31342    4               THEN
     4503    31343    4                   CALL UPDATE$MAIL (VM_PROFILE.OPT.RENUMBER);
     4504    31344    4               IF VM_CURRENT_FOLDER.FLAGS.UPDATE
     4505    31345    4               THEN
     4506    31346    4                   CALL PUT_PROFILE (M$MAIL_FILE_NUM);
     4507    31347    4               FOLDER_WAS_OPEN = '1'B;
     4508    31348        /* The folder used to be closed here.  Now, it is left open for
     4509    31349           the next folders address resolution.  The close is done by
     4510    31350            VMA$OPEN_FOLDER, called by one of the VMB$USE routines.
     4511    31351        */
     4512    31352    4               VM_CURRENT_FOLDER.FLAGS = %NO#;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:161  
     4513    31353    4               IF NOT VM_SEARCH_INFO.ACTIVE
     4514    31354    4               THEN CALL VMA$OPEN_SRCH_LIST(VM_SEARCH_INFO);
     4515    31355    4           END;
     4516    31356    3           ELSE
     4517    31357    3               FOLDER_WAS_OPEN = '0'B;
     4518    31358    3           IF NOT VM_SEARCH_INFO.ACTIVE
     4519    31359    3           THEN
     4520    31360    3               CALL VMA$OPEN_SRCH_LIST (VM_SEARCH_INFO);
     4521    31361        /*
     4522    31362             ***** Get specified options ...
     4523    31363        */
     4524    31364    3           OPT_NOUPDATE = %NO#;
     4525    31365    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;
     4526    31366    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);
     4527    31367    5               DO CASE (BLK$ -> P$B.CODE);
     4528    31368    5               CASE (%OPT_MID);
     4529    31369    5                   VM_CURRENT_FOLDER_SAVE = VM_CURRENT_FOLDER;
     4530    31370    5                   CALL VMB$USE_SPECIFIED (BLK$,USER_NAME,VM_CURRENT_FOLDER,
             31370                            M$MAIL_FILE_NUM,VM_SEARCH_INFO)
     4531    31371    6                   WHENRETURN DO;
     4532    31372    6                       VM_SEARCH_INFO.CURRENT = '1'B;
     4533    31373    6                   END;
     4534    31374    6                   WHENALTRETURN DO;
     4535    31375    6                       VM_SEARCH_INFO.CURRENT = '0'B;
     4536    31376    6                       IF NOT FOLDER_WAS_OPEN THEN GOTO NO_FOLD;
     4537    31377    6                       REOPENED_FOLDER = '1'B;
     4538    31378    6                       VM_CURRENT_FOLDER = VM_CURRENT_FOLDER_SAVE;
     4539    31379    6                       CALL VMA$OPEN_FOLDER (VM_CURRENT_FOLDER,,M$MAIL_FILE_NUM,%
             31379                                OLDFILE#,%UPDATE#)
     4540    31380    7                       WHENRETURN DO;
     4541    31381    7                           VM_SEARCH_INFO.CURRENT = '1'B;
     4542    31382    7                       END;
     4543    31383    7                       WHENALTRETURN DO;
     4544    31384    7                           CALL VMA$OPEN_FOLDER (VM_CURRENT_FOLDER,,M$MAIL_FILE_NUM,%
             31384                                    OLDFILE#,%IN#)
     4545    31385    8                           WHENRETURN DO;
     4546    31386    8                               VM_SEARCH_INFO.CURRENT = '1'B;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:162  
     4547    31387    8                           END;
     4548    31388    8                           WHENALTRETURN DO;
     4549    31389    8                               GOTO CONTINUE;
     4550    31390    8                           END;
     4551    31391    7                       END;
     4552    31392    6                   END;
     4553    31393    5                   CALL CLOSE_SEARCH;
     4554    31394    5               CASE (%OPT_BYPASS);
     4555    31395    5                   OPT_BYPASS = %YES#;
     4556    31396    5               CASE (%OPT_ENDNOUPDATE);
     4557    31397        /*
     4558    31398             ***** Allowed on mail invocation only ...
     4559    31399        */
     4560    31400    5                   OPT_NOUPDATE = %YES#;
     4561    31401    5                   EXIT_MAIL# = %YES#;
     4562    31402    5               CASE (%OPT_ENDUPDATE);
     4563    31403        /*
     4564    31404             ***** Allowed on mail invocation only ...
     4565    31405        */
     4566    31406    5                   OPT_NOUPDATE = %NO#;
     4567    31407    5                   EXIT_MAIL# = %YES#;
     4568    31408    5               CASE (%OPT_NOUPDATE);
     4569    31409    5               END;                  /* Do case ... end */
     4570    31410    4           END;                       /* Do INDX1 = ... end */
     4571    31411        /*
     4572    31412             ***** If no folder was specified (VM_CURRENT_FOLDER.FLAGS.OPEN reset),
     4573    31413                   then open the default folder for this user ...
     4574    31414        */
     4575    31415    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN = %NO# THEN
     4576    31416    4   FOLD_CREATE: DO;
     4577    31417    4               CALL CLOSE_SEARCH;
     4578    31418    4               CALL VMB$USE_DEFAULT (,USER_NAME,VM_CURRENT_FOLDER,M$MAIL_FILE_NUM,
             31418                        VM_SEARCH_INFO,,'1'B)
     4579    31419    5               WHENRETURN DO;
     4580    31420    5                   VM_SEARCH_INFO.CURRENT = %YES#;
     4581    31421    5               END;
     4582    31422    5               WHENALTRETURN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:163  
     4583    31423    6                   call VMB$TESTREG(USER_NAME) whenreturn do;
     4584    31424                            /* If user is registered...  */
     4585    31425        /*
     4586    31426             ***** User is already registered, create folder for him if one doesn't
     4587    31427             ***** already exist.
     4588    31428        */
     4589    31429    6                       VM_CURRENT_FOLDER.FLAGS=%NO#;
     4590    31430    6                       VM_RADDRESS.ACCT = VM_CURRENT_FOLDER.ACCT;
     4591    31431    6                       VM_RADDRESS.FOLDER = VM_CURRENT_FOLDER.FOLDER;
     4592    31432    6                       VM_RADDRESS.PASS = VM_CURRENT_FOLDER.PASS;
     4593    31433    6                       VM_RADDRESS.SITENAME = VM_CURRENT_FOLDER.SITENAME;
     4594    31434    6                       CALL VMA$OPEN_FOLDER (VM_CURRENT_FOLDER,
     4595    31435    6                         ADDR(VM_RADDRESS),M$MAIL_FILE_NUM,%ERROR#,
     4596    31436    6                         %CREATE#)
     4597    31437    7                       WHENALTRETURN DO;
     4598    31438    7                           IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$CREATERR THEN
     4599    31439    8                           DO; /* Folder already exists, so open */
     4600    31440    8                               CALL VMA$OPEN_FOLDER(VM_CURRENT_FOLDER,
     4601    31441    8                                 ADDR(VM_RADDRESS),M$MAIL_FILE_NUM,
     4602    31442    8                                 %OLDFILE#,%UPDATE#) ALTRET(NO_FOLD_ERR);
     4603    31443    8                               EXIT FOLD_CREATE;
     4604    31444    8                           END;
     4605    31445    7                           ELSE
     4606    31446    7                               GOTO NO_FOLD_ERR;
     4607    31447    7                       END;
     4608    31448    6                       WORK_STRING.L#=SIZEC(WORK_STRING.NAME#);
     4609    31449    6                       CALL GET_FOLDERNAME (VM_CURRENT_FOLDER);
     4610    31450    6                       CALL XUR$INFOMSG (E_CREATE_MSG_FMT,,M$ME_NUM,VECTOR(WORK_STRING)
             31450                                );
     4611    31451    6                       VM_PROFILE = CVM_PROFILE; /* Build a default profile */
     4612    31452    6                       VM_PROFILE.FREE$ = ADDR(NIL);
     4613    31453    6                       VM_PROFILE.NEXT$ = ADDR(VM_PROFILE.WORK_AREA);
     4614    31454    6                       CALL CONCAT (VM_PROFILE.NAME_KEY,B$JIT.ACCN,B$JIT.UNAME);
     4615    31455                            %INIT_STR (CODE=E_MAIL_SETUP, STR=VM_MAIL_SETUP, TEST=YES);
     4616    31478    6                       VM_PROFILE.SETUP.COUNT = VM_MAIL_SETUP.L#;
     4617    31479    6                       VM_PROFILE.SETUP.TEXT = VM_MAIL_SETUP.NAME#;
     4618    31480    6                       CALL VMD$PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(E_PMME);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:164  
     4619    31481        /*
     4620    31482             ***** Close the file so that it will be cataloged.
     4621    31483        */
     4622    31484    6                       CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;
     4623    31485    6                       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     4624    31486    6                       VM_CURRENT_FOLDER.FLAGS.OPEN = %NO#;
     4625    31487    6                       CALL CLOSE_SEARCH;
     4626    31488    6                       CALL VMB$USE_DEFAULT (,USER_NAME,VM_CURRENT_FOLDER,
     4627    31489    6                         M$MAIL_FILE_NUM,VM_SEARCH_INFO,,'1'B) ALTRET(NO_FOLD_ERR);
     4628    31490    6                       WORK_STRING.L#=SIZEC(WORK_STRING.NAME#);
     4629    31491    6                       CALL GET_FOLDERNAME (VM_CURRENT_FOLDER);
     4630    31492    6                       CALL XUR$INFOMSG(E_USING_MSG_FMT,,M$ME_NUM,VECTOR(WORK_STRING));
     4631    31493    6                   END;  /* else registered */
     4632    31494
     4633    31495    6                   whenaltreturn do;
     4634    31496                            /*  If user is not registered...  */
     4635    31497
     4636    31498    6                       IF B$JIT.ACCN = SUBSTR(USER_NAME.NAME#,1,8) THEN GOTO
             31498                                NO_FOLD_ERR;
     4637    31499                       /* Try his logon account */
     4638    31500    6                       USER_NAME.L# = LENGTHC(B$JIT.ACCN) + 1;
     4639    31501    6                       SUBSTR(USER_NAME.NAME#,1,8) = B$JIT.ACCN;
     4640    31502    6                       substr(USER_NAME.NAME#,,1) = '.';
     4641    31503    6                       CALL VMB$USE_DEFAULT (,USER_NAME,VM_CURRENT_FOLDER,
             31503                                M$MAIL_FILE_NUM,VM_SEARCH_INFO,,'1'B)
     4642    31504    6                         ALTRET(NO_FOLD_ERR);
     4643    31505    6                       WORK_STRING.L#=SIZEC(WORK_STRING.NAME#);
     4644    31506    6                       CALL GET_FOLDERNAME (VM_CURRENT_FOLDER);
     4645    31507    6                       call XUR$INFOMSG(E_USING_MSG_FMT,,M$ME_NUM,vector(WORK_STRING));
     4646    31508    6                   end;
     4647    31509    5               END;             /* whenaltreturn */
     4648    31510
     4649    31511    4           END;
     4650    31512    3           IF VM_CURRENT_FOLDER.FLAGS.UPDATE = %NO#
     4651    31513    3           THEN
     4652    31514    4           DO;
     4653    31515
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:165  
     4654    31516        /*E* ERROR: VMO-E$NOUPDATE-0
     4655    31517             MESSAGE: Mailbox open read only.
     4656    31518             */
     4657    31519    5               CALL M$ENQ (FILE_SHARE) WHENALTRETURN DO;
     4658    31520    5   FOLD_BUSY:
     4659    31521    5                   CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;
     4660    31522    5                   CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     4661    31523    5                   VM_CURRENT_FOLDER.FLAGS.OPEN = %NO#;
     4662    31524        /**/
     4663    31525    5                   WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);
     4664    31526    5                   CALL GET_FOLDERNAME (VM_CURRENT_FOLDER);
     4665    31527    5                   CALL XUR$ERRMSG (E_FOLDERBUSY,,,VECTOR(WORK_STRING));
     4666    31528    5                   GOTO NO_FOLD;
     4667    31529    5               END;
     4668    31530    4               CALL XUR$ERRMSG(E_NOUPDATE);
     4669    31531    4           END;
     4670    31532    4           ELSE DO;                   /* Enq and see what we can get */
     4671    31533    5               CALL M$ENQ (FILE_NONE) WHENALTRETURN DO;
     4672    31534    5                   CALL M$ENQ (FILE_SHARE)
     4673    31535    6                   WHENRETURN DO;
     4674    31536    6                       VM_CURRENT_FOLDER.FLAGS.UPDATE= %NO#;
     4675    31537    6                       CALL XUR$ERRMSG(E_NOUPDATE);
     4676    31538    6                   END;
     4677    31539    6                   WHENALTRETURN DO;
     4678    31540    6                       GOTO FOLD_BUSY;
     4679    31541    6                   END;
     4680    31542    5               END;
     4681    31543    4           END;
     4682    31544        /*
     4683    31545             ***** Get the profile ...
     4684    31546        */
     4685    31547    3           CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(NO_PROFILE);
     4686    31548    3           VM_RADDRESS.NOMAD.FOLDER = VM_CURRENT_FOLDER.FOLDER;
     4687    31549    3           IF VM_PROFILE.FILE_FOLDER$ ~= ADDR(NIL)
     4688    31550    3             AND (VM_PROFILE.FILE_FOLDER$->VM$RADDRESS.FOLDER='CENTRAL')
     4689    31551    3             AND (VM_PROFILE.FILE_FOLDER$->VM$RADDRESS.ACCT=B$JIT.ACCN)
     4690    31552    4           THEN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:166  
     4691    31553    4               VM_PROFILE.FILE_FOLDER$ = ADDR(NIL);
     4692    31554    4               CALL VMD$PUT_PROFILE(M$MAIL_FILE_NUM);
     4693    31555    4           END;
     4694    31556        /*
     4695    31557           Put code here to check for incompatibilities between versions of MAIL
     4696    31558           that require extensive fixup.  There was code here up through A02 to
     4697    31559           disallow access to mail folders whose version code was not 'A00'
     4698    31560           (and therefore were built by the pre-release 'B03' MAIL.X);  code
     4699    31561           removed 3/12/86 by dcp to permit use of B00 as an official version number.
     4700    31562        */
     4701    31563    4           IF NOT REOPENED_FOLDER THEN DO;
     4702    31564        /*
     4703    31565             ***** If the folder is full, then notify the user ...
     4704    31566        */
     4705    31567    4               IF VM_PROFILE.GRANULES > 0
     4706    31568    4                 AND VM_PROFILE.GRANULES - VM_CURRENT_FOLDER.UGRANS <=0
     4707    31569    4               THEN            /* Report full!!! */
     4708    31570    5               DO;
     4709    31571    5                   WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);
     4710    31572    5                   CALL VMF$MAKE_ADDRESS1 (WORK_STRING,VM_CURRENT_FOLDER);
     4711    31573    5                   VECT_ARRAY(0) = VECTOR(SUBSTR(WORK_STRING.NAME#,0,WORK_STRING.L#));
     4712    31574    5                   F_FDSME.NVECS# = 1;
     4713    31575                        %INIT_STR (CODE=E_USE_FULL_FMT, STR=VM_USE_FULL_FMT,
     4714    31576                        VECT="F_FDSME.FMT_", TEST=YES);
     4715    31599    5                   CALL VMD$WRITE_BUF (F_FDSME);
     4716    31600    5               END;
     4717    31601    4               IF VM_PROFILE.NUM_LOST > 0
     4718    31602    4                 AND VM_PROFILE.NUM_LOST < %MAX_MSGNO /* for pre-B03 readonly folder */
     4719    31603    5               THEN DO;
     4720    31604                        %INIT_STR (CODE=E_USE_LOST_FMT, STR=VM_USE_LOST_FMT,
     4721    31605                        VECT="F_FDSME.FMT_", TEST=YES);
     4722    31628    5                   F_FDSME.NVECS# = 1;
     4723    31629    5                   VECT_ARRAY(0) = VECTOR (VM_PROFILE.NUM_LOST);
     4724    31630    5                   CALL VMD$WRITE_BUF (F_FDSME);
     4725    31631    5               END;
     4726    31632        /*
     4727    31633             ***** Reinitialize the selection contexts ...
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:167  
     4728    31634        */
     4729    31635    4               CALL INIT_CONTEXT (%CONTEXT_CURRENT);
     4730    31636    4               CALL INIT_CONTEXT (%CONTEXT_SELECTED);
     4731    31637    4               IF VM_PROFILE.NUM_MESSAGES = 0
     4732    31638    5               THEN DO;
     4733    31639    5                   SELECTED_CONTEXT%.NUM_ENTRIES = 0;
     4734    31640    5               END;
     4735    31641    4               ELSE
     4736    31642    5               DO;         /* Messages in this folder to process */
     4737    31643    5                   SELECTED_CONTEXT%.MESSAGE_SET.LOW(0) = 1;
     4738    31644    5                   SELECTED_CONTEXT%.MESSAGE_SET.HIGH(0) = %MAX_MSGNO;
     4739    31645    5                   SELECTED_CONTEXT%.NUM_ENTRIES = 1;
     4740    31646    5                   SELECT_CURRENT = '1'B;
     4741    31647    5                   SELECTED_CONTEXT%.MESSAGE_POINTER = -1;
     4742    31648    5               END;
     4743    31649    4               NUM_MESSAGES_PROCESSED = 0; /* How many in this folder */
     4744    31650        /*
     4745    31651             ***** Get the setup command out of the profile.
     4746    31652                   Unless, bypass was specified...
     4747    31653        */
     4748    31654    4               IF OPT_BYPASS = %NO#
     4749    31655    4               THEN
     4750    31656    5               DO;
     4751    31657    5                   NEXT_COMMAND_TEXT = VM_PROFILE.SETUP;
     4752    31658    5                   IF (NEXT_COMMAND_TEXT.L# ~= 0) AND (B$JIT.CPFLAGS1 AND %CP_ECHO#)
             31658                            THEN NEXT_COMMAND_ECHO# = %YES#;
     4753    31659    5               END;
     4754    31660    4           END;                  /* Not reopened */
     4755    31661    4           DO NEVER;
     4756    31662    4   NO_PROFILE:
     4757    31663    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     4758    31664    4               CALL XUR$ERRMSG(E_FOLDEROLD,B$TCB.ALT$->B$ALT.DCB#);
     4759    31665    4               CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);
     4760    31666    4               CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;
     4761    31667    5               CALL M$CLOSE (CLOSE_SAVE) WHENALTRETURN DO;
     4762    31668    5               END;
     4763    31669    4               VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:168  
     4764    31670    4               GOTO NO_FOLD;
     4765    31671    4   NO_FOLD_ERR:
     4766    31672    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     4767    31673    4               DCB# = B$TCB.ALT$ -> B$ALT.DCB#;
     4768    31674    4               CALL XUR$ERRMSG (ERROR,DCB#);
     4769    31675    4   NO_FOLD:
     4770    31676    4               CALL XUR$ERRMSG (E_NOCURFOLD);
     4771    31677    4               VM_SEARCH_INFO.ACTIVE = '0'B;
     4772    31678    4               VM_SEARCH_INFO.CURRENT= '0'B;
     4773    31679    5               DO INDX4=0 TO %VM_MAX_SRCH;
     4774    31680    5                   VM_PROFILE.SEARCH_LIST$(INDX4) = ADDR(NIL);
     4775    31681    5               END;
     4776    31682    4           END;                       /* Do never */
     4777    31683        /*
     4778    31684             ***** Enable breaks again ...
     4779    31685        */
     4780    31686    3           CALL XUR$ENABLE;
     4781    31687        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:169  
     4782    31688        /* Wait command */
     4783    31689    3       CASE (%CMD_WAIT);
     4784    31690    3           CALL NEED_FOLDER ALTRET(CONTINUE);
     4785    31691    4           DO FOREVER;
     4786    31692    4               CALL CHECK_NEW (M$MAIL_FILE_NUM);
     4787    31693    4               IF NEW_FLAG THEN EXIT;
     4788    31694    4               CALL M$WAIT (WAIT30);
     4789    31695    4               NEW_FLAG='0'B;
     4790    31696    4           END;                       /* Do forever  (until new message) */
     4791    31697        /*
     4792    31698             ***** Notify the user that new messages have been delivered ...
     4793    31699        */
     4794    31700    3           CALL XUR$INFOMSG (E_NEW_MESSAGE_FMT,,M$ME_NUM);
     4795    31701    3           NEW_FLAG = %NO#;
     4796    31702        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:170  
     4797    31703    3       END;                             /* End cases */
     4798    31704    2   CONTINUE: ;
     4799    31705    2       RETURN;
     4800    31706
     4801    31707
     4802    31708        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:171  
     4803    31709    2   BAD_PROFILE:
     4804    31710    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     4805    31711    2       CALL XUR$ERRMSG(E_FOLDEROLD,B$TCB.ALT$->B$ALT.DCB#);
     4806    31712    2       CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);
     4807    31713    2       CALL M$EXIT;
     4808    31714    2   WRITE_ERROR: ;
     4809    31715        /*E* ERROR: VMO-E$WERR-4
     4810    31716             MESSAGE: Error occurred while writing the mail file
     4811    31717             DESCRIPTION: While attempting to write to the mail file
     4812    31718                            a monitor error was encountered
     4813    31719              */
     4814    31720    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     4815    31721    2       CALL XUR$ERRMSG(E_WERR);
     4816    31722    2       CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);
     4817    31723    2       GOTO CONTINUE;
     4818    31724
     4819    31725        /**/
     4820    31726    2   E_PMME:
     4821    31727    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     4822    31728    2       DCB# = B$TCB.ALT$ -> B$ALT.DCB#;
     4823    31729    2       CALL XUR$ERRMSG (ERROR,DCB#);
     4824    31730    2       CALL XUR$ENABLE;
     4825    31731    2       DEQ_PROFILE.V.DCB# = ENQ_PROFILE.V.DCB#;
     4826    31732    3       CALL M$DEQ (DEQ_PROFILE) WHENALTRETURN DO;
     4827    31733    3       END;
     4828    31734    2       GOTO CONTINUE;
     4829    31735        /**/
     4830    31736    2   E_ALLOCATE:
     4831    31737    2       CALL XUR$ERRMSG (X$MCB.ERR);
     4832    31738    2       GOTO CONTINUE;
     4833    31739    2   END PROCESS_CMD;
     4834    31740        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:172  
     4835    31741        /********************************************************************/
     4836    31742        /*F*    NAME: NEED_FOLDER, NEED_UPDATE, NEED_GLOBAL
     4837    31743                PURPOSE: To verify that a folder is open, open for update,
     4838    31744                         or open for update to the global mailbox, before
     4839    31745                         executing a command.
     4840    31746        */
     4841    31747        /********************************************************************/
     4842    31748    1   NEED_FOLDER: PROC ALTRET;
     4843    31749    2       IF VM_CURRENT_FOLDER.FLAGS.OPEN THEN RETURN;
     4844    31750    2   NO_FOLDER:
     4845    31751    2       CALL XUR$ERRMSG (E_NEEDMID);
     4846    31752    2       ALTRETURN;
     4847    31753        /*E* ERROR: VMO-E$NEEDMID-1
     4848    31754          MESSAGE: That command is not permitted without a folder open.
     4849    31755          MESSAGE1: The USE command must be issued first to open a folder.
     4850    31756        */
     4851    31757    2   NEED_UPDATE: ENTRY ALTRET;
     4852    31758    2       IF NOT VM_CURRENT_FOLDER.FLAGS.OPEN THEN GOTO NO_FOLDER;
     4853    31759    2       IF VM_CURRENT_FOLDER.FLAGS.UPDATE THEN RETURN;
     4854    31760    2   NO_UPDATE:
     4855    31761    2       CALL XUR$ERRMSG (E_NOTALLOW);
     4856    31762    2       ALTRETURN;
     4857    31763        /*E* ERROR: VMO-E$NOTALLOW-0
     4858    31764             MESSAGE: Command not allowed when mailbox open for reading only.
     4859    31765        */
     4860    31766    2   NEED_GLOBAL: ENTRY ALTRET;
     4861    31767    2       IF NOT VM_CURRENT_FOLDER.FLAGS.OPEN THEN GOTO NO_FOLDER;
     4862    31768    2       IF NOT VM_CURRENT_FOLDER.FLAGS.UPDATE THEN GOTO NO_UPDATE;
     4863    31769    2       FPT_CORRES.V.DCB1# = M$MAIL_FILE_NUM;
     4864    31770    2       FPT_CORRES.V.DCB2# = M$MAIL_GLOBAL_NUM;
     4865    31771    2       CALL M$CORRES (FPT_CORRES)
     4866    31772    3       WHENRETURN DO;
     4867    31773    3           CALL XUR$ERRMSG (E_NOTMCENTRAL);
     4868    31774    3           ALTRETURN;
     4869    31775    3       END;
     4870    31776    2       RETURN;
     4871    31777        /*E*    ERROR: VMO-E$NOTMCENTRAL-0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:173  
     4872    31778                MESSAGE: You cannot create/delete a USER except in .:MAIL/CENTRAL
     4873    31779                MESSAGE1: You are not USEing .:MAIL_CENTRAL
     4874    31780        */
     4875    31781    2   END;
     4876    31782        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:174  
     4877    31783        /*********************************************************************/
     4878    31784        /*F*    NAME:   CLOSE_SEARCH
     4879    31785                PURPOSE: To close all open DCBS in the search list except
     4880    31786                         for the global and current folders.
     4881    31787        */
     4882    31788        /*********************************************************************/
     4883    31789    1   CLOSE_SEARCH: PROC;
     4884    31790    3       DO INDX4 = 0 TO VM_SEARCH_INFO.NUM_ENTRIES-1;
     4885    31791    3           IF VM_SEARCH_INFO.DCB#(INDX4) ~= M$MAIL_FILE_NUM AND
     4886    31792    3             VM_SEARCH_INFO.DCB#(INDX4) ~= M$MAIL_GLOBAL_NUM
     4887    31793    3           THEN
     4888    31794    3               IF DCBADDR(VM_SEARCH_INFO.DCB#(INDX4))->F$DCB.FCD#
     4889    31795    4               THEN DO;
     4890    31796    4                   CLOSE_SAVE.V.DCB# = VM_SEARCH_INFO.DCB#(INDX4);
     4891    31797    5                   CALL M$CLOSE (CLOSE_SAVE) WHENALTRETURN DO;
     4892    31798    5                   END;
     4893    31799    4               END;
     4894    31800    3       END;
     4895    31801    2       VM_SEARCH_INFO.ACTIVE = '0'B;
     4896    31802    2   END CLOSE_SEARCH;
     4897    31803        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:175  
     4898    31804        /*********************************************************************/
     4899    31805        /*F*    NAME:       GET_WILD_FOLDER
     4900    31806                PURPOSE:    To open the next folder which matched wildcard.
     4901    31807                DESCRIPTION: ???
     4902    31808        */
     4903    31809        /*********************************************************************/
     4904    31810    1   GET_WILD_FOLDER: PROC ALTRET;
     4905    31811        /*
     4906    31812             ***** Make sure work DCB isn't left open ...
     4907    31813        */
     4908    31814    2       IF DCBADDR(M$WORK_NUM) -> F$DCB.FCD#
     4909    31815    3       THEN DO;
     4910    31816    3           CLOSE_SAVE.V.DCB# = M$WORK_NUM;
     4911    31817    4           CALL M$CLOSE (CLOSE_SAVE) WHENALTRETURN DO; END;
     4912    31818    3       END;
     4913    31819        /*
     4914    31820             ***** Find the next mail folder ...
     4915    31821        */
     4916    31822    3       DO WHILE WILD;
     4917    31823    3           CALL M$OPEN (OPEN_NEXT)
     4918    31824    4           WHENALTRETURN DO;
     4919    31825    4               IF B$TCB.ALT$ -> B$ALT.ERR.CODE = %E$FDEOF
     4920    31826    4               THEN                       /* End of file directory */
     4921    31827    4                   ALTRETURN;
     4922    31828    4               ELSE
     4923    31829    4                   GOTO E_PMME;
     4924    31830    4           END;                            /* Do never ... end */
     4925    31831    3           IF SUBSTR(DCBADDR(M$WORK_NUM)->F$DCB.NAME#.C,0,6) ~= ':MAIL_'
     4926    31832    3           THEN
     4927    31833    3               ALTRETURN;
     4928    31834    3           VM_WILDCARD.INPUT_ = VECTOR(VM_RADDRESS.FOLDER);
     4929    31835    3           VM_RADDRESS.FOLDER = SUBSTR(DCBADDR(M$WORK_NUM)->F$DCB.NAME#.C,6);
     4930    31836    3           CALL X$WILDCMP (VM_WILDCARD)
     4931    31837    4           WHENRETURN DO;
     4932    31838    4               GOTO MATCH_FOUND;
     4933    31839    4           END;
     4934    31840    4           DO NEVER;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:176  
     4935    31841    4   E_PMME:     ;
     4936    31842    4               CALL XUR$ERRMSG (B$TCB.ALT$ -> B$ALT.ERR, M$WORK_NUM);
     4937    31843    4               IF NOT WILD
     4938    31844    4               THEN
     4939    31845    4                   ALTRETURN;
     4940    31846    4           END/*NEVER*/;
     4941    31847    3           OPEN_NEXT.NAME_ = VECTOR(NIL);
     4942    31848    3       END/*WHILE WILD*/;
     4943    31849        /*
     4944    31850             ***** When match found (or if not wild), open the folder
     4945    31851        */
     4946    31852    2   MATCH_FOUND: ;
     4947    31853    2       VM_WORK_FOLDER.FLAGS = '0'B;
     4948    31854    2       CALL VMA$OPEN_FOLDER (VM_WORK_FOLDER,ADDR(VM_RADDRESS),M$WORK_NUM,
     4949    31855    2         %OLDFILE#,%UPDATE#) ALTRET(E_PMME);
     4950    31856    2       RETURN;
     4951    31857    2   END GET_WILD_FOLDER;
     4952    31858        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:177  
     4953    31859        /*********************************************************************/
     4954    31860        /*F*    NAME:        DEL_NAMEMAP_ENTRIES
     4955    31861                PURPOSE:     To delete all NAMEMAP entries for a USER.
     4956    31862                DESCRIPTION: This routine will delete all the entries in
     4957    31863                             the reverse name map (:NAME.:MAIL) which are found
     4958    31864                             in the definition pointed to by VM_ADD_HEAD.HEAD$.
     4959    31865        */
     4960    31866        /*********************************************************************/
     4961    31867    1   DEL_NAMEMAP_ENTRIES: PROC ALTRET;
     4962    31868    2       PTR1$ = VM_ADD_HEAD.HEAD$;
     4963    31869    2       NAME_KEY.L# = 20;
     4964    31870    3       DO FOREVER;
     4965    31871    3           CALL VMA$GET_NEXT_ENTRY (VM_UADDRESS,VM_RADDRESS,
     4966    31872    3             PTR1$,VM_ADDLIST$) ALTRET(END_DEL_NAME_MAP);
     4967    31873    3           NAME_KEY.NAME# = VM_UADDRESS.NAME_KEY;
     4968    31874    3           IF VM_UADDRESS.SITENAME = ' '
     4969    31875    3             OR VM_UADDRESS.SITENAME = VM_SITENAME
     4970    31876    3             AND NAME_KEY.NAME# ~= ' '
     4971    31877    3           THEN
     4972    31878    4           DO;
     4973    31879    4               CALL M$DELREC (DELREC_NAME_MAP) ALTRET(IGNORE);
     4974    31880    4   IGNORE:     ;
     4975    31881    4           END;
     4976    31882    3       END;                            /* Do forever ... end */
     4977    31883    2   END_DEL_NAME_MAP: ;
     4978    31884    2       RETURN;
     4979    31885    2   END DEL_NAMEMAP_ENTRIES;
     4980    31886        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:178  
     4981    31887        /********************************************************************/
     4982    31888        /*F*    NAME: GET_FOLDERNAME
     4983    31889                PURPOSE: To obtain the current folder name for use in an
     4984    31890                         error message.
     4985    31891                DESCRIPTION: This routine will get the current folder name in
     4986    31892                             WORK_STRING, and, if it is too long to fit in an
     4987    31893                             error message substitution field, will truncate
     4988    31894                             it to fit.
     4989    31895        */
     4990    31896        /********************************************************************/
     4991    31897    1   GET_FOLDERNAME: PROC (FOLDER_SPEC);
     4992    31898        %VM_FOLDER_INFO (NAME=FOLDER_SPEC, STCLASS=PARAM);
     4993    31950        /**/
     4994    31951    2       WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);
     4995    31952    2       CALL VMF$MAKE_ADDRESS1 (WORK_STRING,FOLDER_SPEC);
     4996    31953    2       IF WORK_STRING.L# > 31
     4997    31954    3       THEN DO;
     4998    31955    3           WORK_STRING.L# = 31;
     4999    31956    3           SUBSTR (WORK_STRING.NAME#,28,3) = '...';
     5000    31957    3       END;
     5001    31958    2       RETURN;
     5002    31959    2   END GET_FOLDERNAME;
     5003    31960        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:179  
     5004    31961        /*********************************************************************/
     5005    31962        /*F*    NAME:        LINK_RUNIT
     5006    31963                PURPOSE:     To M$LINK to specified rununit.
     5007    31964                DESCRIPTION: This routine will M$LINK to the specified
     5008    31965                             rununit and perform any necessary cleanup
     5009    31966                             so that MAIL works as though uninterrupted.
     5010    31967        */
     5011    31968        /*********************************************************************/
     5012    31969    1   LINK_RUNIT: PROC ALTRET;
     5013    31970    2       CALL XUR$DISABLE;
     5014    31971        /*
     5015    31972             ***** Write the profile out if updating is permitted.
     5016    31973        */
     5017    31974    2       IF VM_CURRENT_FOLDER.FLAGS.UPDATE = %YES#
     5018    31975    2       THEN
     5019    31976    2           CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(E_PMME);
     5020    31977    2       VM_CURRENT_FOLDER.FLAGS.OPEN = %NO#;
     5021    31978        /*
     5022    31979             ***** Assume that FPT_LINK is setup correctly ...
     5023    31980        */
     5024    31981    2       CALL M$LINK (FPT_LINK)
     5025    31982    3       WHENALTRETURN DO;
     5026    31983    3           ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     5027    31984    3           DCB# = B$TCB.ALT$ -> B$ALT.DCB#;
     5028    31985        /*
     5029    31986             ***** If the M$LINK failed because of rundownip
     5030    31987                   then exit mail now!
     5031    31988        */
     5032    31989    3           IF ERROR.ERR# = %E$EKEY
     5033    31990    3           THEN
     5034    31991    4           DO;
     5035    31992                    %INIT_STR (CODE=E_END_NOUPDATE_CMD, STR=VM_END_NOUPDATE_CMD,
     5036    31993                    NEXT_CMD=VM_END_NOUPDATE_CMD, TEST=YES);
     5037    32016    4               ALTRETURN;
     5038    32017    4           END;
     5039    32018    3           CALL XUR$ERRMSG (ERROR,DCB#);
     5040    32019    3       END;                            /* Do never ... end */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:180  
     5041    32020    2       VM_CURRENT_FOLDER.FLAGS.OPEN = %YES#;
     5042    32021    2       IF VM_CURRENT_FOLDER.FLAGS.UPDATE = %NO#
     5043    32022    2       THEN
     5044    32023    3       DO;
     5045    32024
     5046    32025    4           CALL M$ENQ (FILE_SHARE) WHENALTRETURN DO;
     5047    32026    4   FOLD_BUSY:
     5048    32027    4               CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;
     5049    32028    4               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     5050    32029    4               VM_CURRENT_FOLDER.FLAGS.OPEN = %NO#;
     5051    32030        /**/
     5052    32031    4               WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);
     5053    32032    4               CALL GET_FOLDERNAME (VM_CURRENT_FOLDER);
     5054    32033    4               CALL XUR$ERRMSG (E_FOLDERBUSY,,,VECTOR(WORK_STRING));
     5055    32034    4               GOTO NO_FOLD;
     5056    32035    4           END;
     5057    32036    3           CALL XUR$ERRMSG(E_NOUPDATE);
     5058    32037    3       END;
     5059    32038    3       ELSE DO;                        /* Enq and see what we can get */
     5060    32039    4           CALL M$ENQ (FILE_NONE) WHENALTRETURN DO;
     5061    32040    4               CALL M$ENQ (FILE_SHARE)
     5062    32041    5               WHENRETURN DO;
     5063    32042    5                   VM_CURRENT_FOLDER.FLAGS.UPDATE = %NO#;
     5064    32043    5                   CALL XUR$ERRMSG(E_NOUPDATE);
     5065    32044    5               END;
     5066    32045    5               WHENALTRETURN DO;
     5067    32046    5                   GOTO FOLD_BUSY;
     5068    32047    5               END;
     5069    32048    4           END;
     5070    32049    3       END;
     5071    32050    3       DO NEVER;
     5072    32051    3   NO_FOLD:
     5073    32052    3           CALL XUR$ERRMSG (E_NOCURFOLD);
     5074    32053    3           VM_SEARCH_INFO.ACTIVE = '0'B;
     5075    32054    3           VM_SEARCH_INFO.CURRENT = '0'B;
     5076    32055    4           DO INDX4=0 TO %VM_MAX_SRCH;
     5077    32056    4               VM_PROFILE.SEARCH_LIST$(INDX4) = ADDR(NIL);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:181  
     5078    32057    4           END;
     5079    32058    3       END;
     5080    32059        /*
     5081    32060             ***** Get the profile back ...
     5082    32061        */
     5083    32062    2       IF VM_CURRENT_FOLDER.FLAGS.OPEN
     5084    32063    2       THEN
     5085    32064    2           CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(E_PMME);
     5086    32065    2       CALL XUR$CLRENABLE;
     5087    32066    2       RETURN;
     5088    32067        /**/
     5089    32068    2   E_PMME:
     5090    32069    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     5091    32070    2       DCB# = B$TCB.ALT$ -> B$ALT.DCB#;
     5092    32071    2       CALL XUR$ERRMSG (ERROR,DCB#);
     5093    32072    2       CALL XUR$CLRENABLE;
     5094    32073    2       ALTRETURN;
     5095    32074    2   END LINK_RUNIT;
     5096    32075        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:182  
     5097    32076        /*********************************************************************/
     5098    32077        /*F*    NAME:       REPORT_ACTIVITY
     5099    32078                PURPOSE:     To report values using specified formats.
     5100    32079                DESCRIPTION: This routine will report the value of VALUE
     5101    32080                             using the passed format (FMT_) unless VALUE
     5102    32081                             is zero and SUBSTITUTE is YES. Then the message
     5103    32082                             "No message found" will be printed.
     5104    32083        */
     5105    32084        /*********************************************************************/
     5106    32085    1   REPORT_ACTIVITY: PROC (VALUE, FMT, SUBSTITUTE#, CODE);
     5107    32086    2   DCL VALUE SBIN WORD;
     5108    32087        %VLP_NAME (FPTN=FMT, STCLASS=PARAM);
     5109    32114    2   DCL SUBSTITUTE# BIT(1);
     5110    32115    2   DCL CODE          UBIN;
     5111    32116        /**/
     5112    32117    2       IF VALUE = 0
     5113    32118    2         AND SUBSTITUTE# = %YES#
     5114    32119    2       THEN
     5115    32120    3       DO;
     5116    32121    3           F_FDSME.NVECS# = 0;
     5117    32122                %INIT_STR (CODE=E_NO_MESSAGE_FMT, STR=VM_NO_MESSAGE_FMT,
     5118    32123                VECT="F_FDSME.FMT_", TEST=YES);
     5119    32146    3       END;
     5120    32147    2       ELSE
     5121    32148    3       DO;
     5122    32149    3           VECT_ARRAY(0) = VECTOR(VALUE);
     5123    32150    3           F_FDSME.NVECS# = 1;
     5124    32151                %INIT_STR (CODE=CODE, STR=FMT, VECT="F_FDSME.FMT_", TEST=YES);
     5125    32174    3       END;
     5126    32175    2       CALL VMD$WRITE_BUF (F_FDSME);
     5127    32176    2       RETURN;
     5128    32177    2   END REPORT_ACTIVITY;
     5129    32178        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:183  
     5130    32179        /*********************************************************************/
     5131    32180        /*F*    NAME:        INIT_CONTEXT
     5132    32181                PURPOSE:     To initialize the specified CONTEXT for SELECTIONS
     5133    32182                DESCRIPTION: This routine will reset all items in the specified
     5134    32183                             CONTEXT, i.e. SELECTION CONTEXT information.
     5135    32184        */
     5136    32185        /*********************************************************************/
     5137    32186    1   INIT_CONTEXT: PROC (WHICH_CONTEXT);
     5138    32187    2   DCL WHICH_CONTEXT UBIN WORD;
     5139    32188        /**/
     5140    32189    2       CONTEXT_PTR$(WHICH_CONTEXT) = PINCRW(VM_SELECT$,WHICH_CONTEXT*512);
     5141    32190    2       CONTEXT_PTR$(WHICH_CONTEXT) -> VM$CONTEXT.MESSAGE_POINTER = -1;
     5142    32191    2       CONTEXT_PTR$(WHICH_CONTEXT) -> VM$CONTEXT.TRUTH_TREE$ = ADDR(NIL);
     5143    32192    2       CONTEXT_PTR$(WHICH_CONTEXT) -> VM$CONTEXT.NUM_ENTRIES = 0;
     5144    32193    2       CONTEXT_PTR$(WHICH_CONTEXT) -> VM$CONTEXT.FLAGS = %NO#;
     5145    32194    2       RETURN;
     5146    32195    2   END INIT_CONTEXT;
     5147    32196        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:184  
     5148    32197        /********************************************************************/
     5149    32198        /*F*    NAME:        FIX_CONTEXT
     5150    32199                PURPOSE:     To fix the top end of the message selection range.
     5151    32200                DESCRIPTION: If the current context range is the entire folder,
     5152    32201                             this routine limits it to the number of messages
     5153    32202                             currently in the folder, so that commands which
     5154    32203                             can add new messages don't get into a loop.
     5155    32204        */
     5156    32205        /********************************************************************/
     5157    32206    1   FIX_CONTEXT: PROC;
     5158    32207        /**/
     5159    32208    2       IF CURRENT_CONTEXT%.NUM_ENTRIES = 1
     5160    32209    2         AND CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = 1
     5161    32210    2         AND CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = %MAX_MSGNO
     5162    32211    2       THEN
     5163    32212    2           CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = VM_PROFILE.HI_MESSAGE_NUMBER;
     5164    32213    2       RETURN;
     5165    32214    2   END FIX_CONTEXT;
     5166    32215        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:185  
     5167    32216        /*********************************************************************/
     5168    32217        /*F*    NAME:        INIT$SELECT_OPTS
     5169    32218                PURPOSE:     To initialize all SELECTION CRITIERIA tables.
     5170    32219                DESCRIPTION: This includes setting up the MESSAGE SET and
     5171    32220                             saving the parse tree for the TRUTH EXPRESSION.
     5172    32221        */
     5173    32222        /*********************************************************************/
     5174    32223    1   INIT$SELECT_OPTS: PROC (BLK$,COMMAND) ALTRET;
     5175    32224        /***** Parameters *****/
     5176    32225    2   DCL BLK$ PTR;
     5177    32226    2   DCL COMMAND UBIN WORD;
     5178    32227        /***** Local variables *****/
     5179    32228    2   DCL PTR1$ PTR STATIC;
     5180    32229    2   DCL PTR2$ PTR STATIC;
     5181    32230    2   DCL VALUE1 SBIN WORD STATIC;
     5182    32231    2   DCL VALUE2 SBIN WORD STATIC;
     5183    32232    2   DCL INDX1 SBIN WORD STATIC;
     5184    32233    2   DCL INDX2 SBIN WORD STATIC;
     5185    32234    2   DCL START_BLK SBIN WORD STATIC;
     5186    32235        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:186  
     5187    32236        /*
     5188    32237             ***** If no options are present,
     5189    32238                   then assume all current. That is,
     5190    32239                   don't do anything ...
     5191    32240        */
     5192    32241    2       START_BLK = 0;
     5193    32242    2       IF BLK$ -> P$B.NSUBLKS = 0
     5194    32243    2       THEN
     5195    32244    2           RETURN;
     5196    32245        /*
     5197    32246             ***** The selection functions work on one of the
     5198    32247                   contexts. Therefore, they must be processed,
     5199    32248                   if they were specified, without initializing
     5200    32249                   the context info. All other selection criteria
     5201    32250                   depend upon a cleanly initialized context area ...
     5202    32251        */
     5203    32252    3       DO CASE (BLK$ -> P$B.SUBLK$(0) -> P$B.CODE);
     5204    32253    3       CASE (%SEL_PREVIOUS, %SEL_NEXT);
     5205    32254    3           NEED_TITLE_BAR = %NO#;
     5206    32255    3       CASE (ELSE);
     5207    32256    3       END;
     5208    32257    2   RELATIVE_FUNCTIONS:
     5209    32258    3       DO CASE (BLK$ -> P$B.SUBLK$(0) -> P$B.CODE);
     5210    32259    3       CASE (%SEL_SELECTED);
     5211    32260                            /* Copy the selected context into the current context */
     5212    32261    3           CALL INIT_CONTEXT (%CONTEXT_CURRENT);
     5213    32262    4           DO INDX1 = 0 TO SELECTED_CONTEXT%.NUM_ENTRIES;
     5214    32263    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX1) =
     5215    32264    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX1);
     5216    32265    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX1) =
     5217    32266    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX1);
     5218    32267    4           END;
     5219    32268    3           CURRENT_CONTEXT%.NUM_ENTRIES = SELECTED_CONTEXT%.NUM_ENTRIES;
     5220    32269    3           CURRENT_CONTEXT%.TRUTH_TREE$ = SELECTED_CONTEXT%.TRUTH_TREE$;
     5221    32270    3       CASE (%SEL_THIS);
     5222    32271        /*
     5223    32272          **** Already incremented so decrement so that the proper message is obtained.
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:187  
     5224    32273        */
     5225    32274    3           CURRENT_CONTEXT%.MESSAGE_POINTER = CURRENT_CONTEXT%.MESSAGE_POINTER - 1;
     5226    32275    3           CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = SELECTED_CONTEXT%.MESSAGE_POINTER;
     5227    32276    3           CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = SELECTED_CONTEXT%.MESSAGE_POINTER;
     5228    32277    3           CURRENT_CONTEXT%.NUM_ENTRIES = 1;
     5229    32278    3       CASE (%SEL_FIRST,
     5230    32279    3             %SEL_NEXT,
     5231    32280    3             %SEL_REST);
     5232    32281    3           CALL INIT_CONTEXT (%CONTEXT_CURRENT);
     5233    32282        /*
     5234    32283             ***** If MESSAGE_POINTER has never been set (i.e. -1)
     5235    32284                   or if SEL_FIRST then start from first message ...
     5236    32285        */
     5237    32286    3           IF SELECTED_CONTEXT%.MESSAGE_POINTER = -1
     5238    32287    3             OR BLK$ -> P$B.SUBLK$(0) -> P$B.CODE = %SEL_FIRST
     5239    32288    3           THEN
     5240    32289    3               GOTO SELECT_FIRST;
     5241    32290        /*
     5242    32291             ***** Determine the first possible message number ...
     5243    32292        */
     5244    32293    4           DO INDX2 = 0 TO SELECTED_CONTEXT%.NUM_ENTRIES - 1;
     5245    32294    4               IF SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX2) <=
     5246    32295    4                 SELECTED_CONTEXT%.MESSAGE_POINTER
     5247    32296    4                 AND SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX2) >=
     5248    32297    4                 SELECTED_CONTEXT%.MESSAGE_POINTER
     5249    32298    4               THEN
     5250    32299    4                   EXIT;
     5251    32300    4           END;                       /* Do INDX2 = ... end */
     5252    32301    3           IF SELECTED_CONTEXT%.MESSAGE_POINTER ~=
     5253    32302    3             SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX2)
     5254    32303    3           THEN
     5255    32304    4           DO;
     5256    32305        /*
     5257    32306             ***** Use MESSAGE_POINTER + 1 as the beginning ...
     5258    32307        */
     5259    32308    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) =
     5260    32309    4                 SELECTED_CONTEXT%.MESSAGE_POINTER + 1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:188  
     5261    32310    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) =
     5262    32311    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX2);
     5263    32312    4               CURRENT_CONTEXT%.NUM_ENTRIES = 1;
     5264    32313    4               INDX2 = INDX2 + 1;
     5265    32314    4           END;
     5266    32315    3           ELSE
     5267    32316    4           DO;
     5268    32317        /*
     5269    32318             ***** Start at the next entry in the MESSAGE_SET
     5270    32319                   if there is one. Otherwise, rest is zero ...
     5271    32320        */
     5272    32321    4               IF INDX2 = SELECTED_CONTEXT%.NUM_ENTRIES - 1
     5273    32322    4               THEN
     5274    32323    5               DO;
     5275    32324    5                   EXIT RELATIVE_FUNCTIONS;
     5276    32325    5               END;
     5277    32326    4               ELSE
     5278    32327    5               DO;
     5279    32328    5                   INDX2 = INDX2 + 1;
     5280    32329    5               END;
     5281    32330    4           END;
     5282    32331    4           DO NEVER;
     5283    32332    4   SELECT_FIRST:
     5284    32333    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) =
     5285    32334    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(0);
     5286    32335    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) =
     5287    32336    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(0);
     5288    32337    4               CURRENT_CONTEXT%.NUM_ENTRIES = 1;
     5289    32338    4               INDX2 = 1;
     5290    32339    4           END;
     5291    32340    4           DO INDX1 = INDX2 TO SELECTED_CONTEXT%.NUM_ENTRIES - 1;
     5292    32341    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(CURRENT_CONTEXT%.NUM_ENTRIES) =
     5293    32342    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX1);
     5294    32343    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(CURRENT_CONTEXT%.NUM_ENTRIES) =
     5295    32344    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX1);
     5296    32345    4               CURRENT_CONTEXT%.NUM_ENTRIES = CURRENT_CONTEXT%.NUM_ENTRIES + 1;
     5297    32346    4           END;                       /* Do INDX1 = ... end */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:189  
     5298    32347    3           CURRENT_CONTEXT%.TRUTH_TREE$ = SELECTED_CONTEXT%.TRUTH_TREE$;
     5299    32348    4           DO CASE (BLK$ -> P$B.SUBLK$(0) -> P$B.CODE);
     5300    32349    4           CASE (%SEL_FIRST,
     5301    32350    4             %SEL_NEXT);
     5302    32351    4               CURRENT_CONTEXT%.FLAGS.NEXT = %YES#;
     5303    32352    4           END;                        /* Do case ... end */
     5304    32353    3       CASE (%SEL_LAST,
     5305    32354    3             %SEL_PREVIOUS);
     5306    32355    3           CALL INIT_CONTEXT (%CONTEXT_CURRENT);
     5307    32356        /*
     5308    32357             ***** If MESSAGE_POINTER has never been set (i.e. -1)
     5309    32358                   or if SEL_LAST then start from last message ...
     5310    32359        */
     5311    32360    3           IF SELECTED_CONTEXT%.MESSAGE_POINTER = -1
     5312    32361    3             OR BLK$ -> P$B.SUBLK$(0) -> P$B.CODE = %SEL_LAST
     5313    32362    3           THEN
     5314    32363    3               GOTO SELECT_LAST;
     5315    32364        /*
     5316    32365             ***** Determine the last possible message number ...
     5317    32366        */
     5318    32367    4           DO INDX2 = SELECTED_CONTEXT%.NUM_ENTRIES -1 DOWNTO 0;
     5319    32368    4               IF SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX2) <=
     5320    32369    4                 SELECTED_CONTEXT%.MESSAGE_POINTER
     5321    32370    4                 AND SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX2) >=
     5322    32371    4                 SELECTED_CONTEXT%.MESSAGE_POINTER
     5323    32372    4               THEN
     5324    32373    4                   EXIT;
     5325    32374    4           END;                       /* Do INDX2 = ... end */
     5326    32375    3           IF SELECTED_CONTEXT%.MESSAGE_POINTER ~=
     5327    32376    3             SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX2)
     5328    32377    3           THEN
     5329    32378    4           DO;
     5330    32379        /*
     5331    32380             ***** Use MESSAGE_POINTER as the beginning ...
     5332    32381        */
     5333    32382    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX2) =
     5334    32383    4                 SELECTED_CONTEXT%.MESSAGE_POINTER;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:190  
     5335    32384    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX2) =
     5336    32385    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX2);
     5337    32386    4               CURRENT_CONTEXT%.NUM_ENTRIES = 1;
     5338    32387    4               INDX2 = INDX2 - 1;
     5339    32388    4           END;
     5340    32389    3           ELSE
     5341    32390    4           DO;
     5342    32391        /*
     5343    32392             ***** Start at the previous entry in the MESSAGE_SET
     5344    32393                   if there is one. Otherwise, rest is zero ...
     5345    32394        */
     5346    32395    4               IF INDX2 = 0
     5347    32396    4               THEN
     5348    32397    5               DO;
     5349    32398    5                   EXIT RELATIVE_FUNCTIONS;
     5350    32399    5               END;
     5351    32400    4               ELSE
     5352    32401    5               DO;
     5353    32402    5                   INDX2 = INDX2 - 1;
     5354    32403    5               END;
     5355    32404    4           END;
     5356    32405    4           DO NEVER;
     5357    32406    4   SELECT_LAST:
     5358    32407    4               INDX2 = SELECTED_CONTEXT%.NUM_ENTRIES - 1;
     5359    32408    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX2) =
     5360    32409    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX2);
     5361    32410    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX2) =
     5362    32411    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX2) + 1;
     5363    32412    4               CURRENT_CONTEXT%.NUM_ENTRIES = 1;
     5364    32413    4               INDX2 = INDX2 - 1;
     5365    32414    4           END;
     5366    32415    4           DO INDX1 = INDX2 DOWNTO 0;
     5367    32416    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX1) =
     5368    32417    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX1);
     5369    32418    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX1) =
     5370    32419    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX1) + 1;
     5371    32420    4               CURRENT_CONTEXT%.NUM_ENTRIES = CURRENT_CONTEXT%.NUM_ENTRIES + 1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:191  
     5372    32421    4           END;
     5373    32422    3           CURRENT_CONTEXT%.TRUTH_TREE$ = SELECTED_CONTEXT%.TRUTH_TREE$;
     5374    32423    3           CURRENT_CONTEXT%.FLAGS.PREV = %YES#;
     5375    32424    3           CURRENT_CONTEXT%.FLAGS.INVERSE = %YES#;
     5376    32425    3       CASE (ELSE);
     5377    32426                                 /* Must be one of the other selection criteria items */
     5378    32427    3           GOTO OTHER_CRITERIA;
     5379    32428    3       END;
     5380    32429    2       IF BLK$ -> P$B.NSUBLKS = 2 THEN    /* IE. 'MOVE SEL TO NAME TO FOLDER' */
     5381    32430    3       DO;
     5382    32431    3           START_BLK = 1;
     5383    32432    3           GOTO FINISH_MOVE_CMD;
     5384    32433    3       END;
     5385    32434    2       WHICH_CONTEXT = %CONTEXT_SELECTED;
     5386    32435    2       RETURN;
     5387    32436        /*
     5388    32437             ***** Process selection criteria other than
     5389    32438                   selection functions ...
     5390    32439        */
     5391    32440    2   OTHER_CRITERIA: ;
     5392    32441        /*
     5393    32442             ***** Initialize the current context ...
     5394    32443        */
     5395    32444    2       CALL INIT_CONTEXT (%CONTEXT_CURRENT);
     5396    32445        /*
     5397    32446             ***** Stuff the message set info into the context table ...
     5398    32447        */
     5399    32448    2   FINISH_MOVE_CMD: ;
     5400    32449    3       DO INDX1 = START_BLK TO BLK$ -> P$B.NSUBLKS - 1;
     5401    32450    3           PTR1$ = BLK$ -> P$B.SUBLK$(INDX1);
     5402    32451    4           DO SELECT (PTR1$ -> P$B.CODE);
     5403    32452    4               SELECT (%SEL_ALL);
     5404    32453    4               IF COMMAND = %CMD_SELECT_MESSAGE
     5405    32454    4               THEN
     5406    32455    4                   SELECT_CURRENT = %YES#;
     5407    32456    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = 1;
     5408    32457    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = %MAX_MSGNO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:192  
     5409    32458    4               CURRENT_CONTEXT%.NUM_ENTRIES = 1;
     5410    32459    4               SELECT (%SEL_RANGE);
     5411    32460    4               PTR2$ = PTR1$ -> P$B.SUBLK$(0) -> P$S.TEXTC$;
     5412    32461    4               CALL X$DEC_CONVERT (PTR2$,VALUE1) ALTRET(E_CONVERT);
     5413    32462    4               IF VALUE1 > %MAX_MSGNO
     5414    32463    4               THEN
     5415    32464    4                   GOTO E_CONVERT;
     5416    32465    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX1) = VALUE1;
     5417    32466        /*
     5418    32467             ***** May be a range, not just a single number ..
     5419    32468        */
     5420    32469    4               IF PTR1$ -> P$B.NSUBLKS > 1
     5421    32470    4               THEN
     5422    32471    5               DO;
     5423    32472    5                   PTR2$ = PTR1$ -> P$B.SUBLK$(1) -> P$S.TEXTC$;
     5424    32473    5                   CALL X$DEC_CONVERT (PTR2$,VALUE2) ALTRET(E_CONVERT);
     5425    32474    5                   IF VALUE2 > %MAX_MSGNO
     5426    32475    6                   THEN DO;
     5427    32476    6                       PTR1$ = PTR1$ -> P$B.SUBLK$(1);
     5428    32477    6                       GOTO E_CONVERT;
     5429    32478    6                   END;
     5430    32479    5                   IF VALUE2 < VALUE1
     5431    32480    6                   THEN DO;
     5432    32481    6                       CALL XUR$ERRPTR (PTR1$->P$B.CPOS);
     5433    32482    6                       CALL XUR$ERRMSG (E_BADRANGE);
     5434    32483    6                       ALTRETURN;
     5435    32484    6                   END;
     5436    32485    5                   CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX1) = VALUE2;
     5437    32486    5               END;
     5438    32487    4               ELSE                 /* Set high = low */
     5439    32488    4                   CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX1) = VALUE1;
     5440    32489    4               CURRENT_CONTEXT%.NUM_ENTRIES = CURRENT_CONTEXT%.NUM_ENTRIES + 1;
     5441    32490    4               SELECT (%SEL_EXP);
     5442    32491        /*
     5443    32492             ***** Transplant the truth tree out of the parse tree area ...
     5444    32493        */
     5445    32494    4               IF (INDX1 = 0 AND BLK$ -> P$B.NSUBLKS = 1)
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:193  
             32494                        /* IE. 'MOVE TO NAME TO FOLDER' */
     5446    32495    4                 OR START_BLK = 1                 /* IE. 'MOVE SEL TO NAME TO FOLDER'*/
     5447    32496    5               THEN DO;
     5448    32497    5                   CURRENT_CONTEXT%.NUM_ENTRIES = SELECTED_CONTEXT%.NUM_ENTRIES;
     5449    32498    5                   CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = SELECTED_CONTEXT%.MESSAGE_SET.
             32498                            LOW(0);
     5450    32499    5                   CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = SELECTED_CONTEXT%.MESSAGE_SET
             32499                            .HIGH(0);
     5451    32500    5               END;
     5452    32501    4               X$MCB.FREE_HEAD$ = ADDR(NIL);
     5453    32502    4               X$MCB.TYPE = 0;       /* Bytes */
     5454    32503    4               X$MCB.SEGMENT_BASE$ = ADDR(CURRENT_CONTEXT%.MESSAGE_SET.LOW(
             32503                        CURRENT_CONTEXT%.NUM_ENTRIES+1));
     5455    32504    4               X$MCB.HI_SEGMENT$ = X$MCB.SEGMENT_BASE$;
     5456    32505    4               X$MCB.WKSZ = 511 - POFFW(X$MCB.HI_SEGMENT$,CONTEXT_PTR$(%CONTEXT_CURRENT
             32505                        ));
     5457    32506    4               CALL VMS$MOVE_SELECT (X$MCB,PTR1$,CURRENT_CONTEXT%.TRUTH_TREE$) ALTRET(
             32506                        NO_SPACE);
     5458    32507    4               SELECT (ELSE);
     5459    32508    4           END;                        /* Do case ... end */
     5460    32509    3       END;                            /* Do indx = ... end */
     5461    32510        /*
     5462    32511             ***** If no message set was specified, then assume
     5463    32512                   all messages in the folder ...
     5464    32513        */
     5465    32514    2       IF CURRENT_CONTEXT%.NUM_ENTRIES = 0
     5466    32515    2       THEN
     5467    32516    3       DO;
     5468    32517    3           CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = 1;
     5469    32518    3           CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = %MAX_MSGNO;
     5470    32519    3           CURRENT_CONTEXT%.NUM_ENTRIES = 1;
     5471    32520    3       END;
     5472    32521        /*
     5473    32522             ***** If this command modifies the selected context,
     5474    32523                   then copy the current context to the selected context ...
     5475    32524        */
     5476    32525    3       DO CASE (COMMAND);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:194  
     5477    32526    3       CASE (%CMD_SELECT_MESSAGE);
     5478    32527    3           WHICH_CONTEXT = %CONTEXT_SELECTED;
     5479    32528    3           SELECTED_CONTEXT%.MESSAGE_POINTER = CURRENT_CONTEXT%.MESSAGE_POINTER;
     5480    32529    3           SELECTED_CONTEXT%.NUM_ENTRIES = CURRENT_CONTEXT%.NUM_ENTRIES;
     5481    32530    4           DO INDX1 = 0 TO SELECTED_CONTEXT%.NUM_ENTRIES - 1;
     5482    32531    4               SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX1) =
     5483    32532    4                 CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX1);
     5484    32533    4               SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX1) =
     5485    32534    4                 CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX1);
     5486    32535    4           END;
     5487    32536    3           IF CURRENT_CONTEXT%.TRUTH_TREE$ ~= ADDR(NIL)
     5488    32537    3           THEN                       /* Transplant the tree again */
     5489    32538    4           DO;
     5490    32539    4               X$MCB.FREE_HEAD$ = ADDR(NIL);
     5491    32540    4               X$MCB.TYPE = 0;  /* Bytes */
     5492    32541    4               X$MCB.SEGMENT_BASE$ =
     5493    32542    4                 ADDR(SELECTED_CONTEXT%.MESSAGE_SET.LOW(SELECTED_CONTEXT%.NUM_ENTRIES+1
             32542                          ));
     5494    32543    4               X$MCB.HI_SEGMENT$ = X$MCB.SEGMENT_BASE$;
     5495    32544    4               X$MCB.WKSZ = 511 - POFFW(X$MCB.HI_SEGMENT$,CONTEXT_PTR$(%
             32544                        CONTEXT_SELECTED));
     5496    32545    4               CALL VMS$MOVE_SELECT (X$MCB,CURRENT_CONTEXT%.TRUTH_TREE$,
     5497    32546    4                 SELECTED_CONTEXT%.TRUTH_TREE$) ALTRET(NO_SPACE);
     5498    32547    4           END;                  /* Transplant the tree */
     5499    32548    3           ELSE                       /* Remove the tree */
     5500    32549    3               SELECTED_CONTEXT%.TRUTH_TREE$ = ADDR(NIL);
     5501    32550    3       CASE (ELSE);
     5502    32551    3           WHICH_CONTEXT = %CONTEXT_CURRENT;
     5503    32552    3       END;                             /* Do case ... end */
     5504    32553    2       RETURN;
     5505    32554        /**/
     5506    32555    2   E_CONVERT:
     5507    32556    2       CALL XUR$ERRPTR (PTR1$->P$B.CPOS);
     5508    32557    2       CALL XUR$ERRMSG (E_BIGNUM);
     5509    32558    2       ALTRETURN;
     5510    32559        /**/
     5511    32560    2   NO_SPACE:
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:195  
     5512    32561    2       CALL XUR$ERRMSG (E_MEMERR);
     5513    32562    2       ALTRETURN;
     5514    32563    2   END INIT$SELECT_OPTS;
     5515    32564        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:196  
     5516    32565        /*********************************************************************/
     5517    32566        /*F*    NAME:        GET$MESSAGE
     5518    32567                PURPOSE:     To get the next message to process.
     5519    32568                DESCRIPTION: This routine looks at the RANGE SPECIFICATION
     5520    32569                             and then gets the header for each message in
     5521    32570                             turn and then calls VMS$SELECT which determines
     5522    32571                             if the particular message matches the requesed
     5523    32572                             SELECTION EXPRESSION. This routine continues
     5524    32573                             until (1) a message matching all criteria is
     5525    32574                             found, (2) No messages are found.
     5526    32575        */
     5527    32576        /*********************************************************************/
     5528    32577    1   GET$MESSAGE: PROC ALTRET;
     5529    32578
     5530    32579    2   DCL INDX SBIN WORD STATIC;
     5531    32580    2   DCL VALUE SBIN WORD STATIC;
     5532    32581    2   DCL RESULT$ PTR STATIC;
     5533    32582    2   DCL STATUS_SAVE BIT(1);
     5534    32583
     5535    32584        /*
     5536    32585             ***** If there are no entries in the current context
     5537    32586                   then there are no messages selected. Go back ...
     5538    32587        */
     5539    32588    2       IF CURRENT_CONTEXT%.NUM_ENTRIES = 0
     5540    32589    2       THEN
     5541    32590    2           ALTRETURN;
     5542    32591        /*
     5543    32592             ***** If inverse order is specified
     5544    32593                   then go backwards thru the list ...
     5545    32594        */
     5546    32595    2       IF CURRENT_CONTEXT%.FLAGS.INVERSE
     5547    32596    2       THEN
     5548    32597    2           GOTO PROCESS_INVERSE;
     5549    32598    2       IF CURRENT_CONTEXT%.SET_INDX = -1
     5550    32599    2       THEN                            /* Set to first entry */
     5551    32600    2           GOTO BUMP_CONTEXT_INDX;
     5552    32601    3       DO WHILE (CURRENT_CONTEXT%.SET_INDX < CURRENT_CONTEXT%.NUM_ENTRIES);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:197  
     5553    32602    4           DO FOREVER;
     5554    32603    4               CURRENT_MESSAGE_NUMBER = CURRENT_MESSAGE_NUMBER + 1;
     5555    32604    4               IF CURRENT_MESSAGE_NUMBER <
     5556    32605    4                 CURRENT_CONTEXT%.MESSAGE_SET.LOW(CURRENT_CONTEXT%.SET_INDX)
     5557    32606    4                 OR CURRENT_MESSAGE_NUMBER >
     5558    32607    4                 CURRENT_CONTEXT%.MESSAGE_SET.HIGH(CURRENT_CONTEXT%.SET_INDX)
     5559    32608    4               THEN                 /* Outside the range. Get another */
     5560    32609    4                   GOTO BUMP_CONTEXT_INDX;
     5561    32610                            /* Looks like its in range.  Get it.  Then test to see if
     5562    32611                               we got one that is still in range. */
     5563    32612    4               IF SELECT_CURRENT THEN SELECTED_CONTEXT%.MESSAGE_POINTER =
             32612                        CURRENT_MESSAGE_NUMBER;
     5564    32613    4               CALL VMD$GET_HEADER_NEXT (CURRENT_MESSAGE_NUMBER,
     5565    32614    4                 M$MAIL_FILE_NUM)
     5566    32615    4               WHENALTRETURN
     5567    32616        /*
     5568    32617          **** Altreturn if there are no more messages to process.
     5569    32618        */
     5570    32619    5               DO;
     5571    32620    5                   IF CURRENT_CONTEXT%.SET_INDX + 1 < CURRENT_CONTEXT%.
     5572    32621    5                     NUM_ENTRIES THEN
     5573    32622    5                       GOTO BUMP_CONTEXT_INDX; /* Get next */
     5574    32623    5                   ELSE
     5575    32624    5                       GOTO NO_HEADER;
     5576    32625    5               END;
     5577    32626    4               IF VM_HEADER.UNIQUE_ID$ = ADDR(NIL)
     5578    32627    4                 AND VM_CURRENT_FOLDER.FLAGS.UPDATE
     5579    32628    5               THEN DO;
     5580    32629    5                   CALL ASSIGN_A_MESSAGE_ID
     5581    32630    6                   WHENRETURN DO;
     5582    32631    6                       CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER, M$MAIL_FILE_NUM);
     5583    32632    6                       CALL VMD$PUT_ID (VM_HEADER.UNIQUE_ID$ -> X$STRING,
     5584    32633    6                         M$MAIL_FILE_NUM, CURRENT_MESSAGE_NUMBER);
     5585    32634    6                   END;
     5586    32635    5               END;
     5587    32636    4               IF CURRENT_MESSAGE_NUMBER <
     5588    32637    4                 CURRENT_CONTEXT%.MESSAGE_SET.LOW(CURRENT_CONTEXT%.SET_INDX)
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:198  
     5589    32638    4                 OR CURRENT_MESSAGE_NUMBER >
     5590    32639    4                 CURRENT_CONTEXT%.MESSAGE_SET.HIGH(CURRENT_CONTEXT%.SET_INDX)
     5591    32640    4               THEN                 /* Outside the range. Get another */
     5592    32641    4                   GOTO BUMP_CONTEXT_INDX;
     5593    32642        /*
     5594    32643             ***** Check truth expression ...
     5595    32644        */
     5596    32645    4               IF CURRENT_CONTEXT%.TRUTH_TREE$ ~= ADDR(NIL)
     5597    32646    4               THEN
     5598    32647    5               DO;
     5599    32648    5                   CALL VMS$SELECT (CURRENT_CONTEXT%.TRUTH_TREE$,
     5600    32649    5                     VM_SELECT,RESULT$) ALTRET(E_EVAL);
     5601    32650    5                   CALL X$DEC_CONVERT (RESULT$,VALUE) ALTRET(E_DEC);
     5602    32651    5                   IF VALUE <= 0 THEN
     5603    32652    6                   DO;
     5604    32653        /*
     5605    32654          **** If the selection criterion includes exam and the message was just
     5606    32655          **** displayed, delete the record anyway.
     5607    32656        */
     5608    32657    6                       IF CURR_COMMAND_CODE = %CMD_DELETE_MESSAGE THEN
     5609    32658    7                       DO;
     5610    32659    7                           STATUS_SAVE = VM_HEADER.STATUS.EXAM;
     5611    32660    7                           VM_HEADER.STATUS.EXAM = ~VM_HEADER.STATUS.EXAM;
     5612    32661        /*
     5613    32662          **** Determine if it was the exam criterion that failed the test.
     5614    32663          **** If it was, then if it was just displayed, delete it.
     5615    32664        */
     5616    32665    7                           CALL VMS$SELECT (CURRENT_CONTEXT%.
     5617    32666    7                             TRUTH_TREE$,VM_SELECT,RESULT$)
     5618    32667    7                           WHENALTRETURN
     5619    32668    8                           DO;
     5620    32669    8                               VM_HEADER.STATUS.EXAM = STATUS_SAVE;
     5621    32670    8                               GOTO E_EVAL;
     5622    32671    8                           END;
     5623    32672    7                           VM_HEADER.STATUS.EXAM = STATUS_SAVE;
     5624    32673    7                           CALL X$DEC_CONVERT (RESULT$,
     5625    32674    7                             VALUE) ALTRET(E_DEC);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:199  
     5626    32675    7                           IF VALUE <= 0 THEN
     5627    32676    7                               GOTO GET_NEXT_CONTEXT;
     5628    32677    7                           IF NOT VM_HEADER.STATUS.MAKE_OLD THEN
     5629    32678    7                               GOTO GET_NEXT_CONTEXT;
     5630    32679    7                           EXIT; /* Candidate for deletion */
     5631    32680    7                       END;
     5632    32681    6                       ELSE
     5633    32682    6                           GOTO GET_NEXT_CONTEXT;
     5634    32683    6                   END;
     5635    32684    5               END;
     5636    32685        /*
     5637    32686             ***** Save the context MESSAGE_POINTER ...
     5638    32687        */
     5639    32688    4               CONTEXT_PTR$(WHICH_CONTEXT)->VM$CONTEXT.MESSAGE_POINTER =
     5640    32689    4                 CURRENT_MESSAGE_NUMBER;
     5641    32690        /*
     5642    32691             ***** If next was specified,
     5643    32692                   then only this message is desired.
     5644    32693                   Forget the rest of the messages ...
     5645    32694        */
     5646    32695    4               IF CURRENT_CONTEXT%.FLAGS.NEXT
     5647    32696    4               THEN
     5648    32697    5               DO;
     5649    32698    5                   GOTO MAKE_NEW_CONTEXT;
     5650    32699    5               END;
     5651    32700        /*
     5652    32701             ***** Message matches all criteria ...
     5653    32702        */
     5654    32703    4               GOTO RETURN_MESSAGE;
     5655    32704    4   GET_NEXT_CONTEXT:
     5656    32705    4           END;                       /* Do forever ... end */
     5657    32706        /*
     5658    32707             ***** Bump the context SET_INDX ...
     5659    32708        */
     5660    32709    3   BUMP_CONTEXT_INDX:
     5661    32710    3           CURRENT_CONTEXT%.SET_INDX = CURRENT_CONTEXT%.SET_INDX + 1;
     5662    32711        /*
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:200  
     5663    32712             ***** Set CURRENT_MESSAGE_NUMBER to point to the next
     5664    32713                   message to be selected. Since it will be incrimented
     5665    32714                   by one (due to normal entry conditions) it must be
     5666    32715                   decrimented by one here ...
     5667    32716        */
     5668    32717    3           CURRENT_MESSAGE_NUMBER =
     5669    32718    3             CURRENT_CONTEXT%.MESSAGE_SET.LOW(CURRENT_CONTEXT%.SET_INDX) - 1;
     5670    32719    3       END;                            /* Do while ... end */
     5671    32720        /*
     5672    32721             ***** Unable to find anything that matches ...
     5673    32722        */
     5674    32723    2       GOTO NO_HEADER;
     5675    32724        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:201  
     5676    32725    2   PROCESS_INVERSE:
     5677    32726    2       IF CURRENT_CONTEXT%.SET_INDX = -1
     5678    32727    2       THEN                            /* Set to first entry */
     5679    32728    3       DO;
     5680    32729    3           CURRENT_CONTEXT%.SET_INDX = CURRENT_CONTEXT%.NUM_ENTRIES;
     5681    32730    3           GOTO BUMP_CONTEXT_INVERSE;
     5682    32731    3       END;
     5683    32732    3       DO WHILE (CURRENT_CONTEXT%.SET_INDX >= 0);
     5684    32733    4           DO FOREVER;
     5685    32734    4               IF SELECT_CURRENT THEN SELECTED_CONTEXT%.MESSAGE_POINTER =
             32734                        CURRENT_MESSAGE_NUMBER;
     5686    32735    4               CALL VMD$GET_HEADER_PREV (CURRENT_MESSAGE_NUMBER,
     5687    32736    4                 M$MAIL_FILE_NUM)
     5688    32737    4               WHENALTRETURN
     5689    32738        /*
     5690    32739          **** Altreturn if there are no more messages to process.
     5691    32740        */
     5692    32741    5               DO;
     5693    32742    5                   IF CURRENT_CONTEXT%.SET_INDX - 1 >= 0 THEN
     5694    32743    5                       GOTO BUMP_CONTEXT_INVERSE;
     5695    32744    5                   ELSE
     5696    32745    5                       GOTO NO_HEADER;
     5697    32746    5               END;
     5698    32747    4               IF CURRENT_MESSAGE_NUMBER <
     5699    32748    4                 CURRENT_CONTEXT%.MESSAGE_SET.LOW(CURRENT_CONTEXT%.SET_INDX)
     5700    32749    4                 OR CURRENT_MESSAGE_NUMBER >
     5701    32750    4                 CURRENT_CONTEXT%.MESSAGE_SET.HIGH(CURRENT_CONTEXT%.SET_INDX)
     5702    32751    4               THEN                 /* Outside the range. Get another */
     5703    32752    4                   GOTO BUMP_CONTEXT_INVERSE;
     5704    32753        /*
     5705    32754             ***** Check truth expression ...
     5706    32755        */
     5707    32756    4               IF CURRENT_CONTEXT%.TRUTH_TREE$ ~= ADDR(NIL)
     5708    32757    4               THEN
     5709    32758    5               DO;
     5710    32759    5                   CALL VMS$SELECT (CURRENT_CONTEXT%.TRUTH_TREE$,
     5711    32760    5                     VM_SELECT,RESULT$) ALTRET(E_EVAL);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:202  
     5712    32761    5                   CALL X$DEC_CONVERT (RESULT$,VALUE) ALTRET(E_DEC);
     5713    32762    5                   IF VALUE <= 0
     5714    32763    5                   THEN
     5715    32764    5                       GOTO GET_PREV_CONTEXT;
     5716    32765    5               END;
     5717    32766        /*
     5718    32767             ***** Save the context MESSAGE_POINTER ...
     5719    32768        */
     5720    32769    4               CONTEXT_PTR$(WHICH_CONTEXT)->VM$CONTEXT.MESSAGE_POINTER =
     5721    32770    4                 CURRENT_MESSAGE_NUMBER;
     5722    32771        /*
     5723    32772             ***** If previous was specified,
     5724    32773                   then only this message is desired.
     5725    32774                   Forget the rest of the messages ...
     5726    32775        */
     5727    32776    4               IF CURRENT_CONTEXT%.FLAGS.PREV
     5728    32777    4               THEN
     5729    32778    5               DO;
     5730    32779    5                   GOTO MAKE_NEW_CONTEXT;
     5731    32780    5               END;
     5732    32781        /*
     5733    32782             ***** Message matches all criteria ...
     5734    32783        */
     5735    32784    4               GOTO RETURN_MESSAGE;
     5736    32785    4   GET_PREV_CONTEXT:
     5737    32786    4           END;                       /* Do forever ... end */
     5738    32787        /*
     5739    32788             ***** Bump the context SET_INDX ...
     5740    32789        */
     5741    32790    3   BUMP_CONTEXT_INVERSE:
     5742    32791    3           CURRENT_CONTEXT%.SET_INDX = CURRENT_CONTEXT%.SET_INDX - 1;
     5743    32792        /*
     5744    32793             ***** Set CURRENT_MESSAGE_NUMBER to point to the next
     5745    32794                   message to be selected. ...
     5746    32795        */
     5747    32796    3           CURRENT_MESSAGE_NUMBER =
     5748    32797    3             CURRENT_CONTEXT%.MESSAGE_SET.HIGH(CURRENT_CONTEXT%.SET_INDX);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:203  
     5749    32798    3       END;                            /* Do while ... end */
     5750    32799        /*
     5751    32800             ***** Unable to find anything that matches ...
     5752    32801        */
     5753    32802    2   NO_HEADER:
     5754    32803    2       ALTRETURN;
     5755    32804        /**/
     5756    32805    2   E_EVAL:
     5757    32806    2       CALL XUR$ERRPTR (VM_SELECT.ERR_POS#);
     5758    32807    2       CALL XUR$ERRMSG (VM_SELECT.ERROR);
     5759    32808    2       ALTRETURN;
     5760    32809        /**/
     5761    32810    2   E_DEC:
     5762    32811                                                /* Add call with E_NONDECIMAL */
     5763    32812    2       ALTRETURN;
     5764    32813        /*
     5765    32814             ***** Change the current context to contain only
     5766    32815                   the current message. Only for next and previous ...
     5767    32816        */
     5768    32817    2   MAKE_NEW_CONTEXT:
     5769    32818    2       CURRENT_CONTEXT%.NUM_ENTRIES = 1;
     5770    32819    2       CURRENT_CONTEXT%.SET_INDX = 2;     /* Signal that all have been found */
     5771    32820    2       CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = CURRENT_MESSAGE_NUMBER;
     5772    32821    2       CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = CURRENT_MESSAGE_NUMBER;
     5773    32822    2       CURRENT_CONTEXT%.FLAGS = %NO#;
     5774    32823    2   RETURN_MESSAGE:
     5775    32824    2       IF SELECT_CURRENT THEN SELECTED_CONTEXT%.MESSAGE_POINTER =
             32824                CURRENT_MESSAGE_NUMBER;
     5776    32825    2       VM_HEADRES.RES# = CURRENT_MESSAGE_NUMBER;
     5777    32826    2       CALL M$ENQ (ENQ_HEAD)
     5778    32827    3       WHENALTRETURN DO;
     5779    32828    3           IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$TIMELIMIT
     5780    32829    4           THEN DO;
     5781    32830    4               CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);
     5782    32831    4               CALL XUR$ERRMSG (E_INPROG);
     5783    32832    4               ALTRETURN;
     5784    32833    4           END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:204  
     5785    32834    3       END;
     5786    32835    3       CALL M$DEQ (DEQ_HEAD) WHENALTRETURN DO;
     5787    32836    3       END;
     5788    32837    2       NUM_MESSAGES_PROCESSED = NUM_MESSAGES_PROCESSED + 1;;
     5789    32838    2       RETURN;
     5790    32839    2   END GET$MESSAGE;
     5791    32840        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:205  
     5792    32841    1   ASSIGN_A_MESSAGE_ID: PROC ALTRET;
     5793    32842
     5794    32843        /*
     5795    32844             ***** Construct a unique-ID string for this message, and put it
     5796    32845                   in the header.  The strings take the form:
     5797    32846
     5798    32847                 <yymmdd.hhmmssss@CP6>
     5799    32848
     5800    32849                   This code is executed when MAIL first processes any message
     5801    32850                   that does not already have a unique ID;  such messages may include
     5802    32851                   MAILMAN-generated packets such as ERRs and DELIVs, as well as
     5803    32852                   messages that originate in pre-B00 mail environments.
     5804    32853        */
     5805    32854
     5806    32855        %XUM$MCB (NAME=HEADER_MCB, STCLASS=AUTO);
     5807    32859
     5808    32860    2       WORK_UTS = VM_HEADER.CREATION_DATE;
     5809    32861    2       CALL M$TIME (GET_ANSI_TIME);
     5810    32862    2       CALL CONCAT (ID, '<', ANSI_DATE, '.', ANSI_TIME, '@CP6>');
     5811    32863    2       CALL INDEX (COUNT, ' ', ID);
     5812    32864    2       HEADER_MCB.SIZE = COUNT + 1;
     5813    32865    2       HEADER_MCB.TYPE = 0;
     5814    32866    2       HEADER_MCB.MIN_SIZE = 3;
     5815    32867    2       HEADER_MCB.SEGMENT_BASE$ = VM_HEADER$;
     5816    32868    2       HEADER_MCB.HI_SEGMENT$ = VM_HEADER.NEXT$;
     5817    32869    2       HEADER_MCB.FREE_HEAD$ = VM_HEADER.FREE$;
     5818    32870    2       HEADER_MCB.WKSZ = VM_HEADER.HEADER_SIZE;
     5819    32871    2       CALL X$ALLOCATE (HEADER_MCB) ALTRET (E_ALLOCATE);
     5820    32872    2       VM_HEADER.NEXT$ = PINCRW(HEADER_MCB.HI_SEGMENT$,1);
     5821    32873    2       VM_HEADER.UNIQUE_ID$ = HEADER_MCB.ADDRESS$;
     5822    32874    2       VM_HEADER.UNIQUE_ID$ -> X$STRING.SIZ = COUNT;
     5823    32875    2       VM_HEADER.UNIQUE_ID$ -> X$STRING.TEXT = ID;
     5824    32876
     5825    32877    2       RETURN;
     5826    32878
     5827    32879    2   E_ALLOCATE:
     5828    32880    2       ALTRETURN;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:206  
     5829    32881
     5830    32882    2   END ASSIGN_A_MESSAGE_ID;
     5831    32883        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:207  
     5832    32884        /*****************************************************************/
     5833    32885        /*F*      NAME: PUT_PROFILE
     5834    32886                  PURPOSE: Write the profile record to a folder
     5835    32887                  DESCRIPTION: Merges the new profile info from mail with
     5836    32888                               the new message counts from mailman.  Test
     5837    32889                               for new messages and notifies user if found.
     5838    32890
     5839    32891        */
     5840    32892        /*****************************************************************/
     5841    32893    1   PUT_PROFILE: PROC(DCB#) ALTRET;
     5842    32894    2   DCL DCB# UBIN;
     5843    32895    2   DCL CHECK BIT(1);
     5844    32896        %FPT_READ (FPTN=READ_PROFILE,KEY=VM_PROKEY,KEYS=YES,STCLASS=STATIC);
     5845    32935        %VM_PROFILE (NAME=VM_PROSTUB,STCLASS=AUTO); /* Big enuff for fixed fields */
     5846    33022        %VM_PROKEY (STCLASS=CONSTANT);
     5847    33037    2       CHECK = '0'B;
     5848    33038    2       if VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B then return;
     5849    33039    2       GOTO COMMON;
     5850    33040        /*F*      NAME: CHECK_NEW
     5851    33041                  PURPOSE: checks to see if new mail has been stuffed.
     5852    33042                  DESCRIPTION: reads the fixed portion of the profile record
     5853    33043                               and tests the new message counts from mailman.
     5854    33044
     5855    33045        */
     5856    33046    2   CHECK_NEW: ENTRY(DCB#) ALTRET;
     5857    33047    2       CHECK='1'B;
     5858    33048    2   COMMON:
     5859    33049    2       READ_PROFILE.V.DCB# = DCB#;
     5860    33050    2       READ_PROFILE.BUF_ = VECTOR(VM_PROSTUB);
     5861    33051    3       IF ~ CHECK THEN DO;
     5862    33052    3           ENQ_PROFILE.V.DCB# = DCB#;
     5863    33053    3           CALL M$ENQ (ENQ_PROFILE) ALTRET(ALT);
     5864    33054    3       END;
     5865    33055    2       CALL M$READ (READ_PROFILE)        /* Get fixed fields */
     5866    33056    3       WHENALTRETURN DO;
     5867    33057    3           IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$LD THEN GOTO ALT1;
     5868    33058    3       END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:208  
     5869    33059    2       IF VM_PROFILE.HI_MESSAGE_NUMBER < VM_PROSTUB.HI_MESSAGE_NUMBER
     5870    33060    2       THEN
     5871    33061    2           NEW_FLAG = %YES#;
     5872    33062    2       ELSE
     5873    33063    2           NEW_FLAG = %NO#;
     5874    33064    2       VM_PROFILE.NUM_MESSAGES = VM_PROSTUB.NUM_MESSAGES;
     5875    33065    2       VM_PROFILE.NUM_NEW_MESSAGES = VM_PROSTUB.NUM_NEW_MESSAGES;
     5876    33066    2       IF MADE_OLD
     5877    33067    3       THEN DO;
     5878    33068    3           VM_PROFILE.NUM_NEW_MESSAGES = VM_PROFILE.NUM_NEW_MESSAGES - 1;
     5879    33069    3           MADE_OLD = %NO#;
     5880    33070    3       END;
     5881    33071    2       VM_PROFILE.HI_MESSAGE_NUMBER = VM_PROSTUB.HI_MESSAGE_NUMBER;
     5882    33072    3       IF ~ CHECK THEN DO;
     5883    33073    3           CALL VMD$PUT_PROFILE(DCB#) ALTRET(ALT1);
     5884    33074    3           DEQ_PROFILE.V.DCB# = DCB#;
     5885    33075    4           CALL M$DEQ (DEQ_PROFILE) WHENALTRETURN DO;
     5886    33076    4           END;
     5887    33077    3       END;
     5888    33078    2       RETURN;
     5889    33079    2   ALT1:
     5890    33080    2       DEQ_PROFILE.V.DCB# = DCB#;
     5891    33081    3       CALL M$DEQ (DEQ_PROFILE) WHENALTRETURN DO;
     5892    33082    3       END;
     5893    33083    2   ALT: ALTRETURN;
     5894    33084    2   END PUT_PROFILE;
     5895    33085        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:209  
     5896    33086        /********************************************************************/
     5897    33087        /*I* NAME: UPDATE$MAIL
     5898    33088             DESCRIPTION: Deletes all messages that have been marked as
     5899    33089                          DELETEd. It will RENUMBER the messages as necessary.
     5900    33090                          It will also reclaim unused granules as required.
     5901    33091        *********************************************************************/
     5902    33092    1   UPDATE$MAIL: PROC (RENUMBER#,HEADER_FIELD#);
     5903    33093        /*
     5904    33094             ***** EQUs for RENUMBER options ...
     5905    33095
     5906    33096        %EQU REN_OPT_DATE = 1;
     5907    33097        %EQU REN_OPT_FROM = 2;
     5908    33098        %EQU REN_OPT_REF  = 3;
     5909    33099        %EQU REN_OPT_SUBJ = 4;
     5910    33100        %EQU REN_OPT_TO   = 5;  */
     5911    33101    2   DCL INDX UBIN WORD STATIC;
     5912    33102    2   DCL NEXT_NUM UBIN WORD STATIC;
     5913    33103    2   DCL RECS_DELETED UBIN WORD STATIC;
     5914    33104    2   DCL RENUMBER# BIT(1);
     5915    33105    2   DCL HEADER_FIELD# UBIN HALF HALIGNED;
     5916    33106        %FPT_OPEN (FPTN=RENUM_OPEN,
     5917    33107                  ASN=FILE,
     5918    33108                  ORG=KEYED,
     5919    33109                  SHARE=NONE,
     5920    33110                  FUN=UPDATE,
     5921    33111                  STCLASS=STATIC);
     5922    33220        %FPT_READ (FPTN=READ_OLD, STCLASS=STATIC,
     5923    33221                  DCB=M$MAIL_FILE,
     5924    33222                  KEY=VLP_KEY,
     5925    33223                  KEYS=NO,
     5926    33224                  KEYR=YES);
     5927    33263        %FPT_WRITE (FPTN=WRITE_NEW, STCLASS=STATIC,
     5928    33264                  DCB=M$WORK,
     5929    33265                  KEY=VLP_KEY);
     5930    33296    2   DCL 1 VLP_KEY STATIC,
     5931    33297    2         2 COUNT UBIN(9) CALIGNED,
     5932    33298    2         2 TYPE UBIN(9) CALIGNED,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:210  
     5933    33299    2         2 NUM UBIN WORD CALIGNED,
     5934    33300    2         2 * CHAR(249);
     5935    33301    2   DCL FPARAM_AREA CHAR(1024) AUTO DALIGNED;
     5936    33302        %VLP_NAME (FPTN=FID_NAME);
     5937    33329
     5938    33330    2       IF VM_CURRENT_FOLDER.FLAGS.UPDATE = %NO#
     5939    33331    2       THEN
     5940    33332    2           RETURN;
     5941    33333    2       CALL XUR$DISABLE;
     5942    33334    2       CALL PUT_PROFILE (M$MAIL_FILE_NUM);
     5943    33335    2       CALL M$ENQ(ENQ_PROFILE);
     5944    33336    2       RECS_DELETED=0;
     5945    33337    2       IF VM_PROFILE.HIGH_RECS < VM_CURRENT_FOLDER.NRECS THEN VM_PROFILE.HIGH_RECS =
             33337                VM_CURRENT_FOLDER.NRECS;
     5946    33338        /*N* Currently, all of this happens while enqueued. In the future, try
     5947    33339         to make in smarter */
     5948    33340        /*
     5949    33341             ***** If there are any messages that were new and
     5950    33342                   were marked old, or any messages were deleted,
     5951    33343                   then fix them up now ...
     5952    33344        */
     5953    33345    2       IF VM_PROFILE.NUM_DEL_MESSAGES = 0
     5954    33346    2         AND VM_PROFILE.NUM_MOLD_MESSAGES = 0
     5955    33347    2       THEN                            /* No messages to delete */
     5956    33348    2           GOTO NO_MORE;
     5957    33349        /*
     5958    33350             ***** Delete the messages marked for deletion ...
     5959    33351        */
     5960    33352    2       INDX = 0;                         /* Position before first message */
     5961    33353    2       VM_PROFILE.NUM_MESSAGES = 0;
     5962    33354    2       VM_PROFILE.NUM_NEW_MESSAGES = 0;
     5963    33355    3       DO FOREVER;
     5964    33356    3           CALL VMD$GET_HEADER_NEXT (INDX,M$MAIL_FILE_NUM) ALTRET(NO_MORE);
     5965    33357    3           VM_PROFILE.NUM_MESSAGES = VM_PROFILE.NUM_MESSAGES + 1;
     5966    33358    3           IF VM_HEADER.STATUS.DEL
     5967    33359    3           THEN
     5968    33360    4           DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:211  
     5969    33361    4               CALL VMM$DELETE_MESSAGE (INDX,
     5970    33362    4                 M$MAIL_FILE_NUM) ALTRET(E_DELETE);
     5971    33363    4               VM_PROFILE.NUM_MESSAGES = VM_PROFILE.NUM_MESSAGES - 1;
     5972    33364    4               RECS_DELETED = RECS_DELETED + VM_HEADER.NUM_RECORDS;
     5973    33365    5               DO NEVER;
     5974    33366    5   E_DELETE:
     5975    33367                                                /* Bitch!!! */
     5976    33368    5               END;
     5977    33369    4           END;
     5978    33370    3           ELSE IF VM_HEADER.STATUS.MAKE_OLD
     5979    33371    3               THEN
     5980    33372    4               DO;
     5981    33373    4                   VM_HEADER.STATUS.OLD = %YES#;
     5982    33374    4                   VM_HEADER.STATUS.MAKE_OLD = %NO#;
     5983    33375    4                   CALL VMD$PUT_HEADER (INDX,
     5984    33376    4                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     5985    33377    4               END;
     5986    33378    3               ELSE IF NOT VM_HEADER.STATUS.OLD
     5987    33379    3                   THEN
     5988    33380    3                       VM_PROFILE.NUM_NEW_MESSAGES = VM_PROFILE.NUM_NEW_MESSAGES + 1;
     5989    33381    3           INDX = INDX + 1;
     5990    33382    3       END;                            /* Do forever ... end */
     5991    33383    2   NO_MORE:
     5992    33384    2       VM_PROFILE.NUM_DEL_MESSAGES = 0;
     5993    33385    2       VM_PROFILE.NUM_LOST = 0;
     5994    33386    2       VM_PROFILE.NUM_MOLD_MESSAGES = 0;
     5995    33387    2       VM_PROFILE.RECS_DELETED = VM_PROFILE.RECS_DELETED+RECS_DELETED;
     5996    33388        /*
     5997    33389             ***** Renumber ???
     5998    33390             ***** Don't renumber if there is nothing to delete or deletion is
     5999    33391             ***** for last message.
     6000    33392        */
     6001    33393    2       IF RENUMBER#
     6002    33394    2       THEN
     6003    33395    3       DO;
     6004    33396        /* We can't renumber the file if mailman is stuffing a message.
     6005    33397           The best way to tell if he is is by enqing the header of the high
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:212  
     6006    33398           message.  If we got it, he isn't.  He won't start one because we've
     6007    33399           already got the profile enqueued.
     6008    33400        */
     6009    33401    3           VM_HEADRES.RES# = VM_PROFILE.HI_MESSAGE_NUMBER;
     6010    33402    3           CALL M$ENQ (ENQ_HEAD)
     6011    33403    4           WHENALTRETURN DO;
     6012    33404    4               CALL XUR$ERRMSG (E_CANTREN);
     6013    33405    4               GOTO END_UPDATE;
     6014    33406    4           END;
     6015    33407    3           IF VM_PROFILE.NUM_MESSAGES = 0
     6016    33408    3           THEN
     6017    33409    4           DO;
     6018    33410    4               VM_PROFILE.HI_MESSAGE_NUMBER = 0;
     6019    33411    4               GOTO RELEASE_GRANULES;
     6020    33412    4           END;
     6021    33413    3           IF ADDR(HEADER_FIELD#) = ADDR(NIL) THEN
     6022    33414    4           DO;                   /* Plain vanilla renumber  */
     6023    33415    4               IF VM_PROFILE.LOW_DEL_NUM <= 9 * VM_PROFILE.HI_MESSAGE_NUMBER/10
     6024    33416    4                 OR (VM_PROFILE.HIGH_RECS < VM_PROFILE.RECS_DELETED * 10)
     6025    33417    5               THEN DO;
     6026    33418                                 /* If the first deleted message is less then 75% of
     6027    33419                                    the way thru the file, or more than 90% of the
     6028    33420                                    the data records deleted, then a complete copy will
     6029    33421                                    be faster.  Actually, what we'd like to know is
     6030    33422                                    the record position and not the message number,
     6031    33423                               but so it goes.  Also, if the copy will be done anyway
     6032    33424                               then just do the copy and don't juggle messages.
     6033    33425
     6034    33426                               */
     6035    33427    5                   CALL COPY_FOLDER;
     6036    33428    5               END;
     6037    33429    5               ELSE DO;
     6038    33430                            /* This method is very slow.  It will be the best method
     6039    33431                               for large folders where only the last message received
     6040    33432                               is deleted. */
     6041    33433    5                   NEXT_NUM = 0;
     6042    33434    5                   INDX = 0;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:213  
     6043    33435    6                   DO WHILE (INDX <= VM_PROFILE.HI_MESSAGE_NUMBER);
     6044    33436    6                       CALL VMD$GET_HEADER_NEXT (INDX,M$MAIL_FILE_NUM) ALTRET(
             33436                                END_RENUMBER);
     6045    33437    6                       NEXT_NUM = NEXT_NUM + 1; /* Next avail. msg. number */
     6046    33438    6                       IF INDX ~= NEXT_NUM
     6047    33439    6                       THEN
     6048    33440    7                       DO;
     6049    33441    7                           CALL VMM$COPY_MESSAGE (INDX,NEXT_NUM,
     6050    33442    7                             M$MAIL_FILE_NUM,M$MAIL_FILE_NUM) ALTRET(E_PMME);
     6051    33443    7                           CALL VMM$DELETE_MESSAGE (INDX,M$MAIL_FILE_NUM) ALTRET(E_PMME
             33443                                    );
     6052    33444    7                       END;
     6053    33445    6                       ELSE /* Incriment ptr to next message */
     6054    33446    6                           INDX = INDX + 1;
     6055    33447    6                   END;    /* Do while ... end */
     6056    33448    5               END;          /* Else do */
     6057    33449    4           END;                  /* Plain vanilla */
     6058    33450    3           ELSE
     6059    33451    3               CALL SORT_FOLDER;  /* renumber by something else */
     6060    33452    3   END_RENUMBER: ;                        /* Do something????? */
     6061    33453    3           VM_PROFILE.HI_MESSAGE_NUMBER = NEXT_NUM;
     6062    33454    3           VM_PROFILE.NUM_MESSAGES = NEXT_NUM;
     6063    33455    3           VM_PROFILE.LOW_DEL_NUM = %MAX_MSGNO;
     6064    33456    3       END;                       /* If renum */
     6065    33457    3       ELSE DO;
     6066    33458        /*   ***** Catch users who deleted but hit ctl-y, or old folders that
     6067    33459             ***** got built before this code was added. Execute if more than 20%
     6068    33460             ***** of data records were deleted and folder exceeded 3 granules.
     6069    33461        */
     6070    33462    3   RELEASE_GRANULES:
     6071    33463    3           IF ((VM_PROFILE.HIGH_RECS <
     6072    33464    3             VM_PROFILE.RECS_DELETED * 5) OR VM_PROFILE.LOW_DEL_NUM=0)
     6073    33465    3             AND VM_CURRENT_FOLDER.UGRANS > 3
     6074    33466    3           THEN
     6075    33467    4           DO;
     6076    33468    4               CALL COPY_FOLDER;
     6077    33469    4               VM_PROFILE.LOW_DEL_NUM = %MAX_MSGNO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:214  
     6078    33470    4           END;
     6079    33471    3       END;
     6080    33472    2   END_UPDATE:
     6081    33473    2       CALL VMD$PUT_PROFILE(M$MAIL_FILE_NUM)
     6082    33474    3       WHENALTRETURN DO;          /* At least we'll know an error occurred */
     6083    33475    3           ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     6084    33476    3           DCB# = B$TCB.ALT$ -> B$ALT.DCB#;
     6085    33477    3           CALL XUR$ERRMSG (ERROR,DCB#);
     6086    33478    3       END;
     6087    33479    3       CALL M$DEQ(DEQ_PROFILE) WHENALTRETURN DO;
     6088    33480    3       END;
     6089    33481    3       CALL M$DEQ(DEQ_HEAD) WHENALTRETURN DO;
     6090    33482    3       END;
     6091    33483    2       CALL XUR$ENABLE;
     6092    33484    2       RETURN;
     6093    33485        /**/
     6094    33486    2   E_PMME:
     6095    33487    3       CALL M$DEQ(DEQ_PROFILE) WHENALTRETURN DO;
     6096    33488    3       END;
     6097    33489    2       CALL XUR$ENABLE;
     6098    33490    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     6099    33491    2       DCB# = B$TCB.ALT$ -> B$ALT.DCB#;
     6100    33492    2       CALL XUR$ERRMSG (ERROR,DCB#);
     6101    33493    2       RETURN;
     6102    33494        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:215  
     6103    33495    2   COPY_FOLDER: PROC;
     6104    33496        /*I*   NAME: COPY_FOLDER
     6105    33497               DESCRIPTION:
     6106    33498                       The following code goes thru the file, storing the
     6107    33499                       old message into an array indexed by the new message
     6108    33500                       number.  Once all the headers have been processed, the
     6109    33501                       other records are access. This time, the new message
     6110    33502                       number is determined by comparing the old message
     6111    33503                       message number with the contents of the array.  The records
     6112    33504                       are read into the HEADER_ area, the WORK_ area is used
     6113    33505                       for the array.
     6114    33506                       */
     6115    33507    3   DCL OLD_TYPE UBIN;
     6116    33508    3   DCL CUR_NUM UBIN;
     6117    33509    3   DCL HINDX UBIN;
     6118    33510    3   DCL WRITEIT BIT(1);
     6119    33511    3   DCL HOLE$ PTR STATIC;
     6120    33512    3   DCL MAIL_FILE$ PTR;
     6121    33513    3   DCL HMAX UBIN STATIC;
     6122    33514    3   DCL NEW_NUM UBIN STATIC;
     6123    33515    3   DCL                                        HOLE(0:1024) UBIN BASED(HOLE$);
     6124    33516    3       HOLE$ = VBASE(VM_WORK_);
     6125    33517    3       CALL XUR$ERRMSG (E_COMPACT,,M$ME_NUM);
     6126    33518    3       HMAX=VBOUND(VM_WORK_)/4;
     6127    33519    3       MAIL_FILE$ = DCBADDR(M$MAIL_FILE_NUM);
     6128    33520                                 /* Close the current folder, reopen it share=none */
     6129    33521    3       CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;
     6130    33522    3       VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B;
     6131    33523    3       CALL M$CLOSE (CLOSE_SAVE);
     6132    33524    3       RENUM_OPEN.NAME_ = VECTOR(FID_NAME);
     6133    33525    3       CALL CONCAT(FID_NAME.NAME#,':MAIL_',VM_CURRENT_FOLDER.FOLDER);
     6134    33526    3       CALL INDEX (INDX,' ',FID_NAME.NAME#);
     6135    33527    3       FID_NAME.L# = INDX;
     6136    33528    3       RENUM_OPEN.ACCT_ = VECTOR(VM_CURRENT_FOLDER.ACCT);
     6137    33529    3       RENUM_OPEN.PASS_ = VECTOR(VM_CURRENT_FOLDER.PASS);
     6138    33530    3       RENUM_OPEN.V.ACS#=%DIRECT#;
     6139    33531    3       RENUM_OPEN.FPARAM_ = VECTOR(FPARAM_AREA);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:216  
     6140    33532    3       RENUM_OPEN.V.DCB# = M$MAIL_FILE_NUM;
     6141    33533    3       RENUM_OPEN.V.FUN# = %IN#;
     6142    33534    3       RENUM_OPEN.IFPARAM_ = VECTOR(NIL);
     6143    33535    3       CALL M$OPEN (RENUM_OPEN) ALTRET(E_PMME2);
     6144    33536    3       RENUM_OPEN.V.DCB# = M$WORK_NUM;
     6145    33537    3       RENUM_OPEN.FPARAM_ = VECTOR(NIL);
     6146    33538    3       RENUM_OPEN.IFPARAM_ = VECTOR(FPARAM_AREA);
     6147    33539    3       RENUM_OPEN.V.FUN#=%CREATE#;
     6148    33540    3       RENUM_OPEN.V.EXIST# = %NEWFILE#;
     6149    33541    3       RENUM_OPEN.V.ORG# = %KEYED#;
     6150    33542    3       CALL M$OPEN (RENUM_OPEN) ALTRET(E_PMME);
     6151    33543    3       READ_OLD.BUF_ = VM_HEADER_;
     6152    33544    3       OLD_TYPE=0;
     6153    33545    3       IF RENUMBER# THEN NEXT_NUM = 0;
     6154    33546    3       ELSE NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;
     6155    33547    4   READ_LOOP: DO WHILE('1'B);
     6156    33548    5   READ_AGAIN: CALL M$READ (READ_OLD) WHENALTRETURN DO;
     6157    33549    5               IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$EOF THEN EXIT READ_LOOP;
     6158    33550    5               ELSE IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD
     6159    33551    6                   THEN DO;
     6160    33552    6                       CALL VMA$ENLARGE_SEGMENT (VM_HEADER_, 1024) ALTRET(E_PMME);
     6161    33553    6                       READ_OLD.BUF_ = VM_HEADER_;
     6162    33554    6                       CALL M$PRECORD (FPT_PRECORD) ALTRET(E_PMME); /* Can't
     6163    33555                                                use cont, folder may be compressed */
     6164    33556    6                       GOTO READ_AGAIN;
     6165    33557    6                   END;
     6166    33558    5                   ELSE GOTO E_PMME;
     6167    33559    5           END;
     6168    33560    4           IF VLP_KEY.TYPE ~= OLD_TYPE
     6169    33561    5           THEN DO;
     6170    33562    5               OLD_TYPE = VLP_KEY.TYPE;
     6171    33563    5               CUR_NUM = 1;
     6172    33564    5               HINDX = 0;
     6173    33565    5           END;
     6174    33566    4           WRITEIT = '1'B;
     6175    33567    4           IF RENUMBER#
     6176    33568    5           THEN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:217  
     6177    33569    6               DO CASE(VLP_KEY.TYPE);
     6178    33570    6               CASE(%VM_TYPE_PRO,%VM_TYPE_LIST,%VM_TYPE_USER);
     6179    33571                                                /* Write it by default */
     6180    33572    6               CASE(%VM_TYPE_HEAD);
     6181    33573    6                   NEXT_NUM = NEXT_NUM+1;
     6182    33574    6                   HOLE(CUR_NUM) = VLP_KEY.NUM;
     6183    33575    6                   VLP_KEY.NUM = CUR_NUM;
     6184    33576    6                   CUR_NUM = CUR_NUM+1;
     6185    33577    7                   IF CUR_NUM > HMAX THEN DO;
     6186    33578    7                       CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024) ALTRET(E_PMME);
     6187    33579    7                       HMAX = VBOUND(VM_WORK_)/4;
     6188    33580    7                   END;
     6189    33581                                                /* Write it by default */
     6190    33582    6               CASE(%VM_TYPE_ID);
     6191    33583    6                   WRITEIT = '0'B;
     6192    33584    6                   NEW_NUM = 0;
     6193    33585    7                   DO WHILE (NEW_NUM < NEXT_NUM AND NOT WRITEIT);
     6194    33586    7                       NEW_NUM = NEW_NUM + 1;
     6195    33587    7                       IF VM_ID.MESSAGE_NUMBER = HOLE(NEW_NUM)
     6196    33588    8                       THEN DO;
     6197    33589    8                           VM_ID.MESSAGE_NUMBER = NEW_NUM;
     6198    33590    8                           WRITEIT = '1'B;
     6199    33591    8                       END;
     6200    33592    7                   END;
     6201    33593    6               CASE(ELSE);
     6202    33594    6                   IF CUR_NUM > NEXT_NUM THEN WRITEIT='0'B;
     6203    33595    6                   ELSE IF VLP_KEY.NUM = HOLE(CUR_NUM)
     6204    33596    6                       THEN VLP_KEY.NUM = CUR_NUM;
     6205    33597    6                       ELSE IF VLP_KEY.NUM < HOLE(CUR_NUM)
     6206    33598    6                           THEN WRITEIT='0'B;
     6207    33599    6                           ELSE
     6208    33600    7   SR_LOOP:                DO WHILE (VLP_KEY.NUM > HOLE(CUR_NUM));
     6209    33601    7                               CUR_NUM = CUR_NUM+1;
     6210    33602    7                               IF CUR_NUM > NEXT_NUM
     6211    33603    8                               THEN DO;
     6212    33604    8                                   WRITEIT='0'B;
     6213    33605    8                                   EXIT SR_LOOP;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:218  
     6214    33606    8                               END;
     6215    33607    7                               ELSE IF VLP_KEY.NUM = HOLE(CUR_NUM)
     6216    33608    7                                   THEN VLP_KEY.NUM = CUR_NUM;
     6217    33609    7                                   ELSE IF VLP_KEY.NUM < HOLE(CUR_NUM)
     6218    33610    7                                       THEN WRITEIT='0'B;
     6219    33611    7                           END; /* Do while */
     6220    33612    6               END;             /* Do case */
     6221    33613    5           END;                  /* If renum */
     6222    33614    5           IF WRITEIT THEN DO;
     6223    33615    5               WRITE_NEW.BUF_ = VM_HEADER_;
     6224    33616    5               IF MAIL_FILE$->F$DCB.ARS# = 0 THEN WRITE_NEW.BUF_ = VECTOR(NIL);
     6225    33617    5               ELSE WRITE_NEW.BUF_.BOUND = MAIL_FILE$->F$DCB.ARS#-1;
     6226    33618    5               WRITE_NEW.V.DVBYTE=MAIL_FILE$->F$DCB.DVBYTE;
     6227    33619    5               CALL M$WRITE(WRITE_NEW) ALTRET(E_PMME);
     6228    33620    5           END;
     6229    33621    4       END;                            /* Read loop */
     6230    33622    3       VM_PROFILE.RECS_DELETED=0;
     6231    33623    3       VM_PROFILE.HIGH_RECS = NEXT_NUM;
     6232    33624    3       CALL VMD$PUT_PROFILE(M$WORK_NUM) ALTRET(E_PMME);
     6233    33625    3       CLOSE_SAVE.V.DCB#=M$MAIL_FILE_NUM;
     6234    33626    3       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     6235    33627    3       CLOSE_SAVE.V.DCB#=M$WORK_NUM;
     6236    33628    3       CLOSE_SAVE.V.OPER.RELG# = '1'B;
     6237    33629    3       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     6238    33630    3       CLOSE_SAVE.V.OPER.RELG# = '0'B;
     6239    33631    3   CLEANUP:
     6240    33632    3       CALL VMB$USE_SAME (,,VM_CURRENT_FOLDER,M$MAIL_FILE_NUM);
     6241    33633    3       RETURN;
     6242    33634    3   E_PMME:
     6243    33635    3       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     6244    33636    3       DCB# = B$TCB.ALT$->B$ALT.DCB#;
     6245    33637    3       CALL XUR$ERRMSG (E_RENFAILED);
     6246    33638    3       CALL XUR$ERRMSG (ERROR,DCB#);
     6247    33639    3       CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;
     6248    33640    4       CALL M$CLOSE (CLOSE_SCRATCH) WHENALTRETURN DO;
     6249    33641    4       END;
     6250    33642    3       NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:219  
     6251    33643    3       GOTO CLEANUP;
     6252    33644    3   E_PMME2:
     6253    33645    3       IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$FILEBUSY
     6254    33646    4       THEN DO;
     6255    33647    4           CALL XUR$ERRMSG(E_CANTCOMPACT);
     6256    33648    4           NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;
     6257    33649    4           GOTO CLEANUP;
     6258    33650    4       END;
     6259    33651    3       ELSE GOTO E_PMME;
     6260    33652    3   END COPY_FOLDER;
     6261    33653        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:220  
     6262    33654    2   SORT_FOLDER: PROC;
     6263    33655        /*I*   NAME: SORT_FOLDER
     6264    33656               DESCRIPTION:
     6265    33657                       Alot of this module has been borrowed from the COPY_
     6266    33658                       FOLDER module, with the sort routine being new. The
     6267    33659                       message number is kept in HOLE.MSG_NUM. When sorting by
     6268    33660                       date, the date is kept in HOLE.SORT#. When sorting by a
     6269    33661                       character field, SORT# is an offset from the beginning
     6270    33662                       of STASH where the textc fields of interest are kept.
     6271    33663                       VM_WORK_ and VM_HEADER_ are used the same as in  COPY_
     6272    33664                       FOLDER. Some housekeeping is done in the char sort for
     6273    33665                       HOLE and STASH since they both live in WORK_.      */
     6274    33666        %FPT_PRECORD (FPTN = BOF, BOF = YES);
     6275    33687    3   DCL OLD_TYPE UBIN;
     6276    33688    3   DCL CUR_NUM UBIN;
     6277    33689    3   DCL HINDX UBIN WORD ALIGNED;
     6278    33690    3   DCL WRITEIT BIT(1);
     6279    33691    3   DCL HOLE$ PTR STATIC;
     6280    33692    3   DCL MAIL_FILE$ PTR;
     6281    33693    3   DCL HMAX UBIN STATIC;
     6282    33694    3   DCL NEW_NUM UBIN STATIC;
     6283    33695    3   DCL SIZE UBIN WORD;
     6284    33696    3   DCL TEMPLATE CHAR(SIZE) BASED;
     6285    33697    3   DCL 1 B$TEXTC BASED,
     6286    33698    3         2 L UBIN (9) UNAL,
     6287    33699    3         2 C CHAR(B$TEXTC.L);
     6288    33700    3   DCL STASH_LEN UBIN WORD;
     6289    33701    3   DCL STASH CHAR(STASH_LEN) BASED;
     6290    33702    3   DCL STASH$ PTR;
     6291    33703    3   DCL TEMP$  PTR;
     6292    33704    3   DCL NEXT$ PTR;
     6293    33705    3   DCL HIGH SBIN WORD STATIC INIT(0);
     6294    33706    3   DCL LOW  SBIN WORD STATIC INIT(0);
     6295    33707    3   DCL LAST SBIN WORD STATIC INIT(-1);
     6296    33708    3   DCL MID  SBIN WORD STATIC INIT(0);
     6297    33709    3   DCL I UBIN WORD;
     6298    33710    3   DCL FLDPTR$ PTR;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:221  
     6299    33711    3   DCL VMX$MRL ENTRY(3);
     6300    33712    3   DCL 1 HOLE(0:1024) BASED(HOLE$) DALIGNED,
     6301    33713    3         2 MSG_NUM UBIN WORD ALIGNED,
     6302    33714    3         2 SORT# UBIN WORD ALIGNED;
     6303    33715    3       HOLE$ = VBASE(VM_WORK_);
     6304    33716    3       LAST = -1;
     6305    33717    3       CALL XUR$ERRMSG (E_COMPACT,,M$ME_NUM);
     6306    33718    3       HMAX=VBOUND(VM_WORK_)/4;
     6307    33719    4       IF HEADER_FIELD# > 1 THEN DO; /* If the sort field is char */
     6308    33720    4           CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024) ALTRET(E_PMME);
     6309    33721    4           STASH$ = PINCRW(HOLE$, 1024);
     6310    33722    4           STASH$->B$TEXTC.L=0;
     6311    33723    4           STASH_LEN = 1;
     6312    33724    4       END;
     6313    33725    3       MAIL_FILE$ = DCBADDR(M$MAIL_FILE_NUM);
     6314    33726                                 /* Close the current folder, reopen it share=none */
     6315    33727    3       CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;
     6316    33728    3       VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B;
     6317    33729    3       CALL M$CLOSE (CLOSE_SAVE);
     6318    33730    3       RENUM_OPEN.NAME_ = VECTOR(FID_NAME);
     6319    33731    3       CALL CONCAT(FID_NAME.NAME#,':MAIL_',VM_CURRENT_FOLDER.FOLDER);
     6320    33732    3       CALL INDEX (INDX,' ',FID_NAME.NAME#);
     6321    33733    3       FID_NAME.L# = INDX;
     6322    33734    3       RENUM_OPEN.ACCT_ = VECTOR(VM_CURRENT_FOLDER.ACCT);
     6323    33735    3       RENUM_OPEN.PASS_ = VECTOR(VM_CURRENT_FOLDER.PASS);
     6324    33736    3       RENUM_OPEN.V.ACS#=%DIRECT#;
     6325    33737    3       RENUM_OPEN.FPARAM_ = VECTOR(FPARAM_AREA);
     6326    33738    3       RENUM_OPEN.V.DCB# = M$MAIL_FILE_NUM;
     6327    33739    3       RENUM_OPEN.V.FUN# = %IN#;
     6328    33740    3       RENUM_OPEN.IFPARAM_ = VECTOR(NIL);
     6329    33741    3       CALL M$OPEN (RENUM_OPEN) ALTRET(E_PMME2);
     6330    33742    3       RENUM_OPEN.V.DCB# = M$WORK_NUM;
     6331    33743    3       RENUM_OPEN.FPARAM_ = VECTOR(NIL);
     6332    33744    3       RENUM_OPEN.IFPARAM_ = VECTOR(FPARAM_AREA);
     6333    33745    3       RENUM_OPEN.V.FUN#=%CREATE#;
     6334    33746    3       RENUM_OPEN.V.EXIST# = %NEWFILE#;
     6335    33747    3       RENUM_OPEN.V.ORG# = %KEYED#;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:222  
     6336    33748    3       CALL M$OPEN (RENUM_OPEN) ALTRET(E_PMME);
     6337    33749    3       READ_OLD.BUF_ = VM_HEADER_;
     6338    33750    3       OLD_TYPE=0;
     6339    33751    3       IF RENUMBER# THEN NEXT_NUM = 0;
     6340    33752    3       ELSE NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;
     6341    33753    4   SORT_LOOP: DO WHILE('1'B);
     6342    33754    5   READ_AGAIN_1: CALL M$READ (READ_OLD) WHENALTRETURN DO;
     6343    33755    5               IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$EOF THEN EXIT SORT_LOOP;
     6344    33756    5               ELSE IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD
     6345    33757    6                   THEN DO;
     6346    33758    6                       CALL VMA$ENLARGE_SEGMENT (VM_HEADER_, 1024) ALTRET(E_PMME);
     6347    33759    6                       READ_OLD.BUF_ = VM_HEADER_;
     6348    33760    6                       CALL M$PRECORD (FPT_PRECORD) ALTRET(E_PMME); /* Can't
     6349    33761                                                use cont, folder may be compressed */
     6350    33762    6                       GOTO READ_AGAIN_1;
     6351    33763    6                   END;
     6352    33764    5                   ELSE GOTO E_PMME;
     6353    33765    5           END;                         /* WHENALTRETURN */
     6354    33766    4           IF VLP_KEY.TYPE = %VM_TYPE_HEAD THEN
     6355    33767    5           DO;
     6356    33768    5               IF HEADER_FIELD# = %REN_OPT_DATE THEN
     6357    33769    6               DO;
     6358    33770    6                   IF (LAST+1)*2 >= HMAX THEN
     6359    33771    7                   DO;
     6360    33772    7                       CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024) ALTRET (E_PMME);
     6361    33773    7                       HMAX = VBOUND(VM_WORK_)/4;
     6362    33774    7                   END;
     6363    33775
     6364    33776    6                   IF LAST < 0 THEN
     6365    33777    6                       GOTO PUT_AT_END_UBIN;
     6366    33778
     6367    33779    7                   IF LAST < 20 THEN DO;
     6368    33780
     6369    33781    8                       DO MID = 0 TO LAST;
     6370    33782    8                           IF HOLE.SORT#(MID) > VM_HEADER.CREATION_DATE
     6371    33783    8                           THEN GOTO FOUND_UBIN;
     6372    33784    8                       END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:223  
     6373    33785    7                       GOTO PUT_AT_END_UBIN;
     6374    33786    7                   END;
     6375    33787    7                   ELSE DO;
     6376    33788    7                       LOW = -1;
     6377    33789    7                       HIGH = LAST + 1;
     6378    33790    7   SPLIT_UBIN:         ;
     6379    33791    7                       MID = (LOW + HIGH)/2;
     6380    33792    7                       IF HOLE.SORT#(MID) < VM_HEADER.CREATION_DATE THEN
     6381    33793    7                           LOW = MID;
     6382    33794    7                       ELSE
     6383    33795    7                           IF HOLE.SORT#(MID) > VM_HEADER.CREATION_DATE THEN
     6384    33796    7                               HIGH = MID;
     6385    33797    7                           ELSE
     6386    33798    7                               GOTO FOUND_UBIN;
     6387    33799    7                       IF (LOW + 1) < HIGH THEN
     6388    33800    7                           GOTO SPLIT_UBIN;
     6389    33801    7                       IF HOLE.SORT#(MID) < VM_HEADER.CREATION_DATE THEN
     6390    33802    7                           MID = MID + 1;
     6391    33803    7                       IF MID > LAST THEN
     6392    33804    7                           GOTO PUT_AT_END_UBIN;
     6393    33805    7                   END;
     6394    33806    6   FOUND_UBIN:     ;
     6395    33807    6                   LAST = LAST + 1;
     6396    33808    6                   SIZE = (LAST - MID) * 8;
     6397    33809    6   MLR_UBIN:       ;
     6398    33810    6                   CALL VMX$MRL(ADDR(HOLE(MID))->TEMPLATE, ADDR(HOLE(MID+1))->TEMPLATE,
             33810                            SIZE);
     6399    33811    6                   HOLE.MSG_NUM(MID) = VLP_KEY.NUM;
     6400    33812    6                   HOLE.SORT#(MID) = VM_HEADER.CREATION_DATE;
     6401    33813
     6402    33814    7                   DO WHILE('0'B); /* Never! */
     6403    33815    7   PUT_AT_END_UBIN:    ;
     6404    33816    7                       LAST = LAST + 1;
     6405    33817    7                       HOLE.MSG_NUM(LAST) = VLP_KEY.NUM;
     6406    33818    7                       HOLE.SORT#(LAST) = VM_HEADER.CREATION_DATE;
     6407    33819    7                   END;
     6408    33820    6               END;                     /* IF DATE */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:224  
     6409    33821    6               ELSE DO;                 /* IF CHAR FIELD */
     6410    33822
     6411    33823    7                   DO SELECT (HEADER_FIELD#);
     6412    33824    7                       SELECT (%REN_OPT_FROM);
     6413    33825    7                       FLDPTR$ = VM_HEADER.FROM$;
     6414    33826    7                       SELECT (%REN_OPT_REF);
     6415    33827    7                       FLDPTR$ = VM_HEADER.REFERENCE$;
     6416    33828    7                       SELECT (%REN_OPT_SUBJ);
     6417    33829    7                       FLDPTR$ = VM_HEADER.SUBJECT$;
     6418    33830    7                       SELECT (%REN_OPT_TO);
     6419    33831    7                       FLDPTR$ = VM_HEADER.TO$;
     6420    33832    7                   END; /* SELECT */
     6421    33833
     6422    33834    7                   IF (LAST+1)*2 >= HMAX THEN DO;
     6423    33835    7                       CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024) ALTRET (E_PMME);
     6424    33836    7                       TEMP$ = PINCRW(STASH$,1024);
     6425    33837    7                       CALL VMX$MRL (STASH$->STASH,
     6426    33838    7                         TEMP$->STASH,
     6427    33839    7                         STASH_LEN);
     6428    33840    7                       STASH$ = PINCRW(STASH$,1024);
     6429    33841    7                       HMAX = POFFW(STASH$,HOLE$);
     6430    33842
     6431    33843    7                   END;
     6432    33844
     6433    33845    6                   IF FLDPTR$ = ADDR(NIL) THEN
     6434    33846    6                       GOTO NIL_PTR;
     6435    33847
     6436    33848    6                   IF (VBOUND(VM_WORK_) + 1) -
     6437    33849    7                     ((FLDPTR$->B$TEXTC.L+1) + STASH_LEN + ((HMAX+1)*4)) < 10 THEN DO;
     6438    33850
     6439    33851    7                       CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024) ALTRET(E_PMME);
     6440    33852    7                   END;
     6441    33853
     6442    33854    6                   IF LAST < 0 THEN
     6443    33855    6                       GOTO PUT_AT_END_CHAR;
     6444    33856
     6445    33857    7                   IF LAST < 20 THEN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:225  
     6446    33858
     6447    33859    8                       DO MID = 0 TO LAST;
     6448    33860    9                           IF HOLE.SORT#(MID) > 0 THEN DO;
     6449    33861    9                               TEMP$ = PINCRC(STASH$,HOLE.SORT#(MID));
     6450    33862    9                               IF SUBSTR(TEMP$->B$TEXTC.C, 0, TEMP$->B$TEXTC.L) >
     6451    33863    9                                 SUBSTR(FLDPTR$->B$TEXTC.C, 0, FLDPTR$->B$TEXTC.L)
     6452    33864    9                               THEN GOTO FOUND_CHAR;
     6453    33865    9                           END;
     6454    33866    8                       END;
     6455    33867    7                       GOTO PUT_AT_END_CHAR;
     6456    33868    7                   END;
     6457    33869    7                   ELSE DO;
     6458    33870    7                       LOW = -1;
     6459    33871    7                       HIGH = LAST + 1;
     6460    33872    7   SPLIT_CHAR:         ;
     6461    33873    7                       MID = (LOW + HIGH)/2;
     6462    33874    8                       IF HOLE.SORT#(MID) > 0 THEN DO;
     6463    33875    8                           TEMP$ = PINCRC(STASH$, HOLE.SORT#(MID));
     6464    33876    8                           IF SUBSTR(TEMP$->B$TEXTC.C,0,TEMP$->B$TEXTC.L) <
     6465    33877    8                             SUBSTR(FLDPTR$->B$TEXTC.C, 0, FLDPTR$->B$TEXTC.L) THEN
     6466    33878    8                               LOW = MID;
     6467    33879    8                           ELSE
     6468    33880    8                               IF SUBSTR(TEMP$->B$TEXTC.C,0,TEMP$->B$TEXTC.L) >
     6469    33881    8                                 SUBSTR(FLDPTR$->B$TEXTC.C,0,FLDPTR$->B$TEXTC.L) THEN
     6470    33882    8                                   HIGH = MID;
     6471    33883    8                               ELSE
     6472    33884    8                                   GOTO FOUND_CHAR;
     6473    33885    8                           IF (LOW + 1) < HIGH THEN
     6474    33886    8                               GOTO SPLIT_CHAR;
     6475    33887    8                           IF SUBSTR(TEMP$->B$TEXTC.C,0,TEMP$->B$TEXTC.L) <
     6476    33888    8                             SUBSTR(FLDPTR$->B$TEXTC.C, 0, FLDPTR$->B$TEXTC.L) THEN
     6477    33889    8                               MID = MID + 1;
     6478    33890    8                           IF MID > LAST THEN
     6479    33891    8                               GOTO PUT_AT_END_CHAR;
     6480    33892    8                       END;
     6481    33893    8                       ELSE DO;
     6482    33894    8                           LOW = LOW + 1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:226  
     6483    33895    8                           IF LOW = LAST THEN
     6484    33896    8                               GOTO PUT_AT_END_CHAR;
     6485    33897    8                           ELSE
     6486    33898    8                               GOTO SPLIT_CHAR;
     6487    33899    8                       END;
     6488    33900    7                   END;
     6489    33901    6   FOUND_CHAR:     ;                  /* check for duplicates */
     6490    33902
     6491    33903    7   CHECK_DUPES:    DO I = MID TO LAST;
     6492    33904    7                       TEMP$ = PINCRC(STASH$,HOLE.SORT#(I));
     6493    33905    7                       IF I = LAST THEN
     6494    33906    7                           NEXT$ = PINCRC(STASH$,HOLE.SORT#(I));
     6495    33907    7                       ELSE
     6496    33908    7                           NEXT$ = PINCRC(STASH$,HOLE.SORT#(I+1));
     6497    33909
     6498    33910    7                       IF (SUBSTR(TEMP$->B$TEXTC.C,0,TEMP$->B$TEXTC.L) =
     6499    33911    7                         SUBSTR(FLDPTR$->B$TEXTC.C,0,FLDPTR$->B$TEXTC.L)) OR
     6500    33912    7                         (SUBSTR(NEXT$->B$TEXTC.C,0,NEXT$->B$TEXTC.L) =
     6501    33913    7                         SUBSTR(FLDPTR$->B$TEXTC.C,0,FLDPTR$->B$TEXTC.L))
     6502    33914    8                       THEN DO; /* nothing, just loop */
     6503    33915    8                       END;
     6504    33916    8                       ELSE DO;
     6505    33917    8                           MID = I;
     6506    33918    8                           TEMP$ = PINCRC(STASH$,HOLE.SORT#(MID));
     6507    33919    8                           EXIT CHECK_DUPES;
     6508    33920    8                       END;
     6509    33921    7                   END;
     6510    33922
     6511    33923    6                   LAST = LAST + 1;
     6512    33924    6                   SIZE = (LAST - MID) * 8;
     6513    33925    6   MLR_CHAR:       ;
     6514    33926    6                   CALL VMX$MRL(HOLE(MID), HOLE(MID+1), SIZE);
     6515    33927    6                   HOLE.MSG_NUM(MID) = VLP_KEY.NUM;
     6516    33928    6                   HOLE.SORT#(MID) = STASH_LEN + 1;
     6517    33929    6                   TEMP$ = PINCRC(STASH$,STASH_LEN + 1);
     6518    33930    6                   TEMP$->B$TEXTC.L = FLDPTR$->B$TEXTC.L;
     6519    33931    6                   TEMP$->B$TEXTC.C = FLDPTR$->B$TEXTC.C;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:227  
     6520    33932    6                   STASH_LEN = STASH_LEN + FLDPTR$->B$TEXTC.L + 1;
     6521    33933    7                   DO WHILE('0'B); /* Never! */
     6522    33934    7   PUT_AT_END_CHAR:    ;
     6523    33935    7                       LAST = LAST + 1;
     6524    33936    7                       HOLE.MSG_NUM(LAST) = VLP_KEY.NUM;
     6525    33937    7                       HOLE.SORT#(LAST) = STASH_LEN + 1;
     6526    33938    7                       TEMP$ = PINCRC(STASH$,STASH_LEN + 1);
     6527    33939    7                       TEMP$->B$TEXTC.L = FLDPTR$->B$TEXTC.L;
     6528    33940    7                       TEMP$->B$TEXTC.C = FLDPTR$->B$TEXTC.C;
     6529    33941    7                       STASH_LEN = STASH_LEN + FLDPTR$->B$TEXTC.L + 1;
     6530    33942    7                   END;
     6531    33943
     6532    33944    7                   DO WHILE ('0'B); /* Never! */
     6533    33945    8   NIL_PTR:            DO MID = 0 TO LAST+1;
     6534    33946    8                           IF HOLE.SORT#(MID) > 0 /* 1st non-zero element */
     6535    33947    9                           THEN DO;
     6536    33948    9                               LAST = LAST + 1;
     6537    33949    9                               SIZE = (LAST - MID) * 8;
     6538    33950    9                               CALL VMX$MRL (HOLE(MID),
     6539    33951    9                                 HOLE(MID+1),
     6540    33952    9                                 SIZE);
     6541    33953    9                               HOLE.MSG_NUM(MID) = VLP_KEY.NUM;
     6542    33954    9                               HOLE.SORT#(MID) = 0;
     6543    33955    9                               EXIT NIL_PTR;
     6544    33956    9                           END;
     6545    33957    8                       END;
     6546    33958    7                   END;
     6547    33959    6               END;                     /* IF CHAR FIELD */
     6548    33960    5           END;                         /* If VLP_KEY.TYPE = HEADER */
     6549    33961    4       END;                           /* Sort loop */
     6550    33962        /* Now, go through the file a second time replacing the old
     6551    33963           message numbers with new ones.                           */
     6552    33964
     6553    33965    3       BOF.V.DCB# = M$MAIL_FILE_NUM;
     6554    33966    3       CALL M$PRECORD (BOF);
     6555    33967
     6556    33968    4   RENUMBER_LOOP: DO WHILE ('1'B);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:228  
     6557    33969
     6558    33970    4           CALL M$READ (READ_OLD) WHENALTRETURN
     6559    33971    5           DO;
     6560    33972    5               IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$EOF THEN
     6561    33973    5                   EXIT RENUMBER_LOOP;
     6562    33974    5               ELSE
     6563    33975    5                   GOTO E_PMME;
     6564    33976    5           END;
     6565    33977
     6566    33978    5           DO CASE (VLP_KEY.TYPE);
     6567    33979
     6568    33980    5           CASE(%VM_TYPE_PRO,%VM_TYPE_LIST,
     6569    33981    5             %VM_TYPE_USER,%VM_TYPE_ACC,
     6570    33982    5             %VM_TYPE_SITE);
     6571    33983
     6572    33984
     6573    33985    5           CASE(%VM_TYPE_ID);
     6574    33986    6               DO;
     6575    33987    6                   CALL GET_NEW_MSGNUM(VM_ID.MESSAGE_NUMBER);
     6576    33988    6                   VM_ID.MESSAGE_NUMBER = NEW_NUM;
     6577    33989    6               END;
     6578    33990
     6579    33991    5           CASE (ELSE);
     6580    33992    6               DO;
     6581    33993    6                   HINDX = VLP_KEY.NUM;
     6582    33994    6                   CALL GET_NEW_MSGNUM(HINDX);
     6583    33995    6                   VLP_KEY.NUM = NEW_NUM;
     6584    33996    6               END;
     6585    33997
     6586    33998    5           END;
     6587    33999
     6588    34000    4           WRITE_NEW.BUF_ = VM_HEADER_;
     6589    34001
     6590    34002    4           IF MAIL_FILE$->F$DCB.ARS# = 0 THEN
     6591    34003    4               WRITE_NEW.BUF_ = VECTOR(NIL);
     6592    34004    4           ELSE
     6593    34005    4               WRITE_NEW.BUF_.BOUND = MAIL_FILE$->F$DCB.ARS# - 1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:229  
     6594    34006
     6595    34007    4           WRITE_NEW.V.DVBYTE = MAIL_FILE$->F$DCB.DVBYTE;
     6596    34008    4           WRITE_NEW.KEY_ = VECTOR(VLP_KEY);
     6597    34009
     6598    34010    4           CALL M$WRITE (WRITE_NEW) ALTRET(E_PMME);
     6599    34011
     6600    34012    4       END; /* Renumber loop */
     6601    34013
     6602    34014
     6603    34015    3       NEXT_NUM = LAST + 1;
     6604    34016    3       VM_PROFILE.RECS_DELETED=0;
     6605    34017    3       VM_PROFILE.HI_MESSAGE_NUMBER = LAST + 1;
     6606    34018    3       VM_PROFILE.NUM_MESSAGES = LAST + 1;
     6607    34019    3       CALL VMD$PUT_PROFILE(M$WORK_NUM) ALTRET(E_PMME);
     6608    34020    3       CLOSE_SAVE.V.DCB#=M$MAIL_FILE_NUM;
     6609    34021    3       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     6610    34022    3       CLOSE_SAVE.V.DCB#=M$WORK_NUM;
     6611    34023    3       CLOSE_SAVE.V.OPER.RELG# = '1'B;
     6612    34024    3       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     6613    34025    3       CLOSE_SAVE.V.OPER.RELG# = '0'B;
     6614    34026    3   CLEANUP:
     6615    34027    3       CALL VMB$USE_SAME (,,VM_CURRENT_FOLDER,M$MAIL_FILE_NUM);
     6616    34028    3       CALL VMA$SHRINK_SEGMENT (VM_WORK_,);
     6617    34029    3       CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024);
     6618    34030    3       RETURN;
     6619    34031    3   E_PMME:
     6620    34032    3       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     6621    34033    3       DCB# = B$TCB.ALT$->B$ALT.DCB#;
     6622    34034    3       CALL XUR$ERRMSG (E_RENFAILED);
     6623    34035    3       CALL XUR$ERRMSG (ERROR,DCB#);
     6624    34036    3       CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;
     6625    34037    4       CALL M$CLOSE (CLOSE_SCRATCH) WHENALTRETURN DO;
     6626    34038    4       END;
     6627    34039    3       NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;
     6628    34040    3       GOTO CLEANUP;
     6629    34041    3   E_PMME2:
     6630    34042    3       IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$FILEBUSY
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:230  
     6631    34043    4       THEN DO;
     6632    34044    4           CALL XUR$ERRMSG(E_CANTCOMPACT);
     6633    34045    4           NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;
     6634    34046    4           GOTO CLEANUP;
     6635    34047    4       END;
     6636    34048    3       ELSE GOTO E_PMME;
     6637    34049        /* END SORT_FOLDER; */
     6638    34050        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:231  
     6639    34051    3   GET_NEW_MSGNUM: PROC (OLD_MSGNUM);
     6640    34052
     6641    34053    4   DCL OLD_MSGNUM UBIN WORD ALIGNED;
     6642    34054    4   DCL I UBIN WORD;
     6643    34055
     6644    34056    5   ARRAY_LOOP: DO I = 0 TO LAST;
     6645    34057    5           IF OLD_MSGNUM = HOLE.MSG_NUM(I) THEN
     6646    34058    6           DO;
     6647    34059    6               NEW_NUM = I + 1;
     6648    34060    6               EXIT ARRAY_LOOP;
     6649    34061    6           END;
     6650    34062    5       END;
     6651    34063
     6652    34064    4       RETURN;
     6653    34065
     6654    34066    4   END GET_NEW_MSGNUM;
     6655    34067    3   END SORT_FOLDER;
     6656    34068    2   END UPDATE$MAIL;
     6657    34069        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:232  
     6658    34070    1   TRANSFORM_DOMAIN: PROC (DOMAIN$, SITENAME, NAME) ALTRET;
     6659    34071
     6660    34072    2   DCL DOMAIN$ PTR;
     6661    34073    2   DCL SITENAME CHAR (8);
     6662    34074        %VLP_NAME (FPTN=NAME, STCLASS=PARAM);
     6663    34101
     6664    34102    2   DCL SITE$ PTR;
     6665    34103    2   DCL INDX1 UBIN;
     6666    34104    2   DCL INDX2 UBIN;
     6667    34105
     6668    34106        /*
     6669    34107              ***** If a domain was specified, check to make sure that the outermost
     6670    34108                    subdomain can be mapped into a node name;  reject otherwise.  Then
     6671    34109                    map the domain-name structure into the corresponding CP-6
     6672    34110                    equivalent (e.g. "name@sd1.sd2.sd3" -> "name%sd1.sd2@sd3").
     6673    34111        */
     6674    34112    2       IF DOMAIN$ ~= ADDR(NIL)
     6675    34113    3       THEN DO;
     6676    34114    3           SITE$ = DOMAIN$ -> P$B.SUBLK$(DOMAIN$ -> P$B.NSUBLKS - 1);
     6677    34115    3           IF SITE$ -> P$S.COUNT > LENGTHC(SITENAME)
     6678    34116    4           THEN DO;
     6679    34117    4               CALL XUR$ERRMSG (E_BADDOMAIN,,,
     6680    34118    4                 VECTOR(SITE$->P$S.TEXTC$->X$STRING));
     6681    34119    4               ALTRETURN;
     6682    34120    4           END;
     6683    34121    3           SITENAME = SITE$->P$S.TEXT;
     6684    34122    4           DO INDX2 = 0 TO DOMAIN$ -> P$B.NSUBLKS - 2;
     6685    34123    4               INDX1 = NAME.L#;
     6686    34124    4               NAME.L# = NAME.L# + DOMAIN$ -> P$B.SUBLK$(INDX2) -> P$S.COUNT + 1;
     6687    34125    4               IF INDX2 = 0
     6688    34126    4               THEN
     6689    34127    4                   CALL INSERT (NAME.NAME#, INDX1, , '%', DOMAIN$ -> P$B.SUBLK$(INDX2)
             34127                            -> P$S.TEXT);
     6690    34128    4               ELSE
     6691    34129    4                   CALL INSERT (NAME.NAME#, INDX1, , '.', DOMAIN$ -> P$B.SUBLK$(INDX2)
             34129                            -> P$S.TEXT);
     6692    34130    4           END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:233  
     6693    34131    3       END;
     6694    34132
     6695    34133    2       RETURN;
     6696    34134
     6697    34135    2   END TRANSFORM_DOMAIN;
     6698    34136        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:234  
     6699    34137        /********************************************************************/
     6700    34138        /*I*
     6701    34139             NAME: DO$ACK
     6702    34140             PURPOSE:
     6703    34141                   To acknowledge the current message.
     6704    34142        *********************************************************************/
     6705    34143    1   DO$ACK: PROC (EXPLICIT) ALTRET;
     6706    34144
     6707    34145    2   DCL EXPLICIT BIT(1);
     6708    34146        /*
     6709    34147          ***** Build the command buffer to pass to send ...
     6710    34148        */
     6711    34149              %INIT_STR (CODE=E_SEND_ACKNOWLEDGE, STR=VM_SEND_ACKNOWLEDGE, TEST=YES);
     6712    34172    2       CALL BUILD_LINK_TO_SEND_CMD (VM_SEND_ACKNOWLEDGE);
     6713    34173    2       CALL M$OPEN (OPEN_SEND_FILE) ALTRET(E_PMME);
     6714    34174    2       CALL VME$ACKNOWLEDGE (CURRENT_MESSAGE_NUMBER,USER_NAME,EXPLICIT)
     6715    34175    2         ALTRET(E_ACK);
     6716    34176    2       CLOSE_SAVE.V.DCB# = M$WORK_NUM;
     6717    34177    2       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);
     6718    34178    2       CALL LINK_RUNIT
     6719    34179    2       WHENRETURN
     6720    34180    3       DO;
     6721    34181    3           CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,
     6722    34182    3             M$MAIL_FILE_NUM) ALTRET(E_PMME);
     6723    34183    3       END;
     6724    34184    2       WHENALTRETURN
     6725    34185    3       DO;
     6726    34186    3           CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,
     6727    34187    3             M$MAIL_FILE_NUM) ALTRET(E_PMME);
     6728    34188    3           GOTO E_PMME;
     6729    34189    3       END;
     6730    34190    3       DO NEVER;
     6731    34191    3   E_ACK:                                  /* Cleanup */
     6732    34192    3           CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;
     6733    34193    3           CALL M$CLOSE (CLOSE_SCRATCH) ALTRET(E_PMME);
     6734    34194    3       END;                            /* Do never ... end */
     6735    34195    2       RETURN;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:235  
     6736    34196        /**/
     6737    34197    2   E_PMME:
     6738    34198    2       ALTRETURN;
     6739    34199    2   END DO$ACK;
     6740    34200        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:236  
     6741    34201        /*****************************************************************/
     6742    34202        /*                                                               */
     6743    34203        /*I*       NAME:       BUILD_LINK_TO_SEND_CMD                    *
     6744    34204         *                                                               *
     6745    34205         *         PURPOSE:    To build a legal LINK TO SEND command.    *
     6746    34206         *                                                               *
     6747    34207         *****************************************************************/
     6748    34208
     6749    34209    1   BUILD_LINK_TO_SEND_CMD: PROC(NAME);
     6750    34210
     6751    34211        %VLP_NAME (FPTN=NAME, STCLASS=PARAM);
     6752    34238    2   dcl  LEN   sbin;
     6753    34239    2   dcl  CFLEN sbin;
     6754    34240
     6755    34241        /*
     6756    34242          *****    NAME is the text of the command to pass to send
     6757    34243          *****    1.    Insert command and start option (MAIL=
     6758    34244        */
     6759    34245    2       LINK_CCBUF = NAME;
     6760    34246            %INIT_STR (CODE=E_SEND_MAIL, STR=VM_SEND_MAIL, TEST=YES);
     6761    34269    2       CALL INSERT (LINK_CCBUF.NAME#, LINK_CCBUF.L#,, VM_SEND_MAIL.NAME#);
     6762    34270    2       LEN = NAME.L# + VM_SEND_MAIL.L#;
     6763    34271
     6764    34272        /*
     6765    34273          *****    2.    Pass SEND the name of the current folder
     6766    34274        */
     6767    34275    2       WORK_STRING.L# = lengthc(WORK_STRING.NAME#);
     6768    34276    2       call VMF$MAKE_ADDRESS1PASS (WORK_STRING,VM_CURRENT_FOLDER);
     6769    34277    2       SIZE = WORK_STRING.L#;
     6770    34278    2       substr(LINK_CCBUF.NAME#,LEN,SIZE) = substr(WORK_STRING.NAME#,,SIZE);
     6771    34279    2       substr(LINK_CCBUF.NAME#,LEN+SIZE,1) = ')';
     6772    34280
     6773    34281    2       SIZE = SIZE + LEN + 1;
     6774    34282    2       LINK_CCBUF.L# = SIZE;
     6775    34283        /*
     6776    34284          ***** Check for a valid user name.  If invalid, enclose in quotes
     6777    34285          ***** so that a registered name containing non-standard characters
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:237  
     6778    34286          ***** is acceptable.
     6779    34287        */
     6780    34288    2       CALL XUR$GETCMD (SEND_CMD$->BSD,OUT$,,LINK_CCBUF.NAME#,SIZE)
     6781    34289    3       whenaltreturn do;
     6782    34290    3           INDX2 = 0;
     6783    34291    3           CFLEN = VM_CURRENT_FOLDER.USER_NAME.COUNT;
     6784    34292    4           do while( INDX2 < CFLEN);
     6785    34293    4               if substr(WORK_STRING.NAME#,INDX2,1) ~= substr(VM_CURRENT_FOLDER.
             34293                        USER_NAME.TEXT,INDX2,1)
     6786    34294    4               then exit;
     6787    34295    4               INDX2 = INDX2 + 1;
     6788    34296    4           end;
     6789    34297
     6790    34298    3           substr(LINK_CCBUF.NAME#,LEN,1) = '''';
     6791    34299    3           substr(LINK_CCBUF.NAME#,LEN+1,CFLEN) = WORK_STRING.NAME#;
     6792    34300    3           LEN = LEN + 1 + CFLEN;
     6793    34301    3           substr(LINK_CCBUF.NAME#,LEN,1) = '''';
     6794    34302    3           SIZE = WORK_STRING.L# - INDX2;
     6795    34303    3           substr(LINK_CCBUF.NAME#,LEN+1,SIZE) = substr(WORK_STRING.NAME#,INDX2,SIZE);
     6796    34304    3           substr(LINK_CCBUF.NAME#,LEN+1+SIZE,1) = ')';
     6797    34305    3           SIZE = LEN + 2 + SIZE;
     6798    34306    3           LINK_CCBUF.L# = SIZE;
     6799    34307    3       end;
     6800    34308            %INIT_STR (CODE=E_SEND_NAME, STR=VM_SEND_NAME, TEST=YES);
     6801    34331    2       FPT_LINK.NAME_ = VECTOR(VM_SEND_NAME);
     6802    34332    2       FPT_LINK.ACCT_ = VECTOR(SYSACCT);
     6803    34333
     6804    34334    2       return;
     6805    34335
     6806    34336    2   end BUILD_LINK_TO_SEND_CMD;
     6807    34337    1   END VMO$MAIL;
     6808    34338        %EOD;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:238  
--  Include file information  --

   B$TABLES_C.:LIB_E05  cannot be made into a system file and is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   XUW_MACRO_C.:LIB_E05  is referenced.
   XUR_ENTRY.:LIB_E05  cannot be made into a system file and is referenced.
   XUM_MACRO_C.:LIB_E05  is referenced.
   XUH_MACRO_C.:LIB_E05  is referenced.
   XU_PERR_C.:LIB_E05  is referenced.
   XUE_MACRO_C.:LIB_E05  is referenced.
   XU_FORMAT_C.:LIB_E05  is referenced.
   XU_MACRO_C.:LIB_E05  is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   B_SEGIDS_C.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
      No diagnostics issued in procedure VMO$MAIL.

   Procedure VMO$MAIL requires 10979 words for executable code.
   Procedure VMO$MAIL requires 978 words of local(AUTO) storage.

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:239  

 Object Unit name= VMO$MAIL                                   File name= VMO$MAIL.:VMB6TOU
 UTS= AUG 20 '97 15:19:11.04 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11   Data  even  none  2889   5511  VMO$MAIL
   12  RoData even  UTS    768   1400  VMO$MAIL
   13   DCB   even  none     0      0  M$NAME
   14   DCB   even  none     0      0  M$CMNDF
   15   DCB   even  none     0      0  M$LM
   16   DCB   even  none     0      0  M$EDIT
   17   DCB   even  none     0      0  M$OUT
   18   DCB   even  none     0      0  M$ENCL
   19   Proc  even  none 10979  25343  VMO$MAIL
   20  RoData even  none   460    714  VMO$MAIL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    19      0   yes            yes      Main       0  VMO$MAIL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:240  

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
   11     66  VM_ADDRESS_SPEC$                  12      0  VM_DEFAULT_NODES
   12     36  VM_NATL_PAIRS                     12     45  VM_NODENAMES
   12     72  VM_NODEFID                        11     70  VMO_REMEMBER
   11     72  CURRENT_MESSAGE_NUMBER            11    375  INDX2
   11    400  BREAK_TYPE                        12     75  M$OUT_NUM
   11    404  FOLDER_WAS_OPEN                   12     76  E_MODIFY_LIST_PROMPT
   12     77  E_MODIFY_USER_PROMPT              11   1070  VM_CGBUFFER
   11   1243  VM_CURRENT_FOLDER                 11   1461  VM_WORK_FOLDER
   12   1210  E_GREETING_FMT                    12   1211  E_FOLDER_HEADER1_FMT
   12   1212  E_FOLDER_HEADER2_FMT              12   1213  E_FOLDER_DELETED_FMT
   12   1214  E_FOLDER_DISPLAYED_FMT            12   1215  E_COUNT_FMT
   12   1216  E_NO_MESSAGE_FMT                  12   1217  E_TIME_FMT
   12   1220  E_EMPTY_FOLDER_FMT                12   1221  E_NO_NEW_MESSAGE_FMT
   12   1222  E_CREATE_MSG_FMT                  12   1223  E_USING_MSG_FMT
   12   1224  E_MSGS_DELETED_FMT                12   1225  E_MSGS_UNDELETED_FMT
   12   1226  E_MSGS_MARKED_FMT                 12   1227  E_MSGS_UNMARKED_FMT
   12   1230  E_MSGS_COPIED_FMT                 12   1231  E_MSGS_DISPLAYED_FMT
   12   1232  E_MSGS_LISTED_FMT                 12   1233  E_LISTS_DELETED_FMT
   12   1234  E_LISTS_DISPLAYED_FMT             12   1235  E_USERS_DELETED_FMT
   12   1236  E_USERS_DISPLAYED_FMT             12   1237  E_STATUS_FOLDER_FMT
   12   1240  E_STATUS_SCONTEXT_FMT             12   1241  E_STATUS_CCONTEXT_FMT
   12   1242  E_STATUS_POSITION_FMT             12   1243  E_STATUS_POSITION_OUTSIDE_FMT
   12   1244  E_STATUS_DMSGS_FMT                12   1245  E_STATUS_NMSGS_FMT
   12   1246  E_STATUS_TMSGS_FMT                12   1247  E_STATUS_HMSGS_FMT
   12   1250  E_USE_FULL_FMT                    12   1251  E_USE_LOST_FMT
   12   1252  E_NEW_MESSAGE_FMT                 12   1253  E_DETACH_OK_FMT
   12   1254  E_DETACH_DELETE_OK_FMT            12   1255  E_END_NOUPDATE_CMD
   12   1256  E_NEXT_CMD                        12   1257  E_DI_NEXT_CMD
   12   1260  E_LIST_NEXT_CMD                   12   1261  E_PREVIOUS_CMD
   12   1262  E_DI_PREVIOUS_CMD                 12   1263  E_LIST_PREVIOUS_CMD
   12   1264  E_DI_FIRST_CMD                    12   1265  E_LIST_FIRST_CMD
   12   1266  E_DI_THIS_CMD                     12   1267  E_LIST_THIS_CMD
   12   1270  E_DI_LAST_CMD                     12   1271  E_LIST_LAST_CMD
   12   1272  E_DI_REST_CMD                     12   1273  E_LIST_REST_CMD
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:241  
   12   1274  E_END_CMD                         12   1275  E_SEND_ANSWER
   12   1276  E_SEND_ACKNOWLEDGE                12   1277  E_SEND_FORWARD
   12   1300  E_SEND_FORWARD_ENCL               12   1301  E_SEND_MAIL
   11   5053  VM_SEND_NAME                      12   1302  E_SEND_NAME
   11   5063  VM_RESEND_NAME                    12   1303  E_RESEND_NAME
   12   1304  E_MAIL_SETUP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
 yes     yes           Std       0 VMA$OPEN_ENCL_SEGS
 yes     yes           Std       1 VMD$GET_PROFILE
         yes           Std       4 VMD$GETNODES
         yes           Std       0 XUR$DISABLE
 yes     yes           Std       7 XUR$INFOMSG
 yes     yes           Std       6 XUR$GETCMD
         yes           Std       0 VMO$ABORT
 yes     yes           Std       2 XTX$ADAPT
         yes          Async      0 XUR$BREAK
 yes     yes           Std       2 VMA$ENLARGE_SEGMENT
 yes     yes           Std       7 VMB$USE_DEFAULT
         yes           Std       1 VMD$WRITE_BUF
 yes     yes           Std       4 XUR$SETDCBS
         yes          Async      0 VMO$XCON
 yes     yes           Std       1 VMD$PUT_PROFILE
 yes     yes           Std       1 VMA$OPEN_GLOBAL
         yes           Std       0 XUR$CLRENABLE
 yes     yes           Std       3 VMD$ERRMSG
 yes     yes           Std       3 VMA$MOREMEM
 yes     yes           Std       7 VMB$FIND_DEFAULT
 yes     yes           Std       3 XUR$INIT
 yes     yes           Std       1 XUR$SETERRMSG
 yes     yes           Std       1 VMF$FROM
 yes     yes           Std       2 XUR$ERRPTR
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:242  
         yes           Std       0 XUR$ENABLE
 yes     yes           Std       1 XUR$ECHO
 yes     yes           Std       7 XUR$ERRMSG
 yes     yes           Std       4 VMA$GET_SITE_NAME
 yes     yes           Std       4 VMA$GET_ADD_RECORD
 yes     yes           Std       4 XUR$OPENOUT
 yes     yes           Std       1 X$DEALLOCATE
 yes     yes           Std       2 VMD$GET_HEADER
 yes     yes           Std       1 X$ALLOCATE
 yes     yes           Std       3 VMA$DEL_LIST
 yes     yes           Std       3 VMA$GET_LIST
         yes           Std       3 VMD$DI_HEADER
 yes     yes           Std       3 VME$ANSWER
 yes     yes           Std       6 VMD$DI_MESSAGE
 yes     yes           Std       3 VMA$PUT_LIST
 yes     yes           Std       9 VMD$PUT_ENCL
 yes     yes           Std       1 XUR$MOREMSG
 yes     yes           Std       1 VMA$OPEN_SRCH_LIST
 yes     yes           Std       2 VMD$PUT_HEADER
 yes     yes           Std       1 X$WILDCMP
 yes     yes           Std       9 VMD$GET_ENCL
 yes     yes           Std       1 XUR$HELP
         yes           Std       2 VMS$FMT_SELECT
 yes     yes           Std       3 VMM$COMBINE_MESSAGE
 yes     yes           Std       6 VMA$ADD_UENTRY_SORTED
         yes           Std       2 VMF$MAKE_ADDRESS1
 yes     yes           Std       1 XUR$ALLMSG
 yes     yes           Std       1 VMB$TESTREG
 yes     yes           Std       6 VMM$COPY_MESSAGE
         yes           Std       2 VMD$DI_FOLDER
 yes     yes           Std       6 VMA$DEL_RENTRY
 yes     yes           Std       6 VMA$ADD_RENTRY_SORTED
 yes     yes           Std       5 VMM$EDIT_MESSAGE_OUT
 yes     yes           Std       5 VMA$OPEN_FOLDER
 yes     yes           Std       9 VMD$DEL_ENCL
         yes           Std       2 VMX$OCTBIN
 yes     yes           Std       1 VMD$EJECT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:243  
 yes     yes           Std       4 VMA$PUT_ADD_RECORD
         yes           Std       4 VMD$DI_LIST
         yes           Std       1 VMD$DI_PROFILE
 yes     yes           Std       6 VMA$DEL_UENTRY
 yes     yes           Std       7 VMB$USE_SPECIFIED
         yes           Std       2 VMD$DI_USER
 yes     yes           Std       3 VMA$GET_LIST_NEXT
 yes     yes           Std       4 VMA$GET_NEXT_ENTRY
 yes     yes           Std       2 X$DEC_CONVERT
 yes     yes           Std       3 VMS$MOVE_SELECT
 yes     yes           Std       2 VMD$GET_HEADER_NEXT
 yes     yes           Std       3 VMS$SELECT
 yes     yes           Std       2 VMD$GET_HEADER_PREV
 yes     yes           Std       3 VMD$PUT_ID
 yes     yes           Std       2 VMM$DELETE_MESSAGE
 yes     yes           Std       7 VMB$USE_SAME
 yes     yes           Std       2 VMA$SHRINK_SEGMENT
         yes           Std       3 VMX$MRL
 yes     yes           Std       3 VME$ACKNOWLEDGE
         yes           Std       2 VMF$MAKE_ADDRESS1PASS
                       nStd      0 X66_MAUTO
                       nStd      0 X66_MARET
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:244  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
     VM_SITENAME                           VM_MAILCG_SETSTA                 r    B$XL_UPPER$
     MAIL_NODES                            SEND_CMD                              MAIL_CMD
     MODIFY_LIST                           MODIFY_USER                           ADDRESS_SPEC
     NEED_TITLE_BAR                        B_VERSION                             M$NAME
     M$CMNDF                               M$LM                                  M$EDIT
     M$OUT                                 M$ENCL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:245  


        1        1        /*M* VMO$MAIL Mail handling main program  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
        8        8        /*P* NAME: VMO$MAIL
        9        9             DESCRIPTION: This module performs the message viewing functions
       10       10                       for the mail system. It gives the user the ablity to
       11       11                        display and maintain the mail files in his accounts.
       12       12             WARNING:  To save time, VMA$OPEN_SRCH_LIST is called only when
       13       13                  address expansion may be pending.  As of 4/83, only USE
       14       14                  and LIST can cause expansion in MAIL.  If new features
       15       15                  are added that may cause expansion, call VMA$OPEN_SRCH_LIST
       16       16                  if VM_SEARCH_INFO.ACTIVE is reset.  You have been warned.  HEP
       17       17
       18       18                  ENQ/DEQ discussion:  On 5/8/83 the comgroup method of
       19       19                  concurrency control was replaced by ENQ/DEQ.  Three things
       20       20                  are enqueued, the PROFILE record, the HEADER record, and
       21       21                  the FILE name.  The discussions below concern MAIL and
       22       22                  MAILMAN.  Send does not need to use this facility.
       23       23
       24       24                  PROFILE - Everyone enqueues this SHARE=NONE.  MAILMAN
       25       25                  uses WAIT_TIME of 2 seconds.  This allows time for a
       26       26                  comgroup nowait read event to get in, and mailman can
       27       27                  give a file name to send.  MAIL waits till he gets the
       28       28                  resource.  MAILMAN only holds it for a very short time,
       29       29                  and another MAIL won't hold it unless he's got exclusive
       30       30                  use of the folder, in which case there is no problem as only
       31       31                  one mail will be using it exclusive at a time.  MAILMAN will
       32       32                  be help up by long operations such as COPY, MOVE and RENUMBER,
       33       33                  but only the delivery of mail will be delayed, not the entry
       34       34                  and exit of every user of MAIL as is currently the case.
       35       35                  The delay will only occur if mailman is attempting to deliver
       36       36                  a message to a user doing one of the above long operations.
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:246  
       37       37
       38       38                  HEADER - MAILMAN enqueues a header SHARE=NONE, MAIL enqueues
       39       39                  it SHARE=ALL.  This is used to keep MAIL from reading
       40       40                  a message while MAILMAN is entering it in the folder.  MAIL
       41       41                  does the enque WAIT_TIME=0, if it altrets a special message
       42       42                  is returned to the user, "Message being delivered".
       43       43                  This method was used instead of a busy bit in the message
       44       44                  header to avoid problems if the system crashes while the
       45       45                  message was being built.
       46       46
       47       47                  FILE - MAILMAN does not use this facility.  MAIL uses it to
       48       48                  avoid multiple updater problems with other MAIL users.  The
       49       49                  file open SHARE option can not be used, since MAIL and MAILMAN
       50       50                  must be able to update the file at the same time all users
       51       51                  must open the file SHARE=ALL.  If a user has update access to
       52       52                  the file, the FILE resource is enqueued SHARE=NONE.  If the
       53       53                  file is read only, SHARE=ALL is used.  This will allow
       54       54                  multiple users on information or bulletin board folders, and
       55       55                  only on user at a time in personal folders residing in multi-user
       56       56                  accounts.
       57       57
       58       58                  Before MAIL writes the profile record into the folder, the
       59       59                  record is first read and the number of messages information
       60       60                  is merged into MAIL's copy of the profile.  Since MAILMAN
       61       61                  changes only this information and dosen't dequeue until the
       62       62                  record is re-written, the most current information is always
       63       63                  maintained in the folder.
       64       64                                                                            */
       65       65        VMO$MAIL: PROC MAIN;

     65 19 000000   000000 700200 xent  VMO$MAIL     TSX0  ! X66_MAUTO
        19 000001   001722 000000                    ZERO    978,0

       66       66
       67       67        /***** Include files *****/
       68       68        %INCLUDE B_ERRORS_C;
       69     1195        %INCLUDE B_SEGIDS_C;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:247  
       70     1734        %INCLUDE B$JIT;
       71     2337        %INCLUDE CP_6;
       72     7896        %INCLUDE CP_6_SUBS;
       73     8436        %INCLUDE VM_MACRO_C;
       74     9704        %INCLUDE VM_SUBS_C;
       75     9964        %INCLUDE VM_PERR_C;
       76    10259        %INCLUDE VO_SUBS_C;
       77    10310        %INCLUDE XU_MACRO_C;
       78    13416        %INCLUDE XU_FORMAT_C;
       79    13578        %INCLUDE XUE_MACRO_C;
       80    14322        %INCLUDE XU_PERR_C;
       81    14513        %INCLUDE XUH_MACRO_C;
       82    14597        %INCLUDE XUM_MACRO_C;
       83    14624        %INCLUDE XUR_ENTRY;
       84    14656        %INCLUDE XUW_MACRO_C;
       85    14791        %INCLUDE VM_DATA_R;
       86    15222            %include B$TABLES_C;
       87    15330        %B$XL_UPPER(NAME=LOWER_UPPER);
       88    15334
       89    15335        %F$DCB;
       90    15392        %B$TCB (STCLASS="BASED(B$TCB$)");
       91    15395        %B$ALT;
       92    15403        %PARSE$OUT (NAME=P$B,STCLASS="BASED(BLK$)");
       93    15448        %PARSE$SYM (NAME=P$S,STCLASS="BASED(BLK$)");
       94    15486        %P_PCB (STCLASS=STATIC);
       95    15685
       96    15686        %XUG_GETCMD (NAME=XUG$GETCMD,STCLASS="BASED(XUG_GETCMD$)");
       97    16024    1   DCL XUG_GETCMD$ PTR;
       98    16025
       99    16026        %XUE_ENTRIES;
      100    16050        %XUR_INIT(ABORT=VMO$ABORT,MOREMEM=VMA$MOREMEM,PCB=P_PCB,PREPROCESS=YES,
      101    16051            COMMANDS=YES,INHIBIT_OUTPUT=YES);
      102    16150        /***** Partrge root nodes *****/
      103    16151    1   DCL MAIL_NODES PTR SYMREF;              /* Mail commands */
      104    16152    1   DCL SEND_CMD PTR SYMREF;                /* Mail address */
      105    16153    1   DCL MAIL_CMD PTR SYMREF;                /* Syntax for invoking mail from ibex */
      106    16154    1   DCL MODIFY_LIST PTR SYMREF;             /* Syntax for modify list subcommands */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:248  
      107    16155    1   DCL MODIFY_USER PTR SYMREF;             /* Syntax for modify user subcommands */
      108    16156        /*
      109    16157              Addresses of the nodes for the parser.  Ordinarily these will
      110    16158              have the values of the SYMDEFs above.  But with some imaginative
      111    16159              patching, these pointers can obtain values for user modified,
      112    16160              (foriegn language) nodes.   */
      113    16161    1   DCL   MAIL_NODES$    PTR;
      114    16162    1   DCL   SEND_CMD$      PTR;
      115    16163    1   DCL   MAIL_CMD$      PTR;
      116    16164    1   DCL   MODIFY_LIST$   PTR;
      117    16165    1   DCL   MODIFY_USER$   PTR;
      118    16166    1   DCL   VM_ADDRESS_SPEC$ PTR   STATIC   SYMDEF;/* VME$SUBR needs it */
      119    16167    1   DCL   ADDRESS_SPEC   PTR   SYMREF;
      120    16168
      121    16169    1   DCL   BSD            SBIN  BASED;
      122    16170        /*
      123    16171              The following DCL's are for allowing multiple parse nodes
      124    16172              in different languages.
      125    16173        */
      126    16174        %PARSE_NODES (NAME=VM_DEFAULT_NODES,
      127    16175                    STCLASS="CONSTANT SYMDEF",
      128    16176                    N0=MAIL_NODES,
      129    16177                    N1=MAIL_CMD,
      130    16178                    N2=MODIFY_LIST,
      131    16179                    N3=MODIFY_USER,
      132    16180                    N15=SEND_CMD,
      133    16181                    N26=ADDRESS_SPEC);
      134    16216        %NATL_PAIRS (NAME=VM_NATL_PAIRS,
      135    16217                    STCLASS="CONSTANT SYMDEF",
      136    16218                    NATL_CHARS="' '*0",
      137    16219                    NODES$="ADDR(VM_DEFAULT_NODES), ADDR(NIL)*0");
      138    16237        %PARSE_NODES(NAME=NODES_TO_USE,
      139    16238                    STCLASS="BASED(NODES$)");
      140    16273    1   DCL   NODES$      PTR;
      141    16274
      142    16275    1   dcl 1  VM_NODENAMES   constant symdef
      143    16276
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:249  
      144    16277                    %BUILD_NODENAMES( N=0, NAME=MAIL_NODES);
      145    16289                    %BUILD_NODENAMES( N=1, NAME=MAIL_CMD);
      146    16301                    %BUILD_NODENAMES( N=2, NAME=MODIFY_LIST);
      147    16313                    %BUILD_NODENAMES( N=3, NAME=MODIFY_USER);
      148    16325                    %BUILD_NODENAMES( N=15, NAME=SEND_CMD);
      149    16337                    %BUILD_NODENAMES( N=26, NAME=ADDRESS_SPEC);
      150    16349
      151    16350                    %BUILD_NODENAMES( DONE=YES );
      152    16362
      153    16363        %VLP_NAME( FPTN=VM_NODEFID, NAME='VM_NODES', STCLASS="CONSTANT SYMDEF");
      154    16390        /***** External routines *****/
      155    16391    1   DCL VMA$ADD_RENTRY_SORTED ENTRY(6) ALTRET;
      156    16392    1   DCL VMA$ADD_UENTRY_SORTED ENTRY(6) ALTRET;
      157    16393    1   DCL VMA$COMPRESS_BLANKS ENTRY(1);
      158    16394    1   DCL VMA$DEL_LIST ENTRY(3) ALTRET;
      159    16395    1   DCL VMA$DEL_RENTRY ENTRY(6) ALTRET;
      160    16396    1   DCL VMA$DEL_UENTRY ENTRY(6) ALTRET;
      161    16397    1   DCL VMA$ENLARGE_SEGMENT ENTRY(2) ALTRET;
      162    16398    1   DCL VMA$GET_SITE_NAME ENTRY(4) ALTRET;
      163    16399    1   DCL VMA$GET_NEXT_ENTRY ENTRY(4) ALTRET;
      164    16400    1   DCL VMA$GET_LIST ENTRY(3) ALTRET;
      165    16401
      166    16402    1   DCL VMA$GET_LIST_NEXT ENTRY(3) ALTRET;
      167    16403    1   DCL VMA$MOREMEM ENTRY(3) ALTRET;
      168    16404    1   DCL VMA$OPEN_FOLDER ENTRY(5) ALTRET;
      169    16405    1   DCL VMA$OPEN_GLOBAL ENTRY(1) ALTRET;
      170    16406    1   DCL VMA$PUT_LIST ENTRY(3) ALTRET;
      171    16407    1   DCL VMB$FIND_DEFAULT ENTRY(7) ALTRET;
      172    16408    1   DCL VMB$USE_SPECIFIED ENTRY(7) ALTRET;
      173    16409    1   DCL VMB$USE_DEFAULT ENTRY(7) ALTRET;
      174    16410    1   DCL VMD$DI_FOLDER ENTRY(2);
      175    16411    1   DCL VMB$USE_SAME ENTRY(7) ALTRET;
      176    16412    1   dcl VMB$TESTREG entry(1) altret;
      177    16413    1   DCL VMA$OPEN_SRCH_LIST ENTRY(1) ALTRET;
      178    16414    1   DCL VMA$SHRINK_SEGMENT ENTRY(2) ALTRET;
      179    16415    1   DCL VMA$OPEN_ENCL_SEGS ENTRY ALTRET;
      180    16416    1   DCL VMA$PUT_ADD_RECORD ENTRY(4) ALTRET;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:250  
      181    16417    1   DCL VMD$DI_HEADER ENTRY(3);
      182    16418    1   DCL VMD$DI_LIST ENTRY(4);
      183    16419    1   DCL VMD$DI_MESSAGE ENTRY(6) ALTRET;
      184    16420    1   DCL VMD$DI_PROFILE ENTRY(1);
      185    16421    1   DCL VMD$DI_USER ENTRY(2);
      186    16422    1   DCL VMD$DEL_HEADER ENTRY(2) ALTRET;
      187    16423    1   DCL VMD$EJECT ENTRY(1) ALTRET;
      188    16424        %INIT_STR(DODCL=YES);
      189    16447    1   DCL  VMD$GETNODES            ENTRY(4);
      190    16448    1   DCL VMD$GET_HEADER ENTRY(2) ALTRET;
      191    16449    1   DCL VMD$GET_HEADER_NEXT ENTRY(2) ALTRET;
      192    16450    1   DCL VMD$GET_HEADER_PREV ENTRY(2) ALTRET;
      193    16451    1   DCL VMD$PUT_HEADER ENTRY(2) ALTRET;
      194    16452    1   DCL VMD$GET_PROFILE ENTRY(1) ALTRET;
      195    16453    1   DCL VMD$PUT_PROFILE ENTRY(1) ALTRET;
      196    16454    1   DCL VMD$GET_ENCL ENTRY (9) ALTRET;
      197    16455    1   DCL VMD$PUT_ENCL ENTRY (9) ALTRET;
      198    16456    1   DCL VMD$DEL_ENCL ENTRY (9) ALTRET;
      199    16457    1   DCL VMD$PUT_ID ENTRY (3) ALTRET;
      200    16458    1   DCL VMD$WRITE_BUF ENTRY(1);             /* Takes place of X$FORMAT */
      201    16459    1   DCL VME$ACKNOWLEDGE ENTRY(3) ALTRET;
      202    16460    1   DCL VME$ANSWER ENTRY(3) ALTRET;
      203    16461    1   DCL VMF$FROM ENTRY(1) ALTRET;
      204    16462    1   DCL VMF$MAKE_ADDRESS1 ENTRY(2);
      205    16463    1   dcl VMF$MAKE_ADDRESS1PASS entry(2);   /** Adds password if present **/
      206    16464    1   DCL VMM$COPY_MESSAGE ENTRY(6) ALTRET;
      207    16465    1   DCL VMM$DELETE_MESSAGE ENTRY(2) ALTRET;
      208    16466    1   DCL VMM$COMBINE_MESSAGE ENTRY (3) ALTRET;
      209    16467    1   DCL VMM$EDIT_MESSAGE_OUT ENTRY (5) ALTRET;
      210    16468    1   DCL VMO$XCON ENTRY ASYNC;
      211    16469    1   DCL VMO$ABORT ENTRY;
      212    16470    1   DCL VMS$FMT_SELECT ENTRY(2);
      213    16471    1   DCL VMS$SELECT ENTRY(3) ALTRET;
      214    16472    1   DCL VMS$MOVE_SELECT ENTRY(3) ALTRET;
      215    16473    1   DCL VMA$GET_ADD_RECORD ENTRY(4) ALTRET;
      216    16474    1   DCL X$WILDCMP ENTRY(1) ALTRET;
      217    16475    1   DCL VMX$OCTBIN ENTRY(2);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:251  
      218    16476    1   DCL X$ALLOCATE ENTRY(1) ALTRET;
      219    16477    1   DCL X$DEALLOCATE ENTRY(1) ALTRET;
      220    16478    1   DCL X$HELP ENTRY(1) ALTRET;
      221    16479        /***** Symdef data *****/
      222    16480    1   DCL VMO_REMEMBER REMEMBER STATIC SYMDEF;
      223    16481    1   DCL CURRENT_MESSAGE_NUMBER SBIN WORD STATIC SYMDEF INIT(0);
      224    16482    1   DCL NEED_TITLE_BAR BIT (1) SYMREF;
      225    16483        /***** Character data *****/
      226    16484
      227    16485    1   DCL KEY_VALUE CHAR(8) CALIGNED;
      228    16486    1   DCL WILDCARD_PATTERN CHAR(%SIZ_FOLDER);
      229    16487    1   DCL CURRENT_LINE CHAR (P_PCB.NCHARS) CALIGNED BASED (P_PCB.TEXT$);
      230    16488        %VLP_NAME (FPTN=LINK_CCBUF,LEN=256,STCLASS=STATIC);
      231    16515
      232    16516        %VLP_NAME (FPTN=WORK_STRING,LEN=511,STCLASS=STATIC);
      233    16543    1   DCL B_VERSION CHAR(1) SYMREF;           /* Mail version */
      234    16544    1   DCL 1 B$VERSION BASED,
      235    16545    1         2 L# UBIN BYTE CALIGNED,
      236    16546    1         2 NAME# CHAR(B$VERSION.L#) CALIGNED;
      237    16547        /***** Ptrs *****/
      238    16548    1   DCL OUT$ PTR;
      239    16549        %VLP_ERRCODE (FPTN=OUTERR,STCLASS="REDEF OUT$");
      240    16594    1   DCL BLK$ PTR AUTO;
      241    16595    1   DCL PTR1$ PTR AUTO;
      242    16596    1   DCL PTR2$ PTR AUTO;
      243    16597    1   DCL PTR3$ PTR AUTO;
      244    16598    1   DCL PTR4$ PTR AUTO;
      245    16599        %POINTER (NAME=PTR4R$,STCLASS="REDEF PTR4$");
      246    16604    1   DCL PTR5$ PTR AUTO;
      247    16605    1   DCL ENCL$ PTR;
      248    16606    1   DCL PAGESIZE SBIN WORD STATIC INIT(4096);
      249    16607        /***** Index counters *****/
      250    16608    1   DCL INDX1 SBIN WORD AUTO;
      251    16609    1   DCL INDX2 SBIN WORD STATIC SYMDEF;
      252    16610    1   DCL INDX3 SBIN WORD AUTO;
      253    16611    1   DCL INDX4 SBIN WORD AUTO;
      254    16612        /***** Other variables *****/
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:252  
      255    16613    1   DCL WORK_UTS UBIN WORD STATIC;
      256    16614    1   DCL NEW_FLAG BIT(1) STATIC INIT('0'B);
      257    16615    1   DCL BREAK_TYPE UBIN WORD STATIC SYMDEF INIT(0);
      258    16616    1   DCL DCB# UBIN WORD STATIC;
      259    16617    1   DCL OUTDCB UBIN WORD STATIC INIT(DCBNUM(M$LO));
      260    16618    1   DCL M$OUT_NUM UBIN WORD CONSTANT SYMDEF INIT(DCBNUM(M$OUT));
      261    16619    1   DCL SELECT_CURRENT BIT(1) STATIC;       /* Special select mode bit */
      262    16620    1   DCL FOLDER_WAS_OPEN BIT(1) STATIC SYMDEF;
      263    16621    1   DCL REOPENED_FOLDER BIT(1) STATIC;      /* For bad use recovery */
      264    16622    1   DCL COMBINED BIT (1);
      265    16623    1   DCL NONE BIT (1);
      266    16624    1   DCL MADE_OLD BIT(1);
      267    16625    1   DCL WILD BIT(1);
      268    16626        /***** Variables for list and user definitions *****/
      269    16627        %VLP_ACCT (FPTN=ADDRESS_ACCT,STCLASS=AUTO);
      270    16640        %VLP_ACCT (FPTN=ADDRESS_LACCN,STCLASS=AUTO);
      271    16653    1   DCL ADDRESS_LUNAME CHAR(12) AUTO;       /* Same size as B$JIT.UNAME */
      272    16654        %VLP_NAME (FPTN=ADDRESS_NAME,LEN=511,STCLASS=AUTO);
      273    16681        %VLP_PASS (FPTN=ADDRESS_PASS,STCLASS=AUTO);
      274    16694    1   DCL ADDRESS_FOLDER CHAR(%SIZ_FOLDER) AUTO;
      275    16695    1   DCL ADDRESS_SITENAME CHAR(%SIZ_SITENAME) AUTO;
      276    16696    1   DCL DOMAIN$ PTR;
      277    16697    1   DCL MAIL_PROMPT (0:2) CHAR STATIC INIT (BITASC('100000010'B),'p','>');
      278    16698        %VLP_NAME (FPTN=VM_MODIFY_LIST_PROMPT, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      279    16725        %VLP_ERRCODE (FPTN=E_MODIFY_LIST_PROMPT, STCLASS="CONSTANT SYMDEF",
      280    16726                    ERR#=%E$MODIFY_LIST_PROMPT,          FCG=VM,MID=O);
      281    16771        /*E*  ERROR: VMO-E$MODIFY_LIST_PROMPT-0
      282    16772              MESSAGE:pList>
      283    16773        */
      284    16774             %VLP_NAME (FPTN=VM_MODIFY_USER_PROMPT, LEN=15, L=15, NAME=' ', STCLASS=STATIC)
             16774                  ;
      285    16801        %VLP_ERRCODE (FPTN=E_MODIFY_USER_PROMPT, STCLASS="CONSTANT SYMDEF",
      286    16802                    ERR#=%E$MODIFY_USER_PROMPT,          FCG=VM,MID=O);
      287    16847        /*E*  ERROR: VMO-E$MODIFY_USER_PROMPT-0
      288    16848              MESSAGE:pUser>
      289    16849        */
      290    16850    1   DCL EXIT_MAIL# BIT(1) STATIC INIT(%NO#); /* End spec. on invocation */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:253  
      291    16851    1   DCL EXIT_MAIL_PEND# BIT(1) STATIC INIT(%NO#); /* allows read as setup command */
      292    16852    1   DCL PRINT_HEADER# BIT(1) STATIC;        /* Header spec. in profile? */
      293    16853    1   DCL OUTBUF CHAR(300) STATIC ;           /* Used as an output buffer */
      294    16854    1   DCL TEMPBUF CHAR(%SIZ_LISTNAME) AUTO;   /* Same size as VM_LISTKEY.TEXT */
      295    16855    1   DCL SIZE UBIN WORD STATIC INIT(0);
      296    16856    1   DCL EJECT BIT (1);
      297    16857    1   DCL ANSI_TIME CHAR (8) STATIC;
      298    16858    1   DCL ANSI_DATE CHAR (6) STATIC;
      299    16859    1   DCL ID CHAR (511);
      300    16860    1   DCL COUNT SBIN;
      301    16861    1   DCL INDX1_CHARS CHAR(INDX1) BASED;
      302    16862        /***** Command processing variables *****/
      303    16863        %VLP_NAME (FPTN=NEXT_COMMAND_TEXT,LEN=511,STCLASS=AUTO);
      304    16890    1   DCL NEXT_COMMAND_ECHO# BIT(1) STATIC INIT(%NO#); /* Echo NEXT_COMMAND? */
      305    16891    1   DCL CURR_COMMAND_CODE UBIN WORD STATIC INIT(0); /* Current command */
      306    16892    1   DCL LAST_COMMAND_CODE UBIN WORD STATIC INIT(%CMD_LIST_MESSAGE);
      307    16893    1   DCL M$CMNDF_NUM UBIN WORD STATIC INIT(DCBNUM(M$CMNDF));
      308    16894
      309    16895
      310    16896        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:254  
      311    16897        /*
      312    16898             ***** Macros that define mail structures ...
      313    16899        */
      314    16900        %VM_KEYTYPES;
      315    16921
      316    16922        %VM_ADDTYPES;
      317    16926
      318    16927        %VM_PROFILE;
      319    17014
      320    17015        %VM_PROFILE (NAME=CVM_PROFILE,STCLASS=CONSTANT);
      321    17102
      322    17103        %VM_HEADER;
      323    17232
      324    17233        %VM_INFOKEY (NAME=VM_HEADKEY,TYP=%VM_TYPE_HEAD);
      325    17250
      326    17251        %VM_INFOKEY;
      327    17268
      328    17269        %VM_BODYKEY;
      329    17289
      330    17290        %VM_LISTKEY;
      331    17306
      332    17307        %VM_LISTKEY (NAME=VM_LISTKEY2);
      333    17323
      334    17324        %VM_USERKEY;
      335    17340
      336    17341        %VM_USERKEY (NAME=VM_USERKEY2);
      337    17357
      338    17358        %VM_ADD_HEAD;
      339    17387
      340    17388        %VM_RADDRESS (NAME=VM$RADDRESS,STCLASS=BASED);
      341    17423
      342    17424        %VM_UADDRESS (NAME=VM$UADDRESS,STCLASS=BASED);
      343    17461
      344    17462        %VM_ID (NAME=VM_ID, STCLASS="BASED(VM_HEADER$)");
      345    17475
      346    17476        %VM_BODYTYPES;
      347    17482
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:255  
      348    17483
      349    17484        %VM_ADD_HEAD (NAME=VM_ENCL_HEAD,STCLASS="BASED(VM_ENCLLIST$)");
      350    17513
      351    17514        %VM_ENCLOS (STCLASS="BASED(ENCL$)");
      352    17545
      353    17546        %VM_BODYREC (NAME=VM_ENCLREC,VARYLEN=YES,STCLASS="BASED(VM_ENCLREC$)",TYP=
             17546            %VM_BODY_BINARY_ENCL);
      354    17578
      355    17579        %SET LISTMAC = '0'B;
      356    17580        %SET LISTSUB = '0'B;
      357    17581        %VM_RADDRESS (NAME=VM_RADDRESS,STCLASS=AUTO);
      358    17616
      359    17617        %VM_UADDRESS (NAME=VM_UADDRESS,STCLASS=AUTO);
      360    17654        %SET LISTMAC = '1'B;
      361    17655        %SET LISTSUB = '1'B;
      362    17656
      363    17657        %VM_CGBUFFER (STCLASS="STATIC SYMDEF");
             17658        %LSET LISTDIR='0'B;
             17667    1   DCL 1 VM_CGBUFFER STATIC SYMDEF,
             17668    1         2 STATION# CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17669    1         2 COMMAND SBIN WORD CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17670    1         2 FOLDER,
             17671    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17672    1           3 TEXT CHAR(25) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17673    1         2 * SBIN HALF CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17674    1         2 ACCT CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17675    1         2 * CHAR(24) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17676    1         2 FILE_NAME,
             17677    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17678    1           3 TEXT CHAR(31) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17679    1         2 ERROR ,
             17680                      /* Error code returned by MAILMAN */
             17681    1           3 FCG BIT(12) UNAL,
             17682    1           3 MID BIT(6) UNAL,
             17683    1           3 MON BIT(1) UNAL,
             17684    1           3 ERR# UBIN(14) UNAL,
             17685    1           3 SEV UBIN(3) UNAL,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:256  
             17686    1         2 * CHAR(36) CALIGNED %INIT(' ')%CHARTEXT('/**/');
      364    17688
      365    17689                                           /* Information on the users central folder */
      366    17690        %VM_FOLDER_INFO (NAME=VM_CENTRAL_FOLDER);
             17691        %LSET LISTDIR='0'B;
             17700    1   DCL 1 VM_CENTRAL_FOLDER STATIC,
             17701    1         2 PSID CHAR(6) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17702                          /* Packset on which this folder resides */
             17703    1         2 ACCT CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17704                            /* Account where this folder resides */
             17705    1         2 FOLDER CHAR(25) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17706                            /* Name of this folder */
             17707    1         2 PASS CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17708                            /* Password (if any) of this folder */
             17709    1         2 SITENAME CHAR(8) %INIT(' ')%CHARTEXT('/**/'),
             17710                            /* Site where this folder exists */
             17711    1         2 TIME,
             17712                            /* Various times of interest */
             17713    1           3 ACCESS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17714                            /* Time that this file was last accessed */
             17715    1           3 CREATION UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17716                            /* Time that this file was created */
             17717    1           3 MODIFY UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17718                            /* Time that this file was last modified */
             17719    1         2 NRECS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17720                            /* Number of records in this file */
             17721    1         2 UGRANS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17722                            /* Number of granules currently in use */
             17723    1         2 FLAGS,
             17724    1           3 UPDATE BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17725                            /* May the user UPDATE or just READ this folder */
             17726    1           3 OWNER BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17727                            /* Is current user OWNER of this folder? */
             17728    1           3 ACCT_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17729                            /* Was a account specified in the address? */
             17730    1           3 FOLDER_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17731                            /* Was a folder specified in the address? */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:257  
             17732    1           3 SITENAME_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17733                            /* Was a sitename specified in the address? */
             17734    1           3 OPEN BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17735                            /* Has this folder been opened? */
             17736    1           3 RESERVED BIT(30) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17737    1         2 USER_NAME,
             17738                            /* Name that got us to this folder */
             17739    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17740    1           3 TEXT CHAR(200) CALIGNED %INIT(' ')%CHARTEXT('/**/');
      367    17742                                 /* Information on the folder currently being used */
      368    17743        %VM_FOLDER_INFO (NAME=VM_CURRENT_FOLDER,STCLASS="STATIC SYMDEF");
             17744        %LSET LISTDIR='0'B;
             17753    1   DCL 1 VM_CURRENT_FOLDER STATIC SYMDEF,
             17754    1         2 PSID CHAR(6) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17755                          /* Packset on which this folder resides */
             17756    1         2 ACCT CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17757                            /* Account where this folder resides */
             17758    1         2 FOLDER CHAR(25) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17759                            /* Name of this folder */
             17760    1         2 PASS CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17761                            /* Password (if any) of this folder */
             17762    1         2 SITENAME CHAR(8) %INIT(' ')%CHARTEXT('/**/'),
             17763                            /* Site where this folder exists */
             17764    1         2 TIME,
             17765                            /* Various times of interest */
             17766    1           3 ACCESS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17767                            /* Time that this file was last accessed */
             17768    1           3 CREATION UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17769                            /* Time that this file was created */
             17770    1           3 MODIFY UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17771                            /* Time that this file was last modified */
             17772    1         2 NRECS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17773                            /* Number of records in this file */
             17774    1         2 UGRANS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17775                            /* Number of granules currently in use */
             17776    1         2 FLAGS,
             17777    1           3 UPDATE BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:258  
             17778                            /* May the user UPDATE or just READ this folder */
             17779    1           3 OWNER BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17780                            /* Is current user OWNER of this folder? */
             17781    1           3 ACCT_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17782                            /* Was a account specified in the address? */
             17783    1           3 FOLDER_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17784                            /* Was a folder specified in the address? */
             17785    1           3 SITENAME_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17786                            /* Was a sitename specified in the address? */
             17787    1           3 OPEN BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17788                            /* Has this folder been opened? */
             17789    1           3 RESERVED BIT(30) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17790    1         2 USER_NAME,
             17791                            /* Name that got us to this folder */
             17792    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17793    1           3 TEXT CHAR(200) CALIGNED %INIT(' ')%CHARTEXT('/**/');
      369    17795        %VM_FOLDER_INFO (NAME=VM_CURRENT_FOLDER_SAVE,STCLASS=STATIC);
             17796        %LSET LISTDIR='0'B;
             17805    1   DCL 1 VM_CURRENT_FOLDER_SAVE STATIC,
             17806    1         2 PSID CHAR(6) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17807                          /* Packset on which this folder resides */
             17808    1         2 ACCT CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17809                            /* Account where this folder resides */
             17810    1         2 FOLDER CHAR(25) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17811                            /* Name of this folder */
             17812    1         2 PASS CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17813                            /* Password (if any) of this folder */
             17814    1         2 SITENAME CHAR(8) %INIT(' ')%CHARTEXT('/**/'),
             17815                            /* Site where this folder exists */
             17816    1         2 TIME,
             17817                            /* Various times of interest */
             17818    1           3 ACCESS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17819                            /* Time that this file was last accessed */
             17820    1           3 CREATION UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17821                            /* Time that this file was created */
             17822    1           3 MODIFY UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17823                            /* Time that this file was last modified */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:259  
             17824    1         2 NRECS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17825                            /* Number of records in this file */
             17826    1         2 UGRANS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17827                            /* Number of granules currently in use */
             17828    1         2 FLAGS,
             17829    1           3 UPDATE BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17830                            /* May the user UPDATE or just READ this folder */
             17831    1           3 OWNER BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17832                            /* Is current user OWNER of this folder? */
             17833    1           3 ACCT_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17834                            /* Was a account specified in the address? */
             17835    1           3 FOLDER_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17836                            /* Was a folder specified in the address? */
             17837    1           3 SITENAME_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17838                            /* Was a sitename specified in the address? */
             17839    1           3 OPEN BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17840                            /* Has this folder been opened? */
             17841    1           3 RESERVED BIT(30) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17842    1         2 USER_NAME,
             17843                            /* Name that got us to this folder */
             17844    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17845    1           3 TEXT CHAR(200) CALIGNED %INIT(' ')%CHARTEXT('/**/');
      370    17847
      371    17848                                           /* Information on folders temporarily open */
      372    17849        %VM_FOLDER_INFO (NAME=VM_WORK_FOLDER,STCLASS="STATIC SYMDEF");
             17850        %LSET LISTDIR='0'B;
             17859    1   DCL 1 VM_WORK_FOLDER STATIC SYMDEF,
             17860    1         2 PSID CHAR(6) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17861                          /* Packset on which this folder resides */
             17862    1         2 ACCT CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17863                            /* Account where this folder resides */
             17864    1         2 FOLDER CHAR(25) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17865                            /* Name of this folder */
             17866    1         2 PASS CHAR(8) CALIGNED %INIT(' ')%CHARTEXT('/**/'),
             17867                            /* Password (if any) of this folder */
             17868    1         2 SITENAME CHAR(8) %INIT(' ')%CHARTEXT('/**/'),
             17869                            /* Site where this folder exists */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:260  
             17870    1         2 TIME,
             17871                            /* Various times of interest */
             17872    1           3 ACCESS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17873                            /* Time that this file was last accessed */
             17874    1           3 CREATION UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17875                            /* Time that this file was created */
             17876    1           3 MODIFY UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17877                            /* Time that this file was last modified */
             17878    1         2 NRECS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17879                            /* Number of records in this file */
             17880    1         2 UGRANS UBIN WORD %INIT(0)%CHARTEXT('/**/'),
             17881                            /* Number of granules currently in use */
             17882    1         2 FLAGS,
             17883    1           3 UPDATE BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17884                            /* May the user UPDATE or just READ this folder */
             17885    1           3 OWNER BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17886                            /* Is current user OWNER of this folder? */
             17887    1           3 ACCT_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17888                            /* Was a account specified in the address? */
             17889    1           3 FOLDER_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17890                            /* Was a folder specified in the address? */
             17891    1           3 SITENAME_SPEC BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17892                            /* Was a sitename specified in the address? */
             17893    1           3 OPEN BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17894                            /* Has this folder been opened? */
             17895    1           3 RESERVED BIT(30) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17896    1         2 USER_NAME,
             17897                            /* Name that got us to this folder */
             17898    1           3 COUNT UBIN BYTE CALIGNED %INIT(0)%CHARTEXT('/**/'),
             17899    1           3 TEXT CHAR(200) CALIGNED %INIT(' ')%CHARTEXT('/**/');
      373    17901
      374    17902                            /* Search list info describing how to resolve addresses */
      375    17903        %VM_SEARCH_INFO  (STCLASS=STATIC);
             17904        %LSET LISTDIR='0'B;
             17913    1   DCL 1 VM_SEARCH_INFO STATIC,
             17914    1         2 NUM_ENTRIES UBIN WORD,
             17915                            /* Number of folders to be searched */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:261  
             17916    1         2 DCB# (0:10) UBIN WORD %INIT(0*11)%CHARTEXT('/**/'),
             17917                            /* Number of dcb which points to folder to search */
             17918    1         2 MAP(0:10) UBIN WORD %INIT(0*11)%CHARTEXT('/**/'),
             17919                           /* Maps entry numbers to SEARCH_LIST$ in profile */
             17920    1         2 GETDCB#(0:10) UBIN WORD %INIT(0*11)%CHARTEXT('/**/'),
             17921                            /* DCB number for this slot (via get dcb) */
             17922    1         2 ACTIVE BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17923                            /* All files are open */
             17924    1         2 GLOBAL BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17925                            /* Global folder exists */
             17926    1         2 CURRENT BIT(1) UNAL %INIT('0'B)%CHARTEXT('/**/'),
             17927                            /* Local folder exists */
             17928    1         2 * BIT(33) UNAL;
      376    17930
      377    17931                                                /* Wild card matching info */
      378    17932        %XUW_WILDCARD (FPTN=VM_WILDCARD,STCLASS=STATIC);
             17933        %LSET LISTDIR='0'B;
             17994    1   DCL 1 VM_WILDCARD STATIC DALIGNED,
             17995    1         2 PATTERN_ ALIGNED,
             17996    1           3 BOUND SBIN(20) UNAL INIT(SIZEV(NIL))/**/,
             17997    1           3 * BIT(12) INIT('7772'O)/**/,
             17998    1           3 * BIT(4) INIT('0'B)/**/,
             17999    1           3 PATTERN$ PTR INIT(ADDR(NIL))/**/,
             18000    1         2 INPUT_ ALIGNED,
             18001    1           3 BOUND SBIN(20) UNAL INIT(SIZEV(NIL))/**/,
             18002    1           3 * BIT(12) INIT('7772'O)/**/,
             18003    1           3 * BIT(4) INIT('0'B)/**/,
             18004    1           3 INPUT$ PTR INIT(ADDR(NIL))/**/,
             18005    1         2 TEMPLATE_ ALIGNED,
             18006    1           3 BOUND SBIN(20) UNAL INIT(SIZEV(NIL))/**/,
             18007    1           3 * BIT(12) INIT('7772'O)/**/,
             18008    1           3 * BIT(4) INIT('0'B)/**/,
             18009    1           3 TEMPLATE$ PTR INIT(ADDR(NIL))/**/,
             18010    1         2 OUTPUT_ ALIGNED,
             18011    1           3 BOUND SBIN(20) UNAL INIT(SIZEV(NIL))/**/,
             18012    1           3 * BIT(12) INIT('7772'O)/**/,
             18013    1           3 * BIT(4) INIT('0'B)/**/,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:262  
             18014    1           3 OUTPUT$ PTR INIT(ADDR(NIL))/**/,
             18015    1         2 ERROR ALIGNED,
             18016    1           3 FCG BIT(12) UNAL INIT('0'O)/**/,
             18017    1           3 MID BIT(6) UNAL INIT('0'O)/**/,
             18018    1           3 MON BIT(1) UNAL INIT('0'B)/**/,
             18019    1           3 ERR# UBIN(14) UNAL INIT(0)/**/,
             18020    1           3 SEV UBIN(3) UNAL INIT(0)/**/,
             18021    1         2 WILD_CHAR# CALIGNED CHAR(1) INIT('?')/**/,
             18022    1         2 CONTAINS# BIT(1) UNAL INIT('0'B)/**/,
             18023    1         2 * BIT(8) UNAL INIT('0'B)/**/,
             18024    1         2 * BIT(18) UNAL INIT('0'B)/**/,
             18025    1         2 OUTPUT_LEN UBIN WORD ALIGNED INIT(0)/**/,
             18026    1         2 * BIT(36) ALIGNED INIT('0'B)/**/;
      379    18028        %SET LISTMAC = '0'B;
      380    18029        %SET LISTSUB = '0'B;
      381    18030        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:263  
      382    18031        /***** Selection context information *****/
      383    18032        %SET LISTMAC='1'B;
      384    18033        %SET LISTSUB='1'B;
      385    18034        %VM_CONTEXT (NAME=VM$CONTEXT,STCLASS=BASED);
             18035        %LSET LISTDIR='0'B;
             18044    1   DCL 1 VM$CONTEXT BASED,
             18045    1         2 MESSAGE_POINTER SBIN WORD,
             18046                               /* Number of message currently being processed */
             18047    1         2 TRUTH_TREE$ PTR,
             18048                               /* Ptr to parse tree that contains TRUTH EXPRESSION */
             18049    1         2 NUM_ENTRIES UBIN WORD,
             18050                               /* Number of entries in the MESSAGE SET */
             18051    1         2 SET_INDX SBIN WORD,
             18052                               /* Which MESSAGE SET range is currently active? */
             18053    1         2 FLAGS,
             18054    1           3 INVERSE BIT(1) UNAL,
             18055                               /* Backwards? YES/NO. Default=NO */
             18056    1           3 NEXT BIT(1) UNAL,
             18057                               /* Pickup the NEXT message only */
             18058    1           3 PREV BIT(1) UNAL,
             18059                               /* Pickup the PREVIOUS message only */
             18060    1           3 RESERVED BIT(33) UNAL,
             18061    1         2 MESSAGE_SET (0:0),
             18062    1           3 LOW SBIN WORD,
             18063                               /* Low number in the range specification */
             18064    1           3 HIGH SBIN WORD;
             18065                               /* High number in the range specification */
      386    18067        %VM_SELECT (STCLASS=STATIC);
             18068        %LSET LISTDIR='0'B;
             18077    1   DCL 1 VM_SELECT STATIC,
             18078    1         2 ERROR,
             18079    1           3 FCG BIT(12) UNAL,
             18080    1           3 MID BIT(6) UNAL,
             18081    1           3 MON BIT(1) UNAL,
             18082    1           3 ERR# UBIN (14) UNAL,
             18083    1           3 SEV UBIN(3) UNAL,
             18084                               /* Error code returned from VMS$SELECT. */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:264  
             18085    1         2 ERR_POS# UBIN WORD;
             18086                               /* Position where the error was found. */
      387    18088        %SET LISTMAC='0'B;
      388    18089        %SET LISTSUB='0'B;
      389    18090        %XUM$MCB (NAME=X$MCB,STCLASS=STATIC);
      390    18094    1   DCL CONTEXT_PTR$ (0:3) PTR STATIC;
      391    18095    1   DCL WHICH_CONTEXT UBIN WORD STATIC;
      392    18096        /* Which context is currently active? */
      393    18097          %EQU CONTEXT_CURRENT = 0;             /* The current context */
      394    18098          %EQU CONTEXT_SELECTED = 1;            /* The selected context */
      395    18099        /* Useful subs */
      396    18100          %SUB CURRENT_CONTEXT = "CONTEXT_PTR$(%CONTEXT_CURRENT)->VM$CONTEXT";
      397    18101          %SUB SELECTED_CONTEXT = "CONTEXT_PTR$(%CONTEXT_SELECTED)->VM$CONTEXT";
      398    18102    1   DCL NUM_MESSAGES_PROCESSED UBIN WORD;
      399    18103        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:265  
      400    18104        /*
      401    18105             ***** The following declarations define variables
      402    18106                   that contain option values as set up by the
      403    18107                   INIT$SELECT_OPTS and other routines ...
      404    18108        */
      405    18109
      406    18110    1   DCL TEMP SBIN WORD;
      407    18111    1   DCL OPT_SITE CHAR(8);
      408    18112    1   DCL OPT_BYPASS BIT(1);
      409    18113    1   DCL OPT_NOUPDATE BIT(1);
      410    18114    1   DCL OPT_RECEIVERS BIT(1);
      411    18115    1   DCL OPT_FID CHAR(64) STATIC;
      412    18116    1   DCL OPT_EXIT BIT (1);
      413    18117    1   DCL OPT_QUIT BIT(1);
      414    18118    1   DCL OPT_SEED UBIN WORD STATIC;
      415    18119    1   DCL OPT_SEED$ PTR;
      416    18120    1   DCL OPT$SEED UBIN BASED(OPT_SEED$);
      417    18121
      418    18122        /***** Fpts *****/
      419    18123        %FPT_WAIT (FPTN=WAIT30, UNITS=30, STCLASS=CONSTANT);
      420    18137        %FPT_TIME  (FPTN=GET_ANSI_TIME,
      421    18138                    STCLASS=CONSTANT,
      422    18139                    SOURCE=UTS,
      423    18140                    DEST=ANS,
      424    18141                    TSTAMP=WORK_UTS,
      425    18142                    TIME=ANSI_TIME,
      426    18143                    DATE=ANSI_DATE);
      427    18162        %FPT_ENQ (FPTN=ENQ_PROFILE, STCLASS=STATIC,
      428    18163                  SHARE=NONE,
      429    18164                  WAIT=YES,
      430    18165                  RNAME=VM_PRORES);
      431    18183        %FPT_DEQ (FPTN=DEQ_PROFILE, STCLASS=STATIC,
      432    18184                  RNAME=VM_PRORES);
      433    18201        %VM_PRORES;
      434    18215        %VM_PRORES (NAME=VM_FILERES,RES='FILE');
      435    18229        %FPT_ENQ (FPTN=FILE_SHARE, STCLASS=CONSTANT,
      436    18230                  SHARE=ALL,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:266  
      437    18231                  DCB=M$MAIL_FILE,
      438    18232                  WAIT=YES,
      439    18233                  WAIT_TIME=0,
      440    18234                  RNAME=VM_FILERES);
      441    18252        %FPT_ENQ (FPTN=FILE_NONE, STCLASS=CONSTANT,
      442    18253                  SHARE=NONE,
      443    18254                  DCB=M$MAIL_FILE,
      444    18255                  WAIT=YES,
      445    18256                  WAIT_TIME=0,
      446    18257                  RNAME=VM_FILERES);
      447    18275        %VM_HEADRES;
      448    18289        %FPT_ENQ (FPTN=ENQ_HEAD, STCLASS=CONSTANT,
      449    18290                  DCB=M$MAIL_FILE,
      450    18291                  RNAME=VM_HEADRES,
      451    18292                  WAIT_TIME=0,
      452    18293                  SHARE=ALL);
      453    18311        %FPT_DEQ (FPTN=DEQ_HEAD, STCLASS=CONSTANT,
      454    18312                  DCB=M$MAIL_FILE,
      455    18313                  RNAME=VM_HEADRES);
      456    18330
      457    18331        %FPT_YC (FPTN=RESET_#1,
      458    18332                 CMD=RESET_#1_CMD,
      459    18333                 ECHO=NO,
      460    18334                 NOERR=YES);
      461    18351
      462    18352    1   DCL RESET_#1_CMD CHAR(0) CONSTANT INIT('!RESET #1');
      463    18353
      464    18354        %FPT_YC (FPTN=RESET_#2,
      465    18355                 CMD=RESET_#2_CMD,
      466    18356                 ECHO=NO,
      467    18357                 NOERR=YES);
      468    18374
      469    18375    1   DCL RESET_#2_CMD CHAR(0) CONSTANT INIT('!RESET #2');
      470    18376
      471    18377        %FPT_YC (FPTN=RESET_#3,
      472    18378                 CMD=RESET_#3_CMD,
      473    18379                 ECHO=NO,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:267  
      474    18380                 NOERR=YES);
      475    18397
      476    18398    1   DCL RESET_#3_CMD CHAR(0) CONSTANT INIT('!RESET #3');
      477    18399
      478    18400        %FPT_YC (FPTN=RESET_#4,
      479    18401                 CMD=RESET_#4_CMD,
      480    18402                 ECHO=NO,
      481    18403                 NOERR=YES);
      482    18420
      483    18421    1   DCL RESET_#4_CMD CHAR(0) CONSTANT INIT('!RESET #4');
      484    18422
      485    18423        %XUH_PARAM (NAME=HELP_PARAM,
      486    18424                       PROCACCT=SYSACCT,
      487    18425                       PROCNAME=MAIL_PROG_NAME,
      488    18426                       OUTDCB1=M$ME);
      489    18487
      490    18488              %VLP_NAME (FPTN=MAIL_PROG_NAME,
      491    18489              NAME='MAIL');
      492    18516
      493    18517
      494    18518        %FPT_INT     (UENTRY=XUR$BREAK);
      495    18532
      496    18533        %FPT_XCON (FPTN=SET_XCON,UENTRY=VMO$XCON);
      497    18547
      498    18548        %FPT_CLOSE (FPTN=CLOSE_SAVE,
      499    18549                    DISP=SAVE);
      500    18591        %FPT_CLOSE (FPTN=CLOSE_SCRATCH,
      501    18592                    DISP=SCRATCH);
      502    18634
      503    18635        %VLP_ERRCODE (FPTN=ERROR);
      504    18680
      505    18681              %VLP_NAME (FPTN=FID_NAME);
      506    18708
      507    18709        %VLP_ACCT (FPTN=FID_ACCT);
      508    18722
      509    18723        %VLP_PASS (FPTN=FID_PASS);
      510    18736
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:268  
      511    18737        %VLP_SN (FPTN=FID_SN);
      512    18750
      513    18751        %VLP_WSN (FPTN=FID_WSN);
      514    18764
      515    18765    1   DCL FID_ASN UBIN(9) STATIC;
      516    18766
      517    18767    1   DCL FID_RES CHAR(4) STATIC;
      518    18768
      519    18769        %VLR_FID (FPTN=FID_RESULTS,STCLASS=STATIC);
      520    18788
      521    18789        %FPT_FID  (FPTN=CHECK_FID,              /* Used to check a fid */
      522    18790                       RESULTS=FID_RESULTS,
      523    18791                       ACCT=FID_ACCT,
      524    18792                       ASN=FID_ASN,
      525    18793                       NAME=FID_NAME,
      526    18794                       PASS=FID_PASS,
      527    18795                       RES=FID_RES,
      528    18796                       TEXTFID=OPT_FID,
      529    18797                       SN=FID_SN,
      530    18798                       WSN=FID_WSN);
      531    18821
      532    18822        %FPT_OPEN (FPTN=OPEN_NEXT,
      533    18823                       ACCT=FID_ACCT,
      534    18824                       PASS=FID_PASS,
      535    18825                       ASN=FILE,
      536    18826                       DCB=M$WORK,
      537    18827                       FUN=IN,
      538    18828                       NXTF=YES,
      539    18829                       SHARE=NONE,
      540    18830                       TEST=YES);
      541    18939        /***** Name map fpts *****/
      542    18940        %FPT_OPEN (FPTN=OPEN_NAME_MAP,
      543    18941                        ACCT=VM_MAIL_ACCT,
      544    18942                        ACS=DIRECT,
      545    18943                        ASN=FILE,
      546    18944                        CTG=YES,
      547    18945                        DCB=M$NAME,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:269  
      548    18946                        EXIST=OLDFILE,
      549    18947                        FUN=CREATE,
      550    18948                        NAME=VM_NAME_MAP_NAME,
      551    18949                        ORG=KEYED,
      552    18950                       SHARE=ALL,
      553    18951                       STCLASS=CONSTANT);
      554    19060        %FPT_DELREC (FPTN=DELREC_NAME_MAP,
      555    19061                        DCB=M$NAME,
      556    19062                       KEY=NAME_KEY,
      557    19063                       STCLASS=CONSTANT);
      558    19082
      559    19083
      560    19084        %FPT_WRITE (FPTN=WRITE_NAME_MAP,
      561    19085                        DCB=M$NAME,
      562    19086                        KEY=NAME_KEY);
      563    19117
      564    19118        %FPT_READ (FPTN=READ_NAME_MAP,
      565    19119                      DCB=M$NAME,
      566    19120                      BUF=WORK_STRING.NAME#,
      567    19121                      KEY=NAME_KEY,
      568    19122                      KEYS=YES,
      569    19123                       STCLASS=CONSTANT);
      570    19162
      571    19163        %VLP_NAME (FPTN=NAME_KEY,LEN=20,NAME=' ');
      572    19190
      573    19191        %FPT_CORRES (STCLASS=STATIC);
      574    19205
      575    19206        %FPT_LINK (FPTN=FPT_LINK,
      576    19207                       CMD=LINK_CCBUF);
      577    19225
      578    19226
      579    19227        %VLP_ACCT (FPTN=SYSACCT,ACCT=':SYS');
      580    19240
      581    19241        %FPT_OPEN (FPTN=OPEN_SEND_FILE,
      582    19242                       ACS=DIRECT,
      583    19243                       ASN=FILE,
      584    19244                       DCB=M$WORK,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:270  
      585    19245                       EXIST=NEWFILE,
      586    19246                       FUN=CREATE,
      587    19247                       NAME=VM_SEND_FILE_NAME,
      588    19248                       ORG=KEYED,
      589    19249                       SCRUB=YES,
      590    19250                       STCLASS=CONSTANT);
      591    19359
      592    19360        %FPT_OPEN (FPTN=OPEN_FORWARD_FILE,
      593    19361                       ACS=SEQUEN,
      594    19362                       ASN=FILE,
      595    19363                       DCB=M$WORK,
      596    19364                       EXIST=NEWFILE,
      597    19365                       FUN=CREATE,
      598    19366                       NAME=VM_FORWARD_FILE_NAME,
      599    19367                       PASS=VM_FORWARD_FILE_PASS,
      600    19368                       ORG=CONSEC,
      601    19369                       SCRUB=YES,
      602    19370                       STCLASS=CONSTANT);
      603    19479        %FPT_OPEN (FPTN=OPEN_FORWARD_ENCL_FILE,
      604    19480                       ACS=DIRECT,
      605    19481                       ASN=FILE,
      606    19482                       DCB=M$ENCL,
      607    19483                       EXIST=NEWFILE,
      608    19484                       FUN=CREATE,
      609    19485                       NAME=VM_FORWARD_ENCL_NAME,
      610    19486                       PASS=VM_FORWARD_FILE_PASS,
      611    19487                       ORG=KEYED,
      612    19488                       SCRUB=YES,
      613    19489                       STCLASS=CONSTANT);
      614    19598        %FPT_OPEN (FPTN=REOPEN_FILE,
      615    19599                       FUN=UPDATE);
      616    19708        %FPT_TIME (FPTN=GET_TIME,
      617    19709                       SOURCE=CLOCK,
      618    19710                       DEST=UTS,
      619    19711                       TSTAMP=WORK_UTS);
      620    19730        /***** Fpts for output stream (M$LO) *****/
      621    19731        %FPT_OPEN (FPTN=OPEN_OUTPUT_STREAM_DEFAULT,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:271  
      622    19732                       REASSIGN=YES,
      623    19733                       FUN=CREATE,
      624    19734                       EXIST=OLDFILE,
      625    19735                       SCRUB=YES,
      626    19736                       STCLASS=CONSTANT,
      627    19737                       DCB=M$LO);
      628    19846
      629    19847        /***** Fpts for command stream (M$SI) *****/
      630    19848        %FPT_OPEN (FPTN=OPEN_COMMAND_STREAM_DEFAULT,
      631    19849                       REASSIGN=YES,
      632    19850                       FUN=IN,
      633    19851                       ORG=CONSEC,
      634    19852                       ACS=SEQUEN,
      635    19853                       WSN=ERASE,
      636    19854                       SCRUB=YES,
      637    19855                       STCLASS=CONSTANT,
      638    19856                       DCB=M$SI);
      639    19965
      640    19966        %FPT_OPEN (FPTN=OPEN_COMMAND_STREAM,
      641    19967                       REASSIGN=NO,
      642    19968                       FUN=IN,
      643    19969                       ORG=CONSEC,
      644    19970                       ACS=SEQUEN,
      645    19971                       SCRUB=YES,
      646    19972                       DCB=M$CMNDF);
      647    20081
      648    20082        %FPT_OPEN (FPTN=OPEN_ENCL,
      649    20083                       DCB=M$ENCL,
      650    20084                       ORG=CONSEC,
      651    20085                       ASN=FILE);
      652    20194
      653    20195        %FPT_WRITE (FPTN=WRITE_ENCL,
      654    20196                       DCB=M$ENCL);
      655    20227
      656    20228        %FPT_LDEV (FPTN=PRINT_LDEV, STCLASS=CONSTANT,
      657    20229                  STREAMNAME='ALL');
      658    20254
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:272  
      659    20255        %FPT_PRECORD (STCLASS=CONSTANT,
      660    20256                  N=-1,
      661    20257                  DCB=M$MAIL_FILE);
      662    20278        %F_FDS (NAME=F_FDSME,DCB=M$ME,BUF=OUTBUF,VECTR=VECT_ARRAY);
      663    20391              %F_FDS (NAME=SPACE_LO,BUF=OUTBUF,DCB=M$LO,VECTR=VECT_ARRAY,
      664    20392              FMT=VM_BLANK_LINE_FMT,NVECS=0);
      665    20505              %F_FDS (NAME=F_FDSLO,BUF=OUTBUF,DCB=M$LO,VECTR=VECT_ARRAY);
      666    20618
      667    20619        /***** Misc variables *****/
      668    20620    1   DCL VECT_ARRAY (0:6) BIT(72) DALIGNED STATIC;
      669    20621    1   DCL DELETE_ENCL_FLAG BIT(1);
      670    20622        /***** Dcbs *****/
      671    20623    1   DCL M$NAME DCB;
      672    20624    1   DCL M$CMNDF DCB;
      673    20625    1   DCL M$LM DCB;
      674    20626    1   DCL M$EDIT DCB;
      675    20627    1   DCL M$OUT DCB;
      676    20628    1   DCL M$ENCL DCB;
      677    20629        /***** Formats *****/
      678    20630    1   DCL VM_BLANK_LINE_FMT  CHAR(0)         STATIC INIT('%1X');
      679    20631        %VLP_NAME (FPTN=VM_GREETING_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      680    20658        %VLP_ERRCODE (FPTN=E_GREETING_FMT,   STCLASS="CONSTANT SYMDEF",
      681    20659                    ERR#=%E$GREETING_FMT,      FCG=VM,MID=O);
      682    20704        /*E*  ERROR:VMO-E$GREETING_FMT-0
      683    20705              MESSAGE:Mail "T here
      684    20706        */
      685    20707             %VLP_NAME (FPTN=VM_FOLDER_HEADER1_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             20707                  ;
      686    20734        %VLP_ERRCODE (FPTN=E_FOLDER_HEADER1_FMT, STCLASS="CONSTANT SYMDEF",
      687    20735                    ERR#=%E$FOLDER_HEADER1_FMT,          FCG=VM, MID=O);
      688    20780        /*E*  ERROR:VMO-E$FOLDER_HEADER1_FMT-0
      689    20781              MESSAGE:"15..3U ."A
      690    20782        */
      691    20783             %VLP_NAME (FPTN=VM_FOLDER_HEADER2_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             20783                  ;
      692    20810        %VLP_ERRCODE (FPTN=E_FOLDER_HEADER2_FMT, STCLASS="CONSTANT SYMDEF",
      693    20811                    ERR#=%E$FOLDER_HEADER2_FMT,          FCG=VM,MID=O);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:273  
      694    20856        /*E*  ERROR:VMO-E$FOLDER_HEADER2_FMT-0
      695    20857              MESSAGE:Owner  #Msgs #New Used Gran   Name
      696    20858        */
      697    20859             %VLP_NAME (FPTN=VM_FOLDER_DELETED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             20859                  ;
      698    20886        %VLP_ERRCODE (FPTN=E_FOLDER_DELETED_FMT, STCLASS="CONSTANT SYMDEF",
      699    20887                    ERR#=%E$FOLDER_DELETED_FMT,          FCG=VM,MID=O);
      700    20932        /*E*  ERROR:VMO-E$FOLDER_DELETED_FMT-0
      701    20933              MESSAGE:"D folders deleted
      702    20934        */
      703    20935              %VLP_NAME (FPTN=VM_FOLDER_DISPLAYED_FMT, LEN=80, L=80, NAME=' ', STCLASS=
             20935                  STATIC);
      704    20962        %VLP_ERRCODE(FPTN=E_FOLDER_DISPLAYED_FMT, STCLASS="CONSTANT SYMDEF",
      705    20963                    ERR#=%E$FOLDER_DISPLAYED_FMT,        FCG=VM,MID=O);
      706    21008        /*E*  ERROR:VMO-E$FOLDER_DISPLAYED_FMT-0
      707    21009              MESSAGE:"D folders displayed
      708    21010        */
      709    21011              %VLP_NAME (FPTN=VM_COUNT_FMT, LEN=80, L=80, NAME = ' ', STCLASS=STATIC);
      710    21038        %VLP_ERRCODE (FPTN=E_COUNT_FMT, STCLASS="CONSTANT SYMDEF",
      711    21039                    ERR#=%E$COUNT_FMT,                   FCG=VM,MID=O);
      712    21084        /*E*  ERROR:VMO-E$COUNT_FMT-0
      713    21085              MESSAGE:"D messages found
      714    21086        */
      715    21087              %VLP_NAME (FPTN=VM_NO_MESSAGE_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      716    21114        %VLP_ERRCODE (FPTN=E_NO_MESSAGE_FMT, STCLASS="CONSTANT SYMDEF",
      717    21115                    ERR#=%E$NO_MESSAGE_FMT,              FCG=VM,MID=O);
      718    21160        /*E*  ERROR:VMO-E$NO_MESSAGE_FMT-0
      719    21161              MESSAGE:None found
      720    21162        */
      721    21163              %VLP_NAME (FPTN=VM_TIME_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      722    21190        %VLP_ERRCODE (FPTN=E_TIME_FMT, STCLASS="CONSTANT SYMDEF",
      723    21191                    ERR#=%E$TIME_FMT,                    FCG=VM,MID=O);
      724    21236        /*E*  ERROR:VMO-E$TIME_FMT-0
      725    21237              MESSAGE:"15..3U
      726    21238        */
      727    21239              %VLP_NAME (FPTN=VM_EMPTY_FOLDER_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      728    21266        %VLP_ERRCODE (FPTN=E_EMPTY_FOLDER_FMT, STCLASS="CONSTANT SYMDEF",
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:274  
      729    21267                    ERR#=%E$EMPTY_FOLDER_FMT,            FCG=VM,MID=O);
      730    21312        /*E*  ERROR:VMO-E$EMPTY_FOLDER_FMT-0,                FCG=VM,MID=O);
      731    21313              MESSAGE:Folder "A is empty
      732    21314        */
      733    21315             %VLP_NAME (FPTN=VM_NO_NEW_MESSAGE_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             21315                  ;
      734    21342        %VLP_ERRCODE (FPTN=E_NO_NEW_MESSAGE_FMT, STCLASS="CONSTANT SYMDEF",
      735    21343                    ERR#=%E$NO_NEW_MESSAGE_FMT,           FCG=VM,MID=O);
      736    21388        /*E*  ERROR:VMO-E$NO_NEW_MESSAGE_FMT-0,
      737    21389              MESSAGE:No NEW messages found
      738    21390        */
      739    21391              %VLP_NAME (FPTN=VM_CREATE_MSG_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      740    21418        %VLP_ERRCODE (FPTN=E_CREATE_MSG_FMT,   STCLASS="CONSTANT SYMDEF",
      741    21419                    ERR#=%E$CREATE_MSG_FMT,              FCG=VM,MID=O);
      742    21464        /*E*  ERROR:VMO-E$CREATE_MSG_FMT-0
      743    21465              MESSAGE:Folder %U1 created.
      744    21466        */
      745    21467              %VLP_ERRCODE (FPTN=E_USING_MSG_FMT, STCLASS="CONSTANT SYMDEF",
      746    21468              ERR#=%E$USING_MSG_FMT,                 FCG=VM,MID=O);
      747    21513        /*E*  ERROR:VMO-E$USING_MSG_FMT-0
      748    21514              MESSAGE:Using %U1
      749    21515        */
      750    21516              %VLP_NAME (FPTN=VM_MSGS_DELETED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      751    21543        %VLP_ERRCODE (FPTN=E_MSGS_DELETED_FMT, STCLASS="CONSTANT SYMDEF",
      752    21544                    ERR#=%E$MSGS_DELETED_FMT,             FCG=VM,MID=O);
      753    21589        /*E*  ERROR:VMO-E$MSGS_DELETED_FMT-0,
      754    21590              MESSAGE:"D messages flagged for deletion
      755    21591        */
      756    21592             %VLP_NAME (FPTN=VM_MSGS_UNDELETED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             21592                  ;
      757    21619        %VLP_ERRCODE (FPTN=E_MSGS_UNDELETED_FMT, STCLASS="CONSTANT SYMDEF",
      758    21620                    ERR#=%E$MSGS_UNDELETED_FMT,           FCG=VM,MID=O);
      759    21665        /*E*  ERROR:VMO-E$MSGS_UNDELETED_FMT-0
      760    21666              MESSAGE:"D messages no longer flagged for deletion
      761    21667        */
      762    21668              %VLP_NAME (FPTN=VM_MSGS_MARKED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      763    21695        %VLP_ERRCODE (FPTN=E_MSGS_MARKED_FMT,  STCLASS="CONSTANT SYMDEF",
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:275  
      764    21696                    ERR#=%E$MSGS_MARKED_FMT,             FCG=VM,MID=O);
      765    21741        /*E*  ERROR:VMO-E$MSGS_MARKED_FMT-0
      766    21742              MESSAGE:"D messages marked
      767    21743        */
      768    21744             %VLP_NAME (FPTN=VM_MSGS_UNMARKED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      769    21771        %VLP_ERRCODE (FPTN=E_MSGS_UNMARKED_FMT, STCLASS="CONSTANT SYMDEF",
      770    21772                    ERR#=%E$MSGS_UNMARKED_FMT,           FCG=VM,MID=O);
      771    21817        /*E*  ERROR:VMO-E$MSGS_UNMARKED_FMT-0
      772    21818              MESSAGE:"D messages no longer marked
      773    21819        */
      774    21820              %VLP_NAME (FPTN=VM_MSGS_COPIED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      775    21847        %VLP_ERRCODE (FPTN=E_MSGS_COPIED_FMT,  STCLASS="CONSTANT SYMDEF",
      776    21848                       ERR#=%E$MSGS_COPIED_FMT,          FCG=VM,MID=O);
      777    21893        /*E*  ERROR:VMO-E$MSGS_COPIED_FMT-0
      778    21894              MESSAGE:"D messages copied
      779    21895        */
      780    21896             %VLP_NAME (FPTN=VM_MSGS_DISPLAYED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC)
             21896                  ;
      781    21923        %VLP_ERRCODE (FPTN=E_MSGS_DISPLAYED_FMT, STCLASS="CONSTANT SYMDEF",
      782    21924                    ERR#=%E$MSGS_DISPLAYED_FMT,             FCG=VM,MID=O);
      783    21969        /*E*  ERROR:VMO-E$MSGS_DISPLAYED_FMT-0
      784    21970              MESSAGE:"D messages displayed
      785    21971        */
      786    21972              %VLP_NAME (FPTN=VM_MSGS_LISTED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      787    21999        %VLP_ERRCODE (FPTN=E_MSGS_LISTED_FMT,  STCLASS="CONSTANT SYMDEF",
      788    22000                    ERR#=%E$MSGS_LISTED_FMT,             FCG=VM,MID=O);
      789    22045        /*E*  ERROR:VMO-E$MSGS_LISTED_FMT-0
      790    22046              MESSAGE:"D messages listed
      791    22047        */
      792    22048             %VLP_NAME (FPTN=VM_LISTS_DELETED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      793    22075        %VLP_ERRCODE (FPTN=E_LISTS_DELETED_FMT, STCLASS="CONSTANT SYMDEF",
      794    22076                    ERR#=%E$LISTS_DELETED_FMT,           FCG=VM,MID=O);
      795    22121        /*E*  ERROR:VMO-E$LISTS_DELETED_FMT-0
      796    22122              MESSAGE:"D list definitions deleted
      797    22123        */
      798    22124             %VLP_NAME (FPTN=VM_LISTS_DISPLAYED_FMT, LEN=80, L=80, NAME= ' ',STCLASS=STATIC
             22124                  );
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:276  
      799    22151        %VLP_ERRCODE (FPTN=E_LISTS_DISPLAYED_FMT, STCLASS="CONSTANT SYMDEF",
      800    22152                    ERR#=%E$LISTS_DISPLAYED_FMT,         FCG=VM,MID=O);
      801    22197        /*E*  ERROR:VMO-E$LISTS_DISPLAYED_FMT-0
      802    22198              MESSAGE:"D list definitions displayed
      803    22199        */
      804    22200              %VLP_NAME (FPTN=VM_USERS_DELETED_FMT, LEN=80, L=80, NAME=' ',STCLASS=STATIC);
      805    22227        %VLP_ERRCODE (FPTN=E_USERS_DELETED_FMT, STCLASS="CONSTANT SYMDEF",
      806    22228                    ERR#=%E$USERS_DELETED_FMT,           FCG=VM,MID=O);
      807    22273        /*E*  ERROR:VMO-E$USERS_DELETED_FMT-0
      808    22274              MESSAGE:"D user definitions deleted
      809    22275        */
      810    22276             %VLP_NAME (FPTN=VM_USERS_DISPLAYED_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC
             22276                  );
      811    22303        %VLP_ERRCODE (FPTN=E_USERS_DISPLAYED_FMT, STCLASS="CONSTANT SYMDEF",
      812    22304                    ERR#=%E$USERS_DISPLAYED_FMT,         FCG=VM,MID=O);
      813    22349        /*E*  ERROR:VMO-E$USERS_DISPLAYED_FMT-0
      814    22350              MESSAGE:"D user definitions displayed
      815    22351        */
      816    22352             %VLP_NAME (FPTN=VM_STATUS_FOLDER_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      817    22379        %VLP_ERRCODE (FPTN=E_STATUS_FOLDER_FMT, STCLASS="CONSTANT SYMDEF",
      818    22380                    ERR#=%E$STATUS_FOLDER_FMT,           FCG=VM,MID=O);
      819    22425        /*E*  ERROR:VMO-E$STATUS_FOLDER_FMT-0
      820    22426              MESSAGE:"5XCurrent folder is "A
      821    22427        */
      822    22428             %VLP_NAME (FPTN=VM_STATUS_SCONTEXT_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC
             22428                  );
      823    22455        %VLP_ERRCODE (FPTN=E_STATUS_SCONTEXT_FMT, STCLASS="CONSTANT SYMDEF",
      824    22456                    ERR#=%E$STATUS_SCONTEXT_FMT,         FCG=VM,MID=O);
      825    22501        /*E*  ERROR:VMO-E$STATUS_SCONTEXT_FMT-0
      826    22502              MESSAGE:"5XSelected Context is: "A
      827    22503        */
      828    22504             %VLP_NAME (FPTN=VM_STATUS_CCONTEXT_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC
             22504                  );
      829    22531        %VLP_ERRCODE (FPTN=E_STATUS_CCONTEXT_FMT, STCLASS="CONSTANT SYMDEF",
      830    22532                    ERR#=%E$STATUS_CCONTEXT_FMT,         FCG=VM,MID=O);
      831    22577        /*E*  ERROR:VMO-E$STATUS_CCONTEXT_FMT-0
      832    22578              MESSAGE:"5XCurrent Context is: "A
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:277  
      833    22579        */
      834    22580              %VLP_NAME (FPTN=VM_STATUS_POSITION_FMT, LEN=80, L=80, NAME = ' ', STCLASS=
             22580                  STATIC);
      835    22607        %VLP_ERRCODE (FPTN=E_STATUS_POSITION_FMT, STCLASS="CONSTANT SYMDEF",
      836    22608                    ERR#=%E$STATUS_POSITION_FMT,         FCG=VM,MID=O);
      837    22653        /*E*  ERROR:VMO-E$STATUS_POSITION_FMT-0
      838    22654              MESSAGE:"5XMessage within Selected Context is: "D
      839    22655        */
      840    22656              %VLP_NAME (FPTN=VM_STATUS_POSITION_OUTSIDE_FMT, LEN=80, L=80, NAME=' ',
             22656                  STCLASS=STATIC);
      841    22683        %VLP_ERRCODE (FPTN=E_STATUS_POSITION_OUTSIDE_FMT, STCLASS="CONSTANT SYMDEF",
      842    22684                    ERR#=%E$STATUS_POSITION_OUTSIDE_FMT, FCG=VM,MID=O);
      843    22729        /*E*  ERROR:VMO-E$STATUS_POSITION_OUTSIDE_FMT-0
      844    22730             MESSAGE:"5XMessage position within Selected Context is: Outside Selected Range
      845    22731        */
      846    22732              %VLP_NAME (FPTN=VM_STATUS_DMSGS_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      847    22759        %VLP_ERRCODE (FPTN=E_STATUS_DMSGS_FMT, STCLASS="CONSTANT SYMDEF",
      848    22760                    ERR#=%E$STATUS_DMSGS_FMT,            FCG=VM,MID=O);
      849    22805        /*E*  ERROR:VMO-E$STATUS_DMSGS_FMT-0
      850    22806              MESSAGE:"5XNumber of messages  marked for deletion is "D
      851    22807        */
      852    22808              %VLP_NAME (FPTN=VM_STATUS_NMSGS_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      853    22835        %VLP_ERRCODE (FPTN=E_STATUS_NMSGS_FMT, STCLASS="CONSTANT SYMDEF",
      854    22836                    ERR#=%E$STATUS_NMSGS_FMT,            FCG=VM,MID=O);
      855    22881        /*E*  ERROR:VMO-E$STATUS_NMSGS_FMT-0
      856    22882              MESSAGE:"5XNumber of new messages is "D
      857    22883        */
      858    22884              %VLP_NAME (FPTN=VM_STATUS_TMSGS_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      859    22911        %VLP_ERRCODE (FPTN=E_STATUS_TMSGS_FMT, STCLASS="CONSTANT SYMDEF",
      860    22912                    ERR#=%E$STATUS_TMSGS_FMT,            FCG=VM,MID=O);
      861    22957        /*E*  ERROR:VMO-E$STATUS_TMSGS_FMT-0
      862    22958              MESSAGE:"5XTotal number of messages is "D
      863    22959        */
      864    22960              %VLP_NAME (FPTN=VM_STATUS_HMSGS_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      865    22987        %VLP_ERRCODE (FPTN=E_STATUS_HMSGS_FMT, STCLASS="CONSTANT SYMDEF",
      866    22988                    ERR#=%E$STATUS_HMSGS_FMT,            FCG=VM,MID=O);
      867    23033        /*E*  ERROR:VMO-E$STATUS_HMSGS_FMT-0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:278  
      868    23034              MESSAGE:"5XHighest message number is "D
      869    23035        */
      870    23036              %VLP_NAME (FPTN=VM_USE_FULL_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      871    23063        %VLP_ERRCODE (FPTN=E_USE_FULL_FMT,     STCLASS="CONSTANT SYMDEF",
      872    23064                    ERR#=%E$USE_FULL_FMT,                FCG=VM,MID=O);
      873    23109        /*E*  ERROR:VMO-E$USE_FULL_FMT-0
      874    23110              MESSAGE:Folder "A is full
      875    23111        */
      876    23112              %VLP_NAME (FPTN=VM_USE_LOST_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      877    23139        %VLP_ERRCODE (FPTN=E_USE_LOST_FMT,     STCLASS="CONSTANT SYMDEF",
      878    23140                    ERR#=%E$USE_LOST_FMT,                FCG=VM,MID=O);
      879    23185        /*E*  ERROR:VMO-E$USE_LOST_FMT-0
      880    23186              MESSAGE:Warning: "D messages lost due to insufficient disk space.
      881    23187        */
      882    23188              %VLP_NAME (FPTN=VM_NEW_MESSAGE_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      883    23215        %VLP_ERRCODE (FPTN=E_NEW_MESSAGE_FMT,  STCLASS="CONSTANT SYMDEF",
      884    23216                    ERR#=%E$NEW_MESSAGE_FMT,             FCG=VM,MID=O);
      885    23261        /*E*  ERROR:VMO-E$NEW_MESSAGE_FMT-0
      886    23262              MESSAGE:A new message has been received.
      887    23263        */
      888    23264
      889    23265              %VLP_NAME (FPTN=USER_NAME,LEN=256,NAME=' ',STCLASS=STATIC);
      890    23292        %VLP_NAME (FPTN=VM_DETACH_OK_FMT, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
      891    23319        %VLP_ERRCODE (FPTN=E_DETACH_OK_FMT,STCLASS="CONSTANT SYMDEF",
      892    23320                      ERR#=%E$DETACH_OK_FMT,        FCG="VM",MID="O");
      893    23365        /*E* ERROR:VMO-E$DETACH_OK_FMT
      894    23366             MESSAGE:Enclosure "D detached.
      895    23367        */
      896    23368              %VLP_NAME (FPTN=VM_DETACH_DELETE_OK_FMT, LEN=80, L=80, NAME=' ', STCLASS=
             23368                  STATIC);
      897    23395        %VLP_ERRCODE (FPTN=E_DETACH_DELETE_OK_FMT,STCLASS="CONSTANT SYMDEF",
      898    23396                      ERR#=%E$DETACH_DELETE_OK_FMT,        FCG="VM",MID="O");
      899    23441        /*E* ERROR:VMO-E$DETACH_DELETE_OK_FMT
      900    23442             MESSAGE:Enclosure "D detached and deleted.
      901    23443        */
      902    23444        /***** Embedded commands *****/
      903    23445              %VLP_NAME (FPTN=VM_END_NOUPDATE_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:279  
      904    23472        %VLP_ERRCODE (FPTN=E_END_NOUPDATE_CMD, STCLASS="CONSTANT SYMDEF",
      905    23473                    ERR#=%E$END_NOUPDATE_CMD,            FCG=VM,MID=O);
      906    23518        /*E*  ERROR:VMO-E$END_NOUPDATE_CMD-0
      907    23519              MESSAGE:END NOUPDATE
      908    23520        */
      909    23521              %VLP_NAME (FPTN=VM_NEXT_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      910    23548        %VLP_ERRCODE (FPTN=E_NEXT_CMD,         STCLASS="CONSTANT SYMDEF",
      911    23549                    ERR#=%E$NEXT_CMD,                    FCG=VM,MID=O);
      912    23594        /*E*  ERROR:VMO-E$NEXT_CMD-0
      913    23595              MESSAGE:NEXT
      914    23596        */
      915    23597              %VLP_NAME (FPTN=VM_DI_NEXT_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      916    23624        %VLP_ERRCODE (FPTN=E_DI_NEXT_CMD,      STCLASS="CONSTANT SYMDEF",
      917    23625                    ERR#=%E$DI_NEXT_CMD,                 FCG=VM,MID=O);
      918    23670        /*E*  ERROR:VMO-E$DI_NEXT_CMD-0
      919    23671              MESSAGE:DI NEXT
      920    23672        */
      921    23673              %VLP_NAME (FPTN=VM_LIST_NEXT_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      922    23700        %VLP_ERRCODE (FPTN=E_LIST_NEXT_CMD,    STCLASS="CONSTANT SYMDEF",
      923    23701                    ERR#=%E$LIST_NEXT_CMD,               FCG=VM,MID=O);
      924    23746        /*E*  ERROR:VMO-E$LIST_NEXT_CMD-0
      925    23747              MESSAGE:LIST NEXT
      926    23748        */
      927    23749              %VLP_NAME (FPTN=VM_PREVIOUS_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      928    23776        %VLP_ERRCODE (FPTN=E_PREVIOUS_CMD,     STCLASS="CONSTANT SYMDEF",
      929    23777                    ERR#=%E$PREVIOUS_CMD,                FCG=VM,MID=O);
      930    23822        /*E*  ERROR:VMO-E$PREVIOUS_CMD-0
      931    23823              MESSAGE:PREVIOUS
      932    23824        */
      933    23825              %VLP_NAME (FPTN=VM_DI_PREVIOUS_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      934    23852        %VLP_ERRCODE (FPTN=E_DI_PREVIOUS_CMD,  STCLASS="CONSTANT SYMDEF",
      935    23853                    ERR#=%E$DI_PREVIOUS_CMD,            FCG=VM,MID=O);
      936    23898        /*E*  ERROR:VMO-E$DI_PREVIOUS_CMD-0
      937    23899              MESSAGE:DI PREVIOUS
      938    23900        */
      939    23901             %VLP_NAME (FPTN=VM_LIST_PREVIOUS_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      940    23928        %VLP_ERRCODE (FPTN=E_LIST_PREVIOUS_CMD, STCLASS="CONSTANT SYMDEF",
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:280  
      941    23929                    ERR#=%E$LIST_PREVIOUS_CMD,           FCG=VM,MID=O);
      942    23974        /*E*  ERROR:VMO-E$LIST_PREVIOUS_CMD-0
      943    23975              MESSAGE:LIST PREVIOUS
      944    23976        */
      945    23977              %VLP_NAME (FPTN=VM_DI_FIRST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      946    24004        %VLP_ERRCODE (FPTN=E_DI_FIRST_CMD,     STCLASS="CONSTANT SYMDEF",
      947    24005                    ERR#=%E$DI_FIRST_CMD,                FCG=VM,MID=O);
      948    24050        /*E*  ERROR:VMO-E$DI_FIRST_CMD-0
      949    24051              MESSAGE:DI FIRST
      950    24052        */
      951    24053              %VLP_NAME (FPTN=VM_LIST_FIRST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      952    24080        %VLP_ERRCODE (FPTN=E_LIST_FIRST_CMD,   STCLASS="CONSTANT SYMDEF",
      953    24081                    ERR#=%E$LIST_FIRST_CMD,              FCG=VM,MID=O);
      954    24126        /*E*  ERROR:VMO-E$LIST_FIRST_CMD-0
      955    24127              MESSAGE:LIST FIRST
      956    24128        */
      957    24129              %VLP_NAME (FPTN=VM_DI_THIS_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      958    24156        %VLP_ERRCODE (FPTN=E_DI_THIS_CMD,      STCLASS="CONSTANT SYMDEF",
      959    24157                    ERR#=%E$DI_THIS_CMD,                 FCG=VM,MID=O);
      960    24202        /*E*  ERROR:VMO-E$DI_THIS_CMD-0
      961    24203              MESSAGE:DI THIS
      962    24204        */
      963    24205              %VLP_NAME (FPTN=VM_LIST_THIS_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      964    24232        %VLP_ERRCODE (FPTN=E_LIST_THIS_CMD,    STCLASS="CONSTANT SYMDEF",
      965    24233                    ERR#=%E$LIST_THIS_CMD,               FCG=VM,MID=O);
      966    24278        /*E*  ERROR:VMO-E$LIST_THIS_CMD-0
      967    24279              MESSAGE:LIST THIS
      968    24280        */
      969    24281              %VLP_NAME (FPTN=VM_DI_LAST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      970    24308        %VLP_ERRCODE (FPTN=E_DI_LAST_CMD,    STCLASS="CONSTANT SYMDEF",
      971    24309                    ERR#=%E$DI_LAST_CMD,               FCG=VM,MID=O);
      972    24354        /*E*  ERROR:VMO-E$DI_LAST_CMD-0,
      973    24355              MESSAGE:DI LAST
      974    24356        */
      975    24357              %VLP_NAME (FPTN=VM_LIST_LAST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      976    24384        %VLP_ERRCODE (FPTN=E_LIST_LAST_CMD,    STCLASS="CONSTANT SYMDEF",
      977    24385                    ERR#=%E$LIST_LAST_CMD,               FCG=VM,MID=O);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:281  
      978    24430        /*E*  ERROR:VMO-E$LIST_LAST_CMD-0
      979    24431              MESSAGE:LIST LAST
      980    24432        */
      981    24433              %VLP_NAME (FPTN=VM_DI_REST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      982    24460        %VLP_ERRCODE (FPTN=E_DI_REST_CMD,      STCLASS="CONSTANT SYMDEF",
      983    24461                    ERR#=%E$DI_REST_CMD,                 FCG=VM,MID=O);
      984    24506        /*E*  ERROR:VMO-E$DI_REST_CMD-0
      985    24507              MESSAGE:DI REST
      986    24508        */
      987    24509              %VLP_NAME (FPTN=VM_LIST_REST_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      988    24536        %VLP_ERRCODE (FPTN=E_LIST_REST_CMD,    STCLASS="CONSTANT SYMDEF",
      989    24537                    ERR#=%E$LIST_REST_CMD,               FCG=VM,MID=O);
      990    24582        /*E*  ERROR:VMO-E$LIST_REST_CMD-0
      991    24583              MESSAGE:LIST REST
      992    24584        */
      993    24585              %VLP_NAME (FPTN=VM_END_CMD, LEN=15, L=15, NAME=' ', STCLASS=STATIC);
      994    24612        %VLP_ERRCODE (FPTN=E_END_CMD,          STCLASS="CONSTANT SYMDEF",
      995    24613                    ERR#=%E$END_CMD,                     FCG=VM,MID=O);
      996    24658        /*E*  ERROR:VMO-E$END_CMD-0
      997    24659              MESSAGE:END
      998    24660        */
      999    24661              %VLP_NAME (FPTN=VM_SEND_ANSWER, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
     1000    24688        %VLP_ERRCODE (FPTN=E_SEND_ANSWER,      STCLASS="CONSTANT SYMDEF",
     1001    24689                    ERR#=%E$SEND_ANSWER,                 FCG=VM,MID=O);
     1002    24734        /*E*  ERROR:VMO-E$SEND_ANSWER-0
     1003    24735              MESSAGE:ANSWER
     1004    24736        */
     1005    24737              %VLP_NAME (FPTN=VM_SEND_ACKNOWLEDGE, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
     1006    24764        %VLP_ERRCODE (FPTN=E_SEND_ACKNOWLEDGE, STCLASS="CONSTANT SYMDEF",
     1007    24765                    ERR#=%E$SEND_ACKNOWLEDGE,            FCG=VM,MID=O);
     1008    24810        /*E*  ERROR:VMO-E$SEND_ACKNOWLEDGE-0
     1009    24811              MESSAGE:ACKNOWLEDGE
     1010    24812        */
     1011    24813              %VLP_NAME (FPTN=VM_SEND_FORWARD, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
     1012    24840        %VLP_ERRCODE (FPTN=E_SEND_FORWARD,     STCLASS="CONSTANT SYMDEF",
     1013    24841                    ERR#=%E$SEND_FORWARD,                FCG=VM,MID=O);
     1014    24886        /*E*  ERROR:VMO-E$SEND_FORWARD-0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:282  
     1015    24887              MESSAGE:FORWARD
     1016    24888        */
     1017    24889             %VLP_NAME (FPTN=VM_SEND_FORWARD_ENCL, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
     1018    24916        %VLP_ERRCODE (FPTN=E_SEND_FORWARD_ENCL,    STCLASS="CONSTANT SYMDEF",
     1019    24917                    ERR#=%E$SEND_FORWARD_ENCL,            FCG=VM,MID=O);
     1020    24962        /*E*   ERROR:VMO-E$SEND_FORWARD_ENCL-0
     1021    24963               MESSAGE:FORWARD ENCLOSURE
     1022    24964        */
     1023    24965              %VLP_NAME (FPTN=VM_SEND_MAIL, LEN=80, L=80, NAME=' ', STCLASS=STATIC);
     1024    24992        %VLP_ERRCODE (FPTN=E_SEND_MAIL,        STCLASS="CONSTANT SYMDEF",
     1025    24993                    ERR#=%E$SEND_MAIL,                   FCG=VM,MID=O);
     1026    25038        /*E*  ERROR:VMO-E$SEND_MAIL-0
     1027    25039              MESSAGE: (MAIL=
     1028    25040        */
     1029    25041              %VLP_NAME (FPTN=VM_SEND_NAME, STCLASS="STATIC SYMDEF", STCLASS=STATIC);
     1030    25068        %VLP_ERRCODE (FPTN=E_SEND_NAME,        STCLASS="CONSTANT SYMDEF",
     1031    25069                    ERR#=%E$SEND_NAME,                   FCG=VM,MID=O);
     1032    25114        /*E*  ERROR:VMO-E$SEND_NAME-0
     1033    25115              MESSAGE:SEND
     1034    25116        */
     1035    25117              %VLP_NAME (FPTN=VM_RESEND_NAME, STCLASS="STATIC SYMDEF", STCLASS=STATIC);
     1036    25144        %VLP_ERRCODE (FPTN=E_RESEND_NAME,        STCLASS="CONSTANT SYMDEF",
     1037    25145                    ERR#=%E$RESEND_NAME,                   FCG=VM,MID=O);
     1038    25190        /*E*  ERROR:VMO-E$RESEND_NAME-0
     1039    25191              MESSAGE:RESEND
     1040    25192        */
     1041    25193              %VLP_NAME (FPTN=VM_MAIL_SETUP, LEN=255, L=255, NAME=' ', STCLASS=STATIC);
     1042    25220        %VLP_ERRCODE (FPTN=E_MAIL_SETUP,       STCLASS="CONSTANT SYMDEF",
     1043    25221                    ERR#=%E$MAIL_SETUP,                  FCG=VM,MID=O);
     1044    25266        /*E*  ERROR:VMO-E$MAIL_SETUP-0
     1045    25267              MESSAGE:LIST NEW
     1046    25268        */
     1047    25269        /***** Error codes *****/
     1048    25270              %VLP_ERRCODE (FPTN=E_LISTEXISTS,FCG="VM",MID="O",
     1049    25271              ERR#=%E$LISTEXISTS,STCLASS=CONSTANT);
     1050    25316              %VLP_ERRCODE (FPTN=E_USEREXISTS,FCG="VM",MID="O",
     1051    25317              ERR#=%E$USEREXISTS,STCLASS=CONSTANT);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:283  
     1052    25362              %VLP_ERRCODE (FPTN=E_NOTMCENTRAL,FCG="VM",MID="O",
     1053    25363              ERR#=%E$NOTMCENTRAL,STCLASS=CONSTANT);
     1054    25408              %VLP_ERRCODE (FPTN=E_FOLDERBUSY,FCG="VM",MID="O",
     1055    25409              ERR#=%E$FOLDERBUSY,STCLASS=CONSTANT);
     1056    25454        /*E*    ERROR: VMO-E$FOLDERBUSY-0
     1057    25455                MESSAGE: Folder %U1 is busy. Try again later.
     1058    25456        */
     1059    25457              %VLP_ERRCODE (FPTN=E_FOLDEROLD,FCG="VM",MID="O",
     1060    25458              ERR#=%E$FOLDEROLD,STCLASS=CONSTANT);
     1061    25503        /*E* ERROR: VMO-E$FOLDEROLD-0
     1062    25504             MESSAGE: Error encountered trying to use the %FN folder.
     1063    25505             MESSAGE1: This may not be a folder or it may be a pre-A00 folder that
     1064    25506                     is incompatible with the current version of MAIL. Delete or rename
     1065    25507                     the %FN file and recreate the folder using MAIL.
     1066    25508        */
     1067    25509              %VLP_ERRCODE (FPTN=E_NAMENTALLOWED,FCG="VM",MID="O",
     1068    25510              ERR#=%E$NAMENTALLOWED,STCLASS=CONSTANT);
     1069    25555        /*E*    ERROR: VMO-E$NAMENTALLOWED-0
     1070    25556                MESSAGE: Names are not allowed here.
     1071    25557        */
     1072    25558              %VLP_ERRCODE (FPTN=E_CRFERR,FCG="VM",MID="O",
     1073    25559              ERR#=%E$CRFERR,STCLASS=CONSTANT);
     1074    25604        /*E*    ERROR: VMO-E$CRFERR-0
     1075    25605                MESSAGE: Error encountered trying to create folder.
     1076    25606        */
     1077    25607              %VLP_ERRCODE (FPTN=E_DELFERR,FCG="VM",MID="O",
     1078    25608              ERR#=%E$DELFERR,STCLASS=CONSTANT);
     1079    25653        /*E*    ERROR: VMO-E$DELFERR-0
     1080    25654                MESSAGE: Error encountered trying to delete folder.
     1081    25655        */
     1082    25656              %VLP_ERRCODE (FPTN=E_NOTALLOW,FCG="VM",MID="O",
     1083    25657              ERR#=%E$NOTALLOW,STCLASS=CONSTANT);
     1084    25702              %VLP_ERRCODE (FPTN=E_UNDEFENTRY,FCG="VM",MID="O",
     1085    25703              ERR#=%E$UNDEFENTRY,STCLASS=CONSTANT);
     1086    25748        /*E* ERROR: VMO-E$UNDEFENTRY-0
     1087    25749             MESSAGE: That name is undefined.
     1088    25750        */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:284  
     1089    25751              %VLP_ERRCODE (FPTN=E_NMENTRYEXISTS,FCG="VM",MID="O",
     1090    25752              ERR#=%E$NMENTRYEXISTS,STCLASS=CONSTANT);
     1091    25797        /*E* ERROR: VMO-E$NMENTRYEXISTS-0
     1092    25798             MESSAGE: User map entry %U1 points to user %U2.
     1093    25799        */
     1094    25800              %VLP_ERRCODE (FPTN=E_BLANKUSER,FCG="VM",MID="O",
     1095    25801              ERR#=%E$BLANKUSER,STCLASS=CONSTANT);
     1096    25846        /*E*    ERROR: VMO-E$BLANKUSER-0
     1097    25847                MESSAGE: User name can't be blank.
     1098    25848        */
     1099    25849              %VLP_ERRCODE (FPTN=E_CANTDELCUR,FCG="VM",MID="O",
     1100    25850              ERR#=%E$CANTDELCUR,STCLASS=CONSTANT);
     1101    25895        /*E*    ERROR: VMO-E$CANTDELCUR-0
     1102    25896                MESSAGE: Can't delete current folder
     1103    25897                MESSAGE1: You can't delete the folder you are currently USEing.
     1104    25898        */
     1105    25899              %VLP_ERRCODE (FPTN=E_CANTDELF,FCG="VM",MID="O",
     1106    25900              ERR#=%E$CANTDELF,STCLASS=CONSTANT);
     1107    25945        /*E*    ERROR: VMO-E$CANTDELF-0
     1108    25946                MESSAGE: Can't delete folder:
     1109    25947        */
     1110    25948              %VLP_ERRCODE (FPTN=E_TOOMANYSRCH,FCG="VM",MID="O",
     1111    25949              ERR#=%E$TOOMANYSRCH,STCLASS=CONSTANT);
     1112    25994        /*E*     ERROR: VMO-E$TOOMANYSRCH
     1113    25995                 MESSAGE: No more than 4 folders may be specified.
     1114    25996        */
     1115    25997              %VLP_ERRCODE (FPTN=E_NOCURFOLD,FCG="VM",MID="O",
     1116    25998              ERR#=%E$NOCURFOLD,STCLASS=CONSTANT);
     1117    26043        /*E*      ERROR: VMO-E$NOCURFOLD-0
     1118    26044                  MESSAGE: You currently have no folder open
     1119    26045        */
     1120    26046              %VLP_ERRCODE (FPTN=E_INPROG,FCG="VM",MID="O",
     1121    26047              ERR#=%E$INPROG,STCLASS=CONSTANT);
     1122    26092        /*E* ERROR: VMO-E$INPROG-0
     1123    26093             MESSAGE: This message is still being delivered.
     1124    26094             MESSAGE1: The MAILMAN ghost is currently moving the text of this
     1125    26095                     message into the folder.  None of the text can be accessed until
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:285  
     1126    26096                     the process is complete.  Try again later.
     1127    26097        */
     1128    26098              %VLP_ERRCODE (FPTN=E_CANTREN,FCG="VM",MID="O",
     1129    26099              ERR#=%E$CANTREN,STCLASS=CONSTANT);
     1130    26144        /*E* ERROR: VMO-E$CANTREN-0
     1131    26145             MESSAGE: Can't renumber now, MAILMAN is delivering a message.
     1132    26146        */
     1133    26147              %VLP_ERRCODE (FPTN=E_COMPACT,FCG="VM",MID="O",
     1134    26148              ERR#=%E$COMPACT,STCLASS=CONSTANT);
     1135    26193        /*E* ERROR: VMO-E$COMPACT-0
     1136    26194             MESSAGE: Compacting...
     1137    26195        */
     1138    26196              %VLP_ERRCODE (FPTN=E_RENFAILED,FCG="VM",MID="O",
     1139    26197              ERR#=%E$RENFAILED,STCLASS=CONSTANT);
     1140    26242        /*E* ERROR: VMO-E$RENFAILED-0
     1141    26243             MESSAGE: Renumber aborted
     1142    26244        */
     1143    26245              %VLP_ERRCODE (FPTN=E_CANTCOMPACT,FCG="VM",MID="O",
     1144    26246              ERR#=%E$CANTCOMPACT,STCLASS=CONSTANT);
     1145    26291        /*E* ERROR: VMO-E$CANTCOMPACT-0
     1146    26292             MESSAGE: Can't compact, file is busy or MAILMAN is delivering a message
     1147    26293        */
     1148    26294              %VLP_ERRCODE (FPTN=E_NOLIST,FCG="VM",MID="O",
     1149    26295              ERR#=%E$NOLIST,STCLASS=CONSTANT);
     1150    26340        /*E* ERROR: VMO-E$NOLIST-0
     1151    26341             MESSAGE: List does not exist.
     1152    26342        */
     1153    26343              %VLP_ERRCODE (FPTN=E_BADDOMAIN, FCG="VM", MID="O",
     1154    26344              ERR#=%E$BADDOMAIN, STCLASS=CONSTANT);
     1155    26389        /*E*  ERROR: VMO-E$BADDOMAIN-0
     1156    26390              MESSAGE: Domain %U1 is illegal.
     1157    26391        */
     1158    26392              %VLP_ERRCODE( FPTN=E_ANSBROAD,FCG="VM",MID="O",
     1159    26393              ERR#=%E$ANSBROAD,STCLASS=CONSTANT);
     1160    26438        /*E* ERROR:   VMO-E$ANSBROAD-0
     1161    26439             MESSAGE: It is not possible to ANSWER RECIEVERS a message
     1162    26440                      created with the BROADCAST option.
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:286  
     1163    26441        */
     1164    26442              %VLP_ERRCODE (FPTN=E_MEMERR,FCG="VM",MID="O",
     1165    26443              ERR#=%E$MEMERR,STCLASS=CONSTANT);
     1166    26488              %VLP_ERRCODE (FPTN=E_NEEDMID,FCG="VM",MID="O",
     1167    26489              ERR#=%E$NEEDMID,STCLASS=CONSTANT);
     1168    26534              %VLP_ERRCODE (FPTN=E_NOMORE,FCG="VM",MID="O",
     1169    26535              ERR#=%E$NOMORE,STCLASS=CONSTANT);
     1170    26580              %VLP_ERRCODE (FPTN=E_NOUPDATE,FCG="VM",MID="O",
     1171    26581              ERR#=%E$NOUPDATE,STCLASS=CONSTANT);
     1172    26626              %VLP_ERRCODE (FPTN=E_WERR,FCG="VM",MID="O",
     1173    26627              ERR#=%E$WERR,STCLASS=CONSTANT);
     1174    26672              %VLP_ERRCODE (FPTN=E_NOFILE,FCG="FM",MID="N",MON='1'B,
     1175    26673              ERR#=%E$NOFILE,STCLASS=CONSTANT);
     1176    26718              %VLP_ERRCODE (FPTN=E_BADRANGE,FCG="VM",MID="O",
     1177    26719              ERR#=%E$BADRANGE,STCLASS=CONSTANT);
     1178    26764        /*E* ERROR: VMO-E$BADRANGE
     1179    26765             MESSAGE: End of range is less than start.
     1180    26766        */
     1181    26767              %VLP_ERRCODE (FPTN=E_BIGNUM,FCG="VM",MID="O",
     1182    26768              ERR#=%E$BIGNUM,STCLASS=CONSTANT);
     1183    26813        /*E* ERROR: VMO-E$BIGNUM
     1184    26814             MESSAGE: Message number is too large.
     1185    26815        */
     1186    26816              %VLP_ERRCODE (FPTN=E_NEEDSEED,FCG="VM",MID="O",
     1187    26817              ERR#=%E$NEEDSEED,STCLASS=CONSTANT);
     1188    26862        /*E* ERROR: VMO-E$NEEDSEED
     1189    26863             MESSAGE:CRPT option must be specified for an encrypted message.
     1190    26864        */
     1191    26865              %VLP_ERRCODE (FPTN=E_DI_BADSEED,FCG="VM",MID="O",
     1192    26866              ERR#=%E$DI_BADSEED,STCLASS=CONSTANT);
     1193    26911        /*E* ERROR: VMO-E$DI_BADSEED
     1194    26912             MESSAGE:Incorrect decryption seed supplied; message body omitted.
     1195    26913        */
     1196    26914              %VLP_ERRCODE (FPTN=E_FWD_BADSEED,FCG="VM",MID="O",
     1197    26915              ERR#=%E$FWD_BADSEED,STCLASS=CONSTANT);
     1198    26960              %VLP_ERRCODE (FPTN=E_NOENCLS,FCG="VM",MID="O",
     1199    26961              ERR#=%E$NOENCLS,STCLASS=CONSTANT);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:287  
     1200    27006        /*E* ERROR: VMO-%E$NOENCLS
     1201    27007             MESSAGE:No enclosures are attached to this message.
     1202    27008        */
     1203    27009              %VLP_ERRCODE (FPTN=E_DETALLOWSONE,FCG="VM",MID="O",
     1204    27010              ERR#=%E$DETALLOWSONE,STCLASS=CONSTANT);
     1205    27055        /*E* ERROR: VMO-%E$DETALLOWSONE
     1206    27056             MESSAGE:Can't detach. Too many messages in the current context.
     1207    27057             MESSAGE1:The DETACH command operates on a single message and more
     1208    27058                       than one is in the current selection context. Set the context
     1209    27059                       using LIST, DISPLAY, or SELECT and try again.
     1210    27060        */
     1211    27061              %VLP_ERRCODE (FPTN=E_ENCLNOTFOUND,FCG="VM",MID="O",
     1212    27062              ERR#=%E$ENCLNOTFOUND,STCLASS=CONSTANT);
     1213    27107        /*E* ERROR: VMO-%E$ENCLNOTFOUND
     1214    27108             MESSAGE:Enclosure not found.
     1215    27109        */
     1216    27110              %VLP_ERRCODE (FPTN=E_ENCLDELETED,FCG="VM",MID="O",
     1217    27111              ERR#=%E$ENCLDELETED,STCLASS=CONSTANT);
     1218    27156        /*E* ERROR: VMO-%E$ENCLDELETED
     1219    27157             MESSAGE:Enclosure has already been deleted.
     1220    27158        */
     1221    27159              %VLP_ERRCODE (FPTN=E_ENCLBROKEN,FCG="VM",MID="O",
     1222    27160              ERR#=%E$ENCLBROKEN,STCLASS=CONSTANT);
     1223    27205        /*E* ERROR: VMO-%E$ENCLBROKEN
     1224    27206             MESSAGE:Wrong number of records. This enclosure may be broken.
     1225    27207             MESSAGE1: The number of enclosure records found is less than the
     1226    27208                       number specified. The data in this enclosure may be
     1227    27209                       unreliable.
     1228    27210        */
     1229    27211        /*E* ERROR: VMO-E$FWD_BADSEED
     1230    27212             MESSAGE:Incorrect decryption seed supplied.
     1231    27213        */
     1232    27214        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:288  
     1233    27215        /*
     1234    27216             ***** Initialize VM_CURRENT_FOLDER flags so
     1235    27217                   it is possible to report to mailman the
     1236    27218                   status of the current folder if we trap ...
     1237    27219        */
     1238    27220    1         VM_CURRENT_FOLDER.FLAGS = %NO#;

  27220 19 000002   001266 450000 11                 STZ     VM_CURRENT_FOLDER+19

     1239    27221        /*
     1240    27222             ***** Reset dcbs #1 - #4
     1241    27223                   they cause problems later when M$LINKing
     1242    27224                   to other processors ...
     1243    27225        */
     1244    27226    1       IF B$JIT.PRFLAGS.SI

  27226 19 000003   000000 470400 xsym               LDP0    B$JIT$
        19 000004   000030 234100                    SZN     24,,PR0
        19 000005   000012 605000 19                 TPL     IGNORE_YC1

     1245    27227    1       THEN
     1246    27228    1           CALL M$YC (RESET_#1) ALTRET(IGNORE_YC1);

  27228 19 000006   001742 630400 11                 EPPR0   RESET_#1
        19 000007   400011 713400                    CLIMB   alt,+9
        19 000010   401000 401760                    pmme    nvectors=3
        19 000011   000012 702000 19                 TSX2    IGNORE_YC1

     1247    27229    1   IGNORE_YC1:
     1248    27230
     1249    27231    1       IF B$JIT.PRFLAGS.UI

  27231 19 000012   000000 470400 xsym  IGNORE_YC1   LDP0    B$JIT$
        19 000013   000030 236100                    LDQ     24,,PR0
        19 000014   200000 316003                    CANQ    65536,DU
        19 000015   000022 600000 19                 TZE     IGNORE_YC2

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:289  
     1250    27232    1       THEN
     1251    27233    1           CALL M$YC (RESET_#2) ALTRET(IGNORE_YC2);

  27233 19 000016   001752 630400 11                 EPPR0   RESET_#2
        19 000017   400011 713400                    CLIMB   alt,+9
        19 000020   401000 401760                    pmme    nvectors=3
        19 000021   000022 702000 19                 TSX2    IGNORE_YC2

     1252    27234    1   IGNORE_YC2:
     1253    27235
     1254    27236    1       IF B$JIT.PRFLAGS.OU

  27236 19 000022   000000 470400 xsym  IGNORE_YC2   LDP0    B$JIT$
        19 000023   000030 236100                    LDQ     24,,PR0
        19 000024   100000 316003                    CANQ    32768,DU
        19 000025   000032 600000 19                 TZE     IGNORE_YC3

     1255    27237    1       THEN
     1256    27238    1           CALL M$YC (RESET_#3) ALTRET(IGNORE_YC3);

  27238 19 000026   001762 630400 11                 EPPR0   RESET_#3
        19 000027   400011 713400                    CLIMB   alt,+9
        19 000030   401000 401760                    pmme    nvectors=3
        19 000031   000032 702000 19                 TSX2    IGNORE_YC3

     1257    27239    1   IGNORE_YC3:
     1258    27240
     1259    27241    1       IF B$JIT.PRFLAGS.LS

  27241 19 000032   000000 470400 xsym  IGNORE_YC3   LDP0    B$JIT$
        19 000033   000030 236100                    LDQ     24,,PR0
        19 000034   040000 316003                    CANQ    16384,DU
        19 000035   000042 600000 19                 TZE     IGNORE_YC4

     1260    27242    1       THEN
     1261    27243    1           CALL M$YC (RESET_#4) ALTRET(IGNORE_YC4);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:290  
  27243 19 000036   001772 630400 11                 EPPR0   RESET_#4
        19 000037   400011 713400                    CLIMB   alt,+9
        19 000040   401000 401760                    pmme    nvectors=3
        19 000041   000042 702000 19                 TSX2    IGNORE_YC4

  27241 19 000042                       IGNORE_YC4   null
     1262    27244    1   IGNORE_YC4: ;
     1263    27245
     1264    27246        /*
     1265    27247             ***** How data segments are used in mail/send/mailman ...
     1266    27248
     1267    27249                   Segments used in all modules
     1268    27250                   ----------------------------
     1269    27251                   VM_ADDLIST
     1270    27252                      - used for building new address list (VMA$EXPAND_LIST).
     1271    27253
     1272    27254                   VM_HEADER
     1273    27255                      - used to contain the header of a message.
     1274    27256
     1275    27257                   VM_PROFILE
     1276    27258                      - used to contain the profile of a folder.
     1277    27259
     1278    27260                   VM_WORK
     1279    27261                      - used to contain list and user definitions when
     1280    27262                        expanding an address list.
     1281    27263
     1282    27264                   Segments used by only mail and send
     1283    27265                   -----------------------------------
     1284    27266                   VM_PARSEAREA
     1285    27267                      - used to contain input and parse info (XUR$GETCMD)
     1286    27268
     1287    27269                   VM_SELECT
     1288    27270                      - used to contain message selection contexts
     1289    27271                        Note: VM_SELECT shares a data segment with VM_PARSEAREA.
     1290    27272                        VM_SELECT occupies the first 1024 words and VM_PARSEAREA
     1291    27273                        the subsequent 2048 words (more if ADAPT needs memory).
     1292    27274
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:291  
     1293    27275        */
     1294    27276    1       CALL VMA$ENLARGE_SEGMENT (VM_HEADER_,1024) ALTRET(E_PMME);

  27276 19 000042   000002 630400 20                 EPPR0   2
        19 000043   000000 631400 20                 EPPR1   0
        19 000044   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 000045   001041 702000 19                 TSX2    E_PMME

     1295    27277    1       CALL VMA$ENLARGE_SEGMENT (VM_PROFILE_,1024) ALTRET(E_PMME);

  27277 19 000046   000004 630400 20                 EPPR0   4
        19 000047   000000 631400 20                 EPPR1   0
        19 000050   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 000051   001041 702000 19                 TSX2    E_PMME

     1296    27278    1       CALL VMA$ENLARGE_SEGMENT (VM_ADDLIST_,1024) ALTRET(E_PMME);

  27278 19 000052   000006 630400 20                 EPPR0   6
        19 000053   000000 631400 20                 EPPR1   0
        19 000054   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 000055   001041 702000 19                 TSX2    E_PMME

     1297    27279    1       CALL VMA$ENLARGE_SEGMENT (VM_WORK_,1024) ALTRET(E_PMME);

  27279 19 000056   000010 630400 20                 EPPR0   8
        19 000057   000000 631400 20                 EPPR1   0
        19 000060   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 000061   001041 702000 19                 TSX2    E_PMME

     1298    27280    1       CALL VMA$ENLARGE_SEGMENT (VM_SELECT_,1024) ALTRET(E_PMME);

  27280 19 000062   000012 630400 20                 EPPR0   10
        19 000063   000000 631400 20                 EPPR1   0
        19 000064   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 000065   001041 702000 19                 TSX2    E_PMME

     1299    27281    1       CALL VMA$ENLARGE_SEGMENT (VM_PARSEAREA_,2048) ALTRET(E_PMME);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:292  

  27281 19 000066   000015 630400 20                 EPPR0   13
        19 000067   000000 631400 20                 EPPR1   0
        19 000070   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 000071   001041 702000 19                 TSX2    E_PMME

     1300    27282    1       VBASE(VM_PARSEAREA_) = PINCRW(VBASE(VM_PARSEAREA_),(VBOUND(VM_SELECT_)+3)/4);

  27282 19 000072   000000 236000 xsym               LDQ     VM_SELECT_
        19 000073   000020 772000                    QRL     16
        19 000074   000003 036007                    ADLQ    3,DL
        19 000075   000002 772000                    QRL     2
        19 000076   000022 736000                    QLS     18
        19 000077   000001 036000 xsym               ADLQ    VM_PARSEAREA_+1
        19 000100   000001 756000 xsym               STQ     VM_PARSEAREA_+1

     1301    27283    1       VBOUND(VM_PARSEAREA_) = VBOUND(VM_PARSEAREA_) - (VBOUND(VM_SELECT_) + 1);

  27283 19 000101   000000 236000 xsym               LDQ     VM_SELECT_
        19 000102   000020 772000                    QRL     16
        19 000103   201706 756100                    STQ     I+100,,AUTO
        19 000104   000000 236000 xsym               LDQ     VM_PARSEAREA_
        19 000105   000020 772000                    QRL     16
        19 000106   201706 136100                    SBLQ    I+100,,AUTO
        19 000107   000001 136007                    SBLQ    1,DL
        19 000110   000020 736000                    QLS     16
        19 000111   000000 676000 xsym               ERQ     VM_PARSEAREA_
        19 000112   000017 376000 20                 ANQ     15
        19 000113   000000 656000 xsym               ERSQ    VM_PARSEAREA_

     1302    27284    1       CALL VMA$OPEN_ENCL_SEGS ALTRET(E_PMME);

  27284 19 000114   000020 631400 20                 EPPR1   16
        19 000115   000000 701000 xent               TSX1    VMA$OPEN_ENCL_SEGS
        19 000116   001041 702000 19                 TSX2    E_PMME

     1303    27285
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:293  
     1304    27286        /*
     1305    27287             ***** Initilization of XUR$GETCMD data ...
     1306    27288        */
     1307    27289    1       XUR_INIT.WORK_ = VM_PARSEAREA_;

  27289 19 000117   000000 237000 xsym               LDAQ    VM_PARSEAREA_
        19 000120   000023 755000 11                 STA     XUR_INIT+5
        19 000121   000024 756000 11                 STQ     XUR_INIT+6

     1308    27290    1       CALL XUR$INIT(XUR_INIT,,XUG_GETCMD$)

  27290 19 000122   200003 630500                    EPPR0   XUG_GETCMD$,,AUTO
        19 000123   201710 450500                    STP0    I+102,,AUTO
        19 000124   000022 236000 20                 LDQ     18
        19 000125   000023 235000 20                 LDA     19
        19 000126   201706 757100                    STAQ    I+100,,AUTO
        19 000127   201706 630500                    EPPR0   I+100,,AUTO
        19 000130   000021 631400 20                 EPPR1   17
        19 000131   000000 701000 xent               TSX1    XUR$INIT
        19 000132   000134 702000 19                 TSX2    s:27292
        19 000133   000136 710000 19                 TRA     s:27294

     1309    27291    2       WHENALTRETURN DO;

     1310    27292    2           CALL M$XXX;

  27292 19 000134   000003 713400                    CLIMB   3
        19 000135   000000 401760                    pmme    nvectors=0

     1311    27293    2       END;

     1312    27294    1       CALL XUR$SETERRMSG (ERRMSG_FID) ALTRET(E_PMME);

  27294 19 000136   000025 630400 20                 EPPR0   21
        19 000137   000024 631400 20                 EPPR1   20
        19 000140   000000 701000 xent               TSX1    XUR$SETERRMSG
        19 000141   001041 702000 19                 TSX2    E_PMME
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:294  

     1313    27295        /*
     1314    27296              Setup parse nodes for users native language.
     1315    27297        */
     1316    27298
     1317    27299    1       CALL VMD$GETNODES(VM_NATL_PAIRS,NODES$,VM_NODEFID,VM_NODENAMES);

  27299 19 000142   000030 237000 20                 LDAQ    24
        19 000143   201710 757100                    STAQ    I+102,,AUTO
        19 000144   200011 630500                    EPPR0   NODES$,,AUTO
        19 000145   201707 450500                    STP0    I+101,,AUTO
        19 000146   000027 236000 20                 LDQ     23
        19 000147   201706 756100                    STQ     I+100,,AUTO
        19 000150   201706 630500                    EPPR0   I+100,,AUTO
        19 000151   000026 631400 20                 EPPR1   22
        19 000152   000000 701000 xent               TSX1    VMD$GETNODES
        19 000153   000000 011000                    NOP     0

     1318    27300    1       MAIL_NODES$ = NODES_TO_USE (%PN_MAIL_NODES);

  27300 19 000154   200011 470500                    LDP0    NODES$,,AUTO
        19 000155   000000 236100                    LDQ     0,,PR0
        19 000156   200004 756100                    STQ     MAIL_NODES$,,AUTO

     1319    27301    1       MAIL_CMD$ = NODES_TO_USE (%PN_MAIL_CMD);

  27301 19 000157   000001 236100                    LDQ     1,,PR0
        19 000160   200006 756100                    STQ     MAIL_CMD$,,AUTO

     1320    27302    1       MODIFY_LIST$ = NODES_TO_USE (%PN_MODIFY_LIST);

  27302 19 000161   000002 236100                    LDQ     2,,PR0
        19 000162   200007 756100                    STQ     MODIFY_LIST$,,AUTO

     1321    27303    1       MODIFY_USER$ = NODES_TO_USE (%PN_MODIFY_USER);

  27303 19 000163   000003 236100                    LDQ     3,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:295  
        19 000164   200010 756100                    STQ     MODIFY_USER$,,AUTO

     1322    27304    1       SEND_CMD$ = NODES_TO_USE (%PN_SEND_CMD);

  27304 19 000165   000017 236100                    LDQ     15,,PR0
        19 000166   200005 756100                    STQ     SEND_CMD$,,AUTO

     1323    27305    1       VM_ADDRESS_SPEC$ = NODES_TO_USE (%PN_ADDRESS_SPEC);

  27305 19 000167   000032 236100                    LDQ     26,,PR0
        19 000170   000066 756000 11                 STQ     VM_ADDRESS_SPEC$

     1324    27306
     1325    27307        /*
     1326    27308             ***** Setup command input and echo dcbs ...
     1327    27309        */
     1328    27310    1       CALL M$OPEN (OPEN_COMMAND_STREAM_DEFAULT) ALTRET(E_PMME);

  27310 19 000171   001060 630400 12                 EPPR0   OPEN_COMMAND_STREAM_DEFAULT
        19 000172   450000 713400                    CLIMB   alt,open
        19 000173   410400 401760                    pmme    nvectors=18
        19 000174   001041 702000 19                 TSX2    E_PMME

     1329    27311    1       CALL XUR$SETDCBS (M$SI_NUM,M$ME_NUM);

  27311 19 000175   000032 630400 20                 EPPR0   26
        19 000176   000000 631400 20                 EPPR1   0
        19 000177   000000 701000 xent               TSX1    XUR$SETDCBS
        19 000200   000000 011000                    NOP     0

     1330    27312    1       CALL M$XCON(SET_XCON) ALTRET(E_PMME);

  27312 19 000201   002102 630400 11                 EPPR0   SET_XCON
        19 000202   410003 713400                    CLIMB   alt,+4099
        19 000203   400400 401760                    pmme    nvectors=2
        19 000204   001041 702000 19                 TSX2    E_PMME

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:296  
     1331    27313    1       CALL M$INT (FPT_INT) ALTRET(E_PMME);

  27313 19 000205   002076 630400 11                 EPPR0   FPT_INT
        19 000206   410002 713400                    CLIMB   alt,+4098
        19 000207   400000 401760                    pmme    nvectors=1
        19 000210   001041 702000 19                 TSX2    E_PMME

     1332    27314    1       CALL XUR$DISABLE;

  27314 19 000211   000020 631400 20                 EPPR1   16
        19 000212   000000 701000 xent               TSX1    XUR$DISABLE
        19 000213   000000 011000                    NOP     0

     1333    27315        /*
     1334    27316             ***** Open output stream (M$LO).
     1335    27317        */
     1336    27318    1       CALL M$OPEN (OPEN_OUTPUT_STREAM_DEFAULT) ALTRET(E_PMME);

  27318 19 000214   000766 630400 12                 EPPR0   OPEN_OUTPUT_STREAM_DEFAULT
        19 000215   450000 713400                    CLIMB   alt,open
        19 000216   410400 401760                    pmme    nvectors=18
        19 000217   001041 702000 19                 TSX2    E_PMME

     1337    27319
     1338    27320        /*
     1339    27321             ***** Get the user name of this user ...
     1340    27322        */
     1341    27323    1       USER_NAME.L# = LENGTHC(USER_NAME.NAME#);

  27323 19 000220   400000 236003                    LDQ     -131072,DU
        19 000221   004427 552040 11                 STBQ    USER_NAME,'40'O

     1342    27324    1       CALL VMF$FROM (USER_NAME) ALTRET(E_PMME);

  27324 19 000222   000034 630400 20                 EPPR0   28
        19 000223   000024 631400 20                 EPPR1   20
        19 000224   000000 701000 xent               TSX1    VMF$FROM
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:297  
        19 000225   001041 702000 19                 TSX2    E_PMME

     1343    27325        /*
     1344    27326             ***** Get the name of this site ...
     1345    27327        */
     1346    27328    1       KEY_VALUE='*IAM';

  27328 19 000226   001356 235000 12                 LDA     VM_PROKEY+1
        19 000227   000035 236000 20                 LDQ     29
        19 000230   200012 757100                    STAQ    KEY_VALUE,,AUTO

     1347    27329    1       CALL VMA$GET_SITE_NAME (KEY_VALUE,VM_SITENAME) ALTRET(E_PMME);

  27329 19 000231   000036 236000 20                 LDQ     30
        19 000232   201707 756100                    STQ     I+101,,AUTO
        19 000233   200012 630500                    EPPR0   KEY_VALUE,,AUTO
        19 000234   201706 450500                    STP0    I+100,,AUTO
        19 000235   201706 630500                    EPPR0   I+100,,AUTO
        19 000236   000000 631400 20                 EPPR1   0
        19 000237   000000 701000 xent               TSX1    VMA$GET_SITE_NAME
        19 000240   001041 702000 19                 TSX2    E_PMME

     1348    27330
     1349    27331        /*
     1350    27332             ***** Open mailcg so we can talk to mailman ...
     1351    27333        */
     1352    27334    1       CALL BINCHAR(VM_MAILCG_SETSTA.MYSTATION#,B$JIT.SYSID);

  27334 19 000241   000000 470400 xsym               LDP0    B$JIT$
        19 000242   000000 236100                    LDQ     0,,PR0
        19 000243   777777 376007                    ANQ     -1,DL
        19 000244   000000 235003                    LDA     0,DU
        19 000245   201706 757100                    STAQ    I+100,,AUTO
        19 000246   000000 301500                    BTD
        19 000247   201706 000010                    NDSC9   I+100,,AUTO              cn=0,s=lsgnf,sf=0,n=8
        19 000250   000000 030010 xsym               NDSC9   VM_MAILCG_SETSTA         cn=0,s=nosgn,sf=0,n=8

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:298  
     1353    27335    1       CALL INSERT(VM_MAILCG_SETSTA.MYSTATION#,0,4,'MAIL');

  27335 19 000251   001357 236000 12                 LDQ     VM_PROKEY+2
        19 000252   000000 756000 xsym               STQ     VM_MAILCG_SETSTA

     1354    27336    1       REMEMBER END_LOOP IN VMO_REMEMBER;

  27336 19 000253   000764 635000 19                 EAA     END_LOOP
        19 000254   000070 452400 11                 STP2    VMO_REMEMBER
        19 000255   000071 755000 11                 STA     VMO_REMEMBER+1

     1355    27337        /*
     1356    27338             ***** Setup the default search list.
     1357    27339                   Therefore, open :MAIL_CENTRAL.:MAIL
     1358    27340                   if it exists. Otherwise, an unregistered system ...
     1359    27341        */
     1360    27342    1       CALL VMA$OPEN_GLOBAL (M$MAIL_GLOBAL_NUM)

  27342 19 000256   000037 630400 20                 EPPR0   31
        19 000257   000024 631400 20                 EPPR1   20
        19 000260   000000 701000 xent               TSX1    VMA$OPEN_GLOBAL
        19 000261   000271 702000 19                 TSX2    s:27351

     1361    27343    1       WHENRETURN
     1362    27344    2       DO;

     1363    27345    2           VM_SEARCH_INFO.NUM_ENTRIES = 1;

  27345 19 000262   000001 235007                    LDA     1,DL
        19 000263   001570 755000 11                 STA     VM_SEARCH_INFO

     1364    27346    2           VM_SEARCH_INFO.DCB#(0) = M$MAIL_GLOBAL_NUM;

  27346 19 000264   000000 236000 xsym               LDQ     M$MAIL_GLOBAL_NUM
        19 000265   001571 756000 11                 STQ     VM_SEARCH_INFO+1

     1365    27347    2           VM_SEARCH_INFO.GLOBAL = '1'B;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:299  

  27347 19 000266   200000 236003                    LDQ     65536,DU
        19 000267   001632 256000 11                 ORSQ    VM_SEARCH_INFO+34

     1366    27348    2       END;

  27348 19 000270   000274 710000 19                 TRA     s:27357

     1367    27349    1       WHENALTRETURN
     1368    27350    2       DO;

     1369    27351    2           VM_SEARCH_INFO.NUM_ENTRIES = 0;

  27351 19 000271   001570 450000 11                 STZ     VM_SEARCH_INFO

     1370    27352    2           VM_SEARCH_INFO.GLOBAL = '0'B;

  27352 19 000272   000040 236000 20                 LDQ     32
        19 000273   001632 356000 11                 ANSQ    VM_SEARCH_INFO+34

     1371    27353    2       END;

     1372    27354        /*
     1373    27355             ***** Open the user's central folder ...
     1374    27356        */
     1375    27357    1       CALL VMB$FIND_DEFAULT (,USER_NAME,VM_CENTRAL_FOLDER,

  27357 19 000274   000042 236000 20                 LDQ     34
        19 000275   201712 756100                    STQ     I+104,,AUTO
        19 000276   000044 237000 20                 LDAQ    36
        19 000277   201710 757100                    STAQ    I+102,,AUTO
        19 000300   000034 236000 20                 LDQ     28
        19 000301   000022 235000 20                 LDA     18
        19 000302   201706 757100                    STAQ    I+100,,AUTO
        19 000303   201706 630500                    EPPR0   I+100,,AUTO
        19 000304   000041 631400 20                 EPPR1   33
        19 000305   000000 701000 xent               TSX1    VMB$FIND_DEFAULT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:300  
        19 000306   000423 702000 19                 TSX2    s:27395

     1376    27358    1         M$MAIL_CENTRAL_NUM,VM_SEARCH_INFO)
     1377    27359    2       WHENRETURN DO;

     1378    27360    2           CALL VMB$USE_DEFAULT (,USER_NAME,VM_CURRENT_FOLDER,M$MAIL_FILE_NUM,
             27360                    VM_SEARCH_INFO,,'1'B)

  27360 19 000307   000050 236000 20                 LDQ     40
        19 000310   201714 756100                    STQ     I+106,,AUTO
        19 000311   000022 236000 20                 LDQ     18
        19 000312   000042 235000 20                 LDA     34
        19 000313   201712 757100                    STAQ    I+104,,AUTO
        19 000314   000052 237000 20                 LDAQ    42
        19 000315   201710 757100                    STAQ    I+102,,AUTO
        19 000316   000034 236000 20                 LDQ     28
        19 000317   000022 235000 20                 LDA     18
        19 000320   201706 757100                    STAQ    I+100,,AUTO
        19 000321   201706 630500                    EPPR0   I+100,,AUTO
        19 000322   000046 631400 20                 EPPR1   38
        19 000323   000000 701000 xent               TSX1    VMB$USE_DEFAULT
        19 000324   000420 702000 19                 TSX2    s:27390

     1379    27361    3           WHENRETURN DO;

     1380    27362                            /* get profile, for srch list address resolution only */
     1381    27363    3               CALL VMD$GET_PROFILE(M$MAIL_FILE_NUM)

  27363 19 000325   000053 630400 20                 EPPR0   43
        19 000326   000024 631400 20                 EPPR1   20
        19 000327   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 000330   000332 702000 19                 TSX2    s:27365
        19 000331   000344 710000 19                 TRA     s:27369

     1382    27364    4               WHENALTRETURN DO;

     1383    27365    5                   DO INDX1=0 TO %VM_MAX_SRCH-1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:301  

  27365 19 000332   200033 450100                    STZ     INDX1,,AUTO
        19 000333   000341 710000 19                 TRA     s:27367+1

     1384    27366    5                       VM_PROFILE.SEARCH_LIST$(INDX1)=ADDR(NIL);

  27366 19 000334   000022 236000 20                 LDQ     18
        19 000335   000000 470400 xsym               LDP0    VM_PROFILE$
        19 000336   200033 720100                    LXL0    INDX1,,AUTO
        19 000337   000115 756110                    STQ     77,X0,PR0

     1385    27367    5                   END;

  27367 19 000340   200033 054100                    AOS     INDX1,,AUTO
        19 000341   200033 235100                    LDA     INDX1,,AUTO
        19 000342   000003 115007                    CMPA    3,DL
        19 000343   000334 604400 19                 TMOZ    s:27366

     1386    27368    4               END;

     1387    27369    3               VM_RADDRESS.NOMAD.FOLDER = VM_CURRENT_FOLDER.FOLDER;

  27369 19 000344   040100 100400                    MLR     fill='040'O
        19 000345   001246 400022 11                 ADSC9   VM_CURRENT_FOLDER+3      cn=2,n=18
        19 000346   200760 400022                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=18

     1388    27370    3               IF VM_PROFILE.FILE_FOLDER$ ~= ADDR(NIL)

  27370 19 000347   000000 470400 xsym               LDP0    VM_PROFILE$
        19 000350   000114 236100                    LDQ     76,,PR0
        19 000351   000022 116000 20                 CMPQ    18
        19 000352   000373 600000 19                 TZE     s:27377
        19 000353   000114 471500                    LDP1    76,,PR0
        19 000354   040000 106500                    CMPC    fill='040'O
        19 000355   100007 400031                    ADSC9   7,,PR1                   cn=2,n=25
        19 000356   001360 000007 12                 ADSC9   VM_PROKEY+3              cn=0,n=7
        19 000357   000373 601000 19                 TNZ     s:27377
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:302  
        19 000360   000000 473400 xsym               LDP3    B$JIT$
        19 000361   040100 106500                    CMPC    fill='040'O
        19 000362   100021 600010                    ADSC9   17,,PR1                  cn=3,n=8
        19 000363   300001 000010                    ADSC9   1,,PR3                   cn=0,n=8
        19 000364   000373 601000 19                 TNZ     s:27377

     1389    27371    3                 AND (VM_PROFILE.FILE_FOLDER$->VM$RADDRESS.FOLDER='CENTRAL')
     1390    27372    3                 AND (VM_PROFILE.FILE_FOLDER$->VM$RADDRESS.ACCT=B$JIT.ACCN)
     1391    27373    4               THEN DO;

     1392    27374    4                   VM_PROFILE.FILE_FOLDER$ = ADDR(NIL);

  27374 19 000365   000022 236000 20                 LDQ     18
        19 000366   000114 756100                    STQ     76,,PR0

     1393    27375    4                   CALL VMD$PUT_PROFILE(M$MAIL_FILE_NUM);

  27375 19 000367   000053 630400 20                 EPPR0   43
        19 000370   000024 631400 20                 EPPR1   20
        19 000371   000000 701000 xent               TSX1    VMD$PUT_PROFILE
        19 000372   000000 011000                    NOP     0

     1394    27376    4               END;

     1395    27377    3               VM_SEARCH_INFO.CURRENT = '1'B;

  27377 19 000373   100000 236003                    LDQ     32768,DU
        19 000374   001632 256000 11                 ORSQ    VM_SEARCH_INFO+34

     1396    27378    3               IF VM_CURRENT_FOLDER.ACCT ~= VM_MAIL_ACCT.ACCT#

  27378 19 000375   040000 106400                    CMPC    fill='040'O
        19 000376   001244 400010 11                 ADSC9   VM_CURRENT_FOLDER+1      cn=2,n=8
        19 000377   000000 000010 xsym               ADSC9   VM_MAIL_ACCT             cn=0,n=8
        19 000400   000413 600000 19                 TZE     s:27385
        19 000401   040000 106400                    CMPC    fill='040'O
        19 000402   001246 400031 11                 ADSC9   VM_CURRENT_FOLDER+3      cn=2,n=25
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:303  
        19 000403   001360 000007 12                 ADSC9   VM_PROKEY+3              cn=0,n=7
        19 000404   000413 600000 19                 TZE     s:27385
        19 000405   001570 235000 11                 LDA     VM_SEARCH_INFO
        19 000406   000413 600000 19                 TZE     s:27385

     1397    27379    3                 AND VM_CURRENT_FOLDER.FOLDER ~= 'CENTRAL'
     1398    27380    3                 AND VM_SEARCH_INFO.NUM_ENTRIES > 0
     1399    27381    4               THEN DO;

     1400    27382    4                   VM_SEARCH_INFO.NUM_ENTRIES = VM_SEARCH_INFO.NUM_ENTRIES+1;

  27382 19 000407   000001 035007                    ADLA    1,DL
        19 000410   001570 755000 11                 STA     VM_SEARCH_INFO

     1401    27383    4                   VM_SEARCH_INFO.DCB#(1) = VM_SEARCH_INFO.DCB#(0);

  27383 19 000411   001571 235000 11                 LDA     VM_SEARCH_INFO+1
        19 000412   001572 755000 11                 STA     VM_SEARCH_INFO+2

     1402    27384    4               END;

     1403    27385    3               VM_SEARCH_INFO.DCB#(0) = M$MAIL_FILE_NUM;

  27385 19 000413   000000 235000 xsym               LDA     M$MAIL_FILE_NUM
        19 000414   001571 755000 11                 STA     VM_SEARCH_INFO+1

     1404    27386        /* Only open for command line use resolution, so make it look closed */
     1405    27387    3               VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B;

  27387 19 000415   000054 236000 20                 LDQ     44
        19 000416   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     1406    27388    3           END;

  27388 19 000417   000422 710000 19                 TRA     s:27392

     1407    27389    3           WHENALTRETURN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:304  

     1408    27390    3               VM_SEARCH_INFO.CURRENT = '0'B;

  27390 19 000420   000055 236000 20                 LDQ     45
        19 000421   001632 356000 11                 ANSQ    VM_SEARCH_INFO+34

     1409    27391    3           END;

     1410    27392    2       END;

  27392 19 000422   000425 710000 19                 TRA     s:27398

     1411    27393    1       WHENALTRETURN
     1412    27394    2       DO;

     1413    27395    2           VM_SEARCH_INFO.CURRENT = '0'B;

  27395 19 000423   000055 236000 20                 LDQ     45
        19 000424   001632 356000 11                 ANSQ    VM_SEARCH_INFO+34

     1414    27396                                                /* ??? */
     1415    27397    2       END;

     1416    27398    1       IF ~ VM_SEARCH_INFO.CURRENT

  27398 19 000425   001632 236000 11                 LDQ     VM_SEARCH_INFO+34
        19 000426   000002 736000                    QLS     2
        19 000427   400000 376003                    ANQ     -131072,DU
        19 000430   400000 676003                    ERQ     -131072,DU
        19 000431   000444 600000 19                 TZE     s:27407

     1417    27399    2       THEN DO;

     1418    27400    3           DO INDX1=0 TO %VM_MAX_SRCH-1;

  27400 19 000432   200033 450100                    STZ     INDX1,,AUTO
        19 000433   000441 710000 19                 TRA     s:27402+1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:305  

     1419    27401    3               VM_PROFILE.SEARCH_LIST$(INDX1)=ADDR(NIL);

  27401 19 000434   000022 236000 20                 LDQ     18
        19 000435   000000 470400 xsym               LDP0    VM_PROFILE$
        19 000436   200033 720100                    LXL0    INDX1,,AUTO
        19 000437   000115 756110                    STQ     77,X0,PR0

     1420    27402    3           END;

  27402 19 000440   200033 054100                    AOS     INDX1,,AUTO
        19 000441   200033 235100                    LDA     INDX1,,AUTO
        19 000442   000003 115007                    CMPA    3,DL
        19 000443   000434 604400 19                 TMOZ    s:27401

     1421    27403    2       END;

     1422    27404        /*
     1423    27405             ***** Parse the invocation line ...
     1424    27406        */
     1425    27407    1       OUTBUF = B$JIT.CCBUF;

  27407 19 000444   000000 470400 xsym               LDP0    B$JIT$
        19 000445   040000 100500                    MLR     fill='040'O
        19 000446   000033 000400                    ADSC9   27,,PR0                  cn=0,n=256
        19 000447   000422 000454 11                 ADSC9   OUTBUF                   cn=0,n=300

     1426    27408    1       SIZE = B$JIT.CCARS;

  27408 19 000450   000032 236100                    LDQ     26,,PR0
        19 000451   000022 732000                    QRS     18
        19 000452   000535 756000 11                 STQ     SIZE

     1427    27409    1       CALL XUR$GETCMD(MAIL_CMD$->BSD,OUT$,MAIL_PROMPT,OUTBUF,SIZE) ALTRET(E_INVOKE);

  27409 19 000453   000056 236000 20                 LDQ     46
        19 000454   201712 756100                    STQ     I+104,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:306  
        19 000455   000060 237000 20                 LDAQ    48
        19 000456   201710 757100                    STAQ    I+102,,AUTO
        19 000457   200023 631500                    EPPR1   OUT$,,AUTO
        19 000460   201707 451500                    STP1    I+101,,AUTO
        19 000461   200006 236100                    LDQ     MAIL_CMD$,,AUTO
        19 000462   201706 756100                    STQ     I+100,,AUTO
        19 000463   201706 630500                    EPPR0   I+100,,AUTO
        19 000464   000041 631400 20                 EPPR1   33
        19 000465   000000 701000 xent               TSX1    XUR$GETCMD
        19 000466   000470 702000 19                 TSX2    E_INVOKE

     1428    27410    2       DO NEVER;

  27410 19 000467   000503 710000 19                 TRA     s:27416

     1429    27411    2   E_INVOKE:
     1430    27412    2           CALL XUR$ERRPTR;

  27412 19 000470   000020 631400 20    E_INVOKE     EPPR1   16
        19 000471   000000 701000 xent               TSX1    XUR$ERRPTR
        19 000472   000000 011000                    NOP     0

     1431    27413    2           CALL XUR$ERRMSG (OUTERR);

  27413 19 000473   200023 630500                    EPPR0   OUT$,,AUTO
        19 000474   201706 450500                    STP0    I+100,,AUTO
        19 000475   201706 630500                    EPPR0   I+100,,AUTO
        19 000476   000024 631400 20                 EPPR1   20
        19 000477   000000 701000 xent               TSX1    XUR$ERRMSG
        19 000500   000000 011000                    NOP     0

     1432    27414    2           CALL M$EXIT;

  27414 19 000501   000001 713400                    CLIMB   exit
        19 000502   000000 401760                    pmme    nvectors=0

     1433    27415    2       END;                            /* Do never ... end */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:307  

     1434    27416    1       CURR_COMMAND_CODE = OUT$ -> P$B.CODE;

  27416 19 000503   200023 470500                    LDP0    OUT$,,AUTO
        19 000504   000000 236100                    LDQ     0,,PR0
        19 000505   777777 376007                    ANQ     -1,DL
        19 000506   000543 756000 11                 STQ     CURR_COMMAND_CODE

     1435    27417        /*
     1436    27418          ***** Write greeting thru(M$ME).
     1437    27419        */
     1438    27420    1       IF B$JIT.NEXTCC = %CC_FROMUC#

  27420 19 000507   000000 471400 xsym               LDP1    B$JIT$
        19 000510   100151 236100                    LDQ     105,,PR1
        19 000511   000777 376003                    ANQ     511,DU
        19 000512   000003 116003                    CMPQ    3,DU
        19 000513   000536 601000 19                 TNZ     s:27454

     1439    27421    1       THEN                            /* Greet the user */
     1440    27422    2       DO;

     1441    27423    2           F_FDSME.NVECS# = 1;

  27423 19 000514   000001 235007                    LDA     1,DL
        19 000515   002755 755000 11                 STA     F_FDSME+9

     1442    27424    2           VECT_ARRAY(0) = VECTOR (ADDR(B_VERSION) -> B$VERSION);

  27424 19 000516   000000 236000 xsym               LDQ     B_VERSION
        19 000517   000033 772000                    QRL     27
        19 000520   000001 620006                    EAX0    1,QL
        19 000521   000000 635010                    EAA     0,X0
        19 000522   000002 771000                    ARL     2
        19 000523   000140 135007                    SBLA    96,DL
        19 000524   000062 236000 20                 LDQ     50
        19 000525   003076 757000 11                 STAQ    VECT_ARRAY
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:308  

     1443    27425                %INIT_STR (CODE=E_GREETING_FMT, STR=VM_GREETING_FMT,
     1444    27426                VECT="F_FDSME.FMT_" );

  27441 19 000526   000063 630400 20                 EPPR0   51
        19 000527   000021 631400 20                 EPPR1   17
        19 000530   000000 701000 xent               TSX1    VMD$ERRMSG
        19 000531   000000 011000                    NOP     0

     1445    27449    2           CALL VMD$WRITE_BUF (F_FDSME);

  27449 19 000532   000065 630400 20                 EPPR0   53
        19 000533   000024 631400 20                 EPPR1   20
        19 000534   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 000535   000000 011000                    NOP     0

     1446    27450    2       END;

     1447    27451        /*
     1448    27452             ***** Initialize the selection criteria contexts ...
     1449    27453        */
     1450    27454    1       CALL INIT_CONTEXT (%CONTEXT_CURRENT);

  27454 19 000536   000066 236000 20                 LDQ     54
        19 000537   201123 756100                    STQ     LEN+1,,AUTO
        19 000540   017442 701000 19                 TSX1    INIT_CONTEXT
        19 000541   000000 011000                    NOP     0

     1451    27455    1       CALL INIT_CONTEXT (%CONTEXT_SELECTED);

  27455 19 000542   000070 236000 20                 LDQ     56
        19 000543   201123 756100                    STQ     LEN+1,,AUTO
        19 000544   017442 701000 19                 TSX1    INIT_CONTEXT
        19 000545   000000 011000                    NOP     0

     1452    27456        /*
     1453    27457             ***** Init other variables, flags ...
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:309  
     1454    27458        */
     1455    27459    1       EXIT_MAIL# = %NO#;

  27459 19 000546   000417 450000 11                 STZ     EXIT_MAIL#

     1456    27460    1       OPT_NOUPDATE = %NO#;

  27460 19 000547   201106 450100                    STZ     OPT_NOUPDATE,,AUTO

     1457    27461    1       OPT_BYPASS = %NO#;

  27461 19 000550   201105 450100                    STZ     OPT_BYPASS,,AUTO

     1458    27462    1       MADE_OLD = %NO#;

  27462 19 000551   200040 450100                    STZ     MADE_OLD,,AUTO

     1459    27463    1       DELETE_ENCL_FLAG = %NO#;

  27463 19 000552   201113 450100                    STZ     DELETE_ENCL_FLAG,,AUTO

     1460    27464        /*
     1461    27465             ***** Enable breaks now ...
     1462    27466        */
     1463    27467    1       CALL XUR$CLRENABLE;

  27467 19 000553   000020 631400 20                 EPPR1   16
        19 000554   000000 701000 xent               TSX1    XUR$CLRENABLE
        19 000555   000000 011000                    NOP     0

     1464    27468    1       CALL PROCESS_CMD (CURR_COMMAND_CODE);

  27468 19 000556   000071 236000 20                 LDQ     57
        19 000557   201115 756100                    STQ     DELETE_ENCL_FLAG+2,,AUTO
        19 000560   001055 701000 19                 TSX1    PROCESS_CMD
        19 000561   000000 011000                    NOP     0

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:310  
     1465    27469        /*
     1466    27470             ***** Now prompt the user for commands ...
     1467    27471        */
     1468    27472
     1469    27473    2       DO FOREVER;

     1470    27474        /*
     1471    27475             ***** Get the next command ...
     1472    27476        */
     1473    27477    2           IF NEXT_COMMAND_TEXT.L# ~= 0 /* An internal command */

  27477 19 000562   200551 236100                    LDQ     NEXT_COMMAND_TEXT,,AUTO
        19 000563   777000 316003                    CANQ    -512,DU
        19 000564   000632 600000 19                 TZE     s:27498

     1474    27478    2           THEN
     1475    27479    3           DO;

     1476    27480    3               INDX1 = NEXT_COMMAND_TEXT.L#;

  27480 19 000565   200551 236100                    LDQ     NEXT_COMMAND_TEXT,,AUTO
        19 000566   000033 772000                    QRL     27
        19 000567   200033 756100                    STQ     INDX1,,AUTO

     1477    27481    3               CALL XUR$GETCMD (MAIL_NODES$->BSD,OUT$,,NEXT_COMMAND_TEXT.NAME#,

  27481 19 000570   200033 630500                    EPPR0   INDX1,,AUTO
        19 000571   201712 450500                    STP0    I+104,,AUTO
        19 000572   201713 452500                    STP2    I+105,,AUTO
        19 000573   201713 236100                    LDQ     I+105,,AUTO
        19 000574   000072 036000 20                 ADLQ    58
        19 000575   000022 235000 20                 LDA     18
        19 000576   201710 757100                    STAQ    I+102,,AUTO
        19 000577   200023 631500                    EPPR1   OUT$,,AUTO
        19 000600   201707 451500                    STP1    I+101,,AUTO
        19 000601   200004 236100                    LDQ     MAIL_NODES$,,AUTO
        19 000602   201706 756100                    STQ     I+100,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:311  
        19 000603   201706 630500                    EPPR0   I+100,,AUTO
        19 000604   000041 631400 20                 EPPR1   33
        19 000605   000000 701000 xent               TSX1    XUR$GETCMD
        19 000606   000610 702000 19                 TSX2    s:27483
        19 000607   000620 710000 19                 TRA     s:27488

     1478    27482    4                 INDX1) WHENALTRETURN DO;

     1479    27483    4                   CALL XUR$ECHO (M$ME_NUM);

  27483 19 000610   000033 630400 20                 EPPR0   27
        19 000611   000024 631400 20                 EPPR1   20
        19 000612   000000 701000 xent               TSX1    XUR$ECHO
        19 000613   000000 011000                    NOP     0

     1480    27484    4                   NEXT_COMMAND_ECHO# = %NO#;

  27484 19 000614   000542 450000 11                 STZ     NEXT_COMMAND_ECHO#

     1481    27485    4                   NEXT_COMMAND_TEXT.L# = 0;

  27485 19 000615   000000 236003                    LDQ     0,DU
        19 000616   200551 552140                    STBQ    NEXT_COMMAND_TEXT,'40'O,AUTO

     1482    27486    4                   GOTO XUR_ERROR;

  27486 19 000617   000703 710000 19                 TRA     XUR_ERROR

     1483    27487    4               END;
     1484    27488    3               IF NEXT_COMMAND_ECHO#

  27488 19 000620   000542 234000 11                 SZN     NEXT_COMMAND_ECHO#
        19 000621   000626 605000 19                 TPL     s:27491

     1485    27489    3               THEN
     1486    27490    3                   CALL XUR$ECHO (M$ME_NUM);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:312  
  27490 19 000622   000033 630400 20                 EPPR0   27
        19 000623   000024 631400 20                 EPPR1   20
        19 000624   000000 701000 xent               TSX1    XUR$ECHO
        19 000625   000000 011000                    NOP     0

     1487    27491    3               NEXT_COMMAND_ECHO# = %NO#;

  27491 19 000626   000542 450000 11                 STZ     NEXT_COMMAND_ECHO#

     1488    27492    3               NEXT_COMMAND_TEXT.L# = 0;

  27492 19 000627   000000 236003                    LDQ     0,DU
        19 000630   200551 552140                    STBQ    NEXT_COMMAND_TEXT,'40'O,AUTO

     1489    27493
     1490    27494    3           END;

  27494 19 000631   000667 710000 19                 TRA     s:27508

     1491    27495    2           ELSE
     1492    27496    3           DO;

     1493    27497        /* Check for new mail */
     1494    27498    3               IF VM_CURRENT_FOLDER.FLAGS.OPEN

  27498 19 000632   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 000633   010000 316003                    CANQ    4096,DU
        19 000634   000655 600000 19                 TZE     s:27506

     1495    27499    4               THEN DO;

     1496    27500    4                   CALL CHECK_NEW (M$MAIL_FILE_NUM);

  27500 19 000635   000053 236000 20                 LDQ     43
        19 000636   201523 756100                    STQ     INDX2+255,,AUTO
        19 000637   021327 701000 19                 TSX1    CHECK_NEW
        19 000640   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:313  

     1497    27501    5                   IF NEW_FLAG THEN DO;

  27501 19 000641   000377 234000 11                 SZN     NEW_FLAG
        19 000642   000655 605000 19                 TPL     s:27506

     1498    27502    5                       CALL XUR$INFOMSG (E_NEW_MESSAGE_FMT,,M$ME_NUM);

  27502 19 000643   000033 236000 20                 LDQ     27
        19 000644   201710 756100                    STQ     I+102,,AUTO
        19 000645   000022 236000 20                 LDQ     18
        19 000646   000073 235000 20                 LDA     59
        19 000647   201706 757100                    STAQ    I+100,,AUTO
        19 000650   201706 630500                    EPPR0   I+100,,AUTO
        19 000651   000021 631400 20                 EPPR1   17
        19 000652   000000 701000 xent               TSX1    XUR$INFOMSG
        19 000653   000000 011000                    NOP     0

     1499    27503    5                       NEW_FLAG = '0'B;

  27503 19 000654   000377 450000 11                 STZ     NEW_FLAG

     1500    27504    5                   END;

     1501    27505    4               END;

     1502    27506    3               CALL XUR$GETCMD(MAIL_NODES$->BSD,OUT$,MAIL_PROMPT)ALTRET(XUR_ERROR);

  27506 19 000655   000060 236000 20                 LDQ     48
        19 000656   201710 756100                    STQ     I+102,,AUTO
        19 000657   200023 630500                    EPPR0   OUT$,,AUTO
        19 000660   201707 450500                    STP0    I+101,,AUTO
        19 000661   200004 236100                    LDQ     MAIL_NODES$,,AUTO
        19 000662   201706 756100                    STQ     I+100,,AUTO
        19 000663   201706 630500                    EPPR0   I+100,,AUTO
        19 000664   000021 631400 20                 EPPR1   17
        19 000665   000000 701000 xent               TSX1    XUR$GETCMD
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:314  
        19 000666   000703 702000 19                 TSX2    XUR_ERROR

     1503    27507    3           END;

     1504    27508    2           IF OUT$ = ADDR(NIL) THEN GOTO END_LOOP;

  27508 19 000667   200023 236100                    LDQ     OUT$,,AUTO
        19 000670   000022 116000 20                 CMPQ    18
        19 000671   000764 600000 19                 TZE     END_LOOP

     1505    27509    2           CURR_COMMAND_CODE = OUT$ -> P$B.CODE;

  27509 19 000672   200023 470500                    LDP0    OUT$,,AUTO
        19 000673   000000 236100                    LDQ     0,,PR0
        19 000674   777777 376007                    ANQ     -1,DL
        19 000675   000543 756000 11                 STQ     CURR_COMMAND_CODE

     1506    27510
     1507    27511    2           CALL PROCESS_CMD (CURR_COMMAND_CODE);

  27511 19 000676   000071 236000 20                 LDQ     57
        19 000677   201115 756100                    STQ     DELETE_ENCL_FLAG+2,,AUTO
        19 000700   001055 701000 19                 TSX1    PROCESS_CMD
        19 000701   000000 011000                    NOP     0

     1508    27512    3           DO NEVER;

  27512 19 000702   000764 710000 19                 TRA     END_LOOP

     1509    27513    3   XUR_ERROR :                             /* Error parsing command */
     1510    27514    4               DO SELECT (OUTERR.ERR#);

  27514 19 000703   200023 236100       XUR_ERROR    LDQ     OUT$,,AUTO
        19 000704   000003 772000                    QRL     3
        19 000705   037777 376007                    ANQ     16383,DL
        19 000706   000006 116007                    CMPQ    6,DL
        19 000707   000753 602000 19                 TNC     s:27565
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:315  
        19 000710   000715 600000 19                 TZE     s:27523
        19 000711   000003 736000                    QLS     3
        19 000712   000140 116007                    CMPQ    96,DL
        19 000713   000753 601000 19                 TNZ     s:27565
        19 000714   000715 710000 19                 TRA     s:27523

     1511    27515
     1512    27516    4                   SELECT (%E$EOF, %E$LDSC);

     1513    27517        /*
     1514    27518             ***** If an end-of-file is found, and we were reading from a command
     1515    27519                    file (M$CMNDF is open), close the file and commence reading
     1516    27520                   from the command stream (M$SI).  If line disconnects, and we're
     1517    27521                   reading from the terminal, then act like user entered 'END'.
     1518    27522        */
     1519    27523    4                   IF DCBADDR(M$CMNDF_NUM) -> F$DCB.FCD# = %NO#

  27523 19 000715   000074 470400 20                 LDP0    60
        19 000716   000000 471500                    LDP1    0,,PR0
        19 000717   000545 720000 11                 LXL0    M$CMNDF_NUM
        19 000720   100000 473510                    LDP3    0,X0,PR1
        19 000721   300031 236100                    LDQ     25,,PR3
        19 000722   020000 316007                    CANQ    8192,DL
        19 000723   000734 601000 19                 TNZ     s:27553

     1520    27524    4                   THEN
     1521    27525    5                   DO;   /* Exit */

     1522    27526                            %INIT_STR (CODE=E_END_CMD, STR=VM_END_CMD, NEXT_CMD=
             27526                                NEXT_COMMAND_TEXT);

  27541 19 000724   000075 630400 20                 EPPR0   61
        19 000725   000000 631400 20                 EPPR1   0
        19 000726   000000 701000 xent               TSX1    VMD$ERRMSG
        19 000727   000000 011000                    NOP     0

  27544 19 000730   000100 100400                    MLR     fill='000'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:316  
        19 000731   004676 000020 11                 ADSC9   VM_END_CMD               cn=0,n=16
        19 000732   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

     1523    27549    5                       GOTO END_LOOP;

  27549 19 000733   000764 710000 19                 TRA     END_LOOP

     1524    27550    5                   END;
     1525    27551    4                   ELSE
     1526    27552    5                   DO;   /* Connect back to command stream */

     1527    27553    5                       CLOSE_SAVE.V.DCB# = M$CMNDF_NUM;

  27553 19 000734   002142 740000 11                 STX0    CLOSE_SAVE+26

     1528    27554    5                       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  27554 19 000735   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 000736   450001 713400                    CLIMB   alt,close
        19 000737   406000 401760                    pmme    nvectors=13
        19 000740   001041 702000 19                 TSX2    E_PMME

     1529    27555    5                       CALL XUR$SETDCBS (M$SI_NUM);

  27555 19 000741   000032 630400 20                 EPPR0   26
        19 000742   000024 631400 20                 EPPR1   20
        19 000743   000000 701000 xent               TSX1    XUR$SETDCBS
        19 000744   000000 011000                    NOP     0

     1530    27556    5                       IF EXIT_MAIL_PEND#

  27556 19 000745   000420 234000 11                 SZN     EXIT_MAIL_PEND#
        19 000746   000764 605000 19                 TPL     END_LOOP

     1531    27557    6                       THEN DO;

     1532    27558    6                           EXIT_MAIL_PEND# = '0'B;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:317  

  27558 19 000747   000420 450000 11                 STZ     EXIT_MAIL_PEND#

     1533    27559    6                           EXIT_MAIL# = '1'B;

  27559 19 000750   400000 236003                    LDQ     -131072,DU
        19 000751   000417 756000 11                 STQ     EXIT_MAIL#

     1534    27560    6                           GOTO END_LOOP;

  27560 19 000752   000764 710000 19                 TRA     END_LOOP

     1535    27561    6                       END;
     1536    27562    5                   END;
     1537    27563
     1538    27564    4                   SELECT (ELSE);   /* Report the error */

     1539    27565    4               CALL XUR$ERRPTR;

  27565 19 000753   000020 631400 20                 EPPR1   16
        19 000754   000000 701000 xent               TSX1    XUR$ERRPTR
        19 000755   000000 011000                    NOP     0

     1540    27566    4               CALL XUR$ERRMSG (OUTERR);

  27566 19 000756   200023 630500                    EPPR0   OUT$,,AUTO
        19 000757   201706 450500                    STP0    I+100,,AUTO
        19 000760   201706 630500                    EPPR0   I+100,,AUTO
        19 000761   000024 631400 20                 EPPR1   20
        19 000762   000000 701000 xent               TSX1    XUR$ERRMSG
        19 000763   000000 011000                    NOP     0

     1541    27567    4               END;

     1542    27568    3           END;                       /* Do never ... end */

     1543    27569    2   END_LOOP:
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:318  
     1544    27570        /*
     1545    27571             *****  Reset output DCB for display and list commands ...
     1546    27572        */
     1547    27573    2           F_FDSLO.DCB# = M$LO_NUM;

  27573 19 000764   000000 720000 xsym  END_LOOP     LXL0    M$LO_NUM
        19 000765   003053 740000 11                 STX0    F_FDSLO+11

     1548    27574    2           IF OUTDCB ~= M$LO_NUM

  27574 19 000766   000402 236000 11                 LDQ     OUTDCB
        19 000767   000000 116000 xsym               CMPQ    M$LO_NUM
        19 000770   001010 600000 19                 TZE     s:27587

     1549    27575    3           THEN DO;

     1550    27576    3               IF DCBADDR(OUTDCB) -> F$DCB.FCD#

  27576 19 000771   000074 470400 20                 LDP0    60
        19 000772   000000 471500                    LDP1    0,,PR0
        19 000773   100000 473506                    LDP3    0,QL,PR1
        19 000774   300031 236100                    LDQ     25,,PR3
        19 000775   020000 316007                    CANQ    8192,DL
        19 000776   001006 600000 19                 TZE     s:27581

     1551    27577    4               THEN DO;

     1552    27578    4                   CLOSE_SAVE.V.DCB# = OUTDCB;

  27578 19 000777   000402 721000 11                 LXL1    OUTDCB
        19 001000   002142 741000 11                 STX1    CLOSE_SAVE+26

     1553    27579    5                   CALL M$CLOSE (CLOSE_SAVE) WHENALTRETURN DO; END;

  27579 19 001001   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 001002   450001 713400                    CLIMB   alt,close
        19 001003   406000 401760                    pmme    nvectors=13
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:319  
        19 001004   001006 702000 19                 TSX2    s:27581
        19 001005   001006 710000 19                 TRA     s:27581

     1554    27580    4               END;

     1555    27581    3               OUTDCB = M$LO_NUM;

  27581 19 001006   000000 235000 xsym               LDA     M$LO_NUM
        19 001007   000402 755000 11                 STA     OUTDCB

     1556    27582    3           END;

     1557    27583        /*
     1558    27584             ***** If EXIT_MAIL# is set and no messages have
     1559    27585                   been processed, then get out of here ...
     1560    27586        */
     1561    27587    2           IF EXIT_MAIL#

  27587 19 001010   000417 234000 11                 SZN     EXIT_MAIL#
        19 001011   001035 605000 19                 TPL     s:27646

     1562    27588    2           THEN
     1563    27589    3           DO;

     1564    27590    3               EXIT_MAIL# = %NO#;

  27590 19 001012   000417 450000 11                 STZ     EXIT_MAIL#

     1565    27591    3               IF NUM_MESSAGES_PROCESSED = 0

  27591 19 001013   201101 235100                    LDA     NUM_MESSAGES_PROCESSED,,AUTO
        19 001014   001024 601000 19                 TNZ     s:27618

     1566    27592    3               THEN
     1567    27593    4               DO;

     1568    27594                        %INIT_STR (CODE=E_END_CMD, STR=VM_END_CMD, NEXT_CMD=
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:320  
             27594                            NEXT_COMMAND_TEXT);

  27609 19 001015   000075 630400 20                 EPPR0   61
        19 001016   000000 631400 20                 EPPR1   0
        19 001017   000000 701000 xent               TSX1    VMD$ERRMSG
        19 001020   000000 011000                    NOP     0

  27612 19 001021   000100 100400                    MLR     fill='000'O
        19 001022   004676 000020 11                 ADSC9   VM_END_CMD               cn=0,n=16
        19 001023   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

     1569    27617    4               END;

     1570    27618    3               IF OPT_NOUPDATE

  27618 19 001024   201106 234100                    SZN     OPT_NOUPDATE,,AUTO
        19 001025   001035 605000 19                 TPL     s:27646

     1571    27619    3               THEN
     1572    27620    4               DO;

     1573    27621                        %INIT_STR (CODE=E_END_NOUPDATE_CMD, STR=VM_END_NOUPDATE_CMD,
             27621                            NEXT_CMD=NEXT_COMMAND_TEXT);

  27636 19 001026   000077 630400 20                 EPPR0   63
        19 001027   000000 631400 20                 EPPR1   0
        19 001030   000000 701000 xent               TSX1    VMD$ERRMSG
        19 001031   000000 011000                    NOP     0

  27639 19 001032   000100 100400                    MLR     fill='000'O
        19 001033   004602 000020 11                 ADSC9   VM_END_NOUPDATE_CMD      cn=0,n=16
        19 001034   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

     1574    27644    4               END;

     1575    27645    3           END;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:321  
     1576    27646    2           CALL XUR$ENABLE;

  27646 19 001035   000020 631400 20                 EPPR1   16
        19 001036   000000 701000 xent               TSX1    XUR$ENABLE
        19 001037   000000 011000                    NOP     0

     1577    27647    2       END;                            /* Do forever */

  27647 19 001040   000562 710000 19                 TRA     s:27477

     1578    27648    1   E_PMME:
     1579    27649    1       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  27649 19 001041   000000 470400 xsym  E_PMME       LDP0    B$TCB$
        19 001042   000000 471500                    LDP1    0,,PR0
        19 001043   100102 236100                    LDQ     66,,PR1
        19 001044   002204 756000 11                 STQ     ERROR

     1580    27650    1       DCB# = B$TCB.ALT$ -> B$ALT.DCB#;

  27650 19 001045   000000 471500                    LDP1    0,,PR0
        19 001046   100101 235100                    LDA     65,,PR1
        19 001047   000401 755000 11                 STA     DCB#

     1581    27651    1       CALL XUR$ERRMSG (ERROR,DCB#);

  27651 19 001050   000101 630400 20                 EPPR0   65
        19 001051   000000 631400 20                 EPPR1   0
        19 001052   000000 701000 xent               TSX1    XUR$ERRMSG
        19 001053   000000 011000                    NOP     0
        19 001054   025342 710000 19                 TRA     s:34337

     1582    27652        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:322  
     1583    27653        /********************************************************************/
     1584    27654        /*F*    NAME:        PROCESS_CMD
     1585    27655                PURPOSE:     To process all MAIL commands.
     1586    27656                DESCRIPTION: This routine processes all MAIL commands.
     1587    27657                             The command to be processed is in CURR_COMMAND_CODE.
     1588    27658                             If there are any options for this command then
     1589    27659                             OUT$ will be non-nil. If there are no options
     1590    27660                             specified then use any options remaining from
     1591    27661                             previous commands. This mainly applies only to
     1592    27662                             SELECTION CLAUSES.
     1593    27663        */
     1594    27664        /********************************************************************/
     1595    27665    1   PROCESS_CMD: PROC (CURR_COMMAND_CODE);

  27665 19 001055   201114 741300       PROCESS_CMD  STX1  ! DELETE_ENCL_FLAG+1,,AUTO

     1596    27666
     1597    27667    2   DCL CURR_COMMAND_CODE UBIN WORD;
     1598    27668        /*
     1599    27669             ***** Initialization needed for each command ...
     1600    27670        */
     1601    27671    2       WHICH_CONTEXT = %CONTEXT_CURRENT; /* Default context to use */

  27671 19 001056   001667 450000 11                 STZ     WHICH_CONTEXT

     1602    27672    2       CURRENT_CONTEXT%.SET_INDX = -1;

  27672 19 001057   000001 335007                    LCA     1,DL
        19 001060   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 001061   000003 755100                    STA     3,,PR0

     1603    27673    2       SELECTED_CONTEXT%.SET_INDX = -1;

  27673 19 001062   001664 471400 11                 LDP1    CONTEXT_PTR$+1
        19 001063   100003 755100                    STA     3,,PR1

     1604    27674    2       NEED_TITLE_BAR = %YES#;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:323  

  27674 19 001064   400000 236003                    LDQ     -131072,DU
        19 001065   000000 756000 xsym               STQ     NEED_TITLE_BAR

     1605    27675        /*
     1606    27676             ***** Process the command ...
     1607    27677        */
     1608    27678    3       DO CASE(CURR_COMMAND_CODE);       /* Command number */

  27678 19 001066   201115 473500                    LDP3    @CURR_COMMAND_CODE,,AUTO
        19 001067   300000 235100                    LDA     0,,PR3
        19 001070   000067 115007                    CMPA    55,DL
        19 001071   001073 602005 19                 TNC     s:27678+5,AL
        19 001072   016452 710000 19                 TRA     CONTINUE
        19 001073   016452 710000 19                 TRA     CONTINUE
        19 001074   001162 710000 19                 TRA     s:27682
        19 001075   001235 710000 19                 TRA     s:27705
        19 001076   001504 710000 19                 TRA     s:27854
        19 001077   002115 710000 19                 TRA     s:28014
        19 001100   002147 710000 19                 TRA     s:28030
        19 001101   002421 710000 19                 TRA     s:28133
        19 001102   003020 710000 19                 TRA     s:28280
        19 001103   003617 710000 19                 TRA     s:28464
        19 001104   004061 710000 19                 TRA     s:28549
        19 001105   004432 710000 19                 TRA     s:28666
        19 001106   004237 710000 19                 TRA     s:28602
        19 001107   010060 710000 19                 TRA     s:29803
        19 001110   005143 710000 19                 TRA     s:28804
        19 001111   005477 710000 19                 TRA     s:28893
        19 001112   006051 710000 19                 TRA     s:29010
        19 001113   006110 710000 19                 TRA     s:29026
        19 001114   006526 710000 19                 TRA     s:29301
        19 001115   007006 710000 19                 TRA     s:29380
        19 001116   007060 710000 19                 TRA     s:29402
        19 001117   007115 710000 19                 TRA     s:29457
        19 001120   007671 710000 19                 TRA     s:29699
        19 001121   007723 710000 19                 TRA     s:29719
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:324  
        19 001122   010510 710000 19                 TRA     s:29981
        19 001123   010720 710000 19                 TRA     s:30037
        19 001124   011015 710000 19                 TRA     s:30068
        19 001125   011417 710000 19                 TRA     s:30199
        19 001126   001507 710000 19                 TRA     s:27857
        19 001127   012355 710000 19                 TRA     s:30413
        19 001130   012410 710000 19                 TRA     s:30468
        19 001131   012432 710000 19                 TRA     s:30475
        19 001132   012444 710000 19                 TRA     s:30483
        19 001133   012477 710000 19                 TRA     s:30537
        19 001134   007704 710000 19                 TRA     s:29704
        19 001135   007711 710000 19                 TRA     s:29706
        19 001136   014112 710000 19                 TRA     s:30881
        19 001137   014654 710000 19                 TRA     s:31126
        19 001140   014621 710000 19                 TRA     s:31072
        19 001141   014727 710000 19                 TRA     s:31149
        19 001142   014742 710000 19                 TRA     s:31155
        19 001143   014763 710000 19                 TRA     s:31169
        19 001144   015016 710000 19                 TRA     s:31223
        19 001145   015051 710000 19                 TRA     s:31254
        19 001146   015156 710000 19                 TRA     s:31287
        19 001147   015253 710000 19                 TRA     s:31321
        19 001150   016423 710000 19                 TRA     s:31690
        19 001151   016452 710000 19                 TRA     CONTINUE
        19 001152   007617 710000 19                 TRA     s:29632
        19 001153   010060 710000 19                 TRA     s:29803
        19 001154   016452 710000 19                 TRA     CONTINUE
        19 001155   001426 710000 19                 TRA     s:27793
        19 001156   012437 710000 19                 TRA     s:30479
        19 001157   007756 710000 19                 TRA     s:29772
        19 001160   014363 710000 19                 TRA     s:30973
        19 001161   004547 710000 19                 TRA     s:28704

     1609    27679        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:325  
     1610    27680        /* Acknowledge command */
     1611    27681    3       CASE (%CMD_ACKNOWLEDGE_MESSAGE);

     1612    27682    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  27682 19 001162   016562 701000 19                 TSX1    NEED_UPDATE
        19 001163   016452 702000 19                 TSX2    CONTINUE

     1613    27683
     1614    27684    3           IF OUT$ -> P$B.NSUBLKS > 0

  27684 19 001164   200023 470500                    LDP0    OUT$,,AUTO
        19 001165   000001 220100                    LDX0    1,,PR0
        19 001166   001176 600000 19                 TZE     s:27687

     1615    27685    3           THEN                       /* There are options */
     1616    27686    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_ACKNOWLEDGE_MESSAGE)
             27686                        ALTRET(CONTINUE);

  27686 19 001167   000070 236000 20                 LDQ     56
        19 001170   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 001171   200023 236100                    LDQ     OUT$,,AUTO
        19 001172   000003 036003                    ADLQ    3,DU
        19 001173   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 001174   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 001175   016452 702000 19                 TSX2    CONTINUE

     1617    27687    3           CALL FIX_CONTEXT;

  27687 19 001176   017470 701000 19                 TSX1    FIX_CONTEXT
        19 001177   000000 011000                    NOP     0

     1618    27688    3           INDX1 = 0;

  27688 19 001200   200033 450100                    STZ     INDX1,,AUTO

     1619    27689        /*
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:326  
     1620    27690             ***** Acknowledge all the messages ...
     1621    27691        */
     1622    27692    4           DO FOREVER;

     1623    27693    4               CALL GET$MESSAGE ALTRET(END_ACK);

  27693 19 001201   020536 701000 19                 TSX1    GET$MESSAGE
        19 001202   001222 702000 19                 TSX2    END_ACK

     1624    27694    4               CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);

  27694 19 001203   000033 236000 20                 LDQ     27
        19 001204   201710 756100                    STQ     I+102,,AUTO
        19 001205   000103 236000 20                 LDQ     67
        19 001206   000000 235000 xsym               LDA     VM_HEADER$
        19 001207   201706 757100                    STAQ    I+100,,AUTO
        19 001210   201706 630500                    EPPR0   I+100,,AUTO
        19 001211   000021 631400 20                 EPPR1   17
        19 001212   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 001213   000000 011000                    NOP     0

     1625    27695    4               CALL DO$ACK (%YES#) ALTRET(E_PMME);

  27695 19 001214   000050 236000 20                 LDQ     40
        19 001215   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 001216   025040 701000 19                 TSX1    DO$ACK
        19 001217   016514 702000 19                 TSX2    E_PMME

     1626    27696    4               INDX1 = INDX1 + 1;

  27696 19 001220   200033 054100                    AOS     INDX1,,AUTO

     1627    27697    4           END;                       /* Do forever ... end */

  27697 19 001221   001201 710000 19                 TRA     s:27693

     1628    27698    3   END_ACK:
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:327  
     1629    27699    3           IF INDX1 = 0

  27699 19 001222   200033 235100       END_ACK      LDA     INDX1,,AUTO
        19 001223   016452 601000 19                 TNZ     CONTINUE

     1630    27700    3           THEN
     1631    27701    3               CALL REPORT_ACTIVITY (INDX1,VM_NO_MESSAGE_FMT,%YES#,E_NO_MESSAGE_FMT);

  27701 19 001224   000104 236000 20                 LDQ     68
        19 001225   201122 756100                    STQ     @NAME+1,,AUTO
        19 001226   000106 237000 20                 LDAQ    70
        19 001227   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 001230   200033 630500                    EPPR0   INDX1,,AUTO
        19 001231   201117 450500                    STP0    @CURR_COMMAND_CODE+2,,AUTO
        19 001232   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 001233   000000 011000                    NOP     0
        19 001234   016452 710000 19                 TRA     CONTINUE

     1632    27702        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:328  
     1633    27703        /* Answer command */
     1634    27704    3       CASE (%CMD_ANSWER_MESSAGE);

     1635    27705    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  27705 19 001235   016562 701000 19                 TSX1    NEED_UPDATE
        19 001236   016452 702000 19                 TSX2    CONTINUE

     1636    27706
     1637    27707    3           IF OUT$ -> P$B.NSUBLKS > 0

  27707 19 001237   200023 470500                    LDP0    OUT$,,AUTO
        19 001240   000001 220100                    LDX0    1,,PR0
        19 001241   001251 600000 19                 TZE     s:27710

     1638    27708    3           THEN                       /* There are options */
     1639    27709    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_ANSWER_MESSAGE) ALTRET(
             27709                        CONTINUE);

  27709 19 001242   000111 236000 20                 LDQ     73
        19 001243   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 001244   200023 236100                    LDQ     OUT$,,AUTO
        19 001245   000003 036003                    ADLQ    3,DU
        19 001246   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 001247   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 001250   016452 702000 19                 TSX2    CONTINUE

     1640    27710    3           CALL FIX_CONTEXT;

  27710 19 001251   017470 701000 19                 TSX1    FIX_CONTEXT
        19 001252   000000 011000                    NOP     0

     1641    27711    3           INDX1 = 0;                  /* Used as counter */

  27711 19 001253   200033 450100                    STZ     INDX1,,AUTO

     1642    27712        /*
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:329  
     1643    27713            ***** Determine if 'RECEIVERS' was specified. (default = no)
     1644    27714        */
     1645    27715    3           OPT_RECEIVERS = VM_PROFILE.OPT.ANS_RECEIVERS;

  27715 19 001254   000000 470400 xsym               LDP0    VM_PROFILE$
        19 001255   000001 236100                    LDQ     1,,PR0
        19 001256   400000 376003                    ANQ     -131072,DU
        19 001257   201107 756100                    STQ     OPT_RECEIVERS,,AUTO

     1646    27716    3           IF OUT$ -> P$B.NSUBLKS > 1

  27716 19 001260   200023 471500                    LDP1    OUT$,,AUTO
        19 001261   100001 220100                    LDX0    1,,PR1
        19 001262   000002 100003                    CMPX0   2,DU
        19 001263   001302 602000 19                 TNC     s:27734

     1647    27717    3           THEN                       /* Receivers or sender specified */
     1648    27718    4           DO CASE (OUT$ -> P$B.SUBLK$(1) -> P$B.CODE);

  27718 19 001264   100004 473500                    LDP3    4,,PR1
        19 001265   300000 721100                    LXL1    0,,PR3
        19 001266   000005 101003                    CMPX1   5,DU
        19 001267   001271 602011 19                 TNC     s:27718+5,X1
        19 001270   001302 710000 19                 TRA     s:27734
        19 001271   001302 710000 19                 TRA     s:27734
        19 001272   001302 710000 19                 TRA     s:27734
        19 001273   001302 710000 19                 TRA     s:27734
        19 001274   001276 710000 19                 TRA     s:27720
        19 001275   001301 710000 19                 TRA     s:27722

     1649    27719    4           CASE (%OPT_RECEIVERS);

     1650    27720    4               OPT_RECEIVERS = %YES#;

  27720 19 001276   400000 236003                    LDQ     -131072,DU
        19 001277   201107 756100                    STQ     OPT_RECEIVERS,,AUTO
        19 001300   001302 710000 19                 TRA     s:27734
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:330  

     1651    27721    4           CASE (%OPT_SENDER);

     1652    27722    4               OPT_RECEIVERS = %NO#;

  27722 19 001301   201107 450100                    STZ     OPT_RECEIVERS,,AUTO

     1653    27723    4           END;                   /* Do case ... end */

     1654    27724        /*
     1655    27725             ***** Build the command buffer to pass to send ...
     1656    27726        */
     1657    27727                %INIT_STR (CODE=E_SEND_ANSWER, STR=VM_SEND_ANSWER, TEST=YES);

  27734 19 001302   040000 106400                    CMPC    fill='040'O
        19 001303   004702 200120 11                 ADSC9   VM_SEND_ANSWER           cn=1,n=80
        19 001304   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 001305   001312 601000 19                 TNZ     s:27750

  27736 19 001306   000112 630400 20                 EPPR0   74
        19 001307   000000 631400 20                 EPPR1   0
        19 001310   000000 701000 xent               TSX1    VMD$ERRMSG
        19 001311   000000 011000                    NOP     0

     1658    27750    3           CALL BUILD_LINK_TO_SEND_CMD (VM_SEND_ANSWER);

  27750 19 001312   000113 236000 20                 LDQ     75
        19 001313   201121 756100                    STQ     @SITENAME+1,,AUTO
        19 001314   025126 701000 19                 TSX1    BUILD_LINK_TO_SEND_CMD
        19 001315   000000 011000                    NOP     0

     1659    27751        /*
     1660    27752             ***** Acknowledge all the messages ...
     1661    27753        */
     1662    27754    4           DO FOREVER;

     1663    27755    4               CALL GET$MESSAGE ALTRET(END_ANSWER);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:331  

  27755 19 001316   020536 701000 19                 TSX1    GET$MESSAGE
        19 001317   001413 702000 19                 TSX2    END_ANSWER

     1664    27756    4               CALL M$OPEN (OPEN_SEND_FILE) ALTRET(E_PMME);

  27756 19 001320   000510 630400 12                 EPPR0   OPEN_SEND_FILE
        19 001321   450000 713400                    CLIMB   alt,open
        19 001322   410400 401760                    pmme    nvectors=18
        19 001323   016514 702000 19                 TSX2    E_PMME

     1665    27757    4               CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);

  27757 19 001324   000033 236000 20                 LDQ     27
        19 001325   201710 756100                    STQ     I+102,,AUTO
        19 001326   000103 236000 20                 LDQ     67
        19 001327   000000 235000 xsym               LDA     VM_HEADER$
        19 001330   201706 757100                    STAQ    I+100,,AUTO
        19 001331   201706 630500                    EPPR0   I+100,,AUTO
        19 001332   000021 631400 20                 EPPR1   17
        19 001333   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 001334   000000 011000                    NOP     0

     1666    27758    4               if OPT_RECEIVERS='1'b and VM_HEADER.STATUS.BROADCAST='1'b then

  27758 19 001335   201107 234100                    SZN     OPT_RECEIVERS,,AUTO
        19 001336   001350 605000 19                 TPL     s:27763
        19 001337   000000 470400 xsym               LDP0    VM_HEADER$
        19 001340   000012 236100                    LDQ     10,,PR0
        19 001341   000001 316003                    CANQ    1,DU
        19 001342   001350 600000 19                 TZE     s:27763

     1667    27759    5               do;

     1668    27760    5                   CALL XUR$ERRMSG (E_ANSBROAD);

  27760 19 001343   000114 630400 20                 EPPR0   76
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:332  
        19 001344   000024 631400 20                 EPPR1   20
        19 001345   000000 701000 xent               TSX1    XUR$ERRMSG
        19 001346   000000 011000                    NOP     0

     1669    27761    5                   goto E_ANSWER;

  27761 19 001347   001403 710000 19                 TRA     E_ANSWER

     1670    27762    5               end;
     1671    27763    4               CALL VME$ANSWER (CURRENT_MESSAGE_NUMBER,USER_NAME,

  27763 19 001350   201107 630500                    EPPR0   OPT_RECEIVERS,,AUTO
        19 001351   201710 450500                    STP0    I+102,,AUTO
        19 001352   000116 237000 20                 LDAQ    78
        19 001353   201706 757100                    STAQ    I+100,,AUTO
        19 001354   201706 630500                    EPPR0   I+100,,AUTO
        19 001355   000021 631400 20                 EPPR1   17
        19 001356   000000 701000 xent               TSX1    VME$ANSWER
        19 001357   001403 702000 19                 TSX2    E_ANSWER

     1672    27764    4                 OPT_RECEIVERS) ALTRET(E_ANSWER);
     1673    27765    4               CLOSE_SAVE.V.DCB# = M$WORK_NUM;

  27765 19 001360   000000 720000 xsym               LXL0    M$WORK_NUM
        19 001361   002142 740000 11                 STX0    CLOSE_SAVE+26

     1674    27766    4               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  27766 19 001362   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 001363   450001 713400                    CLIMB   alt,close
        19 001364   406000 401760                    pmme    nvectors=13
        19 001365   016514 702000 19                 TSX2    E_PMME

     1675    27767    4               CALL LINK_RUNIT

  27767 19 001366   017111 701000 19                 TSX1    LINK_RUNIT
        19 001367   001375 702000 19                 TSX2    s:27775
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:333  

     1676    27768    4               WHENRETURN
     1677    27769    5               DO;

     1678    27770    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,

  27770 19 001370   000120 630400 20                 EPPR0   80
        19 001371   000000 631400 20                 EPPR1   0
        19 001372   000000 701000 xent               TSX1    VMD$GET_HEADER
        19 001373   016514 702000 19                 TSX2    E_PMME

     1679    27771    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     1680    27772    5               END;

  27772 19 001374   001402 710000 19                 TRA     s:27779

     1681    27773    4               WHENALTRETURN
     1682    27774    5               DO;

     1683    27775    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,

  27775 19 001375   000120 630400 20                 EPPR0   80
        19 001376   000000 631400 20                 EPPR1   0
        19 001377   000000 701000 xent               TSX1    VMD$GET_HEADER
        19 001400   016514 702000 19                 TSX2    E_PMME

     1684    27776    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     1685    27777    5                   GOTO END_ANSWER;

  27777 19 001401   001413 710000 19                 TRA     END_ANSWER

     1686    27778    5               END;
     1687    27779    5               DO NEVER;

  27779 19 001402   001411 710000 19                 TRA     s:27784

     1688    27780    5   E_ANSWER:                               /* Cleanup */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:334  
     1689    27781    5                   CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;

  27781 19 001403   000000 720000 xsym  E_ANSWER     LXL0    M$WORK_NUM
        19 001404   002200 740000 11                 STX0    CLOSE_SCRATCH+26

     1690    27782    5                   CALL M$CLOSE (CLOSE_SCRATCH) ALTRET(E_PMME);

  27782 19 001405   002146 630400 11                 EPPR0   CLOSE_SCRATCH
        19 001406   450001 713400                    CLIMB   alt,close
        19 001407   406000 401760                    pmme    nvectors=13
        19 001410   016514 702000 19                 TSX2    E_PMME

     1691    27783    5               END;                  /* Do never ... end */

     1692    27784    4               INDX1 = INDX1 + 1;

  27784 19 001411   200033 054100                    AOS     INDX1,,AUTO

     1693    27785    4           END;                       /* Do forever ... end */

  27785 19 001412   001316 710000 19                 TRA     s:27755

     1694    27786    3   END_ANSWER:
     1695    27787    3           IF INDX1 = 0

  27787 19 001413   200033 235100       END_ANSWER   LDA     INDX1,,AUTO
        19 001414   016452 601000 19                 TNZ     CONTINUE

     1696    27788    3           THEN
     1697    27789    3               CALL REPORT_ACTIVITY (INDX1,VM_NO_MESSAGE_FMT,%YES#,E_NO_MESSAGE_FMT);

  27789 19 001415   000104 236000 20                 LDQ     68
        19 001416   201122 756100                    STQ     @NAME+1,,AUTO
        19 001417   000106 237000 20                 LDAQ    70
        19 001420   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 001421   200033 630500                    EPPR0   INDX1,,AUTO
        19 001422   201117 450500                    STP0    @CURR_COMMAND_CODE+2,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:335  
        19 001423   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 001424   000000 011000                    NOP     0
        19 001425   016452 710000 19                 TRA     CONTINUE

     1698    27790        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:336  
     1699    27791        /* Null command.  Look for <lf> and <eod> */
     1700    27792    3       CASE(%CMD_BLANK);

     1701    27793    3           if dcbaddr(M$CMNDF_NUM)->F$DCB.FCD# = '1'B

  27793 19 001426   000074 474400 20                 LDP4    60
        19 001427   400000 475500                    LDP5    0,,PR4
        19 001430   000545 720000 11                 LXL0    M$CMNDF_NUM
        19 001431   500000 476510                    LDP6    0,X0,PR5
        19 001432   600031 236100                    LDQ     25,,PR6
        19 001433   020000 316007                    CANQ    8192,DL
        19 001434   001440 600000 19                 TZE     s:27795

     1702    27794    3           then substr(NEXT_COMMAND_TEXT.NAME#,2,1) = dcbaddr(M$CMNDF_NUM)->F$DCB.
             27794                    EOMCHAR#;

  27794 19 001435   600003 236100                    LDQ     3,,PR6
        19 001436   200551 552104                    STBQ    NEXT_COMMAND_TEXT,'04'O,AUTO
        19 001437   001444 710000 19                 TRA     s:27797

     1703    27795    3           else substr(NEXT_COMMAND_TEXT.NAME#,2,1) = dcbaddr(M$SI_NUM   )->F$DCB.
             27795                    EOMCHAR#;

  27795 19 001440   000000 721000 xsym               LXL1    M$SI_NUM
        19 001441   500000 477511                    LDP7    0,X1,PR5
        19 001442   700003 236100                    LDQ     3,,PR7
        19 001443   200551 552104                    STBQ    NEXT_COMMAND_TEXT,'04'O,AUTO

     1704    27796
     1705    27797    3           if substr(NEXT_COMMAND_TEXT.NAME#,2,1) = BITASC('012'O) /* Lf */

  27797 19 001444   200551 236100                    LDQ     NEXT_COMMAND_TEXT,,AUTO
        19 001445   000777 376007                    ANQ     511,DL
        19 001446   000012 116007                    CMPQ    10,DL
        19 001447   001464 601000 19                 TNZ     s:27824

     1706    27798    4           THEN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:337  

     1707    27799                   %INIT_STR (CODE=E_NEXT_CMD, STR=VM_NEXT_CMD, NEXT_CMD=NEXT_COMMAND_TEXT,
             27799                        TEST=YES);

  27806 19 001450   040000 106400                    CMPC    fill='040'O
        19 001451   004606 200017 11                 ADSC9   VM_NEXT_CMD              cn=1,n=15
        19 001452   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 001453   001460 601000 19                 TNZ     s:27817

  27808 19 001454   000122 630400 20                 EPPR0   82
        19 001455   000000 631400 20                 EPPR1   0
        19 001456   000000 701000 xent               TSX1    VMD$ERRMSG
        19 001457   000000 011000                    NOP     0

  27817 19 001460   000100 100400                    MLR     fill='000'O
        19 001461   004606 000020 11                 ADSC9   VM_NEXT_CMD              cn=0,n=16
        19 001462   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

     1708    27822    4           END;

  27822 19 001463   016452 710000 19                 TRA     CONTINUE

     1709    27823    3           else
     1710    27824    3               if substr(NEXT_COMMAND_TEXT.NAME#,2,1) = BITASC('004'O) /* Eod */

  27824 19 001464   200551 236100                    LDQ     NEXT_COMMAND_TEXT,,AUTO
        19 001465   000777 376007                    ANQ     511,DL
        19 001466   000004 116007                    CMPQ    4,DL
        19 001467   016452 601000 19                 TNZ     CONTINUE

     1711    27825    4               then do;

     1712    27826                        %INIT_STR (CODE=E_PREVIOUS_CMD, STR=VM_PREVIOUS_CMD, NEXT_CMD=
             27826                            NEXT_COMMAND_TEXT, TEST=YES);

  27833 19 001470   040000 106400                    CMPC    fill='040'O
        19 001471   004622 200017 11                 ADSC9   VM_PREVIOUS_CMD          cn=1,n=15
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:338  
        19 001472   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 001473   001500 601000 19                 TNZ     s:27844

  27835 19 001474   000124 630400 20                 EPPR0   84
        19 001475   000000 631400 20                 EPPR1   0
        19 001476   000000 701000 xent               TSX1    VMD$ERRMSG
        19 001477   000000 011000                    NOP     0

  27844 19 001500   000100 100400                    MLR     fill='000'O
        19 001501   004622 000020 11                 ADSC9   VM_PREVIOUS_CMD          cn=0,n=16
        19 001502   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

     1713    27849    4               END;

  27849 19 001503   016452 710000 19                 TRA     CONTINUE

     1714    27850                                                /* Otherwise do nothing */
     1715    27851        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:339  
     1716    27852        /* Copy and move commands */
     1717    27853    3       CASE (%CMD_COPY_MESSAGE);

     1718    27854    3           CALL NEED_FOLDER ALTRET(CONTINUE);

  27854 19 001504   016547 701000 19                 TSX1    NEED_FOLDER
        19 001505   016452 702000 19                 TSX2    CONTINUE

     1719    27855    3           GOTO COPY_MOVE;

  27855 19 001506   001511 710000 19                 TRA     COPY_MOVE

     1720    27856    3       CASE (%CMD_MOVE_MESSAGE);

     1721    27857    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  27857 19 001507   016562 701000 19                 TSX1    NEED_UPDATE
        19 001510   016452 702000 19                 TSX2    CONTINUE

     1722    27858    3   COPY_MOVE:
     1723    27859
     1724    27860    3           INDX1 = 0;                  /* Number of messages moved */

  27860 19 001511   200033 450100       COPY_MOVE    STZ     INDX1,,AUTO

     1725    27861    3           INDX2 = 0;             /* Number of messages marked for deletion */

  27861 19 001512   000375 450000 11                 STZ     INDX2

     1726    27862    3           IF NOT VM_SEARCH_INFO.ACTIVE THEN CALL VMA$OPEN_SRCH_LIST(VM_SEARCH_INFO);

  27862 19 001513   001632 234000 11                 SZN     VM_SEARCH_INFO+34
        19 001514   001521 604000 19                 TMI     s:27863

  27862 19 001515   000042 630400 20                 EPPR0   34
        19 001516   000024 631400 20                 EPPR1   20
        19 001517   000000 701000 xent               TSX1    VMA$OPEN_SRCH_LIST
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:340  
        19 001520   000000 011000                    NOP     0

     1727    27863    3           IF OUT$->P$B.NSUBLKS > 1

  27863 19 001521   200023 470500                    LDP0    OUT$,,AUTO
        19 001522   000001 220100                    LDX0    1,,PR0
        19 001523   000002 100003                    CMPX0   2,DU
        19 001524   001534 602000 19                 TNC     s:27871

     1728    27864    4           THEN DO;

     1729    27865    4               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_COPY_MESSAGE) ALTRET(
             27865                        CONTINUE);

  27865 19 001525   000127 236000 20                 LDQ     87
        19 001526   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 001527   200023 236100                    LDQ     OUT$,,AUTO
        19 001530   000003 036003                    ADLQ    3,DU
        19 001531   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 001532   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 001533   016452 702000 19                 TSX2    CONTINUE

     1730    27866    4           END;

     1731    27867        /*
     1732    27868            ***** Set break type so that break control routine can perform cleanup
     1733    27869            ***** in case a break is hit.
     1734    27870        */
     1735    27871    3           FOLDER_WAS_OPEN = %YES#;

  27871 19 001534   400000 236003                    LDQ     -131072,DU
        19 001535   000404 756000 11                 STQ     FOLDER_WAS_OPEN

     1736    27872    3           BREAK_TYPE = CURR_COMMAND_CODE;

  27872 19 001536   201115 470500                    LDP0    @CURR_COMMAND_CODE,,AUTO
        19 001537   000000 235100                    LDA     0,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:341  
        19 001540   000400 755000 11                 STA     BREAK_TYPE

     1737    27873        /*
     1738    27874             ***** Open the destination ...
     1739    27875        */
     1740    27876    3           IF OUT$->P$B.NSUBLKS = 1

  27876 19 001541   200023 471500                    LDP1    OUT$,,AUTO
        19 001542   100001 220100                    LDX0    1,,PR1
        19 001543   000001 100003                    CMPX0   1,DU
        19 001544   001563 601000 19                 TNZ     s:27883

     1741    27877    4           THEN DO;

     1742    27878    4               CALL VMB$USE_SPECIFIED (OUT$->P$B.SUBLK$(0),USER_NAME,

  27878 19 001545   000042 237000 20                 LDAQ    34
        19 001546   201712 757100                    STAQ    I+104,,AUTO
        19 001547   000132 237000 20                 LDAQ    90
        19 001550   201710 757100                    STAQ    I+102,,AUTO
        19 001551   000034 236000 20                 LDQ     28
        19 001552   201707 756100                    STQ     I+101,,AUTO
        19 001553   200023 236100                    LDQ     OUT$,,AUTO
        19 001554   000003 036003                    ADLQ    3,DU
        19 001555   201706 756100                    STQ     I+100,,AUTO
        19 001556   201706 630500                    EPPR0   I+100,,AUTO
        19 001557   000130 631400 20                 EPPR1   88
        19 001560   000000 701000 xent               TSX1    VMB$USE_SPECIFIED
        19 001561   002063 702000 19                 TSX2    CANT_COPY

     1743    27879    4                 VM_WORK_FOLDER,M$WORK_NUM,
     1744    27880    4                 VM_SEARCH_INFO,%UPDATE#) ALTRET(CANT_COPY);
     1745    27881    4           END;

  27881 19 001562   001600 710000 19                 TRA     s:27887

     1746    27882    4           ELSE DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:342  

     1747    27883    4               CALL VMB$USE_SPECIFIED (OUT$->P$B.SUBLK$(1),

  27883 19 001563   000042 237000 20                 LDAQ    34
        19 001564   201712 757100                    STAQ    I+104,,AUTO
        19 001565   000132 237000 20                 LDAQ    90
        19 001566   201710 757100                    STAQ    I+102,,AUTO
        19 001567   000034 236000 20                 LDQ     28
        19 001570   201707 756100                    STQ     I+101,,AUTO
        19 001571   200023 236100                    LDQ     OUT$,,AUTO
        19 001572   000004 036003                    ADLQ    4,DU
        19 001573   201706 756100                    STQ     I+100,,AUTO
        19 001574   201706 630500                    EPPR0   I+100,,AUTO
        19 001575   000130 631400 20                 EPPR1   88
        19 001576   000000 701000 xent               TSX1    VMB$USE_SPECIFIED
        19 001577   002063 702000 19                 TSX2    CANT_COPY

     1748    27884    4                 USER_NAME,VM_WORK_FOLDER,M$WORK_NUM,VM_SEARCH_INFO,
     1749    27885    4                 %UPDATE#) ALTRET(CANT_COPY);
     1750    27886    4           END;

     1751    27887    3           IF VM_WORK_FOLDER.FLAGS.UPDATE = %NO#

  27887 19 001600   001504 234000 11                 SZN     VM_WORK_FOLDER+19
        19 001601   001607 604000 19                 TMI     s:27896

     1752    27888    4           THEN DO;

     1753    27889    4               CALL XUR$ERRMSG(E_NOTALLOW);

  27889 19 001602   000131 630400 20                 EPPR0   89
        19 001603   000024 631400 20                 EPPR1   20
        19 001604   000000 701000 xent               TSX1    XUR$ERRMSG
        19 001605   000000 011000                    NOP     0

     1754    27890    4               GOTO CANT_COPY;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:343  
  27890 19 001606   002063 710000 19                 TRA     CANT_COPY

     1755    27891    4           END;
     1756    27892        /*
     1757    27893             ***** Stash the profile for the current folder and
     1758    27894                   get the profile for the destination folder ...
     1759    27895        */
     1760    27896    3           PRINT_HEADER# = VM_PROFILE.OPT.HEADERS;

  27896 19 001607   000000 470400 xsym               LDP0    VM_PROFILE$
        19 001610   000000 236100                    LDQ     0,,PR0
        19 001611   000033 736000                    QLS     27
        19 001612   400000 376003                    ANQ     -131072,DU
        19 001613   000421 756000 11                 STQ     PRINT_HEADER#

     1761    27897    3           IF VM_CURRENT_FOLDER.FLAGS.UPDATE = %YES#

  27897 19 001614   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 001615   001622 605000 19                 TPL     s:27900

     1762    27898    3           THEN
     1763    27899    3               CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(E_PMME);

  27899 19 001616   000053 236000 20                 LDQ     43
        19 001617   201523 756100                    STQ     INDX2+255,,AUTO
        19 001620   021320 701000 19                 TSX1    PUT_PROFILE
        19 001621   016514 702000 19                 TSX2    E_PMME

     1764    27900    3           VM_CURRENT_FOLDER.FLAGS.OPEN = %NO#; /* This keeps

  27900 19 001622   000054 236000 20                 LDQ     44
        19 001623   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     1765    27901                                           a bad profile record being written if we get
     1766    27902                                           ctl-y or otherwise xconed. */
     1767    27903    3           CALL VMD$GET_PROFILE (M$WORK_NUM) ALTRET(E_COPY);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:344  
  27903 19 001624   000133 630400 20                 EPPR0   91
        19 001625   000024 631400 20                 EPPR1   20
        19 001626   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 001627   002047 702000 19                 TSX2    E_COPY

     1768    27904        /*
     1769    27905             ***** Now move the messages ...
     1770    27906        */
     1771    27907    3           ENQ_PROFILE.V.DCB# = M$WORK_NUM;

  27907 19 001630   000000 720000 xsym               LXL0    M$WORK_NUM
        19 001631   001720 740000 11                 STX0    ENQ_PROFILE+6

     1772    27908    3           DEQ_PROFILE.V.DCB# = M$WORK_NUM;

  27908 19 001632   001732 740000 11                 STX0    DEQ_PROFILE+6

     1773    27909    4           DO FOREVER;

     1774    27910    4               CALL M$ENQ (ENQ_PROFILE);

  27910 19 001633   001712 630400 11                 EPPR0   ENQ_PROFILE
        19 001634   020002 713400                    CLIMB   8194
        19 001635   401000 401760                    pmme    nvectors=3

     1775    27911    4               CALL VMD$GET_PROFILE(M$WORK_NUM) ALTRET(E_COPY);

  27911 19 001636   000133 630400 20                 EPPR0   91
        19 001637   000024 631400 20                 EPPR1   20
        19 001640   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 001641   002047 702000 19                 TSX2    E_COPY

     1776    27912    4               CALL GET$MESSAGE ALTRET(END_COPY);

  27912 19 001642   020536 701000 19                 TSX1    GET$MESSAGE
        19 001643   002024 702000 19                 TSX2    END_COPY

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:345  
     1777    27913        /*
     1778    27914             ***** Display the header of the message if necessary ...
     1779    27915        */
     1780    27916    4               IF PRINT_HEADER#

  27916 19 001644   000421 234000 11                 SZN     PRINT_HEADER#
        19 001645   001657 605000 19                 TPL     s:27919

     1781    27917    4               THEN
     1782    27918    4                   CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);

  27918 19 001646   000033 236000 20                 LDQ     27
        19 001647   201710 756100                    STQ     I+102,,AUTO
        19 001650   000103 236000 20                 LDQ     67
        19 001651   000000 235000 xsym               LDA     VM_HEADER$
        19 001652   201706 757100                    STAQ    I+100,,AUTO
        19 001653   201706 630500                    EPPR0   I+100,,AUTO
        19 001654   000021 631400 20                 EPPR1   17
        19 001655   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 001656   000000 011000                    NOP     0

     1783    27919    4               CALL XUR$DISABLE;

  27919 19 001657   000020 631400 20                 EPPR1   16
        19 001660   000000 701000 xent               TSX1    XUR$DISABLE
        19 001661   000000 011000                    NOP     0

     1784    27920    4               INDX1 = INDX1 + 1;

  27920 19 001662   200033 054100                    AOS     INDX1,,AUTO

     1785    27921    4               COMBINED = %YES#;

  27921 19 001663   400000 236003                    LDQ     -131072,DU
        19 001664   200036 756100                    STQ     COMBINED,,AUTO

     1786    27922    4               CALL VMM$COMBINE_MESSAGE (M$MAIL_FILE_NUM, CURRENT_MESSAGE_NUMBER,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:346  
             27922                        M$WORK_NUM)

  27922 19 001665   000134 630400 20                 EPPR0   92
        19 001666   000021 631400 20                 EPPR1   17
        19 001667   000000 701000 xent               TSX1    VMM$COMBINE_MESSAGE
        19 001670   001672 702000 19                 TSX2    s:27924
        19 001671   001673 710000 19                 TRA     s:27926

     1787    27923    5               WHENALTRETURN DO;

     1788    27924    5                   COMBINED = %NO#;

  27924 19 001672   200036 450100                    STZ     COMBINED,,AUTO

     1789    27925    5               END;

     1790    27926    4               CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER, M$MAIL_FILE_NUM);

  27926 19 001673   000120 630400 20                 EPPR0   80
        19 001674   000000 631400 20                 EPPR1   0
        19 001675   000000 701000 xent               TSX1    VMD$GET_HEADER
        19 001676   000000 011000                    NOP     0

     1791    27927    4               IF NOT COMBINED OR NOT VM_PROFILE.OPT.COMBINE

  27927 19 001677   200036 234100                    SZN     COMBINED,,AUTO
        19 001700   001715 605000 19                 TPL     s:27931
        19 001701   000000 470400 xsym               LDP0    VM_PROFILE$
        19 001702   000000 236100                    LDQ     0,,PR0
        19 001703   000002 316007                    CANQ    2,DL
        19 001704   001715 600000 19                 TZE     s:27931
        19 001705   000000 471400 xsym               LDP1    VM_HEADER$
        19 001706   100012 236100                    LDQ     10,,PR1
        19 001707   100000 316003                    CANQ    32768,DU
        19 001710   001765 601000 19                 TNZ     s:27950
        19 001711   020000 316007                    CANQ    8192,DL
        19 001712   001765 601000 19                 TNZ     s:27950
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:347  
        19 001713   000002 316003                    CANQ    2,DU
        19 001714   001765 601000 19                 TNZ     s:27950

     1792    27928    4                 OR NOT (VM_HEADER.STATUS.ACK OR VM_HEADER.STATUS.RRACK
     1793    27929    4                 OR VM_HEADER.STATUS.DELIVERY)
     1794    27930    5               THEN DO;

     1795    27931    5                   VM_PROFILE.HI_MESSAGE_NUMBER = VM_PROFILE.HI_MESSAGE_NUMBER + 1;

  27931 19 001715   000000 470400 xsym               LDP0    VM_PROFILE$
        19 001716   000011 235100                    LDA     9,,PR0
        19 001717   000001 035007                    ADLA    1,DL
        19 001720   000011 755100                    STA     9,,PR0

     1796    27932    5                   VM_PROFILE.NUM_MESSAGES = VM_PROFILE.NUM_MESSAGES + 1;

  27932 19 001721   000005 235100                    LDA     5,,PR0
        19 001722   000001 035007                    ADLA    1,DL
        19 001723   000005 755100                    STA     5,,PR0

     1797    27933    5                   IF CURR_COMMAND_CODE = %CMD_COPY_MESSAGE

  27933 19 001724   201115 471500                    LDP1    @CURR_COMMAND_CODE,,AUTO
        19 001725   100000 235100                    LDA     0,,PR1
        19 001726   000003 115007                    CMPA    3,DL
        19 001727   001733 601000 19                 TNZ     s:27936

     1798    27934    5                   THEN
     1799    27935    5                       VM_HEADER.STATUS.RR = %NO#;

  27935 19 001730   000000 473400 xsym               LDP3    VM_HEADER$
        19 001731   000137 236000 20                 LDQ     95
        19 001732   300012 356100                    ANSQ    10,,PR3

     1800    27936    5                   VM_HEADER.STATUS.DEL = %NO#;

  27936 19 001733   000000 473400 xsym               LDP3    VM_HEADER$
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:348  
        19 001734   000140 236000 20                 LDQ     96
        19 001735   300012 356100                    ANSQ    10,,PR3

     1801    27937    5                   IF VM_HEADER.STATUS.MAKE_OLD

  27937 19 001736   300012 236100                    LDQ     10,,PR3
        19 001737   002000 316003                    CANQ    1024,DU
        19 001740   001745 600000 19                 TZE     s:27942

     1802    27938    6                   THEN DO;

     1803    27939    6                       VM_HEADER.STATUS.OLD = %YES#;

  27939 19 001741   004000 236003                    LDQ     2048,DU
        19 001742   300012 256100                    ORSQ    10,,PR3

     1804    27940    6                       VM_HEADER.STATUS.MAKE_OLD = %NO#;

  27940 19 001743   000141 236000 20                 LDQ     97
        19 001744   300012 356100                    ANSQ    10,,PR3

     1805    27941    6                   END;

     1806    27942    5                   IF NOT VM_HEADER.STATUS.OLD

  27942 19 001745   300012 236100                    LDQ     10,,PR3
        19 001746   004000 316003                    CANQ    2048,DU
        19 001747   001753 601000 19                 TNZ     s:27945

     1807    27943    5                   THEN
     1808    27944    5                       VM_PROFILE.NUM_NEW_MESSAGES = VM_PROFILE.NUM_NEW_MESSAGES + 1;

  27944 19 001750   000006 235100                    LDA     6,,PR0
        19 001751   000001 035007                    ADLA    1,DL
        19 001752   000006 755100                    STA     6,,PR0

     1809    27945    5                   CALL VMM$COPY_MESSAGE (CURRENT_MESSAGE_NUMBER, VM_PROFILE.
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:349  
             27945                           HI_MESSAGE_NUMBER, M$MAIL_FILE_NUM, M$WORK_NUM) ALTRET (E_COPY);

  27945 19 001753   000142 237000 20                 LDAQ    98
        19 001754   201710 757100                    STAQ    I+102,,AUTO
        19 001755   000000 236000 xsym               LDQ     VM_PROFILE$
        19 001756   000011 036003                    ADLQ    9,DU
        19 001757   000103 235000 20                 LDA     67
        19 001760   201706 757100                    STAQ    I+100,,AUTO
        19 001761   201706 630500                    EPPR0   I+100,,AUTO
        19 001762   000026 631400 20                 EPPR1   22
        19 001763   000000 701000 xent               TSX1    VMM$COPY_MESSAGE
        19 001764   002047 702000 19                 TSX2    E_COPY

     1810    27946    5               END;

     1811    27947        /*
     1812    27948             ***** If move command, then delete the current message ...
     1813    27949        */
     1814    27950    4               IF CURR_COMMAND_CODE = %CMD_MOVE_MESSAGE

  27950 19 001765   201115 470500                    LDP0    @CURR_COMMAND_CODE,,AUTO
        19 001766   000000 235100                    LDA     0,,PR0
        19 001767   000033 115007                    CMPA    27,DL
        19 001770   002010 601000 19                 TNZ     s:27966

     1815    27951    4               THEN
     1816    27952    5               DO;              /* Special move processing */

     1817    27953    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,

  27953 19 001771   000120 630400 20                 EPPR0   80
        19 001772   000000 631400 20                 EPPR1   0
        19 001773   000000 701000 xent               TSX1    VMD$GET_HEADER
        19 001774   002047 702000 19                 TSX2    E_COPY

     1818    27954    5                     M$MAIL_FILE_NUM) ALTRET(E_COPY);
     1819    27955    5                   IF VM_HEADER.STATUS.DEL = %NO#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:350  

  27955 19 001775   000000 470400 xsym               LDP0    VM_HEADER$
        19 001776   000012 236100                    LDQ     10,,PR0
        19 001777   000400 316003                    CANQ    256,DU
        19 002000   002010 601000 19                 TNZ     s:27966

     1820    27956    5                   THEN      /* Not yet marked for deletion */
     1821    27957    6                   DO;   /* Mark for deletion */

     1822    27958    6                       VM_HEADER.STATUS.DEL = %YES#;

  27958 19 002001   000400 236003                    LDQ     256,DU
        19 002002   000012 256100                    ORSQ    10,,PR0

     1823    27959    6                       CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,

  27959 19 002003   000120 630400 20                 EPPR0   80
        19 002004   000000 631400 20                 EPPR1   0
        19 002005   000000 701000 xent               TSX1    VMD$PUT_HEADER
        19 002006   002047 702000 19                 TSX2    E_COPY

     1824    27960    6                         M$MAIL_FILE_NUM) ALTRET(E_COPY);
     1825    27961    6                       INDX2 = INDX2 + 1;

  27961 19 002007   000375 054000 11                 AOS     INDX2

     1826    27962    6                   END;

     1827    27963    5               END;             /* Special move processing */

     1828    27964                  /* write profile and deq to give mailman a change to deliver, just
     1829    27965                     in case he's been waiting */
     1830    27966    4               CALL VMD$PUT_PROFILE(M$WORK_NUM) ALTRET(E_COPY);

  27966 19 002010   000133 630400 20                 EPPR0   91
        19 002011   000024 631400 20                 EPPR1   20
        19 002012   000000 701000 xent               TSX1    VMD$PUT_PROFILE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:351  
        19 002013   002047 702000 19                 TSX2    E_COPY

     1831    27967    4               CALL M$DEQ (DEQ_PROFILE) ALTRET (E_COPY);

  27967 19 002014   001724 630400 11                 EPPR0   DEQ_PROFILE
        19 002015   420003 713400                    CLIMB   alt,+8195
        19 002016   401000 401760                    pmme    nvectors=3
        19 002017   002047 702000 19                 TSX2    E_COPY

     1832    27968    4               CALL XUR$ENABLE;

  27968 19 002020   000020 631400 20                 EPPR1   16
        19 002021   000000 701000 xent               TSX1    XUR$ENABLE
        19 002022   000000 011000                    NOP     0

     1833    27969    4           END;                       /* Do forever ... end */

  27969 19 002023   001633 710000 19                 TRA     s:27910

     1834    27970        /*
     1835    27971             ***** Update the profile in the destination folder ...
     1836    27972        */
     1837    27973    3   END_COPY:
     1838    27974        /*
     1839    27975             ***** Report how many messages were copied or moved ...
     1840    27976        */
     1841    27977    3           CALL REPORT_ACTIVITY (INDX1,VM_MSGS_COPIED_FMT,%YES#,E_MSGS_COPIED_FMT);

  27977 19 002024   000144 236000 20    END_COPY     LDQ     100
        19 002025   201122 756100                    STQ     @NAME+1,,AUTO
        19 002026   000146 237000 20                 LDAQ    102
        19 002027   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 002030   200033 630500                    EPPR0   INDX1,,AUTO
        19 002031   201117 450500                    STP0    @CURR_COMMAND_CODE+2,,AUTO
        19 002032   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 002033   000000 011000                    NOP     0

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:352  
     1842    27978    3           IF INDX2 > 0

  27978 19 002034   000375 235000 11                 LDA     INDX2
        19 002035   002046 604400 19                 TMOZ    s:27985

     1843    27979    4           THEN DO;         /* Tell how many messages marked for deletion */

     1844    27980    4              CALL REPORT_ACTIVITY (INDX2,VM_MSGS_DELETED_FMT,%YES#,E_MSGS_DELETED_FMT
             27980                        );

  27980 19 002036   000150 236000 20                 LDQ     104
        19 002037   201122 756100                    STQ     @NAME+1,,AUTO
        19 002040   000152 237000 20                 LDAQ    106
        19 002041   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 002042   000154 236000 20                 LDQ     108
        19 002043   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 002044   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 002045   000000 011000                    NOP     0

     1845    27981    4           END;

     1846    27982        /*
     1847    27983             ***** Report any unexpected error ...
     1848    27984        */
     1849    27985    4           DO NEVER;

  27985 19 002046   002063 710000 19                 TRA     CANT_COPY

     1850    27986    4   E_COPY:
     1851    27987    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  27987 19 002047   000000 470400 xsym  E_COPY       LDP0    B$TCB$
        19 002050   000000 471500                    LDP1    0,,PR0
        19 002051   100102 236100                    LDQ     66,,PR1
        19 002052   002204 756000 11                 STQ     ERROR

     1852    27988    4               CALL XUR$ERRMSG(ERROR,M$WORK_NUM);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:353  

  27988 19 002053   000155 630400 20                 EPPR0   109
        19 002054   000000 631400 20                 EPPR1   0
        19 002055   000000 701000 xent               TSX1    XUR$ERRMSG
        19 002056   000000 011000                    NOP     0

     1853    27989    4               CALL XUR$ERRMSG(E_FOLDEROLD,M$WORK_NUM);

  27989 19 002057   000157 630400 20                 EPPR0   111
        19 002060   000000 631400 20                 EPPR1   0
        19 002061   000000 701000 xent               TSX1    XUR$ERRMSG
        19 002062   000000 011000                    NOP     0

     1854    27990    4           END;

     1855    27991    3   CANT_COPY:
     1856    27992        /*
     1857    27993             ***** Make sure the destination folder is closed ...
     1858    27994        */
     1859    27995    3           IF DCBADDR(M$WORK_NUM) -> F$DCB.FCD#

  27995 19 002063   000074 470400 20    CANT_COPY    LDP0    60
        19 002064   000000 471500                    LDP1    0,,PR0
        19 002065   000000 720000 xsym               LXL0    M$WORK_NUM
        19 002066   100000 473510                    LDP3    0,X0,PR1
        19 002067   300031 236100                    LDQ     25,,PR3
        19 002070   020000 316007                    CANQ    8192,DL
        19 002071   002077 600000 19                 TZE     s:28000

     1860    27996    4           THEN DO;

     1861    27997    4               CLOSE_SAVE.V.DCB# = M$WORK_NUM;

  27997 19 002072   002142 740000 11                 STX0    CLOSE_SAVE+26

     1862    27998    4               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:354  
  27998 19 002073   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 002074   450001 713400                    CLIMB   alt,close
        19 002075   406000 401760                    pmme    nvectors=13
        19 002076   016514 702000 19                 TSX2    E_PMME

     1863    27999    4           END;

     1864    28000    3           VM_WORK_FOLDER.FLAGS.OPEN = %NO#;

  28000 19 002077   000054 236000 20                 LDQ     44
        19 002100   001504 356000 11                 ANSQ    VM_WORK_FOLDER+19

     1865    28001        /*
     1866    28002             ***** Restore the profile for the current folder ...
     1867    28003        */
     1868    28004    3           CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);

  28004 19 002101   000053 630400 20                 EPPR0   43
        19 002102   000024 631400 20                 EPPR1   20
        19 002103   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 002104   016454 702000 19                 TSX2    BAD_PROFILE

     1869    28005    3           VM_PROFILE.NUM_DEL_MESSAGES = VM_PROFILE.NUM_DEL_MESSAGES + INDX2;

  28005 19 002105   000000 470400 xsym               LDP0    VM_PROFILE$
        19 002106   000007 236100                    LDQ     7,,PR0
        19 002107   000375 036000 11                 ADLQ    INDX2
        19 002110   000007 756100                    STQ     7,,PR0

     1870    28006        /*
     1871    28007             ***** Reset special break controls ...
     1872    28008        */
     1873    28009    3           BREAK_TYPE = 0;

  28009 19 002111   000400 450000 11                 STZ     BREAK_TYPE

     1874    28010    3           VM_CURRENT_FOLDER.FLAGS.OPEN = %YES#;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:355  

  28010 19 002112   010000 236003                    LDQ     4096,DU
        19 002113   001266 256000 11                 ORSQ    VM_CURRENT_FOLDER+19
        19 002114   016452 710000 19                 TRA     CONTINUE

     1875    28011        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:356  
     1876    28012        /* Count command */
     1877    28013    3       CASE (%CMD_COUNT_MESSAGE);

     1878    28014    3           CALL NEED_FOLDER ALTRET(CONTINUE);

  28014 19 002115   016547 701000 19                 TSX1    NEED_FOLDER
        19 002116   016452 702000 19                 TSX2    CONTINUE

     1879    28015    3           IF OUT$ -> P$B.NSUBLKS > 0

  28015 19 002117   200023 470500                    LDP0    OUT$,,AUTO
        19 002120   000001 220100                    LDX0    1,,PR0
        19 002121   002131 600000 19                 TZE     s:28018

     1880    28016    3           THEN                       /* There are options */
     1881    28017    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_COUNT_MESSAGE) ALTRET(
             28017                        CONTINUE);

  28017 19 002122   000162 236000 20                 LDQ     114
        19 002123   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 002124   200023 236100                    LDQ     OUT$,,AUTO
        19 002125   000003 036003                    ADLQ    3,DU
        19 002126   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 002127   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 002130   016452 702000 19                 TSX2    CONTINUE

     1882    28018    3           INDX1 = 0;

  28018 19 002131   200033 450100                    STZ     INDX1,,AUTO

     1883    28019
     1884    28020    4           DO FOREVER;

     1885    28021
     1886    28022    4               CALL GET$MESSAGE ALTRET(END_COUNT);

  28022 19 002132   020536 701000 19                 TSX1    GET$MESSAGE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:357  
        19 002133   002136 702000 19                 TSX2    END_COUNT

     1887    28023    4               INDX1 = INDX1 + 1;

  28023 19 002134   200033 054100                    AOS     INDX1,,AUTO

     1888    28024    4           END;                       /* Do forever */

  28024 19 002135   002132 710000 19                 TRA     s:28022

     1889    28025    3   END_COUNT:
     1890    28026    3           CALL REPORT_ACTIVITY (INDX1,VM_COUNT_FMT,%YES#,E_COUNT_FMT);

  28026 19 002136   000163 236000 20    END_COUNT    LDQ     115
        19 002137   201122 756100                    STQ     @NAME+1,,AUTO
        19 002140   000164 237000 20                 LDAQ    116
        19 002141   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 002142   200033 630500                    EPPR0   INDX1,,AUTO
        19 002143   201117 450500                    STP0    @CURR_COMMAND_CODE+2,,AUTO
        19 002144   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 002145   000000 011000                    NOP     0
        19 002146   016452 710000 19                 TRA     CONTINUE

     1891    28027        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:358  
     1892    28028        /* Create folder command */
     1893    28029    3       CASE(%CMD_CREATE_FOLDER);

     1894    28030    3           CALL XUR$DISABLE;

  28030 19 002147   000020 631400 20                 EPPR1   16
        19 002150   000000 701000 xent               TSX1    XUR$DISABLE
        19 002151   000000 011000                    NOP     0

     1895    28031        /*
     1896    28032             ***** Initialize the address variables ...
     1897    28033        */
     1898    28034    3           VM_RADDRESS.ACCT = VM_CENTRAL_FOLDER.ACCT;

  28034 19 002152   040100 100400                    MLR     fill='040'O
        19 002153   001135 400010 11                 ADSC9   VM_CENTRAL_FOLDER+1      cn=2,n=8
        19 002154   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8

     1899    28035    3           VM_RADDRESS.FOLDER = VM_CENTRAL_FOLDER.FOLDER;

  28035 19 002155   040100 100400                    MLR     fill='040'O
        19 002156   001137 400031 11                 ADSC9   VM_CENTRAL_FOLDER+3      cn=2,n=25
        19 002157   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25

     1900    28036    3           VM_RADDRESS.PASS = ' ';

  28036 19 002160   040100 100400                    MLR     fill='040'O
        19 002161   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 002162   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8

     1901    28037    3           VM_RADDRESS.SITENAME = ' ';

  28037 19 002163   040100 100400                    MLR     fill='040'O
        19 002164   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 002165   200770 600010                    ADSC9   VM_RADDRESS+15,,AUTO     cn=3,n=8

     1902    28038                                                /*
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:359  
     1903    28039                       ***** Repeat this loop once for each piece of the address ...
     1904    28040                       */
     1905    28041    3           IF OUT$ -> P$B.NSUBLKS > 0

  28041 19 002166   200023 470500                    LDP0    OUT$,,AUTO
        19 002167   000001 220100                    LDX0    1,,PR0
        19 002170   002253 600000 19                 TZE     s:28063

     1906    28042    3           THEN
     1907    28043    4           DO;

     1908    28044    4               BLK$ = OUT$ -> P$B.SUBLK$(0);

  28044 19 002171   000003 236100                    LDQ     3,,PR0
        19 002172   200024 756100                    STQ     BLK$,,AUTO

     1909    28045    5               DO INDX1 = 0 TO BLK$ -> P$B.NSUBLKS - 1;

  28045 19 002173   200033 450100                    STZ     INDX1,,AUTO
        19 002174   002246 710000 19                 TRA     s:28058+1

     1910    28046    5                   PTR1$ = BLK$ -> P$B.SUBLK$(INDX1);

  28046 19 002175   200024 470500                    LDP0    BLK$,,AUTO
        19 002176   200033 720100                    LXL0    INDX1,,AUTO
        19 002177   000003 236110                    LDQ     3,X0,PR0
        19 002200   200025 756100                    STQ     PTR1$,,AUTO

     1911    28047    6                   DO CASE (PTR1$ -> P$B.CODE);

  28047 19 002201   200025 471500                    LDP1    PTR1$,,AUTO
        19 002202   100000 721100                    LXL1    0,,PR1
        19 002203   000006 101003                    CMPX1   6,DU
        19 002204   002206 602011 19                 TNC     s:28047+5,X1
        19 002205   002245 710000 19                 TRA     s:28058
        19 002206   002245 710000 19                 TRA     s:28058
        19 002207   002245 710000 19                 TRA     s:28058
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:360  
        19 002210   002214 710000 19                 TRA     s:28049
        19 002211   002223 710000 19                 TRA     s:28051
        19 002212   002232 710000 19                 TRA     s:28053
        19 002213   002237 710000 19                 TRA     s:28056

     1912    28048    6                   CASE (%ADD_ACCT);

     1913    28049    6                       VM_RADDRESS.ACCT = PTR1$ -> P$S.TEXT;

  28049 19 002214   100004 236100                    LDQ     4,,PR1
        19 002215   000033 772000                    QRL     27
        19 002216   000000 622006                    EAX2    0,QL
        19 002217   040100 100540                    MLR     fill='040'O
        19 002220   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 002221   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8
        19 002222   002245 710000 19                 TRA     s:28058

     1914    28050    6                   CASE (%ADD_FOLDER);

     1915    28051    6                       VM_RADDRESS.FOLDER = PTR1$ -> P$S.TEXT;

  28051 19 002223   100004 236100                    LDQ     4,,PR1
        19 002224   000033 772000                    QRL     27
        19 002225   000000 622006                    EAX2    0,QL
        19 002226   040100 100540                    MLR     fill='040'O
        19 002227   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 002230   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
        19 002231   002245 710000 19                 TRA     s:28058

     1916    28052    6                   CASE (%ADD_NAME);

     1917    28053    6                       CALL XUR$ERRMSG (E_NAMENTALLOWED);

  28053 19 002232   000166 630400 20                 EPPR0   118
        19 002233   000024 631400 20                 EPPR1   20
        19 002234   000000 701000 xent               TSX1    XUR$ERRMSG
        19 002235   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:361  

     1918    28054    6                       GOTO CONTINUE;

  28054 19 002236   016452 710000 19                 TRA     CONTINUE

     1919    28055    6                   CASE (%ADD_PASS);

     1920    28056    6                       VM_RADDRESS.PASS = PTR1$ -> P$S.TEXT;

  28056 19 002237   100004 236100                    LDQ     4,,PR1
        19 002240   000033 772000                    QRL     27
        19 002241   000000 622006                    EAX2    0,QL
        19 002242   040100 100540                    MLR     fill='040'O
        19 002243   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 002244   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8

     1921    28057    6                   END;       /* Do case ... end */

     1922    28058    5               END;             /* Do INDX1 = ... end */

  28058 19 002245   200033 054100                    AOS     INDX1,,AUTO
        19 002246   200024 470500                    LDP0    BLK$,,AUTO
        19 002247   000001 236100                    LDQ     1,,PR0
        19 002250   000022 772000                    QRL     18
        19 002251   200033 116100                    CMPQ    INDX1,,AUTO
        19 002252   002175 605400 19                 TPNZ    s:28046

     1923    28059    4           END;

     1924    28060        /*
     1925    28061             ***** Now create the folder ...
     1926    28062        */
     1927    28063    3           VM_WORK_FOLDER.FLAGS = %NO#;

  28063 19 002253   001504 450000 11                 STZ     VM_WORK_FOLDER+19

     1928    28064    3           CALL VMA$OPEN_FOLDER (VM_WORK_FOLDER,ADDR(VM_RADDRESS),
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:362  

  28064 19 002254   200751 630500                    EPPR0   VM_RADDRESS,,AUTO
        19 002255   201706 450500                    STP0    I+100,,AUTO
        19 002256   000170 237000 20                 LDAQ    120
        19 002257   201712 757100                    STAQ    I+104,,AUTO
        19 002260   000133 236000 20                 LDQ     91
        19 002261   201711 756100                    STQ     I+103,,AUTO
        19 002262   201706 631500                    EPPR1   I+100,,AUTO
        19 002263   201710 451500                    STP1    I+102,,AUTO
        19 002264   000132 236000 20                 LDQ     90
        19 002265   201707 756100                    STQ     I+101,,AUTO
        19 002266   201707 630500                    EPPR0   I+101,,AUTO
        19 002267   000041 631400 20                 EPPR1   33
        19 002270   000000 701000 xent               TSX1    VMA$OPEN_FOLDER
        19 002271   002375 702000 19                 TSX2    CANT_CREATE_FOLDER

     1929    28065    3             M$WORK_NUM,%ERROR#,%CREATE#) ALTRET(CANT_CREATE_FOLDER);
     1930    28066    3           VM_WORK_FOLDER.FLAGS.FOLDER_SPEC = '1'B;

  28066 19 002272   040000 236003                    LDQ     16384,DU
        19 002273   001504 256000 11                 ORSQ    VM_WORK_FOLDER+19

     1931    28067    3           VM_WORK_FOLDER.SITENAME=' ';

  28067 19 002274   040000 100400                    MLR     fill='040'O
        19 002275   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 002276   001474 600010 11                 ADSC9   VM_WORK_FOLDER+11        cn=3,n=8

     1932    28068    3           WORK_STRING.L#=SIZEC(WORK_STRING.NAME#);

  28068 19 002277   777000 236003                    LDQ     -512,DU
        19 002300   000174 552040 11                 STBQ    WORK_STRING,'40'O

     1933    28069    3           CALL GET_FOLDERNAME (VM_WORK_FOLDER);

  28069 19 002301   000132 236000 20                 LDQ     90
        19 002302   201123 756100                    STQ     LEN+1,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:363  
        19 002303   017064 701000 19                 TSX1    GET_FOLDERNAME
        19 002304   000000 011000                    NOP     0

     1934    28070    3           CALL XUR$INFOMSG (E_CREATE_MSG_FMT,, M$ME_NUM,VECTOR(WORK_STRING));

  28070 19 002305   000174 237000 20                 LDAQ    124
        19 002306   201710 757100                    STAQ    I+102,,AUTO
        19 002307   000022 236000 20                 LDQ     18
        19 002310   000176 235000 20                 LDA     126
        19 002311   201706 757100                    STAQ    I+100,,AUTO
        19 002312   201706 630500                    EPPR0   I+100,,AUTO
        19 002313   000026 631400 20                 EPPR1   22
        19 002314   000000 701000 xent               TSX1    XUR$INFOMSG
        19 002315   000000 011000                    NOP     0

     1935    28071        /*
     1936    28072             ***** Give this folder a profile.
     1937    28073                   First store away our current profile,
     1938    28074                   reset important fields, write this profile
     1939    28075                   into the newly created folder, and then get
     1940    28076                   back the profile for our current folder ...
     1941    28077        */
     1942    28078    3           IF VM_CURRENT_FOLDER.FLAGS.UPDATE

  28078 19 002316   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 002317   002324 605000 19                 TPL     s:28081

     1943    28079    3           THEN                       /* Ok to stash profile */
     1944    28080    3               CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(E_PMME);

  28080 19 002320   000053 236000 20                 LDQ     43
        19 002321   201523 756100                    STQ     INDX2+255,,AUTO
        19 002322   021320 701000 19                 TSX1    PUT_PROFILE
        19 002323   016514 702000 19                 TSX2    E_PMME

     1945    28081    3           VM_PROFILE = CVM_PROFILE;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:364  
  28081 19 002324   000000 470400 xsym               LDP0    VM_PROFILE$
        19 002325   000100 100400                    MLR     fill='000'O
        19 002326   000100 000704 12                 ADSC9   CVM_PROFILE              cn=0,n=452
        19 002327   000000 000704                    ADSC9   0,,PR0                   cn=0,n=452

     1946    28082    3           VM_PROFILE.FREE$ = ADDR(NIL);

  28082 19 002330   000022 236000 20                 LDQ     18
        19 002331   000003 756100                    STQ     3,,PR0

     1947    28083    3           VM_PROFILE.NEXT$ = ADDR(VM_PROFILE.WORK_AREA);

  28083 19 002332   000000 236000 xsym               LDQ     VM_PROFILE$
        19 002333   000160 036003                    ADLQ    112,DU
        19 002334   000004 756100                    STQ     4,,PR0

     1948    28084    3           CALL CONCAT (VM_PROFILE.NAME_KEY,B$JIT.ACCN,B$JIT.UNAME);

  28084 19 002335   000000 471400 xsym               LDP1    B$JIT$
        19 002336   040100 100500                    MLR     fill='040'O
        19 002337   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
        19 002340   000127 000010                    ADSC9   87,,PR0                  cn=0,n=8
        19 002341   040100 100500                    MLR     fill='040'O
        19 002342   100003 000014                    ADSC9   3,,PR1                   cn=0,n=12
        19 002343   000131 000014                    ADSC9   89,,PR0                  cn=0,n=12

     1949    28085                %INIT_STR (CODE=E_MAIL_SETUP, STR=VM_MAIL_SETUP, TEST=YES);

  28092 19 002344   040000 106400                    CMPC    fill='040'O
        19 002345   005073 200377 11                 ADSC9   VM_MAIL_SETUP            cn=1,n=255
        19 002346   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 002347   002354 601000 19                 TNZ     s:28108

  28094 19 002350   000177 630400 20                 EPPR0   127
        19 002351   000000 631400 20                 EPPR1   0
        19 002352   000000 701000 xent               TSX1    VMD$ERRMSG
        19 002353   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:365  

     1950    28108    3           VM_PROFILE.SETUP.COUNT = VM_MAIL_SETUP.L#;

  28108 19 002354   000000 470400 xsym               LDP0    VM_PROFILE$
        19 002355   005073 236000 11                 LDQ     VM_MAIL_SETUP
        19 002356   000013 552140                    STBQ    11,'40'O,PR0

     1951    28109    3           VM_PROFILE.SETUP.TEXT = VM_MAIL_SETUP.NAME#;

  28109 19 002357   040100 100400                    MLR     fill='040'O
        19 002360   005073 200377 11                 ADSC9   VM_MAIL_SETUP            cn=1,n=255
        19 002361   000013 200400                    ADSC9   11,,PR0                  cn=1,n=256

     1952    28110    3           CALL VMD$PUT_PROFILE (M$WORK_NUM) ALTRET(E_PMME);

  28110 19 002362   000133 630400 20                 EPPR0   91
        19 002363   000024 631400 20                 EPPR1   20
        19 002364   000000 701000 xent               TSX1    VMD$PUT_PROFILE
        19 002365   016514 702000 19                 TSX2    E_PMME

     1953    28111        /*
     1954    28112             ***** Close the file with disp=save so that the
     1955    28113                   file will be entered into the catalog. ...
     1956    28114        */
     1957    28115    3           CLOSE_SAVE.V.DCB# = M$WORK_NUM;

  28115 19 002366   000000 720000 xsym               LXL0    M$WORK_NUM
        19 002367   002142 740000 11                 STX0    CLOSE_SAVE+26

     1958    28116    3           CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  28116 19 002370   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 002371   450001 713400                    CLIMB   alt,close
        19 002372   406000 401760                    pmme    nvectors=13
        19 002373   016514 702000 19                 TSX2    E_PMME

     1959    28117        /**/
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:366  
     1960    28118    4           DO NEVER;

  28118 19 002374   002411 710000 19                 TRA     s:28127

     1961    28119    4   CANT_CREATE_FOLDER:
     1962    28120    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  28120 19 002375   000000 470400 xsym  CANT_CREATE* LDP0    B$TCB$
        19 002376   000000 471500                    LDP1    0,,PR0
        19 002377   100102 236100                    LDQ     66,,PR1
        19 002400   002204 756000 11                 STQ     ERROR

     1963    28121    4               CALL XUR$ERRMSG(E_CRFERR);

  28121 19 002401   000201 630400 20                 EPPR0   129
        19 002402   000024 631400 20                 EPPR1   20
        19 002403   000000 701000 xent               TSX1    XUR$ERRMSG
        19 002404   000000 011000                    NOP     0

     1964    28122    4               CALL XUR$ERRMSG (ERROR,M$WORK_NUM);

  28122 19 002405   000155 630400 20                 EPPR0   109
        19 002406   000000 631400 20                 EPPR1   0
        19 002407   000000 701000 xent               TSX1    XUR$ERRMSG
        19 002410   000000 011000                    NOP     0

     1965    28123    4           END;                       /* Do never ... end */

     1966    28124        /*
     1967    28125             ***** Get profile for the current folder back ...
     1968    28126        */
     1969    28127    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN

  28127 19 002411   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 002412   010000 316003                    CANQ    4096,DU
        19 002413   016452 600000 19                 TZE     CONTINUE

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:367  
     1970    28128    3           THEN                       /* A folder is open */
     1971    28129    3               CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);

  28129 19 002414   000053 630400 20                 EPPR0   43
        19 002415   000024 631400 20                 EPPR1   20
        19 002416   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 002417   016454 702000 19                 TSX2    BAD_PROFILE
        19 002420   016452 710000 19                 TRA     CONTINUE

     1972    28130        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:368  
     1973    28131        /* Create list command */
     1974    28132    3       CASE(%CMD_CREATE_LIST);

     1975    28133    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  28133 19 002421   016562 701000 19                 TSX1    NEED_UPDATE
        19 002422   016452 702000 19                 TSX2    CONTINUE

     1976    28134        /*E*    ERROR: VMO-E$LISTEXISTS-0
     1977    28135                MESSAGE: List %U1 already exists.
     1978    28136        */
     1979    28137        /*
     1980    28138             ***** Repeat this loop once for each list name defined ...
     1981    28139        */
     1982    28140    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;

  28140 19 002423   200033 450100                    STZ     INDX1,,AUTO
        19 002424   003012 710000 19                 TRA     CREATE_LIST_END+1

     1983    28141    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);

  28141 19 002425   200023 470500                    LDP0    OUT$,,AUTO
        19 002426   200033 720100                    LXL0    INDX1,,AUTO
        19 002427   000003 236110                    LDQ     3,X0,PR0
        19 002430   200024 756100                    STQ     BLK$,,AUTO

     1984    28142        /*
     1985    28143             ***** Check if a list with this name exists ...
     1986    28144        */
     1987    28145    4               VM_LISTKEY.TEXT = BLK$ -> P$B.SUBLK$(0) -> P$S.TEXT;

  28145 19 002431   200024 471500                    LDP1    BLK$,,AUTO
        19 002432   100003 473500                    LDP3    3,,PR1
        19 002433   300004 236100                    LDQ     4,,PR3
        19 002434   000033 772000                    QRL     27
        19 002435   000000 621006                    EAX1    0,QL
        19 002436   040000 100540                    MLR     fill='040'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:369  
        19 002437   300004 200011                    ADSC9   4,,PR3                   cn=1,n=*X1
        19 002440   000554 400310 11                 ADSC9   VM_LISTKEY               cn=2,n=200

     1988    28146    4               CALL VMA$GET_LIST (VM_LISTKEY,VM_ADDLIST$,

  28146 19 002441   000202 630400 20                 EPPR0   130
        19 002442   000021 631400 20                 EPPR1   17
        19 002443   000000 701000 xent               TSX1    VMA$GET_LIST
        19 002444   002476 702000 19                 TSX2    E_CRLIST1

     1989    28147    4                 M$MAIL_FILE_NUM) ALTRET(E_CRLIST1);
     1990    28148        /*
     1991    28149             ***** It does exist...
     1992    28150                   Bug!!!
     1993    28151        */
     1994    28152    4               CALL XUR$ERRMSG (E_LISTEXISTS,,,

  28152 19 002445   200024 470500                    LDP0    BLK$,,AUTO
        19 002446   000003 471500                    LDP1    3,,PR0
        19 002447   100003 473500                    LDP3    3,,PR1
        19 002450   000100 101500                    MRL     fill='000'O
        19 002451   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 002452   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 002453   201706 220100                    LDX0    I+100,,AUTO
        19 002454   000001 621010                    EAX1    1,X0
        19 002455   000000 635011                    EAA     0,X1
        19 002456   000002 771000                    ARL     2
        19 002457   000140 135007                    SBLA    96,DL
        19 002460   201707 453500                    STP3    I+101,,AUTO
        19 002461   201707 236100                    LDQ     I+101,,AUTO
        19 002462   201710 757100                    STAQ    I+102,,AUTO
        19 002463   201710 631500                    EPPR1   I+102,,AUTO
        19 002464   201715 451500                    STP1    I+107,,AUTO
        19 002465   000022 236000 20                 LDQ     18
        19 002466   201714 756100                    STQ     I+106,,AUTO
        19 002467   000205 235000 20                 LDA     133
        19 002470   201712 757100                    STAQ    I+104,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:370  
        19 002471   201712 630500                    EPPR0   I+104,,AUTO
        19 002472   000026 631400 20                 EPPR1   22
        19 002473   000000 701000 xent               TSX1    XUR$ERRMSG
        19 002474   000000 011000                    NOP     0

     1995    28153    4                 VECTOR(BLK$->P$B.SUBLK$(0)->P$S.TEXTC$->X$STRING));
     1996    28154    4               GOTO CREATE_LIST_END;

  28154 19 002475   003011 710000 19                 TRA     CREATE_LIST_END

  28153 19 002476                       E_CRLIST1    null
     1997    28155        /*
     1998    28156             ***** If attempting to create a global list,
     1999    28157                   first check to see if a user with this
     2000    28158                   name already exists. If so, then error ...
     2001    28159        */
     2002    28160    4   E_CRLIST1:  ;
     2003    28161    4               FPT_CORRES.V.DCB1# = M$MAIL_FILE_NUM;

  28161 19 002476   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 002477   002412 740000 11                 STX0    FPT_CORRES+2

     2004    28162    4               FPT_CORRES.V.DCB2# = M$MAIL_GLOBAL_NUM;

  28162 19 002500   000000 721000 xsym               LXL1    M$MAIL_GLOBAL_NUM
        19 002501   002412 441000 11                 SXL1    FPT_CORRES+2

     2005    28163    4               CALL M$CORRES (FPT_CORRES) ALTRET(E_CRLIST2);

  28163 19 002502   002410 630400 11                 EPPR0   FPT_CORRES
        19 002503   460000 713400                    CLIMB   alt,+24576
        19 002504   400000 401760                    pmme    nvectors=1
        19 002505   002507 702000 19                 TSX2    E_CRLIST2

     2006    28164    4               GOTO E_CRLIST3;       /* Not same file */

  28164 19 002506   002547 710000 19                 TRA     E_CRLIST3
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:371  

  28162 19 002507                       E_CRLIST2    null
     2007    28165    4   E_CRLIST2:  ;
     2008    28166    4               VM_USERKEY.TEXT = VM_LISTKEY.TEXT;

  28166 19 002507   040000 100400                    MLR     fill='040'O
        19 002510   000554 400310 11                 ADSC9   VM_LISTKEY               cn=2,n=200
        19 002511   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200

     2009    28167    4               CALL VMA$GET_LIST (VM_USERKEY,VM_ADDLIST$,

  28167 19 002512   000206 630400 20                 EPPR0   134
        19 002513   000021 631400 20                 EPPR1   17
        19 002514   000000 701000 xent               TSX1    VMA$GET_LIST
        19 002515   002547 702000 19                 TSX2    E_CRLIST3

     2010    28168    4                 M$MAIL_FILE_NUM) ALTRET(E_CRLIST3);
     2011    28169        /*
     2012    28170             ***** It does exist...
     2013    28171                   Bug!!!
     2014    28172        */
     2015    28173    4               CALL XUR$ERRMSG (E_USEREXISTS,,,

  28173 19 002516   200024 470500                    LDP0    BLK$,,AUTO
        19 002517   000003 471500                    LDP1    3,,PR0
        19 002520   100003 473500                    LDP3    3,,PR1
        19 002521   000100 101500                    MRL     fill='000'O
        19 002522   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 002523   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 002524   201706 220100                    LDX0    I+100,,AUTO
        19 002525   000001 621010                    EAX1    1,X0
        19 002526   000000 635011                    EAA     0,X1
        19 002527   000002 771000                    ARL     2
        19 002530   000140 135007                    SBLA    96,DL
        19 002531   201707 453500                    STP3    I+101,,AUTO
        19 002532   201707 236100                    LDQ     I+101,,AUTO
        19 002533   201710 757100                    STAQ    I+102,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:372  
        19 002534   201710 631500                    EPPR1   I+102,,AUTO
        19 002535   201715 451500                    STP1    I+107,,AUTO
        19 002536   000022 236000 20                 LDQ     18
        19 002537   201714 756100                    STQ     I+106,,AUTO
        19 002540   000211 235000 20                 LDA     137
        19 002541   201712 757100                    STAQ    I+104,,AUTO
        19 002542   201712 630500                    EPPR0   I+104,,AUTO
        19 002543   000026 631400 20                 EPPR1   22
        19 002544   000000 701000 xent               TSX1    XUR$ERRMSG
        19 002545   000000 011000                    NOP     0

     2016    28174    4                 VECTOR(BLK$->P$B.SUBLK$(0)->P$S.TEXTC$->X$STRING));
     2017    28175    4               GOTO CREATE_LIST_END;

  28175 19 002546   003011 710000 19                 TRA     CREATE_LIST_END

  28166 19 002547                       E_CRLIST3    null
     2018    28176        /*
     2019    28177             ***** Ok to create the list ...
     2020    28178        */
     2021    28179    4   E_CRLIST3:  ;
     2022    28180        /*
     2023    28181             ***** Initialize VM_ADD_HEAD ...
     2024    28182        */
     2025    28183    4               VM_ADD_HEAD.NUM_ENTRIES = 0;

  28183 19 002547   000000 470400 xsym               LDP0    VM_ADDLIST$
        19 002550   000001 450100                    STZ     1,,PR0

     2026    28184        /*
     2027    28185             ***** Repeat this loop once for each address in the definition ...
     2028    28186        */
     2029    28187    5               DO INDX2 = 1 TO BLK$ -> P$B.NSUBLKS - 1;

  28187 19 002551   000001 235007                    LDA     1,DL
        19 002552   000375 755000 11                 STA     INDX2
        19 002553   003000 710000 19                 TRA     s:28252+1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:373  

     2030    28188    5                   PTR2$ = BLK$ -> P$B.SUBLK$(INDX2);

  28188 19 002554   200024 470500                    LDP0    BLK$,,AUTO
        19 002555   000375 720000 11                 LXL0    INDX2
        19 002556   000003 236110                    LDQ     3,X0,PR0
        19 002557   200026 756100                    STQ     PTR2$,,AUTO

     2031    28189        /*
     2032    28190             ***** Initialize the address variables ...
     2033    28191        */
     2034    28192    5                   ADDRESS_ACCT.ACCT# = ' ';

  28192 19 002560   000035 235000 20                 LDA     29
        19 002561   000035 236000 20                 LDQ     29
        19 002562   200042 757100                    STAQ    ADDRESS_ACCT,,AUTO

     2035    28193    5                   ADDRESS_NAME.L# = 0;

  28193 19 002563   000000 236003                    LDQ     0,DU
        19 002564   200051 552140                    STBQ    ADDRESS_NAME,'40'O,AUTO

     2036    28194    5                   ADDRESS_NAME.NAME# = ' ';

  28194 19 002565   040100 100400                    MLR     fill='040'O
        19 002566   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 002567   200051 200777                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=511

     2037    28195    5                   ADDRESS_FOLDER = ' ';

  28195 19 002570   040100 100400                    MLR     fill='040'O
        19 002571   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 002572   200253 000031                    ADSC9   ADDRESS_FOLDER,,AUTO     cn=0,n=25

     2038    28196    5                   ADDRESS_PASS.PASS# = ' ';

  28196 19 002573   000035 235000 20                 LDA     29
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:374  
        19 002574   000035 236000 20                 LDQ     29
        19 002575   200251 755100                    STA     ADDRESS_PASS,,AUTO
        19 002576   200252 756100                    STQ     ADDRESS_PASS+1,,AUTO

     2039    28197    5                   ADDRESS_SITENAME = ' ';

  28197 19 002577   000035 235000 20                 LDA     29
        19 002600   000035 236000 20                 LDQ     29
        19 002601   200262 757100                    STAQ    ADDRESS_SITENAME,,AUTO

     2040    28198    5                   DOMAIN$ = ADDR(NIL);

  28198 19 002602   000022 236000 20                 LDQ     18
        19 002603   200264 756100                    STQ     DOMAIN$,,AUTO

     2041    28199                                                /*
     2042    28200                       ***** Repeat this loop once for each piece of the address ...
     2043    28201                       */
     2044    28202    6                   DO INDX3 = 0 TO PTR2$ -> P$B.NSUBLKS - 1;

  28202 19 002604   200034 450100                    STZ     INDX3,,AUTO
        19 002605   002700 710000 19                 TRA     s:28219+1

     2045    28203    6                       PTR3$ = PTR2$ -> P$B.SUBLK$(INDX3);

  28203 19 002606   200026 470500                    LDP0    PTR2$,,AUTO
        19 002607   200034 720100                    LXL0    INDX3,,AUTO
        19 002610   000003 236110                    LDQ     3,X0,PR0
        19 002611   200027 756100                    STQ     PTR3$,,AUTO

     2046    28204    7                       DO CASE (PTR3$ -> P$B.CODE);

  28204 19 002612   200027 471500                    LDP1    PTR3$,,AUTO
        19 002613   100000 721100                    LXL1    0,,PR1
        19 002614   000012 101003                    CMPX1   10,DU
        19 002615   002617 602011 19                 TNC     s:28204+5,X1
        19 002616   002677 710000 19                 TRA     s:28219
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:375  
        19 002617   002677 710000 19                 TRA     s:28219
        19 002620   002677 710000 19                 TRA     s:28219
        19 002621   002631 710000 19                 TRA     s:28206
        19 002622   002640 710000 19                 TRA     s:28208
        19 002623   002647 710000 19                 TRA     s:28210
        19 002624   002660 710000 19                 TRA     s:28213
        19 002625   002667 710000 19                 TRA     s:28215
        19 002626   002677 710000 19                 TRA     s:28219
        19 002627   002677 710000 19                 TRA     s:28219
        19 002630   002676 710000 19                 TRA     s:28217

     2047    28205    7                       CASE (%ADD_ACCT);

     2048    28206    7                           ADDRESS_ACCT.ACCT# = PTR3$ -> P$S.TEXT;

  28206 19 002631   100004 236100                    LDQ     4,,PR1
        19 002632   000033 772000                    QRL     27
        19 002633   000000 622006                    EAX2    0,QL
        19 002634   040100 100540                    MLR     fill='040'O
        19 002635   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 002636   200042 000010                    ADSC9   ADDRESS_ACCT,,AUTO       cn=0,n=8
        19 002637   002677 710000 19                 TRA     s:28219

     2049    28207    7                       CASE (%ADD_FOLDER);

     2050    28208    7                           ADDRESS_FOLDER = PTR3$ -> P$S.TEXT;

  28208 19 002640   100004 236100                    LDQ     4,,PR1
        19 002641   000033 772000                    QRL     27
        19 002642   000000 622006                    EAX2    0,QL
        19 002643   040100 100540                    MLR     fill='040'O
        19 002644   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 002645   200253 000031                    ADSC9   ADDRESS_FOLDER,,AUTO     cn=0,n=25
        19 002646   002677 710000 19                 TRA     s:28219

     2051    28209    7                       CASE (%ADD_NAME);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:376  
     2052    28210    7                           ADDRESS_NAME.NAME# = PTR3$ -> P$S.TEXT;

  28210 19 002647   100004 236100                    LDQ     4,,PR1
        19 002650   000033 772000                    QRL     27
        19 002651   000000 622006                    EAX2    0,QL
        19 002652   040100 100540                    MLR     fill='040'O
        19 002653   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 002654   200051 200777                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=511

     2053    28211    7                           ADDRESS_NAME.L# = PTR3$ -> P$S.COUNT;

  28211 19 002655   100004 236100                    LDQ     4,,PR1
        19 002656   200051 552140                    STBQ    ADDRESS_NAME,'40'O,AUTO
        19 002657   002677 710000 19                 TRA     s:28219

     2054    28212    7                       CASE (%ADD_PASS);

     2055    28213    7                           ADDRESS_PASS.PASS# = PTR3$ -> P$S.TEXT;

  28213 19 002660   100004 236100                    LDQ     4,,PR1
        19 002661   000033 772000                    QRL     27
        19 002662   000000 622006                    EAX2    0,QL
        19 002663   040100 100540                    MLR     fill='040'O
        19 002664   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 002665   200251 000010                    ADSC9   ADDRESS_PASS,,AUTO       cn=0,n=8
        19 002666   002677 710000 19                 TRA     s:28219

     2056    28214    7                       CASE (%ADD_SITE);

     2057    28215    7                           ADDRESS_SITENAME = PTR3$ -> P$S.TEXT;

  28215 19 002667   100004 236100                    LDQ     4,,PR1
        19 002670   000033 772000                    QRL     27
        19 002671   000000 622006                    EAX2    0,QL
        19 002672   040100 100540                    MLR     fill='040'O
        19 002673   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 002674   200262 000010                    ADSC9   ADDRESS_SITENAME,,AUTO   cn=0,n=8
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:377  
        19 002675   002677 710000 19                 TRA     s:28219

     2058    28216    7                       CASE (%ADD_DOMAIN);

     2059    28217    7                           DOMAIN$ = PTR3$;

  28217 19 002676   200264 756100                    STQ     DOMAIN$,,AUTO

     2060    28218    7                       END;      /* Do case ... end */

     2061    28219    6                   END;            /* Do INDX3 = ... end */

  28219 19 002677   200034 054100                    AOS     INDX3,,AUTO
        19 002700   200026 470500                    LDP0    PTR2$,,AUTO
        19 002701   000001 236100                    LDQ     1,,PR0
        19 002702   000022 772000                    QRL     18
        19 002703   200034 116100                    CMPQ    INDX3,,AUTO
        19 002704   002606 605400 19                 TPNZ    s:28203

     2062    28220    5                   CALL TRANSFORM_DOMAIN (DOMAIN$, ADDRESS_SITENAME, ADDRESS_NAME)

  28220 19 002705   200051 631500                    EPPR1   ADDRESS_NAME,,AUTO
        19 002706   201121 451500                    STP1    @SITENAME+1,,AUTO
        19 002707   200262 633500                    EPPR3   ADDRESS_SITENAME,,AUTO
        19 002710   201120 453500                    STP3    @EXPLICIT+1,,AUTO
        19 002711   200264 634500                    EPPR4   DOMAIN$,,AUTO
        19 002712   201117 454500                    STP4    @CURR_COMMAND_CODE+2,,AUTO
        19 002713   024636 701000 19                 TSX1    TRANSFORM_DOMAIN
        19 002714   003011 702000 19                 TSX2    CREATE_LIST_END

     2063    28221    5                     ALTRET (CREATE_LIST_END);
     2064    28222        /*
     2065    28223             ***** Add this entry to the address list ...
     2066    28224        */
     2067    28225    5                   IF ADDRESS_ACCT.ACCT# = ' '

  28225 19 002715   200042 237100                    LDAQ    ADDRESS_ACCT,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:378  
        19 002716   000212 117000 20                 CMPAQ   138
        19 002717   002743 601000 19                 TNZ     s:28241
        19 002720   040000 106500                    CMPC    fill='040'O
        19 002721   200051 200777                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=511
        19 002722   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 002723   002743 601000 19                 TNZ     s:28241

     2068    28226    5                     AND ADDRESS_NAME.NAME# = ' '
     2069    28227    5                   THEN           /* Fill in default */
     2070    28228    6                   DO;

     2071    28229    6                       IF SUBSTR(USER_NAME.NAME#,0,1) = '.'

  28229 19 002724   004427 236000 11                 LDQ     USER_NAME
        19 002725   000777 376003                    ANQ     511,DU
        19 002726   000056 116003                    CMPQ    46,DU
        19 002727   002736 601000 19                 TNZ     s:28237

     2072    28230    6                       THEN /* User is not registered */
     2073    28231    7                       DO;

     2074    28232    7                           ADDRESS_ACCT.ACCT# = SUBSTR(USER_NAME.NAME#,1);

  28232 19 002730   040100 100400                    MLR     fill='040'O
        19 002731   004427 400010 11                 ADSC9   USER_NAME                cn=2,n=8
        19 002732   200042 000010                    ADSC9   ADDRESS_ACCT,,AUTO       cn=0,n=8

     2075    28233    7                           ADDRESS_NAME.L# = 0;

  28233 19 002733   000000 236003                    LDQ     0,DU
        19 002734   200051 552140                    STBQ    ADDRESS_NAME,'40'O,AUTO

     2076    28234    7                       END;

  28234 19 002735   002743 710000 19                 TRA     s:28241

     2077    28235    6                       ELSE /* User is registered */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:379  
     2078    28236    7                       DO;

     2079    28237    7                           ADDRESS_NAME.L# = USER_NAME.L#;

  28237 19 002736   004427 236000 11                 LDQ     USER_NAME
        19 002737   200051 552140                    STBQ    ADDRESS_NAME,'40'O,AUTO

     2080    28238    7                           ADDRESS_NAME.NAME# = USER_NAME.NAME#;

  28238 19 002740   040100 100400                    MLR     fill='040'O
        19 002741   004427 200400 11                 ADSC9   USER_NAME                cn=1,n=256
        19 002742   200051 200777                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=511

     2081    28239    7                       END;

     2082    28240    6                   END;

     2083    28241    5                   IF ADDRESS_NAME.L# ~= 0

  28241 19 002743   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 002744   777000 316003                    CANQ    -512,DU
        19 002745   002763 600000 19                 TZE     s:28249

     2084    28242    5                   THEN           /* Store as unresolved address */
     2085    28243    6                   DO;

     2086    28244    6                       CALL VMA$ADD_UENTRY_SORTED (ADDRESS_NAME,ADDRESS_FOLDER,

  28244 19 002746   200262 630500                    EPPR0   ADDRESS_SITENAME,,AUTO
        19 002747   201711 450500                    STP0    I+103,,AUTO
        19 002750   200251 631500                    EPPR1   ADDRESS_PASS,,AUTO
        19 002751   201710 451500                    STP1    I+102,,AUTO
        19 002752   200253 633500                    EPPR3   ADDRESS_FOLDER,,AUTO
        19 002753   201707 453500                    STP3    I+101,,AUTO
        19 002754   200051 634500                    EPPR4   ADDRESS_NAME,,AUTO
        19 002755   201706 454500                    STP4    I+100,,AUTO
        19 002756   201706 630500                    EPPR0   I+100,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:380  
        19 002757   000026 631400 20                 EPPR1   22
        19 002760   000000 701000 xent               TSX1    VMA$ADD_UENTRY_SORTED
        19 002761   016514 702000 19                 TSX2    E_PMME

     2087    28245    6                         ADDRESS_PASS,ADDRESS_SITENAME) ALTRET(E_PMME);
     2088    28246    6                   END;

  28246 19 002762   002777 710000 19                 TRA     s:28252

     2089    28247    5                   ELSE           /* Store as resolved address */
     2090    28248    6                   DO;

     2091    28249    6                       CALL VMA$ADD_RENTRY_SORTED (ADDRESS_ACCT,ADDRESS_FOLDER,

  28249 19 002763   200262 630500                    EPPR0   ADDRESS_SITENAME,,AUTO
        19 002764   201711 450500                    STP0    I+103,,AUTO
        19 002765   200251 631500                    EPPR1   ADDRESS_PASS,,AUTO
        19 002766   201710 451500                    STP1    I+102,,AUTO
        19 002767   200253 633500                    EPPR3   ADDRESS_FOLDER,,AUTO
        19 002770   201707 453500                    STP3    I+101,,AUTO
        19 002771   200042 634500                    EPPR4   ADDRESS_ACCT,,AUTO
        19 002772   201706 454500                    STP4    I+100,,AUTO
        19 002773   201706 630500                    EPPR0   I+100,,AUTO
        19 002774   000026 631400 20                 EPPR1   22
        19 002775   000000 701000 xent               TSX1    VMA$ADD_RENTRY_SORTED
        19 002776   016514 702000 19                 TSX2    E_PMME

     2092    28250    6                         ADDRESS_PASS,ADDRESS_SITENAME) ALTRET(E_PMME);
     2093    28251    6                   END;

     2094    28252    5               END;                  /* Do INDX2 = ... End */

  28252 19 002777   000375 054000 11                 AOS     INDX2
        19 003000   200024 470500                    LDP0    BLK$,,AUTO
        19 003001   000001 236100                    LDQ     1,,PR0
        19 003002   000022 772000                    QRL     18
        19 003003   000375 116000 11                 CMPQ    INDX2
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:381  
        19 003004   002554 605400 19                 TPNZ    s:28188

     2095    28253        /*
     2096    28254             ***** Store the completed list ...
     2097    28255        */
     2098    28256    4               CALL VMA$PUT_LIST (VM_LISTKEY,VM_ADDLIST$,

  28256 19 003005   000202 630400 20                 EPPR0   130
        19 003006   000021 631400 20                 EPPR1   17
        19 003007   000000 701000 xent               TSX1    VMA$PUT_LIST
        19 003010   016514 702000 19                 TSX2    E_PMME

     2099    28257    4                 M$MAIL_FILE_NUM) ALTRET(E_PMME);
     2100    28258    4   CREATE_LIST_END:
     2101    28259    4           END;                       /* Do INDX1 = ... end */

  28259 19 003011   200033 054100       CREATE_LIST* AOS     INDX1,,AUTO
        19 003012   200023 470500                    LDP0    OUT$,,AUTO
        19 003013   000001 236100                    LDQ     1,,PR0
        19 003014   000022 772000                    QRL     18
        19 003015   200033 116100                    CMPQ    INDX1,,AUTO
        19 003016   002425 605400 19                 TPNZ    s:28141
        19 003017   016452 710000 19                 TRA     CONTINUE

     2102    28260        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:382  
     2103    28261        /* Create user command */
     2104    28262    3       CASE(%CMD_CREATE_USER);

     2105    28263        /*
     2106    28264             ***** A user definition consists of two parts:
     2107    28265                   1) a definition of where the user's mailbox resides.
     2108    28266                   2) the logon (accn,uname) that uniquely identifies this user.
     2109    28267
     2110    28268                   The first part is stored just as a list definition,
     2111    28269                   except for a different key to identify it as a user
     2112    28270                   rather than a list. The second part is stored in a
     2113    28271                   seperate file, i.e. :NAME.:MAIL ...
     2114    28272
     2115    28273                   The address spec (part one) is stored in the global
     2116    28274                   folder. The user must use this folder in order to
     2117    28275                   create a user definition. Otherwise, error!!!
     2118    28276        */
     2119    28277        /*E*    ERROR: VMO-E$USEREXISTS-0
     2120    28278                MESSAGE: User %U1 already exists.
     2121    28279        */
     2122    28280    3           CALL NEED_GLOBAL ALTRET(CONTINUE);

  28280 19 003020   016577 701000 19                 TSX1    NEED_GLOBAL
        19 003021   016452 702000 19                 TSX2    CONTINUE

     2123    28281        /*
     2124    28282             ***** Check if this user already exists ...
     2125    28283        */
     2126    28284    3           VM_USERKEY.TEXT = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;

  28284 19 003022   200023 470500                    LDP0    OUT$,,AUTO
        19 003023   000003 471500                    LDP1    3,,PR0
        19 003024   100004 236100                    LDQ     4,,PR1
        19 003025   000033 772000                    QRL     27
        19 003026   000000 620006                    EAX0    0,QL
        19 003027   040000 100540                    MLR     fill='040'O
        19 003030   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:383  
        19 003031   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200

     2127    28285        /*
     2128    28286             First see if the name is blank, blow him away is it is
     2129    28287        */
     2130    28288    3           IF VM_USERKEY.TEXT = ' '

  28288 19 003032   040000 106400                    CMPC    fill='040'O
        19 003033   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200
        19 003034   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 003035   003043 601000 19                 TNZ     s:28293

     2131    28289    4           THEN DO;

     2132    28290    4               CALL XUR$ERRMSG(E_BLANKUSER);

  28290 19 003036   000214 630400 20                 EPPR0   140
        19 003037   000024 631400 20                 EPPR1   20
        19 003040   000000 701000 xent               TSX1    XUR$ERRMSG
        19 003041   000000 011000                    NOP     0

     2133    28291    4               GOTO CONTINUE;

  28291 19 003042   016452 710000 19                 TRA     CONTINUE

     2134    28292    4           END;
     2135    28293    3           CALL VMA$GET_LIST (VM_USERKEY,VM_ADDLIST$,

  28293 19 003043   000206 630400 20                 EPPR0   134
        19 003044   000021 631400 20                 EPPR1   17
        19 003045   000000 701000 xent               TSX1    VMA$GET_LIST
        19 003046   003100 702000 19                 TSX2    E_CRUSER1

     2136    28294    3             M$MAIL_FILE_NUM) ALTRET(E_CRUSER1);
     2137    28295        /*
     2138    28296             ***** It does exist...
     2139    28297                   Bug!!!
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:384  
     2140    28298        */
     2141    28299    3           CALL XUR$ERRMSG (E_USEREXISTS,,,

  28299 19 003047   200023 470500                    LDP0    OUT$,,AUTO
        19 003050   000003 471500                    LDP1    3,,PR0
        19 003051   100003 473500                    LDP3    3,,PR1
        19 003052   000100 101500                    MRL     fill='000'O
        19 003053   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 003054   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 003055   201706 220100                    LDX0    I+100,,AUTO
        19 003056   000001 621010                    EAX1    1,X0
        19 003057   000000 635011                    EAA     0,X1
        19 003060   000002 771000                    ARL     2
        19 003061   000140 135007                    SBLA    96,DL
        19 003062   201707 453500                    STP3    I+101,,AUTO
        19 003063   201707 236100                    LDQ     I+101,,AUTO
        19 003064   201710 757100                    STAQ    I+102,,AUTO
        19 003065   201710 631500                    EPPR1   I+102,,AUTO
        19 003066   201715 451500                    STP1    I+107,,AUTO
        19 003067   000022 236000 20                 LDQ     18
        19 003070   201714 756100                    STQ     I+106,,AUTO
        19 003071   000211 235000 20                 LDA     137
        19 003072   201712 757100                    STAQ    I+104,,AUTO
        19 003073   201712 630500                    EPPR0   I+104,,AUTO
        19 003074   000026 631400 20                 EPPR1   22
        19 003075   000000 701000 xent               TSX1    XUR$ERRMSG
        19 003076   000000 011000                    NOP     0

     2142    28300    3             VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXTC$->X$STRING));
     2143    28301    3           GOTO CREATE_USER_END2;

  28301 19 003077   003613 710000 19                 TRA     CREATE_USER_END2

  28300 19 003100                       E_CRUSER1    null
     2144    28302    3   E_CRUSER1: ;
     2145    28303        /*
     2146    28304             ***** Check if a list with this name exists ...
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:385  
     2147    28305        */
     2148    28306    3           VM_LISTKEY.TEXT = VM_USERKEY.TEXT;

  28306 19 003100   040000 100400                    MLR     fill='040'O
        19 003101   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200
        19 003102   000554 400310 11                 ADSC9   VM_LISTKEY               cn=2,n=200

     2149    28307    3           CALL VMA$GET_LIST (VM_LISTKEY,VM_ADDLIST$,

  28307 19 003103   000202 630400 20                 EPPR0   130
        19 003104   000021 631400 20                 EPPR1   17
        19 003105   000000 701000 xent               TSX1    VMA$GET_LIST
        19 003106   003140 702000 19                 TSX2    E_CRUSER2

     2150    28308    3             M$MAIL_FILE_NUM) ALTRET(E_CRUSER2);
     2151    28309        /*
     2152    28310             ***** It does exist...
     2153    28311                   Bug!!!
     2154    28312        */
     2155    28313    3           CALL XUR$ERRMSG (E_LISTEXISTS,,,

  28313 19 003107   200023 470500                    LDP0    OUT$,,AUTO
        19 003110   000003 471500                    LDP1    3,,PR0
        19 003111   100003 473500                    LDP3    3,,PR1
        19 003112   000100 101500                    MRL     fill='000'O
        19 003113   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 003114   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 003115   201706 220100                    LDX0    I+100,,AUTO
        19 003116   000001 621010                    EAX1    1,X0
        19 003117   000000 635011                    EAA     0,X1
        19 003120   000002 771000                    ARL     2
        19 003121   000140 135007                    SBLA    96,DL
        19 003122   201707 453500                    STP3    I+101,,AUTO
        19 003123   201707 236100                    LDQ     I+101,,AUTO
        19 003124   201710 757100                    STAQ    I+102,,AUTO
        19 003125   201710 631500                    EPPR1   I+102,,AUTO
        19 003126   201715 451500                    STP1    I+107,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:386  
        19 003127   000022 236000 20                 LDQ     18
        19 003130   201714 756100                    STQ     I+106,,AUTO
        19 003131   000205 235000 20                 LDA     133
        19 003132   201712 757100                    STAQ    I+104,,AUTO
        19 003133   201712 630500                    EPPR0   I+104,,AUTO
        19 003134   000026 631400 20                 EPPR1   22
        19 003135   000000 701000 xent               TSX1    XUR$ERRMSG
        19 003136   000000 011000                    NOP     0

     2156    28314    3             VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXTC$->X$STRING));
     2157    28315    3           GOTO CREATE_USER_END2;

  28315 19 003137   003613 710000 19                 TRA     CREATE_USER_END2

  28306 19 003140                       E_CRUSER2    null
     2158    28316        /*
     2159    28317             ***** Ok to create the user ...
     2160    28318        */
     2161    28319    3   E_CRUSER2: ;
     2162    28320        /*
     2163    28321             ***** Open the reverse name map file ...
     2164    28322        */
     2165    28323    3           CALL XUR$DISABLE;

  28323 19 003140   000020 631400 20                 EPPR1   16
        19 003141   000000 701000 xent               TSX1    XUR$DISABLE
        19 003142   000000 011000                    NOP     0

     2166    28324    3           CALL M$OPEN (OPEN_NAME_MAP) ALTRET(E_PMME);

  28324 19 003143   000366 630400 12                 EPPR0   OPEN_NAME_MAP
        19 003144   450000 713400                    CLIMB   alt,open
        19 003145   410400 401760                    pmme    nvectors=18
        19 003146   016514 702000 19                 TSX2    E_PMME

     2167    28325        /*
     2168    28326             ***** Initialize VM_ADD_HEAD ...
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:387  
     2169    28327        */
     2170    28328    3           VM_ADD_HEAD.NUM_ENTRIES = 0;

  28328 19 003147   000000 470400 xsym               LDP0    VM_ADDLIST$
        19 003150   000001 450100                    STZ     1,,PR0

     2171    28329    4           DO INDX1 = 1 TO OUT$ -> P$B.NSUBLKS - 1;

  28329 19 003151   000001 235007                    LDA     1,DL
        19 003152   200033 755100                    STA     INDX1,,AUTO
        19 003153   003573 710000 19                 TRA     s:28450+1

     2172    28330    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);

  28330 19 003154   200023 470500                    LDP0    OUT$,,AUTO
        19 003155   200033 720100                    LXL0    INDX1,,AUTO
        19 003156   000003 236110                    LDQ     3,X0,PR0
        19 003157   200024 756100                    STQ     BLK$,,AUTO

     2173    28331        /*
     2174    28332             ***** Initialize the address variables ...
     2175    28333        */
     2176    28334    4               ADDRESS_ACCT.ACCT# = ' ';

  28334 19 003160   000035 235000 20                 LDA     29
        19 003161   000035 236000 20                 LDQ     29
        19 003162   200042 757100                    STAQ    ADDRESS_ACCT,,AUTO

     2177    28335    4               ADDRESS_NAME.L# = 0;

  28335 19 003163   000000 236003                    LDQ     0,DU
        19 003164   200051 552140                    STBQ    ADDRESS_NAME,'40'O,AUTO

     2178    28336    4               ADDRESS_NAME.NAME# = ' ';

  28336 19 003165   040100 100400                    MLR     fill='040'O
        19 003166   000035 000001 20                 ADSC9   29                       cn=0,n=1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:388  
        19 003167   200051 200777                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=511

     2179    28337    4               ADDRESS_FOLDER = ' ';

  28337 19 003170   040100 100400                    MLR     fill='040'O
        19 003171   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 003172   200253 000031                    ADSC9   ADDRESS_FOLDER,,AUTO     cn=0,n=25

     2180    28338    4               ADDRESS_PASS.PASS# = ' ';

  28338 19 003173   000035 235000 20                 LDA     29
        19 003174   000035 236000 20                 LDQ     29
        19 003175   200251 755100                    STA     ADDRESS_PASS,,AUTO
        19 003176   200252 756100                    STQ     ADDRESS_PASS+1,,AUTO

     2181    28339    4               ADDRESS_SITENAME = VM_SITENAME;

  28339 19 003177   040100 100400                    MLR     fill='040'O
        19 003200   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        19 003201   200262 000010                    ADSC9   ADDRESS_SITENAME,,AUTO   cn=0,n=8

     2182    28340    4               ADDRESS_LACCN.ACCT# = ' '; /* Logon accn */

  28340 19 003202   000035 235000 20                 LDA     29
        19 003203   000035 236000 20                 LDQ     29
        19 003204   200044 757100                    STAQ    ADDRESS_LACCN,,AUTO

     2183    28341    4               ADDRESS_LUNAME = ' '; /* Logon uname */

  28341 19 003205   040100 100400                    MLR     fill='040'O
        19 003206   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 003207   200046 000014                    ADSC9   ADDRESS_LUNAME,,AUTO     cn=0,n=12

     2184    28342    4               DOMAIN$ = ADDR(NIL);

  28342 19 003210   000022 236000 20                 LDQ     18
        19 003211   200264 756100                    STQ     DOMAIN$,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:389  

     2185    28343        /*
     2186    28344             ***** Repeat this loop once for each part of the definition ...
     2187    28345        */
     2188    28346    5               DO INDX2 = 0 TO BLK$ -> P$B.NSUBLKS - 1;

  28346 19 003212   000375 450000 11                 STZ     INDX2
        19 003213   003355 710000 19                 TRA     s:28376+1

     2189    28347    5                   PTR2$ = BLK$ -> P$B.SUBLK$(INDX2);

  28347 19 003214   200024 470500                    LDP0    BLK$,,AUTO
        19 003215   000375 720000 11                 LXL0    INDX2
        19 003216   000003 236110                    LDQ     3,X0,PR0
        19 003217   200026 756100                    STQ     PTR2$,,AUTO

     2190    28348    6                   DO CASE (PTR2$ -> P$B.CODE);

  28348 19 003220   200026 471500                    LDP1    PTR2$,,AUTO
        19 003221   100000 721100                    LXL1    0,,PR1
        19 003222   000010 101003                    CMPX1   8,DU
        19 003223   003225 602011 19                 TNC     s:28348+5,X1
        19 003224   003354 710000 19                 TRA     s:28376
        19 003225   003354 710000 19                 TRA     s:28376
        19 003226   003253 710000 19                 TRA     s:28357
        19 003227   003235 710000 19                 TRA     s:28350
        19 003230   003354 710000 19                 TRA     s:28376
        19 003231   003354 710000 19                 TRA     s:28376
        19 003232   003354 710000 19                 TRA     s:28376
        19 003233   003354 710000 19                 TRA     s:28376
        19 003234   003244 710000 19                 TRA     s:28352

     2191    28349    6                   CASE (%ADD_ACCT);

     2192    28350    6                       ADDRESS_LACCN.ACCT# = PTR2$ -> P$S.TEXT;

  28350 19 003235   100004 236100                    LDQ     4,,PR1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:390  
        19 003236   000033 772000                    QRL     27
        19 003237   000000 622006                    EAX2    0,QL
        19 003240   040100 100540                    MLR     fill='040'O
        19 003241   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 003242   200044 000010                    ADSC9   ADDRESS_LACCN,,AUTO      cn=0,n=8
        19 003243   003354 710000 19                 TRA     s:28376

     2193    28351    6                   CASE (%ADD_UNAME);

     2194    28352    6                       ADDRESS_LUNAME = PTR2$ -> P$S.TEXT;

  28352 19 003244   100004 236100                    LDQ     4,,PR1
        19 003245   000033 772000                    QRL     27
        19 003246   000000 622006                    EAX2    0,QL
        19 003247   040100 100540                    MLR     fill='040'O
        19 003250   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 003251   200046 000014                    ADSC9   ADDRESS_LUNAME,,AUTO     cn=0,n=12
        19 003252   003354 710000 19                 TRA     s:28376

     2195    28353    6                   CASE (%ADD_ADDRESS);

     2196    28354                                                /*
     2197    28355                       ***** Repeat this loop once for each piece of the address ...
     2198    28356                       */
     2199    28357    7                       DO INDX3 = 0 TO PTR2$ -> P$B.NSUBLKS - 1;

  28357 19 003253   200034 450100                    STZ     INDX3,,AUTO
        19 003254   003347 710000 19                 TRA     s:28374+1

     2200    28358    7                           PTR3$ = PTR2$ -> P$B.SUBLK$(INDX3);

  28358 19 003255   200026 470500                    LDP0    PTR2$,,AUTO
        19 003256   200034 720100                    LXL0    INDX3,,AUTO
        19 003257   000003 236110                    LDQ     3,X0,PR0
        19 003260   200027 756100                    STQ     PTR3$,,AUTO

     2201    28359    8                           DO CASE (PTR3$ -> P$B.CODE);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:391  

  28359 19 003261   200027 471500                    LDP1    PTR3$,,AUTO
        19 003262   100000 721100                    LXL1    0,,PR1
        19 003263   000012 101003                    CMPX1   10,DU
        19 003264   003266 602011 19                 TNC     s:28359+5,X1
        19 003265   003346 710000 19                 TRA     s:28374
        19 003266   003346 710000 19                 TRA     s:28374
        19 003267   003346 710000 19                 TRA     s:28374
        19 003270   003300 710000 19                 TRA     s:28361
        19 003271   003307 710000 19                 TRA     s:28363
        19 003272   003316 710000 19                 TRA     s:28365
        19 003273   003327 710000 19                 TRA     s:28368
        19 003274   003336 710000 19                 TRA     s:28370
        19 003275   003346 710000 19                 TRA     s:28374
        19 003276   003346 710000 19                 TRA     s:28374
        19 003277   003345 710000 19                 TRA     s:28372

     2202    28360    8                           CASE (%ADD_ACCT);

     2203    28361    8                               ADDRESS_ACCT.ACCT# = PTR3$ -> P$S.TEXT;

  28361 19 003300   100004 236100                    LDQ     4,,PR1
        19 003301   000033 772000                    QRL     27
        19 003302   000000 622006                    EAX2    0,QL
        19 003303   040100 100540                    MLR     fill='040'O
        19 003304   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 003305   200042 000010                    ADSC9   ADDRESS_ACCT,,AUTO       cn=0,n=8
        19 003306   003346 710000 19                 TRA     s:28374

     2204    28362    8                           CASE (%ADD_FOLDER);

     2205    28363    8                               ADDRESS_FOLDER = PTR3$ -> P$S.TEXT;

  28363 19 003307   100004 236100                    LDQ     4,,PR1
        19 003310   000033 772000                    QRL     27
        19 003311   000000 622006                    EAX2    0,QL
        19 003312   040100 100540                    MLR     fill='040'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:392  
        19 003313   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 003314   200253 000031                    ADSC9   ADDRESS_FOLDER,,AUTO     cn=0,n=25
        19 003315   003346 710000 19                 TRA     s:28374

     2206    28364    8                           CASE (%ADD_NAME);

     2207    28365    8                               ADDRESS_NAME.NAME# = PTR3$ -> P$S.TEXT;

  28365 19 003316   100004 236100                    LDQ     4,,PR1
        19 003317   000033 772000                    QRL     27
        19 003320   000000 622006                    EAX2    0,QL
        19 003321   040100 100540                    MLR     fill='040'O
        19 003322   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 003323   200051 200777                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=511

     2208    28366    8                               ADDRESS_NAME.L# = PTR3$ -> P$S.COUNT;

  28366 19 003324   100004 236100                    LDQ     4,,PR1
        19 003325   200051 552140                    STBQ    ADDRESS_NAME,'40'O,AUTO
        19 003326   003346 710000 19                 TRA     s:28374

     2209    28367    8                           CASE (%ADD_PASS);

     2210    28368    8                               ADDRESS_PASS.PASS# = PTR3$ -> P$S.TEXT;

  28368 19 003327   100004 236100                    LDQ     4,,PR1
        19 003330   000033 772000                    QRL     27
        19 003331   000000 622006                    EAX2    0,QL
        19 003332   040100 100540                    MLR     fill='040'O
        19 003333   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 003334   200251 000010                    ADSC9   ADDRESS_PASS,,AUTO       cn=0,n=8
        19 003335   003346 710000 19                 TRA     s:28374

     2211    28369    8                           CASE (%ADD_SITE);

     2212    28370    8                               ADDRESS_SITENAME = PTR3$ -> P$S.TEXT;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:393  
  28370 19 003336   100004 236100                    LDQ     4,,PR1
        19 003337   000033 772000                    QRL     27
        19 003340   000000 622006                    EAX2    0,QL
        19 003341   040100 100540                    MLR     fill='040'O
        19 003342   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 003343   200262 000010                    ADSC9   ADDRESS_SITENAME,,AUTO   cn=0,n=8
        19 003344   003346 710000 19                 TRA     s:28374

     2213    28371    8                           CASE (%ADD_DOMAIN);

     2214    28372    8                               DOMAIN$ = PTR3$;

  28372 19 003345   200264 756100                    STQ     DOMAIN$,,AUTO

     2215    28373    8                           END; /* Do case ... end */

     2216    28374    7                       END;      /* Do INDX3 = ... end */

  28374 19 003346   200034 054100                    AOS     INDX3,,AUTO
        19 003347   200026 470500                    LDP0    PTR2$,,AUTO
        19 003350   000001 236100                    LDQ     1,,PR0
        19 003351   000022 772000                    QRL     18
        19 003352   200034 116100                    CMPQ    INDX3,,AUTO
        19 003353   003255 605400 19                 TPNZ    s:28358

     2217    28375    6                   END;            /* Do CASE(PTR2$) */

     2218    28376    5               END;                  /* Do INDX2 */

  28376 19 003354   000375 054000 11                 AOS     INDX2
        19 003355   200024 470500                    LDP0    BLK$,,AUTO
        19 003356   000001 236100                    LDQ     1,,PR0
        19 003357   000022 772000                    QRL     18
        19 003360   000375 116000 11                 CMPQ    INDX2
        19 003361   003214 605400 19                 TPNZ    s:28347

     2219    28377    4               CALL TRANSFORM_DOMAIN (DOMAIN$, ADDRESS_SITENAME, ADDRESS_NAME)
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:394  

  28377 19 003362   200051 631500                    EPPR1   ADDRESS_NAME,,AUTO
        19 003363   201121 451500                    STP1    @SITENAME+1,,AUTO
        19 003364   200262 633500                    EPPR3   ADDRESS_SITENAME,,AUTO
        19 003365   201120 453500                    STP3    @EXPLICIT+1,,AUTO
        19 003366   200264 634500                    EPPR4   DOMAIN$,,AUTO
        19 003367   201117 454500                    STP4    @CURR_COMMAND_CODE+2,,AUTO
        19 003370   024636 701000 19                 TSX1    TRANSFORM_DOMAIN
        19 003371   003604 702000 19                 TSX2    CREATE_USER_END

     2220    28378    4                 ALTRET (CREATE_USER_END);
     2221    28379        /*
     2222    28380             ***** Fill in default values ...
     2223    28381        */
     2224    28382    4               IF ADDRESS_ACCT.ACCT# = ' '

  28382 19 003372   200042 237100                    LDAQ    ADDRESS_ACCT,,AUTO
        19 003373   000212 117000 20                 CMPAQ   138
        19 003374   003400 601000 19                 TNZ     s:28385

     2225    28383    4               THEN
     2226    28384    4                   ADDRESS_ACCT.ACCT# = ADDRESS_LACCN.ACCT#;

  28384 19 003375   200044 237100                    LDAQ    ADDRESS_LACCN,,AUTO
        19 003376   200042 757100                    STAQ    ADDRESS_ACCT,,AUTO
        19 003377   003405 710000 19                 TRA     s:28390

     2227    28385    4               ELSE IF ADDRESS_LACCN.ACCT# = ' ' THEN

  28385 19 003400   200044 237100                    LDAQ    ADDRESS_LACCN,,AUTO
        19 003401   000212 117000 20                 CMPAQ   138
        19 003402   003405 601000 19                 TNZ     s:28390

     2228    28386    4                       ADDRESS_LACCN.ACCT# = ADDRESS_ACCT.ACCT#;

  28386 19 003403   200042 237100                    LDAQ    ADDRESS_ACCT,,AUTO
        19 003404   200044 757100                    STAQ    ADDRESS_LACCN,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:395  

     2229    28387        /*
     2230    28388             ***** Store the reverse name map info if available ...
     2231    28389        */
     2232    28390    4               IF ADDRESS_LACCN.ACCT# ~= ' '

  28390 19 003405   200044 237100                    LDAQ    ADDRESS_LACCN,,AUTO
        19 003406   000212 117000 20                 CMPAQ   138
        19 003407   003525 600000 19                 TZE     s:28426
        19 003410   040000 106500                    CMPC    fill='040'O
        19 003411   200262 000010                    ADSC9   ADDRESS_SITENAME,,AUTO   cn=0,n=8
        19 003412   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        19 003413   003417 600000 19                 TZE     s:28395
        19 003414   200262 237100                    LDAQ    ADDRESS_SITENAME,,AUTO
        19 003415   000212 117000 20                 CMPAQ   138
        19 003416   003525 601000 19                 TNZ     s:28426

     2233    28391    4                 AND (ADDRESS_SITENAME = VM_SITENAME
     2234    28392    4                 OR ADDRESS_SITENAME = ' ')
     2235    28393    4               THEN                 /* Info avail */
     2236    28394    5               DO;

     2237    28395    5                   CALL CONCAT (NAME_KEY.NAME#,ADDRESS_LACCN.ACCT#,

  28395 19 003417   040000 100500                    MLR     fill='040'O
        19 003420   200044 000010                    ADSC9   ADDRESS_LACCN,,AUTO      cn=0,n=8
        19 003421   002402 200010 11                 ADSC9   NAME_KEY                 cn=1,n=8
        19 003422   040000 100500                    MLR     fill='040'O
        19 003423   200046 000014                    ADSC9   ADDRESS_LUNAME,,AUTO     cn=0,n=12
        19 003424   002404 200014 11                 ADSC9   NAME_KEY+2               cn=1,n=12

     2238    28396    5                     ADDRESS_LUNAME);
     2239    28397    5                   NAME_KEY.L# = 20;

  28397 19 003425   024000 236003                    LDQ     10240,DU
        19 003426   002402 552040 11                 STBQ    NAME_KEY,'40'O

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:396  
     2240    28398    5                   WRITE_NAME_MAP.BUF_ = VECTOR(OUT$ -> P$B.SUBLK$(0)

  28398 19 003427   200023 470500                    LDP0    OUT$,,AUTO
        19 003430   000003 471500                    LDP1    3,,PR0
        19 003431   100004 236100                    LDQ     4,,PR1
        19 003432   000033 772000                    QRL     27
        19 003433   000064 737000                    LLS     52
        19 003434   000140 135007                    SBLA    96,DL
        19 003435   201706 451500                    STP1    I+100,,AUTO
        19 003436   201706 236100                    LDQ     I+100,,AUTO
        19 003437   000215 036000 20                 ADLQ    141
        19 003440   002372 757000 11                 STAQ    WRITE_NAME_MAP+4

     2241    28399    5                     -> P$S.TEXT);
     2242    28400        /*
     2243    28401             ***** Check if this NAME_MAP entry already exists.
     2244    28402                   If it does, then error!!!
     2245    28403        */
     2246    28404    5                   CALL M$READ (READ_NAME_MAP)

  28404 19 003441   000472 630400 12                 EPPR0   READ_NAME_MAP
        19 003442   440000 713400                    CLIMB   alt,read
        19 003443   401400 401760                    pmme    nvectors=4
        19 003444   003520 702000 19                 TSX2    s:28422

     2247    28405    5                   WHENRETURN
     2248    28406    6                   DO;

     2249    28407    6                       IF OUT$->P$B.SUBLK$(0)->P$S.TEXT ~= SUBSTR(WORK_STRING.NAME#,

  28407 19 003445   200023 470500                    LDP0    OUT$,,AUTO
        19 003446   000003 471500                    LDP1    3,,PR0
        19 003447   100004 236100                    LDQ     4,,PR1
        19 003450   000033 772000                    QRL     27
        19 003451   000000 620006                    EAX0    0,QL
        19 003452   000000 236007 xsym               LDQ     M$NAME,DL
        19 003453   000074 473400 20                 LDP3    60
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:397  
        19 003454   300000 474500                    LDP4    0,,PR3
        19 003455   400000 475506                    LDP5    0,QL,PR4
        19 003456   500000 721100                    LXL1    0,,PR5
        19 003457   040040 106540                    CMPC    fill='040'O
        19 003460   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 003461   000174 200011 11                 ADSC9   WORK_STRING              cn=1,n=*X1
        19 003462   003520 600000 19                 TZE     s:28422

     2250    28408    6                         0, DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS#)
     2251    28409    7                       THEN DO;

     2252    28410    7                           IF DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS# <= 31

  28410 19 003463   000000 236007 xsym               LDQ     M$NAME,DL
        19 003464   400000 475506                    LDP5    0,QL,PR4
        19 003465   500000 235100                    LDA     0,,PR5
        19 003466   000037 115007                    CMPA    31,DL
        19 003467   003476 605400 19                 TPNZ    s:28414

     2253    28411    7                           THEN
     2254    28412    7                               WORK_STRING.L# = DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS#;

  28412 19 003470   000000 236007 xsym               LDQ     M$NAME,DL
        19 003471   400000 475506                    LDP5    0,QL,PR4
        19 003472   500000 236100                    LDQ     0,,PR5
        19 003473   000033 736000                    QLS     27
        19 003474   000174 552040 11                 STBQ    WORK_STRING,'40'O
        19 003475   003503 710000 19                 TRA     s:28417

     2255    28413    8                           ELSE DO;

     2256    28414    8                               WORK_STRING.L# = 31;

  28414 19 003476   037000 236003                    LDQ     15872,DU
        19 003477   000174 552040 11                 STBQ    WORK_STRING,'40'O

     2257    28415    8                               SUBSTR (WORK_STRING.NAME#,28,3) = '...';
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:398  

  28415 19 003500   001362 236000 12                 LDQ     VM_PROKEY+5
        19 003501   000011 772000                    QRL     9
        19 003502   000203 552034 11                 STBQ    WORK_STRING+7,'34'O

     2258    28416    8                           END;

     2259    28417    7                           CALL XUR$ERRMSG (E_NMENTRYEXISTS,,,

  28417 19 003503   000175 236000 20                 LDQ     125
        19 003504   201712 756100                    STQ     I+104,,AUTO
        19 003505   000220 236000 20                 LDQ     144
        19 003506   000022 235000 20                 LDA     18
        19 003507   201710 757100                    STAQ    I+102,,AUTO
        19 003510   000022 236000 20                 LDQ     18
        19 003511   000221 235000 20                 LDA     145
        19 003512   201706 757100                    STAQ    I+100,,AUTO
        19 003513   201706 630500                    EPPR0   I+100,,AUTO
        19 003514   000041 631400 20                 EPPR1   33
        19 003515   000000 701000 xent               TSX1    XUR$ERRMSG
        19 003516   000000 011000                    NOP     0

     2260    28418    7                             VECTOR(NAME_KEY),VECTOR(WORK_STRING));
     2261    28419    7                           GOTO CREATE_USER_END;

  28419 19 003517   003604 710000 19                 TRA     CREATE_USER_END

     2262    28420    7                       END;
     2263    28421    6                   END;
     2264    28422    5                   CALL M$WRITE (WRITE_NAME_MAP) ALTRET(E_PMME);

  28422 19 003520   002366 630400 11                 EPPR0   WRITE_NAME_MAP
        19 003521   440001 713400                    CLIMB   alt,write
        19 003522   401400 401760                    pmme    nvectors=4
        19 003523   016514 702000 19                 TSX2    E_PMME

     2265    28423    5               END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:399  

  28423 19 003524   003532 710000 19                 TRA     ITS_OK

     2266    28424    4               ELSE
     2267    28425    5               DO;

     2268    28426    5                   NAME_KEY.L# = 0;

  28426 19 003525   000000 236003                    LDQ     0,DU
        19 003526   002402 552040 11                 STBQ    NAME_KEY,'40'O

     2269    28427    5                   NAME_KEY.NAME# = ' ';

  28427 19 003527   040000 100400                    MLR     fill='040'O
        19 003530   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 003531   002402 200024 11                 ADSC9   NAME_KEY                 cn=1,n=20

     2270    28428    5               END;

     2271    28429        /*
     2272    28430             ***** Add this entry to the user list ...
     2273    28431        */
     2274    28432    4   ITS_OK:     IF ADDRESS_NAME.L# ~= 0

  28432 19 003532   200051 236100       ITS_OK       LDQ     ADDRESS_NAME,,AUTO
        19 003533   777000 316003                    CANQ    -512,DU
        19 003534   003554 600000 19                 TZE     s:28442

     2275    28433    4               THEN                 /* Store as unresolved address */
     2276    28434    5               DO;

     2277    28435    5                   CALL VMA$ADD_UENTRY_SORTED (ADDRESS_NAME,

  28435 19 003535   000222 237000 20                 LDAQ    146
        19 003536   201712 757100                    STAQ    I+104,,AUTO
        19 003537   200262 630500                    EPPR0   ADDRESS_SITENAME,,AUTO
        19 003540   201711 450500                    STP0    I+103,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:400  
        19 003541   200251 631500                    EPPR1   ADDRESS_PASS,,AUTO
        19 003542   201710 451500                    STP1    I+102,,AUTO
        19 003543   200253 633500                    EPPR3   ADDRESS_FOLDER,,AUTO
        19 003544   201707 453500                    STP3    I+101,,AUTO
        19 003545   200051 634500                    EPPR4   ADDRESS_NAME,,AUTO
        19 003546   201706 454500                    STP4    I+100,,AUTO
        19 003547   201706 630500                    EPPR0   I+100,,AUTO
        19 003550   000130 631400 20                 EPPR1   88
        19 003551   000000 701000 xent               TSX1    VMA$ADD_UENTRY_SORTED
        19 003552   016514 702000 19                 TSX2    E_PMME

     2278    28436    5                     ADDRESS_FOLDER,
     2279    28437    5                     ADDRESS_PASS,ADDRESS_SITENAME,%NO#,NAME_KEY.
     2280    28438    5                     NAME#) ALTRET(E_PMME);
     2281    28439    5               END;

  28439 19 003553   003572 710000 19                 TRA     s:28450

     2282    28440    4               ELSE                 /* Store as resolved address */
     2283    28441    5               DO;

     2284    28442    5                   CALL VMA$ADD_RENTRY_SORTED (ADDRESS_ACCT,

  28442 19 003554   000222 237000 20                 LDAQ    146
        19 003555   201712 757100                    STAQ    I+104,,AUTO
        19 003556   200262 630500                    EPPR0   ADDRESS_SITENAME,,AUTO
        19 003557   201711 450500                    STP0    I+103,,AUTO
        19 003560   200251 631500                    EPPR1   ADDRESS_PASS,,AUTO
        19 003561   201710 451500                    STP1    I+102,,AUTO
        19 003562   200253 633500                    EPPR3   ADDRESS_FOLDER,,AUTO
        19 003563   201707 453500                    STP3    I+101,,AUTO
        19 003564   200042 634500                    EPPR4   ADDRESS_ACCT,,AUTO
        19 003565   201706 454500                    STP4    I+100,,AUTO
        19 003566   201706 630500                    EPPR0   I+100,,AUTO
        19 003567   000130 631400 20                 EPPR1   88
        19 003570   000000 701000 xent               TSX1    VMA$ADD_RENTRY_SORTED
        19 003571   016514 702000 19                 TSX2    E_PMME
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:401  

     2285    28443    5                     ADDRESS_FOLDER,
     2286    28444    5                     ADDRESS_PASS,ADDRESS_SITENAME,%NO#,NAME_KEY.
     2287    28445    5                     NAME#) ALTRET(E_PMME);
     2288    28446    5               END;

     2289    28447        /*
     2290    28448             ***** Store the completed list ...
     2291    28449        */
     2292    28450    4           END;

  28450 19 003572   200033 054100                    AOS     INDX1,,AUTO
        19 003573   200023 470500                    LDP0    OUT$,,AUTO
        19 003574   000001 236100                    LDQ     1,,PR0
        19 003575   000022 772000                    QRL     18
        19 003576   200033 116100                    CMPQ    INDX1,,AUTO
        19 003577   003154 605400 19                 TPNZ    s:28330

     2293    28451    3           CALL VMA$PUT_LIST (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)

  28451 19 003600   000206 630400 20                 EPPR0   134
        19 003601   000021 631400 20                 EPPR1   17
        19 003602   000000 701000 xent               TSX1    VMA$PUT_LIST
        19 003603   016514 702000 19                 TSX2    E_PMME

     2294    28452    3             ALTRET(E_PMME);
     2295    28453    3   CREATE_USER_END:
     2296    28454    3           CLOSE_SAVE.V.DCB# = DCBNUM(M$NAME);

  28454 19 003604   000000 236007 xsym  CREATE_USER* LDQ     M$NAME,DL
        19 003605   000000 620006                    EAX0    0,QL
        19 003606   002142 740000 11                 STX0    CLOSE_SAVE+26

     2297    28455    3           CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  28455 19 003607   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 003610   450001 713400                    CLIMB   alt,close
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:402  
        19 003611   406000 401760                    pmme    nvectors=13
        19 003612   016514 702000 19                 TSX2    E_PMME

     2298    28456    3   CREATE_USER_END2:
     2299    28457    3           CALL XUR$ENABLE;

  28457 19 003613   000020 631400 20    CREATE_USER* EPPR1   16
        19 003614   000000 701000 xent               TSX1    XUR$ENABLE
        19 003615   000000 011000                    NOP     0
        19 003616   016452 710000 19                 TRA     CONTINUE

     2300    28458        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:403  
     2301    28459        /* Delete folder command */
     2302    28460    3       CASE (%CMD_DELETE_FOLDER);

     2303    28461        /*
     2304    28462             ***** Look at folders in the user's file directory acct ...
     2305    28463        */
     2306    28464    3           INDX2 = 0;                  /* Used as counter */

  28464 19 003617   000375 450000 11                 STZ     INDX2

     2307    28465    3           VM_RADDRESS.ACCT = VM_CENTRAL_FOLDER.ACCT;

  28465 19 003620   040100 100400                    MLR     fill='040'O
        19 003621   001135 400010 11                 ADSC9   VM_CENTRAL_FOLDER+1      cn=2,n=8
        19 003622   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8

     2308    28466    3           VM_RADDRESS.FOLDER = 'CENTRAL';   /* Default is CENTRAL folder */

  28466 19 003623   040100 100400                    MLR     fill='040'O
        19 003624   001360 000007 12                 ADSC9   VM_PROKEY+3              cn=0,n=7
        19 003625   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25

     2309    28467    3           VM_RADDRESS.PASS = ' ';

  28467 19 003626   040100 100400                    MLR     fill='040'O
        19 003627   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 003630   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8

     2310    28468    3           VM_RADDRESS.SITENAME = ' ';

  28468 19 003631   040100 100400                    MLR     fill='040'O
        19 003632   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 003633   200770 600010                    ADSC9   VM_RADDRESS+15,,AUTO     cn=3,n=8

     2311    28469    3           VM_RADDRESS.TYPE = %VM_ADD_RESOLVED;

  28469 19 003634   000001 236003                    LDQ     1,DU
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:404  
        19 003635   200753 552120                    STBQ    VM_RADDRESS+2,'20'O,AUTO

     2312    28470    3           IF OUT$ -> P$B.NSUBLKS ~= 0

  28470 19 003636   200023 474500                    LDP4    OUT$,,AUTO
        19 003637   400001 220100                    LDX0    1,,PR4
        19 003640   003723 600000 19                 TZE     s:28493

     2313    28471    3           THEN
     2314    28472    4           DO;                    /* Pick up options */

     2315    28473    4               BLK$ = OUT$ -> P$B.SUBLK$(0);

  28473 19 003641   400003 236100                    LDQ     3,,PR4
        19 003642   200024 756100                    STQ     BLK$,,AUTO

     2316    28474        /*
     2317    28475             ***** Repeat this loop once for each piece of the address ...
     2318    28476        */
     2319    28477    5               DO INDX1 = 0 TO BLK$ -> P$B.NSUBLKS - 1;

  28477 19 003643   200033 450100                    STZ     INDX1,,AUTO
        19 003644   003716 710000 19                 TRA     s:28490+1

     2320    28478    5                   PTR1$ = BLK$ -> P$B.SUBLK$(INDX1);

  28478 19 003645   200024 470500                    LDP0    BLK$,,AUTO
        19 003646   200033 720100                    LXL0    INDX1,,AUTO
        19 003647   000003 236110                    LDQ     3,X0,PR0
        19 003650   200025 756100                    STQ     PTR1$,,AUTO

     2321    28479    6                   DO CASE (PTR1$ -> P$B.CODE);

  28479 19 003651   200025 471500                    LDP1    PTR1$,,AUTO
        19 003652   100000 721100                    LXL1    0,,PR1
        19 003653   000006 101003                    CMPX1   6,DU
        19 003654   003656 602011 19                 TNC     s:28479+5,X1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:405  
        19 003655   003715 710000 19                 TRA     s:28490
        19 003656   003715 710000 19                 TRA     s:28490
        19 003657   003715 710000 19                 TRA     s:28490
        19 003660   003664 710000 19                 TRA     s:28481
        19 003661   003673 710000 19                 TRA     s:28483
        19 003662   003702 710000 19                 TRA     s:28485
        19 003663   003707 710000 19                 TRA     s:28488

     2322    28480    6                   CASE (%ADD_ACCT);

     2323    28481    6                       VM_RADDRESS.ACCT = PTR1$ -> P$S.TEXT;

  28481 19 003664   100004 236100                    LDQ     4,,PR1
        19 003665   000033 772000                    QRL     27
        19 003666   000000 622006                    EAX2    0,QL
        19 003667   040100 100540                    MLR     fill='040'O
        19 003670   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 003671   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8
        19 003672   003715 710000 19                 TRA     s:28490

     2324    28482    6                   CASE (%ADD_FOLDER);

     2325    28483    6                       VM_RADDRESS.FOLDER = PTR1$ -> P$S.TEXT;

  28483 19 003673   100004 236100                    LDQ     4,,PR1
        19 003674   000033 772000                    QRL     27
        19 003675   000000 622006                    EAX2    0,QL
        19 003676   040100 100540                    MLR     fill='040'O
        19 003677   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 003700   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
        19 003701   003715 710000 19                 TRA     s:28490

     2326    28484    6                   CASE (%ADD_NAME);

     2327    28485    6                       CALL XUR$ERRMSG (E_NAMENTALLOWED);

  28485 19 003702   000166 630400 20                 EPPR0   118
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:406  
        19 003703   000024 631400 20                 EPPR1   20
        19 003704   000000 701000 xent               TSX1    XUR$ERRMSG
        19 003705   000000 011000                    NOP     0

     2328    28486    6                       GOTO CONTINUE;

  28486 19 003706   016452 710000 19                 TRA     CONTINUE

     2329    28487    6                   CASE (%ADD_PASS);

     2330    28488    6                       VM_RADDRESS.PASS = PTR1$ -> P$S.TEXT;

  28488 19 003707   100004 236100                    LDQ     4,,PR1
        19 003710   000033 772000                    QRL     27
        19 003711   000000 622006                    EAX2    0,QL
        19 003712   040100 100540                    MLR     fill='040'O
        19 003713   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 003714   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8

     2331    28489    6                   END;       /* Do case ... end */

     2332    28490    5               END;             /* Do INDX1 = ... end */

  28490 19 003715   200033 054100                    AOS     INDX1,,AUTO
        19 003716   200024 470500                    LDP0    BLK$,,AUTO
        19 003717   000001 236100                    LDQ     1,,PR0
        19 003720   000022 772000                    QRL     18
        19 003721   200033 116100                    CMPQ    INDX1,,AUTO
        19 003722   003645 605400 19                 TPNZ    s:28478

     2333    28491    4           END;                  /* Pick up options */

     2334    28492        /**/
     2335    28493    3           IF VM_CURRENT_FOLDER.ACCT = VM_RADDRESS.ACCT

  28493 19 003723   040100 106400                    CMPC    fill='040'O
        19 003724   001244 400010 11                 ADSC9   VM_CURRENT_FOLDER+1      cn=2,n=8
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:407  
        19 003725   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8
        19 003726   003740 601000 19                 TNZ     s:28499
        19 003727   040100 106400                    CMPC    fill='040'O
        19 003730   001246 400031 11                 ADSC9   VM_CURRENT_FOLDER+3      cn=2,n=25
        19 003731   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
        19 003732   003740 601000 19                 TNZ     s:28499

     2336    28494    3             AND VM_CURRENT_FOLDER.FOLDER = VM_RADDRESS.FOLDER
     2337    28495    4           THEN DO;

     2338    28496    4               CALL XUR$ERRMSG (E_CANTDELCUR);

  28496 19 003733   000224 630400 20                 EPPR0   148
        19 003734   000024 631400 20                 EPPR1   20
        19 003735   000000 701000 xent               TSX1    XUR$ERRMSG
        19 003736   000000 011000                    NOP     0

     2339    28497    4               GOTO CONTINUE;

  28497 19 003737   016452 710000 19                 TRA     CONTINUE

     2340    28498    4           END;
     2341    28499    3           FID_ACCT.ACCT# = VM_RADDRESS.ACCT;

  28499 19 003740   040000 100500                    MLR     fill='040'O
        19 003741   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8
        19 003742   002215 000010 11                 ADSC9   FID_ACCT                 cn=0,n=8

     2342    28500    3           FID_PASS.PASS# = VM_RADDRESS.PASS;

  28500 19 003743   040000 100500                    MLR     fill='040'O
        19 003744   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8
        19 003745   002217 000010 11                 ADSC9   FID_PASS                 cn=0,n=8

     2343    28501    3           CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;

  28501 19 003746   000000 720000 xsym               LXL0    M$WORK_NUM
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:408  
        19 003747   002200 740000 11                 STX0    CLOSE_SCRATCH+26

     2344    28502        /*
     2345    28503             ***** Wildcard specified ???
     2346    28504        */
     2347    28505    3           IF VM_RADDRESS.FOLDER = 'CENTRAL'

  28505 19 003750   040000 106500                    CMPC    fill='040'O
        19 003751   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
        19 003752   001360 000007 12                 ADSC9   VM_PROKEY+3              cn=0,n=7
        19 003753   003757 601000 19                 TNZ     s:28508

     2348    28506    3           THEN                       /* Supply name of central folder */
     2349    28507    3               VM_RADDRESS.FOLDER = VM_CENTRAL_FOLDER.FOLDER;

  28507 19 003754   040100 100400                    MLR     fill='040'O
        19 003755   001137 400031 11                 ADSC9   VM_CENTRAL_FOLDER+3      cn=2,n=25
        19 003756   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25

     2350    28508    3           WILDCARD_PATTERN = VM_RADDRESS.FOLDER;

  28508 19 003757   040100 100500                    MLR     fill='040'O
        19 003760   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
        19 003761   200014 000031                    ADSC9   WILDCARD_PATTERN,,AUTO   cn=0,n=25

     2351    28509    3           CALL INDEX(INDX1,'?',WILDCARD_PATTERN)

  28509 19 003762   000000 124500                    SCM     mask='000'O
        19 003763   200014 000031                    ADSC9   WILDCARD_PATTERN,,AUTO   cn=0,n=25
        19 003764   000225 000001 20                 ADSC9   149                      cn=0,n=1
        19 003765   200033 000100                    ARG     INDX1,,AUTO
        19 003766   003772 606400 19                 TTN     s:28514

     2352    28510    4           WHENRETURN DO;

     2353    28511    4               WILD = %YES#;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:409  
  28511 19 003767   400000 236003                    LDQ     -131072,DU
        19 003770   200041 756100                    STQ     WILD,,AUTO

     2354    28512    4           END;

  28512 19 003771   003773 710000 19                 TRA     s:28516

     2355    28513    4           WHENALTRETURN DO;

     2356    28514    4               WILD = %NO#;

  28514 19 003772   200041 450100                    STZ     WILD,,AUTO

     2357    28515    4           END;

     2358    28516    3           CALL INDEX(INDX1,' ',WILDCARD_PATTERN);

  28516 19 003773   000000 124500                    SCM     mask='000'O
        19 003774   200014 000031                    ADSC9   WILDCARD_PATTERN,,AUTO   cn=0,n=25
        19 003775   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 003776   200033 000100                    ARG     INDX1,,AUTO

     2359    28517    3           VM_WILDCARD.PATTERN_ = VECTOR(SUBSTR(WILDCARD_PATTERN,0,INDX1));

  28517 19 003777   200033 235100                    LDA     INDX1,,AUTO
        19 004000   000020 735000                    ALS     16
        19 004001   000140 135007                    SBLA    96,DL
        19 004002   201706 452500                    STP2    I+100,,AUTO
        19 004003   201706 236100                    LDQ     I+100,,AUTO
        19 004004   000014 036003                    ADLQ    12,DU
        19 004005   001634 757000 11                 STAQ    VM_WILDCARD

     2360    28518    3           OPEN_NEXT.NAME_ = VECTOR(FID_NAME);

  28518 19 004006   000226 237000 20                 LDAQ    150
        19 004007   002302 757000 11                 STAQ    OPEN_NEXT+6

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:410  
     2361    28519    3           FID_NAME.NAME# = ':MAIL_';

  28519 19 004010   040000 100400                    MLR     fill='040'O
        19 004011   001363 000006 12                 ADSC9   VM_PROKEY+6              cn=0,n=6
        19 004012   002205 200037 11                 ADSC9   FID_NAME                 cn=1,n=31

     2362    28520    3           FID_NAME.L# = LENGTHC(':MAIL_');

  28520 19 004013   006000 236003                    LDQ     3072,DU
        19 004014   002205 552040 11                 STBQ    FID_NAME,'40'O

     2363    28521    3           CALL GET_WILD_FOLDER ALTRET(END_DEL_FOLDER);

  28521 19 004015   016664 701000 19                 TSX1    GET_WILD_FOLDER
        19 004016   004050 702000 19                 TSX2    END_DEL_FOLDER

     2364    28522    3           OPEN_NEXT.NAME_ = VECTOR(NIL);

  28522 19 004017   000230 237000 20                 LDAQ    152
        19 004020   002302 757000 11                 STAQ    OPEN_NEXT+6

     2365    28523    4           DO FOREVER;

     2366    28524    4               CALL M$CLOSE (CLOSE_SCRATCH)

  28524 19 004021   002146 630400 11                 EPPR0   CLOSE_SCRATCH
        19 004022   450001 713400                    CLIMB   alt,close
        19 004023   406000 401760                    pmme    nvectors=13
        19 004024   004027 702000 19                 TSX2    s:28529

     2367    28525    5               WHENRETURN DO;

     2368    28526    5                   INDX2 = INDX2 + 1;

  28526 19 004025   000375 054000 11                 AOS     INDX2

     2369    28527    5               END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:411  

  28527 19 004026   004043 710000 19                 TRA     s:28536

     2370    28528    5               WHENALTRETURN DO;

     2371    28529    5                   ERROR = B$TCB.ALT$->B$ALT.ERR;

  28529 19 004027   000000 470400 xsym               LDP0    B$TCB$
        19 004030   000000 471500                    LDP1    0,,PR0
        19 004031   100102 236100                    LDQ     66,,PR1
        19 004032   002204 756000 11                 STQ     ERROR

     2372    28530    5                   CALL XUR$ERRMSG (E_CANTDELF);

  28530 19 004033   000232 630400 20                 EPPR0   154
        19 004034   000024 631400 20                 EPPR1   20
        19 004035   000000 701000 xent               TSX1    XUR$ERRMSG
        19 004036   000000 011000                    NOP     0

     2373    28531    5                   CALL XUR$ERRMSG (ERROR,M$WORK_NUM);

  28531 19 004037   000155 630400 20                 EPPR0   109
        19 004040   000000 631400 20                 EPPR1   0
        19 004041   000000 701000 xent               TSX1    XUR$ERRMSG
        19 004042   000000 011000                    NOP     0

     2374    28532    5               END;

     2375    28533        /*
     2376    28534             ***** If wildcard specified, loop to process other matches ...
     2377    28535        */
     2378    28536    4               IF NOT WILD

  28536 19 004043   200041 234100                    SZN     WILD,,AUTO
        19 004044   004050 605000 19                 TPL     END_DEL_FOLDER

     2379    28537    4               THEN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:412  
     2380    28538    4                   GOTO END_DEL_FOLDER;
     2381    28539    4               CALL GET_WILD_FOLDER ALTRET(END_DEL_FOLDER);

  28539 19 004045   016664 701000 19                 TSX1    GET_WILD_FOLDER
        19 004046   004050 702000 19                 TSX2    END_DEL_FOLDER

     2382    28540    4           END;                       /* Do forever ... end */

  28540 19 004047   004021 710000 19                 TRA     s:28524

     2383    28541        /*
     2384    28542             ***** Get the profile for the current folder ...
     2385    28543        */
     2386    28544    3   END_DEL_FOLDER:
     2387    28545    3          CALL REPORT_ACTIVITY (INDX2,VM_FOLDER_DELETED_FMT,%NO#,E_FOLDER_DELETED_FMT)
             28545                    ;

  28545 19 004050   000233 236000 20    END_DEL_FOL* LDQ     155
        19 004051   201122 756100                    STQ     @NAME+1,,AUTO
        19 004052   000234 237000 20                 LDAQ    156
        19 004053   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 004054   000154 236000 20                 LDQ     108
        19 004055   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 004056   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 004057   000000 011000                    NOP     0
        19 004060   016452 710000 19                 TRA     CONTINUE

     2388    28546        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:413  
     2389    28547        /* Delete list command */
     2390    28548    3       CASE (%CMD_DELETE_LIST);

     2391    28549    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  28549 19 004061   016562 701000 19                 TSX1    NEED_UPDATE
        19 004062   016452 702000 19                 TSX2    CONTINUE

     2392    28550    3           INDX2 = 0;                  /* Used as counter */

  28550 19 004063   000375 450000 11                 STZ     INDX2

     2393    28551    3           CALL INDEX(INDX1,'?',OUT$->P$B.SUBLK$(0)->P$S.TEXT) ALTRET(

  28551 19 004064   200023 470500                    LDP0    OUT$,,AUTO
        19 004065   000003 471500                    LDP1    3,,PR0
        19 004066   100004 236100                    LDQ     4,,PR1
        19 004067   000033 772000                    QRL     27
        19 004070   000000 620006                    EAX0    0,QL
        19 004071   000000 124540                    SCM     mask='000'O
        19 004072   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 004073   000225 000001 20                 ADSC9   149                      cn=0,n=1
        19 004074   200033 000100                    ARG     INDX1,,AUTO
        19 004075   004175 606400 19                 TTN     NON_WILD_DEL_LIST

     2394    28552    3             NON_WILD_DEL_LIST);
     2395    28553    3           VM_WILDCARD.PATTERN_ = VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXT);

  28553 19 004076   000003 471500                    LDP1    3,,PR0
        19 004077   100004 236100                    LDQ     4,,PR1
        19 004100   000033 772000                    QRL     27
        19 004101   000064 737000                    LLS     52
        19 004102   000140 135007                    SBLA    96,DL
        19 004103   201706 451500                    STP1    I+100,,AUTO
        19 004104   201706 236100                    LDQ     I+100,,AUTO
        19 004105   000215 036000 20                 ADLQ    141
        19 004106   001634 757000 11                 STAQ    VM_WILDCARD
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:414  

     2396    28554    3           CALL XLATE (OUT$->P$B.SUBLK$(0)->P$S.TEXT, LOWER_UPPER,

  28554 19 004107   000003 471500                    LDP1    3,,PR0
        19 004110   100004 236100                    LDQ     4,,PR1
        19 004111   000033 772000                    QRL     27
        19 004112   000000 620006                    EAX0    0,QL
        19 004113   000000 473400 xsym               LDP3    B$XL_UPPER$
        19 004114   000000 621006                    EAX1    0,QL
        19 004115   040140 160540                    MVT     fill='040'O
        19 004116   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 004117   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        19 004120   300000 000100                    ARG     0,,PR3

     2397    28555    3             OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2398    28556    3           VM_LISTKEY.TEXT = ' ';      /* Start at first entry */

  28556 19 004121   040000 100400                    MLR     fill='040'O
        19 004122   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 004123   000554 400310 11                 ADSC9   VM_LISTKEY               cn=2,n=200

     2399    28557    3           VM_LISTKEY2 = VM_LISTKEY;   /* Remember previous entry */

  28557 19 004124   000000 100400                    MLR     fill='000'O
        19 004125   000554 000312 11                 ADSC9   VM_LISTKEY               cn=0,n=202
        19 004126   000637 000312 11                 ADSC9   VM_LISTKEY2              cn=0,n=202

     2400    28558    3           CALL VMA$GET_LIST_NEXT (VM_LISTKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(

  28558 19 004127   000202 630400 20                 EPPR0   130
        19 004130   000021 631400 20                 EPPR1   17
        19 004131   000000 701000 xent               TSX1    VMA$GET_LIST_NEXT
        19 004132   004226 702000 19                 TSX2    END_DEL_LIST

     2401    28559    3             END_DEL_LIST);
     2402    28560    4           DO FOREVER;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:415  
     2403    28561    4               VM_WILDCARD.INPUT_ = VECTOR(SUBSTR(VM_LISTKEY.TEXT,0,

  28561 19 004133   000554 236000 11                 LDQ     VM_LISTKEY
        19 004134   000033 772000                    QRL     27
        19 004135   777777 620006                    EAX0    -1,QL
        19 004136   000000 635010                    EAA     0,X0
        19 004137   000002 771000                    ARL     2
        19 004140   000140 135007                    SBLA    96,DL
        19 004141   000236 236000 20                 LDQ     158
        19 004142   001636 757000 11                 STAQ    VM_WILDCARD+2

     2404    28562    4                 VM_LISTKEY.COUNT-1)); /* One less for type */
     2405    28563    4               CALL X$WILDCMP (VM_WILDCARD)

  28563 19 004143   000237 630400 20                 EPPR0   159
        19 004144   000024 631400 20                 EPPR1   20
        19 004145   000000 701000 xent               TSX1    X$WILDCMP
        19 004146   004162 702000 19                 TSX2    s:28571

     2406    28564    4               WHENRETURN
     2407    28565    5               DO;

     2408    28566    5                   CALL VMA$DEL_LIST (VM_LISTKEY,,M$MAIL_FILE_NUM) ALTRET(E_PMME);

  28566 19 004147   000053 236000 20                 LDQ     43
        19 004150   201710 756100                    STQ     I+102,,AUTO
        19 004151   000022 236000 20                 LDQ     18
        19 004152   000202 235000 20                 LDA     130
        19 004153   201706 757100                    STAQ    I+100,,AUTO
        19 004154   201706 630500                    EPPR0   I+100,,AUTO
        19 004155   000021 631400 20                 EPPR1   17
        19 004156   000000 701000 xent               TSX1    VMA$DEL_LIST
        19 004157   016514 702000 19                 TSX2    E_PMME

     2409    28567    5                   INDX2 = INDX2 + 1;

  28567 19 004160   000375 054000 11                 AOS     INDX2
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:416  

     2410    28568    5               END;

  28568 19 004161   004165 710000 19                 TRA     s:28573

     2411    28569    4               WHENALTRETURN
     2412    28570    5               DO;

     2413    28571    5                   VM_LISTKEY2 = VM_LISTKEY; /* New previous entry */

  28571 19 004162   000000 100400                    MLR     fill='000'O
        19 004163   000554 000312 11                 ADSC9   VM_LISTKEY               cn=0,n=202
        19 004164   000637 000312 11                 ADSC9   VM_LISTKEY2              cn=0,n=202

     2414    28572    5               END;

     2415    28573    4               VM_LISTKEY = VM_LISTKEY2; /* Previous needed to find next */

  28573 19 004165   000000 100400                    MLR     fill='000'O
        19 004166   000637 000312 11                 ADSC9   VM_LISTKEY2              cn=0,n=202
        19 004167   000554 000312 11                 ADSC9   VM_LISTKEY               cn=0,n=202

     2416    28574    4               CALL VMA$GET_LIST_NEXT (VM_LISTKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)

  28574 19 004170   000202 630400 20                 EPPR0   130
        19 004171   000021 631400 20                 EPPR1   17
        19 004172   000000 701000 xent               TSX1    VMA$GET_LIST_NEXT
        19 004173   004226 702000 19                 TSX2    END_DEL_LIST

     2417    28575    4                 ALTRET(END_DEL_LIST);
     2418    28576    4           END;                       /* Do forever ... end */

  28576 19 004174   004133 710000 19                 TRA     s:28561

     2419    28577        /*
     2420    28578             ***** Handle non-wild case ...
     2421    28579        */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:417  
     2422    28580    4           DO NEVER;

     2423    28581    4   NON_WILD_DEL_LIST:
     2424    28582    4               VM_LISTKEY.TEXT = OUT$->P$B.SUBLK$(0)->P$S.TEXT;

  28582 19 004175   200023 470500       NON_WILD_DE* LDP0    OUT$,,AUTO
        19 004176   000003 471500                    LDP1    3,,PR0
        19 004177   100004 236100                    LDQ     4,,PR1
        19 004200   000033 772000                    QRL     27
        19 004201   000000 620006                    EAX0    0,QL
        19 004202   040000 100540                    MLR     fill='040'O
        19 004203   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 004204   000554 400310 11                 ADSC9   VM_LISTKEY               cn=2,n=200

     2425    28583    4               CALL VMA$DEL_LIST (VM_LISTKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)

  28583 19 004205   000202 630400 20                 EPPR0   130
        19 004206   000021 631400 20                 EPPR1   17
        19 004207   000000 701000 xent               TSX1    VMA$DEL_LIST
        19 004210   004212 702000 19                 TSX2    s:28586
        19 004211   004225 710000 19                 TRA     s:28595

     2426    28584    4               WHENALTRETURN
     2427    28585    5               DO;

     2428    28586    5                   IF B$TCB.ALT$ -> B$ALT.ERR.CODE = %E$NOKEY

  28586 19 004212   000000 470400 xsym               LDP0    B$TCB$
        19 004213   000000 471500                    LDP1    0,,PR0
        19 004214   100102 236100                    LDQ     66,,PR1
        19 004215   377770 376007                    ANQ     131064,DL
        19 004216   001020 116007                    CMPQ    528,DL
        19 004217   016514 601000 19                 TNZ     E_PMME

     2429    28587    5                   THEN
     2430    28588    6                   DO;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:418  
     2431    28589    6                       CALL XUR$ERRMSG(E_NOLIST);

  28589 19 004220   000240 630400 20                 EPPR0   160
        19 004221   000024 631400 20                 EPPR1   20
        19 004222   000000 701000 xent               TSX1    XUR$ERRMSG
        19 004223   000000 011000                    NOP     0

     2432    28590    6                       GOTO CONTINUE;

  28590 19 004224   016452 710000 19                 TRA     CONTINUE

     2433    28591    6                   END;
     2434    28592    5                   ELSE
     2435    28593    5                       GOTO E_PMME;
     2436    28594    5               END;
     2437    28595    4               INDX2 = INDX2 + 1;

  28595 19 004225   000375 054000 11                 AOS     INDX2

     2438    28596    4           END;                       /* Do never ... end */

  28589 19 004226                       END_DEL_LIST null
     2439    28597    3   END_DEL_LIST: ;
     2440    28598    3           CALL REPORT_ACTIVITY (INDX2,VM_LISTS_DELETED_FMT,%NO#,E_LISTS_DELETED_FMT);

  28598 19 004226   000241 236000 20                 LDQ     161
        19 004227   201122 756100                    STQ     @NAME+1,,AUTO
        19 004230   000242 237000 20                 LDAQ    162
        19 004231   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 004232   000154 236000 20                 LDQ     108
        19 004233   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 004234   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 004235   000000 011000                    NOP     0
        19 004236   016452 710000 19                 TRA     CONTINUE

     2441    28599        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:419  
     2442    28600        /* Delete user command */
     2443    28601    3       CASE (%CMD_DELETE_USER);

     2444    28602    3           CALL NEED_GLOBAL ALTRET(CONTINUE);

  28602 19 004237   016577 701000 19                 TSX1    NEED_GLOBAL
        19 004240   016452 702000 19                 TSX2    CONTINUE

     2445    28603        /*
     2446    28604             ***** Open the reverse name map file ...
     2447    28605        */
     2448    28606    3           CALL XUR$DISABLE;

  28606 19 004241   000020 631400 20                 EPPR1   16
        19 004242   000000 701000 xent               TSX1    XUR$DISABLE
        19 004243   000000 011000                    NOP     0

     2449    28607    3           CALL M$OPEN (OPEN_NAME_MAP) ALTRET(E_PMME);

  28607 19 004244   000366 630400 12                 EPPR0   OPEN_NAME_MAP
        19 004245   450000 713400                    CLIMB   alt,open
        19 004246   410400 401760                    pmme    nvectors=18
        19 004247   016514 702000 19                 TSX2    E_PMME

     2450    28608    3           INDX2 = 0;                  /* Used as counter */

  28608 19 004250   000375 450000 11                 STZ     INDX2

     2451    28609    3           CALL INDEX(INDX1,'?',OUT$->P$B.SUBLK$(0)->P$S.TEXT) ALTRET(

  28609 19 004251   200023 470500                    LDP0    OUT$,,AUTO
        19 004252   000003 471500                    LDP1    3,,PR0
        19 004253   100004 236100                    LDQ     4,,PR1
        19 004254   000033 772000                    QRL     27
        19 004255   000000 620006                    EAX0    0,QL
        19 004256   000000 124540                    SCM     mask='000'O
        19 004257   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:420  
        19 004260   000225 000001 20                 ADSC9   149                      cn=0,n=1
        19 004261   200033 000100                    ARG     INDX1,,AUTO
        19 004262   004364 606400 19                 TTN     NON_WILD_DEL_USER

     2452    28610    3             NON_WILD_DEL_USER);
     2453    28611    3           VM_WILDCARD.PATTERN_ = VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXT);

  28611 19 004263   000003 471500                    LDP1    3,,PR0
        19 004264   100004 236100                    LDQ     4,,PR1
        19 004265   000033 772000                    QRL     27
        19 004266   000064 737000                    LLS     52
        19 004267   000140 135007                    SBLA    96,DL
        19 004270   201706 451500                    STP1    I+100,,AUTO
        19 004271   201706 236100                    LDQ     I+100,,AUTO
        19 004272   000215 036000 20                 ADLQ    141
        19 004273   001634 757000 11                 STAQ    VM_WILDCARD

     2454    28612    3           CALL XLATE (OUT$->P$B.SUBLK$(0)->P$S.TEXT, LOWER_UPPER,

  28612 19 004274   000003 471500                    LDP1    3,,PR0
        19 004275   100004 236100                    LDQ     4,,PR1
        19 004276   000033 772000                    QRL     27
        19 004277   000000 620006                    EAX0    0,QL
        19 004300   000000 473400 xsym               LDP3    B$XL_UPPER$
        19 004301   000000 621006                    EAX1    0,QL
        19 004302   040140 160540                    MVT     fill='040'O
        19 004303   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 004304   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        19 004305   300000 000100                    ARG     0,,PR3

     2455    28613    3             OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2456    28614    3           VM_USERKEY.TEXT = ' ';      /* Start at first entry */

  28614 19 004306   040000 100400                    MLR     fill='040'O
        19 004307   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 004310   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:421  
     2457    28615    3           VM_USERKEY2 = VM_USERKEY;   /* Remember previous entry */

  28615 19 004311   000000 100400                    MLR     fill='000'O
        19 004312   000722 000312 11                 ADSC9   VM_USERKEY               cn=0,n=202
        19 004313   001005 000312 11                 ADSC9   VM_USERKEY2              cn=0,n=202

     2458    28616    3           CALL VMA$GET_LIST_NEXT (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(

  28616 19 004314   000206 630400 20                 EPPR0   134
        19 004315   000021 631400 20                 EPPR1   17
        19 004316   000000 701000 xent               TSX1    VMA$GET_LIST_NEXT
        19 004317   004407 702000 19                 TSX2    END_DEL_USER

     2459    28617    3             END_DEL_USER);
     2460    28618    4           DO FOREVER;

     2461    28619    4               VM_WILDCARD.INPUT_ = VECTOR(SUBSTR(VM_USERKEY.TEXT,0,

  28619 19 004320   000722 236000 11                 LDQ     VM_USERKEY
        19 004321   000033 772000                    QRL     27
        19 004322   777777 620006                    EAX0    -1,QL
        19 004323   000000 635010                    EAA     0,X0
        19 004324   000002 771000                    ARL     2
        19 004325   000140 135007                    SBLA    96,DL
        19 004326   000244 236000 20                 LDQ     164
        19 004327   001636 757000 11                 STAQ    VM_WILDCARD+2

     2462    28620    4                 VM_USERKEY.COUNT-1)); /* One less for type */
     2463    28621    4               CALL X$WILDCMP (VM_WILDCARD)

  28621 19 004330   000237 630400 20                 EPPR0   159
        19 004331   000024 631400 20                 EPPR1   20
        19 004332   000000 701000 xent               TSX1    X$WILDCMP
        19 004333   004351 702000 19                 TSX2    s:28636

     2464    28622    4               WHENRETURN
     2465    28623    5               DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:422  

     2466    28624        /*
     2467    28625             ***** Delete all reverse name map records for this user ...
     2468    28626        */
     2469    28627    5                   CALL DEL_NAMEMAP_ENTRIES ALTRET(END_DEL_USER);

  28627 19 004334   017014 701000 19                 TSX1    DEL_NAMEMAP_ENTRIES
        19 004335   004407 702000 19                 TSX2    END_DEL_USER

     2470    28628        /*
     2471    28629             ***** Now delete the record ...
     2472    28630        */
     2473    28631    5                   CALL VMA$DEL_LIST (VM_USERKEY,,M$MAIL_FILE_NUM) ALTRET(E_PMME);

  28631 19 004336   000053 236000 20                 LDQ     43
        19 004337   201710 756100                    STQ     I+102,,AUTO
        19 004340   000022 236000 20                 LDQ     18
        19 004341   000206 235000 20                 LDA     134
        19 004342   201706 757100                    STAQ    I+100,,AUTO
        19 004343   201706 630500                    EPPR0   I+100,,AUTO
        19 004344   000021 631400 20                 EPPR1   17
        19 004345   000000 701000 xent               TSX1    VMA$DEL_LIST
        19 004346   016514 702000 19                 TSX2    E_PMME

     2474    28632    5                   INDX2 = INDX2 + 1;

  28632 19 004347   000375 054000 11                 AOS     INDX2

     2475    28633    5               END;

  28633 19 004350   004354 710000 19                 TRA     s:28638

     2476    28634    4               WHENALTRETURN
     2477    28635    5               DO;

     2478    28636    5                   VM_USERKEY2 = VM_USERKEY; /* New previous entry */

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:423  
  28636 19 004351   000000 100400                    MLR     fill='000'O
        19 004352   000722 000312 11                 ADSC9   VM_USERKEY               cn=0,n=202
        19 004353   001005 000312 11                 ADSC9   VM_USERKEY2              cn=0,n=202

     2479    28637    5               END;

     2480    28638    4               VM_USERKEY = VM_USERKEY2; /* Previous needed to find next */

  28638 19 004354   000000 100400                    MLR     fill='000'O
        19 004355   001005 000312 11                 ADSC9   VM_USERKEY2              cn=0,n=202
        19 004356   000722 000312 11                 ADSC9   VM_USERKEY               cn=0,n=202

     2481    28639    4               CALL VMA$GET_LIST_NEXT (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)

  28639 19 004357   000206 630400 20                 EPPR0   134
        19 004360   000021 631400 20                 EPPR1   17
        19 004361   000000 701000 xent               TSX1    VMA$GET_LIST_NEXT
        19 004362   004407 702000 19                 TSX2    END_DEL_USER

     2482    28640    4                 ALTRET(END_DEL_USER);
     2483    28641    4           END;                       /* Do forever ... end */

  28641 19 004363   004320 710000 19                 TRA     s:28619

     2484    28642        /*
     2485    28643             ***** Handle non-wild case ...
     2486    28644        */
     2487    28645    4           DO NEVER;

     2488    28646    4   NON_WILD_DEL_USER:
     2489    28647    4               VM_USERKEY.TEXT = OUT$->P$B.SUBLK$(0)->P$S.TEXT;

  28647 19 004364   200023 470500       NON_WILD_DE* LDP0    OUT$,,AUTO
        19 004365   000003 471500                    LDP1    3,,PR0
        19 004366   100004 236100                    LDQ     4,,PR1
        19 004367   000033 772000                    QRL     27
        19 004370   000000 620006                    EAX0    0,QL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:424  
        19 004371   040000 100540                    MLR     fill='040'O
        19 004372   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 004373   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200

     2490    28648    4               CALL VMA$GET_LIST (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(

  28648 19 004374   000206 630400 20                 EPPR0   134
        19 004375   000021 631400 20                 EPPR1   17
        19 004376   000000 701000 xent               TSX1    VMA$GET_LIST
        19 004377   004407 702000 19                 TSX2    END_DEL_USER

     2491    28649    4                 END_DEL_USER);
     2492    28650    4               CALL DEL_NAMEMAP_ENTRIES;

  28650 19 004400   017014 701000 19                 TSX1    DEL_NAMEMAP_ENTRIES
        19 004401   000000 011000                    NOP     0

     2493    28651    4               CALL VMA$DEL_LIST (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(

  28651 19 004402   000206 630400 20                 EPPR0   134
        19 004403   000021 631400 20                 EPPR1   17
        19 004404   000000 701000 xent               TSX1    VMA$DEL_LIST
        19 004405   016514 702000 19                 TSX2    E_PMME

     2494    28652    4                 E_PMME);
     2495    28653    4               INDX2 = INDX2 + 1;

  28653 19 004406   000375 054000 11                 AOS     INDX2

     2496    28654    4           END;                       /* Do never ... end */

  28652 19 004407                       END_DEL_USER null
     2497    28655    3   END_DEL_USER: ;
     2498    28656        /*
     2499    28657             ***** Close the reverse name map ...
     2500    28658        */
     2501    28659    3           CLOSE_SAVE.V.DCB# = DCBNUM(M$NAME);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:425  

  28659 19 004407   000000 236007 xsym               LDQ     M$NAME,DL
        19 004410   000000 620006                    EAX0    0,QL
        19 004411   002142 740000 11                 STX0    CLOSE_SAVE+26

     2502    28660    3           CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  28660 19 004412   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 004413   450001 713400                    CLIMB   alt,close
        19 004414   406000 401760                    pmme    nvectors=13
        19 004415   016514 702000 19                 TSX2    E_PMME

     2503    28661    3           CALL XUR$ENABLE;

  28661 19 004416   000020 631400 20                 EPPR1   16
        19 004417   000000 701000 xent               TSX1    XUR$ENABLE
        19 004420   000000 011000                    NOP     0

     2504    28662    3           CALL REPORT_ACTIVITY (INDX2,VM_USERS_DELETED_FMT,%NO#,E_USERS_DELETED_FMT);

  28662 19 004421   000245 236000 20                 LDQ     165
        19 004422   201122 756100                    STQ     @NAME+1,,AUTO
        19 004423   000246 237000 20                 LDAQ    166
        19 004424   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 004425   000154 236000 20                 LDQ     108
        19 004426   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 004427   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 004430   000000 011000                    NOP     0
        19 004431   016452 710000 19                 TRA     CONTINUE

     2505    28663        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:426  
     2506    28664        /* Delete message command */
     2507    28665    3       CASE (%CMD_DELETE_MESSAGE);

     2508    28666    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  28666 19 004432   016562 701000 19                 TSX1    NEED_UPDATE
        19 004433   016452 702000 19                 TSX2    CONTINUE

     2509    28667    3           CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_DELETE_MESSAGE) ALTRET(

  28667 19 004434   000251 236000 20                 LDQ     169
        19 004435   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 004436   200023 236100                    LDQ     OUT$,,AUTO
        19 004437   000003 036003                    ADLQ    3,DU
        19 004440   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 004441   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 004442   016452 702000 19                 TSX2    CONTINUE

     2510    28668    3             CONTINUE);
     2511    28669    3           INDX1 = 0;                  /* Used as counter */

  28669 19 004443   200033 450100                    STZ     INDX1,,AUTO

     2512    28670    3           NONE = %YES#;

  28670 19 004444   400000 236003                    LDQ     -131072,DU
        19 004445   200037 756100                    STQ     NONE,,AUTO

     2513    28671    4           DO FOREVER;

     2514    28672    4               CALL GET$MESSAGE ALTRET(END_DELETE);

  28672 19 004446   020536 701000 19                 TSX1    GET$MESSAGE
        19 004447   004534 702000 19                 TSX2    END_DELETE

     2515    28673    4               NONE = %NO#;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:427  
  28673 19 004450   200037 450100                    STZ     NONE,,AUTO

     2516    28674        /*
     2517    28675             ***** Only delete messages that have been listed before
     2518    28676                   and that have not already been deleted.
     2519    28677        */
     2520    28678    4               IF (VM_HEADER.STATUS.OLD = %YES#

  28678 19 004451   000000 470400 xsym               LDP0    VM_HEADER$
        19 004452   000012 236100                    LDQ     10,,PR0
        19 004453   004000 316003                    CANQ    2048,DU
        19 004454   004457 601000 19                 TNZ     s:28678+6
        19 004455   002000 316003                    CANQ    1024,DU
        19 004456   004446 600000 19                 TZE     s:28672
        19 004457   000400 316003                    CANQ    256,DU
        19 004460   004446 601000 19                 TNZ     s:28672

     2521    28679    4                 OR VM_HEADER.STATUS.MAKE_OLD = %YES#)
     2522    28680    4                 AND VM_HEADER.STATUS.DEL ~= %YES#
     2523    28681    5               THEN DO;             /* Message has been listed */

     2524    28682    5                   IF VM_PROFILE.OPT.HEADERS

  28682 19 004461   000000 471400 xsym               LDP1    VM_PROFILE$
        19 004462   100000 236100                    LDQ     0,,PR1
        19 004463   000400 316007                    CANQ    256,DL
        19 004464   004476 600000 19                 TZE     s:28685

     2525    28683    5                   THEN
     2526    28684    5                       CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);

  28684 19 004465   000033 236000 20                 LDQ     27
        19 004466   201710 756100                    STQ     I+102,,AUTO
        19 004467   000103 236000 20                 LDQ     67
        19 004470   000000 235000 xsym               LDA     VM_HEADER$
        19 004471   201706 757100                    STAQ    I+100,,AUTO
        19 004472   201706 630500                    EPPR0   I+100,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:428  
        19 004473   000021 631400 20                 EPPR1   17
        19 004474   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 004475   000000 011000                    NOP     0

     2527    28685    5                   CALL XUR$DISABLE;

  28685 19 004476   000020 631400 20                 EPPR1   16
        19 004477   000000 701000 xent               TSX1    XUR$DISABLE
        19 004500   000000 011000                    NOP     0

     2528    28686    5                   VM_HEADER.STATUS.DEL = %YES#;

  28686 19 004501   000000 470400 xsym               LDP0    VM_HEADER$
        19 004502   000400 236003                    LDQ     256,DU
        19 004503   000012 256100                    ORSQ    10,,PR0

     2529    28687    5                   IF VM_PROFILE.LOW_DEL_NUM > CURRENT_MESSAGE_NUMBER

  28687 19 004504   000000 471400 xsym               LDP1    VM_PROFILE$
        19 004505   100134 236100                    LDQ     92,,PR1
        19 004506   004511 604000 19                 TMI     s:28688
        19 004507   000072 116000 11                 CMPQ    CURRENT_MESSAGE_NUMBER
        19 004510   004513 604400 19                 TMOZ    s:28689

     2530    28688    5                   THEN VM_PROFILE.LOW_DEL_NUM = CURRENT_MESSAGE_NUMBER;

  28688 19 004511   000072 235000 11                 LDA     CURRENT_MESSAGE_NUMBER
        19 004512   100134 755100                    STA     92,,PR1

     2531    28689    5                   CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM)

  28689 19 004513   000120 630400 20                 EPPR0   80
        19 004514   000000 631400 20                 EPPR1   0
        19 004515   000000 701000 xent               TSX1    VMD$PUT_HEADER
        19 004516   000000 011000                    NOP     0

     2532    28690    5                     ;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:429  
     2533    28691    5                   VM_PROFILE.NUM_DEL_MESSAGES = VM_PROFILE.NUM_DEL_MESSAGES +

  28691 19 004517   000000 470400 xsym               LDP0    VM_PROFILE$
        19 004520   000007 235100                    LDA     7,,PR0
        19 004521   000001 035007                    ADLA    1,DL
        19 004522   000007 755100                    STA     7,,PR0

     2534    28692    5                     1;
     2535    28693    5                   CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(WRITE_ERROR);

  28693 19 004523   000053 236000 20                 LDQ     43
        19 004524   201523 756100                    STQ     INDX2+255,,AUTO
        19 004525   021320 701000 19                 TSX1    PUT_PROFILE
        19 004526   016477 702000 19                 TSX2    WRITE_ERROR

     2536    28694    5                   CALL XUR$ENABLE;

  28694 19 004527   000020 631400 20                 EPPR1   16
        19 004530   000000 701000 xent               TSX1    XUR$ENABLE
        19 004531   000000 011000                    NOP     0

     2537    28695    5                   INDX1 = INDX1 + 1; /* Deletions */

  28695 19 004532   200033 054100                    AOS     INDX1,,AUTO

     2538    28696    5               END;             /* Do ... end */

     2539    28697    4           END;                       /* Do forever ... end  */

  28697 19 004533   004446 710000 19                 TRA     s:28672

  28692 19 004534                       END_DELETE   null
     2540    28698
     2541    28699    3   END_DELETE: ;
     2542    28700    3           CALL REPORT_ACTIVITY (INDX1,VM_MSGS_DELETED_FMT,NONE,E_MSGS_DELETED_FMT);

  28700 19 004534   000150 236000 20                 LDQ     104
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:430  
        19 004535   201122 756100                    STQ     @NAME+1,,AUTO
        19 004536   200037 630500                    EPPR0   NONE,,AUTO
        19 004537   201121 450500                    STP0    @SITENAME+1,,AUTO
        19 004540   000152 236000 20                 LDQ     106
        19 004541   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 004542   200033 631500                    EPPR1   INDX1,,AUTO
        19 004543   201117 451500                    STP1    @CURR_COMMAND_CODE+2,,AUTO
        19 004544   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 004545   000000 011000                    NOP     0
        19 004546   016452 710000 19                 TRA     CONTINUE

     2543    28701        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:431  
     2544    28702        /* Detach command */
     2545    28703    3       CASE (%CMD_DETACH);

     2546    28704    3           CALL NEED_FOLDER

  28704 19 004547   016547 701000 19                 TSX1    NEED_FOLDER
        19 004550   004552 702000 19                 TSX2    s:28706
        19 004551   004557 710000 19                 TRA     s:28709

     2547    28705    4           WHENALTRETURN DO;

     2548    28706    4               CALL XUR$ERRMSG (E_NOCURFOLD);

  28706 19 004552   000252 630400 20                 EPPR0   170
        19 004553   000024 631400 20                 EPPR1   20
        19 004554   000000 701000 xent               TSX1    XUR$ERRMSG
        19 004555   000000 011000                    NOP     0

     2549    28707    4               GOTO CONTINUE;

  28707 19 004556   016452 710000 19                 TRA     CONTINUE

     2550    28708    4           END;
     2551    28709    3           CALL GET$MESSAGE ALTRET (END_DETACH);

  28709 19 004557   020536 701000 19                 TSX1    GET$MESSAGE
        19 004560   005116 702000 19                 TSX2    END_DETACH

     2552    28710                /* Make sure there are nclosure for this mailgram */
     2553    28711    4           IF VM_HEADER.STATUS.ENCL = %NO# THEN DO;

  28711 19 004561   000000 470400 xsym               LDP0    VM_HEADER$
        19 004562   000012 236100                    LDQ     10,,PR0
        19 004563   004000 316007                    CANQ    2048,DL
        19 004564   004572 601000 19                 TNZ     s:28716

     2554    28712    4               CALL XUR$ERRMSG (E_NOENCLS);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:432  

  28712 19 004565   000253 630400 20                 EPPR0   171
        19 004566   000024 631400 20                 EPPR1   20
        19 004567   000000 701000 xent               TSX1    XUR$ERRMSG
        19 004570   000000 011000                    NOP     0

     2555    28713    4               GOTO CONTINUE;

  28713 19 004571   016452 710000 19                 TRA     CONTINUE

     2556    28714    4           END;
     2557    28715
     2558    28716    3          IF NOT ( CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) - CURRENT_CONTEXT%.MESSAGE_SET
             28716                    .LOW(0) = 0 AND

  28716 19 004572   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 004573   100006 236100                    LDQ     6,,PR1
        19 004574   100005 136100                    SBLQ    5,,PR1
        19 004575   004601 601000 19                 TNZ     s:28720
        19 004576   100001 236100                    LDQ     1,,PR1
        19 004577   000022 116000 20                 CMPQ    18
        19 004600   004606 600000 19                 TZE     s:28727

     2559    28717    4             CURRENT_CONTEXT%.TRUTH_TREE$ = ADDR(NIL)) THEN DO;

     2560    28718                   /* some message about only one message may
     2561    28719                      be selected when using the DETACH command */
     2562    28720    4               CALL XUR$ERRMSG (E_DETALLOWSONE);

  28720 19 004601   000254 630400 20                 EPPR0   172
        19 004602   000024 631400 20                 EPPR1   20
        19 004603   000000 701000 xent               TSX1    XUR$ERRMSG
        19 004604   000000 011000                    NOP     0

     2563    28721    4               GOTO CONTINUE;

  28721 19 004605   016452 710000 19                 TRA     CONTINUE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:433  

     2564    28722    4           END;
     2565    28723    4           ELSE DO;

     2566    28724
     2567    28725                   /* Loop thru the parse nodes */
     2568    28726
     2569    28727    5               DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;

  28727 19 004606   200033 450100                    STZ     INDX1,,AUTO
        19 004607   004747 710000 19                 TRA     s:28764+1

     2570    28728    5                   PTR1$ = OUT$ -> P$B.SUBLK$(INDX1);

  28728 19 004610   200023 470500                    LDP0    OUT$,,AUTO
        19 004611   200033 720100                    LXL0    INDX1,,AUTO
        19 004612   000003 236110                    LDQ     3,X0,PR0
        19 004613   200025 756100                    STQ     PTR1$,,AUTO

     2571    28729    6                   DO CASE (PTR1$ -> P$B.CODE);

  28729 19 004614   200025 471500                    LDP1    PTR1$,,AUTO
        19 004615   100000 721100                    LXL1    0,,PR1
        19 004616   000006 101003                    CMPX1   6,DU
        19 004617   004621 602011 19                 TNC     s:28729+5,X1
        19 004620   004746 710000 19                 TRA     s:28764
        19 004621   004746 710000 19                 TRA     s:28764
        19 004622   004720 710000 19                 TRA     s:28758
        19 004623   004746 710000 19                 TRA     s:28764
        19 004624   004746 710000 19                 TRA     s:28764
        19 004625   004715 710000 19                 TRA     s:28756
        19 004626   004627 710000 19                 TRA     s:28731

     2572    28730    6                   CASE (%DET_ENCLNUM);

     2573    28731    6                       CALL CHARBIN(INDX2,PTR1$->P$S.TEXTC$->X$STRING.TEXT);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:434  
  28731 19 004627   100003 473500                    LDP3    3,,PR1
        19 004630   000100 101500                    MRL     fill='000'O
        19 004631   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 004632   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 004633   201706 221100                    LDX1    I+100,,AUTO
        19 004634   000000 305540                    DTB
        19 004635   300000 230011                    NDSC9   0,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
        19 004636   000375 000004 11                 NDSC9   INDX2                    cn=0,s=lsgnf,sf=0,n=4

     2574    28732    6   GET_ENCL:           CALL VMA$GET_ADD_RECORD(%VM_TYPE_ENCL, VM_ENCLLIST_,
             28732            M$MAIL_FILE_NUM,CURRENT_MESSAGE_NUMBER)

  28732 19 004637   000256 630400 20    GET_ENCL     EPPR0   174
        19 004640   000026 631400 20                 EPPR1   22
        19 004641   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        19 004642   004644 702000 19                 TSX2    s:28734
        19 004643   004662 710000 19                 TRA     s:28739

     2575    28733    7                       WHENALTRETURN DO;

     2576    28734    8                           IF B$TCB.ALT$->B$ALT.ERR.CODE=%E$LD THEN DO;

  28734 19 004644   000000 470400 xsym               LDP0    B$TCB$
        19 004645   000000 471500                    LDP1    0,,PR0
        19 004646   100102 236100                    LDQ     66,,PR1
        19 004647   377770 376007                    ANQ     131064,DL
        19 004650   000070 116007                    CMPQ    56,DL
        19 004651   004662 601000 19                 TNZ     s:28739

     2577    28735    8                               VBOUND(VM_ENCLREC_) = VBOUND(VM_ENCLREC_) + PAGESIZE;

  28735 19 004652   000000 236000 xsym               LDQ     VM_ENCLREC_
        19 004653   000020 772000                    QRL     16
        19 004654   000374 036000 11                 ADLQ    PAGESIZE
        19 004655   000020 736000                    QLS     16
        19 004656   000000 676000 xsym               ERQ     VM_ENCLREC_
        19 004657   000017 376000 20                 ANQ     15
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:435  
        19 004660   000000 656000 xsym               ERSQ    VM_ENCLREC_

     2578    28736    8                               GOTO GET_ENCL;

  28736 19 004661   004637 710000 19                 TRA     GET_ENCL

     2579    28737    8                           END;
     2580    28738    7                       END;
     2581    28739    6                       ENCL$ = VM_ENCL_HEAD.HEAD$;

  28739 19 004662   000000 470400 xsym               LDP0    VM_ENCLLIST$
        19 004663   000003 236100                    LDQ     3,,PR0
        19 004664   200032 756100                    STQ     ENCL$,,AUTO

     2582    28740    7   FIND_ENCL:          DO FOREVER;

  28740 19 004665                       FIND_ENCL    null
     2583    28741    8                           IF VM_ENCLOS.TYPE - %VM_TYPE_ENCL = INDX2 THEN DO;

  28741 19 004665   200032 470500                    LDP0    ENCL$,,AUTO
        19 004666   000012 236100                    LDQ     10,,PR0
        19 004667   000033 772000                    QRL     27
        19 004670   000144 136007                    SBLQ    100,DL
        19 004671   000375 116000 11                 CMPQ    INDX2
        19 004672   004702 601000 19                 TNZ     s:28749

     2584    28742    9                               IF VM_ENCLOS.FLAGS.DELETED THEN DO;

  28742 19 004673   000002 234100                    SZN     2,,PR0
        19 004674   004714 605000 19                 TPL     s:28754+1

     2585    28743    9                                   CALL XUR$ERRMSG (E_ENCLDELETED);

  28743 19 004675   000262 630400 20                 EPPR0   178
        19 004676   000024 631400 20                 EPPR1   20
        19 004677   000000 701000 xent               TSX1    XUR$ERRMSG
        19 004700   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:436  

     2586    28744    9                                   GOTO CONTINUE;

  28744 19 004701   016452 710000 19                 TRA     CONTINUE

     2587    28745    9                               END;
     2588    28746    8                               ELSE
     2589    28747    8                                   EXIT FIND_ENCL;
     2590    28748    8                           END;
     2591    28749    8                           ELSE IF VM_ENCLOS.NEXT$ = ADDR(NIL) THEN DO;

  28749 19 004702   000000 236100                    LDQ     0,,PR0
        19 004703   000022 116000 20                 CMPQ    18
        19 004704   004712 601000 19                 TNZ     s:28753

     2592    28750    8                                   CALL XUR$ERRMSG (E_ENCLNOTFOUND);

  28750 19 004705   000263 630400 20                 EPPR0   179
        19 004706   000024 631400 20                 EPPR1   20
        19 004707   000000 701000 xent               TSX1    XUR$ERRMSG
        19 004710   000000 011000                    NOP     0

     2593    28751    8                                   GOTO CONTINUE;

  28751 19 004711   016452 710000 19                 TRA     CONTINUE

     2594    28752    8                               END;
     2595    28753    7                           ENCL$ = VM_ENCLOS.NEXT$;

  28753 19 004712   200032 756100                    STQ     ENCL$,,AUTO

     2596    28754    7                       END;

  28754 19 004713   004665 710000 19                 TRA     FIND_ENCL
        19 004714   004746 710000 19                 TRA     s:28764

     2597    28755    6                   CASE (%DET_DELETE);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:437  

     2598    28756    6                       DELETE_ENCL_FLAG = %YES#;

  28756 19 004715   400000 236003                    LDQ     -131072,DU
        19 004716   201113 756100                    STQ     DELETE_ENCL_FLAG,,AUTO
        19 004717   004746 710000 19                 TRA     s:28764

     2599    28757    6                   CASE (%DET_OPTS);

     2600    28758    6                       CALL XUR$OPENOUT (DCBNUM(M$ENCL),PTR1$->P$B,OPEN_ENCL)

  28758 19 004720   000000 236007 xsym               LDQ     M$ENCL,DL
        19 004721   201706 756100                    STQ     I+100,,AUTO
        19 004722   000264 236000 20                 LDQ     180
        19 004723   200025 235100                    LDA     PTR1$,,AUTO
        19 004724   201710 757100                    STAQ    I+102,,AUTO
        19 004725   201706 633500                    EPPR3   I+100,,AUTO
        19 004726   201707 453500                    STP3    I+101,,AUTO
        19 004727   201707 630500                    EPPR0   I+101,,AUTO
        19 004730   000021 631400 20                 EPPR1   17
        19 004731   000000 701000 xent               TSX1    XUR$OPENOUT
        19 004732   004734 702000 19                 TSX2    s:28760
        19 004733   004746 710000 19                 TRA     s:28764

     2601    28759    7                       WHENALTRETURN DO;

     2602    28760    7                           CALL XUR$ERRMSG(XUG$GETCMD.ERR#,M$OUT_NUM);

  28760 19 004734   000265 236000 20                 LDQ     181
        19 004735   201707 756100                    STQ     I+101,,AUTO
        19 004736   200003 236100                    LDQ     XUG_GETCMD$,,AUTO
        19 004737   000001 036003                    ADLQ    1,DU
        19 004740   201706 756100                    STQ     I+100,,AUTO
        19 004741   201706 630500                    EPPR0   I+100,,AUTO
        19 004742   000000 631400 20                 EPPR1   0
        19 004743   000000 701000 xent               TSX1    XUR$ERRMSG
        19 004744   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:438  

     2603    28761    7                           GOTO CONTINUE;

  28761 19 004745   016452 710000 19                 TRA     CONTINUE

     2604    28762    7                       END;
     2605    28763    6                   END;

     2606    28764    5               END;  /* INDX1 */

  28764 19 004746   200033 054100                    AOS     INDX1,,AUTO
        19 004747   200023 470500                    LDP0    OUT$,,AUTO
        19 004750   000001 236100                    LDQ     1,,PR0
        19 004751   000022 772000                    QRL     18
        19 004752   200033 116100                    CMPQ    INDX1,,AUTO
        19 004753   004610 605400 19                 TPNZ    s:28728

     2607    28765
     2608    28766    5               DO INDX3 = 0 TO VM_ENCLOS.NRECS - 1;

  28766 19 004754   200034 450100                    STZ     INDX3,,AUTO
        19 004755   005044 710000 19                 TRA     s:28780+1

     2609    28767    5                  CALL VMD$GET_ENCL(CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM,INDX3,COUNT
             28767                            ,,,,INDX2,VM_ENCLREC$)

  28767 19 004756   000267 236000 20                 LDQ     183
        19 004757   201716 756100                    STQ     I+108,,AUTO
        19 004760   000154 236000 20                 LDQ     108
        19 004761   000022 235000 20                 LDA     18
        19 004762   201714 757100                    STAQ    I+106,,AUTO
        19 004763   000022 236000 20                 LDQ     18
        19 004764   000022 235000 20                 LDA     18
        19 004765   201712 757100                    STAQ    I+104,,AUTO
        19 004766   200550 630500                    EPPR0   COUNT,,AUTO
        19 004767   201711 450500                    STP0    I+103,,AUTO
        19 004770   200034 631500                    EPPR1   INDX3,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:439  
        19 004771   201710 451500                    STP1    I+102,,AUTO
        19 004772   000120 237000 20                 LDAQ    80
        19 004773   201706 757100                    STAQ    I+100,,AUTO
        19 004774   201706 630500                    EPPR0   I+100,,AUTO
        19 004775   000266 631400 20                 EPPR1   182
        19 004776   000000 701000 xent               TSX1    VMD$GET_ENCL
        19 004777   005001 702000 19                 TSX2    s:28769
        19 005000   005006 710000 19                 TRA     s:28772

     2610    28768    6                   WHENALTRETURN DO;

     2611    28769    6                       CALL XUR$ERRMSG(E_ENCLBROKEN);

  28769 19 005001   000270 630400 20                 EPPR0   184
        19 005002   000024 631400 20                 EPPR1   20
        19 005003   000000 701000 xent               TSX1    XUR$ERRMSG
        19 005004   000000 011000                    NOP     0

     2612    28770    6                       EXIT;

  28770 19 005005   005006 710000 19                 TRA     s:28772

     2613    28771    6                   END;
     2614    28772    5                   WRITE_ENCL.BUF_.BUF$ = PINCRW(VM_ENCLREC$,2);

  28772 19 005006   000000 236000 xsym               LDQ     VM_ENCLREC$
        19 005007   000002 036003                    ADLQ    2,DU
        19 005010   002735 756000 11                 STQ     WRITE_ENCL+5

     2615    28773    5                   WRITE_ENCL.BUF_.BOUND = COUNT - 1;

  28773 19 005011   200550 236100                    LDQ     COUNT,,AUTO
        19 005012   000001 136007                    SBLQ    1,DL
        19 005013   000020 736000                    QLS     16
        19 005014   002734 676000 11                 ERQ     WRITE_ENCL+4
        19 005015   000017 376000 20                 ANQ     15
        19 005016   002734 656000 11                 ERSQ    WRITE_ENCL+4
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:440  

     2616    28774    5                   IF (COUNT = 0) THEN WRITE_ENCL.BUF_.BOUND = 0;

  28774 19 005017   200550 235100                    LDA     COUNT,,AUTO
        19 005020   005023 601000 19                 TNZ     s:28775

  28774 19 005021   177777 236007                    LDQ     65535,DL
        19 005022   002734 356000 11                 ANSQ    WRITE_ENCL+4

     2617    28775    5                   CALL M$WRITE (WRITE_ENCL)

  28775 19 005023   002730 630400 11                 EPPR0   WRITE_ENCL
        19 005024   440001 713400                    CLIMB   alt,write
        19 005025   401400 401760                    pmme    nvectors=4
        19 005026   005030 702000 19                 TSX2    s:28777
        19 005027   005043 710000 19                 TRA     s:28780

     2618    28776    6                   WHENALTRETURN DO;

     2619    28777    6                       CALL XUR$ERRMSG(B$TCB.ALT$->B$ALT.ERR, M$OUT_NUM);

  28777 19 005030   000000 470400 xsym               LDP0    B$TCB$
        19 005031   000000 471500                    LDP1    0,,PR0
        19 005032   000265 236000 20                 LDQ     181
        19 005033   201707 756100                    STQ     I+101,,AUTO
        19 005034   100102 633500                    EPPR3   66,,PR1
        19 005035   201706 453500                    STP3    I+100,,AUTO
        19 005036   201706 630500                    EPPR0   I+100,,AUTO
        19 005037   000000 631400 20                 EPPR1   0
        19 005040   000000 701000 xent               TSX1    XUR$ERRMSG
        19 005041   000000 011000                    NOP     0

     2620    28778    6                       GOTO CONTINUE;

  28778 19 005042   016452 710000 19                 TRA     CONTINUE

     2621    28779    6                   END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:441  
     2622    28780    5               END;

  28780 19 005043   200034 054100                    AOS     INDX3,,AUTO
        19 005044   200032 470500                    LDP0    ENCL$,,AUTO
        19 005045   200034 236100                    LDQ     INDX3,,AUTO
        19 005046   004756 604000 19                 TMI     s:28767
        19 005047   000011 116100                    CMPQ    9,,PR0
        19 005050   004756 602000 19                 TNC     s:28767

     2623    28781
     2624    28782    4               CLOSE_SAVE.V.DCB# = DCBNUM(M$ENCL);

  28782 19 005051   000000 236007 xsym               LDQ     M$ENCL,DL
        19 005052   000000 620006                    EAX0    0,QL
        19 005053   002142 740000 11                 STX0    CLOSE_SAVE+26

     2625    28783    4               CALL M$CLOSE (CLOSE_SAVE);

  28783 19 005054   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 005055   050001 713400                    CLIMB   close
        19 005056   406000 401760                    pmme    nvectors=13

     2626    28784
     2627    28785                    /* if the delete option was used or del_on_detach is
     2628    28786                       set then delete the enclosure, set the delete flag
     2629    28787                       and save the context record */
     2630    28788
     2631    28789    5               IF VM_PROFILE.OPT.DEL_ON_DETACH OR DELETE_ENCL_FLAG THEN DO;

  28789 19 005057   000000 470400 xsym               LDP0    VM_PROFILE$
        19 005060   000001 236100                    LDQ     1,,PR0
        19 005061   040000 316003                    CANQ    16384,DU
        19 005062   005065 601000 19                 TNZ     s:28790
        19 005063   201113 234100                    SZN     DELETE_ENCL_FLAG,,AUTO
        19 005064   005116 605000 19                 TPL     END_DETACH

     2632    28790    5                  CALL VMD$DEL_ENCL(CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM,0,VM_ENCLOS
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:442  
             28790                            .NRECS,,,,INDX2,VM_ENCLREC$);

  28790 19 005065   000267 236000 20                 LDQ     183
        19 005066   201716 756100                    STQ     I+108,,AUTO
        19 005067   000154 236000 20                 LDQ     108
        19 005070   000022 235000 20                 LDA     18
        19 005071   201714 757100                    STAQ    I+106,,AUTO
        19 005072   000022 236000 20                 LDQ     18
        19 005073   000022 235000 20                 LDA     18
        19 005074   201712 757100                    STAQ    I+104,,AUTO
        19 005075   200032 236100                    LDQ     ENCL$,,AUTO
        19 005076   000011 036003                    ADLQ    9,DU
        19 005077   000066 235000 20                 LDA     54
        19 005100   201710 757100                    STAQ    I+102,,AUTO
        19 005101   000120 237000 20                 LDAQ    80
        19 005102   201706 757100                    STAQ    I+100,,AUTO
        19 005103   201706 630500                    EPPR0   I+100,,AUTO
        19 005104   000266 631400 20                 EPPR1   182
        19 005105   000000 701000 xent               TSX1    VMD$DEL_ENCL
        19 005106   000000 011000                    NOP     0

     2633    28791    5                   VM_ENCLOS.FLAGS.DELETED = %YES#;

  28791 19 005107   200032 470500                    LDP0    ENCL$,,AUTO
        19 005110   400000 236003                    LDQ     -131072,DU
        19 005111   000002 256100                    ORSQ    2,,PR0

     2634    28792    5                  CALL VMA$PUT_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,M$MAIL_FILE_NUM,
             28792                            CURRENT_MESSAGE_NUMBER);

  28792 19 005112   000256 630400 20                 EPPR0   174
        19 005113   000026 631400 20                 EPPR1   22
        19 005114   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        19 005115   000000 011000                    NOP     0

     2635    28793    5               END;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:443  
     2636    28794
     2637    28795    4           END;

  28790 19 005116                       END_DETACH   null
     2638    28796    3   END_DETACH:;
     2639    28797    3           IF VM_ENCLOS.FLAGS.DELETED THEN

  28797 19 005116   200032 470500                    LDP0    ENCL$,,AUTO
        19 005117   000002 234100                    SZN     2,,PR0
        19 005120   005132 605000 19                 TPL     s:28800

     2640    28798    3               CALL REPORT_ACTIVITY (INDX2,VM_DETACH_DELETE_OK_FMT,%YES#,
             28798                        E_DETACH_DELETE_OK_FMT);

  28798 19 005121   000271 236000 20                 LDQ     185
        19 005122   201122 756100                    STQ     @NAME+1,,AUTO
        19 005123   000272 237000 20                 LDAQ    186
        19 005124   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 005125   000154 236000 20                 LDQ     108
        19 005126   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 005127   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 005130   000000 011000                    NOP     0
        19 005131   016452 710000 19                 TRA     CONTINUE

     2641    28799    3           ELSE
     2642    28800    3               CALL REPORT_ACTIVITY (INDX2,VM_DETACH_OK_FMT,%YES#,E_DETACH_OK_FMT);

  28800 19 005132   000274 236000 20                 LDQ     188
        19 005133   201122 756100                    STQ     @NAME+1,,AUTO
        19 005134   000276 237000 20                 LDAQ    190
        19 005135   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 005136   000154 236000 20                 LDQ     108
        19 005137   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 005140   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 005141   000000 011000                    NOP     0
        19 005142   016452 710000 19                 TRA     CONTINUE

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:444  
     2643    28801        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:445  
     2644    28802        /* Display list command */
     2645    28803    3       CASE (%CMD_DISPLAY_LIST);

     2646    28804    3           CALL NEED_FOLDER ALTRET(CONTINUE);

  28804 19 005143   016547 701000 19                 TSX1    NEED_FOLDER
        19 005144   016452 702000 19                 TSX2    CONTINUE

     2647    28805    3           IF NOT VM_SEARCH_INFO.ACTIVE THEN CALL VMA$OPEN_SRCH_LIST(VM_SEARCH_INFO);

  28805 19 005145   001632 234000 11                 SZN     VM_SEARCH_INFO+34
        19 005146   005153 604000 19                 TMI     s:28806

  28805 19 005147   000042 630400 20                 EPPR0   34
        19 005150   000024 631400 20                 EPPR1   20
        19 005151   000000 701000 xent               TSX1    VMA$OPEN_SRCH_LIST
        19 005152   000000 011000                    NOP     0

     2648    28806    3           INDX2 = 0;                  /* Used as counter */

  28806 19 005153   000375 450000 11                 STZ     INDX2

     2649    28807    3           IF OUT$ -> P$B.NSUBLKS = 0

  28807 19 005154   200023 470500                    LDP0    OUT$,,AUTO
        19 005155   000001 220100                    LDX0    1,,PR0
        19 005156   005174 601000 19                 TNZ     s:28822

     2650    28808    4           THEN DO;    /* Display all lists in current folder */

     2651    28809    4   DI_LIST_ALL:
     2652    28810    4               VM_LISTKEY.TEXT = ' ';

  28810 19 005157   040000 100400       DI_LIST_ALL  MLR     fill='040'O
        19 005160   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 005161   000554 400310 11                 ADSC9   VM_LISTKEY               cn=2,n=200

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:446  
     2653    28811    5               DO FOREVER;

     2654    28812    5                   CALL VMA$GET_LIST_NEXT (VM_LISTKEY,VM_ADDLIST$,

  28812 19 005162   000202 630400 20                 EPPR0   130
        19 005163   000021 631400 20                 EPPR1   17
        19 005164   000000 701000 xent               TSX1    VMA$GET_LIST_NEXT
        19 005165   005454 702000 19                 TSX2    END_DI_LIST

     2655    28813    5                     M$MAIL_FILE_NUM) ALTRET(END_DI_LIST);
     2656    28814    5                   CALL VMD$DI_LIST (VM_LISTKEY,OUTDCB);

  28814 19 005166   000300 630400 20                 EPPR0   192
        19 005167   000000 631400 20                 EPPR1   0
        19 005170   000000 701000 xent               TSX1    VMD$DI_LIST
        19 005171   000000 011000                    NOP     0

     2657    28815    5                   INDX2 = INDX2 + 1;

  28815 19 005172   000375 054000 11                 AOS     INDX2

     2658    28816    5               END;

  28816 19 005173   005162 710000 19                 TRA     s:28812

     2659    28817    4           END;
     2660    28818    4           ELSE DO;

     2661    28819        /*
     2662    28820                ***** Handle output clause, if any ...
     2663    28821        */
     2664    28822    4               BLK$ = OUT$ -> P$B.SUBLK$ (OUT$ -> P$B.NSUBLKS - 1);

  28822 19 005174   000002 236110                    LDQ     2,X0,PR0
        19 005175   200024 756100                    STQ     BLK$,,AUTO

     2665    28823    4               IF BLK$ -> P$B.CODE = %OPT_OUTPUT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:447  

  28823 19 005176   200024 471500                    LDP1    BLK$,,AUTO
        19 005177   100000 720100                    LXL0    0,,PR1
        19 005200   000005 100003                    CMPX0   5,DU
        19 005201   005231 601000 19                 TNZ     s:28840

     2666    28824    5               THEN DO;

     2667    28825    5                   CALL XUR$OPENOUT (M$OUT_NUM, BLK$ -> P$B)

  28825 19 005202   000265 235000 20                 LDA     181
        19 005203   201706 757100                    STAQ    I+100,,AUTO
        19 005204   201706 630500                    EPPR0   I+100,,AUTO
        19 005205   000000 631400 20                 EPPR1   0
        19 005206   000000 701000 xent               TSX1    XUR$OPENOUT
        19 005207   005213 702000 19                 TSX2    s:28830

     2668    28826    6                   WHENRETURN DO;

     2669    28827    6                       OUTDCB = M$OUT_NUM;

  28827 19 005210   000075 235000 12                 LDA     M$OUT_NUM
        19 005211   000402 755000 11                 STA     OUTDCB

     2670    28828    6                   END;

  28828 19 005212   005225 710000 19                 TRA     s:28833

     2671    28829    6                   WHENALTRETURN DO;

     2672    28830    6                       CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);

  28830 19 005213   000265 236000 20                 LDQ     181
        19 005214   201707 756100                    STQ     I+101,,AUTO
        19 005215   200003 236100                    LDQ     XUG_GETCMD$,,AUTO
        19 005216   000001 036003                    ADLQ    1,DU
        19 005217   201706 756100                    STQ     I+100,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:448  
        19 005220   201706 630500                    EPPR0   I+100,,AUTO
        19 005221   000000 631400 20                 EPPR1   0
        19 005222   000000 701000 xent               TSX1    XUR$ERRMSG
        19 005223   000000 011000                    NOP     0

     2673    28831    6                       GOTO CONTINUE;

  28831 19 005224   016452 710000 19                 TRA     CONTINUE

     2674    28832    6                   END;
     2675    28833    5                   IF OUT$ -> P$B.NSUBLKS = 1

  28833 19 005225   200023 470500                    LDP0    OUT$,,AUTO
        19 005226   000001 220100                    LDX0    1,,PR0
        19 005227   000001 100003                    CMPX0   1,DU
        19 005230   005157 600000 19                 TZE     DI_LIST_ALL

     2676    28834    5                   THEN            /* No listname specified */
     2677    28835    5                       GOTO DI_LIST_ALL;
     2678    28836    5               END;

     2679    28837        /*
     2680    28838                ***** Handle wildcarded list ...
     2681    28839        */
     2682    28840    4               CALL INDEX(INDX1,'?',OUT$->P$B.SUBLK$(0)->P$S.TEXT) ALTRET(

  28840 19 005231   000003 471500                    LDP1    3,,PR0
        19 005232   100004 236100                    LDQ     4,,PR1
        19 005233   000033 772000                    QRL     27
        19 005234   000000 620006                    EAX0    0,QL
        19 005235   000000 124540                    SCM     mask='000'O
        19 005236   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 005237   000225 000001 20                 ADSC9   149                      cn=0,n=1
        19 005240   200033 000100                    ARG     INDX1,,AUTO
        19 005241   005410 606400 19                 TTN     NON_WILD_DI_LIST

     2683    28841    4                 NON_WILD_DI_LIST);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:449  
     2684    28842    4               VM_WILDCARD.PATTERN_ = VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXT);

  28842 19 005242   000003 471500                    LDP1    3,,PR0
        19 005243   100004 236100                    LDQ     4,,PR1
        19 005244   000033 772000                    QRL     27
        19 005245   000064 737000                    LLS     52
        19 005246   000140 135007                    SBLA    96,DL
        19 005247   201706 451500                    STP1    I+100,,AUTO
        19 005250   201706 236100                    LDQ     I+100,,AUTO
        19 005251   000215 036000 20                 ADLQ    141
        19 005252   001634 757000 11                 STAQ    VM_WILDCARD

     2685    28843    4               CALL XLATE(OUT$->P$B.SUBLK$(0)->P$S.TEXT, LOWER_UPPER,

  28843 19 005253   000003 471500                    LDP1    3,,PR0
        19 005254   100004 236100                    LDQ     4,,PR1
        19 005255   000033 772000                    QRL     27
        19 005256   000000 620006                    EAX0    0,QL
        19 005257   000000 473400 xsym               LDP3    B$XL_UPPER$
        19 005260   000000 621006                    EAX1    0,QL
        19 005261   040140 160540                    MVT     fill='040'O
        19 005262   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 005263   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        19 005264   300000 000100                    ARG     0,,PR3

     2686    28844    4                 OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2687    28845    5               DO INDX3=0 TO VM_SEARCH_INFO.NUM_ENTRIES-1;

  28845 19 005265   200034 450100                    STZ     INDX3,,AUTO
        19 005266   005403 710000 19                 TRA     NO_MATCH_DI_LIST+1

     2688    28846    5                   IF INDX1 = 0

  28846 19 005267   200033 235100                    LDA     INDX1,,AUTO
        19 005270   005275 601000 19                 TNZ     s:28850

     2689    28847    5                   THEN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:450  
     2690    28848    5                       VM_LISTKEY.TEXT = ' '; /* Start at first entry */

  28848 19 005271   040000 100400                    MLR     fill='040'O
        19 005272   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 005273   000554 400310 11                 ADSC9   VM_LISTKEY               cn=2,n=200
        19 005274   005325 710000 19                 TRA     LIST_LOOP

     2691    28849    6                   ELSE DO;

     2692    28850    6                       VM_LISTKEY.TEXT = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;

  28850 19 005275   200023 470500                    LDP0    OUT$,,AUTO
        19 005276   000003 471500                    LDP1    3,,PR0
        19 005277   100004 236100                    LDQ     4,,PR1
        19 005300   000033 772000                    QRL     27
        19 005301   000000 620006                    EAX0    0,QL
        19 005302   040000 100540                    MLR     fill='040'O
        19 005303   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 005304   000554 400310 11                 ADSC9   VM_LISTKEY               cn=2,n=200

     2693    28851    6                       SUBSTR (VM_LISTKEY.TEXT, INDX1) = ' ';

  28851 19 005305   777467 620005                    EAX0    -201,AL
        19 005306   777777 660003                    ERX0    -1,DU
        19 005307   040045 100400                    MLR     fill='040'O
        19 005310   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 005311   000554 400010 11                 ADSC9   VM_LISTKEY,A             cn=2,n=*X0

     2694    28852    6                       SUBSTR (VM_LISTKEY.TEXT, INDX1-1, 1) = BINASC(ASCBIN(SUBSTR(
             28852                                VM_LISTKEY.TEXT, INDX1-1, 1)) - 1);

  28852 19 005312   000100 101405                    MRL     fill='000'O
        19 005313   000554 200001 11                 ADSC9   VM_LISTKEY,A             cn=1,n=1
        19 005314   201706 000004                    ADSC9   I+100,,AUTO              cn=0,n=4
        19 005315   201706 236100                    LDQ     I+100,,AUTO
        19 005316   000001 136007                    SBLQ    1,DL
        19 005317   000033 736000                    QLS     27
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:451  
        19 005320   000302 276000 20                 ORQ     194
        19 005321   201707 756100                    STQ     I+101,,AUTO
        19 005322   040005 100500                    MLR     fill='040'O
        19 005323   201707 000004                    ADSC9   I+101,,AUTO              cn=0,n=4
        19 005324   000554 200001 11                 ADSC9   VM_LISTKEY,A             cn=1,n=1

     2695    28853    6                   END;

     2696    28854    5   LIST_LOOP:
     2697    28855    5                   CALL VMA$GET_LIST_NEXT (VM_LISTKEY,VM_ADDLIST$,

  28855 19 005325   200034 720100       LIST_LOOP    LXL0    INDX3,,AUTO
        19 005326   001571 630410 11                 EPPR0   VM_SEARCH_INFO+1,X0
        19 005327   201710 450500                    STP0    I+102,,AUTO
        19 005330   000202 237000 20                 LDAQ    130
        19 005331   201706 757100                    STAQ    I+100,,AUTO
        19 005332   201706 630500                    EPPR0   I+100,,AUTO
        19 005333   000021 631400 20                 EPPR1   17
        19 005334   000000 701000 xent               TSX1    VMA$GET_LIST_NEXT
        19 005335   005402 702000 19                 TSX2    NO_MATCH_DI_LIST

     2698    28856    5                     VM_SEARCH_INFO.DCB#(INDX3)) ALTRET(NO_MATCH_DI_LIST);
     2699    28857    5                   IF INDX1 > 0

  28857 19 005336   200033 235100                    LDA     INDX1,,AUTO
        19 005337   005352 604400 19                 TMOZ    s:28861
        19 005340   200023 470500                    LDP0    OUT$,,AUTO
        19 005341   000003 471500                    LDP1    3,,PR0
        19 005342   100004 236100                    LDQ     4,,PR1
        19 005343   000033 772000                    QRL     27
        19 005344   000000 620005                    EAX0    0,AL
        19 005345   200033 721100                    LXL1    INDX1,,AUTO
        19 005346   040040 106540                    CMPC    fill='040'O
        19 005347   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 005350   000554 400011 11                 ADSC9   VM_LISTKEY               cn=2,n=*X1
        19 005351   005402 602000 19                 TNC     NO_MATCH_DI_LIST

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:452  
     2700    28858    5                    AND SUBSTR(VM_LISTKEY.TEXT, 0, INDX1) > SUBSTR(OUT$ -> P$B.SUBLK$(
             28858                              0) -> P$S.TEXT, 0, INDX1)
     2701    28859    5                   THEN
     2702    28860    5                       GOTO NO_MATCH_DI_LIST;
     2703    28861    5                   VM_WILDCARD.INPUT_ = VECTOR(SUBSTR(VM_LISTKEY.TEXT,0,

  28861 19 005352   000554 236000 11                 LDQ     VM_LISTKEY
        19 005353   000033 772000                    QRL     27
        19 005354   777777 620006                    EAX0    -1,QL
        19 005355   000000 635010                    EAA     0,X0
        19 005356   000002 771000                    ARL     2
        19 005357   000140 135007                    SBLA    96,DL
        19 005360   000236 236000 20                 LDQ     158
        19 005361   001636 757000 11                 STAQ    VM_WILDCARD+2

     2704    28862    5                     VM_LISTKEY.COUNT-1)); /* One less for type */
     2705    28863    5                   CALL X$WILDCMP (VM_WILDCARD) ALTRET(LIST_LOOP);

  28863 19 005362   000237 630400 20                 EPPR0   159
        19 005363   000024 631400 20                 EPPR1   20
        19 005364   000000 701000 xent               TSX1    X$WILDCMP
        19 005365   005325 702000 19                 TSX2    LIST_LOOP

     2706    28864    5                   CALL VMD$DI_LIST (VM_LISTKEY,OUTDCB,INDX3,VM_SEARCH_INFO);

  28864 19 005366   000042 236000 20                 LDQ     34
        19 005367   201711 756100                    STQ     I+103,,AUTO
        19 005370   200034 630500                    EPPR0   INDX3,,AUTO
        19 005371   201710 450500                    STP0    I+102,,AUTO
        19 005372   000300 237000 20                 LDAQ    192
        19 005373   201706 757100                    STAQ    I+100,,AUTO
        19 005374   201706 630500                    EPPR0   I+100,,AUTO
        19 005375   000026 631400 20                 EPPR1   22
        19 005376   000000 701000 xent               TSX1    VMD$DI_LIST
        19 005377   000000 011000                    NOP     0

     2707    28865    5                   INDX2 = INDX2 + 1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:453  

  28865 19 005400   000375 054000 11                 AOS     INDX2

     2708    28866    5                   GOTO LIST_LOOP;

  28866 19 005401   005325 710000 19                 TRA     LIST_LOOP

     2709    28867    5   NO_MATCH_DI_LIST:
     2710    28868    5               END;

  28868 19 005402   200034 054100       NO_MATCH_DI* AOS     INDX3,,AUTO
        19 005403   200034 236100                    LDQ     INDX3,,AUTO
        19 005404   005267 604000 19                 TMI     s:28846
        19 005405   001570 116000 11                 CMPQ    VM_SEARCH_INFO
        19 005406   005267 602000 19                 TNC     s:28846

     2711    28869        /*
     2712    28870             ***** Handle non-wild case ...
     2713    28871        */
     2714    28872    5               DO NEVER;

  28872 19 005407   005454 710000 19                 TRA     END_DI_LIST

     2715    28873    5   NON_WILD_DI_LIST:
     2716    28874    5                   VM_LISTKEY.TEXT = OUT$->P$B.SUBLK$(0)->P$S.TEXT;

  28874 19 005410   200023 470500       NON_WILD_DI* LDP0    OUT$,,AUTO
        19 005411   000003 471500                    LDP1    3,,PR0
        19 005412   100004 236100                    LDQ     4,,PR1
        19 005413   000033 772000                    QRL     27
        19 005414   000000 620006                    EAX0    0,QL
        19 005415   040000 100540                    MLR     fill='040'O
        19 005416   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 005417   000554 400310 11                 ADSC9   VM_LISTKEY               cn=2,n=200

     2717    28875    6                   DO INDX3=0 TO VM_SEARCH_INFO.NUM_ENTRIES-1;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:454  
  28875 19 005420   200034 450100                    STZ     INDX3,,AUTO
        19 005421   005450 710000 19                 TRA     s:28883+1

     2718    28876    6                       CALL VMA$GET_LIST (VM_LISTKEY,VM_ADDLIST$,

  28876 19 005422   200034 720100                    LXL0    INDX3,,AUTO
        19 005423   001571 630410 11                 EPPR0   VM_SEARCH_INFO+1,X0
        19 005424   201710 450500                    STP0    I+102,,AUTO
        19 005425   000202 237000 20                 LDAQ    130
        19 005426   201706 757100                    STAQ    I+100,,AUTO
        19 005427   201706 630500                    EPPR0   I+100,,AUTO
        19 005430   000021 631400 20                 EPPR1   17
        19 005431   000000 701000 xent               TSX1    VMA$GET_LIST
        19 005432   005447 702000 19                 TSX2    s:28883

     2719    28877    6                         VM_SEARCH_INFO.DCB#(INDX3))
     2720    28878    7                       WHENRETURN DO;

     2721    28879    7                           INDX2 = INDX2 + 1;

  28879 19 005433   000375 054000 11                 AOS     INDX2

     2722    28880    7                           CALL VMD$DI_LIST (VM_LISTKEY,OUTDCB,INDX3,VM_SEARCH_INFO);

  28880 19 005434   000042 236000 20                 LDQ     34
        19 005435   201711 756100                    STQ     I+103,,AUTO
        19 005436   200034 630500                    EPPR0   INDX3,,AUTO
        19 005437   201710 450500                    STP0    I+102,,AUTO
        19 005440   000300 237000 20                 LDAQ    192
        19 005441   201706 757100                    STAQ    I+100,,AUTO
        19 005442   201706 630500                    EPPR0   I+100,,AUTO
        19 005443   000026 631400 20                 EPPR1   22
        19 005444   000000 701000 xent               TSX1    VMD$DI_LIST
        19 005445   000000 011000                    NOP     0

     2723    28881    7                           GOTO END_DI_LIST;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:455  
  28881 19 005446   005454 710000 19                 TRA     END_DI_LIST

     2724    28882    7                       END;
     2725    28883    6                   END;

  28883 19 005447   200034 054100                    AOS     INDX3,,AUTO
        19 005450   200034 236100                    LDQ     INDX3,,AUTO
        19 005451   005422 604000 19                 TMI     s:28876
        19 005452   001570 116000 11                 CMPQ    VM_SEARCH_INFO
        19 005453   005422 602000 19                 TNC     s:28876

     2726    28884    5               END;             /* Do never ... end */

     2727    28885    4           END;

  28876 19 005454                       END_DI_LIST  null
     2728    28886    3   END_DI_LIST: ;
     2729    28887    3           IF INDX2 ~= 1 OR NOT DCBADDR(OUTDCB) -> F$DCB.DDEV.UCOUT#

  28887 19 005454   000375 235000 11                 LDA     INDX2
        19 005455   000001 115007                    CMPA    1,DL
        19 005456   005466 601000 19                 TNZ     s:28889
        19 005457   000074 470400 20                 LDP0    60
        19 005460   000000 471500                    LDP1    0,,PR0
        19 005461   000402 720000 11                 LXL0    OUTDCB
        19 005462   100000 473510                    LDP3    0,X0,PR1
        19 005463   300004 236100                    LDQ     4,,PR3
        19 005464   020000 316007                    CANQ    8192,DL
        19 005465   016452 601000 19                 TNZ     CONTINUE

     2730    28888    3           THEN
     2731    28889    3               CALL REPORT_ACTIVITY (INDX2,VM_LISTS_DISPLAYED_FMT,%NO#,
             28889                        E_LISTS_DISPLAYED_FMT);

  28889 19 005466   000303 236000 20                 LDQ     195
        19 005467   201122 756100                    STQ     @NAME+1,,AUTO
        19 005470   000304 237000 20                 LDAQ    196
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:456  
        19 005471   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 005472   000154 236000 20                 LDQ     108
        19 005473   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 005474   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 005475   000000 011000                    NOP     0
        19 005476   016452 710000 19                 TRA     CONTINUE

     2732    28890        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:457  
     2733    28891        /* Display message command */
     2734    28892    3       CASE (%CMD_DISPLAY_MESSAGE);

     2735    28893    3           CALL NEED_FOLDER ALTRET(CONTINUE);

  28893 19 005477   016547 701000 19                 TSX1    NEED_FOLDER
        19 005500   016452 702000 19                 TSX2    CONTINUE

     2736    28894    3           OPT_SEED = 0;

  28894 19 005501   001710 450000 11                 STZ     OPT_SEED

     2737    28895    3           OPT_SEED$ = ADDR(OPT_SEED);

  28895 19 005502   000306 236000 20                 LDQ     198
        19 005503   201112 756100                    STQ     OPT_SEED$,,AUTO

     2738    28896    3           LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE;

  28896 19 005504   000016 235007                    LDA     14,DL
        19 005505   000544 755000 11                 STA     LAST_COMMAND_CODE

     2739    28897    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;

  28897 19 005506   200033 450100                    STZ     INDX1,,AUTO
        19 005507   005577 710000 19                 TRA     s:28918+1

     2740    28898    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);

  28898 19 005510   200023 470500                    LDP0    OUT$,,AUTO
        19 005511   200033 720100                    LXL0    INDX1,,AUTO
        19 005512   000003 236110                    LDQ     3,X0,PR0
        19 005513   200024 756100                    STQ     BLK$,,AUTO

     2741    28899    5               DO CASE (BLK$ -> P$B.CODE);

  28899 19 005514   200024 471500                    LDP1    BLK$,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:458  
        19 005515   100000 721100                    LXL1    0,,PR1
        19 005516   000006 101003                    CMPX1   6,DU
        19 005517   005521 602011 19                 TNC     s:28899+5,X1
        19 005520   005576 710000 19                 TRA     s:28918
        19 005521   005576 710000 19                 TRA     s:28918
        19 005522   005527 710000 19                 TRA     s:28901
        19 005523   005570 710000 19                 TRA     s:28915
        19 005524   005576 710000 19                 TRA     s:28918
        19 005525   005576 710000 19                 TRA     s:28918
        19 005526   005544 710000 19                 TRA     s:28906

     2742    28900    5               CASE (%OPT_CRPT);

     2743    28901    5                   CALL VMX$OCTBIN (BLK$->P$B.SUBLK$(0)->P$S,OPT_SEED);

  28901 19 005527   100003 473500                    LDP3    3,,PR1
        19 005530   000306 236000 20                 LDQ     198
        19 005531   201707 756100                    STQ     I+101,,AUTO
        19 005532   201706 453500                    STP3    I+100,,AUTO
        19 005533   201706 630500                    EPPR0   I+100,,AUTO
        19 005534   000000 631400 20                 EPPR1   0
        19 005535   000000 701000 xent               TSX1    VMX$OCTBIN
        19 005536   000000 011000                    NOP     0

     2744    28902    5                   IF OPT_SEED = 0

  28902 19 005537   001710 235000 11                 LDA     OPT_SEED
        19 005540   005576 601000 19                 TNZ     s:28918

     2745    28903    5                   THEN /* allow display w/o decryption */
     2746    28904    5                       OPT_SEED$ = ADDR(NIL);

  28904 19 005541   000022 236000 20                 LDQ     18
        19 005542   201112 756100                    STQ     OPT_SEED$,,AUTO
        19 005543   005576 710000 19                 TRA     s:28918

     2747    28905    5               CASE (%OPT_OUTPUT);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:459  

     2748    28906    5                   CALL XUR$OPENOUT (M$OUT_NUM, BLK$ -> P$B)

  28906 19 005544   000265 235000 20                 LDA     181
        19 005545   201706 757100                    STAQ    I+100,,AUTO
        19 005546   201706 630500                    EPPR0   I+100,,AUTO
        19 005547   000000 631400 20                 EPPR1   0
        19 005550   000000 701000 xent               TSX1    XUR$OPENOUT
        19 005551   005555 702000 19                 TSX2    s:28911

     2749    28907    6                   WHENRETURN DO;

     2750    28908    6                       OUTDCB = M$OUT_NUM;

  28908 19 005552   000075 235000 12                 LDA     M$OUT_NUM
        19 005553   000402 755000 11                 STA     OUTDCB

     2751    28909    6                   END;

  28909 19 005554   005567 710000 19                 TRA     s:28912+1

     2752    28910    6                   WHENALTRETURN DO;

     2753    28911    6                       CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);

  28911 19 005555   000265 236000 20                 LDQ     181
        19 005556   201707 756100                    STQ     I+101,,AUTO
        19 005557   200003 236100                    LDQ     XUG_GETCMD$,,AUTO
        19 005560   000001 036003                    ADLQ    1,DU
        19 005561   201706 756100                    STQ     I+100,,AUTO
        19 005562   201706 630500                    EPPR0   I+100,,AUTO
        19 005563   000000 631400 20                 EPPR1   0
        19 005564   000000 701000 xent               TSX1    XUR$ERRMSG
        19 005565   000000 011000                    NOP     0

     2754    28912    6                       GOTO CONTINUE;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:460  
  28912 19 005566   016452 710000 19                 TRA     CONTINUE
        19 005567   005576 710000 19                 TRA     s:28918

     2755    28913    6                   END;
     2756    28914    5               CASE (%OPT_SELECT);

     2757    28915    5                   CALL INIT$SELECT_OPTS (BLK$,%CMD_DISPLAY_MESSAGE) ALTRET(

  28915 19 005570   000310 236000 20                 LDQ     200
        19 005571   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 005572   200024 633500                    EPPR3   BLK$,,AUTO
        19 005573   201117 453500                    STP3    @CURR_COMMAND_CODE+2,,AUTO
        19 005574   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 005575   016452 702000 19                 TSX2    CONTINUE

     2758    28916    5                     CONTINUE);
     2759    28917    5               END;             /* Do case ... end */

     2760    28918    4           END;                  /* Do INDX1 = ... end */

  28918 19 005576   200033 054100                    AOS     INDX1,,AUTO
        19 005577   200023 470500                    LDP0    OUT$,,AUTO
        19 005600   000001 236100                    LDQ     1,,PR0
        19 005601   000022 772000                    QRL     18
        19 005602   200033 116100                    CMPQ    INDX1,,AUTO
        19 005603   005510 605400 19                 TPNZ    s:28898

     2761    28919
     2762    28920    3           INDX2 = 0;                  /* Used as counter */

  28920 19 005604   000375 450000 11                 STZ     INDX2

     2763    28921    3           NONE = %YES#;

  28921 19 005605   400000 236003                    LDQ     -131072,DU
        19 005606   200037 756100                    STQ     NONE,,AUTO

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:461  
     2764    28922    4           DO FOREVER;

     2765    28923    4   DI_NEXT:
     2766    28924    4               CALL GET$MESSAGE ALTRET(END_DISP);

  28924 19 005607   020536 701000 19    DI_NEXT      TSX1    GET$MESSAGE
        19 005610   006024 702000 19                 TSX2    END_DISP

     2767    28925    4               NONE = %NO#;

  28925 19 005611   200037 450100                    STZ     NONE,,AUTO

     2768    28926    4               VM_PROFILE.HI_MESSAGE_NUMBER =

  28926 19 005612   000072 236000 11                 LDQ     CURRENT_MESSAGE_NUMBER
        19 005613   000000 470400 xsym               LDP0    VM_PROFILE$
        19 005614   005617 604000 19                 TMI     s:28926+5
        19 005615   000011 116100                    CMPQ    9,,PR0
        19 005616   005620 603000 19                 TRC     s:28926+6
        19 005617   000011 236100                    LDQ     9,,PR0
        19 005620   000011 756100                    STQ     9,,PR0

     2769    28927    4                 MAXIMUM( VM_PROFILE.HI_MESSAGE_NUMBER , CURRENT_MESSAGE_NUMBER );
     2770    28928    4               IF VM_HEADER.STATUS.CRYPT

  28928 19 005621   000000 471400 xsym               LDP1    VM_HEADER$
        19 005622   100012 236100                    LDQ     10,,PR1
        19 005623   010000 316003                    CANQ    4096,DU
        19 005624   005650 600000 19                 TZE     s:28936
        19 005625   001710 235000 11                 LDA     OPT_SEED
        19 005626   005650 601000 19                 TNZ     s:28936
        19 005627   201112 236100                    LDQ     OPT_SEED$,,AUTO
        19 005630   000022 116000 20                 CMPQ    18
        19 005631   005650 600000 19                 TZE     s:28936

     2771    28929    4                 AND OPT_SEED = 0
     2772    28930    4                 AND OPT_SEED$ ~= ADDR(NIL)
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:462  
     2773    28931    5               THEN DO;

     2774    28932    5                   CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,OUTDCB);

  28932 19 005632   000301 236000 20                 LDQ     193
        19 005633   201710 756100                    STQ     I+102,,AUTO
        19 005634   000103 236000 20                 LDQ     67
        19 005635   000000 235000 xsym               LDA     VM_HEADER$
        19 005636   201706 757100                    STAQ    I+100,,AUTO
        19 005637   201706 630500                    EPPR0   I+100,,AUTO
        19 005640   000021 631400 20                 EPPR1   17
        19 005641   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 005642   000000 011000                    NOP     0

     2775    28933    5                   CALL XUR$ERRMSG (E_NEEDSEED);

  28933 19 005643   000311 630400 20                 EPPR0   201
        19 005644   000024 631400 20                 EPPR1   20
        19 005645   000000 701000 xent               TSX1    XUR$ERRMSG
        19 005646   000000 011000                    NOP     0

     2776    28934    5                   GOTO DI_NEXT;

  28934 19 005647   005607 710000 19                 TRA     DI_NEXT

     2777    28935    5               END;
     2778    28936    4               IF VM_PROFILE.OPT.PAGE

  28936 19 005650   000000 236100                    LDQ     0,,PR0
        19 005651   000020 316007                    CANQ    16,DL
        19 005652   005657 600000 19                 TZE     s:28939

     2779    28937    4               THEN                 /* Go to top of page */
     2780    28938    4                   CALL VMD$EJECT(OUTDCB) ALTRET(E_PMME);

  28938 19 005653   000301 630400 20                 EPPR0   193
        19 005654   000024 631400 20                 EPPR1   20
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:463  
        19 005655   000000 701000 xent               TSX1    VMD$EJECT
        19 005656   016514 702000 19                 TSX2    E_PMME

     2781    28939    4               CALL VMD$DI_MESSAGE(CURRENT_MESSAGE_NUMBER,

  28939 19 005657   000066 236000 20                 LDQ     54
        19 005660   201712 756100                    STQ     I+104,,AUTO
        19 005661   201112 236100                    LDQ     OPT_SEED$,,AUTO
        19 005662   000053 235000 20                 LDA     43
        19 005663   201710 757100                    STAQ    I+102,,AUTO
        19 005664   000312 237000 20                 LDAQ    202
        19 005665   201706 757100                    STAQ    I+100,,AUTO
        19 005666   201706 630500                    EPPR0   I+100,,AUTO
        19 005667   000041 631400 20                 EPPR1   33
        19 005670   000000 701000 xent               TSX1    VMD$DI_MESSAGE
        19 005671   005673 702000 19                 TSX2    s:28942
        19 005672   005700 710000 19                 TRA     s:28945

     2782    28940    4                 OUTDCB,M$MAIL_FILE_NUM,OPT$SEED,%NO#)
     2783    28941    5               WHENALTRETURN DO;

     2784    28942    5                   CALL XUR$ERRMSG (E_DI_BADSEED);

  28942 19 005673   000314 630400 20                 EPPR0   204
        19 005674   000024 631400 20                 EPPR1   20
        19 005675   000000 701000 xent               TSX1    XUR$ERRMSG
        19 005676   000000 011000                    NOP     0

     2785    28943    5                   GOTO DI_NEXT;

  28943 19 005677   005607 710000 19                 TRA     DI_NEXT

     2786    28944    5               END;
     2787    28945    4               INDX2 = INDX2 + 1;

  28945 19 005700   000375 054000 11                 AOS     INDX2

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:464  
     2788    28946    4               IF VM_CURRENT_FOLDER.FLAGS.UPDATE

  28946 19 005701   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 005702   005607 605000 19                 TPL     DI_NEXT

     2789    28947    4               THEN
     2790    28948    5               DO;

     2791    28949    5                   IF VM_HEADER.STATUS.EXAM = %NO#

  28949 19 005703   000000 470400 xsym               LDP0    VM_HEADER$
        19 005704   000012 430100                    FSZN    10,,PR0
        19 005705   005711 605000 19                 TPL     s:28953
        19 005706   000012 236100                    LDQ     10,,PR0
        19 005707   004000 316003                    CANQ    2048,DU
        19 005710   005750 601000 19                 TNZ     s:28974

     2792    28950    5                     OR VM_HEADER.STATUS.OLD = %NO#
     2793    28951    5                   THEN      /* Must set these flags */
     2794    28952    6                   DO;

     2795    28953    6                       CALL XUR$DISABLE;

  28953 19 005711   000020 631400 20                 EPPR1   16
        19 005712   000000 701000 xent               TSX1    XUR$DISABLE
        19 005713   000000 011000                    NOP     0

     2796    28954    6                       IF NOT VM_HEADER.STATUS.OLD

  28954 19 005714   000000 470400 xsym               LDP0    VM_HEADER$
        19 005715   000012 236100                    LDQ     10,,PR0
        19 005716   004000 316003                    CANQ    2048,DU
        19 005717   005724 601000 19                 TNZ     s:28958
        19 005720   002000 316003                    CANQ    1024,DU
        19 005721   005724 601000 19                 TNZ     s:28958

     2797    28955    6                         AND NOT VM_HEADER.STATUS.MAKE_OLD
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:465  
     2798    28956    6                       THEN
     2799    28957    6                           MADE_OLD = %YES#;

  28957 19 005722   400000 236003                    LDQ     -131072,DU
        19 005723   200040 756100                    STQ     MADE_OLD,,AUTO

     2800    28958    6                       VM_HEADER.STATUS.EXAM = %YES#;

  28958 19 005724   001000 236003                    LDQ     512,DU
        19 005725   000012 256100                    ORSQ    10,,PR0

     2801    28959    6                       VM_HEADER.STATUS.MAKE_OLD = %YES#;

  28959 19 005726   002000 236003                    LDQ     1024,DU
        19 005727   000012 256100                    ORSQ    10,,PR0

     2802    28960    6                       CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,

  28960 19 005730   000120 630400 20                 EPPR0   80
        19 005731   000000 631400 20                 EPPR1   0
        19 005732   000000 701000 xent               TSX1    VMD$PUT_HEADER
        19 005733   000000 011000                    NOP     0

     2803    28961    6                         M$MAIL_FILE_NUM);
     2804    28962    6                      VM_PROFILE.NUM_MOLD_MESSAGES = VM_PROFILE.NUM_MOLD_MESSAGES + 1;

  28962 19 005734   000000 470400 xsym               LDP0    VM_PROFILE$
        19 005735   000010 235100                    LDA     8,,PR0
        19 005736   000001 035007                    ADLA    1,DL
        19 005737   000010 755100                    STA     8,,PR0

     2805    28963    6                       CALL PUT_PROFILE (M$MAIL_FILE_NUM)

  28963 19 005740   000053 236000 20                 LDQ     43
        19 005741   201523 756100                    STQ     INDX2+255,,AUTO
        19 005742   021320 701000 19                 TSX1    PUT_PROFILE
        19 005743   016477 702000 19                 TSX2    WRITE_ERROR
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:466  

     2806    28964    6                         ALTRET(WRITE_ERROR);
     2807    28965    6                       CALL XUR$ENABLE;

  28965 19 005744   000020 631400 20                 EPPR1   16
        19 005745   000000 701000 xent               TSX1    XUR$ENABLE
        19 005746   000000 011000                    NOP     0

     2808    28966    6                   END;

  28966 19 005747   005773 710000 19                 TRA     s:28986

     2809    28967    5                   ELSE
     2810    28968        /*
     2811    28969          **** This code should never get excercised. Profile record may not get
     2812    28970          **** updated if the system crashes. This will set the num_mold_messages
     2813    28971          **** so that updating occurs at exit which sets vm_header.status.old.
     2814    28972        */
     2815    28973    6                   DO;

     2816    28974    6                       IF VM_HEADER.STATUS.EXAM = %YES#

  28974 19 005750   000012 430100                    FSZN    10,,PR0
        19 005751   005773 605000 19                 TPL     s:28986
        19 005752   002000 316003                    CANQ    1024,DU
        19 005753   005773 600000 19                 TZE     s:28986
        19 005754   000000 471400 xsym               LDP1    VM_PROFILE$
        19 005755   100010 235100                    LDA     8,,PR1
        19 005756   005773 601000 19                 TNZ     s:28986

     2817    28975    6                         AND VM_HEADER.STATUS.MAKE_OLD = %YES#
     2818    28976    6                         AND VM_PROFILE.NUM_MOLD_MESSAGES = 0 THEN
     2819    28977    7                       DO;

     2820    28978    7                           VM_PROFILE.NUM_MOLD_MESSAGES =

  28978 19 005757   100005 235100                    LDA     5,,PR1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:467  
        19 005760   100010 755100                    STA     8,,PR1

     2821    28979    7                             VM_PROFILE.NUM_MESSAGES;
     2822    28980    7                           CALL XUR$DISABLE;

  28980 19 005761   000020 631400 20                 EPPR1   16
        19 005762   000000 701000 xent               TSX1    XUR$DISABLE
        19 005763   000000 011000                    NOP     0

     2823    28981    7                           CALL PUT_PROFILE (M$MAIL_FILE_NUM)

  28981 19 005764   000053 236000 20                 LDQ     43
        19 005765   201523 756100                    STQ     INDX2+255,,AUTO
        19 005766   021320 701000 19                 TSX1    PUT_PROFILE
        19 005767   016477 702000 19                 TSX2    WRITE_ERROR

     2824    28982    7                             ALTRET(WRITE_ERROR);
     2825    28983    7                           CALL XUR$ENABLE;

  28983 19 005770   000020 631400 20                 EPPR1   16
        19 005771   000000 701000 xent               TSX1    XUR$ENABLE
        19 005772   000000 011000                    NOP     0

     2826    28984    7                       END;

     2827    28985    6                   END;

     2828    28986    5                   IF VM_HEADER.STATUS.RR

  28986 19 005773   000000 470400 xsym               LDP0    VM_HEADER$
        19 005774   000012 236100                    LDQ     10,,PR0
        19 005775   020000 316003                    CANQ    8192,DU
        19 005776   005607 600000 19                 TZE     DI_NEXT

     2829    28987    5                   THEN
     2830    28988    6                   DO;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:468  
     2831    28989    6                       IF VM_HEADER.FROM$ -> X$STRING.TEXT ~=

  28989 19 005777   000023 471500                    LDP1    19,,PR0
        19 006000   000100 101500                    MRL     fill='000'O
        19 006001   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 006002   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 006003   201706 220100                    LDX0    I+100,,AUTO
        19 006004   040000 106540                    CMPC    fill='040'O
        19 006005   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        19 006006   004427 200400 11                 ADSC9   USER_NAME                cn=1,n=256
        19 006007   005607 600000 19                 TZE     DI_NEXT

     2832    28990    6                         USER_NAME.NAME#
     2833    28991    7                       THEN DO;

     2834    28992    7                           CALL DO$ACK (%NO#)

  28992 19 006010   000066 236000 20                 LDQ     54
        19 006011   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 006012   025040 701000 19                 TSX1    DO$ACK
        19 006013   006023 702000 19                 TSX2    s:29000

     2835    28993    8                           WHENRETURN DO;

     2836    28994    8                               VM_HEADER.STATUS.RR = %NO#;

  28994 19 006014   000000 470400 xsym               LDP0    VM_HEADER$
        19 006015   000137 236000 20                 LDQ     95
        19 006016   000012 356100                    ANSQ    10,,PR0

     2837    28995    8                               CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,
             28995                                        M$MAIL_FILE_NUM);

  28995 19 006017   000120 630400 20                 EPPR0   80
        19 006020   000000 631400 20                 EPPR1   0
        19 006021   000000 701000 xent               TSX1    VMD$PUT_HEADER
        19 006022   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:469  

     2838    28996    8                           END;

     2839    28997    7                       END;

     2840    28998    6                   END;

     2841    28999    5               END;

     2842    29000    4           END;                       /* Do forever ... end  */

  29000 19 006023   005607 710000 19                 TRA     DI_NEXT

  28993 19 006024                       END_DISP     null
     2843    29001
     2844    29002    3   END_DISP: ;
     2845    29003    3           IF INDX2 ~= 1 OR NOT DCBADDR(OUTDCB) -> F$DCB.DDEV.UCOUT#

  29003 19 006024   000375 235000 11                 LDA     INDX2
        19 006025   000001 115007                    CMPA    1,DL
        19 006026   006036 601000 19                 TNZ     s:29005
        19 006027   000074 470400 20                 LDP0    60
        19 006030   000000 471500                    LDP1    0,,PR0
        19 006031   000402 720000 11                 LXL0    OUTDCB
        19 006032   100000 473510                    LDP3    0,X0,PR1
        19 006033   300004 236100                    LDQ     4,,PR3
        19 006034   020000 316007                    CANQ    8192,DL
        19 006035   016452 601000 19                 TNZ     CONTINUE

     2846    29004    3           THEN
     2847    29005    3               CALL REPORT_ACTIVITY (INDX2,VM_MSGS_DISPLAYED_FMT,NONE,

  29005 19 006036   000315 236000 20                 LDQ     205
        19 006037   201122 756100                    STQ     @NAME+1,,AUTO
        19 006040   200037 630500                    EPPR0   NONE,,AUTO
        19 006041   201121 450500                    STP0    @SITENAME+1,,AUTO
        19 006042   000316 236000 20                 LDQ     206
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:470  
        19 006043   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 006044   000154 236000 20                 LDQ     108
        19 006045   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 006046   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 006047   000000 011000                    NOP     0
        19 006050   016452 710000 19                 TRA     CONTINUE

     2848    29006    3                 E_MSGS_DISPLAYED_FMT);
     2849    29007        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:471  
     2850    29008        /* Display profile */
     2851    29009    3       CASE (%CMD_DISPLAY_PROFILE);

     2852    29010    3           CALL NEED_FOLDER ALTRET(CONTINUE);

  29010 19 006051   016547 701000 19                 TSX1    NEED_FOLDER
        19 006052   016452 702000 19                 TSX2    CONTINUE

     2853    29011    3           IF OUT$ -> P$B.NSUBLKS > 0

  29011 19 006053   200023 470500                    LDP0    OUT$,,AUTO
        19 006054   000001 220100                    LDX0    1,,PR0
        19 006055   006103 600000 19                 TZE     s:29022

     2854    29012    4           THEN DO;

     2855    29013    4               CALL XUR$OPENOUT (M$OUT_NUM, OUT$ -> P$B.SUBLK$(0) -> P$B)

  29013 19 006056   000003 471500                    LDP1    3,,PR0
        19 006057   201707 451500                    STP1    I+101,,AUTO
        19 006060   000265 236000 20                 LDQ     181
        19 006061   201706 756100                    STQ     I+100,,AUTO
        19 006062   201706 630500                    EPPR0   I+100,,AUTO
        19 006063   000000 631400 20                 EPPR1   0
        19 006064   000000 701000 xent               TSX1    XUR$OPENOUT
        19 006065   006071 702000 19                 TSX2    s:29018

     2856    29014    5               WHENRETURN DO;

     2857    29015    5                   OUTDCB = M$OUT_NUM;

  29015 19 006066   000075 235000 12                 LDA     M$OUT_NUM
        19 006067   000402 755000 11                 STA     OUTDCB

     2858    29016    5               END;

  29016 19 006070   006103 710000 19                 TRA     s:29022
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:472  

     2859    29017    5               WHENALTRETURN DO;

     2860    29018    5                   CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);

  29018 19 006071   000265 236000 20                 LDQ     181
        19 006072   201707 756100                    STQ     I+101,,AUTO
        19 006073   200003 236100                    LDQ     XUG_GETCMD$,,AUTO
        19 006074   000001 036003                    ADLQ    1,DU
        19 006075   201706 756100                    STQ     I+100,,AUTO
        19 006076   201706 630500                    EPPR0   I+100,,AUTO
        19 006077   000000 631400 20                 EPPR1   0
        19 006100   000000 701000 xent               TSX1    XUR$ERRMSG
        19 006101   000000 011000                    NOP     0

     2861    29019    5                   GOTO CONTINUE;

  29019 19 006102   016452 710000 19                 TRA     CONTINUE

     2862    29020    5               END;
     2863    29021    4           END;

     2864    29022    3           CALL VMD$DI_PROFILE (OUTDCB);

  29022 19 006103   000301 630400 20                 EPPR0   193
        19 006104   000024 631400 20                 EPPR1   20
        19 006105   000000 701000 xent               TSX1    VMD$DI_PROFILE
        19 006106   000000 011000                    NOP     0
        19 006107   016452 710000 19                 TRA     CONTINUE

     2865    29023        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:473  
     2866    29024        /* Display status command */
     2867    29025    3       CASE (%CMD_DISPLAY_STATUS);

     2868    29026    3           CALL NEED_FOLDER ALTRET(CONTINUE);

  29026 19 006110   016547 701000 19                 TSX1    NEED_FOLDER
        19 006111   016452 702000 19                 TSX2    CONTINUE

     2869    29027    3           IF OUT$ -> P$B.NSUBLKS > 0

  29027 19 006112   200023 470500                    LDP0    OUT$,,AUTO
        19 006113   000001 220100                    LDX0    1,,PR0
        19 006114   006142 600000 19                 TZE     s:29038

     2870    29028    4           THEN DO;

     2871    29029    4               CALL XUR$OPENOUT (M$OUT_NUM, OUT$ -> P$B.SUBLK$(0) -> P$B)

  29029 19 006115   000003 471500                    LDP1    3,,PR0
        19 006116   201707 451500                    STP1    I+101,,AUTO
        19 006117   000265 236000 20                 LDQ     181
        19 006120   201706 756100                    STQ     I+100,,AUTO
        19 006121   201706 630500                    EPPR0   I+100,,AUTO
        19 006122   000000 631400 20                 EPPR1   0
        19 006123   000000 701000 xent               TSX1    XUR$OPENOUT
        19 006124   006130 702000 19                 TSX2    s:29034

     2872    29030    5               WHENRETURN DO;

     2873    29031    5                   OUTDCB = M$OUT_NUM;

  29031 19 006125   000075 235000 12                 LDA     M$OUT_NUM
        19 006126   000402 755000 11                 STA     OUTDCB

     2874    29032    5               END;

  29032 19 006127   006142 710000 19                 TRA     s:29038
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:474  

     2875    29033    5               WHENALTRETURN DO;

     2876    29034    5                   CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);

  29034 19 006130   000265 236000 20                 LDQ     181
        19 006131   201707 756100                    STQ     I+101,,AUTO
        19 006132   200003 236100                    LDQ     XUG_GETCMD$,,AUTO
        19 006133   000001 036003                    ADLQ    1,DU
        19 006134   201706 756100                    STQ     I+100,,AUTO
        19 006135   201706 630500                    EPPR0   I+100,,AUTO
        19 006136   000000 631400 20                 EPPR1   0
        19 006137   000000 701000 xent               TSX1    XUR$ERRMSG
        19 006140   000000 011000                    NOP     0

     2877    29035    5                   GOTO CONTINUE;

  29035 19 006141   016452 710000 19                 TRA     CONTINUE

     2878    29036    5               END;
     2879    29037    4           END;

     2880    29038    3           F_FDSLO.DCB# = OUTDCB;

  29038 19 006142   000402 720000 11                 LXL0    OUTDCB
        19 006143   003053 740000 11                 STX0    F_FDSLO+11

     2881    29039    3           F_FDSLO.NVECS# = 0;

  29039 19 006144   003051 450000 11                 STZ     F_FDSLO+9

     2882    29040        /**/
     2883    29041    3           WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);

  29041 19 006145   777000 236003                    LDQ     -512,DU
        19 006146   000174 552040 11                 STBQ    WORK_STRING,'40'O

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:475  
     2884    29042    3           CALL VMF$MAKE_ADDRESS1 (WORK_STRING,VM_CURRENT_FOLDER);

  29042 19 006147   000051 630400 20                 EPPR0   41
        19 006150   000000 631400 20                 EPPR1   0
        19 006151   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS1
        19 006152   000000 011000                    NOP     0

     2885    29043    3           VECT_ARRAY(0) = VECTOR(SUBSTR(WORK_STRING.NAME#,0,

  29043 19 006153   000174 236000 11                 LDQ     WORK_STRING
        19 006154   000033 772000                    QRL     27
        19 006155   000064 737000                    LLS     52
        19 006156   000140 135007                    SBLA    96,DL
        19 006157   000317 236000 20                 LDQ     207
        19 006160   003076 757000 11                 STAQ    VECT_ARRAY

     2886    29044    3             WORK_STRING.L#));
     2887    29045                %INIT_STR (CODE=E_STATUS_FOLDER_FMT, STR=VM_STATUS_FOLDER_FMT,
     2888    29046                VECT="F_FDSLO.FMT_", TEST=YES);

  29053 19 006161   040000 106400                    CMPC    fill='040'O
        19 006162   004033 200120 11                 ADSC9   VM_STATUS_FOLDER_FMT     cn=1,n=80
        19 006163   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006164   006172 601000 19                 TNZ     s:29058

  29055 19 006165   000320 630400 20                 EPPR0   208
        19 006166   000021 631400 20                 EPPR1   17
        19 006167   000000 701000 xent               TSX1    VMD$ERRMSG
        19 006170   000000 011000                    NOP     0

  29056 19 006171   006200 710000 19                 TRA     s:29069

  29058 19 006172   004033 236000 11                 LDQ     VM_STATUS_FOLDER_FMT
        19 006173   000033 772000                    QRL     27
        19 006174   000064 737000                    LLS     52
        19 006175   000140 135007                    SBLA    96,DL
        19 006176   000323 236000 20                 LDQ     211
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:476  
        19 006177   003040 757000 11                 STAQ    F_FDSLO

     2889    29069    3           F_FDSLO.NVECS# = 1;

  29069 19 006200   000001 235007                    LDA     1,DL
        19 006201   003051 755000 11                 STA     F_FDSLO+9

     2890    29070    3           CALL VMD$WRITE_BUF (F_FDSLO);

  29070 19 006202   000322 630400 20                 EPPR0   210
        19 006203   000024 631400 20                 EPPR1   20
        19 006204   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 006205   000000 011000                    NOP     0

     2891    29071        /**/
     2892    29072    3           WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);

  29072 19 006206   777000 236003                    LDQ     -512,DU
        19 006207   000174 552040 11                 STBQ    WORK_STRING,'40'O

     2893    29073    3           CALL VMS$FMT_SELECT (CURRENT_CONTEXT%,WORK_STRING);

  29073 19 006210   000051 236000 20                 LDQ     41
        19 006211   001663 235000 11                 LDA     CONTEXT_PTR$
        19 006212   201706 757100                    STAQ    I+100,,AUTO
        19 006213   201706 630500                    EPPR0   I+100,,AUTO
        19 006214   000000 631400 20                 EPPR1   0
        19 006215   000000 701000 xent               TSX1    VMS$FMT_SELECT
        19 006216   000000 011000                    NOP     0

     2894    29074                %INIT_STR (CODE=E_STATUS_CCONTEXT_FMT, STR=VM_STATUS_CCONTEXT_FMT,
     2895    29075                VECT="F_FDSLO.FMT_", TEST=YES);

  29082 19 006217   040000 106400                    CMPC    fill='040'O
        19 006220   004105 200120 11                 ADSC9   VM_STATUS_CCONTEXT_FMT   cn=1,n=80
        19 006221   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006222   006230 601000 19                 TNZ     s:29087
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:477  

  29084 19 006223   000324 630400 20                 EPPR0   212
        19 006224   000021 631400 20                 EPPR1   17
        19 006225   000000 701000 xent               TSX1    VMD$ERRMSG
        19 006226   000000 011000                    NOP     0

  29085 19 006227   006236 710000 19                 TRA     s:29098

  29087 19 006230   004105 236000 11                 LDQ     VM_STATUS_CCONTEXT_FMT
        19 006231   000033 772000                    QRL     27
        19 006232   000064 737000                    LLS     52
        19 006233   000140 135007                    SBLA    96,DL
        19 006234   000327 236000 20                 LDQ     215
        19 006235   003040 757000 11                 STAQ    F_FDSLO

     2896    29098    3           VECT_ARRAY(0) = VECTOR(SUBSTR(WORK_STRING.NAME#,0,WORK_STRING.L#));

  29098 19 006236   000174 236000 11                 LDQ     WORK_STRING
        19 006237   000033 772000                    QRL     27
        19 006240   000064 737000                    LLS     52
        19 006241   000140 135007                    SBLA    96,DL
        19 006242   000317 236000 20                 LDQ     207
        19 006243   003076 757000 11                 STAQ    VECT_ARRAY

     2897    29099    3           CALL VMD$WRITE_BUF (F_FDSLO);

  29099 19 006244   000322 630400 20                 EPPR0   210
        19 006245   000024 631400 20                 EPPR1   20
        19 006246   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 006247   000000 011000                    NOP     0

     2898    29100        /**/
     2899    29101    3           WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);

  29101 19 006250   777000 236003                    LDQ     -512,DU
        19 006251   000174 552040 11                 STBQ    WORK_STRING,'40'O

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:478  
     2900    29102    3           CALL VMS$FMT_SELECT (SELECTED_CONTEXT%,WORK_STRING);

  29102 19 006252   000051 236000 20                 LDQ     41
        19 006253   001664 235000 11                 LDA     CONTEXT_PTR$+1
        19 006254   201706 757100                    STAQ    I+100,,AUTO
        19 006255   201706 630500                    EPPR0   I+100,,AUTO
        19 006256   000000 631400 20                 EPPR1   0
        19 006257   000000 701000 xent               TSX1    VMS$FMT_SELECT
        19 006260   000000 011000                    NOP     0

     2901    29103                %INIT_STR (CODE=E_STATUS_SCONTEXT_FMT, STR=VM_STATUS_SCONTEXT_FMT,
     2902    29104                VECT="F_FDSLO.FMT_", TEST=YES);

  29111 19 006261   040000 106400                    CMPC    fill='040'O
        19 006262   004060 200120 11                 ADSC9   VM_STATUS_SCONTEXT_FMT   cn=1,n=80
        19 006263   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006264   006272 601000 19                 TNZ     s:29116

  29113 19 006265   000330 630400 20                 EPPR0   216
        19 006266   000021 631400 20                 EPPR1   17
        19 006267   000000 701000 xent               TSX1    VMD$ERRMSG
        19 006270   000000 011000                    NOP     0

  29114 19 006271   006300 710000 19                 TRA     s:29127

  29116 19 006272   004060 236000 11                 LDQ     VM_STATUS_SCONTEXT_FMT
        19 006273   000033 772000                    QRL     27
        19 006274   000064 737000                    LLS     52
        19 006275   000140 135007                    SBLA    96,DL
        19 006276   000333 236000 20                 LDQ     219
        19 006277   003040 757000 11                 STAQ    F_FDSLO

     2903    29127    3           VECT_ARRAY(0) = VECTOR(SUBSTR(WORK_STRING.NAME#,0,WORK_STRING.L#));

  29127 19 006300   000174 236000 11                 LDQ     WORK_STRING
        19 006301   000033 772000                    QRL     27
        19 006302   000064 737000                    LLS     52
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:479  
        19 006303   000140 135007                    SBLA    96,DL
        19 006304   000317 236000 20                 LDQ     207
        19 006305   003076 757000 11                 STAQ    VECT_ARRAY

     2904    29128    3           CALL VMD$WRITE_BUF (F_FDSLO);

  29128 19 006306   000322 630400 20                 EPPR0   210
        19 006307   000024 631400 20                 EPPR1   20
        19 006310   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 006311   000000 011000                    NOP     0

     2905    29129        /**/
     2906    29130    3           IF SELECTED_CONTEXT%.MESSAGE_POINTER = -1

  29130 19 006312   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 006313   000000 235100                    LDA     0,,PR0
        19 006314   000334 115000 20                 CMPA    220
        19 006315   006337 601000 19                 TNZ     s:29161

     2907    29131    3           THEN
     2908    29132    4           DO;

     2909    29133                    %INIT_STR (CODE=E_STATUS_POSITION_OUTSIDE_FMT, STR=
             29133                        VM_STATUS_POSITION_OUTSIDE_FMT,
     2910    29134                    VECT="F_FDSLO.FMT_", TEST=YES);

  29141 19 006316   040000 106400                    CMPC    fill='040'O
        19 006317   004157 200120 11                 ADSC9   VM_STATUS_POSITION_OUTSIDE_FMT cn=1,n=80
        19 006320   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006321   006327 601000 19                 TNZ     s:29146

  29143 19 006322   000335 630400 20                 EPPR0   221
        19 006323   000021 631400 20                 EPPR1   17
        19 006324   000000 701000 xent               TSX1    VMD$ERRMSG
        19 006325   000000 011000                    NOP     0

  29144 19 006326   006335 710000 19                 TRA     s:29157
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:480  

  29146 19 006327   004157 236000 11                 LDQ     VM_STATUS_POSITION_OUTSIDE_FMT
        19 006330   000033 772000                    QRL     27
        19 006331   000064 737000                    LLS     52
        19 006332   000140 135007                    SBLA    96,DL
        19 006333   000340 236000 20                 LDQ     224
        19 006334   003040 757000 11                 STAQ    F_FDSLO

     2911    29157    4               F_FDSLO.NVECS# = 0;

  29157 19 006335   003051 450000 11                 STZ     F_FDSLO+9

     2912    29158    4           END;

  29158 19 006336   006363 710000 19                 TRA     s:29188

     2913    29159    3           ELSE
     2914    29160    4           DO;

     2915    29161    4               VECT_ARRAY(0) = VECTOR(SELECTED_CONTEXT%.MESSAGE_POINTER);

  29161 19 006337   777640 235007                    LDA     -96,DL
        19 006340   001664 236000 11                 LDQ     CONTEXT_PTR$+1
        19 006341   003076 757000 11                 STAQ    VECT_ARRAY

     2916    29162                    %INIT_STR (CODE=E_STATUS_POSITION_FMT, STR=VM_STATUS_POSITION_FMT,
     2917    29163                    VECT="F_FDSLO.FMT_", TEST=YES);

  29170 19 006342   040000 106400                    CMPC    fill='040'O
        19 006343   004132 200120 11                 ADSC9   VM_STATUS_POSITION_FMT   cn=1,n=80
        19 006344   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006345   006353 601000 19                 TNZ     s:29175

  29172 19 006346   000341 630400 20                 EPPR0   225
        19 006347   000021 631400 20                 EPPR1   17
        19 006350   000000 701000 xent               TSX1    VMD$ERRMSG
        19 006351   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:481  

  29173 19 006352   006361 710000 19                 TRA     s:29186

  29175 19 006353   004132 236000 11                 LDQ     VM_STATUS_POSITION_FMT
        19 006354   000033 772000                    QRL     27
        19 006355   000064 737000                    LLS     52
        19 006356   000140 135007                    SBLA    96,DL
        19 006357   000344 236000 20                 LDQ     228
        19 006360   003040 757000 11                 STAQ    F_FDSLO

     2918    29186    4               F_FDSLO.NVECS# = 1;

  29186 19 006361   000001 235007                    LDA     1,DL
        19 006362   003051 755000 11                 STA     F_FDSLO+9

     2919    29187    4           END;

     2920    29188    3           CALL VMD$WRITE_BUF (F_FDSLO);

  29188 19 006363   000322 630400 20                 EPPR0   210
        19 006364   000024 631400 20                 EPPR1   20
        19 006365   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 006366   000000 011000                    NOP     0

     2921    29189        /**/
     2922    29190    3           F_FDSLO.NVECS# = 1;

  29190 19 006367   000001 235007                    LDA     1,DL
        19 006370   003051 755000 11                 STA     F_FDSLO+9

     2923    29191                %INIT_STR (CODE=E_STATUS_DMSGS_FMT, STR=VM_STATUS_DMSGS_FMT,
     2924    29192                VECT="F_FDSLO.FMT_", TEST=YES);

  29199 19 006371   040000 106400                    CMPC    fill='040'O
        19 006372   004204 200120 11                 ADSC9   VM_STATUS_DMSGS_FMT      cn=1,n=80
        19 006373   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006374   006402 601000 19                 TNZ     s:29204
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:482  

  29201 19 006375   000345 630400 20                 EPPR0   229
        19 006376   000021 631400 20                 EPPR1   17
        19 006377   000000 701000 xent               TSX1    VMD$ERRMSG
        19 006400   000000 011000                    NOP     0

  29202 19 006401   006410 710000 19                 TRA     s:29215

  29204 19 006402   004204 236000 11                 LDQ     VM_STATUS_DMSGS_FMT
        19 006403   000033 772000                    QRL     27
        19 006404   000064 737000                    LLS     52
        19 006405   000140 135007                    SBLA    96,DL
        19 006406   000350 236000 20                 LDQ     232
        19 006407   003040 757000 11                 STAQ    F_FDSLO

     2925    29215    3           VECT_ARRAY(0) = VECTOR(VM_PROFILE.NUM_DEL_MESSAGES);

  29215 19 006410   777640 235007                    LDA     -96,DL
        19 006411   000000 236000 xsym               LDQ     VM_PROFILE$
        19 006412   000007 036003                    ADLQ    7,DU
        19 006413   003076 757000 11                 STAQ    VECT_ARRAY

     2926    29216    3           CALL VMD$WRITE_BUF (F_FDSLO);

  29216 19 006414   000322 630400 20                 EPPR0   210
        19 006415   000024 631400 20                 EPPR1   20
        19 006416   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 006417   000000 011000                    NOP     0

     2927    29217        /**/
     2928    29218                %INIT_STR (CODE=E_STATUS_NMSGS_FMT, STR=VM_STATUS_NMSGS_FMT,
     2929    29219                VECT="F_FDSLO.FMT_", TEST=YES);

  29226 19 006420   040000 106400                    CMPC    fill='040'O
        19 006421   004231 200120 11                 ADSC9   VM_STATUS_NMSGS_FMT      cn=1,n=80
        19 006422   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006423   006431 601000 19                 TNZ     s:29231
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:483  

  29228 19 006424   000351 630400 20                 EPPR0   233
        19 006425   000021 631400 20                 EPPR1   17
        19 006426   000000 701000 xent               TSX1    VMD$ERRMSG
        19 006427   000000 011000                    NOP     0

  29229 19 006430   006437 710000 19                 TRA     s:29242

  29231 19 006431   004231 236000 11                 LDQ     VM_STATUS_NMSGS_FMT
        19 006432   000033 772000                    QRL     27
        19 006433   000064 737000                    LLS     52
        19 006434   000140 135007                    SBLA    96,DL
        19 006435   000354 236000 20                 LDQ     236
        19 006436   003040 757000 11                 STAQ    F_FDSLO

     2930    29242    3           VECT_ARRAY(0) = VECTOR(VM_PROFILE.NUM_NEW_MESSAGES);

  29242 19 006437   777640 235007                    LDA     -96,DL
        19 006440   000000 236000 xsym               LDQ     VM_PROFILE$
        19 006441   000006 036003                    ADLQ    6,DU
        19 006442   003076 757000 11                 STAQ    VECT_ARRAY

     2931    29243    3           CALL VMD$WRITE_BUF (F_FDSLO);

  29243 19 006443   000322 630400 20                 EPPR0   210
        19 006444   000024 631400 20                 EPPR1   20
        19 006445   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 006446   000000 011000                    NOP     0

     2932    29244        /**/
     2933    29245                %INIT_STR (CODE=E_STATUS_TMSGS_FMT, STR=VM_STATUS_TMSGS_FMT,
     2934    29246                VECT="F_FDSLO.FMT_", TEST=YES);

  29253 19 006447   040000 106400                    CMPC    fill='040'O
        19 006450   004256 200120 11                 ADSC9   VM_STATUS_TMSGS_FMT      cn=1,n=80
        19 006451   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006452   006460 601000 19                 TNZ     s:29258
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:484  

  29255 19 006453   000355 630400 20                 EPPR0   237
        19 006454   000021 631400 20                 EPPR1   17
        19 006455   000000 701000 xent               TSX1    VMD$ERRMSG
        19 006456   000000 011000                    NOP     0

  29256 19 006457   006466 710000 19                 TRA     s:29269

  29258 19 006460   004256 236000 11                 LDQ     VM_STATUS_TMSGS_FMT
        19 006461   000033 772000                    QRL     27
        19 006462   000064 737000                    LLS     52
        19 006463   000140 135007                    SBLA    96,DL
        19 006464   000360 236000 20                 LDQ     240
        19 006465   003040 757000 11                 STAQ    F_FDSLO

     2935    29269    3           VECT_ARRAY(0) = VECTOR(VM_PROFILE.NUM_MESSAGES);

  29269 19 006466   777640 235007                    LDA     -96,DL
        19 006467   000000 236000 xsym               LDQ     VM_PROFILE$
        19 006470   000005 036003                    ADLQ    5,DU
        19 006471   003076 757000 11                 STAQ    VECT_ARRAY

     2936    29270    3           CALL VMD$WRITE_BUF (F_FDSLO);

  29270 19 006472   000322 630400 20                 EPPR0   210
        19 006473   000024 631400 20                 EPPR1   20
        19 006474   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 006475   000000 011000                    NOP     0

     2937    29271        /**/
     2938    29272                %INIT_STR (CODE=E_STATUS_HMSGS_FMT, STR=VM_STATUS_HMSGS_FMT,
     2939    29273                VECT="F_FDSLO.FMT_", TEST=YES);

  29280 19 006476   040000 106400                    CMPC    fill='040'O
        19 006477   004303 200120 11                 ADSC9   VM_STATUS_HMSGS_FMT      cn=1,n=80
        19 006500   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006501   006507 601000 19                 TNZ     s:29285
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:485  

  29282 19 006502   000361 630400 20                 EPPR0   241
        19 006503   000021 631400 20                 EPPR1   17
        19 006504   000000 701000 xent               TSX1    VMD$ERRMSG
        19 006505   000000 011000                    NOP     0

  29283 19 006506   006515 710000 19                 TRA     s:29296

  29285 19 006507   004303 236000 11                 LDQ     VM_STATUS_HMSGS_FMT
        19 006510   000033 772000                    QRL     27
        19 006511   000064 737000                    LLS     52
        19 006512   000140 135007                    SBLA    96,DL
        19 006513   000364 236000 20                 LDQ     244
        19 006514   003040 757000 11                 STAQ    F_FDSLO

     2940    29296    3           VECT_ARRAY(0) = VECTOR(VM_PROFILE.HI_MESSAGE_NUMBER);

  29296 19 006515   777640 235007                    LDA     -96,DL
        19 006516   000000 236000 xsym               LDQ     VM_PROFILE$
        19 006517   000011 036003                    ADLQ    9,DU
        19 006520   003076 757000 11                 STAQ    VECT_ARRAY

     2941    29297    3           CALL VMD$WRITE_BUF (F_FDSLO);

  29297 19 006521   000322 630400 20                 EPPR0   210
        19 006522   000024 631400 20                 EPPR1   20
        19 006523   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 006524   000000 011000                    NOP     0
        19 006525   016452 710000 19                 TRA     CONTINUE

     2942    29298        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:486  
     2943    29299        /* Display user command */
     2944    29300    3       CASE (%CMD_DISPLAY_USER);

     2945    29301    3           INDX2 = 0;                  /* Used as counter */

  29301 19 006526   000375 450000 11                 STZ     INDX2

     2946    29302    3           IF OUT$ -> P$B.NSUBLKS = 0

  29302 19 006527   200023 474500                    LDP4    OUT$,,AUTO
        19 006530   400001 220100                    LDX0    1,,PR4
        19 006531   006547 601000 19                 TNZ     s:29317

     2947    29303    4           THEN DO;    /* Display all user definitions */

     2948    29304    4   DI_USER_ALL:
     2949    29305    4               VM_USERKEY.TEXT = ' ';

  29305 19 006532   040000 100400       DI_USER_ALL  MLR     fill='040'O
        19 006533   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006534   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200

     2950    29306    5               DO FOREVER;

     2951    29307    5                   CALL VMA$GET_LIST_NEXT (VM_USERKEY,VM_ADDLIST$,

  29307 19 006535   000365 630400 20                 EPPR0   245
        19 006536   000021 631400 20                 EPPR1   17
        19 006537   000000 701000 xent               TSX1    VMA$GET_LIST_NEXT
        19 006540   006763 702000 19                 TSX2    END_DI_USER

     2952    29308    5                     M$MAIL_GLOBAL_NUM) ALTRET(END_DI_USER);
     2953    29309    5                   CALL VMD$DI_USER (VM_USERKEY,OUTDCB);

  29309 19 006541   000370 630400 20                 EPPR0   248
        19 006542   000000 631400 20                 EPPR1   0
        19 006543   000000 701000 xent               TSX1    VMD$DI_USER
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:487  
        19 006544   000000 011000                    NOP     0

     2954    29310    5                   INDX2 = INDX2 + 1;

  29310 19 006545   000375 054000 11                 AOS     INDX2

     2955    29311    5               END;

  29311 19 006546   006535 710000 19                 TRA     s:29307

     2956    29312    4           END;
     2957    29313    4           ELSE DO;

     2958    29314        /*
     2959    29315                ***** Handle output clause, if any ...
     2960    29316        */
     2961    29317    4               BLK$ = OUT$ -> P$B.SUBLK$ (OUT$ -> P$B.NSUBLKS - 1);

  29317 19 006547   400002 236110                    LDQ     2,X0,PR4
        19 006550   200024 756100                    STQ     BLK$,,AUTO

     2962    29318    4               IF BLK$ -> P$B.CODE = %OPT_OUTPUT

  29318 19 006551   200024 475500                    LDP5    BLK$,,AUTO
        19 006552   500000 720100                    LXL0    0,,PR5
        19 006553   000005 100003                    CMPX0   5,DU
        19 006554   006604 601000 19                 TNZ     s:29335

     2963    29319    5               THEN DO;

     2964    29320    5                   CALL XUR$OPENOUT (M$OUT_NUM, BLK$ -> P$B)

  29320 19 006555   000265 235000 20                 LDA     181
        19 006556   201706 757100                    STAQ    I+100,,AUTO
        19 006557   201706 630500                    EPPR0   I+100,,AUTO
        19 006560   000000 631400 20                 EPPR1   0
        19 006561   000000 701000 xent               TSX1    XUR$OPENOUT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:488  
        19 006562   006566 702000 19                 TSX2    s:29325

     2965    29321    6                   WHENRETURN DO;

     2966    29322    6                       OUTDCB = M$OUT_NUM;

  29322 19 006563   000075 235000 12                 LDA     M$OUT_NUM
        19 006564   000402 755000 11                 STA     OUTDCB

     2967    29323    6                   END;

  29323 19 006565   006600 710000 19                 TRA     s:29328

     2968    29324    6                   WHENALTRETURN DO;

     2969    29325    6                       CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);

  29325 19 006566   000265 236000 20                 LDQ     181
        19 006567   201707 756100                    STQ     I+101,,AUTO
        19 006570   200003 236100                    LDQ     XUG_GETCMD$,,AUTO
        19 006571   000001 036003                    ADLQ    1,DU
        19 006572   201706 756100                    STQ     I+100,,AUTO
        19 006573   201706 630500                    EPPR0   I+100,,AUTO
        19 006574   000000 631400 20                 EPPR1   0
        19 006575   000000 701000 xent               TSX1    XUR$ERRMSG
        19 006576   000000 011000                    NOP     0

     2970    29326    6                       GOTO CONTINUE;

  29326 19 006577   016452 710000 19                 TRA     CONTINUE

     2971    29327    6                   END;
     2972    29328    5                   IF OUT$ -> P$B.NSUBLKS = 1

  29328 19 006600   200023 470500                    LDP0    OUT$,,AUTO
        19 006601   000001 220100                    LDX0    1,,PR0
        19 006602   000001 100003                    CMPX0   1,DU
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:489  
        19 006603   006532 600000 19                 TZE     DI_USER_ALL

     2973    29329    5                   THEN            /* No name specified */
     2974    29330    5                       GOTO DI_USER_ALL;
     2975    29331    5               END;

     2976    29332        /*
     2977    29333                ***** Handle wildcarded name ...
     2978    29334        */
     2979    29335    4               CALL INDEX(INDX1,'?',OUT$->P$B.SUBLK$(0)->P$S.TEXT) ALTRET(

  29335 19 006604   200023 470500                    LDP0    OUT$,,AUTO
        19 006605   000003 471500                    LDP1    3,,PR0
        19 006606   100004 236100                    LDQ     4,,PR1
        19 006607   000033 772000                    QRL     27
        19 006610   000000 620006                    EAX0    0,QL
        19 006611   000000 124540                    SCM     mask='000'O
        19 006612   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 006613   000225 000001 20                 ADSC9   149                      cn=0,n=1
        19 006614   200033 000100                    ARG     INDX1,,AUTO
        19 006615   006742 606400 19                 TTN     NON_WILD_DI_USER

     2980    29336    4                 NON_WILD_DI_USER);
     2981    29337    4               VM_WILDCARD.PATTERN_ = VECTOR(OUT$->P$B.SUBLK$(0)->P$S.TEXT);

  29337 19 006616   000003 471500                    LDP1    3,,PR0
        19 006617   100004 236100                    LDQ     4,,PR1
        19 006620   000033 772000                    QRL     27
        19 006621   000064 737000                    LLS     52
        19 006622   000140 135007                    SBLA    96,DL
        19 006623   201706 451500                    STP1    I+100,,AUTO
        19 006624   201706 236100                    LDQ     I+100,,AUTO
        19 006625   000215 036000 20                 ADLQ    141
        19 006626   001634 757000 11                 STAQ    VM_WILDCARD

     2982    29338    4               CALL XLATE(OUT$->P$B.SUBLK$(0)->P$S.TEXT, LOWER_UPPER,

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:490  
  29338 19 006627   000003 471500                    LDP1    3,,PR0
        19 006630   100004 236100                    LDQ     4,,PR1
        19 006631   000033 772000                    QRL     27
        19 006632   000000 620006                    EAX0    0,QL
        19 006633   000000 473400 xsym               LDP3    B$XL_UPPER$
        19 006634   000000 621006                    EAX1    0,QL
        19 006635   040140 160540                    MVT     fill='040'O
        19 006636   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 006637   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        19 006640   300000 000100                    ARG     0,,PR3

     2983    29339    4                 OUT$->P$B.SUBLK$(0)->P$S.TEXT);
     2984    29340    4               IF INDX1 = 0

  29340 19 006641   200033 235100                    LDA     INDX1,,AUTO
        19 006642   006647 601000 19                 TNZ     s:29344

     2985    29341    4               THEN
     2986    29342    4                   VM_USERKEY.TEXT = ' '; /* Start at first entry */

  29342 19 006643   040000 100400                    MLR     fill='040'O
        19 006644   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006645   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200
        19 006646   006677 710000 19                 TRA     s:29349

     2987    29343    5               ELSE DO;

     2988    29344    5                   VM_USERKEY.TEXT = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;

  29344 19 006647   200023 470500                    LDP0    OUT$,,AUTO
        19 006650   000003 471500                    LDP1    3,,PR0
        19 006651   100004 236100                    LDQ     4,,PR1
        19 006652   000033 772000                    QRL     27
        19 006653   000000 620006                    EAX0    0,QL
        19 006654   040000 100540                    MLR     fill='040'O
        19 006655   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 006656   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:491  

     2989    29345    5                   SUBSTR (VM_USERKEY.TEXT, INDX1) = ' ';

  29345 19 006657   777467 620005                    EAX0    -201,AL
        19 006660   777777 660003                    ERX0    -1,DU
        19 006661   040045 100400                    MLR     fill='040'O
        19 006662   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 006663   000722 400010 11                 ADSC9   VM_USERKEY,A             cn=2,n=*X0

     2990    29346    5                   SUBSTR (VM_USERKEY.TEXT, INDX1-1, 1) = BINASC(ASCBIN(SUBSTR(
             29346                            VM_USERKEY.TEXT, INDX1-1, 1)) - 1);

  29346 19 006664   000100 101405                    MRL     fill='000'O
        19 006665   000722 200001 11                 ADSC9   VM_USERKEY,A             cn=1,n=1
        19 006666   201706 000004                    ADSC9   I+100,,AUTO              cn=0,n=4
        19 006667   201706 236100                    LDQ     I+100,,AUTO
        19 006670   000001 136007                    SBLQ    1,DL
        19 006671   000033 736000                    QLS     27
        19 006672   000302 276000 20                 ORQ     194
        19 006673   201707 756100                    STQ     I+101,,AUTO
        19 006674   040005 100500                    MLR     fill='040'O
        19 006675   201707 000004                    ADSC9   I+101,,AUTO              cn=0,n=4
        19 006676   000722 200001 11                 ADSC9   VM_USERKEY,A             cn=1,n=1

     2991    29347    5               END;

     2992    29348    5               DO FOREVER;

     2993    29349    5                   CALL VMA$GET_LIST_NEXT (VM_USERKEY,VM_ADDLIST$,

  29349 19 006677   000365 630400 20                 EPPR0   245
        19 006700   000021 631400 20                 EPPR1   17
        19 006701   000000 701000 xent               TSX1    VMA$GET_LIST_NEXT
        19 006702   006763 702000 19                 TSX2    END_DI_USER

     2994    29350    5                     M$MAIL_GLOBAL_NUM) ALTRET(END_DI_USER);
     2995    29351    5                   IF INDX1 > 0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:492  

  29351 19 006703   200033 235100                    LDA     INDX1,,AUTO
        19 006704   006717 604400 19                 TMOZ    s:29355
        19 006705   200023 470500                    LDP0    OUT$,,AUTO
        19 006706   000003 471500                    LDP1    3,,PR0
        19 006707   100004 236100                    LDQ     4,,PR1
        19 006710   000033 772000                    QRL     27
        19 006711   000000 620005                    EAX0    0,AL
        19 006712   200033 721100                    LXL1    INDX1,,AUTO
        19 006713   040040 106540                    CMPC    fill='040'O
        19 006714   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 006715   000722 400011 11                 ADSC9   VM_USERKEY               cn=2,n=*X1
        19 006716   006741 602000 19                 TNC     s:29365

     2996    29352    5                    AND SUBSTR(VM_USERKEY.TEXT, 0, INDX1) > SUBSTR(OUT$ -> P$B.SUBLK$(
             29352                              0) -> P$S.TEXT, 0, INDX1)
     2997    29353    5                   THEN
     2998    29354    5                       EXIT;
     2999    29355    5                   VM_WILDCARD.INPUT_ = VECTOR(SUBSTR(VM_USERKEY.TEXT,0,

  29355 19 006717   000722 236000 11                 LDQ     VM_USERKEY
        19 006720   000033 772000                    QRL     27
        19 006721   777777 620006                    EAX0    -1,QL
        19 006722   000000 635010                    EAA     0,X0
        19 006723   000002 771000                    ARL     2
        19 006724   000140 135007                    SBLA    96,DL
        19 006725   000244 236000 20                 LDQ     164
        19 006726   001636 757000 11                 STAQ    VM_WILDCARD+2

     3000    29356    5                     VM_USERKEY.COUNT-1)); /* One less for type */
     3001    29357    5                   CALL X$WILDCMP (VM_WILDCARD) ALTRET(NO_MATCH_DI_USER);

  29357 19 006727   000237 630400 20                 EPPR0   159
        19 006730   000024 631400 20                 EPPR1   20
        19 006731   000000 701000 xent               TSX1    X$WILDCMP
        19 006732   006740 702000 19                 TSX2    NO_MATCH_DI_USER

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:493  
     3002    29358    5                   CALL VMD$DI_USER (VM_USERKEY,OUTDCB);

  29358 19 006733   000370 630400 20                 EPPR0   248
        19 006734   000000 631400 20                 EPPR1   0
        19 006735   000000 701000 xent               TSX1    VMD$DI_USER
        19 006736   000000 011000                    NOP     0

     3003    29359    5                   INDX2 = INDX2 + 1;

  29359 19 006737   000375 054000 11                 AOS     INDX2

     3004    29360    5   NO_MATCH_DI_USER:
     3005    29361    5               END;             /* Do forever ... end */

  29361 19 006740   006677 710000 19    NO_MATCH_DI* TRA     s:29349

     3006    29362        /*
     3007    29363             ***** Handle non-wild case ...
     3008    29364        */
     3009    29365    5               DO NEVER;

  29365 19 006741   006763 710000 19                 TRA     END_DI_USER

     3010    29366    5   NON_WILD_DI_USER:
     3011    29367    5                   VM_USERKEY.TEXT = OUT$->P$B.SUBLK$(0)->P$S.TEXT;

  29367 19 006742   200023 470500       NON_WILD_DI* LDP0    OUT$,,AUTO
        19 006743   000003 471500                    LDP1    3,,PR0
        19 006744   100004 236100                    LDQ     4,,PR1
        19 006745   000033 772000                    QRL     27
        19 006746   000000 620006                    EAX0    0,QL
        19 006747   040000 100540                    MLR     fill='040'O
        19 006750   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 006751   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200

     3012    29368    5                   CALL VMA$GET_LIST (VM_USERKEY,VM_ADDLIST$,

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:494  
  29368 19 006752   000365 630400 20                 EPPR0   245
        19 006753   000021 631400 20                 EPPR1   17
        19 006754   000000 701000 xent               TSX1    VMA$GET_LIST
        19 006755   006763 702000 19                 TSX2    END_DI_USER

     3013    29369    5                     M$MAIL_GLOBAL_NUM) ALTRET(END_DI_USER);
     3014    29370    5                   CALL VMD$DI_USER (VM_USERKEY,OUTDCB);

  29370 19 006756   000370 630400 20                 EPPR0   248
        19 006757   000000 631400 20                 EPPR1   0
        19 006760   000000 701000 xent               TSX1    VMD$DI_USER
        19 006761   000000 011000                    NOP     0

     3015    29371    5                   INDX2 = INDX2 + 1;

  29371 19 006762   000375 054000 11                 AOS     INDX2

     3016    29372    5               END;             /* Do never ... end */

     3017    29373    4           END;

  29373 19 006763                       END_DI_USER  null
     3018    29374    3   END_DI_USER: ;
     3019    29375    3           IF INDX2 ~= 1 OR NOT DCBADDR(OUTDCB) -> F$DCB.DDEV.UCOUT#

  29375 19 006763   000375 235000 11                 LDA     INDX2
        19 006764   000001 115007                    CMPA    1,DL
        19 006765   006775 601000 19                 TNZ     s:29377
        19 006766   000074 470400 20                 LDP0    60
        19 006767   000000 471500                    LDP1    0,,PR0
        19 006770   000402 720000 11                 LXL0    OUTDCB
        19 006771   100000 473510                    LDP3    0,X0,PR1
        19 006772   300004 236100                    LDQ     4,,PR3
        19 006773   020000 316007                    CANQ    8192,DL
        19 006774   016452 601000 19                 TNZ     CONTINUE

     3020    29376    3           THEN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:495  
     3021    29377    3               CALL REPORT_ACTIVITY (INDX2,VM_USERS_DISPLAYED_FMT,%NO#,
             29377                        E_USERS_DISPLAYED_FMT);

  29377 19 006775   000372 236000 20                 LDQ     250
        19 006776   201122 756100                    STQ     @NAME+1,,AUTO
        19 006777   000374 237000 20                 LDAQ    252
        19 007000   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 007001   000154 236000 20                 LDQ     108
        19 007002   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 007003   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 007004   000000 011000                    NOP     0
        19 007005   016452 710000 19                 TRA     CONTINUE

     3022    29378        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:496  
     3023    29379    3       CASE (%CMD_END);

     3024    29380    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN

  29380 19 007006   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 007007   010000 316003                    CANQ    4096,DU
        19 007010   007055 600000 19                 TZE     s:29398

     3025    29381    3           THEN
     3026    29382    4           DO;

     3027    29383    4               IF OUT$ -> P$B.NSUBLKS = 0

  29383 19 007011   200023 474500                    LDP4    OUT$,,AUTO
        19 007012   400001 220100                    LDX0    1,,PR4
        19 007013   007023 601000 19                 TNZ     s:29386

     3028    29384    4               THEN            /* Noupdate not specified */
     3029    29385    4                   CALL UPDATE$MAIL (VM_PROFILE.OPT.RENUMBER);

  29385 19 007014   000022 236000 20                 LDQ     18
        19 007015   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 007016   000000 236000 xsym               LDQ     VM_PROFILE$
        19 007017   630000 036007                    ADLQ    -53248,DL
        19 007020   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 007021   021446 701000 19                 TSX1    UPDATE$MAIL
        19 007022   000000 011000                    NOP     0

     3030    29386    4               IF VM_CURRENT_FOLDER.FLAGS.UPDATE

  29386 19 007023   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 007024   007046 605000 19                 TPL     s:29394

     3031    29387    4               THEN            /* Ok to write profile */
     3032    29388    4                   CALL PUT_PROFILE (M$MAIL_FILE_NUM)

  29388 19 007025   000053 236000 20                 LDQ     43
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:497  
        19 007026   201523 756100                    STQ     INDX2+255,,AUTO
        19 007027   021320 701000 19                 TSX1    PUT_PROFILE
        19 007030   007032 702000 19                 TSX2    s:29390
        19 007031   007046 710000 19                 TRA     s:29394

     3033    29389    5                   WHENALTRETURN DO;

     3034    29390    5                       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  29390 19 007032   000000 470400 xsym               LDP0    B$TCB$
        19 007033   000000 471500                    LDP1    0,,PR0
        19 007034   100102 236100                    LDQ     66,,PR1
        19 007035   002204 756000 11                 STQ     ERROR

     3035    29391    5                       CALL XUR$ERRMSG(E_WERR);

  29391 19 007036   000376 630400 20                 EPPR0   254
        19 007037   000024 631400 20                 EPPR1   20
        19 007040   000000 701000 xent               TSX1    XUR$ERRMSG
        19 007041   000000 011000                    NOP     0

     3036    29392    5                       CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);

  29392 19 007042   000377 630400 20                 EPPR0   255
        19 007043   000000 631400 20                 EPPR1   0
        19 007044   000000 701000 xent               TSX1    XUR$ERRMSG
        19 007045   000000 011000                    NOP     0

     3037    29393    5                   END;

     3038    29394    4               CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;

  29394 19 007046   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 007047   002142 740000 11                 STX0    CLOSE_SAVE+26

     3039    29395    4               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:498  
  29395 19 007050   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 007051   450001 713400                    CLIMB   alt,close
        19 007052   406000 401760                    pmme    nvectors=13
        19 007053   016514 702000 19                 TSX2    E_PMME

     3040    29396    4               VM_CURRENT_FOLDER.FLAGS = %NO#;

  29396 19 007054   001266 450000 11                 STZ     VM_CURRENT_FOLDER+19

     3041    29397    4           END;

     3042    29398    3           CALL M$EXIT;

  29398 19 007055   000001 713400                    CLIMB   exit
        19 007056   000000 401760                    pmme    nvectors=0
        19 007057   016452 710000 19                 TRA     CONTINUE

     3043    29399        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:499  
     3044    29400        /* First message command */
     3045    29401    3       CASE(%CMD_FIRST_MESSAGE);

     3046    29402    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE

  29402 19 007060   000544 235000 11                 LDA     LAST_COMMAND_CODE
        19 007061   000016 115007                    CMPA    14,DL
        19 007062   007077 601000 19                 TNZ     s:29437

     3047    29403    3           THEN
     3048    29404                    %INIT_STR (CODE=E_DI_FIRST_CMD, STR=VM_DI_FIRST_CMD,
     3049    29405                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  29412 19 007063   040000 106400                    CMPC    fill='040'O
        19 007064   004636 200017 11                 ADSC9   VM_DI_FIRST_CMD          cn=1,n=15
        19 007065   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 007066   007073 601000 19                 TNZ     s:29423

  29414 19 007067   000401 630400 20                 EPPR0   257
        19 007070   000000 631400 20                 EPPR1   0
        19 007071   000000 701000 xent               TSX1    VMD$ERRMSG
        19 007072   000000 011000                    NOP     0

  29423 19 007073   000100 100400                    MLR     fill='000'O
        19 007074   004636 000020 11                 ADSC9   VM_DI_FIRST_CMD          cn=0,n=16
        19 007075   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  29425 19 007076   007112 710000 19                 TRA     s:29453

     3050    29428    3           ELSE
     3051    29429                  %INIT_STR (CODE=E_LIST_FIRST_CMD, STR=VM_LIST_FIRST_CMD,
     3052    29430                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  29437 19 007077   040000 106400                    CMPC    fill='040'O
        19 007100   004642 200017 11                 ADSC9   VM_LIST_FIRST_CMD        cn=1,n=15
        19 007101   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 007102   007107 601000 19                 TNZ     s:29448
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:500  

  29439 19 007103   000403 630400 20                 EPPR0   259
        19 007104   000000 631400 20                 EPPR1   0
        19 007105   000000 701000 xent               TSX1    VMD$ERRMSG
        19 007106   000000 011000                    NOP     0

  29448 19 007107   000100 100400                    MLR     fill='000'O
        19 007110   004642 000020 11                 ADSC9   VM_LIST_FIRST_CMD        cn=0,n=16
        19 007111   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

     3053    29453    3           NEXT_COMMAND_TEXT.L# = LENGTHC('DI FIRST');

  29453 19 007112   010000 236003                    LDQ     4096,DU
        19 007113   200551 552140                    STBQ    NEXT_COMMAND_TEXT,'40'O,AUTO
        19 007114   016452 710000 19                 TRA     CONTINUE

     3054    29454        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:501  
     3055    29455        /* Forward command */
     3056    29456    3       CASE (%CMD_FORWARD_MESSAGE);

     3057    29457    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  29457 19 007115   016562 701000 19                 TSX1    NEED_UPDATE
        19 007116   016452 702000 19                 TSX2    CONTINUE

     3058    29458    3           OPT_SEED = 0;

  29458 19 007117   001710 450000 11                 STZ     OPT_SEED

     3059    29459    3           OPT_SEED$ = ADDR(OPT_SEED);

  29459 19 007120   000306 236000 20                 LDQ     198
        19 007121   201112 756100                    STQ     OPT_SEED$,,AUTO

     3060    29460    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;

  29460 19 007122   200033 450100                    STZ     INDX1,,AUTO
        19 007123   007164 710000 19                 TRA     s:29471+1

     3061    29461    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);

  29461 19 007124   200023 470500                    LDP0    OUT$,,AUTO
        19 007125   200033 720100                    LXL0    INDX1,,AUTO
        19 007126   000003 236110                    LDQ     3,X0,PR0
        19 007127   200024 756100                    STQ     BLK$,,AUTO

     3062    29462    5               DO CASE (BLK$ -> P$B.CODE);

  29462 19 007130   200024 471500                    LDP1    BLK$,,AUTO
        19 007131   100000 721100                    LXL1    0,,PR1
        19 007132   000003 101003                    CMPX1   3,DU
        19 007133   007135 602011 19                 TNC     s:29462+5,X1
        19 007134   007163 710000 19                 TRA     s:29471
        19 007135   007163 710000 19                 TRA     s:29471
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:502  
        19 007136   007140 710000 19                 TRA     s:29464
        19 007137   007155 710000 19                 TRA     s:29469

     3063    29463    5               CASE (%OPT_CRPT);

     3064    29464    5                   CALL VMX$OCTBIN (BLK$->P$B.SUBLK$(0)->P$S,OPT_SEED);

  29464 19 007140   100003 473500                    LDP3    3,,PR1
        19 007141   000306 236000 20                 LDQ     198
        19 007142   201707 756100                    STQ     I+101,,AUTO
        19 007143   201706 453500                    STP3    I+100,,AUTO
        19 007144   201706 630500                    EPPR0   I+100,,AUTO
        19 007145   000000 631400 20                 EPPR1   0
        19 007146   000000 701000 xent               TSX1    VMX$OCTBIN
        19 007147   000000 011000                    NOP     0

     3065    29465    5                   IF OPT_SEED = 0

  29465 19 007150   001710 235000 11                 LDA     OPT_SEED
        19 007151   007163 601000 19                 TNZ     s:29471

     3066    29466    5                   THEN /* allow display w/o decryption */
     3067    29467    5                       OPT_SEED$ = ADDR(NIL);

  29467 19 007152   000022 236000 20                 LDQ     18
        19 007153   201112 756100                    STQ     OPT_SEED$,,AUTO
        19 007154   007163 710000 19                 TRA     s:29471

     3068    29468    5               CASE (%OPT_SELECT);

     3069    29469    5                   CALL INIT$SELECT_OPTS (BLK$,%CMD_FORWARD_MESSAGE) ALTRET(CONTINUE);

  29469 19 007155   000406 236000 20                 LDQ     262
        19 007156   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 007157   200024 633500                    EPPR3   BLK$,,AUTO
        19 007160   201117 453500                    STP3    @CURR_COMMAND_CODE+2,,AUTO
        19 007161   017510 701000 19                 TSX1    INIT$SELECT_OPTS
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:503  
        19 007162   016452 702000 19                 TSX2    CONTINUE

     3070    29470    5               END;             /* Do case ... end */

     3071    29471    4           END;

  29471 19 007163   200033 054100                    AOS     INDX1,,AUTO
        19 007164   200023 470500                    LDP0    OUT$,,AUTO
        19 007165   000001 236100                    LDQ     1,,PR0
        19 007166   000022 772000                    QRL     18
        19 007167   200033 116100                    CMPQ    INDX1,,AUTO
        19 007170   007124 605400 19                 TPNZ    s:29461

     3072    29472    3           CALL FIX_CONTEXT;

  29472 19 007171   017470 701000 19                 TSX1    FIX_CONTEXT
        19 007172   000000 011000                    NOP     0

     3073    29473    3           INDX1 = 0;

  29473 19 007173   200033 450100                    STZ     INDX1,,AUTO

     3074    29474        /*
     3075    29475             ***** Build the command buffer to pass to send ...
     3076    29476        */
     3077    29477                %INIT_STR (CODE=E_SEND_FORWARD, STR=VM_SEND_FORWARD, TEST=YES);

  29484 19 007174   040000 106400                    CMPC    fill='040'O
        19 007175   004754 200120 11                 ADSC9   VM_SEND_FORWARD          cn=1,n=80
        19 007176   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 007177   007204 601000 19                 TNZ     s:29500

  29486 19 007200   000407 630400 20                 EPPR0   263
        19 007201   000000 631400 20                 EPPR1   0
        19 007202   000000 701000 xent               TSX1    VMD$ERRMSG
        19 007203   000000 011000                    NOP     0

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:504  
     3078    29500    3           CALL BUILD_LINK_TO_SEND_CMD(VM_SEND_FORWARD);

  29500 19 007204   000410 236000 20                 LDQ     264
        19 007205   201121 756100                    STQ     @SITENAME+1,,AUTO
        19 007206   025126 701000 19                 TSX1    BUILD_LINK_TO_SEND_CMD
        19 007207   000000 011000                    NOP     0

     3079    29501        /*
     3080    29502             ***** Forward all the messages ...
     3081    29503        */
     3082    29504    4           DO FOREVER;

  29484 19 007210                       FWD_NEXT     null
     3083    29505    4   FWD_NEXT:   ;
     3084    29506    4               CALL GET$MESSAGE ALTRET(END_FORWARD);

  29506 19 007210   020536 701000 19                 TSX1    GET$MESSAGE
        19 007211   007560 702000 19                 TSX2    END_FORWARD

     3085    29507    4               INDX1 = INDX1 + 1;

  29507 19 007212   200033 054100                    AOS     INDX1,,AUTO

     3086    29508    4               IF VM_HEADER.STATUS.CRYPT

  29508 19 007213   000000 470400 xsym               LDP0    VM_HEADER$
        19 007214   000012 236100                    LDQ     10,,PR0
        19 007215   010000 316003                    CANQ    4096,DU
        19 007216   007231 600000 19                 TZE     s:29515
        19 007217   001710 235000 11                 LDA     OPT_SEED
        19 007220   007231 601000 19                 TNZ     s:29515
        19 007221   201112 236100                    LDQ     OPT_SEED$,,AUTO
        19 007222   000022 116000 20                 CMPQ    18
        19 007223   007231 600000 19                 TZE     s:29515

     3087    29509    4                 AND OPT_SEED = 0
     3088    29510    4                 AND OPT_SEED$ ~= ADDR(NIL)
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:505  
     3089    29511    5               THEN DO;

     3090    29512    5                   CALL XUR$ERRMSG (E_NEEDSEED);

  29512 19 007224   000311 630400 20                 EPPR0   201
        19 007225   000024 631400 20                 EPPR1   20
        19 007226   000000 701000 xent               TSX1    XUR$ERRMSG
        19 007227   000000 011000                    NOP     0

     3091    29513    5                   GOTO CONTINUE;

  29513 19 007230   016452 710000 19                 TRA     CONTINUE

     3092    29514    5               END;
     3093    29515    4               CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);

  29515 19 007231   000033 236000 20                 LDQ     27
        19 007232   201710 756100                    STQ     I+102,,AUTO
        19 007233   000103 236000 20                 LDQ     67
        19 007234   000000 235000 xsym               LDA     VM_HEADER$
        19 007235   201706 757100                    STAQ    I+100,,AUTO
        19 007236   201706 630500                    EPPR0   I+100,,AUTO
        19 007237   000021 631400 20                 EPPR1   17
        19 007240   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 007241   000000 011000                    NOP     0

     3094    29516        /*
     3095    29517             ***** Create the file to contain the message being forwarded ...
     3096    29518        */
     3097    29519    4               CALL M$OPEN (OPEN_FORWARD_FILE) ALTRET(E_PMME);

  29519 19 007242   000602 630400 12                 EPPR0   OPEN_FORWARD_FILE
        19 007243   450000 713400                    CLIMB   alt,open
        19 007244   410400 401760                    pmme    nvectors=18
        19 007245   016514 702000 19                 TSX2    E_PMME

     3098    29520    4               CLOSE_SAVE.V.DCB# = M$WORK_NUM;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:506  

  29520 19 007246   000000 720000 xsym               LXL0    M$WORK_NUM
        19 007247   002142 740000 11                 STX0    CLOSE_SAVE+26

     3099    29521        /*
     3100    29522             ***** Now move the text into the file.
     3101    29523                   No vfc!!!
     3102    29524        */
     3103    29525    5               IF VM_HEADER.STATUS.ENCL = %NO# THEN DO;

  29525 19 007250   000000 470400 xsym               LDP0    VM_HEADER$
        19 007251   000012 236100                    LDQ     10,,PR0
        19 007252   004000 316007                    CANQ    2048,DL
        19 007253   007300 601000 19                 TNZ     s:29534

     3104    29526    5                   CALL VMD$DI_MESSAGE (CURRENT_MESSAGE_NUMBER,M$WORK_NUM,

  29526 19 007254   201112 236100                    LDQ     OPT_SEED$,,AUTO
        19 007255   000053 235000 20                 LDA     43
        19 007256   201710 757100                    STAQ    I+102,,AUTO
        19 007257   000412 237000 20                 LDAQ    266
        19 007260   201706 757100                    STAQ    I+100,,AUTO
        19 007261   201706 630500                    EPPR0   I+100,,AUTO
        19 007262   000026 631400 20                 EPPR1   22
        19 007263   000000 701000 xent               TSX1    VMD$DI_MESSAGE
        19 007264   007266 702000 19                 TSX2    s:29529
        19 007265   007277 710000 19                 TRA     s:29533

     3105    29527    5                     M$MAIL_FILE_NUM,OPT$SEED)
     3106    29528    6                   WHENALTRETURN DO;

     3107    29529    6                       CALL XUR$ERRMSG (E_FWD_BADSEED);

  29529 19 007266   000414 630400 20                 EPPR0   268
        19 007267   000024 631400 20                 EPPR1   20
        19 007270   000000 701000 xent               TSX1    XUR$ERRMSG
        19 007271   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:507  

     3108    29530    6                       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  29530 19 007272   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 007273   450001 713400                    CLIMB   alt,close
        19 007274   406000 401760                    pmme    nvectors=13
        19 007275   016514 702000 19                 TSX2    E_PMME

     3109    29531    6                       GOTO FWD_NEXT;

  29531 19 007276   007210 710000 19                 TRA     FWD_NEXT

     3110    29532    6                   END;
     3111    29533    5               END;

  29533 19 007277   007330 710000 19                 TRA     s:29543

     3112    29534    5               ELSE IF VM_HEADER.STATUS.ENCL = %YES# THEN DO;

  29534 19 007300   004000 316007                    CANQ    2048,DL
        19 007301   007330 600000 19                 TZE     s:29543

     3113    29535    5                       CALL VMD$DI_MESSAGE (CURRENT_MESSAGE_NUMBER,M$WORK_NUM,

  29535 19 007302   000416 236000 20                 LDQ     270
        19 007303   000022 235000 20                 LDA     18
        19 007304   201712 757100                    STAQ    I+104,,AUTO
        19 007305   201112 236100                    LDQ     OPT_SEED$,,AUTO
        19 007306   000053 235000 20                 LDA     43
        19 007307   201710 757100                    STAQ    I+102,,AUTO
        19 007310   000412 237000 20                 LDAQ    266
        19 007311   201706 757100                    STAQ    I+100,,AUTO
        19 007312   201706 630500                    EPPR0   I+100,,AUTO
        19 007313   000130 631400 20                 EPPR1   88
        19 007314   000000 701000 xent               TSX1    VMD$DI_MESSAGE
        19 007315   007317 702000 19                 TSX2    s:29538
        19 007316   007330 710000 19                 TRA     s:29543
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:508  

     3114    29536    5                         M$MAIL_FILE_NUM,OPT$SEED,,%MAIL_FORWARD_ENCL)
     3115    29537    6                       WHENALTRETURN DO;

     3116    29538    6                           CALL XUR$ERRMSG (E_FWD_BADSEED);

  29538 19 007317   000414 630400 20                 EPPR0   268
        19 007320   000024 631400 20                 EPPR1   20
        19 007321   000000 701000 xent               TSX1    XUR$ERRMSG
        19 007322   000000 011000                    NOP     0

     3117    29539    6                           CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  29539 19 007323   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 007324   450001 713400                    CLIMB   alt,close
        19 007325   406000 401760                    pmme    nvectors=13
        19 007326   016514 702000 19                 TSX2    E_PMME

     3118    29540    6                           GOTO FWD_NEXT;

  29540 19 007327   007210 710000 19                 TRA     FWD_NEXT

     3119    29541    6                       END;
     3120    29542    5                   END;

     3121    29543    4               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  29543 19 007330   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 007331   450001 713400                    CLIMB   alt,close
        19 007332   406000 401760                    pmme    nvectors=13
        19 007333   016514 702000 19                 TSX2    E_PMME

     3122    29544        /*
     3123    29545             ***** Now move enclosure records, if there are any ...
     3124    29546        */
     3125    29547    5               IF VM_HEADER.STATUS.ENCL = %YES# THEN DO;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:509  
  29547 19 007334   000000 470400 xsym               LDP0    VM_HEADER$
        19 007335   000012 236100                    LDQ     10,,PR0
        19 007336   004000 316007                    CANQ    2048,DL
        19 007337   007543 600000 19                 TZE     s:29603

     3126    29548                       %INIT_STR (CODE=E_SEND_FORWARD_ENCL, STR=VM_SEND_FORWARD_ENCL, TEST=
             29548                            YES);

  29555 19 007340   040000 106400                    CMPC    fill='040'O
        19 007341   005001 200120 11                 ADSC9   VM_SEND_FORWARD_ENCL     cn=1,n=80
        19 007342   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 007343   007350 601000 19                 TNZ     s:29571

  29557 19 007344   000417 630400 20                 EPPR0   271
        19 007345   000000 631400 20                 EPPR1   0
        19 007346   000000 701000 xent               TSX1    VMD$ERRMSG
        19 007347   000000 011000                    NOP     0

     3127    29571    5                   CALL BUILD_LINK_TO_SEND_CMD(VM_SEND_FORWARD_ENCL);

  29571 19 007350   000420 236000 20                 LDQ     272
        19 007351   201121 756100                    STQ     @SITENAME+1,,AUTO
        19 007352   025126 701000 19                 TSX1    BUILD_LINK_TO_SEND_CMD
        19 007353   000000 011000                    NOP     0

     3128    29572
     3129    29573    5                   CALL M$OPEN (OPEN_FORWARD_ENCL_FILE) ALTRET (E_PMME);

  29573 19 007354   000674 630400 12                 EPPR0   OPEN_FORWARD_ENCL_FILE
        19 007355   450000 713400                    CLIMB   alt,open
        19 007356   410400 401760                    pmme    nvectors=18
        19 007357   016514 702000 19                 TSX2    E_PMME

     3130    29574    5                   CLOSE_SAVE.V.DCB# = DCBNUM(M$ENCL);

  29574 19 007360   000000 236007 xsym               LDQ     M$ENCL,DL
        19 007361   000000 620006                    EAX0    0,QL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:510  
        19 007362   002142 740000 11                 STX0    CLOSE_SAVE+26

     3131    29575
     3132    29576    5                   ENCL$ = VM_ENCL_HEAD.HEAD$;

  29576 19 007363   000000 470400 xsym               LDP0    VM_ENCLLIST$
        19 007364   000003 236100                    LDQ     3,,PR0
        19 007365   200032 756100                    STQ     ENCL$,,AUTO

     3133    29577    6                   DO INDX1 = 0 TO VM_ENCL_HEAD.NUM_ENTRIES - 1;

  29577 19 007366   200033 450100                    STZ     INDX1,,AUTO
        19 007367   007516 710000 19                 TRA     s:29593+1

     3134    29578    7                       DO INDX3 = 0 TO VM_ENCLOS.NRECS - 1;

  29578 19 007370   200034 450100                    STZ     INDX3,,AUTO
        19 007371   007506 710000 19                 TRA     s:29591+1

     3135    29579    7   GET_ENCL_REC:           CALL VMD$GET_ENCL(CURRENT_MESSAGE_NUMBER,

  29579 19 007372   200032 470500       GET_ENCL_REC LDP0    ENCL$,,AUTO
        19 007373   000012 236100                    LDQ     10,,PR0
        19 007374   000033 772000                    QRL     27
        19 007375   000144 136007                    SBLQ    100,DL
        19 007376   201706 756100                    STQ     I+100,,AUTO
        19 007377   000267 236000 20                 LDQ     183
        19 007400   201717 756100                    STQ     I+109,,AUTO
        19 007401   201706 631500                    EPPR1   I+100,,AUTO
        19 007402   201716 451500                    STP1    I+108,,AUTO
        19 007403   000022 236000 20                 LDQ     18
        19 007404   000022 235000 20                 LDA     18
        19 007405   201714 757100                    STAQ    I+106,,AUTO
        19 007406   000022 236000 20                 LDQ     18
        19 007407   201713 756100                    STQ     I+105,,AUTO
        19 007410   200550 633500                    EPPR3   COUNT,,AUTO
        19 007411   201712 453500                    STP3    I+104,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:511  
        19 007412   200034 634500                    EPPR4   INDX3,,AUTO
        19 007413   201711 454500                    STP4    I+103,,AUTO
        19 007414   000053 236000 20                 LDQ     43
        19 007415   201710 756100                    STQ     I+102,,AUTO
        19 007416   000103 236000 20                 LDQ     67
        19 007417   201707 756100                    STQ     I+101,,AUTO
        19 007420   201707 630500                    EPPR0   I+101,,AUTO
        19 007421   000266 631400 20                 EPPR1   182
        19 007422   000000 701000 xent               TSX1    VMD$GET_ENCL
        19 007423   007425 702000 19                 TSX2    s:29583
        19 007424   007443 710000 19                 TRA     s:29588

     3136    29580    7                             M$MAIL_FILE_NUM,INDX3,COUNT,,,,VM_ENCLOS.TYPE-%
             29580                                      VM_TYPE_ENCL,
     3137    29581    7                             VM_ENCLREC$)
     3138    29582    8                           WHENALTRETURN DO;

     3139    29583    9                               IF B$TCB.ALT$->B$ALT.ERR.CODE=%E$LD THEN DO;

  29583 19 007425   000000 470400 xsym               LDP0    B$TCB$
        19 007426   000000 471500                    LDP1    0,,PR0
        19 007427   100102 236100                    LDQ     66,,PR1
        19 007430   377770 376007                    ANQ     131064,DL
        19 007431   000070 116007                    CMPQ    56,DL
        19 007432   007443 601000 19                 TNZ     s:29588

     3140    29584    9                                  VBOUND(VM_ENCLREC_) = VBOUND(VM_ENCLREC_) + PAGESIZE
             29584                                            ;

  29584 19 007433   000000 236000 xsym               LDQ     VM_ENCLREC_
        19 007434   000020 772000                    QRL     16
        19 007435   000374 036000 11                 ADLQ    PAGESIZE
        19 007436   000020 736000                    QLS     16
        19 007437   000000 676000 xsym               ERQ     VM_ENCLREC_
        19 007440   000017 376000 20                 ANQ     15
        19 007441   000000 656000 xsym               ERSQ    VM_ENCLREC_

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:512  
     3141    29585    9                                   GOTO GET_ENCL_REC;

  29585 19 007442   007372 710000 19                 TRA     GET_ENCL_REC

     3142    29586    9                               END;
     3143    29587    8                           END;
     3144    29588    7                           CALL VMD$PUT_ENCL (0,DCBNUM(M$ENCL),INDX3,COUNT,

  29588 19 007443   000000 236007 xsym               LDQ     M$ENCL,DL
        19 007444   201706 756100                    STQ     I+100,,AUTO
        19 007445   000000 236007 xsym               LDQ     M$ENCL,DL
        19 007446   000074 470400 20                 LDP0    60
        19 007447   000000 471500                    LDP1    0,,PR0
        19 007450   100000 473506                    LDP3    0,QL,PR1
        19 007451   201706 235100                    LDA     I+100,,AUTO
        19 007452   201707 755100                    STA     I+101,,AUTO
        19 007453   200032 474500                    LDP4    ENCL$,,AUTO
        19 007454   400012 236100                    LDQ     10,,PR4
        19 007455   000033 772000                    QRL     27
        19 007456   000144 136007                    SBLQ    100,DL
        19 007457   201710 756100                    STQ     I+102,,AUTO
        19 007460   000267 236000 20                 LDQ     183
        19 007461   201721 756100                    STQ     I+111,,AUTO
        19 007462   201710 635500                    EPPR5   I+102,,AUTO
        19 007463   201720 455500                    STP5    I+110,,AUTO
        19 007464   300003 636500                    EPPR6   3,,PR3
        19 007465   201717 456500                    STP6    I+109,,AUTO
        19 007466   000022 236000 20                 LDQ     18
        19 007467   201716 756100                    STQ     I+108,,AUTO
        19 007470   000066 236000 20                 LDQ     54
        19 007471   201715 756100                    STQ     I+107,,AUTO
        19 007472   200550 633500                    EPPR3   COUNT,,AUTO
        19 007473   201714 453500                    STP3    I+106,,AUTO
        19 007474   200034 637500                    EPPR7   INDX3,,AUTO
        19 007475   201713 457500                    STP7    I+105,,AUTO
        19 007476   201707 630500                    EPPR0   I+101,,AUTO
        19 007477   201712 450500                    STP0    I+104,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:513  
        19 007500   201711 756100                    STQ     I+103,,AUTO
        19 007501   201711 630500                    EPPR0   I+103,,AUTO
        19 007502   000266 631400 20                 EPPR1   182
        19 007503   000000 701000 xent               TSX1    VMD$PUT_ENCL
        19 007504   000000 011000                    NOP     0

     3145    29589    7                             0, ,DCBADDR(DCBNUM(M$ENCL))->F$DCB.DVBYTE,
     3146    29590    7                             VM_ENCLOS.TYPE-%VM_TYPE_ENCL,VM_ENCLREC$);
     3147    29591    7                       END; /* J */

  29591 19 007505   200034 054100                    AOS     INDX3,,AUTO
        19 007506   200032 470500                    LDP0    ENCL$,,AUTO
        19 007507   200034 236100                    LDQ     INDX3,,AUTO
        19 007510   007372 604000 19                 TMI     GET_ENCL_REC
        19 007511   000011 116100                    CMPQ    9,,PR0
        19 007512   007372 602000 19                 TNC     GET_ENCL_REC

     3148    29592    6                       ENCL$ = VM_ENCLOS.NEXT$;

  29592 19 007513   000000 236100                    LDQ     0,,PR0
        19 007514   200032 756100                    STQ     ENCL$,,AUTO

     3149    29593    6                   END; /* I */

  29593 19 007515   200033 054100                    AOS     INDX1,,AUTO
        19 007516   000000 470400 xsym               LDP0    VM_ENCLLIST$
        19 007517   200033 236100                    LDQ     INDX1,,AUTO
        19 007520   007370 604000 19                 TMI     s:29578
        19 007521   000001 116100                    CMPQ    1,,PR0
        19 007522   007370 602000 19                 TNC     s:29578

     3150    29594    5                   CALL VMA$PUT_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,

  29594 19 007523   000000 236007 xsym               LDQ     M$ENCL,DL
        19 007524   201706 756100                    STQ     I+100,,AUTO
        19 007525   201706 631500                    EPPR1   I+100,,AUTO
        19 007526   201711 451500                    STP1    I+103,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:514  
        19 007527   000257 236000 20                 LDQ     175
        19 007530   201710 756100                    STQ     I+102,,AUTO
        19 007531   000256 236000 20                 LDQ     174
        19 007532   201707 756100                    STQ     I+101,,AUTO
        19 007533   201707 630500                    EPPR0   I+101,,AUTO
        19 007534   000021 631400 20                 EPPR1   17
        19 007535   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        19 007536   000000 011000                    NOP     0

     3151    29595    5                     DCBNUM(M$ENCL));
     3152    29596
     3153    29597    5                   CALL M$CLOSE (CLOSE_SAVE) ALTRET (E_PMME);

  29597 19 007537   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 007540   450001 713400                    CLIMB   alt,close
        19 007541   406000 401760                    pmme    nvectors=13
        19 007542   016514 702000 19                 TSX2    E_PMME

     3154    29598
     3155    29599    5               END; /* IF ENCL */

     3156    29600        /*
     3157    29601             ***** Link to SEND ...
     3158    29602        */
     3159    29603    4               CALL LINK_RUNIT

  29603 19 007543   017111 701000 19                 TSX1    LINK_RUNIT
        19 007544   007552 702000 19                 TSX2    s:29611

     3160    29604    4               WHENRETURN
     3161    29605    5               DO;

     3162    29606    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,

  29606 19 007545   000120 630400 20                 EPPR0   80
        19 007546   000000 631400 20                 EPPR1   0
        19 007547   000000 701000 xent               TSX1    VMD$GET_HEADER
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:515  
        19 007550   016514 702000 19                 TSX2    E_PMME

     3163    29607    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     3164    29608    5               END;

  29608 19 007551   007557 710000 19                 TRA     s:29615

     3165    29609    4               WHENALTRETURN
     3166    29610    5               DO;

     3167    29611    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,

  29611 19 007552   000120 630400 20                 EPPR0   80
        19 007553   000000 631400 20                 EPPR1   0
        19 007554   000000 701000 xent               TSX1    VMD$GET_HEADER
        19 007555   016514 702000 19                 TSX2    E_PMME

     3168    29612    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     3169    29613    5                   GOTO END_FORWARD;

  29613 19 007556   007560 710000 19                 TRA     END_FORWARD

     3170    29614    5               END;
     3171    29615    4           END;                       /* Do forever ... end */

  29615 19 007557   007210 710000 19                 TRA     FWD_NEXT

     3172    29616    3   END_FORWARD:
     3173    29617    3           REOPEN_FILE.V.DCB# = M$WORK_NUM;

  29617 19 007560   000000 720000 xsym  END_FORWARD  LXL0    M$WORK_NUM
        19 007561   002502 740000 11                 STX0    REOPEN_FILE+36

     3174    29618    3           CALL M$OPEN (REOPEN_FILE)

  29618 19 007562   002436 630400 11                 EPPR0   REOPEN_FILE
        19 007563   450000 713400                    CLIMB   alt,open
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:516  
        19 007564   410400 401760                    pmme    nvectors=18
        19 007565   007575 702000 19                 TSX2    s:29623

     3175    29619    4           WHENRETURN DO;

     3176    29620    4               CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;

  29620 19 007566   000000 720000 xsym               LXL0    M$WORK_NUM
        19 007567   002200 740000 11                 STX0    CLOSE_SCRATCH+26

     3177    29621    5               CALL M$CLOSE (CLOSE_SCRATCH) WHENALTRETURN DO; END;

  29621 19 007570   002146 630400 11                 EPPR0   CLOSE_SCRATCH
        19 007571   450001 713400                    CLIMB   alt,close
        19 007572   406000 401760                    pmme    nvectors=13
        19 007573   007575 702000 19                 TSX2    s:29623
        19 007574   007575 710000 19                 TRA     s:29623

     3178    29622    4           END;

     3179    29623    3           IF INDX1 = 0

  29623 19 007575   200033 235100                    LDA     INDX1,,AUTO
        19 007576   007607 601000 19                 TNZ     s:29626

     3180    29624    3           THEN
     3181    29625    3               CALL REPORT_ACTIVITY (INDX1,VM_NO_MESSAGE_FMT,%YES#,E_NO_MESSAGE_FMT);

  29625 19 007577   000104 236000 20                 LDQ     68
        19 007600   201122 756100                    STQ     @NAME+1,,AUTO
        19 007601   000106 237000 20                 LDAQ    70
        19 007602   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 007603   200033 630500                    EPPR0   INDX1,,AUTO
        19 007604   201117 450500                    STP0    @CURR_COMMAND_CODE+2,,AUTO
        19 007605   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 007606   000000 011000                    NOP     0

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:517  
     3182    29626    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN

  29626 19 007607   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 007610   010000 316003                    CANQ    4096,DU
        19 007611   016452 600000 19                 TZE     CONTINUE

     3183    29627    3           THEN                       /* Ok to read profile */
     3184    29628    3               CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);

  29628 19 007612   000053 630400 20                 EPPR0   43
        19 007613   000024 631400 20                 EPPR1   20
        19 007614   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 007615   016454 702000 19                 TSX2    BAD_PROFILE
        19 007616   016452 710000 19                 TRA     CONTINUE

     3185    29629        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:518  
     3186    29630        /* Goto command */
     3187    29631    3       CASE (%CMD_GOTO_MESSAGE);

     3188    29632    3           CALL NEED_FOLDER ALTRET(CONTINUE);

  29632 19 007617   016547 701000 19                 TSX1    NEED_FOLDER
        19 007620   016452 702000 19                 TSX2    CONTINUE

     3189    29633    3           CALL CHARBIN (INDX3,OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT);

  29633 19 007621   200023 470500                    LDP0    OUT$,,AUTO
        19 007622   000003 471500                    LDP1    3,,PR0
        19 007623   100004 236100                    LDQ     4,,PR1
        19 007624   000033 772000                    QRL     27
        19 007625   000000 620006                    EAX0    0,QL
        19 007626   000100 305540                    DTB
        19 007627   100004 230010                    NDSC9   4,,PR1                   cn=1,s=nosgn,sf=0,n=*X0
        19 007630   200034 000004                    NDSC9   INDX3,,AUTO              cn=0,s=lsgnf,sf=0,n=4

     3190    29634        /*
     3191    29635             ***** Determine if this message number is valid
     3192    29636                   according to the selected context info ...
     3193    29637        */
     3194    29638                                      /* $$$$$$$$$$$$$ code to be added $$$$$$$$$$$$$ */
     3195    29639    3           SELECTED_CONTEXT%.MESSAGE_POINTER = INDX3;

  29639 19 007631   001664 471400 11                 LDP1    CONTEXT_PTR$+1
        19 007632   200034 235100                    LDA     INDX3,,AUTO
        19 007633   100000 755100                    STA     0,,PR1

     3196    29640        /*
     3197    29641             ***** Now list or display this message ...
     3198    29642        */
     3199    29643    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE

  29643 19 007634   000544 236000 11                 LDQ     LAST_COMMAND_CODE
        19 007635   000016 116007                    CMPQ    14,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:519  
        19 007636   007653 601000 19                 TNZ     s:29678

     3200    29644    3           THEN
     3201    29645                    %INIT_STR (CODE=E_DI_THIS_CMD, STR=VM_DI_THIS_CMD,
     3202    29646                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  29653 19 007637   040000 106400                    CMPC    fill='040'O
        19 007640   004646 200017 11                 ADSC9   VM_DI_THIS_CMD           cn=1,n=15
        19 007641   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 007642   007647 601000 19                 TNZ     s:29664

  29655 19 007643   000421 630400 20                 EPPR0   273
        19 007644   000000 631400 20                 EPPR1   0
        19 007645   000000 701000 xent               TSX1    VMD$ERRMSG
        19 007646   000000 011000                    NOP     0

  29664 19 007647   000100 100400                    MLR     fill='000'O
        19 007650   004646 000020 11                 ADSC9   VM_DI_THIS_CMD           cn=0,n=16
        19 007651   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  29666 19 007652   007666 710000 19                 TRA     s:29694

     3203    29669    3           ELSE
     3204    29670                  %INIT_STR (CODE=E_LIST_THIS_CMD, STR=VM_LIST_THIS_CMD,
     3205    29671                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  29678 19 007653   040000 106400                    CMPC    fill='040'O
        19 007654   004652 200017 11                 ADSC9   VM_LIST_THIS_CMD         cn=1,n=15
        19 007655   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 007656   007663 601000 19                 TNZ     s:29689

  29680 19 007657   000423 630400 20                 EPPR0   275
        19 007660   000000 631400 20                 EPPR1   0
        19 007661   000000 701000 xent               TSX1    VMD$ERRMSG
        19 007662   000000 011000                    NOP     0

  29689 19 007663   000100 100400                    MLR     fill='000'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:520  
        19 007664   004652 000020 11                 ADSC9   VM_LIST_THIS_CMD         cn=0,n=16
        19 007665   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

     3206    29694    3           NEXT_COMMAND_TEXT.L# = LENGTHC('DI THIS');

  29694 19 007666   007000 236003                    LDQ     3584,DU
        19 007667   200551 552140                    STBQ    NEXT_COMMAND_TEXT,'40'O,AUTO
        19 007670   016452 710000 19                 TRA     CONTINUE

     3207    29695        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:521  
     3208    29696        /* Help commands */
     3209    29697
     3210    29698    3       CASE(%CMD_HELP);

     3211    29699    3           HELP_PARAM.HELP$ = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXTC$;

  29699 19 007671   200023 474500                    LDP4    OUT$,,AUTO
        19 007672   400003 475500                    LDP5    3,,PR4
        19 007673   500003 236100                    LDQ     3,,PR5
        19 007674   002013 756000 11                 STQ     HELP_PARAM+9

     3212    29700    3           HELP_PARAM.MORE# = %NO#;

  29700 19 007675   000425 236000 20                 LDQ     277
        19 007676   002014 356000 11                 ANSQ    HELP_PARAM+10

     3213    29701    3           CALL XUR$HELP (HELP_PARAM);

  29701 19 007677   000426 630400 20                 EPPR0   278
        19 007700   000024 631400 20                 EPPR1   20
        19 007701   000000 701000 xent               TSX1    XUR$HELP
        19 007702   000000 011000                    NOP     0
        19 007703   016452 710000 19                 TRA     CONTINUE

     3214    29702
     3215    29703    3       CASE (%CMD_QUES1);

     3216    29704    3           CALL XUR$MOREMSG (HELP_PARAM) ALTRET(NO_MORE);

  29704 19 007704   000426 630400 20                 EPPR0   278
        19 007705   000024 631400 20                 EPPR1   20
        19 007706   000000 701000 xent               TSX1    XUR$MOREMSG
        19 007707   007716 702000 19                 TSX2    NO_MORE
        19 007710   016452 710000 19                 TRA     CONTINUE

     3217    29705    3       CASE (%CMD_QUES2);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:522  
     3218    29706    3           CALL XUR$ALLMSG (HELP_PARAM) ALTRET(NO_MORE);

  29706 19 007711   000426 630400 20                 EPPR0   278
        19 007712   000024 631400 20                 EPPR1   20
        19 007713   000000 701000 xent               TSX1    XUR$ALLMSG
        19 007714   007716 702000 19                 TSX2    NO_MORE

     3219    29707        /**/
     3220    29708    4           DO NEVER;

  29708 19 007715   016452 710000 19                 TRA     CONTINUE

     3221    29709    4   NO_MORE:
     3222    29710        /*E*    ERROR: VMO-E$NOMORE-0
     3223    29711                MESSAGE: No messages available. */
     3224    29712    4               CALL XUR$ERRMSG (E_NOMORE);

  29712 19 007716   000427 630400 20    NO_MORE      EPPR0   279
        19 007717   000024 631400 20                 EPPR1   20
        19 007720   000000 701000 xent               TSX1    XUR$ERRMSG
        19 007721   000000 011000                    NOP     0

     3225    29713    4           END;                       /* Do never ... end */

  29713 19 007722   016452 710000 19                 TRA     CONTINUE

     3226    29714
     3227    29715
     3228    29716        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:523  
     3229    29717        /* Last message command */
     3230    29718    3       CASE(%CMD_LAST_MESSAGE);

     3231    29719    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE

  29719 19 007723   000544 235000 11                 LDA     LAST_COMMAND_CODE
        19 007724   000016 115007                    CMPA    14,DL
        19 007725   007742 601000 19                 TNZ     s:29754

     3232    29720    3           THEN
     3233    29721                    %INIT_STR (CODE=E_DI_LAST_CMD, STR=VM_DI_LAST_CMD,
     3234    29722                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  29729 19 007726   040000 106400                    CMPC    fill='040'O
        19 007727   004656 200017 11                 ADSC9   VM_DI_LAST_CMD           cn=1,n=15
        19 007730   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 007731   007736 601000 19                 TNZ     s:29740

  29731 19 007732   000430 630400 20                 EPPR0   280
        19 007733   000000 631400 20                 EPPR1   0
        19 007734   000000 701000 xent               TSX1    VMD$ERRMSG
        19 007735   000000 011000                    NOP     0

  29740 19 007736   000100 100400                    MLR     fill='000'O
        19 007737   004656 000020 11                 ADSC9   VM_DI_LAST_CMD           cn=0,n=16
        19 007740   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  29742 19 007741   016452 710000 19                 TRA     CONTINUE

     3235    29745    3           ELSE
     3236    29746                  %INIT_STR (CODE=E_LIST_LAST_CMD, STR=VM_LIST_LAST_CMD,
     3237    29747                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  29754 19 007742   040000 106400                    CMPC    fill='040'O
        19 007743   004662 200017 11                 ADSC9   VM_LIST_LAST_CMD         cn=1,n=15
        19 007744   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 007745   007752 601000 19                 TNZ     s:29765
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:524  

  29756 19 007746   000432 630400 20                 EPPR0   282
        19 007747   000000 631400 20                 EPPR1   0
        19 007750   000000 701000 xent               TSX1    VMD$ERRMSG
        19 007751   000000 011000                    NOP     0

  29765 19 007752   000100 100400                    MLR     fill='000'O
        19 007753   004662 000020 11                 ADSC9   VM_LIST_LAST_CMD         cn=0,n=16
        19 007754   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  29767 19 007755   016452 710000 19                 TRA     CONTINUE

     3238    29770        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:525  
     3239    29771    3       CASE(%CMD_LINK);

     3240    29772    3           BLK$ = OUT$->P$B.SUBLK$(0);

  29772 19 007756   200023 474500                    LDP4    OUT$,,AUTO
        19 007757   400003 236100                    LDQ     3,,PR4
        19 007760   200024 756100                    STQ     BLK$,,AUTO

     3241    29773    3           OPT_FID = BLK$->P$S.TEXT;

  29773 19 007761   200024 475500                    LDP5    BLK$,,AUTO
        19 007762   500004 236100                    LDQ     4,,PR5
        19 007763   000033 772000                    QRL     27
        19 007764   000000 620006                    EAX0    0,QL
        19 007765   040000 100540                    MLR     fill='040'O
        19 007766   500004 200010                    ADSC9   4,,PR5                   cn=1,n=*X0
        19 007767   001670 000100 11                 ADSC9   OPT_FID                  cn=0,n=64

     3242    29774    3           IF OUT$->P$B.NSUBLKS = 2 THEN

  29774 19 007770   400001 220100                    LDX0    1,,PR4
        19 007771   000002 100003                    CMPX0   2,DU
        19 007772   010045 601000 19                 TNZ     s:29790

     3243    29775    4           DO;                    /* Process the cc buffer for link     */

     3244    29776    4               LINK_CCBUF.L# = BLK$->P$S.COUNT;

  29776 19 007773   500004 236100                    LDQ     4,,PR5
        19 007774   000073 552040 11                 STBQ    LINK_CCBUF,'40'O

     3245    29777    4               LINK_CCBUF.NAME# = BLK$->P$S.TEXT;

  29777 19 007775   500004 236100                    LDQ     4,,PR5
        19 007776   000033 772000                    QRL     27
        19 007777   000000 620006                    EAX0    0,QL
        19 010000   040000 100540                    MLR     fill='040'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:526  
        19 010001   500004 200010                    ADSC9   4,,PR5                   cn=1,n=*X0
        19 010002   000073 200400 11                 ADSC9   LINK_CCBUF               cn=1,n=256

     3246    29778    4               BLK$ = OUT$->P$B.SUBLK$(1);

  29778 19 010003   400004 236100                    LDQ     4,,PR4
        19 010004   200024 756100                    STQ     BLK$,,AUTO

     3247    29779    4               IF BLK$ -> P$S.COUNT > 0

  29779 19 010005   200024 475500                    LDP5    BLK$,,AUTO
        19 010006   500004 236100                    LDQ     4,,PR5
        19 010007   777000 316003                    CANQ    -512,DU
        19 010010   010042 600000 19                 TZE     s:29787

     3248    29780    4               THEN
     3249    29781    5               DO;

     3250    29782    5                   INDX4 = BLK$ -> P$S.COUNT + 1;

  29782 19 010011   500004 236100                    LDQ     4,,PR5
        19 010012   000033 772000                    QRL     27
        19 010013   000001 036007                    ADLQ    1,DL
        19 010014   200035 756100                    STQ     INDX4,,AUTO

     3251    29783    5                   INDX3 = LINK_CCBUF.L#;

  29783 19 010015   000073 236000 11                 LDQ     LINK_CCBUF
        19 010016   000033 772000                    QRL     27
        19 010017   200034 756100                    STQ     INDX3,,AUTO

     3252    29784    5                   LINK_CCBUF.L# = LINK_CCBUF.L# + INDX4;

  29784 19 010020   200035 036100                    ADLQ    INDX4,,AUTO
        19 010021   000033 736000                    QLS     27
        19 010022   000073 552040 11                 STBQ    LINK_CCBUF,'40'O

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:527  
     3253    29785    5                   CALL INSERT(LINK_CCBUF.NAME#,INDX3,INDX4,' ',BLK$->P$S.TEXT);

  29785 19 010023   500004 236100                    LDQ     4,,PR5
        19 010024   000033 772000                    QRL     27
        19 010025   200035 720100                    LXL0    INDX4,,AUTO
        19 010026   200034 235100                    LDA     INDX3,,AUTO
        19 010027   040045 100400                    MLR     fill='040'O
        19 010030   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 010031   000073 200010 11                 ADSC9   LINK_CCBUF,A             cn=1,n=*X0
        19 010032   000000 621006                    EAX1    0,QL
        19 010033   200035 236100                    LDQ     INDX4,,AUTO
        19 010034   000001 116007                    CMPQ    1,DL
        19 010035   010042 604400 19                 TMOZ    s:29787
        19 010036   777777 622006                    EAX2    -1,QL
        19 010037   040045 100540                    MLR     fill='040'O
        19 010040   500004 200011                    ADSC9   4,,PR5                   cn=1,n=*X1
        19 010041   000073 400012 11                 ADSC9   LINK_CCBUF,A             cn=2,n=*X2

     3254    29786    5               END;

     3255    29787    4               FPT_LINK.CP_CMD_ = VECTOR(LINK_CCBUF);

  29787 19 010042   000434 237000 20                 LDAQ    284
        19 010043   002426 757000 11                 STAQ    FPT_LINK+10

     3256    29788    4           END;

  29788 19 010044   010047 710000 19                 TRA     s:29792

     3257    29789    3           ELSE
     3258    29790    3               FPT_LINK.CP_CMD_ = VECTOR(NIL);

  29790 19 010045   000230 237000 20                 LDAQ    152
        19 010046   002426 757000 11                 STAQ    FPT_LINK+10

     3259    29791
     3260    29792    3           CALL LINK_RUNIT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:528  

  29792 19 010047   017111 701000 19                 TSX1    LINK_RUNIT
        19 010050   000000 011000                    NOP     0

     3261    29793    3           FPT_LINK.PSID_ = VECTOR(NIL);

  29793 19 010051   000230 237000 20                 LDAQ    152
        19 010052   002422 757000 11                 STAQ    FPT_LINK+6

     3262    29794    3           FPT_LINK.PASS_ = VECTOR(NIL);

  29794 19 010053   000230 237000 20                 LDAQ    152
        19 010054   002420 757000 11                 STAQ    FPT_LINK+4

     3263    29795    3           FPT_LINK.CP_CMD_ = VECTOR(NIL);

  29795 19 010055   000230 237000 20                 LDAQ    152
        19 010056   002426 757000 11                 STAQ    FPT_LINK+10
        19 010057   016452 710000 19                 TRA     CONTINUE

     3264    29796        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:529  
     3265    29797        /* List folder command */
     3266    29798    3       CASE (%CMD_LIST_FOLDER,%CMD_DISPLAY_FOLDER);

     3267    29799        /*
     3268    29800             ***** Stash the profile for the current folder.
     3269    29801                   Need to get the profile for each folder to display ...
     3270    29802        */
     3271    29803    3           IF VM_CURRENT_FOLDER.FLAGS.UPDATE

  29803 19 010060   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 010061   010066 605000 19                 TPL     s:29808

     3272    29804    3           THEN
     3273    29805    4           DO;

     3274    29806    4               CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(WRITE_ERROR);

  29806 19 010062   000053 236000 20                 LDQ     43
        19 010063   201523 756100                    STQ     INDX2+255,,AUTO
        19 010064   021320 701000 19                 TSX1    PUT_PROFILE
        19 010065   016477 702000 19                 TSX2    WRITE_ERROR

     3275    29807    4           END;

     3276    29808    3           FOLDER_WAS_OPEN = VM_CURRENT_FOLDER.FLAGS.OPEN;

  29808 19 010066   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 010067   000005 736000                    QLS     5
        19 010070   400000 376003                    ANQ     -131072,DU
        19 010071   000404 756000 11                 STQ     FOLDER_WAS_OPEN

     3277    29809    3           VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B; /* This keeps

  29809 19 010072   000054 236000 20                 LDQ     44
        19 010073   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     3278    29810                                           a bad profile record being written if we get
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:530  
     3279    29811                                           ctl-y or otherwise xconed. */
     3280    29812    3           BREAK_TYPE = CURR_COMMAND_CODE;

  29812 19 010074   201115 470500                    LDP0    @CURR_COMMAND_CODE,,AUTO
        19 010075   000000 235100                    LDA     0,,PR0
        19 010076   000400 755000 11                 STA     BREAK_TYPE

     3281    29813        /*
     3282    29814             ***** Look at folders in the user's file directory acct ...
     3283    29815        */
     3284    29816    3           INDX2 = 0;                  /* Used as counter */

  29816 19 010077   000375 450000 11                 STZ     INDX2

     3285    29817    3           VM_RADDRESS.ACCT = VM_CENTRAL_FOLDER.ACCT;

  29817 19 010100   040100 100400                    MLR     fill='040'O
        19 010101   001135 400010 11                 ADSC9   VM_CENTRAL_FOLDER+1      cn=2,n=8
        19 010102   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8

     3286    29818    3           VM_RADDRESS.FOLDER = '?';   /* Default is everything */

  29818 19 010103   040100 100400                    MLR     fill='040'O
        19 010104   000225 000001 20                 ADSC9   149                      cn=0,n=1
        19 010105   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25

     3287    29819    3           VM_RADDRESS.PASS = ' ';

  29819 19 010106   040100 100400                    MLR     fill='040'O
        19 010107   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 010110   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8

     3288    29820    3           VM_RADDRESS.SITENAME = ' ';

  29820 19 010111   040100 100400                    MLR     fill='040'O
        19 010112   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 010113   200770 600010                    ADSC9   VM_RADDRESS+15,,AUTO     cn=3,n=8
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:531  

     3289    29821    3           VM_RADDRESS.TYPE = %VM_ADD_RESOLVED;

  29821 19 010114   000001 236003                    LDQ     1,DU
        19 010115   200753 552120                    STBQ    VM_RADDRESS+2,'20'O,AUTO

     3290    29822    3           IF OUT$ -> P$B.NSUBLKS ~= 0

  29822 19 010116   200023 471500                    LDP1    OUT$,,AUTO
        19 010117   100001 220100                    LDX0    1,,PR1
        19 010120   010241 600000 19                 TZE     LI_FOLD_ALL

     3291    29823    4           THEN DO;

     3292    29824        /*
     3293    29825                ***** Handle output clause, if any ...
     3294    29826        */
     3295    29827    4               BLK$ = OUT$ -> P$B.SUBLK$ (OUT$ -> P$B.NSUBLKS - 1);

  29827 19 010121   100002 236110                    LDQ     2,X0,PR1
        19 010122   200024 756100                    STQ     BLK$,,AUTO

     3296    29828    4               IF BLK$ -> P$B.CODE = %OPT_OUTPUT

  29828 19 010123   200024 473500                    LDP3    BLK$,,AUTO
        19 010124   300000 720100                    LXL0    0,,PR3
        19 010125   000005 100003                    CMPX0   5,DU
        19 010126   010156 601000 19                 TNZ     s:29842

     3297    29829    5               THEN DO;

     3298    29830    5                   CALL XUR$OPENOUT (M$OUT_NUM, BLK$ -> P$B)

  29830 19 010127   000265 235000 20                 LDA     181
        19 010130   201706 757100                    STAQ    I+100,,AUTO
        19 010131   201706 630500                    EPPR0   I+100,,AUTO
        19 010132   000000 631400 20                 EPPR1   0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:532  
        19 010133   000000 701000 xent               TSX1    XUR$OPENOUT
        19 010134   010140 702000 19                 TSX2    s:29835

     3299    29831    6                   WHENRETURN DO;

     3300    29832    6                       OUTDCB = M$OUT_NUM;

  29832 19 010135   000075 235000 12                 LDA     M$OUT_NUM
        19 010136   000402 755000 11                 STA     OUTDCB

     3301    29833    6                   END;

  29833 19 010137   010152 710000 19                 TRA     s:29838

     3302    29834    6                   WHENALTRETURN DO;

     3303    29835    6                       CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);

  29835 19 010140   000265 236000 20                 LDQ     181
        19 010141   201707 756100                    STQ     I+101,,AUTO
        19 010142   200003 236100                    LDQ     XUG_GETCMD$,,AUTO
        19 010143   000001 036003                    ADLQ    1,DU
        19 010144   201706 756100                    STQ     I+100,,AUTO
        19 010145   201706 630500                    EPPR0   I+100,,AUTO
        19 010146   000000 631400 20                 EPPR1   0
        19 010147   000000 701000 xent               TSX1    XUR$ERRMSG
        19 010150   000000 011000                    NOP     0

     3304    29836    6                       GOTO END_LI_FOLDER;

  29836 19 010151   010447 710000 19                 TRA     END_LI_FOLDER

     3305    29837    6                   END;
     3306    29838    5                   IF OUT$ -> P$B.NSUBLKS = 1

  29838 19 010152   200023 470500                    LDP0    OUT$,,AUTO
        19 010153   000001 220100                    LDX0    1,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:533  
        19 010154   000001 100003                    CMPX0   1,DU
        19 010155   010241 600000 19                 TZE     LI_FOLD_ALL

     3307    29839    5                   THEN            /* No listname specified */
     3308    29840    5                       GOTO LI_FOLD_ALL;
     3309    29841    5               END;

     3310    29842    4               BLK$ = OUT$ -> P$B.SUBLK$(0);

  29842 19 010156   200023 470500                    LDP0    OUT$,,AUTO
        19 010157   000003 236100                    LDQ     3,,PR0
        19 010160   200024 756100                    STQ     BLK$,,AUTO

     3311    29843        /*
     3312    29844             ***** Repeat this loop once for each piece of the address ...
     3313    29845        */
     3314    29846    5               DO INDX1 = 0 TO BLK$ -> P$B.NSUBLKS - 1;

  29846 19 010161   200033 450100                    STZ     INDX1,,AUTO
        19 010162   010234 710000 19                 TRA     s:29859+1

     3315    29847    5                   PTR1$ = BLK$ -> P$B.SUBLK$(INDX1);

  29847 19 010163   200024 470500                    LDP0    BLK$,,AUTO
        19 010164   200033 720100                    LXL0    INDX1,,AUTO
        19 010165   000003 236110                    LDQ     3,X0,PR0
        19 010166   200025 756100                    STQ     PTR1$,,AUTO

     3316    29848    6                   DO CASE (PTR1$ -> P$B.CODE);

  29848 19 010167   200025 471500                    LDP1    PTR1$,,AUTO
        19 010170   100000 721100                    LXL1    0,,PR1
        19 010171   000006 101003                    CMPX1   6,DU
        19 010172   010174 602011 19                 TNC     s:29848+5,X1
        19 010173   010233 710000 19                 TRA     s:29859
        19 010174   010233 710000 19                 TRA     s:29859
        19 010175   010233 710000 19                 TRA     s:29859
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:534  
        19 010176   010202 710000 19                 TRA     s:29850
        19 010177   010211 710000 19                 TRA     s:29852
        19 010200   010220 710000 19                 TRA     s:29854
        19 010201   010225 710000 19                 TRA     s:29857

     3317    29849    6                   CASE (%ADD_ACCT);

     3318    29850    6                       VM_RADDRESS.ACCT = PTR1$ -> P$S.TEXT;

  29850 19 010202   100004 236100                    LDQ     4,,PR1
        19 010203   000033 772000                    QRL     27
        19 010204   000000 622006                    EAX2    0,QL
        19 010205   040100 100540                    MLR     fill='040'O
        19 010206   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 010207   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8
        19 010210   010233 710000 19                 TRA     s:29859

     3319    29851    6                   CASE (%ADD_FOLDER);

     3320    29852    6                       VM_RADDRESS.FOLDER = PTR1$ -> P$S.TEXT;

  29852 19 010211   100004 236100                    LDQ     4,,PR1
        19 010212   000033 772000                    QRL     27
        19 010213   000000 622006                    EAX2    0,QL
        19 010214   040100 100540                    MLR     fill='040'O
        19 010215   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 010216   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
        19 010217   010233 710000 19                 TRA     s:29859

     3321    29853    6                   CASE (%ADD_NAME);

     3322    29854    6                       CALL XUR$ERRMSG (E_NAMENTALLOWED);

  29854 19 010220   000166 630400 20                 EPPR0   118
        19 010221   000024 631400 20                 EPPR1   20
        19 010222   000000 701000 xent               TSX1    XUR$ERRMSG
        19 010223   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:535  

     3323    29855    6                       GOTO CONTINUE;

  29855 19 010224   016452 710000 19                 TRA     CONTINUE

     3324    29856    6                   CASE (%ADD_PASS);

     3325    29857    6                       VM_RADDRESS.PASS = PTR1$ -> P$S.TEXT;

  29857 19 010225   100004 236100                    LDQ     4,,PR1
        19 010226   000033 772000                    QRL     27
        19 010227   000000 622006                    EAX2    0,QL
        19 010230   040100 100540                    MLR     fill='040'O
        19 010231   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 010232   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8

     3326    29858    6                   END;       /* Do case ... end */

     3327    29859    5               END;             /* Do INDX1 = ... end */

  29859 19 010233   200033 054100                    AOS     INDX1,,AUTO
        19 010234   200024 470500                    LDP0    BLK$,,AUTO
        19 010235   000001 236100                    LDQ     1,,PR0
        19 010236   000022 772000                    QRL     18
        19 010237   200033 116100                    CMPQ    INDX1,,AUTO
        19 010240   010163 605400 19                 TPNZ    s:29847

     3328    29860    4           END;                  /* Pick up options */

     3329    29861    3   LI_FOLD_ALL:
     3330    29862    3           FID_ACCT.ACCT# = VM_RADDRESS.ACCT;

  29862 19 010241   040000 100500       LI_FOLD_ALL  MLR     fill='040'O
        19 010242   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8
        19 010243   002215 000010 11                 ADSC9   FID_ACCT                 cn=0,n=8

     3331    29863    3           FID_PASS.PASS# = VM_RADDRESS.PASS;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:536  

  29863 19 010244   040000 100500                    MLR     fill='040'O
        19 010245   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8
        19 010246   002217 000010 11                 ADSC9   FID_PASS                 cn=0,n=8

     3332    29864    3           CLOSE_SAVE.V.DCB# = M$WORK_NUM;

  29864 19 010247   000000 720000 xsym               LXL0    M$WORK_NUM
        19 010250   002142 740000 11                 STX0    CLOSE_SAVE+26

     3333    29865        /*
     3334    29866             ***** Wildcard specified ???
     3335    29867        */
     3336    29868    3           IF VM_RADDRESS.FOLDER = 'CENTRAL'

  29868 19 010251   040000 106500                    CMPC    fill='040'O
        19 010252   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
        19 010253   001360 000007 12                 ADSC9   VM_PROKEY+3              cn=0,n=7
        19 010254   010260 601000 19                 TNZ     s:29871

     3337    29869    3           THEN                       /* Supply name of central folder */
     3338    29870    3               VM_RADDRESS.FOLDER = VM_CENTRAL_FOLDER.FOLDER;

  29870 19 010255   040100 100400                    MLR     fill='040'O
        19 010256   001137 400031 11                 ADSC9   VM_CENTRAL_FOLDER+3      cn=2,n=25
        19 010257   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25

     3339    29871    3           WILDCARD_PATTERN = VM_RADDRESS.FOLDER;

  29871 19 010260   040100 100500                    MLR     fill='040'O
        19 010261   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
        19 010262   200014 000031                    ADSC9   WILDCARD_PATTERN,,AUTO   cn=0,n=25

     3340    29872    3           CALL INDEX(INDX1,'?',WILDCARD_PATTERN)

  29872 19 010263   000000 124500                    SCM     mask='000'O
        19 010264   200014 000031                    ADSC9   WILDCARD_PATTERN,,AUTO   cn=0,n=25
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:537  
        19 010265   000225 000001 20                 ADSC9   149                      cn=0,n=1
        19 010266   200033 000100                    ARG     INDX1,,AUTO
        19 010267   010273 606400 19                 TTN     s:29877

     3341    29873    4           WHENRETURN DO;

     3342    29874    4               WILD = %YES#;

  29874 19 010270   400000 236003                    LDQ     -131072,DU
        19 010271   200041 756100                    STQ     WILD,,AUTO

     3343    29875    4           END;

  29875 19 010272   010274 710000 19                 TRA     s:29879

     3344    29876    4           WHENALTRETURN DO;

     3345    29877    4               WILD = %NO#;

  29877 19 010273   200041 450100                    STZ     WILD,,AUTO

     3346    29878    4           END;

     3347    29879    3           CALL INDEX(INDX1,' ',WILDCARD_PATTERN);

  29879 19 010274   000000 124500                    SCM     mask='000'O
        19 010275   200014 000031                    ADSC9   WILDCARD_PATTERN,,AUTO   cn=0,n=25
        19 010276   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 010277   200033 000100                    ARG     INDX1,,AUTO

     3348    29880    3           VM_WILDCARD.PATTERN_ = VECTOR(SUBSTR(WILDCARD_PATTERN,0,INDX1));

  29880 19 010300   200033 235100                    LDA     INDX1,,AUTO
        19 010301   000020 735000                    ALS     16
        19 010302   000140 135007                    SBLA    96,DL
        19 010303   201706 452500                    STP2    I+100,,AUTO
        19 010304   201706 236100                    LDQ     I+100,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:538  
        19 010305   000014 036003                    ADLQ    12,DU
        19 010306   001634 757000 11                 STAQ    VM_WILDCARD

     3349    29881    3           OPEN_NEXT.NAME_ = VECTOR(FID_NAME);

  29881 19 010307   000226 237000 20                 LDAQ    150
        19 010310   002302 757000 11                 STAQ    OPEN_NEXT+6

     3350    29882    3           FID_NAME.NAME# = ':MAIL_';

  29882 19 010311   040000 100400                    MLR     fill='040'O
        19 010312   001363 000006 12                 ADSC9   VM_PROKEY+6              cn=0,n=6
        19 010313   002205 200037 11                 ADSC9   FID_NAME                 cn=1,n=31

     3351    29883    3           FID_NAME.L# = LENGTHC(':MAIL_');

  29883 19 010314   006000 236003                    LDQ     3072,DU
        19 010315   002205 552040 11                 STBQ    FID_NAME,'40'O

     3352    29884    4           DO NEVER;

  29884 19 010316   010323 710000 19                 TRA     s:29888

     3353    29885    4   LI_FOLD_ERR1:
     3354    29886    4               CALL XUR$ERRMSG (E_FOLDEROLD, M$WORK_NUM);

  29886 19 010317   000157 630400 20    LI_FOLD_ERR1 EPPR0   111
        19 010320   000000 631400 20                 EPPR1   0
        19 010321   000000 701000 xent               TSX1    XUR$ERRMSG
        19 010322   000000 011000                    NOP     0

     3355    29887    4           END/*NEVER*/;

     3356    29888    3           CALL GET_WILD_FOLDER ALTRET(END_LI_FOLDER);

  29888 19 010323   016664 701000 19                 TSX1    GET_WILD_FOLDER
        19 010324   010447 702000 19                 TSX2    END_LI_FOLDER
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:539  

     3357    29889    3           CALL VMD$GET_PROFILE (M$WORK_NUM) ALTRET(LI_FOLD_ERR1);

  29889 19 010325   000133 630400 20                 EPPR0   91
        19 010326   000024 631400 20                 EPPR1   20
        19 010327   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 010330   010317 702000 19                 TSX2    LI_FOLD_ERR1

     3358    29890        /*
     3359    29891             ***** Print the header ...
     3360    29892        */
     3361    29893    3           CALL M$TIME (GET_TIME);

  29893 19 010331   002530 630400 11                 EPPR0   GET_TIME
        19 010332   020004 713400                    CLIMB   8196
        19 010333   402000 401760                    pmme    nvectors=5

     3362    29894                %INIT_STR (CODE=E_FOLDER_HEADER1_FMT, STR=VM_FOLDER_HEADER1_FMT,
     3363    29895                VECT="F_FDSLO.FMT_", TEST=YES);

  29902 19 010334   040000 106400                    CMPC    fill='040'O
        19 010335   003142 200120 11                 ADSC9   VM_FOLDER_HEADER1_FMT    cn=1,n=80
        19 010336   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 010337   010345 601000 19                 TNZ     s:29907

  29904 19 010340   000436 630400 20                 EPPR0   286
        19 010341   000021 631400 20                 EPPR1   17
        19 010342   000000 701000 xent               TSX1    VMD$ERRMSG
        19 010343   000000 011000                    NOP     0

  29905 19 010344   010353 710000 19                 TRA     s:29918

  29907 19 010345   003142 236000 11                 LDQ     VM_FOLDER_HEADER1_FMT
        19 010346   000033 772000                    QRL     27
        19 010347   000064 737000                    LLS     52
        19 010350   000140 135007                    SBLA    96,DL
        19 010351   000441 236000 20                 LDQ     289
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:540  
        19 010352   003040 757000 11                 STAQ    F_FDSLO

     3364    29918    3           VECT_ARRAY(0) = VECTOR(WORK_UTS);

  29918 19 010353   000442 237000 20                 LDAQ    290
        19 010354   003076 757000 11                 STAQ    VECT_ARRAY

     3365    29919    3           VECT_ARRAY(1) = VECTOR(FID_ACCT.ACCT#);

  29919 19 010355   000444 237000 20                 LDAQ    292
        19 010356   003100 757000 11                 STAQ    VECT_ARRAY+2

     3366    29920    3           F_FDSLO.NVECS# = 2;

  29920 19 010357   000002 235007                    LDA     2,DL
        19 010360   003051 755000 11                 STA     F_FDSLO+9

     3367    29921    3           F_FDSLO.DCB# = OUTDCB;

  29921 19 010361   000402 720000 11                 LXL0    OUTDCB
        19 010362   003053 740000 11                 STX0    F_FDSLO+11

     3368    29922    3           CALL VMD$WRITE_BUF (F_FDSLO);

  29922 19 010363   000322 630400 20                 EPPR0   210
        19 010364   000024 631400 20                 EPPR1   20
        19 010365   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 010366   000000 011000                    NOP     0

     3369    29923    3           F_FDSLO.NVECS# = 0;

  29923 19 010367   003051 450000 11                 STZ     F_FDSLO+9

     3370    29924                %INIT_STR (CODE=E_FOLDER_HEADER2_FMT, STR= VM_FOLDER_HEADER2_FMT,
     3371    29925                VECT="F_FDSLO.FMT_", TEST=YES);

  29932 19 010370   040000 106400                    CMPC    fill='040'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:541  
        19 010371   003167 200120 11                 ADSC9   VM_FOLDER_HEADER2_FMT    cn=1,n=80
        19 010372   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 010373   010401 601000 19                 TNZ     s:29937

  29934 19 010374   000446 630400 20                 EPPR0   294
        19 010375   000021 631400 20                 EPPR1   17
        19 010376   000000 701000 xent               TSX1    VMD$ERRMSG
        19 010377   000000 011000                    NOP     0

  29935 19 010400   010407 710000 19                 TRA     s:29948

  29937 19 010401   003167 236000 11                 LDQ     VM_FOLDER_HEADER2_FMT
        19 010402   000033 772000                    QRL     27
        19 010403   000064 737000                    LLS     52
        19 010404   000140 135007                    SBLA    96,DL
        19 010405   000451 236000 20                 LDQ     297
        19 010406   003040 757000 11                 STAQ    F_FDSLO

     3372    29948    3           CALL VMD$WRITE_BUF (F_FDSLO);

  29948 19 010407   000322 630400 20                 EPPR0   210
        19 010410   000024 631400 20                 EPPR1   20
        19 010411   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 010412   000000 011000                    NOP     0

     3373    29949    3           CALL VMD$DI_FOLDER (VM_WORK_FOLDER,OUTDCB);

  29949 19 010413   000452 630400 20                 EPPR0   298
        19 010414   000000 631400 20                 EPPR1   0
        19 010415   000000 701000 xent               TSX1    VMD$DI_FOLDER
        19 010416   000000 011000                    NOP     0

     3374    29950    3           OPEN_NEXT.NAME_ = VECTOR(NIL);

  29950 19 010417   000230 237000 20                 LDAQ    152
        19 010420   002302 757000 11                 STAQ    OPEN_NEXT+6

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:542  
     3375    29951    3           INDX2 = 1;

  29951 19 010421   000001 235007                    LDA     1,DL
        19 010422   000375 755000 11                 STA     INDX2

     3376    29952        /*
     3377    29953             ***** If wildcard specified, loop to process other matches ...
     3378    29954        */
     3379    29955    4           DO WHILE WILD;

  29955 19 010423   200041 234100                    SZN     WILD,,AUTO
        19 010424   010447 605000 19                 TPL     END_LI_FOLDER

     3380    29956    5               DO NEVER;

  29956 19 010425   010432 710000 19                 TRA     s:29960

  29955 19 010426                       LI_FOLD_ERR2 null
     3381    29957    5   LI_FOLD_ERR2:   ;
     3382    29958    5                   CALL XUR$ERRMSG (E_FOLDEROLD, M$WORK_NUM);

  29958 19 010426   000157 630400 20                 EPPR0   111
        19 010427   000000 631400 20                 EPPR1   0
        19 010430   000000 701000 xent               TSX1    XUR$ERRMSG
        19 010431   000000 011000                    NOP     0

     3383    29959    5               END/*NEVER*/;

     3384    29960    4               CALL GET_WILD_FOLDER ALTRET(END_LI_FOLDER);

  29960 19 010432   016664 701000 19                 TSX1    GET_WILD_FOLDER
        19 010433   010447 702000 19                 TSX2    END_LI_FOLDER

     3385    29961    4               CALL VMD$GET_PROFILE (M$WORK_NUM) ALTRET(LI_FOLD_ERR2);

  29961 19 010434   000133 630400 20                 EPPR0   91
        19 010435   000024 631400 20                 EPPR1   20
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:543  
        19 010436   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 010437   010426 702000 19                 TSX2    LI_FOLD_ERR2

     3386    29962    4               CALL VMD$DI_FOLDER (VM_WORK_FOLDER,OUTDCB);

  29962 19 010440   000452 630400 20                 EPPR0   298
        19 010441   000000 631400 20                 EPPR1   0
        19 010442   000000 701000 xent               TSX1    VMD$DI_FOLDER
        19 010443   000000 011000                    NOP     0

     3387    29963    4               INDX2 = INDX2 + 1;

  29963 19 010444   000375 054000 11                 AOS     INDX2

     3388    29964    4           END/*WHILE WILD*/;

  29964 19 010445   200041 234100                    SZN     WILD,,AUTO
        19 010446   010425 604000 19                 TMI     s:29956

     3389    29965        /*
     3390    29966             ***** Get the profile for the current folder ...
     3391    29967        */
     3392    29968    3   END_LI_FOLDER:
     3393    29969    3           VM_CURRENT_FOLDER.FLAGS.OPEN = FOLDER_WAS_OPEN;

  29969 19 010447   000404 236000 11    END_LI_FOLD* LDQ     FOLDER_WAS_OPEN
        19 010450   000005 772000                    QRL     5
        19 010451   001266 676000 11                 ERQ     VM_CURRENT_FOLDER+19
        19 010452   010000 376003                    ANQ     4096,DU
        19 010453   001266 656000 11                 ERSQ    VM_CURRENT_FOLDER+19

     3394    29970    3           IF DCBADDR(M$WORK_NUM) -> F$DCB.FCD#

  29970 19 010454   000074 470400 20                 LDP0    60
        19 010455   000000 471500                    LDP1    0,,PR0
        19 010456   000000 720000 xsym               LXL0    M$WORK_NUM
        19 010457   100000 473510                    LDP3    0,X0,PR1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:544  
        19 010460   300031 236100                    LDQ     25,,PR3
        19 010461   020000 316007                    CANQ    8192,DL
        19 010462   010467 600000 19                 TZE     s:29973

     3395    29971    3           THEN                       /* Close it */
     3396    29972    3               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  29972 19 010463   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 010464   450001 713400                    CLIMB   alt,close
        19 010465   406000 401760                    pmme    nvectors=13
        19 010466   016514 702000 19                 TSX2    E_PMME

     3397    29973    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN

  29973 19 010467   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 010470   010000 316003                    CANQ    4096,DU
        19 010471   010476 600000 19                 TZE     s:29976

     3398    29974    3           THEN
     3399    29975    3               CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);

  29975 19 010472   000053 630400 20                 EPPR0   43
        19 010473   000024 631400 20                 EPPR1   20
        19 010474   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 010475   016454 702000 19                 TSX2    BAD_PROFILE

     3400    29976    3           BREAK_TYPE = 0;

  29976 19 010476   000400 450000 11                 STZ     BREAK_TYPE

     3401    29977    3           CALL REPORT_ACTIVITY (INDX2,VM_FOLDER_DISPLAYED_FMT,%NO#,
             29977                    E_FOLDER_DISPLAYED_FMT);

  29977 19 010477   000454 236000 20                 LDQ     300
        19 010500   201122 756100                    STQ     @NAME+1,,AUTO
        19 010501   000456 237000 20                 LDAQ    302
        19 010502   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:545  
        19 010503   000154 236000 20                 LDQ     108
        19 010504   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 010505   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 010506   000000 011000                    NOP     0
        19 010507   016452 710000 19                 TRA     CONTINUE

     3402    29978        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:546  
     3403    29979        /* List command */
     3404    29980    3       CASE (%CMD_LIST_MESSAGE);

     3405    29981    3           CALL NEED_FOLDER ALTRET(CONTINUE);

  29981 19 010510   016547 701000 19                 TSX1    NEED_FOLDER
        19 010511   016452 702000 19                 TSX2    CONTINUE

     3406    29982    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;

  29982 19 010512   200033 450100                    STZ     INDX1,,AUTO
        19 010513   010566 710000 19                 TRA     s:29997+1

     3407    29983    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);

  29983 19 010514   200023 470500                    LDP0    OUT$,,AUTO
        19 010515   200033 720100                    LXL0    INDX1,,AUTO
        19 010516   000003 236110                    LDQ     3,X0,PR0
        19 010517   200024 756100                    STQ     BLK$,,AUTO

     3408    29984    5               DO CASE (BLK$ -> P$B.CODE);

  29984 19 010520   200024 471500                    LDP1    BLK$,,AUTO
        19 010521   100000 721100                    LXL1    0,,PR1
        19 010522   000006 101003                    CMPX1   6,DU
        19 010523   010525 602011 19                 TNC     s:29984+5,X1
        19 010524   010565 710000 19                 TRA     s:29997
        19 010525   010565 710000 19                 TRA     s:29997
        19 010526   010565 710000 19                 TRA     s:29997
        19 010527   010533 710000 19                 TRA     s:29986
        19 010530   010565 710000 19                 TRA     s:29997
        19 010531   010565 710000 19                 TRA     s:29997
        19 010532   010542 710000 19                 TRA     s:29988

     3409    29985    5               CASE (%OPT_SELECT);

     3410    29986    5                   CALL INIT$SELECT_OPTS (BLK$,%CMD_LIST_MESSAGE) ALTRET(CONTINUE);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:547  

  29986 19 010533   000461 236000 20                 LDQ     305
        19 010534   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 010535   200024 633500                    EPPR3   BLK$,,AUTO
        19 010536   201117 453500                    STP3    @CURR_COMMAND_CODE+2,,AUTO
        19 010537   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 010540   016452 702000 19                 TSX2    CONTINUE
        19 010541   010565 710000 19                 TRA     s:29997

     3411    29987    5               CASE (%OPT_OUTPUT);

     3412    29988    5                   CALL XUR$OPENOUT (M$OUT_NUM, BLK$ -> P$B)

  29988 19 010542   000265 235000 20                 LDA     181
        19 010543   201706 757100                    STAQ    I+100,,AUTO
        19 010544   201706 630500                    EPPR0   I+100,,AUTO
        19 010545   000000 631400 20                 EPPR1   0
        19 010546   000000 701000 xent               TSX1    XUR$OPENOUT
        19 010547   010553 702000 19                 TSX2    s:29993

     3413    29989    6                   WHENRETURN DO;

     3414    29990    6                       OUTDCB = M$OUT_NUM;

  29990 19 010550   000075 235000 12                 LDA     M$OUT_NUM
        19 010551   000402 755000 11                 STA     OUTDCB

     3415    29991    6                   END;

  29991 19 010552   010565 710000 19                 TRA     s:29997

     3416    29992    6                   WHENALTRETURN DO;

     3417    29993    6                       CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$OUT_NUM);

  29993 19 010553   000265 236000 20                 LDQ     181
        19 010554   201707 756100                    STQ     I+101,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:548  
        19 010555   200003 236100                    LDQ     XUG_GETCMD$,,AUTO
        19 010556   000001 036003                    ADLQ    1,DU
        19 010557   201706 756100                    STQ     I+100,,AUTO
        19 010560   201706 630500                    EPPR0   I+100,,AUTO
        19 010561   000000 631400 20                 EPPR1   0
        19 010562   000000 701000 xent               TSX1    XUR$ERRMSG
        19 010563   000000 011000                    NOP     0

     3418    29994    6                       GOTO CONTINUE;

  29994 19 010564   016452 710000 19                 TRA     CONTINUE

     3419    29995    6                   END;
     3420    29996    5               END;

     3421    29997    4           END;

  29997 19 010565   200033 054100                    AOS     INDX1,,AUTO
        19 010566   200023 470500                    LDP0    OUT$,,AUTO
        19 010567   000001 236100                    LDQ     1,,PR0
        19 010570   000022 772000                    QRL     18
        19 010571   200033 116100                    CMPQ    INDX1,,AUTO
        19 010572   010514 605400 19                 TPNZ    s:29983

     3422    29998    3           LAST_COMMAND_CODE = %CMD_LIST_MESSAGE;

  29998 19 010573   000027 235007                    LDA     23,DL
        19 010574   000544 755000 11                 STA     LAST_COMMAND_CODE

     3423    29999
     3424    30000    3           INDX1 = 0;                  /* Used as counter */

  30000 19 010575   200033 450100                    STZ     INDX1,,AUTO

     3425    30001    3           EJECT = VM_PROFILE.OPT.PAGE;

  30001 19 010576   000000 471400 xsym               LDP1    VM_PROFILE$
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:549  
        19 010577   100000 236100                    LDQ     0,,PR1
        19 010600   000037 736000                    QLS     31
        19 010601   400000 376003                    ANQ     -131072,DU
        19 010602   200347 756100                    STQ     EJECT,,AUTO

     3426    30002
     3427    30003    4           DO FOREVER;

     3428    30004
     3429    30005    4               CALL GET$MESSAGE ALTRET(END_LIST);

  30005 19 010603   020536 701000 19                 TSX1    GET$MESSAGE
        19 010604   010675 702000 19                 TSX2    END_LIST

     3430    30006    4               IF EJECT

  30006 19 010605   200347 234100                    SZN     EJECT,,AUTO
        19 010606   010614 605000 19                 TPL     s:30011

     3431    30007    5               THEN DO;

     3432    30008    5                   CALL VMD$EJECT (OUTDCB);

  30008 19 010607   000301 630400 20                 EPPR0   193
        19 010610   000024 631400 20                 EPPR1   20
        19 010611   000000 701000 xent               TSX1    VMD$EJECT
        19 010612   000000 011000                    NOP     0

     3433    30009    5                   EJECT = %NO#;

  30009 19 010613   200347 450100                    STZ     EJECT,,AUTO

     3434    30010    5               END;

     3435    30011    4               VM_PROFILE.HI_MESSAGE_NUMBER =

  30011 19 010614   000072 236000 11                 LDQ     CURRENT_MESSAGE_NUMBER
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:550  
        19 010615   000000 470400 xsym               LDP0    VM_PROFILE$
        19 010616   010621 604000 19                 TMI     s:30011+5
        19 010617   000011 116100                    CMPQ    9,,PR0
        19 010620   010622 603000 19                 TRC     s:30011+6
        19 010621   000011 236100                    LDQ     9,,PR0
        19 010622   000011 756100                    STQ     9,,PR0

     3436    30012    4                 MAXIMUM( VM_PROFILE.HI_MESSAGE_NUMBER , CURRENT_MESSAGE_NUMBER );
     3437    30013    4               CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,OUTDCB);

  30013 19 010623   000301 236000 20                 LDQ     193
        19 010624   201710 756100                    STQ     I+102,,AUTO
        19 010625   000103 236000 20                 LDQ     67
        19 010626   000000 235000 xsym               LDA     VM_HEADER$
        19 010627   201706 757100                    STAQ    I+100,,AUTO
        19 010630   201706 630500                    EPPR0   I+100,,AUTO
        19 010631   000021 631400 20                 EPPR1   17
        19 010632   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 010633   000000 011000                    NOP     0

     3438    30014    4               INDX1 = INDX1 + 1;

  30014 19 010634   200033 054100                    AOS     INDX1,,AUTO

     3439    30015    4               IF VM_CURRENT_FOLDER.FLAGS.UPDATE

  30015 19 010635   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 010636   010603 605000 19                 TPL     s:30005
        19 010637   000000 470400 xsym               LDP0    VM_HEADER$
        19 010640   000012 236100                    LDQ     10,,PR0
        19 010641   002000 316003                    CANQ    1024,DU
        19 010642   010603 601000 19                 TNZ     s:30005
        19 010643   004000 316003                    CANQ    2048,DU
        19 010644   010603 601000 19                 TNZ     s:30005

     3440    30016    4                 AND VM_HEADER.STATUS.MAKE_OLD = %NO#
     3441    30017    4                 AND VM_HEADER.STATUS.OLD = %NO#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:551  
     3442    30018    4               THEN
     3443    30019    5               DO;

     3444    30020    5                   CALL XUR$DISABLE;

  30020 19 010645   000020 631400 20                 EPPR1   16
        19 010646   000000 701000 xent               TSX1    XUR$DISABLE
        19 010647   000000 011000                    NOP     0

     3445    30021    5                   VM_HEADER.STATUS.MAKE_OLD = %YES#;

  30021 19 010650   000000 470400 xsym               LDP0    VM_HEADER$
        19 010651   002000 236003                    LDQ     1024,DU
        19 010652   000012 256100                    ORSQ    10,,PR0

     3446    30022    5                   CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM)

  30022 19 010653   000120 630400 20                 EPPR0   80
        19 010654   000000 631400 20                 EPPR1   0
        19 010655   000000 701000 xent               TSX1    VMD$PUT_HEADER
        19 010656   000000 011000                    NOP     0

     3447    30023    5                     ;
     3448    30024    5                   VM_PROFILE.NUM_MOLD_MESSAGES = VM_PROFILE.NUM_MOLD_MESSAGES + 1;

  30024 19 010657   000000 470400 xsym               LDP0    VM_PROFILE$
        19 010660   000010 235100                    LDA     8,,PR0
        19 010661   000001 035007                    ADLA    1,DL
        19 010662   000010 755100                    STA     8,,PR0

     3449    30025    5                   MADE_OLD = %YES#;

  30025 19 010663   400000 236003                    LDQ     -131072,DU
        19 010664   200040 756100                    STQ     MADE_OLD,,AUTO

     3450    30026    5                   CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(WRITE_ERROR);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:552  
  30026 19 010665   000053 236000 20                 LDQ     43
        19 010666   201523 756100                    STQ     INDX2+255,,AUTO
        19 010667   021320 701000 19                 TSX1    PUT_PROFILE
        19 010670   016477 702000 19                 TSX2    WRITE_ERROR

     3451    30027    5                   CALL XUR$ENABLE;

  30027 19 010671   000020 631400 20                 EPPR1   16
        19 010672   000000 701000 xent               TSX1    XUR$ENABLE
        19 010673   000000 011000                    NOP     0

     3452    30028    5               END;

     3453    30029    4           END;                       /* Do forever ... end */

  30029 19 010674   010603 710000 19                 TRA     s:30005

     3454    30030    3   END_LIST:
     3455    30031    3           IF INDX1 ~= 1 OR NOT DCBADDR(OUTDCB) -> F$DCB.DDEV.UCOUT#

  30031 19 010675   200033 235100       END_LIST     LDA     INDX1,,AUTO
        19 010676   000001 115007                    CMPA    1,DL
        19 010677   010707 601000 19                 TNZ     s:30033
        19 010700   000074 470400 20                 LDP0    60
        19 010701   000000 471500                    LDP1    0,,PR0
        19 010702   000402 720000 11                 LXL0    OUTDCB
        19 010703   100000 473510                    LDP3    0,X0,PR1
        19 010704   300004 236100                    LDQ     4,,PR3
        19 010705   020000 316007                    CANQ    8192,DL
        19 010706   016452 601000 19                 TNZ     CONTINUE

     3456    30032    3           THEN
     3457    30033    3              CALL REPORT_ACTIVITY (INDX1,VM_MSGS_LISTED_FMT,%YES#,E_MSGS_LISTED_FMT);

  30033 19 010707   000462 236000 20                 LDQ     306
        19 010710   201122 756100                    STQ     @NAME+1,,AUTO
        19 010711   000464 237000 20                 LDAQ    308
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:553  
        19 010712   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 010713   200033 630500                    EPPR0   INDX1,,AUTO
        19 010714   201117 450500                    STP0    @CURR_COMMAND_CODE+2,,AUTO
        19 010715   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 010716   000000 011000                    NOP     0
        19 010717   016452 710000 19                 TRA     CONTINUE

     3458    30034        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:554  
     3459    30035        /* Mark command */
     3460    30036    3       CASE(%CMD_MARK_MESSAGE);

     3461    30037    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  30037 19 010720   016562 701000 19                 TSX1    NEED_UPDATE
        19 010721   016452 702000 19                 TSX2    CONTINUE

     3462    30038    3           IF OUT$ -> P$B.NSUBLKS > 0

  30038 19 010722   200023 470500                    LDP0    OUT$,,AUTO
        19 010723   000001 220100                    LDX0    1,,PR0
        19 010724   010734 600000 19                 TZE     s:30041

     3463    30039    3           THEN                       /* There are options */
     3464    30040    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_MARK_MESSAGE) ALTRET(
             30040                        CONTINUE);

  30040 19 010725   000467 236000 20                 LDQ     311
        19 010726   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 010727   200023 236100                    LDQ     OUT$,,AUTO
        19 010730   000003 036003                    ADLQ    3,DU
        19 010731   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 010732   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 010733   016452 702000 19                 TSX2    CONTINUE

     3465    30041    3           INDX1 = 0;                  /* Used as counter */

  30041 19 010734   200033 450100                    STZ     INDX1,,AUTO

     3466    30042    3           NONE = %YES#;

  30042 19 010735   400000 236003                    LDQ     -131072,DU
        19 010736   200037 756100                    STQ     NONE,,AUTO

     3467    30043    4           DO FOREVER;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:555  
     3468    30044    4               CALL GET$MESSAGE ALTRET(END_MARK);

  30044 19 010737   020536 701000 19                 TSX1    GET$MESSAGE
        19 010740   011002 702000 19                 TSX2    END_MARK

     3469    30045    4               NONE = %NO#;

  30045 19 010741   200037 450100                    STZ     NONE,,AUTO

     3470    30046
     3471    30047    4               IF VM_PROFILE.OPT.HEADERS

  30047 19 010742   000000 470400 xsym               LDP0    VM_PROFILE$
        19 010743   000000 236100                    LDQ     0,,PR0
        19 010744   000400 316007                    CANQ    256,DL
        19 010745   010757 600000 19                 TZE     s:30051

     3472    30048    4               THEN
     3473    30049    4                   CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,M$LO_NUM);

  30049 19 010746   000470 236000 20                 LDQ     312
        19 010747   201710 756100                    STQ     I+102,,AUTO
        19 010750   000103 236000 20                 LDQ     67
        19 010751   000000 235000 xsym               LDA     VM_HEADER$
        19 010752   201706 757100                    STAQ    I+100,,AUTO
        19 010753   201706 630500                    EPPR0   I+100,,AUTO
        19 010754   000021 631400 20                 EPPR1   17
        19 010755   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 010756   000000 011000                    NOP     0

     3474    30050
     3475    30051    4               IF VM_HEADER.STATUS.MARK = %NO#

  30051 19 010757   000000 470400 xsym               LDP0    VM_HEADER$
        19 010760   000012 236100                    LDQ     10,,PR0
        19 010761   000100 316003                    CANQ    64,DU
        19 010762   010737 601000 19                 TNZ     s:30044
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:556  

     3476    30052    4               THEN                 /* Mark it now */
     3477    30053    5               DO;

     3478    30054    5                   CALL XUR$DISABLE;

  30054 19 010763   000020 631400 20                 EPPR1   16
        19 010764   000000 701000 xent               TSX1    XUR$DISABLE
        19 010765   000000 011000                    NOP     0

     3479    30055    5                   VM_HEADER.STATUS.MARK = %YES#;

  30055 19 010766   000000 470400 xsym               LDP0    VM_HEADER$
        19 010767   000100 236003                    LDQ     64,DU
        19 010770   000012 256100                    ORSQ    10,,PR0

     3480    30056    5                   CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM);

  30056 19 010771   000120 630400 20                 EPPR0   80
        19 010772   000000 631400 20                 EPPR1   0
        19 010773   000000 701000 xent               TSX1    VMD$PUT_HEADER
        19 010774   000000 011000                    NOP     0

     3481    30057    5                   CALL XUR$ENABLE;

  30057 19 010775   000020 631400 20                 EPPR1   16
        19 010776   000000 701000 xent               TSX1    XUR$ENABLE
        19 010777   000000 011000                    NOP     0

     3482    30058    5                   INDX1 = INDX1 + 1;

  30058 19 011000   200033 054100                    AOS     INDX1,,AUTO

     3483    30059    5               END;

     3484    30060    4           END;                       /* Do forever ... end  */

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:557  
  30060 19 011001   010737 710000 19                 TRA     s:30044

  30055 19 011002                       END_MARK     null
     3485    30061
     3486    30062    3   END_MARK: ;
     3487    30063    3           CALL REPORT_ACTIVITY (INDX1,VM_MSGS_MARKED_FMT,NONE,E_MSGS_MARKED_FMT);

  30063 19 011002   000471 236000 20                 LDQ     313
        19 011003   201122 756100                    STQ     @NAME+1,,AUTO
        19 011004   200037 630500                    EPPR0   NONE,,AUTO
        19 011005   201121 450500                    STP0    @SITENAME+1,,AUTO
        19 011006   000472 236000 20                 LDQ     314
        19 011007   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 011010   200033 631500                    EPPR1   INDX1,,AUTO
        19 011011   201117 451500                    STP1    @CURR_COMMAND_CODE+2,,AUTO
        19 011012   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 011013   000000 011000                    NOP     0
        19 011014   016452 710000 19                 TRA     CONTINUE

     3488    30064
     3489    30065        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:558  
     3490    30066        /* Modify list command */
     3491    30067    3       CASE (%CMD_MODIFY_LIST);

     3492    30068    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  30068 19 011015   016562 701000 19                 TSX1    NEED_UPDATE
        19 011016   016452 702000 19                 TSX2    CONTINUE

     3493    30069        /*
     3494    30070             ***** Pickup the name of the list to modify ...
     3495    30071        */
     3496    30072    3           VM_LISTKEY.TEXT = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;

  30072 19 011017   200023 470500                    LDP0    OUT$,,AUTO
        19 011020   000003 471500                    LDP1    3,,PR0
        19 011021   100004 236100                    LDQ     4,,PR1
        19 011022   000033 772000                    QRL     27
        19 011023   000000 620006                    EAX0    0,QL
        19 011024   040000 100540                    MLR     fill='040'O
        19 011025   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 011026   000554 400310 11                 ADSC9   VM_LISTKEY               cn=2,n=200

     3497    30073    3           CALL VMA$GET_LIST (VM_LISTKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)

  30073 19 011027   000202 630400 20                 EPPR0   130
        19 011030   000021 631400 20                 EPPR1   17
        19 011031   000000 701000 xent               TSX1    VMA$GET_LIST
        19 011032   011034 702000 19                 TSX2    s:30076
        19 011033   011041 710000 19                 TRA     REPARSE

     3498    30074    3           WHENALTRETURN
     3499    30075    4           DO;

     3500    30076    4               CALL XUR$ERRMSG(E_UNDEFENTRY);

  30076 19 011034   000473 630400 20                 EPPR0   315
        19 011035   000024 631400 20                 EPPR1   20
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:559  
        19 011036   000000 701000 xent               TSX1    XUR$ERRMSG
        19 011037   000000 011000                    NOP     0

     3501    30077    4               GOTO MOD_CASE_END;

  30077 19 011040   011416 710000 19                 TRA     MOD_CASE_END

     3502    30078        /*
     3503    30079             ***** Report that the specified list does not exist ...
     3504    30080        */
     3505    30081    4           END;
     3506    30082        /*
     3507    30083             ***** Now prompt for sub-commands ...
     3508    30084        */
     3509    30085    4           DO FOREVER;

     3510    30086    4   REPARSE:
     3511    30087                    %INIT_STR (CODE=E_MODIFY_LIST_PROMPT, STR=VM_MODIFY_LIST_PROMPT, TEST=
             30087                        YES);

  30092 19 011041                       REPARSE      null
  30094 19 011041   040000 106400                    CMPC    fill='040'O
        19 011042   000407 200017 11                 ADSC9   VM_MODIFY_LIST_PROMPT    cn=1,n=15
        19 011043   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 011044   011051 601000 19                 TNZ     s:30110

  30096 19 011045   000474 630400 20                 EPPR0   316
        19 011046   000000 631400 20                 EPPR1   0
        19 011047   000000 701000 xent               TSX1    VMD$ERRMSG
        19 011050   000000 011000                    NOP     0

     3512    30110    4               CALL XUR$GETCMD(MODIFY_LIST$->BSD,OUT$,

  30110 19 011051   000407 236000 11                 LDQ     VM_MODIFY_LIST_PROMPT
        19 011052   000033 772000                    QRL     27
        19 011053   000064 737000                    LLS     52
        19 011054   000140 135007                    SBLA    96,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:560  
        19 011055   000476 236000 20                 LDQ     318
        19 011056   201706 757100                    STAQ    I+100,,AUTO
        19 011057   201706 630500                    EPPR0   I+100,,AUTO
        19 011060   201712 450500                    STP0    I+104,,AUTO
        19 011061   200023 631500                    EPPR1   OUT$,,AUTO
        19 011062   201711 451500                    STP1    I+103,,AUTO
        19 011063   200007 236100                    LDQ     MODIFY_LIST$,,AUTO
        19 011064   201710 756100                    STQ     I+102,,AUTO
        19 011065   201710 630500                    EPPR0   I+102,,AUTO
        19 011066   000021 631400 20                 EPPR1   17
        19 011067   000000 701000 xent               TSX1    XUR$GETCMD
        19 011070   011072 702000 19                 TSX2    s:30113
        19 011071   011104 710000 19                 TRA     s:30120

     3513    30111    4                VECTOR(SUBSTR(VM_MODIFY_LIST_PROMPT.NAME#,0,VM_MODIFY_LIST_PROMPT.L#))
             30111                          )
     3514    30112    5               WHENALTRETURN DO;

     3515    30113    5                   CALL XUR$ERRPTR;

  30113 19 011072   000020 631400 20                 EPPR1   16
        19 011073   000000 701000 xent               TSX1    XUR$ERRPTR
        19 011074   000000 011000                    NOP     0

     3516    30114    5                   CALL XUR$ERRMSG (OUTERR);

  30114 19 011075   200023 630500                    EPPR0   OUT$,,AUTO
        19 011076   201706 450500                    STP0    I+100,,AUTO
        19 011077   201706 630500                    EPPR0   I+100,,AUTO
        19 011100   000024 631400 20                 EPPR1   20
        19 011101   000000 701000 xent               TSX1    XUR$ERRMSG
        19 011102   000000 011000                    NOP     0

     3517    30115    5                   GOTO REPARSE;

  30115 19 011103   011041 710000 19                 TRA     REPARSE

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:561  
     3518    30116    5               END;
     3519    30117        /*
     3520    30118             ***** Initialize ...
     3521    30119        */
     3522    30120    4               ADDRESS_ACCT.ACCT# = ' ';

  30120 19 011104   000035 235000 20                 LDA     29
        19 011105   000035 236000 20                 LDQ     29
        19 011106   200042 757100                    STAQ    ADDRESS_ACCT,,AUTO

     3523    30121    4               ADDRESS_NAME.L# = 0;

  30121 19 011107   000000 236003                    LDQ     0,DU
        19 011110   200051 552140                    STBQ    ADDRESS_NAME,'40'O,AUTO

     3524    30122    4               ADDRESS_NAME.NAME# = ' ';

  30122 19 011111   040100 100400                    MLR     fill='040'O
        19 011112   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 011113   200051 200777                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=511

     3525    30123    4               ADDRESS_FOLDER = ' ';

  30123 19 011114   040100 100400                    MLR     fill='040'O
        19 011115   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 011116   200253 000031                    ADSC9   ADDRESS_FOLDER,,AUTO     cn=0,n=25

     3526    30124    4               ADDRESS_PASS.PASS# = ' ';

  30124 19 011117   000035 235000 20                 LDA     29
        19 011120   000035 236000 20                 LDQ     29
        19 011121   200251 755100                    STA     ADDRESS_PASS,,AUTO
        19 011122   200252 756100                    STQ     ADDRESS_PASS+1,,AUTO

     3527    30125    4               ADDRESS_SITENAME = ' ';

  30125 19 011123   000035 235000 20                 LDA     29
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:562  
        19 011124   000035 236000 20                 LDQ     29
        19 011125   200262 757100                    STAQ    ADDRESS_SITENAME,,AUTO

     3528    30126    4               DOMAIN$ = ADDR(NIL);

  30126 19 011126   000022 236000 20                 LDQ     18
        19 011127   200264 756100                    STQ     DOMAIN$,,AUTO

     3529    30127    4               IF OUT$ -> P$B.NSUBLKS = 0

  30127 19 011130   200023 470500                    LDP0    OUT$,,AUTO
        19 011131   000001 220100                    LDX0    1,,PR0
        19 011132   011246 600000 19                 TZE     PROCESS_MODLIST_SUBC

     3530    30128    4               THEN
     3531    30129    4                   GOTO PROCESS_MODLIST_SUBC;
     3532    30130        /*
     3533    30131             ***** Repeat this loop once for each piece of the address ...
     3534    30132        */
     3535    30133    4               PTR2$ = OUT$ -> P$B.SUBLK$(0); /* Ptr to OPT_ADDRESS */

  30133 19 011133   000003 236100                    LDQ     3,,PR0
        19 011134   200026 756100                    STQ     PTR2$,,AUTO

     3536    30134    5               DO INDX3 = 0 TO PTR2$ -> P$B.NSUBLKS - 1;

  30134 19 011135   200034 450100                    STZ     INDX3,,AUTO
        19 011136   011231 710000 19                 TRA     s:30151+1

     3537    30135    5                   PTR3$ = PTR2$ -> P$B.SUBLK$(INDX3);

  30135 19 011137   200026 470500                    LDP0    PTR2$,,AUTO
        19 011140   200034 720100                    LXL0    INDX3,,AUTO
        19 011141   000003 236110                    LDQ     3,X0,PR0
        19 011142   200027 756100                    STQ     PTR3$,,AUTO

     3538    30136    6                   DO CASE (PTR3$ -> P$B.CODE);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:563  

  30136 19 011143   200027 471500                    LDP1    PTR3$,,AUTO
        19 011144   100000 721100                    LXL1    0,,PR1
        19 011145   000012 101003                    CMPX1   10,DU
        19 011146   011150 602011 19                 TNC     s:30136+5,X1
        19 011147   011230 710000 19                 TRA     s:30151
        19 011150   011230 710000 19                 TRA     s:30151
        19 011151   011230 710000 19                 TRA     s:30151
        19 011152   011162 710000 19                 TRA     s:30138
        19 011153   011171 710000 19                 TRA     s:30140
        19 011154   011200 710000 19                 TRA     s:30142
        19 011155   011211 710000 19                 TRA     s:30145
        19 011156   011220 710000 19                 TRA     s:30147
        19 011157   011230 710000 19                 TRA     s:30151
        19 011160   011230 710000 19                 TRA     s:30151
        19 011161   011227 710000 19                 TRA     s:30149

     3539    30137    6                   CASE (%ADD_ACCT);

     3540    30138    6                       ADDRESS_ACCT.ACCT# = PTR3$ -> P$S.TEXT;

  30138 19 011162   100004 236100                    LDQ     4,,PR1
        19 011163   000033 772000                    QRL     27
        19 011164   000000 622006                    EAX2    0,QL
        19 011165   040100 100540                    MLR     fill='040'O
        19 011166   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011167   200042 000010                    ADSC9   ADDRESS_ACCT,,AUTO       cn=0,n=8
        19 011170   011230 710000 19                 TRA     s:30151

     3541    30139    6                   CASE (%ADD_FOLDER);

     3542    30140    6                       ADDRESS_FOLDER = PTR3$ -> P$S.TEXT;

  30140 19 011171   100004 236100                    LDQ     4,,PR1
        19 011172   000033 772000                    QRL     27
        19 011173   000000 622006                    EAX2    0,QL
        19 011174   040100 100540                    MLR     fill='040'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:564  
        19 011175   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011176   200253 000031                    ADSC9   ADDRESS_FOLDER,,AUTO     cn=0,n=25
        19 011177   011230 710000 19                 TRA     s:30151

     3543    30141    6                   CASE (%ADD_NAME);

     3544    30142    6                       ADDRESS_NAME.NAME# = PTR3$ -> P$S.TEXT;

  30142 19 011200   100004 236100                    LDQ     4,,PR1
        19 011201   000033 772000                    QRL     27
        19 011202   000000 622006                    EAX2    0,QL
        19 011203   040100 100540                    MLR     fill='040'O
        19 011204   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011205   200051 200777                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=511

     3545    30143    6                       ADDRESS_NAME.L# = PTR3$ -> P$S.COUNT;

  30143 19 011206   100004 236100                    LDQ     4,,PR1
        19 011207   200051 552140                    STBQ    ADDRESS_NAME,'40'O,AUTO
        19 011210   011230 710000 19                 TRA     s:30151

     3546    30144    6                   CASE (%ADD_PASS);

     3547    30145    6                       ADDRESS_PASS.PASS# = PTR3$ -> P$S.TEXT;

  30145 19 011211   100004 236100                    LDQ     4,,PR1
        19 011212   000033 772000                    QRL     27
        19 011213   000000 622006                    EAX2    0,QL
        19 011214   040100 100540                    MLR     fill='040'O
        19 011215   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011216   200251 000010                    ADSC9   ADDRESS_PASS,,AUTO       cn=0,n=8
        19 011217   011230 710000 19                 TRA     s:30151

     3548    30146    6                   CASE (%ADD_SITE);

     3549    30147    6                       ADDRESS_SITENAME = PTR3$ -> P$S.TEXT;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:565  
  30147 19 011220   100004 236100                    LDQ     4,,PR1
        19 011221   000033 772000                    QRL     27
        19 011222   000000 622006                    EAX2    0,QL
        19 011223   040100 100540                    MLR     fill='040'O
        19 011224   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011225   200262 000010                    ADSC9   ADDRESS_SITENAME,,AUTO   cn=0,n=8
        19 011226   011230 710000 19                 TRA     s:30151

     3550    30148    6                   CASE (%ADD_DOMAIN);

     3551    30149    6                       DOMAIN$ = PTR3$;

  30149 19 011227   200264 756100                    STQ     DOMAIN$,,AUTO

     3552    30150    6                   END;            /* Do case ... end */

     3553    30151    5               END;                  /* Do INDX3 = ... end */

  30151 19 011230   200034 054100                    AOS     INDX3,,AUTO
        19 011231   200026 470500                    LDP0    PTR2$,,AUTO
        19 011232   000001 236100                    LDQ     1,,PR0
        19 011233   000022 772000                    QRL     18
        19 011234   200034 116100                    CMPQ    INDX3,,AUTO
        19 011235   011137 605400 19                 TPNZ    s:30135

     3554    30152    4               CALL TRANSFORM_DOMAIN (DOMAIN$, ADDRESS_SITENAME, ADDRESS_NAME)

  30152 19 011236   200051 631500                    EPPR1   ADDRESS_NAME,,AUTO
        19 011237   201121 451500                    STP1    @SITENAME+1,,AUTO
        19 011240   200262 633500                    EPPR3   ADDRESS_SITENAME,,AUTO
        19 011241   201120 453500                    STP3    @EXPLICIT+1,,AUTO
        19 011242   200264 634500                    EPPR4   DOMAIN$,,AUTO
        19 011243   201117 454500                    STP4    @CURR_COMMAND_CODE+2,,AUTO
        19 011244   024636 701000 19                 TSX1    TRANSFORM_DOMAIN
        19 011245   011041 702000 19                 TSX2    REPARSE

     3555    30153    4                 ALTRET (REPARSE);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:566  
     3556    30154        /*
     3557    30155             ***** Now process the sub-command ...
     3558    30156        */
     3559    30157    4   PROCESS_MODLIST_SUBC:
     3560    30158    5               DO CASE (OUT$ -> P$B.CODE);

  30158 19 011246   200023 470500       PROCESS_MOD* LDP0    OUT$,,AUTO
        19 011247   000000 720100                    LXL0    0,,PR0
        19 011250   000005 100003                    CMPX0   5,DU
        19 011251   011253 602010 19                 TNC     PROCESS_MODLIST_SUBC+5,X0
        19 011252   011041 710000 19                 TRA     REPARSE
        19 011253   011411 710000 19                 TRA     s:30192
        19 011254   011260 710000 19                 TRA     s:30161
        19 011255   011315 710000 19                 TRA     s:30169
        19 011256   011403 710000 19                 TRA     s:30188
        19 011257   011410 710000 19                 TRA     s:30190

     3561    30159    5               CASE(%MODIFY_BLANK);

     3562    30160    5               CASE (%MODIFY_ADD);

     3563    30161    5                   IF ADDRESS_NAME.L# ~= 0

  30161 19 011260   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 011261   777000 316003                    CANQ    -512,DU
        19 011262   011300 600000 19                 TZE     s:30166

     3564    30162    5                   THEN           /* Store as unresolved address */
     3565    30163    5                       CALL VMA$ADD_UENTRY_SORTED (ADDRESS_NAME,

  30163 19 011263   200262 631500                    EPPR1   ADDRESS_SITENAME,,AUTO
        19 011264   201711 451500                    STP1    I+103,,AUTO
        19 011265   200251 633500                    EPPR3   ADDRESS_PASS,,AUTO
        19 011266   201710 453500                    STP3    I+102,,AUTO
        19 011267   200253 634500                    EPPR4   ADDRESS_FOLDER,,AUTO
        19 011270   201707 454500                    STP4    I+101,,AUTO
        19 011271   200051 635500                    EPPR5   ADDRESS_NAME,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:567  
        19 011272   201706 455500                    STP5    I+100,,AUTO
        19 011273   201706 630500                    EPPR0   I+100,,AUTO
        19 011274   000026 631400 20                 EPPR1   22
        19 011275   000000 701000 xent               TSX1    VMA$ADD_UENTRY_SORTED
        19 011276   016514 702000 19                 TSX2    E_PMME
        19 011277   011041 710000 19                 TRA     REPARSE

     3566    30164    5                         ADDRESS_FOLDER,ADDRESS_PASS,ADDRESS_SITENAME) ALTRET(E_PMME);
     3567    30165    5                   ELSE           /* Store as resolved address */
     3568    30166    5                       CALL VMA$ADD_RENTRY_SORTED (ADDRESS_ACCT,

  30166 19 011300   200262 631500                    EPPR1   ADDRESS_SITENAME,,AUTO
        19 011301   201711 451500                    STP1    I+103,,AUTO
        19 011302   200251 633500                    EPPR3   ADDRESS_PASS,,AUTO
        19 011303   201710 453500                    STP3    I+102,,AUTO
        19 011304   200253 634500                    EPPR4   ADDRESS_FOLDER,,AUTO
        19 011305   201707 454500                    STP4    I+101,,AUTO
        19 011306   200042 635500                    EPPR5   ADDRESS_ACCT,,AUTO
        19 011307   201706 455500                    STP5    I+100,,AUTO
        19 011310   201706 630500                    EPPR0   I+100,,AUTO
        19 011311   000026 631400 20                 EPPR1   22
        19 011312   000000 701000 xent               TSX1    VMA$ADD_RENTRY_SORTED
        19 011313   016514 702000 19                 TSX2    E_PMME
        19 011314   011041 710000 19                 TRA     REPARSE

     3569    30167    5                         ADDRESS_FOLDER,ADDRESS_PASS,ADDRESS_SITENAME) ALTRET(E_PMME);
     3570    30168    5               CASE (%MODIFY_DEL);

     3571    30169    5                   IF ADDRESS_NAME.L# ~= 0

  30169 19 011315   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 011316   777000 316003                    CANQ    -512,DU
        19 011317   011361 600000 19                 TZE     s:30180

     3572    30170    5                   THEN           /* Store as unresolved address */
     3573    30171    6                   DO;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:568  
     3574    30172    6                       SUBSTR(WORK_STRING.NAME#,0,ADDRESS_NAME.L#) =

  30172 19 011320   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 011321   000033 772000                    QRL     27
        19 011322   000000 621006                    EAX1    0,QL
        19 011323   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 011324   000033 772000                    QRL     27
        19 011325   000000 622006                    EAX2    0,QL
        19 011326   040040 100540                    MLR     fill='040'O
        19 011327   200051 200012                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=*X2
        19 011330   000174 200011 11                 ADSC9   WORK_STRING              cn=1,n=*X1

     3575    30173    6                         SUBSTR(ADDRESS_NAME.NAME#,0,ADDRESS_NAME.L#);
     3576    30174    6                       CALL XLATE(SUBSTR(ADDRESS_NAME.NAME#,0,ADDRESS_NAME.L#),

  30174 19 011331   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 011332   000033 772000                    QRL     27
        19 011333   000000 620006                    EAX0    0,QL
        19 011334   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 011335   000033 772000                    QRL     27
        19 011336   000000 621006                    EAX1    0,QL
        19 011337   000000 471400 xsym               LDP1    B$XL_UPPER$
        19 011340   040140 160440                    MVT     fill='040'O
        19 011341   000174 200011 11                 ADSC9   WORK_STRING              cn=1,n=*X1
        19 011342   200051 200010                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=*X0
        19 011343   100000 000100                    ARG     0,,PR1

     3577    30175    6                         LOWER_UPPER,SUBSTR(WORK_STRING.NAME#,0,ADDRESS_NAME.L#));
     3578    30176    6                       CALL VMA$DEL_UENTRY (ADDRESS_NAME,

  30176 19 011344   200262 633500                    EPPR3   ADDRESS_SITENAME,,AUTO
        19 011345   201711 453500                    STP3    I+103,,AUTO
        19 011346   200251 634500                    EPPR4   ADDRESS_PASS,,AUTO
        19 011347   201710 454500                    STP4    I+102,,AUTO
        19 011350   200253 635500                    EPPR5   ADDRESS_FOLDER,,AUTO
        19 011351   201707 455500                    STP5    I+101,,AUTO
        19 011352   200051 636500                    EPPR6   ADDRESS_NAME,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:569  
        19 011353   201706 456500                    STP6    I+100,,AUTO
        19 011354   201706 630500                    EPPR0   I+100,,AUTO
        19 011355   000026 631400 20                 EPPR1   22
        19 011356   000000 701000 xent               TSX1    VMA$DEL_UENTRY
        19 011357   011376 702000 19                 TSX2    E_MODLIST_DEL

     3579    30177    6                         ADDRESS_FOLDER,ADDRESS_PASS,ADDRESS_SITENAME) ALTRET(
             30177                                  E_MODLIST_DEL);
     3580    30178    6                   END;

  30178 19 011360   011041 710000 19                 TRA     REPARSE

     3581    30179    5                   ELSE           /* Store as resolved address */
     3582    30180    5                       CALL VMA$DEL_RENTRY (ADDRESS_ACCT,

  30180 19 011361   200262 631500                    EPPR1   ADDRESS_SITENAME,,AUTO
        19 011362   201711 451500                    STP1    I+103,,AUTO
        19 011363   200251 633500                    EPPR3   ADDRESS_PASS,,AUTO
        19 011364   201710 453500                    STP3    I+102,,AUTO
        19 011365   200253 634500                    EPPR4   ADDRESS_FOLDER,,AUTO
        19 011366   201707 454500                    STP4    I+101,,AUTO
        19 011367   200042 635500                    EPPR5   ADDRESS_ACCT,,AUTO
        19 011370   201706 455500                    STP5    I+100,,AUTO
        19 011371   201706 630500                    EPPR0   I+100,,AUTO
        19 011372   000026 631400 20                 EPPR1   22
        19 011373   000000 701000 xent               TSX1    VMA$DEL_RENTRY
        19 011374   011376 702000 19                 TSX2    E_MODLIST_DEL
        19 011375   011402 710000 19                 TRA     s:30186

     3583    30181    5                         ADDRESS_FOLDER,ADDRESS_PASS,ADDRESS_SITENAME)
     3584    30182    5                       WHENALTRETURN
     3585    30183    6                       DO;

     3586    30184    6   E_MODLIST_DEL:
     3587    30185    6                           CALL XUR$ERRMSG (E_UNDEFENTRY);

  30185 19 011376   000473 630400 20    E_MODLIST_D* EPPR0   315
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:570  
        19 011377   000024 631400 20                 EPPR1   20
        19 011400   000000 701000 xent               TSX1    XUR$ERRMSG
        19 011401   000000 011000                    NOP     0

     3588    30186    6                       END;

  30186 19 011402   011041 710000 19                 TRA     REPARSE

     3589    30187    5               CASE (%MODIFY_DI);

     3590    30188    5                   CALL VMD$DI_LIST (VM_LISTKEY,M$ME_NUM);

  30188 19 011403   000477 630400 20                 EPPR0   319
        19 011404   000000 631400 20                 EPPR1   0
        19 011405   000000 701000 xent               TSX1    VMD$DI_LIST
        19 011406   000000 011000                    NOP     0
        19 011407   011041 710000 19                 TRA     REPARSE

     3591    30189    5               CASE (%MODIFY_END);

     3592    30190    5                   GOTO END_MOD_LIST;

  30190 19 011410   011412 710000 19                 TRA     END_MOD_LIST

     3593    30191    5               END;                  /* Do case ... end */

     3594    30192    4           END;                       /* Do forever ... end */

  30192 19 011411   011041 710000 19                 TRA     REPARSE

     3595    30193    3   END_MOD_LIST:
     3596    30194    3           CALL VMA$PUT_LIST (VM_LISTKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(E_PMME);

  30194 19 011412   000202 630400 20    END_MOD_LIST EPPR0   130
        19 011413   000021 631400 20                 EPPR1   17
        19 011414   000000 701000 xent               TSX1    VMA$PUT_LIST
        19 011415   016514 702000 19                 TSX2    E_PMME
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:571  

  30188 19 011416   016452 710000 19    MOD_CASE_END TRA     CONTINUE

     3597    30195    3   MOD_CASE_END:;
     3598    30196        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:572  
     3599    30197        /* Modify user command */
     3600    30198    3       CASE (%CMD_MODIFY_USER);

     3601    30199    3           CALL NEED_GLOBAL ALTRET(CONTINUE);

  30199 19 011417   016577 701000 19                 TSX1    NEED_GLOBAL
        19 011420   016452 702000 19                 TSX2    CONTINUE

     3602    30200        /*
     3603    30201             ***** Pickup the name of the user to modify ...
     3604    30202        */
     3605    30203    3           TEMPBUF = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;

  30203 19 011421   200023 470500                    LDP0    OUT$,,AUTO
        19 011422   000003 471500                    LDP1    3,,PR0
        19 011423   100004 236100                    LDQ     4,,PR1
        19 011424   000033 772000                    QRL     27
        19 011425   000000 620006                    EAX0    0,QL
        19 011426   040100 100540                    MLR     fill='040'O
        19 011427   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 011430   200265 000310                    ADSC9   TEMPBUF,,AUTO            cn=0,n=200

     3606    30204    3           SIZE = OUT$ -> P$B.SUBLK$(0) -> P$S.COUNT;

  30204 19 011431   000003 471500                    LDP1    3,,PR0
        19 011432   100004 236100                    LDQ     4,,PR1
        19 011433   000033 772000                    QRL     27
        19 011434   000535 756000 11                 STQ     SIZE

     3607    30205    3           VM_USERKEY.TEXT = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;

  30205 19 011435   000003 471500                    LDP1    3,,PR0
        19 011436   100004 236100                    LDQ     4,,PR1
        19 011437   000033 772000                    QRL     27
        19 011440   000000 620006                    EAX0    0,QL
        19 011441   040000 100540                    MLR     fill='040'O
        19 011442   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:573  
        19 011443   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200

     3608    30206    3           CALL VMA$GET_LIST (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM)

  30206 19 011444   000206 630400 20                 EPPR0   134
        19 011445   000021 631400 20                 EPPR1   17
        19 011446   000000 701000 xent               TSX1    VMA$GET_LIST
        19 011447   011451 702000 19                 TSX2    s:30208
        19 011450   011456 710000 19                 TRA     s:30214

     3609    30207    4           WHENALTRETURN DO;

     3610    30208    4               CALL XUR$ERRMSG(E_UNDEFENTRY);

  30208 19 011451   000473 630400 20                 EPPR0   315
        19 011452   000024 631400 20                 EPPR1   20
        19 011453   000000 701000 xent               TSX1    XUR$ERRMSG
        19 011454   000000 011000                    NOP     0

     3611    30209    4               GOTO CONTINUE;

  30209 19 011455   016452 710000 19                 TRA     CONTINUE

     3612    30210    4           END;
     3613    30211        /*
     3614    30212             ***** Now prompt for sub-commands ...
     3615    30213        */
     3616    30214    3           CLOSE_SAVE.V.DCB# = DCBNUM(M$NAME);

  30214 19 011456   000000 236007 xsym               LDQ     M$NAME,DL
        19 011457   000000 620006                    EAX0    0,QL
        19 011460   002142 740000 11                 STX0    CLOSE_SAVE+26

     3617    30215                %INIT_STR (CODE=E_MODIFY_USER_PROMPT, STR=VM_MODIFY_USER_PROMPT, TEST=YES);

  30222 19 011461   040000 106400                    CMPC    fill='040'O
        19 011462   000413 200017 11                 ADSC9   VM_MODIFY_USER_PROMPT    cn=1,n=15
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:574  
        19 011463   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 011464   011471 601000 19                 TNZ     REPARSE_USER

  30224 19 011465   000501 630400 20                 EPPR0   321
        19 011466   000000 631400 20                 EPPR1   0
        19 011467   000000 701000 xent               TSX1    VMD$ERRMSG
        19 011470   000000 011000                    NOP     0

     3618    30238    4           DO FOREVER;

     3619    30239    4   REPARSE_USER:
     3620    30240    4               CALL XUR$GETCMD(MODIFY_USER$->BSD,OUT$,

  30240 19 011471   000413 236000 11    REPARSE_USER LDQ     VM_MODIFY_USER_PROMPT
        19 011472   000033 772000                    QRL     27
        19 011473   000064 737000                    LLS     52
        19 011474   000140 135007                    SBLA    96,DL
        19 011475   000503 236000 20                 LDQ     323
        19 011476   201706 757100                    STAQ    I+100,,AUTO
        19 011477   201706 630500                    EPPR0   I+100,,AUTO
        19 011500   201712 450500                    STP0    I+104,,AUTO
        19 011501   200023 631500                    EPPR1   OUT$,,AUTO
        19 011502   201711 451500                    STP1    I+103,,AUTO
        19 011503   200010 236100                    LDQ     MODIFY_USER$,,AUTO
        19 011504   201710 756100                    STQ     I+102,,AUTO
        19 011505   201710 630500                    EPPR0   I+102,,AUTO
        19 011506   000021 631400 20                 EPPR1   17
        19 011507   000000 701000 xent               TSX1    XUR$GETCMD
        19 011510   011512 702000 19                 TSX2    s:30243
        19 011511   011524 710000 19                 TRA     s:30250

     3621    30241    4                VECTOR(SUBSTR(VM_MODIFY_USER_PROMPT.NAME#,0,VM_MODIFY_USER_PROMPT.L#))
             30241                          )
     3622    30242    5               WHENALTRETURN DO;

     3623    30243    5                   CALL XUR$ERRPTR;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:575  
  30243 19 011512   000020 631400 20                 EPPR1   16
        19 011513   000000 701000 xent               TSX1    XUR$ERRPTR
        19 011514   000000 011000                    NOP     0

     3624    30244    5                   CALL XUR$ERRMSG (OUTERR);

  30244 19 011515   200023 630500                    EPPR0   OUT$,,AUTO
        19 011516   201706 450500                    STP0    I+100,,AUTO
        19 011517   201706 630500                    EPPR0   I+100,,AUTO
        19 011520   000024 631400 20                 EPPR1   20
        19 011521   000000 701000 xent               TSX1    XUR$ERRMSG
        19 011522   000000 011000                    NOP     0

     3625    30245    5                   GOTO REPARSE_USER;

  30245 19 011523   011471 710000 19                 TRA     REPARSE_USER

     3626    30246    5               END;
     3627    30247        /*
     3628    30248             ***** Get address parts for subcommand, if any ...
     3629    30249        */
     3630    30250    4               IF OUT$ -> P$B.NSUBLKS > 0

  30250 19 011524   200023 470500                    LDP0    OUT$,,AUTO
        19 011525   000001 220100                    LDX0    1,,PR0
        19 011526   011756 600000 19                 TZE     s:30306

     3631    30251    5               THEN DO;

     3632    30252    5                   ADDRESS_ACCT.ACCT# = ' ';

  30252 19 011527   000035 235000 20                 LDA     29
        19 011530   000035 236000 20                 LDQ     29
        19 011531   200042 757100                    STAQ    ADDRESS_ACCT,,AUTO

     3633    30253    5                   ADDRESS_NAME.L# = 0;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:576  
  30253 19 011532   000000 236003                    LDQ     0,DU
        19 011533   200051 552140                    STBQ    ADDRESS_NAME,'40'O,AUTO

     3634    30254    5                   ADDRESS_NAME.NAME# = ' ';

  30254 19 011534   040100 100400                    MLR     fill='040'O
        19 011535   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 011536   200051 200777                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=511

     3635    30255    5                   ADDRESS_FOLDER = ' ';

  30255 19 011537   040100 100400                    MLR     fill='040'O
        19 011540   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 011541   200253 000031                    ADSC9   ADDRESS_FOLDER,,AUTO     cn=0,n=25

     3636    30256    5                   ADDRESS_PASS.PASS# = ' ';

  30256 19 011542   000035 235000 20                 LDA     29
        19 011543   000035 236000 20                 LDQ     29
        19 011544   200251 755100                    STA     ADDRESS_PASS,,AUTO
        19 011545   200252 756100                    STQ     ADDRESS_PASS+1,,AUTO

     3637    30257    5                   ADDRESS_LACCN.ACCT# = ' ';

  30257 19 011546   000035 235000 20                 LDA     29
        19 011547   000035 236000 20                 LDQ     29
        19 011550   200044 757100                    STAQ    ADDRESS_LACCN,,AUTO

     3638    30258    5                   ADDRESS_LUNAME = ' ';

  30258 19 011551   040100 100400                    MLR     fill='040'O
        19 011552   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 011553   200046 000014                    ADSC9   ADDRESS_LUNAME,,AUTO     cn=0,n=12

     3639    30259    5                   ADDRESS_SITENAME = VM_SITENAME;

  30259 19 011554   040100 100400                    MLR     fill='040'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:577  
        19 011555   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        19 011556   200262 000010                    ADSC9   ADDRESS_SITENAME,,AUTO   cn=0,n=8

     3640    30260    5                   DOMAIN$ = ADDR(NIL);

  30260 19 011557   000022 236000 20                 LDQ     18
        19 011560   200264 756100                    STQ     DOMAIN$,,AUTO

     3641    30261        /*
     3642    30262             ***** Repeat this loop once for each piece of the address ...
     3643    30263        */
     3644    30264    5                   BLK$ = OUT$ -> P$B.SUBLK$(0);

  30264 19 011561   000003 236100                    LDQ     3,,PR0
        19 011562   200024 756100                    STQ     BLK$,,AUTO

     3645    30265    6                   DO INDX2 = 0 TO BLK$ -> P$B.NSUBLKS - 1;

  30265 19 011563   000375 450000 11                 STZ     INDX2
        19 011564   011726 710000 19                 TRA     s:30292+1

     3646    30266    6                       PTR2$ = BLK$ -> P$B.SUBLK$(INDX2);

  30266 19 011565   200024 470500                    LDP0    BLK$,,AUTO
        19 011566   000375 720000 11                 LXL0    INDX2
        19 011567   000003 236110                    LDQ     3,X0,PR0
        19 011570   200026 756100                    STQ     PTR2$,,AUTO

     3647    30267    7                       DO CASE (PTR2$ -> P$B.CODE);

  30267 19 011571   200026 471500                    LDP1    PTR2$,,AUTO
        19 011572   100000 721100                    LXL1    0,,PR1
        19 011573   000010 101003                    CMPX1   8,DU
        19 011574   011576 602011 19                 TNC     s:30267+5,X1
        19 011575   011725 710000 19                 TRA     s:30292
        19 011576   011725 710000 19                 TRA     s:30292
        19 011577   011624 710000 19                 TRA     s:30273
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:578  
        19 011600   011606 710000 19                 TRA     s:30269
        19 011601   011725 710000 19                 TRA     s:30292
        19 011602   011725 710000 19                 TRA     s:30292
        19 011603   011725 710000 19                 TRA     s:30292
        19 011604   011725 710000 19                 TRA     s:30292
        19 011605   011615 710000 19                 TRA     s:30271

     3648    30268    7                       CASE (%ADD_ACCT);

     3649    30269    7                           ADDRESS_LACCN.ACCT# = PTR2$ -> P$S.TEXT;

  30269 19 011606   100004 236100                    LDQ     4,,PR1
        19 011607   000033 772000                    QRL     27
        19 011610   000000 622006                    EAX2    0,QL
        19 011611   040100 100540                    MLR     fill='040'O
        19 011612   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011613   200044 000010                    ADSC9   ADDRESS_LACCN,,AUTO      cn=0,n=8
        19 011614   011725 710000 19                 TRA     s:30292

     3650    30270    7                       CASE (%ADD_UNAME);

     3651    30271    7                           ADDRESS_LUNAME = PTR2$ -> P$S.TEXT;

  30271 19 011615   100004 236100                    LDQ     4,,PR1
        19 011616   000033 772000                    QRL     27
        19 011617   000000 622006                    EAX2    0,QL
        19 011620   040100 100540                    MLR     fill='040'O
        19 011621   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011622   200046 000014                    ADSC9   ADDRESS_LUNAME,,AUTO     cn=0,n=12
        19 011623   011725 710000 19                 TRA     s:30292

     3652    30272    7                       CASE (%ADD_ADDRESS);

     3653    30273    8                           DO INDX3 = 0 TO PTR2$ -> P$B.NSUBLKS - 1;

  30273 19 011624   200034 450100                    STZ     INDX3,,AUTO
        19 011625   011720 710000 19                 TRA     s:30290+1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:579  

     3654    30274    8                               PTR3$ = PTR2$ -> P$B.SUBLK$(INDX3);

  30274 19 011626   200026 470500                    LDP0    PTR2$,,AUTO
        19 011627   200034 720100                    LXL0    INDX3,,AUTO
        19 011630   000003 236110                    LDQ     3,X0,PR0
        19 011631   200027 756100                    STQ     PTR3$,,AUTO

     3655    30275    9                               DO CASE (PTR3$ -> P$B.CODE);

  30275 19 011632   200027 471500                    LDP1    PTR3$,,AUTO
        19 011633   100000 721100                    LXL1    0,,PR1
        19 011634   000012 101003                    CMPX1   10,DU
        19 011635   011637 602011 19                 TNC     s:30275+5,X1
        19 011636   011717 710000 19                 TRA     s:30290
        19 011637   011717 710000 19                 TRA     s:30290
        19 011640   011717 710000 19                 TRA     s:30290
        19 011641   011651 710000 19                 TRA     s:30277
        19 011642   011660 710000 19                 TRA     s:30279
        19 011643   011667 710000 19                 TRA     s:30281
        19 011644   011700 710000 19                 TRA     s:30284
        19 011645   011707 710000 19                 TRA     s:30286
        19 011646   011717 710000 19                 TRA     s:30290
        19 011647   011717 710000 19                 TRA     s:30290
        19 011650   011716 710000 19                 TRA     s:30288

     3656    30276    9                               CASE (%ADD_ACCT);

     3657    30277    9                                   ADDRESS_ACCT.ACCT# = PTR3$ -> P$S.TEXT;

  30277 19 011651   100004 236100                    LDQ     4,,PR1
        19 011652   000033 772000                    QRL     27
        19 011653   000000 622006                    EAX2    0,QL
        19 011654   040100 100540                    MLR     fill='040'O
        19 011655   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011656   200042 000010                    ADSC9   ADDRESS_ACCT,,AUTO       cn=0,n=8
        19 011657   011717 710000 19                 TRA     s:30290
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:580  

     3658    30278    9                               CASE (%ADD_FOLDER);

     3659    30279    9                                   ADDRESS_FOLDER = PTR3$ -> P$S.TEXT;

  30279 19 011660   100004 236100                    LDQ     4,,PR1
        19 011661   000033 772000                    QRL     27
        19 011662   000000 622006                    EAX2    0,QL
        19 011663   040100 100540                    MLR     fill='040'O
        19 011664   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011665   200253 000031                    ADSC9   ADDRESS_FOLDER,,AUTO     cn=0,n=25
        19 011666   011717 710000 19                 TRA     s:30290

     3660    30280    9                               CASE (%ADD_NAME);

     3661    30281    9                                   ADDRESS_NAME.NAME# = PTR3$ -> P$S.TEXT;

  30281 19 011667   100004 236100                    LDQ     4,,PR1
        19 011670   000033 772000                    QRL     27
        19 011671   000000 622006                    EAX2    0,QL
        19 011672   040100 100540                    MLR     fill='040'O
        19 011673   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011674   200051 200777                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=511

     3662    30282    9                                   ADDRESS_NAME.L# = PTR3$ -> P$S.COUNT;

  30282 19 011675   100004 236100                    LDQ     4,,PR1
        19 011676   200051 552140                    STBQ    ADDRESS_NAME,'40'O,AUTO
        19 011677   011717 710000 19                 TRA     s:30290

     3663    30283    9                               CASE (%ADD_PASS);

     3664    30284    9                                   ADDRESS_PASS.PASS# = PTR3$ -> P$S.TEXT;

  30284 19 011700   100004 236100                    LDQ     4,,PR1
        19 011701   000033 772000                    QRL     27
        19 011702   000000 622006                    EAX2    0,QL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:581  
        19 011703   040100 100540                    MLR     fill='040'O
        19 011704   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011705   200251 000010                    ADSC9   ADDRESS_PASS,,AUTO       cn=0,n=8
        19 011706   011717 710000 19                 TRA     s:30290

     3665    30285    9                               CASE (%ADD_SITE);

     3666    30286    9                                   ADDRESS_SITENAME = PTR3$ -> P$S.TEXT;

  30286 19 011707   100004 236100                    LDQ     4,,PR1
        19 011710   000033 772000                    QRL     27
        19 011711   000000 622006                    EAX2    0,QL
        19 011712   040100 100540                    MLR     fill='040'O
        19 011713   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 011714   200262 000010                    ADSC9   ADDRESS_SITENAME,,AUTO   cn=0,n=8
        19 011715   011717 710000 19                 TRA     s:30290

     3667    30287    9                               CASE (%ADD_DOMAIN);

     3668    30288    9                                   DOMAIN$ = PTR3$;

  30288 19 011716   200264 756100                    STQ     DOMAIN$,,AUTO

     3669    30289    9                               END;

     3670    30290    8                           END;

  30290 19 011717   200034 054100                    AOS     INDX3,,AUTO
        19 011720   200026 470500                    LDP0    PTR2$,,AUTO
        19 011721   000001 236100                    LDQ     1,,PR0
        19 011722   000022 772000                    QRL     18
        19 011723   200034 116100                    CMPQ    INDX3,,AUTO
        19 011724   011626 605400 19                 TPNZ    s:30274

     3671    30291    7                       END;

     3672    30292    6                   END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:582  

  30292 19 011725   000375 054000 11                 AOS     INDX2
        19 011726   200024 470500                    LDP0    BLK$,,AUTO
        19 011727   000001 236100                    LDQ     1,,PR0
        19 011730   000022 772000                    QRL     18
        19 011731   000375 116000 11                 CMPQ    INDX2
        19 011732   011565 605400 19                 TPNZ    s:30266

     3673    30293    5                   CALL TRANSFORM_DOMAIN (DOMAIN$, ADDRESS_SITENAME, ADDRESS_NAME)

  30293 19 011733   200051 631500                    EPPR1   ADDRESS_NAME,,AUTO
        19 011734   201121 451500                    STP1    @SITENAME+1,,AUTO
        19 011735   200262 633500                    EPPR3   ADDRESS_SITENAME,,AUTO
        19 011736   201120 453500                    STP3    @EXPLICIT+1,,AUTO
        19 011737   200264 634500                    EPPR4   DOMAIN$,,AUTO
        19 011740   201117 454500                    STP4    @CURR_COMMAND_CODE+2,,AUTO
        19 011741   024636 701000 19                 TSX1    TRANSFORM_DOMAIN
        19 011742   011471 702000 19                 TSX2    REPARSE_USER

     3674    30294    5                     ALTRET (REPARSE_USER);
     3675    30295    5                   IF ADDRESS_ACCT.ACCT# = ' '

  30295 19 011743   200042 237100                    LDAQ    ADDRESS_ACCT,,AUTO
        19 011744   000212 117000 20                 CMPAQ   138
        19 011745   011751 601000 19                 TNZ     s:30299

     3676    30296    5                   THEN
     3677    30297    5                       ADDRESS_ACCT.ACCT# = ADDRESS_LACCN.ACCT#;

  30297 19 011746   200044 237100                    LDAQ    ADDRESS_LACCN,,AUTO
        19 011747   200042 757100                    STAQ    ADDRESS_ACCT,,AUTO
        19 011750   011756 710000 19                 TRA     s:30306

     3678    30298    5                   ELSE
     3679    30299    5                       IF ADDRESS_LACCN.ACCT# = ' '

  30299 19 011751   200044 237100                    LDAQ    ADDRESS_LACCN,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:583  
        19 011752   000212 117000 20                 CMPAQ   138
        19 011753   011756 601000 19                 TNZ     s:30306

     3680    30300    5                       THEN
     3681    30301    5                           ADDRESS_LACCN.ACCT# = ADDRESS_ACCT.ACCT#;

  30301 19 011754   200042 237100                    LDAQ    ADDRESS_ACCT,,AUTO
        19 011755   200044 757100                    STAQ    ADDRESS_LACCN,,AUTO

     3682    30302    5               END;

     3683    30303        /*
     3684    30304             ***** Now process the sub-command ...
     3685    30305        */
     3686    30306    5               DO CASE (OUT$ -> P$B.CODE);

  30306 19 011756   200023 470500                    LDP0    OUT$,,AUTO
        19 011757   000000 720100                    LXL0    0,,PR0
        19 011760   000005 100003                    CMPX0   5,DU
        19 011761   011763 602010 19                 TNC     s:30306+5,X0
        19 011762   011471 710000 19                 TRA     REPARSE_USER
        19 011763   012347 710000 19                 TRA     s:30406
        19 011764   011770 710000 19                 TRA     s:30312
        19 011765   012173 710000 19                 TRA     s:30368
        19 011766   012341 710000 19                 TRA     s:30402
        19 011767   012346 710000 19                 TRA     s:30404

     3687    30307    5               CASE(%MODIFY_BLANK);

     3688    30308    5               CASE (%MODIFY_ADD);

     3689    30309        /*
     3690    30310             ***** Store the reverse name map info if available ...
     3691    30311        */
     3692    30312    5                   IF ADDRESS_LACCN.ACCT# ~= ' '

  30312 19 011770   200044 237100                    LDAQ    ADDRESS_LACCN,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:584  
        19 011771   000212 117000 20                 CMPAQ   138
        19 011772   012125 600000 19                 TZE     s:30350
        19 011773   040000 106500                    CMPC    fill='040'O
        19 011774   200262 000010                    ADSC9   ADDRESS_SITENAME,,AUTO   cn=0,n=8
        19 011775   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        19 011776   012002 600000 19                 TZE     s:30315
        19 011777   200262 237100                    LDAQ    ADDRESS_SITENAME,,AUTO
        19 012000   000212 117000 20                 CMPAQ   138
        19 012001   012125 601000 19                 TNZ     s:30350

     3693    30313    5                     AND (ADDRESS_SITENAME = VM_SITENAME OR ADDRESS_SITENAME = ' ')
     3694    30314    6                   THEN DO;              /* Info avail */

     3695    30315    6                       CALL XUR$DISABLE;

  30315 19 012002   000020 631400 20                 EPPR1   16
        19 012003   000000 701000 xent               TSX1    XUR$DISABLE
        19 012004   000000 011000                    NOP     0

     3696    30316    6                       CALL M$OPEN (OPEN_NAME_MAP) ALTRET(E_PMME);

  30316 19 012005   000366 630400 12                 EPPR0   OPEN_NAME_MAP
        19 012006   450000 713400                    CLIMB   alt,open
        19 012007   410400 401760                    pmme    nvectors=18
        19 012010   016514 702000 19                 TSX2    E_PMME

     3697    30317    6                       CALL CONCAT (NAME_KEY.NAME#,ADDRESS_LACCN.ACCT#,

  30317 19 012011   040000 100500                    MLR     fill='040'O
        19 012012   200044 000010                    ADSC9   ADDRESS_LACCN,,AUTO      cn=0,n=8
        19 012013   002402 200010 11                 ADSC9   NAME_KEY                 cn=1,n=8
        19 012014   040000 100500                    MLR     fill='040'O
        19 012015   200046 000014                    ADSC9   ADDRESS_LUNAME,,AUTO     cn=0,n=12
        19 012016   002404 200014 11                 ADSC9   NAME_KEY+2               cn=1,n=12

     3698    30318    6                         ADDRESS_LUNAME);
     3699    30319    6                       NAME_KEY.L# = 20;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:585  

  30319 19 012017   024000 236003                    LDQ     10240,DU
        19 012020   002402 552040 11                 STBQ    NAME_KEY,'40'O

     3700    30320    6                       WRITE_NAME_MAP.BUF_ = VECTOR (SUBSTR(TEMPBUF,0,SIZE));

  30320 19 012021   000535 235000 11                 LDA     SIZE
        19 012022   000020 735000                    ALS     16
        19 012023   000140 135007                    SBLA    96,DL
        19 012024   201706 452500                    STP2    I+100,,AUTO
        19 012025   201706 236100                    LDQ     I+100,,AUTO
        19 012026   000265 036003                    ADLQ    181,DU
        19 012027   002372 757000 11                 STAQ    WRITE_NAME_MAP+4

     3701    30321        /*
     3702    30322             ***** Check if this NAME_MAP entry already exists.
     3703    30323                   If it does, then error!!!
     3704    30324        */
     3705    30325    6                       CALL M$READ (READ_NAME_MAP)

  30325 19 012030   000472 630400 12                 EPPR0   READ_NAME_MAP
        19 012031   440000 713400                    CLIMB   alt,read
        19 012032   401400 401760                    pmme    nvectors=4
        19 012033   012111 702000 19                 TSX2    s:30345

     3706    30326    7                       WHENRETURN DO;

     3707    30327    7                           IF VM_USERKEY.TEXT ~= SUBSTR (WORK_STRING.NAME#, 0,

  30327 19 012034   000000 236007 xsym               LDQ     M$NAME,DL
        19 012035   000074 470400 20                 LDP0    60
        19 012036   000000 471500                    LDP1    0,,PR0
        19 012037   100000 473506                    LDP3    0,QL,PR1
        19 012040   300000 720100                    LXL0    0,,PR3
        19 012041   040040 106400                    CMPC    fill='040'O
        19 012042   000722 400310 11                 ADSC9   VM_USERKEY               cn=2,n=200
        19 012043   000174 200010 11                 ADSC9   WORK_STRING              cn=1,n=*X0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:586  
        19 012044   012111 600000 19                 TZE     s:30345

     3708    30328    7                             DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS#)
     3709    30329    8                           THEN DO;

     3710    30330    8                               IF DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS# <= 21

  30330 19 012045   000000 236007 xsym               LDQ     M$NAME,DL
        19 012046   100000 473506                    LDP3    0,QL,PR1
        19 012047   300000 235100                    LDA     0,,PR3
        19 012050   000025 115007                    CMPA    21,DL
        19 012051   012060 605400 19                 TPNZ    s:30335

     3711    30331    8                               THEN
     3712    30332    8                                   WORK_STRING.L# =

  30332 19 012052   000000 236007 xsym               LDQ     M$NAME,DL
        19 012053   100000 473506                    LDP3    0,QL,PR1
        19 012054   300000 236100                    LDQ     0,,PR3
        19 012055   000033 736000                    QLS     27
        19 012056   000174 552040 11                 STBQ    WORK_STRING,'40'O
        19 012057   012065 710000 19                 TRA     s:30338

     3713    30333    8                                     DCBADDR(DCBNUM(M$NAME)) -> F$DCB.ARS#;
     3714    30334    9                               ELSE DO;

     3715    30335    9                                   WORK_STRING.L# = 31;

  30335 19 012060   037000 236003                    LDQ     15872,DU
        19 012061   000174 552040 11                 STBQ    WORK_STRING,'40'O

     3716    30336    9                                   SUBSTR (WORK_STRING.NAME#,28,3) = '...';

  30336 19 012062   001362 236000 12                 LDQ     VM_PROKEY+5
        19 012063   000011 772000                    QRL     9
        19 012064   000203 552034 11                 STBQ    WORK_STRING+7,'34'O

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:587  
     3717    30337    9                               END;

     3718    30338    8                               CALL XUR$ERRMSG (E_NMENTRYEXISTS,,,

  30338 19 012065   000175 236000 20                 LDQ     125
        19 012066   201712 756100                    STQ     I+104,,AUTO
        19 012067   000220 236000 20                 LDQ     144
        19 012070   000022 235000 20                 LDA     18
        19 012071   201710 757100                    STAQ    I+102,,AUTO
        19 012072   000022 236000 20                 LDQ     18
        19 012073   000221 235000 20                 LDA     145
        19 012074   201706 757100                    STAQ    I+100,,AUTO
        19 012075   201706 630500                    EPPR0   I+100,,AUTO
        19 012076   000041 631400 20                 EPPR1   33
        19 012077   000000 701000 xent               TSX1    XUR$ERRMSG
        19 012100   000000 011000                    NOP     0

     3719    30339    8                                 VECTOR(NAME_KEY),VECTOR(WORK_STRING));
     3720    30340    8                               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  30340 19 012101   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 012102   450001 713400                    CLIMB   alt,close
        19 012103   406000 401760                    pmme    nvectors=13
        19 012104   016514 702000 19                 TSX2    E_PMME

     3721    30341    8                               CALL XUR$ENABLE;

  30341 19 012105   000020 631400 20                 EPPR1   16
        19 012106   000000 701000 xent               TSX1    XUR$ENABLE
        19 012107   000000 011000                    NOP     0

     3722    30342    8                               GOTO REPARSE_USER;

  30342 19 012110   011471 710000 19                 TRA     REPARSE_USER

     3723    30343    8                           END;
     3724    30344    7                       END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:588  
     3725    30345    6                       CALL M$WRITE (WRITE_NAME_MAP) ALTRET(E_PMME);

  30345 19 012111   002366 630400 11                 EPPR0   WRITE_NAME_MAP
        19 012112   440001 713400                    CLIMB   alt,write
        19 012113   401400 401760                    pmme    nvectors=4
        19 012114   016514 702000 19                 TSX2    E_PMME

     3726    30346    6                       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  30346 19 012115   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 012116   450001 713400                    CLIMB   alt,close
        19 012117   406000 401760                    pmme    nvectors=13
        19 012120   016514 702000 19                 TSX2    E_PMME

     3727    30347    6                       CALL XUR$ENABLE;

  30347 19 012121   000020 631400 20                 EPPR1   16
        19 012122   000000 701000 xent               TSX1    XUR$ENABLE
        19 012123   000000 011000                    NOP     0

     3728    30348    6                   END;

  30348 19 012124   012132 710000 19                 TRA     s:30356

     3729    30349    6                   ELSE DO;

     3730    30350    6                       NAME_KEY.L# = 0;

  30350 19 012125   000000 236003                    LDQ     0,DU
        19 012126   002402 552040 11                 STBQ    NAME_KEY,'40'O

     3731    30351    6                       NAME_KEY.NAME# = ' ';

  30351 19 012127   040000 100400                    MLR     fill='040'O
        19 012130   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 012131   002402 200024 11                 ADSC9   NAME_KEY                 cn=1,n=20

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:589  
     3732    30352    6                   END;

     3733    30353        /*
     3734    30354             ***** Add this entry to the user list ...
     3735    30355        */
     3736    30356    5                   IF ADDRESS_NAME.L# ~= 0

  30356 19 012132   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 012133   777000 316003                    CANQ    -512,DU
        19 012134   012154 600000 19                 TZE     s:30363

     3737    30357    6                   THEN DO;              /* Store as unresolved address */

     3738    30358    6                       CALL VMA$ADD_UENTRY_SORTED (ADDRESS_NAME,ADDRESS_FOLDER,

  30358 19 012135   000222 237000 20                 LDAQ    146
        19 012136   201712 757100                    STAQ    I+104,,AUTO
        19 012137   200262 630500                    EPPR0   ADDRESS_SITENAME,,AUTO
        19 012140   201711 450500                    STP0    I+103,,AUTO
        19 012141   200251 631500                    EPPR1   ADDRESS_PASS,,AUTO
        19 012142   201710 451500                    STP1    I+102,,AUTO
        19 012143   200253 633500                    EPPR3   ADDRESS_FOLDER,,AUTO
        19 012144   201707 453500                    STP3    I+101,,AUTO
        19 012145   200051 634500                    EPPR4   ADDRESS_NAME,,AUTO
        19 012146   201706 454500                    STP4    I+100,,AUTO
        19 012147   201706 630500                    EPPR0   I+100,,AUTO
        19 012150   000130 631400 20                 EPPR1   88
        19 012151   000000 701000 xent               TSX1    VMA$ADD_UENTRY_SORTED
        19 012152   016514 702000 19                 TSX2    E_PMME

     3739    30359    6                         ADDRESS_PASS,ADDRESS_SITENAME,%NO#,NAME_KEY.NAME#)
     3740    30360    6                         ALTRET(E_PMME);
     3741    30361    6                   END;

  30361 19 012153   011471 710000 19                 TRA     REPARSE_USER

     3742    30362    6                   ELSE DO;              /* Store as resolved address */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:590  

     3743    30363    6                       CALL VMA$ADD_RENTRY_SORTED (ADDRESS_ACCT,ADDRESS_FOLDER,

  30363 19 012154   000222 237000 20                 LDAQ    146
        19 012155   201712 757100                    STAQ    I+104,,AUTO
        19 012156   200262 630500                    EPPR0   ADDRESS_SITENAME,,AUTO
        19 012157   201711 450500                    STP0    I+103,,AUTO
        19 012160   200251 631500                    EPPR1   ADDRESS_PASS,,AUTO
        19 012161   201710 451500                    STP1    I+102,,AUTO
        19 012162   200253 633500                    EPPR3   ADDRESS_FOLDER,,AUTO
        19 012163   201707 453500                    STP3    I+101,,AUTO
        19 012164   200042 634500                    EPPR4   ADDRESS_ACCT,,AUTO
        19 012165   201706 454500                    STP4    I+100,,AUTO
        19 012166   201706 630500                    EPPR0   I+100,,AUTO
        19 012167   000130 631400 20                 EPPR1   88
        19 012170   000000 701000 xent               TSX1    VMA$ADD_RENTRY_SORTED
        19 012171   016514 702000 19                 TSX2    E_PMME

     3744    30364    6                         ADDRESS_PASS,ADDRESS_SITENAME,%NO#,NAME_KEY.NAME#)
     3745    30365    6                         ALTRET(E_PMME);
     3746    30366    6                   END;

  30366 19 012172   011471 710000 19                 TRA     REPARSE_USER

     3747    30367    5               CASE (%MODIFY_DEL);

     3748    30368    5                   CALL CONCAT (NAME_KEY.NAME#,ADDRESS_LACCN.ACCT#,ADDRESS_LUNAME);

  30368 19 012173   040000 100500                    MLR     fill='040'O
        19 012174   200044 000010                    ADSC9   ADDRESS_LACCN,,AUTO      cn=0,n=8
        19 012175   002402 200010 11                 ADSC9   NAME_KEY                 cn=1,n=8
        19 012176   040000 100500                    MLR     fill='040'O
        19 012177   200046 000014                    ADSC9   ADDRESS_LUNAME,,AUTO     cn=0,n=12
        19 012200   002404 200014 11                 ADSC9   NAME_KEY+2               cn=1,n=12

     3749    30369    5                   IF ADDRESS_NAME.L# ~= 0

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:591  
  30369 19 012201   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 012202   777000 316003                    CANQ    -512,DU
        19 012203   012247 600000 19                 TZE     s:30379

     3750    30370    6                   THEN DO;         /* Delete unresolved address */

     3751    30371    6                       SUBSTR(WORK_STRING.NAME#,0,ADDRESS_NAME.L#) =

  30371 19 012204   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 012205   000033 772000                    QRL     27
        19 012206   000000 620006                    EAX0    0,QL
        19 012207   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 012210   000033 772000                    QRL     27
        19 012211   000000 621006                    EAX1    0,QL
        19 012212   040040 100540                    MLR     fill='040'O
        19 012213   200051 200011                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=*X1
        19 012214   000174 200010 11                 ADSC9   WORK_STRING              cn=1,n=*X0

     3752    30372    6                         SUBSTR(ADDRESS_NAME.NAME#,0,ADDRESS_NAME.L#);
     3753    30373    6                       CALL XLATE(SUBSTR(ADDRESS_NAME.NAME#,0,ADDRESS_NAME.L#),

  30373 19 012215   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 012216   000033 772000                    QRL     27
        19 012217   000000 620006                    EAX0    0,QL
        19 012220   200051 236100                    LDQ     ADDRESS_NAME,,AUTO
        19 012221   000033 772000                    QRL     27
        19 012222   000000 621006                    EAX1    0,QL
        19 012223   000000 470400 xsym               LDP0    B$XL_UPPER$
        19 012224   040140 160440                    MVT     fill='040'O
        19 012225   000174 200011 11                 ADSC9   WORK_STRING              cn=1,n=*X1
        19 012226   200051 200010                    ADSC9   ADDRESS_NAME,,AUTO       cn=1,n=*X0
        19 012227   000000 000100                    ARG     0,,PR0

     3754    30374    6                         LOWER_UPPER,SUBSTR(WORK_STRING.NAME#,0,ADDRESS_NAME.L#));
     3755    30375    6                       CALL VMA$DEL_UENTRY (ADDRESS_NAME,ADDRESS_FOLDER,ADDRESS_PASS,

  30375 19 012230   000222 237000 20                 LDAQ    146
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:592  
        19 012231   201712 757100                    STAQ    I+104,,AUTO
        19 012232   200262 631500                    EPPR1   ADDRESS_SITENAME,,AUTO
        19 012233   201711 451500                    STP1    I+103,,AUTO
        19 012234   200251 633500                    EPPR3   ADDRESS_PASS,,AUTO
        19 012235   201710 453500                    STP3    I+102,,AUTO
        19 012236   200253 634500                    EPPR4   ADDRESS_FOLDER,,AUTO
        19 012237   201707 454500                    STP4    I+101,,AUTO
        19 012240   200051 635500                    EPPR5   ADDRESS_NAME,,AUTO
        19 012241   201706 455500                    STP5    I+100,,AUTO
        19 012242   201706 630500                    EPPR0   I+100,,AUTO
        19 012243   000130 631400 20                 EPPR1   88
        19 012244   000000 701000 xent               TSX1    VMA$DEL_UENTRY
        19 012245   012266 702000 19                 TSX2    E_MODUSER_DEL

     3756    30376    6                         ADDRESS_SITENAME,%NO#,NAME_KEY.NAME#) ALTRET(E_MODUSER_DEL);
     3757    30377    6                   END;

  30377 19 012246   012273 710000 19                 TRA     s:30389

     3758    30378    5                   ELSE             /* Delete resolved address */
     3759    30379    5                       CALL VMA$DEL_RENTRY (ADDRESS_ACCT,ADDRESS_FOLDER,ADDRESS_PASS,

  30379 19 012247   000222 237000 20                 LDAQ    146
        19 012250   201712 757100                    STAQ    I+104,,AUTO
        19 012251   200262 630500                    EPPR0   ADDRESS_SITENAME,,AUTO
        19 012252   201711 450500                    STP0    I+103,,AUTO
        19 012253   200251 631500                    EPPR1   ADDRESS_PASS,,AUTO
        19 012254   201710 451500                    STP1    I+102,,AUTO
        19 012255   200253 633500                    EPPR3   ADDRESS_FOLDER,,AUTO
        19 012256   201707 453500                    STP3    I+101,,AUTO
        19 012257   200042 634500                    EPPR4   ADDRESS_ACCT,,AUTO
        19 012260   201706 454500                    STP4    I+100,,AUTO
        19 012261   201706 630500                    EPPR0   I+100,,AUTO
        19 012262   000130 631400 20                 EPPR1   88
        19 012263   000000 701000 xent               TSX1    VMA$DEL_RENTRY
        19 012264   012266 702000 19                 TSX2    E_MODUSER_DEL
        19 012265   012273 710000 19                 TRA     s:30389
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:593  

     3760    30380    5                         ADDRESS_SITENAME,%NO#,NAME_KEY.NAME#)
     3761    30381    6                       WHENALTRETURN DO;

     3762    30382    6   E_MODUSER_DEL:
     3763    30383    6                           CALL XUR$ERRMSG (E_UNDEFENTRY);

  30383 19 012266   000473 630400 20    E_MODUSER_D* EPPR0   315
        19 012267   000024 631400 20                 EPPR1   20
        19 012270   000000 701000 xent               TSX1    XUR$ERRMSG
        19 012271   000000 011000                    NOP     0

     3764    30384    6                           GOTO REPARSE_USER;

  30384 19 012272   011471 710000 19                 TRA     REPARSE_USER

     3765    30385    6                       END;
     3766    30386        /*
     3767    30387             ***** Delete the reverse name map info if present ...
     3768    30388        */
     3769    30389    5                   IF ADDRESS_LACCN.ACCT# ~= ' '

  30389 19 012273   200044 237100                    LDAQ    ADDRESS_LACCN,,AUTO
        19 012274   000212 117000 20                 CMPAQ   138
        19 012275   011471 600000 19                 TZE     REPARSE_USER
        19 012276   040000 106500                    CMPC    fill='040'O
        19 012277   200262 000010                    ADSC9   ADDRESS_SITENAME,,AUTO   cn=0,n=8
        19 012300   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        19 012301   012305 600000 19                 TZE     s:30392
        19 012302   200262 237100                    LDAQ    ADDRESS_SITENAME,,AUTO
        19 012303   000212 117000 20                 CMPAQ   138
        19 012304   011471 601000 19                 TNZ     REPARSE_USER

     3770    30390    5                     AND (ADDRESS_SITENAME = VM_SITENAME OR ADDRESS_SITENAME = ' ')
     3771    30391    6                   THEN DO;              /* Info avail */

     3772    30392    6                       CALL XUR$DISABLE;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:594  

  30392 19 012305   000020 631400 20                 EPPR1   16
        19 012306   000000 701000 xent               TSX1    XUR$DISABLE
        19 012307   000000 011000                    NOP     0

     3773    30393    6                       CALL M$OPEN (OPEN_NAME_MAP) ALTRET(E_PMME);

  30393 19 012310   000366 630400 12                 EPPR0   OPEN_NAME_MAP
        19 012311   450000 713400                    CLIMB   alt,open
        19 012312   410400 401760                    pmme    nvectors=18
        19 012313   016514 702000 19                 TSX2    E_PMME

     3774    30394    6                       CALL CONCAT (NAME_KEY.NAME#,ADDRESS_LACCN.ACCT#,

  30394 19 012314   040000 100500                    MLR     fill='040'O
        19 012315   200044 000010                    ADSC9   ADDRESS_LACCN,,AUTO      cn=0,n=8
        19 012316   002402 200010 11                 ADSC9   NAME_KEY                 cn=1,n=8
        19 012317   040000 100500                    MLR     fill='040'O
        19 012320   200046 000014                    ADSC9   ADDRESS_LUNAME,,AUTO     cn=0,n=12
        19 012321   002404 200014 11                 ADSC9   NAME_KEY+2               cn=1,n=12

     3775    30395    6                         ADDRESS_LUNAME);
     3776    30396    6                       NAME_KEY.L# = 20;

  30396 19 012322   024000 236003                    LDQ     10240,DU
        19 012323   002402 552040 11                 STBQ    NAME_KEY,'40'O

     3777    30397    7                       CALL M$DELREC (DELREC_NAME_MAP) WHENALTRETURN DO; END;

  30397 19 012324   000460 630400 12                 EPPR0   DELREC_NAME_MAP
        19 012325   440002 713400                    CLIMB   alt,+16386
        19 012326   401400 401760                    pmme    nvectors=4
        19 012327   012331 702000 19                 TSX2    s:30398
        19 012330   012331 710000 19                 TRA     s:30398

     3778    30398    6                       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:595  
  30398 19 012331   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 012332   450001 713400                    CLIMB   alt,close
        19 012333   406000 401760                    pmme    nvectors=13
        19 012334   016514 702000 19                 TSX2    E_PMME

     3779    30399    6                       CALL XUR$ENABLE;

  30399 19 012335   000020 631400 20                 EPPR1   16
        19 012336   000000 701000 xent               TSX1    XUR$ENABLE
        19 012337   000000 011000                    NOP     0

     3780    30400    6                   END;

  30400 19 012340   011471 710000 19                 TRA     REPARSE_USER

     3781    30401    5               CASE (%MODIFY_DI);

     3782    30402    5                   CALL VMD$DI_USER (VM_USERKEY,M$ME_NUM);

  30402 19 012341   000504 630400 20                 EPPR0   324
        19 012342   000000 631400 20                 EPPR1   0
        19 012343   000000 701000 xent               TSX1    VMD$DI_USER
        19 012344   000000 011000                    NOP     0
        19 012345   011471 710000 19                 TRA     REPARSE_USER

     3783    30403    5               CASE (%MODIFY_END);

     3784    30404    5                   GOTO END_MOD_USER;

  30404 19 012346   012350 710000 19                 TRA     END_MOD_USER

     3785    30405    5               END;

     3786    30406    4           END;

  30406 19 012347   011471 710000 19                 TRA     REPARSE_USER

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:596  
     3787    30407    3   END_MOD_USER:
     3788    30408    3           CALL VMA$PUT_LIST (VM_USERKEY,VM_ADDLIST$,M$MAIL_FILE_NUM) ALTRET(E_PMME);

  30408 19 012350   000206 630400 20    END_MOD_USER EPPR0   134
        19 012351   000021 631400 20                 EPPR1   17
        19 012352   000000 701000 xent               TSX1    VMA$PUT_LIST
        19 012353   016514 702000 19                 TSX2    E_PMME
        19 012354   016452 710000 19                 TRA     CONTINUE

     3789    30409        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:597  
     3790    30410        /* Next command */
     3791    30411    3       CASE (%CMD_NEXT_MESSAGE);

     3792    30412
     3793    30413    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE

  30413 19 012355   000544 235000 11                 LDA     LAST_COMMAND_CODE
        19 012356   000016 115007                    CMPA    14,DL
        19 012357   012374 601000 19                 TNZ     s:30448

     3794    30414    3           THEN
     3795    30415                    %INIT_STR (CODE=E_DI_NEXT_CMD, STR=VM_DI_NEXT_CMD,
     3796    30416                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  30423 19 012360   040000 106400                    CMPC    fill='040'O
        19 012361   004612 200017 11                 ADSC9   VM_DI_NEXT_CMD           cn=1,n=15
        19 012362   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 012363   012370 601000 19                 TNZ     s:30434

  30425 19 012364   000506 630400 20                 EPPR0   326
        19 012365   000000 631400 20                 EPPR1   0
        19 012366   000000 701000 xent               TSX1    VMD$ERRMSG
        19 012367   000000 011000                    NOP     0

  30434 19 012370   000100 100400                    MLR     fill='000'O
        19 012371   004612 000020 11                 ADSC9   VM_DI_NEXT_CMD           cn=0,n=16
        19 012372   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  30436 19 012373   016452 710000 19                 TRA     CONTINUE

     3797    30439    3           ELSE
     3798    30440                  %INIT_STR (CODE=E_LIST_NEXT_CMD, STR=VM_LIST_NEXT_CMD,
     3799    30441                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  30448 19 012374   040000 106400                    CMPC    fill='040'O
        19 012375   004616 200017 11                 ADSC9   VM_LIST_NEXT_CMD         cn=1,n=15
        19 012376   000035 000001 20                 ADSC9   29                       cn=0,n=1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:598  
        19 012377   012404 601000 19                 TNZ     s:30459

  30450 19 012400   000510 630400 20                 EPPR0   328
        19 012401   000000 631400 20                 EPPR1   0
        19 012402   000000 701000 xent               TSX1    VMD$ERRMSG
        19 012403   000000 011000                    NOP     0

  30459 19 012404   000100 100400                    MLR     fill='000'O
        19 012405   004616 000020 11                 ADSC9   VM_LIST_NEXT_CMD         cn=0,n=16
        19 012406   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  30461 19 012407   016452 710000 19                 TRA     CONTINUE

     3800    30464
     3801    30465        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:599  
     3802    30466        /* Output command */
     3803    30467    3       CASE (%CMD_OUTPUT);

     3804    30468    3           CALL XUR$OPENOUT (M$LO_NUM, OUT$ -> P$B)

  30468 19 012410   200023 236100                    LDQ     OUT$,,AUTO
        19 012411   000470 235000 20                 LDA     312
        19 012412   201706 757100                    STAQ    I+100,,AUTO
        19 012413   201706 630500                    EPPR0   I+100,,AUTO
        19 012414   000000 631400 20                 EPPR1   0
        19 012415   000000 701000 xent               TSX1    XUR$OPENOUT
        19 012416   012420 702000 19                 TSX2    s:30470
        19 012417   012431 710000 19                 TRA     s:30471

     3805    30469    4           WHENALTRETURN DO;

     3806    30470    4               CALL XUR$ERRMSG (XUG$GETCMD.ERR#,M$LO_NUM);

  30470 19 012420   000470 236000 20                 LDQ     312
        19 012421   201707 756100                    STQ     I+101,,AUTO
        19 012422   200003 236100                    LDQ     XUG_GETCMD$,,AUTO
        19 012423   000001 036003                    ADLQ    1,DU
        19 012424   201706 756100                    STQ     I+100,,AUTO
        19 012425   201706 630500                    EPPR0   I+100,,AUTO
        19 012426   000000 631400 20                 EPPR1   0
        19 012427   000000 701000 xent               TSX1    XUR$ERRMSG
        19 012430   000000 011000                    NOP     0

     3807    30471    4           END;

  30471 19 012431   016452 710000 19                 TRA     CONTINUE

     3808    30472        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:600  
     3809    30473        /* Page command */
     3810    30474    3       CASE (%CMD_PAGE);

     3811    30475    3           CALL VMD$EJECT(M$LO_NUM) ALTRET(E_PMME);

  30475 19 012432   000470 630400 20                 EPPR0   312
        19 012433   000024 631400 20                 EPPR1   20
        19 012434   000000 701000 xent               TSX1    VMD$EJECT
        19 012435   016514 702000 19                 TSX2    E_PMME
        19 012436   016452 710000 19                 TRA     CONTINUE

     3812    30476        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:601  
     3813    30477                                                /* Print command */
     3814    30478    3       CASE (%CMD_PRINT);

     3815    30479    3           CALL M$LDEV (PRINT_LDEV) ALTRET(E_PMME);

  30479 19 012437   001152 630400 12                 EPPR0   PRINT_LDEV
        19 012440   460004 713400                    CLIMB   alt,+24580
        19 012441   403000 401760                    pmme    nvectors=7
        19 012442   016514 702000 19                 TSX2    E_PMME
        19 012443   016452 710000 19                 TRA     CONTINUE

     3816    30480        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:602  
     3817    30481        /* Previous message command */
     3818    30482    3       CASE(%CMD_PREVIOUS_MESSAGE);

     3819    30483    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE

  30483 19 012444   000544 235000 11                 LDA     LAST_COMMAND_CODE
        19 012445   000016 115007                    CMPA    14,DL
        19 012446   012463 601000 19                 TNZ     s:30518

     3820    30484    3           THEN
     3821    30485                    %INIT_STR (CODE=E_DI_PREVIOUS_CMD, STR=VM_DI_PREVIOUS_CMD,
     3822    30486                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  30493 19 012447   040000 106400                    CMPC    fill='040'O
        19 012450   004626 200017 11                 ADSC9   VM_DI_PREVIOUS_CMD       cn=1,n=15
        19 012451   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 012452   012457 601000 19                 TNZ     s:30504

  30495 19 012453   000512 630400 20                 EPPR0   330
        19 012454   000000 631400 20                 EPPR1   0
        19 012455   000000 701000 xent               TSX1    VMD$ERRMSG
        19 012456   000000 011000                    NOP     0

  30504 19 012457   000100 100400                    MLR     fill='000'O
        19 012460   004626 000020 11                 ADSC9   VM_DI_PREVIOUS_CMD       cn=0,n=16
        19 012461   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  30506 19 012462   016452 710000 19                 TRA     CONTINUE

     3823    30509    3           ELSE
     3824    30510                  %INIT_STR (CODE=E_LIST_PREVIOUS_CMD, STR=VM_LIST_PREVIOUS_CMD,
     3825    30511                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  30518 19 012463   040000 106400                    CMPC    fill='040'O
        19 012464   004632 200017 11                 ADSC9   VM_LIST_PREVIOUS_CMD     cn=1,n=15
        19 012465   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 012466   012473 601000 19                 TNZ     s:30529
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:603  

  30520 19 012467   000514 630400 20                 EPPR0   332
        19 012470   000000 631400 20                 EPPR1   0
        19 012471   000000 701000 xent               TSX1    VMD$ERRMSG
        19 012472   000000 011000                    NOP     0

  30529 19 012473   000100 100400                    MLR     fill='000'O
        19 012474   004632 000020 11                 ADSC9   VM_LIST_PREVIOUS_CMD     cn=0,n=16
        19 012475   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  30531 19 012476   016452 710000 19                 TRA     CONTINUE

     3826    30534        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:604  
     3827    30535        /* Profile command */
     3828    30536    3       CASE (%CMD_PROFILE);

     3829    30537    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  30537 19 012477   016562 701000 19                 TSX1    NEED_UPDATE
        19 012500   016452 702000 19                 TSX2    CONTINUE

     3830    30538        /*
     3831    30539             ***** Copy current profile to work segment so it can be restored
     3832    30540                   if new record won't fit ...
     3833    30541        */
     3834    30542    3           IF VBOUND (VM_PROFILE_) > VBOUND (VM_WORK_)

  30542 19 012501   000000 236000 xsym               LDQ     VM_PROFILE_
        19 012502   000020 772000                    QRL     16
        19 012503   201706 756100                    STQ     I+100,,AUTO
        19 012504   000000 236000 xsym               LDQ     VM_WORK_
        19 012505   000020 772000                    QRL     16
        19 012506   201706 116100                    CMPQ    I+100,,AUTO
        19 012507   012526 605000 19                 TPL     s:30547

     3835    30543    4           THEN DO;

     3836    30544    4               INDX1 = (VBOUND (VM_PROFILE_) - VBOUND (VM_WORK_)) / 4;

  30544 19 012510   201706 756100                    STQ     I+100,,AUTO
        19 012511   000000 236000 xsym               LDQ     VM_PROFILE_
        19 012512   000020 772000                    QRL     16
        19 012513   201706 136100                    SBLQ    I+100,,AUTO
        19 012514   000004 506007                    DIV     4,DL
        19 012515   200033 756100                    STQ     INDX1,,AUTO

     3837    30545    4               CALL VMA$ENLARGE_SEGMENT (VM_WORK_,INDX1) ALTRET(E_PMME);

  30545 19 012516   200033 630500                    EPPR0   INDX1,,AUTO
        19 012517   201707 450500                    STP0    I+101,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:605  
        19 012520   000010 236000 20                 LDQ     8
        19 012521   201706 756100                    STQ     I+100,,AUTO
        19 012522   201706 630500                    EPPR0   I+100,,AUTO
        19 012523   000000 631400 20                 EPPR1   0
        19 012524   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 012525   016514 702000 19                 TSX2    E_PMME

     3838    30546    4           END;

     3839    30547    3           INDX1 = VM_PROFILE.PROFILE_SIZE * 4;

  30547 19 012526   000000 470400 xsym               LDP0    VM_PROFILE$
        19 012527   000002 235100                    LDA     2,,PR0
        19 012530   000002 735000                    ALS     2
        19 012531   200033 755100                    STA     INDX1,,AUTO

     3840    30548    3           VM_WORK$ -> INDX1_CHARS = VM_PROFILE$ -> INDX1_CHARS;

  30548 19 012532   000000 620005                    EAX0    0,AL
        19 012533   000000 471400 xsym               LDP1    VM_WORK$
        19 012534   200033 721100                    LXL1    INDX1,,AUTO
        19 012535   040140 100540                    MLR     fill='040'O
        19 012536   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
        19 012537   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

     3841    30549        /*
     3842    30550             ***** Setup for dynamic allocation of WORK_AREA ...
     3843    30551        */
     3844    30552    3           X$MCB.WKSZ = VM_PROFILE.PROFILE_SIZE -

  30552 19 012540   000000 236000 xsym               LDQ     VM_PROFILE$
        19 012541   000022 772000                    QRL     18
        19 012542   201706 756100                    STQ     I+100,,AUTO
        19 012543   000000 236000 xsym               LDQ     VM_PROFILE$
        19 012544   000160 036003                    ADLQ    112,DU
        19 012545   000022 772000                    QRL     18
        19 012546   201706 136100                    SBLQ    I+100,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:606  
        19 012547   201707 756100                    STQ     I+101,,AUTO
        19 012550   000002 236100                    LDQ     2,,PR0
        19 012551   201707 136100                    SBLQ    I+101,,AUTO
        19 012552   001656 756000 11                 STQ     X$MCB+4

     3845    30553    3             POFFW(ADDR(VM_PROFILE.WORK_AREA),ADDR(VM_PROFILE));
     3846    30554    3           X$MCB.FREE_HEAD$ = VM_PROFILE.FREE$;

  30554 19 012553   000003 236100                    LDQ     3,,PR0
        19 012554   001653 756000 11                 STQ     X$MCB+1

     3847    30555    3           X$MCB.SEGMENT_BASE$ = ADDR(VM_PROFILE.WORK_AREA);

  30555 19 012555   000000 236000 xsym               LDQ     VM_PROFILE$
        19 012556   000160 036003                    ADLQ    112,DU
        19 012557   001654 756000 11                 STQ     X$MCB+2

     3848    30556    3           X$MCB.HI_SEGMENT$ = VM_PROFILE.NEXT$;

  30556 19 012560   000004 236100                    LDQ     4,,PR0
        19 012561   001655 756000 11                 STQ     X$MCB+3

     3849    30557    3           X$MCB.TYPE = 0;

  30557 19 012562   001657 450000 11                 STZ     X$MCB+5

     3850    30558        /**/
     3851    30559    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;

  30559 19 012563   200033 450100                    STZ     INDX1,,AUTO
        19 012564   014040 710000 19                 TRA     s:30860+1

     3852    30560
     3853    30561    4               BLK$ = OUT$ -> P$B.SUBLK$ (INDX1);

  30561 19 012565   200023 470500                    LDP0    OUT$,,AUTO
        19 012566   200033 720100                    LXL0    INDX1,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:607  
        19 012567   000003 236110                    LDQ     3,X0,PR0
        19 012570   200024 756100                    STQ     BLK$,,AUTO

     3854    30562
     3855    30563    5               DO CASE (P$S.CODE);

  30563 19 012571   200024 471500                    LDP1    BLK$,,AUTO
        19 012572   100000 721100                    LXL1    0,,PR1
        19 012573   000025 101003                    CMPX1   21,DU
        19 012574   012576 602011 19                 TNC     s:30563+5,X1
        19 012575   014037 710000 19                 TRA     s:30860
        19 012576   014037 710000 19                 TRA     s:30860
        19 012577   012776 710000 19                 TRA     s:30626
        19 012600   013056 710000 19                 TRA     s:30653
        19 012601   012747 710000 19                 TRA     s:30615
        19 012602   012762 710000 19                 TRA     s:30619
        19 012603   013243 710000 19                 TRA     s:30697
        19 012604   013042 710000 19                 TRA     s:30647
        19 012605   013401 710000 19                 TRA     s:30737
        19 012606   013355 710000 19                 TRA     s:30728
        19 012607   013557 710000 19                 TRA     s:30777
        19 012610   013012 710000 19                 TRA     s:30633
        19 012611   013465 710000 19                 TRA     s:30758
        19 012612   013257 710000 19                 TRA     s:30707
        19 012613   012667 710000 19                 TRA     s:30587
        19 012614   012733 710000 19                 TRA     s:30608
        19 012615   012703 710000 19                 TRA     s:30594
        19 012616   012717 710000 19                 TRA     s:30601
        19 012617   012623 710000 19                 TRA     s:30566
        19 012620   013026 710000 19                 TRA     s:30640
        19 012621   012653 710000 19                 TRA     s:30580
        19 012622   012637 710000 19                 TRA     s:30573

     3856    30564
     3857    30565    5               CASE (%POPT_ANSWER);

     3858    30566    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_RECEIVERS
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:608  

  30566 19 012623   100003 473500                    LDP3    3,,PR1
        19 012624   300000 722100                    LXL2    0,,PR3
        19 012625   000003 102003                    CMPX2   3,DU
        19 012626   012633 601000 19                 TNZ     s:30570

     3859    30567    5                   THEN
     3860    30568    5                       VM_PROFILE.OPT.ANS_RECEIVERS = %YES#;

  30568 19 012627   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012630   400000 236003                    LDQ     -131072,DU
        19 012631   400001 256100                    ORSQ    1,,PR4
        19 012632   014037 710000 19                 TRA     s:30860

     3861    30569    5                   ELSE
     3862    30570    5                       VM_PROFILE.OPT.ANS_RECEIVERS = %NO#;

  30570 19 012633   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012634   000516 236000 20                 LDQ     334
        19 012635   400001 356100                    ANSQ    1,,PR4
        19 012636   014037 710000 19                 TRA     s:30860

     3863    30571
     3864    30572    5               CASE (%POPT_DELATTACH);

     3865    30573    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30573 19 012637   100003 473500                    LDP3    3,,PR1
        19 012640   300000 722100                    LXL2    0,,PR3
        19 012641   000001 102003                    CMPX2   1,DU
        19 012642   012647 601000 19                 TNZ     s:30577

     3866    30574    5                   THEN          /* Yes specified */
     3867    30575    5                       VM_PROFILE.OPT.DEL_ON_DETACH = %YES#;

  30575 19 012643   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012644   040000 236003                    LDQ     16384,DU
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:609  
        19 012645   400001 256100                    ORSQ    1,,PR4
        19 012646   014037 710000 19                 TRA     s:30860

     3868    30576    5                   ELSE          /* No specified */
     3869    30577    5                       VM_PROFILE.OPT.DEL_ON_DETACH = %NO#;

  30577 19 012647   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012650   000517 236000 20                 LDQ     335
        19 012651   400001 356100                    ANSQ    1,,PR4
        19 012652   014037 710000 19                 TRA     s:30860

     3870    30578
     3871    30579    5               CASE (%POPT_EXTADDRDISP);

     3872    30580    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30580 19 012653   100003 473500                    LDP3    3,,PR1
        19 012654   300000 722100                    LXL2    0,,PR3
        19 012655   000001 102003                    CMPX2   1,DU
        19 012656   012663 601000 19                 TNZ     s:30584

     3873    30581    5                   THEN          /* Yes specified */
     3874    30582    5                       VM_PROFILE.OPT.EXT_ADDR_DISP = %YES#;

  30582 19 012657   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012660   100000 236003                    LDQ     32768,DU
        19 012661   400001 256100                    ORSQ    1,,PR4
        19 012662   014037 710000 19                 TRA     s:30860

     3875    30583    5                   ELSE          /* No specified */
     3876    30584    5                       VM_PROFILE.OPT.EXT_ADDR_DISP = %NO#;

  30584 19 012663   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012664   000055 236000 20                 LDQ     45
        19 012665   400001 356100                    ANSQ    1,,PR4
        19 012666   014037 710000 19                 TRA     s:30860

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:610  
     3877    30585
     3878    30586    5               CASE (%POPT_AUTOEDIT);

     3879    30587    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30587 19 012667   100003 473500                    LDP3    3,,PR1
        19 012670   300000 722100                    LXL2    0,,PR3
        19 012671   000001 102003                    CMPX2   1,DU
        19 012672   012677 601000 19                 TNZ     s:30591

     3880    30588    5                   THEN           /* Yes specified */
     3881    30589    5                       VM_PROFILE.OPT.AUTO_EDIT = %YES#;

  30589 19 012673   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012674   000010 236007                    LDQ     8,DL
        19 012675   400000 256100                    ORSQ    0,,PR4
        19 012676   014037 710000 19                 TRA     s:30860

     3882    30590    5                   ELSE           /* No specified */
     3883    30591    5                       VM_PROFILE.OPT.AUTO_EDIT = %NO#;

  30591 19 012677   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012700   000520 236000 20                 LDQ     336
        19 012701   400000 356100                    ANSQ    0,,PR4
        19 012702   014037 710000 19                 TRA     s:30860

     3884    30592
     3885    30593    5               CASE (%POPT_COMBINE);

     3886    30594    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30594 19 012703   100003 473500                    LDP3    3,,PR1
        19 012704   300000 722100                    LXL2    0,,PR3
        19 012705   000001 102003                    CMPX2   1,DU
        19 012706   012713 601000 19                 TNZ     s:30598

     3887    30595    5                   THEN           /* Yes specified */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:611  
     3888    30596    5                       VM_PROFILE.OPT.COMBINE = %YES#;

  30596 19 012707   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012710   000002 236007                    LDQ     2,DL
        19 012711   400000 256100                    ORSQ    0,,PR4
        19 012712   014037 710000 19                 TRA     s:30860

     3889    30597    5                   ELSE           /* No specified */
     3890    30598    5                       VM_PROFILE.OPT.COMBINE = %NO#;

  30598 19 012713   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012714   000521 236000 20                 LDQ     337
        19 012715   400000 356100                    ANSQ    0,,PR4
        19 012716   014037 710000 19                 TRA     s:30860

     3891    30599
     3892    30600    5               CASE (%POPT_DR);

     3893    30601    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30601 19 012717   100003 473500                    LDP3    3,,PR1
        19 012720   300000 722100                    LXL2    0,,PR3
        19 012721   000001 102003                    CMPX2   1,DU
        19 012722   012727 601000 19                 TNZ     s:30605

     3894    30602    5                   THEN           /* Yes specified */
     3895    30603    5                       VM_PROFILE.OPT.DELIVERY_RECEIPT = %YES#;

  30603 19 012723   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012724   000001 236007                    LDQ     1,DL
        19 012725   400000 256100                    ORSQ    0,,PR4
        19 012726   014037 710000 19                 TRA     s:30860

     3896    30604    5                   ELSE           /* No specified */
     3897    30605    5                       VM_PROFILE.OPT.DELIVERY_RECEIPT = %NO#;

  30605 19 012727   000000 474400 xsym               LDP4    VM_PROFILE$
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:612  
        19 012730   000522 236000 20                 LDQ     338
        19 012731   400000 356100                    ANSQ    0,,PR4
        19 012732   014037 710000 19                 TRA     s:30860

     3898    30606
     3899    30607    5               CASE (%POPT_DISPTRACE);

     3900    30608    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30608 19 012733   100003 473500                    LDP3    3,,PR1
        19 012734   300000 722100                    LXL2    0,,PR3
        19 012735   000001 102003                    CMPX2   1,DU
        19 012736   012743 601000 19                 TNZ     s:30612

     3901    30609    5                   THEN           /* Yes specified */
     3902    30610    5                       VM_PROFILE.OPT.DISPTRACE = %YES#;

  30610 19 012737   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012740   000004 236007                    LDQ     4,DL
        19 012741   400000 256100                    ORSQ    0,,PR4
        19 012742   014037 710000 19                 TRA     s:30860

     3903    30611    5                   ELSE           /* No specified */
     3904    30612    5                       VM_PROFILE.OPT.DISPTRACE = %NO#;

  30612 19 012743   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012744   000523 236000 20                 LDQ     339
        19 012745   400000 356100                    ANSQ    0,,PR4
        19 012746   014037 710000 19                 TRA     s:30860

     3905    30613
     3906    30614    5               CASE (%POPT_GRANULES) ;

     3907    30615    5                   CALL CHARBIN(TEMP,P$B.SUBLK$(0)->P$S.TEXT);

  30615 19 012747   100003 473500                    LDP3    3,,PR1
        19 012750   300004 236100                    LDQ     4,,PR3
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:613  
        19 012751   000033 772000                    QRL     27
        19 012752   000000 622006                    EAX2    0,QL
        19 012753   000100 305540                    DTB
        19 012754   300004 230012                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X2
        19 012755   201102 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4

     3908    30616    5                   VM_PROFILE.GRANULES = TEMP;

  30616 19 012756   201102 235100                    LDA     TEMP,,AUTO
        19 012757   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012760   400012 755100                    STA     10,,PR4
        19 012761   014037 710000 19                 TRA     s:30860

     3909    30617
     3910    30618    5               CASE (%POPT_HEADERS);

     3911    30619    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30619 19 012762   100003 473500                    LDP3    3,,PR1
        19 012763   300000 722100                    LXL2    0,,PR3
        19 012764   000001 102003                    CMPX2   1,DU
        19 012765   012772 601000 19                 TNZ     s:30623

     3912    30620    5                   THEN           /* Yes specified */
     3913    30621    5                       VM_PROFILE.OPT.HEADERS = %YES#;

  30621 19 012766   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012767   000400 236007                    LDQ     256,DL
        19 012770   400000 256100                    ORSQ    0,,PR4
        19 012771   014037 710000 19                 TRA     s:30860

     3914    30622    5                   ELSE           /* No specified */
     3915    30623    5                       VM_PROFILE.OPT.HEADERS = %NO#;

  30623 19 012772   000000 474400 xsym               LDP4    VM_PROFILE$
        19 012773   000524 236000 20                 LDQ     340
        19 012774   400000 356100                    ANSQ    0,,PR4
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:614  
        19 012775   014037 710000 19                 TRA     s:30860

     3916    30624
     3917    30625    5               CASE (%POPT_FCOPY);

     3918    30626    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30626 19 012776   100003 473500                    LDP3    3,,PR1
        19 012777   300000 722100                    LXL2    0,,PR3
        19 013000   000001 102003                    CMPX2   1,DU
        19 013001   013006 601000 19                 TNZ     s:30630

     3919    30627    5                   THEN           /* Yes specified */
     3920    30628    5                       VM_PROFILE.OPT.FCOPY = %YES#;

  30628 19 013002   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013003   000200 236007                    LDQ     128,DL
        19 013004   400000 256100                    ORSQ    0,,PR4
        19 013005   014037 710000 19                 TRA     s:30860

     3921    30629    5                   ELSE           /* No specified */
     3922    30630    5                       VM_PROFILE.OPT.FCOPY = %NO#;

  30630 19 013006   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013007   000525 236000 20                 LDQ     341
        19 013010   400000 356100                    ANSQ    0,,PR4
        19 013011   014037 710000 19                 TRA     s:30860

     3923    30631
     3924    30632    5               CASE (%POPT_PAGE);

     3925    30633    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30633 19 013012   100003 473500                    LDP3    3,,PR1
        19 013013   300000 722100                    LXL2    0,,PR3
        19 013014   000001 102003                    CMPX2   1,DU
        19 013015   013022 601000 19                 TNZ     s:30637
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:615  

     3926    30634    5                   THEN           /* Yes specified */
     3927    30635    5                       VM_PROFILE.OPT.PAGE = %YES#;

  30635 19 013016   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013017   000020 236007                    LDQ     16,DL
        19 013020   400000 256100                    ORSQ    0,,PR4
        19 013021   014037 710000 19                 TRA     s:30860

     3928    30636    5                   ELSE           /* No specified */
     3929    30637    5                       VM_PROFILE.OPT.PAGE = %NO#;

  30637 19 013022   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013023   000526 236000 20                 LDQ     342
        19 013024   400000 356100                    ANSQ    0,,PR4
        19 013025   014037 710000 19                 TRA     s:30860

     3930    30638
     3931    30639    5               CASE (%POPT_PREP);

     3932    30640    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30640 19 013026   100003 473500                    LDP3    3,,PR1
        19 013027   300000 722100                    LXL2    0,,PR3
        19 013030   000001 102003                    CMPX2   1,DU
        19 013031   013036 601000 19                 TNZ     s:30644

     3933    30641    5                   THEN           /* Yes specified */
     3934    30642    5                       VM_PROFILE.OPT.PREPROCESS = %YES#;

  30642 19 013032   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013033   200000 236003                    LDQ     65536,DU
        19 013034   400001 256100                    ORSQ    1,,PR4
        19 013035   014037 710000 19                 TRA     s:30860

     3935    30643    5                   ELSE           /* No specified */
     3936    30644    5                       VM_PROFILE.OPT.PREPROCESS = %NO#;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:616  

  30644 19 013036   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013037   000040 236000 20                 LDQ     32
        19 013040   400001 356100                    ANSQ    1,,PR4
        19 013041   014037 710000 19                 TRA     s:30860

     3937    30645
     3938    30646    5               CASE (%POPT_RENUMBER);

     3939    30647    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30647 19 013042   100003 473500                    LDP3    3,,PR1
        19 013043   300000 722100                    LXL2    0,,PR3
        19 013044   000001 102003                    CMPX2   1,DU
        19 013045   013052 601000 19                 TNZ     s:30651

     3940    30648    5                   THEN           /* Yes specified */
     3941    30649    5                       VM_PROFILE.OPT.RENUMBER = %YES#;

  30649 19 013046   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013047   000040 236007                    LDQ     32,DL
        19 013050   400000 256100                    ORSQ    0,,PR4
        19 013051   014037 710000 19                 TRA     s:30860

     3942    30650    5                   ELSE           /* No specified */
     3943    30651    5                       VM_PROFILE.OPT.RENUMBER = %NO#;

  30651 19 013052   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013053   000527 236000 20                 LDQ     343
        19 013054   400000 356100                    ANSQ    0,,PR4
        19 013055   014037 710000 19                 TRA     s:30860

     3944    30652    5               CASE (%POPT_FFOLDER);

     3945    30653    5                   IF VM_PROFILE.FILE_FOLDER$ = ADDR(NIL)

  30653 19 013056   000000 473400 xsym               LDP3    VM_PROFILE$
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:617  
        19 013057   300114 236100                    LDQ     76,,PR3
        19 013060   000022 116000 20                 CMPQ    18
        19 013061   013073 601000 19                 TNZ     s:30660

     3946    30654    5                   THEN
     3947    30655    6                   DO;        /* Allocate space */

     3948    30656    6                       X$MCB.SIZE = SIZEC(VM$RADDRESS);

  30656 19 013062   000120 235007                    LDA     80,DL
        19 013063   001660 755000 11                 STA     X$MCB+6

     3949    30657    6                       CALL X$ALLOCATE (X$MCB) ALTRET(E_ALLOCATE);

  30657 19 013064   000530 630400 20                 EPPR0   344
        19 013065   000024 631400 20                 EPPR1   20
        19 013066   000000 701000 xent               TSX1    X$ALLOCATE
        19 013067   016542 702000 19                 TSX2    E_ALLOCATE

     3950    30658    6                       VM_PROFILE.FILE_FOLDER$ = X$MCB.ADDRESS$;

  30658 19 013070   001652 236000 11                 LDQ     X$MCB
        19 013071   000000 470400 xsym               LDP0    VM_PROFILE$
        19 013072   000114 756100                    STQ     76,,PR0

     3951    30659    6                   END;

     3952    30660    5                   BLK$ = BLK$ -> P$B.SUBLK$(0); /* To account for OPT_MID */

  30660 19 013073   200024 470500                    LDP0    BLK$,,AUTO
        19 013074   000003 236100                    LDQ     3,,PR0
        19 013075   200024 756100                    STQ     BLK$,,AUTO

     3953    30661    5                   IF BLK$->P$B.CODE = %OPT_NONE

  30661 19 013076   200024 470500                    LDP0    BLK$,,AUTO
        19 013077   000000 720100                    LXL0    0,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:618  
        19 013100   000005 100003                    CMPX0   5,DU
        19 013101   013115 601000 19                 TNZ     s:30668

     3954    30662    6                   THEN DO;

     3955    30663    6                       X$MCB.ADDRESS$ = VM_PROFILE.FILE_FOLDER$;

  30663 19 013102   000000 471400 xsym               LDP1    VM_PROFILE$
        19 013103   100114 236100                    LDQ     76,,PR1
        19 013104   001652 756000 11                 STQ     X$MCB

     3956    30664    6                       CALL X$DEALLOCATE (X$MCB) ALTRET(E_ALLOCATE);

  30664 19 013105   000530 630400 20                 EPPR0   344
        19 013106   000024 631400 20                 EPPR1   20
        19 013107   000000 701000 xent               TSX1    X$DEALLOCATE
        19 013110   016542 702000 19                 TSX2    E_ALLOCATE

     3957    30665    6                       VM_PROFILE.FILE_FOLDER$ = ADDR(NIL);

  30665 19 013111   000022 236000 20                 LDQ     18
        19 013112   000000 470400 xsym               LDP0    VM_PROFILE$
        19 013113   000114 756100                    STQ     76,,PR0

     3958    30666    6                   END;

  30666 19 013114   014037 710000 19                 TRA     s:30860

     3959    30667    6                   ELSE DO;

     3960    30668    6                       VM_RADDRESS.ACCT = VM_CURRENT_FOLDER.ACCT;

  30668 19 013115   040100 100400                    MLR     fill='040'O
        19 013116   001244 400010 11                 ADSC9   VM_CURRENT_FOLDER+1      cn=2,n=8
        19 013117   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8

     3961    30669    6                       VM_RADDRESS.FOLDER = VM_CURRENT_FOLDER.FOLDER;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:619  

  30669 19 013120   040100 100400                    MLR     fill='040'O
        19 013121   001246 400031 11                 ADSC9   VM_CURRENT_FOLDER+3      cn=2,n=25
        19 013122   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25

     3962    30670    6                       VM_RADDRESS.PASS = VM_CURRENT_FOLDER.PASS;

  30670 19 013123   040100 100400                    MLR     fill='040'O
        19 013124   001254 600010 11                 ADSC9   VM_CURRENT_FOLDER+9      cn=3,n=8
        19 013125   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8

     3963    30671    6                       VM_RADDRESS.SITENAME = VM_CURRENT_FOLDER.SITENAME;

  30671 19 013126   040100 100400                    MLR     fill='040'O
        19 013127   001256 600010 11                 ADSC9   VM_CURRENT_FOLDER+11     cn=3,n=8
        19 013130   200770 600010                    ADSC9   VM_RADDRESS+15,,AUTO     cn=3,n=8

     3964    30672    6                       VM_RADDRESS.NEXT$ = ADDR(NIL);

  30672 19 013131   000022 236000 20                 LDQ     18
        19 013132   200751 756100                    STQ     VM_RADDRESS,,AUTO

     3965    30673    6                       VM_RADDRESS.PREV$ = ADDR(NIL);

  30673 19 013133   200752 756100                    STQ     VM_RADDRESS+1,,AUTO

     3966    30674    6                       VM_RADDRESS.FLAGS = %NO#;

  30674 19 013134   000000 236003                    LDQ     0,DU
        19 013135   200753 552140                    STBQ    VM_RADDRESS+2,'40'O,AUTO

     3967    30675    6                       VM_RADDRESS.TYPE = %VM_ADD_RESOLVED;

  30675 19 013136   000001 236003                    LDQ     1,DU
        19 013137   200753 552120                    STBQ    VM_RADDRESS+2,'20'O,AUTO

     3968    30676    7                       DO INDX2 = 0 TO BLK$ -> P$B.NSUBLKS - 1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:620  

  30676 19 013140   000375 450000 11                 STZ     INDX2
        19 013141   013213 710000 19                 TRA     s:30688+1

     3969    30677    7                           PTR1$ = BLK$ -> P$B.SUBLK$(INDX2);

  30677 19 013142   200024 470500                    LDP0    BLK$,,AUTO
        19 013143   000375 720000 11                 LXL0    INDX2
        19 013144   000003 236110                    LDQ     3,X0,PR0
        19 013145   200025 756100                    STQ     PTR1$,,AUTO

     3970    30678    8                           DO CASE (PTR1$ -> P$B.CODE);

  30678 19 013146   200025 471500                    LDP1    PTR1$,,AUTO
        19 013147   100000 721100                    LXL1    0,,PR1
        19 013150   000006 101003                    CMPX1   6,DU
        19 013151   013153 602011 19                 TNC     s:30678+5,X1
        19 013152   013212 710000 19                 TRA     s:30688
        19 013153   013212 710000 19                 TRA     s:30688
        19 013154   013212 710000 19                 TRA     s:30688
        19 013155   013161 710000 19                 TRA     s:30680
        19 013156   013170 710000 19                 TRA     s:30682
        19 013157   013177 710000 19                 TRA     s:30684
        19 013160   013204 710000 19                 TRA     s:30686

     3971    30679    8                           CASE (%ADD_ACCT);

     3972    30680    8                               VM_RADDRESS.ACCT = PTR1$ -> P$S.TEXT;

  30680 19 013161   100004 236100                    LDQ     4,,PR1
        19 013162   000033 772000                    QRL     27
        19 013163   000000 622006                    EAX2    0,QL
        19 013164   040100 100540                    MLR     fill='040'O
        19 013165   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 013166   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8
        19 013167   013212 710000 19                 TRA     s:30688

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:621  
     3973    30681    8                           CASE (%ADD_FOLDER);

     3974    30682    8                               VM_RADDRESS.FOLDER = PTR1$ -> P$S.TEXT;

  30682 19 013170   100004 236100                    LDQ     4,,PR1
        19 013171   000033 772000                    QRL     27
        19 013172   000000 622006                    EAX2    0,QL
        19 013173   040100 100540                    MLR     fill='040'O
        19 013174   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 013175   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
        19 013176   013212 710000 19                 TRA     s:30688

     3975    30683    8                           CASE (%ADD_NAME);

     3976    30684    8                               CALL XUR$ERRMSG (E_NAMENTALLOWED);

  30684 19 013177   000166 630400 20                 EPPR0   118
        19 013200   000024 631400 20                 EPPR1   20
        19 013201   000000 701000 xent               TSX1    XUR$ERRMSG
        19 013202   000000 011000                    NOP     0
        19 013203   013212 710000 19                 TRA     s:30688

     3977    30685    8                           CASE (%ADD_PASS);

     3978    30686    8                               VM_RADDRESS.PASS = PTR1$ -> P$S.TEXT;

  30686 19 013204   100004 236100                    LDQ     4,,PR1
        19 013205   000033 772000                    QRL     27
        19 013206   000000 622006                    EAX2    0,QL
        19 013207   040100 100540                    MLR     fill='040'O
        19 013210   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 013211   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8

     3979    30687    8                           END; /* Do case ... end */

     3980    30688    7                       END; /* Do INDX1 = ... end */

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:622  
  30688 19 013212   000375 054000 11                 AOS     INDX2
        19 013213   200024 470500                    LDP0    BLK$,,AUTO
        19 013214   000001 236100                    LDQ     1,,PR0
        19 013215   000022 772000                    QRL     18
        19 013216   000375 116000 11                 CMPQ    INDX2
        19 013217   013142 605400 19                 TPNZ    s:30677

     3981    30689    6                       IF (VM_RADDRESS.FOLDER='CENTRAL') AND

  30689 19 013220   040000 106500                    CMPC    fill='040'O
        19 013221   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
        19 013222   001360 000007 12                 ADSC9   VM_PROKEY+3              cn=0,n=7
        19 013223   013235 601000 19                 TNZ     s:30694
        19 013224   000000 471400 xsym               LDP1    B$JIT$
        19 013225   040100 106500                    CMPC    fill='040'O
        19 013226   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8
        19 013227   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
        19 013230   013235 601000 19                 TNZ     s:30694

     3982    30690    6                         (VM_RADDRESS.ACCT=B$JIT.ACCN)
     3983    30691    6                       THEN
     3984    30692    6                           VM_PROFILE.FILE_FOLDER$ = ADDR(NIL);

  30692 19 013231   000022 236000 20                 LDQ     18
        19 013232   000000 473400 xsym               LDP3    VM_PROFILE$
        19 013233   300114 756100                    STQ     76,,PR3
        19 013234   014037 710000 19                 TRA     s:30860

     3985    30693    6                       ELSE
     3986    30694    6                           VM_PROFILE.FILE_FOLDER$ -> VM$RADDRESS = VM_RADDRESS;

  30694 19 013235   000000 471400 xsym               LDP1    VM_PROFILE$
        19 013236   100114 473500                    LDP3    76,,PR1
        19 013237   000100 100500                    MLR     fill='000'O
        19 013240   200751 000117                    ADSC9   VM_RADDRESS,,AUTO        cn=0,n=79
        19 013241   300000 000117                    ADSC9   0,,PR3                   cn=0,n=79

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:623  
     3987    30695    6                   END;       /* If not none */

  30695 19 013242   014037 710000 19                 TRA     s:30860

     3988    30696    5               CASE (%POPT_RR);

     3989    30697    5                   IF P$B.SUBLK$(0) -> P$B.CODE = %OPT_YES

  30697 19 013243   100003 473500                    LDP3    3,,PR1
        19 013244   300000 722100                    LXL2    0,,PR3
        19 013245   000001 102003                    CMPX2   1,DU
        19 013246   013253 601000 19                 TNZ     s:30701

     3990    30698    5                   THEN           /* Yes specified */
     3991    30699    5                       VM_PROFILE.OPT.RETURN_RECEIPT = %YES#;

  30699 19 013247   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013250   000100 236007                    LDQ     64,DL
        19 013251   400000 256100                    ORSQ    0,,PR4
        19 013252   014037 710000 19                 TRA     s:30860

     3992    30700    5                   ELSE           /* No specified */
     3993    30701    5                       VM_PROFILE.OPT.RETURN_RECEIPT = %NO#;

  30701 19 013253   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013254   000531 236000 20                 LDQ     345
        19 013255   400000 356100                    ANSQ    0,,PR4
        19 013256   014037 710000 19                 TRA     s:30860

     3994    30702
     3995    30703    5               CASE (%POPT_RTO);

     3996    30704        /*
     3997    30705             ***** Release any allocated space ...
     3998    30706        */
     3999    30707    5                   IF VM_PROFILE.REPLY_TO$ ~= ADDR(NIL)

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:624  
  30707 19 013257   000000 473400 xsym               LDP3    VM_PROFILE$
        19 013260   300140 236100                    LDQ     96,,PR3
        19 013261   000022 116000 20                 CMPQ    18
        19 013262   013273 600000 19                 TZE     s:30715

     4000    30708    5                   THEN
     4001    30709    6                   DO;

     4002    30710    6                       X$MCB.ADDRESS$ = VM_PROFILE.REPLY_TO$;

  30710 19 013263   001652 756000 11                 STQ     X$MCB

     4003    30711    6                       CALL X$DEALLOCATE (X$MCB) ALTRET(E_ALLOCATE);

  30711 19 013264   000530 630400 20                 EPPR0   344
        19 013265   000024 631400 20                 EPPR1   20
        19 013266   000000 701000 xent               TSX1    X$DEALLOCATE
        19 013267   016542 702000 19                 TSX2    E_ALLOCATE

     4004    30712    6                       VM_PROFILE.REPLY_TO$ = ADDR(NIL);

  30712 19 013270   000022 236000 20                 LDQ     18
        19 013271   000000 470400 xsym               LDP0    VM_PROFILE$
        19 013272   000140 756100                    STQ     96,,PR0

     4005    30713    6                   END;

     4006    30714        /* Check if none or null string was specified */
     4007    30715    5                   IF P$B.SUBLK$(0) -> P$B.CODE ~= %OPT_NONE AND P$B.SUBLK$(0)->P$B.
             30715                            SUBLK$(0) -> P$S.COUNT > 0

  30715 19 013273   200024 470500                    LDP0    BLK$,,AUTO
        19 013274   000003 471500                    LDP1    3,,PR0
        19 013275   100000 720100                    LXL0    0,,PR1
        19 013276   000005 100003                    CMPX0   5,DU
        19 013277   014037 600000 19                 TZE     s:30860
        19 013300   100003 473500                    LDP3    3,,PR1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:625  
        19 013301   300004 236100                    LDQ     4,,PR3
        19 013302   777000 316003                    CANQ    -512,DU
        19 013303   014037 600000 19                 TZE     s:30860

     4008    30716    5                   THEN
     4009    30717    6                   DO;

     4010    30718    6                       BLK$ = OUT$ -> P$B.SUBLK$(INDX1) -> P$B.SUBLK$(0);

  30718 19 013304   200023 474500                    LDP4    OUT$,,AUTO
        19 013305   200033 721100                    LXL1    INDX1,,AUTO
        19 013306   400003 475511                    LDP5    3,X1,PR4
        19 013307   500003 236100                    LDQ     3,,PR5
        19 013310   200024 756100                    STQ     BLK$,,AUTO

     4011    30719    6                       INDX2 = P$B.CPOS;

  30719 19 013311   200024 470500                    LDP0    BLK$,,AUTO
        19 013312   000002 235100                    LDA     2,,PR0
        19 013313   000375 755000 11                 STA     INDX2

     4012    30720    6                       X$MCB.SIZE = (P_PCB.NCHARS - INDX2) + 1;

  30720 19 013314   000011 236000 11                 LDQ     P_PCB+9
        19 013315   000375 136000 11                 SBLQ    INDX2
        19 013316   000001 036007                    ADLQ    1,DL
        19 013317   001660 756000 11                 STQ     X$MCB+6

     4013    30721    6                       X$MCB.TYPE = 0; /* Bytes */

  30721 19 013320   001657 450000 11                 STZ     X$MCB+5

     4014    30722    6                       CALL X$ALLOCATE (X$MCB) ALTRET(E_ALLOCATE);

  30722 19 013321   000530 630400 20                 EPPR0   344
        19 013322   000024 631400 20                 EPPR1   20
        19 013323   000000 701000 xent               TSX1    X$ALLOCATE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:626  
        19 013324   016542 702000 19                 TSX2    E_ALLOCATE

     4015    30723    6                       VM_PROFILE.REPLY_TO$ = X$MCB.ADDRESS$;

  30723 19 013325   001652 236000 11                 LDQ     X$MCB
        19 013326   000000 470400 xsym               LDP0    VM_PROFILE$
        19 013327   000140 756100                    STQ     96,,PR0

     4016    30724    6                       VM_PROFILE.REPLY_TO$ -> X$STRING.SIZ = X$MCB.SIZE - 1;

  30724 19 013330   000140 471500                    LDP1    96,,PR0
        19 013331   001660 236000 11                 LDQ     X$MCB+6
        19 013332   000001 136007                    SBLQ    1,DL
        19 013333   201706 756100                    STQ     I+100,,AUTO
        19 013334   000100 101500                    MRL     fill='000'O
        19 013335   201706 000004                    ADSC9   I+100,,AUTO              cn=0,n=4
        19 013336   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     4017    30725    6                       VM_PROFILE.REPLY_TO$ -> X$STRING.TEXT = SUBSTR(CURRENT_LINE,
             30725                                INDX2,P_PCB.NCHARS - INDX2);

  30725 19 013337   000140 471500                    LDP1    96,,PR0
        19 013340   000100 101500                    MRL     fill='000'O
        19 013341   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 013342   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 013343   201706 220100                    LDX0    I+100,,AUTO
        19 013344   000011 236000 11                 LDQ     P_PCB+9
        19 013345   000375 136000 11                 SBLQ    INDX2
        19 013346   000000 473400 11                 LDP3    P_PCB
        19 013347   000000 621006                    EAX1    0,QL
        19 013350   000375 235000 11                 LDA     INDX2
        19 013351   040140 100545                    MLR     fill='040'O
        19 013352   300000 000011                    ADSC9   0,A,PR3                  cn=0,n=*X1
        19 013353   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0

     4018    30726    6                   END;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:627  
  30726 19 013354   014037 710000 19                 TRA     s:30860

     4019    30727    5               CASE (%POPT_SETUP);

     4020    30728    5                  IF P$B.SUBLK$(0)->P$B.CODE = %OPT_NONE THEN VM_PROFILE.SETUP.COUNT =
             30728                            0;

  30728 19 013355   100003 473500                    LDP3    3,,PR1
        19 013356   300000 722100                    LXL2    0,,PR3
        19 013357   000005 102003                    CMPX2   5,DU
        19 013360   013365 601000 19                 TNZ     s:30730

  30728 19 013361   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013362   000000 236003                    LDQ     0,DU
        19 013363   400013 552140                    STBQ    11,'40'O,PR4
        19 013364   014037 710000 19                 TRA     s:30860

     4021    30729    6                   ELSE DO;

     4022    30730    6                       VM_PROFILE.SETUP.COUNT = P$B.SUBLK$(0) -> P$S.COUNT;

  30730 19 013365   000000 474400 xsym               LDP4    VM_PROFILE$
        19 013366   300004 236100                    LDQ     4,,PR3
        19 013367   400013 552140                    STBQ    11,'40'O,PR4

     4023    30731    6                       VM_PROFILE.SETUP.TEXT = P$B.SUBLK$(0) -> P$S.TEXT;

  30731 19 013370   200024 470500                    LDP0    BLK$,,AUTO
        19 013371   000003 471500                    LDP1    3,,PR0
        19 013372   100004 236100                    LDQ     4,,PR1
        19 013373   000033 772000                    QRL     27
        19 013374   000000 620006                    EAX0    0,QL
        19 013375   040100 100540                    MLR     fill='040'O
        19 013376   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        19 013377   400013 200400                    ADSC9   11,,PR4                  cn=1,n=256

     4024    30732    6                   END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:628  

  30732 19 013400   014037 710000 19                 TRA     s:30860

     4025    30733    5               CASE (%POPT_SIGNED);

     4026    30734        /*
     4027    30735             ***** Release any allocated space ...
     4028    30736        */
     4029    30737    5                   IF VM_PROFILE.SIGNED$ ~= ADDR(NIL)

  30737 19 013401   000000 473400 xsym               LDP3    VM_PROFILE$
        19 013402   300126 236100                    LDQ     86,,PR3
        19 013403   000022 116000 20                 CMPQ    18
        19 013404   013415 600000 19                 TZE     s:30744

     4030    30738    5                   THEN
     4031    30739    6                   DO;

     4032    30740    6                       X$MCB.ADDRESS$ = VM_PROFILE.SIGNED$;

  30740 19 013405   001652 756000 11                 STQ     X$MCB

     4033    30741    6                       CALL X$DEALLOCATE (X$MCB) ALTRET(E_ALLOCATE);

  30741 19 013406   000530 630400 20                 EPPR0   344
        19 013407   000024 631400 20                 EPPR1   20
        19 013410   000000 701000 xent               TSX1    X$DEALLOCATE
        19 013411   016542 702000 19                 TSX2    E_ALLOCATE

     4034    30742    6                       VM_PROFILE.SIGNED$ = ADDR(NIL);

  30742 19 013412   000022 236000 20                 LDQ     18
        19 013413   000000 470400 xsym               LDP0    VM_PROFILE$
        19 013414   000126 756100                    STQ     86,,PR0

     4035    30743    6                   END;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:629  
     4036    30744    5                  IF P$B.SUBLK$(0)->P$B.CODE ~= %OPT_NONE AND P$B.SUBLK$(0)->P$S.COUNT
             30744                            > 0

  30744 19 013415   200024 470500                    LDP0    BLK$,,AUTO
        19 013416   000003 471500                    LDP1    3,,PR0
        19 013417   100000 720100                    LXL0    0,,PR1
        19 013420   000005 100003                    CMPX0   5,DU
        19 013421   014037 600000 19                 TZE     s:30860
        19 013422   100004 236100                    LDQ     4,,PR1
        19 013423   777000 316003                    CANQ    -512,DU
        19 013424   014037 600000 19                 TZE     s:30860

     4037    30745    5                   THEN
     4038    30746    6                   DO;

     4039    30747    6                       X$MCB.SIZE = P$B.SUBLK$(0)->P$S.COUNT + 1;

  30747 19 013425   100004 236100                    LDQ     4,,PR1
        19 013426   000033 772000                    QRL     27
        19 013427   000001 036007                    ADLQ    1,DL
        19 013430   001660 756000 11                 STQ     X$MCB+6

     4040    30748    6                       X$MCB.TYPE = 0; /* Bytes */

  30748 19 013431   001657 450000 11                 STZ     X$MCB+5

     4041    30749    6                       CALL X$ALLOCATE (X$MCB) ALTRET(E_ALLOCATE);

  30749 19 013432   000530 630400 20                 EPPR0   344
        19 013433   000024 631400 20                 EPPR1   20
        19 013434   000000 701000 xent               TSX1    X$ALLOCATE
        19 013435   016542 702000 19                 TSX2    E_ALLOCATE

     4042    30750    6                       VM_PROFILE.SIGNED$ = X$MCB.ADDRESS$;

  30750 19 013436   001652 236000 11                 LDQ     X$MCB
        19 013437   000000 470400 xsym               LDP0    VM_PROFILE$
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:630  
        19 013440   000126 756100                    STQ     86,,PR0

     4043    30751    6                      VM_PROFILE.SIGNED$ -> X$STRING.SIZ = P$B.SUBLK$(0) -> P$S.COUNT;

  30751 19 013441   000126 471500                    LDP1    86,,PR0
        19 013442   200024 473500                    LDP3    BLK$,,AUTO
        19 013443   300003 474500                    LDP4    3,,PR3
        19 013444   000100 100500                    MLR     fill='000'O
        19 013445   400004 000001                    ADSC9   4,,PR4                   cn=0,n=1
        19 013446   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     4044    30752    6                      VM_PROFILE.SIGNED$ -> X$STRING.TEXT = P$B.SUBLK$(0) -> P$S.TEXT;

  30752 19 013447   000126 471500                    LDP1    86,,PR0
        19 013450   000100 101500                    MRL     fill='000'O
        19 013451   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 013452   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 013453   201706 220100                    LDX0    I+100,,AUTO
        19 013454   200024 473500                    LDP3    BLK$,,AUTO
        19 013455   300003 474500                    LDP4    3,,PR3
        19 013456   400004 236100                    LDQ     4,,PR4
        19 013457   000033 772000                    QRL     27
        19 013460   000000 621006                    EAX1    0,QL
        19 013461   040140 100540                    MLR     fill='040'O
        19 013462   400004 200011                    ADSC9   4,,PR4                   cn=1,n=*X1
        19 013463   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0

     4045    30753    6                   END;

  30753 19 013464   014037 710000 19                 TRA     s:30860

     4046    30754    5               CASE (%POPT_EDITOR);

     4047    30755        /*
     4048    30756             ***** Release any allocated space ...
     4049    30757        */
     4050    30758    5                   PTR4$ = VM_PROFILE.EDITOR$;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:631  

  30758 19 013465   000000 473400 xsym               LDP3    VM_PROFILE$
        19 013466   300137 236100                    LDQ     95,,PR3
        19 013467   200030 756100                    STQ     PTR4$,,AUTO

     4051    30759    5                   IF PTR4$ ~= ADDR(NIL) AND PTR4R$.SEGID = %DS3SID

  30759 19 013470   000022 116000 20                 CMPQ    18
        19 013471   013507 600000 19                 TZE     s:30766
        19 013472   200030 236100                    LDQ     PTR4$,,AUTO
        19 013473   007777 376007                    ANQ     4095,DL
        19 013474   006006 116007                    CMPQ    3078,DL
        19 013475   013507 601000 19                 TNZ     s:30766

     4052    30760    5                   THEN
     4053    30761    6                   DO;

     4054    30762    6                       X$MCB.ADDRESS$ = VM_PROFILE.EDITOR$;

  30762 19 013476   300137 236100                    LDQ     95,,PR3
        19 013477   001652 756000 11                 STQ     X$MCB

     4055    30763    6                       CALL X$DEALLOCATE (X$MCB) ALTRET(E_ALLOCATE);

  30763 19 013500   000530 630400 20                 EPPR0   344
        19 013501   000024 631400 20                 EPPR1   20
        19 013502   000000 701000 xent               TSX1    X$DEALLOCATE
        19 013503   016542 702000 19                 TSX2    E_ALLOCATE

     4056    30764    6                       VM_PROFILE.EDITOR$ = ADDR(NIL);

  30764 19 013504   000022 236000 20                 LDQ     18
        19 013505   000000 470400 xsym               LDP0    VM_PROFILE$
        19 013506   000137 756100                    STQ     95,,PR0

     4057    30765    6                   END;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:632  
     4058    30766    5                  IF P$B.SUBLK$(0)->P$B.CODE ~= %OPT_NONE AND P$B.SUBLK$(0)->P$S.COUNT
             30766                            > 0

  30766 19 013507   200024 470500                    LDP0    BLK$,,AUTO
        19 013510   000003 471500                    LDP1    3,,PR0
        19 013511   100000 720100                    LXL0    0,,PR1
        19 013512   000005 100003                    CMPX0   5,DU
        19 013513   014037 600000 19                 TZE     s:30860
        19 013514   100004 236100                    LDQ     4,,PR1
        19 013515   777000 316003                    CANQ    -512,DU
        19 013516   014037 600000 19                 TZE     s:30860

     4059    30767    5                   THEN
     4060    30768    6                   DO;

     4061    30769    6                       X$MCB.SIZE = P$B.SUBLK$(0)->P$S.COUNT + 1;

  30769 19 013517   100004 236100                    LDQ     4,,PR1
        19 013520   000033 772000                    QRL     27
        19 013521   000001 036007                    ADLQ    1,DL
        19 013522   001660 756000 11                 STQ     X$MCB+6

     4062    30770    6                       X$MCB.TYPE = 0; /* Bytes */

  30770 19 013523   001657 450000 11                 STZ     X$MCB+5

     4063    30771    6                       CALL X$ALLOCATE (X$MCB) ALTRET(E_ALLOCATE);

  30771 19 013524   000530 630400 20                 EPPR0   344
        19 013525   000024 631400 20                 EPPR1   20
        19 013526   000000 701000 xent               TSX1    X$ALLOCATE
        19 013527   016542 702000 19                 TSX2    E_ALLOCATE

     4064    30772    6                       VM_PROFILE.EDITOR$ = X$MCB.ADDRESS$;

  30772 19 013530   001652 236000 11                 LDQ     X$MCB
        19 013531   000000 470400 xsym               LDP0    VM_PROFILE$
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:633  
        19 013532   000137 756100                    STQ     95,,PR0

     4065    30773    6                      VM_PROFILE.EDITOR$ -> X$STRING.SIZ = P$B.SUBLK$(0) -> P$S.COUNT;

  30773 19 013533   000137 471500                    LDP1    95,,PR0
        19 013534   200024 473500                    LDP3    BLK$,,AUTO
        19 013535   300003 474500                    LDP4    3,,PR3
        19 013536   000100 100500                    MLR     fill='000'O
        19 013537   400004 000001                    ADSC9   4,,PR4                   cn=0,n=1
        19 013540   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     4066    30774    6                      VM_PROFILE.EDITOR$ -> X$STRING.TEXT = P$B.SUBLK$(0) -> P$S.TEXT;

  30774 19 013541   000137 471500                    LDP1    95,,PR0
        19 013542   000100 101500                    MRL     fill='000'O
        19 013543   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 013544   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 013545   201706 220100                    LDX0    I+100,,AUTO
        19 013546   200024 473500                    LDP3    BLK$,,AUTO
        19 013547   300003 474500                    LDP4    3,,PR3
        19 013550   400004 236100                    LDQ     4,,PR4
        19 013551   000033 772000                    QRL     27
        19 013552   000000 621006                    EAX1    0,QL
        19 013553   040140 100540                    MLR     fill='040'O
        19 013554   400004 200011                    ADSC9   4,,PR4                   cn=1,n=*X1
        19 013555   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0

     4067    30775    6                   END;

  30775 19 013556   014037 710000 19                 TRA     s:30860

     4068    30776    5               CASE (%POPT_SRCH);

     4069    30777    5                   IF BLK$->P$B.NSUBLKS > %VM_MAX_SRCH

  30777 19 013557   100001 222100                    LDX2    1,,PR1
        19 013560   000005 102003                    CMPX2   5,DU
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:634  
        19 013561   013567 602000 19                 TNC     s:30783

     4070    30778    6                   THEN DO;

     4071    30779    6                       CALL XUR$ERRMSG (E_TOOMANYSRCH);

  30779 19 013562   000532 630400 20                 EPPR0   346
        19 013563   000024 631400 20                 EPPR1   20
        19 013564   000000 701000 xent               TSX1    XUR$ERRMSG
        19 013565   000000 011000                    NOP     0

     4072    30780    6                       GOTO CONTINUE; /* abort processing */

  30780 19 013566   016452 710000 19                 TRA     CONTINUE

     4073    30781    6                   END;
     4074    30782        /* An arbitary limit of 4 has been set on the number of srch folders. */
     4075    30783    6                   DO INDX4 = %VM_MAX_SRCH-1 DOWNTO 0;

  30783 19 013567   000003 235007                    LDA     3,DL
        19 013570   200035 755100                    STA     INDX4,,AUTO
        19 013571   013612 710000 19                 TRA     s:30791+2

     4076    30784    6                       IF VM_PROFILE.SEARCH_LIST$(INDX4) ~= ADDR(NIL)

  30784 19 013572   000000 470400 xsym               LDP0    VM_PROFILE$
        19 013573   200035 720100                    LXL0    INDX4,,AUTO
        19 013574   000115 236110                    LDQ     77,X0,PR0
        19 013575   000022 116000 20                 CMPQ    18
        19 013576   013610 600000 19                 TZE     s:30791

     4077    30785    6                       THEN
     4078    30786    7                       DO;  /* Deallocate space */

     4079    30787    7                           X$MCB.ADDRESS$ = VM_PROFILE.SEARCH_LIST$(INDX4);

  30787 19 013577   001652 756000 11                 STQ     X$MCB
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:635  

     4080    30788    7                           CALL X$DEALLOCATE (X$MCB);

  30788 19 013600   000530 630400 20                 EPPR0   344
        19 013601   000024 631400 20                 EPPR1   20
        19 013602   000000 701000 xent               TSX1    X$DEALLOCATE
        19 013603   000000 011000                    NOP     0

     4081    30789    7                           VM_PROFILE.SEARCH_LIST$(INDX4) = ADDR(NIL);

  30789 19 013604   000022 236000 20                 LDQ     18
        19 013605   000000 470400 xsym               LDP0    VM_PROFILE$
        19 013606   200035 720100                    LXL0    INDX4,,AUTO
        19 013607   000115 756110                    STQ     77,X0,PR0

     4082    30790    7                       END;

     4083    30791    6                   END;

  30791 19 013610   000001 336007                    LCQ     1,DL
        19 013611   200035 056100                    ASQ     INDX4,,AUTO
        19 013612   200035 235100                    LDA     INDX4,,AUTO
        19 013613   013572 605000 19                 TPL     s:30784

     4084    30792    5                   IF BLK$->P$B.SUBLK$(0)->P$B.CODE ~= %OPT_NONE

  30792 19 013614   200024 470500                    LDP0    BLK$,,AUTO
        19 013615   000003 471500                    LDP1    3,,PR0
        19 013616   100000 720100                    LXL0    0,,PR1
        19 013617   000005 100003                    CMPX0   5,DU
        19 013620   014035 600000 19                 TZE     s:30858

     4085    30793    6                   THEN DO;

     4086    30794    6                       PTR4$ = BLK$;

  30794 19 013621   200024 236100                    LDQ     BLK$,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:636  
        19 013622   200030 756100                    STQ     PTR4$,,AUTO

     4087    30795    7                       DO INDX4 = 0 TO PTR4$->P$B.NSUBLKS-1;

  30795 19 013623   200035 450100                    STZ     INDX4,,AUTO
        19 013624   014030 710000 19                 TRA     NULL_ENTRY+1

     4088    30796    7                           BLK$ = PTR4$ -> P$B.SUBLK$(INDX4);
             30796                                    /* To account for OPT_MID */

  30796 19 013625   200030 470500                    LDP0    PTR4$,,AUTO
        19 013626   200035 720100                    LXL0    INDX4,,AUTO
        19 013627   000003 236110                    LDQ     3,X0,PR0
        19 013630   200024 756100                    STQ     BLK$,,AUTO

     4089    30797    7                           VM_RADDRESS.ACCT = ' ';

  30797 19 013631   040100 100400                    MLR     fill='040'O
        19 013632   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 013633   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8

     4090    30798    7                           VM_RADDRESS.FOLDER = ' ';

  30798 19 013634   040100 100400                    MLR     fill='040'O
        19 013635   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 013636   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25

     4091    30799    7                           VM_RADDRESS.PASS = ' ';

  30799 19 013637   040100 100400                    MLR     fill='040'O
        19 013640   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 013641   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8

     4092    30800    7                           VM_RADDRESS.SITENAME = ' ';

  30800 19 013642   040100 100400                    MLR     fill='040'O
        19 013643   000035 000001 20                 ADSC9   29                       cn=0,n=1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:637  
        19 013644   200770 600010                    ADSC9   VM_RADDRESS+15,,AUTO     cn=3,n=8

     4093    30801    7                           VM_RADDRESS.NEXT$ = ADDR(NIL);

  30801 19 013645   000022 236000 20                 LDQ     18
        19 013646   200751 756100                    STQ     VM_RADDRESS,,AUTO

     4094    30802    7                           VM_RADDRESS.PREV$ = ADDR(NIL);

  30802 19 013647   200752 756100                    STQ     VM_RADDRESS+1,,AUTO

     4095    30803    7                           VM_RADDRESS.FLAGS = %NO#;

  30803 19 013650   000000 236003                    LDQ     0,DU
        19 013651   200753 552140                    STBQ    VM_RADDRESS+2,'40'O,AUTO

     4096    30804    7                           VM_RADDRESS.TYPE = %VM_ADD_RESOLVED;

  30804 19 013652   000001 236003                    LDQ     1,DU
        19 013653   200753 552120                    STBQ    VM_RADDRESS+2,'20'O,AUTO

     4097    30805    7                           VM_UADDRESS.USER_NAME.COUNT = 0;

  30805 19 013654   000000 236003                    LDQ     0,DU
        19 013655   201016 552104                    STBQ    VM_UADDRESS+17,'04'O,AUTO

     4098    30806    8                           DO INDX2 = 0 TO BLK$ -> P$B.NSUBLKS - 1;

  30806 19 013656   000375 450000 11                 STZ     INDX2
        19 013657   013741 710000 19                 TRA     s:30820+1

     4099    30807    8                               PTR1$ = BLK$ -> P$B.SUBLK$(INDX2);

  30807 19 013660   200024 470500                    LDP0    BLK$,,AUTO
        19 013661   000375 720000 11                 LXL0    INDX2
        19 013662   000003 236110                    LDQ     3,X0,PR0
        19 013663   200025 756100                    STQ     PTR1$,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:638  

     4100    30808    9                               DO CASE (PTR1$ -> P$B.CODE);

  30808 19 013664   200025 471500                    LDP1    PTR1$,,AUTO
        19 013665   100000 721100                    LXL1    0,,PR1
        19 013666   000006 101003                    CMPX1   6,DU
        19 013667   013671 602011 19                 TNC     s:30808+5,X1
        19 013670   013740 710000 19                 TRA     s:30820
        19 013671   013740 710000 19                 TRA     s:30820
        19 013672   013740 710000 19                 TRA     s:30820
        19 013673   013677 710000 19                 TRA     s:30810
        19 013674   013706 710000 19                 TRA     s:30812
        19 013675   013715 710000 19                 TRA     s:30814
        19 013676   013732 710000 19                 TRA     s:30818

     4101    30809    9                               CASE (%ADD_ACCT);

     4102    30810    9                                   VM_RADDRESS.ACCT = PTR1$ -> P$S.TEXT;

  30810 19 013677   100004 236100                    LDQ     4,,PR1
        19 013700   000033 772000                    QRL     27
        19 013701   000000 622006                    EAX2    0,QL
        19 013702   040100 100540                    MLR     fill='040'O
        19 013703   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 013704   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8
        19 013705   013740 710000 19                 TRA     s:30820

     4103    30811    9                               CASE (%ADD_FOLDER);

     4104    30812    9                                   VM_RADDRESS.FOLDER = PTR1$ -> P$S.TEXT;

  30812 19 013706   100004 236100                    LDQ     4,,PR1
        19 013707   000033 772000                    QRL     27
        19 013710   000000 622006                    EAX2    0,QL
        19 013711   040100 100540                    MLR     fill='040'O
        19 013712   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 013713   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:639  
        19 013714   013740 710000 19                 TRA     s:30820

     4105    30813    9                               CASE (%ADD_NAME);

     4106    30814    9                                   VM_UADDRESS.USER_NAME.COUNT = PTR1$ -> P$S.COUNT;

  30814 19 013715   100004 236100                    LDQ     4,,PR1
        19 013716   000033 772000                    QRL     27
        19 013717   201016 552104                    STBQ    VM_UADDRESS+17,'04'O,AUTO

     4107    30815    9                                   VM_UADDRESS.USER_NAME.TEXT = PTR1$ -> P$S.TEXT;

  30815 19 013720   100004 236100                    LDQ     4,,PR1
        19 013721   000033 772000                    QRL     27
        19 013722   000000 621006                    EAX1    0,QL
        19 013723   040100 100540                    MLR     fill='040'O
        19 013724   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        19 013725   201017 000310                    ADSC9   VM_UADDRESS+18,,AUTO     cn=0,n=200

     4108    30816    9                                   IF VM_UADDRESS.USER_NAME.COUNT = 0 THEN GOTO
             30816                                            NULL_ENTRY;

  30816 19 013726   201016 236100                    LDQ     VM_UADDRESS+17,,AUTO
        19 013727   000777 316007                    CANQ    511,DL
        19 013730   014027 600000 19                 TZE     NULL_ENTRY
        19 013731   013740 710000 19                 TRA     s:30820

     4109    30817    9                               CASE (%ADD_PASS);

     4110    30818    9                                   VM_RADDRESS.PASS = PTR1$ -> P$S.TEXT;

  30818 19 013732   100004 236100                    LDQ     4,,PR1
        19 013733   000033 772000                    QRL     27
        19 013734   000000 622006                    EAX2    0,QL
        19 013735   040100 100540                    MLR     fill='040'O
        19 013736   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        19 013737   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:640  

     4111    30819    9                               END; /* Do case ... end */

     4112    30820    8                           END; /* Do INDX2 = ... end */

  30820 19 013740   000375 054000 11                 AOS     INDX2
        19 013741   200024 470500                    LDP0    BLK$,,AUTO
        19 013742   000001 236100                    LDQ     1,,PR0
        19 013743   000022 772000                    QRL     18
        19 013744   000375 116000 11                 CMPQ    INDX2
        19 013745   013660 605400 19                 TPNZ    s:30807

     4113    30821    7                           IF VM_UADDRESS.USER_NAME.COUNT > 0

  30821 19 013746   201016 236100                    LDQ     VM_UADDRESS+17,,AUTO
        19 013747   000777 316007                    CANQ    511,DL
        19 013750   013756 600000 19                 TZE     s:30830

     4114    30822    7                           THEN /* Store as unresolved address */
     4115    30823    8                           DO;

     4116    30824    8                               X$MCB.SIZE = SIZEC(VM_UADDRESS) -

  30824 19 013751   201016 236100                    LDQ     VM_UADDRESS+17,,AUTO
        19 013752   000777 376007                    ANQ     511,DL
        19 013753   000110 036007                    ADLQ    72,DL
        19 013754   001660 756000 11                 STQ     X$MCB+6

     4117    30825    8                                 SIZEC(VM_UADDRESS.USER_NAME.TEXT) +
     4118    30826    8                                 VM_UADDRESS.USER_NAME.COUNT;
     4119    30827    8                           END;

  30827 19 013755   013760 710000 19                 TRA     s:30832

     4120    30828    7                           ELSE /* Store as resolved address */
     4121    30829    8                           DO;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:641  
     4122    30830    8                               X$MCB.SIZE = SIZEC(VM_RADDRESS);

  30830 19 013756   000120 235007                    LDA     80,DL
        19 013757   001660 755000 11                 STA     X$MCB+6

     4123    30831    8                           END;

     4124    30832    7                           CALL X$ALLOCATE (X$MCB)

  30832 19 013760   000530 630400 20                 EPPR0   344
        19 013761   000024 631400 20                 EPPR1   20
        19 013762   000000 701000 xent               TSX1    X$ALLOCATE
        19 013763   013765 702000 19                 TSX2    s:30835
        19 013764   014000 710000 19                 TRA     s:30840

     4125    30833    7                           WHENALTRETURN
     4126    30834    8                           DO;

     4127    30835    8                               CALL VMA$ENLARGE_SEGMENT (VM_PROFILE_,

  30835 19 013765   000004 630400 20                 EPPR0   4
        19 013766   000000 631400 20                 EPPR1   0
        19 013767   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 013770   016514 702000 19                 TSX2    E_PMME

     4128    30836    8                                 1024) ALTRET(E_PMME);
     4129    30837    8                               X$MCB.WKSZ = X$MCB.WKSZ + 1024;

  30837 19 013771   001656 235000 11                 LDA     X$MCB+4
        19 013772   002000 035007                    ADLA    1024,DL
        19 013773   001656 755000 11                 STA     X$MCB+4

     4130    30838    8                               CALL X$ALLOCATE (X$MCB) ALTRET(E_ALLOCATE);

  30838 19 013774   000530 630400 20                 EPPR0   344
        19 013775   000024 631400 20                 EPPR1   20
        19 013776   000000 701000 xent               TSX1    X$ALLOCATE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:642  
        19 013777   016542 702000 19                 TSX2    E_ALLOCATE

     4131    30839    8                           END;

     4132    30840    7                           VM_PROFILE.SEARCH_LIST$(INDX4) = X$MCB.ADDRESS$;

  30840 19 014000   001652 236000 11                 LDQ     X$MCB
        19 014001   000000 470400 xsym               LDP0    VM_PROFILE$
        19 014002   200035 720100                    LXL0    INDX4,,AUTO
        19 014003   000115 756110                    STQ     77,X0,PR0

     4133    30841    7                          VM_PROFILE.SEARCH_LIST$(INDX4) -> VM$RADDRESS = VM_RADDRESS;

  30841 19 014004   000115 471510                    LDP1    77,X0,PR0
        19 014005   000100 100500                    MLR     fill='000'O
        19 014006   200751 000117                    ADSC9   VM_RADDRESS,,AUTO        cn=0,n=79
        19 014007   100000 000117                    ADSC9   0,,PR1                   cn=0,n=79

     4134    30842    7                           IF VM_UADDRESS.USER_NAME.COUNT > 0

  30842 19 014010   201016 236100                    LDQ     VM_UADDRESS+17,,AUTO
        19 014011   000777 316007                    CANQ    511,DL
        19 014012   014027 600000 19                 TZE     NULL_ENTRY

     4135    30843    7                           THEN
     4136    30844    8                           DO;

     4137    30845    8                               VM_PROFILE.SEARCH_LIST$(INDX4) -> VM$UADDRESS.TYPE

  30845 19 014013   000115 471510                    LDP1    77,X0,PR0
        19 014014   000002 236003                    LDQ     2,DU
        19 014015   100002 552120                    STBQ    2,'20'O,PR1

     4138    30846    8                                 = %VM_ADD_UNRESOLVED;
     4139    30847    8                              VM_PROFILE.SEARCH_LIST$(INDX4) -> VM$UADDRESS.USER_NAME.
             30847                                        COUNT

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:643  
  30847 19 014016   000115 471510                    LDP1    77,X0,PR0
        19 014017   201016 236100                    LDQ     VM_UADDRESS+17,,AUTO
        19 014020   100021 552104                    STBQ    17,'04'O,PR1

     4140    30848    8                                 = VM_UADDRESS.USER_NAME.COUNT;
     4141    30849    8                               CALL INSERT (VM_PROFILE.SEARCH_LIST$(INDX4) ->

  30849 19 014021   000115 471510                    LDP1    77,X0,PR0
        19 014022   201016 721100                    LXL1    VM_UADDRESS+17,,AUTO
        19 014023   000777 361003                    ANX1    511,DU
        19 014024   040140 100500                    MLR     fill='040'O
        19 014025   201017 000310                    ADSC9   VM_UADDRESS+18,,AUTO     cn=0,n=200
        19 014026   100022 000011                    ADSC9   18,,PR1                  cn=0,n=*X1

     4142    30850    8                                 VM$UADDRESS.USER_NAME.TEXT,0,VM_UADDRESS.USER_NAME.
             30850                                          COUNT,
     4143    30851    8                                 VM_UADDRESS.USER_NAME.TEXT);
     4144    30852    8                           END;

     4145    30853    7   NULL_ENTRY:
     4146    30854    7                       END; /* Do INDX4 */

  30854 19 014027   200035 054100       NULL_ENTRY   AOS     INDX4,,AUTO
        19 014030   200030 470500                    LDP0    PTR4$,,AUTO
        19 014031   000001 236100                    LDQ     1,,PR0
        19 014032   000022 772000                    QRL     18
        19 014033   200035 116100                    CMPQ    INDX4,,AUTO
        19 014034   013625 605400 19                 TPNZ    s:30796

     4147    30855                                 /* Close out current search list.  The new ones will be
     4148    30856                                    reopened if needed. */
     4149    30857    6                   END;       /* If not none */

     4150    30858    5                   CALL CLOSE_SEARCH;

  30858 19 014035   016625 701000 19                 TSX1    CLOSE_SEARCH
        19 014036   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:644  

     4151    30859    5               END;                  /* End cases */

     4152    30860    4           END;                       /* Do INDX1 = ... end */

  30860 19 014037   200033 054100                    AOS     INDX1,,AUTO
        19 014040   200023 470500                    LDP0    OUT$,,AUTO
        19 014041   000001 236100                    LDQ     1,,PR0
        19 014042   000022 772000                    QRL     18
        19 014043   200033 116100                    CMPQ    INDX1,,AUTO
        19 014044   012565 605400 19                 TPNZ    s:30561

     4153    30861        /*
     4154    30862             ***** Store the profile (if allowed) ...
     4155    30863        */
     4156    30864    3           VM_PROFILE.NEXT$ = X$MCB.HI_SEGMENT$;

  30864 19 014045   001655 236000 11                 LDQ     X$MCB+3
        19 014046   000000 471400 xsym               LDP1    VM_PROFILE$
        19 014047   100004 756100                    STQ     4,,PR1

     4157    30865    3           VM_PROFILE.FREE$ = X$MCB.FREE_HEAD$;

  30865 19 014050   001653 236000 11                 LDQ     X$MCB+1
        19 014051   100003 756100                    STQ     3,,PR1

     4158    30866    3           CALL PUT_PROFILE (M$MAIL_FILE_NUM)

  30866 19 014052   000053 236000 20                 LDQ     43
        19 014053   201523 756100                    STQ     INDX2+255,,AUTO
        19 014054   021320 701000 19                 TSX1    PUT_PROFILE
        19 014055   014057 702000 19                 TSX2    s:30868
        19 014056   014111 710000 19                 TRA     s:30874

     4159    30867    4           WHENALTRETURN DO;

     4160    30868    4               INDX1 = VM_WORK$ -> VM_PROFILE.PROFILE_SIZE * 4;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:645  

  30868 19 014057   000000 470400 xsym               LDP0    VM_WORK$
        19 014060   000002 235100                    LDA     2,,PR0
        19 014061   000002 735000                    ALS     2
        19 014062   200033 755100                    STA     INDX1,,AUTO

     4161    30869    4               VM_PROFILE$ -> INDX1_CHARS = VM_WORK$ -> INDX1_CHARS;

  30869 19 014063   000000 620005                    EAX0    0,AL
        19 014064   000000 471400 xsym               LDP1    VM_PROFILE$
        19 014065   200033 721100                    LXL1    INDX1,,AUTO
        19 014066   040140 100540                    MLR     fill='040'O
        19 014067   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
        19 014070   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

     4162    30870    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  30870 19 014071   000000 473400 xsym               LDP3    B$TCB$
        19 014072   300000 474500                    LDP4    0,,PR3
        19 014073   400102 236100                    LDQ     66,,PR4
        19 014074   002204 756000 11                 STQ     ERROR

     4163    30871    4               CALL XUR$ERRMSG(E_WERR);

  30871 19 014075   000376 630400 20                 EPPR0   254
        19 014076   000024 631400 20                 EPPR1   20
        19 014077   000000 701000 xent               TSX1    XUR$ERRMSG
        19 014100   000000 011000                    NOP     0

     4164    30872    4               CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);

  30872 19 014101   000377 630400 20                 EPPR0   255
        19 014102   000000 631400 20                 EPPR1   0
        19 014103   000000 701000 xent               TSX1    XUR$ERRMSG
        19 014104   000000 011000                    NOP     0

     4165    30873    4               CALL PUT_PROFILE (M$MAIL_FILE_NUM);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:646  

  30873 19 014105   000053 236000 20                 LDQ     43
        19 014106   201523 756100                    STQ     INDX2+255,,AUTO
        19 014107   021320 701000 19                 TSX1    PUT_PROFILE
        19 014110   000000 011000                    NOP     0

     4166    30874    4           END;

  30874 19 014111   016452 710000 19                 TRA     CONTINUE

     4167    30875        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:647  
     4168    30876        /* Read command */
     4169    30877    3       CASE (%CMD_READ);

     4170    30878        /*
     4171    30879             ***** Open M$CMNDF dcb to the specified command file.
     4172    30880        */
     4173    30881    3           IF OUT$ -> P$B.NSUBLKS > 0

  30881 19 014112   200023 474500                    LDP4    OUT$,,AUTO
        19 014113   400001 220100                    LDX0    1,,PR4
        19 014114   014356 600000 19                 TZE     s:30964

     4174    30882    3           THEN
     4175    30883    4           DO;                    /* Get options, and open M$CMNDF */

     4176    30884    4               IF DCBADDR(M$CMNDF_NUM) -> F$DCB.FCD# /* Close if open */

  30884 19 014115   000074 475400 20                 LDP5    60
        19 014116   500000 476500                    LDP6    0,,PR5
        19 014117   000545 721000 11                 LXL1    M$CMNDF_NUM
        19 014120   600000 477511                    LDP7    0,X1,PR6
        19 014121   700031 236100                    LDQ     25,,PR7
        19 014122   020000 316007                    CANQ    8192,DL
        19 014123   014130 600000 19                 TZE     s:30890

     4177    30885    4               THEN
     4178    30886    5               DO;

     4179    30887    5                   CLOSE_SAVE.V.DCB# = M$CMNDF_NUM;

  30887 19 014124   002142 741000 11                 STX1    CLOSE_SAVE+26

     4180    30888    5                   CALL M$CLOSE (CLOSE_SAVE);

  30888 19 014125   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 014126   050001 713400                    CLIMB   close
        19 014127   406000 401760                    pmme    nvectors=13
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:648  

     4181    30889    5               END;

     4182    30890    4               FID_NAME.NAME# = ' ';

  30890 19 014130   040000 100400                    MLR     fill='040'O
        19 014131   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 014132   002205 200037 11                 ADSC9   FID_NAME                 cn=1,n=31

     4183    30891    4               FID_NAME.L# = 0;

  30891 19 014133   000000 236003                    LDQ     0,DU
        19 014134   002205 552040 11                 STBQ    FID_NAME,'40'O

     4184    30892    4               FID_ACCT.ACCT# = B$JIT.FACCN;

  30892 19 014135   000000 470400 xsym               LDP0    B$JIT$
        19 014136   000006 237100                    LDAQ    6,,PR0
        19 014137   002215 755000 11                 STA     FID_ACCT
        19 014140   002216 756000 11                 STQ     FID_ACCT+1

     4185    30893    4               FID_PASS.PASS# = ' ';

  30893 19 014141   000035 235000 20                 LDA     29
        19 014142   000035 236000 20                 LDQ     29
        19 014143   002217 755000 11                 STA     FID_PASS
        19 014144   002220 756000 11                 STQ     FID_PASS+1

     4186    30894    4               FID_WSN.WSN# = ' ';

  30894 19 014145   000035 235000 20                 LDA     29
        19 014146   000035 236000 20                 LDQ     29
        19 014147   002226 757000 11                 STAQ    FID_WSN

     4187    30895    4               FID_RESULTS = '0'B;                /* Zap all flags */

  30895 19 014150   000000 100400                    MLR     fill='000'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:649  
        19 014151   000020 000001 20                 ADSC9   16                       cn=0,n=1
        19 014152   002232 000044 11                 ADSC9   FID_RESULTS              cn=0,n=36

     4188    30896
     4189    30897    4               OPT_FID = OUT$ -> P$B.SUBLK$(0) -> P$S.TEXT;

  30897 19 014153   200023 471500                    LDP1    OUT$,,AUTO
        19 014154   100003 473500                    LDP3    3,,PR1
        19 014155   300004 236100                    LDQ     4,,PR3
        19 014156   000033 772000                    QRL     27
        19 014157   000000 620006                    EAX0    0,QL
        19 014160   040000 100540                    MLR     fill='040'O
        19 014161   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
        19 014162   001670 000100 11                 ADSC9   OPT_FID                  cn=0,n=64

     4190    30898    4               CALL M$FID (CHECK_FID)

  30898 19 014163   002244 630400 11                 EPPR0   CHECK_FID
        19 014164   420001 713400                    CLIMB   alt,+8193
        19 014165   404400 401760                    pmme    nvectors=10
        19 014166   014170 702000 19                 TSX2    s:30900
        19 014167   014211 710000 19                 TRA     s:30908

     4191    30899    5               WHENALTRETURN DO;

     4192    30900    5                   ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  30900 19 014170   000000 470400 xsym               LDP0    B$TCB$
        19 014171   000000 471500                    LDP1    0,,PR0
        19 014172   100102 236100                    LDQ     66,,PR1
        19 014173   002204 756000 11                 STQ     ERROR

     4193    30901    5                   CALL XUR$ERRPTR (OUT$ -> P$B.SUBLK$(0) -> P$S.CPOS);

  30901 19 014174   200023 471500                    LDP1    OUT$,,AUTO
        19 014175   100003 473500                    LDP3    3,,PR1
        19 014176   300002 634500                    EPPR4   2,,PR3
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:650  
        19 014177   201706 454500                    STP4    I+100,,AUTO
        19 014200   201706 630500                    EPPR0   I+100,,AUTO
        19 014201   000024 631400 20                 EPPR1   20
        19 014202   000000 701000 xent               TSX1    XUR$ERRPTR
        19 014203   000000 011000                    NOP     0

     4194    30902    5                   CALL XUR$ERRMSG (ERROR);

  30902 19 014204   000101 630400 20                 EPPR0   65
        19 014205   000024 631400 20                 EPPR1   20
        19 014206   000000 701000 xent               TSX1    XUR$ERRMSG
        19 014207   000000 011000                    NOP     0

     4195    30903    5                   GOTO CONTINUE;

  30903 19 014210   016452 710000 19                 TRA     CONTINUE

     4196    30904    5               END;
     4197    30905        /*
     4198    30906             ***** Stuff the information into the open fpt ...
     4199    30907        */
     4200    30908    4               IF FID_RESULTS.ACCT = %NO#

  30908 19 014211   002232 236000 11                 LDQ     FID_RESULTS
        19 014212   200000 316003                    CANQ    65536,DU
        19 014213   014220 601000 19                 TNZ     s:30911

     4201    30909    4               THEN            /* Default to current account */
     4202    30910    4                   FID_ACCT.ACCT# = B$JIT.FACCN;

  30910 19 014214   000000 470400 xsym               LDP0    B$JIT$
        19 014215   000006 237100                    LDAQ    6,,PR0
        19 014216   002215 755000 11                 STA     FID_ACCT
        19 014217   002216 756000 11                 STQ     FID_ACCT+1

     4203    30911    4               OPEN_COMMAND_STREAM.NAME_=VECTOR(FID_NAME);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:651  
  30911 19 014220   000226 237000 20                 LDAQ    150
        19 014221   002552 757000 11                 STAQ    OPEN_COMMAND_STREAM+6

     4204    30912    4               OPEN_COMMAND_STREAM.ACCT_=VECTOR(FID_ACCT);

  30912 19 014222   000444 237000 20                 LDAQ    292
        19 014223   002570 757000 11                 STAQ    OPEN_COMMAND_STREAM+20

     4205    30913    4               IF FID_RESULTS.PASS

  30913 19 014224   002232 236000 11                 LDQ     FID_RESULTS
        19 014225   100000 316003                    CANQ    32768,DU
        19 014226   014231 600000 19                 TZE     s:30916

     4206    30914    4               THEN
     4207    30915    4                   OPEN_COMMAND_STREAM.PASS_=VECTOR(FID_PASS);

  30915 19 014227   000534 237000 20                 LDAQ    348
        19 014230   002554 757000 11                 STAQ    OPEN_COMMAND_STREAM+8

     4208    30916    4               IF FID_RESULTS.SN

  30916 19 014231   002232 236000 11                 LDQ     FID_RESULTS
        19 014232   040000 316003                    CANQ    16384,DU
        19 014233   014236 600000 19                 TZE     s:30919

     4209    30917    4               THEN
     4210    30918    4                   OPEN_COMMAND_STREAM.SN_=VECTOR(FID_SN);

  30918 19 014234   000536 237000 20                 LDAQ    350
        19 014235   002546 757000 11                 STAQ    OPEN_COMMAND_STREAM+2

     4211    30919    4               IF FID_RESULTS.WSN

  30919 19 014236   002232 236000 11                 LDQ     FID_RESULTS
        19 014237   020000 316003                    CANQ    8192,DU
        19 014240   014243 600000 19                 TZE     s:30922
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:652  

     4212    30920    4               THEN
     4213    30921    4                   OPEN_COMMAND_STREAM.WSN_=VECTOR(FID_WSN);

  30921 19 014241   000540 237000 20                 LDAQ    352
        19 014242   002576 757000 11                 STAQ    OPEN_COMMAND_STREAM+26

     4214    30922    4               IF FID_RESULTS.RES

  30922 19 014243   002232 236000 11                 LDQ     FID_RESULTS
        19 014244   004000 316003                    CANQ    2048,DU
        19 014245   014250 600000 19                 TZE     s:30925

     4215    30923    4               THEN
     4216    30924    4                   OPEN_COMMAND_STREAM.V.RES#=FID_RES;

  30924 19 014246   002231 236000 11                 LDQ     FID_RES
        19 014247   002614 756000 11                 STQ     OPEN_COMMAND_STREAM+40

     4217    30925    4               OPEN_COMMAND_STREAM.V.ASN#=FID_ASN;

  30925 19 014250   002230 236000 11                 LDQ     FID_ASN
        19 014251   000033 772000                    QRL     27
        19 014252   002611 552004 11                 STBQ    OPEN_COMMAND_STREAM+37,'04'O

     4218    30926        /*      Prevent unauthorized access to :NODES and files in .:MAIL. */
     4219    30927    4               IF (FID_NAME.NAME# = ':NODES'

  30927 19 014253   040000 106400                    CMPC    fill='040'O
        19 014254   002205 200037 11                 ADSC9   FID_NAME                 cn=1,n=31
        19 014255   001371 000006 12                 ADSC9   VM_PROKEY+12             cn=0,n=6
        19 014256   014267 601000 19                 TNZ     s:30927+12
        19 014257   000000 236007 xsym               LDQ     M$LM,DL
        19 014260   000074 470400 20                 LDP0    60
        19 014261   000000 471500                    LDP1    0,,PR0
        19 014262   100000 473506                    LDP3    0,QL,PR1
        19 014263   040100 106400                    CMPC    fill='040'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:653  
        19 014264   002215 000010 11                 ADSC9   FID_ACCT                 cn=0,n=8
        19 014265   300020 000010                    ADSC9   16,,PR3                  cn=0,n=8
        19 014266   014277 600000 19                 TZE     s:30931
        19 014267   000000 236007 xsym               LDQ     M$LM,DL
        19 014270   000074 470400 20                 LDP0    60
        19 014271   000000 471500                    LDP1    0,,PR0
        19 014272   100000 473506                    LDP3    0,QL,PR1
        19 014273   040000 106500                    CMPC    fill='040'O
        19 014274   300020 000010                    ADSC9   16,,PR3                  cn=0,n=8
        19 014275   001363 000005 12                 ADSC9   VM_PROKEY+6              cn=0,n=5
        19 014276   014302 601000 19                 TNZ     s:30933

     4220    30928    4                 AND FID_ACCT.ACCT# = DCBADDR(DCBNUM(M$LM)) -> F$DCB.ACCT#)
     4221    30929    4                 OR DCBADDR(DCBNUM(M$LM)) -> F$DCB.ACCT# = ':MAIL'
     4222    30930    4               THEN
     4223    30931    4                   OPEN_COMMAND_STREAM.V.SETDCB# = %YES#;

  30931 19 014277   100000 236007                    LDQ     32768,DL
        19 014300   002610 256000 11                 ORSQ    OPEN_COMMAND_STREAM+36
        19 014301   014304 710000 19                 TRA     s:30934

     4224    30932    4               ELSE
     4225    30933    4                   OPEN_COMMAND_STREAM.V.SETDCB# = %NO#;

  30933 19 014302   000542 236000 20                 LDQ     354
        19 014303   002610 356000 11                 ANSQ    OPEN_COMMAND_STREAM+36

     4226    30934    4               OPEN_COMMAND_STREAM.V.INITZ.SCRUB# = %YES#;

  30934 19 014304   400000 236007                    LDQ     -131072,DL
        19 014305   002610 256000 11                 ORSQ    OPEN_COMMAND_STREAM+36

     4227    30935    4               CALL M$OPEN(OPEN_COMMAND_STREAM)

  30935 19 014306   002544 630400 11                 EPPR0   OPEN_COMMAND_STREAM
        19 014307   450000 713400                    CLIMB   alt,open
        19 014310   410400 401760                    pmme    nvectors=18
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:654  
        19 014311   014332 702000 19                 TSX2    s:30950

     4228    30936    5               WHENRETURN DO;

     4229    30937    5                   IF OPEN_COMMAND_STREAM.V.SETDCB#

  30937 19 014312   002610 236000 11                 LDQ     OPEN_COMMAND_STREAM+36
        19 014313   100000 316007                    CANQ    32768,DL
        19 014314   014320 600000 19                 TZE     s:30942

     4230    30938    6                   THEN DO;

     4231    30939    6                       ERROR = E_NOFILE;

  30939 19 014315   001342 236000 12                 LDQ     E_NOFILE
        19 014316   002204 756000 11                 STQ     ERROR

     4232    30940    6                       GOTO READCMD_ERR;

  30940 19 014317   014336 710000 19                 TRA     READCMD_ERR

     4233    30941    6                   END;
     4234    30942    5                   IF EXIT_MAIL#

  30942 19 014320   000417 234000 11                 SZN     EXIT_MAIL#
        19 014321   014325 605000 19                 TPL     s:30947

     4235    30943    6                   THEN DO;

     4236    30944    6                       EXIT_MAIL# = '0'B;

  30944 19 014322   000417 450000 11                 STZ     EXIT_MAIL#

     4237    30945    6                       EXIT_MAIL_PEND# = '1'B;

  30945 19 014323   400000 236003                    LDQ     -131072,DU
        19 014324   000420 756000 11                 STQ     EXIT_MAIL_PEND#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:655  

     4238    30946    6                   END;

     4239    30947    5                   CALL XUR$SETDCBS (M$CMNDF_NUM);

  30947 19 014325   000543 630400 20                 EPPR0   355
        19 014326   000024 631400 20                 EPPR1   20
        19 014327   000000 701000 xent               TSX1    XUR$SETDCBS
        19 014330   000000 011000                    NOP     0

     4240    30948    5               END;

  30948 19 014331   014355 710000 19                 TRA     s:30961

     4241    30949    5               WHENALTRETURN DO;

     4242    30950    5                   ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  30950 19 014332   000000 470400 xsym               LDP0    B$TCB$
        19 014333   000000 471500                    LDP1    0,,PR0
        19 014334   100102 236100                    LDQ     66,,PR1
        19 014335   002204 756000 11                 STQ     ERROR

     4243    30951    5   READCMD_ERR:
     4244    30952    5                   DCB# = M$CMNDF_NUM;

  30952 19 014336   000545 235000 11    READCMD_ERR  LDA     M$CMNDF_NUM
        19 014337   000401 755000 11                 STA     DCB#

     4245    30953    5                   IF EXIT_MAIL_PEND#

  30953 19 014340   000420 234000 11                 SZN     EXIT_MAIL_PEND#
        19 014341   014345 605000 19                 TPL     s:30958

     4246    30954    6                   THEN DO;

     4247    30955    6                       EXIT_MAIL# = '1'B;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:656  

  30955 19 014342   400000 236003                    LDQ     -131072,DU
        19 014343   000417 756000 11                 STQ     EXIT_MAIL#

     4248    30956    6                       EXIT_MAIL_PEND# = '0'B;

  30956 19 014344   000420 450000 11                 STZ     EXIT_MAIL_PEND#

     4249    30957    6                   END;

     4250    30958    5                   CALL XUR$ERRMSG (ERROR,DCB#);

  30958 19 014345   000101 630400 20                 EPPR0   65
        19 014346   000000 631400 20                 EPPR1   0
        19 014347   000000 701000 xent               TSX1    XUR$ERRMSG
        19 014350   000000 011000                    NOP     0

     4251    30959    5                   CALL XUR$SETDCBS (M$SI_NUM);

  30959 19 014351   000032 630400 20                 EPPR0   26
        19 014352   000024 631400 20                 EPPR1   20
        19 014353   000000 701000 xent               TSX1    XUR$SETDCBS
        19 014354   000000 011000                    NOP     0

     4252    30960    5               END;

     4253    30961    4           END;

  30961 19 014355   016452 710000 19                 TRA     CONTINUE

     4254    30962    3           ELSE                       /* Open back to ME# */
     4255    30963    4           DO;

     4256    30964    4               IF EXIT_MAIL_PEND#

  30964 19 014356   000420 234000 11                 SZN     EXIT_MAIL_PEND#
        19 014357   016452 605000 19                 TPL     CONTINUE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:657  

     4257    30965    5               THEN DO;

     4258    30966    5                   EXIT_MAIL# = '1'B;

  30966 19 014360   000417 756000 11                 STQ     EXIT_MAIL#

     4259    30967    5                   EXIT_MAIL_PEND# = '0'B;

  30967 19 014361   000420 450000 11                 STZ     EXIT_MAIL_PEND#

     4260    30968    5               END;

     4261    30969    4           END;

  30969 19 014362   016452 710000 19                 TRA     CONTINUE

     4262    30970        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:658  
     4263    30971        /* Resend message command */
     4264    30972    3       CASE (%CMD_RESEND_MESSAGE);

     4265    30973    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  30973 19 014363   016562 701000 19                 TSX1    NEED_UPDATE
        19 014364   016452 702000 19                 TSX2    CONTINUE

     4266    30974    3           OPT_SEED = 0;

  30974 19 014365   001710 450000 11                 STZ     OPT_SEED

     4267    30975    3           OPT_SEED$ = ADDR(OPT_SEED);

  30975 19 014366   000306 236000 20                 LDQ     198
        19 014367   201112 756100                    STQ     OPT_SEED$,,AUTO

     4268    30976    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;

  30976 19 014370   200033 450100                    STZ     INDX1,,AUTO
        19 014371   014432 710000 19                 TRA     s:30987+1

     4269    30977    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);

  30977 19 014372   200023 470500                    LDP0    OUT$,,AUTO
        19 014373   200033 720100                    LXL0    INDX1,,AUTO
        19 014374   000003 236110                    LDQ     3,X0,PR0
        19 014375   200024 756100                    STQ     BLK$,,AUTO

     4270    30978    5               DO CASE (BLK$ -> P$B.CODE);

  30978 19 014376   200024 471500                    LDP1    BLK$,,AUTO
        19 014377   100000 721100                    LXL1    0,,PR1
        19 014400   000003 101003                    CMPX1   3,DU
        19 014401   014403 602011 19                 TNC     s:30978+5,X1
        19 014402   014431 710000 19                 TRA     s:30987
        19 014403   014431 710000 19                 TRA     s:30987
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:659  
        19 014404   014406 710000 19                 TRA     s:30980
        19 014405   014423 710000 19                 TRA     s:30985

     4271    30979    5               CASE (%OPT_CRPT);

     4272    30980    5                   CALL VMX$OCTBIN (BLK$->P$B.SUBLK$(0)->P$S,OPT_SEED);

  30980 19 014406   100003 473500                    LDP3    3,,PR1
        19 014407   000306 236000 20                 LDQ     198
        19 014410   201707 756100                    STQ     I+101,,AUTO
        19 014411   201706 453500                    STP3    I+100,,AUTO
        19 014412   201706 630500                    EPPR0   I+100,,AUTO
        19 014413   000000 631400 20                 EPPR1   0
        19 014414   000000 701000 xent               TSX1    VMX$OCTBIN
        19 014415   000000 011000                    NOP     0

     4273    30981    5                   IF OPT_SEED = 0

  30981 19 014416   001710 235000 11                 LDA     OPT_SEED
        19 014417   014431 601000 19                 TNZ     s:30987

     4274    30982    5                   THEN /* allow display w/o decryption */
     4275    30983    5                       OPT_SEED$ = ADDR(NIL);

  30983 19 014420   000022 236000 20                 LDQ     18
        19 014421   201112 756100                    STQ     OPT_SEED$,,AUTO
        19 014422   014431 710000 19                 TRA     s:30987

     4276    30984    5               CASE (%OPT_SELECT);

     4277    30985    5                   CALL INIT$SELECT_OPTS (BLK$,%CMD_RESEND_MESSAGE) ALTRET(CONTINUE);

  30985 19 014423   000545 236000 20                 LDQ     357
        19 014424   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 014425   200024 633500                    EPPR3   BLK$,,AUTO
        19 014426   201117 453500                    STP3    @CURR_COMMAND_CODE+2,,AUTO
        19 014427   017510 701000 19                 TSX1    INIT$SELECT_OPTS
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:660  
        19 014430   016452 702000 19                 TSX2    CONTINUE

     4278    30986    5               END;             /* Do case ... end */

     4279    30987    4           END;

  30987 19 014431   200033 054100                    AOS     INDX1,,AUTO
        19 014432   200023 470500                    LDP0    OUT$,,AUTO
        19 014433   000001 236100                    LDQ     1,,PR0
        19 014434   000022 772000                    QRL     18
        19 014435   200033 116100                    CMPQ    INDX1,,AUTO
        19 014436   014372 605400 19                 TPNZ    s:30977

     4280    30988    3           CALL FIX_CONTEXT;

  30988 19 014437   017470 701000 19                 TSX1    FIX_CONTEXT
        19 014440   000000 011000                    NOP     0

     4281    30989    3           INDX1 = 0;

  30989 19 014441   200033 450100                    STZ     INDX1,,AUTO

     4282    30990        /*
     4283    30991             ***** Build the command buffer to pass to send ...
     4284    30992        */
     4285    30993                %INIT_STR (CODE=E_RESEND_NAME, STR=VM_RESEND_NAME, TEST=YES);

  31000 19 014442   040000 106400                    CMPC    fill='040'O
        19 014443   005063 200037 11                 ADSC9   VM_RESEND_NAME           cn=1,n=31
        19 014444   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 014445   014452 601000 19                 TNZ     s:31016

  31002 19 014446   000546 630400 20                 EPPR0   358
        19 014447   000000 631400 20                 EPPR1   0
        19 014450   000000 701000 xent               TSX1    VMD$ERRMSG
        19 014451   000000 011000                    NOP     0

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:661  
     4286    31016    3           WORK_STRING.L# = VM_RESEND_NAME.L# + 6;

  31016 19 014452   005063 236000 11                 LDQ     VM_RESEND_NAME
        19 014453   000033 772000                    QRL     27
        19 014454   000006 036007                    ADLQ    6,DL
        19 014455   000033 736000                    QLS     27
        19 014456   000174 552040 11                 STBQ    WORK_STRING,'40'O

     4287    31017    3           CALL CONCAT (WORK_STRING.NAME#, ADDR(VM_RESEND_NAME) -> X$STRING.TEXT,

  31017 19 014457   005063 236000 11                 LDQ     VM_RESEND_NAME
        19 014460   000033 772000                    QRL     27
        19 014461   000000 620006                    EAX0    0,QL
        19 014462   040000 100440                    MLR     fill='040'O
        19 014463   005063 200010 11                 ADSC9   VM_RESEND_NAME           cn=1,n=*X0
        19 014464   000174 200777 11                 ADSC9   WORK_STRING              cn=1,n=511
        19 014465   000777 116007                    CMPQ    511,DL
        19 014466   014474 603000 19                 TRC     s:31019
        19 014467   777000 621006                    EAX1    -512,QL
        19 014470   777777 661003                    ERX1    -1,DU
        19 014471   040046 100400                    MLR     fill='040'O
        19 014472   001373 000006 12                 ADSC9   VM_PROKEY+14             cn=0,n=6
        19 014473   000174 200011 11                 ADSC9   WORK_STRING,Q            cn=1,n=*X1

     4288    31018    3             ' *BODY');
     4289    31019    3           CALL BUILD_LINK_TO_SEND_CMD(WORK_STRING);

  31019 19 014474   000051 236000 20                 LDQ     41
        19 014475   201121 756100                    STQ     @SITENAME+1,,AUTO
        19 014476   025126 701000 19                 TSX1    BUILD_LINK_TO_SEND_CMD
        19 014477   000000 011000                    NOP     0

     4290    31020        /*
     4291    31021             ***** Resend all the messages ...
     4292    31022        */
     4293    31023    4           DO FOREVER;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:662  
  31017 19 014500                       RESEND_NEXT  null
     4294    31024    4   RESEND_NEXT: ;
     4295    31025    4               CALL GET$MESSAGE ALTRET(END_RESEND);

  31025 19 014500   020536 701000 19                 TSX1    GET$MESSAGE
        19 014501   014560 702000 19                 TSX2    END_RESEND

     4296    31026    4               INDX1 = INDX1 + 1;

  31026 19 014502   200033 054100                    AOS     INDX1,,AUTO

     4297    31027    4               IF VM_HEADER.STATUS.CRYPT

  31027 19 014503   000000 470400 xsym               LDP0    VM_HEADER$
        19 014504   000012 236100                    LDQ     10,,PR0
        19 014505   010000 316003                    CANQ    4096,DU
        19 014506   014521 600000 19                 TZE     s:31034
        19 014507   001710 235000 11                 LDA     OPT_SEED
        19 014510   014521 601000 19                 TNZ     s:31034
        19 014511   201112 236100                    LDQ     OPT_SEED$,,AUTO
        19 014512   000022 116000 20                 CMPQ    18
        19 014513   014521 600000 19                 TZE     s:31034

     4298    31028    4                 AND OPT_SEED = 0
     4299    31029    4                 AND OPT_SEED$ ~= ADDR(NIL)
     4300    31030    5               THEN DO;

     4301    31031    5                   CALL XUR$ERRMSG (E_NEEDSEED);

  31031 19 014514   000311 630400 20                 EPPR0   201
        19 014515   000024 631400 20                 EPPR1   20
        19 014516   000000 701000 xent               TSX1    XUR$ERRMSG
        19 014517   000000 011000                    NOP     0

     4302    31032    5                   GOTO CONTINUE;

  31032 19 014520   016452 710000 19                 TRA     CONTINUE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:663  

     4303    31033    5               END;
     4304    31034    4               CALL VMD$DI_HEADER (VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);

  31034 19 014521   000033 236000 20                 LDQ     27
        19 014522   201710 756100                    STQ     I+102,,AUTO
        19 014523   000103 236000 20                 LDQ     67
        19 014524   000000 235000 xsym               LDA     VM_HEADER$
        19 014525   201706 757100                    STAQ    I+100,,AUTO
        19 014526   201706 630500                    EPPR0   I+100,,AUTO
        19 014527   000021 631400 20                 EPPR1   17
        19 014530   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 014531   000000 011000                    NOP     0

     4305    31035        /*
     4306    31036             ***** Create the file to contain the message being resent ...
     4307    31037        */
     4308    31038    4               CALL VMM$EDIT_MESSAGE_OUT (CURRENT_MESSAGE_NUMBER,OPT$SEED,

  31038 19 014532   000550 237000 20                 LDAQ    360
        19 014533   201710 757100                    STAQ    I+102,,AUTO
        19 014534   201112 236100                    LDQ     OPT_SEED$,,AUTO
        19 014535   000103 235000 20                 LDA     67
        19 014536   201706 757100                    STAQ    I+100,,AUTO
        19 014537   201706 630500                    EPPR0   I+100,,AUTO
        19 014540   000026 631400 20                 EPPR1   22
        19 014541   000000 701000 xent               TSX1    VMM$EDIT_MESSAGE_OUT
        19 014542   016514 702000 19                 TSX2    E_PMME

     4309    31039    4                 M$MAIL_FILE_NUM,%NO#) ALTRET(E_PMME);
     4310    31040        /*
     4311    31041             ***** Link to SEND ...
     4312    31042        */
     4313    31043    4               CALL LINK_RUNIT

  31043 19 014543   017111 701000 19                 TSX1    LINK_RUNIT
        19 014544   014552 702000 19                 TSX2    s:31051
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:664  

     4314    31044    4               WHENRETURN
     4315    31045    5               DO;

     4316    31046    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,

  31046 19 014545   000120 630400 20                 EPPR0   80
        19 014546   000000 631400 20                 EPPR1   0
        19 014547   000000 701000 xent               TSX1    VMD$GET_HEADER
        19 014550   016514 702000 19                 TSX2    E_PMME

     4317    31047    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     4318    31048    5               END;

  31048 19 014551   014557 710000 19                 TRA     s:31055

     4319    31049    4               WHENALTRETURN
     4320    31050    5               DO;

     4321    31051    5                   CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,

  31051 19 014552   000120 630400 20                 EPPR0   80
        19 014553   000000 631400 20                 EPPR1   0
        19 014554   000000 701000 xent               TSX1    VMD$GET_HEADER
        19 014555   016514 702000 19                 TSX2    E_PMME

     4322    31052    5                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     4323    31053    5                   GOTO END_RESEND;

  31053 19 014556   014560 710000 19                 TRA     END_RESEND

     4324    31054    5               END;
     4325    31055    4           END;                       /* Do forever ... end */

  31055 19 014557   014500 710000 19                 TRA     RESEND_NEXT

     4326    31056    3   END_RESEND:
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:665  
     4327    31057    3           REOPEN_FILE.V.DCB# = DCBNUM(M$EDIT);

  31057 19 014560   000000 236007 xsym  END_RESEND   LDQ     M$EDIT,DL
        19 014561   000000 620006                    EAX0    0,QL
        19 014562   002502 740000 11                 STX0    REOPEN_FILE+36

     4328    31058    3           CALL M$OPEN (REOPEN_FILE)

  31058 19 014563   002436 630400 11                 EPPR0   REOPEN_FILE
        19 014564   450000 713400                    CLIMB   alt,open
        19 014565   410400 401760                    pmme    nvectors=18
        19 014566   014577 702000 19                 TSX2    s:31063

     4329    31059    4           WHENRETURN DO;

     4330    31060    4               CLOSE_SCRATCH.V.DCB# = DCBNUM(M$EDIT);

  31060 19 014567   000000 236007 xsym               LDQ     M$EDIT,DL
        19 014570   000000 620006                    EAX0    0,QL
        19 014571   002200 740000 11                 STX0    CLOSE_SCRATCH+26

     4331    31061    5               CALL M$CLOSE (CLOSE_SCRATCH) WHENALTRETURN DO; END;

  31061 19 014572   002146 630400 11                 EPPR0   CLOSE_SCRATCH
        19 014573   450001 713400                    CLIMB   alt,close
        19 014574   406000 401760                    pmme    nvectors=13
        19 014575   014577 702000 19                 TSX2    s:31063
        19 014576   014577 710000 19                 TRA     s:31063

     4332    31062    4           END;

     4333    31063    3           IF INDX1 = 0

  31063 19 014577   200033 235100                    LDA     INDX1,,AUTO
        19 014600   014611 601000 19                 TNZ     s:31066

     4334    31064    3           THEN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:666  
     4335    31065    3               CALL REPORT_ACTIVITY (INDX1,VM_NO_MESSAGE_FMT,%YES#,E_NO_MESSAGE_FMT);

  31065 19 014601   000104 236000 20                 LDQ     68
        19 014602   201122 756100                    STQ     @NAME+1,,AUTO
        19 014603   000106 237000 20                 LDAQ    70
        19 014604   201120 757100                    STAQ    @EXPLICIT+1,,AUTO
        19 014605   200033 630500                    EPPR0   INDX1,,AUTO
        19 014606   201117 450500                    STP0    @CURR_COMMAND_CODE+2,,AUTO
        19 014607   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 014610   000000 011000                    NOP     0

     4336    31066    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN

  31066 19 014611   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 014612   010000 316003                    CANQ    4096,DU
        19 014613   016452 600000 19                 TZE     CONTINUE

     4337    31067    3           THEN                       /* Ok to read profile */
     4338    31068    3               CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);

  31068 19 014614   000053 630400 20                 EPPR0   43
        19 014615   000024 631400 20                 EPPR1   20
        19 014616   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 014617   016454 702000 19                 TSX2    BAD_PROFILE
        19 014620   016452 710000 19                 TRA     CONTINUE

     4339    31069        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:667  
     4340    31070        /* Rest message command */
     4341    31071    3       CASE(%CMD_REST_MESSAGE);

     4342    31072    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE

  31072 19 014621   000544 235000 11                 LDA     LAST_COMMAND_CODE
        19 014622   000016 115007                    CMPA    14,DL
        19 014623   014640 601000 19                 TNZ     s:31107

     4343    31073    3           THEN
     4344    31074                    %INIT_STR (CODE=E_DI_REST_CMD, STR=VM_DI_REST_CMD,
     4345    31075                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  31082 19 014624   040000 106400                    CMPC    fill='040'O
        19 014625   004666 200017 11                 ADSC9   VM_DI_REST_CMD           cn=1,n=15
        19 014626   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 014627   014634 601000 19                 TNZ     s:31093

  31084 19 014630   000552 630400 20                 EPPR0   362
        19 014631   000000 631400 20                 EPPR1   0
        19 014632   000000 701000 xent               TSX1    VMD$ERRMSG
        19 014633   000000 011000                    NOP     0

  31093 19 014634   000100 100400                    MLR     fill='000'O
        19 014635   004666 000020 11                 ADSC9   VM_DI_REST_CMD           cn=0,n=16
        19 014636   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  31095 19 014637   016452 710000 19                 TRA     CONTINUE

     4346    31098    3           ELSE
     4347    31099                  %INIT_STR (CODE=E_LIST_REST_CMD, STR=VM_LIST_REST_CMD,
     4348    31100                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  31107 19 014640   040000 106400                    CMPC    fill='040'O
        19 014641   004672 200017 11                 ADSC9   VM_LIST_REST_CMD         cn=1,n=15
        19 014642   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 014643   014650 601000 19                 TNZ     s:31118
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:668  

  31109 19 014644   000554 630400 20                 EPPR0   364
        19 014645   000000 631400 20                 EPPR1   0
        19 014646   000000 701000 xent               TSX1    VMD$ERRMSG
        19 014647   000000 011000                    NOP     0

  31118 19 014650   000100 100400                    MLR     fill='000'O
        19 014651   004672 000020 11                 ADSC9   VM_LIST_REST_CMD         cn=0,n=16
        19 014652   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  31120 19 014653   016452 710000 19                 TRA     CONTINUE

     4349    31123        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:669  
     4350    31124        /* Renumber command */
     4351    31125    3       CASE (%CMD_RENUMBER);

     4352    31126    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  31126 19 014654   016562 701000 19                 TSX1    NEED_UPDATE
        19 014655   016452 702000 19                 TSX2    CONTINUE

     4353    31127    3           IF OUT$ -> P$B.NSUBLKS = 0 THEN /* Check for renumber options */

  31127 19 014656   200023 470500                    LDP0    OUT$,,AUTO
        19 014657   000001 220100                    LDX0    1,,PR0
        19 014660   014670 601000 19                 TNZ     s:31131

     4354    31128
     4355    31129    3               CALL UPDATE$MAIL (%YES#); /* Plain renumber */

  31129 19 014661   000022 236000 20                 LDQ     18
        19 014662   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 014663   000050 236000 20                 LDQ     40
        19 014664   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 014665   021446 701000 19                 TSX1    UPDATE$MAIL
        19 014666   000000 011000                    NOP     0
        19 014667   014701 710000 19                 TRA     s:31135

     4356    31130    3           ELSE
     4357    31131    3               CALL UPDATE$MAIL (%YES#,OUT$->P$B.SUBLK$(0)->P$B.CODE);

  31131 19 014670   000003 471500                    LDP1    3,,PR0
        19 014671   201706 451500                    STP1    I+100,,AUTO
        19 014672   201706 236100                    LDQ     I+100,,AUTO
        19 014673   400000 036007                    ADLQ    -131072,DL
        19 014674   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 014675   000050 236000 20                 LDQ     40
        19 014676   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 014677   021446 701000 19                 TSX1    UPDATE$MAIL
        19 014700   000000 011000                    NOP     0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:670  

     4358    31132        /*
     4359    31133             ***** Reinitialize the selection contexts ...
     4360    31134        */
     4361    31135    3           CALL INIT_CONTEXT (%CONTEXT_CURRENT);

  31135 19 014701   000066 236000 20                 LDQ     54
        19 014702   201123 756100                    STQ     LEN+1,,AUTO
        19 014703   017442 701000 19                 TSX1    INIT_CONTEXT
        19 014704   000000 011000                    NOP     0

     4362    31136    3           CALL INIT_CONTEXT (%CONTEXT_SELECTED);

  31136 19 014705   000043 236000 20                 LDQ     35
        19 014706   201123 756100                    STQ     LEN+1,,AUTO
        19 014707   017442 701000 19                 TSX1    INIT_CONTEXT
        19 014710   000000 011000                    NOP     0

     4363    31137    3           IF VM_PROFILE.NUM_MESSAGES > 0

  31137 19 014711   000000 470400 xsym               LDP0    VM_PROFILE$
        19 014712   000005 235100                    LDA     5,,PR0
        19 014713   016452 600000 19                 TZE     CONTINUE

     4364    31138    3           THEN                       /* Select all */
     4365    31139    4           DO;

     4366    31140    4               SELECTED_CONTEXT%.MESSAGE_SET.LOW(0) = 1;

  31140 19 014714   000001 236007                    LDQ     1,DL
        19 014715   001664 471400 11                 LDP1    CONTEXT_PTR$+1
        19 014716   100005 756100                    STQ     5,,PR1

     4367    31141    4               SELECTED_CONTEXT%.MESSAGE_SET.HIGH(0) = %MAX_MSGNO;

  31141 19 014717   000556 235000 20                 LDA     366
        19 014720   100006 755100                    STA     6,,PR1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:671  

     4368    31142    4               SELECTED_CONTEXT%.NUM_ENTRIES = 1;

  31142 19 014721   100002 756100                    STQ     2,,PR1

     4369    31143    4               SELECTED_CONTEXT%.MESSAGE_POINTER = -1;

  31143 19 014722   000001 335007                    LCA     1,DL
        19 014723   100000 755100                    STA     0,,PR1

     4370    31144    4               SELECT_CURRENT = '1'B;

  31144 19 014724   400000 236003                    LDQ     -131072,DU
        19 014725   000403 756000 11                 STQ     SELECT_CURRENT

     4371    31145    4           END;

  31145 19 014726   016452 710000 19                 TRA     CONTINUE

     4372    31146        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:672  
     4373    31147        /* Select message command */
     4374    31148    3       CASE (%CMD_SELECT_MESSAGE);

     4375    31149    3           CALL NEED_FOLDER ALTRET(CONTINUE);

  31149 19 014727   016547 701000 19                 TSX1    NEED_FOLDER
        19 014730   016452 702000 19                 TSX2    CONTINUE

     4376    31150    3           SELECT_CURRENT = '0'B;

  31150 19 014731   000403 450000 11                 STZ     SELECT_CURRENT

     4377    31151    3           CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_SELECT_MESSAGE) ALTRET(
             31151                    CONTINUE);

  31151 19 014732   000560 236000 20                 LDQ     368
        19 014733   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 014734   200023 236100                    LDQ     OUT$,,AUTO
        19 014735   000003 036003                    ADLQ    3,DU
        19 014736   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 014737   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 014740   016452 702000 19                 TSX2    CONTINUE
        19 014741   016452 710000 19                 TRA     CONTINUE

     4378    31152        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:673  
     4379    31153        /* Send command */
     4380    31154    3       CASE (%CMD_SEND);

     4381    31155    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  31155 19 014742   016562 701000 19                 TSX1    NEED_UPDATE
        19 014743   016452 702000 19                 TSX2    CONTINUE

     4382    31156        /*
     4383    31157             ***** Build the command buffer to pass to send ...
     4384    31158        */
     4385    31159    3           WORK_STRING.L# = P_PCB.NCHARS;

  31159 19 014744   000011 236000 11                 LDQ     P_PCB+9
        19 014745   000033 736000                    QLS     27
        19 014746   000174 552040 11                 STBQ    WORK_STRING,'40'O

     4386    31160    3           WORK_STRING.NAME# =CURRENT_LINE;

  31160 19 014747   000000 470400 11                 LDP0    P_PCB
        19 014750   000011 720000 11                 LXL0    P_PCB+9
        19 014751   040000 100540                    MLR     fill='040'O
        19 014752   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
        19 014753   000174 200777 11                 ADSC9   WORK_STRING              cn=1,n=511

     4387    31161    3           CALL BUILD_LINK_TO_SEND_CMD (WORK_STRING);

  31161 19 014754   000051 236000 20                 LDQ     41
        19 014755   201121 756100                    STQ     @SITENAME+1,,AUTO
        19 014756   025126 701000 19                 TSX1    BUILD_LINK_TO_SEND_CMD
        19 014757   000000 011000                    NOP     0

     4388    31162        /*
     4389    31163             ***** Do it...
     4390    31164        */
     4391    31165    3           CALL LINK_RUNIT;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:674  
  31165 19 014760   017111 701000 19                 TSX1    LINK_RUNIT
        19 014761   000000 011000                    NOP     0
        19 014762   016452 710000 19                 TRA     CONTINUE

     4392    31166        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:675  
     4393    31167        /* This message command */
     4394    31168    3       CASE(%CMD_THIS_MESSAGE);

     4395    31169    3           IF LAST_COMMAND_CODE = %CMD_DISPLAY_MESSAGE

  31169 19 014763   000544 235000 11                 LDA     LAST_COMMAND_CODE
        19 014764   000016 115007                    CMPA    14,DL
        19 014765   015002 601000 19                 TNZ     s:31204

     4396    31170    3           THEN
     4397    31171                    %INIT_STR (CODE=E_DI_THIS_CMD, STR=VM_DI_THIS_CMD,
     4398    31172                      NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  31179 19 014766   040000 106400                    CMPC    fill='040'O
        19 014767   004646 200017 11                 ADSC9   VM_DI_THIS_CMD           cn=1,n=15
        19 014770   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 014771   014776 601000 19                 TNZ     s:31190

  31181 19 014772   000421 630400 20                 EPPR0   273
        19 014773   000000 631400 20                 EPPR1   0
        19 014774   000000 701000 xent               TSX1    VMD$ERRMSG
        19 014775   000000 011000                    NOP     0

  31190 19 014776   000100 100400                    MLR     fill='000'O
        19 014777   004646 000020 11                 ADSC9   VM_DI_THIS_CMD           cn=0,n=16
        19 015000   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  31192 19 015001   016452 710000 19                 TRA     CONTINUE

     4399    31195    3           ELSE
     4400    31196                  %INIT_STR (CODE=E_LIST_THIS_CMD, STR=VM_LIST_THIS_CMD,
     4401    31197                  NEXT_CMD=NEXT_COMMAND_TEXT, TEST=YES);

  31204 19 015002   040000 106400                    CMPC    fill='040'O
        19 015003   004652 200017 11                 ADSC9   VM_LIST_THIS_CMD         cn=1,n=15
        19 015004   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 015005   015012 601000 19                 TNZ     s:31215
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:676  

  31206 19 015006   000423 630400 20                 EPPR0   275
        19 015007   000000 631400 20                 EPPR1   0
        19 015010   000000 701000 xent               TSX1    VMD$ERRMSG
        19 015011   000000 011000                    NOP     0

  31215 19 015012   000100 100400                    MLR     fill='000'O
        19 015013   004652 000020 11                 ADSC9   VM_LIST_THIS_CMD         cn=0,n=16
        19 015014   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

  31217 19 015015   016452 710000 19                 TRA     CONTINUE

     4402    31220        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:677  
     4403    31221        /* Time command */
     4404    31222    3       CASE (%CMD_TIME);

     4405    31223    3           CALL M$TIME(GET_TIME);

  31223 19 015016   002530 630400 11                 EPPR0   GET_TIME
        19 015017   020004 713400                    CLIMB   8196
        19 015020   402000 401760                    pmme    nvectors=5

     4406    31224                %INIT_STR (CODE=E_TIME_FMT, STR=VM_TIME_FMT,
     4407    31225                VECT="F_FDSME.FMT_", TEST=YES);

  31232 19 015021   040000 106400                    CMPC    fill='040'O
        19 015022   003340 200120 11                 ADSC9   VM_TIME_FMT              cn=1,n=80
        19 015023   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 015024   015032 601000 19                 TNZ     s:31237

  31234 19 015025   000561 630400 20                 EPPR0   369
        19 015026   000021 631400 20                 EPPR1   17
        19 015027   000000 701000 xent               TSX1    VMD$ERRMSG
        19 015030   000000 011000                    NOP     0

  31235 19 015031   015040 710000 19                 TRA     s:31248

  31237 19 015032   003340 236000 11                 LDQ     VM_TIME_FMT
        19 015033   000033 772000                    QRL     27
        19 015034   000064 737000                    LLS     52
        19 015035   000140 135007                    SBLA    96,DL
        19 015036   000564 236000 20                 LDQ     372
        19 015037   002744 757000 11                 STAQ    F_FDSME

     4408    31248    3           VECT_ARRAY(0) = VECTOR(WORK_UTS);

  31248 19 015040   000442 237000 20                 LDAQ    290
        19 015041   003076 757000 11                 STAQ    VECT_ARRAY

     4409    31249    3           F_FDSME.NVECS# = 1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:678  

  31249 19 015042   000001 235007                    LDA     1,DL
        19 015043   002755 755000 11                 STA     F_FDSME+9

     4410    31250    3           CALL VMD$WRITE_BUF(F_FDSME);

  31250 19 015044   000065 630400 20                 EPPR0   53
        19 015045   000024 631400 20                 EPPR1   20
        19 015046   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 015047   000000 011000                    NOP     0
        19 015050   016452 710000 19                 TRA     CONTINUE

     4411    31251        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:679  
     4412    31252        /* Undelete command */
     4413    31253    3       CASE (%CMD_UNDELETE_MESSAGE);

     4414    31254    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  31254 19 015051   016562 701000 19                 TSX1    NEED_UPDATE
        19 015052   016452 702000 19                 TSX2    CONTINUE

     4415    31255    3           IF OUT$ -> P$B.NSUBLKS > 0

  31255 19 015053   200023 470500                    LDP0    OUT$,,AUTO
        19 015054   000001 220100                    LDX0    1,,PR0
        19 015055   015065 600000 19                 TZE     s:31258

     4416    31256    3           THEN                       /* There are options */
     4417    31257    3              CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_UNDELETE_MESSAGE) ALTRET
             31257                        (CONTINUE);

  31257 19 015056   000566 236000 20                 LDQ     374
        19 015057   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 015060   200023 236100                    LDQ     OUT$,,AUTO
        19 015061   000003 036003                    ADLQ    3,DU
        19 015062   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 015063   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 015064   016452 702000 19                 TSX2    CONTINUE

     4418    31258    3           INDX1 = 0;                  /* Used as counter */

  31258 19 015065   200033 450100                    STZ     INDX1,,AUTO

     4419    31259    3           NONE = %YES#;

  31259 19 015066   400000 236003                    LDQ     -131072,DU
        19 015067   200037 756100                    STQ     NONE,,AUTO

     4420    31260    4           DO FOREVER;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:680  
     4421    31261    4               CALL GET$MESSAGE ALTRET(END_UNDELETE);

  31261 19 015070   020536 701000 19                 TSX1    GET$MESSAGE
        19 015071   015143 702000 19                 TSX2    END_UNDELETE

     4422    31262    4               NONE = %NO#;

  31262 19 015072   200037 450100                    STZ     NONE,,AUTO

     4423    31263
     4424    31264    4               IF VM_PROFILE.OPT.HEADERS

  31264 19 015073   000000 470400 xsym               LDP0    VM_PROFILE$
        19 015074   000000 236100                    LDQ     0,,PR0
        19 015075   000400 316007                    CANQ    256,DL
        19 015076   015110 600000 19                 TZE     s:31268

     4425    31265    4               THEN
     4426    31266    4                   CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);

  31266 19 015077   000033 236000 20                 LDQ     27
        19 015100   201710 756100                    STQ     I+102,,AUTO
        19 015101   000103 236000 20                 LDQ     67
        19 015102   000000 235000 xsym               LDA     VM_HEADER$
        19 015103   201706 757100                    STAQ    I+100,,AUTO
        19 015104   201706 630500                    EPPR0   I+100,,AUTO
        19 015105   000021 631400 20                 EPPR1   17
        19 015106   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 015107   000000 011000                    NOP     0

     4427    31267
     4428    31268    4               IF VM_HEADER.STATUS.DEL

  31268 19 015110   000000 470400 xsym               LDP0    VM_HEADER$
        19 015111   000012 236100                    LDQ     10,,PR0
        19 015112   000400 316003                    CANQ    256,DU
        19 015113   015137 600000 19                 TZE     s:31278
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:681  

     4429    31269    4               THEN
     4430    31270    5               DO;              /* Remove the delete mark */

     4431    31271    5                   CALL XUR$DISABLE;

  31271 19 015114   000020 631400 20                 EPPR1   16
        19 015115   000000 701000 xent               TSX1    XUR$DISABLE
        19 015116   000000 011000                    NOP     0

     4432    31272    5                   VM_HEADER.STATUS.DEL = %NO#;

  31272 19 015117   000000 470400 xsym               LDP0    VM_HEADER$
        19 015120   000140 236000 20                 LDQ     96
        19 015121   000012 356100                    ANSQ    10,,PR0

     4433    31273    5                   CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM);

  31273 19 015122   000120 630400 20                 EPPR0   80
        19 015123   000000 631400 20                 EPPR1   0
        19 015124   000000 701000 xent               TSX1    VMD$PUT_HEADER
        19 015125   000000 011000                    NOP     0

     4434    31274    5                   VM_PROFILE.NUM_DEL_MESSAGES = VM_PROFILE.NUM_DEL_MESSAGES - 1;

  31274 19 015126   000000 470400 xsym               LDP0    VM_PROFILE$
        19 015127   000007 235100                    LDA     7,,PR0
        19 015130   000001 135007                    SBLA    1,DL
        19 015131   000007 755100                    STA     7,,PR0

     4435    31275    5                   INDX1 = INDX1 + 1; /* Keep track of how many messages undeleted */

  31275 19 015132   200033 054100                    AOS     INDX1,,AUTO

     4436    31276    5                   CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(WRITE_ERROR);

  31276 19 015133   000053 236000 20                 LDQ     43
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:682  
        19 015134   201523 756100                    STQ     INDX2+255,,AUTO
        19 015135   021320 701000 19                 TSX1    PUT_PROFILE
        19 015136   016477 702000 19                 TSX2    WRITE_ERROR

     4437    31277    5               END;             /* Remove the delete mark */

     4438    31278    4               CALL XUR$ENABLE;

  31278 19 015137   000020 631400 20                 EPPR1   16
        19 015140   000000 701000 xent               TSX1    XUR$ENABLE
        19 015141   000000 011000                    NOP     0

     4439    31279    4           END;                       /* Do forever ... end  */

  31279 19 015142   015070 710000 19                 TRA     s:31261

  31272 19 015143                       END_UNDELETE null
     4440    31280
     4441    31281    3   END_UNDELETE: ;
     4442    31282    3          CALL REPORT_ACTIVITY (INDX1,VM_MSGS_UNDELETED_FMT,NONE,E_MSGS_UNDELETED_FMT)
             31282                    ;

  31282 19 015143   000567 236000 20                 LDQ     375
        19 015144   201122 756100                    STQ     @NAME+1,,AUTO
        19 015145   200037 630500                    EPPR0   NONE,,AUTO
        19 015146   201121 450500                    STP0    @SITENAME+1,,AUTO
        19 015147   000570 236000 20                 LDQ     376
        19 015150   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 015151   200033 631500                    EPPR1   INDX1,,AUTO
        19 015152   201117 451500                    STP1    @CURR_COMMAND_CODE+2,,AUTO
        19 015153   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 015154   000000 011000                    NOP     0
        19 015155   016452 710000 19                 TRA     CONTINUE

     4443    31283
     4444    31284        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:683  
     4445    31285        /* Unmark command */
     4446    31286    3       CASE(%CMD_UNMARK_MESSAGE);

     4447    31287    3           CALL NEED_UPDATE ALTRET(CONTINUE);

  31287 19 015156   016562 701000 19                 TSX1    NEED_UPDATE
        19 015157   016452 702000 19                 TSX2    CONTINUE

     4448    31288    3           IF OUT$ -> P$B.NSUBLKS > 0

  31288 19 015160   200023 470500                    LDP0    OUT$,,AUTO
        19 015161   000001 220100                    LDX0    1,,PR0
        19 015162   015172 600000 19                 TZE     s:31291

     4449    31289    3           THEN                       /* There are options */
     4450    31290    3               CALL INIT$SELECT_OPTS (OUT$->P$B.SUBLK$(0),%CMD_UNMARK_MESSAGE) ALTRET(
             31290                        CONTINUE);

  31290 19 015163   000572 236000 20                 LDQ     378
        19 015164   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 015165   200023 236100                    LDQ     OUT$,,AUTO
        19 015166   000003 036003                    ADLQ    3,DU
        19 015167   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 015170   017510 701000 19                 TSX1    INIT$SELECT_OPTS
        19 015171   016452 702000 19                 TSX2    CONTINUE

     4451    31291    3           INDX1 = 0;                  /* Used as counter */

  31291 19 015172   200033 450100                    STZ     INDX1,,AUTO

     4452    31292    3           NONE = %YES#;

  31292 19 015173   400000 236003                    LDQ     -131072,DU
        19 015174   200037 756100                    STQ     NONE,,AUTO

     4453    31293    4           DO FOREVER;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:684  
     4454    31294    4               CALL GET$MESSAGE ALTRET(END_UNMARK);

  31294 19 015175   020536 701000 19                 TSX1    GET$MESSAGE
        19 015176   015240 702000 19                 TSX2    END_UNMARK

     4455    31295    4               NONE = %NO#;

  31295 19 015177   200037 450100                    STZ     NONE,,AUTO

     4456    31296
     4457    31297    4               IF VM_PROFILE.OPT.HEADERS

  31297 19 015200   000000 470400 xsym               LDP0    VM_PROFILE$
        19 015201   000000 236100                    LDQ     0,,PR0
        19 015202   000400 316007                    CANQ    256,DL
        19 015203   015215 600000 19                 TZE     s:31300

     4458    31298    4               THEN
     4459    31299    4                   CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,M$LO_NUM);

  31299 19 015204   000470 236000 20                 LDQ     312
        19 015205   201710 756100                    STQ     I+102,,AUTO
        19 015206   000103 236000 20                 LDQ     67
        19 015207   000000 235000 xsym               LDA     VM_HEADER$
        19 015210   201706 757100                    STAQ    I+100,,AUTO
        19 015211   201706 630500                    EPPR0   I+100,,AUTO
        19 015212   000021 631400 20                 EPPR1   17
        19 015213   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 015214   000000 011000                    NOP     0

     4460    31300    4               IF VM_HEADER.STATUS.MARK

  31300 19 015215   000000 470400 xsym               LDP0    VM_HEADER$
        19 015216   000012 236100                    LDQ     10,,PR0
        19 015217   000100 316003                    CANQ    64,DU
        19 015220   015175 600000 19                 TZE     s:31294

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:685  
     4461    31301    4               THEN
     4462    31302    5               DO;              /* Remove the mark */

     4463    31303
     4464    31304    5                   CALL XUR$DISABLE;

  31304 19 015221   000020 631400 20                 EPPR1   16
        19 015222   000000 701000 xent               TSX1    XUR$DISABLE
        19 015223   000000 011000                    NOP     0

     4465    31305    5                   VM_HEADER.STATUS.MARK = %NO#;

  31305 19 015224   000000 470400 xsym               LDP0    VM_HEADER$
        19 015225   000573 236000 20                 LDQ     379
        19 015226   000012 356100                    ANSQ    10,,PR0

     4466    31306    5                   CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER,M$MAIL_FILE_NUM);

  31306 19 015227   000120 630400 20                 EPPR0   80
        19 015230   000000 631400 20                 EPPR1   0
        19 015231   000000 701000 xent               TSX1    VMD$PUT_HEADER
        19 015232   000000 011000                    NOP     0

     4467    31307    5                   CALL XUR$ENABLE;

  31307 19 015233   000020 631400 20                 EPPR1   16
        19 015234   000000 701000 xent               TSX1    XUR$ENABLE
        19 015235   000000 011000                    NOP     0

     4468    31308    5                   INDX1 = INDX1 + 1;

  31308 19 015236   200033 054100                    AOS     INDX1,,AUTO

     4469    31309    5               END;             /* Remove the mark */

     4470    31310    4           END;                       /* Do forever ... end  */

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:686  
  31310 19 015237   015175 710000 19                 TRA     s:31294

  31305 19 015240                       END_UNMARK   null
     4471    31311
     4472    31312    3   END_UNMARK: ;
     4473    31313    3           CALL REPORT_ACTIVITY (INDX1,VM_MSGS_UNMARKED_FMT,NONE,E_MSGS_UNMARKED_FMT);

  31313 19 015240   000574 236000 20                 LDQ     380
        19 015241   201122 756100                    STQ     @NAME+1,,AUTO
        19 015242   200037 630500                    EPPR0   NONE,,AUTO
        19 015243   201121 450500                    STP0    @SITENAME+1,,AUTO
        19 015244   000575 236000 20                 LDQ     381
        19 015245   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 015246   200033 631500                    EPPR1   INDX1,,AUTO
        19 015247   201117 451500                    STP1    @CURR_COMMAND_CODE+2,,AUTO
        19 015250   017334 701000 19                 TSX1    REPORT_ACTIVITY
        19 015251   000000 011000                    NOP     0
        19 015252   016452 710000 19                 TRA     CONTINUE

     4474    31314
     4475    31315        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:687  
     4476    31316        /* Use command */
     4477    31317    3       CASE (%CMD_USE);

     4478    31318        /*
     4479    31319             ***** Process ...
     4480    31320        */
     4481    31321    3           NEXT_COMMAND_TEXT.L# = 0;

  31321 19 015253   000000 236003                    LDQ     0,DU
        19 015254   200551 552140                    STBQ    NEXT_COMMAND_TEXT,'40'O,AUTO

     4482    31322    3           REOPENED_FOLDER = '0'B;

  31322 19 015255   000405 450000 11                 STZ     REOPENED_FOLDER

     4483    31323    3           EXIT_MAIL# = %NO#;

  31323 19 015256   000417 450000 11                 STZ     EXIT_MAIL#

     4484    31324    3           OPT_NOUPDATE = %NO#;

  31324 19 015257   201106 450100                    STZ     OPT_NOUPDATE,,AUTO

     4485    31325    3           OPT_BYPASS = %NO#;

  31325 19 015260   201105 450100                    STZ     OPT_BYPASS,,AUTO

     4486    31326        /*
     4487    31327             ***** Disable breaks ...
     4488    31328        */
     4489    31329    3           CALL XUR$DISABLE;

  31329 19 015261   000020 631400 20                 EPPR1   16
        19 015262   000000 701000 xent               TSX1    XUR$DISABLE
        19 015263   000000 011000                    NOP     0

     4490    31330    3           NEXT_COMMAND_ECHO# = %NO#;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:688  

  31330 19 015264   000542 450000 11                 STZ     NEXT_COMMAND_ECHO#

     4491    31331    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN /* Check if file already open */

  31331 19 015265   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 015266   010000 316003                    CANQ    4096,DU
        19 015267   015346 600000 19                 TZE     s:31357

     4492    31332    3           THEN
     4493    31333    4           DO;

     4494    31334    5               DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;

  31334 19 015270   200033 450100                    STZ     INDX1,,AUTO
        19 015271   015310 710000 19                 TRA     s:31340+1

     4495    31335    6                   DO CASE (OUT$ -> P$B.SUBLK$(INDX1) -> P$B.CODE);

  31335 19 015272   200023 470500                    LDP0    OUT$,,AUTO
        19 015273   200033 720100                    LXL0    INDX1,,AUTO
        19 015274   000003 471510                    LDP1    3,X0,PR0
        19 015275   100000 236100                    LDQ     0,,PR1
        19 015276   777777 376007                    ANQ     -1,DL
        19 015277   000005 136007                    SBLQ    5,DL
        19 015300   000001 116007                    CMPQ    1,DL
        19 015301   015303 602006 19                 TNC     s:31335+9,QL
        19 015302   015307 710000 19                 TRA     s:31340
        19 015303   015304 710000 19                 TRA     s:31337

     4496    31336    6                   CASE (%OPT_NOUPDATE);

     4497    31337    6                       OPT_NOUPDATE = %YES#;

  31337 19 015304   400000 236003                    LDQ     -131072,DU
        19 015305   201106 756100                    STQ     OPT_NOUPDATE,,AUTO
        19 015306   015307 710000 19                 TRA     s:31340
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:689  

     4498    31338    6                   CASE (ELSE);

     4499    31339    6                   END;

     4500    31340    5               END;

  31340 19 015307   200033 054100                    AOS     INDX1,,AUTO
        19 015310   200023 470500                    LDP0    OUT$,,AUTO
        19 015311   000001 236100                    LDQ     1,,PR0
        19 015312   000022 772000                    QRL     18
        19 015313   200033 116100                    CMPQ    INDX1,,AUTO
        19 015314   015272 605400 19                 TPNZ    s:31335

     4501    31341    4               IF NOT OPT_NOUPDATE

  31341 19 015315   201106 234100                    SZN     OPT_NOUPDATE,,AUTO
        19 015316   015326 604000 19                 TMI     s:31344

     4502    31342    4               THEN
     4503    31343    4                   CALL UPDATE$MAIL (VM_PROFILE.OPT.RENUMBER);

  31343 19 015317   000022 236000 20                 LDQ     18
        19 015320   201120 756100                    STQ     @EXPLICIT+1,,AUTO
        19 015321   000000 236000 xsym               LDQ     VM_PROFILE$
        19 015322   630000 036007                    ADLQ    -53248,DL
        19 015323   201117 756100                    STQ     @CURR_COMMAND_CODE+2,,AUTO
        19 015324   021446 701000 19                 TSX1    UPDATE$MAIL
        19 015325   000000 011000                    NOP     0

     4504    31344    4               IF VM_CURRENT_FOLDER.FLAGS.UPDATE

  31344 19 015326   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 015327   015334 605000 19                 TPL     s:31347

     4505    31345    4               THEN
     4506    31346    4                   CALL PUT_PROFILE (M$MAIL_FILE_NUM);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:690  

  31346 19 015330   000053 236000 20                 LDQ     43
        19 015331   201523 756100                    STQ     INDX2+255,,AUTO
        19 015332   021320 701000 19                 TSX1    PUT_PROFILE
        19 015333   000000 011000                    NOP     0

     4507    31347    4               FOLDER_WAS_OPEN = '1'B;

  31347 19 015334   400000 236003                    LDQ     -131072,DU
        19 015335   000404 756000 11                 STQ     FOLDER_WAS_OPEN

     4508    31348        /* The folder used to be closed here.  Now, it is left open for
     4509    31349           the next folders address resolution.  The close is done by
     4510    31350            VMA$OPEN_FOLDER, called by one of the VMB$USE routines.
     4511    31351        */
     4512    31352    4               VM_CURRENT_FOLDER.FLAGS = %NO#;

  31352 19 015336   001266 450000 11                 STZ     VM_CURRENT_FOLDER+19

     4513    31353    4               IF NOT VM_SEARCH_INFO.ACTIVE

  31353 19 015337   001632 234000 11                 SZN     VM_SEARCH_INFO+34
        19 015340   015347 604000 19                 TMI     s:31358

     4514    31354    4               THEN CALL VMA$OPEN_SRCH_LIST(VM_SEARCH_INFO);

  31354 19 015341   000042 630400 20                 EPPR0   34
        19 015342   000024 631400 20                 EPPR1   20
        19 015343   000000 701000 xent               TSX1    VMA$OPEN_SRCH_LIST
        19 015344   000000 011000                    NOP     0

     4515    31355    4           END;

  31355 19 015345   015347 710000 19                 TRA     s:31358

     4516    31356    3           ELSE
     4517    31357    3               FOLDER_WAS_OPEN = '0'B;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:691  

  31357 19 015346   000404 450000 11                 STZ     FOLDER_WAS_OPEN

     4518    31358    3           IF NOT VM_SEARCH_INFO.ACTIVE

  31358 19 015347   001632 234000 11                 SZN     VM_SEARCH_INFO+34
        19 015350   015355 604000 19                 TMI     s:31364

     4519    31359    3           THEN
     4520    31360    3               CALL VMA$OPEN_SRCH_LIST (VM_SEARCH_INFO);

  31360 19 015351   000042 630400 20                 EPPR0   34
        19 015352   000024 631400 20                 EPPR1   20
        19 015353   000000 701000 xent               TSX1    VMA$OPEN_SRCH_LIST
        19 015354   000000 011000                    NOP     0

     4521    31361        /*
     4522    31362             ***** Get specified options ...
     4523    31363        */
     4524    31364    3           OPT_NOUPDATE = %NO#;

  31364 19 015355   201106 450100                    STZ     OPT_NOUPDATE,,AUTO

     4525    31365    4           DO INDX1 = 0 TO OUT$ -> P$B.NSUBLKS - 1;

  31365 19 015356   200033 450100                    STZ     INDX1,,AUTO
        19 015357   015505 710000 19                 TRA     s:31410+1

     4526    31366    4               BLK$ = OUT$ -> P$B.SUBLK$(INDX1);

  31366 19 015360   200023 470500                    LDP0    OUT$,,AUTO
        19 015361   200033 720100                    LXL0    INDX1,,AUTO
        19 015362   000003 236110                    LDQ     3,X0,PR0
        19 015363   200024 756100                    STQ     BLK$,,AUTO

     4527    31367    5               DO CASE (BLK$ -> P$B.CODE);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:692  
  31367 19 015364   200024 471500                    LDP1    BLK$,,AUTO
        19 015365   100000 721100                    LXL1    0,,PR1
        19 015366   000005 101003                    CMPX1   5,DU
        19 015367   015371 602011 19                 TNC     s:31367+5,X1
        19 015370   015504 710000 19                 TRA     s:31410
        19 015371   015504 710000 19                 TRA     s:31410
        19 015372   015471 710000 19                 TRA     s:31395
        19 015373   015474 710000 19                 TRA     s:31400
        19 015374   015500 710000 19                 TRA     s:31406
        19 015375   015376 710000 19                 TRA     s:31369

     4528    31368    5               CASE (%OPT_MID);

     4529    31369    5                   VM_CURRENT_FOLDER_SAVE = VM_CURRENT_FOLDER;

  31369 19 015376   000000 100400                    MLR     fill='000'O
        19 015377   001243 000431 11                 ADSC9   VM_CURRENT_FOLDER        cn=0,n=281
        19 015400   001352 000431 11                 ADSC9   VM_CURRENT_FOLDER_SAVE   cn=0,n=281

     4530    31370    5                   CALL VMB$USE_SPECIFIED (BLK$,USER_NAME,VM_CURRENT_FOLDER,
             31370                            M$MAIL_FILE_NUM,VM_SEARCH_INFO)

  31370 19 015401   000042 236000 20                 LDQ     34
        19 015402   201712 756100                    STQ     I+104,,AUTO
        19 015403   000052 237000 20                 LDAQ    42
        19 015404   201710 757100                    STAQ    I+102,,AUTO
        19 015405   000034 236000 20                 LDQ     28
        19 015406   201707 756100                    STQ     I+101,,AUTO
        19 015407   200024 633500                    EPPR3   BLK$,,AUTO
        19 015410   201706 453500                    STP3    I+100,,AUTO
        19 015411   201706 630500                    EPPR0   I+100,,AUTO
        19 015412   000041 631400 20                 EPPR1   33
        19 015413   000000 701000 xent               TSX1    VMB$USE_SPECIFIED
        19 015414   015420 702000 19                 TSX2    s:31375

     4531    31371    6                   WHENRETURN DO;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:693  
     4532    31372    6                       VM_SEARCH_INFO.CURRENT = '1'B;

  31372 19 015415   100000 236003                    LDQ     32768,DU
        19 015416   001632 256000 11                 ORSQ    VM_SEARCH_INFO+34

     4533    31373    6                   END;

  31373 19 015417   015466 710000 19                 TRA     s:31393

     4534    31374    6                   WHENALTRETURN DO;

     4535    31375    6                       VM_SEARCH_INFO.CURRENT = '0'B;

  31375 19 015420   000055 236000 20                 LDQ     45
        19 015421   001632 356000 11                 ANSQ    VM_SEARCH_INFO+34

     4536    31376    6                       IF NOT FOLDER_WAS_OPEN THEN GOTO NO_FOLD;

  31376 19 015422   000404 234000 11                 SZN     FOLDER_WAS_OPEN
        19 015423   016376 605000 19                 TPL     NO_FOLD

     4537    31377    6                       REOPENED_FOLDER = '1'B;

  31377 19 015424   400000 236003                    LDQ     -131072,DU
        19 015425   000405 756000 11                 STQ     REOPENED_FOLDER

     4538    31378    6                       VM_CURRENT_FOLDER = VM_CURRENT_FOLDER_SAVE;

  31378 19 015426   000000 100400                    MLR     fill='000'O
        19 015427   001352 000431 11                 ADSC9   VM_CURRENT_FOLDER_SAVE   cn=0,n=281
        19 015430   001243 000431 11                 ADSC9   VM_CURRENT_FOLDER        cn=0,n=281

     4539    31379    6                       CALL VMA$OPEN_FOLDER (VM_CURRENT_FOLDER,,M$MAIL_FILE_NUM,%
             31379                                OLDFILE#,%UPDATE#)

  31379 19 015431   000043 236000 20                 LDQ     35
        19 015432   201712 756100                    STQ     I+104,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:694  
        19 015433   000576 237000 20                 LDAQ    382
        19 015434   201710 757100                    STAQ    I+102,,AUTO
        19 015435   000022 236000 20                 LDQ     18
        19 015436   000052 235000 20                 LDA     42
        19 015437   201706 757100                    STAQ    I+100,,AUTO
        19 015440   201706 630500                    EPPR0   I+100,,AUTO
        19 015441   000041 631400 20                 EPPR1   33
        19 015442   000000 701000 xent               TSX1    VMA$OPEN_FOLDER
        19 015443   015447 702000 19                 TSX2    s:31384

     4540    31380    7                       WHENRETURN DO;

     4541    31381    7                           VM_SEARCH_INFO.CURRENT = '1'B;

  31381 19 015444   100000 236003                    LDQ     32768,DU
        19 015445   001632 256000 11                 ORSQ    VM_SEARCH_INFO+34

     4542    31382    7                       END;

  31382 19 015446   015466 710000 19                 TRA     s:31393

     4543    31383    7                       WHENALTRETURN DO;

     4544    31384    7                           CALL VMA$OPEN_FOLDER (VM_CURRENT_FOLDER,,M$MAIL_FILE_NUM,%
             31384                                    OLDFILE#,%IN#)

  31384 19 015447   000111 236000 20                 LDQ     73
        19 015450   201712 756100                    STQ     I+104,,AUTO
        19 015451   000576 237000 20                 LDAQ    382
        19 015452   201710 757100                    STAQ    I+102,,AUTO
        19 015453   000022 236000 20                 LDQ     18
        19 015454   000052 235000 20                 LDA     42
        19 015455   201706 757100                    STAQ    I+100,,AUTO
        19 015456   201706 630500                    EPPR0   I+100,,AUTO
        19 015457   000041 631400 20                 EPPR1   33
        19 015460   000000 701000 xent               TSX1    VMA$OPEN_FOLDER
        19 015461   015465 702000 19                 TSX2    s:31389
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:695  

     4545    31385    8                           WHENRETURN DO;

     4546    31386    8                               VM_SEARCH_INFO.CURRENT = '1'B;

  31386 19 015462   100000 236003                    LDQ     32768,DU
        19 015463   001632 256000 11                 ORSQ    VM_SEARCH_INFO+34

     4547    31387    8                           END;

  31387 19 015464   015466 710000 19                 TRA     s:31393

     4548    31388    8                           WHENALTRETURN DO;

     4549    31389    8                               GOTO CONTINUE;

  31389 19 015465   016452 710000 19                 TRA     CONTINUE

     4550    31390    8                           END;
     4551    31391    7                       END;

     4552    31392    6                   END;

     4553    31393    5                   CALL CLOSE_SEARCH;

  31393 19 015466   016625 701000 19                 TSX1    CLOSE_SEARCH
        19 015467   000000 011000                    NOP     0
        19 015470   015504 710000 19                 TRA     s:31410

     4554    31394    5               CASE (%OPT_BYPASS);

     4555    31395    5                   OPT_BYPASS = %YES#;

  31395 19 015471   400000 236003                    LDQ     -131072,DU
        19 015472   201105 756100                    STQ     OPT_BYPASS,,AUTO
        19 015473   015504 710000 19                 TRA     s:31410

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:696  
     4556    31396    5               CASE (%OPT_ENDNOUPDATE);

     4557    31397        /*
     4558    31398             ***** Allowed on mail invocation only ...
     4559    31399        */
     4560    31400    5                   OPT_NOUPDATE = %YES#;

  31400 19 015474   400000 236003                    LDQ     -131072,DU
        19 015475   201106 756100                    STQ     OPT_NOUPDATE,,AUTO

     4561    31401    5                   EXIT_MAIL# = %YES#;

  31401 19 015476   000417 756000 11                 STQ     EXIT_MAIL#
        19 015477   015504 710000 19                 TRA     s:31410

     4562    31402    5               CASE (%OPT_ENDUPDATE);

     4563    31403        /*
     4564    31404             ***** Allowed on mail invocation only ...
     4565    31405        */
     4566    31406    5                   OPT_NOUPDATE = %NO#;

  31406 19 015500   201106 450100                    STZ     OPT_NOUPDATE,,AUTO

     4567    31407    5                   EXIT_MAIL# = %YES#;

  31407 19 015501   400000 236003                    LDQ     -131072,DU
        19 015502   000417 756000 11                 STQ     EXIT_MAIL#
        19 015503   015504 710000 19                 TRA     s:31410

     4568    31408    5               CASE (%OPT_NOUPDATE);

     4569    31409    5               END;                  /* Do case ... end */

     4570    31410    4           END;                       /* Do INDX1 = ... end */

  31410 19 015504   200033 054100                    AOS     INDX1,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:697  
        19 015505   200023 470500                    LDP0    OUT$,,AUTO
        19 015506   000001 236100                    LDQ     1,,PR0
        19 015507   000022 772000                    QRL     18
        19 015510   200033 116100                    CMPQ    INDX1,,AUTO
        19 015511   015360 605400 19                 TPNZ    s:31366

     4571    31411        /*
     4572    31412             ***** If no folder was specified (VM_CURRENT_FOLDER.FLAGS.OPEN reset),
     4573    31413                   then open the default folder for this user ...
     4574    31414        */
     4575    31415    3           IF VM_CURRENT_FOLDER.FLAGS.OPEN = %NO# THEN

  31415 19 015512   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 015513   010000 316003                    CANQ    4096,DU
        19 015514   016027 601000 19                 TNZ     s:31512

     4576    31416    4   FOLD_CREATE: DO;

  31416 19 015515                       FOLD_CREATE  null
     4577    31417    4               CALL CLOSE_SEARCH;

  31417 19 015515   016625 701000 19                 TSX1    CLOSE_SEARCH
        19 015516   000000 011000                    NOP     0

     4578    31418    4               CALL VMB$USE_DEFAULT (,USER_NAME,VM_CURRENT_FOLDER,M$MAIL_FILE_NUM,
             31418                        VM_SEARCH_INFO,,'1'B)

  31418 19 015517   000050 236000 20                 LDQ     40
        19 015520   201714 756100                    STQ     I+106,,AUTO
        19 015521   000022 236000 20                 LDQ     18
        19 015522   000042 235000 20                 LDA     34
        19 015523   201712 757100                    STAQ    I+104,,AUTO
        19 015524   000052 237000 20                 LDAQ    42
        19 015525   201710 757100                    STAQ    I+102,,AUTO
        19 015526   000034 236000 20                 LDQ     28
        19 015527   000022 235000 20                 LDA     18
        19 015530   201706 757100                    STAQ    I+100,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:698  
        19 015531   201706 630500                    EPPR0   I+100,,AUTO
        19 015532   000046 631400 20                 EPPR1   38
        19 015533   000000 701000 xent               TSX1    VMB$USE_DEFAULT
        19 015534   015540 702000 19                 TSX2    s:31423

     4579    31419    5               WHENRETURN DO;

     4580    31420    5                   VM_SEARCH_INFO.CURRENT = %YES#;

  31420 19 015535   100000 236003                    LDQ     32768,DU
        19 015536   001632 256000 11                 ORSQ    VM_SEARCH_INFO+34

     4581    31421    5               END;

  31421 19 015537   016027 710000 19                 TRA     s:31512

     4582    31422    5               WHENALTRETURN DO;

     4583    31423    6                   call VMB$TESTREG(USER_NAME) whenreturn do;

  31423 19 015540   000034 630400 20                 EPPR0   28
        19 015541   000024 631400 20                 EPPR1   20
        19 015542   000000 701000 xent               TSX1    VMB$TESTREG
        19 015543   015756 702000 19                 TSX2    s:31498

     4584    31424                            /* If user is registered...  */
     4585    31425        /*
     4586    31426             ***** User is already registered, create folder for him if one doesn't
     4587    31427             ***** already exist.
     4588    31428        */
     4589    31429    6                       VM_CURRENT_FOLDER.FLAGS=%NO#;

  31429 19 015544   001266 450000 11                 STZ     VM_CURRENT_FOLDER+19

     4590    31430    6                       VM_RADDRESS.ACCT = VM_CURRENT_FOLDER.ACCT;

  31430 19 015545   040100 100400                    MLR     fill='040'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:699  
        19 015546   001244 400010 11                 ADSC9   VM_CURRENT_FOLDER+1      cn=2,n=8
        19 015547   200772 600010                    ADSC9   VM_RADDRESS+17,,AUTO     cn=3,n=8

     4591    31431    6                       VM_RADDRESS.FOLDER = VM_CURRENT_FOLDER.FOLDER;

  31431 19 015550   040100 100400                    MLR     fill='040'O
        19 015551   001246 400031 11                 ADSC9   VM_CURRENT_FOLDER+3      cn=2,n=25
        19 015552   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25

     4592    31432    6                       VM_RADDRESS.PASS = VM_CURRENT_FOLDER.PASS;

  31432 19 015553   040100 100400                    MLR     fill='040'O
        19 015554   001254 600010 11                 ADSC9   VM_CURRENT_FOLDER+9      cn=3,n=8
        19 015555   200766 600010                    ADSC9   VM_RADDRESS+13,,AUTO     cn=3,n=8

     4593    31433    6                       VM_RADDRESS.SITENAME = VM_CURRENT_FOLDER.SITENAME;

  31433 19 015556   040100 100400                    MLR     fill='040'O
        19 015557   001256 600010 11                 ADSC9   VM_CURRENT_FOLDER+11     cn=3,n=8
        19 015560   200770 600010                    ADSC9   VM_RADDRESS+15,,AUTO     cn=3,n=8

     4594    31434    6                       CALL VMA$OPEN_FOLDER (VM_CURRENT_FOLDER,

  31434 19 015561   200751 630500                    EPPR0   VM_RADDRESS,,AUTO
        19 015562   201706 450500                    STP0    I+100,,AUTO
        19 015563   000170 237000 20                 LDAQ    120
        19 015564   201712 757100                    STAQ    I+104,,AUTO
        19 015565   000053 236000 20                 LDQ     43
        19 015566   201711 756100                    STQ     I+103,,AUTO
        19 015567   201706 631500                    EPPR1   I+100,,AUTO
        19 015570   201710 451500                    STP1    I+102,,AUTO
        19 015571   000052 236000 20                 LDQ     42
        19 015572   201707 756100                    STQ     I+101,,AUTO
        19 015573   201707 630500                    EPPR0   I+101,,AUTO
        19 015574   000041 631400 20                 EPPR1   33
        19 015575   000000 701000 xent               TSX1    VMA$OPEN_FOLDER
        19 015576   015600 702000 19                 TSX2    s:31438
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:700  
        19 015577   015625 710000 19                 TRA     s:31448

     4595    31435    6                         ADDR(VM_RADDRESS),M$MAIL_FILE_NUM,%ERROR#,
     4596    31436    6                         %CREATE#)
     4597    31437    7                       WHENALTRETURN DO;

     4598    31438    7                           IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$CREATERR THEN

  31438 19 015600   000000 470400 xsym               LDP0    B$TCB$
        19 015601   000000 471500                    LDP1    0,,PR0
        19 015602   100102 236100                    LDQ     66,,PR1
        19 015603   377770 376007                    ANQ     131064,DL
        19 015604   001560 116007                    CMPQ    880,DL
        19 015605   016363 601000 19                 TNZ     NO_FOLD_ERR

     4599    31439    8                           DO; /* Folder already exists, so open */

     4600    31440    8                               CALL VMA$OPEN_FOLDER(VM_CURRENT_FOLDER,

  31440 19 015606   200751 633500                    EPPR3   VM_RADDRESS,,AUTO
        19 015607   201706 453500                    STP3    I+100,,AUTO
        19 015610   000600 237000 20                 LDAQ    384
        19 015611   201712 757100                    STAQ    I+104,,AUTO
        19 015612   000053 236000 20                 LDQ     43
        19 015613   201711 756100                    STQ     I+103,,AUTO
        19 015614   201706 631500                    EPPR1   I+100,,AUTO
        19 015615   201710 451500                    STP1    I+102,,AUTO
        19 015616   000052 236000 20                 LDQ     42
        19 015617   201707 756100                    STQ     I+101,,AUTO
        19 015620   201707 630500                    EPPR0   I+101,,AUTO
        19 015621   000041 631400 20                 EPPR1   33
        19 015622   000000 701000 xent               TSX1    VMA$OPEN_FOLDER
        19 015623   016363 702000 19                 TSX2    NO_FOLD_ERR

     4601    31441    8                                 ADDR(VM_RADDRESS),M$MAIL_FILE_NUM,
     4602    31442    8                                 %OLDFILE#,%UPDATE#) ALTRET(NO_FOLD_ERR);
     4603    31443    8                               EXIT FOLD_CREATE;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:701  

  31443 19 015624   016027 710000 19                 TRA     s:31512

     4604    31444    8                           END;
     4605    31445    7                           ELSE
     4606    31446    7                               GOTO NO_FOLD_ERR;
     4607    31447    7                       END;
     4608    31448    6                       WORK_STRING.L#=SIZEC(WORK_STRING.NAME#);

  31448 19 015625   777000 236003                    LDQ     -512,DU
        19 015626   000174 552040 11                 STBQ    WORK_STRING,'40'O

     4609    31449    6                       CALL GET_FOLDERNAME (VM_CURRENT_FOLDER);

  31449 19 015627   000052 236000 20                 LDQ     42
        19 015630   201123 756100                    STQ     LEN+1,,AUTO
        19 015631   017064 701000 19                 TSX1    GET_FOLDERNAME
        19 015632   000000 011000                    NOP     0

     4610    31450    6                      CALL XUR$INFOMSG (E_CREATE_MSG_FMT,,M$ME_NUM,VECTOR(WORK_STRING)
             31450                                );

  31450 19 015633   000174 237000 20                 LDAQ    124
        19 015634   201710 757100                    STAQ    I+102,,AUTO
        19 015635   000022 236000 20                 LDQ     18
        19 015636   000176 235000 20                 LDA     126
        19 015637   201706 757100                    STAQ    I+100,,AUTO
        19 015640   201706 630500                    EPPR0   I+100,,AUTO
        19 015641   000026 631400 20                 EPPR1   22
        19 015642   000000 701000 xent               TSX1    XUR$INFOMSG
        19 015643   000000 011000                    NOP     0

     4611    31451    6                       VM_PROFILE = CVM_PROFILE; /* Build a default profile */

  31451 19 015644   000000 470400 xsym               LDP0    VM_PROFILE$
        19 015645   000100 100400                    MLR     fill='000'O
        19 015646   000100 000704 12                 ADSC9   CVM_PROFILE              cn=0,n=452
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:702  
        19 015647   000000 000704                    ADSC9   0,,PR0                   cn=0,n=452

     4612    31452    6                       VM_PROFILE.FREE$ = ADDR(NIL);

  31452 19 015650   000022 236000 20                 LDQ     18
        19 015651   000003 756100                    STQ     3,,PR0

     4613    31453    6                       VM_PROFILE.NEXT$ = ADDR(VM_PROFILE.WORK_AREA);

  31453 19 015652   000000 236000 xsym               LDQ     VM_PROFILE$
        19 015653   000160 036003                    ADLQ    112,DU
        19 015654   000004 756100                    STQ     4,,PR0

     4614    31454    6                       CALL CONCAT (VM_PROFILE.NAME_KEY,B$JIT.ACCN,B$JIT.UNAME);

  31454 19 015655   000000 471400 xsym               LDP1    B$JIT$
        19 015656   040100 100500                    MLR     fill='040'O
        19 015657   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
        19 015660   000127 000010                    ADSC9   87,,PR0                  cn=0,n=8
        19 015661   040100 100500                    MLR     fill='040'O
        19 015662   100003 000014                    ADSC9   3,,PR1                   cn=0,n=12
        19 015663   000131 000014                    ADSC9   89,,PR0                  cn=0,n=12

     4615    31455                            %INIT_STR (CODE=E_MAIL_SETUP, STR=VM_MAIL_SETUP, TEST=YES);

  31462 19 015664   040000 106400                    CMPC    fill='040'O
        19 015665   005073 200377 11                 ADSC9   VM_MAIL_SETUP            cn=1,n=255
        19 015666   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 015667   015674 601000 19                 TNZ     s:31478

  31464 19 015670   000177 630400 20                 EPPR0   127
        19 015671   000000 631400 20                 EPPR1   0
        19 015672   000000 701000 xent               TSX1    VMD$ERRMSG
        19 015673   000000 011000                    NOP     0

     4616    31478    6                       VM_PROFILE.SETUP.COUNT = VM_MAIL_SETUP.L#;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:703  
  31478 19 015674   000000 470400 xsym               LDP0    VM_PROFILE$
        19 015675   005073 236000 11                 LDQ     VM_MAIL_SETUP
        19 015676   000013 552140                    STBQ    11,'40'O,PR0

     4617    31479    6                       VM_PROFILE.SETUP.TEXT = VM_MAIL_SETUP.NAME#;

  31479 19 015677   040100 100400                    MLR     fill='040'O
        19 015700   005073 200377 11                 ADSC9   VM_MAIL_SETUP            cn=1,n=255
        19 015701   000013 200400                    ADSC9   11,,PR0                  cn=1,n=256

     4618    31480    6                       CALL VMD$PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(E_PMME);

  31480 19 015702   000053 630400 20                 EPPR0   43
        19 015703   000024 631400 20                 EPPR1   20
        19 015704   000000 701000 xent               TSX1    VMD$PUT_PROFILE
        19 015705   016514 702000 19                 TSX2    E_PMME

     4619    31481        /*
     4620    31482             ***** Close the file so that it will be cataloged.
     4621    31483        */
     4622    31484    6                       CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;

  31484 19 015706   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 015707   002142 740000 11                 STX0    CLOSE_SAVE+26

     4623    31485    6                       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  31485 19 015710   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 015711   450001 713400                    CLIMB   alt,close
        19 015712   406000 401760                    pmme    nvectors=13
        19 015713   016514 702000 19                 TSX2    E_PMME

     4624    31486    6                       VM_CURRENT_FOLDER.FLAGS.OPEN = %NO#;

  31486 19 015714   000054 236000 20                 LDQ     44
        19 015715   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:704  
     4625    31487    6                       CALL CLOSE_SEARCH;

  31487 19 015716   016625 701000 19                 TSX1    CLOSE_SEARCH
        19 015717   000000 011000                    NOP     0

     4626    31488    6                       CALL VMB$USE_DEFAULT (,USER_NAME,VM_CURRENT_FOLDER,

  31488 19 015720   000050 236000 20                 LDQ     40
        19 015721   201714 756100                    STQ     I+106,,AUTO
        19 015722   000022 236000 20                 LDQ     18
        19 015723   000042 235000 20                 LDA     34
        19 015724   201712 757100                    STAQ    I+104,,AUTO
        19 015725   000052 237000 20                 LDAQ    42
        19 015726   201710 757100                    STAQ    I+102,,AUTO
        19 015727   000034 236000 20                 LDQ     28
        19 015730   000022 235000 20                 LDA     18
        19 015731   201706 757100                    STAQ    I+100,,AUTO
        19 015732   201706 630500                    EPPR0   I+100,,AUTO
        19 015733   000046 631400 20                 EPPR1   38
        19 015734   000000 701000 xent               TSX1    VMB$USE_DEFAULT
        19 015735   016363 702000 19                 TSX2    NO_FOLD_ERR

     4627    31489    6                         M$MAIL_FILE_NUM,VM_SEARCH_INFO,,'1'B) ALTRET(NO_FOLD_ERR);
     4628    31490    6                       WORK_STRING.L#=SIZEC(WORK_STRING.NAME#);

  31490 19 015736   777000 236003                    LDQ     -512,DU
        19 015737   000174 552040 11                 STBQ    WORK_STRING,'40'O

     4629    31491    6                       CALL GET_FOLDERNAME (VM_CURRENT_FOLDER);

  31491 19 015740   000052 236000 20                 LDQ     42
        19 015741   201123 756100                    STQ     LEN+1,,AUTO
        19 015742   017064 701000 19                 TSX1    GET_FOLDERNAME
        19 015743   000000 011000                    NOP     0

     4630    31492    6                      CALL XUR$INFOMSG(E_USING_MSG_FMT,,M$ME_NUM,VECTOR(WORK_STRING));

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:705  
  31492 19 015744   000174 237000 20                 LDAQ    124
        19 015745   201710 757100                    STAQ    I+102,,AUTO
        19 015746   000022 236000 20                 LDQ     18
        19 015747   000602 235000 20                 LDA     386
        19 015750   201706 757100                    STAQ    I+100,,AUTO
        19 015751   201706 630500                    EPPR0   I+100,,AUTO
        19 015752   000026 631400 20                 EPPR1   22
        19 015753   000000 701000 xent               TSX1    XUR$INFOMSG
        19 015754   000000 011000                    NOP     0

     4631    31493    6                   END;  /* else registered */

  31493 19 015755   016027 710000 19                 TRA     s:31512

     4632    31494
     4633    31495    6                   whenaltreturn do;

     4634    31496                            /*  If user is not registered...  */
     4635    31497
     4636    31498    6                       IF B$JIT.ACCN = SUBSTR(USER_NAME.NAME#,1,8) THEN GOTO
             31498                                NO_FOLD_ERR;

  31498 19 015756   000000 470400 xsym               LDP0    B$JIT$
        19 015757   040000 106500                    CMPC    fill='040'O
        19 015760   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        19 015761   004427 400010 11                 ADSC9   USER_NAME                cn=2,n=8
        19 015762   016363 600000 19                 TZE     NO_FOLD_ERR

     4637    31499                       /* Try his logon account */
     4638    31500    6                       USER_NAME.L# = LENGTHC(B$JIT.ACCN) + 1;

  31500 19 015763   011000 236003                    LDQ     4608,DU
        19 015764   004427 552040 11                 STBQ    USER_NAME,'40'O

     4639    31501    6                       SUBSTR(USER_NAME.NAME#,1,8) = B$JIT.ACCN;

  31501 19 015765   040000 100500                    MLR     fill='040'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:706  
        19 015766   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        19 015767   004427 400010 11                 ADSC9   USER_NAME                cn=2,n=8

     4640    31502    6                       substr(USER_NAME.NAME#,,1) = '.';

  31502 19 015770   000056 236003                    LDQ     46,DU
        19 015771   004427 552020 11                 STBQ    USER_NAME,'20'O

     4641    31503    6                       CALL VMB$USE_DEFAULT (,USER_NAME,VM_CURRENT_FOLDER,
             31503                                M$MAIL_FILE_NUM,VM_SEARCH_INFO,,'1'B)

  31503 19 015772   000050 236000 20                 LDQ     40
        19 015773   201714 756100                    STQ     I+106,,AUTO
        19 015774   000022 236000 20                 LDQ     18
        19 015775   000042 235000 20                 LDA     34
        19 015776   201712 757100                    STAQ    I+104,,AUTO
        19 015777   000052 237000 20                 LDAQ    42
        19 016000   201710 757100                    STAQ    I+102,,AUTO
        19 016001   000034 236000 20                 LDQ     28
        19 016002   000022 235000 20                 LDA     18
        19 016003   201706 757100                    STAQ    I+100,,AUTO
        19 016004   201706 630500                    EPPR0   I+100,,AUTO
        19 016005   000046 631400 20                 EPPR1   38
        19 016006   000000 701000 xent               TSX1    VMB$USE_DEFAULT
        19 016007   016363 702000 19                 TSX2    NO_FOLD_ERR

     4642    31504    6                         ALTRET(NO_FOLD_ERR);
     4643    31505    6                       WORK_STRING.L#=SIZEC(WORK_STRING.NAME#);

  31505 19 016010   777000 236003                    LDQ     -512,DU
        19 016011   000174 552040 11                 STBQ    WORK_STRING,'40'O

     4644    31506    6                       CALL GET_FOLDERNAME (VM_CURRENT_FOLDER);

  31506 19 016012   000052 236000 20                 LDQ     42
        19 016013   201123 756100                    STQ     LEN+1,,AUTO
        19 016014   017064 701000 19                 TSX1    GET_FOLDERNAME
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:707  
        19 016015   000000 011000                    NOP     0

     4645    31507    6                      call XUR$INFOMSG(E_USING_MSG_FMT,,M$ME_NUM,vector(WORK_STRING));

  31507 19 016016   000174 237000 20                 LDAQ    124
        19 016017   201710 757100                    STAQ    I+102,,AUTO
        19 016020   000022 236000 20                 LDQ     18
        19 016021   000602 235000 20                 LDA     386
        19 016022   201706 757100                    STAQ    I+100,,AUTO
        19 016023   201706 630500                    EPPR0   I+100,,AUTO
        19 016024   000026 631400 20                 EPPR1   22
        19 016025   000000 701000 xent               TSX1    XUR$INFOMSG
        19 016026   000000 011000                    NOP     0

     4646    31508    6                   end;

     4647    31509    5               END;             /* whenaltreturn */

     4648    31510
     4649    31511    4           END;

     4650    31512    3           IF VM_CURRENT_FOLDER.FLAGS.UPDATE = %NO#

  31512 19 016027   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 016030   016074 604000 19                 TMI     s:31533

     4651    31513    3           THEN
     4652    31514    4           DO;

     4653    31515
     4654    31516        /*E* ERROR: VMO-E$NOUPDATE-0
     4655    31517             MESSAGE: Mailbox open read only.
     4656    31518             */
     4657    31519    5               CALL M$ENQ (FILE_SHARE) WHENALTRETURN DO;

  31519 19 016031   000304 630400 12                 EPPR0   FILE_SHARE
        19 016032   420002 713400                    CLIMB   alt,+8194
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:708  
        19 016033   401000 401760                    pmme    nvectors=3
        19 016034   016036 702000 19                 TSX2    FOLD_BUSY
        19 016035   016067 710000 19                 TRA     s:31530

     4658    31520    5   FOLD_BUSY:
     4659    31521    5                   CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;

  31521 19 016036   000000 720000 xsym  FOLD_BUSY    LXL0    M$MAIL_FILE_NUM
        19 016037   002142 740000 11                 STX0    CLOSE_SAVE+26

     4660    31522    5                   CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  31522 19 016040   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 016041   450001 713400                    CLIMB   alt,close
        19 016042   406000 401760                    pmme    nvectors=13
        19 016043   016514 702000 19                 TSX2    E_PMME

     4661    31523    5                   VM_CURRENT_FOLDER.FLAGS.OPEN = %NO#;

  31523 19 016044   000054 236000 20                 LDQ     44
        19 016045   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     4662    31524        /**/
     4663    31525    5                   WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);

  31525 19 016046   777000 236003                    LDQ     -512,DU
        19 016047   000174 552040 11                 STBQ    WORK_STRING,'40'O

     4664    31526    5                   CALL GET_FOLDERNAME (VM_CURRENT_FOLDER);

  31526 19 016050   000052 236000 20                 LDQ     42
        19 016051   201123 756100                    STQ     LEN+1,,AUTO
        19 016052   017064 701000 19                 TSX1    GET_FOLDERNAME
        19 016053   000000 011000                    NOP     0

     4665    31527    5                   CALL XUR$ERRMSG (E_FOLDERBUSY,,,VECTOR(WORK_STRING));

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:709  
  31527 19 016054   000175 236000 20                 LDQ     125
        19 016055   000022 235000 20                 LDA     18
        19 016056   201710 757100                    STAQ    I+102,,AUTO
        19 016057   000022 236000 20                 LDQ     18
        19 016060   000603 235000 20                 LDA     387
        19 016061   201706 757100                    STAQ    I+100,,AUTO
        19 016062   201706 630500                    EPPR0   I+100,,AUTO
        19 016063   000026 631400 20                 EPPR1   22
        19 016064   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016065   000000 011000                    NOP     0

     4666    31528    5                   GOTO NO_FOLD;

  31528 19 016066   016376 710000 19                 TRA     NO_FOLD

     4667    31529    5               END;
     4668    31530    4               CALL XUR$ERRMSG(E_NOUPDATE);

  31530 19 016067   000604 630400 20                 EPPR0   388
        19 016070   000024 631400 20                 EPPR1   20
        19 016071   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016072   000000 011000                    NOP     0

     4669    31531    4           END;

  31531 19 016073   016115 710000 19                 TRA     s:31547

     4670    31532    4           ELSE DO;                   /* Enq and see what we can get */

     4671    31533    5               CALL M$ENQ (FILE_NONE) WHENALTRETURN DO;

  31533 19 016074   000316 630400 12                 EPPR0   FILE_NONE
        19 016075   420002 713400                    CLIMB   alt,+8194
        19 016076   401000 401760                    pmme    nvectors=3
        19 016077   016101 702000 19                 TSX2    s:31534
        19 016100   016115 710000 19                 TRA     s:31547

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:710  
     4672    31534    5                   CALL M$ENQ (FILE_SHARE)

  31534 19 016101   000304 630400 12                 EPPR0   FILE_SHARE
        19 016102   420002 713400                    CLIMB   alt,+8194
        19 016103   401000 401760                    pmme    nvectors=3
        19 016104   016114 702000 19                 TSX2    s:31540

     4673    31535    6                   WHENRETURN DO;

     4674    31536    6                       VM_CURRENT_FOLDER.FLAGS.UPDATE= %NO#;

  31536 19 016105   000516 236000 20                 LDQ     334
        19 016106   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     4675    31537    6                       CALL XUR$ERRMSG(E_NOUPDATE);

  31537 19 016107   000604 630400 20                 EPPR0   388
        19 016110   000024 631400 20                 EPPR1   20
        19 016111   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016112   000000 011000                    NOP     0

     4676    31538    6                   END;

  31538 19 016113   016115 710000 19                 TRA     s:31547

     4677    31539    6                   WHENALTRETURN DO;

     4678    31540    6                       GOTO FOLD_BUSY;

  31540 19 016114   016036 710000 19                 TRA     FOLD_BUSY

     4679    31541    6                   END;
     4680    31542    5               END;

     4681    31543    4           END;

     4682    31544        /*
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:711  
     4683    31545             ***** Get the profile ...
     4684    31546        */
     4685    31547    3           CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(NO_PROFILE);

  31547 19 016115   000053 630400 20                 EPPR0   43
        19 016116   000024 631400 20                 EPPR1   20
        19 016117   000000 701000 xent               TSX1    VMD$GET_PROFILE
        19 016120   016330 702000 19                 TSX2    NO_PROFILE

     4686    31548    3           VM_RADDRESS.NOMAD.FOLDER = VM_CURRENT_FOLDER.FOLDER;

  31548 19 016121   040100 100400                    MLR     fill='040'O
        19 016122   001246 400022 11                 ADSC9   VM_CURRENT_FOLDER+3      cn=2,n=18
        19 016123   200760 400022                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=18

     4687    31549    3           IF VM_PROFILE.FILE_FOLDER$ ~= ADDR(NIL)

  31549 19 016124   000000 470400 xsym               LDP0    VM_PROFILE$
        19 016125   000114 236100                    LDQ     76,,PR0
        19 016126   000022 116000 20                 CMPQ    18
        19 016127   016150 600000 19                 TZE     s:31563
        19 016130   000114 471500                    LDP1    76,,PR0
        19 016131   040000 106500                    CMPC    fill='040'O
        19 016132   100007 400031                    ADSC9   7,,PR1                   cn=2,n=25
        19 016133   001360 000007 12                 ADSC9   VM_PROKEY+3              cn=0,n=7
        19 016134   016150 601000 19                 TNZ     s:31563
        19 016135   000000 473400 xsym               LDP3    B$JIT$
        19 016136   040100 106500                    CMPC    fill='040'O
        19 016137   100021 600010                    ADSC9   17,,PR1                  cn=3,n=8
        19 016140   300001 000010                    ADSC9   1,,PR3                   cn=0,n=8
        19 016141   016150 601000 19                 TNZ     s:31563

     4688    31550    3             AND (VM_PROFILE.FILE_FOLDER$->VM$RADDRESS.FOLDER='CENTRAL')
     4689    31551    3             AND (VM_PROFILE.FILE_FOLDER$->VM$RADDRESS.ACCT=B$JIT.ACCN)
     4690    31552    4           THEN DO;

     4691    31553    4               VM_PROFILE.FILE_FOLDER$ = ADDR(NIL);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:712  

  31553 19 016142   000022 236000 20                 LDQ     18
        19 016143   000114 756100                    STQ     76,,PR0

     4692    31554    4               CALL VMD$PUT_PROFILE(M$MAIL_FILE_NUM);

  31554 19 016144   000053 630400 20                 EPPR0   43
        19 016145   000024 631400 20                 EPPR1   20
        19 016146   000000 701000 xent               TSX1    VMD$PUT_PROFILE
        19 016147   000000 011000                    NOP     0

     4693    31555    4           END;

     4694    31556        /*
     4695    31557           Put code here to check for incompatibilities between versions of MAIL
     4696    31558           that require extensive fixup.  There was code here up through A02 to
     4697    31559           disallow access to mail folders whose version code was not 'A00'
     4698    31560           (and therefore were built by the pre-release 'B03' MAIL.X);  code
     4699    31561           removed 3/12/86 by dcp to permit use of B00 as an official version number.
     4700    31562        */
     4701    31563    4           IF NOT REOPENED_FOLDER THEN DO;

  31563 19 016150   000405 234000 11                 SZN     REOPENED_FOLDER
        19 016151   016327 604000 19                 TMI     s:31661

     4702    31564        /*
     4703    31565             ***** If the folder is full, then notify the user ...
     4704    31566        */
     4705    31567    4               IF VM_PROFILE.GRANULES > 0

  31567 19 016152   000000 470400 xsym               LDP0    VM_PROFILE$
        19 016153   000012 235100                    LDA     10,,PR0
        19 016154   016221 600000 19                 TZE     s:31601
        19 016155   000012 236100                    LDQ     10,,PR0
        19 016156   001265 136000 11                 SBLQ    VM_CURRENT_FOLDER+18
        19 016157   016221 605400 19                 TPNZ    s:31601

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:713  
     4706    31568    4                 AND VM_PROFILE.GRANULES - VM_CURRENT_FOLDER.UGRANS <=0
     4707    31569    4               THEN            /* Report full!!! */
     4708    31570    5               DO;

     4709    31571    5                   WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);

  31571 19 016160   777000 236003                    LDQ     -512,DU
        19 016161   000174 552040 11                 STBQ    WORK_STRING,'40'O

     4710    31572    5                   CALL VMF$MAKE_ADDRESS1 (WORK_STRING,VM_CURRENT_FOLDER);

  31572 19 016162   000051 630400 20                 EPPR0   41
        19 016163   000000 631400 20                 EPPR1   0
        19 016164   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS1
        19 016165   000000 011000                    NOP     0

     4711    31573    5                   VECT_ARRAY(0) = VECTOR(SUBSTR(WORK_STRING.NAME#,0,WORK_STRING.L#));

  31573 19 016166   000174 236000 11                 LDQ     WORK_STRING
        19 016167   000033 772000                    QRL     27
        19 016170   000064 737000                    LLS     52
        19 016171   000140 135007                    SBLA    96,DL
        19 016172   000317 236000 20                 LDQ     207
        19 016173   003076 757000 11                 STAQ    VECT_ARRAY

     4712    31574    5                   F_FDSME.NVECS# = 1;

  31574 19 016174   000001 235007                    LDA     1,DL
        19 016175   002755 755000 11                 STA     F_FDSME+9

     4713    31575                        %INIT_STR (CODE=E_USE_FULL_FMT, STR=VM_USE_FULL_FMT,
     4714    31576                        VECT="F_FDSME.FMT_", TEST=YES);

  31583 19 016176   040000 106400                    CMPC    fill='040'O
        19 016177   004330 200120 11                 ADSC9   VM_USE_FULL_FMT          cn=1,n=80
        19 016200   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 016201   016207 601000 19                 TNZ     s:31588
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:714  

  31585 19 016202   000605 630400 20                 EPPR0   389
        19 016203   000021 631400 20                 EPPR1   17
        19 016204   000000 701000 xent               TSX1    VMD$ERRMSG
        19 016205   000000 011000                    NOP     0

  31586 19 016206   016215 710000 19                 TRA     s:31599

  31588 19 016207   004330 236000 11                 LDQ     VM_USE_FULL_FMT
        19 016210   000033 772000                    QRL     27
        19 016211   000064 737000                    LLS     52
        19 016212   000140 135007                    SBLA    96,DL
        19 016213   000610 236000 20                 LDQ     392
        19 016214   002744 757000 11                 STAQ    F_FDSME

     4715    31599    5                   CALL VMD$WRITE_BUF (F_FDSME);

  31599 19 016215   000065 630400 20                 EPPR0   53
        19 016216   000024 631400 20                 EPPR1   20
        19 016217   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 016220   000000 011000                    NOP     0

     4716    31600    5               END;

     4717    31601    4               IF VM_PROFILE.NUM_LOST > 0

  31601 19 016221   000000 470400 xsym               LDP0    VM_PROFILE$
        19 016222   000141 235100                    LDA     97,,PR0
        19 016223   016257 600000 19                 TZE     s:31635
        19 016224   000556 115000 20                 CMPA    366
        19 016225   016257 603000 19                 TRC     s:31635

     4718    31602    4                AND VM_PROFILE.NUM_LOST < %MAX_MSGNO /* for pre-B03 readonly folder */
     4719    31603    5               THEN DO;

     4720    31604                        %INIT_STR (CODE=E_USE_LOST_FMT, STR=VM_USE_LOST_FMT,
     4721    31605                        VECT="F_FDSME.FMT_", TEST=YES);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:715  

  31612 19 016226   040000 106400                    CMPC    fill='040'O
        19 016227   004355 200120 11                 ADSC9   VM_USE_LOST_FMT          cn=1,n=80
        19 016230   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 016231   016237 601000 19                 TNZ     s:31617

  31614 19 016232   000611 630400 20                 EPPR0   393
        19 016233   000021 631400 20                 EPPR1   17
        19 016234   000000 701000 xent               TSX1    VMD$ERRMSG
        19 016235   000000 011000                    NOP     0

  31615 19 016236   016245 710000 19                 TRA     s:31628

  31617 19 016237   004355 236000 11                 LDQ     VM_USE_LOST_FMT
        19 016240   000033 772000                    QRL     27
        19 016241   000064 737000                    LLS     52
        19 016242   000140 135007                    SBLA    96,DL
        19 016243   000614 236000 20                 LDQ     396
        19 016244   002744 757000 11                 STAQ    F_FDSME

     4722    31628    5                   F_FDSME.NVECS# = 1;

  31628 19 016245   000001 235007                    LDA     1,DL
        19 016246   002755 755000 11                 STA     F_FDSME+9

     4723    31629    5                   VECT_ARRAY(0) = VECTOR (VM_PROFILE.NUM_LOST);

  31629 19 016247   777640 235007                    LDA     -96,DL
        19 016250   000000 236000 xsym               LDQ     VM_PROFILE$
        19 016251   000141 036003                    ADLQ    97,DU
        19 016252   003076 757000 11                 STAQ    VECT_ARRAY

     4724    31630    5                   CALL VMD$WRITE_BUF (F_FDSME);

  31630 19 016253   000065 630400 20                 EPPR0   53
        19 016254   000024 631400 20                 EPPR1   20
        19 016255   000000 701000 xent               TSX1    VMD$WRITE_BUF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:716  
        19 016256   000000 011000                    NOP     0

     4725    31631    5               END;

     4726    31632        /*
     4727    31633             ***** Reinitialize the selection contexts ...
     4728    31634        */
     4729    31635    4               CALL INIT_CONTEXT (%CONTEXT_CURRENT);

  31635 19 016257   000066 236000 20                 LDQ     54
        19 016260   201123 756100                    STQ     LEN+1,,AUTO
        19 016261   017442 701000 19                 TSX1    INIT_CONTEXT
        19 016262   000000 011000                    NOP     0

     4730    31636    4               CALL INIT_CONTEXT (%CONTEXT_SELECTED);

  31636 19 016263   000043 236000 20                 LDQ     35
        19 016264   201123 756100                    STQ     LEN+1,,AUTO
        19 016265   017442 701000 19                 TSX1    INIT_CONTEXT
        19 016266   000000 011000                    NOP     0

     4731    31637    4               IF VM_PROFILE.NUM_MESSAGES = 0

  31637 19 016267   000000 470400 xsym               LDP0    VM_PROFILE$
        19 016270   000005 235100                    LDA     5,,PR0
        19 016271   016275 601000 19                 TNZ     s:31643

     4732    31638    5               THEN DO;

     4733    31639    5                   SELECTED_CONTEXT%.NUM_ENTRIES = 0;

  31639 19 016272   001664 471400 11                 LDP1    CONTEXT_PTR$+1
        19 016273   100002 450100                    STZ     2,,PR1

     4734    31640    5               END;

  31640 19 016274   016307 710000 19                 TRA     s:31649
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:717  

     4735    31641    4               ELSE
     4736    31642    5               DO;         /* Messages in this folder to process */

     4737    31643    5                   SELECTED_CONTEXT%.MESSAGE_SET.LOW(0) = 1;

  31643 19 016275   000001 236007                    LDQ     1,DL
        19 016276   001664 471400 11                 LDP1    CONTEXT_PTR$+1
        19 016277   100005 756100                    STQ     5,,PR1

     4738    31644    5                   SELECTED_CONTEXT%.MESSAGE_SET.HIGH(0) = %MAX_MSGNO;

  31644 19 016300   000556 235000 20                 LDA     366
        19 016301   100006 755100                    STA     6,,PR1

     4739    31645    5                   SELECTED_CONTEXT%.NUM_ENTRIES = 1;

  31645 19 016302   100002 756100                    STQ     2,,PR1

     4740    31646    5                   SELECT_CURRENT = '1'B;

  31646 19 016303   400000 236003                    LDQ     -131072,DU
        19 016304   000403 756000 11                 STQ     SELECT_CURRENT

     4741    31647    5                   SELECTED_CONTEXT%.MESSAGE_POINTER = -1;

  31647 19 016305   000001 335007                    LCA     1,DL
        19 016306   100000 755100                    STA     0,,PR1

     4742    31648    5               END;

     4743    31649    4               NUM_MESSAGES_PROCESSED = 0; /* How many in this folder */

  31649 19 016307   201101 450100                    STZ     NUM_MESSAGES_PROCESSED,,AUTO

     4744    31650        /*
     4745    31651             ***** Get the setup command out of the profile.
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:718  
     4746    31652                   Unless, bypass was specified...
     4747    31653        */
     4748    31654    4               IF OPT_BYPASS = %NO#

  31654 19 016310   201105 234100                    SZN     OPT_BYPASS,,AUTO
        19 016311   016327 604000 19                 TMI     s:31661

     4749    31655    4               THEN
     4750    31656    5               DO;

     4751    31657    5                   NEXT_COMMAND_TEXT = VM_PROFILE.SETUP;

  31657 19 016312   000100 100500                    MLR     fill='000'O
        19 016313   000013 000401                    ADSC9   11,,PR0                  cn=0,n=257
        19 016314   200551 001000                    ADSC9   NEXT_COMMAND_TEXT,,AUTO  cn=0,n=512

     4752    31658    5                   IF (NEXT_COMMAND_TEXT.L# ~= 0) AND (B$JIT.CPFLAGS1 AND %CP_ECHO#)
             31658                            THEN NEXT_COMMAND_ECHO# = %YES#;

  31658 19 016315   200551 236100                    LDQ     NEXT_COMMAND_TEXT,,AUTO
        19 016316   777000 316003                    CANQ    -512,DU
        19 016317   016327 600000 19                 TZE     s:31661
        19 016320   000000 473400 xsym               LDP3    B$JIT$
        19 016321   300143 235100                    LDA     99,,PR3
        19 016322   016327 600000 19                 TZE     s:31661
        19 016323   001375 235000 12                 LDA     VM_PROKEY+16
        19 016324   016327 600000 19                 TZE     s:31661

  31658 19 016325   400000 236003                    LDQ     -131072,DU
        19 016326   000542 756000 11                 STQ     NEXT_COMMAND_ECHO#

     4753    31659    5               END;

     4754    31660    4           END;                  /* Not reopened */

     4755    31661    4           DO NEVER;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:719  
  31661 19 016327   016417 710000 19                 TRA     s:31686

     4756    31662    4   NO_PROFILE:
     4757    31663    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  31663 19 016330   000000 470400 xsym  NO_PROFILE   LDP0    B$TCB$
        19 016331   000000 471500                    LDP1    0,,PR0
        19 016332   100102 236100                    LDQ     66,,PR1
        19 016333   002204 756000 11                 STQ     ERROR

     4758    31664    4               CALL XUR$ERRMSG(E_FOLDEROLD,B$TCB.ALT$->B$ALT.DCB#);

  31664 19 016334   000000 471500                    LDP1    0,,PR0
        19 016335   100101 633500                    EPPR3   65,,PR1
        19 016336   201707 453500                    STP3    I+101,,AUTO
        19 016337   000157 236000 20                 LDQ     111
        19 016340   201706 756100                    STQ     I+100,,AUTO
        19 016341   201706 630500                    EPPR0   I+100,,AUTO
        19 016342   000000 631400 20                 EPPR1   0
        19 016343   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016344   000000 011000                    NOP     0

     4759    31665    4               CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);

  31665 19 016345   000377 630400 20                 EPPR0   255
        19 016346   000000 631400 20                 EPPR1   0
        19 016347   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016350   000000 011000                    NOP     0

     4760    31666    4               CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;

  31666 19 016351   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 016352   002142 740000 11                 STX0    CLOSE_SAVE+26

     4761    31667    5               CALL M$CLOSE (CLOSE_SAVE) WHENALTRETURN DO;

  31667 19 016353   002110 630400 11                 EPPR0   CLOSE_SAVE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:720  
        19 016354   450001 713400                    CLIMB   alt,close
        19 016355   406000 401760                    pmme    nvectors=13
        19 016356   016360 702000 19                 TSX2    s:31669
        19 016357   016360 710000 19                 TRA     s:31669

     4762    31668    5               END;

     4763    31669    4               VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B;

  31669 19 016360   000054 236000 20                 LDQ     44
        19 016361   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     4764    31670    4               GOTO NO_FOLD;

  31670 19 016362   016376 710000 19                 TRA     NO_FOLD

     4765    31671    4   NO_FOLD_ERR:
     4766    31672    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  31672 19 016363   000000 470400 xsym  NO_FOLD_ERR  LDP0    B$TCB$
        19 016364   000000 471500                    LDP1    0,,PR0
        19 016365   100102 236100                    LDQ     66,,PR1
        19 016366   002204 756000 11                 STQ     ERROR

     4767    31673    4               DCB# = B$TCB.ALT$ -> B$ALT.DCB#;

  31673 19 016367   000000 471500                    LDP1    0,,PR0
        19 016370   100101 235100                    LDA     65,,PR1
        19 016371   000401 755000 11                 STA     DCB#

     4768    31674    4               CALL XUR$ERRMSG (ERROR,DCB#);

  31674 19 016372   000101 630400 20                 EPPR0   65
        19 016373   000000 631400 20                 EPPR1   0
        19 016374   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016375   000000 011000                    NOP     0

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:721  
     4769    31675    4   NO_FOLD:
     4770    31676    4               CALL XUR$ERRMSG (E_NOCURFOLD);

  31676 19 016376   000252 630400 20    NO_FOLD      EPPR0   170
        19 016377   000024 631400 20                 EPPR1   20
        19 016400   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016401   000000 011000                    NOP     0

     4771    31677    4               VM_SEARCH_INFO.ACTIVE = '0'B;

  31677 19 016402   000516 236000 20                 LDQ     334
        19 016403   001632 356000 11                 ANSQ    VM_SEARCH_INFO+34

     4772    31678    4               VM_SEARCH_INFO.CURRENT= '0'B;

  31678 19 016404   000055 236000 20                 LDQ     45
        19 016405   001632 356000 11                 ANSQ    VM_SEARCH_INFO+34

     4773    31679    5               DO INDX4=0 TO %VM_MAX_SRCH;

  31679 19 016406   200035 450100                    STZ     INDX4,,AUTO

     4774    31680    5                   VM_PROFILE.SEARCH_LIST$(INDX4) = ADDR(NIL);

  31680 19 016407   000022 236000 20                 LDQ     18
        19 016410   000000 470400 xsym               LDP0    VM_PROFILE$
        19 016411   200035 720100                    LXL0    INDX4,,AUTO
        19 016412   000115 756110                    STQ     77,X0,PR0

     4775    31681    5               END;

  31681 19 016413   200035 054100                    AOS     INDX4,,AUTO
        19 016414   200035 235100                    LDA     INDX4,,AUTO
        19 016415   000004 115007                    CMPA    4,DL
        19 016416   016407 604400 19                 TMOZ    s:31680

     4776    31682    4           END;                       /* Do never */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:722  

     4777    31683        /*
     4778    31684             ***** Enable breaks again ...
     4779    31685        */
     4780    31686    3           CALL XUR$ENABLE;

  31686 19 016417   000020 631400 20                 EPPR1   16
        19 016420   000000 701000 xent               TSX1    XUR$ENABLE
        19 016421   000000 011000                    NOP     0
        19 016422   016452 710000 19                 TRA     CONTINUE

     4781    31687        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:723  
     4782    31688        /* Wait command */
     4783    31689    3       CASE (%CMD_WAIT);

     4784    31690    3           CALL NEED_FOLDER ALTRET(CONTINUE);

  31690 19 016423   016547 701000 19                 TSX1    NEED_FOLDER
        19 016424   016452 702000 19                 TSX2    CONTINUE

     4785    31691    4           DO FOREVER;

     4786    31692    4               CALL CHECK_NEW (M$MAIL_FILE_NUM);

  31692 19 016425   000053 236000 20                 LDQ     43
        19 016426   201523 756100                    STQ     INDX2+255,,AUTO
        19 016427   021327 701000 19                 TSX1    CHECK_NEW
        19 016430   000000 011000                    NOP     0

     4787    31693    4               IF NEW_FLAG THEN EXIT;

  31693 19 016431   000377 234000 11                 SZN     NEW_FLAG
        19 016432   016440 604000 19                 TMI     s:31700

     4788    31694    4               CALL M$WAIT (WAIT30);

  31694 19 016433   000262 630400 12                 EPPR0   WAIT30
        19 016434   020006 713400                    CLIMB   8198
        19 016435   400400 401760                    pmme    nvectors=2

     4789    31695    4               NEW_FLAG='0'B;

  31695 19 016436   000377 450000 11                 STZ     NEW_FLAG

     4790    31696    4           END;                       /* Do forever  (until new message) */

  31696 19 016437   016425 710000 19                 TRA     s:31692

     4791    31697        /*
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:724  
     4792    31698             ***** Notify the user that new messages have been delivered ...
     4793    31699        */
     4794    31700    3           CALL XUR$INFOMSG (E_NEW_MESSAGE_FMT,,M$ME_NUM);

  31700 19 016440   000033 236000 20                 LDQ     27
        19 016441   201710 756100                    STQ     I+102,,AUTO
        19 016442   000022 236000 20                 LDQ     18
        19 016443   000073 235000 20                 LDA     59
        19 016444   201706 757100                    STAQ    I+100,,AUTO
        19 016445   201706 630500                    EPPR0   I+100,,AUTO
        19 016446   000021 631400 20                 EPPR1   17
        19 016447   000000 701000 xent               TSX1    XUR$INFOMSG
        19 016450   000000 011000                    NOP     0

     4795    31701    3           NEW_FLAG = %NO#;

  31701 19 016451   000377 450000 11                 STZ     NEW_FLAG

     4796    31702        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:725  
     4797    31703    3       END;                             /* End cases */

  31701 19 016452                       CONTINUE     null
     4798    31704    2   CONTINUE: ;
     4799    31705    2       RETURN;

  31705 19 016452   201114 221300                    LDX1  ! DELETE_ENCL_FLAG+1,,AUTO
        19 016453   000001 702211                    TSX2  ! 1,X1

     4800    31706
     4801    31707
     4802    31708        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:726  
     4803    31709    2   BAD_PROFILE:
     4804    31710    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  31710 19 016454   000000 470400 xsym  BAD_PROFILE  LDP0    B$TCB$
        19 016455   000000 471500                    LDP1    0,,PR0
        19 016456   100102 236100                    LDQ     66,,PR1
        19 016457   002204 756000 11                 STQ     ERROR

     4805    31711    2       CALL XUR$ERRMSG(E_FOLDEROLD,B$TCB.ALT$->B$ALT.DCB#);

  31711 19 016460   000000 471500                    LDP1    0,,PR0
        19 016461   100101 633500                    EPPR3   65,,PR1
        19 016462   201707 453500                    STP3    I+101,,AUTO
        19 016463   000157 236000 20                 LDQ     111
        19 016464   201706 756100                    STQ     I+100,,AUTO
        19 016465   201706 630500                    EPPR0   I+100,,AUTO
        19 016466   000000 631400 20                 EPPR1   0
        19 016467   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016470   000000 011000                    NOP     0

     4806    31712    2       CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);

  31712 19 016471   000377 630400 20                 EPPR0   255
        19 016472   000000 631400 20                 EPPR1   0
        19 016473   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016474   000000 011000                    NOP     0

     4807    31713    2       CALL M$EXIT;

  31713 19 016475   000001 713400                    CLIMB   exit
        19 016476   000000 401760                    pmme    nvectors=0

  31701 19 016477                       WRITE_ERROR  null
     4808    31714    2   WRITE_ERROR: ;
     4809    31715        /*E* ERROR: VMO-E$WERR-4
     4810    31716             MESSAGE: Error occurred while writing the mail file
     4811    31717             DESCRIPTION: While attempting to write to the mail file
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:727  
     4812    31718                            a monitor error was encountered
     4813    31719              */
     4814    31720    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  31720 19 016477   000000 470400 xsym               LDP0    B$TCB$
        19 016500   000000 471500                    LDP1    0,,PR0
        19 016501   100102 236100                    LDQ     66,,PR1
        19 016502   002204 756000 11                 STQ     ERROR

     4815    31721    2       CALL XUR$ERRMSG(E_WERR);

  31721 19 016503   000376 630400 20                 EPPR0   254
        19 016504   000024 631400 20                 EPPR1   20
        19 016505   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016506   000000 011000                    NOP     0

     4816    31722    2       CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);

  31722 19 016507   000377 630400 20                 EPPR0   255
        19 016510   000000 631400 20                 EPPR1   0
        19 016511   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016512   000000 011000                    NOP     0

     4817    31723    2       GOTO CONTINUE;

  31723 19 016513   016452 710000 19                 TRA     CONTINUE

     4818    31724
     4819    31725        /**/
     4820    31726    2   E_PMME:
     4821    31727    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  31727 19 016514   000000 470400 xsym  E_PMME       LDP0    B$TCB$
        19 016515   000000 471500                    LDP1    0,,PR0
        19 016516   100102 236100                    LDQ     66,,PR1
        19 016517   002204 756000 11                 STQ     ERROR

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:728  
     4822    31728    2       DCB# = B$TCB.ALT$ -> B$ALT.DCB#;

  31728 19 016520   000000 471500                    LDP1    0,,PR0
        19 016521   100101 235100                    LDA     65,,PR1
        19 016522   000401 755000 11                 STA     DCB#

     4823    31729    2       CALL XUR$ERRMSG (ERROR,DCB#);

  31729 19 016523   000101 630400 20                 EPPR0   65
        19 016524   000000 631400 20                 EPPR1   0
        19 016525   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016526   000000 011000                    NOP     0

     4824    31730    2       CALL XUR$ENABLE;

  31730 19 016527   000020 631400 20                 EPPR1   16
        19 016530   000000 701000 xent               TSX1    XUR$ENABLE
        19 016531   000000 011000                    NOP     0

     4825    31731    2       DEQ_PROFILE.V.DCB# = ENQ_PROFILE.V.DCB#;

  31731 19 016532   001720 220000 11                 LDX0    ENQ_PROFILE+6
        19 016533   001732 740000 11                 STX0    DEQ_PROFILE+6

     4826    31732    3       CALL M$DEQ (DEQ_PROFILE) WHENALTRETURN DO;

  31732 19 016534   001724 630400 11                 EPPR0   DEQ_PROFILE
        19 016535   420003 713400                    CLIMB   alt,+8195
        19 016536   401000 401760                    pmme    nvectors=3
        19 016537   016541 702000 19                 TSX2    s:31734
        19 016540   016541 710000 19                 TRA     s:31734

     4827    31733    3       END;

     4828    31734    2       GOTO CONTINUE;

  31734 19 016541   016452 710000 19                 TRA     CONTINUE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:729  

     4829    31735        /**/
     4830    31736    2   E_ALLOCATE:
     4831    31737    2       CALL XUR$ERRMSG (X$MCB.ERR);

  31737 19 016542   000615 630400 20    E_ALLOCATE   EPPR0   397
        19 016543   000024 631400 20                 EPPR1   20
        19 016544   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016545   000000 011000                    NOP     0

     4832    31738    2       GOTO CONTINUE;

  31738 19 016546   016452 710000 19                 TRA     CONTINUE

     4833    31739    2   END PROCESS_CMD;
     4834    31740        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:730  
     4835    31741        /********************************************************************/
     4836    31742        /*F*    NAME: NEED_FOLDER, NEED_UPDATE, NEED_GLOBAL
     4837    31743                PURPOSE: To verify that a folder is open, open for update,
     4838    31744                         or open for update to the global mailbox, before
     4839    31745                         executing a command.
     4840    31746        */
     4841    31747        /********************************************************************/
     4842    31748    1   NEED_FOLDER: PROC ALTRET;

  31748 19 016547   201116 741300       NEED_FOLDER  STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     4843    31749    2       IF VM_CURRENT_FOLDER.FLAGS.OPEN THEN RETURN;

  31749 19 016550   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 016551   010000 316003                    CANQ    4096,DU
        19 016552   016554 600000 19                 TZE     NO_FOLDER

  31749 19 016553   000001 702211                    TSX2  ! 1,X1

     4844    31750    2   NO_FOLDER:
     4845    31751    2       CALL XUR$ERRMSG (E_NEEDMID);

  31751 19 016554   000616 630400 20    NO_FOLDER    EPPR0   398
        19 016555   000024 631400 20                 EPPR1   20
        19 016556   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016557   000000 011000                    NOP     0

     4846    31752    2       ALTRETURN;

  31752 19 016560   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 016561   000000 702211                    TSX2  ! 0,X1

     4847    31753        /*E* ERROR: VMO-E$NEEDMID-1
     4848    31754          MESSAGE: That command is not permitted without a folder open.
     4849    31755          MESSAGE1: The USE command must be issued first to open a folder.
     4850    31756        */
     4851    31757    2   NEED_UPDATE: ENTRY ALTRET;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:731  

  31757 19 016562   201116 741300       NEED_UPDATE  STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     4852    31758    2       IF NOT VM_CURRENT_FOLDER.FLAGS.OPEN THEN GOTO NO_FOLDER;

  31758 19 016563   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 016564   010000 316003                    CANQ    4096,DU
        19 016565   016554 600000 19                 TZE     NO_FOLDER

     4853    31759    2       IF VM_CURRENT_FOLDER.FLAGS.UPDATE THEN RETURN;

  31759 19 016566   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 016567   016571 605000 19                 TPL     NO_UPDATE

  31759 19 016570   000001 702211                    TSX2  ! 1,X1

     4854    31760    2   NO_UPDATE:
     4855    31761    2       CALL XUR$ERRMSG (E_NOTALLOW);

  31761 19 016571   000131 630400 20    NO_UPDATE    EPPR0   89
        19 016572   000024 631400 20                 EPPR1   20
        19 016573   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016574   000000 011000                    NOP     0

     4856    31762    2       ALTRETURN;

  31762 19 016575   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 016576   000000 702211                    TSX2  ! 0,X1

     4857    31763        /*E* ERROR: VMO-E$NOTALLOW-0
     4858    31764             MESSAGE: Command not allowed when mailbox open for reading only.
     4859    31765        */
     4860    31766    2   NEED_GLOBAL: ENTRY ALTRET;

  31766 19 016577   201116 741300       NEED_GLOBAL  STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     4861    31767    2       IF NOT VM_CURRENT_FOLDER.FLAGS.OPEN THEN GOTO NO_FOLDER;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:732  

  31767 19 016600   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 016601   010000 316003                    CANQ    4096,DU
        19 016602   016554 600000 19                 TZE     NO_FOLDER

     4862    31768    2       IF NOT VM_CURRENT_FOLDER.FLAGS.UPDATE THEN GOTO NO_UPDATE;

  31768 19 016603   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 016604   016571 605000 19                 TPL     NO_UPDATE

     4863    31769    2       FPT_CORRES.V.DCB1# = M$MAIL_FILE_NUM;

  31769 19 016605   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 016606   002412 740000 11                 STX0    FPT_CORRES+2

     4864    31770    2       FPT_CORRES.V.DCB2# = M$MAIL_GLOBAL_NUM;

  31770 19 016607   000000 722000 xsym               LXL2    M$MAIL_GLOBAL_NUM
        19 016610   002412 442000 11                 SXL2    FPT_CORRES+2

     4865    31771    2       CALL M$CORRES (FPT_CORRES)

  31771 19 016611   002410 630400 11                 EPPR0   FPT_CORRES
        19 016612   460000 713400                    CLIMB   alt,+24576
        19 016613   400000 401760                    pmme    nvectors=1
        19 016614   016623 702000 19                 TSX2    s:31776

     4866    31772    3       WHENRETURN DO;

     4867    31773    3           CALL XUR$ERRMSG (E_NOTMCENTRAL);

  31773 19 016615   000617 630400 20                 EPPR0   399
        19 016616   000024 631400 20                 EPPR1   20
        19 016617   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016620   000000 011000                    NOP     0

     4868    31774    3           ALTRETURN;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:733  

  31774 19 016621   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 016622   000000 702211                    TSX2  ! 0,X1

     4869    31775    3       END;
     4870    31776    2       RETURN;

  31776 19 016623   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 016624   000001 702211                    TSX2  ! 1,X1

     4871    31777        /*E*    ERROR: VMO-E$NOTMCENTRAL-0
     4872    31778                MESSAGE: You cannot create/delete a USER except in .:MAIL/CENTRAL
     4873    31779                MESSAGE1: You are not USEing .:MAIL_CENTRAL
     4874    31780        */
     4875    31781    2   END;
     4876    31782        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:734  
     4877    31783        /*********************************************************************/
     4878    31784        /*F*    NAME:   CLOSE_SEARCH
     4879    31785                PURPOSE: To close all open DCBS in the search list except
     4880    31786                         for the global and current folders.
     4881    31787        */
     4882    31788        /*********************************************************************/
     4883    31789    1   CLOSE_SEARCH: PROC;

  31789 19 016625   201116 741300       CLOSE_SEARCH STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     4884    31790    3       DO INDX4 = 0 TO VM_SEARCH_INFO.NUM_ENTRIES-1;

  31790 19 016626   200035 450100                    STZ     INDX4,,AUTO
        19 016627   016654 710000 19                 TRA     s:31800+1

     4885    31791    3           IF VM_SEARCH_INFO.DCB#(INDX4) ~= M$MAIL_FILE_NUM AND

  31791 19 016630   200035 720100                    LXL0    INDX4,,AUTO
        19 016631   001571 236010 11                 LDQ     VM_SEARCH_INFO+1,X0
        19 016632   000000 116000 xsym               CMPQ    M$MAIL_FILE_NUM
        19 016633   016653 600000 19                 TZE     s:31800
        19 016634   000000 116000 xsym               CMPQ    M$MAIL_GLOBAL_NUM
        19 016635   016653 600000 19                 TZE     s:31800

     4886    31792    3             VM_SEARCH_INFO.DCB#(INDX4) ~= M$MAIL_GLOBAL_NUM
     4887    31793    3           THEN
     4888    31794    3               IF DCBADDR(VM_SEARCH_INFO.DCB#(INDX4))->F$DCB.FCD#

  31794 19 016636   000074 470400 20                 LDP0    60
        19 016637   000000 471500                    LDP1    0,,PR0
        19 016640   001571 721010 11                 LXL1    VM_SEARCH_INFO+1,X0
        19 016641   100000 473511                    LDP3    0,X1,PR1
        19 016642   300031 236100                    LDQ     25,,PR3
        19 016643   020000 316007                    CANQ    8192,DL
        19 016644   016653 600000 19                 TZE     s:31800

     4889    31795    4               THEN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:735  

     4890    31796    4                   CLOSE_SAVE.V.DCB# = VM_SEARCH_INFO.DCB#(INDX4);

  31796 19 016645   002142 741000 11                 STX1    CLOSE_SAVE+26

     4891    31797    5                   CALL M$CLOSE (CLOSE_SAVE) WHENALTRETURN DO;

  31797 19 016646   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 016647   450001 713400                    CLIMB   alt,close
        19 016650   406000 401760                    pmme    nvectors=13
        19 016651   016653 702000 19                 TSX2    s:31800
        19 016652   016653 710000 19                 TRA     s:31800

     4892    31798    5                   END;

     4893    31799    4               END;

     4894    31800    3       END;

  31800 19 016653   200035 054100                    AOS     INDX4,,AUTO
        19 016654   200035 236100                    LDQ     INDX4,,AUTO
        19 016655   016630 604000 19                 TMI     s:31791
        19 016656   001570 116000 11                 CMPQ    VM_SEARCH_INFO
        19 016657   016630 602000 19                 TNC     s:31791

     4895    31801    2       VM_SEARCH_INFO.ACTIVE = '0'B;

  31801 19 016660   000516 236000 20                 LDQ     334
        19 016661   001632 356000 11                 ANSQ    VM_SEARCH_INFO+34

     4896    31802    2   END CLOSE_SEARCH;

  31802 19 016662   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 016663   000001 702211                    TSX2  ! 1,X1

     4897    31803        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:736  
     4898    31804        /*********************************************************************/
     4899    31805        /*F*    NAME:       GET_WILD_FOLDER
     4900    31806                PURPOSE:    To open the next folder which matched wildcard.
     4901    31807                DESCRIPTION: ???
     4902    31808        */
     4903    31809        /*********************************************************************/
     4904    31810    1   GET_WILD_FOLDER: PROC ALTRET;

  31810 19 016664   201116 741300       GET_WILD_FO* STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     4905    31811        /*
     4906    31812             ***** Make sure work DCB isn't left open ...
     4907    31813        */
     4908    31814    2       IF DCBADDR(M$WORK_NUM) -> F$DCB.FCD#

  31814 19 016665   000074 470400 20                 LDP0    60
        19 016666   000000 471500                    LDP1    0,,PR0
        19 016667   000000 720000 xsym               LXL0    M$WORK_NUM
        19 016670   100000 473510                    LDP3    0,X0,PR1
        19 016671   300031 236100                    LDQ     25,,PR3
        19 016672   020000 316007                    CANQ    8192,DL
        19 016673   016702 600000 19                 TZE     s:31822

     4909    31815    3       THEN DO;

     4910    31816    3           CLOSE_SAVE.V.DCB# = M$WORK_NUM;

  31816 19 016674   002142 740000 11                 STX0    CLOSE_SAVE+26

     4911    31817    4           CALL M$CLOSE (CLOSE_SAVE) WHENALTRETURN DO; END;

  31817 19 016675   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 016676   450001 713400                    CLIMB   alt,close
        19 016677   406000 401760                    pmme    nvectors=13
        19 016700   016702 702000 19                 TSX2    s:31822
        19 016701   016702 710000 19                 TRA     s:31822

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:737  
     4912    31818    3       END;

     4913    31819        /*
     4914    31820             ***** Find the next mail folder ...
     4915    31821        */
     4916    31822    3       DO WHILE WILD;

  31822 19 016702   200041 234100                    SZN     WILD,,AUTO
        19 016703   016773 605000 19                 TPL     MATCH_FOUND

     4917    31823    3           CALL M$OPEN (OPEN_NEXT)

  31823 19 016704   002274 630400 11                 EPPR0   OPEN_NEXT
        19 016705   450000 713400                    CLIMB   alt,open
        19 016706   410400 401760                    pmme    nvectors=18
        19 016707   016711 702000 19                 TSX2    s:31825
        19 016710   016721 710000 19                 TRA     s:31831

     4918    31824    4           WHENALTRETURN DO;

     4919    31825    4               IF B$TCB.ALT$ -> B$ALT.ERR.CODE = %E$FDEOF

  31825 19 016711   000000 470400 xsym               LDP0    B$TCB$
        19 016712   000000 471500                    LDP1    0,,PR0
        19 016713   100102 236100                    LDQ     66,,PR1
        19 016714   377770 376007                    ANQ     131064,DL
        19 016715   001540 116007                    CMPQ    864,DL
        19 016716   016751 601000 19                 TNZ     E_PMME

     4920    31826    4               THEN                       /* End of file directory */
     4921    31827    4                   ALTRETURN;

  31827 19 016717   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 016720   000000 702211                    TSX2  ! 0,X1

     4922    31828    4               ELSE
     4923    31829    4                   GOTO E_PMME;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:738  
     4924    31830    4           END;                            /* Do never ... end */
     4925    31831    3           IF SUBSTR(DCBADDR(M$WORK_NUM)->F$DCB.NAME#.C,0,6) ~= ':MAIL_'

  31831 19 016721   000074 470400 20                 LDP0    60
        19 016722   000000 471500                    LDP1    0,,PR0
        19 016723   000000 720000 xsym               LXL0    M$WORK_NUM
        19 016724   100000 473510                    LDP3    0,X0,PR1
        19 016725   040000 106500                    CMPC    fill='040'O
        19 016726   300010 200006                    ADSC9   8,,PR3                   cn=1,n=6
        19 016727   001363 000006 12                 ADSC9   VM_PROKEY+6              cn=0,n=6
        19 016730   016733 600000 19                 TZE     s:31834

     4926    31832    3           THEN
     4927    31833    3               ALTRETURN;

  31833 19 016731   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 016732   000000 702211                    TSX2  ! 0,X1

     4928    31834    3           VM_WILDCARD.INPUT_ = VECTOR(VM_RADDRESS.FOLDER);

  31834 19 016733   000620 235000 20                 LDA     400
        19 016734   201706 452500                    STP2    I+100,,AUTO
        19 016735   201706 236100                    LDQ     I+100,,AUTO
        19 016736   000621 036000 20                 ADLQ    401
        19 016737   001636 757000 11                 STAQ    VM_WILDCARD+2

     4929    31835    3           VM_RADDRESS.FOLDER = SUBSTR(DCBADDR(M$WORK_NUM)->F$DCB.NAME#.C,6);

  31835 19 016740   040100 100500                    MLR     fill='040'O
        19 016741   300011 600031                    ADSC9   9,,PR3                   cn=3,n=25
        19 016742   200760 400031                    ADSC9   VM_RADDRESS+7,,AUTO      cn=2,n=25

     4930    31836    3           CALL X$WILDCMP (VM_WILDCARD)

  31836 19 016743   000237 630400 20                 EPPR0   159
        19 016744   000024 631400 20                 EPPR1   20
        19 016745   000000 701000 xent               TSX1    X$WILDCMP
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:739  
        19 016746   016750 702000 19                 TSX2    s:31840

     4931    31837    4           WHENRETURN DO;

     4932    31838    4               GOTO MATCH_FOUND;

  31838 19 016747   016773 710000 19                 TRA     MATCH_FOUND

     4933    31839    4           END;
     4934    31840    4           DO NEVER;

  31840 19 016750   016767 710000 19                 TRA     s:31847

  31835 19 016751                       E_PMME       null
     4935    31841    4   E_PMME:     ;
     4936    31842    4               CALL XUR$ERRMSG (B$TCB.ALT$ -> B$ALT.ERR, M$WORK_NUM);

  31842 19 016751   000000 470400 xsym               LDP0    B$TCB$
        19 016752   000000 471500                    LDP1    0,,PR0
        19 016753   000133 236000 20                 LDQ     91
        19 016754   201707 756100                    STQ     I+101,,AUTO
        19 016755   100102 633500                    EPPR3   66,,PR1
        19 016756   201706 453500                    STP3    I+100,,AUTO
        19 016757   201706 630500                    EPPR0   I+100,,AUTO
        19 016760   000000 631400 20                 EPPR1   0
        19 016761   000000 701000 xent               TSX1    XUR$ERRMSG
        19 016762   000000 011000                    NOP     0

     4937    31843    4               IF NOT WILD

  31843 19 016763   200041 234100                    SZN     WILD,,AUTO
        19 016764   016767 604000 19                 TMI     s:31847

     4938    31844    4               THEN
     4939    31845    4                   ALTRETURN;

  31845 19 016765   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:740  
        19 016766   000000 702211                    TSX2  ! 0,X1

     4940    31846    4           END/*NEVER*/;

     4941    31847    3           OPEN_NEXT.NAME_ = VECTOR(NIL);

  31847 19 016767   000230 237000 20                 LDAQ    152
        19 016770   002302 757000 11                 STAQ    OPEN_NEXT+6

     4942    31848    3       END/*WHILE WILD*/;

  31848 19 016771   200041 234100                    SZN     WILD,,AUTO
        19 016772   016704 604000 19                 TMI     s:31823

  31840 19 016773                       MATCH_FOUND  null
     4943    31849        /*
     4944    31850             ***** When match found (or if not wild), open the folder
     4945    31851        */
     4946    31852    2   MATCH_FOUND: ;
     4947    31853    2       VM_WORK_FOLDER.FLAGS = '0'B;

  31853 19 016773   001504 450000 11                 STZ     VM_WORK_FOLDER+19

     4948    31854    2       CALL VMA$OPEN_FOLDER (VM_WORK_FOLDER,ADDR(VM_RADDRESS),M$WORK_NUM,

  31854 19 016774   200751 630500                    EPPR0   VM_RADDRESS,,AUTO
        19 016775   201706 450500                    STP0    I+100,,AUTO
        19 016776   000600 237000 20                 LDAQ    384
        19 016777   201712 757100                    STAQ    I+104,,AUTO
        19 017000   000133 236000 20                 LDQ     91
        19 017001   201711 756100                    STQ     I+103,,AUTO
        19 017002   201706 631500                    EPPR1   I+100,,AUTO
        19 017003   201710 451500                    STP1    I+102,,AUTO
        19 017004   000132 236000 20                 LDQ     90
        19 017005   201707 756100                    STQ     I+101,,AUTO
        19 017006   201707 630500                    EPPR0   I+101,,AUTO
        19 017007   000041 631400 20                 EPPR1   33
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:741  
        19 017010   000000 701000 xent               TSX1    VMA$OPEN_FOLDER
        19 017011   016751 702000 19                 TSX2    E_PMME

     4949    31855    2         %OLDFILE#,%UPDATE#) ALTRET(E_PMME);
     4950    31856    2       RETURN;

  31856 19 017012   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 017013   000001 702211                    TSX2  ! 1,X1

     4951    31857    2   END GET_WILD_FOLDER;
     4952    31858        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:742  
     4953    31859        /*********************************************************************/
     4954    31860        /*F*    NAME:        DEL_NAMEMAP_ENTRIES
     4955    31861                PURPOSE:     To delete all NAMEMAP entries for a USER.
     4956    31862                DESCRIPTION: This routine will delete all the entries in
     4957    31863                             the reverse name map (:NAME.:MAIL) which are found
     4958    31864                             in the definition pointed to by VM_ADD_HEAD.HEAD$.
     4959    31865        */
     4960    31866        /*********************************************************************/
     4961    31867    1   DEL_NAMEMAP_ENTRIES: PROC ALTRET;

  31867 19 017014   201116 741300       DEL_NAMEMAP* STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     4962    31868    2       PTR1$ = VM_ADD_HEAD.HEAD$;

  31868 19 017015   000000 470400 xsym               LDP0    VM_ADDLIST$
        19 017016   000003 236100                    LDQ     3,,PR0
        19 017017   200025 756100                    STQ     PTR1$,,AUTO

     4963    31869    2       NAME_KEY.L# = 20;

  31869 19 017020   024000 236003                    LDQ     10240,DU
        19 017021   002402 552040 11                 STBQ    NAME_KEY,'40'O

     4964    31870    3       DO FOREVER;

     4965    31871    3           CALL VMA$GET_NEXT_ENTRY (VM_UADDRESS,VM_RADDRESS,

  31871 19 017022   000203 236000 20                 LDQ     131
        19 017023   201711 756100                    STQ     I+103,,AUTO
        19 017024   200025 630500                    EPPR0   PTR1$,,AUTO
        19 017025   201710 450500                    STP0    I+102,,AUTO
        19 017026   200751 631500                    EPPR1   VM_RADDRESS,,AUTO
        19 017027   201707 451500                    STP1    I+101,,AUTO
        19 017030   200775 633500                    EPPR3   VM_UADDRESS,,AUTO
        19 017031   201706 453500                    STP3    I+100,,AUTO
        19 017032   201706 630500                    EPPR0   I+100,,AUTO
        19 017033   000026 631400 20                 EPPR1   22
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:743  
        19 017034   000000 701000 xent               TSX1    VMA$GET_NEXT_ENTRY
        19 017035   017062 702000 19                 TSX2    END_DEL_NAME_MAP

     4966    31872    3             PTR1$,VM_ADDLIST$) ALTRET(END_DEL_NAME_MAP);
     4967    31873    3           NAME_KEY.NAME# = VM_UADDRESS.NAME_KEY;

  31873 19 017036   040000 100500                    MLR     fill='040'O
        19 017037   200777 400024                    ADSC9   VM_UADDRESS+2,,AUTO      cn=2,n=20
        19 017040   002402 200024 11                 ADSC9   NAME_KEY                 cn=1,n=20

     4968    31874    3           IF VM_UADDRESS.SITENAME = ' '

  31874 19 017041   040000 106500                    CMPC    fill='040'O
        19 017042   201014 600010                    ADSC9   VM_UADDRESS+15,,AUTO     cn=3,n=8
        19 017043   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 017044   017055 600000 19                 TZE     s:31879
        19 017045   040000 106500                    CMPC    fill='040'O
        19 017046   201014 600010                    ADSC9   VM_UADDRESS+15,,AUTO     cn=3,n=8
        19 017047   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        19 017050   017022 601000 19                 TNZ     s:31871
        19 017051   040000 106400                    CMPC    fill='040'O
        19 017052   002402 200024 11                 ADSC9   NAME_KEY                 cn=1,n=20
        19 017053   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 017054   017022 600000 19                 TZE     s:31871

     4969    31875    3             OR VM_UADDRESS.SITENAME = VM_SITENAME
     4970    31876    3             AND NAME_KEY.NAME# ~= ' '
     4971    31877    3           THEN
     4972    31878    4           DO;

     4973    31879    4               CALL M$DELREC (DELREC_NAME_MAP) ALTRET(IGNORE);

  31879 19 017055   000460 630400 12                 EPPR0   DELREC_NAME_MAP
        19 017056   440002 713400                    CLIMB   alt,+16386
        19 017057   401400 401760                    pmme    nvectors=4
        19 017060   017061 702000 19                 TSX2    IGNORE

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:744  
  31879 19 017061                       IGNORE       null
     4974    31880    4   IGNORE:     ;
     4975    31881    4           END;

     4976    31882    3       END;                            /* Do forever ... end */

  31882 19 017061   017022 710000 19                 TRA     s:31871

  31879 19 017062                       END_DEL_NAM* null
     4977    31883    2   END_DEL_NAME_MAP: ;
     4978    31884    2       RETURN;

  31884 19 017062   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 017063   000001 702211                    TSX2  ! 1,X1

     4979    31885    2   END DEL_NAMEMAP_ENTRIES;
     4980    31886        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:745  
     4981    31887        /********************************************************************/
     4982    31888        /*F*    NAME: GET_FOLDERNAME
     4983    31889                PURPOSE: To obtain the current folder name for use in an
     4984    31890                         error message.
     4985    31891                DESCRIPTION: This routine will get the current folder name in
     4986    31892                             WORK_STRING, and, if it is too long to fit in an
     4987    31893                             error message substitution field, will truncate
     4988    31894                             it to fit.
     4989    31895        */
     4990    31896        /********************************************************************/
     4991    31897    1   GET_FOLDERNAME: PROC (FOLDER_SPEC);

  31897 19 017064   201122 741300       GET_FOLDERN* STX1  ! @NAME+1,,AUTO

     4992    31898        %VM_FOLDER_INFO (NAME=FOLDER_SPEC, STCLASS=PARAM);
     4993    31950        /**/
     4994    31951    2       WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);

  31951 19 017065   777000 236003                    LDQ     -512,DU
        19 017066   000174 552040 11                 STBQ    WORK_STRING,'40'O

     4995    31952    2       CALL VMF$MAKE_ADDRESS1 (WORK_STRING,FOLDER_SPEC);

  31952 19 017067   201123 236100                    LDQ     @FOLDER_SPEC,,AUTO
        19 017070   000051 235000 20                 LDA     41
        19 017071   201706 757100                    STAQ    I+100,,AUTO
        19 017072   201706 630500                    EPPR0   I+100,,AUTO
        19 017073   000000 631400 20                 EPPR1   0
        19 017074   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS1
        19 017075   000000 011000                    NOP     0

     4996    31953    2       IF WORK_STRING.L# > 31

  31953 19 017076   000174 236000 11                 LDQ     WORK_STRING
        19 017077   777000 376003                    ANQ     -512,DU
        19 017100   040000 116003                    CMPQ    16384,DU
        19 017101   017107 602000 19                 TNC     s:31958
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:746  

     4997    31954    3       THEN DO;

     4998    31955    3           WORK_STRING.L# = 31;

  31955 19 017102   037000 236003                    LDQ     15872,DU
        19 017103   000174 552040 11                 STBQ    WORK_STRING,'40'O

     4999    31956    3           SUBSTR (WORK_STRING.NAME#,28,3) = '...';

  31956 19 017104   001362 236000 12                 LDQ     VM_PROKEY+5
        19 017105   000011 772000                    QRL     9
        19 017106   000203 552034 11                 STBQ    WORK_STRING+7,'34'O

     5000    31957    3       END;

     5001    31958    2       RETURN;

  31958 19 017107   201122 221300                    LDX1  ! @NAME+1,,AUTO
        19 017110   000001 702211                    TSX2  ! 1,X1

     5002    31959    2   END GET_FOLDERNAME;
     5003    31960        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:747  
     5004    31961        /*********************************************************************/
     5005    31962        /*F*    NAME:        LINK_RUNIT
     5006    31963                PURPOSE:     To M$LINK to specified rununit.
     5007    31964                DESCRIPTION: This routine will M$LINK to the specified
     5008    31965                             rununit and perform any necessary cleanup
     5009    31966                             so that MAIL works as though uninterrupted.
     5010    31967        */
     5011    31968        /*********************************************************************/
     5012    31969    1   LINK_RUNIT: PROC ALTRET;

  31969 19 017111   201120 741300       LINK_RUNIT   STX1  ! @EXPLICIT+1,,AUTO

     5013    31970    2       CALL XUR$DISABLE;

  31970 19 017112   000020 631400 20                 EPPR1   16
        19 017113   000000 701000 xent               TSX1    XUR$DISABLE
        19 017114   000000 011000                    NOP     0

     5014    31971        /*
     5015    31972             ***** Write the profile out if updating is permitted.
     5016    31973        */
     5017    31974    2       IF VM_CURRENT_FOLDER.FLAGS.UPDATE = %YES#

  31974 19 017115   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 017116   017123 605000 19                 TPL     s:31977

     5018    31975    2       THEN
     5019    31976    2           CALL PUT_PROFILE (M$MAIL_FILE_NUM) ALTRET(E_PMME);

  31976 19 017117   000053 236000 20                 LDQ     43
        19 017120   201523 756100                    STQ     INDX2+255,,AUTO
        19 017121   021320 701000 19                 TSX1    PUT_PROFILE
        19 017122   017314 702000 19                 TSX2    E_PMME

     5020    31977    2       VM_CURRENT_FOLDER.FLAGS.OPEN = %NO#;

  31977 19 017123   000054 236000 20                 LDQ     44
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:748  
        19 017124   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     5021    31978        /*
     5022    31979             ***** Assume that FPT_LINK is setup correctly ...
     5023    31980        */
     5024    31981    2       CALL M$LINK (FPT_LINK)

  31981 19 017125   002414 630400 11                 EPPR0   FPT_LINK
        19 017126   400005 713400                    CLIMB   alt,+5
        19 017127   403000 401760                    pmme    nvectors=7
        19 017130   017132 702000 19                 TSX2    s:31983
        19 017131   017166 710000 19                 TRA     s:32020

     5025    31982    3       WHENALTRETURN DO;

     5026    31983    3           ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  31983 19 017132   000000 470400 xsym               LDP0    B$TCB$
        19 017133   000000 471500                    LDP1    0,,PR0
        19 017134   100102 236100                    LDQ     66,,PR1
        19 017135   002204 756000 11                 STQ     ERROR

     5027    31984    3           DCB# = B$TCB.ALT$ -> B$ALT.DCB#;

  31984 19 017136   000000 471500                    LDP1    0,,PR0
        19 017137   100101 235100                    LDA     65,,PR1
        19 017140   000401 755000 11                 STA     DCB#

     5028    31985        /*
     5029    31986             ***** If the M$LINK failed because of rundownip
     5030    31987                   then exit mail now!
     5031    31988        */
     5032    31989    3           IF ERROR.ERR# = %E$EKEY

  31989 19 017141   002204 236000 11                 LDQ     ERROR
        19 017142   377770 376007                    ANQ     131064,DL
        19 017143   003740 116007                    CMPQ    2016,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:749  
        19 017144   017162 601000 19                 TNZ     s:32018

     5033    31990    3           THEN
     5034    31991    4           DO;

     5035    31992                    %INIT_STR (CODE=E_END_NOUPDATE_CMD, STR=VM_END_NOUPDATE_CMD,
     5036    31993                    NEXT_CMD=VM_END_NOUPDATE_CMD, TEST=YES);

  32000 19 017145   040000 106400                    CMPC    fill='040'O
        19 017146   004602 200017 11                 ADSC9   VM_END_NOUPDATE_CMD      cn=1,n=15
        19 017147   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 017150   017155 601000 19                 TNZ     s:32011

  32002 19 017151   000077 630400 20                 EPPR0   63
        19 017152   000000 631400 20                 EPPR1   0
        19 017153   000000 701000 xent               TSX1    VMD$ERRMSG
        19 017154   000000 011000                    NOP     0

  32011 19 017155   000000 100400                    MLR     fill='000'O
        19 017156   004602 000020 11                 ADSC9   VM_END_NOUPDATE_CMD      cn=0,n=16
        19 017157   004602 000020 11                 ADSC9   VM_END_NOUPDATE_CMD      cn=0,n=16

     5037    32016    4               ALTRETURN;

  32016 19 017160   201120 221300                    LDX1  ! @EXPLICIT+1,,AUTO
        19 017161   000000 702211                    TSX2  ! 0,X1

     5038    32017    4           END;
     5039    32018    3           CALL XUR$ERRMSG (ERROR,DCB#);

  32018 19 017162   000101 630400 20                 EPPR0   65
        19 017163   000000 631400 20                 EPPR1   0
        19 017164   000000 701000 xent               TSX1    XUR$ERRMSG
        19 017165   000000 011000                    NOP     0

     5040    32019    3       END;                            /* Do never ... end */

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:750  
     5041    32020    2       VM_CURRENT_FOLDER.FLAGS.OPEN = %YES#;

  32020 19 017166   010000 236003                    LDQ     4096,DU
        19 017167   001266 256000 11                 ORSQ    VM_CURRENT_FOLDER+19

     5042    32021    2       IF VM_CURRENT_FOLDER.FLAGS.UPDATE = %NO#

  32021 19 017170   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 017171   017235 604000 19                 TMI     s:32039

     5043    32022    2       THEN
     5044    32023    3       DO;

     5045    32024
     5046    32025    4           CALL M$ENQ (FILE_SHARE) WHENALTRETURN DO;

  32025 19 017172   000304 630400 12                 EPPR0   FILE_SHARE
        19 017173   420002 713400                    CLIMB   alt,+8194
        19 017174   401000 401760                    pmme    nvectors=3
        19 017175   017177 702000 19                 TSX2    FOLD_BUSY
        19 017176   017230 710000 19                 TRA     s:32036

     5047    32026    4   FOLD_BUSY:
     5048    32027    4               CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;

  32027 19 017177   000000 720000 xsym  FOLD_BUSY    LXL0    M$MAIL_FILE_NUM
        19 017200   002142 740000 11                 STX0    CLOSE_SAVE+26

     5049    32028    4               CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  32028 19 017201   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 017202   450001 713400                    CLIMB   alt,close
        19 017203   406000 401760                    pmme    nvectors=13
        19 017204   017314 702000 19                 TSX2    E_PMME

     5050    32029    4               VM_CURRENT_FOLDER.FLAGS.OPEN = %NO#;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:751  
  32029 19 017205   000054 236000 20                 LDQ     44
        19 017206   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     5051    32030        /**/
     5052    32031    4               WORK_STRING.L# = LENGTHC(WORK_STRING.NAME#);

  32031 19 017207   777000 236003                    LDQ     -512,DU
        19 017210   000174 552040 11                 STBQ    WORK_STRING,'40'O

     5053    32032    4               CALL GET_FOLDERNAME (VM_CURRENT_FOLDER);

  32032 19 017211   000052 236000 20                 LDQ     42
        19 017212   201123 756100                    STQ     @FOLDER_SPEC,,AUTO
        19 017213   017064 701000 19                 TSX1    GET_FOLDERNAME
        19 017214   000000 011000                    NOP     0

     5054    32033    4               CALL XUR$ERRMSG (E_FOLDERBUSY,,,VECTOR(WORK_STRING));

  32033 19 017215   000175 236000 20                 LDQ     125
        19 017216   000022 235000 20                 LDA     18
        19 017217   201710 757100                    STAQ    I+102,,AUTO
        19 017220   000022 236000 20                 LDQ     18
        19 017221   000603 235000 20                 LDA     387
        19 017222   201706 757100                    STAQ    I+100,,AUTO
        19 017223   201706 630500                    EPPR0   I+100,,AUTO
        19 017224   000026 631400 20                 EPPR1   22
        19 017225   000000 701000 xent               TSX1    XUR$ERRMSG
        19 017226   000000 011000                    NOP     0

     5055    32034    4               GOTO NO_FOLD;

  32034 19 017227   017257 710000 19                 TRA     NO_FOLD

     5056    32035    4           END;
     5057    32036    3           CALL XUR$ERRMSG(E_NOUPDATE);

  32036 19 017230   000604 630400 20                 EPPR0   388
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:752  
        19 017231   000024 631400 20                 EPPR1   20
        19 017232   000000 701000 xent               TSX1    XUR$ERRMSG
        19 017233   000000 011000                    NOP     0

     5058    32037    3       END;

  32037 19 017234   017256 710000 19                 TRA     s:32050

     5059    32038    3       ELSE DO;                        /* Enq and see what we can get */

     5060    32039    4           CALL M$ENQ (FILE_NONE) WHENALTRETURN DO;

  32039 19 017235   000316 630400 12                 EPPR0   FILE_NONE
        19 017236   420002 713400                    CLIMB   alt,+8194
        19 017237   401000 401760                    pmme    nvectors=3
        19 017240   017242 702000 19                 TSX2    s:32040
        19 017241   017256 710000 19                 TRA     s:32050

     5061    32040    4               CALL M$ENQ (FILE_SHARE)

  32040 19 017242   000304 630400 12                 EPPR0   FILE_SHARE
        19 017243   420002 713400                    CLIMB   alt,+8194
        19 017244   401000 401760                    pmme    nvectors=3
        19 017245   017255 702000 19                 TSX2    s:32046

     5062    32041    5               WHENRETURN DO;

     5063    32042    5                   VM_CURRENT_FOLDER.FLAGS.UPDATE = %NO#;

  32042 19 017246   000516 236000 20                 LDQ     334
        19 017247   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     5064    32043    5                   CALL XUR$ERRMSG(E_NOUPDATE);

  32043 19 017250   000604 630400 20                 EPPR0   388
        19 017251   000024 631400 20                 EPPR1   20
        19 017252   000000 701000 xent               TSX1    XUR$ERRMSG
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:753  
        19 017253   000000 011000                    NOP     0

     5065    32044    5               END;

  32044 19 017254   017256 710000 19                 TRA     s:32050

     5066    32045    5               WHENALTRETURN DO;

     5067    32046    5                   GOTO FOLD_BUSY;

  32046 19 017255   017177 710000 19                 TRA     FOLD_BUSY

     5068    32047    5               END;
     5069    32048    4           END;

     5070    32049    3       END;

     5071    32050    3       DO NEVER;

  32050 19 017256   017300 710000 19                 TRA     s:32062

     5072    32051    3   NO_FOLD:
     5073    32052    3           CALL XUR$ERRMSG (E_NOCURFOLD);

  32052 19 017257   000252 630400 20    NO_FOLD      EPPR0   170
        19 017260   000024 631400 20                 EPPR1   20
        19 017261   000000 701000 xent               TSX1    XUR$ERRMSG
        19 017262   000000 011000                    NOP     0

     5074    32053    3           VM_SEARCH_INFO.ACTIVE = '0'B;

  32053 19 017263   000516 236000 20                 LDQ     334
        19 017264   001632 356000 11                 ANSQ    VM_SEARCH_INFO+34

     5075    32054    3           VM_SEARCH_INFO.CURRENT = '0'B;

  32054 19 017265   000055 236000 20                 LDQ     45
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:754  
        19 017266   001632 356000 11                 ANSQ    VM_SEARCH_INFO+34

     5076    32055    4           DO INDX4=0 TO %VM_MAX_SRCH;

  32055 19 017267   200035 450100                    STZ     INDX4,,AUTO

     5077    32056    4               VM_PROFILE.SEARCH_LIST$(INDX4) = ADDR(NIL);

  32056 19 017270   000022 236000 20                 LDQ     18
        19 017271   000000 470400 xsym               LDP0    VM_PROFILE$
        19 017272   200035 720100                    LXL0    INDX4,,AUTO
        19 017273   000115 756110                    STQ     77,X0,PR0

     5078    32057    4           END;

  32057 19 017274   200035 054100                    AOS     INDX4,,AUTO
        19 017275   200035 235100                    LDA     INDX4,,AUTO
        19 017276   000004 115007                    CMPA    4,DL
        19 017277   017270 604400 19                 TMOZ    s:32056

     5079    32058    3       END;

     5080    32059        /*
     5081    32060             ***** Get the profile back ...
     5082    32061        */
     5083    32062    2       IF VM_CURRENT_FOLDER.FLAGS.OPEN

  32062 19 017300   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 017301   010000 316003                    CANQ    4096,DU
        19 017302   017307 600000 19                 TZE     s:32065

     5084    32063    2       THEN
     5085    32064    2           CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(E_PMME);

  32064 19 017303   000053 630400 20                 EPPR0   43
        19 017304   000024 631400 20                 EPPR1   20
        19 017305   000000 701000 xent               TSX1    VMD$GET_PROFILE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:755  
        19 017306   017314 702000 19                 TSX2    E_PMME

     5086    32065    2       CALL XUR$CLRENABLE;

  32065 19 017307   000020 631400 20                 EPPR1   16
        19 017310   000000 701000 xent               TSX1    XUR$CLRENABLE
        19 017311   000000 011000                    NOP     0

     5087    32066    2       RETURN;

  32066 19 017312   201120 221300                    LDX1  ! @EXPLICIT+1,,AUTO
        19 017313   000001 702211                    TSX2  ! 1,X1

     5088    32067        /**/
     5089    32068    2   E_PMME:
     5090    32069    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  32069 19 017314   000000 470400 xsym  E_PMME       LDP0    B$TCB$
        19 017315   000000 471500                    LDP1    0,,PR0
        19 017316   100102 236100                    LDQ     66,,PR1
        19 017317   002204 756000 11                 STQ     ERROR

     5091    32070    2       DCB# = B$TCB.ALT$ -> B$ALT.DCB#;

  32070 19 017320   000000 471500                    LDP1    0,,PR0
        19 017321   100101 235100                    LDA     65,,PR1
        19 017322   000401 755000 11                 STA     DCB#

     5092    32071    2       CALL XUR$ERRMSG (ERROR,DCB#);

  32071 19 017323   000101 630400 20                 EPPR0   65
        19 017324   000000 631400 20                 EPPR1   0
        19 017325   000000 701000 xent               TSX1    XUR$ERRMSG
        19 017326   000000 011000                    NOP     0

     5093    32072    2       CALL XUR$CLRENABLE;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:756  
  32072 19 017327   000020 631400 20                 EPPR1   16
        19 017330   000000 701000 xent               TSX1    XUR$CLRENABLE
        19 017331   000000 011000                    NOP     0

     5094    32073    2       ALTRETURN;

  32073 19 017332   201120 221300                    LDX1  ! @EXPLICIT+1,,AUTO
        19 017333   000000 702211                    TSX2  ! 0,X1

     5095    32074    2   END LINK_RUNIT;
     5096    32075        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:757  
     5097    32076        /*********************************************************************/
     5098    32077        /*F*    NAME:       REPORT_ACTIVITY
     5099    32078                PURPOSE:     To report values using specified formats.
     5100    32079                DESCRIPTION: This routine will report the value of VALUE
     5101    32080                             using the passed format (FMT_) unless VALUE
     5102    32081                             is zero and SUBSTITUTE is YES. Then the message
     5103    32082                             "No message found" will be printed.
     5104    32083        */
     5105    32084        /*********************************************************************/
     5106    32085    1   REPORT_ACTIVITY: PROC (VALUE, FMT, SUBSTITUTE#, CODE);

  32085 19 017334   201116 741300       REPORT_ACTI* STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     5107    32086    2   DCL VALUE SBIN WORD;
     5108    32087        %VLP_NAME (FPTN=FMT, STCLASS=PARAM);
     5109    32114    2   DCL SUBSTITUTE# BIT(1);
     5110    32115    2   DCL CODE          UBIN;
     5111    32116        /**/
     5112    32117    2       IF VALUE = 0

  32117 19 017335   201117 470500                    LDP0    @VALUE,,AUTO
        19 017336   000000 235100                    LDA     0,,PR0
        19 017337   017366 601000 19                 TNZ     s:32149
        19 017340   201121 471500                    LDP1    @SUBSTITUTE#,,AUTO
        19 017341   000000 066500                    CMPB    filb='0'B
        19 017342   100000 000001                    BDSC    0,,PR1                   by=0,bit=0,n=1
        19 017343   000020 000022 20                 BDSC    16                       by=0,bit=0,n=18
        19 017344   017366 600000 19                 TZE     s:32149

     5113    32118    2         AND SUBSTITUTE# = %YES#
     5114    32119    2       THEN
     5115    32120    3       DO;

     5116    32121    3           F_FDSME.NVECS# = 0;

  32121 19 017345   002755 450000 11                 STZ     F_FDSME+9

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:758  
     5117    32122                %INIT_STR (CODE=E_NO_MESSAGE_FMT, STR=VM_NO_MESSAGE_FMT,
     5118    32123                VECT="F_FDSME.FMT_", TEST=YES);

  32130 19 017346   040000 106400                    CMPC    fill='040'O
        19 017347   003313 200120 11                 ADSC9   VM_NO_MESSAGE_FMT        cn=1,n=80
        19 017350   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 017351   017357 601000 19                 TNZ     s:32135

  32132 19 017352   000622 630400 20                 EPPR0   402
        19 017353   000021 631400 20                 EPPR1   17
        19 017354   000000 701000 xent               TSX1    VMD$ERRMSG
        19 017355   000000 011000                    NOP     0

  32133 19 017356   017434 710000 19                 TRA     s:32175

  32135 19 017357   003313 236000 11                 LDQ     VM_NO_MESSAGE_FMT
        19 017360   000033 772000                    QRL     27
        19 017361   000064 737000                    LLS     52
        19 017362   000140 135007                    SBLA    96,DL
        19 017363   000625 236000 20                 LDQ     405
        19 017364   002744 757000 11                 STAQ    F_FDSME

     5119    32146    3       END;

  32146 19 017365   017434 710000 19                 TRA     s:32175

     5120    32147    2       ELSE
     5121    32148    3       DO;

     5122    32149    3           VECT_ARRAY(0) = VECTOR(VALUE);

  32149 19 017366   777640 235007                    LDA     -96,DL
        19 017367   201117 236100                    LDQ     @VALUE,,AUTO
        19 017370   003076 757000 11                 STAQ    VECT_ARRAY

     5123    32150    3           F_FDSME.NVECS# = 1;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:759  
  32150 19 017371   000001 235007                    LDA     1,DL
        19 017372   002755 755000 11                 STA     F_FDSME+9

     5124    32151                %INIT_STR (CODE=CODE, STR=FMT, VECT="F_FDSME.FMT_", TEST=YES);

  32158 19 017373   201120 471500                    LDP1    @FMT,,AUTO
        19 017374   000100 101500                    MRL     fill='000'O
        19 017375   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 017376   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 017377   201706 220100                    LDX0    I+100,,AUTO
        19 017400   040000 106540                    CMPC    fill='040'O
        19 017401   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        19 017402   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 017403   017416 601000 19                 TNZ     s:32163

  32160 19 017404   000065 236000 20                 LDQ     53
        19 017405   201710 756100                    STQ     I+102,,AUTO
        19 017406   201120 236100                    LDQ     @FMT,,AUTO
        19 017407   201122 235100                    LDA     @CODE,,AUTO
        19 017410   201706 757100                    STAQ    I+100,,AUTO
        19 017411   201706 630500                    EPPR0   I+100,,AUTO
        19 017412   000021 631400 20                 EPPR1   17
        19 017413   000000 701000 xent               TSX1    VMD$ERRMSG
        19 017414   000000 011000                    NOP     0

  32161 19 017415   017434 710000 19                 TRA     s:32175

  32163 19 017416   000100 101500                    MRL     fill='000'O
        19 017417   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 017420   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 017421   201706 220100                    LDX0    I+100,,AUTO
        19 017422   000100 101500                    MRL     fill='000'O
        19 017423   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 017424   201707 000002                    ADSC9   I+101,,AUTO              cn=0,n=2
        19 017425   201707 222100                    LDX2    I+101,,AUTO
        19 017426   000000 635012                    EAA     0,X2
        19 017427   000002 771000                    ARL     2
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:760  
        19 017430   000140 135007                    SBLA    96,DL
        19 017431   201120 236100                    LDQ     @FMT,,AUTO
        19 017432   200000 036007                    ADLQ    65536,DL
        19 017433   002744 757000 11                 STAQ    F_FDSME

     5125    32174    3       END;

     5126    32175    2       CALL VMD$WRITE_BUF (F_FDSME);

  32175 19 017434   000065 630400 20                 EPPR0   53
        19 017435   000024 631400 20                 EPPR1   20
        19 017436   000000 701000 xent               TSX1    VMD$WRITE_BUF
        19 017437   000000 011000                    NOP     0

     5127    32176    2       RETURN;

  32176 19 017440   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 017441   000001 702211                    TSX2  ! 1,X1

     5128    32177    2   END REPORT_ACTIVITY;
     5129    32178        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:761  
     5130    32179        /*********************************************************************/
     5131    32180        /*F*    NAME:        INIT_CONTEXT
     5132    32181                PURPOSE:     To initialize the specified CONTEXT for SELECTIONS
     5133    32182                DESCRIPTION: This routine will reset all items in the specified
     5134    32183                             CONTEXT, i.e. SELECTION CONTEXT information.
     5135    32184        */
     5136    32185        /*********************************************************************/
     5137    32186    1   INIT_CONTEXT: PROC (WHICH_CONTEXT);

  32186 19 017442   201122 741300       INIT_CONTEXT STX1  ! @CODE,,AUTO

     5138    32187    2   DCL WHICH_CONTEXT UBIN WORD;
     5139    32188        /**/
     5140    32189    2       CONTEXT_PTR$(WHICH_CONTEXT) = PINCRW(VM_SELECT$,WHICH_CONTEXT*512);

  32189 19 017443   201123 470500                    LDP0    @WHICH_CONTEXT,,AUTO
        19 017444   000000 720100                    LXL0    0,,PR0
        19 017445   000000 636010                    EAQ     0,X0
        19 017446   000011 736000                    QLS     9
        19 017447   000000 036000 xsym               ADLQ    VM_SELECT$
        19 017450   001663 756010 11                 STQ     CONTEXT_PTR$,X0

     5141    32190    2       CONTEXT_PTR$(WHICH_CONTEXT) -> VM$CONTEXT.MESSAGE_POINTER = -1;

  32190 19 017451   001663 471410 11                 LDP1    CONTEXT_PTR$,X0
        19 017452   000001 335007                    LCA     1,DL
        19 017453   100000 755100                    STA     0,,PR1

     5142    32191    2       CONTEXT_PTR$(WHICH_CONTEXT) -> VM$CONTEXT.TRUTH_TREE$ = ADDR(NIL);

  32191 19 017454   000000 720100                    LXL0    0,,PR0
        19 017455   001663 471410 11                 LDP1    CONTEXT_PTR$,X0
        19 017456   000022 236000 20                 LDQ     18
        19 017457   100001 756100                    STQ     1,,PR1

     5143    32192    2       CONTEXT_PTR$(WHICH_CONTEXT) -> VM$CONTEXT.NUM_ENTRIES = 0;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:762  
  32192 19 017460   000000 720100                    LXL0    0,,PR0
        19 017461   001663 471410 11                 LDP1    CONTEXT_PTR$,X0
        19 017462   100002 450100                    STZ     2,,PR1

     5144    32193    2       CONTEXT_PTR$(WHICH_CONTEXT) -> VM$CONTEXT.FLAGS = %NO#;

  32193 19 017463   000000 720100                    LXL0    0,,PR0
        19 017464   001663 471410 11                 LDP1    CONTEXT_PTR$,X0
        19 017465   100004 450100                    STZ     4,,PR1

     5145    32194    2       RETURN;

  32194 19 017466   201122 221300                    LDX1  ! @CODE,,AUTO
        19 017467   000001 702211                    TSX2  ! 1,X1

     5146    32195    2   END INIT_CONTEXT;
     5147    32196        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:763  
     5148    32197        /********************************************************************/
     5149    32198        /*F*    NAME:        FIX_CONTEXT
     5150    32199                PURPOSE:     To fix the top end of the message selection range.
     5151    32200                DESCRIPTION: If the current context range is the entire folder,
     5152    32201                             this routine limits it to the number of messages
     5153    32202                             currently in the folder, so that commands which
     5154    32203                             can add new messages don't get into a loop.
     5155    32204        */
     5156    32205        /********************************************************************/
     5157    32206    1   FIX_CONTEXT: PROC;

  32206 19 017470   201116 741300       FIX_CONTEXT  STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     5158    32207        /**/
     5159    32208    2       IF CURRENT_CONTEXT%.NUM_ENTRIES = 1

  32208 19 017471   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 017472   000002 235100                    LDA     2,,PR0
        19 017473   000001 115007                    CMPA    1,DL
        19 017474   017506 601000 19                 TNZ     s:32213
        19 017475   000005 235100                    LDA     5,,PR0
        19 017476   000001 115007                    CMPA    1,DL
        19 017477   017506 601000 19                 TNZ     s:32213
        19 017500   000006 235100                    LDA     6,,PR0
        19 017501   000556 115000 20                 CMPA    366
        19 017502   017506 601000 19                 TNZ     s:32213

     5160    32209    2         AND CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = 1
     5161    32210    2         AND CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = %MAX_MSGNO
     5162    32211    2       THEN
     5163    32212    2           CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = VM_PROFILE.HI_MESSAGE_NUMBER;

  32212 19 017503   000000 471400 xsym               LDP1    VM_PROFILE$
        19 017504   100011 235100                    LDA     9,,PR1
        19 017505   000006 755100                    STA     6,,PR0

     5164    32213    2       RETURN;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:764  

  32213 19 017506   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 017507   000001 702211                    TSX2  ! 1,X1

     5165    32214    2   END FIX_CONTEXT;
     5166    32215        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:765  
     5167    32216        /*********************************************************************/
     5168    32217        /*F*    NAME:        INIT$SELECT_OPTS
     5169    32218                PURPOSE:     To initialize all SELECTION CRITIERIA tables.
     5170    32219                DESCRIPTION: This includes setting up the MESSAGE SET and
     5171    32220                             saving the parse tree for the TRUTH EXPRESSION.
     5172    32221        */
     5173    32222        /*********************************************************************/
     5174    32223    1   INIT$SELECT_OPTS: PROC (BLK$,COMMAND) ALTRET;

  32223 19 017510   201116 741300       INIT$SELECT* STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     5175    32224        /***** Parameters *****/
     5176    32225    2   DCL BLK$ PTR;
     5177    32226    2   DCL COMMAND UBIN WORD;
     5178    32227        /***** Local variables *****/
     5179    32228    2   DCL PTR1$ PTR STATIC;
     5180    32229    2   DCL PTR2$ PTR STATIC;
     5181    32230    2   DCL VALUE1 SBIN WORD STATIC;
     5182    32231    2   DCL VALUE2 SBIN WORD STATIC;
     5183    32232    2   DCL INDX1 SBIN WORD STATIC;
     5184    32233    2   DCL INDX2 SBIN WORD STATIC;
     5185    32234    2   DCL START_BLK SBIN WORD STATIC;
     5186    32235        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:766  
     5187    32236        /*
     5188    32237             ***** If no options are present,
     5189    32238                   then assume all current. That is,
     5190    32239                   don't do anything ...
     5191    32240        */
     5192    32241    2       START_BLK = 0;

  32241 19 017511   005201 450000 11                 STZ     START_BLK

     5193    32242    2       IF BLK$ -> P$B.NSUBLKS = 0

  32242 19 017512   201117 470500                    LDP0    @BLK$,,AUTO
        19 017513   000000 471500                    LDP1    0,,PR0
        19 017514   100001 220100                    LDX0    1,,PR1
        19 017515   017517 601000 19                 TNZ     s:32252

     5194    32243    2       THEN
     5195    32244    2           RETURN;

  32244 19 017516   000001 702211                    TSX2  ! 1,X1

     5196    32245        /*
     5197    32246             ***** The selection functions work on one of the
     5198    32247                   contexts. Therefore, they must be processed,
     5199    32248                   if they were specified, without initializing
     5200    32249                   the context info. All other selection criteria
     5201    32250                   depend upon a cleanly initialized context area ...
     5202    32251        */
     5203    32252    3       DO CASE (BLK$ -> P$B.SUBLK$(0) -> P$B.CODE);

  32252 19 017517   100003 473500                    LDP3    3,,PR1
        19 017520   300000 236100                    LDQ     0,,PR3
        19 017521   777777 376007                    ANQ     -1,DL
        19 017522   000162 136007                    SBLQ    114,DL
        19 017523   000002 116007                    CMPQ    2,DL
        19 017524   017526 602006 19                 TNC     s:32252+7,QL
        19 017525   017532 710000 19                 TRA     RELATIVE_FUNCTIONS
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:767  
        19 017526   017530 710000 19                 TRA     s:32254
        19 017527   017530 710000 19                 TRA     s:32254

     5204    32253    3       CASE (%SEL_PREVIOUS, %SEL_NEXT);

     5205    32254    3           NEED_TITLE_BAR = %NO#;

  32254 19 017530   000000 450000 xsym               STZ     NEED_TITLE_BAR
        19 017531   017532 710000 19                 TRA     RELATIVE_FUNCTIONS

     5206    32255    3       CASE (ELSE);

     5207    32256    3       END;

     5208    32257    2   RELATIVE_FUNCTIONS:
     5209    32258    3       DO CASE (BLK$ -> P$B.SUBLK$(0) -> P$B.CODE);

  32258 19 017532   000000 471500       RELATIVE_FU* LDP1    0,,PR0
        19 017533   100003 473500                    LDP3    3,,PR1
        19 017534   300000 236100                    LDQ     0,,PR3
        19 017535   777777 376007                    ANQ     -1,DL
        19 017536   000156 136007                    SBLQ    110,DL
        19 017537   000007 116007                    CMPQ    7,DL
        19 017540   017542 602006 19                 TNC     RELATIVE_FUNCTIONS+8,QL
        19 017541   020124 710000 19                 TRA     s:32427
        19 017542   017551 710000 19                 TRA     s:32261
        19 017543   017603 710000 19                 TRA     s:32274
        19 017544   017616 710000 19                 TRA     s:32281
        19 017545   017765 710000 19                 TRA     s:32355
        19 017546   017616 710000 19                 TRA     s:32281
        19 017547   017765 710000 19                 TRA     s:32355
        19 017550   017616 710000 19                 TRA     s:32281

     5210    32259    3       CASE (%SEL_SELECTED);

     5211    32260                            /* Copy the selected context into the current context */
     5212    32261    3           CALL INIT_CONTEXT (%CONTEXT_CURRENT);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:768  

  32261 19 017551   000066 236000 20                 LDQ     54
        19 017552   201123 756100                    STQ     @WHICH_CONTEXT,,AUTO
        19 017553   017442 701000 19                 TSX1    INIT_CONTEXT
        19 017554   000000 011000                    NOP     0

     5213    32262    4           DO INDX1 = 0 TO SELECTED_CONTEXT%.NUM_ENTRIES;

  32262 19 017555   005177 450000 11                 STZ     INDX1
        19 017556   017571 710000 19                 TRA     s:32267+1

     5214    32263    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX1) =

  32263 19 017557   005177 235000 11                 LDA     INDX1
        19 017560   000001 735000                    ALS     1
        19 017561   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 017562   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 017563   000000 620005                    EAX0    0,AL
        19 017564   000005 235105                    LDA     5,AL,PR0
        19 017565   100005 755110                    STA     5,X0,PR1

     5215    32264    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX1);
     5216    32265    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX1) =

  32265 19 017566   000006 235110                    LDA     6,X0,PR0
        19 017567   100006 755110                    STA     6,X0,PR1

     5217    32266    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX1);
     5218    32267    4           END;

  32267 19 017570   005177 054000 11                 AOS     INDX1
        19 017571   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 017572   000002 236100                    LDQ     2,,PR0
        19 017573   017557 604000 19                 TMI     s:32263
        19 017574   005177 116000 11                 CMPQ    INDX1
        19 017575   017557 605000 19                 TPL     s:32263

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:769  
     5219    32268    3           CURRENT_CONTEXT%.NUM_ENTRIES = SELECTED_CONTEXT%.NUM_ENTRIES;

  32268 19 017576   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 017577   100002 756100                    STQ     2,,PR1

     5220    32269    3           CURRENT_CONTEXT%.TRUTH_TREE$ = SELECTED_CONTEXT%.TRUTH_TREE$;

  32269 19 017600   000001 236100                    LDQ     1,,PR0
        19 017601   100001 756100                    STQ     1,,PR1
        19 017602   020125 710000 19                 TRA     s:32429

     5221    32270    3       CASE (%SEL_THIS);

     5222    32271        /*
     5223    32272          **** Already incremented so decrement so that the proper message is obtained.
     5224    32273        */
     5225    32274    3           CURRENT_CONTEXT%.MESSAGE_POINTER = CURRENT_CONTEXT%.MESSAGE_POINTER - 1;

  32274 19 017603   001663 474400 11                 LDP4    CONTEXT_PTR$
        19 017604   000001 336007                    LCQ     1,DL
        19 017605   400000 056100                    ASQ     0,,PR4

     5226    32275    3           CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = SELECTED_CONTEXT%.MESSAGE_POINTER;

  32275 19 017606   001664 471400 11                 LDP1    CONTEXT_PTR$+1
        19 017607   100000 235100                    LDA     0,,PR1
        19 017610   400005 755100                    STA     5,,PR4

     5227    32276    3           CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = SELECTED_CONTEXT%.MESSAGE_POINTER;

  32276 19 017611   100000 235100                    LDA     0,,PR1
        19 017612   400006 755100                    STA     6,,PR4

     5228    32277    3           CURRENT_CONTEXT%.NUM_ENTRIES = 1;

  32277 19 017613   000001 235007                    LDA     1,DL
        19 017614   400002 755100                    STA     2,,PR4
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:770  
        19 017615   020125 710000 19                 TRA     s:32429

     5229    32278    3       CASE (%SEL_FIRST,

     5230    32279    3             %SEL_NEXT,
     5231    32280    3             %SEL_REST);
     5232    32281    3           CALL INIT_CONTEXT (%CONTEXT_CURRENT);

  32281 19 017616   000066 236000 20                 LDQ     54
        19 017617   201123 756100                    STQ     @WHICH_CONTEXT,,AUTO
        19 017620   017442 701000 19                 TSX1    INIT_CONTEXT
        19 017621   000000 011000                    NOP     0

     5233    32282        /*
     5234    32283             ***** If MESSAGE_POINTER has never been set (i.e. -1)
     5235    32284                   or if SEL_FIRST then start from first message ...
     5236    32285        */
     5237    32286    3           IF SELECTED_CONTEXT%.MESSAGE_POINTER = -1

  32286 19 017622   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 017623   000000 235100                    LDA     0,,PR0
        19 017624   000334 115000 20                 CMPA    220
        19 017625   017701 600000 19                 TZE     SELECT_FIRST
        19 017626   201117 471500                    LDP1    @BLK$,,AUTO
        19 017627   100000 473500                    LDP3    0,,PR1
        19 017630   300003 474500                    LDP4    3,,PR3
        19 017631   400000 720100                    LXL0    0,,PR4
        19 017632   000160 100003                    CMPX0   112,DU
        19 017633   017701 600000 19                 TZE     SELECT_FIRST

     5238    32287    3             OR BLK$ -> P$B.SUBLK$(0) -> P$B.CODE = %SEL_FIRST
     5239    32288    3           THEN
     5240    32289    3               GOTO SELECT_FIRST;
     5241    32290        /*
     5242    32291             ***** Determine the first possible message number ...
     5243    32292        */
     5244    32293    4           DO INDX2 = 0 TO SELECTED_CONTEXT%.NUM_ENTRIES - 1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:771  

  32293 19 017634   005200 450000 11                 STZ     INDX2
        19 017635   017650 710000 19                 TRA     s:32300+1

     5245    32294    4               IF SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX2) <=

  32294 19 017636   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 017637   005200 235000 11                 LDA     INDX2
        19 017640   000001 735000                    ALS     1
        19 017641   000005 236105                    LDQ     5,AL,PR0
        19 017642   000000 116100                    CMPQ    0,,PR0
        19 017643   017647 605400 19                 TPNZ    s:32300
        19 017644   000006 236105                    LDQ     6,AL,PR0
        19 017645   000000 116100                    CMPQ    0,,PR0
        19 017646   017654 605000 19                 TPL     s:32301

     5246    32295    4                 SELECTED_CONTEXT%.MESSAGE_POINTER
     5247    32296    4                 AND SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX2) >=
     5248    32297    4                 SELECTED_CONTEXT%.MESSAGE_POINTER
     5249    32298    4               THEN
     5250    32299    4                   EXIT;
     5251    32300    4           END;                       /* Do INDX2 = ... end */

  32300 19 017647   005200 054000 11                 AOS     INDX2
        19 017650   005200 236000 11                 LDQ     INDX2
        19 017651   017636 604000 19                 TMI     s:32294
        19 017652   000002 116100                    CMPQ    2,,PR0
        19 017653   017636 602000 19                 TNC     s:32294

     5252    32301    3           IF SELECTED_CONTEXT%.MESSAGE_POINTER ~=

  32301 19 017654   005200 235000 11                 LDA     INDX2
        19 017655   000001 735000                    ALS     1
        19 017656   000000 236100                    LDQ     0,,PR0
        19 017657   000006 116105                    CMPQ    6,AL,PR0
        19 017660   017672 600000 19                 TZE     s:32321

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:772  
     5253    32302    3             SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX2)
     5254    32303    3           THEN
     5255    32304    4           DO;

     5256    32305        /*
     5257    32306             ***** Use MESSAGE_POINTER + 1 as the beginning ...
     5258    32307        */
     5259    32308    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) =

  32308 19 017661   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 017662   000001 036007                    ADLQ    1,DL
        19 017663   100005 756100                    STQ     5,,PR1

     5260    32309    4                 SELECTED_CONTEXT%.MESSAGE_POINTER + 1;
     5261    32310    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) =

  32310 19 017664   000006 235105                    LDA     6,AL,PR0
        19 017665   100006 755100                    STA     6,,PR1

     5262    32311    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX2);
     5263    32312    4               CURRENT_CONTEXT%.NUM_ENTRIES = 1;

  32312 19 017666   000001 235007                    LDA     1,DL
        19 017667   100002 755100                    STA     2,,PR1

     5264    32313    4               INDX2 = INDX2 + 1;

  32313 19 017670   005200 054000 11                 AOS     INDX2

     5265    32314    4           END;

  32314 19 017671   017700 710000 19                 TRA     s:32331

     5266    32315    3           ELSE
     5267    32316    4           DO;

     5268    32317        /*
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:773  
     5269    32318             ***** Start at the next entry in the MESSAGE_SET
     5270    32319                   if there is one. Otherwise, rest is zero ...
     5271    32320        */
     5272    32321    4               IF INDX2 = SELECTED_CONTEXT%.NUM_ENTRIES - 1

  32321 19 017672   000002 236100                    LDQ     2,,PR0
        19 017673   000001 136007                    SBLQ    1,DL
        19 017674   005200 116000 11                 CMPQ    INDX2
        19 017675   017677 601000 19                 TNZ     s:32328

     5273    32322    4               THEN
     5274    32323    5               DO;

     5275    32324    5                   EXIT RELATIVE_FUNCTIONS;

  32324 19 017676   020125 710000 19                 TRA     s:32429

     5276    32325    5               END;
     5277    32326    4               ELSE
     5278    32327    5               DO;

     5279    32328    5                   INDX2 = INDX2 + 1;

  32328 19 017677   005200 054000 11                 AOS     INDX2

     5280    32329    5               END;

     5281    32330    4           END;

     5282    32331    4           DO NEVER;

  32331 19 017700   017711 710000 19                 TRA     s:32340

     5283    32332    4   SELECT_FIRST:
     5284    32333    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) =

  32333 19 017701   001663 471400 11    SELECT_FIRST LDP1    CONTEXT_PTR$
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:774  
        19 017702   000005 235100                    LDA     5,,PR0
        19 017703   100005 755100                    STA     5,,PR1

     5285    32334    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(0);
     5286    32335    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) =

  32335 19 017704   000006 235100                    LDA     6,,PR0
        19 017705   100006 755100                    STA     6,,PR1

     5287    32336    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(0);
     5288    32337    4               CURRENT_CONTEXT%.NUM_ENTRIES = 1;

  32337 19 017706   000001 236007                    LDQ     1,DL
        19 017707   100002 756100                    STQ     2,,PR1

     5289    32338    4               INDX2 = 1;

  32338 19 017710   005200 756000 11                 STQ     INDX2

     5290    32339    4           END;

     5291    32340    4           DO INDX1 = INDX2 TO SELECTED_CONTEXT%.NUM_ENTRIES - 1;

  32340 19 017711   005200 235000 11                 LDA     INDX2
        19 017712   005177 755000 11                 STA     INDX1
        19 017713   017736 710000 19                 TRA     s:32346+1

     5292    32341    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(CURRENT_CONTEXT%.NUM_ENTRIES) =

  32341 19 017714   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 017715   000002 235100                    LDA     2,,PR0
        19 017716   000001 735000                    ALS     1
        19 017717   005177 236000 11                 LDQ     INDX1
        19 017720   000001 736000                    QLS     1
        19 017721   001664 471400 11                 LDP1    CONTEXT_PTR$+1
        19 017722   000000 620005                    EAX0    0,AL
        19 017723   100005 235106                    LDA     5,QL,PR1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:775  
        19 017724   000005 755110                    STA     5,X0,PR0

     5293    32342    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX1);
     5294    32343    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(CURRENT_CONTEXT%.NUM_ENTRIES) =

  32343 19 017725   000002 235100                    LDA     2,,PR0
        19 017726   000001 735000                    ALS     1
        19 017727   000000 620005                    EAX0    0,AL
        19 017730   100006 235106                    LDA     6,QL,PR1
        19 017731   000006 755110                    STA     6,X0,PR0

     5295    32344    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX1);
     5296    32345    4               CURRENT_CONTEXT%.NUM_ENTRIES = CURRENT_CONTEXT%.NUM_ENTRIES + 1;

  32345 19 017732   000002 235100                    LDA     2,,PR0
        19 017733   000001 035007                    ADLA    1,DL
        19 017734   000002 755100                    STA     2,,PR0

     5297    32346    4           END;                       /* Do INDX1 = ... end */

  32346 19 017735   005177 054000 11                 AOS     INDX1
        19 017736   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 017737   005177 236000 11                 LDQ     INDX1
        19 017740   017714 604000 19                 TMI     s:32341
        19 017741   000002 116100                    CMPQ    2,,PR0
        19 017742   017714 602000 19                 TNC     s:32341

     5298    32347    3           CURRENT_CONTEXT%.TRUTH_TREE$ = SELECTED_CONTEXT%.TRUTH_TREE$;

  32347 19 017743   000001 236100                    LDQ     1,,PR0
        19 017744   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 017745   100001 756100                    STQ     1,,PR1

     5299    32348    4           DO CASE (BLK$ -> P$B.SUBLK$(0) -> P$B.CODE);

  32348 19 017746   201117 473500                    LDP3    @BLK$,,AUTO
        19 017747   300000 474500                    LDP4    0,,PR3
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:776  
        19 017750   400003 475500                    LDP5    3,,PR4
        19 017751   500000 236100                    LDQ     0,,PR5
        19 017752   777777 376007                    ANQ     -1,DL
        19 017753   000160 136007                    SBLQ    112,DL
        19 017754   000003 116007                    CMPQ    3,DL
        19 017755   017757 602006 19                 TNC     s:32348+9,QL
        19 017756   020125 710000 19                 TRA     s:32429
        19 017757   017762 710000 19                 TRA     s:32351
        19 017760   017764 710000 19                 TRA     s:32352
        19 017761   017762 710000 19                 TRA     s:32351

     5300    32349    4           CASE (%SEL_FIRST,

     5301    32350    4             %SEL_NEXT);
     5302    32351    4               CURRENT_CONTEXT%.FLAGS.NEXT = %YES#;

  32351 19 017762   200000 236003                    LDQ     65536,DU
        19 017763   100004 256100                    ORSQ    4,,PR1

     5303    32352    4           END;                        /* Do case ... end */

  32352 19 017764   020125 710000 19                 TRA     s:32429

     5304    32353    3       CASE (%SEL_LAST,

     5305    32354    3             %SEL_PREVIOUS);
     5306    32355    3           CALL INIT_CONTEXT (%CONTEXT_CURRENT);

  32355 19 017765   000066 236000 20                 LDQ     54
        19 017766   201123 756100                    STQ     @WHICH_CONTEXT,,AUTO
        19 017767   017442 701000 19                 TSX1    INIT_CONTEXT
        19 017770   000000 011000                    NOP     0

     5307    32356        /*
     5308    32357             ***** If MESSAGE_POINTER has never been set (i.e. -1)
     5309    32358                   or if SEL_LAST then start from last message ...
     5310    32359        */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:777  
     5311    32360    3           IF SELECTED_CONTEXT%.MESSAGE_POINTER = -1

  32360 19 017771   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 017772   000000 235100                    LDA     0,,PR0
        19 017773   000334 115000 20                 CMPA    220
        19 017774   020051 600000 19                 TZE     SELECT_LAST
        19 017775   201117 471500                    LDP1    @BLK$,,AUTO
        19 017776   100000 473500                    LDP3    0,,PR1
        19 017777   300003 474500                    LDP4    3,,PR3
        19 020000   400000 720100                    LXL0    0,,PR4
        19 020001   000161 100003                    CMPX0   113,DU
        19 020002   020051 600000 19                 TZE     SELECT_LAST

     5312    32361    3             OR BLK$ -> P$B.SUBLK$(0) -> P$B.CODE = %SEL_LAST
     5313    32362    3           THEN
     5314    32363    3               GOTO SELECT_LAST;
     5315    32364        /*
     5316    32365             ***** Determine the last possible message number ...
     5317    32366        */
     5318    32367    4           DO INDX2 = SELECTED_CONTEXT%.NUM_ENTRIES -1 DOWNTO 0;

  32367 19 020003   000002 235100                    LDA     2,,PR0
        19 020004   000001 135007                    SBLA    1,DL
        19 020005   005200 755000 11                 STA     INDX2
        19 020006   020022 710000 19                 TRA     s:32374+2

     5319    32368    4               IF SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX2) <=

  32368 19 020007   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 020010   005200 235000 11                 LDA     INDX2
        19 020011   000001 735000                    ALS     1
        19 020012   000005 236105                    LDQ     5,AL,PR0
        19 020013   000000 116100                    CMPQ    0,,PR0
        19 020014   020020 605400 19                 TPNZ    s:32374
        19 020015   000006 236105                    LDQ     6,AL,PR0
        19 020016   000000 116100                    CMPQ    0,,PR0
        19 020017   020024 605000 19                 TPL     s:32375
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:778  

     5320    32369    4                 SELECTED_CONTEXT%.MESSAGE_POINTER
     5321    32370    4                 AND SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX2) >=
     5322    32371    4                 SELECTED_CONTEXT%.MESSAGE_POINTER
     5323    32372    4               THEN
     5324    32373    4                   EXIT;
     5325    32374    4           END;                       /* Do INDX2 = ... end */

  32374 19 020020   000001 336007                    LCQ     1,DL
        19 020021   005200 056000 11                 ASQ     INDX2
        19 020022   005200 235000 11                 LDA     INDX2
        19 020023   020007 605000 19                 TPL     s:32368

     5326    32375    3           IF SELECTED_CONTEXT%.MESSAGE_POINTER ~=

  32375 19 020024   005200 235000 11                 LDA     INDX2
        19 020025   000001 735000                    ALS     1
        19 020026   000000 236100                    LDQ     0,,PR0
        19 020027   000005 116105                    CMPQ    5,AL,PR0
        19 020030   020043 600000 19                 TZE     s:32395

     5327    32376    3             SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX2)
     5328    32377    3           THEN
     5329    32378    4           DO;

     5330    32379        /*
     5331    32380             ***** Use MESSAGE_POINTER as the beginning ...
     5332    32381        */
     5333    32382    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX2) =

  32382 19 020031   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 020032   100006 756105                    STQ     6,AL,PR1

     5334    32383    4                 SELECTED_CONTEXT%.MESSAGE_POINTER;
     5335    32384    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX2) =

  32384 19 020033   000000 620005                    EAX0    0,AL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:779  
        19 020034   000005 235105                    LDA     5,AL,PR0
        19 020035   100005 755110                    STA     5,X0,PR1

     5336    32385    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX2);
     5337    32386    4               CURRENT_CONTEXT%.NUM_ENTRIES = 1;

  32386 19 020036   000001 235007                    LDA     1,DL
        19 020037   100002 755100                    STA     2,,PR1

     5338    32387    4               INDX2 = INDX2 - 1;

  32387 19 020040   000001 336007                    LCQ     1,DL
        19 020041   005200 056000 11                 ASQ     INDX2

     5339    32388    4           END;

  32388 19 020042   020050 710000 19                 TRA     s:32405

     5340    32389    3           ELSE
     5341    32390    4           DO;

     5342    32391        /*
     5343    32392             ***** Start at the previous entry in the MESSAGE_SET
     5344    32393                   if there is one. Otherwise, rest is zero ...
     5345    32394        */
     5346    32395    4               IF INDX2 = 0

  32395 19 020043   005200 235000 11                 LDA     INDX2
        19 020044   020046 601000 19                 TNZ     s:32402

     5347    32396    4               THEN
     5348    32397    5               DO;

     5349    32398    5                   EXIT RELATIVE_FUNCTIONS;

  32398 19 020045   020125 710000 19                 TRA     s:32429

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:780  
     5350    32399    5               END;
     5351    32400    4               ELSE
     5352    32401    5               DO;

     5353    32402    5                   INDX2 = INDX2 - 1;

  32402 19 020046   000001 336007                    LCQ     1,DL
        19 020047   005200 056000 11                 ASQ     INDX2

     5354    32403    5               END;

     5355    32404    4           END;

     5356    32405    4           DO NEVER;

  32405 19 020050   020070 710000 19                 TRA     s:32415

     5357    32406    4   SELECT_LAST:
     5358    32407    4               INDX2 = SELECTED_CONTEXT%.NUM_ENTRIES - 1;

  32407 19 020051   000002 235100       SELECT_LAST  LDA     2,,PR0
        19 020052   000001 135007                    SBLA    1,DL
        19 020053   005200 755000 11                 STA     INDX2

     5359    32408    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX2) =

  32408 19 020054   000001 735000                    ALS     1
        19 020055   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 020056   000000 620005                    EAX0    0,AL
        19 020057   000005 235105                    LDA     5,AL,PR0
        19 020060   100005 755110                    STA     5,X0,PR1

     5360    32409    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX2);
     5361    32410    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX2) =

  32410 19 020061   000006 235110                    LDA     6,X0,PR0
        19 020062   000001 035007                    ADLA    1,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:781  
        19 020063   100006 755110                    STA     6,X0,PR1

     5362    32411    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX2) + 1;
     5363    32412    4               CURRENT_CONTEXT%.NUM_ENTRIES = 1;

  32412 19 020064   000001 236007                    LDQ     1,DL
        19 020065   100002 756100                    STQ     2,,PR1

     5364    32413    4               INDX2 = INDX2 - 1;

  32413 19 020066   000001 336007                    LCQ     1,DL
        19 020067   005200 056000 11                 ASQ     INDX2

     5365    32414    4           END;

     5366    32415    4           DO INDX1 = INDX2 DOWNTO 0;

  32415 19 020070   005200 235000 11                 LDA     INDX2
        19 020071   005177 755000 11                 STA     INDX1
        19 020072   020112 710000 19                 TRA     s:32421+2

     5367    32416    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX1) =

  32416 19 020073   005177 235000 11                 LDA     INDX1
        19 020074   000001 735000                    ALS     1
        19 020075   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 020076   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 020077   000000 620005                    EAX0    0,AL
        19 020100   000005 235105                    LDA     5,AL,PR0
        19 020101   100005 755110                    STA     5,X0,PR1

     5368    32417    4                 SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX1);
     5369    32418    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX1) =

  32418 19 020102   000006 235110                    LDA     6,X0,PR0
        19 020103   000001 035007                    ADLA    1,DL
        19 020104   100006 755110                    STA     6,X0,PR1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:782  

     5370    32419    4                 SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX1) + 1;
     5371    32420    4               CURRENT_CONTEXT%.NUM_ENTRIES = CURRENT_CONTEXT%.NUM_ENTRIES + 1;

  32420 19 020105   100002 235100                    LDA     2,,PR1
        19 020106   000001 035007                    ADLA    1,DL
        19 020107   100002 755100                    STA     2,,PR1

     5372    32421    4           END;

  32421 19 020110   000001 336007                    LCQ     1,DL
        19 020111   005177 056000 11                 ASQ     INDX1
        19 020112   005177 235000 11                 LDA     INDX1
        19 020113   020073 605000 19                 TPL     s:32416

     5373    32422    3           CURRENT_CONTEXT%.TRUTH_TREE$ = SELECTED_CONTEXT%.TRUTH_TREE$;

  32422 19 020114   000001 236100                    LDQ     1,,PR0
        19 020115   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 020116   100001 756100                    STQ     1,,PR1

     5374    32423    3           CURRENT_CONTEXT%.FLAGS.PREV = %YES#;

  32423 19 020117   100000 236003                    LDQ     32768,DU
        19 020120   100004 256100                    ORSQ    4,,PR1

     5375    32424    3           CURRENT_CONTEXT%.FLAGS.INVERSE = %YES#;

  32424 19 020121   400000 236003                    LDQ     -131072,DU
        19 020122   100004 256100                    ORSQ    4,,PR1
        19 020123   020125 710000 19                 TRA     s:32429

     5376    32425    3       CASE (ELSE);

     5377    32426                                 /* Must be one of the other selection criteria items */
     5378    32427    3           GOTO OTHER_CRITERIA;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:783  
  32427 19 020124   020141 710000 19                 TRA     OTHER_CRITERIA

     5379    32428    3       END;

     5380    32429    2       IF BLK$ -> P$B.NSUBLKS = 2 THEN    /* IE. 'MOVE SEL TO NAME TO FOLDER' */

  32429 19 020125   201117 470500                    LDP0    @BLK$,,AUTO
        19 020126   000000 471500                    LDP1    0,,PR0
        19 020127   100001 220100                    LDX0    1,,PR1
        19 020130   000002 100003                    CMPX0   2,DU
        19 020131   020135 601000 19                 TNZ     s:32434

     5381    32430    3       DO;

     5382    32431    3           START_BLK = 1;

  32431 19 020132   000001 235007                    LDA     1,DL
        19 020133   005201 755000 11                 STA     START_BLK

     5383    32432    3           GOTO FINISH_MOVE_CMD;

  32432 19 020134   020145 710000 19                 TRA     FINISH_MOVE_CMD

     5384    32433    3       END;
     5385    32434    2       WHICH_CONTEXT = %CONTEXT_SELECTED;

  32434 19 020135   000001 235007                    LDA     1,DL
        19 020136   001667 755000 11                 STA     WHICH_CONTEXT

     5386    32435    2       RETURN;

  32435 19 020137   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 020140   000001 702211                    TSX2  ! 1,X1

  32434 19 020141                       OTHER_CRITE* null
     5387    32436        /*
     5388    32437             ***** Process selection criteria other than
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:784  
     5389    32438                   selection functions ...
     5390    32439        */
     5391    32440    2   OTHER_CRITERIA: ;
     5392    32441        /*
     5393    32442             ***** Initialize the current context ...
     5394    32443        */
     5395    32444    2       CALL INIT_CONTEXT (%CONTEXT_CURRENT);

  32444 19 020141   000066 236000 20                 LDQ     54
        19 020142   201123 756100                    STQ     @WHICH_CONTEXT,,AUTO
        19 020143   017442 701000 19                 TSX1    INIT_CONTEXT
        19 020144   000000 011000                    NOP     0

  32434 19 020145                       FINISH_MOVE* null
     5396    32445        /*
     5397    32446             ***** Stuff the message set info into the context table ...
     5398    32447        */
     5399    32448    2   FINISH_MOVE_CMD: ;
     5400    32449    3       DO INDX1 = START_BLK TO BLK$ -> P$B.NSUBLKS - 1;

  32449 19 020145   005201 235000 11                 LDA     START_BLK
        19 020146   005177 755000 11                 STA     INDX1
        19 020147   020364 710000 19                 TRA     s:32509+1

     5401    32450    3           PTR1$ = BLK$ -> P$B.SUBLK$(INDX1);

  32450 19 020150   201117 470500                    LDP0    @BLK$,,AUTO
        19 020151   000000 471500                    LDP1    0,,PR0
        19 020152   005177 720000 11                 LXL0    INDX1
        19 020153   100003 236110                    LDQ     3,X0,PR1
        19 020154   005173 756000 11                 STQ     PTR1$

     5402    32451    4           DO SELECT (PTR1$ -> P$B.CODE);

  32451 19 020155   005173 471400 11                 LDP1    PTR1$
        19 020156   100000 236100                    LDQ     0,,PR1
        19 020157   777777 376007                    ANQ     -1,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:785  
        19 020160   000311 116007                    CMPQ    201,DL
        19 020161   020167 602000 19                 TNC     s:32451+10
        19 020162   020210 600000 19                 TZE     s:32460
        19 020163   100000 721100                    LXL1    0,,PR1
        19 020164   000313 101003                    CMPX1   203,DU
        19 020165   020363 601000 19                 TNZ     s:32509
        19 020166   020173 710000 19                 TRA     s:32453
        19 020167   100000 721100                    LXL1    0,,PR1
        19 020170   000036 101003                    CMPX1   30,DU
        19 020171   020363 601000 19                 TNZ     s:32509
        19 020172   020303 710000 19                 TRA     s:32494

     5403    32452    4               SELECT (%SEL_ALL);

     5404    32453    4               IF COMMAND = %CMD_SELECT_MESSAGE

  32453 19 020173   201120 473500                    LDP3    @COMMAND,,AUTO
        19 020174   300000 235100                    LDA     0,,PR3
        19 020175   000046 115007                    CMPA    38,DL
        19 020176   020201 601000 19                 TNZ     s:32456

     5405    32454    4               THEN
     5406    32455    4                   SELECT_CURRENT = %YES#;

  32455 19 020177   400000 236003                    LDQ     -131072,DU
        19 020200   000403 756000 11                 STQ     SELECT_CURRENT

     5407    32456    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = 1;

  32456 19 020201   000001 236007                    LDQ     1,DL
        19 020202   001663 474400 11                 LDP4    CONTEXT_PTR$
        19 020203   400005 756100                    STQ     5,,PR4

     5408    32457    4               CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = %MAX_MSGNO;

  32457 19 020204   000556 235000 20                 LDA     366
        19 020205   400006 755100                    STA     6,,PR4
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:786  

     5409    32458    4               CURRENT_CONTEXT%.NUM_ENTRIES = 1;

  32458 19 020206   400002 756100                    STQ     2,,PR4
        19 020207   020363 710000 19                 TRA     s:32509

     5410    32459    4               SELECT (%SEL_RANGE);

     5411    32460    4               PTR2$ = PTR1$ -> P$B.SUBLK$(0) -> P$S.TEXTC$;

  32460 19 020210   100003 473500                    LDP3    3,,PR1
        19 020211   300003 236100                    LDQ     3,,PR3
        19 020212   005174 756000 11                 STQ     PTR2$

     5412    32461    4               CALL X$DEC_CONVERT (PTR2$,VALUE1) ALTRET(E_CONVERT);

  32461 19 020213   000626 630400 20                 EPPR0   406
        19 020214   000000 631400 20                 EPPR1   0
        19 020215   000000 701000 xent               TSX1    X$DEC_CONVERT
        19 020216   020513 702000 19                 TSX2    E_CONVERT

     5413    32462    4               IF VALUE1 > %MAX_MSGNO

  32462 19 020217   005175 235000 11                 LDA     VALUE1
        19 020220   000556 115000 20                 CMPA    366
        19 020221   020513 605400 19                 TPNZ    E_CONVERT

     5414    32463    4               THEN
     5415    32464    4                   GOTO E_CONVERT;
     5416    32465    4               CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX1) = VALUE1;

  32465 19 020222   005177 236000 11                 LDQ     INDX1
        19 020223   000001 736000                    QLS     1
        19 020224   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 020225   000005 755106                    STA     5,QL,PR0

     5417    32466        /*
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:787  
     5418    32467             ***** May be a range, not just a single number ..
     5419    32468        */
     5420    32469    4               IF PTR1$ -> P$B.NSUBLKS > 1

  32469 19 020226   005173 471400 11                 LDP1    PTR1$
        19 020227   100001 220100                    LDX0    1,,PR1
        19 020230   000002 100003                    CMPX0   2,DU
        19 020231   020275 602000 19                 TNC     s:32488

     5421    32470    4               THEN
     5422    32471    5               DO;

     5423    32472    5                   PTR2$ = PTR1$ -> P$B.SUBLK$(1) -> P$S.TEXTC$;

  32472 19 020232   100004 473500                    LDP3    4,,PR1
        19 020233   300003 236100                    LDQ     3,,PR3
        19 020234   005174 756000 11                 STQ     PTR2$

     5424    32473    5                   CALL X$DEC_CONVERT (PTR2$,VALUE2) ALTRET(E_CONVERT);

  32473 19 020235   000630 630400 20                 EPPR0   408
        19 020236   000000 631400 20                 EPPR1   0
        19 020237   000000 701000 xent               TSX1    X$DEC_CONVERT
        19 020240   020513 702000 19                 TSX2    E_CONVERT

     5425    32474    5                   IF VALUE2 > %MAX_MSGNO

  32474 19 020241   005176 235000 11                 LDA     VALUE2
        19 020242   000556 115000 20                 CMPA    366
        19 020243   020250 604400 19                 TMOZ    s:32479

     5426    32475    6                   THEN DO;

     5427    32476    6                       PTR1$ = PTR1$ -> P$B.SUBLK$(1);

  32476 19 020244   005173 470400 11                 LDP0    PTR1$
        19 020245   000004 236100                    LDQ     4,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:788  
        19 020246   005173 756000 11                 STQ     PTR1$

     5428    32477    6                       GOTO E_CONVERT;

  32477 19 020247   020513 710000 19                 TRA     E_CONVERT

     5429    32478    6                   END;
     5430    32479    5                   IF VALUE2 < VALUE1

  32479 19 020250   005176 236000 11                 LDQ     VALUE2
        19 020251   005175 116000 11                 CMPQ    VALUE1
        19 020252   020270 605000 19                 TPL     s:32485

     5431    32480    6                   THEN DO;

     5432    32481    6                       CALL XUR$ERRPTR (PTR1$->P$B.CPOS);

  32481 19 020253   005173 236000 11                 LDQ     PTR1$
        19 020254   000002 036003                    ADLQ    2,DU
        19 020255   201706 756100                    STQ     I+100,,AUTO
        19 020256   201706 630500                    EPPR0   I+100,,AUTO
        19 020257   000024 631400 20                 EPPR1   20
        19 020260   000000 701000 xent               TSX1    XUR$ERRPTR
        19 020261   000000 011000                    NOP     0

     5433    32482    6                       CALL XUR$ERRMSG (E_BADRANGE);

  32482 19 020262   000632 630400 20                 EPPR0   410
        19 020263   000024 631400 20                 EPPR1   20
        19 020264   000000 701000 xent               TSX1    XUR$ERRMSG
        19 020265   000000 011000                    NOP     0

     5434    32483    6                       ALTRETURN;

  32483 19 020266   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 020267   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:789  
     5435    32484    6                   END;
     5436    32485    5                   CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX1) = VALUE2;

  32485 19 020270   005177 235000 11                 LDA     INDX1
        19 020271   000001 735000                    ALS     1
        19 020272   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 020273   000006 756105                    STQ     6,AL,PR0

     5437    32486    5               END;

  32486 19 020274   020277 710000 19                 TRA     s:32489

     5438    32487    4               ELSE                 /* Set high = low */
     5439    32488    4                   CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX1) = VALUE1;

  32488 19 020275   005175 235000 11                 LDA     VALUE1
        19 020276   000006 755106                    STA     6,QL,PR0

     5440    32489    4               CURRENT_CONTEXT%.NUM_ENTRIES = CURRENT_CONTEXT%.NUM_ENTRIES + 1;

  32489 19 020277   000002 235100                    LDA     2,,PR0
        19 020300   000001 035007                    ADLA    1,DL
        19 020301   000002 755100                    STA     2,,PR0
        19 020302   020363 710000 19                 TRA     s:32509

     5441    32490    4               SELECT (%SEL_EXP);

     5442    32491        /*
     5443    32492             ***** Transplant the truth tree out of the parse tree area ...
     5444    32493        */
     5445    32494    4               IF (INDX1 = 0 AND BLK$ -> P$B.NSUBLKS = 1)
             32494                        /* IE. 'MOVE TO NAME TO FOLDER' */

  32494 19 020303   005177 235000 11                 LDA     INDX1
        19 020304   020311 601000 19                 TNZ     s:32494+6
        19 020305   000000 473500                    LDP3    0,,PR0
        19 020306   300001 222100                    LDX2    1,,PR3
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:790  
        19 020307   000001 102003                    CMPX2   1,DU
        19 020310   020314 600000 19                 TZE     s:32497
        19 020311   005201 235000 11                 LDA     START_BLK
        19 020312   000001 115007                    CMPA    1,DL
        19 020313   020324 601000 19                 TNZ     s:32501

     5446    32495    4                 OR START_BLK = 1                /* IE. 'MOVE SEL TO NAME TO FOLDER'*/
     5447    32496    5               THEN DO;

     5448    32497    5                   CURRENT_CONTEXT%.NUM_ENTRIES = SELECTED_CONTEXT%.NUM_ENTRIES;

  32497 19 020314   001664 473400 11                 LDP3    CONTEXT_PTR$+1
        19 020315   001663 474400 11                 LDP4    CONTEXT_PTR$
        19 020316   300002 235100                    LDA     2,,PR3
        19 020317   400002 755100                    STA     2,,PR4

     5449    32498    5                  CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = SELECTED_CONTEXT%.MESSAGE_SET.
             32498                            LOW(0);

  32498 19 020320   300005 235100                    LDA     5,,PR3
        19 020321   400005 755100                    STA     5,,PR4

     5450    32499    5                  CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = SELECTED_CONTEXT%.MESSAGE_SET
             32499                            .HIGH(0);

  32499 19 020322   300006 235100                    LDA     6,,PR3
        19 020323   400006 755100                    STA     6,,PR4

     5451    32500    5               END;

     5452    32501    4               X$MCB.FREE_HEAD$ = ADDR(NIL);

  32501 19 020324   000022 236000 20                 LDQ     18
        19 020325   001653 756000 11                 STQ     X$MCB+1

     5453    32502    4               X$MCB.TYPE = 0;       /* Bytes */

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:791  
  32502 19 020326   001657 450000 11                 STZ     X$MCB+5

     5454    32503    4               X$MCB.SEGMENT_BASE$ = ADDR(CURRENT_CONTEXT%.MESSAGE_SET.LOW(
             32503                        CURRENT_CONTEXT%.NUM_ENTRIES+1));

  32503 19 020327   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 020330   100002 235100                    LDA     2,,PR1
        19 020331   000001 735000                    ALS     1
        19 020332   000044 733000                    LRS     36
        19 020333   000022 736000                    QLS     18
        19 020334   000007 036003                    ADLQ    7,DU
        19 020335   001663 036000 11                 ADLQ    CONTEXT_PTR$
        19 020336   001654 756000 11                 STQ     X$MCB+2

     5455    32504    4               X$MCB.HI_SEGMENT$ = X$MCB.SEGMENT_BASE$;

  32504 19 020337   001655 756000 11                 STQ     X$MCB+3

     5456    32505    4              X$MCB.WKSZ = 511 - POFFW(X$MCB.HI_SEGMENT$,CONTEXT_PTR$(%CONTEXT_CURRENT
             32505                        ));

  32505 19 020340   001663 235000 11                 LDA     CONTEXT_PTR$
        19 020341   000022 771000                    ARL     18
        19 020342   201706 755100                    STA     I+100,,AUTO
        19 020343   001655 236000 11                 LDQ     X$MCB+3
        19 020344   000022 772000                    QRL     18
        19 020345   201706 136100                    SBLQ    I+100,,AUTO
        19 020346   000334 676000 20                 ERQ     220
        19 020347   001000 036007                    ADLQ    512,DL
        19 020350   001656 756000 11                 STQ     X$MCB+4

     5457    32506    4               CALL VMS$MOVE_SELECT (X$MCB,PTR1$,CURRENT_CONTEXT%.TRUTH_TREE$) ALTRET(
             32506                        NO_SPACE);

  32506 19 020351   001663 236000 11                 LDQ     CONTEXT_PTR$
        19 020352   000001 036003                    ADLQ    1,DU
        19 020353   201710 756100                    STQ     I+102,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:792  
        19 020354   000634 237000 20                 LDAQ    412
        19 020355   201706 757100                    STAQ    I+100,,AUTO
        19 020356   201706 630500                    EPPR0   I+100,,AUTO
        19 020357   000021 631400 20                 EPPR1   17
        19 020360   000000 701000 xent               TSX1    VMS$MOVE_SELECT
        19 020361   020530 702000 19                 TSX2    NO_SPACE
        19 020362   020363 710000 19                 TRA     s:32509

     5458    32507    4               SELECT (ELSE);

     5459    32508    4           END;                        /* Do case ... end */

     5460    32509    3       END;                            /* Do indx = ... end */

  32509 19 020363   005177 054000 11                 AOS     INDX1
        19 020364   201117 470500                    LDP0    @BLK$,,AUTO
        19 020365   000000 471500                    LDP1    0,,PR0
        19 020366   100001 236100                    LDQ     1,,PR1
        19 020367   000022 772000                    QRL     18
        19 020370   005177 116000 11                 CMPQ    INDX1
        19 020371   020150 605400 19                 TPNZ    s:32450

     5461    32510        /*
     5462    32511             ***** If no message set was specified, then assume
     5463    32512                   all messages in the folder ...
     5464    32513        */
     5465    32514    2       IF CURRENT_CONTEXT%.NUM_ENTRIES = 0

  32514 19 020372   001663 473400 11                 LDP3    CONTEXT_PTR$
        19 020373   300002 235100                    LDA     2,,PR3
        19 020374   020402 601000 19                 TNZ     s:32525

     5466    32515    2       THEN
     5467    32516    3       DO;

     5468    32517    3           CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = 1;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:793  
  32517 19 020375   000001 235007                    LDA     1,DL
        19 020376   300005 755100                    STA     5,,PR3

     5469    32518    3           CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = %MAX_MSGNO;

  32518 19 020377   000556 236000 20                 LDQ     366
        19 020400   300006 756100                    STQ     6,,PR3

     5470    32519    3           CURRENT_CONTEXT%.NUM_ENTRIES = 1;

  32519 19 020401   300002 755100                    STA     2,,PR3

     5471    32520    3       END;

     5472    32521        /*
     5473    32522             ***** If this command modifies the selected context,
     5474    32523                   then copy the current context to the selected context ...
     5475    32524        */
     5476    32525    3       DO CASE (COMMAND);

  32525 19 020402   201120 471500                    LDP1    @COMMAND,,AUTO
        19 020403   100000 235100                    LDA     0,,PR1
        19 020404   000046 135007                    SBLA    38,DL
        19 020405   000001 115007                    CMPA    1,DL
        19 020406   020410 602005 19                 TNC     s:32525+6,AL
        19 020407   020510 710000 19                 TRA     s:32551
        19 020410   020411 710000 19                 TRA     s:32527

     5477    32526    3       CASE (%CMD_SELECT_MESSAGE);

     5478    32527    3           WHICH_CONTEXT = %CONTEXT_SELECTED;

  32527 19 020411   000001 236007                    LDQ     1,DL
        19 020412   001667 756000 11                 STQ     WHICH_CONTEXT

     5479    32528    3           SELECTED_CONTEXT%.MESSAGE_POINTER = CURRENT_CONTEXT%.MESSAGE_POINTER;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:794  
  32528 19 020413   001664 474400 11                 LDP4    CONTEXT_PTR$+1
        19 020414   300000 235100                    LDA     0,,PR3
        19 020415   400000 755100                    STA     0,,PR4

     5480    32529    3           SELECTED_CONTEXT%.NUM_ENTRIES = CURRENT_CONTEXT%.NUM_ENTRIES;

  32529 19 020416   300002 235100                    LDA     2,,PR3
        19 020417   400002 755100                    STA     2,,PR4

     5481    32530    4           DO INDX1 = 0 TO SELECTED_CONTEXT%.NUM_ENTRIES - 1;

  32530 19 020420   005177 450000 11                 STZ     INDX1
        19 020421   020434 710000 19                 TRA     s:32535+1

     5482    32531    4               SELECTED_CONTEXT%.MESSAGE_SET.LOW(INDX1) =

  32531 19 020422   005177 235000 11                 LDA     INDX1
        19 020423   000001 735000                    ALS     1
        19 020424   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 020425   001664 471400 11                 LDP1    CONTEXT_PTR$+1
        19 020426   000000 620005                    EAX0    0,AL
        19 020427   000005 235105                    LDA     5,AL,PR0
        19 020430   100005 755110                    STA     5,X0,PR1

     5483    32532    4                 CURRENT_CONTEXT%.MESSAGE_SET.LOW(INDX1);
     5484    32533    4               SELECTED_CONTEXT%.MESSAGE_SET.HIGH(INDX1) =

  32533 19 020431   000006 235110                    LDA     6,X0,PR0
        19 020432   100006 755110                    STA     6,X0,PR1

     5485    32534    4                 CURRENT_CONTEXT%.MESSAGE_SET.HIGH(INDX1);
     5486    32535    4           END;

  32535 19 020433   005177 054000 11                 AOS     INDX1
        19 020434   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 020435   005177 236000 11                 LDQ     INDX1
        19 020436   020422 604000 19                 TMI     s:32531
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:795  
        19 020437   000002 116100                    CMPQ    2,,PR0
        19 020440   020422 602000 19                 TNC     s:32531

     5487    32536    3           IF CURRENT_CONTEXT%.TRUTH_TREE$ ~= ADDR(NIL)

  32536 19 020441   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 020442   100001 236100                    LDQ     1,,PR1
        19 020443   000022 116000 20                 CMPQ    18
        19 020444   020505 600000 19                 TZE     s:32549

     5488    32537    3           THEN                       /* Transplant the tree again */
     5489    32538    4           DO;

     5490    32539    4               X$MCB.FREE_HEAD$ = ADDR(NIL);

  32539 19 020445   000022 236000 20                 LDQ     18
        19 020446   001653 756000 11                 STQ     X$MCB+1

     5491    32540    4               X$MCB.TYPE = 0;  /* Bytes */

  32540 19 020447   001657 450000 11                 STZ     X$MCB+5

     5492    32541    4               X$MCB.SEGMENT_BASE$ =

  32541 19 020450   000002 235100                    LDA     2,,PR0
        19 020451   000001 735000                    ALS     1
        19 020452   000044 733000                    LRS     36
        19 020453   000022 736000                    QLS     18
        19 020454   000007 036003                    ADLQ    7,DU
        19 020455   001664 036000 11                 ADLQ    CONTEXT_PTR$+1
        19 020456   001654 756000 11                 STQ     X$MCB+2

     5493    32542    4                ADDR(SELECTED_CONTEXT%.MESSAGE_SET.LOW(SELECTED_CONTEXT%.NUM_ENTRIES+1
             32542                          ));
     5494    32543    4               X$MCB.HI_SEGMENT$ = X$MCB.SEGMENT_BASE$;

  32543 19 020457   001655 756000 11                 STQ     X$MCB+3
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:796  

     5495    32544    4               X$MCB.WKSZ = 511 - POFFW(X$MCB.HI_SEGMENT$,CONTEXT_PTR$(%
             32544                        CONTEXT_SELECTED));

  32544 19 020460   001664 235000 11                 LDA     CONTEXT_PTR$+1
        19 020461   000022 771000                    ARL     18
        19 020462   201706 755100                    STA     I+100,,AUTO
        19 020463   001655 236000 11                 LDQ     X$MCB+3
        19 020464   000022 772000                    QRL     18
        19 020465   201706 136100                    SBLQ    I+100,,AUTO
        19 020466   000334 676000 20                 ERQ     220
        19 020467   001000 036007                    ADLQ    512,DL
        19 020470   001656 756000 11                 STQ     X$MCB+4

     5496    32545    4               CALL VMS$MOVE_SELECT (X$MCB,CURRENT_CONTEXT%.TRUTH_TREE$,

  32545 19 020471   001664 236000 11                 LDQ     CONTEXT_PTR$+1
        19 020472   000001 036003                    ADLQ    1,DU
        19 020473   201710 756100                    STQ     I+102,,AUTO
        19 020474   001663 236000 11                 LDQ     CONTEXT_PTR$
        19 020475   000001 036003                    ADLQ    1,DU
        19 020476   000530 235000 20                 LDA     344
        19 020477   201706 757100                    STAQ    I+100,,AUTO
        19 020500   201706 630500                    EPPR0   I+100,,AUTO
        19 020501   000021 631400 20                 EPPR1   17
        19 020502   000000 701000 xent               TSX1    VMS$MOVE_SELECT
        19 020503   020530 702000 19                 TSX2    NO_SPACE

     5497    32546    4                 SELECTED_CONTEXT%.TRUTH_TREE$) ALTRET(NO_SPACE);
     5498    32547    4           END;                  /* Transplant the tree */

  32547 19 020504   020511 710000 19                 TRA     s:32553

     5499    32548    3           ELSE                       /* Remove the tree */
     5500    32549    3               SELECTED_CONTEXT%.TRUTH_TREE$ = ADDR(NIL);

  32549 19 020505   000022 236000 20                 LDQ     18
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:797  
        19 020506   000001 756100                    STQ     1,,PR0
        19 020507   020511 710000 19                 TRA     s:32553

     5501    32550    3       CASE (ELSE);

     5502    32551    3           WHICH_CONTEXT = %CONTEXT_CURRENT;

  32551 19 020510   001667 450000 11                 STZ     WHICH_CONTEXT

     5503    32552    3       END;                             /* Do case ... end */

     5504    32553    2       RETURN;

  32553 19 020511   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 020512   000001 702211                    TSX2  ! 1,X1

     5505    32554        /**/
     5506    32555    2   E_CONVERT:
     5507    32556    2       CALL XUR$ERRPTR (PTR1$->P$B.CPOS);

  32556 19 020513   005173 236000 11    E_CONVERT    LDQ     PTR1$
        19 020514   000002 036003                    ADLQ    2,DU
        19 020515   201706 756100                    STQ     I+100,,AUTO
        19 020516   201706 630500                    EPPR0   I+100,,AUTO
        19 020517   000024 631400 20                 EPPR1   20
        19 020520   000000 701000 xent               TSX1    XUR$ERRPTR
        19 020521   000000 011000                    NOP     0

     5508    32557    2       CALL XUR$ERRMSG (E_BIGNUM);

  32557 19 020522   000636 630400 20                 EPPR0   414
        19 020523   000024 631400 20                 EPPR1   20
        19 020524   000000 701000 xent               TSX1    XUR$ERRMSG
        19 020525   000000 011000                    NOP     0

     5509    32558    2       ALTRETURN;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:798  
  32558 19 020526   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 020527   000000 702211                    TSX2  ! 0,X1

     5510    32559        /**/
     5511    32560    2   NO_SPACE:
     5512    32561    2       CALL XUR$ERRMSG (E_MEMERR);

  32561 19 020530   000637 630400 20    NO_SPACE     EPPR0   415
        19 020531   000024 631400 20                 EPPR1   20
        19 020532   000000 701000 xent               TSX1    XUR$ERRMSG
        19 020533   000000 011000                    NOP     0

     5513    32562    2       ALTRETURN;

  32562 19 020534   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 020535   000000 702211                    TSX2  ! 0,X1

     5514    32563    2   END INIT$SELECT_OPTS;
     5515    32564        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:799  
     5516    32565        /*********************************************************************/
     5517    32566        /*F*    NAME:        GET$MESSAGE
     5518    32567                PURPOSE:     To get the next message to process.
     5519    32568                DESCRIPTION: This routine looks at the RANGE SPECIFICATION
     5520    32569                             and then gets the header for each message in
     5521    32570                             turn and then calls VMS$SELECT which determines
     5522    32571                             if the particular message matches the requesed
     5523    32572                             SELECTION EXPRESSION. This routine continues
     5524    32573                             until (1) a message matching all criteria is
     5525    32574                             found, (2) No messages are found.
     5526    32575        */
     5527    32576        /*********************************************************************/
     5528    32577    1   GET$MESSAGE: PROC ALTRET;

  32577 19 020536   201116 741300       GET$MESSAGE  STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     5529    32578
     5530    32579    2   DCL INDX SBIN WORD STATIC;
     5531    32580    2   DCL VALUE SBIN WORD STATIC;
     5532    32581    2   DCL RESULT$ PTR STATIC;
     5533    32582    2   DCL STATUS_SAVE BIT(1);
     5534    32583
     5535    32584        /*
     5536    32585             ***** If there are no entries in the current context
     5537    32586                   then there are no messages selected. Go back ...
     5538    32587        */
     5539    32588    2       IF CURRENT_CONTEXT%.NUM_ENTRIES = 0

  32588 19 020537   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 020540   000002 235100                    LDA     2,,PR0
        19 020541   020543 601000 19                 TNZ     s:32595

     5540    32589    2       THEN
     5541    32590    2           ALTRETURN;

  32590 19 020542   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:800  
     5542    32591        /*
     5543    32592             ***** If inverse order is specified
     5544    32593                   then go backwards thru the list ...
     5545    32594        */
     5546    32595    2       IF CURRENT_CONTEXT%.FLAGS.INVERSE

  32595 19 020543   000004 234100                    SZN     4,,PR0
        19 020544   021004 604000 19                 TMI     PROCESS_INVERSE

     5547    32596    2       THEN
     5548    32597    2           GOTO PROCESS_INVERSE;
     5549    32598    2       IF CURRENT_CONTEXT%.SET_INDX = -1

  32598 19 020545   000003 235100                    LDA     3,,PR0
        19 020546   000334 115000 20                 CMPA    220
        19 020547   020771 600000 19                 TZE     BUMP_CONTEXT_INDX

     5550    32599    2       THEN                            /* Set to first entry */
     5551    32600    2           GOTO BUMP_CONTEXT_INDX;
     5552    32601    3       DO WHILE (CURRENT_CONTEXT%.SET_INDX < CURRENT_CONTEXT%.NUM_ENTRIES);

  32601 19 020550   000003 236100                    LDQ     3,,PR0
        19 020551   020554 604000 19                 TMI     s:32603
        19 020552   000002 116100                    CMPQ    2,,PR0
        19 020553   021003 603000 19                 TRC     s:32723

     5553    32602    4           DO FOREVER;

     5554    32603    4               CURRENT_MESSAGE_NUMBER = CURRENT_MESSAGE_NUMBER + 1;

  32603 19 020554   000072 054000 11                 AOS     CURRENT_MESSAGE_NUMBER

     5555    32604    4               IF CURRENT_MESSAGE_NUMBER <

  32604 19 020555   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 020556   000003 235100                    LDA     3,,PR0
        19 020557   000001 735000                    ALS     1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:801  
        19 020560   000072 236000 11                 LDQ     CURRENT_MESSAGE_NUMBER
        19 020561   000005 116105                    CMPQ    5,AL,PR0
        19 020562   020771 604000 19                 TMI     BUMP_CONTEXT_INDX
        19 020563   000003 235100                    LDA     3,,PR0
        19 020564   000001 735000                    ALS     1
        19 020565   000006 116105                    CMPQ    6,AL,PR0
        19 020566   020771 605400 19                 TPNZ    BUMP_CONTEXT_INDX

     5556    32605    4                 CURRENT_CONTEXT%.MESSAGE_SET.LOW(CURRENT_CONTEXT%.SET_INDX)
     5557    32606    4                 OR CURRENT_MESSAGE_NUMBER >
     5558    32607    4                 CURRENT_CONTEXT%.MESSAGE_SET.HIGH(CURRENT_CONTEXT%.SET_INDX)
     5559    32608    4               THEN                 /* Outside the range. Get another */
     5560    32609    4                   GOTO BUMP_CONTEXT_INDX;
     5561    32610                            /* Looks like its in range.  Get it.  Then test to see if
     5562    32611                               we got one that is still in range. */
     5563    32612    4               IF SELECT_CURRENT THEN SELECTED_CONTEXT%.MESSAGE_POINTER =
             32612                        CURRENT_MESSAGE_NUMBER;

  32612 19 020567   000403 234000 11                 SZN     SELECT_CURRENT
        19 020570   020573 605000 19                 TPL     s:32613

  32612 19 020571   001664 471400 11                 LDP1    CONTEXT_PTR$+1
        19 020572   100000 756100                    STQ     0,,PR1

     5564    32613    4               CALL VMD$GET_HEADER_NEXT (CURRENT_MESSAGE_NUMBER,

  32613 19 020573   000120 630400 20                 EPPR0   80
        19 020574   000000 631400 20                 EPPR1   0
        19 020575   000000 701000 xent               TSX1    VMD$GET_HEADER_NEXT
        19 020576   020600 702000 19                 TSX2    s:32620
        19 020577   020607 710000 19                 TRA     s:32626

     5565    32614    4                 M$MAIL_FILE_NUM)
     5566    32615    4               WHENALTRETURN
     5567    32616        /*
     5568    32617          **** Altreturn if there are no more messages to process.
     5569    32618        */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:802  
     5570    32619    5               DO;

     5571    32620    5                   IF CURRENT_CONTEXT%.SET_INDX + 1 < CURRENT_CONTEXT%.

  32620 19 020600   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 020601   000003 236100                    LDQ     3,,PR0
        19 020602   000001 036007                    ADLQ    1,DL
        19 020603   020771 604000 19                 TMI     BUMP_CONTEXT_INDX
        19 020604   000002 116100                    CMPQ    2,,PR0
        19 020605   020771 602000 19                 TNC     BUMP_CONTEXT_INDX

     5572    32621    5                     NUM_ENTRIES THEN
     5573    32622    5                       GOTO BUMP_CONTEXT_INDX; /* Get next */
     5574    32623    5                   ELSE
     5575    32624    5                       GOTO NO_HEADER;

  32624 19 020606   021113 710000 19                 TRA     NO_HEADER

     5576    32625    5               END;
     5577    32626    4               IF VM_HEADER.UNIQUE_ID$ = ADDR(NIL)

  32626 19 020607   000000 470400 xsym               LDP0    VM_HEADER$
        19 020610   000032 236100                    LDQ     26,,PR0
        19 020611   000022 116000 20                 CMPQ    18
        19 020612   020636 601000 19                 TNZ     s:32636
        19 020613   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 020614   020636 605000 19                 TPL     s:32636

     5578    32627    4                 AND VM_CURRENT_FOLDER.FLAGS.UPDATE
     5579    32628    5               THEN DO;

     5580    32629    5                   CALL ASSIGN_A_MESSAGE_ID

  32629 19 020615   021216 701000 19                 TSX1    ASSIGN_A_MESSAGE_ID
        19 020616   020636 702000 19                 TSX2    s:32636

     5581    32630    6                   WHENRETURN DO;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:803  

     5582    32631    6                       CALL VMD$PUT_HEADER (CURRENT_MESSAGE_NUMBER, M$MAIL_FILE_NUM);

  32631 19 020617   000120 630400 20                 EPPR0   80
        19 020620   000000 631400 20                 EPPR1   0
        19 020621   000000 701000 xent               TSX1    VMD$PUT_HEADER
        19 020622   000000 011000                    NOP     0

     5583    32632    6                       CALL VMD$PUT_ID (VM_HEADER.UNIQUE_ID$ -> X$STRING,

  32632 19 020623   000000 470400 xsym               LDP0    VM_HEADER$
        19 020624   000032 471500                    LDP1    26,,PR0
        19 020625   000103 236000 20                 LDQ     67
        19 020626   201710 756100                    STQ     I+102,,AUTO
        19 020627   000053 236000 20                 LDQ     43
        19 020630   201707 756100                    STQ     I+101,,AUTO
        19 020631   201706 451500                    STP1    I+100,,AUTO
        19 020632   201706 630500                    EPPR0   I+100,,AUTO
        19 020633   000021 631400 20                 EPPR1   17
        19 020634   000000 701000 xent               TSX1    VMD$PUT_ID
        19 020635   000000 011000                    NOP     0

     5584    32633    6                         M$MAIL_FILE_NUM, CURRENT_MESSAGE_NUMBER);
     5585    32634    6                   END;

     5586    32635    5               END;

     5587    32636    4               IF CURRENT_MESSAGE_NUMBER <

  32636 19 020636   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 020637   000003 235100                    LDA     3,,PR0
        19 020640   000001 735000                    ALS     1
        19 020641   000072 236000 11                 LDQ     CURRENT_MESSAGE_NUMBER
        19 020642   000005 116105                    CMPQ    5,AL,PR0
        19 020643   020771 604000 19                 TMI     BUMP_CONTEXT_INDX
        19 020644   000003 235100                    LDA     3,,PR0
        19 020645   000001 735000                    ALS     1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:804  
        19 020646   000006 116105                    CMPQ    6,AL,PR0
        19 020647   020771 605400 19                 TPNZ    BUMP_CONTEXT_INDX

     5588    32637    4                 CURRENT_CONTEXT%.MESSAGE_SET.LOW(CURRENT_CONTEXT%.SET_INDX)
     5589    32638    4                 OR CURRENT_MESSAGE_NUMBER >
     5590    32639    4                 CURRENT_CONTEXT%.MESSAGE_SET.HIGH(CURRENT_CONTEXT%.SET_INDX)
     5591    32640    4               THEN                 /* Outside the range. Get another */
     5592    32641    4                   GOTO BUMP_CONTEXT_INDX;
     5593    32642        /*
     5594    32643             ***** Check truth expression ...
     5595    32644        */
     5596    32645    4               IF CURRENT_CONTEXT%.TRUTH_TREE$ ~= ADDR(NIL)

  32645 19 020650   000001 236100                    LDQ     1,,PR0
        19 020651   000022 116000 20                 CMPQ    18
        19 020652   020756 600000 19                 TZE     s:32688

     5597    32646    4               THEN
     5598    32647    5               DO;

     5599    32648    5                   CALL VMS$SELECT (CURRENT_CONTEXT%.TRUTH_TREE$,

  32648 19 020653   000640 236000 20                 LDQ     416
        19 020654   201710 756100                    STQ     I+102,,AUTO
        19 020655   000641 236000 20                 LDQ     417
        19 020656   201707 756100                    STQ     I+101,,AUTO
        19 020657   001663 236000 11                 LDQ     CONTEXT_PTR$
        19 020660   000001 036003                    ADLQ    1,DU
        19 020661   201706 756100                    STQ     I+100,,AUTO
        19 020662   201706 630500                    EPPR0   I+100,,AUTO
        19 020663   000021 631400 20                 EPPR1   17
        19 020664   000000 701000 xent               TSX1    VMS$SELECT
        19 020665   021115 702000 19                 TSX2    E_EVAL

     5600    32649    5                     VM_SELECT,RESULT$) ALTRET(E_EVAL);
     5601    32650    5                   CALL X$DEC_CONVERT (RESULT$,VALUE) ALTRET(E_DEC);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:805  
  32650 19 020666   000642 630400 20                 EPPR0   418
        19 020667   000000 631400 20                 EPPR1   0
        19 020670   000000 701000 xent               TSX1    X$DEC_CONVERT
        19 020671   021127 702000 19                 TSX2    E_DEC

     5602    32651    5                   IF VALUE <= 0 THEN

  32651 19 020672   005203 235000 11                 LDA     VALUE
        19 020673   020756 605400 19                 TPNZ    s:32688

     5603    32652    6                   DO;

     5604    32653        /*
     5605    32654          **** If the selection criterion includes exam and the message was just
     5606    32655          **** displayed, delete the record anyway.
     5607    32656        */
     5608    32657    6                       IF CURR_COMMAND_CODE = %CMD_DELETE_MESSAGE THEN

  32657 19 020674   000543 236000 11                 LDQ     CURR_COMMAND_CODE
        19 020675   000012 116007                    CMPQ    10,DL
        19 020676   020770 601000 19                 TNZ     GET_NEXT_CONTEXT

     5609    32658    7                       DO;

     5610    32659    7                           STATUS_SAVE = VM_HEADER.STATUS.EXAM;

  32659 19 020677   000000 470400 xsym               LDP0    VM_HEADER$
        19 020700   000012 236100                    LDQ     10,,PR0
        19 020701   000010 736000                    QLS     8
        19 020702   400000 376003                    ANQ     -131072,DU
        19 020703   201117 756100                    STQ     STATUS_SAVE,,AUTO

     5611    32660    7                           VM_HEADER.STATUS.EXAM = ~VM_HEADER.STATUS.EXAM;

  32660 19 020704   400000 676003                    ERQ     -131072,DU
        19 020705   000010 772000                    QRL     8
        19 020706   000012 676100                    ERQ     10,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:806  
        19 020707   001000 376003                    ANQ     512,DU
        19 020710   000012 656100                    ERSQ    10,,PR0

     5612    32661        /*
     5613    32662          **** Determine if it was the exam criterion that failed the test.
     5614    32663          **** If it was, then if it was just displayed, delete it.
     5615    32664        */
     5616    32665    7                           CALL VMS$SELECT (CURRENT_CONTEXT%.

  32665 19 020711   000640 236000 20                 LDQ     416
        19 020712   201710 756100                    STQ     I+102,,AUTO
        19 020713   000641 236000 20                 LDQ     417
        19 020714   201707 756100                    STQ     I+101,,AUTO
        19 020715   001663 236000 11                 LDQ     CONTEXT_PTR$
        19 020716   000001 036003                    ADLQ    1,DU
        19 020717   201706 756100                    STQ     I+100,,AUTO
        19 020720   201706 630500                    EPPR0   I+100,,AUTO
        19 020721   000021 631400 20                 EPPR1   17
        19 020722   000000 701000 xent               TSX1    VMS$SELECT
        19 020723   020725 702000 19                 TSX2    s:32669
        19 020724   020734 710000 19                 TRA     s:32672

     5617    32666    7                             TRUTH_TREE$,VM_SELECT,RESULT$)
     5618    32667    7                           WHENALTRETURN
     5619    32668    8                           DO;

     5620    32669    8                               VM_HEADER.STATUS.EXAM = STATUS_SAVE;

  32669 19 020725   000000 470400 xsym               LDP0    VM_HEADER$
        19 020726   201117 236100                    LDQ     STATUS_SAVE,,AUTO
        19 020727   000010 772000                    QRL     8
        19 020730   000012 676100                    ERQ     10,,PR0
        19 020731   001000 376003                    ANQ     512,DU
        19 020732   000012 656100                    ERSQ    10,,PR0

     5621    32670    8                               GOTO E_EVAL;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:807  
  32670 19 020733   021115 710000 19                 TRA     E_EVAL

     5622    32671    8                           END;
     5623    32672    7                           VM_HEADER.STATUS.EXAM = STATUS_SAVE;

  32672 19 020734   000000 470400 xsym               LDP0    VM_HEADER$
        19 020735   201117 236100                    LDQ     STATUS_SAVE,,AUTO
        19 020736   000010 772000                    QRL     8
        19 020737   000012 676100                    ERQ     10,,PR0
        19 020740   001000 376003                    ANQ     512,DU
        19 020741   000012 656100                    ERSQ    10,,PR0

     5624    32673    7                           CALL X$DEC_CONVERT (RESULT$,

  32673 19 020742   000642 630400 20                 EPPR0   418
        19 020743   000000 631400 20                 EPPR1   0
        19 020744   000000 701000 xent               TSX1    X$DEC_CONVERT
        19 020745   021127 702000 19                 TSX2    E_DEC

     5625    32674    7                             VALUE) ALTRET(E_DEC);
     5626    32675    7                           IF VALUE <= 0 THEN

  32675 19 020746   005203 235000 11                 LDA     VALUE
        19 020747   020770 604400 19                 TMOZ    GET_NEXT_CONTEXT

     5627    32676    7                               GOTO GET_NEXT_CONTEXT;
     5628    32677    7                           IF NOT VM_HEADER.STATUS.MAKE_OLD THEN

  32677 19 020750   000000 470400 xsym               LDP0    VM_HEADER$
        19 020751   000012 236100                    LDQ     10,,PR0
        19 020752   002000 316003                    CANQ    1024,DU
        19 020753   020770 600000 19                 TZE     GET_NEXT_CONTEXT

     5629    32678    7                               GOTO GET_NEXT_CONTEXT;
     5630    32679    7                           EXIT; /* Candidate for deletion */

  32679 19 020754   020755 710000 19                 TRA     s:32679+1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:808  
        19 020755   020756 710000 19                 TRA     s:32688

     5631    32680    7                       END;
     5632    32681    6                       ELSE
     5633    32682    6                           GOTO GET_NEXT_CONTEXT;
     5634    32683    6                   END;
     5635    32684    5               END;
     5636    32685        /*
     5637    32686             ***** Save the context MESSAGE_POINTER ...
     5638    32687        */
     5639    32688    4               CONTEXT_PTR$(WHICH_CONTEXT)->VM$CONTEXT.MESSAGE_POINTER =

  32688 19 020756   001667 720000 11                 LXL0    WHICH_CONTEXT
        19 020757   001663 470410 11                 LDP0    CONTEXT_PTR$,X0
        19 020760   000072 235000 11                 LDA     CURRENT_MESSAGE_NUMBER
        19 020761   000000 755100                    STA     0,,PR0

     5640    32689    4                 CURRENT_MESSAGE_NUMBER;
     5641    32690        /*
     5642    32691             ***** If next was specified,
     5643    32692                   then only this message is desired.
     5644    32693                   Forget the rest of the messages ...
     5645    32694        */
     5646    32695    4               IF CURRENT_CONTEXT%.FLAGS.NEXT

  32695 19 020762   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 020763   100004 236100                    LDQ     4,,PR1
        19 020764   200000 316003                    CANQ    65536,DU
        19 020765   020767 600000 19                 TZE     s:32703

     5647    32696    4               THEN
     5648    32697    5               DO;

     5649    32698    5                   GOTO MAKE_NEW_CONTEXT;

  32698 19 020766   021131 710000 19                 TRA     MAKE_NEW_CONTEXT

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:809  
     5650    32699    5               END;
     5651    32700        /*
     5652    32701             ***** Message matches all criteria ...
     5653    32702        */
     5654    32703    4               GOTO RETURN_MESSAGE;

  32703 19 020767   021142 710000 19                 TRA     RETURN_MESSAGE

     5655    32704    4   GET_NEXT_CONTEXT:
     5656    32705    4           END;                       /* Do forever ... end */

  32705 19 020770   020554 710000 19    GET_NEXT_CO* TRA     s:32603

     5657    32706        /*
     5658    32707             ***** Bump the context SET_INDX ...
     5659    32708        */
     5660    32709    3   BUMP_CONTEXT_INDX:
     5661    32710    3           CURRENT_CONTEXT%.SET_INDX = CURRENT_CONTEXT%.SET_INDX + 1;

  32710 19 020771   000003 054100       BUMP_CONTEX* AOS     3,,PR0

     5662    32711        /*
     5663    32712             ***** Set CURRENT_MESSAGE_NUMBER to point to the next
     5664    32713                   message to be selected. Since it will be incrimented
     5665    32714                   by one (due to normal entry conditions) it must be
     5666    32715                   decrimented by one here ...
     5667    32716        */
     5668    32717    3           CURRENT_MESSAGE_NUMBER =

  32717 19 020772   000003 235100                    LDA     3,,PR0
        19 020773   000001 735000                    ALS     1
        19 020774   000005 235105                    LDA     5,AL,PR0
        19 020775   000001 135007                    SBLA    1,DL
        19 020776   000072 755000 11                 STA     CURRENT_MESSAGE_NUMBER

     5669    32718    3             CURRENT_CONTEXT%.MESSAGE_SET.LOW(CURRENT_CONTEXT%.SET_INDX) - 1;
     5670    32719    3       END;                            /* Do while ... end */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:810  

  32719 19 020777   000003 236100                    LDQ     3,,PR0
        19 021000   020554 604000 19                 TMI     s:32603
        19 021001   000002 116100                    CMPQ    2,,PR0
        19 021002   020554 602000 19                 TNC     s:32603

     5671    32720        /*
     5672    32721             ***** Unable to find anything that matches ...
     5673    32722        */
     5674    32723    2       GOTO NO_HEADER;

  32723 19 021003   021113 710000 19                 TRA     NO_HEADER

     5675    32724        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:811  
     5676    32725    2   PROCESS_INVERSE:
     5677    32726    2       IF CURRENT_CONTEXT%.SET_INDX = -1

  32726 19 021004   000003 235100       PROCESS_INV* LDA     3,,PR0
        19 021005   000334 115000 20                 CMPA    220
        19 021006   021012 601000 19                 TNZ     s:32732

     5678    32727    2       THEN                            /* Set to first entry */
     5679    32728    3       DO;

     5680    32729    3           CURRENT_CONTEXT%.SET_INDX = CURRENT_CONTEXT%.NUM_ENTRIES;

  32729 19 021007   000002 235100                    LDA     2,,PR0
        19 021010   000003 755100                    STA     3,,PR0

     5681    32730    3           GOTO BUMP_CONTEXT_INVERSE;

  32730 19 021011   021103 710000 19                 TRA     BUMP_CONTEXT_INVERSE

     5682    32731    3       END;
     5683    32732    3       DO WHILE (CURRENT_CONTEXT%.SET_INDX >= 0);

  32732 19 021012   000000 115003                    CMPA    0,DU
        19 021013   021113 604000 19                 TMI     NO_HEADER

     5684    32733    4           DO FOREVER;

     5685    32734    4               IF SELECT_CURRENT THEN SELECTED_CONTEXT%.MESSAGE_POINTER =
             32734                        CURRENT_MESSAGE_NUMBER;

  32734 19 021014   000403 234000 11                 SZN     SELECT_CURRENT
        19 021015   021021 605000 19                 TPL     s:32735

  32734 19 021016   001664 470400 11                 LDP0    CONTEXT_PTR$+1
        19 021017   000072 235000 11                 LDA     CURRENT_MESSAGE_NUMBER
        19 021020   000000 755100                    STA     0,,PR0

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:812  
     5686    32735    4               CALL VMD$GET_HEADER_PREV (CURRENT_MESSAGE_NUMBER,

  32735 19 021021   000120 630400 20                 EPPR0   80
        19 021022   000000 631400 20                 EPPR1   0
        19 021023   000000 701000 xent               TSX1    VMD$GET_HEADER_PREV
        19 021024   021026 702000 19                 TSX2    s:32742
        19 021025   021032 710000 19                 TRA     s:32747

     5687    32736    4                 M$MAIL_FILE_NUM)
     5688    32737    4               WHENALTRETURN
     5689    32738        /*
     5690    32739          **** Altreturn if there are no more messages to process.
     5691    32740        */
     5692    32741    5               DO;

     5693    32742    5                   IF CURRENT_CONTEXT%.SET_INDX - 1 >= 0 THEN

  32742 19 021026   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 021027   000003 235100                    LDA     3,,PR0
        19 021030   021103 605400 19                 TPNZ    BUMP_CONTEXT_INVERSE

     5694    32743    5                       GOTO BUMP_CONTEXT_INVERSE;
     5695    32744    5                   ELSE
     5696    32745    5                       GOTO NO_HEADER;

  32745 19 021031   021113 710000 19                 TRA     NO_HEADER

     5697    32746    5               END;
     5698    32747    4               IF CURRENT_MESSAGE_NUMBER <

  32747 19 021032   001663 470400 11                 LDP0    CONTEXT_PTR$
        19 021033   000003 235100                    LDA     3,,PR0
        19 021034   000001 735000                    ALS     1
        19 021035   000072 236000 11                 LDQ     CURRENT_MESSAGE_NUMBER
        19 021036   000005 116105                    CMPQ    5,AL,PR0
        19 021037   021103 604000 19                 TMI     BUMP_CONTEXT_INVERSE
        19 021040   000003 235100                    LDA     3,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:813  
        19 021041   000001 735000                    ALS     1
        19 021042   000006 116105                    CMPQ    6,AL,PR0
        19 021043   021103 605400 19                 TPNZ    BUMP_CONTEXT_INVERSE

     5699    32748    4                 CURRENT_CONTEXT%.MESSAGE_SET.LOW(CURRENT_CONTEXT%.SET_INDX)
     5700    32749    4                 OR CURRENT_MESSAGE_NUMBER >
     5701    32750    4                 CURRENT_CONTEXT%.MESSAGE_SET.HIGH(CURRENT_CONTEXT%.SET_INDX)
     5702    32751    4               THEN                 /* Outside the range. Get another */
     5703    32752    4                   GOTO BUMP_CONTEXT_INVERSE;
     5704    32753        /*
     5705    32754             ***** Check truth expression ...
     5706    32755        */
     5707    32756    4               IF CURRENT_CONTEXT%.TRUTH_TREE$ ~= ADDR(NIL)

  32756 19 021044   000001 236100                    LDQ     1,,PR0
        19 021045   000022 116000 20                 CMPQ    18
        19 021046   021070 600000 19                 TZE     s:32769

     5708    32757    4               THEN
     5709    32758    5               DO;

     5710    32759    5                   CALL VMS$SELECT (CURRENT_CONTEXT%.TRUTH_TREE$,

  32759 19 021047   000640 236000 20                 LDQ     416
        19 021050   201710 756100                    STQ     I+102,,AUTO
        19 021051   000641 236000 20                 LDQ     417
        19 021052   201707 756100                    STQ     I+101,,AUTO
        19 021053   001663 236000 11                 LDQ     CONTEXT_PTR$
        19 021054   000001 036003                    ADLQ    1,DU
        19 021055   201706 756100                    STQ     I+100,,AUTO
        19 021056   201706 630500                    EPPR0   I+100,,AUTO
        19 021057   000021 631400 20                 EPPR1   17
        19 021060   000000 701000 xent               TSX1    VMS$SELECT
        19 021061   021115 702000 19                 TSX2    E_EVAL

     5711    32760    5                     VM_SELECT,RESULT$) ALTRET(E_EVAL);
     5712    32761    5                   CALL X$DEC_CONVERT (RESULT$,VALUE) ALTRET(E_DEC);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:814  

  32761 19 021062   000642 630400 20                 EPPR0   418
        19 021063   000000 631400 20                 EPPR1   0
        19 021064   000000 701000 xent               TSX1    X$DEC_CONVERT
        19 021065   021127 702000 19                 TSX2    E_DEC

     5713    32762    5                   IF VALUE <= 0

  32762 19 021066   005203 235000 11                 LDA     VALUE
        19 021067   021102 604400 19                 TMOZ    GET_PREV_CONTEXT

     5714    32763    5                   THEN
     5715    32764    5                       GOTO GET_PREV_CONTEXT;
     5716    32765    5               END;

     5717    32766        /*
     5718    32767             ***** Save the context MESSAGE_POINTER ...
     5719    32768        */
     5720    32769    4               CONTEXT_PTR$(WHICH_CONTEXT)->VM$CONTEXT.MESSAGE_POINTER =

  32769 19 021070   001667 720000 11                 LXL0    WHICH_CONTEXT
        19 021071   001663 470410 11                 LDP0    CONTEXT_PTR$,X0
        19 021072   000072 235000 11                 LDA     CURRENT_MESSAGE_NUMBER
        19 021073   000000 755100                    STA     0,,PR0

     5721    32770    4                 CURRENT_MESSAGE_NUMBER;
     5722    32771        /*
     5723    32772             ***** If previous was specified,
     5724    32773                   then only this message is desired.
     5725    32774                   Forget the rest of the messages ...
     5726    32775        */
     5727    32776    4               IF CURRENT_CONTEXT%.FLAGS.PREV

  32776 19 021074   001663 471400 11                 LDP1    CONTEXT_PTR$
        19 021075   100004 236100                    LDQ     4,,PR1
        19 021076   100000 316003                    CANQ    32768,DU
        19 021077   021101 600000 19                 TZE     s:32784
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:815  

     5728    32777    4               THEN
     5729    32778    5               DO;

     5730    32779    5                   GOTO MAKE_NEW_CONTEXT;

  32779 19 021100   021131 710000 19                 TRA     MAKE_NEW_CONTEXT

     5731    32780    5               END;
     5732    32781        /*
     5733    32782             ***** Message matches all criteria ...
     5734    32783        */
     5735    32784    4               GOTO RETURN_MESSAGE;

  32784 19 021101   021142 710000 19                 TRA     RETURN_MESSAGE

     5736    32785    4   GET_PREV_CONTEXT:
     5737    32786    4           END;                       /* Do forever ... end */

  32786 19 021102   021014 710000 19    GET_PREV_CO* TRA     s:32734

     5738    32787        /*
     5739    32788             ***** Bump the context SET_INDX ...
     5740    32789        */
     5741    32790    3   BUMP_CONTEXT_INVERSE:
     5742    32791    3           CURRENT_CONTEXT%.SET_INDX = CURRENT_CONTEXT%.SET_INDX - 1;

  32791 19 021103   000001 336007       BUMP_CONTEX* LCQ     1,DL
        19 021104   000003 056100                    ASQ     3,,PR0

     5743    32792        /*
     5744    32793             ***** Set CURRENT_MESSAGE_NUMBER to point to the next
     5745    32794                   message to be selected. ...
     5746    32795        */
     5747    32796    3           CURRENT_MESSAGE_NUMBER =

  32796 19 021105   000003 235100                    LDA     3,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:816  
        19 021106   000001 735000                    ALS     1
        19 021107   000006 235105                    LDA     6,AL,PR0
        19 021110   000072 755000 11                 STA     CURRENT_MESSAGE_NUMBER

     5748    32797    3             CURRENT_CONTEXT%.MESSAGE_SET.HIGH(CURRENT_CONTEXT%.SET_INDX);
     5749    32798    3       END;                            /* Do while ... end */

  32798 19 021111   000003 235100                    LDA     3,,PR0
        19 021112   021014 605000 19                 TPL     s:32734

     5750    32799        /*
     5751    32800             ***** Unable to find anything that matches ...
     5752    32801        */
     5753    32802    2   NO_HEADER:
     5754    32803    2       ALTRETURN;

  32803 19 021113   201116 221300       NO_HEADER    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 021114   000000 702211                    TSX2  ! 0,X1

     5755    32804        /**/
     5756    32805    2   E_EVAL:
     5757    32806    2       CALL XUR$ERRPTR (VM_SELECT.ERR_POS#);

  32806 19 021115   000644 630400 20    E_EVAL       EPPR0   420
        19 021116   000024 631400 20                 EPPR1   20
        19 021117   000000 701000 xent               TSX1    XUR$ERRPTR
        19 021120   000000 011000                    NOP     0

     5758    32807    2       CALL XUR$ERRMSG (VM_SELECT.ERROR);

  32807 19 021121   000641 630400 20                 EPPR0   417
        19 021122   000024 631400 20                 EPPR1   20
        19 021123   000000 701000 xent               TSX1    XUR$ERRMSG
        19 021124   000000 011000                    NOP     0

     5759    32808    2       ALTRETURN;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:817  
  32808 19 021125   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 021126   000000 702211                    TSX2  ! 0,X1

     5760    32809        /**/
     5761    32810    2   E_DEC:
     5762    32811                                                /* Add call with E_NONDECIMAL */
     5763    32812    2       ALTRETURN;

  32812 19 021127   201116 221300       E_DEC        LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 021130   000000 702211                    TSX2  ! 0,X1

     5764    32813        /*
     5765    32814             ***** Change the current context to contain only
     5766    32815                   the current message. Only for next and previous ...
     5767    32816        */
     5768    32817    2   MAKE_NEW_CONTEXT:
     5769    32818    2       CURRENT_CONTEXT%.NUM_ENTRIES = 1;

  32818 19 021131   000001 235007       MAKE_NEW_CO* LDA     1,DL
        19 021132   100002 755100                    STA     2,,PR1

     5770    32819    2       CURRENT_CONTEXT%.SET_INDX = 2;     /* Signal that all have been found */

  32819 19 021133   000002 235007                    LDA     2,DL
        19 021134   100003 755100                    STA     3,,PR1

     5771    32820    2       CURRENT_CONTEXT%.MESSAGE_SET.LOW(0) = CURRENT_MESSAGE_NUMBER;

  32820 19 021135   000072 235000 11                 LDA     CURRENT_MESSAGE_NUMBER
        19 021136   100005 755100                    STA     5,,PR1

     5772    32821    2       CURRENT_CONTEXT%.MESSAGE_SET.HIGH(0) = CURRENT_MESSAGE_NUMBER;

  32821 19 021137   000072 235000 11                 LDA     CURRENT_MESSAGE_NUMBER
        19 021140   100006 755100                    STA     6,,PR1

     5773    32822    2       CURRENT_CONTEXT%.FLAGS = %NO#;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:818  

  32822 19 021141   100004 450100                    STZ     4,,PR1

     5774    32823    2   RETURN_MESSAGE:
     5775    32824    2       IF SELECT_CURRENT THEN SELECTED_CONTEXT%.MESSAGE_POINTER =
             32824                CURRENT_MESSAGE_NUMBER;

  32824 19 021142   000403 234000 11    RETURN_MESS* SZN     SELECT_CURRENT
        19 021143   021147 605000 19                 TPL     s:32825

  32824 19 021144   001664 473400 11                 LDP3    CONTEXT_PTR$+1
        19 021145   000072 235000 11                 LDA     CURRENT_MESSAGE_NUMBER
        19 021146   300000 755100                    STA     0,,PR3

     5776    32825    2       VM_HEADRES.RES# = CURRENT_MESSAGE_NUMBER;

  32825 19 021147   000000 100400                    MLR     fill='000'O
        19 021150   000072 000004 11                 ADSC9   CURRENT_MESSAGE_NUMBER   cn=0,n=4
        19 021151   001740 200004 11                 ADSC9   VM_HEADRES               cn=1,n=4

     5777    32826    2       CALL M$ENQ (ENQ_HEAD)

  32826 19 021152   000330 630400 12                 EPPR0   ENQ_HEAD
        19 021153   420002 713400                    CLIMB   alt,+8194
        19 021154   401000 401760                    pmme    nvectors=3
        19 021155   021157 702000 19                 TSX2    s:32828
        19 021156   021204 710000 19                 TRA     s:32835

     5778    32827    3       WHENALTRETURN DO;

     5779    32828    3           IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$TIMELIMIT

  32828 19 021157   000000 470400 xsym               LDP0    B$TCB$
        19 021160   000000 471500                    LDP1    0,,PR0
        19 021161   100102 236100                    LDQ     66,,PR1
        19 021162   377770 376007                    ANQ     131064,DL
        19 021163   014420 116007                    CMPQ    6416,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:819  
        19 021164   021204 601000 19                 TNZ     s:32835

     5780    32829    4           THEN DO;

     5781    32830    4               CALL VMD$DI_HEADER(VM_HEADER,CURRENT_MESSAGE_NUMBER,M$ME_NUM);

  32830 19 021165   000033 236000 20                 LDQ     27
        19 021166   201710 756100                    STQ     I+102,,AUTO
        19 021167   000103 236000 20                 LDQ     67
        19 021170   000000 235000 xsym               LDA     VM_HEADER$
        19 021171   201706 757100                    STAQ    I+100,,AUTO
        19 021172   201706 630500                    EPPR0   I+100,,AUTO
        19 021173   000021 631400 20                 EPPR1   17
        19 021174   000000 701000 xent               TSX1    VMD$DI_HEADER
        19 021175   000000 011000                    NOP     0

     5782    32831    4               CALL XUR$ERRMSG (E_INPROG);

  32831 19 021176   000645 630400 20                 EPPR0   421
        19 021177   000024 631400 20                 EPPR1   20
        19 021200   000000 701000 xent               TSX1    XUR$ERRMSG
        19 021201   000000 011000                    NOP     0

     5783    32832    4               ALTRETURN;

  32832 19 021202   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 021203   000000 702211                    TSX2  ! 0,X1

     5784    32833    4           END;
     5785    32834    3       END;
     5786    32835    3       CALL M$DEQ (DEQ_HEAD) WHENALTRETURN DO;

  32835 19 021204   000342 630400 12                 EPPR0   DEQ_HEAD
        19 021205   420003 713400                    CLIMB   alt,+8195
        19 021206   401000 401760                    pmme    nvectors=3
        19 021207   021211 702000 19                 TSX2    s:32837
        19 021210   021211 710000 19                 TRA     s:32837
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:820  

     5787    32836    3       END;

     5788    32837    2       NUM_MESSAGES_PROCESSED = NUM_MESSAGES_PROCESSED + 1;;

  32837 19 021211   201101 235100                    LDA     NUM_MESSAGES_PROCESSED,,AUTO
        19 021212   000001 035007                    ADLA    1,DL
        19 021213   201101 755100                    STA     NUM_MESSAGES_PROCESSED,,AUTO

     5789    32838    2       RETURN;

  32838 19 021214   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 021215   000001 702211                    TSX2  ! 1,X1

     5790    32839    2   END GET$MESSAGE;
     5791    32840        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:821  
     5792    32841    1   ASSIGN_A_MESSAGE_ID: PROC ALTRET;

  32841 19 021216   201120 741300       ASSIGN_A_ME* STX1  ! @COMMAND,,AUTO

     5793    32842
     5794    32843        /*
     5795    32844             ***** Construct a unique-ID string for this message, and put it
     5796    32845                   in the header.  The strings take the form:
     5797    32846
     5798    32847                 <yymmdd.hhmmssss@CP6>
     5799    32848
     5800    32849                   This code is executed when MAIL first processes any message
     5801    32850                   that does not already have a unique ID;  such messages may include
     5802    32851                   MAILMAN-generated packets such as ERRs and DELIVs, as well as
     5803    32852                   messages that originate in pre-B00 mail environments.
     5804    32853        */
     5805    32854
     5806    32855        %XUM$MCB (NAME=HEADER_MCB, STCLASS=AUTO);
     5807    32859
     5808    32860    2       WORK_UTS = VM_HEADER.CREATION_DATE;

  32860 19 021217   000000 470400 xsym               LDP0    VM_HEADER$
        19 021220   000001 235100                    LDA     1,,PR0
        19 021221   000376 755000 11                 STA     WORK_UTS

     5809    32861    2       CALL M$TIME (GET_ANSI_TIME);

  32861 19 021222   000270 630400 12                 EPPR0   GET_ANSI_TIME
        19 021223   020004 713400                    CLIMB   8196
        19 021224   402000 401760                    pmme    nvectors=5

     5810    32862    2       CALL CONCAT (ID, '<', ANSI_DATE, '.', ANSI_TIME, '@CP6>');

  32862 19 021225   074000 236003                    LDQ     30720,DU
        19 021226   200350 756100                    STQ     ID,,AUTO
        19 021227   040100 100400                    MLR     fill='040'O
        19 021230   000540 000006 11                 ADSC9   ANSI_DATE                cn=0,n=6
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:822  
        19 021231   200350 200006                    ADSC9   ID,,AUTO                 cn=1,n=6
        19 021232   000056 236007                    LDQ     46,DL
        19 021233   200351 552104                    STBQ    ID+1,'04'O,AUTO
        19 021234   000536 237000 11                 LDAQ    ANSI_TIME
        19 021235   200352 757100                    STAQ    ID+2,,AUTO
        19 021236   040100 100400                    MLR     fill='040'O
        19 021237   001376 000005 12                 ADSC9   VM_PROKEY+17             cn=0,n=5
        19 021240   200354 000757                    ADSC9   ID+4,,AUTO               cn=0,n=495

     5811    32863    2       CALL INDEX (COUNT, ' ', ID);

  32863 19 021241   000000 124500                    SCM     mask='000'O
        19 021242   200350 000777                    ADSC9   ID,,AUTO                 cn=0,n=511
        19 021243   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 021244   200550 000100                    ARG     COUNT,,AUTO

     5812    32864    2       HEADER_MCB.SIZE = COUNT + 1;

  32864 19 021245   200550 235100                    LDA     COUNT,,AUTO
        19 021246   000001 035007                    ADLA    1,DL
        19 021247   201127 755100                    STA     INDX2+3,,AUTO

     5813    32865    2       HEADER_MCB.TYPE = 0;

  32865 19 021250   201126 450100                    STZ     INDX2+2,,AUTO

     5814    32866    2       HEADER_MCB.MIN_SIZE = 3;

  32866 19 021251   000003 236007                    LDQ     3,DL
        19 021252   201130 756100                    STQ     INDX2+4,,AUTO

     5815    32867    2       HEADER_MCB.SEGMENT_BASE$ = VM_HEADER$;

  32867 19 021253   000000 236000 xsym               LDQ     VM_HEADER$
        19 021254   201123 756100                    STQ     @WHICH_CONTEXT,,AUTO

     5816    32868    2       HEADER_MCB.HI_SEGMENT$ = VM_HEADER.NEXT$;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:823  

  32868 19 021255   000000 470400 xsym               LDP0    VM_HEADER$
        19 021256   000016 236100                    LDQ     14,,PR0
        19 021257   201124 756100                    STQ     CFLEN+1,,AUTO

     5817    32869    2       HEADER_MCB.FREE_HEAD$ = VM_HEADER.FREE$;

  32869 19 021260   000015 236100                    LDQ     13,,PR0
        19 021261   201122 756100                    STQ     @CODE,,AUTO

     5818    32870    2       HEADER_MCB.WKSZ = VM_HEADER.HEADER_SIZE;

  32870 19 021262   000000 235100                    LDA     0,,PR0
        19 021263   201125 755100                    STA     INDX2+1,,AUTO

     5819    32871    2       CALL X$ALLOCATE (HEADER_MCB) ALTRET (E_ALLOCATE);

  32871 19 021264   201121 631500                    EPPR1   HEADER_MCB,,AUTO
        19 021265   201706 451500                    STP1    I+100,,AUTO
        19 021266   201706 630500                    EPPR0   I+100,,AUTO
        19 021267   000024 631400 20                 EPPR1   20
        19 021270   000000 701000 xent               TSX1    X$ALLOCATE
        19 021271   021316 702000 19                 TSX2    E_ALLOCATE

     5820    32872    2       VM_HEADER.NEXT$ = PINCRW(HEADER_MCB.HI_SEGMENT$,1);

  32872 19 021272   201124 236100                    LDQ     CFLEN+1,,AUTO
        19 021273   000001 036003                    ADLQ    1,DU
        19 021274   000000 470400 xsym               LDP0    VM_HEADER$
        19 021275   000016 756100                    STQ     14,,PR0

     5821    32873    2       VM_HEADER.UNIQUE_ID$ = HEADER_MCB.ADDRESS$;

  32873 19 021276   201121 236100                    LDQ     HEADER_MCB,,AUTO
        19 021277   000032 756100                    STQ     26,,PR0

     5822    32874    2       VM_HEADER.UNIQUE_ID$ -> X$STRING.SIZ = COUNT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:824  

  32874 19 021300   000032 471500                    LDP1    26,,PR0
        19 021301   000100 101500                    MRL     fill='000'O
        19 021302   200550 000004                    ADSC9   COUNT,,AUTO              cn=0,n=4
        19 021303   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     5823    32875    2       VM_HEADER.UNIQUE_ID$ -> X$STRING.TEXT = ID;

  32875 19 021304   000032 471500                    LDP1    26,,PR0
        19 021305   000100 101500                    MRL     fill='000'O
        19 021306   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 021307   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 021310   201706 220100                    LDX0    I+100,,AUTO
        19 021311   040140 100500                    MLR     fill='040'O
        19 021312   200350 000777                    ADSC9   ID,,AUTO                 cn=0,n=511
        19 021313   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0

     5824    32876
     5825    32877    2       RETURN;

  32877 19 021314   201120 221300                    LDX1  ! @COMMAND,,AUTO
        19 021315   000001 702211                    TSX2  ! 1,X1

     5826    32878
     5827    32879    2   E_ALLOCATE:
     5828    32880    2       ALTRETURN;

  32880 19 021316   201120 221300       E_ALLOCATE   LDX1  ! @COMMAND,,AUTO
        19 021317   000000 702211                    TSX2  ! 0,X1

     5829    32881
     5830    32882    2   END ASSIGN_A_MESSAGE_ID;
     5831    32883        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:825  
     5832    32884        /*****************************************************************/
     5833    32885        /*F*      NAME: PUT_PROFILE
     5834    32886                  PURPOSE: Write the profile record to a folder
     5835    32887                  DESCRIPTION: Merges the new profile info from mail with
     5836    32888                               the new message counts from mailman.  Test
     5837    32889                               for new messages and notifies user if found.
     5838    32890
     5839    32891        */
     5840    32892        /*****************************************************************/
     5841    32893    1   PUT_PROFILE: PROC(DCB#) ALTRET;

  32893 19 021320   201522 741300       PUT_PROFILE  STX1  ! INDX2+254,,AUTO

     5842    32894    2   DCL DCB# UBIN;
     5843    32895    2   DCL CHECK BIT(1);
     5844    32896        %FPT_READ (FPTN=READ_PROFILE,KEY=VM_PROKEY,KEYS=YES,STCLASS=STATIC);
     5845    32935        %VM_PROFILE (NAME=VM_PROSTUB,STCLASS=AUTO); /* Big enuff for fixed fields */
     5846    33022        %VM_PROKEY (STCLASS=CONSTANT);
     5847    33037    2       CHECK = '0'B;

  33037 19 021321   201524 450100                    STZ     CHECK,,AUTO

     5848    33038    2       if VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B then return;

  33038 19 021322   001266 236000 11                 LDQ     VM_CURRENT_FOLDER+19
        19 021323   010000 316003                    CANQ    4096,DU
        19 021324   021326 601000 19                 TNZ     s:33039

  33038 19 021325   000001 702211                    TSX2  ! 1,X1

     5849    33039    2       GOTO COMMON;

  33039 19 021326   021332 710000 19                 TRA     COMMON

     5850    33040        /*F*      NAME: CHECK_NEW
     5851    33041                  PURPOSE: checks to see if new mail has been stuffed.
     5852    33042                  DESCRIPTION: reads the fixed portion of the profile record
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:826  
     5853    33043                               and tests the new message counts from mailman.
     5854    33044
     5855    33045        */
     5856    33046    2   CHECK_NEW: ENTRY(DCB#) ALTRET;

  33046 19 021327   201522 741300       CHECK_NEW    STX1  ! INDX2+254,,AUTO

     5857    33047    2       CHECK='1'B;

  33047 19 021330   400000 236003                    LDQ     -131072,DU
        19 021331   201524 756100                    STQ     CHECK,,AUTO

     5858    33048    2   COMMON:
     5859    33049    2       READ_PROFILE.V.DCB# = DCB#;

  33049 19 021332   201523 470500       COMMON       LDP0    @DCB#,,AUTO
        19 021333   000000 720100                    LXL0    0,,PR0
        19 021334   005216 740000 11                 STX0    READ_PROFILE+8

     5860    33050    2       READ_PROFILE.BUF_ = VECTOR(VM_PROSTUB);

  33050 19 021335   000646 235000 20                 LDA     422
        19 021336   201706 452500                    STP2    I+100,,AUTO
        19 021337   201706 236100                    LDQ     I+100,,AUTO
        19 021340   001525 036003                    ADLQ    853,DU
        19 021341   005212 757000 11                 STAQ    READ_PROFILE+4

     5861    33051    3       IF ~ CHECK THEN DO;

  33051 19 021342   201524 236100                    LDQ     CHECK,,AUTO
        19 021343   400000 376003                    ANQ     -131072,DU
        19 021344   400000 676003                    ERQ     -131072,DU
        19 021345   021354 600000 19                 TZE     s:33055

     5862    33052    3           ENQ_PROFILE.V.DCB# = DCB#;

  33052 19 021346   000000 722100                    LXL2    0,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:827  
        19 021347   001720 742000 11                 STX2    ENQ_PROFILE+6

     5863    33053    3           CALL M$ENQ (ENQ_PROFILE) ALTRET(ALT);

  33053 19 021350   001712 630400 11                 EPPR0   ENQ_PROFILE
        19 021351   420002 713400                    CLIMB   alt,+8194
        19 021352   401000 401760                    pmme    nvectors=3
        19 021353   021444 702000 19                 TSX2    ALT

     5864    33054    3       END;

     5865    33055    2       CALL M$READ (READ_PROFILE)        /* Get fixed fields */

  33055 19 021354   005206 630400 11                 EPPR0   READ_PROFILE
        19 021355   440000 713400                    CLIMB   alt,read
        19 021356   401400 401760                    pmme    nvectors=4
        19 021357   021361 702000 19                 TSX2    s:33057
        19 021360   021367 710000 19                 TRA     s:33059

     5866    33056    3       WHENALTRETURN DO;

     5867    33057    3           IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$LD THEN GOTO ALT1;

  33057 19 021361   000000 470400 xsym               LDP0    B$TCB$
        19 021362   000000 471500                    LDP1    0,,PR0
        19 021363   100102 236100                    LDQ     66,,PR1
        19 021364   377770 376007                    ANQ     131064,DL
        19 021365   000070 116007                    CMPQ    56,DL
        19 021366   021434 601000 19                 TNZ     ALT1

     5868    33058    3       END;

     5869    33059    2       IF VM_PROFILE.HI_MESSAGE_NUMBER < VM_PROSTUB.HI_MESSAGE_NUMBER

  33059 19 021367   000000 470400 xsym               LDP0    VM_PROFILE$
        19 021370   000011 236100                    LDQ     9,,PR0
        19 021371   201536 116100                    CMPQ    I+1,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:828  
        19 021372   021376 603000 19                 TRC     s:33063

     5870    33060    2       THEN
     5871    33061    2           NEW_FLAG = %YES#;

  33061 19 021373   400000 236003                    LDQ     -131072,DU
        19 021374   000377 756000 11                 STQ     NEW_FLAG
        19 021375   021377 710000 19                 TRA     s:33064

     5872    33062    2       ELSE
     5873    33063    2           NEW_FLAG = %NO#;

  33063 19 021376   000377 450000 11                 STZ     NEW_FLAG

     5874    33064    2       VM_PROFILE.NUM_MESSAGES = VM_PROSTUB.NUM_MESSAGES;

  33064 19 021377   201532 235100                    LDA     STASH_LEN+1,,AUTO
        19 021400   000005 755100                    STA     5,,PR0

     5875    33065    2       VM_PROFILE.NUM_NEW_MESSAGES = VM_PROSTUB.NUM_NEW_MESSAGES;

  33065 19 021401   201533 236100                    LDQ     STASH$+1,,AUTO
        19 021402   000006 756100                    STQ     6,,PR0

     5876    33066    2       IF MADE_OLD

  33066 19 021403   200040 234100                    SZN     MADE_OLD,,AUTO
        19 021404   021410 605000 19                 TPL     s:33071

     5877    33067    3       THEN DO;

     5878    33068    3           VM_PROFILE.NUM_NEW_MESSAGES = VM_PROFILE.NUM_NEW_MESSAGES - 1;

  33068 19 021405   000001 136007                    SBLQ    1,DL
        19 021406   000006 756100                    STQ     6,,PR0

     5879    33069    3           MADE_OLD = %NO#;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:829  

  33069 19 021407   200040 450100                    STZ     MADE_OLD,,AUTO

     5880    33070    3       END;

     5881    33071    2       VM_PROFILE.HI_MESSAGE_NUMBER = VM_PROSTUB.HI_MESSAGE_NUMBER;

  33071 19 021410   201536 235100                    LDA     I+1,,AUTO
        19 021411   000011 755100                    STA     9,,PR0

     5882    33072    3       IF ~ CHECK THEN DO;

  33072 19 021412   201524 236100                    LDQ     CHECK,,AUTO
        19 021413   400000 376003                    ANQ     -131072,DU
        19 021414   400000 676003                    ERQ     -131072,DU
        19 021415   021432 600000 19                 TZE     s:33078

     5883    33073    3           CALL VMD$PUT_PROFILE(DCB#) ALTRET(ALT1);

  33073 19 021416   201523 630500                    EPPR0   @DCB#,,AUTO
        19 021417   000024 631400 20                 EPPR1   20
        19 021420   000000 701000 xent               TSX1    VMD$PUT_PROFILE
        19 021421   021434 702000 19                 TSX2    ALT1

     5884    33074    3           DEQ_PROFILE.V.DCB# = DCB#;

  33074 19 021422   201523 470500                    LDP0    @DCB#,,AUTO
        19 021423   000000 720100                    LXL0    0,,PR0
        19 021424   001732 740000 11                 STX0    DEQ_PROFILE+6

     5885    33075    4           CALL M$DEQ (DEQ_PROFILE) WHENALTRETURN DO;

  33075 19 021425   001724 630400 11                 EPPR0   DEQ_PROFILE
        19 021426   420003 713400                    CLIMB   alt,+8195
        19 021427   401000 401760                    pmme    nvectors=3
        19 021430   021432 702000 19                 TSX2    s:33078
        19 021431   021432 710000 19                 TRA     s:33078
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:830  

     5886    33076    4           END;

     5887    33077    3       END;

     5888    33078    2       RETURN;

  33078 19 021432   201522 221300                    LDX1  ! INDX2+254,,AUTO
        19 021433   000001 702211                    TSX2  ! 1,X1

     5889    33079    2   ALT1:
     5890    33080    2       DEQ_PROFILE.V.DCB# = DCB#;

  33080 19 021434   201523 470500       ALT1         LDP0    @DCB#,,AUTO
        19 021435   000000 720100                    LXL0    0,,PR0
        19 021436   001732 740000 11                 STX0    DEQ_PROFILE+6

     5891    33081    3       CALL M$DEQ (DEQ_PROFILE) WHENALTRETURN DO;

  33081 19 021437   001724 630400 11                 EPPR0   DEQ_PROFILE
        19 021440   420003 713400                    CLIMB   alt,+8195
        19 021441   401000 401760                    pmme    nvectors=3
        19 021442   021444 702000 19                 TSX2    ALT
        19 021443   021444 710000 19                 TRA     ALT

     5892    33082    3       END;

     5893    33083    2   ALT: ALTRETURN;

  33083 19 021444   201522 221300       ALT          LDX1  ! INDX2+254,,AUTO
        19 021445   000000 702211                    TSX2  ! 0,X1

     5894    33084    2   END PUT_PROFILE;
     5895    33085        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:831  
     5896    33086        /********************************************************************/
     5897    33087        /*I* NAME: UPDATE$MAIL
     5898    33088             DESCRIPTION: Deletes all messages that have been marked as
     5899    33089                          DELETEd. It will RENUMBER the messages as necessary.
     5900    33090                          It will also reclaim unused granules as required.
     5901    33091        *********************************************************************/
     5902    33092    1   UPDATE$MAIL: PROC (RENUMBER#,HEADER_FIELD#);

  33092 19 021446   201116 741300       UPDATE$MAIL  STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     5903    33093        /*
     5904    33094             ***** EQUs for RENUMBER options ...
     5905    33095
     5906    33096        %EQU REN_OPT_DATE = 1;
     5907    33097        %EQU REN_OPT_FROM = 2;
     5908    33098        %EQU REN_OPT_REF  = 3;
     5909    33099        %EQU REN_OPT_SUBJ = 4;
     5910    33100        %EQU REN_OPT_TO   = 5;  */
     5911    33101    2   DCL INDX UBIN WORD STATIC;
     5912    33102    2   DCL NEXT_NUM UBIN WORD STATIC;
     5913    33103    2   DCL RECS_DELETED UBIN WORD STATIC;
     5914    33104    2   DCL RENUMBER# BIT(1);
     5915    33105    2   DCL HEADER_FIELD# UBIN HALF HALIGNED;
     5916    33106        %FPT_OPEN (FPTN=RENUM_OPEN,
     5917    33107                  ASN=FILE,
     5918    33108                  ORG=KEYED,
     5919    33109                  SHARE=NONE,
     5920    33110                  FUN=UPDATE,
     5921    33111                  STCLASS=STATIC);
     5922    33220        %FPT_READ (FPTN=READ_OLD, STCLASS=STATIC,
     5923    33221                  DCB=M$MAIL_FILE,
     5924    33222                  KEY=VLP_KEY,
     5925    33223                  KEYS=NO,
     5926    33224                  KEYR=YES);
     5927    33263        %FPT_WRITE (FPTN=WRITE_NEW, STCLASS=STATIC,
     5928    33264                  DCB=M$WORK,
     5929    33265                  KEY=VLP_KEY);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:832  
     5930    33296    2   DCL 1 VLP_KEY STATIC,
     5931    33297    2         2 COUNT UBIN(9) CALIGNED,
     5932    33298    2         2 TYPE UBIN(9) CALIGNED,
     5933    33299    2         2 NUM UBIN WORD CALIGNED,
     5934    33300    2         2 * CHAR(249);
     5935    33301    2   DCL FPARAM_AREA CHAR(1024) AUTO DALIGNED;
     5936    33302        %VLP_NAME (FPTN=FID_NAME);
     5937    33329
     5938    33330    2       IF VM_CURRENT_FOLDER.FLAGS.UPDATE = %NO#

  33330 19 021447   001266 234000 11                 SZN     VM_CURRENT_FOLDER+19
        19 021450   021452 604000 19                 TMI     s:33333

     5939    33331    2       THEN
     5940    33332    2           RETURN;

  33332 19 021451   000001 702211                    TSX2  ! 1,X1

     5941    33333    2       CALL XUR$DISABLE;

  33333 19 021452   000020 631400 20                 EPPR1   16
        19 021453   000000 701000 xent               TSX1    XUR$DISABLE
        19 021454   000000 011000                    NOP     0

     5942    33334    2       CALL PUT_PROFILE (M$MAIL_FILE_NUM);

  33334 19 021455   000053 236000 20                 LDQ     43
        19 021456   201523 756100                    STQ     @DCB#,,AUTO
        19 021457   021320 701000 19                 TSX1    PUT_PROFILE
        19 021460   000000 011000                    NOP     0

     5943    33335    2       CALL M$ENQ(ENQ_PROFILE);

  33335 19 021461   001712 630400 11                 EPPR0   ENQ_PROFILE
        19 021462   020002 713400                    CLIMB   8194
        19 021463   401000 401760                    pmme    nvectors=3

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:833  
     5944    33336    2       RECS_DELETED=0;

  33336 19 021464   005226 450000 11                 STZ     RECS_DELETED

     5945    33337    2       IF VM_PROFILE.HIGH_RECS < VM_CURRENT_FOLDER.NRECS THEN VM_PROFILE.HIGH_RECS =
             33337                VM_CURRENT_FOLDER.NRECS;

  33337 19 021465   000000 470400 xsym               LDP0    VM_PROFILE$
        19 021466   000136 236100                    LDQ     94,,PR0
        19 021467   001264 116000 11                 CMPQ    VM_CURRENT_FOLDER+17
        19 021470   021473 603000 19                 TRC     s:33345

  33337 19 021471   001264 235000 11                 LDA     VM_CURRENT_FOLDER+17
        19 021472   000136 755100                    STA     94,,PR0

     5946    33338        /*N* Currently, all of this happens while enqueued. In the future, try
     5947    33339         to make in smarter */
     5948    33340        /*
     5949    33341             ***** If there are any messages that were new and
     5950    33342                   were marked old, or any messages were deleted,
     5951    33343                   then fix them up now ...
     5952    33344        */
     5953    33345    2       IF VM_PROFILE.NUM_DEL_MESSAGES = 0

  33345 19 021473   000007 235100                    LDA     7,,PR0
        19 021474   021477 601000 19                 TNZ     s:33352
        19 021475   000010 235100                    LDA     8,,PR0
        19 021476   021560 600000 19                 TZE     NO_MORE

     5954    33346    2         AND VM_PROFILE.NUM_MOLD_MESSAGES = 0
     5955    33347    2       THEN                            /* No messages to delete */
     5956    33348    2           GOTO NO_MORE;
     5957    33349        /*
     5958    33350             ***** Delete the messages marked for deletion ...
     5959    33351        */
     5960    33352    2       INDX = 0;                         /* Position before first message */

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:834  
  33352 19 021477   005224 450000 11                 STZ     INDX

     5961    33353    2       VM_PROFILE.NUM_MESSAGES = 0;

  33353 19 021500   000005 450100                    STZ     5,,PR0

     5962    33354    2       VM_PROFILE.NUM_NEW_MESSAGES = 0;

  33354 19 021501   000006 450100                    STZ     6,,PR0

     5963    33355    3       DO FOREVER;

     5964    33356    3           CALL VMD$GET_HEADER_NEXT (INDX,M$MAIL_FILE_NUM) ALTRET(NO_MORE);

  33356 19 021502   000647 630400 20                 EPPR0   423
        19 021503   000000 631400 20                 EPPR1   0
        19 021504   000000 701000 xent               TSX1    VMD$GET_HEADER_NEXT
        19 021505   021560 702000 19                 TSX2    NO_MORE

     5965    33357    3           VM_PROFILE.NUM_MESSAGES = VM_PROFILE.NUM_MESSAGES + 1;

  33357 19 021506   000000 470400 xsym               LDP0    VM_PROFILE$
        19 021507   000005 235100                    LDA     5,,PR0
        19 021510   000001 035007                    ADLA    1,DL
        19 021511   000005 755100                    STA     5,,PR0

     5966    33358    3           IF VM_HEADER.STATUS.DEL

  33358 19 021512   000000 471400 xsym               LDP1    VM_HEADER$
        19 021513   100012 236100                    LDQ     10,,PR1
        19 021514   000400 316003                    CANQ    256,DU
        19 021515   021534 600000 19                 TZE     s:33370

     5967    33359    3           THEN
     5968    33360    4           DO;

     5969    33361    4               CALL VMM$DELETE_MESSAGE (INDX,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:835  

  33361 19 021516   000647 630400 20                 EPPR0   423
        19 021517   000000 631400 20                 EPPR1   0
        19 021520   000000 701000 xent               TSX1    VMM$DELETE_MESSAGE
        19 021521   021533 702000 19                 TSX2    E_DELETE

     5970    33362    4                 M$MAIL_FILE_NUM) ALTRET(E_DELETE);
     5971    33363    4               VM_PROFILE.NUM_MESSAGES = VM_PROFILE.NUM_MESSAGES - 1;

  33363 19 021522   000000 470400 xsym               LDP0    VM_PROFILE$
        19 021523   000005 235100                    LDA     5,,PR0
        19 021524   000001 135007                    SBLA    1,DL
        19 021525   000005 755100                    STA     5,,PR0

     5972    33364    4               RECS_DELETED = RECS_DELETED + VM_HEADER.NUM_RECORDS;

  33364 19 021526   000000 471400 xsym               LDP1    VM_HEADER$
        19 021527   005226 236000 11                 LDQ     RECS_DELETED
        19 021530   100011 036100                    ADLQ    9,,PR1
        19 021531   005226 756000 11                 STQ     RECS_DELETED

     5973    33365    5               DO NEVER;

  33365 19 021532   021554 710000 19                 TRA     s:33381

     5974    33366    5   E_DELETE:
     5975    33367                                                /* Bitch!!! */
     5976    33368    5               END;

  33368 19 021533                       E_DELETE     null
     5977    33369    4           END;

  33369 19 021533   021554 710000 19                 TRA     s:33381

     5978    33370    3           ELSE IF VM_HEADER.STATUS.MAKE_OLD

  33370 19 021534   002000 316003                    CANQ    1024,DU
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:836  
        19 021535   021547 600000 19                 TZE     s:33378

     5979    33371    3               THEN
     5980    33372    4               DO;

     5981    33373    4                   VM_HEADER.STATUS.OLD = %YES#;

  33373 19 021536   004000 236003                    LDQ     2048,DU
        19 021537   100012 256100                    ORSQ    10,,PR1

     5982    33374    4                   VM_HEADER.STATUS.MAKE_OLD = %NO#;

  33374 19 021540   000141 236000 20                 LDQ     97
        19 021541   100012 356100                    ANSQ    10,,PR1

     5983    33375    4                   CALL VMD$PUT_HEADER (INDX,

  33375 19 021542   000647 630400 20                 EPPR0   423
        19 021543   000000 631400 20                 EPPR1   0
        19 021544   000000 701000 xent               TSX1    VMD$PUT_HEADER
        19 021545   021766 702000 19                 TSX2    E_PMME

     5984    33376    4                     M$MAIL_FILE_NUM) ALTRET(E_PMME);
     5985    33377    4               END;

  33377 19 021546   021554 710000 19                 TRA     s:33381

     5986    33378    3               ELSE IF NOT VM_HEADER.STATUS.OLD

  33378 19 021547   004000 316003                    CANQ    2048,DU
        19 021550   021554 601000 19                 TNZ     s:33381

     5987    33379    3                   THEN
     5988    33380    3                       VM_PROFILE.NUM_NEW_MESSAGES = VM_PROFILE.NUM_NEW_MESSAGES + 1;

  33380 19 021551   000006 235100                    LDA     6,,PR0
        19 021552   000001 035007                    ADLA    1,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:837  
        19 021553   000006 755100                    STA     6,,PR0

     5989    33381    3           INDX = INDX + 1;

  33381 19 021554   005224 235000 11                 LDA     INDX
        19 021555   000001 035007                    ADLA    1,DL
        19 021556   005224 755000 11                 STA     INDX

     5990    33382    3       END;                            /* Do forever ... end */

  33382 19 021557   021502 710000 19                 TRA     s:33356

     5991    33383    2   NO_MORE:
     5992    33384    2       VM_PROFILE.NUM_DEL_MESSAGES = 0;

  33384 19 021560   000000 470400 xsym  NO_MORE      LDP0    VM_PROFILE$
        19 021561   000007 450100                    STZ     7,,PR0

     5993    33385    2       VM_PROFILE.NUM_LOST = 0;

  33385 19 021562   000141 450100                    STZ     97,,PR0

     5994    33386    2       VM_PROFILE.NUM_MOLD_MESSAGES = 0;

  33386 19 021563   000010 450100                    STZ     8,,PR0

     5995    33387    2       VM_PROFILE.RECS_DELETED = VM_PROFILE.RECS_DELETED+RECS_DELETED;

  33387 19 021564   000135 236100                    LDQ     93,,PR0
        19 021565   005226 036000 11                 ADLQ    RECS_DELETED
        19 021566   000135 756100                    STQ     93,,PR0

     5996    33388        /*
     5997    33389             ***** Renumber ???
     5998    33390             ***** Don't renumber if there is nothing to delete or deletion is
     5999    33391             ***** for last message.
     6000    33392        */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:838  
     6001    33393    2       IF RENUMBER#

  33393 19 021567   201117 471500                    LDP1    @RENUMBER#,,AUTO
        19 021570   000000 066500                    CMPB    filb='0'B
        19 021571   100000 000001                    BDSC    0,,PR1                   by=0,bit=0,n=1
        19 021572   000020 000022 20                 BDSC    16                       by=0,bit=0,n=18
        19 021573   021710 600000 19                 TZE     RELEASE_GRANULES

     6002    33394    2       THEN
     6003    33395    3       DO;

     6004    33396        /* We can't renumber the file if mailman is stuffing a message.
     6005    33397           The best way to tell if he is is by enqing the header of the high
     6006    33398           message.  If we got it, he isn't.  He won't start one because we've
     6007    33399           already got the profile enqueued.
     6008    33400        */
     6009    33401    3           VM_HEADRES.RES# = VM_PROFILE.HI_MESSAGE_NUMBER;

  33401 19 021574   000000 100500                    MLR     fill='000'O
        19 021575   000011 000004                    ADSC9   9,,PR0                   cn=0,n=4
        19 021576   001740 200004 11                 ADSC9   VM_HEADRES               cn=1,n=4

     6010    33402    3           CALL M$ENQ (ENQ_HEAD)

  33402 19 021577   000330 630400 12                 EPPR0   ENQ_HEAD
        19 021600   420002 713400                    CLIMB   alt,+8194
        19 021601   401000 401760                    pmme    nvectors=3
        19 021602   021604 702000 19                 TSX2    s:33404
        19 021603   021611 710000 19                 TRA     s:33407

     6011    33403    4           WHENALTRETURN DO;

     6012    33404    4               CALL XUR$ERRMSG (E_CANTREN);

  33404 19 021604   000651 630400 20                 EPPR0   425
        19 021605   000024 631400 20                 EPPR1   20
        19 021606   000000 701000 xent               TSX1    XUR$ERRMSG
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:839  
        19 021607   000000 011000                    NOP     0

     6013    33405    4               GOTO END_UPDATE;

  33405 19 021610   021727 710000 19                 TRA     END_UPDATE

     6014    33406    4           END;
     6015    33407    3           IF VM_PROFILE.NUM_MESSAGES = 0

  33407 19 021611   000000 470400 xsym               LDP0    VM_PROFILE$
        19 021612   000005 235100                    LDA     5,,PR0
        19 021613   021616 601000 19                 TNZ     s:33413

     6016    33408    3           THEN
     6017    33409    4           DO;

     6018    33410    4               VM_PROFILE.HI_MESSAGE_NUMBER = 0;

  33410 19 021614   000011 450100                    STZ     9,,PR0

     6019    33411    4               GOTO RELEASE_GRANULES;

  33411 19 021615   021710 710000 19                 TRA     RELEASE_GRANULES

     6020    33412    4           END;
     6021    33413    3           IF ADDR(HEADER_FIELD#) = ADDR(NIL) THEN

  33413 19 021616   201120 236100                    LDQ     @HEADER_FIELD#,,AUTO
        19 021617   000022 116000 20                 CMPQ    18
        19 021620   021676 601000 19                 TNZ     s:33451

     6022    33414    4           DO;                   /* Plain vanilla renumber  */

     6023    33415    4               IF VM_PROFILE.LOW_DEL_NUM <= 9 * VM_PROFILE.HI_MESSAGE_NUMBER/10

  33415 19 021621   000011 236100                    LDQ     9,,PR0
        19 021622   000011 402007                    MPY     9,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:840  
        19 021623   000001 772000                    QRL     1
        19 021624   000005 506007                    DIV     5,DL
        19 021625   000134 116100                    CMPQ    92,,PR0
        19 021626   021634 603000 19                 TRC     s:33427
        19 021627   000135 236100                    LDQ     93,,PR0
        19 021630   000012 402007                    MPY     10,DL
        19 021631   000136 116100                    CMPQ    94,,PR0
        19 021632   021637 602000 19                 TNC     s:33433
        19 021633   021637 600000 19                 TZE     s:33433

     6024    33416    4                 OR (VM_PROFILE.HIGH_RECS < VM_PROFILE.RECS_DELETED * 10)
     6025    33417    5               THEN DO;

     6026    33418                                 /* If the first deleted message is less then 75% of
     6027    33419                                    the way thru the file, or more than 90% of the
     6028    33420                                    the data records deleted, then a complete copy will
     6029    33421                                    be faster.  Actually, what we'd like to know is
     6030    33422                                    the record position and not the message number,
     6031    33423                               but so it goes.  Also, if the copy will be done anyway
     6032    33424                               then just do the copy and don't juggle messages.
     6033    33425
     6034    33426                               */
     6035    33427    5                   CALL COPY_FOLDER;

  33427 19 021634   022013 701000 19                 TSX1    COPY_FOLDER
        19 021635   000000 011000                    NOP     0

     6036    33428    5               END;

  33428 19 021636   021700 710000 19                 TRA     END_RENUMBER

     6037    33429    5               ELSE DO;

     6038    33430                            /* This method is very slow.  It will be the best method
     6039    33431                               for large folders where only the last message received
     6040    33432                               is deleted. */
     6041    33433    5                   NEXT_NUM = 0;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:841  

  33433 19 021637   005225 450000 11                 STZ     NEXT_NUM

     6042    33434    5                   INDX = 0;

  33434 19 021640   005224 450000 11                 STZ     INDX

     6043    33435    6                   DO WHILE (INDX <= VM_PROFILE.HI_MESSAGE_NUMBER);

  33435 19 021641   000011 236100                    LDQ     9,,PR0
        19 021642   005224 116000 11                 CMPQ    INDX
        19 021643   021700 602000 19                 TNC     END_RENUMBER

     6044    33436    6                       CALL VMD$GET_HEADER_NEXT (INDX,M$MAIL_FILE_NUM) ALTRET(
             33436                                END_RENUMBER);

  33436 19 021644   000647 630400 20                 EPPR0   423
        19 021645   000000 631400 20                 EPPR1   0
        19 021646   000000 701000 xent               TSX1    VMD$GET_HEADER_NEXT
        19 021647   021700 702000 19                 TSX2    END_RENUMBER

     6045    33437    6                       NEXT_NUM = NEXT_NUM + 1; /* Next avail. msg. number */

  33437 19 021650   005225 235000 11                 LDA     NEXT_NUM
        19 021651   000001 035007                    ADLA    1,DL
        19 021652   005225 755000 11                 STA     NEXT_NUM

     6046    33438    6                       IF INDX ~= NEXT_NUM

  33438 19 021653   005224 236000 11                 LDQ     INDX
        19 021654   005225 116000 11                 CMPQ    NEXT_NUM
        19 021655   021667 600000 19                 TZE     s:33446

     6047    33439    6                       THEN
     6048    33440    7                       DO;

     6049    33441    7                           CALL VMM$COPY_MESSAGE (INDX,NEXT_NUM,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:842  

  33441 19 021656   000652 630400 20                 EPPR0   426
        19 021657   000026 631400 20                 EPPR1   22
        19 021660   000000 701000 xent               TSX1    VMM$COPY_MESSAGE
        19 021661   021766 702000 19                 TSX2    E_PMME

     6050    33442    7                             M$MAIL_FILE_NUM,M$MAIL_FILE_NUM) ALTRET(E_PMME);
     6051    33443    7                          CALL VMM$DELETE_MESSAGE (INDX,M$MAIL_FILE_NUM) ALTRET(E_PMME
             33443                                    );

  33443 19 021662   000647 630400 20                 EPPR0   423
        19 021663   000000 631400 20                 EPPR1   0
        19 021664   000000 701000 xent               TSX1    VMM$DELETE_MESSAGE
        19 021665   021766 702000 19                 TSX2    E_PMME

     6052    33444    7                       END;

  33444 19 021666   021671 710000 19                 TRA     s:33447

     6053    33445    6                       ELSE /* Incriment ptr to next message */
     6054    33446    6                           INDX = INDX + 1;

  33446 19 021667   000001 036007                    ADLQ    1,DL
        19 021670   005224 756000 11                 STQ     INDX

     6055    33447    6                   END;    /* Do while ... end */

  33447 19 021671   000000 470400 xsym               LDP0    VM_PROFILE$
        19 021672   000011 236100                    LDQ     9,,PR0
        19 021673   005224 116000 11                 CMPQ    INDX
        19 021674   021644 603000 19                 TRC     s:33436

     6056    33448    5               END;          /* Else do */

     6057    33449    4           END;                  /* Plain vanilla */

  33449 19 021675   021700 710000 19                 TRA     END_RENUMBER
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:843  

     6058    33450    3           ELSE
     6059    33451    3               CALL SORT_FOLDER;  /* renumber by something else */

  33451 19 021676   022670 701000 19                 TSX1    SORT_FOLDER
        19 021677   000000 011000                    NOP     0

  33442 19 021700                       END_RENUMBER null
     6060    33452    3   END_RENUMBER: ;                        /* Do something????? */
     6061    33453    3           VM_PROFILE.HI_MESSAGE_NUMBER = NEXT_NUM;

  33453 19 021700   000000 470400 xsym               LDP0    VM_PROFILE$
        19 021701   005225 235000 11                 LDA     NEXT_NUM
        19 021702   000011 755100                    STA     9,,PR0

     6062    33454    3           VM_PROFILE.NUM_MESSAGES = NEXT_NUM;

  33454 19 021703   005225 236000 11                 LDQ     NEXT_NUM
        19 021704   000005 756100                    STQ     5,,PR0

     6063    33455    3           VM_PROFILE.LOW_DEL_NUM = %MAX_MSGNO;

  33455 19 021705   000556 235000 20                 LDA     366
        19 021706   000134 755100                    STA     92,,PR0

     6064    33456    3       END;                       /* If renum */

  33456 19 021707   021727 710000 19                 TRA     END_UPDATE

     6065    33457    3       ELSE DO;

     6066    33458        /*   ***** Catch users who deleted but hit ctl-y, or old folders that
     6067    33459             ***** got built before this code was added. Execute if more than 20%
     6068    33460             ***** of data records were deleted and folder exceeded 3 granules.
     6069    33461        */
     6070    33462    3   RELEASE_GRANULES:
     6071    33463    3           IF ((VM_PROFILE.HIGH_RECS <
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:844  

  33463 19 021710   000135 236100       RELEASE_GRA* LDQ     93,,PR0
        19 021711   000005 402007                    MPY     5,DL
        19 021712   000136 116100                    CMPQ    94,,PR0
        19 021713   021715 600000 19                 TZE     RELEASE_GRANULES+5
        19 021714   021717 603000 19                 TRC     RELEASE_GRANULES+7
        19 021715   000134 235100                    LDA     92,,PR0
        19 021716   021727 601000 19                 TNZ     END_UPDATE
        19 021717   001265 235000 11                 LDA     VM_CURRENT_FOLDER+18
        19 021720   000004 115007                    CMPA    4,DL
        19 021721   021727 602000 19                 TNC     END_UPDATE

     6072    33464    3             VM_PROFILE.RECS_DELETED * 5) OR VM_PROFILE.LOW_DEL_NUM=0)
     6073    33465    3             AND VM_CURRENT_FOLDER.UGRANS > 3
     6074    33466    3           THEN
     6075    33467    4           DO;

     6076    33468    4               CALL COPY_FOLDER;

  33468 19 021722   022013 701000 19                 TSX1    COPY_FOLDER
        19 021723   000000 011000                    NOP     0

     6077    33469    4               VM_PROFILE.LOW_DEL_NUM = %MAX_MSGNO;

  33469 19 021724   000556 235000 20                 LDA     366
        19 021725   000000 470400 xsym               LDP0    VM_PROFILE$
        19 021726   000134 755100                    STA     92,,PR0

     6078    33470    4           END;

     6079    33471    3       END;

     6080    33472    2   END_UPDATE:
     6081    33473    2       CALL VMD$PUT_PROFILE(M$MAIL_FILE_NUM)

  33473 19 021727   000053 630400 20    END_UPDATE   EPPR0   43
        19 021730   000024 631400 20                 EPPR1   20
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:845  
        19 021731   000000 701000 xent               TSX1    VMD$PUT_PROFILE
        19 021732   021734 702000 19                 TSX2    s:33475
        19 021733   021747 710000 19                 TRA     s:33479

     6082    33474    3       WHENALTRETURN DO;          /* At least we'll know an error occurred */

     6083    33475    3           ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  33475 19 021734   000000 470400 xsym               LDP0    B$TCB$
        19 021735   000000 471500                    LDP1    0,,PR0
        19 021736   100102 236100                    LDQ     66,,PR1
        19 021737   002204 756000 11                 STQ     ERROR

     6084    33476    3           DCB# = B$TCB.ALT$ -> B$ALT.DCB#;

  33476 19 021740   000000 471500                    LDP1    0,,PR0
        19 021741   100101 235100                    LDA     65,,PR1
        19 021742   000401 755000 11                 STA     DCB#

     6085    33477    3           CALL XUR$ERRMSG (ERROR,DCB#);

  33477 19 021743   000101 630400 20                 EPPR0   65
        19 021744   000000 631400 20                 EPPR1   0
        19 021745   000000 701000 xent               TSX1    XUR$ERRMSG
        19 021746   000000 011000                    NOP     0

     6086    33478    3       END;

     6087    33479    3       CALL M$DEQ(DEQ_PROFILE) WHENALTRETURN DO;

  33479 19 021747   001724 630400 11                 EPPR0   DEQ_PROFILE
        19 021750   420003 713400                    CLIMB   alt,+8195
        19 021751   401000 401760                    pmme    nvectors=3
        19 021752   021754 702000 19                 TSX2    s:33481
        19 021753   021754 710000 19                 TRA     s:33481

     6088    33480    3       END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:846  

     6089    33481    3       CALL M$DEQ(DEQ_HEAD) WHENALTRETURN DO;

  33481 19 021754   000342 630400 12                 EPPR0   DEQ_HEAD
        19 021755   420003 713400                    CLIMB   alt,+8195
        19 021756   401000 401760                    pmme    nvectors=3
        19 021757   021761 702000 19                 TSX2    s:33483
        19 021760   021761 710000 19                 TRA     s:33483

     6090    33482    3       END;

     6091    33483    2       CALL XUR$ENABLE;

  33483 19 021761   000020 631400 20                 EPPR1   16
        19 021762   000000 701000 xent               TSX1    XUR$ENABLE
        19 021763   000000 011000                    NOP     0

     6092    33484    2       RETURN;

  33484 19 021764   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 021765   000001 702211                    TSX2  ! 1,X1

     6093    33485        /**/
     6094    33486    2   E_PMME:
     6095    33487    3       CALL M$DEQ(DEQ_PROFILE) WHENALTRETURN DO;

  33487 19 021766   001724 630400 11    E_PMME       EPPR0   DEQ_PROFILE
        19 021767   420003 713400                    CLIMB   alt,+8195
        19 021770   401000 401760                    pmme    nvectors=3
        19 021771   021773 702000 19                 TSX2    s:33489
        19 021772   021773 710000 19                 TRA     s:33489

     6096    33488    3       END;

     6097    33489    2       CALL XUR$ENABLE;

  33489 19 021773   000020 631400 20                 EPPR1   16
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:847  
        19 021774   000000 701000 xent               TSX1    XUR$ENABLE
        19 021775   000000 011000                    NOP     0

     6098    33490    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  33490 19 021776   000000 470400 xsym               LDP0    B$TCB$
        19 021777   000000 471500                    LDP1    0,,PR0
        19 022000   100102 236100                    LDQ     66,,PR1
        19 022001   002204 756000 11                 STQ     ERROR

     6099    33491    2       DCB# = B$TCB.ALT$ -> B$ALT.DCB#;

  33491 19 022002   000000 471500                    LDP1    0,,PR0
        19 022003   100101 235100                    LDA     65,,PR1
        19 022004   000401 755000 11                 STA     DCB#

     6100    33492    2       CALL XUR$ERRMSG (ERROR,DCB#);

  33492 19 022005   000101 630400 20                 EPPR0   65
        19 022006   000000 631400 20                 EPPR1   0
        19 022007   000000 701000 xent               TSX1    XUR$ERRMSG
        19 022010   000000 011000                    NOP     0

     6101    33493    2       RETURN;

  33493 19 022011   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 022012   000001 702211                    TSX2  ! 1,X1

     6102    33494        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:848  
     6103    33495    2   COPY_FOLDER: PROC;

  33495 19 022013   201522 741300       COPY_FOLDER  STX1  ! INDX2+254,,AUTO

     6104    33496        /*I*   NAME: COPY_FOLDER
     6105    33497               DESCRIPTION:
     6106    33498                       The following code goes thru the file, storing the
     6107    33499                       old message into an array indexed by the new message
     6108    33500                       number.  Once all the headers have been processed, the
     6109    33501                       other records are access. This time, the new message
     6110    33502                       number is determined by comparing the old message
     6111    33503                       message number with the contents of the array.  The records
     6112    33504                       are read into the HEADER_ area, the WORK_ area is used
     6113    33505                       for the array.
     6114    33506                       */
     6115    33507    3   DCL OLD_TYPE UBIN;
     6116    33508    3   DCL CUR_NUM UBIN;
     6117    33509    3   DCL HINDX UBIN;
     6118    33510    3   DCL WRITEIT BIT(1);
     6119    33511    3   DCL HOLE$ PTR STATIC;
     6120    33512    3   DCL MAIL_FILE$ PTR;
     6121    33513    3   DCL HMAX UBIN STATIC;
     6122    33514    3   DCL NEW_NUM UBIN STATIC;
     6123    33515    3   DCL                                        HOLE(0:1024) UBIN BASED(HOLE$);
     6124    33516    3       HOLE$ = VBASE(VM_WORK_);

  33516 19 022014   000001 236000 xsym               LDQ     VM_WORK_+1
        19 022015   005464 756000 11                 STQ     HOLE$

     6125    33517    3       CALL XUR$ERRMSG (E_COMPACT,,M$ME_NUM);

  33517 19 022016   000033 236000 20                 LDQ     27
        19 022017   201710 756100                    STQ     I+102,,AUTO
        19 022020   000022 236000 20                 LDQ     18
        19 022021   000656 235000 20                 LDA     430
        19 022022   201706 757100                    STAQ    I+100,,AUTO
        19 022023   201706 630500                    EPPR0   I+100,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:849  
        19 022024   000021 631400 20                 EPPR1   17
        19 022025   000000 701000 xent               TSX1    XUR$ERRMSG
        19 022026   000000 011000                    NOP     0

     6126    33518    3       HMAX=VBOUND(VM_WORK_)/4;

  33518 19 022027   000000 236000 xsym               LDQ     VM_WORK_
        19 022030   000020 772000                    QRL     16
        19 022031   000002 772000                    QRL     2
        19 022032   005465 756000 11                 STQ     HMAX

     6127    33519    3       MAIL_FILE$ = DCBADDR(M$MAIL_FILE_NUM);

  33519 19 022033   000074 470400 20                 LDP0    60
        19 022034   000000 471500                    LDP1    0,,PR0
        19 022035   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 022036   100000 236110                    LDQ     0,X0,PR1
        19 022037   201527 756100                    STQ     MAIL_FILE$,,AUTO

     6128    33520                                 /* Close the current folder, reopen it share=none */
     6129    33521    3       CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;

  33521 19 022040   002142 740000 11                 STX0    CLOSE_SAVE+26

     6130    33522    3       VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B;

  33522 19 022041   000054 236000 20                 LDQ     44
        19 022042   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     6131    33523    3       CALL M$CLOSE (CLOSE_SAVE);

  33523 19 022043   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 022044   050001 713400                    CLIMB   close
        19 022045   406000 401760                    pmme    nvectors=13

     6132    33524    3       RENUM_OPEN.NAME_ = VECTOR(FID_NAME);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:850  
  33524 19 022046   000660 237000 20                 LDAQ    432
        19 022047   005236 757000 11                 STAQ    RENUM_OPEN+6

     6133    33525    3       CALL CONCAT(FID_NAME.NAME#,':MAIL_',VM_CURRENT_FOLDER.FOLDER);

  33525 19 022050   040000 100400                    MLR     fill='040'O
        19 022051   001363 000006 12                 ADSC9   VM_PROKEY+6              cn=0,n=6
        19 022052   005454 200006 11                 ADSC9   FID_NAME                 cn=1,n=6
        19 022053   040000 100400                    MLR     fill='040'O
        19 022054   001246 400031 11                 ADSC9   VM_CURRENT_FOLDER+3      cn=2,n=25
        19 022055   005455 600031 11                 ADSC9   FID_NAME+1               cn=3,n=25

     6134    33526    3       CALL INDEX (INDX,' ',FID_NAME.NAME#);

  33526 19 022056   000000 124400                    SCM     mask='000'O
        19 022057   005454 200037 11                 ADSC9   FID_NAME                 cn=1,n=31
        19 022060   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 022061   005224 000000 11                 ARG     INDX

     6135    33527    3       FID_NAME.L# = INDX;

  33527 19 022062   005224 236000 11                 LDQ     INDX
        19 022063   000033 736000                    QLS     27
        19 022064   005454 552040 11                 STBQ    FID_NAME,'40'O

     6136    33528    3       RENUM_OPEN.ACCT_ = VECTOR(VM_CURRENT_FOLDER.ACCT);

  33528 19 022065   000662 237000 20                 LDAQ    434
        19 022066   005254 757000 11                 STAQ    RENUM_OPEN+20

     6137    33529    3       RENUM_OPEN.PASS_ = VECTOR(VM_CURRENT_FOLDER.PASS);

  33529 19 022067   000664 237000 20                 LDAQ    436
        19 022070   005240 757000 11                 STAQ    RENUM_OPEN+8

     6138    33530    3       RENUM_OPEN.V.ACS#=%DIRECT#;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:851  
  33530 19 022071   000002 236007                    LDQ     2,DL
        19 022072   005276 552004 11                 STBQ    RENUM_OPEN+38,'04'O

     6139    33531    3       RENUM_OPEN.FPARAM_ = VECTOR(FPARAM_AREA);

  33531 19 022073   000666 235000 20                 LDA     438
        19 022074   201706 452500                    STP2    I+100,,AUTO
        19 022075   201706 236100                    LDQ     I+100,,AUTO
        19 022076   001122 036003                    ADLQ    594,DU
        19 022077   005260 757000 11                 STAQ    RENUM_OPEN+24

     6140    33532    3       RENUM_OPEN.V.DCB# = M$MAIL_FILE_NUM;

  33532 19 022100   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 022101   005274 740000 11                 STX0    RENUM_OPEN+36

     6141    33533    3       RENUM_OPEN.V.FUN# = %IN#;

  33533 19 022102   002000 236007                    LDQ     1024,DL
        19 022103   005275 552010 11                 STBQ    RENUM_OPEN+37,'10'O

     6142    33534    3       RENUM_OPEN.IFPARAM_ = VECTOR(NIL);

  33534 19 022104   000230 237000 20                 LDAQ    152
        19 022105   005256 757000 11                 STAQ    RENUM_OPEN+22

     6143    33535    3       CALL M$OPEN (RENUM_OPEN) ALTRET(E_PMME2);

  33535 19 022106   005230 630400 11                 EPPR0   RENUM_OPEN
        19 022107   450000 713400                    CLIMB   alt,open
        19 022110   410400 401760                    pmme    nvectors=18
        19 022111   022652 702000 19                 TSX2    E_PMME2

     6144    33536    3       RENUM_OPEN.V.DCB# = M$WORK_NUM;

  33536 19 022112   000000 720000 xsym               LXL0    M$WORK_NUM
        19 022113   005274 740000 11                 STX0    RENUM_OPEN+36
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:852  

     6145    33537    3       RENUM_OPEN.FPARAM_ = VECTOR(NIL);

  33537 19 022114   000230 237000 20                 LDAQ    152
        19 022115   005260 757000 11                 STAQ    RENUM_OPEN+24

     6146    33538    3       RENUM_OPEN.IFPARAM_ = VECTOR(FPARAM_AREA);

  33538 19 022116   000666 235000 20                 LDA     438
        19 022117   201706 452500                    STP2    I+100,,AUTO
        19 022120   201706 236100                    LDQ     I+100,,AUTO
        19 022121   001122 036003                    ADLQ    594,DU
        19 022122   005256 757000 11                 STAQ    RENUM_OPEN+22

     6147    33539    3       RENUM_OPEN.V.FUN#=%CREATE#;

  33539 19 022123   003000 236007                    LDQ     1536,DL
        19 022124   005275 552010 11                 STBQ    RENUM_OPEN+37,'10'O

     6148    33540    3       RENUM_OPEN.V.EXIST# = %NEWFILE#;

  33540 19 022125   000600 236007                    LDQ     384,DL
        19 022126   005274 256000 11                 ORSQ    RENUM_OPEN+36

     6149    33541    3       RENUM_OPEN.V.ORG# = %KEYED#;

  33541 19 022127   002000 236007                    LDQ     1024,DL
        19 022130   005276 552010 11                 STBQ    RENUM_OPEN+38,'10'O

     6150    33542    3       CALL M$OPEN (RENUM_OPEN) ALTRET(E_PMME);

  33542 19 022131   005230 630400 11                 EPPR0   RENUM_OPEN
        19 022132   450000 713400                    CLIMB   alt,open
        19 022133   410400 401760                    pmme    nvectors=18
        19 022134   022620 702000 19                 TSX2    E_PMME

     6151    33543    3       READ_OLD.BUF_ = VM_HEADER_;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:853  

  33543 19 022135   000000 237000 xsym               LDAQ    VM_HEADER_
        19 022136   005326 757000 11                 STAQ    READ_OLD+4

     6152    33544    3       OLD_TYPE=0;

  33544 19 022137   201523 450100                    STZ     OLD_TYPE,,AUTO

     6153    33545    3       IF RENUMBER# THEN NEXT_NUM = 0;

  33545 19 022140   201117 470500                    LDP0    @RENUMBER#,,AUTO
        19 022141   000000 066500                    CMPB    filb='0'B
        19 022142   000000 000001                    BDSC    0,,PR0                   by=0,bit=0,n=1
        19 022143   000020 000022 20                 BDSC    16                       by=0,bit=0,n=18
        19 022144   022147 600000 19                 TZE     s:33546

  33545 19 022145   005225 450000 11                 STZ     NEXT_NUM
        19 022146   022152 710000 19                 TRA     READ_LOOP

     6154    33546    3       ELSE NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;

  33546 19 022147   000000 471400 xsym               LDP1    VM_PROFILE$
        19 022150   100011 235100                    LDA     9,,PR1
        19 022151   005225 755000 11                 STA     NEXT_NUM

     6155    33547    4   READ_LOOP: DO WHILE('1'B);

  33547 19 022152                       READ_LOOP    null
     6156    33548    5   READ_AGAIN: CALL M$READ (READ_OLD) WHENALTRETURN DO;

  33548 19 022152   005322 630400 11    READ_AGAIN   EPPR0   READ_OLD
        19 022153   440000 713400                    CLIMB   alt,read
        19 022154   401400 401760                    pmme    nvectors=4
        19 022155   022157 702000 19                 TSX2    s:33549
        19 022156   022202 710000 19                 TRA     s:33560

     6157    33549    5               IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$EOF THEN EXIT READ_LOOP;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:854  

  33549 19 022157   000000 470400 xsym               LDP0    B$TCB$
        19 022160   000000 471500                    LDP1    0,,PR0
        19 022161   100102 236100                    LDQ     66,,PR1
        19 022162   377770 376007                    ANQ     131064,DL
        19 022163   000060 116007                    CMPQ    48,DL
        19 022164   022555 600000 19                 TZE     s:33622

     6158    33550    5               ELSE IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD

  33550 19 022165   000070 116007                    CMPQ    56,DL
        19 022166   022620 601000 19                 TNZ     E_PMME

     6159    33551    6                   THEN DO;

     6160    33552    6                       CALL VMA$ENLARGE_SEGMENT (VM_HEADER_, 1024) ALTRET(E_PMME);

  33552 19 022167   000002 630400 20                 EPPR0   2
        19 022170   000000 631400 20                 EPPR1   0
        19 022171   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 022172   022620 702000 19                 TSX2    E_PMME

     6161    33553    6                       READ_OLD.BUF_ = VM_HEADER_;

  33553 19 022173   000000 237000 xsym               LDAQ    VM_HEADER_
        19 022174   005326 757000 11                 STAQ    READ_OLD+4

     6162    33554    6                       CALL M$PRECORD (FPT_PRECORD) ALTRET(E_PMME); /* Can't

  33554 19 022175   001176 630400 12                 EPPR0   FPT_PRECORD
        19 022176   440003 713400                    CLIMB   alt,+16387
        19 022177   401000 401760                    pmme    nvectors=3
        19 022200   022620 702000 19                 TSX2    E_PMME

     6163    33555                                                use cont, folder may be compressed */
     6164    33556    6                       GOTO READ_AGAIN;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:855  
  33556 19 022201   022152 710000 19                 TRA     READ_LOOP

     6165    33557    6                   END;
     6166    33558    5                   ELSE GOTO E_PMME;
     6167    33559    5           END;
     6168    33560    4           IF VLP_KEY.TYPE ~= OLD_TYPE

  33560 19 022202   005354 236000 11                 LDQ     VLP_KEY
        19 022203   000022 772000                    QRL     18
        19 022204   000777 376007                    ANQ     511,DL
        19 022205   201523 116100                    CMPQ    OLD_TYPE,,AUTO
        19 022206   022213 600000 19                 TZE     s:33566

     6169    33561    5           THEN DO;

     6170    33562    5               OLD_TYPE = VLP_KEY.TYPE;

  33562 19 022207   201523 756100                    STQ     OLD_TYPE,,AUTO

     6171    33563    5               CUR_NUM = 1;

  33563 19 022210   000001 235007                    LDA     1,DL
        19 022211   201524 755100                    STA     CUR_NUM,,AUTO

     6172    33564    5               HINDX = 0;

  33564 19 022212   201525 450100                    STZ     HINDX,,AUTO

     6173    33565    5           END;

     6174    33566    4           WRITEIT = '1'B;

  33566 19 022213   400000 236003                    LDQ     -131072,DU
        19 022214   201526 756100                    STQ     WRITEIT,,AUTO

     6175    33567    4           IF RENUMBER#

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:856  
  33567 19 022215   201117 470500                    LDP0    @RENUMBER#,,AUTO
        19 022216   000000 066500                    CMPB    filb='0'B
        19 022217   000000 000001                    BDSC    0,,PR0                   by=0,bit=0,n=1
        19 022220   000020 000022 20                 BDSC    16                       by=0,bit=0,n=18
        19 022221   022525 600000 19                 TZE     s:33614

     6176    33568    5           THEN DO;

     6177    33569    6               DO CASE(VLP_KEY.TYPE);

  33569 19 022222   005354 220000 11                 LDX0    VLP_KEY
        19 022223   000777 360003                    ANX0    511,DU
        19 022224   000133 100003                    CMPX0   91,DU
        19 022225   022227 602010 19                 TNC     s:33569+5,X0
        19 022226   022442 710000 19                 TRA     s:33594
        19 022227   022442 710000 19                 TRA     s:33594
        19 022230   022525 710000 19                 TRA     s:33614
        19 022231   022442 710000 19                 TRA     s:33594
        19 022232   022442 710000 19                 TRA     s:33594
        19 022233   022442 710000 19                 TRA     s:33594
        19 022234   022442 710000 19                 TRA     s:33594
        19 022235   022442 710000 19                 TRA     s:33594
        19 022236   022442 710000 19                 TRA     s:33594
        19 022237   022362 710000 19                 TRA     s:33573
        19 022240   022442 710000 19                 TRA     s:33594
        19 022241   022442 710000 19                 TRA     s:33594
        19 022242   022442 710000 19                 TRA     s:33594
        19 022243   022442 710000 19                 TRA     s:33594
        19 022244   022442 710000 19                 TRA     s:33594
        19 022245   022442 710000 19                 TRA     s:33594
        19 022246   022442 710000 19                 TRA     s:33594
        19 022247   022442 710000 19                 TRA     s:33594
        19 022250   022442 710000 19                 TRA     s:33594
        19 022251   022442 710000 19                 TRA     s:33594
        19 022252   022442 710000 19                 TRA     s:33594
        19 022253   022442 710000 19                 TRA     s:33594
        19 022254   022442 710000 19                 TRA     s:33594
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:857  
        19 022255   022442 710000 19                 TRA     s:33594
        19 022256   022442 710000 19                 TRA     s:33594
        19 022257   022442 710000 19                 TRA     s:33594
        19 022260   022442 710000 19                 TRA     s:33594
        19 022261   022442 710000 19                 TRA     s:33594
        19 022262   022442 710000 19                 TRA     s:33594
        19 022263   022442 710000 19                 TRA     s:33594
        19 022264   022442 710000 19                 TRA     s:33594
        19 022265   022442 710000 19                 TRA     s:33594
        19 022266   022442 710000 19                 TRA     s:33594
        19 022267   022442 710000 19                 TRA     s:33594
        19 022270   022442 710000 19                 TRA     s:33594
        19 022271   022442 710000 19                 TRA     s:33594
        19 022272   022442 710000 19                 TRA     s:33594
        19 022273   022442 710000 19                 TRA     s:33594
        19 022274   022442 710000 19                 TRA     s:33594
        19 022275   022442 710000 19                 TRA     s:33594
        19 022276   022442 710000 19                 TRA     s:33594
        19 022277   022442 710000 19                 TRA     s:33594
        19 022300   022442 710000 19                 TRA     s:33594
        19 022301   022442 710000 19                 TRA     s:33594
        19 022302   022442 710000 19                 TRA     s:33594
        19 022303   022442 710000 19                 TRA     s:33594
        19 022304   022442 710000 19                 TRA     s:33594
        19 022305   022442 710000 19                 TRA     s:33594
        19 022306   022442 710000 19                 TRA     s:33594
        19 022307   022442 710000 19                 TRA     s:33594
        19 022310   022442 710000 19                 TRA     s:33594
        19 022311   022442 710000 19                 TRA     s:33594
        19 022312   022442 710000 19                 TRA     s:33594
        19 022313   022442 710000 19                 TRA     s:33594
        19 022314   022442 710000 19                 TRA     s:33594
        19 022315   022442 710000 19                 TRA     s:33594
        19 022316   022442 710000 19                 TRA     s:33594
        19 022317   022442 710000 19                 TRA     s:33594
        19 022320   022442 710000 19                 TRA     s:33594
        19 022321   022442 710000 19                 TRA     s:33594
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:858  
        19 022322   022442 710000 19                 TRA     s:33594
        19 022323   022525 710000 19                 TRA     s:33614
        19 022324   022442 710000 19                 TRA     s:33594
        19 022325   022442 710000 19                 TRA     s:33594
        19 022326   022442 710000 19                 TRA     s:33594
        19 022327   022442 710000 19                 TRA     s:33594
        19 022330   022442 710000 19                 TRA     s:33594
        19 022331   022442 710000 19                 TRA     s:33594
        19 022332   022442 710000 19                 TRA     s:33594
        19 022333   022442 710000 19                 TRA     s:33594
        19 022334   022442 710000 19                 TRA     s:33594
        19 022335   022442 710000 19                 TRA     s:33594
        19 022336   022442 710000 19                 TRA     s:33594
        19 022337   022442 710000 19                 TRA     s:33594
        19 022340   022442 710000 19                 TRA     s:33594
        19 022341   022442 710000 19                 TRA     s:33594
        19 022342   022442 710000 19                 TRA     s:33594
        19 022343   022442 710000 19                 TRA     s:33594
        19 022344   022442 710000 19                 TRA     s:33594
        19 022345   022442 710000 19                 TRA     s:33594
        19 022346   022442 710000 19                 TRA     s:33594
        19 022347   022525 710000 19                 TRA     s:33614
        19 022350   022442 710000 19                 TRA     s:33594
        19 022351   022442 710000 19                 TRA     s:33594
        19 022352   022442 710000 19                 TRA     s:33594
        19 022353   022442 710000 19                 TRA     s:33594
        19 022354   022442 710000 19                 TRA     s:33594
        19 022355   022442 710000 19                 TRA     s:33594
        19 022356   022442 710000 19                 TRA     s:33594
        19 022357   022442 710000 19                 TRA     s:33594
        19 022360   022442 710000 19                 TRA     s:33594
        19 022361   022415 710000 19                 TRA     s:33583

     6178    33570    6               CASE(%VM_TYPE_PRO,%VM_TYPE_LIST,%VM_TYPE_USER);

     6179    33571                                                /* Write it by default */
     6180    33572    6               CASE(%VM_TYPE_HEAD);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:859  

     6181    33573    6                   NEXT_NUM = NEXT_NUM+1;

  33573 19 022362   005225 235000 11                 LDA     NEXT_NUM
        19 022363   000001 035007                    ADLA    1,DL
        19 022364   005225 755000 11                 STA     NEXT_NUM

     6182    33574    6                   HOLE(CUR_NUM) = VLP_KEY.NUM;

  33574 19 022365   005464 471400 11                 LDP1    HOLE$
        19 022366   201524 721100                    LXL1    CUR_NUM,,AUTO
        19 022367   005354 235000 11                 LDA     VLP_KEY
        19 022370   005355 236000 11                 LDQ     VLP_KEY+1
        19 022371   000022 773000                    LRL     18
        19 022372   100000 756111                    STQ     0,X1,PR1

     6183    33575    6                   VLP_KEY.NUM = CUR_NUM;

  33575 19 022373   000000 100500                    MLR     fill='000'O
        19 022374   201524 000004                    ADSC9   CUR_NUM,,AUTO            cn=0,n=4
        19 022375   005354 400004 11                 ADSC9   VLP_KEY                  cn=2,n=4

     6184    33576    6                   CUR_NUM = CUR_NUM+1;

  33576 19 022376   201524 235100                    LDA     CUR_NUM,,AUTO
        19 022377   000001 035007                    ADLA    1,DL
        19 022400   201524 755100                    STA     CUR_NUM,,AUTO

     6185    33577    7                   IF CUR_NUM > HMAX THEN DO;

  33577 19 022401   005465 236000 11                 LDQ     HMAX
        19 022402   201524 116100                    CMPQ    CUR_NUM,,AUTO
        19 022403   022525 603000 19                 TRC     s:33614

     6186    33578    7                       CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024) ALTRET(E_PMME);

  33578 19 022404   000010 630400 20                 EPPR0   8
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:860  
        19 022405   000000 631400 20                 EPPR1   0
        19 022406   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 022407   022620 702000 19                 TSX2    E_PMME

     6187    33579    7                       HMAX = VBOUND(VM_WORK_)/4;

  33579 19 022410   000000 236000 xsym               LDQ     VM_WORK_
        19 022411   000020 772000                    QRL     16
        19 022412   000002 772000                    QRL     2
        19 022413   005465 756000 11                 STQ     HMAX

     6188    33580    7                   END;

  33580 19 022414   022525 710000 19                 TRA     s:33614

     6189    33581                                                /* Write it by default */
     6190    33582    6               CASE(%VM_TYPE_ID);

     6191    33583    6                   WRITEIT = '0'B;

  33583 19 022415   201526 450100                    STZ     WRITEIT,,AUTO

     6192    33584    6                   NEW_NUM = 0;

  33584 19 022416   005466 450000 11                 STZ     NEW_NUM

     6193    33585    7                   DO WHILE (NEW_NUM < NEXT_NUM AND NOT WRITEIT);

  33585 19 022417   022434 710000 19                 TRA     s:33592

     6194    33586    7                       NEW_NUM = NEW_NUM + 1;

  33586 19 022420   005466 235000 11                 LDA     NEW_NUM
        19 022421   000001 035007                    ADLA    1,DL
        19 022422   005466 755000 11                 STA     NEW_NUM

     6195    33587    7                       IF VM_ID.MESSAGE_NUMBER = HOLE(NEW_NUM)
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:861  

  33587 19 022423   000000 470400 xsym               LDP0    VM_HEADER$
        19 022424   005464 471400 11                 LDP1    HOLE$
        19 022425   000000 236100                    LDQ     0,,PR0
        19 022426   100000 116105                    CMPQ    0,AL,PR1
        19 022427   022434 601000 19                 TNZ     s:33592

     6196    33588    8                       THEN DO;

     6197    33589    8                           VM_ID.MESSAGE_NUMBER = NEW_NUM;

  33589 19 022430   005466 235000 11                 LDA     NEW_NUM
        19 022431   000000 755100                    STA     0,,PR0

     6198    33590    8                           WRITEIT = '1'B;

  33590 19 022432   400000 236003                    LDQ     -131072,DU
        19 022433   201526 756100                    STQ     WRITEIT,,AUTO

     6199    33591    8                       END;

     6200    33592    7                   END;

  33592 19 022434   005466 236000 11                 LDQ     NEW_NUM
        19 022435   005225 116000 11                 CMPQ    NEXT_NUM
        19 022436   022441 603000 19                 TRC     s:33592+5
        19 022437   201526 234100                    SZN     WRITEIT,,AUTO
        19 022440   022420 605000 19                 TPL     s:33586
        19 022441   022525 710000 19                 TRA     s:33614

     6201    33593    6               CASE(ELSE);

     6202    33594    6                   IF CUR_NUM > NEXT_NUM THEN WRITEIT='0'B;

  33594 19 022442   005225 236000 11                 LDQ     NEXT_NUM
        19 022443   201524 116100                    CMPQ    CUR_NUM,,AUTO
        19 022444   022447 603000 19                 TRC     s:33595
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:862  

  33594 19 022445   201526 450100                    STZ     WRITEIT,,AUTO
        19 022446   022525 710000 19                 TRA     s:33614

     6203    33595    6                   ELSE IF VLP_KEY.NUM = HOLE(CUR_NUM)

  33595 19 022447   005464 471400 11                 LDP1    HOLE$
        19 022450   201524 721100                    LXL1    CUR_NUM,,AUTO
        19 022451   005354 235000 11                 LDA     VLP_KEY
        19 022452   005355 236000 11                 LDQ     VLP_KEY+1
        19 022453   000022 773000                    LRL     18
        19 022454   100000 116111                    CMPQ    0,X1,PR1
        19 022455   022462 601000 19                 TNZ     s:33597

     6204    33596    6                       THEN VLP_KEY.NUM = CUR_NUM;

  33596 19 022456   000000 100500                    MLR     fill='000'O
        19 022457   201524 000004                    ADSC9   CUR_NUM,,AUTO            cn=0,n=4
        19 022460   005354 400004 11                 ADSC9   VLP_KEY                  cn=2,n=4
        19 022461   022525 710000 19                 TRA     s:33614

     6205    33597    6                       ELSE IF VLP_KEY.NUM < HOLE(CUR_NUM)

  33597 19 022462   022465 603000 19                 TRC     SR_LOOP

     6206    33598    6                           THEN WRITEIT='0'B;

  33598 19 022463   201526 450100                    STZ     WRITEIT,,AUTO
        19 022464   022525 710000 19                 TRA     s:33614

     6207    33599    6                           ELSE
     6208    33600    7   SR_LOOP:                DO WHILE (VLP_KEY.NUM > HOLE(CUR_NUM));

  33600 19 022465   022525 602000 19    SR_LOOP      TNC     s:33614
        19 022466   022525 600000 19                 TZE     s:33614

     6209    33601    7                               CUR_NUM = CUR_NUM+1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:863  

  33601 19 022467   201524 235100                    LDA     CUR_NUM,,AUTO
        19 022470   000001 035007                    ADLA    1,DL
        19 022471   201524 755100                    STA     CUR_NUM,,AUTO

     6210    33602    7                               IF CUR_NUM > NEXT_NUM

  33602 19 022472   005225 236000 11                 LDQ     NEXT_NUM
        19 022473   201524 116100                    CMPQ    CUR_NUM,,AUTO
        19 022474   022477 603000 19                 TRC     s:33607

     6211    33603    8                               THEN DO;

     6212    33604    8                                   WRITEIT='0'B;

  33604 19 022475   201526 450100                    STZ     WRITEIT,,AUTO

     6213    33605    8                                   EXIT SR_LOOP;

  33605 19 022476   022525 710000 19                 TRA     s:33614

     6214    33606    8                               END;
     6215    33607    7                               ELSE IF VLP_KEY.NUM = HOLE(CUR_NUM)

  33607 19 022477   005464 470400 11                 LDP0    HOLE$
        19 022500   000000 620005                    EAX0    0,AL
        19 022501   005354 235000 11                 LDA     VLP_KEY
        19 022502   005355 236000 11                 LDQ     VLP_KEY+1
        19 022503   000022 773000                    LRL     18
        19 022504   000000 116110                    CMPQ    0,X0,PR0
        19 022505   022512 601000 19                 TNZ     s:33609

     6216    33608    7                                   THEN VLP_KEY.NUM = CUR_NUM;

  33608 19 022506   000000 100500                    MLR     fill='000'O
        19 022507   201524 000004                    ADSC9   CUR_NUM,,AUTO            cn=0,n=4
        19 022510   005354 400004 11                 ADSC9   VLP_KEY                  cn=2,n=4
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:864  
        19 022511   022516 710000 19                 TRA     s:33611

     6217    33609    7                                   ELSE IF VLP_KEY.NUM < HOLE(CUR_NUM)

  33609 19 022512   201524 720100                    LXL0    CUR_NUM,,AUTO
        19 022513   000000 116110                    CMPQ    0,X0,PR0
        19 022514   022516 603000 19                 TRC     s:33611

     6218    33610    7                                       THEN WRITEIT='0'B;

  33610 19 022515   201526 450100                    STZ     WRITEIT,,AUTO

     6219    33611    7                           END; /* Do while */

  33611 19 022516   201524 720100                    LXL0    CUR_NUM,,AUTO
        19 022517   005354 235000 11                 LDA     VLP_KEY
        19 022520   005355 236000 11                 LDQ     VLP_KEY+1
        19 022521   000022 773000                    LRL     18
        19 022522   000000 116110                    CMPQ    0,X0,PR0
        19 022523   022525 600000 19                 TZE     s:33614
        19 022524   022467 603000 19                 TRC     s:33601

     6220    33612    6               END;             /* Do case */

     6221    33613    5           END;                  /* If renum */

     6222    33614    5           IF WRITEIT THEN DO;

  33614 19 022525   201526 234100                    SZN     WRITEIT,,AUTO
        19 022526   022152 605000 19                 TPL     READ_LOOP

     6223    33615    5               WRITE_NEW.BUF_ = VM_HEADER_;

  33615 19 022527   000000 237000 xsym               LDAQ    VM_HEADER_
        19 022530   005344 757000 11                 STAQ    WRITE_NEW+4

     6224    33616    5               IF MAIL_FILE$->F$DCB.ARS# = 0 THEN WRITE_NEW.BUF_ = VECTOR(NIL);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:865  

  33616 19 022531   201527 470500                    LDP0    MAIL_FILE$,,AUTO
        19 022532   000000 235100                    LDA     0,,PR0
        19 022533   022537 601000 19                 TNZ     s:33617

  33616 19 022534   000230 237000 20                 LDAQ    152
        19 022535   005344 757000 11                 STAQ    WRITE_NEW+4
        19 022536   022545 710000 19                 TRA     s:33618

     6225    33617    5               ELSE WRITE_NEW.BUF_.BOUND = MAIL_FILE$->F$DCB.ARS#-1;

  33617 19 022537   000000 236100                    LDQ     0,,PR0
        19 022540   000001 136007                    SBLQ    1,DL
        19 022541   000020 736000                    QLS     16
        19 022542   005344 676000 11                 ERQ     WRITE_NEW+4
        19 022543   000017 376000 20                 ANQ     15
        19 022544   005344 656000 11                 ERSQ    WRITE_NEW+4

     6226    33618    5               WRITE_NEW.V.DVBYTE=MAIL_FILE$->F$DCB.DVBYTE;

  33618 19 022545   000003 236100                    LDQ     3,,PR0
        19 022546   776000 376003                    ANQ     -1024,DU
        19 022547   005353 552040 11                 STBQ    WRITE_NEW+11,'40'O

     6227    33619    5               CALL M$WRITE(WRITE_NEW) ALTRET(E_PMME);

  33619 19 022550   005340 630400 11                 EPPR0   WRITE_NEW
        19 022551   440001 713400                    CLIMB   alt,write
        19 022552   401400 401760                    pmme    nvectors=4
        19 022553   022620 702000 19                 TSX2    E_PMME

     6228    33620    5           END;

     6229    33621    4       END;                            /* Read loop */

  33621 19 022554   022152 710000 19                 TRA     READ_LOOP

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:866  
     6230    33622    3       VM_PROFILE.RECS_DELETED=0;

  33622 19 022555   000000 473400 xsym               LDP3    VM_PROFILE$
        19 022556   300135 450100                    STZ     93,,PR3

     6231    33623    3       VM_PROFILE.HIGH_RECS = NEXT_NUM;

  33623 19 022557   005225 235000 11                 LDA     NEXT_NUM
        19 022560   300136 755100                    STA     94,,PR3

     6232    33624    3       CALL VMD$PUT_PROFILE(M$WORK_NUM) ALTRET(E_PMME);

  33624 19 022561   000133 630400 20                 EPPR0   91
        19 022562   000024 631400 20                 EPPR1   20
        19 022563   000000 701000 xent               TSX1    VMD$PUT_PROFILE
        19 022564   022620 702000 19                 TSX2    E_PMME

     6233    33625    3       CLOSE_SAVE.V.DCB#=M$MAIL_FILE_NUM;

  33625 19 022565   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 022566   002142 740000 11                 STX0    CLOSE_SAVE+26

     6234    33626    3       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  33626 19 022567   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 022570   450001 713400                    CLIMB   alt,close
        19 022571   406000 401760                    pmme    nvectors=13
        19 022572   022620 702000 19                 TSX2    E_PMME

     6235    33627    3       CLOSE_SAVE.V.DCB#=M$WORK_NUM;

  33627 19 022573   000000 720000 xsym               LXL0    M$WORK_NUM
        19 022574   002142 740000 11                 STX0    CLOSE_SAVE+26

     6236    33628    3       CLOSE_SAVE.V.OPER.RELG# = '1'B;

  33628 19 022575   200000 236007                    LDQ     65536,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:867  
        19 022576   002142 256000 11                 ORSQ    CLOSE_SAVE+26

     6237    33629    3       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  33629 19 022577   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 022600   450001 713400                    CLIMB   alt,close
        19 022601   406000 401760                    pmme    nvectors=13
        19 022602   022620 702000 19                 TSX2    E_PMME

     6238    33630    3       CLOSE_SAVE.V.OPER.RELG# = '0'B;

  33630 19 022603   000667 236000 20                 LDQ     439
        19 022604   002142 356000 11                 ANSQ    CLOSE_SAVE+26

     6239    33631    3   CLEANUP:
     6240    33632    3       CALL VMB$USE_SAME (,,VM_CURRENT_FOLDER,M$MAIL_FILE_NUM);

  33632 19 022605   000052 237000 20    CLEANUP      LDAQ    42
        19 022606   201710 757100                    STAQ    I+102,,AUTO
        19 022607   000022 236000 20                 LDQ     18
        19 022610   000022 235000 20                 LDA     18
        19 022611   201706 757100                    STAQ    I+100,,AUTO
        19 022612   201706 630500                    EPPR0   I+100,,AUTO
        19 022613   000026 631400 20                 EPPR1   22
        19 022614   000000 701000 xent               TSX1    VMB$USE_SAME
        19 022615   000000 011000                    NOP     0

     6241    33633    3       RETURN;

  33633 19 022616   201522 221300                    LDX1  ! INDX2+254,,AUTO
        19 022617   000001 702211                    TSX2  ! 1,X1

     6242    33634    3   E_PMME:
     6243    33635    3       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  33635 19 022620   000000 470400 xsym  E_PMME       LDP0    B$TCB$
        19 022621   000000 471500                    LDP1    0,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:868  
        19 022622   100102 236100                    LDQ     66,,PR1
        19 022623   002204 756000 11                 STQ     ERROR

     6244    33636    3       DCB# = B$TCB.ALT$->B$ALT.DCB#;

  33636 19 022624   000000 471500                    LDP1    0,,PR0
        19 022625   100101 235100                    LDA     65,,PR1
        19 022626   000401 755000 11                 STA     DCB#

     6245    33637    3       CALL XUR$ERRMSG (E_RENFAILED);

  33637 19 022627   000670 630400 20                 EPPR0   440
        19 022630   000024 631400 20                 EPPR1   20
        19 022631   000000 701000 xent               TSX1    XUR$ERRMSG
        19 022632   000000 011000                    NOP     0

     6246    33638    3       CALL XUR$ERRMSG (ERROR,DCB#);

  33638 19 022633   000101 630400 20                 EPPR0   65
        19 022634   000000 631400 20                 EPPR1   0
        19 022635   000000 701000 xent               TSX1    XUR$ERRMSG
        19 022636   000000 011000                    NOP     0

     6247    33639    3       CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;

  33639 19 022637   000000 720000 xsym               LXL0    M$WORK_NUM
        19 022640   002200 740000 11                 STX0    CLOSE_SCRATCH+26

     6248    33640    4       CALL M$CLOSE (CLOSE_SCRATCH) WHENALTRETURN DO;

  33640 19 022641   002146 630400 11                 EPPR0   CLOSE_SCRATCH
        19 022642   450001 713400                    CLIMB   alt,close
        19 022643   406000 401760                    pmme    nvectors=13
        19 022644   022646 702000 19                 TSX2    s:33642
        19 022645   022646 710000 19                 TRA     s:33642

     6249    33641    4       END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:869  

     6250    33642    3       NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;

  33642 19 022646   000000 470400 xsym               LDP0    VM_PROFILE$
        19 022647   000011 235100                    LDA     9,,PR0
        19 022650   005225 755000 11                 STA     NEXT_NUM

     6251    33643    3       GOTO CLEANUP;

  33643 19 022651   022605 710000 19                 TRA     CLEANUP

     6252    33644    3   E_PMME2:
     6253    33645    3       IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$FILEBUSY

  33645 19 022652   000000 470400 xsym  E_PMME2      LDP0    B$TCB$
        19 022653   000000 471500                    LDP1    0,,PR0
        19 022654   100102 236100                    LDQ     66,,PR1
        19 022655   377770 376007                    ANQ     131064,DL
        19 022656   001550 116007                    CMPQ    872,DL
        19 022657   022620 601000 19                 TNZ     E_PMME

     6254    33646    4       THEN DO;

     6255    33647    4           CALL XUR$ERRMSG(E_CANTCOMPACT);

  33647 19 022660   000671 630400 20                 EPPR0   441
        19 022661   000024 631400 20                 EPPR1   20
        19 022662   000000 701000 xent               TSX1    XUR$ERRMSG
        19 022663   000000 011000                    NOP     0

     6256    33648    4           NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;

  33648 19 022664   000000 470400 xsym               LDP0    VM_PROFILE$
        19 022665   000011 235100                    LDA     9,,PR0
        19 022666   005225 755000 11                 STA     NEXT_NUM

     6257    33649    4           GOTO CLEANUP;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:870  

  33649 19 022667   022605 710000 19                 TRA     CLEANUP

     6258    33650    4       END;
     6259    33651    3       ELSE GOTO E_PMME;
     6260    33652    3   END COPY_FOLDER;
     6261    33653        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:871  
     6262    33654    2   SORT_FOLDER: PROC;

  33654 19 022670   201522 741300       SORT_FOLDER  STX1  ! INDX2+254,,AUTO

     6263    33655        /*I*   NAME: SORT_FOLDER
     6264    33656               DESCRIPTION:
     6265    33657                       Alot of this module has been borrowed from the COPY_
     6266    33658                       FOLDER module, with the sort routine being new. The
     6267    33659                       message number is kept in HOLE.MSG_NUM. When sorting by
     6268    33660                       date, the date is kept in HOLE.SORT#. When sorting by a
     6269    33661                       character field, SORT# is an offset from the beginning
     6270    33662                       of STASH where the textc fields of interest are kept.
     6271    33663                       VM_WORK_ and VM_HEADER_ are used the same as in  COPY_
     6272    33664                       FOLDER. Some housekeeping is done in the char sort for
     6273    33665                       HOLE and STASH since they both live in WORK_.      */
     6274    33666        %FPT_PRECORD (FPTN = BOF, BOF = YES);
     6275    33687    3   DCL OLD_TYPE UBIN;
     6276    33688    3   DCL CUR_NUM UBIN;
     6277    33689    3   DCL HINDX UBIN WORD ALIGNED;
     6278    33690    3   DCL WRITEIT BIT(1);
     6279    33691    3   DCL HOLE$ PTR STATIC;
     6280    33692    3   DCL MAIL_FILE$ PTR;
     6281    33693    3   DCL HMAX UBIN STATIC;
     6282    33694    3   DCL NEW_NUM UBIN STATIC;
     6283    33695    3   DCL SIZE UBIN WORD;
     6284    33696    3   DCL TEMPLATE CHAR(SIZE) BASED;
     6285    33697    3   DCL 1 B$TEXTC BASED,
     6286    33698    3         2 L UBIN (9) UNAL,
     6287    33699    3         2 C CHAR(B$TEXTC.L);
     6288    33700    3   DCL STASH_LEN UBIN WORD;
     6289    33701    3   DCL STASH CHAR(STASH_LEN) BASED;
     6290    33702    3   DCL STASH$ PTR;
     6291    33703    3   DCL TEMP$  PTR;
     6292    33704    3   DCL NEXT$ PTR;
     6293    33705    3   DCL HIGH SBIN WORD STATIC INIT(0);
     6294    33706    3   DCL LOW  SBIN WORD STATIC INIT(0);
     6295    33707    3   DCL LAST SBIN WORD STATIC INIT(-1);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:872  
     6296    33708    3   DCL MID  SBIN WORD STATIC INIT(0);
     6297    33709    3   DCL I UBIN WORD;
     6298    33710    3   DCL FLDPTR$ PTR;
     6299    33711    3   DCL VMX$MRL ENTRY(3);
     6300    33712    3   DCL 1 HOLE(0:1024) BASED(HOLE$) DALIGNED,
     6301    33713    3         2 MSG_NUM UBIN WORD ALIGNED,
     6302    33714    3         2 SORT# UBIN WORD ALIGNED;
     6303    33715    3       HOLE$ = VBASE(VM_WORK_);

  33715 19 022671   000001 236000 xsym               LDQ     VM_WORK_+1
        19 022672   005502 756000 11                 STQ     HOLE$

     6304    33716    3       LAST = -1;

  33716 19 022673   000001 335007                    LCA     1,DL
        19 022674   005507 755000 11                 STA     LAST

     6305    33717    3       CALL XUR$ERRMSG (E_COMPACT,,M$ME_NUM);

  33717 19 022675   000033 236000 20                 LDQ     27
        19 022676   201710 756100                    STQ     I+102,,AUTO
        19 022677   000022 236000 20                 LDQ     18
        19 022700   000656 235000 20                 LDA     430
        19 022701   201706 757100                    STAQ    I+100,,AUTO
        19 022702   201706 630500                    EPPR0   I+100,,AUTO
        19 022703   000021 631400 20                 EPPR1   17
        19 022704   000000 701000 xent               TSX1    XUR$ERRMSG
        19 022705   000000 011000                    NOP     0

     6306    33718    3       HMAX=VBOUND(VM_WORK_)/4;

  33718 19 022706   000000 236000 xsym               LDQ     VM_WORK_
        19 022707   000020 772000                    QRL     16
        19 022710   000002 772000                    QRL     2
        19 022711   005503 756000 11                 STQ     HMAX

     6307    33719    4       IF HEADER_FIELD# > 1 THEN DO; /* If the sort field is char */
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:873  

  33719 19 022712   201120 470500                    LDP0    @HEADER_FIELD#,,AUTO
        19 022713   000100 101500                    MRL     fill='000'O
        19 022714   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
        19 022715   201706 000004                    ADSC9   I+100,,AUTO              cn=0,n=4
        19 022716   201706 236100                    LDQ     I+100,,AUTO
        19 022717   000002 116007                    CMPQ    2,DL
        19 022720   022736 604000 19                 TMI     s:33725

     6308    33720    4           CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024) ALTRET(E_PMME);

  33720 19 022721   000010 630400 20                 EPPR0   8
        19 022722   000000 631400 20                 EPPR1   0
        19 022723   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 022724   024537 702000 19                 TSX2    E_PMME

     6309    33721    4           STASH$ = PINCRW(HOLE$, 1024);

  33721 19 022725   005502 236000 11                 LDQ     HOLE$
        19 022726   002000 036003                    ADLQ    1024,DU
        19 022727   201532 756100                    STQ     STASH$,,AUTO

     6310    33722    4           STASH$->B$TEXTC.L=0;

  33722 19 022730   201532 470500                    LDP0    STASH$,,AUTO
        19 022731   000100 101400                    MRL     fill='000'O
        19 022732   000020 000004 20                 ADSC9   16                       cn=0,n=4
        19 022733   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     6311    33723    4           STASH_LEN = 1;

  33723 19 022734   000001 235007                    LDA     1,DL
        19 022735   201531 755100                    STA     STASH_LEN,,AUTO

     6312    33724    4       END;

     6313    33725    3       MAIL_FILE$ = DCBADDR(M$MAIL_FILE_NUM);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:874  

  33725 19 022736   000074 470400 20                 LDP0    60
        19 022737   000000 471500                    LDP1    0,,PR0
        19 022740   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 022741   100000 236110                    LDQ     0,X0,PR1
        19 022742   201527 756100                    STQ     MAIL_FILE$,,AUTO

     6314    33726                                 /* Close the current folder, reopen it share=none */
     6315    33727    3       CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;

  33727 19 022743   002142 740000 11                 STX0    CLOSE_SAVE+26

     6316    33728    3       VM_CURRENT_FOLDER.FLAGS.OPEN = '0'B;

  33728 19 022744   000054 236000 20                 LDQ     44
        19 022745   001266 356000 11                 ANSQ    VM_CURRENT_FOLDER+19

     6317    33729    3       CALL M$CLOSE (CLOSE_SAVE);

  33729 19 022746   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 022747   050001 713400                    CLIMB   close
        19 022750   406000 401760                    pmme    nvectors=13

     6318    33730    3       RENUM_OPEN.NAME_ = VECTOR(FID_NAME);

  33730 19 022751   000660 237000 20                 LDAQ    432
        19 022752   005236 757000 11                 STAQ    RENUM_OPEN+6

     6319    33731    3       CALL CONCAT(FID_NAME.NAME#,':MAIL_',VM_CURRENT_FOLDER.FOLDER);

  33731 19 022753   040000 100400                    MLR     fill='040'O
        19 022754   001363 000006 12                 ADSC9   VM_PROKEY+6              cn=0,n=6
        19 022755   005454 200006 11                 ADSC9   FID_NAME                 cn=1,n=6
        19 022756   040000 100400                    MLR     fill='040'O
        19 022757   001246 400031 11                 ADSC9   VM_CURRENT_FOLDER+3      cn=2,n=25
        19 022760   005455 600031 11                 ADSC9   FID_NAME+1               cn=3,n=25

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:875  
     6320    33732    3       CALL INDEX (INDX,' ',FID_NAME.NAME#);

  33732 19 022761   000000 124400                    SCM     mask='000'O
        19 022762   005454 200037 11                 ADSC9   FID_NAME                 cn=1,n=31
        19 022763   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 022764   005224 000000 11                 ARG     INDX

     6321    33733    3       FID_NAME.L# = INDX;

  33733 19 022765   005224 236000 11                 LDQ     INDX
        19 022766   000033 736000                    QLS     27
        19 022767   005454 552040 11                 STBQ    FID_NAME,'40'O

     6322    33734    3       RENUM_OPEN.ACCT_ = VECTOR(VM_CURRENT_FOLDER.ACCT);

  33734 19 022770   000662 237000 20                 LDAQ    434
        19 022771   005254 757000 11                 STAQ    RENUM_OPEN+20

     6323    33735    3       RENUM_OPEN.PASS_ = VECTOR(VM_CURRENT_FOLDER.PASS);

  33735 19 022772   000664 237000 20                 LDAQ    436
        19 022773   005240 757000 11                 STAQ    RENUM_OPEN+8

     6324    33736    3       RENUM_OPEN.V.ACS#=%DIRECT#;

  33736 19 022774   000002 236007                    LDQ     2,DL
        19 022775   005276 552004 11                 STBQ    RENUM_OPEN+38,'04'O

     6325    33737    3       RENUM_OPEN.FPARAM_ = VECTOR(FPARAM_AREA);

  33737 19 022776   000666 235000 20                 LDA     438
        19 022777   201706 452500                    STP2    I+100,,AUTO
        19 023000   201706 236100                    LDQ     I+100,,AUTO
        19 023001   001122 036003                    ADLQ    594,DU
        19 023002   005260 757000 11                 STAQ    RENUM_OPEN+24

     6326    33738    3       RENUM_OPEN.V.DCB# = M$MAIL_FILE_NUM;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:876  

  33738 19 023003   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 023004   005274 740000 11                 STX0    RENUM_OPEN+36

     6327    33739    3       RENUM_OPEN.V.FUN# = %IN#;

  33739 19 023005   002000 236007                    LDQ     1024,DL
        19 023006   005275 552010 11                 STBQ    RENUM_OPEN+37,'10'O

     6328    33740    3       RENUM_OPEN.IFPARAM_ = VECTOR(NIL);

  33740 19 023007   000230 237000 20                 LDAQ    152
        19 023010   005256 757000 11                 STAQ    RENUM_OPEN+22

     6329    33741    3       CALL M$OPEN (RENUM_OPEN) ALTRET(E_PMME2);

  33741 19 023011   005230 630400 11                 EPPR0   RENUM_OPEN
        19 023012   450000 713400                    CLIMB   alt,open
        19 023013   410400 401760                    pmme    nvectors=18
        19 023014   024571 702000 19                 TSX2    E_PMME2

     6330    33742    3       RENUM_OPEN.V.DCB# = M$WORK_NUM;

  33742 19 023015   000000 720000 xsym               LXL0    M$WORK_NUM
        19 023016   005274 740000 11                 STX0    RENUM_OPEN+36

     6331    33743    3       RENUM_OPEN.FPARAM_ = VECTOR(NIL);

  33743 19 023017   000230 237000 20                 LDAQ    152
        19 023020   005260 757000 11                 STAQ    RENUM_OPEN+24

     6332    33744    3       RENUM_OPEN.IFPARAM_ = VECTOR(FPARAM_AREA);

  33744 19 023021   000666 235000 20                 LDA     438
        19 023022   201706 452500                    STP2    I+100,,AUTO
        19 023023   201706 236100                    LDQ     I+100,,AUTO
        19 023024   001122 036003                    ADLQ    594,DU
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:877  
        19 023025   005256 757000 11                 STAQ    RENUM_OPEN+22

     6333    33745    3       RENUM_OPEN.V.FUN#=%CREATE#;

  33745 19 023026   003000 236007                    LDQ     1536,DL
        19 023027   005275 552010 11                 STBQ    RENUM_OPEN+37,'10'O

     6334    33746    3       RENUM_OPEN.V.EXIST# = %NEWFILE#;

  33746 19 023030   000600 236007                    LDQ     384,DL
        19 023031   005274 256000 11                 ORSQ    RENUM_OPEN+36

     6335    33747    3       RENUM_OPEN.V.ORG# = %KEYED#;

  33747 19 023032   002000 236007                    LDQ     1024,DL
        19 023033   005276 552010 11                 STBQ    RENUM_OPEN+38,'10'O

     6336    33748    3       CALL M$OPEN (RENUM_OPEN) ALTRET(E_PMME);

  33748 19 023034   005230 630400 11                 EPPR0   RENUM_OPEN
        19 023035   450000 713400                    CLIMB   alt,open
        19 023036   410400 401760                    pmme    nvectors=18
        19 023037   024537 702000 19                 TSX2    E_PMME

     6337    33749    3       READ_OLD.BUF_ = VM_HEADER_;

  33749 19 023040   000000 237000 xsym               LDAQ    VM_HEADER_
        19 023041   005326 757000 11                 STAQ    READ_OLD+4

     6338    33750    3       OLD_TYPE=0;

  33750 19 023042   201523 450100                    STZ     OLD_TYPE,,AUTO

     6339    33751    3       IF RENUMBER# THEN NEXT_NUM = 0;

  33751 19 023043   201117 470500                    LDP0    @RENUMBER#,,AUTO
        19 023044   000000 066500                    CMPB    filb='0'B
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:878  
        19 023045   000000 000001                    BDSC    0,,PR0                   by=0,bit=0,n=1
        19 023046   000020 000022 20                 BDSC    16                       by=0,bit=0,n=18
        19 023047   023052 600000 19                 TZE     s:33752

  33751 19 023050   005225 450000 11                 STZ     NEXT_NUM
        19 023051   023055 710000 19                 TRA     SORT_LOOP

     6340    33752    3       ELSE NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;

  33752 19 023052   000000 471400 xsym               LDP1    VM_PROFILE$
        19 023053   100011 235100                    LDA     9,,PR1
        19 023054   005225 755000 11                 STA     NEXT_NUM

     6341    33753    4   SORT_LOOP: DO WHILE('1'B);

  33753 19 023055                       SORT_LOOP    null
     6342    33754    5   READ_AGAIN_1: CALL M$READ (READ_OLD) WHENALTRETURN DO;

  33754 19 023055   005322 630400 11    READ_AGAIN_1 EPPR0   READ_OLD
        19 023056   440000 713400                    CLIMB   alt,read
        19 023057   401400 401760                    pmme    nvectors=4
        19 023060   023062 702000 19                 TSX2    s:33755
        19 023061   023105 710000 19                 TRA     s:33766

     6343    33755    5               IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$EOF THEN EXIT SORT_LOOP;

  33755 19 023062   000000 470400 xsym               LDP0    B$TCB$
        19 023063   000000 471500                    LDP1    0,,PR0
        19 023064   100102 236100                    LDQ     66,,PR1
        19 023065   377770 376007                    ANQ     131064,DL
        19 023066   000060 116007                    CMPQ    48,DL
        19 023067   024225 600000 19                 TZE     s:33965

     6344    33756    5               ELSE IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD

  33756 19 023070   000070 116007                    CMPQ    56,DL
        19 023071   024537 601000 19                 TNZ     E_PMME
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:879  

     6345    33757    6                   THEN DO;

     6346    33758    6                       CALL VMA$ENLARGE_SEGMENT (VM_HEADER_, 1024) ALTRET(E_PMME);

  33758 19 023072   000002 630400 20                 EPPR0   2
        19 023073   000000 631400 20                 EPPR1   0
        19 023074   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 023075   024537 702000 19                 TSX2    E_PMME

     6347    33759    6                       READ_OLD.BUF_ = VM_HEADER_;

  33759 19 023076   000000 237000 xsym               LDAQ    VM_HEADER_
        19 023077   005326 757000 11                 STAQ    READ_OLD+4

     6348    33760    6                       CALL M$PRECORD (FPT_PRECORD) ALTRET(E_PMME); /* Can't

  33760 19 023100   001176 630400 12                 EPPR0   FPT_PRECORD
        19 023101   440003 713400                    CLIMB   alt,+16387
        19 023102   401000 401760                    pmme    nvectors=3
        19 023103   024537 702000 19                 TSX2    E_PMME

     6349    33761                                                use cont, folder may be compressed */
     6350    33762    6                       GOTO READ_AGAIN_1;

  33762 19 023104   023055 710000 19                 TRA     SORT_LOOP

     6351    33763    6                   END;
     6352    33764    5                   ELSE GOTO E_PMME;
     6353    33765    5           END;                         /* WHENALTRETURN */
     6354    33766    4           IF VLP_KEY.TYPE = %VM_TYPE_HEAD THEN

  33766 19 023105   005354 236000 11                 LDQ     VLP_KEY
        19 023106   000777 376003                    ANQ     511,DU
        19 023107   000010 116003                    CMPQ    8,DU
        19 023110   023055 601000 19                 TNZ     SORT_LOOP

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:880  
     6355    33767    5           DO;

     6356    33768    5               IF HEADER_FIELD# = %REN_OPT_DATE THEN

  33768 19 023111   201120 470500                    LDP0    @HEADER_FIELD#,,AUTO
        19 023112   000100 101500                    MRL     fill='000'O
        19 023113   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
        19 023114   201706 000004                    ADSC9   I+100,,AUTO              cn=0,n=4
        19 023115   201706 236100                    LDQ     I+100,,AUTO
        19 023116   000001 116007                    CMPQ    1,DL
        19 023117   023301 601000 19                 TNZ     s:33823

     6357    33769    6               DO;

     6358    33770    6                   IF (LAST+1)*2 >= HMAX THEN

  33770 19 023120   005507 236000 11                 LDQ     LAST
        19 023121   000001 736000                    QLS     1
        19 023122   000002 036007                    ADLQ    2,DL
        19 023123   023136 604000 19                 TMI     s:33776
        19 023124   005503 116000 11                 CMPQ    HMAX
        19 023125   023136 602000 19                 TNC     s:33776

     6359    33771    7                   DO;

     6360    33772    7                       CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024) ALTRET (E_PMME);

  33772 19 023126   000010 630400 20                 EPPR0   8
        19 023127   000000 631400 20                 EPPR1   0
        19 023130   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 023131   024537 702000 19                 TSX2    E_PMME

     6361    33773    7                       HMAX = VBOUND(VM_WORK_)/4;

  33773 19 023132   000000 236000 xsym               LDQ     VM_WORK_
        19 023133   000020 772000                    QRL     16
        19 023134   000002 772000                    QRL     2
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:881  
        19 023135   005503 756000 11                 STQ     HMAX

     6362    33774    7                   END;

     6363    33775
     6364    33776    6                   IF LAST < 0 THEN

  33776 19 023136   005507 235000 11                 LDA     LAST
        19 023137   023264 604000 19                 TMI     PUT_AT_END_UBIN

     6365    33777    6                       GOTO PUT_AT_END_UBIN;
     6366    33778
     6367    33779    7                   IF LAST < 20 THEN DO;

  33779 19 023140   000024 115007                    CMPA    20,DL
        19 023141   023160 605000 19                 TPL     s:33788

     6368    33780
     6369    33781    8                       DO MID = 0 TO LAST;

  33781 19 023142   005510 450000 11                 STZ     MID
        19 023143   023154 710000 19                 TRA     s:33784+1

     6370    33782    8                           IF HOLE.SORT#(MID) > VM_HEADER.CREATION_DATE

  33782 19 023144   000000 470400 xsym               LDP0    VM_HEADER$
        19 023145   005510 235000 11                 LDA     MID
        19 023146   000001 735000                    ALS     1
        19 023147   005502 471400 11                 LDP1    HOLE$
        19 023150   000001 236100                    LDQ     1,,PR0
        19 023151   100001 116105                    CMPQ    1,AL,PR1
        19 023152   023224 602000 19                 TNC     FOUND_UBIN

     6371    33783    8                           THEN GOTO FOUND_UBIN;
     6372    33784    8                       END;

  33784 19 023153   005510 054000 11                 AOS     MID
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:882  
        19 023154   005510 236000 11                 LDQ     MID
        19 023155   005507 116000 11                 CMPQ    LAST
        19 023156   023144 604400 19                 TMOZ    s:33782

     6373    33785    7                       GOTO PUT_AT_END_UBIN;

  33785 19 023157   023264 710000 19                 TRA     PUT_AT_END_UBIN

     6374    33786    7                   END;
     6375    33787    7                   ELSE DO;

     6376    33788    7                       LOW = -1;

  33788 19 023160   000001 336007                    LCQ     1,DL
        19 023161   005506 756000 11                 STQ     LOW

     6377    33789    7                       HIGH = LAST + 1;

  33789 19 023162   000001 035007                    ADLA    1,DL
        19 023163   005505 755000 11                 STA     HIGH

  33789 19 023164                       SPLIT_UBIN   null
     6378    33790    7   SPLIT_UBIN:         ;
     6379    33791    7                       MID = (LOW + HIGH)/2;

  33791 19 023164   005506 236000 11                 LDQ     LOW
        19 023165   005505 036000 11                 ADLQ    HIGH
        19 023166   000002 506007                    DIV     2,DL
        19 023167   005510 756000 11                 STQ     MID

     6380    33792    7                       IF HOLE.SORT#(MID) < VM_HEADER.CREATION_DATE THEN

  33792 19 023170   000000 470400 xsym               LDP0    VM_HEADER$
        19 023171   005510 235000 11                 LDA     MID
        19 023172   000001 735000                    ALS     1
        19 023173   005502 471400 11                 LDP1    HOLE$
        19 023174   100001 236105                    LDQ     1,AL,PR1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:883  
        19 023175   000001 116100                    CMPQ    1,,PR0
        19 023176   023202 603000 19                 TRC     s:33795

     6381    33793    7                           LOW = MID;

  33793 19 023177   005510 235000 11                 LDA     MID
        19 023200   005506 755000 11                 STA     LOW
        19 023201   023210 710000 19                 TRA     s:33799

     6382    33794    7                       ELSE
     6383    33795    7                           IF HOLE.SORT#(MID) > VM_HEADER.CREATION_DATE THEN

  33795 19 023202   000001 236100                    LDQ     1,,PR0
        19 023203   100001 116105                    CMPQ    1,AL,PR1
        19 023204   023224 603000 19                 TRC     FOUND_UBIN

     6384    33796    7                               HIGH = MID;

  33796 19 023205   005510 235000 11                 LDA     MID
        19 023206   005505 755000 11                 STA     HIGH
        19 023207   023210 710000 19                 TRA     s:33799

     6385    33797    7                           ELSE
     6386    33798    7                               GOTO FOUND_UBIN;
     6387    33799    7                       IF (LOW + 1) < HIGH THEN

  33799 19 023210   005506 236000 11                 LDQ     LOW
        19 023211   000001 036007                    ADLQ    1,DL
        19 023212   005505 116000 11                 CMPQ    HIGH
        19 023213   023164 604000 19                 TMI     SPLIT_UBIN

     6388    33800    7                           GOTO SPLIT_UBIN;
     6389    33801    7                       IF HOLE.SORT#(MID) < VM_HEADER.CREATION_DATE THEN

  33801 19 023214   000001 735000                    ALS     1
        19 023215   100001 236105                    LDQ     1,AL,PR1
        19 023216   000001 116100                    CMPQ    1,,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:884  
        19 023217   023221 603000 19                 TRC     s:33803

     6390    33802    7                           MID = MID + 1;

  33802 19 023220   005510 054000 11                 AOS     MID

     6391    33803    7                       IF MID > LAST THEN

  33803 19 023221   005510 236000 11                 LDQ     MID
        19 023222   005507 116000 11                 CMPQ    LAST
        19 023223   023264 605400 19                 TPNZ    PUT_AT_END_UBIN

     6392    33804    7                           GOTO PUT_AT_END_UBIN;
     6393    33805    7                   END;

  33799 19 023224                       FOUND_UBIN   null
     6394    33806    6   FOUND_UBIN:     ;
     6395    33807    6                   LAST = LAST + 1;

  33807 19 023224   005507 054000 11                 AOS     LAST

     6396    33808    6                   SIZE = (LAST - MID) * 8;

  33808 19 023225   005507 236000 11                 LDQ     LAST
        19 023226   005510 136000 11                 SBLQ    MID
        19 023227   000003 736000                    QLS     3
        19 023230   201530 756100                    STQ     SIZE,,AUTO

  33808 19 023231                       MLR_UBIN     null
     6397    33809    6   MLR_UBIN:       ;
     6398    33810    6                  CALL VMX$MRL(ADDR(HOLE(MID))->TEMPLATE, ADDR(HOLE(MID+1))->TEMPLATE,
             33810                            SIZE);

  33810 19 023231   201530 633500                    EPPR3   SIZE,,AUTO
        19 023232   201710 453500                    STP3    I+102,,AUTO
        19 023233   005510 236000 11                 LDQ     MID
        19 023234   000023 736000                    QLS     19
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:885  
        19 023235   000002 036003                    ADLQ    2,DU
        19 023236   005502 036000 11                 ADLQ    HOLE$
        19 023237   201707 756100                    STQ     I+101,,AUTO
        19 023240   005510 236000 11                 LDQ     MID
        19 023241   000023 736000                    QLS     19
        19 023242   005502 036000 11                 ADLQ    HOLE$
        19 023243   201706 756100                    STQ     I+100,,AUTO
        19 023244   201706 630500                    EPPR0   I+100,,AUTO
        19 023245   000021 631400 20                 EPPR1   17
        19 023246   000000 701000 xent               TSX1    VMX$MRL
        19 023247   000000 011000                    NOP     0

     6399    33811    6                   HOLE.MSG_NUM(MID) = VLP_KEY.NUM;

  33811 19 023250   005510 235000 11                 LDA     MID
        19 023251   000001 735000                    ALS     1
        19 023252   005502 470400 11                 LDP0    HOLE$
        19 023253   000000 620005                    EAX0    0,AL
        19 023254   005354 235000 11                 LDA     VLP_KEY
        19 023255   005355 236000 11                 LDQ     VLP_KEY+1
        19 023256   000022 773000                    LRL     18
        19 023257   000000 756110                    STQ     0,X0,PR0

     6400    33812    6                   HOLE.SORT#(MID) = VM_HEADER.CREATION_DATE;

  33812 19 023260   000000 471400 xsym               LDP1    VM_HEADER$
        19 023261   100001 235100                    LDA     1,,PR1
        19 023262   000001 755110                    STA     1,X0,PR0

     6401    33813
     6402    33814    7                   DO WHILE('0'B); /* Never! */

  33814 19 023263   023055 710000 19                 TRA     SORT_LOOP

  33814 19 023264                       PUT_AT_END_* null
     6403    33815    7   PUT_AT_END_UBIN:    ;
     6404    33816    7                       LAST = LAST + 1;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:886  

  33816 19 023264   005507 054000 11                 AOS     LAST

     6405    33817    7                       HOLE.MSG_NUM(LAST) = VLP_KEY.NUM;

  33817 19 023265   005507 235000 11                 LDA     LAST
        19 023266   000001 735000                    ALS     1
        19 023267   005502 470400 11                 LDP0    HOLE$
        19 023270   000000 620005                    EAX0    0,AL
        19 023271   005354 235000 11                 LDA     VLP_KEY
        19 023272   005355 236000 11                 LDQ     VLP_KEY+1
        19 023273   000022 773000                    LRL     18
        19 023274   000000 756110                    STQ     0,X0,PR0

     6406    33818    7                       HOLE.SORT#(LAST) = VM_HEADER.CREATION_DATE;

  33818 19 023275   000000 471400 xsym               LDP1    VM_HEADER$
        19 023276   100001 235100                    LDA     1,,PR1
        19 023277   000001 755110                    STA     1,X0,PR0

     6407    33819    7                   END;

     6408    33820    6               END;                     /* IF DATE */

  33820 19 023300   023055 710000 19                 TRA     SORT_LOOP

     6409    33821    6               ELSE DO;                 /* IF CHAR FIELD */

     6410    33822
     6411    33823    7                   DO SELECT (HEADER_FIELD#);

  33823 19 023301   000100 101500                    MRL     fill='000'O
        19 023302   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
        19 023303   201706 000004                    ADSC9   I+100,,AUTO              cn=0,n=4
        19 023304   201706 236100                    LDQ     I+100,,AUTO
        19 023305   000003 116007                    CMPQ    3,DL
        19 023306   023326 602000 19                 TNC     s:33823+21
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:887  
        19 023307   023341 600000 19                 TZE     s:33827
        19 023310   000100 101500                    MRL     fill='000'O
        19 023311   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
        19 023312   201707 000004                    ADSC9   I+101,,AUTO              cn=0,n=4
        19 023313   201707 236100                    LDQ     I+101,,AUTO
        19 023314   000004 116007                    CMPQ    4,DL
        19 023315   023354 602000 19                 TNC     s:33834
        19 023316   023345 600000 19                 TZE     s:33829
        19 023317   000100 101500                    MRL     fill='000'O
        19 023320   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
        19 023321   201710 000004                    ADSC9   I+102,,AUTO              cn=0,n=4
        19 023322   201710 236100                    LDQ     I+102,,AUTO
        19 023323   000005 116007                    CMPQ    5,DL
        19 023324   023354 601000 19                 TNZ     s:33834
        19 023325   023351 710000 19                 TRA     s:33831
        19 023326   000100 101500                    MRL     fill='000'O
        19 023327   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
        19 023330   201711 000004                    ADSC9   I+103,,AUTO              cn=0,n=4
        19 023331   201711 236100                    LDQ     I+103,,AUTO
        19 023332   000002 116007                    CMPQ    2,DL
        19 023333   023354 601000 19                 TNZ     s:33834
        19 023334   023335 710000 19                 TRA     s:33825

     6412    33824    7                       SELECT (%REN_OPT_FROM);

     6413    33825    7                       FLDPTR$ = VM_HEADER.FROM$;

  33825 19 023335   000000 471400 xsym               LDP1    VM_HEADER$
        19 023336   100023 236100                    LDQ     19,,PR1
        19 023337   201536 756100                    STQ     FLDPTR$,,AUTO
        19 023340   023354 710000 19                 TRA     s:33834

     6414    33826    7                       SELECT (%REN_OPT_REF);

     6415    33827    7                       FLDPTR$ = VM_HEADER.REFERENCE$;

  33827 19 023341   000000 471400 xsym               LDP1    VM_HEADER$
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:888  
        19 023342   100024 236100                    LDQ     20,,PR1
        19 023343   201536 756100                    STQ     FLDPTR$,,AUTO
        19 023344   023354 710000 19                 TRA     s:33834

     6416    33828    7                       SELECT (%REN_OPT_SUBJ);

     6417    33829    7                       FLDPTR$ = VM_HEADER.SUBJECT$;

  33829 19 023345   000000 471400 xsym               LDP1    VM_HEADER$
        19 023346   100030 236100                    LDQ     24,,PR1
        19 023347   201536 756100                    STQ     FLDPTR$,,AUTO
        19 023350   023354 710000 19                 TRA     s:33834

     6418    33830    7                       SELECT (%REN_OPT_TO);

     6419    33831    7                       FLDPTR$ = VM_HEADER.TO$;

  33831 19 023351   000000 471400 xsym               LDP1    VM_HEADER$
        19 023352   100031 236100                    LDQ     25,,PR1
        19 023353   201536 756100                    STQ     FLDPTR$,,AUTO

     6420    33832    7                   END; /* SELECT */

     6421    33833
     6422    33834    7                   IF (LAST+1)*2 >= HMAX THEN DO;

  33834 19 023354   005507 236000 11                 LDQ     LAST
        19 023355   000001 736000                    QLS     1
        19 023356   000002 036007                    ADLQ    2,DL
        19 023357   023413 604000 19                 TMI     s:33845
        19 023360   005503 116000 11                 CMPQ    HMAX
        19 023361   023413 602000 19                 TNC     s:33845

     6423    33835    7                       CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024) ALTRET (E_PMME);

  33835 19 023362   000010 630400 20                 EPPR0   8
        19 023363   000000 631400 20                 EPPR1   0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:889  
        19 023364   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 023365   024537 702000 19                 TSX2    E_PMME

     6424    33836    7                       TEMP$ = PINCRW(STASH$,1024);

  33836 19 023366   201532 236100                    LDQ     STASH$,,AUTO
        19 023367   002000 036003                    ADLQ    1024,DU
        19 023370   201533 756100                    STQ     TEMP$,,AUTO

     6425    33837    7                       CALL VMX$MRL (STASH$->STASH,

  33837 19 023371   201531 630500                    EPPR0   STASH_LEN,,AUTO
        19 023372   201710 450500                    STP0    I+102,,AUTO
        19 023373   201532 237100                    LDAQ    STASH$,,AUTO
        19 023374   201706 757100                    STAQ    I+100,,AUTO
        19 023375   201706 630500                    EPPR0   I+100,,AUTO
        19 023376   000021 631400 20                 EPPR1   17
        19 023377   000000 701000 xent               TSX1    VMX$MRL
        19 023400   000000 011000                    NOP     0

     6426    33838    7                         TEMP$->STASH,
     6427    33839    7                         STASH_LEN);
     6428    33840    7                       STASH$ = PINCRW(STASH$,1024);

  33840 19 023401   201532 236100                    LDQ     STASH$,,AUTO
        19 023402   002000 036003                    ADLQ    1024,DU
        19 023403   201532 756100                    STQ     STASH$,,AUTO

     6429    33841    7                       HMAX = POFFW(STASH$,HOLE$);

  33841 19 023404   005502 235000 11                 LDA     HOLE$
        19 023405   000022 771000                    ARL     18
        19 023406   201706 755100                    STA     I+100,,AUTO
        19 023407   201532 236100                    LDQ     STASH$,,AUTO
        19 023410   000022 772000                    QRL     18
        19 023411   201706 136100                    SBLQ    I+100,,AUTO
        19 023412   005503 756000 11                 STQ     HMAX
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:890  

     6430    33842
     6431    33843    7                   END;

     6432    33844
     6433    33845    6                   IF FLDPTR$ = ADDR(NIL) THEN

  33845 19 023413   201536 236100                    LDQ     FLDPTR$,,AUTO
        19 023414   000022 116000 20                 CMPQ    18
        19 023415   024152 600000 19                 TZE     NIL_PTR

     6434    33846    6                       GOTO NIL_PTR;
     6435    33847
     6436    33848    6                   IF (VBOUND(VM_WORK_) + 1) -

  33848 19 023416   201536 470500                    LDP0    FLDPTR$,,AUTO
        19 023417   000100 101500                    MRL     fill='000'O
        19 023420   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        19 023421   201706 000004                    ADSC9   I+100,,AUTO              cn=0,n=4
        19 023422   201706 236100                    LDQ     I+100,,AUTO
        19 023423   201531 036100                    ADLQ    STASH_LEN,,AUTO
        19 023424   201707 756100                    STQ     I+101,,AUTO
        19 023425   005503 236000 11                 LDQ     HMAX
        19 023426   000002 736000                    QLS     2
        19 023427   201707 036100                    ADLQ    I+101,,AUTO
        19 023430   201710 756100                    STQ     I+102,,AUTO
        19 023431   000000 236000 xsym               LDQ     VM_WORK_
        19 023432   000020 772000                    QRL     16
        19 023433   201710 136100                    SBLQ    I+102,,AUTO
        19 023434   000016 116007                    CMPQ    14,DL
        19 023435   023442 605000 19                 TPL     s:33854

     6437    33849    7                     ((FLDPTR$->B$TEXTC.L+1) + STASH_LEN + ((HMAX+1)*4)) < 10 THEN DO;

     6438    33850
     6439    33851    7                       CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024) ALTRET(E_PMME);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:891  
  33851 19 023436   000010 630400 20                 EPPR0   8
        19 023437   000000 631400 20                 EPPR1   0
        19 023440   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 023441   024537 702000 19                 TSX2    E_PMME

     6440    33852    7                   END;

     6441    33853
     6442    33854    6                   IF LAST < 0 THEN

  33854 19 023442   005507 235000 11                 LDA     LAST
        19 023443   024101 604000 19                 TMI     PUT_AT_END_CHAR

     6443    33855    6                       GOTO PUT_AT_END_CHAR;
     6444    33856
     6445    33857    7                   IF LAST < 20 THEN DO;

  33857 19 023444   000024 115007                    CMPA    20,DL
        19 023445   023516 605000 19                 TPL     s:33870

     6446    33858
     6447    33859    8                       DO MID = 0 TO LAST;

  33859 19 023446   005510 450000 11                 STZ     MID
        19 023447   023512 710000 19                 TRA     s:33866+1

     6448    33860    9                           IF HOLE.SORT#(MID) > 0 THEN DO;

  33860 19 023450   005510 235000 11                 LDA     MID
        19 023451   000001 735000                    ALS     1
        19 023452   005502 470400 11                 LDP0    HOLE$
        19 023453   000001 235105                    LDA     1,AL,PR0
        19 023454   023511 600000 19                 TZE     s:33866

     6449    33861    9                               TEMP$ = PINCRC(STASH$,HOLE.SORT#(MID));

  33861 19 023455   005510 235000 11                 LDA     MID
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:892  
        19 023456   000001 735000                    ALS     1
        19 023457   000001 236105                    LDQ     1,AL,PR0
        19 023460   000020 736000                    QLS     16
        19 023461   201532 036100                    ADLQ    STASH$,,AUTO
        19 023462   201533 756100                    STQ     TEMP$,,AUTO

     6450    33862    9                               IF SUBSTR(TEMP$->B$TEXTC.C, 0, TEMP$->B$TEXTC.L) >

  33862 19 023463   201533 471500                    LDP1    TEMP$,,AUTO
        19 023464   000100 101500                    MRL     fill='000'O
        19 023465   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 023466   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 023467   201706 220100                    LDX0    I+100,,AUTO
        19 023470   000100 101500                    MRL     fill='000'O
        19 023471   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 023472   201707 000002                    ADSC9   I+101,,AUTO              cn=0,n=2
        19 023473   201707 221100                    LDX1    I+101,,AUTO
        19 023474   201536 473500                    LDP3    FLDPTR$,,AUTO
        19 023475   000100 101500                    MRL     fill='000'O
        19 023476   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023477   201710 000002                    ADSC9   I+102,,AUTO              cn=0,n=2
        19 023500   201710 222100                    LDX2    I+102,,AUTO
        19 023501   000100 101500                    MRL     fill='000'O
        19 023502   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023503   201711 000002                    ADSC9   I+103,,AUTO              cn=0,n=2
        19 023504   201711 223100                    LDX3    I+103,,AUTO
        19 023505   040140 106540                    CMPC    fill='040'O
        19 023506   300000 200013                    ADSC9   0,,PR3                   cn=1,n=*X3
        19 023507   100000 200011                    ADSC9   0,,PR1                   cn=1,n=*X1
        19 023510   023663 602000 19                 TNC     FOUND_CHAR

     6451    33863    9                                 SUBSTR(FLDPTR$->B$TEXTC.C, 0, FLDPTR$->B$TEXTC.L)
     6452    33864    9                               THEN GOTO FOUND_CHAR;
     6453    33865    9                           END;

     6454    33866    8                       END;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:893  
  33866 19 023511   005510 054000 11                 AOS     MID
        19 023512   005510 236000 11                 LDQ     MID
        19 023513   005507 116000 11                 CMPQ    LAST
        19 023514   023450 604400 19                 TMOZ    s:33860

     6455    33867    7                       GOTO PUT_AT_END_CHAR;

  33867 19 023515   024101 710000 19                 TRA     PUT_AT_END_CHAR

     6456    33868    7                   END;
     6457    33869    7                   ELSE DO;

     6458    33870    7                       LOW = -1;

  33870 19 023516   000001 336007                    LCQ     1,DL
        19 023517   005506 756000 11                 STQ     LOW

     6459    33871    7                       HIGH = LAST + 1;

  33871 19 023520   000001 035007                    ADLA    1,DL
        19 023521   005505 755000 11                 STA     HIGH

  33871 19 023522                       SPLIT_CHAR   null
     6460    33872    7   SPLIT_CHAR:         ;
     6461    33873    7                       MID = (LOW + HIGH)/2;

  33873 19 023522   005506 236000 11                 LDQ     LOW
        19 023523   005505 036000 11                 ADLQ    HIGH
        19 023524   000002 506007                    DIV     2,DL
        19 023525   005510 756000 11                 STQ     MID

     6462    33874    8                       IF HOLE.SORT#(MID) > 0 THEN DO;

  33874 19 023526   005510 235000 11                 LDA     MID
        19 023527   000001 735000                    ALS     1
        19 023530   005502 470400 11                 LDP0    HOLE$
        19 023531   000001 235105                    LDA     1,AL,PR0
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:894  
        19 023532   023656 600000 19                 TZE     s:33894

     6463    33875    8                           TEMP$ = PINCRC(STASH$, HOLE.SORT#(MID));

  33875 19 023533   005510 235000 11                 LDA     MID
        19 023534   000001 735000                    ALS     1
        19 023535   000001 236105                    LDQ     1,AL,PR0
        19 023536   000020 736000                    QLS     16
        19 023537   201532 036100                    ADLQ    STASH$,,AUTO
        19 023540   201533 756100                    STQ     TEMP$,,AUTO

     6464    33876    8                           IF SUBSTR(TEMP$->B$TEXTC.C,0,TEMP$->B$TEXTC.L) <

  33876 19 023541   201533 471500                    LDP1    TEMP$,,AUTO
        19 023542   000100 101500                    MRL     fill='000'O
        19 023543   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 023544   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 023545   201706 220100                    LDX0    I+100,,AUTO
        19 023546   000100 101500                    MRL     fill='000'O
        19 023547   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 023550   201707 000002                    ADSC9   I+101,,AUTO              cn=0,n=2
        19 023551   201707 221100                    LDX1    I+101,,AUTO
        19 023552   201536 473500                    LDP3    FLDPTR$,,AUTO
        19 023553   000100 101500                    MRL     fill='000'O
        19 023554   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023555   201710 000002                    ADSC9   I+102,,AUTO              cn=0,n=2
        19 023556   201710 222100                    LDX2    I+102,,AUTO
        19 023557   000100 101500                    MRL     fill='000'O
        19 023560   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023561   201711 000002                    ADSC9   I+103,,AUTO              cn=0,n=2
        19 023562   201711 223100                    LDX3    I+103,,AUTO
        19 023563   040140 106540                    CMPC    fill='040'O
        19 023564   100000 200011                    ADSC9   0,,PR1                   cn=1,n=*X1
        19 023565   300000 200013                    ADSC9   0,,PR3                   cn=1,n=*X3
        19 023566   023572 603000 19                 TRC     s:33880

     6465    33877    8                             SUBSTR(FLDPTR$->B$TEXTC.C, 0, FLDPTR$->B$TEXTC.L) THEN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:895  
     6466    33878    8                               LOW = MID;

  33878 19 023567   005510 235000 11                 LDA     MID
        19 023570   005506 755000 11                 STA     LOW
        19 023571   023621 710000 19                 TRA     s:33885

     6467    33879    8                           ELSE
     6468    33880    8                               IF SUBSTR(TEMP$->B$TEXTC.C,0,TEMP$->B$TEXTC.L) >

  33880 19 023572   000100 101500                    MRL     fill='000'O
        19 023573   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 023574   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 023575   201706 220100                    LDX0    I+100,,AUTO
        19 023576   000100 101500                    MRL     fill='000'O
        19 023577   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 023600   201707 000002                    ADSC9   I+101,,AUTO              cn=0,n=2
        19 023601   201707 221100                    LDX1    I+101,,AUTO
        19 023602   000100 101500                    MRL     fill='000'O
        19 023603   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023604   201710 000002                    ADSC9   I+102,,AUTO              cn=0,n=2
        19 023605   201710 222100                    LDX2    I+102,,AUTO
        19 023606   000100 101500                    MRL     fill='000'O
        19 023607   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023610   201711 000002                    ADSC9   I+103,,AUTO              cn=0,n=2
        19 023611   201711 223100                    LDX3    I+103,,AUTO
        19 023612   040140 106540                    CMPC    fill='040'O
        19 023613   300000 200013                    ADSC9   0,,PR3                   cn=1,n=*X3
        19 023614   100000 200011                    ADSC9   0,,PR1                   cn=1,n=*X1
        19 023615   023663 603000 19                 TRC     FOUND_CHAR

     6469    33881    8                                 SUBSTR(FLDPTR$->B$TEXTC.C,0,FLDPTR$->B$TEXTC.L) THEN
     6470    33882    8                                   HIGH = MID;

  33882 19 023616   005510 235000 11                 LDA     MID
        19 023617   005505 755000 11                 STA     HIGH
        19 023620   023621 710000 19                 TRA     s:33885

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:896  
     6471    33883    8                               ELSE
     6472    33884    8                                   GOTO FOUND_CHAR;
     6473    33885    8                           IF (LOW + 1) < HIGH THEN

  33885 19 023621   005506 236000 11                 LDQ     LOW
        19 023622   000001 036007                    ADLQ    1,DL
        19 023623   005505 116000 11                 CMPQ    HIGH
        19 023624   023522 604000 19                 TMI     SPLIT_CHAR

     6474    33886    8                               GOTO SPLIT_CHAR;
     6475    33887    8                           IF SUBSTR(TEMP$->B$TEXTC.C,0,TEMP$->B$TEXTC.L) <

  33887 19 023625   000100 101500                    MRL     fill='000'O
        19 023626   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 023627   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 023630   201706 220100                    LDX0    I+100,,AUTO
        19 023631   000100 101500                    MRL     fill='000'O
        19 023632   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 023633   201707 000002                    ADSC9   I+101,,AUTO              cn=0,n=2
        19 023634   201707 221100                    LDX1    I+101,,AUTO
        19 023635   000100 101500                    MRL     fill='000'O
        19 023636   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023637   201710 000002                    ADSC9   I+102,,AUTO              cn=0,n=2
        19 023640   201710 222100                    LDX2    I+102,,AUTO
        19 023641   000100 101500                    MRL     fill='000'O
        19 023642   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023643   201711 000002                    ADSC9   I+103,,AUTO              cn=0,n=2
        19 023644   201711 223100                    LDX3    I+103,,AUTO
        19 023645   040140 106540                    CMPC    fill='040'O
        19 023646   100000 200011                    ADSC9   0,,PR1                   cn=1,n=*X1
        19 023647   300000 200013                    ADSC9   0,,PR3                   cn=1,n=*X3
        19 023650   023652 603000 19                 TRC     s:33890

     6476    33888    8                             SUBSTR(FLDPTR$->B$TEXTC.C, 0, FLDPTR$->B$TEXTC.L) THEN
     6477    33889    8                               MID = MID + 1;

  33889 19 023651   005510 054000 11                 AOS     MID
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:897  

     6478    33890    8                           IF MID > LAST THEN

  33890 19 023652   005510 236000 11                 LDQ     MID
        19 023653   005507 116000 11                 CMPQ    LAST
        19 023654   024101 605400 19                 TPNZ    PUT_AT_END_CHAR

     6479    33891    8                               GOTO PUT_AT_END_CHAR;
     6480    33892    8                       END;

  33892 19 023655   023663 710000 19                 TRA     FOUND_CHAR

     6481    33893    8                       ELSE DO;

     6482    33894    8                           LOW = LOW + 1;

  33894 19 023656   005506 054000 11                 AOS     LOW

     6483    33895    8                           IF LOW = LAST THEN

  33895 19 023657   005506 236000 11                 LDQ     LOW
        19 023660   005507 116000 11                 CMPQ    LAST
        19 023661   024101 600000 19                 TZE     PUT_AT_END_CHAR

     6484    33896    8                               GOTO PUT_AT_END_CHAR;
     6485    33897    8                           ELSE
     6486    33898    8                               GOTO SPLIT_CHAR;

  33898 19 023662   023522 710000 19                 TRA     SPLIT_CHAR

     6487    33899    8                       END;

  33899 19 023663                       FOUND_CHAR   null
     6488    33900    7                   END;
     6489    33901    6   FOUND_CHAR:     ;                  /* check for duplicates */
     6490    33902
     6491    33903    7   CHECK_DUPES:    DO I = MID TO LAST;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:898  

  33903 19 023663   005510 235000 11    CHECK_DUPES  LDA     MID
        19 023664   201535 755100                    STA     I,,AUTO
        19 023665   024001 710000 19                 TRA     s:33921+3

     6492    33904    7                       TEMP$ = PINCRC(STASH$,HOLE.SORT#(I));

  33904 19 023666   201535 235100                    LDA     I,,AUTO
        19 023667   000001 735000                    ALS     1
        19 023670   005502 470400 11                 LDP0    HOLE$
        19 023671   000001 236105                    LDQ     1,AL,PR0
        19 023672   000020 736000                    QLS     16
        19 023673   201532 036100                    ADLQ    STASH$,,AUTO
        19 023674   201533 756100                    STQ     TEMP$,,AUTO

     6493    33905    7                       IF I = LAST THEN

  33905 19 023675   201535 236100                    LDQ     I,,AUTO
        19 023676   023706 604000 19                 TMI     s:33908
        19 023677   005507 116000 11                 CMPQ    LAST
        19 023700   023706 601000 19                 TNZ     s:33908

     6494    33906    7                           NEXT$ = PINCRC(STASH$,HOLE.SORT#(I));

  33906 19 023701   000001 236105                    LDQ     1,AL,PR0
        19 023702   000020 736000                    QLS     16
        19 023703   201532 036100                    ADLQ    STASH$,,AUTO
        19 023704   201534 756100                    STQ     NEXT$,,AUTO
        19 023705   023712 710000 19                 TRA     s:33910

     6495    33907    7                       ELSE
     6496    33908    7                           NEXT$ = PINCRC(STASH$,HOLE.SORT#(I+1));

  33908 19 023706   000003 236105                    LDQ     3,AL,PR0
        19 023707   000020 736000                    QLS     16
        19 023710   201532 036100                    ADLQ    STASH$,,AUTO
        19 023711   201534 756100                    STQ     NEXT$,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:899  

     6497    33909
     6498    33910    7                       IF (SUBSTR(TEMP$->B$TEXTC.C,0,TEMP$->B$TEXTC.L) =

  33910 19 023712   201533 471500                    LDP1    TEMP$,,AUTO
        19 023713   000100 101500                    MRL     fill='000'O
        19 023714   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 023715   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 023716   201706 220100                    LDX0    I+100,,AUTO
        19 023717   000100 101500                    MRL     fill='000'O
        19 023720   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 023721   201707 000002                    ADSC9   I+101,,AUTO              cn=0,n=2
        19 023722   201707 221100                    LDX1    I+101,,AUTO
        19 023723   201536 473500                    LDP3    FLDPTR$,,AUTO
        19 023724   000100 101500                    MRL     fill='000'O
        19 023725   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023726   201710 000002                    ADSC9   I+102,,AUTO              cn=0,n=2
        19 023727   201710 222100                    LDX2    I+102,,AUTO
        19 023730   000100 101500                    MRL     fill='000'O
        19 023731   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023732   201711 000002                    ADSC9   I+103,,AUTO              cn=0,n=2
        19 023733   201711 223100                    LDX3    I+103,,AUTO
        19 023734   040140 106540                    CMPC    fill='040'O
        19 023735   100000 200011                    ADSC9   0,,PR1                   cn=1,n=*X1
        19 023736   300000 200013                    ADSC9   0,,PR3                   cn=1,n=*X3
        19 023737   023765 600000 19                 TZE     s:33915
        19 023740   201534 474500                    LDP4    NEXT$,,AUTO
        19 023741   000100 101500                    MRL     fill='000'O
        19 023742   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        19 023743   201712 000002                    ADSC9   I+104,,AUTO              cn=0,n=2
        19 023744   201712 221100                    LDX1    I+104,,AUTO
        19 023745   000100 101500                    MRL     fill='000'O
        19 023746   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        19 023747   201713 000002                    ADSC9   I+105,,AUTO              cn=0,n=2
        19 023750   201713 223100                    LDX3    I+105,,AUTO
        19 023751   000100 101500                    MRL     fill='000'O
        19 023752   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:900  
        19 023753   201714 000002                    ADSC9   I+106,,AUTO              cn=0,n=2
        19 023754   201714 224100                    LDX4    I+106,,AUTO
        19 023755   000100 101500                    MRL     fill='000'O
        19 023756   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 023757   201715 000002                    ADSC9   I+107,,AUTO              cn=0,n=2
        19 023760   201715 225100                    LDX5    I+107,,AUTO
        19 023761   040140 106540                    CMPC    fill='040'O
        19 023762   400000 200013                    ADSC9   0,,PR4                   cn=1,n=*X3
        19 023763   300000 200015                    ADSC9   0,,PR3                   cn=1,n=*X5
        19 023764   023766 601000 19                 TNZ     s:33917

     6499    33911    7                         SUBSTR(FLDPTR$->B$TEXTC.C,0,FLDPTR$->B$TEXTC.L)) OR
     6500    33912    7                         (SUBSTR(NEXT$->B$TEXTC.C,0,NEXT$->B$TEXTC.L) =
     6501    33913    7                         SUBSTR(FLDPTR$->B$TEXTC.C,0,FLDPTR$->B$TEXTC.L))
     6502    33914    8                       THEN DO; /* nothing, just loop */

     6503    33915    8                       END;

  33915 19 023765   023776 710000 19                 TRA     s:33921

     6504    33916    8                       ELSE DO;

     6505    33917    8                           MID = I;

  33917 19 023766   201535 235100                    LDA     I,,AUTO
        19 023767   005510 755000 11                 STA     MID

     6506    33918    8                           TEMP$ = PINCRC(STASH$,HOLE.SORT#(MID));

  33918 19 023770   000001 735000                    ALS     1
        19 023771   000001 236105                    LDQ     1,AL,PR0
        19 023772   000020 736000                    QLS     16
        19 023773   201532 036100                    ADLQ    STASH$,,AUTO
        19 023774   201533 756100                    STQ     TEMP$,,AUTO

     6507    33919    8                           EXIT CHECK_DUPES;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:901  
  33919 19 023775   024005 710000 19                 TRA     s:33923

     6508    33920    8                       END;
     6509    33921    7                   END;

  33921 19 023776   201535 235100                    LDA     I,,AUTO
        19 023777   000001 035007                    ADLA    1,DL
        19 024000   201535 755100                    STA     I,,AUTO
        19 024001   201535 236100                    LDQ     I,,AUTO
        19 024002   024005 604000 19                 TMI     s:33923
        19 024003   005507 116000 11                 CMPQ    LAST
        19 024004   023666 604400 19                 TMOZ    s:33904

     6510    33922
     6511    33923    6                   LAST = LAST + 1;

  33923 19 024005   005507 054000 11                 AOS     LAST

     6512    33924    6                   SIZE = (LAST - MID) * 8;

  33924 19 024006   005507 236000 11                 LDQ     LAST
        19 024007   005510 136000 11                 SBLQ    MID
        19 024010   000003 736000                    QLS     3
        19 024011   201530 756100                    STQ     SIZE,,AUTO

  33924 19 024012                       MLR_CHAR     null
     6513    33925    6   MLR_CHAR:       ;
     6514    33926    6                   CALL VMX$MRL(HOLE(MID), HOLE(MID+1), SIZE);

  33926 19 024012   201530 631500                    EPPR1   SIZE,,AUTO
        19 024013   201710 451500                    STP1    I+102,,AUTO
        19 024014   005510 236000 11                 LDQ     MID
        19 024015   000023 736000                    QLS     19
        19 024016   000002 036003                    ADLQ    2,DU
        19 024017   005502 036000 11                 ADLQ    HOLE$
        19 024020   201707 756100                    STQ     I+101,,AUTO
        19 024021   005510 236000 11                 LDQ     MID
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:902  
        19 024022   000023 736000                    QLS     19
        19 024023   005502 036000 11                 ADLQ    HOLE$
        19 024024   201706 756100                    STQ     I+100,,AUTO
        19 024025   201706 630500                    EPPR0   I+100,,AUTO
        19 024026   000021 631400 20                 EPPR1   17
        19 024027   000000 701000 xent               TSX1    VMX$MRL
        19 024030   000000 011000                    NOP     0

     6515    33927    6                   HOLE.MSG_NUM(MID) = VLP_KEY.NUM;

  33927 19 024031   005510 235000 11                 LDA     MID
        19 024032   000001 735000                    ALS     1
        19 024033   005502 470400 11                 LDP0    HOLE$
        19 024034   000000 620005                    EAX0    0,AL
        19 024035   005354 235000 11                 LDA     VLP_KEY
        19 024036   005355 236000 11                 LDQ     VLP_KEY+1
        19 024037   000022 773000                    LRL     18
        19 024040   000000 756110                    STQ     0,X0,PR0

     6516    33928    6                   HOLE.SORT#(MID) = STASH_LEN + 1;

  33928 19 024041   201531 235100                    LDA     STASH_LEN,,AUTO
        19 024042   000001 035007                    ADLA    1,DL
        19 024043   000001 755110                    STA     1,X0,PR0

     6517    33929    6                   TEMP$ = PINCRC(STASH$,STASH_LEN + 1);

  33929 19 024044   201531 236100                    LDQ     STASH_LEN,,AUTO
        19 024045   000020 736000                    QLS     16
        19 024046   200000 036007                    ADLQ    65536,DL
        19 024047   201532 036100                    ADLQ    STASH$,,AUTO
        19 024050   201533 756100                    STQ     TEMP$,,AUTO

     6518    33930    6                   TEMP$->B$TEXTC.L = FLDPTR$->B$TEXTC.L;

  33930 19 024051   201536 471500                    LDP1    FLDPTR$,,AUTO
        19 024052   201533 473500                    LDP3    TEMP$,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:903  
        19 024053   000100 100500                    MLR     fill='000'O
        19 024054   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 024055   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

     6519    33931    6                   TEMP$->B$TEXTC.C = FLDPTR$->B$TEXTC.C;

  33931 19 024056   000100 101500                    MRL     fill='000'O
        19 024057   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 024060   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 024061   201706 221100                    LDX1    I+100,,AUTO
        19 024062   000100 101500                    MRL     fill='000'O
        19 024063   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 024064   201707 000002                    ADSC9   I+101,,AUTO              cn=0,n=2
        19 024065   201707 222100                    LDX2    I+101,,AUTO
        19 024066   040140 100540                    MLR     fill='040'O
        19 024067   100000 200012                    ADSC9   0,,PR1                   cn=1,n=*X2
        19 024070   300000 200011                    ADSC9   0,,PR3                   cn=1,n=*X1

     6520    33932    6                   STASH_LEN = STASH_LEN + FLDPTR$->B$TEXTC.L + 1;

  33932 19 024071   000100 101500                    MRL     fill='000'O
        19 024072   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 024073   201706 000004                    ADSC9   I+100,,AUTO              cn=0,n=4
        19 024074   201706 236100                    LDQ     I+100,,AUTO
        19 024075   201531 036100                    ADLQ    STASH_LEN,,AUTO
        19 024076   000001 036007                    ADLQ    1,DL
        19 024077   201531 756100                    STQ     STASH_LEN,,AUTO

     6521    33933    7                   DO WHILE('0'B); /* Never! */

  33933 19 024100   024151 710000 19                 TRA     s:33944

  33932 19 024101                       PUT_AT_END_* null
     6522    33934    7   PUT_AT_END_CHAR:    ;
     6523    33935    7                       LAST = LAST + 1;

  33935 19 024101   005507 054000 11                 AOS     LAST
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:904  

     6524    33936    7                       HOLE.MSG_NUM(LAST) = VLP_KEY.NUM;

  33936 19 024102   005507 235000 11                 LDA     LAST
        19 024103   000001 735000                    ALS     1
        19 024104   005502 470400 11                 LDP0    HOLE$
        19 024105   000000 620005                    EAX0    0,AL
        19 024106   005354 235000 11                 LDA     VLP_KEY
        19 024107   005355 236000 11                 LDQ     VLP_KEY+1
        19 024110   000022 773000                    LRL     18
        19 024111   000000 756110                    STQ     0,X0,PR0

     6525    33937    7                       HOLE.SORT#(LAST) = STASH_LEN + 1;

  33937 19 024112   201531 235100                    LDA     STASH_LEN,,AUTO
        19 024113   000001 035007                    ADLA    1,DL
        19 024114   000001 755110                    STA     1,X0,PR0

     6526    33938    7                       TEMP$ = PINCRC(STASH$,STASH_LEN + 1);

  33938 19 024115   201531 236100                    LDQ     STASH_LEN,,AUTO
        19 024116   000020 736000                    QLS     16
        19 024117   200000 036007                    ADLQ    65536,DL
        19 024120   201532 036100                    ADLQ    STASH$,,AUTO
        19 024121   201533 756100                    STQ     TEMP$,,AUTO

     6527    33939    7                       TEMP$->B$TEXTC.L = FLDPTR$->B$TEXTC.L;

  33939 19 024122   201536 471500                    LDP1    FLDPTR$,,AUTO
        19 024123   201533 473500                    LDP3    TEMP$,,AUTO
        19 024124   000100 100500                    MLR     fill='000'O
        19 024125   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 024126   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

     6528    33940    7                       TEMP$->B$TEXTC.C = FLDPTR$->B$TEXTC.C;

  33940 19 024127   000100 101500                    MRL     fill='000'O
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:905  
        19 024130   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        19 024131   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 024132   201706 221100                    LDX1    I+100,,AUTO
        19 024133   000100 101500                    MRL     fill='000'O
        19 024134   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 024135   201707 000002                    ADSC9   I+101,,AUTO              cn=0,n=2
        19 024136   201707 222100                    LDX2    I+101,,AUTO
        19 024137   040140 100540                    MLR     fill='040'O
        19 024140   100000 200012                    ADSC9   0,,PR1                   cn=1,n=*X2
        19 024141   300000 200011                    ADSC9   0,,PR3                   cn=1,n=*X1

     6529    33941    7                       STASH_LEN = STASH_LEN + FLDPTR$->B$TEXTC.L + 1;

  33941 19 024142   000100 101500                    MRL     fill='000'O
        19 024143   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        19 024144   201706 000004                    ADSC9   I+100,,AUTO              cn=0,n=4
        19 024145   201706 236100                    LDQ     I+100,,AUTO
        19 024146   201531 036100                    ADLQ    STASH_LEN,,AUTO
        19 024147   000001 036007                    ADLQ    1,DL
        19 024150   201531 756100                    STQ     STASH_LEN,,AUTO

     6530    33942    7                   END;

     6531    33943
     6532    33944    7                   DO WHILE ('0'B); /* Never! */

  33944 19 024151   023055 710000 19                 TRA     SORT_LOOP

     6533    33945    8   NIL_PTR:            DO MID = 0 TO LAST+1;

  33945 19 024152   005510 450000 11    NIL_PTR      STZ     MID
        19 024153   024220 710000 19                 TRA     s:33957+1

     6534    33946    8                           IF HOLE.SORT#(MID) > 0 /* 1st non-zero element */

  33946 19 024154   005510 235000 11                 LDA     MID
        19 024155   000001 735000                    ALS     1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:906  
        19 024156   005502 470400 11                 LDP0    HOLE$
        19 024157   000001 235105                    LDA     1,AL,PR0
        19 024160   024217 600000 19                 TZE     s:33957

     6535    33947    9                           THEN DO;

     6536    33948    9                               LAST = LAST + 1;

  33948 19 024161   005507 054000 11                 AOS     LAST

     6537    33949    9                               SIZE = (LAST - MID) * 8;

  33949 19 024162   005507 236000 11                 LDQ     LAST
        19 024163   005510 136000 11                 SBLQ    MID
        19 024164   000003 736000                    QLS     3
        19 024165   201530 756100                    STQ     SIZE,,AUTO

     6538    33950    9                               CALL VMX$MRL (HOLE(MID),

  33950 19 024166   201530 631500                    EPPR1   SIZE,,AUTO
        19 024167   201710 451500                    STP1    I+102,,AUTO
        19 024170   005510 236000 11                 LDQ     MID
        19 024171   000023 736000                    QLS     19
        19 024172   000002 036003                    ADLQ    2,DU
        19 024173   005502 036000 11                 ADLQ    HOLE$
        19 024174   201707 756100                    STQ     I+101,,AUTO
        19 024175   005510 236000 11                 LDQ     MID
        19 024176   000023 736000                    QLS     19
        19 024177   005502 036000 11                 ADLQ    HOLE$
        19 024200   201706 756100                    STQ     I+100,,AUTO
        19 024201   201706 630500                    EPPR0   I+100,,AUTO
        19 024202   000021 631400 20                 EPPR1   17
        19 024203   000000 701000 xent               TSX1    VMX$MRL
        19 024204   000000 011000                    NOP     0

     6539    33951    9                                 HOLE(MID+1),
     6540    33952    9                                 SIZE);
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:907  
     6541    33953    9                               HOLE.MSG_NUM(MID) = VLP_KEY.NUM;

  33953 19 024205   005510 235000 11                 LDA     MID
        19 024206   000001 735000                    ALS     1
        19 024207   005502 470400 11                 LDP0    HOLE$
        19 024210   000000 620005                    EAX0    0,AL
        19 024211   005354 235000 11                 LDA     VLP_KEY
        19 024212   005355 236000 11                 LDQ     VLP_KEY+1
        19 024213   000022 773000                    LRL     18
        19 024214   000000 756110                    STQ     0,X0,PR0

     6542    33954    9                               HOLE.SORT#(MID) = 0;

  33954 19 024215   000001 450110                    STZ     1,X0,PR0

     6543    33955    9                               EXIT NIL_PTR;

  33955 19 024216   024224 710000 19                 TRA     s:33961

     6544    33956    9                           END;
     6545    33957    8                       END;

  33957 19 024217   005510 054000 11                 AOS     MID
        19 024220   005507 236000 11                 LDQ     LAST
        19 024221   000001 036007                    ADLQ    1,DL
        19 024222   005510 116000 11                 CMPQ    MID
        19 024223   024154 605000 19                 TPL     s:33946

     6546    33958    7                   END;

     6547    33959    6               END;                     /* IF CHAR FIELD */

     6548    33960    5           END;                         /* If VLP_KEY.TYPE = HEADER */

     6549    33961    4       END;                           /* Sort loop */

  33961 19 024224   023055 710000 19                 TRA     SORT_LOOP
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:908  

     6550    33962        /* Now, go through the file a second time replacing the old
     6551    33963           message numbers with new ones.                           */
     6552    33964
     6553    33965    3       BOF.V.DCB# = M$MAIL_FILE_NUM;

  33965 19 024225   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 024226   005476 740000 11                 STX0    BOF+6

     6554    33966    3       CALL M$PRECORD (BOF);

  33966 19 024227   005470 630400 11                 EPPR0   BOF
        19 024230   040003 713400                    CLIMB   16387
        19 024231   401000 401760                    pmme    nvectors=3

     6555    33967
     6556    33968    4   RENUMBER_LOOP: DO WHILE ('1'B);

  33968 19 024232                       RENUMBER_LO* null
     6557    33969
     6558    33970    4           CALL M$READ (READ_OLD) WHENALTRETURN

  33970 19 024232   005322 630400 11                 EPPR0   READ_OLD
        19 024233   440000 713400                    CLIMB   alt,read
        19 024234   401400 401760                    pmme    nvectors=4
        19 024235   024237 702000 19                 TSX2    s:33972
        19 024236   024246 710000 19                 TRA     s:33978

     6559    33971    5           DO;

     6560    33972    5               IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$EOF THEN

  33972 19 024237   000000 470400 xsym               LDP0    B$TCB$
        19 024240   000000 471500                    LDP1    0,,PR0
        19 024241   100102 236100                    LDQ     66,,PR1
        19 024242   377770 376007                    ANQ     131064,DL
        19 024243   000060 116007                    CMPQ    48,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:909  
        19 024244   024461 600000 19                 TZE     s:34015

     6561    33973    5                   EXIT RENUMBER_LOOP;
     6562    33974    5               ELSE
     6563    33975    5                   GOTO E_PMME;

  33975 19 024245   024537 710000 19                 TRA     E_PMME

     6564    33976    5           END;
     6565    33977
     6566    33978    5           DO CASE (VLP_KEY.TYPE);

  33978 19 024246   005354 220000 11                 LDX0    VLP_KEY
        19 024247   000777 360003                    ANX0    511,DU
        19 024250   000133 100003                    CMPX0   91,DU
        19 024251   024253 602010 19                 TNC     s:33978+5,X0
        19 024252   024416 710000 19                 TRA     s:33993
        19 024253   024416 710000 19                 TRA     s:33993
        19 024254   024431 710000 19                 TRA     s:34000
        19 024255   024431 710000 19                 TRA     s:34000
        19 024256   024416 710000 19                 TRA     s:33993
        19 024257   024416 710000 19                 TRA     s:33993
        19 024260   024416 710000 19                 TRA     s:33993
        19 024261   024416 710000 19                 TRA     s:33993
        19 024262   024416 710000 19                 TRA     s:33993
        19 024263   024416 710000 19                 TRA     s:33993
        19 024264   024416 710000 19                 TRA     s:33993
        19 024265   024431 710000 19                 TRA     s:34000
        19 024266   024416 710000 19                 TRA     s:33993
        19 024267   024416 710000 19                 TRA     s:33993
        19 024270   024416 710000 19                 TRA     s:33993
        19 024271   024416 710000 19                 TRA     s:33993
        19 024272   024416 710000 19                 TRA     s:33993
        19 024273   024416 710000 19                 TRA     s:33993
        19 024274   024416 710000 19                 TRA     s:33993
        19 024275   024416 710000 19                 TRA     s:33993
        19 024276   024416 710000 19                 TRA     s:33993
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:910  
        19 024277   024416 710000 19                 TRA     s:33993
        19 024300   024416 710000 19                 TRA     s:33993
        19 024301   024416 710000 19                 TRA     s:33993
        19 024302   024416 710000 19                 TRA     s:33993
        19 024303   024416 710000 19                 TRA     s:33993
        19 024304   024416 710000 19                 TRA     s:33993
        19 024305   024416 710000 19                 TRA     s:33993
        19 024306   024416 710000 19                 TRA     s:33993
        19 024307   024416 710000 19                 TRA     s:33993
        19 024310   024416 710000 19                 TRA     s:33993
        19 024311   024416 710000 19                 TRA     s:33993
        19 024312   024416 710000 19                 TRA     s:33993
        19 024313   024416 710000 19                 TRA     s:33993
        19 024314   024416 710000 19                 TRA     s:33993
        19 024315   024416 710000 19                 TRA     s:33993
        19 024316   024416 710000 19                 TRA     s:33993
        19 024317   024416 710000 19                 TRA     s:33993
        19 024320   024416 710000 19                 TRA     s:33993
        19 024321   024416 710000 19                 TRA     s:33993
        19 024322   024416 710000 19                 TRA     s:33993
        19 024323   024416 710000 19                 TRA     s:33993
        19 024324   024416 710000 19                 TRA     s:33993
        19 024325   024416 710000 19                 TRA     s:33993
        19 024326   024416 710000 19                 TRA     s:33993
        19 024327   024416 710000 19                 TRA     s:33993
        19 024330   024416 710000 19                 TRA     s:33993
        19 024331   024416 710000 19                 TRA     s:33993
        19 024332   024416 710000 19                 TRA     s:33993
        19 024333   024416 710000 19                 TRA     s:33993
        19 024334   024416 710000 19                 TRA     s:33993
        19 024335   024416 710000 19                 TRA     s:33993
        19 024336   024416 710000 19                 TRA     s:33993
        19 024337   024416 710000 19                 TRA     s:33993
        19 024340   024416 710000 19                 TRA     s:33993
        19 024341   024416 710000 19                 TRA     s:33993
        19 024342   024416 710000 19                 TRA     s:33993
        19 024343   024416 710000 19                 TRA     s:33993
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:911  
        19 024344   024416 710000 19                 TRA     s:33993
        19 024345   024416 710000 19                 TRA     s:33993
        19 024346   024416 710000 19                 TRA     s:33993
        19 024347   024431 710000 19                 TRA     s:34000
        19 024350   024416 710000 19                 TRA     s:33993
        19 024351   024416 710000 19                 TRA     s:33993
        19 024352   024416 710000 19                 TRA     s:33993
        19 024353   024416 710000 19                 TRA     s:33993
        19 024354   024416 710000 19                 TRA     s:33993
        19 024355   024416 710000 19                 TRA     s:33993
        19 024356   024416 710000 19                 TRA     s:33993
        19 024357   024416 710000 19                 TRA     s:33993
        19 024360   024416 710000 19                 TRA     s:33993
        19 024361   024416 710000 19                 TRA     s:33993
        19 024362   024416 710000 19                 TRA     s:33993
        19 024363   024416 710000 19                 TRA     s:33993
        19 024364   024416 710000 19                 TRA     s:33993
        19 024365   024416 710000 19                 TRA     s:33993
        19 024366   024416 710000 19                 TRA     s:33993
        19 024367   024416 710000 19                 TRA     s:33993
        19 024370   024416 710000 19                 TRA     s:33993
        19 024371   024416 710000 19                 TRA     s:33993
        19 024372   024416 710000 19                 TRA     s:33993
        19 024373   024431 710000 19                 TRA     s:34000
        19 024374   024416 710000 19                 TRA     s:33993
        19 024375   024416 710000 19                 TRA     s:33993
        19 024376   024416 710000 19                 TRA     s:33993
        19 024377   024416 710000 19                 TRA     s:33993
        19 024400   024416 710000 19                 TRA     s:33993
        19 024401   024416 710000 19                 TRA     s:33993
        19 024402   024416 710000 19                 TRA     s:33993
        19 024403   024416 710000 19                 TRA     s:33993
        19 024404   024416 710000 19                 TRA     s:33993
        19 024405   024406 710000 19                 TRA     s:33987

     6567    33979
     6568    33980    5           CASE(%VM_TYPE_PRO,%VM_TYPE_LIST,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:912  

     6569    33981    5             %VM_TYPE_USER,%VM_TYPE_ACC,
     6570    33982    5             %VM_TYPE_SITE);
     6571    33983
     6572    33984
     6573    33985    5           CASE(%VM_TYPE_ID);

     6574    33986    6               DO;

     6575    33987    6                   CALL GET_NEW_MSGNUM(VM_ID.MESSAGE_NUMBER);

  33987 19 024406   000000 236000 xsym               LDQ     VM_HEADER$
        19 024407   201541 756100                    STQ     FLDPTR$+3,,AUTO
        19 024410   024607 701000 19                 TSX1    GET_NEW_MSGNUM
        19 024411   000000 011000                    NOP     0

     6576    33988    6                   VM_ID.MESSAGE_NUMBER = NEW_NUM;

  33988 19 024412   000000 470400 xsym               LDP0    VM_HEADER$
        19 024413   005504 235000 11                 LDA     NEW_NUM
        19 024414   000000 755100                    STA     0,,PR0

     6577    33989    6               END;

  33989 19 024415   024431 710000 19                 TRA     s:34000

     6578    33990
     6579    33991    5           CASE (ELSE);

     6580    33992    6               DO;

     6581    33993    6                   HINDX = VLP_KEY.NUM;

  33993 19 024416   005354 235000 11                 LDA     VLP_KEY
        19 024417   005355 236000 11                 LDQ     VLP_KEY+1
        19 024420   000022 773000                    LRL     18
        19 024421   201525 756100                    STQ     HINDX,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:913  

     6582    33994    6                   CALL GET_NEW_MSGNUM(HINDX);

  33994 19 024422   201525 630500                    EPPR0   HINDX,,AUTO
        19 024423   201541 450500                    STP0    FLDPTR$+3,,AUTO
        19 024424   024607 701000 19                 TSX1    GET_NEW_MSGNUM
        19 024425   000000 011000                    NOP     0

     6583    33995    6                   VLP_KEY.NUM = NEW_NUM;

  33995 19 024426   000000 100400                    MLR     fill='000'O
        19 024427   005504 000004 11                 ADSC9   NEW_NUM                  cn=0,n=4
        19 024430   005354 400004 11                 ADSC9   VLP_KEY                  cn=2,n=4

     6584    33996    6               END;

     6585    33997
     6586    33998    5           END;

     6587    33999
     6588    34000    4           WRITE_NEW.BUF_ = VM_HEADER_;

  34000 19 024431   000000 237000 xsym               LDAQ    VM_HEADER_
        19 024432   005344 757000 11                 STAQ    WRITE_NEW+4

     6589    34001
     6590    34002    4           IF MAIL_FILE$->F$DCB.ARS# = 0 THEN

  34002 19 024433   201527 470500                    LDP0    MAIL_FILE$,,AUTO
        19 024434   000000 235100                    LDA     0,,PR0
        19 024435   024441 601000 19                 TNZ     s:34005

     6591    34003    4               WRITE_NEW.BUF_ = VECTOR(NIL);

  34003 19 024436   000230 237000 20                 LDAQ    152
        19 024437   005344 757000 11                 STAQ    WRITE_NEW+4
        19 024440   024447 710000 19                 TRA     s:34007
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:914  

     6592    34004    4           ELSE
     6593    34005    4               WRITE_NEW.BUF_.BOUND = MAIL_FILE$->F$DCB.ARS# - 1;

  34005 19 024441   000000 236100                    LDQ     0,,PR0
        19 024442   000001 136007                    SBLQ    1,DL
        19 024443   000020 736000                    QLS     16
        19 024444   005344 676000 11                 ERQ     WRITE_NEW+4
        19 024445   000017 376000 20                 ANQ     15
        19 024446   005344 656000 11                 ERSQ    WRITE_NEW+4

     6594    34006
     6595    34007    4           WRITE_NEW.V.DVBYTE = MAIL_FILE$->F$DCB.DVBYTE;

  34007 19 024447   000003 236100                    LDQ     3,,PR0
        19 024450   776000 376003                    ANQ     -1024,DU
        19 024451   005353 552040 11                 STBQ    WRITE_NEW+11,'40'O

     6596    34008    4           WRITE_NEW.KEY_ = VECTOR(VLP_KEY);

  34008 19 024452   000672 237000 20                 LDAQ    442
        19 024453   005342 757000 11                 STAQ    WRITE_NEW+2

     6597    34009
     6598    34010    4           CALL M$WRITE (WRITE_NEW) ALTRET(E_PMME);

  34010 19 024454   005340 630400 11                 EPPR0   WRITE_NEW
        19 024455   440001 713400                    CLIMB   alt,write
        19 024456   401400 401760                    pmme    nvectors=4
        19 024457   024537 702000 19                 TSX2    E_PMME

     6599    34011
     6600    34012    4       END; /* Renumber loop */

  34012 19 024460   024232 710000 19                 TRA     RENUMBER_LOOP

     6601    34013
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:915  
     6602    34014
     6603    34015    3       NEXT_NUM = LAST + 1;

  34015 19 024461   005507 235000 11                 LDA     LAST
        19 024462   000001 035007                    ADLA    1,DL
        19 024463   005225 755000 11                 STA     NEXT_NUM

     6604    34016    3       VM_PROFILE.RECS_DELETED=0;

  34016 19 024464   000000 471400 xsym               LDP1    VM_PROFILE$
        19 024465   100135 450100                    STZ     93,,PR1

     6605    34017    3       VM_PROFILE.HI_MESSAGE_NUMBER = LAST + 1;

  34017 19 024466   100011 755100                    STA     9,,PR1

     6606    34018    3       VM_PROFILE.NUM_MESSAGES = LAST + 1;

  34018 19 024467   100005 755100                    STA     5,,PR1

     6607    34019    3       CALL VMD$PUT_PROFILE(M$WORK_NUM) ALTRET(E_PMME);

  34019 19 024470   000133 630400 20                 EPPR0   91
        19 024471   000024 631400 20                 EPPR1   20
        19 024472   000000 701000 xent               TSX1    VMD$PUT_PROFILE
        19 024473   024537 702000 19                 TSX2    E_PMME

     6608    34020    3       CLOSE_SAVE.V.DCB#=M$MAIL_FILE_NUM;

  34020 19 024474   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        19 024475   002142 740000 11                 STX0    CLOSE_SAVE+26

     6609    34021    3       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  34021 19 024476   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 024477   450001 713400                    CLIMB   alt,close
        19 024500   406000 401760                    pmme    nvectors=13
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:916  
        19 024501   024537 702000 19                 TSX2    E_PMME

     6610    34022    3       CLOSE_SAVE.V.DCB#=M$WORK_NUM;

  34022 19 024502   000000 720000 xsym               LXL0    M$WORK_NUM
        19 024503   002142 740000 11                 STX0    CLOSE_SAVE+26

     6611    34023    3       CLOSE_SAVE.V.OPER.RELG# = '1'B;

  34023 19 024504   200000 236007                    LDQ     65536,DL
        19 024505   002142 256000 11                 ORSQ    CLOSE_SAVE+26

     6612    34024    3       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  34024 19 024506   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 024507   450001 713400                    CLIMB   alt,close
        19 024510   406000 401760                    pmme    nvectors=13
        19 024511   024537 702000 19                 TSX2    E_PMME

     6613    34025    3       CLOSE_SAVE.V.OPER.RELG# = '0'B;

  34025 19 024512   000667 236000 20                 LDQ     439
        19 024513   002142 356000 11                 ANSQ    CLOSE_SAVE+26

     6614    34026    3   CLEANUP:
     6615    34027    3       CALL VMB$USE_SAME (,,VM_CURRENT_FOLDER,M$MAIL_FILE_NUM);

  34027 19 024514   000052 237000 20    CLEANUP      LDAQ    42
        19 024515   201710 757100                    STAQ    I+102,,AUTO
        19 024516   000022 236000 20                 LDQ     18
        19 024517   000022 235000 20                 LDA     18
        19 024520   201706 757100                    STAQ    I+100,,AUTO
        19 024521   201706 630500                    EPPR0   I+100,,AUTO
        19 024522   000026 631400 20                 EPPR1   22
        19 024523   000000 701000 xent               TSX1    VMB$USE_SAME
        19 024524   000000 011000                    NOP     0

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:917  
     6616    34028    3       CALL VMA$SHRINK_SEGMENT (VM_WORK_,);

  34028 19 024525   000010 630400 20                 EPPR0   8
        19 024526   000024 631400 20                 EPPR1   20
        19 024527   000000 701000 xent               TSX1    VMA$SHRINK_SEGMENT
        19 024530   000000 011000                    NOP     0

     6617    34029    3       CALL VMA$ENLARGE_SEGMENT (VM_WORK_, 1024);

  34029 19 024531   000010 630400 20                 EPPR0   8
        19 024532   000000 631400 20                 EPPR1   0
        19 024533   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        19 024534   000000 011000                    NOP     0

     6618    34030    3       RETURN;

  34030 19 024535   201522 221300                    LDX1  ! INDX2+254,,AUTO
        19 024536   000001 702211                    TSX2  ! 1,X1

     6619    34031    3   E_PMME:
     6620    34032    3       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  34032 19 024537   000000 470400 xsym  E_PMME       LDP0    B$TCB$
        19 024540   000000 471500                    LDP1    0,,PR0
        19 024541   100102 236100                    LDQ     66,,PR1
        19 024542   002204 756000 11                 STQ     ERROR

     6621    34033    3       DCB# = B$TCB.ALT$->B$ALT.DCB#;

  34033 19 024543   000000 471500                    LDP1    0,,PR0
        19 024544   100101 235100                    LDA     65,,PR1
        19 024545   000401 755000 11                 STA     DCB#

     6622    34034    3       CALL XUR$ERRMSG (E_RENFAILED);

  34034 19 024546   000670 630400 20                 EPPR0   440
        19 024547   000024 631400 20                 EPPR1   20
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:918  
        19 024550   000000 701000 xent               TSX1    XUR$ERRMSG
        19 024551   000000 011000                    NOP     0

     6623    34035    3       CALL XUR$ERRMSG (ERROR,DCB#);

  34035 19 024552   000101 630400 20                 EPPR0   65
        19 024553   000000 631400 20                 EPPR1   0
        19 024554   000000 701000 xent               TSX1    XUR$ERRMSG
        19 024555   000000 011000                    NOP     0

     6624    34036    3       CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;

  34036 19 024556   000000 720000 xsym               LXL0    M$WORK_NUM
        19 024557   002200 740000 11                 STX0    CLOSE_SCRATCH+26

     6625    34037    4       CALL M$CLOSE (CLOSE_SCRATCH) WHENALTRETURN DO;

  34037 19 024560   002146 630400 11                 EPPR0   CLOSE_SCRATCH
        19 024561   450001 713400                    CLIMB   alt,close
        19 024562   406000 401760                    pmme    nvectors=13
        19 024563   024565 702000 19                 TSX2    s:34039
        19 024564   024565 710000 19                 TRA     s:34039

     6626    34038    4       END;

     6627    34039    3       NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;

  34039 19 024565   000000 470400 xsym               LDP0    VM_PROFILE$
        19 024566   000011 235100                    LDA     9,,PR0
        19 024567   005225 755000 11                 STA     NEXT_NUM

     6628    34040    3       GOTO CLEANUP;

  34040 19 024570   024514 710000 19                 TRA     CLEANUP

     6629    34041    3   E_PMME2:
     6630    34042    3       IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$FILEBUSY
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:919  

  34042 19 024571   000000 470400 xsym  E_PMME2      LDP0    B$TCB$
        19 024572   000000 471500                    LDP1    0,,PR0
        19 024573   100102 236100                    LDQ     66,,PR1
        19 024574   377770 376007                    ANQ     131064,DL
        19 024575   001550 116007                    CMPQ    872,DL
        19 024576   024537 601000 19                 TNZ     E_PMME

     6631    34043    4       THEN DO;

     6632    34044    4           CALL XUR$ERRMSG(E_CANTCOMPACT);

  34044 19 024577   000671 630400 20                 EPPR0   441
        19 024600   000024 631400 20                 EPPR1   20
        19 024601   000000 701000 xent               TSX1    XUR$ERRMSG
        19 024602   000000 011000                    NOP     0

     6633    34045    4           NEXT_NUM = VM_PROFILE.HI_MESSAGE_NUMBER;

  34045 19 024603   000000 470400 xsym               LDP0    VM_PROFILE$
        19 024604   000011 235100                    LDA     9,,PR0
        19 024605   005225 755000 11                 STA     NEXT_NUM

     6634    34046    4           GOTO CLEANUP;

  34046 19 024606   024514 710000 19                 TRA     CLEANUP

     6635    34047    4       END;
     6636    34048    3       ELSE GOTO E_PMME;
     6637    34049        /* END SORT_FOLDER; */
     6638    34050        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:920  
     6639    34051    3   GET_NEW_MSGNUM: PROC (OLD_MSGNUM);

  34051 19 024607   201540 741300       GET_NEW_MSG* STX1  ! FLDPTR$+2,,AUTO

     6640    34052
     6641    34053    4   DCL OLD_MSGNUM UBIN WORD ALIGNED;
     6642    34054    4   DCL I UBIN WORD;
     6643    34055
     6644    34056    5   ARRAY_LOOP: DO I = 0 TO LAST;

  34056 19 024610   201542 450100       ARRAY_LOOP   STZ     I,,AUTO
        19 024611   024630 710000 19                 TRA     s:34062+3

     6645    34057    5           IF OLD_MSGNUM = HOLE.MSG_NUM(I) THEN

  34057 19 024612   201541 470500                    LDP0    @OLD_MSGNUM,,AUTO
        19 024613   201542 235100                    LDA     I,,AUTO
        19 024614   000001 735000                    ALS     1
        19 024615   005502 471400 11                 LDP1    HOLE$
        19 024616   000000 236100                    LDQ     0,,PR0
        19 024617   100000 116105                    CMPQ    0,AL,PR1
        19 024620   024625 601000 19                 TNZ     s:34062

     6646    34058    6           DO;

     6647    34059    6               NEW_NUM = I + 1;

  34059 19 024621   201542 235100                    LDA     I,,AUTO
        19 024622   000001 035007                    ADLA    1,DL
        19 024623   005504 755000 11                 STA     NEW_NUM

     6648    34060    6               EXIT ARRAY_LOOP;

  34060 19 024624   024634 710000 19                 TRA     s:34064

     6649    34061    6           END;
     6650    34062    5       END;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:921  

  34062 19 024625   201542 235100                    LDA     I,,AUTO
        19 024626   000001 035007                    ADLA    1,DL
        19 024627   201542 755100                    STA     I,,AUTO
        19 024630   201542 236100                    LDQ     I,,AUTO
        19 024631   024634 604000 19                 TMI     s:34064
        19 024632   005507 116000 11                 CMPQ    LAST
        19 024633   024612 604400 19                 TMOZ    s:34057

     6651    34063
     6652    34064    4       RETURN;

  34064 19 024634   201540 221300                    LDX1  ! FLDPTR$+2,,AUTO
        19 024635   000001 702211                    TSX2  ! 1,X1

     6653    34065
     6654    34066    4   END GET_NEW_MSGNUM;
     6655    34067    3   END SORT_FOLDER;
     6656    34068    2   END UPDATE$MAIL;
     6657    34069        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:922  
     6658    34070    1   TRANSFORM_DOMAIN: PROC (DOMAIN$, SITENAME, NAME) ALTRET;

  34070 19 024636   201116 741300       TRANSFORM_D* STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     6659    34071
     6660    34072    2   DCL DOMAIN$ PTR;
     6661    34073    2   DCL SITENAME CHAR (8);
     6662    34074        %VLP_NAME (FPTN=NAME, STCLASS=PARAM);
     6663    34101
     6664    34102    2   DCL SITE$ PTR;
     6665    34103    2   DCL INDX1 UBIN;
     6666    34104    2   DCL INDX2 UBIN;
     6667    34105
     6668    34106        /*
     6669    34107              ***** If a domain was specified, check to make sure that the outermost
     6670    34108                    subdomain can be mapped into a node name;  reject otherwise.  Then
     6671    34109                    map the domain-name structure into the corresponding CP-6
     6672    34110                    equivalent (e.g. "name@sd1.sd2.sd3" -> "name%sd1.sd2@sd3").
     6673    34111        */
     6674    34112    2       IF DOMAIN$ ~= ADDR(NIL)

  34112 19 024637   201117 470500                    LDP0    @DOMAIN$,,AUTO
        19 024640   000000 236100                    LDQ     0,,PR0
        19 024641   000022 116000 20                 CMPQ    18
        19 024642   025036 600000 19                 TZE     s:34133

     6675    34113    3       THEN DO;

     6676    34114    3           SITE$ = DOMAIN$ -> P$B.SUBLK$(DOMAIN$ -> P$B.NSUBLKS - 1);

  34114 19 024643   000000 471500                    LDP1    0,,PR0
        19 024644   100001 220100                    LDX0    1,,PR1
        19 024645   100002 236110                    LDQ     2,X0,PR1
        19 024646   201122 756100                    STQ     SITE$,,AUTO

     6677    34115    3           IF SITE$ -> P$S.COUNT > LENGTHC(SITENAME)

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:923  
  34115 19 024647   201122 473500                    LDP3    SITE$,,AUTO
        19 024650   300004 236100                    LDQ     4,,PR3
        19 024651   777000 376003                    ANQ     -512,DU
        19 024652   011000 116003                    CMPQ    4608,DU
        19 024653   024704 602000 19                 TNC     s:34121

     6678    34116    4           THEN DO;

     6679    34117    4               CALL XUR$ERRMSG (E_BADDOMAIN,,,

  34117 19 024654   300003 474500                    LDP4    3,,PR3
        19 024655   000100 101500                    MRL     fill='000'O
        19 024656   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        19 024657   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 024660   201706 220100                    LDX0    I+100,,AUTO
        19 024661   000001 622010                    EAX2    1,X0
        19 024662   000000 635012                    EAA     0,X2
        19 024663   000002 771000                    ARL     2
        19 024664   000140 135007                    SBLA    96,DL
        19 024665   201707 454500                    STP4    I+101,,AUTO
        19 024666   201707 236100                    LDQ     I+101,,AUTO
        19 024667   201710 757100                    STAQ    I+102,,AUTO
        19 024670   201710 631500                    EPPR1   I+102,,AUTO
        19 024671   201715 451500                    STP1    I+107,,AUTO
        19 024672   000022 236000 20                 LDQ     18
        19 024673   201714 756100                    STQ     I+106,,AUTO
        19 024674   000674 235000 20                 LDA     444
        19 024675   201712 757100                    STAQ    I+104,,AUTO
        19 024676   201712 630500                    EPPR0   I+104,,AUTO
        19 024677   000026 631400 20                 EPPR1   22
        19 024700   000000 701000 xent               TSX1    XUR$ERRMSG
        19 024701   000000 011000                    NOP     0

     6680    34118    4                 VECTOR(SITE$->P$S.TEXTC$->X$STRING));
     6681    34119    4               ALTRETURN;

  34119 19 024702   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:924  
        19 024703   000000 702211                    TSX2  ! 0,X1

     6682    34120    4           END;
     6683    34121    3           SITENAME = SITE$->P$S.TEXT;

  34121 19 024704   300004 236100                    LDQ     4,,PR3
        19 024705   000033 772000                    QRL     27
        19 024706   000000 622006                    EAX2    0,QL
        19 024707   201120 474500                    LDP4    @SITENAME,,AUTO
        19 024710   040100 100540                    MLR     fill='040'O
        19 024711   300004 200012                    ADSC9   4,,PR3                   cn=1,n=*X2
        19 024712   400000 000010                    ADSC9   0,,PR4                   cn=0,n=8

     6684    34122    4           DO INDX2 = 0 TO DOMAIN$ -> P$B.NSUBLKS - 2;

  34122 19 024713   201124 450100                    STZ     INDX2,,AUTO
        19 024714   025026 710000 19                 TRA     s:34130+3

     6685    34123    4               INDX1 = NAME.L#;

  34123 19 024715   201121 470500                    LDP0    @NAME,,AUTO
        19 024716   000100 101500                    MRL     fill='000'O
        19 024717   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        19 024720   201123 000004                    ADSC9   INDX1,,AUTO              cn=0,n=4

     6686    34124    4               NAME.L# = NAME.L# + DOMAIN$ -> P$B.SUBLK$(INDX2) -> P$S.COUNT + 1;

  34124 19 024721   201117 471500                    LDP1    @DOMAIN$,,AUTO
        19 024722   100000 473500                    LDP3    0,,PR1
        19 024723   201124 720100                    LXL0    INDX2,,AUTO
        19 024724   300003 474510                    LDP4    3,X0,PR3
        19 024725   400004 236100                    LDQ     4,,PR4
        19 024726   000033 772000                    QRL     27
        19 024727   201706 756100                    STQ     I+100,,AUTO
        19 024730   000100 101500                    MRL     fill='000'O
        19 024731   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        19 024732   201707 000004                    ADSC9   I+101,,AUTO              cn=0,n=4
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:925  
        19 024733   201707 236100                    LDQ     I+101,,AUTO
        19 024734   201706 036100                    ADLQ    I+100,,AUTO
        19 024735   000001 036007                    ADLQ    1,DL
        19 024736   201710 756100                    STQ     I+102,,AUTO
        19 024737   000100 101500                    MRL     fill='000'O
        19 024740   201710 000004                    ADSC9   I+102,,AUTO              cn=0,n=4
        19 024741   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     6687    34125    4               IF INDX2 = 0

  34125 19 024742   201124 235100                    LDA     INDX2,,AUTO
        19 024743   024774 601000 19                 TNZ     s:34129

     6688    34126    4               THEN
     6689    34127    4                   CALL INSERT (NAME.NAME#, INDX1, , '%', DOMAIN$ -> P$B.SUBLK$(INDX2)
             34127                            -> P$S.TEXT);

  34127 19 024744   000100 101500                    MRL     fill='000'O
        19 024745   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        19 024746   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 024747   201706 221100                    LDX1    I+100,,AUTO
        19 024750   100000 473500                    LDP3    0,,PR1
        19 024751   300003 474510                    LDP4    3,X0,PR3
        19 024752   400004 236100                    LDQ     4,,PR4
        19 024753   000033 772000                    QRL     27
        19 024754   000000 622006                    EAX2    0,QL
        19 024755   000000 636011                    EAQ     0,X1
        19 024756   000022 772000                    QRL     18
        19 024757   201123 136100                    SBLQ    INDX1,,AUTO
        19 024760   000000 623006                    EAX3    0,QL
        19 024761   201123 235100                    LDA     INDX1,,AUTO
        19 024762   040145 100400                    MLR     fill='040'O
        19 024763   000675 000001 20                 ADSC9   445                      cn=0,n=1
        19 024764   000000 200013                    ADSC9   0,A,PR0                  cn=1,n=*X3
        19 024765   000001 116007                    CMPQ    1,DL
        19 024766   024773 604400 19                 TMOZ    s:34127+23
        19 024767   777777 623006                    EAX3    -1,QL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:926  
        19 024770   040145 100540                    MLR     fill='040'O
        19 024771   400004 200012                    ADSC9   4,,PR4                   cn=1,n=*X2
        19 024772   000000 400013                    ADSC9   0,A,PR0                  cn=2,n=*X3
        19 024773   025023 710000 19                 TRA     s:34130

     6690    34128    4               ELSE
     6691    34129    4                   CALL INSERT (NAME.NAME#, INDX1, , '.', DOMAIN$ -> P$B.SUBLK$(INDX2)
             34129                            -> P$S.TEXT);

  34129 19 024774   000100 101500                    MRL     fill='000'O
        19 024775   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        19 024776   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 024777   201706 221100                    LDX1    I+100,,AUTO
        19 025000   100000 473500                    LDP3    0,,PR1
        19 025001   300003 474510                    LDP4    3,X0,PR3
        19 025002   400004 236100                    LDQ     4,,PR4
        19 025003   000033 772000                    QRL     27
        19 025004   000000 622006                    EAX2    0,QL
        19 025005   000000 636011                    EAQ     0,X1
        19 025006   000022 772000                    QRL     18
        19 025007   201123 136100                    SBLQ    INDX1,,AUTO
        19 025010   000000 623006                    EAX3    0,QL
        19 025011   201123 235100                    LDA     INDX1,,AUTO
        19 025012   040145 100400                    MLR     fill='040'O
        19 025013   000676 000001 20                 ADSC9   446                      cn=0,n=1
        19 025014   000000 200013                    ADSC9   0,A,PR0                  cn=1,n=*X3
        19 025015   000001 116007                    CMPQ    1,DL
        19 025016   025023 604400 19                 TMOZ    s:34130
        19 025017   777777 623006                    EAX3    -1,QL
        19 025020   040145 100540                    MLR     fill='040'O
        19 025021   400004 200012                    ADSC9   4,,PR4                   cn=1,n=*X2
        19 025022   000000 400013                    ADSC9   0,A,PR0                  cn=2,n=*X3

     6692    34130    4           END;

  34130 19 025023   201124 236100                    LDQ     INDX2,,AUTO
        19 025024   000001 036007                    ADLQ    1,DL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:927  
        19 025025   201124 756100                    STQ     INDX2,,AUTO
        19 025026   201117 470500                    LDP0    @DOMAIN$,,AUTO
        19 025027   000000 471500                    LDP1    0,,PR0
        19 025030   100001 236100                    LDQ     1,,PR1
        19 025031   000022 772000                    QRL     18
        19 025032   000002 136007                    SBLQ    2,DL
        19 025033   025036 604000 19                 TMI     s:34133
        19 025034   201124 116100                    CMPQ    INDX2,,AUTO
        19 025035   024715 603000 19                 TRC     s:34123

     6693    34131    3       END;

     6694    34132
     6695    34133    2       RETURN;

  34133 19 025036   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 025037   000001 702211                    TSX2  ! 1,X1

     6696    34134
     6697    34135    2   END TRANSFORM_DOMAIN;
     6698    34136        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:928  
     6699    34137        /********************************************************************/
     6700    34138        /*I*
     6701    34139             NAME: DO$ACK
     6702    34140             PURPOSE:
     6703    34141                   To acknowledge the current message.
     6704    34142        *********************************************************************/
     6705    34143    1   DO$ACK: PROC (EXPLICIT) ALTRET;

  34143 19 025040   201116 741300       DO$ACK       STX1  ! @CURR_COMMAND_CODE+1,,AUTO

     6706    34144
     6707    34145    2   DCL EXPLICIT BIT(1);
     6708    34146        /*
     6709    34147          ***** Build the command buffer to pass to send ...
     6710    34148        */
     6711    34149              %INIT_STR (CODE=E_SEND_ACKNOWLEDGE, STR=VM_SEND_ACKNOWLEDGE, TEST=YES);

  34156 19 025041   040000 106400                    CMPC    fill='040'O
        19 025042   004727 200120 11                 ADSC9   VM_SEND_ACKNOWLEDGE      cn=1,n=80
        19 025043   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 025044   025051 601000 19                 TNZ     s:34172

  34158 19 025045   000677 630400 20                 EPPR0   447
        19 025046   000000 631400 20                 EPPR1   0
        19 025047   000000 701000 xent               TSX1    VMD$ERRMSG
        19 025050   000000 011000                    NOP     0

     6712    34172    2       CALL BUILD_LINK_TO_SEND_CMD (VM_SEND_ACKNOWLEDGE);

  34172 19 025051   000700 236000 20                 LDQ     448
        19 025052   201121 756100                    STQ     @NAME,,AUTO
        19 025053   025126 701000 19                 TSX1    BUILD_LINK_TO_SEND_CMD
        19 025054   000000 011000                    NOP     0

     6713    34173    2       CALL M$OPEN (OPEN_SEND_FILE) ALTRET(E_PMME);

  34173 19 025055   000510 630400 12                 EPPR0   OPEN_SEND_FILE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:929  
        19 025056   450000 713400                    CLIMB   alt,open
        19 025057   410400 401760                    pmme    nvectors=18
        19 025060   025124 702000 19                 TSX2    E_PMME

     6714    34174    2       CALL VME$ACKNOWLEDGE (CURRENT_MESSAGE_NUMBER,USER_NAME,EXPLICIT)

  34174 19 025061   201117 236100                    LDQ     @EXPLICIT,,AUTO
        19 025062   201710 756100                    STQ     I+102,,AUTO
        19 025063   000116 237000 20                 LDAQ    78
        19 025064   201706 757100                    STAQ    I+100,,AUTO
        19 025065   201706 630500                    EPPR0   I+100,,AUTO
        19 025066   000021 631400 20                 EPPR1   17
        19 025067   000000 701000 xent               TSX1    VME$ACKNOWLEDGE
        19 025070   025114 702000 19                 TSX2    E_ACK

     6715    34175    2         ALTRET(E_ACK);
     6716    34176    2       CLOSE_SAVE.V.DCB# = M$WORK_NUM;

  34176 19 025071   000000 720000 xsym               LXL0    M$WORK_NUM
        19 025072   002142 740000 11                 STX0    CLOSE_SAVE+26

     6717    34177    2       CALL M$CLOSE (CLOSE_SAVE) ALTRET(E_PMME);

  34177 19 025073   002110 630400 11                 EPPR0   CLOSE_SAVE
        19 025074   450001 713400                    CLIMB   alt,close
        19 025075   406000 401760                    pmme    nvectors=13
        19 025076   025124 702000 19                 TSX2    E_PMME

     6718    34178    2       CALL LINK_RUNIT

  34178 19 025077   017111 701000 19                 TSX1    LINK_RUNIT
        19 025100   025106 702000 19                 TSX2    s:34186

     6719    34179    2       WHENRETURN
     6720    34180    3       DO;

     6721    34181    3           CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:930  

  34181 19 025101   000120 630400 20                 EPPR0   80
        19 025102   000000 631400 20                 EPPR1   0
        19 025103   000000 701000 xent               TSX1    VMD$GET_HEADER
        19 025104   025124 702000 19                 TSX2    E_PMME

     6722    34182    3             M$MAIL_FILE_NUM) ALTRET(E_PMME);
     6723    34183    3       END;

  34183 19 025105   025113 710000 19                 TRA     s:34190

     6724    34184    2       WHENALTRETURN
     6725    34185    3       DO;

     6726    34186    3           CALL VMD$GET_HEADER (CURRENT_MESSAGE_NUMBER,

  34186 19 025106   000120 630400 20                 EPPR0   80
        19 025107   000000 631400 20                 EPPR1   0
        19 025110   000000 701000 xent               TSX1    VMD$GET_HEADER
        19 025111   025124 702000 19                 TSX2    E_PMME

     6727    34187    3             M$MAIL_FILE_NUM) ALTRET(E_PMME);
     6728    34188    3           GOTO E_PMME;

  34188 19 025112   025124 710000 19                 TRA     E_PMME

     6729    34189    3       END;
     6730    34190    3       DO NEVER;

  34190 19 025113   025122 710000 19                 TRA     s:34195

     6731    34191    3   E_ACK:                                  /* Cleanup */
     6732    34192    3           CLOSE_SCRATCH.V.DCB# = M$WORK_NUM;

  34192 19 025114   000000 720000 xsym  E_ACK        LXL0    M$WORK_NUM
        19 025115   002200 740000 11                 STX0    CLOSE_SCRATCH+26

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:931  
     6733    34193    3           CALL M$CLOSE (CLOSE_SCRATCH) ALTRET(E_PMME);

  34193 19 025116   002146 630400 11                 EPPR0   CLOSE_SCRATCH
        19 025117   450001 713400                    CLIMB   alt,close
        19 025120   406000 401760                    pmme    nvectors=13
        19 025121   025124 702000 19                 TSX2    E_PMME

     6734    34194    3       END;                            /* Do never ... end */

     6735    34195    2       RETURN;

  34195 19 025122   201116 221300                    LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 025123   000001 702211                    TSX2  ! 1,X1

     6736    34196        /**/
     6737    34197    2   E_PMME:
     6738    34198    2       ALTRETURN;

  34198 19 025124   201116 221300       E_PMME       LDX1  ! @CURR_COMMAND_CODE+1,,AUTO
        19 025125   000000 702211                    TSX2  ! 0,X1

     6739    34199    2   END DO$ACK;
     6740    34200        %EJECT;
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:932  
     6741    34201        /*****************************************************************/
     6742    34202        /*                                                               */
     6743    34203        /*I*       NAME:       BUILD_LINK_TO_SEND_CMD                    *
     6744    34204         *                                                               *
     6745    34205         *         PURPOSE:    To build a legal LINK TO SEND command.    *
     6746    34206         *                                                               *
     6747    34207         *****************************************************************/
     6748    34208
     6749    34209    1   BUILD_LINK_TO_SEND_CMD: PROC(NAME);

  34209 19 025126   201120 741300       BUILD_LINK_* STX1  ! @SITENAME,,AUTO

     6750    34210
     6751    34211        %VLP_NAME (FPTN=NAME, STCLASS=PARAM);
     6752    34238    2   dcl  LEN   sbin;
     6753    34239    2   dcl  CFLEN sbin;
     6754    34240
     6755    34241        /*
     6756    34242          *****    NAME is the text of the command to pass to send
     6757    34243          *****    1.    Insert command and start option (MAIL=
     6758    34244        */
     6759    34245    2       LINK_CCBUF = NAME;

  34245 19 025127   201121 470500                    LDP0    @NAME,,AUTO
        19 025130   000100 101500                    MRL     fill='000'O
        19 025131   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        19 025132   201706 000002                    ADSC9   I+100,,AUTO              cn=0,n=2
        19 025133   201706 220100                    LDX0    I+100,,AUTO
        19 025134   000001 622010                    EAX2    1,X0
        19 025135   000000 100540                    MLR     fill='000'O
        19 025136   000000 000012                    ADSC9   0,,PR0                   cn=0,n=*X2
        19 025137   000073 000401 11                 ADSC9   LINK_CCBUF               cn=0,n=257

     6760    34246            %INIT_STR (CODE=E_SEND_MAIL, STR=VM_SEND_MAIL, TEST=YES);

  34253 19 025140   040000 106400                    CMPC    fill='040'O
        19 025141   005026 200120 11                 ADSC9   VM_SEND_MAIL             cn=1,n=80
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:933  
        19 025142   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 025143   025150 601000 19                 TNZ     s:34269

  34255 19 025144   000701 630400 20                 EPPR0   449
        19 025145   000000 631400 20                 EPPR1   0
        19 025146   000000 701000 xent               TSX1    VMD$ERRMSG
        19 025147   000000 011000                    NOP     0

     6761    34269    2       CALL INSERT (LINK_CCBUF.NAME#, LINK_CCBUF.L#,, VM_SEND_MAIL.NAME#);

  34269 19 025150   000073 236000 11                 LDQ     LINK_CCBUF
        19 025151   000033 772000                    QRL     27
        19 025152   777377 620006                    EAX0    -257,QL
        19 025153   777777 660003                    ERX0    -1,DU
        19 025154   040046 100400                    MLR     fill='040'O
        19 025155   005026 200120 11                 ADSC9   VM_SEND_MAIL             cn=1,n=80
        19 025156   000073 200010 11                 ADSC9   LINK_CCBUF,Q             cn=1,n=*X0

     6762    34270    2       LEN = NAME.L# + VM_SEND_MAIL.L#;

  34270 19 025157   005026 236000 11                 LDQ     VM_SEND_MAIL
        19 025160   000033 772000                    QRL     27
        19 025161   201706 756100                    STQ     I+100,,AUTO
        19 025162   201121 470500                    LDP0    @NAME,,AUTO
        19 025163   000100 101500                    MRL     fill='000'O
        19 025164   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        19 025165   201707 000004                    ADSC9   I+101,,AUTO              cn=0,n=4
        19 025166   201707 236100                    LDQ     I+101,,AUTO
        19 025167   201706 036100                    ADLQ    I+100,,AUTO
        19 025170   201122 756100                    STQ     LEN,,AUTO

     6763    34271
     6764    34272        /*
     6765    34273          *****    2.    Pass SEND the name of the current folder
     6766    34274        */
     6767    34275    2       WORK_STRING.L# = lengthc(WORK_STRING.NAME#);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:934  
  34275 19 025171   777000 236003                    LDQ     -512,DU
        19 025172   000174 552040 11                 STBQ    WORK_STRING,'40'O

     6768    34276    2       call VMF$MAKE_ADDRESS1PASS (WORK_STRING,VM_CURRENT_FOLDER);

  34276 19 025173   000051 630400 20                 EPPR0   41
        19 025174   000000 631400 20                 EPPR1   0
        19 025175   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS1PASS
        19 025176   000000 011000                    NOP     0

     6769    34277    2       SIZE = WORK_STRING.L#;

  34277 19 025177   000174 236000 11                 LDQ     WORK_STRING
        19 025200   000033 772000                    QRL     27
        19 025201   000535 756000 11                 STQ     SIZE

     6770    34278    2       substr(LINK_CCBUF.NAME#,LEN,SIZE) = substr(WORK_STRING.NAME#,,SIZE);

  34278 19 025202   000000 620006                    EAX0    0,QL
        19 025203   000535 721000 11                 LXL1    SIZE
        19 025204   201122 235100                    LDA     LEN,,AUTO
        19 025205   040045 100440                    MLR     fill='040'O
        19 025206   000174 200010 11                 ADSC9   WORK_STRING              cn=1,n=*X0
        19 025207   000073 200011 11                 ADSC9   LINK_CCBUF,A             cn=1,n=*X1

     6771    34279    2       substr(LINK_CCBUF.NAME#,LEN+SIZE,1) = ')';

  34279 19 025210   201122 236100                    LDQ     LEN,,AUTO
        19 025211   000535 036000 11                 ADLQ    SIZE
        19 025212   040006 100400                    MLR     fill='040'O
        19 025213   000703 000001 20                 ADSC9   451                      cn=0,n=1
        19 025214   000073 200001 11                 ADSC9   LINK_CCBUF,Q             cn=1,n=1

     6772    34280
     6773    34281    2       SIZE = SIZE + LEN + 1;

  34281 19 025215   000535 236000 11                 LDQ     SIZE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:935  
        19 025216   201122 036100                    ADLQ    LEN,,AUTO
        19 025217   000001 036007                    ADLQ    1,DL
        19 025220   000535 756000 11                 STQ     SIZE

     6774    34282    2       LINK_CCBUF.L# = SIZE;

  34282 19 025221   000033 736000                    QLS     27
        19 025222   000073 552040 11                 STBQ    LINK_CCBUF,'40'O

     6775    34283        /*
     6776    34284          ***** Check for a valid user name.  If invalid, enclose in quotes
     6777    34285          ***** so that a registered name containing non-standard characters
     6778    34286          ***** is acceptable.
     6779    34287        */
     6780    34288    2       CALL XUR$GETCMD (SEND_CMD$->BSD,OUT$,,LINK_CCBUF.NAME#,SIZE)

  34288 19 025223   000056 236000 20                 LDQ     46
        19 025224   201712 756100                    STQ     I+104,,AUTO
        19 025225   000704 236000 20                 LDQ     452
        19 025226   000022 235000 20                 LDA     18
        19 025227   201710 757100                    STAQ    I+102,,AUTO
        19 025230   200023 630500                    EPPR0   OUT$,,AUTO
        19 025231   201707 450500                    STP0    I+101,,AUTO
        19 025232   200005 236100                    LDQ     SEND_CMD$,,AUTO
        19 025233   201706 756100                    STQ     I+100,,AUTO
        19 025234   201706 630500                    EPPR0   I+100,,AUTO
        19 025235   000041 631400 20                 EPPR1   33
        19 025236   000000 701000 xent               TSX1    XUR$GETCMD
        19 025237   025241 702000 19                 TSX2    s:34290
        19 025240   025324 710000 19                 TRA     s:34315

     6781    34289    3       whenaltreturn do;

     6782    34290    3           INDX2 = 0;

  34290 19 025241   000375 450000 11                 STZ     INDX2

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:936  
     6783    34291    3           CFLEN = VM_CURRENT_FOLDER.USER_NAME.COUNT;

  34291 19 025242   001267 236000 11                 LDQ     VM_CURRENT_FOLDER+20
        19 025243   000033 772000                    QRL     27
        19 025244   201123 756100                    STQ     CFLEN,,AUTO

     6784    34292    4           do while( INDX2 < CFLEN);

  34292 19 025245   000375 116000 11                 CMPQ    INDX2
        19 025246   025260 604400 19                 TMOZ    s:34298

     6785    34293    4               if substr(WORK_STRING.NAME#,INDX2,1) ~= substr(VM_CURRENT_FOLDER.
             34293                        USER_NAME.TEXT,INDX2,1)

  34293 19 025247   000375 235000 11                 LDA     INDX2
        19 025250   040005 106405                    CMPC    fill='040'O
        19 025251   000174 200001 11                 ADSC9   WORK_STRING,A            cn=1,n=1
        19 025252   001267 200001 11                 ADSC9   VM_CURRENT_FOLDER+20,A   cn=1,n=1
        19 025253   025260 601000 19                 TNZ     s:34298

     6786    34294    4               then exit;
     6787    34295    4               INDX2 = INDX2 + 1;

  34295 19 025254   000375 054000 11                 AOS     INDX2

     6788    34296    4           end;

  34296 19 025255   000375 236000 11                 LDQ     INDX2
        19 025256   201123 116100                    CMPQ    CFLEN,,AUTO
        19 025257   025247 604000 19                 TMI     s:34293

     6789    34297
     6790    34298    3           substr(LINK_CCBUF.NAME#,LEN,1) = '''';

  34298 19 025260   201122 235100                    LDA     LEN,,AUTO
        19 025261   040005 100400                    MLR     fill='040'O
        19 025262   000705 000001 20                 ADSC9   453                      cn=0,n=1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:937  
        19 025263   000073 200001 11                 ADSC9   LINK_CCBUF,A             cn=1,n=1

     6791    34299    3           substr(LINK_CCBUF.NAME#,LEN+1,CFLEN) = WORK_STRING.NAME#;

  34299 19 025264   201123 720100                    LXL0    CFLEN,,AUTO
        19 025265   040045 100400                    MLR     fill='040'O
        19 025266   000174 200777 11                 ADSC9   WORK_STRING              cn=1,n=511
        19 025267   000073 400010 11                 ADSC9   LINK_CCBUF,A             cn=2,n=*X0

     6792    34300    3           LEN = LEN + 1 + CFLEN;

  34300 19 025270   201122 236100                    LDQ     LEN,,AUTO
        19 025271   201123 036100                    ADLQ    CFLEN,,AUTO
        19 025272   000001 036007                    ADLQ    1,DL
        19 025273   201122 756100                    STQ     LEN,,AUTO

     6793    34301    3           substr(LINK_CCBUF.NAME#,LEN,1) = '''';

  34301 19 025274   040006 100400                    MLR     fill='040'O
        19 025275   000705 000001 20                 ADSC9   453                      cn=0,n=1
        19 025276   000073 200001 11                 ADSC9   LINK_CCBUF,Q             cn=1,n=1

     6794    34302    3           SIZE = WORK_STRING.L# - INDX2;

  34302 19 025277   000174 236000 11                 LDQ     WORK_STRING
        19 025300   000033 772000                    QRL     27
        19 025301   000375 136000 11                 SBLQ    INDX2
        19 025302   000535 756000 11                 STQ     SIZE

     6795    34303    3           substr(LINK_CCBUF.NAME#,LEN+1,SIZE) = substr(WORK_STRING.NAME#,INDX2,SIZE);

  34303 19 025303   000000 621006                    EAX1    0,QL
        19 025304   000375 235000 11                 LDA     INDX2
        19 025305   000535 722000 11                 LXL2    SIZE
        19 025306   201122 236100                    LDQ     LEN,,AUTO
        19 025307   040046 100445                    MLR     fill='040'O
        19 025310   000174 200011 11                 ADSC9   WORK_STRING,A            cn=1,n=*X1
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:938  
        19 025311   000073 400012 11                 ADSC9   LINK_CCBUF,Q             cn=2,n=*X2

     6796    34304    3           substr(LINK_CCBUF.NAME#,LEN+1+SIZE,1) = ')';

  34304 19 025312   000535 036000 11                 ADLQ    SIZE
        19 025313   040006 100400                    MLR     fill='040'O
        19 025314   000703 000001 20                 ADSC9   451                      cn=0,n=1
        19 025315   000073 400001 11                 ADSC9   LINK_CCBUF,Q             cn=2,n=1

     6797    34305    3           SIZE = LEN + 2 + SIZE;

  34305 19 025316   201122 236100                    LDQ     LEN,,AUTO
        19 025317   000535 036000 11                 ADLQ    SIZE
        19 025320   000002 036007                    ADLQ    2,DL
        19 025321   000535 756000 11                 STQ     SIZE

     6798    34306    3           LINK_CCBUF.L# = SIZE;

  34306 19 025322   000033 736000                    QLS     27
        19 025323   000073 552040 11                 STBQ    LINK_CCBUF,'40'O

     6799    34307    3       end;

     6800    34308            %INIT_STR (CODE=E_SEND_NAME, STR=VM_SEND_NAME, TEST=YES);

  34315 19 025324   040000 106400                    CMPC    fill='040'O
        19 025325   005053 200037 11                 ADSC9   VM_SEND_NAME             cn=1,n=31
        19 025326   000035 000001 20                 ADSC9   29                       cn=0,n=1
        19 025327   025334 601000 19                 TNZ     s:34331

  34317 19 025330   000706 630400 20                 EPPR0   454
        19 025331   000000 631400 20                 EPPR1   0
        19 025332   000000 701000 xent               TSX1    VMD$ERRMSG
        19 025333   000000 011000                    NOP     0

     6801    34331    2       FPT_LINK.NAME_ = VECTOR(VM_SEND_NAME);

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:939  
  34331 19 025334   000710 237000 20                 LDAQ    456
        19 025335   002414 757000 11                 STAQ    FPT_LINK

     6802    34332    2       FPT_LINK.ACCT_ = VECTOR(SYSACCT);

  34332 19 025336   000712 237000 20                 LDAQ    458
        19 025337   002416 757000 11                 STAQ    FPT_LINK+2

     6803    34333
     6804    34334    2       return;

  34334 19 025340   201120 221300                    LDX1  ! @SITENAME,,AUTO
        19 025341   000001 702211                    TSX2  ! 1,X1

     6805    34335
     6806    34336    2   end BUILD_LINK_TO_SEND_CMD;
     6807    34337    1   END VMO$MAIL;

  34337 19 025342   000000 702200 xent               TSX2  ! X66_MARET

P_PCB
 Sect OctLoc
  11     000   000000 006014   000000 006014   000000 006014   000000 006014    ................
  11     004   000000 000000   000000 600000   000000 000000   040042 040042    ............ " "
  11     010   000000 040000   000000 000000   000000 000000   000000 006014    .. .............
  11     014   000000 006014   000000 000000                                    ........

XUR_INIT
 Sect OctLoc
  11     016   720000 000001   000000 000000   000000 000000   000000 000000    ................
  11     022   000000 006000   000000 177640   000000 006014   000000 000000    ................
  11     026   000000 006014   000000 000000   000000 000000   ****** ******    ................
  11     032   000000 177640   000000 006014   000000 000000   000000 000000    ................
  11     036   000000 177640   000000 006014   000000 000000   00200* ******    ................
  11     042   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11     062*  000000 000000   000000 000000   000000 000000                    ............

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:940  
CURRENT_MESSAGE_NUMBER
 Sect OctLoc
  11     072   000000 000000                                                    ....

LINK_CCBUF
 Sect OctLoc
  11     073   037040 040040   040040 040040   040040 040040   040040 040040    .
  11     077   040040 040040   040040 040040   040040 040040   040040 040040
  11     173*  040*** ******                                                     ...

WORK_STRING
 Sect OctLoc
  11     174   037040 040040   040040 040040   040040 040040   040040 040040    .
  11     200   040040 040040   040040 040040   040040 040040   040040 040040
  11     370*  040040 040040   040040 040040   040040 040040   040040 040040

PAGESIZE
 Sect OctLoc
  11     374   000000 010000                                                    ....

NEW_FLAG
 Sect OctLoc
  11     377   0***** ******                                                    ....

BREAK_TYPE
 Sect OctLoc
  11     400   000000 000000                                                    ....

OUTDCB
 Sect OctLoc
  11     402   000000 000000                                                    ....

MAIL_PROMPT
 Sect OctLoc
  11     406   402160 076***                                                    .p>.

VM_MODIFY_LIST_PROMPT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:941  
 Sect OctLoc
  11     407   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_MODIFY_USER_PROMPT
 Sect OctLoc
  11     413   017040 040040   040040 040040   040040 040040   040040 040040    .

EXIT_MAIL#
 Sect OctLoc
  11     417   0***** ******                                                    ....

EXIT_MAIL_PEND#
 Sect OctLoc
  11     420   0***** ******                                                    ....

OUTBUF
 Sect OctLoc
  11     422   ****** ******   ****** ******   ****** ******   ****** ******    ................

SIZE
 Sect OctLoc
  11     535   000000 000000                                                    ....

NEXT_COMMAND_ECHO#
 Sect OctLoc
  11     542   0***** ******                                                    ....

CURR_COMMAND_CODE
 Sect OctLoc
  11     543   000000 000000                                                    ....

LAST_COMMAND_CODE
 Sect OctLoc
  11     544   000000 000027                                                    ....

M$CMNDF_NUM
 Sect OctLoc
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:942  
  11     545   000000 000000                                                    ....

VM_HEADKEY
 Sect OctLoc
  11     546   005010 000000   000000 ******                                    ........

VM_INFOKEY
 Sect OctLoc
  11     550   005000 000000   000000 ******                                    ........

VM_BODYKEY
 Sect OctLoc
  11     552   007060 000000   000000 000000                                    .0......

VM_LISTKEY
 Sect OctLoc
  11     554   311074 ******   ****** ******   ****** ******   ****** ******    .<..............
  11     634*  ****** ******   ****** ******   ****** ******                    ............

VM_LISTKEY2
 Sect OctLoc
  11     637   311074 ******   ****** ******   ****** ******   ****** ******    .<..............
  11     717*  ****** ******   ****** ******   ****** ******                    ............

VM_USERKEY
 Sect OctLoc
  11     722   311120 ******   ****** ******   ****** ******   ****** ******    .P..............
  11    1002*  ****** ******   ****** ******   ****** ******                    ............

VM_USERKEY2
 Sect OctLoc
  11    1005   311120 ******   ****** ******   ****** ******   ****** ******    .P..............
  11    1065*  ****** ******   ****** ******   ****** ******                    ............

VM_CGBUFFER
 Sect OctLoc
  11    1070   040040 040040   040040 040040   000000 000000   000040 040040            .....
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:943  
  11    1074   040040 040040   040040 040040   040040 040040   040040 040040
  11    1100   040040 040040   040040 000000   040040 040040   040040 040040          ..
  11    1104   040040 040040   040040 040040   040040 040040   040040 040040
  11    1110   040040 040040   040040 040040   000040 040040   040040 040040            .
  11    1114   040040 040040   040040 040040   040040 040040   040040 040040
  11    1120   040040 040040   040040 040040   ****** ******   040040 040040            ....
  11    1124   040040 040040   040040 040040   040040 040040   040040 040040
  11    1130   040040 040040   040040 040040   040040 040040   040040 040040

VM_CENTRAL_FOLDER
 Sect OctLoc
  11    1134   040040 040040   040040 040040   040040 040040   040040 040040
  11    1150*  040040 040040   040040 040***   000000 000000   000000 000000           .........
  11    1154   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    1160   000040 040040   040040 040040   040040 040040   040040 040040    .
  11    1164   040040 040040   040040 040040   040040 040040   040040 040040
  11    1240*  040040 040040   040040 040040   040*** ******                             ...

VM_CURRENT_FOLDER
 Sect OctLoc
  11    1243   040040 040040   040040 040040   040040 040040   040040 040040
  11    1257*  040040 040040   040040 040***   000000 000000   000000 000000           .........
  11    1263   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    1267   000040 040040   040040 040040   040040 040040   040040 040040    .
  11    1273   040040 040040   040040 040040   040040 040040   040040 040040
  11    1347*  040040 040040   040040 040040   040*** ******                             ...

VM_CURRENT_FOLDER_SAVE
 Sect OctLoc
  11    1352   040040 040040   040040 040040   040040 040040   040040 040040
  11    1366*  040040 040040   040040 040***   000000 000000   000000 000000           .........
  11    1372   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    1376   000040 040040   040040 040040   040040 040040   040040 040040    .
  11    1402   040040 040040   040040 040040   040040 040040   040040 040040
  11    1456*  040040 040040   040040 040040   040*** ******                             ...

VM_WORK_FOLDER
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:944  
 Sect OctLoc
  11    1461   040040 040040   040040 040040   040040 040040   040040 040040
  11    1475*  040040 040040   040040 040***   000000 000000   000000 000000           .........
  11    1501   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    1505   000040 040040   040040 040040   040040 040040   040040 040040    .
  11    1511   040040 040040   040040 040040   040040 040040   040040 040040
  11    1565*  040040 040040   040040 040040   040*** ******                             ...

VM_SEARCH_INFO
 Sect OctLoc
  11    1570   ****** ******   000000 000000   000000 000000   000000 000000    ................
  11    1574   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    1630*  000000 000000   000000 000000   00**** ******                    ............

VM_WILDCARD
 Sect OctLoc
  11    1634   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    1644*  000000 000000   077000 000000   000000 000000   000000 000000    ....?...........

X$MCB
 Sect OctLoc
  11    1652   ****** ******   ****** ******   ****** ******   ****** ******    ................

OPT_FID
 Sect OctLoc
  11    1670   ****** ******   ****** ******   ****** ******   ****** ******    ................

ENQ_PROFILE
 Sect OctLoc
  11    1712   000003 777640   001720 006000   000001 777640   001734 006000    ................
  11    1716   000000 177640   000000 006014   000000 540000   777777 777777    ................
  11    1722   000000 000000   000000 000000                                    ........

DEQ_PROFILE
 Sect OctLoc
  11    1724   000001 777640   001732 006000   000001 777640   001734 006000    ................
  11    1730   000000 177640   000000 006014   000000 400000   000000 000000    ................
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:945  

VM_PRORES
 Sect OctLoc
  11    1734   007120 122117   106111 114105                                    .PROFILE

VM_FILERES
 Sect OctLoc
  11    1736   004106 111114   105*** ******                                    .FILE...

VM_HEADRES
 Sect OctLoc
  11    1740   004000 000000   000*** ******                                    ........

RESET_#1
 Sect OctLoc
  11    1742   000002 177640   000352 006000   000001 777640   001750 006000    ................
  11    1746   000000 177640   000000 006014   200000 000000   0***** ******    ................

RESET_#2
 Sect OctLoc
  11    1752   000002 177640   000355 006000   000001 777640   001760 006000    ................
  11    1756   000000 177640   000000 006014   200000 000000   0***** ******    ................

RESET_#3
 Sect OctLoc
  11    1762   000002 177640   000360 006000   000001 777640   001770 006000    ................
  11    1766   000000 177640   000000 006014   200000 000000   0***** ******    ................

RESET_#4
 Sect OctLoc
  11    1772   000002 177640   000363 006000   000001 777640   002000 006000    ................
  11    1776   000000 177640   000000 006014   200000 000000   0***** ******    ................

HELP_PARAM
 Sect OctLoc
  11    2002   000001 177640   002074 006000   000001 777640   002434 006000    .....<..........
  11    2006   000000 177640   000000 006014   000000 177640   000000 006014    ................
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:946  
  11    2012   000000 000000   000000 006014   000000 000000   0***** ******    ................
  11    2016   000000 000000   000000 000000   003040 040040   040040 040040    .........
  11    2022   040040 040040   040040 040040   040040 040040   040040 040040
  11    2026   040040 040040   040040 040040   040040 040000   040040 040040               .
  11    2032   040040 040040   040040 040040   040040 040040   040040 040040
  11    2046*  040*** ******   ****** ******   000000 177640   000000 006014     ...............
  11    2052   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2056   000000 177640   000000 006014   000000 361101   000000 000000    ...........A....
  11    2062   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    2072*  000000 000000                                                    ....

MAIL_PROG_NAME
 Sect OctLoc
  11    2074   004115 101111   114*** ******                                    .MAIL...

FPT_INT
 Sect OctLoc
  11    2076   000001 777640   002100 006000   000000 000000   000000 000000    .....@..........

SET_XCON
 Sect OctLoc
  11    2102   000001 777640   002106 006000   000000 177640   000000 006014    .....F..........
  11    2106   000000 000000   000000 000000                                    ........

CLOSE_SAVE
 Sect OctLoc
  11    2110   000003 777640   002142 006000   000000 177640   000000 006014    .....b..........
  11    2114   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2140*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
  11    2144   000220 000000   000000 000000                                    ........

CLOSE_SCRATCH
 Sect OctLoc
  11    2146   000003 777640   002200 006000   000000 177640   000000 006014    ................
  11    2152   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2176*  000000 177640   000000 006014   000000 000001   000000 000040    ...............
  11    2202   000220 000000   000000 000000                                    ........
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:947  

ERROR
 Sect OctLoc
  11    2204   000000 000000                                                    ....

FID_NAME
 Sect OctLoc
  11    2205   037040 040040   040040 040040   040040 040040   040040 040040    .
  11    2211   040040 040040   040040 040040   040040 040040   040040 040040

FID_ACCT
 Sect OctLoc
  11    2215   040040 040040   040040 040040

FID_PASS
 Sect OctLoc
  11    2217   040040 040040   040040 040040

FID_SN
 Sect OctLoc
  11    2222   000000 000001   040040 040040   040040 ******                    ....      ..

FID_WSN
 Sect OctLoc
  11    2226   040040 040040   040040 040040

FID_RESULTS
 Sect OctLoc
  11    2232   ****** ******   ****** ******   ****** ******   ****** ******    ................

CHECK_FID
 Sect OctLoc
  11    2244   000003 777640   002270 006000   000017 777640   001670 006000    ................
  11    2250   000007 777640   002205 006000   000001 777640   002215 006000    ................
  11    2254   000001 777640   002217 006000   000003 777640   002222 006000    ................
  11    2260   000001 777640   002226 006000   000000 777640   002230 006000    ................
  11    2264   000000 777640   002231 006000   000011 777640   002232 006000    ................
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:948  
  11    2270   777000 000000   000000 000000   000000 000000   ****** ******    ................

OPEN_NEXT
 Sect OctLoc
  11    2274   000025 777640   002340 006000   000000 177640   000000 006014    ................
  11    2300   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2304   000001 777640   002217 006000   000000 177640   000000 006014    ................
  11    2310   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2320*  000001 777640   002215 006000   000000 177640   000000 006014    ................
  11    2324   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2340*  000000 024072   000000 002001   252525 000000   000040 252520    ...:......... ..
  11    2344   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11    2350   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    2354   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11    2360   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11    2364   000000 000000   ****** ******                                    ........

WRITE_NAME_MAP
 Sect OctLoc
  11    2366   000003 777640   002376 006000   000005 177640   002402 006000    ................
  11    2372   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2376   000000 400400   000000 000000   000000 000000   000000 000000    ................

NAME_KEY
 Sect OctLoc
  11    2402   001040 040040   040040 040040   040040 040040   040040 040040    .
  11    2406   040040 040040   040*** ******                                         ...

FPT_CORRES
 Sect OctLoc
  11    2410   000001 777640   002412 006000   000000 000000   ****** ******    ................

FPT_LINK
 Sect OctLoc
  11    2414   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2424*  000100 177640   000073 006000   000000 177640   000000 006014    .@...;..........
  11    2430   000001 777640   002432 006000   600000 000000   000000 000000    ................
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:949  

SYSACCT
 Sect OctLoc
  11    2434   072123 131123   040040 040040                                    :SYS

REOPEN_FILE
 Sect OctLoc
  11    2436   000025 777640   002502 006000   000000 177640   000000 006014    ................
  11    2442   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2502*  000000 000042   000000 001000   252525 000000   000040 252520    ..."......... ..
  11    2506   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11    2512   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    2516   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11    2522   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11    2526   000000 000000   ****** ******                                    ........

GET_TIME
 Sect OctLoc
  11    2530   000001 777640   002542 006000   000000 177640   000000 006014    ................
  11    2534   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2540   000000 777640   000376 006000   000004 000000   ****** ******    ................

OPEN_COMMAND_STREAM
 Sect OctLoc
  11    2544   000025 777640   002610 006000   000000 177640   000000 006014    ................
  11    2550   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2610*  000000 400042   000000 002000   252525 001001   000040 252520    ..."......... ..
  11    2614   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11    2620   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    2624   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11    2630   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11    2634   000000 000000   ****** ******                                    ........

OPEN_ENCL
 Sect OctLoc
  11    2636   000025 777640   002702 006000   000000 177640   000000 006014    ................
  11    2642   000000 177640   000000 006014   000000 177640   000000 006014    ................
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:950  
  11    2702*  000000 000042   000000 000001   252525 001000   000040 252520    ..."......... ..
  11    2706   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11    2712   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    2716   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11    2722   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11    2726   000000 000000   ****** ******                                    ........

WRITE_ENCL
 Sect OctLoc
  11    2730   000003 777640   002740 006000   000000 177640   000000 006014    ................
  11    2734   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2740   000000 400400   000000 000000   000000 000000   000000 000000    ................

F_FDSME
 Sect OctLoc
  11    2744   000000 177640   000000 006014   000000 000000   000000 000000    ................
  11    2750   000000 000000   000112 777640   000422 006000   000000 000001    .....J..........
  11    2754   000000 000000   000000 000000   003076 006000   000000 101500    .........>....A.
  11    2760   000000 000000   000000 000000   000000 000001   000000 000012    ................
  11    2764   000000 000000   ****** ******   ****** ******   000000 000000    ................
  11    2770   000000 000000   000000 000000   000000 000000   000000 006014    ................
  11    2774   000000 006014   000000 006014   000000 006014   000000 000000    ................
  11    3000   000000 000000   000000 000000                                    ........

SPACE_LO
 Sect OctLoc
  11    3002   000000 577640   003114 006000   000000 000000   000000 000000    .....L..........
  11    3006   000000 000000   000112 777640   000422 006000   000000 000001    .....J..........
  11    3012   000000 000000   000000 000000   003076 006000   000000 101500    .........>....A.
  11    3016   000000 000000   000000 000000   000000 000001   000000 000012    ................
  11    3022   000000 000000   ****** ******   ****** ******   000000 000000    ................
  11    3026   000000 000000   000000 000000   000000 000000   000000 006014    ................
  11    3032   000000 006014   000000 006014   000000 006014   000000 000000    ................
  11    3036   000000 000000   000000 000000                                    ........

F_FDSLO
 Sect OctLoc
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:951  
  11    3040   000000 177640   000000 006014   000000 000000   000000 000000    ................
  11    3044   000000 000000   000112 777640   000422 006000   000000 000001    .....J..........
  11    3050   000000 000000   000000 000000   003076 006000   000000 101500    .........>....A.
  11    3054   000000 000000   000000 000000   000000 000001   000000 000012    ................
  11    3060   000000 000000   ****** ******   ****** ******   000000 000000    ................
  11    3064   000000 000000   000000 000000   000000 000000   000000 006014    ................
  11    3070   000000 006014   000000 006014   000000 006014   000000 000000    ................
  11    3074   000000 000000   000000 000000                                    ........

VECT_ARRAY
 Sect OctLoc
  11    3076   ****** ******   ****** ******   ****** ******   ****** ******    ................

VM_BLANK_LINE_FMT
 Sect OctLoc
  11    3114   045061 130***                                                    %1X.

VM_GREETING_FMT
 Sect OctLoc
  11    3115   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3121   040040 040040   040040 040040   040040 040040   040040 040040
  11    3141*  040*** ******                                                     ...

VM_FOLDER_HEADER1_FMT
 Sect OctLoc
  11    3142   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3146   040040 040040   040040 040040   040040 040040   040040 040040
  11    3166*  040*** ******                                                     ...

VM_FOLDER_HEADER2_FMT
 Sect OctLoc
  11    3167   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3173   040040 040040   040040 040040   040040 040040   040040 040040
  11    3213*  040*** ******                                                     ...

VM_FOLDER_DELETED_FMT
 Sect OctLoc
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:952  
  11    3214   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3220   040040 040040   040040 040040   040040 040040   040040 040040
  11    3240*  040*** ******                                                     ...

VM_FOLDER_DISPLAYED_FMT
 Sect OctLoc
  11    3241   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3245   040040 040040   040040 040040   040040 040040   040040 040040
  11    3265*  040*** ******                                                     ...

VM_COUNT_FMT
 Sect OctLoc
  11    3266   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3272   040040 040040   040040 040040   040040 040040   040040 040040
  11    3312*  040*** ******                                                     ...

VM_NO_MESSAGE_FMT
 Sect OctLoc
  11    3313   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3317   040040 040040   040040 040040   040040 040040   040040 040040
  11    3337*  040*** ******                                                     ...

VM_TIME_FMT
 Sect OctLoc
  11    3340   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3344   040040 040040   040040 040040   040040 040040   040040 040040
  11    3364*  040*** ******                                                     ...

VM_EMPTY_FOLDER_FMT
 Sect OctLoc
  11    3365   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3371   040040 040040   040040 040040   040040 040040   040040 040040
  11    3411*  040*** ******                                                     ...

VM_NO_NEW_MESSAGE_FMT
 Sect OctLoc
  11    3412   120040 040040   040040 040040   040040 040040   040040 040040    P
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:953  
  11    3416   040040 040040   040040 040040   040040 040040   040040 040040
  11    3436*  040*** ******                                                     ...

VM_CREATE_MSG_FMT
 Sect OctLoc
  11    3437   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3443   040040 040040   040040 040040   040040 040040   040040 040040
  11    3463*  040*** ******                                                     ...

VM_MSGS_DELETED_FMT
 Sect OctLoc
  11    3464   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3470   040040 040040   040040 040040   040040 040040   040040 040040
  11    3510*  040*** ******                                                     ...

VM_MSGS_UNDELETED_FMT
 Sect OctLoc
  11    3511   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3515   040040 040040   040040 040040   040040 040040   040040 040040
  11    3535*  040*** ******                                                     ...

VM_MSGS_MARKED_FMT
 Sect OctLoc
  11    3536   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3542   040040 040040   040040 040040   040040 040040   040040 040040
  11    3562*  040*** ******                                                     ...

VM_MSGS_UNMARKED_FMT
 Sect OctLoc
  11    3563   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3567   040040 040040   040040 040040   040040 040040   040040 040040
  11    3607*  040*** ******                                                     ...

VM_MSGS_COPIED_FMT
 Sect OctLoc
  11    3610   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3614   040040 040040   040040 040040   040040 040040   040040 040040
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:954  
  11    3634*  040*** ******                                                     ...

VM_MSGS_DISPLAYED_FMT
 Sect OctLoc
  11    3635   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3641   040040 040040   040040 040040   040040 040040   040040 040040
  11    3661*  040*** ******                                                     ...

VM_MSGS_LISTED_FMT
 Sect OctLoc
  11    3662   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3666   040040 040040   040040 040040   040040 040040   040040 040040
  11    3706*  040*** ******                                                     ...

VM_LISTS_DELETED_FMT
 Sect OctLoc
  11    3707   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3713   040040 040040   040040 040040   040040 040040   040040 040040
  11    3733*  040*** ******                                                     ...

VM_LISTS_DISPLAYED_FMT
 Sect OctLoc
  11    3734   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3740   040040 040040   040040 040040   040040 040040   040040 040040
  11    3760*  040*** ******                                                     ...

VM_USERS_DELETED_FMT
 Sect OctLoc
  11    3761   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    3765   040040 040040   040040 040040   040040 040040   040040 040040
  11    4005*  040*** ******                                                     ...

VM_USERS_DISPLAYED_FMT
 Sect OctLoc
  11    4006   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4012   040040 040040   040040 040040   040040 040040   040040 040040
  11    4032*  040*** ******                                                     ...
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:955  

VM_STATUS_FOLDER_FMT
 Sect OctLoc
  11    4033   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4037   040040 040040   040040 040040   040040 040040   040040 040040
  11    4057*  040*** ******                                                     ...

VM_STATUS_SCONTEXT_FMT
 Sect OctLoc
  11    4060   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4064   040040 040040   040040 040040   040040 040040   040040 040040
  11    4104*  040*** ******                                                     ...

VM_STATUS_CCONTEXT_FMT
 Sect OctLoc
  11    4105   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4111   040040 040040   040040 040040   040040 040040   040040 040040
  11    4131*  040*** ******                                                     ...

VM_STATUS_POSITION_FMT
 Sect OctLoc
  11    4132   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4136   040040 040040   040040 040040   040040 040040   040040 040040
  11    4156*  040*** ******                                                     ...

VM_STATUS_POSITION_OUTSIDE_FMT
 Sect OctLoc
  11    4157   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4163   040040 040040   040040 040040   040040 040040   040040 040040
  11    4203*  040*** ******                                                     ...

VM_STATUS_DMSGS_FMT
 Sect OctLoc
  11    4204   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4210   040040 040040   040040 040040   040040 040040   040040 040040
  11    4230*  040*** ******                                                     ...

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:956  
VM_STATUS_NMSGS_FMT
 Sect OctLoc
  11    4231   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4235   040040 040040   040040 040040   040040 040040   040040 040040
  11    4255*  040*** ******                                                     ...

VM_STATUS_TMSGS_FMT
 Sect OctLoc
  11    4256   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4262   040040 040040   040040 040040   040040 040040   040040 040040
  11    4302*  040*** ******                                                     ...

VM_STATUS_HMSGS_FMT
 Sect OctLoc
  11    4303   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4307   040040 040040   040040 040040   040040 040040   040040 040040
  11    4327*  040*** ******                                                     ...

VM_USE_FULL_FMT
 Sect OctLoc
  11    4330   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4334   040040 040040   040040 040040   040040 040040   040040 040040
  11    4354*  040*** ******                                                     ...

VM_USE_LOST_FMT
 Sect OctLoc
  11    4355   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4361   040040 040040   040040 040040   040040 040040   040040 040040
  11    4401*  040*** ******                                                     ...

VM_NEW_MESSAGE_FMT
 Sect OctLoc
  11    4402   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4406   040040 040040   040040 040040   040040 040040   040040 040040
  11    4426*  040*** ******                                                     ...

USER_NAME
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:957  
 Sect OctLoc
  11    4427   001040 040040   040040 040040   040040 040040   040040 040040    .
  11    4433   040040 040040   040040 040040   040040 040040   040040 040040
  11    4527*  040*** ******                                                     ...

VM_DETACH_OK_FMT
 Sect OctLoc
  11    4530   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4534   040040 040040   040040 040040   040040 040040   040040 040040
  11    4554*  040*** ******                                                     ...

VM_DETACH_DELETE_OK_FMT
 Sect OctLoc
  11    4555   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4561   040040 040040   040040 040040   040040 040040   040040 040040
  11    4601*  040*** ******                                                     ...

VM_END_NOUPDATE_CMD
 Sect OctLoc
  11    4602   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_NEXT_CMD
 Sect OctLoc
  11    4606   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_DI_NEXT_CMD
 Sect OctLoc
  11    4612   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_LIST_NEXT_CMD
 Sect OctLoc
  11    4616   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_PREVIOUS_CMD
 Sect OctLoc
  11    4622   017040 040040   040040 040040   040040 040040   040040 040040    .

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:958  
VM_DI_PREVIOUS_CMD
 Sect OctLoc
  11    4626   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_LIST_PREVIOUS_CMD
 Sect OctLoc
  11    4632   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_DI_FIRST_CMD
 Sect OctLoc
  11    4636   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_LIST_FIRST_CMD
 Sect OctLoc
  11    4642   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_DI_THIS_CMD
 Sect OctLoc
  11    4646   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_LIST_THIS_CMD
 Sect OctLoc
  11    4652   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_DI_LAST_CMD
 Sect OctLoc
  11    4656   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_LIST_LAST_CMD
 Sect OctLoc
  11    4662   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_DI_REST_CMD
 Sect OctLoc
  11    4666   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_LIST_REST_CMD
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:959  
 Sect OctLoc
  11    4672   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_END_CMD
 Sect OctLoc
  11    4676   017040 040040   040040 040040   040040 040040   040040 040040    .

VM_SEND_ANSWER
 Sect OctLoc
  11    4702   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4706   040040 040040   040040 040040   040040 040040   040040 040040
  11    4726*  040*** ******                                                     ...

VM_SEND_ACKNOWLEDGE
 Sect OctLoc
  11    4727   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4733   040040 040040   040040 040040   040040 040040   040040 040040
  11    4753*  040*** ******                                                     ...

VM_SEND_FORWARD
 Sect OctLoc
  11    4754   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    4760   040040 040040   040040 040040   040040 040040   040040 040040
  11    5000*  040*** ******                                                     ...

VM_SEND_FORWARD_ENCL
 Sect OctLoc
  11    5001   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    5005   040040 040040   040040 040040   040040 040040   040040 040040
  11    5025*  040*** ******                                                     ...

VM_SEND_MAIL
 Sect OctLoc
  11    5026   120040 040040   040040 040040   040040 040040   040040 040040    P
  11    5032   040040 040040   040040 040040   040040 040040   040040 040040
  11    5052*  040*** ******                                                     ...

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:960  
VM_SEND_NAME
 Sect OctLoc
  11    5053   037040 040040   040040 040040   040040 040040   040040 040040    .
  11    5057   040040 040040   040040 040040   040040 040040   040040 040040

VM_RESEND_NAME
 Sect OctLoc
  11    5063   037040 040040   040040 040040   040040 040040   040040 040040    .
  11    5067   040040 040040   040040 040040   040040 040040   040040 040040

VM_MAIL_SETUP
 Sect OctLoc
  11    5073   377040 040040   040040 040040   040040 040040   040040 040040    .
  11    5077   040040 040040   040040 040040   040040 040040   040040 040040
  11    5167*  040040 040040   040040 040040   040040 040040   040040 040040

READ_PROFILE
 Sect OctLoc
  11    5206   000005 777640   005216 006000   000000 377640   001355 006000    ................
  11    5212   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    5216   000000 600000   000000 000000   000000 000000   000000 000000    ................
  11    5222   000000 000000   000000 000000                                    ........

RENUM_OPEN
 Sect OctLoc
  11    5230   000025 777640   005274 006000   000000 177640   000000 006014    ................
  11    5234   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    5274*  000000 000072   000000 001001   252525 002000   000040 252520    ...:......... ..
  11    5300   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11    5304   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    5310   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11    5314   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11    5320   000000 000000   ****** ******                                    ........

READ_OLD
 Sect OctLoc
  11    5322   000005 777640   005332 006000   000077 577640   005354 006000    .........?......
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:961  
  11    5326   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    5332   000000 500000   000000 000000   000000 000000   000000 000000    ................
  11    5336   000000 000000   000000 000000                                    ........

WRITE_NEW
 Sect OctLoc
  11    5340   000003 777640   005350 006000   000077 577640   005354 006000    .........?......
  11    5344   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    5350   000000 400400   000000 000000   000000 000000   000000 000000    ................

VLP_KEY
 Sect OctLoc
  11    5354   ****** ******   ****** ******   ****** ******   ****** ******    ................

FID_NAME
 Sect OctLoc
  11    5454   037040 040040   040040 040040   040040 040040   040040 040040    .
  11    5460   040040 040040   040040 040040   040040 040040   040040 040040

BOF
 Sect OctLoc
  11    5470   000003 777640   005476 006000   000000 177640   000000 006014    ................
  11    5474   000000 177640   000000 006014   000000 020000   000000 000000    ................
  11    5500   000000 000000   0***** ******                                    ........

HIGH
 Sect OctLoc
  11    5505   000000 000000                                                    ....

LOW
 Sect OctLoc
  11    5506   000000 000000                                                    ....

LAST
 Sect OctLoc
  11    5507   777777 777777                                                    ....

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:962  
MID
 Sect OctLoc
  11    5510   000000 000000                                                    ....

VM_DEFAULT_NODES
 Sect OctLoc
  12     000   000000 006000   000000 006000   000000 006000   000000 006000    ................
  12     004   000000 006014   000000 006014   000000 006014   000000 006014    ................
  12     014*  000000 006014   000000 006014   000000 006014   000000 006000    ................
  12     020   000000 006014   000000 006014   000000 006014   000000 006014    ................
  12     030*  000000 006014   000000 006014   000000 006000   000000 006014    ................
  12     034   000000 006014   000000 006014                                    ........

VM_NATL_PAIRS
 Sect OctLoc
  12     036   040040 040040   040*** ******   000000 006000   000000 006014         ...........
  12     042   000000 006014   000000 006014   000000 006014                    ............

VM_NODENAMES
 Sect OctLoc
  12     045   000000 012115   101111 114137   116117 104105   123000 001010    ...MAIL_NODES...
  12     051   115101 111114   137103 115104   000002 013115   117104 111106    MAIL_CMD...MODIF
  12     055   131137 114111   123124 000003   013115 117104   111106 131137    Y_LIST...MODIFY_
  12     061   125123 105122   000017 010123   105116 104137   103115 104000    USER...SEND_CMD.
  12     065   032014 101104   104122 105123   123137 123120   105103 000000    ..ADDRESS_SPEC..
  12     071   000*** ******                                                    ....

VM_NODEFID
 Sect OctLoc
  12     072   010126 115137   116117 104105   123*** ******                    .VM_NODES...

M$OUT_NUM
 Sect OctLoc
  12     075   000000 000000                                                    ....

E_MODIFY_LIST_PROMPT
 Sect OctLoc
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:963  
  12     076   261517 017500                                                    ....

E_MODIFY_USER_PROMPT
 Sect OctLoc
  12     077   261517 017510                                                    ....

CVM_PROFILE
 Sect OctLoc
  12     100   102060 060004   000000 000000   000000 000000   000000 006014    B00.............
  12     104   000260 006000   000000 000000   000000 000000   000000 000000    ................
  12     110   000000 000000   000000 000000   000000 000000   010114 111123    .............LIS
  12     114   124040 116105   127040 040040   040040 040040   040040 040040    T NEW
  12     120   040040 040040   040040 040040   040040 040040   040040 040040
  12     210*  040040 040040   040040 040040   040040 040040   040*** ******                 ...
  12     214   000000 006014   000000 006014   000000 006014   000000 006014    ................
  12     224*  000000 006014   000000 006014   000000 006014   040040 040040    ............
  12     230   040040 040040   040040 040040   040040 040040   040040 040040
  12     234   000000 000000   000000 000000   000000 000000   000000 006014    ................
  12     240   000000 006014   000000 000000   000000 000000   000000 000000    ................
  12     244   000000 000000   000000 000000   000000 000000   000000 000000    ................
  12     260*  ****** ******                                                    ....

WAIT30
 Sect OctLoc
  12     262   000001 777640   000266 006000   000000 177640   000000 006014    ................
  12     266   000000 000036   000000 000001                                    ........

GET_ANSI_TIME
 Sect OctLoc
  12     270   000001 777640   000302 006000   000001 377640   000540 006000    ................
  12     274   000001 777640   000536 006000   000000 177640   000000 006014    ................
  12     300   000000 777640   000376 006000   004002 000000   ****** ******    ................

FILE_SHARE
 Sect OctLoc
  12     304   000003 777640   000312 006000   000001 177640   001736 006000    ................
  12     310   000000 177640   000000 006014   000000 440000   000000 000000    ................
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:964  
  12     314   000000 000000   000000 000000                                    ........

FILE_NONE
 Sect OctLoc
  12     316   000003 777640   000324 006000   000001 177640   001736 006000    ................
  12     322   000000 177640   000000 006014   000000 540000   000000 000000    ................
  12     326   000000 000000   000000 000000                                    ........

ENQ_HEAD
 Sect OctLoc
  12     330   000003 777640   000336 006000   000001 177640   001740 006000    ................
  12     334   000000 177640   000000 006014   000000 440000   000000 000000    ................
  12     340   000000 000000   000000 000000                                    ........

DEQ_HEAD
 Sect OctLoc
  12     342   000001 777640   000350 006000   000001 177640   001740 006000    ................
  12     346   000000 177640   000000 006014   000000 400000   000000 000000    ................

RESET_#1_CMD
 Sect OctLoc
  12     352   041122 105123   105124 040043   061*** ******                    !RESET #1...

RESET_#2_CMD
 Sect OctLoc
  12     355   041122 105123   105124 040043   062*** ******                    !RESET #2...

RESET_#3_CMD
 Sect OctLoc
  12     360   041122 105123   105124 040043   063*** ******                    !RESET #3...

RESET_#4_CMD
 Sect OctLoc
  12     363   041122 105123   105124 040043   064*** ******                    !RESET #4...

OPEN_NAME_MAP
 Sect OctLoc
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:965  
  12     366   000025 777640   000432 006000   000000 177640   000000 006014    ................
  12     372   000000 177640   000000 006014   000001 377640   000000 006000    ................
  12     376   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12     412*  000001 777640   000000 006000   000000 177640   000000 006014    ................
  12     416   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12     432*  000000 000512   000000 003001   252525 002002   000040 252520    ............. ..
  12     436   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  12     442   000000 000000   000000 000000   000000 000000   000000 000000    ................
  12     446   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  12     452   040040 040040   000000 000000   000000 000000   000000 000000        ............
  12     456   000000 000000   ****** ******                                    ........

DELREC_NAME_MAP
 Sect OctLoc
  12     460   000001 777640   000470 006000   000005 177640   002402 006000    ................
  12     464   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12     470   000000 000000   000000 000000                                    ........

READ_NAME_MAP
 Sect OctLoc
  12     472   000005 777640   000502 006000   000005 177640   002402 006000    ................
  12     476   000177 577640   000174 206000   000000 177640   000000 006014    .....|..........
  12     502   000000 600000   000000 000000   000000 000000   000000 000000    ................
  12     506   000000 000000   000000 000000                                    ........

OPEN_SEND_FILE
 Sect OctLoc
  12     510   000025 777640   000554 006000   000000 177640   000000 006014    ................
  12     514   000000 177640   000000 006014   000007 777640   000000 006000    ................
  12     520   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12     554*  000000 400642   000000 003001   252525 002002   000040 252520    ............. ..
  12     560   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  12     564   000000 000000   000000 000000   000000 000000   000000 000000    ................
  12     570   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  12     574   040040 040040   000000 000000   000000 000000   000000 000000        ............
  12     600   000000 000000   ****** ******                                    ........

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:966  
OPEN_FORWARD_FILE
 Sect OctLoc
  12     602   000025 777640   000646 006000   000000 177640   000000 006014    ................
  12     606   000000 177640   000000 006014   000007 377640   000000 006000    ................
  12     612   000001 777640   000000 006000   000000 177640   000000 006014    ................
  12     616   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12     646*  000000 400642   000000 003001   252525 001001   000040 252520    ............. ..
  12     652   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  12     656   000000 000000   000000 000000   000000 000000   000000 000000    ................
  12     662   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  12     666   040040 040040   000000 000000   000000 000000   000000 000000        ............
  12     672   000000 000000   ****** ******                                    ........

OPEN_FORWARD_ENCL_FILE
 Sect OctLoc
  12     674   000025 777640   000740 006000   000000 177640   000000 006014    ................
  12     700   000000 177640   000000 006014   000007 377640   000000 006000    ................
  12     704   000001 777640   000000 006000   000000 177640   000000 006014    ................
  12     710   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12     740*  000000 400642   000000 003001   252525 002002   000040 252520    ............. ..
  12     744   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  12     750   000000 000000   000000 000000   000000 000000   000000 000000    ................
  12     754   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  12     760   040040 040040   000000 000000   000000 000000   000000 000000        ............
  12     764   000000 000000   ****** ******                                    ........

OPEN_OUTPUT_STREAM_DEFAULT
 Sect OctLoc
  12     766   000025 777640   001032 006000   000000 177640   000000 006014    ................
  12     772   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12    1032*  000000 600442   000000 003000   252525 000000   000040 252520    ............. ..
  12    1036   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  12    1042   000000 000000   000000 000000   000000 000000   000000 000000    ................
  12    1046   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  12    1052   040040 040040   000000 000000   000000 000000   000000 000000        ............
  12    1056   000000 000000   ****** ******                                    ........

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:967  
OPEN_COMMAND_STREAM_DEFAULT
 Sect OctLoc
  12    1060   000025 777640   001124 006000   000000 177640   000000 006014    .....T..........
  12    1064   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12    1110*  000000 177640   000000 006014   000000 377640   000000 006014    ................
  12    1114   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12    1124*  000000 600042   000000 002000   252525 001001   000040 252520    ..."......... ..
  12    1130   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  12    1134   000000 000000   000000 000000   000000 000000   000000 000000    ................
  12    1140   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  12    1144   040040 040040   000000 000000   000000 000000   000000 000000        ............
  12    1150   000000 000000   ****** ******                                    ........

PRINT_LDEV
 Sect OctLoc
  12    1152   000005 777640   001170 006000   000000 177640   000000 006014    .....x..........
  12    1156   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12    1166*  000000 177640   000000 006014   101114 114040   000000 040040    ........ALL ..
  12    1172   000000 000000   000000 200111   040040 040040   000040 040000    .......I    .  .

FPT_PRECORD
 Sect OctLoc
  12    1176   000003 777640   001204 006000   000000 177640   000000 006014    ................
  12    1202   000000 177640   000000 006014   000000 000000   777777 777777    ................
  12    1206   000000 000000   0***** ******                                    ........

E_GREETING_FMT
 Sect OctLoc
  12    1210   261517 017530                                                    ....

E_FOLDER_HEADER1_FMT
 Sect OctLoc
  12    1211   261517 017540                                                    ....

E_FOLDER_HEADER2_FMT
 Sect OctLoc
  12    1212   261517 017550                                                    ....
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:968  

E_FOLDER_DELETED_FMT
 Sect OctLoc
  12    1213   261517 017560                                                    ....

E_FOLDER_DISPLAYED_FMT
 Sect OctLoc
  12    1214   261517 017570                                                    ....

E_COUNT_FMT
 Sect OctLoc
  12    1215   261517 017600                                                    ....

E_NO_MESSAGE_FMT
 Sect OctLoc
  12    1216   261517 017610                                                    ....

E_TIME_FMT
 Sect OctLoc
  12    1217   261517 017620                                                    ....

E_EMPTY_FOLDER_FMT
 Sect OctLoc
  12    1220   261517 017630                                                    ....

E_NO_NEW_MESSAGE_FMT
 Sect OctLoc
  12    1221   261517 017640                                                    ....

E_CREATE_MSG_FMT
 Sect OctLoc
  12    1222   261517 017650                                                    ....

E_USING_MSG_FMT
 Sect OctLoc
  12    1223   261517 017660                                                    ....

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:969  
E_MSGS_DELETED_FMT
 Sect OctLoc
  12    1224   261517 017670                                                    ....

E_MSGS_UNDELETED_FMT
 Sect OctLoc
  12    1225   261517 017700                                                    ....

E_MSGS_MARKED_FMT
 Sect OctLoc
  12    1226   261517 017710                                                    ....

E_MSGS_UNMARKED_FMT
 Sect OctLoc
  12    1227   261517 017720                                                    ....

E_MSGS_COPIED_FMT
 Sect OctLoc
  12    1230   261517 017730                                                    ....

E_MSGS_DISPLAYED_FMT
 Sect OctLoc
  12    1231   261517 017740                                                    ....

E_MSGS_LISTED_FMT
 Sect OctLoc
  12    1232   261517 017750                                                    ....

E_LISTS_DELETED_FMT
 Sect OctLoc
  12    1233   261517 017760                                                    ....

E_LISTS_DISPLAYED_FMT
 Sect OctLoc
  12    1234   261517 017770                                                    ....

E_USERS_DELETED_FMT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:970  
 Sect OctLoc
  12    1235   261517 020000                                                    ....

E_USERS_DISPLAYED_FMT
 Sect OctLoc
  12    1236   261517 020010                                                    ....

E_STATUS_FOLDER_FMT
 Sect OctLoc
  12    1237   261517 020020                                                    ....

E_STATUS_SCONTEXT_FMT
 Sect OctLoc
  12    1240   261517 020030                                                    ....

E_STATUS_CCONTEXT_FMT
 Sect OctLoc
  12    1241   261517 020040                                                    ...

E_STATUS_POSITION_FMT
 Sect OctLoc
  12    1242   261517 020050                                                    ...(

E_STATUS_POSITION_OUTSIDE_FMT
 Sect OctLoc
  12    1243   261517 020060                                                    ...0

E_STATUS_DMSGS_FMT
 Sect OctLoc
  12    1244   261517 020070                                                    ...8

E_STATUS_NMSGS_FMT
 Sect OctLoc
  12    1245   261517 020100                                                    ...@

E_STATUS_TMSGS_FMT
 Sect OctLoc
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:971  
  12    1246   261517 020110                                                    ...H

E_STATUS_HMSGS_FMT
 Sect OctLoc
  12    1247   261517 020120                                                    ...P

E_USE_FULL_FMT
 Sect OctLoc
  12    1250   261517 020140                                                    ...`

E_USE_LOST_FMT
 Sect OctLoc
  12    1251   261517 020200                                                    ....

E_NEW_MESSAGE_FMT
 Sect OctLoc
  12    1252   261517 020150                                                    ...h

E_DETACH_OK_FMT
 Sect OctLoc
  12    1253   261517 020210                                                    ....

E_DETACH_DELETE_OK_FMT
 Sect OctLoc
  12    1254   261517 020220                                                    ....

E_END_NOUPDATE_CMD
 Sect OctLoc
  12    1255   261517 021140                                                    ...`

E_NEXT_CMD
 Sect OctLoc
  12    1256   261517 021150                                                    ...h

E_DI_NEXT_CMD
 Sect OctLoc
  12    1257   261517 021160                                                    ...p
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:972  

E_LIST_NEXT_CMD
 Sect OctLoc
  12    1260   261517 021170                                                    ...x

E_PREVIOUS_CMD
 Sect OctLoc
  12    1261   261517 021200                                                    ....

E_DI_PREVIOUS_CMD
 Sect OctLoc
  12    1262   261517 021210                                                    ....

E_LIST_PREVIOUS_CMD
 Sect OctLoc
  12    1263   261517 021220                                                    ....

E_DI_FIRST_CMD
 Sect OctLoc
  12    1264   261517 021230                                                    ....

E_LIST_FIRST_CMD
 Sect OctLoc
  12    1265   261517 021240                                                    ....

E_DI_THIS_CMD
 Sect OctLoc
  12    1266   261517 021250                                                    ....

E_LIST_THIS_CMD
 Sect OctLoc
  12    1267   261517 021260                                                    ....

E_DI_LAST_CMD
 Sect OctLoc
  12    1270   261517 021270                                                    ....

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:973  
E_LIST_LAST_CMD
 Sect OctLoc
  12    1271   261517 021410                                                    ....

E_DI_REST_CMD
 Sect OctLoc
  12    1272   261517 021310                                                    ....

E_LIST_REST_CMD
 Sect OctLoc
  12    1273   261517 021320                                                    ....

E_END_CMD
 Sect OctLoc
  12    1274   261517 021330                                                    ....

E_SEND_ANSWER
 Sect OctLoc
  12    1275   261517 021340                                                    ....

E_SEND_ACKNOWLEDGE
 Sect OctLoc
  12    1276   261517 021350                                                    ....

E_SEND_FORWARD
 Sect OctLoc
  12    1277   261517 021360                                                    ....

E_SEND_FORWARD_ENCL
 Sect OctLoc
  12    1300   261517 021460                                                    ....

E_SEND_MAIL
 Sect OctLoc
  12    1301   261517 021400                                                    ....

E_SEND_NAME
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:974  
 Sect OctLoc
  12    1302   261517 021370                                                    ....

E_RESEND_NAME
 Sect OctLoc
  12    1303   261517 021440                                                    ....

E_MAIL_SETUP
 Sect OctLoc
  12    1304   261517 021430                                                    ....

E_LISTEXISTS
 Sect OctLoc
  12    1305   261517 001450                                                    ....

E_USEREXISTS
 Sect OctLoc
  12    1306   261517 001460                                                    ....

E_NOTMCENTRAL
 Sect OctLoc
  12    1307   261517 010120                                                    ...P

E_FOLDERBUSY
 Sect OctLoc
  12    1310   261517 010050                                                    ...(

E_FOLDEROLD
 Sect OctLoc
  12    1311   261517 010060                                                    ...0

E_NAMENTALLOWED
 Sect OctLoc
  12    1312   261517 010070                                                    ...8

E_CRFERR
 Sect OctLoc
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:975  
  12    1313   261517 010100                                                    ...@

E_DELFERR
 Sect OctLoc
  12    1314   261517 010110                                                    ...H

E_NOTALLOW
 Sect OctLoc
  12    1315   261517 011300                                                    ....

E_UNDEFENTRY
 Sect OctLoc
  12    1316   261517 001510                                                    ....

E_NMENTRYEXISTS
 Sect OctLoc
  12    1317   261517 001520                                                    ....

E_BLANKUSER
 Sect OctLoc
  12    1320   261517 001530                                                    ....

E_CANTDELCUR
 Sect OctLoc
  12    1321   261517 001540                                                    ....

E_CANTDELF
 Sect OctLoc
  12    1322   261517 001550                                                    ....

E_TOOMANYSRCH
 Sect OctLoc
  12    1323   261517 001560                                                    ....

E_NOCURFOLD
 Sect OctLoc
  12    1324   261517 001600                                                    ....
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:976  

E_INPROG
 Sect OctLoc
  12    1325   261517 001610                                                    ....

E_CANTREN
 Sect OctLoc
  12    1326   261517 001630                                                    ....

E_COMPACT
 Sect OctLoc
  12    1327   261517 001640                                                    ....

E_RENFAILED
 Sect OctLoc
  12    1330   261517 001650                                                    ....

E_CANTCOMPACT
 Sect OctLoc
  12    1331   261517 001660                                                    ....

E_NOLIST
 Sect OctLoc
  12    1332   261517 001710                                                    ....

E_BADDOMAIN
 Sect OctLoc
  12    1333   261517 001730                                                    ....

E_ANSBROAD
 Sect OctLoc
  12    1334   261517 001740                                                    ....

E_MEMERR
 Sect OctLoc
  12    1335   261517 000020                                                    ....

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:977  
E_NEEDMID
 Sect OctLoc
  12    1336   261517 000130                                                    ...X

E_NOMORE
 Sect OctLoc
  12    1337   261517 011330                                                    ....

E_NOUPDATE
 Sect OctLoc
  12    1340   261517 000300                                                    ....

E_WERR
 Sect OctLoc
  12    1341   261517 000040                                                    ...

E_NOFILE
 Sect OctLoc
  12    1342   061516 401610                                                    1...

E_BADRANGE
 Sect OctLoc
  12    1343   261517 001750                                                    ....

E_BIGNUM
 Sect OctLoc
  12    1344   261517 001760                                                    ....

E_NEEDSEED
 Sect OctLoc
  12    1345   261517 001770                                                    ....

E_DI_BADSEED
 Sect OctLoc
  12    1346   261517 002000                                                    ....

E_FWD_BADSEED
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:978  
 Sect OctLoc
  12    1347   261517 002010                                                    ....

E_NOENCLS
 Sect OctLoc
  12    1350   261517 003110                                                    ...H

E_DETALLOWSONE
 Sect OctLoc
  12    1351   261517 003120                                                    ...P

E_ENCLNOTFOUND
 Sect OctLoc
  12    1352   261517 003130                                                    ...X

E_ENCLDELETED
 Sect OctLoc
  12    1353   261517 003140                                                    ...`

E_ENCLBROKEN
 Sect OctLoc
  12    1354   261517 003150                                                    ...h

VM_PROKEY
 Sect OctLoc
  12    1355   001001 ******                                                    ....

(unnamed)
 Sect OctLoc
  12    1356   052111 101115   115101 111114   103105 116124   122101 114040    *IAMMAILCENTRAL
  12    1362   056056 056040   072115 101111   114137 040040   104111 040106    ... :MAIL_  DI F
  12    1366   111122 123124   104111 040124   110111 123040   072116 117104    IRSTDI THIS :NOD
  12    1372   105123 040040   040052 102117   104131 040040   000000 000010    ES   *BODY  ....
  12    1376   100103 120066   076040 040040                                    @CP6>

(unnamed)
 Sect OctLoc
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:979  
  20     000   000002 000000   000000 002000   000000 006000   000001 006000    ................
  20     004   000000 006000   000001 006000   000000 006000   000001 006000    ................
  20     014*  000000 004000   000000 006000   000014 006000   777777 600000    ................
  20     020   000000 000000   000003 000000   000000 006014   000016 006000    ................
  20     024   000001 000000   000000 006000   000004 000000   000036 006000    ................
  20     030   000072 006000   000045 006000   000000 006000   000000 006000    .:...%..........
  20     034   004427 006000   040040 040040   000000 006000   000000 006000    ....    ........
  20     040   577777 777777   000005 000000   001570 006000   000067 006000    .............7..
  20     044   001134 006000   000000 006000   000007 000000   400000 000000    .\..............
  20     050   000047 006000   000174 006000   001243 006000   000000 006000    .'...|..........
  20     054   767777 777777   677777 777777   000535 006000   000000 000000    ................
  20     060   000406 006000   000422 006000   000000 006000   001210 006000    ................
  20     064   003115 006000   002744 006000   000020 006000   000000 000001    .M..............
  20     070   000067 006000   000543 006000   000551 200000   001252 006000    .7..............
  20     074   000000 006003   001274 006000   004676 006000   001255 006000    ................
  20     100   004602 006000   002204 006000   000401 006000   000072 006000    .............:..
  20     104   001216 006000   000000 000000   003313 006000   000047 006000    .............'..
  20     110   000000 000002   000110 006000   001275 006000   004702 006000    .....H..........
  20     114   001334 006000   000000 000000   000072 006000   004427 006000    .........:......
  20     120   000072 006000   000000 006000   001256 006000   004606 006000    .:..............
  20     124   001261 006000   004622 006000   000000 000003   000126 006000    .............V..
  20     130   000006 000000   001315 006000   001461 006000   000000 006000    ................
  20     134   000000 006000   000072 006000   000000 006000   757777 777777    .....:..........
  20     140   777377 777777   775777 777777   000000 006000   000000 006000    ................
  20     144   001230 006000   000000 000000   003610 006000   000047 006000    .............'..
  20     150   001224 006000   000000 000000   003464 006000   000047 006000    .............'..
  20     154   000375 006000   002204 006000   000000 006000   001311 006000    ................
  20     160   000000 006000   000000 000004   000161 006000   001215 006000    .........q......
  20     164   003266 006000   000047 006000   001312 006000   000000 000000    .....'..........
  20     170   000067 006000   000126 006000   000177 777640   000174 006000    .7...V.......|..
  20     174   000000 006000   000172 006000   001222 006000   001304 006000    .....z..........
  20     200   005073 006000   001313 006000   000554 006000   000000 006000    .;..............
  20     204   000000 006000   001305 006000   000722 006000   000000 006000    ................
  20     210   000000 006000   001306 006000   040040 040040   040040 040040    ........
  20     214   001320 006000   000004 200000   000005 177640   002402 006000    ................
  20     220   000216 006000   001317 006000   000020 006000   002402 206000    ................
  20     224   001321 006000   077040 040040   000007 777640   002205 006000    ....?   ........
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:980  
  20     230   000000 177640   000000 006014   001322 006000   001213 006000    ................
  20     234   003214 006000   000020 006000   000554 406000   001634 006000    ................
  20     240   001332 006000   001233 006000   003707 006000   000020 006000    ................
  20     244   000722 406000   001235 006000   003761 006000   000020 006000    ................
  20     250   000000 000012   000250 006000   001324 006000   001350 006000    ................
  20     254   001351 006000   000000 000144   000255 006000   000000 006000    .......d........
  20     260   000000 006000   000072 006000   001353 006000   001352 006000    .....:..........
  20     264   002636 006000   000075 006000   000011 000000   000000 006000    .....=..........
  20     270   001354 006000   001254 006000   004555 006000   000047 006000    .............'..
  20     274   001253 006000   000000 000000   004530 006000   000047 006000    .............'..
  20     300   000554 006000   000402 006000   000040 040040   001234 006000    .........   ....
  20     304   003734 006000   000020 006000   001710 006000   000000 000016    ................
  20     310   000307 006000   001345 006000   000072 006000   000402 006000    .........:......
  20     314   001346 006000   001231 006000   003635 006000   000174 206000    .............|..
  20     320   001237 006000   004033 006000   003040 006000   004033 206000    ......... ......
  20     324   001241 006000   004105 006000   003040 006000   004105 206000    .....E... ...E..
  20     330   001240 006000   004060 006000   003040 006000   004060 206000    .....0... ...0..
  20     334   777777 777777   001243 006000   004157 006000   003040 006000    .........o... ..
  20     340   004157 206000   001242 006000   004132 006000   003040 006000    .o.......Z... ..
  20     344   004132 206000   001244 006000   004204 006000   003040 006000    .Z........... ..
  20     350   004204 206000   001245 006000   004231 006000   003040 006000    ............. ..
  20     354   004231 206000   001246 006000   004256 006000   003040 006000    ............. ..
  20     360   004256 206000   001247 006000   004303 006000   003040 006000    ............. ..
  20     364   004303 206000   000722 006000   000000 006000   000000 006000    ................
  20     370   000722 006000   000402 006000   001236 006000   000000 000000    ................
  20     374   004006 006000   000020 006000   001341 006000   002204 006000    ................
  20     400   000000 006000   001264 006000   004636 006000   001265 006000    ................
  20     404   004642 006000   000000 000024   000405 006000   001277 006000    ................
  20     410   004754 006000   000000 000000   000072 006000   000000 006000    .........:......
  20     414   001347 006000   000000 000006   000415 006000   001300 006000    ................
  20     420   005001 006000   001266 006000   004646 006000   001267 006000    ................
  20     424   004652 006000   777577 777777   002002 006000   001337 006000    ................
  20     430   001270 006000   004656 006000   001271 006000   004662 006000    ................
  20     434   000100 177640   000073 006000   001211 006000   003142 006000    .@...;.......b..
  20     440   003040 006000   003142 206000   000000 777640   000376 006000    . ...b..........
  20     444   000001 777640   002215 006000   001212 006000   003167 006000    .............w..
  20     450   003040 006000   003167 206000   001461 006000   000402 006000    . ...w..........
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:981  
  20     454   001214 006000   000000 000000   003241 006000   000020 006000    ................
  20     460   000000 000027   000460 006000   001232 006000   000000 000000    ................
  20     464   003662 006000   000047 006000   000000 000030   000466 006000    .....'..........
  20     470   000000 006000   001226 006000   003536 006000   001316 006000    ................
  20     474   000076 006000   000407 006000   000407 206000   000554 006000    .>..............
  20     500   000000 006000   000077 006000   000413 006000   000413 206000    .....?..........
  20     504   000722 006000   000000 006000   001257 006000   004612 006000    ................
  20     510   001260 006000   004616 006000   001262 006000   004626 006000    ................
  20     514   001263 006000   004632 006000   377777 777777   737777 777777    ................
  20     520   777777 777767   777777 777775   777777 777776   777777 777773    ................
  20     524   777777 777377   777777 777577   777777 777757   777777 777737    ................
  20     530   001652 006000   777777 777677   001323 006000   000000 000000    ................
  20     534   000001 777640   002217 006000   000003 777640   002222 006000    ................
  20     540   000001 777640   002226 006000   777777 677777   000545 006000    ................
  20     544   000000 000065   000544 006000   001303 006000   005063 006000    ...5.........3..
  20     550   000000 006000   000020 006000   001272 006000   004666 006000    ................
  20     554   001273 006000   004672 006000   000575 360377   000000 000046    ...............&
  20     560   000557 006000   001217 006000   003340 006000   002744 006000    ................
  20     564   003340 206000   000000 000052   000565 006000   001225 006000    .......*........
  20     570   003511 006000   000000 000053   000571 006000   777677 777777    .......+........
  20     574   001227 006000   003563 006000   000000 006000   000110 006000    .............H..
  20     600   000110 006000   000067 006000   001223 006000   001310 006000    .H...7..........
  20     604   001340 006000   001250 006000   004330 006000   002744 006000    ................
  20     610   004330 206000   001251 006000   004355 006000   002744 006000    ................
  20     614   004355 206000   001662 006000   001336 006000   001307 006000    ................
  20     620   000006 177640   000760 400000   001216 006000   003313 006000    ................
  20     624   002744 006000   003313 206000   005174 006000   005175 006000    .........|...}..
  20     630   005174 006000   005176 006000   001343 006000   000000 000000    .|...~..........
  20     634   001652 006000   005173 006000   001344 006000   001335 006000    .....{..........
  20     640   005204 006000   001650 006000   005204 006000   005203 006000    ................
  20     644   001651 006000   001325 006000   000160 777640   005224 006000    .........p......
  20     650   000000 006000   001326 006000   005224 006000   005225 006000    ................
  20     654   000000 006000   000000 006000   001327 006000   000000 000000    ................
  20     660   000007 777640   005454 006000   000001 777640   001244 406000    ................
  20     664   000001 777640   001254 606000   000377 777640   777777 577777    ................
  20     670   001330 006000   001331 006000   000077 577640   005354 006000    .........?......
  20     674   001333 006000   045040 040040   056040 040040   001276 006000    ....%   .   ....
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:982  
  20     700   004727 006000   001301 006000   005026 006000   051040 040040    ............)
  20     704   000073 206000   047040 040040   001302 006000   005053 006000    .;..'   .....+..
  20     710   000007 777640   005053 006000   000001 777640   002434 006000    .....+..........
     6808    34338        %EOD;

PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:983  
--  Include file information  --

   B$TABLES_C.:LIB_E05  cannot be made into a system file and is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   XUW_MACRO_C.:LIB_E05  is referenced.
   XUR_ENTRY.:LIB_E05  cannot be made into a system file and is referenced.
   XUM_MACRO_C.:LIB_E05  is referenced.
   XUH_MACRO_C.:LIB_E05  is referenced.
   XU_PERR_C.:LIB_E05  is referenced.
   XUE_MACRO_C.:LIB_E05  is referenced.
   XU_FORMAT_C.:LIB_E05  is referenced.
   XU_MACRO_C.:LIB_E05  is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   B_SEGIDS_C.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
      No diagnostics issued in procedure VMO$MAIL.
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:984  

 **** Variables and constants ****

  ****  Section 011  Data  VMO$MAIL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   540-0-0/c CHAR(6)     r     1 ANSI_DATE                536-0-0/c CHAR(8)     r     1 ANSI_TIME
  5470-0-0/d STRC(360)   r     1 BOF                      400-0-0/w UBIN        r     1 BREAK_TYPE
  2244-0-0/d STRC(864)   r     1 CHECK_FID               2110-0-0/d STRC(1080)  r     1 CLOSE_SAVE
  2146-0-0/d STRC(1080)  r     1 CLOSE_SCRATCH
  1663-0-0/w PTR         r     1 CONTEXT_PTR$(0:3)
    72-0-0/w SBIN        r     1 CURRENT_MESSAGE_NUMBER
   543-0-0/w UBIN        r     1 CURR_COMMAND_CODE        401-0-0/w UBIN        r     1 DCB#
  1724-0-0/d STRC(288)   r     1 DEQ_PROFILE             1712-0-0/d STRC(360)   r     1 ENQ_PROFILE
  2204-0-0/w STRC        r     1 ERROR                    417-0-0/b BIT         r     1 EXIT_MAIL#
   420-0-0/b BIT         r     1 EXIT_MAIL_PEND#         2215-0-0/c STRC(72)    r     1 FID_ACCT
  2230-0-0/w UBIN(9)     r     1 FID_ASN                 2205-0-0/c STRC(288)   r     1 FID_NAME
  5454-0-0/c STRC(288)   r     1 FID_NAME                2217-0-0/c STRC(72)    r     1 FID_PASS
  2231-0-0/c CHAR(4)     r     1 FID_RES                 2232-0-0/d STRC(324)   r     1 FID_RESULTS
  2222-0-0/d STRC(90)    r     1 FID_SN                  2226-0-0/c STRC(72)    r     1 FID_WSN
   404-0-0/b BIT         r     1 FOLDER_WAS_OPEN         2410-0-0/d STRC(144)   r     1 FPT_CORRES
  2076-0-0/d STRC(144)   r     1 FPT_INT                 2414-0-0/d STRC(576)   r     1 FPT_LINK
  3040-0-0/w STRC(1080)  r     1 F_FDSLO                 2744-0-0/w STRC(1080)  r     1 F_FDSME
  2530-0-0/d STRC(432)   r     1 GET_TIME                2002-0-0/d STRC(2052)  r     1 HELP_PARAM
  5505-0-0/w SBIN        r     1 HIGH                    5465-0-0/w UBIN        r     1 HMAX
  5503-0-0/w UBIN        r     1 HMAX                    5464-0-0/w PTR         r     1 HOLE$
  5502-0-0/w PTR         r     1 HOLE$                   5202-0-0/w SBIN              1 INDX
  5224-0-0/w UBIN        r     1 INDX                    5177-0-0/w SBIN        r     1 INDX1
   375-0-0/w SBIN        r     1 INDX2                   5200-0-0/w SBIN        r     1 INDX2
  5507-0-0/w SBIN        r     1 LAST                     544-0-0/w UBIN        r     1 LAST_COMMAND_CODE
    73-0-0/c STRC(2313)  r     1 LINK_CCBUF              5506-0-0/w SBIN        r     1 LOW
   545-0-0/w UBIN        r     1 M$CMNDF_NUM             2074-0-0/c STRC(45)    r     1 MAIL_PROG_NAME
   406-0-0/c CHAR        r     1 MAIL_PROMPT(0:2)
  5510-0-0/w SBIN        r     1 MID                     2402-0-0/c STRC(189)   r     1 NAME_KEY
   377-0-0/b BIT         r     1 NEW_FLAG                5466-0-0/w UBIN        r     1 NEW_NUM
  5504-0-0/w UBIN        r     1 NEW_NUM                  542-0-0/b BIT         r     1 NEXT_COMMAND_ECHO#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:985  
  5225-0-0/w UBIN        r     1 NEXT_NUM                2544-0-0/d STRC(2088)  r     1 OPEN_COMMAND_STREAM
  2636-0-0/d STRC(2088)  r     1 OPEN_ENCL               2274-0-0/d STRC(2088)  r     1 OPEN_NEXT
  1670-0-0/c CHAR(64)    r     1 OPT_FID                 1710-0-0/w UBIN        r     1 OPT_SEED
   422-0-0/c CHAR(300)   r     1 OUTBUF                   402-0-0/w UBIN        r     1 OUTDCB
   374-0-0/w SBIN        r     1 PAGESIZE                 421-0-0/b BIT         r     1 PRINT_HEADER#
  5173-0-0/w PTR         r     1 PTR1$                   5174-0-0/w PTR         r     1 PTR2$
     0-0-0/w STRC(504)   r     1 P_PCB                   5322-0-0/d STRC(504)   r     1 READ_OLD
  5206-0-0/d STRC(504)   r     1 READ_PROFILE            5226-0-0/w UBIN        r     1 RECS_DELETED
  5230-0-0/d STRC(2088)  r     1 RENUM_OPEN               405-0-0/b BIT         r     1 REOPENED_FOLDER
  2436-0-0/d STRC(2088)  r     1 REOPEN_FILE             1742-0-0/d STRC(288)   r     1 RESET_#1
  1752-0-0/d STRC(288)   r     1 RESET_#2                1762-0-0/d STRC(288)   r     1 RESET_#3
  1772-0-0/d STRC(288)   r     1 RESET_#4                5204-0-0/w PTR         r     1 RESULT$
   403-0-0/b BIT         r     1 SELECT_CURRENT          2102-0-0/d STRC(216)   r     1 SET_XCON
   535-0-0/w UBIN        r     1 SIZE                    3002-0-0/w STRC(1080)        1 SPACE_LO
  5201-0-0/w SBIN        r     1 START_BLK               2434-0-0/c STRC(72)    r     1 SYSACCT
  4427-0-0/c STRC(2313)  r     1 USER_NAME               5203-0-0/w SBIN        r     1 VALUE
  5175-0-0/w SBIN        r     1 VALUE1                  5176-0-0/w SBIN        r     1 VALUE2
  3076-0-0/d BIT (72)    r     1 VECT_ARRAY(0:6)
  5354-0-0/c STRC(2295)  r     1 VLP_KEY                   70-0-0/d REMB        r     1 VMO_REMEMBER
    66-0-0/w PTR         r     1 VM_ADDRESS_SPEC$        3114-0-0/c CHAR(3)     r     1 VM_BLANK_LINE_FMT
   552-0-0/c STRC(72)          1 VM_BODYKEY              1134-0-0/w STRC(2529)  r     1 VM_CENTRAL_FOLDER
  1070-0-0/c STRC(1296)        1 VM_CGBUFFER             3266-0-0/c STRC(729)   r     1 VM_COUNT_FMT
  3437-0-0/c STRC(729)         1 VM_CREATE_MSG_FMT       1243-0-0/w STRC(2529)  r     1 VM_CURRENT_FOLDER
  1352-0-0/w STRC(2529)  r     1 VM_CURRENT_FOLDER_SAVE
  4555-0-0/c STRC(729)   r     1 VM_DETACH_DELETE_OK_FMT
  4530-0-0/c STRC(729)   r     1 VM_DETACH_OK_FMT        4636-0-0/c STRC(144)   r     1 VM_DI_FIRST_CMD
  4656-0-0/c STRC(144)   r     1 VM_DI_LAST_CMD          4612-0-0/c STRC(144)   r     1 VM_DI_NEXT_CMD
  4626-0-0/c STRC(144)   r     1 VM_DI_PREVIOUS_CMD      4666-0-0/c STRC(144)   r     1 VM_DI_REST_CMD
  4646-0-0/c STRC(144)   r     1 VM_DI_THIS_CMD          3365-0-0/c STRC(729)         1 VM_EMPTY_FOLDER_FMT
  4676-0-0/c STRC(144)   r     1 VM_END_CMD              4602-0-0/c STRC(144)   r     1 VM_END_NOUPDATE_CMD
  1736-0-0/c STRC(45)    r     1 VM_FILERES
  3214-0-0/c STRC(729)   r     1 VM_FOLDER_DELETED_FMT
  3241-0-0/c STRC(729)   r     1 VM_FOLDER_DISPLAYED_FMT
  3142-0-0/c STRC(729)   r     1 VM_FOLDER_HEADER1_FMT
  3167-0-0/c STRC(729)   r     1 VM_FOLDER_HEADER2_FMT
  3115-0-0/c STRC(729)   r     1 VM_GREETING_FMT          546-0-0/c STRC(54)          1 VM_HEADKEY
  1740-0-0/c STRC(45)    r     1 VM_HEADRES               550-0-0/c STRC(54)          1 VM_INFOKEY
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:986  
   554-0-0/c STRC(1818)  r     1 VM_LISTKEY               637-0-0/c STRC(1818)  r     1 VM_LISTKEY2
  3707-0-0/c STRC(729)   r     1 VM_LISTS_DELETED_FMT
  3734-0-0/c STRC(729)   r     1 VM_LISTS_DISPLAYED_FMT
  4642-0-0/c STRC(144)   r     1 VM_LIST_FIRST_CMD       4662-0-0/c STRC(144)   r     1 VM_LIST_LAST_CMD
  4616-0-0/c STRC(144)   r     1 VM_LIST_NEXT_CMD        4632-0-0/c STRC(144)   r     1 VM_LIST_PREVIOUS_CMD
  4672-0-0/c STRC(144)   r     1 VM_LIST_REST_CMD        4652-0-0/c STRC(144)   r     1 VM_LIST_THIS_CMD
  5073-0-0/c STRC(2304)  r     1 VM_MAIL_SETUP
   407-0-0/c STRC(144)   r     1 VM_MODIFY_LIST_PROMPT
   413-0-0/c STRC(144)   r     1 VM_MODIFY_USER_PROMPT
  3610-0-0/c STRC(729)   r     1 VM_MSGS_COPIED_FMT      3464-0-0/c STRC(729)   r     1 VM_MSGS_DELETED_FMT
  3635-0-0/c STRC(729)   r     1 VM_MSGS_DISPLAYED_FMT
  3662-0-0/c STRC(729)   r     1 VM_MSGS_LISTED_FMT      3536-0-0/c STRC(729)   r     1 VM_MSGS_MARKED_FMT
  3511-0-0/c STRC(729)   r     1 VM_MSGS_UNDELETED_FMT
  3563-0-0/c STRC(729)   r     1 VM_MSGS_UNMARKED_FMT    4402-0-0/c STRC(729)         1 VM_NEW_MESSAGE_FMT
  4606-0-0/c STRC(144)   r     1 VM_NEXT_CMD             3313-0-0/c STRC(729)   r     1 VM_NO_MESSAGE_FMT
  3412-0-0/c STRC(729)         1 VM_NO_NEW_MESSAGE_FMT
  4622-0-0/c STRC(144)   r     1 VM_PREVIOUS_CMD         1734-0-0/c STRC(72)    r     1 VM_PRORES
  5063-0-0/c STRC(288)   r     1 VM_RESEND_NAME          1570-0-0/w STRC(1260)  r     1 VM_SEARCH_INFO
  1650-0-0/w STRC(72)    r     1 VM_SELECT               4727-0-0/c STRC(729)   r     1 VM_SEND_ACKNOWLEDGE
  4702-0-0/c STRC(729)   r     1 VM_SEND_ANSWER          4754-0-0/c STRC(729)   r     1 VM_SEND_FORWARD
  5001-0-0/c STRC(729)   r     1 VM_SEND_FORWARD_ENCL    5026-0-0/c STRC(729)   r     1 VM_SEND_MAIL
  5053-0-0/c STRC(288)   r     1 VM_SEND_NAME
  4105-0-0/c STRC(729)   r     1 VM_STATUS_CCONTEXT_FMT
  4204-0-0/c STRC(729)   r     1 VM_STATUS_DMSGS_FMT     4033-0-0/c STRC(729)   r     1 VM_STATUS_FOLDER_FMT
  4303-0-0/c STRC(729)   r     1 VM_STATUS_HMSGS_FMT     4231-0-0/c STRC(729)   r     1 VM_STATUS_NMSGS_FMT
  4132-0-0/c STRC(729)   r     1 VM_STATUS_POSITION_FMT
  4157-0-0/c STRC(729)   r     1 VM_STATUS_POSITION_OUTSIDE_FMT
  4060-0-0/c STRC(729)   r     1 VM_STATUS_SCONTEXT_FMT
  4256-0-0/c STRC(729)   r     1 VM_STATUS_TMSGS_FMT     3340-0-0/c STRC(729)   r     1 VM_TIME_FMT
   722-0-0/c STRC(1818)  r     1 VM_USERKEY              1005-0-0/c STRC(1818)  r     1 VM_USERKEY2
  3761-0-0/c STRC(729)   r     1 VM_USERS_DELETED_FMT
  4006-0-0/c STRC(729)   r     1 VM_USERS_DISPLAYED_FMT
  4330-0-0/c STRC(729)   r     1 VM_USE_FULL_FMT         4355-0-0/c STRC(729)   r     1 VM_USE_LOST_FMT
  1634-0-0/d STRC(432)   r     1 VM_WILDCARD             1461-0-0/w STRC(2529)  r     1 VM_WORK_FOLDER
  1667-0-0/w UBIN        r     1 WHICH_CONTEXT            174-0-0/c STRC(4608)  r     1 WORK_STRING
   376-0-0/w UBIN        r     1 WORK_UTS                2730-0-0/d STRC(432)   r     1 WRITE_ENCL
  2366-0-0/d STRC(432)   r     1 WRITE_NAME_MAP          5340-0-0/d STRC(432)   r     1 WRITE_NEW
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:987  
  1652-0-0/w STRC(324)   r     1 X$MCB                     16-0-0/d STRC(1404)  r     1 XUR_INIT

  ****  Section 012 RoData VMO$MAIL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   100-0-0/w STRC(4068)  r     1 CVM_PROFILE              460-0-0/d STRC(360)   r     1 DELREC_NAME_MAP
   342-0-0/d STRC(288)   r     1 DEQ_HEAD                 330-0-0/d STRC(360)   r     1 ENQ_HEAD
  1334-0-0/w STRC        r     1 E_ANSBROAD              1333-0-0/w STRC        r     1 E_BADDOMAIN
  1343-0-0/w STRC        r     1 E_BADRANGE              1344-0-0/w STRC        r     1 E_BIGNUM
  1320-0-0/w STRC        r     1 E_BLANKUSER             1331-0-0/w STRC        r     1 E_CANTCOMPACT
  1321-0-0/w STRC        r     1 E_CANTDELCUR            1322-0-0/w STRC        r     1 E_CANTDELF
  1326-0-0/w STRC        r     1 E_CANTREN               1327-0-0/w STRC        r     1 E_COMPACT
  1215-0-0/w STRC        r     1 E_COUNT_FMT             1222-0-0/w STRC        r     1 E_CREATE_MSG_FMT
  1313-0-0/w STRC        r     1 E_CRFERR                1314-0-0/w STRC              1 E_DELFERR
  1254-0-0/w STRC        r     1 E_DETACH_DELETE_OK_FMT
  1253-0-0/w STRC        r     1 E_DETACH_OK_FMT         1351-0-0/w STRC        r     1 E_DETALLOWSONE
  1346-0-0/w STRC        r     1 E_DI_BADSEED            1264-0-0/w STRC        r     1 E_DI_FIRST_CMD
  1270-0-0/w STRC        r     1 E_DI_LAST_CMD           1257-0-0/w STRC        r     1 E_DI_NEXT_CMD
  1262-0-0/w STRC        r     1 E_DI_PREVIOUS_CMD       1272-0-0/w STRC        r     1 E_DI_REST_CMD
  1266-0-0/w STRC        r     1 E_DI_THIS_CMD           1220-0-0/w STRC              1 E_EMPTY_FOLDER_FMT
  1354-0-0/w STRC        r     1 E_ENCLBROKEN            1353-0-0/w STRC        r     1 E_ENCLDELETED
  1352-0-0/w STRC        r     1 E_ENCLNOTFOUND          1274-0-0/w STRC        r     1 E_END_CMD
  1255-0-0/w STRC        r     1 E_END_NOUPDATE_CMD      1310-0-0/w STRC        r     1 E_FOLDERBUSY
  1311-0-0/w STRC        r     1 E_FOLDEROLD             1213-0-0/w STRC        r     1 E_FOLDER_DELETED_FMT
  1214-0-0/w STRC        r     1 E_FOLDER_DISPLAYED_FMT
  1211-0-0/w STRC        r     1 E_FOLDER_HEADER1_FMT    1212-0-0/w STRC        r     1 E_FOLDER_HEADER2_FMT
  1347-0-0/w STRC        r     1 E_FWD_BADSEED           1210-0-0/w STRC        r     1 E_GREETING_FMT
  1325-0-0/w STRC        r     1 E_INPROG                1305-0-0/w STRC        r     1 E_LISTEXISTS
  1233-0-0/w STRC        r     1 E_LISTS_DELETED_FMT
  1234-0-0/w STRC        r     1 E_LISTS_DISPLAYED_FMT
  1265-0-0/w STRC        r     1 E_LIST_FIRST_CMD        1271-0-0/w STRC        r     1 E_LIST_LAST_CMD
  1260-0-0/w STRC        r     1 E_LIST_NEXT_CMD         1263-0-0/w STRC        r     1 E_LIST_PREVIOUS_CMD
  1273-0-0/w STRC        r     1 E_LIST_REST_CMD         1267-0-0/w STRC        r     1 E_LIST_THIS_CMD
  1304-0-0/w STRC        r     1 E_MAIL_SETUP            1335-0-0/w STRC        r     1 E_MEMERR
    76-0-0/w STRC        r     1 E_MODIFY_LIST_PROMPT      77-0-0/w STRC        r     1 E_MODIFY_USER_PROMPT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:988  
  1230-0-0/w STRC        r     1 E_MSGS_COPIED_FMT       1224-0-0/w STRC        r     1 E_MSGS_DELETED_FMT
  1231-0-0/w STRC        r     1 E_MSGS_DISPLAYED_FMT    1232-0-0/w STRC        r     1 E_MSGS_LISTED_FMT
  1226-0-0/w STRC        r     1 E_MSGS_MARKED_FMT       1225-0-0/w STRC        r     1 E_MSGS_UNDELETED_FMT
  1227-0-0/w STRC        r     1 E_MSGS_UNMARKED_FMT     1312-0-0/w STRC        r     1 E_NAMENTALLOWED
  1336-0-0/w STRC        r     1 E_NEEDMID               1345-0-0/w STRC        r     1 E_NEEDSEED
  1252-0-0/w STRC        r     1 E_NEW_MESSAGE_FMT       1256-0-0/w STRC        r     1 E_NEXT_CMD
  1317-0-0/w STRC        r     1 E_NMENTRYEXISTS         1324-0-0/w STRC        r     1 E_NOCURFOLD
  1350-0-0/w STRC        r     1 E_NOENCLS               1342-0-0/w STRC        r     1 E_NOFILE
  1332-0-0/w STRC        r     1 E_NOLIST                1337-0-0/w STRC        r     1 E_NOMORE
  1315-0-0/w STRC        r     1 E_NOTALLOW              1307-0-0/w STRC        r     1 E_NOTMCENTRAL
  1340-0-0/w STRC        r     1 E_NOUPDATE              1216-0-0/w STRC        r     1 E_NO_MESSAGE_FMT
  1221-0-0/w STRC              1 E_NO_NEW_MESSAGE_FMT    1261-0-0/w STRC        r     1 E_PREVIOUS_CMD
  1330-0-0/w STRC        r     1 E_RENFAILED             1303-0-0/w STRC        r     1 E_RESEND_NAME
  1276-0-0/w STRC        r     1 E_SEND_ACKNOWLEDGE      1275-0-0/w STRC        r     1 E_SEND_ANSWER
  1277-0-0/w STRC        r     1 E_SEND_FORWARD          1300-0-0/w STRC        r     1 E_SEND_FORWARD_ENCL
  1301-0-0/w STRC        r     1 E_SEND_MAIL             1302-0-0/w STRC        r     1 E_SEND_NAME
  1241-0-0/w STRC        r     1 E_STATUS_CCONTEXT_FMT
  1244-0-0/w STRC        r     1 E_STATUS_DMSGS_FMT      1237-0-0/w STRC        r     1 E_STATUS_FOLDER_FMT
  1247-0-0/w STRC        r     1 E_STATUS_HMSGS_FMT      1245-0-0/w STRC        r     1 E_STATUS_NMSGS_FMT
  1242-0-0/w STRC        r     1 E_STATUS_POSITION_FMT
  1243-0-0/w STRC        r     1 E_STATUS_POSITION_OUTSIDE_FMT
  1240-0-0/w STRC        r     1 E_STATUS_SCONTEXT_FMT
  1246-0-0/w STRC        r     1 E_STATUS_TMSGS_FMT      1217-0-0/w STRC        r     1 E_TIME_FMT
  1323-0-0/w STRC        r     1 E_TOOMANYSRCH           1316-0-0/w STRC        r     1 E_UNDEFENTRY
  1306-0-0/w STRC        r     1 E_USEREXISTS            1235-0-0/w STRC        r     1 E_USERS_DELETED_FMT
  1236-0-0/w STRC        r     1 E_USERS_DISPLAYED_FMT
  1250-0-0/w STRC        r     1 E_USE_FULL_FMT          1251-0-0/w STRC        r     1 E_USE_LOST_FMT
  1223-0-0/w STRC        r     1 E_USING_MSG_FMT         1341-0-0/w STRC        r     1 E_WERR
   316-0-0/d STRC(360)   r     1 FILE_NONE                304-0-0/d STRC(360)   r     1 FILE_SHARE
  1176-0-0/d STRC(360)   r     1 FPT_PRECORD              270-0-0/d STRC(432)   r     1 GET_ANSI_TIME
    75-0-0/w UBIN        r     1 M$OUT_NUM
  1060-0-0/d STRC(2088)  r     1 OPEN_COMMAND_STREAM_DEFAULT
   674-0-0/d STRC(2088)  r     1 OPEN_FORWARD_ENCL_FILE
   602-0-0/d STRC(2088)  r     1 OPEN_FORWARD_FILE        366-0-0/d STRC(2088)  r     1 OPEN_NAME_MAP
   766-0-0/d STRC(2088)  r     1 OPEN_OUTPUT_STREAM_DEFAULT
   510-0-0/d STRC(2088)  r     1 OPEN_SEND_FILE          1152-0-0/d STRC(720)   r     1 PRINT_LDEV
   472-0-0/d STRC(504)   r     1 READ_NAME_MAP            352-0-0/c CHAR(9)     r     1 RESET_#1_CMD
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:989  
   355-0-0/c CHAR(9)     r     1 RESET_#2_CMD             360-0-0/c CHAR(9)     r     1 RESET_#3_CMD
   363-0-0/c CHAR(9)     r     1 RESET_#4_CMD
     0-0-0/w PTR         r     1 VM_DEFAULT_NODES(0:29)
    36-0-0/w STRC(252)   r     1 VM_NATL_PAIRS             72-0-0/c STRC(81)    r     1 VM_NODEFID
    45-0-0/c STRC(729)   r     1 VM_NODENAMES            1355-0-0/c STRC(18)    r     1 VM_PROKEY
   262-0-0/d STRC(216)   r     1 WAIT30

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  1117-0-0/w PTR         r     1 @BLK$                   1122-0-0/w PTR         r     1 @CODE
  1120-0-0/w PTR         r     1 @COMMAND                1115-0-0/w PTR         r     1 @CURR_COMMAND_CODE
  1523-0-0/w PTR         r     1 @DCB#                   1117-0-0/w PTR         r     1 @DOMAIN$
  1117-0-0/w PTR         r     1 @EXPLICIT               1120-0-0/w PTR         r     1 @FMT
  1123-0-0/w PTR         r     1 @FOLDER_SPEC            1120-0-0/w PTR         r     1 @HEADER_FIELD#
  1121-0-0/w PTR         r     1 @NAME                   1121-0-0/w PTR         r     1 @NAME
  1541-0-0/w PTR         r     1 @OLD_MSGNUM             1117-0-0/w PTR         r     1 @RENUMBER#
  1120-0-0/w PTR         r     1 @SITENAME               1121-0-0/w PTR         r     1 @SUBSTITUTE#
  1117-0-0/w PTR         r     1 @VALUE                  1123-0-0/w PTR         r     1 @WHICH_CONTEXT
    42-0-0/c STRC(72)    r     1 ADDRESS_ACCT             253-0-0/c CHAR(25)    r     1 ADDRESS_FOLDER
    44-0-0/c STRC(72)    r     1 ADDRESS_LACCN             46-0-0/c CHAR(12)    r     1 ADDRESS_LUNAME
    51-0-0/c STRC(4608)  r     1 ADDRESS_NAME             251-0-0/c STRC(72)    r     1 ADDRESS_PASS
   262-0-0/c CHAR(8)     r     1 ADDRESS_SITENAME          24-0-0/w PTR         r     1 BLK$
    *0-0-0/w PTR         r     1 BLK$                    1123-0-0/w SBIN        r     1 CFLEN
  1524-0-0/b BIT         r     1 CHECK                     *0-0-0/w UBIN        r     1 CODE
    36-0-0/b BIT         r     1 COMBINED                  *0-0-0/w UBIN        r     1 COMMAND
   550-0-0/w SBIN        r     1 COUNT                     *0-0-0/w UBIN        r     1 CURR_COMMAND_CODE
  1524-0-0/w UBIN        r     1 CUR_NUM                 1524-0-0/w UBIN              1 CUR_NUM
    *0-0-0/w UBIN        r     1 DCB#                    1113-0-0/b BIT         r     1 DELETE_ENCL_FLAG
   264-0-0/w PTR         r     1 DOMAIN$                   *0-0-0/w PTR         r     1 DOMAIN$
   347-0-0/b BIT         r     1 EJECT                     32-0-0/w PTR         r     1 ENCL$
    *0-0-0/b BIT         r     1 EXPLICIT                1536-0-0/w PTR         r     1 FLDPTR$
    *0-0-0/c ASTR(9)     r     1 FMT                       *0-0-0/w STRC(2529)  r     1 FOLDER_SPEC
  1122-0-0/d CHAR(1024)  r     1 FPARAM_AREA               *0-0-0/h UBIN(18)    r     1 HEADER_FIELD#
  1121-0-0/w STRC(324)   r     1 HEADER_MCB              1525-0-0/w UBIN        r     1 HINDX
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:990  
  1525-0-0/w UBIN        r     1 HINDX                   1535-0-0/w UBIN        r     1 I
  1542-0-0/w UBIN        r     1 I                        350-0-0/c CHAR(511)   r     1 ID
    33-0-0/w SBIN        r     1 INDX1                   1123-0-0/w UBIN        r     1 INDX1
  1124-0-0/w UBIN        r     1 INDX2                     34-0-0/w SBIN        r     1 INDX3
    35-0-0/w SBIN        r     1 INDX4                     12-0-0/c CHAR(8)     r     1 KEY_VALUE
  1122-0-0/w SBIN        r     1 LEN                       40-0-0/b BIT         r     1 MADE_OLD
     6-0-0/w PTR         r     1 MAIL_CMD$               1527-0-0/w PTR         r     1 MAIL_FILE$
  1527-0-0/w PTR         r     1 MAIL_FILE$                 4-0-0/w PTR         r     1 MAIL_NODES$
     7-0-0/w PTR         r     1 MODIFY_LIST$              10-0-0/w PTR         r     1 MODIFY_USER$
    *0-0-0/c ASTR(9)     r     1 NAME                      *0-0-0/c ASTR(9)     r     1 NAME
  1534-0-0/w PTR         r     1 NEXT$                    551-0-0/c STRC(4608)  r     1 NEXT_COMMAND_TEXT
    11-0-0/w PTR         r     1 NODES$                    37-0-0/b BIT         r     1 NONE
  1101-0-0/w UBIN        r     1 NUM_MESSAGES_PROCESSED
    *0-0-0/w UBIN        r     1 OLD_MSGNUM              1523-0-0/w UBIN        r     1 OLD_TYPE
  1523-0-0/w UBIN        r     1 OLD_TYPE                1105-0-0/b BIT         r     1 OPT_BYPASS
  1110-0-0/b BIT               1 OPT_EXIT                1106-0-0/b BIT         r     1 OPT_NOUPDATE
  1111-0-0/b BIT               1 OPT_QUIT                1107-0-0/b BIT         r     1 OPT_RECEIVERS
  1112-0-0/w PTR         r     1 OPT_SEED$               1103-0-0/c CHAR(8)           1 OPT_SITE
    23-0-0/w PTR         r     1 OUT$                      23-0-0/w STRC        r     1 OUTERR
    25-0-0/w PTR         r     1 PTR1$                     26-0-0/w PTR         r     1 PTR2$
    27-0-0/w PTR         r     1 PTR3$                     30-0-0/w PTR         r     1 PTR4$
    30-0-0/w STRC        r     1 PTR4R$                    31-0-0/w PTR               1 PTR5$
    *0-0-0/b BIT         r     1 RENUMBER#                  5-0-0/w PTR         r     1 SEND_CMD$
  1122-0-0/w PTR         r     1 SITE$                     *0-0-0/c CHAR(8)     r     1 SITENAME
  1530-0-0/w UBIN        r     1 SIZE                    1532-0-0/w PTR         r     1 STASH$
  1531-0-0/w UBIN        r     1 STASH_LEN               1117-0-0/b BIT         r     1 STATUS_SAVE
    *0-0-0/b BIT         r     1 SUBSTITUTE#             1102-0-0/w SBIN        r     1 TEMP
  1533-0-0/w PTR         r     1 TEMP$                    265-0-0/c CHAR(200)   r     1 TEMPBUF
    *0-0-0/w SBIN        r     1 VALUE                   1525-0-0/w STRC(4068)  r     1 VM_PROSTUB
   751-0-0/w STRC(711)   r     1 VM_RADDRESS              775-0-0/w STRC(2448)  r     1 VM_UADDRESS
    *0-0-0/w UBIN        r     1 WHICH_CONTEXT             41-0-0/b BIT         r     1 WILD
    14-0-0/c CHAR(25)    r     1 WILDCARD_PATTERN        1526-0-0/b BIT         r     1 WRITEIT
  1526-0-0/b BIT               1 WRITEIT                    3-0-0/w PTR         r     1 XUG_GETCMD$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:991  
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 ADDRESS_SPEC               0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/w PTR         r     1 B$XL_UPPER$
     0-0-0/c CHAR        r     1 B_VERSION                  0-0-0/c ASTR(9)     r     1 ERRMSG_FID
     0-0-0/w UBIN              1 M$DO_NUM                   0-0-0/w UBIN        r     1 M$LO_NUM
     0-0-0/w UBIN        r     1 M$MAIL_CENTRAL_NUM         0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM
     0-0-0/w UBIN        r     1 M$MAIL_FILE_NUM            0-0-0/w UBIN        r     1 M$MAIL_GLOBAL_NUM
     0-0-0/w UBIN        r     1 M$ME_NUM                   0-0-0/w UBIN              1 M$NODE_NUM
     0-0-0/w UBIN        r     1 M$SI_NUM                   0-0-0/w UBIN        r     1 M$WORK_NUM
     0-0-0/w PTR         r     1 MAIL_CMD                   0-0-0/w PTR         r     1 MAIL_NODES
     0-0-0/w PTR         r     1 MODIFY_LIST                0-0-0/w PTR         r     1 MODIFY_USER
     0-0-0/b BIT         r     1 NEED_TITLE_BAR             0-0-0/w PTR         r     1 SEND_CMD
     0-0-0/w PTR         r     1 VM_ADDLIST$                0-0-0/d VECT        r     1 VM_ADDLIST_
     0-0-0/w PTR               1 VM_ADDREC$                 0-0-0/d VECT              1 VM_ADDREC_
     0-0-0/w PTR               1 VM_COPY$                   0-0-0/d VECT              1 VM_COPY_
     0-0-0/w PTR         r     1 VM_ENCLLIST$               0-0-0/d VECT        r     1 VM_ENCLLIST_
     0-0-0/w PTR         r     1 VM_ENCLREC$                0-0-0/d VECT        r     1 VM_ENCLREC_
     0-0-0/c STRC(270)   r     1 VM_FORWARD_ENCL_NAME       0-0-0/c STRC(270)   r     1 VM_FORWARD_FILE_NAME
     0-0-0/c STRC(72)    r     1 VM_FORWARD_FILE_PASS       0-0-0/w PTR         r     1 VM_HEADER$
     0-0-0/d VECT        r     1 VM_HEADER_                 0-0-0/d VECT              1 VM_HEADER_INIT_
     0-0-0/w PTR               1 VM_INPUT$                  0-0-0/d VECT              1 VM_INPUT_
     0-0-0/c STRC(72)          1 VM_MAILCG_NAME             0-0-0/w STRC(432)   r     1 VM_MAILCG_SETSTA
     0-0-0/c STRC(72)    r     1 VM_MAIL_ACCT               0-0-0/c STRC(54)    r     1 VM_NAME_MAP_NAME
     0-0-0/w PTR               1 VM_PARSEAREA$              0-0-0/d VECT        r     1 VM_PARSEAREA_
     0-0-0/w PTR         r     1 VM_PROFILE$                0-0-0/d VECT        r     1 VM_PROFILE_
     0-0-0/w PTR         r     1 VM_SELECT$                 0-0-0/d VECT        r     1 VM_SELECT_
     0-0-0/c STRC(288)   r     1 VM_SEND_FILE_NAME          0-0-0/c CHAR(8)     r     1 VM_SITENAME
     0-0-0/w PTR         r     1 VM_WORK$                   0-0-0/d VECT        r     1 VM_WORK_

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/c ASTR(9)     r     1 B$TEXTC
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:992  
     0-0-0/c ASTR(9)     r     1 B$VERSION                  0-0-0/w SBIN        r     1 BSD
     0-0-0/c ACHR        r     1 CURRENT_LINE               0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w UBIN        r     1 HOLE(0:1024)               0-0-0/d STRC(72)    r     1 HOLE(0:1024)
     0-0-0/c ACHR        r     1 INDX1_CHARS                0-0-0/d STRC(4608)  r     1 LOWER_UPPER
     0-0-0N  NULL        r     1 M$CMNDF                    0-0-0N  NULL        r     1 M$DO
     0-0-0N  NULL        r     1 M$EDIT                     0-0-0N  NULL        r     1 M$ENCL
     0-0-0N  NULL        r     1 M$LM                       0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$MAIL_CENTRAL             0-0-0N  NULL        r     1 M$MAIL_COMGROUP
     0-0-0N  NULL        r     1 M$MAIL_FILE                0-0-0N  NULL        r     1 M$MAIL_GLOBAL
     0-0-0N  NULL        r     1 M$ME                       0-0-0N  NULL        r     1 M$NAME
     0-0-0N  NULL        r     1 M$NODE                     0-0-0N  NULL        r     1 M$OUT
     0-0-0N  NULL        r     1 M$SI                       0-0-0N  NULL        r     1 M$UC
     0-0-0N  NULL        r     1 M$WORK
     0-0-0/w PTR         r     1 NODES_TO_USE(0:29)
     0-0-0/w UBIN        r     1 OPT$SEED                   0-0-0/w STRC(144)   r     1 P$B
     0-0-0/w ASTR(153)   r     1 P$S                        0-0-0/c ACHR        r     1 STASH
     0-0-0/c ACHR        r     1 TEMPLATE                   0-0-0/w STRC(252)   r     1 VM$CONTEXT
     0-0-0/w STRC(711)   r     1 VM$RADDRESS                0-0-0/w STRC(2448)  r     1 VM$UADDRESS
     0-0-0/w STRC(252)   r     1 VM_ADD_HEAD                0-0-0/w STRC(432)   r     1 VM_ENCLOS
     0-0-0/w ASTR(72)    r     1 VM_ENCLREC                 0-0-0/w STRC(252)   r     1 VM_ENCL_HEAD
     0-0-0/w STRC(1332)  r     1 VM_HEADER                  0-0-0/w STRC        r     1 VM_ID
     0-0-0/w STRC(4068)  r     1 VM_PROFILE                 0-0-0/c ASTR(9)     r     1 X$STRING
     0-0-0/d STRC(1512)  r     1 XUG$GETCMD


   Procedure VMO$MAIL requires 10979 words for executable code.
   Procedure VMO$MAIL requires 978 words of local(AUTO) storage.
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:993  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:994  
          MINI XREF LISTING

ADDRESS_ACCT
     16638**DCL     28249<>CALL    28442<>CALL    30166<>CALL    30180<>CALL    30363<>CALL    30379<>CALL
ADDRESS_ACCT.ACCT#
     16638**DCL     28192<<ASSIGN  28206<<ASSIGN  28225>>IF      28232<<ASSIGN  28334<<ASSIGN  28361<<ASSIGN
     28382>>IF      28384<<ASSIGN  28386>>ASSIGN  30120<<ASSIGN  30138<<ASSIGN  30252<<ASSIGN  30277<<ASSIGN
     30295>>IF      30297<<ASSIGN  30301>>ASSIGN
ADDRESS_FOLDER
     16694**DCL     28195<<ASSIGN  28208<<ASSIGN  28244<>CALL    28249<>CALL    28337<<ASSIGN  28363<<ASSIGN
     28435<>CALL    28442<>CALL    30123<<ASSIGN  30140<<ASSIGN  30163<>CALL    30166<>CALL    30176<>CALL
     30180<>CALL    30255<<ASSIGN  30279<<ASSIGN  30358<>CALL    30363<>CALL    30375<>CALL    30379<>CALL
ADDRESS_LACCN.ACCT#
     16651**DCL     28340<<ASSIGN  28350<<ASSIGN  28384>>ASSIGN  28385>>IF      28386<<ASSIGN  28390>>IF
     28395>>CALLBLT 30257<<ASSIGN  30269<<ASSIGN  30297>>ASSIGN  30299>>IF      30301<<ASSIGN  30312>>IF
     30317>>CALLBLT 30368>>CALLBLT 30389>>IF      30394>>CALLBLT
ADDRESS_LUNAME
     16653**DCL     28341<<ASSIGN  28352<<ASSIGN  28395>>CALLBLT 30258<<ASSIGN  30271<<ASSIGN  30317>>CALLBLT
     30368>>CALLBLT 30394>>CALLBLT
ADDRESS_NAME
     16679**DCL     28220<>CALL    28244<>CALL    28377<>CALL    28435<>CALL    30152<>CALL    30163<>CALL
     30176<>CALL    30293<>CALL    30358<>CALL    30375<>CALL
ADDRESS_NAME.L#
     16679**DCL     28193<<ASSIGN  28211<<ASSIGN  28233<<ASSIGN  28237<<ASSIGN  28241>>IF      28335<<ASSIGN
     28366<<ASSIGN  28432>>IF      30121<<ASSIGN  30143<<ASSIGN  30161>>IF      30169>>IF      30172>>ASSIGN
     30172>>ASSIGN  30174>>CALLBLT 30174>>CALLBLT 30253<<ASSIGN  30282<<ASSIGN  30356>>IF      30369>>IF
     30371>>ASSIGN  30371>>ASSIGN  30373>>CALLBLT 30373>>CALLBLT
ADDRESS_NAME.NAME#
     16679**DCL     28194<<ASSIGN  28210<<ASSIGN  28225>>IF      28238<<ASSIGN  28336<<ASSIGN  28365<<ASSIGN
     30122<<ASSIGN  30142<<ASSIGN  30172>>ASSIGN  30174<<CALLBLT 30254<<ASSIGN  30281<<ASSIGN  30371>>ASSIGN
     30373<<CALLBLT
ADDRESS_PASS
     16692**DCL     28244<>CALL    28249<>CALL    28435<>CALL    28442<>CALL    30163<>CALL    30166<>CALL
     30176<>CALL    30180<>CALL    30358<>CALL    30363<>CALL    30375<>CALL    30379<>CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:995  
ADDRESS_PASS.PASS#
     16692**DCL     28196<<ASSIGN  28213<<ASSIGN  28338<<ASSIGN  28368<<ASSIGN  30124<<ASSIGN  30145<<ASSIGN
     30256<<ASSIGN  30284<<ASSIGN
ADDRESS_SITENAME
     16695**DCL     28197<<ASSIGN  28215<<ASSIGN  28220<>CALL    28244<>CALL    28249<>CALL    28339<<ASSIGN
     28370<<ASSIGN  28377<>CALL    28390>>IF      28390>>IF      28435<>CALL    28442<>CALL    30125<<ASSIGN
     30147<<ASSIGN  30152<>CALL    30163<>CALL    30166<>CALL    30176<>CALL    30180<>CALL    30259<<ASSIGN
     30286<<ASSIGN  30293<>CALL    30312>>IF      30312>>IF      30358<>CALL    30363<>CALL    30375<>CALL
     30379<>CALL    30389>>IF      30389>>IF
ADDRESS_SPEC
     16167**DCL     16211--DCLINIT
ALT IN PROCEDURE PUT_PROFILE
     33083**LABEL   33053--CALLALT
ALT1 IN PROCEDURE PUT_PROFILE
     33080**LABEL   33057--GOTO    33073--CALLALT
ANSI_DATE
     16858**DCL     18154--DCLINIT 18155--DCLINIT 32862>>CALLBLT
ANSI_TIME
     16857**DCL     18156--DCLINIT 18157--DCLINIT 32862>>CALLBLT
ARRAY_LOOP IN PROCEDURE GET_NEW_MSGNUM
     34056**LABEL   34060--EXIT
ASSIGN_A_MESSAGE_ID
     32841**PROC    32629--CALL
B$ALT.CODE
     15397**DCL     15397--REDEF   15398--REDEF   15398--REDEF
B$ALT.DCB#
     15398**DCL     27650>>ASSIGN  31664<>CALL    31673>>ASSIGN  31711<>CALL    31728>>ASSIGN  31984>>ASSIGN
     32070>>ASSIGN  33476>>ASSIGN  33491>>ASSIGN  33636>>ASSIGN  34033>>ASSIGN
B$ALT.ERR
     15398**DCL     27649>>ASSIGN  27987>>ASSIGN  28120>>ASSIGN  28529>>ASSIGN  28777<>CALL    29390>>ASSIGN
     30870>>ASSIGN  30900>>ASSIGN  30950>>ASSIGN  31663>>ASSIGN  31672>>ASSIGN  31710>>ASSIGN  31720>>ASSIGN
     31727>>ASSIGN  31842<>CALL    31983>>ASSIGN  32069>>ASSIGN  33475>>ASSIGN  33490>>ASSIGN  33635>>ASSIGN
     34032>>ASSIGN
B$ALT.ERR.CODE
     15399**DCL     28586>>IF      28734>>IF      29583>>IF      31438>>IF      31825>>IF      32828>>IF
     33057>>IF      33549>>IF      33550>>IF      33645>>IF      33755>>IF      33756>>IF      33972>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:996  
     34042>>IF
B$ALT.ERR.ERR#
     15399**DCL     15399--REDEF
B$ALT.EVID
     15398**DCL     15398--REDEF   15398--REDEF
B$JIT.ACCN
      2061**DCL     27370>>IF      28084>>CALLBLT 30689>>IF      31454>>CALLBLT 31498>>IF      31500--ASSIGN
     31501>>ASSIGN  31549>>IF
B$JIT.CCARS
      2149**DCL     27408>>ASSIGN
B$JIT.CCBUF
      2149**DCL     27407>>ASSIGN
B$JIT.CPFLAGS1
      2150**DCL     31658>>IF
B$JIT.CPFLAGS1.SLEAZE
      2155**DCL      2155--REDEF
B$JIT.ERR.MID
      2062**DCL      2062--REDEF
B$JIT.FACCN
      2061**DCL     30892>>ASSIGN  30910>>ASSIGN
B$JIT.JRESPEAK
      2223**DCL      2224--REDEF
B$JIT.NEXTCC
      2203**DCL     27420>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
      2332**DCL      2332--REDEF    2333--REDEF
B$JIT.PNR
      2236**DCL      2236--REDEF
B$JIT.PRFLAGS.LS
      2145**DCL     27241>>IF
B$JIT.PRFLAGS.OU
      2145**DCL     27236>>IF
B$JIT.PRFLAGS.SI
      2145**DCL     27226>>IF
B$JIT.PRFLAGS.UI
      2145**DCL     27231>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:997  
B$JIT.SYSID
      2061**DCL     27334>>CALLBLT
B$JIT.TSLINE
      2330**DCL      2331--REDEF
B$JIT.UNAME
      2061**DCL     28084>>CALLBLT 31454>>CALLBLT
B$JIT$
     14998**DCL      2056--IMP-PTR 27226>>IF      27231>>IF      27236>>IF      27241>>IF      27334>>CALLBLT
     27370>>IF      27407>>ASSIGN  27408>>ASSIGN  27420>>IF      28084>>CALLBLT 28084>>CALLBLT 30689>>IF
     30892>>ASSIGN  30910>>ASSIGN  31454>>CALLBLT 31454>>CALLBLT 31498>>IF      31501>>ASSIGN  31549>>IF
     31658>>IF
B$TCB.ALT$
     15393**DCL     27649>>ASSIGN  27650>>ASSIGN  27987>>ASSIGN  28120>>ASSIGN  28529>>ASSIGN  28586>>IF
     28734>>IF      28777>>CALL    29390>>ASSIGN  29583>>IF      30870>>ASSIGN  30900>>ASSIGN  30950>>ASSIGN
     31438>>IF      31663>>ASSIGN  31664>>CALL    31672>>ASSIGN  31673>>ASSIGN  31710>>ASSIGN  31711>>CALL
     31720>>ASSIGN  31727>>ASSIGN  31728>>ASSIGN  31825>>IF      31842>>CALL    31983>>ASSIGN  31984>>ASSIGN
     32069>>ASSIGN  32070>>ASSIGN  32828>>IF      33057>>IF      33475>>ASSIGN  33476>>ASSIGN  33490>>ASSIGN
     33491>>ASSIGN  33549>>IF      33550>>IF      33635>>ASSIGN  33636>>ASSIGN  33645>>IF      33755>>IF
     33756>>IF      33972>>IF      34032>>ASSIGN  34033>>ASSIGN  34042>>IF
B$TCB$
     14999**DCL     15393--IMP-PTR 27649>>ASSIGN  27650>>ASSIGN  27987>>ASSIGN  28120>>ASSIGN  28529>>ASSIGN
     28586>>IF      28734>>IF      28777>>CALL    29390>>ASSIGN  29583>>IF      30870>>ASSIGN  30900>>ASSIGN
     30950>>ASSIGN  31438>>IF      31663>>ASSIGN  31664>>CALL    31672>>ASSIGN  31673>>ASSIGN  31710>>ASSIGN
     31711>>CALL    31720>>ASSIGN  31727>>ASSIGN  31728>>ASSIGN  31825>>IF      31842>>CALL    31983>>ASSIGN
     31984>>ASSIGN  32069>>ASSIGN  32070>>ASSIGN  32828>>IF      33057>>IF      33475>>ASSIGN  33476>>ASSIGN
     33490>>ASSIGN  33491>>ASSIGN  33549>>IF      33550>>IF      33635>>ASSIGN  33636>>ASSIGN  33645>>IF
     33755>>IF      33756>>IF      33972>>IF      34032>>ASSIGN  34033>>ASSIGN  34042>>IF
B$TEXTC.C IN PROCEDURE SORT_FOLDER
     33699**DCL     33862>>IF      33862>>IF      33876>>IF      33876>>IF      33880>>IF      33880>>IF
     33887>>IF      33887>>IF      33910>>IF      33910>>IF      33910>>IF      33910>>IF      33931<<ASSIGN
     33931>>ASSIGN  33940<<ASSIGN  33940>>ASSIGN
B$TEXTC.L IN PROCEDURE SORT_FOLDER
     33698**DCL     33699--IMP-SIZ 33722<<ASSIGN  33848>>IF      33862>>IF      33862>>IF      33862>>IF
     33862>>IF      33876>>IF      33876>>IF      33876>>IF      33876>>IF      33880>>IF      33880>>IF
     33880>>IF      33880>>IF      33887>>IF      33887>>IF      33887>>IF      33887>>IF      33910>>IF
     33910>>IF      33910>>IF      33910>>IF      33910>>IF      33910>>IF      33910>>IF      33910>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:998  
     33930<<ASSIGN  33930>>ASSIGN  33931>>ASSIGN  33931>>ASSIGN  33932>>ASSIGN  33939<<ASSIGN  33939>>ASSIGN
     33940>>ASSIGN  33940>>ASSIGN  33941>>ASSIGN
B$VERSION
     16544**DCL     27424--ASSIGN
B$VERSION.L#
     16545**DCL     16546--IMP-SIZ 27424>>ASSIGN
B$XL_UPPER$
     15331**DCL     15332--IMP-PTR 28554>>CALLBLT 28612>>CALLBLT 28843>>CALLBLT 29338>>CALLBLT 30174>>CALLBLT
     30373>>CALLBLT
BAD_PROFILE IN PROCEDURE PROCESS_CMD
     31710**LABEL   28004--CALLALT 28129--CALLALT 29628--CALLALT 29975--CALLALT 31068--CALLALT
BLK$
     16594**DCL     15409--IMP-PTR 15455--IMP-PTR 28044<<ASSIGN  28045>>DOINDEX 28046>>ASSIGN  28141<<ASSIGN
     28145>>ASSIGN  28145>>ASSIGN  28152>>CALL    28152>>CALL    28173>>CALL    28173>>CALL    28187>>DOINDEX
     28188>>ASSIGN  28330<<ASSIGN  28346>>DOINDEX 28347>>ASSIGN  28473<<ASSIGN  28477>>DOINDEX 28478>>ASSIGN
     28822<<ASSIGN  28823>>IF      28825>>CALL    28898<<ASSIGN  28899>>DOCASE  28901>>CALL    28901>>CALL
     28906>>CALL    28915<>CALL    29317<<ASSIGN  29318>>IF      29320>>CALL    29461<<ASSIGN  29462>>DOCASE
     29464>>CALL    29464>>CALL    29469<>CALL    29772<<ASSIGN  29773>>ASSIGN  29773>>ASSIGN  29776>>ASSIGN
     29777>>ASSIGN  29777>>ASSIGN  29778<<ASSIGN  29779>>IF      29782>>ASSIGN  29785>>CALLBLT 29785>>CALLBLT
     29827<<ASSIGN  29828>>IF      29830>>CALL    29842<<ASSIGN  29846>>DOINDEX 29847>>ASSIGN  29983<<ASSIGN
     29984>>DOCASE  29986<>CALL    29988>>CALL    30264<<ASSIGN  30265>>DOINDEX 30266>>ASSIGN  30561<<ASSIGN
     30563>>DOCASE  30566>>IF      30573>>IF      30580>>IF      30587>>IF      30594>>IF      30601>>IF
     30608>>IF      30615>>CALLBLT 30615>>CALLBLT 30619>>IF      30626>>IF      30633>>IF      30640>>IF
     30647>>IF      30660<<ASSIGN  30660>>ASSIGN  30661>>IF      30676>>DOINDEX 30677>>ASSIGN  30697>>IF
     30715>>IF      30715>>IF      30718<<ASSIGN  30719>>ASSIGN  30728>>IF      30730>>ASSIGN  30731>>ASSIGN
     30731>>ASSIGN  30744>>IF      30744>>IF      30747>>ASSIGN  30751>>ASSIGN  30752>>ASSIGN  30752>>ASSIGN
     30766>>IF      30766>>IF      30769>>ASSIGN  30773>>ASSIGN  30774>>ASSIGN  30774>>ASSIGN  30777>>IF
     30792>>IF      30794>>ASSIGN  30796<<ASSIGN  30806>>DOINDEX 30807>>ASSIGN  30977<<ASSIGN  30978>>DOCASE
     30980>>CALL    30980>>CALL    30985<>CALL    31366<<ASSIGN  31367>>DOCASE  31370<>CALL
BLK$ IN PROCEDURE INIT$SELECT_OPTS
     32225**DCL     32223--PROC    32242>>IF      32252>>DOCASE  32258>>DOCASE  32286>>IF      32348>>DOCASE
     32360>>IF      32429>>IF      32449>>DOINDEX 32450>>ASSIGN  32494>>IF
BOF IN PROCEDURE SORT_FOLDER
     33677**DCL     33966<>CALL
BOF.V IN PROCEDURE SORT_FOLDER
     33679**DCL     33677--DCLINIT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:999  
BOF.V.DCB# IN PROCEDURE SORT_FOLDER
     33679**DCL     33965<<ASSIGN
BREAK_TYPE
     16615**DCL     27872<<ASSIGN  28009<<ASSIGN  29812<<ASSIGN  29976<<ASSIGN
BSD
     16169**DCL     27409<>CALL    27481<>CALL    27506<>CALL    30110<>CALL    30240<>CALL    34288<>CALL
BUILD_LINK_TO_SEND_CMD
     34209**PROC    27750--CALL    29500--CALL    29571--CALL    31019--CALL    31161--CALL    34172--CALL
BUMP_CONTEXT_INDX IN PROCEDURE GET$MESSAGE
     32710**LABEL   32600--GOTO    32609--GOTO    32622--GOTO    32641--GOTO
BUMP_CONTEXT_INVERSE IN PROCEDURE GET$MESSAGE
     32791**LABEL   32730--GOTO    32743--GOTO    32752--GOTO
B_VERSION
     16543**DCL     27424--ASSIGN  27424--ASSIGN
CANT_COPY IN PROCEDURE PROCESS_CMD
     27995**LABEL   27878--CALLALT 27883--CALLALT 27890--GOTO
CANT_CREATE_FOLDER IN PROCEDURE PROCESS_CMD
     28120**LABEL   28064--CALLALT
CFLEN IN PROCEDURE BUILD_LINK_TO_SEND_CMD
     34239**DCL     34291<<ASSIGN  34292>>DOWHILE 34299>>ASSIGN  34300>>ASSIGN
CHECK IN PROCEDURE PUT_PROFILE
     32895**DCL     33037<<ASSIGN  33047<<ASSIGN  33051>>IF      33072>>IF
CHECK_DUPES IN PROCEDURE SORT_FOLDER
     33903**LABEL   33919--EXIT
CHECK_FID
     18809**DCL     30898<>CALL
CHECK_FID.V
     18813**DCL     18809--DCLINIT
CHECK_NEW IN PROCEDURE PUT_PROFILE
     33046**ENTRY   27500--CALL    31692--CALL
CLEANUP IN PROCEDURE COPY_FOLDER
     33632**LABEL   33643--GOTO    33649--GOTO
CLEANUP IN PROCEDURE SORT_FOLDER
     34027**LABEL   34040--GOTO    34046--GOTO
CLOSE_SAVE
     18572**DCL     27554<>CALL    27579<>CALL    27766<>CALL    27998<>CALL    28116<>CALL    28455<>CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1000 
     28660<>CALL    28783<>CALL    29395<>CALL    29530<>CALL    29539<>CALL    29543<>CALL    29597<>CALL
     29972<>CALL    30340<>CALL    30346<>CALL    30398<>CALL    30888<>CALL    31485<>CALL    31522<>CALL
     31667<>CALL    31797<>CALL    31817<>CALL    32028<>CALL    33523<>CALL    33626<>CALL    33629<>CALL
     33729<>CALL    34021<>CALL    34024<>CALL    34177<>CALL
CLOSE_SAVE.SN_
     18572**DCL     18572--REDEF
CLOSE_SAVE.UTL_
     18573**DCL     18573--REDEF
CLOSE_SAVE.V
     18577**DCL     18572--DCLINIT
CLOSE_SAVE.V.DCB#
     18578**DCL     27553<<ASSIGN  27578<<ASSIGN  27765<<ASSIGN  27997<<ASSIGN  28115<<ASSIGN  28454<<ASSIGN
     28659<<ASSIGN  28782<<ASSIGN  29394<<ASSIGN  29520<<ASSIGN  29574<<ASSIGN  29864<<ASSIGN  30214<<ASSIGN
     30887<<ASSIGN  31484<<ASSIGN  31521<<ASSIGN  31666<<ASSIGN  31796<<ASSIGN  31816<<ASSIGN  32027<<ASSIGN
     33521<<ASSIGN  33625<<ASSIGN  33627<<ASSIGN  33727<<ASSIGN  34020<<ASSIGN  34022<<ASSIGN  34176<<ASSIGN
CLOSE_SAVE.V.EXPIRE#
     18587**DCL     18587--REDEF
CLOSE_SAVE.V.OPER.RELG#
     18578**DCL     33628<<ASSIGN  33630<<ASSIGN  34023<<ASSIGN  34025<<ASSIGN
CLOSE_SAVE.V.TYPE#
     18585**DCL     18585--REDEF
CLOSE_SAVE.V.XTNSIZE#
     18582**DCL     18582--REDEF   18584--REDEF
CLOSE_SCRATCH
     18615**DCL     27782<>CALL    28524<>CALL    29621<>CALL    31061<>CALL    33640<>CALL    34037<>CALL
     34193<>CALL
CLOSE_SCRATCH.SN_
     18615**DCL     18615--REDEF
CLOSE_SCRATCH.UTL_
     18616**DCL     18616--REDEF
CLOSE_SCRATCH.V
     18620**DCL     18615--DCLINIT
CLOSE_SCRATCH.V.DCB#
     18621**DCL     27781<<ASSIGN  28501<<ASSIGN  29620<<ASSIGN  31060<<ASSIGN  33639<<ASSIGN  34036<<ASSIGN
     34192<<ASSIGN
CLOSE_SCRATCH.V.EXPIRE#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1001 
     18630**DCL     18630--REDEF
CLOSE_SCRATCH.V.TYPE#
     18628**DCL     18628--REDEF
CLOSE_SCRATCH.V.XTNSIZE#
     18625**DCL     18625--REDEF   18627--REDEF
CLOSE_SEARCH
     31789**PROC    30858--CALL    31393--CALL    31417--CALL    31487--CALL
CODE IN PROCEDURE REPORT_ACTIVITY
     32115**DCL     32085--PROC    32160<>CALL
COMBINED
     16622**DCL     27921<<ASSIGN  27924<<ASSIGN  27927>>IF
COMMAND IN PROCEDURE INIT$SELECT_OPTS
     32226**DCL     32223--PROC    32453>>IF      32525>>DOCASE
COMMON IN PROCEDURE PUT_PROFILE
     33049**LABEL   33039--GOTO
CONTEXT_PTR$
     18094**DCL     27672>>ASSIGN  27673>>ASSIGN  28716>>IF      28716>>IF      28716>>IF      29073>>CALL
     29102>>CALL    29130>>IF      29161>>ASSIGN  29639>>ASSIGN  31140>>ASSIGN  31141>>ASSIGN  31142>>ASSIGN
     31143>>ASSIGN  31639>>ASSIGN  31643>>ASSIGN  31644>>ASSIGN  31645>>ASSIGN  31647>>ASSIGN  32189<<ASSIGN
     32190>>ASSIGN  32191>>ASSIGN  32192>>ASSIGN  32193>>ASSIGN  32208>>IF      32208>>IF      32208>>IF
     32212>>ASSIGN  32262>>DOINDEX 32263>>ASSIGN  32263>>ASSIGN  32265>>ASSIGN  32265>>ASSIGN  32268>>ASSIGN
     32268>>ASSIGN  32269>>ASSIGN  32269>>ASSIGN  32274>>ASSIGN  32274>>ASSIGN  32275>>ASSIGN  32275>>ASSIGN
     32276>>ASSIGN  32276>>ASSIGN  32277>>ASSIGN  32286>>IF      32293>>DOINDEX 32294>>IF      32294>>IF
     32294>>IF      32294>>IF      32301>>IF      32301>>IF      32308>>ASSIGN  32308>>ASSIGN  32310>>ASSIGN
     32310>>ASSIGN  32312>>ASSIGN  32321>>IF      32333>>ASSIGN  32333>>ASSIGN  32335>>ASSIGN  32335>>ASSIGN
     32337>>ASSIGN  32340>>DOINDEX 32341>>ASSIGN  32341>>ASSIGN  32341>>ASSIGN  32343>>ASSIGN  32343>>ASSIGN
     32343>>ASSIGN  32345>>ASSIGN  32345>>ASSIGN  32347>>ASSIGN  32347>>ASSIGN  32351>>ASSIGN  32360>>IF
     32367>>DOINDEX 32368>>IF      32368>>IF      32368>>IF      32368>>IF      32375>>IF      32375>>IF
     32382>>ASSIGN  32382>>ASSIGN  32384>>ASSIGN  32384>>ASSIGN  32386>>ASSIGN  32407>>ASSIGN  32408>>ASSIGN
     32408>>ASSIGN  32410>>ASSIGN  32410>>ASSIGN  32412>>ASSIGN  32416>>ASSIGN  32416>>ASSIGN  32418>>ASSIGN
     32418>>ASSIGN  32420>>ASSIGN  32420>>ASSIGN  32422>>ASSIGN  32422>>ASSIGN  32423>>ASSIGN  32424>>ASSIGN
     32456>>ASSIGN  32457>>ASSIGN  32458>>ASSIGN  32465>>ASSIGN  32485>>ASSIGN  32488>>ASSIGN  32489>>ASSIGN
     32489>>ASSIGN  32497>>ASSIGN  32497>>ASSIGN  32498>>ASSIGN  32498>>ASSIGN  32499>>ASSIGN  32499>>ASSIGN
     32503>>ASSIGN  32503>>ASSIGN  32505>>ASSIGN  32506>>CALL    32514>>IF      32517>>ASSIGN  32518>>ASSIGN
     32519>>ASSIGN  32528>>ASSIGN  32528>>ASSIGN  32529>>ASSIGN  32529>>ASSIGN  32530>>DOINDEX 32531>>ASSIGN
     32531>>ASSIGN  32533>>ASSIGN  32533>>ASSIGN  32536>>IF      32541>>ASSIGN  32541>>ASSIGN  32544>>ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1002 
     32545>>CALL    32545>>CALL    32549>>ASSIGN  32588>>IF      32595>>IF      32598>>IF      32601>>DOWHILE
     32601>>DOWHILE 32604>>IF      32604>>IF      32604>>IF      32604>>IF      32612>>ASSIGN  32620>>IF
     32620>>IF      32636>>IF      32636>>IF      32636>>IF      32636>>IF      32645>>IF      32648>>CALL
     32665>>CALL    32688>>ASSIGN  32695>>IF      32710>>ASSIGN  32710>>ASSIGN  32717>>ASSIGN  32717>>ASSIGN
     32726>>IF      32729>>ASSIGN  32729>>ASSIGN  32732>>DOWHILE 32734>>ASSIGN  32742>>IF      32747>>IF
     32747>>IF      32747>>IF      32747>>IF      32756>>IF      32759>>CALL    32769>>ASSIGN  32776>>IF
     32791>>ASSIGN  32791>>ASSIGN  32796>>ASSIGN  32796>>ASSIGN  32818>>ASSIGN  32819>>ASSIGN  32820>>ASSIGN
     32821>>ASSIGN  32822>>ASSIGN  32824>>ASSIGN
CONTINUE IN PROCEDURE PROCESS_CMD
     31701**LABEL   27682--CALLALT 27686--CALLALT 27705--CALLALT 27709--CALLALT 27854--CALLALT 27857--CALLALT
     27865--CALLALT 28014--CALLALT 28017--CALLALT 28054--GOTO    28133--CALLALT 28280--CALLALT 28291--GOTO
     28486--GOTO    28497--GOTO    28549--CALLALT 28590--GOTO    28602--CALLALT 28666--CALLALT 28667--CALLALT
     28707--GOTO    28713--GOTO    28721--GOTO    28744--GOTO    28751--GOTO    28761--GOTO    28778--GOTO
     28804--CALLALT 28831--GOTO    28893--CALLALT 28912--GOTO    28915--CALLALT 29010--CALLALT 29019--GOTO
     29026--CALLALT 29035--GOTO    29326--GOTO    29457--CALLALT 29469--CALLALT 29513--GOTO    29632--CALLALT
     29855--GOTO    29981--CALLALT 29986--CALLALT 29994--GOTO    30037--CALLALT 30040--CALLALT 30068--CALLALT
     30199--CALLALT 30209--GOTO    30537--CALLALT 30780--GOTO    30903--GOTO    30973--CALLALT 30985--CALLALT
     31032--GOTO    31126--CALLALT 31149--CALLALT 31151--CALLALT 31155--CALLALT 31254--CALLALT 31257--CALLALT
     31287--CALLALT 31290--CALLALT 31389--GOTO    31690--CALLALT 31723--GOTO    31734--GOTO    31738--GOTO
COPY_FOLDER IN PROCEDURE UPDATE$MAIL
     33495**PROC    33427--CALL    33468--CALL
COPY_MOVE IN PROCEDURE PROCESS_CMD
     27860**LABEL   27855--GOTO
COUNT
     16860**DCL     28767<>CALL    28773>>ASSIGN  28774>>IF      29579<>CALL    29588<>CALL    32863<<CALLBLT
     32864>>ASSIGN  32874>>ASSIGN
CREATE_LIST_END IN PROCEDURE PROCESS_CMD
     28259**LABEL   28154--GOTO    28175--GOTO    28220--CALLALT
CREATE_USER_END IN PROCEDURE PROCESS_CMD
     28454**LABEL   28377--CALLALT 28419--GOTO
CREATE_USER_END2 IN PROCEDURE PROCESS_CMD
     28457**LABEL   28301--GOTO    28315--GOTO
CURRENT_LINE
     16487**DCL     30725>>ASSIGN  31160>>ASSIGN
CURRENT_MESSAGE_NUMBER
     16481**DCL     27694<>CALL    27757<>CALL    27763<>CALL    27770<>CALL    27775<>CALL    27918<>CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1003 
     27922<>CALL    27926<>CALL    27945<>CALL    27953<>CALL    27959<>CALL    28684<>CALL    28687>>IF
     28688>>ASSIGN  28689<>CALL    28732<>CALL    28767<>CALL    28790<>CALL    28792<>CALL    28926>>ASSIGN
     28932<>CALL    28939<>CALL    28960<>CALL    28995<>CALL    29515<>CALL    29526<>CALL    29535<>CALL
     29579<>CALL    29606<>CALL    29611<>CALL    30011>>ASSIGN  30013<>CALL    30022<>CALL    30049<>CALL
     30056<>CALL    31034<>CALL    31038<>CALL    31046<>CALL    31051<>CALL    31266<>CALL    31273<>CALL
     31299<>CALL    31306<>CALL    32603<<ASSIGN  32603>>ASSIGN  32604>>IF      32604>>IF      32612>>ASSIGN
     32613<>CALL    32631<>CALL    32632<>CALL    32636>>IF      32636>>IF      32688>>ASSIGN  32717<<ASSIGN
     32734>>ASSIGN  32735<>CALL    32747>>IF      32747>>IF      32769>>ASSIGN  32796<<ASSIGN  32820>>ASSIGN
     32821>>ASSIGN  32824>>ASSIGN  32825>>ASSIGN  32830<>CALL    34174<>CALL    34181<>CALL    34186<>CALL
CURR_COMMAND_CODE
     16891**DCL     27416<<ASSIGN  27468<>CALL    27509<<ASSIGN  27511<>CALL    32657>>IF
CURR_COMMAND_CODE IN PROCEDURE PROCESS_CMD
     27667**DCL     27665--PROC    27678>>DOCASE  27872>>ASSIGN  27933>>IF      27950>>IF      29812>>ASSIGN
CUR_NUM IN PROCEDURE COPY_FOLDER
     33508**DCL     33563<<ASSIGN  33574>>ASSIGN  33575>>ASSIGN  33576<<ASSIGN  33576>>ASSIGN  33577>>IF
     33594>>IF      33595>>IF      33596>>ASSIGN  33597>>IF      33600>>DOWHILE 33601<<ASSIGN  33601>>ASSIGN
     33602>>IF      33607>>IF      33608>>ASSIGN  33609>>IF
CVM_PROFILE
     17025**DCL     28081>>ASSIGN  31451>>ASSIGN
CVM_PROFILE.WORK_AREA
     17099**DCL     17060--DCLINIT
DCB#
     16616**DCL     27650<<ASSIGN  27651<>CALL    30952<<ASSIGN  30958<>CALL    31673<<ASSIGN  31674<>CALL
     31728<<ASSIGN  31729<>CALL    31984<<ASSIGN  32018<>CALL    32070<<ASSIGN  32071<>CALL    33476<<ASSIGN
     33477<>CALL    33491<<ASSIGN  33492<>CALL    33636<<ASSIGN  33638<>CALL    34033<<ASSIGN  34035<>CALL
DCB# IN PROCEDURE PUT_PROFILE
     32894**DCL     32893--PROC    33046--ENTRY   33049>>ASSIGN  33052>>ASSIGN  33073<>CALL    33074>>ASSIGN
     33080>>ASSIGN
DELETE_ENCL_FLAG
     20621**DCL     27463<<ASSIGN  28756<<ASSIGN  28789>>IF
DELREC_NAME_MAP
     19074**DCL     30397<>CALL    31879<>CALL
DELREC_NAME_MAP.V
     19077**DCL     19074--DCLINIT
DEL_NAMEMAP_ENTRIES
     31867**PROC    28627--CALL    28650--CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1004 
DEQ_HEAD
     18324**DCL     32835<>CALL    33481<>CALL
DEQ_HEAD.V
     18325**DCL     18324--DCLINIT
DEQ_PROFILE
     18195**DCL     27967<>CALL    31732<>CALL    33075<>CALL    33081<>CALL    33479<>CALL    33487<>CALL
DEQ_PROFILE.V
     18196**DCL     18195--DCLINIT
DEQ_PROFILE.V.DCB#
     18196**DCL     27908<<ASSIGN  31731<<ASSIGN  33074<<ASSIGN  33080<<ASSIGN
DI_LIST_ALL IN PROCEDURE PROCESS_CMD
     28810**LABEL   28835--GOTO
DI_NEXT IN PROCEDURE PROCESS_CMD
     28924**LABEL   28934--GOTO    28943--GOTO
DI_USER_ALL IN PROCEDURE PROCESS_CMD
     29305**LABEL   29330--GOTO
DO$ACK
     34143**PROC    27695--CALL    28992--CALL
DOMAIN$
     16696**DCL     28198<<ASSIGN  28217<<ASSIGN  28220<>CALL    28342<<ASSIGN  28372<<ASSIGN  28377<>CALL
     30126<<ASSIGN  30149<<ASSIGN  30152<>CALL    30260<<ASSIGN  30288<<ASSIGN  30293<>CALL
DOMAIN$ IN PROCEDURE TRANSFORM_DOMAIN
     34072**DCL     34070--PROC    34112>>IF      34114>>ASSIGN  34114>>ASSIGN  34122>>DOINDEX 34124>>ASSIGN
     34127>>CALLBLT 34127>>CALLBLT 34129>>CALLBLT 34129>>CALLBLT
EJECT
     16856**DCL     30001<<ASSIGN  30006>>IF      30009<<ASSIGN
ENCL$
     16605**DCL     17524--IMP-PTR 28739<<ASSIGN  28741>>IF      28742>>IF      28749>>IF      28753<<ASSIGN
     28753>>ASSIGN  28766>>DOINDEX 28790>>CALL    28791>>ASSIGN  28797>>IF      29576<<ASSIGN  29578>>DOINDEX
     29579>>CALL    29588>>CALL    29592<<ASSIGN  29592>>ASSIGN
END_ACK IN PROCEDURE PROCESS_CMD
     27699**LABEL   27693--CALLALT
END_ANSWER IN PROCEDURE PROCESS_CMD
     27787**LABEL   27755--CALLALT 27777--GOTO
END_COPY IN PROCEDURE PROCESS_CMD
     27977**LABEL   27912--CALLALT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1005 
END_COUNT IN PROCEDURE PROCESS_CMD
     28026**LABEL   28022--CALLALT
END_DELETE IN PROCEDURE PROCESS_CMD
     28692**LABEL   28672--CALLALT
END_DEL_FOLDER IN PROCEDURE PROCESS_CMD
     28545**LABEL   28521--CALLALT 28538--GOTO    28539--CALLALT
END_DEL_LIST IN PROCEDURE PROCESS_CMD
     28589**LABEL   28558--CALLALT 28574--CALLALT
END_DEL_NAME_MAP IN PROCEDURE DEL_NAMEMAP_ENTRIES
     31879**LABEL   31871--CALLALT
END_DEL_USER IN PROCEDURE PROCESS_CMD
     28652**LABEL   28616--CALLALT 28627--CALLALT 28639--CALLALT 28648--CALLALT
END_DETACH IN PROCEDURE PROCESS_CMD
     28790**LABEL   28709--CALLALT
END_DISP IN PROCEDURE PROCESS_CMD
     28993**LABEL   28924--CALLALT
END_DI_LIST IN PROCEDURE PROCESS_CMD
     28876**LABEL   28812--CALLALT 28881--GOTO
END_DI_USER IN PROCEDURE PROCESS_CMD
     29373**LABEL   29307--CALLALT 29349--CALLALT 29368--CALLALT
END_FORWARD IN PROCEDURE PROCESS_CMD
     29617**LABEL   29506--CALLALT 29613--GOTO
END_LIST IN PROCEDURE PROCESS_CMD
     30031**LABEL   30005--CALLALT
END_LI_FOLDER IN PROCEDURE PROCESS_CMD
     29969**LABEL   29836--GOTO    29888--CALLALT 29960--CALLALT
END_LOOP
     27573**LABEL   27336--REMEMBR 27508--GOTO    27549--GOTO    27560--GOTO
END_MARK IN PROCEDURE PROCESS_CMD
     30055**LABEL   30044--CALLALT
END_MOD_LIST IN PROCEDURE PROCESS_CMD
     30194**LABEL   30190--GOTO
END_MOD_USER IN PROCEDURE PROCESS_CMD
     30408**LABEL   30404--GOTO
END_RENUMBER IN PROCEDURE UPDATE$MAIL
     33442**LABEL   33436--CALLALT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1006 
END_RESEND IN PROCEDURE PROCESS_CMD
     31057**LABEL   31025--CALLALT 31053--GOTO
END_UNDELETE IN PROCEDURE PROCESS_CMD
     31272**LABEL   31261--CALLALT
END_UNMARK IN PROCEDURE PROCESS_CMD
     31305**LABEL   31294--CALLALT
END_UPDATE IN PROCEDURE UPDATE$MAIL
     33473**LABEL   33405--GOTO
ENQ_HEAD
     18304**DCL     32826<>CALL    33402<>CALL
ENQ_HEAD.V
     18305**DCL     18304--DCLINIT
ENQ_PROFILE
     18176**DCL     27910<>CALL    33053<>CALL    33335<>CALL
ENQ_PROFILE.V
     18177**DCL     18176--DCLINIT
ENQ_PROFILE.V.DCB#
     18177**DCL     27907<<ASSIGN  31731>>ASSIGN  33052<<ASSIGN
ERRMSG_FID
     15067**DCL     27294<>CALL
ERRMSG_FID.L#
     15067**DCL     15067--IMP-SIZ 27294>>CALL
ERROR
     18647**DCL     27649<<ASSIGN  27651<>CALL    27987<<ASSIGN  27988<>CALL    28120<<ASSIGN  28122<>CALL
     28529<<ASSIGN  28531<>CALL    29390<<ASSIGN  29392<>CALL    30870<<ASSIGN  30872<>CALL    30900<<ASSIGN
     30902<>CALL    30939<<ASSIGN  30950<<ASSIGN  30958<>CALL    31663<<ASSIGN  31665<>CALL    31672<<ASSIGN
     31674<>CALL    31710<<ASSIGN  31712<>CALL    31720<<ASSIGN  31722<>CALL    31727<<ASSIGN  31729<>CALL
     31983<<ASSIGN  32018<>CALL    32069<<ASSIGN  32071<>CALL    33475<<ASSIGN  33477<>CALL    33490<<ASSIGN
     33492<>CALL    33635<<ASSIGN  33638<>CALL    34032<<ASSIGN  34035<>CALL
ERROR.ERR#
     18677**DCL     31989>>IF
EXIT_MAIL#
     16850**DCL     27459<<ASSIGN  27559<<ASSIGN  27587>>IF      27590<<ASSIGN  30942>>IF      30944<<ASSIGN
     30955<<ASSIGN  30966<<ASSIGN  31323<<ASSIGN  31401<<ASSIGN  31407<<ASSIGN
EXIT_MAIL_PEND#
     16851**DCL     27556>>IF      27558<<ASSIGN  30945<<ASSIGN  30953>>IF      30956<<ASSIGN  30964>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1007 
     30967<<ASSIGN
EXPLICIT IN PROCEDURE DO$ACK
     34145**DCL     34143--PROC    34174<>CALL
E_ACK IN PROCEDURE DO$ACK
     34192**LABEL   34174--CALLALT
E_ALLOCATE IN PROCEDURE ASSIGN_A_MESSAGE_ID
     32880**LABEL   32871--CALLALT
E_ALLOCATE IN PROCEDURE PROCESS_CMD
     31737**LABEL   30657--CALLALT 30664--CALLALT 30711--CALLALT 30722--CALLALT 30741--CALLALT 30749--CALLALT
     30763--CALLALT 30771--CALLALT 30838--CALLALT
E_ANSBROAD
     26405**DCL     27760<>CALL
E_ANSWER IN PROCEDURE PROCESS_CMD
     27781**LABEL   27761--GOTO    27763--CALLALT
E_BADDOMAIN
     26356**DCL     34117<>CALL
E_BADRANGE
     26731**DCL     32482<>CALL
E_BIGNUM
     26780**DCL     32557<>CALL
E_BLANKUSER
     25813**DCL     28290<>CALL
E_CANTCOMPACT
     26258**DCL     33647<>CALL    34044<>CALL
E_CANTDELCUR
     25862**DCL     28496<>CALL
E_CANTDELF
     25912**DCL     28530<>CALL
E_CANTREN
     26111**DCL     33404<>CALL
E_COMPACT
     26160**DCL     33517<>CALL    33717<>CALL
E_CONVERT IN PROCEDURE INIT$SELECT_OPTS
     32556**LABEL   32461--CALLALT 32464--GOTO    32473--CALLALT 32477--GOTO
E_COPY IN PROCEDURE PROCESS_CMD
     27987**LABEL   27903--CALLALT 27911--CALLALT 27945--CALLALT 27953--CALLALT 27959--CALLALT 27966--CALLALT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1008 
     27967--CALLALT
E_COUNT_FMT
     21051**DCL     28026<>CALL
E_CREATE_MSG_FMT
     21431**DCL     28070<>CALL    31450<>CALL
E_CRFERR
     25571**DCL     28121<>CALL
E_CRLIST1 IN PROCEDURE PROCESS_CMD
     28153**LABEL   28146--CALLALT
E_CRLIST2 IN PROCEDURE PROCESS_CMD
     28162**LABEL   28163--CALLALT
E_CRLIST3 IN PROCEDURE PROCESS_CMD
     28166**LABEL   28164--GOTO    28167--CALLALT
E_CRUSER1 IN PROCEDURE PROCESS_CMD
     28300**LABEL   28293--CALLALT
E_CRUSER2 IN PROCEDURE PROCESS_CMD
     28306**LABEL   28307--CALLALT
E_DEC IN PROCEDURE GET$MESSAGE
     32812**LABEL   32650--CALLALT 32673--CALLALT 32761--CALLALT
E_DELETE IN PROCEDURE UPDATE$MAIL
     33368**LABEL   33361--CALLALT
E_DETACH_DELETE_OK_FMT
     23408**DCL     28798<>CALL
E_DETACH_OK_FMT
     23332**DCL     28800<>CALL
E_DETALLOWSONE
     27022**DCL     28720<>CALL
E_DI_BADSEED
     26878**DCL     28942<>CALL
E_DI_FIRST_CMD
     24017**DCL     29414<>CALL
E_DI_LAST_CMD
     24321**DCL     29731<>CALL
E_DI_NEXT_CMD
     23637**DCL     30425<>CALL
E_DI_PREVIOUS_CMD
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1009 
     23865**DCL     30495<>CALL
E_DI_REST_CMD
     24473**DCL     31084<>CALL
E_DI_THIS_CMD
     24169**DCL     29655<>CALL    31181<>CALL
E_ENCLBROKEN
     27172**DCL     28769<>CALL
E_ENCLDELETED
     27123**DCL     28743<>CALL
E_ENCLNOTFOUND
     27074**DCL     28750<>CALL
E_END_CMD
     24625**DCL     27541<>CALL    27609<>CALL
E_END_NOUPDATE_CMD
     23485**DCL     27636<>CALL    32002<>CALL
E_EVAL IN PROCEDURE GET$MESSAGE
     32806**LABEL   32648--CALLALT 32670--GOTO    32759--CALLALT
E_FOLDERBUSY
     25421**DCL     31527<>CALL    32033<>CALL
E_FOLDEROLD
     25470**DCL     27989<>CALL    29886<>CALL    29958<>CALL    31664<>CALL    31711<>CALL
E_FOLDER_DELETED_FMT
     20899**DCL     28545<>CALL
E_FOLDER_DISPLAYED_FMT
     20975**DCL     29977<>CALL
E_FOLDER_HEADER1_FMT
     20747**DCL     29904<>CALL
E_FOLDER_HEADER2_FMT
     20823**DCL     29934<>CALL
E_FWD_BADSEED
     26927**DCL     29529<>CALL    29538<>CALL
E_GREETING_FMT
     20671**DCL     27441<>CALL
E_INPROG
     26059**DCL     32831<>CALL
E_INVOKE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1010 
     27412**LABEL   27409--CALLALT
E_LISTEXISTS
     25283**DCL     28152<>CALL    28313<>CALL
E_LISTS_DELETED_FMT
     22088**DCL     28598<>CALL
E_LISTS_DISPLAYED_FMT
     22164**DCL     28889<>CALL
E_LIST_FIRST_CMD
     24093**DCL     29439<>CALL
E_LIST_LAST_CMD
     24397**DCL     29756<>CALL
E_LIST_NEXT_CMD
     23713**DCL     30450<>CALL
E_LIST_PREVIOUS_CMD
     23941**DCL     30520<>CALL
E_LIST_REST_CMD
     24549**DCL     31109<>CALL
E_LIST_THIS_CMD
     24245**DCL     29680<>CALL    31206<>CALL
E_MAIL_SETUP
     25233**DCL     28094<>CALL    31464<>CALL
E_MEMERR
     26455**DCL     32561<>CALL
E_MODIFY_LIST_PROMPT
     16738**DCL     30096<>CALL
E_MODIFY_USER_PROMPT
     16814**DCL     30224<>CALL
E_MODLIST_DEL IN PROCEDURE PROCESS_CMD
     30185**LABEL   30176--CALLALT
E_MODUSER_DEL IN PROCEDURE PROCESS_CMD
     30383**LABEL   30375--CALLALT
E_MSGS_COPIED_FMT
     21860**DCL     27977<>CALL
E_MSGS_DELETED_FMT
     21556**DCL     27980<>CALL    28700<>CALL
E_MSGS_DISPLAYED_FMT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1011 
     21936**DCL     29005<>CALL
E_MSGS_LISTED_FMT
     22012**DCL     30033<>CALL
E_MSGS_MARKED_FMT
     21708**DCL     30063<>CALL
E_MSGS_UNDELETED_FMT
     21632**DCL     31282<>CALL
E_MSGS_UNMARKED_FMT
     21784**DCL     31313<>CALL
E_NAMENTALLOWED
     25522**DCL     28053<>CALL    28485<>CALL    29854<>CALL    30684<>CALL
E_NEEDMID
     26501**DCL     31751<>CALL
E_NEEDSEED
     26829**DCL     28933<>CALL    29512<>CALL    31031<>CALL
E_NEW_MESSAGE_FMT
     23228**DCL     27502<>CALL    31700<>CALL
E_NEXT_CMD
     23561**DCL     27808<>CALL
E_NMENTRYEXISTS
     25764**DCL     28417<>CALL    30338<>CALL
E_NOCURFOLD
     26010**DCL     28706<>CALL    31676<>CALL    32052<>CALL
E_NOENCLS
     26973**DCL     28712<>CALL
E_NOFILE
     26685**DCL     30939>>ASSIGN
E_NOLIST
     26307**DCL     28589<>CALL
E_NOMORE
     26547**DCL     29712<>CALL
E_NOTALLOW
     25669**DCL     27889<>CALL    31761<>CALL
E_NOTMCENTRAL
     25375**DCL     31773<>CALL
E_NOUPDATE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1012 
     26593**DCL     31530<>CALL    31537<>CALL    32036<>CALL    32043<>CALL
E_NO_MESSAGE_FMT
     21127**DCL     27701<>CALL    27789<>CALL    29625<>CALL    31065<>CALL    32132<>CALL
E_PMME
     27649**LABEL   27276--CALLALT 27277--CALLALT 27278--CALLALT 27279--CALLALT 27280--CALLALT 27281--CALLALT
     27284--CALLALT 27294--CALLALT 27310--CALLALT 27312--CALLALT 27313--CALLALT 27318--CALLALT 27324--CALLALT
     27329--CALLALT 27554--CALLALT
E_PMME IN PROCEDURE COPY_FOLDER
     33635**LABEL   33542--CALLALT 33552--CALLALT 33554--CALLALT 33558--GOTO    33578--CALLALT 33619--CALLALT
     33624--CALLALT 33626--CALLALT 33629--CALLALT 33651--GOTO
E_PMME IN PROCEDURE DO$ACK
     34198**LABEL   34173--CALLALT 34177--CALLALT 34181--CALLALT 34186--CALLALT 34188--GOTO    34193--CALLALT
E_PMME IN PROCEDURE GET_WILD_FOLDER
     31835**LABEL   31829--GOTO    31854--CALLALT
E_PMME IN PROCEDURE LINK_RUNIT
     32069**LABEL   31976--CALLALT 32028--CALLALT 32064--CALLALT
E_PMME IN PROCEDURE PROCESS_CMD
     31727**LABEL   27695--CALLALT 27756--CALLALT 27766--CALLALT 27770--CALLALT 27775--CALLALT 27782--CALLALT
     27899--CALLALT 27998--CALLALT 28080--CALLALT 28110--CALLALT 28116--CALLALT 28244--CALLALT 28249--CALLALT
     28256--CALLALT 28324--CALLALT 28422--CALLALT 28435--CALLALT 28442--CALLALT 28451--CALLALT 28455--CALLALT
     28566--CALLALT 28593--GOTO    28607--CALLALT 28631--CALLALT 28651--CALLALT 28660--CALLALT 28938--CALLALT
     29395--CALLALT 29519--CALLALT 29530--CALLALT 29539--CALLALT 29543--CALLALT 29573--CALLALT 29597--CALLALT
     29606--CALLALT 29611--CALLALT 29972--CALLALT 30163--CALLALT 30166--CALLALT 30194--CALLALT 30316--CALLALT
     30340--CALLALT 30345--CALLALT 30346--CALLALT 30358--CALLALT 30363--CALLALT 30393--CALLALT 30398--CALLALT
     30408--CALLALT 30475--CALLALT 30479--CALLALT 30545--CALLALT 30835--CALLALT 31038--CALLALT 31046--CALLALT
     31051--CALLALT 31480--CALLALT 31485--CALLALT 31522--CALLALT
E_PMME IN PROCEDURE SORT_FOLDER
     34032**LABEL   33720--CALLALT 33748--CALLALT 33758--CALLALT 33760--CALLALT 33764--GOTO    33772--CALLALT
     33835--CALLALT 33851--CALLALT 33975--GOTO    34010--CALLALT 34019--CALLALT 34021--CALLALT 34024--CALLALT
     34048--GOTO
E_PMME IN PROCEDURE UPDATE$MAIL
     33487**LABEL   33375--CALLALT 33441--CALLALT 33443--CALLALT
E_PMME2 IN PROCEDURE COPY_FOLDER
     33645**LABEL   33535--CALLALT
E_PMME2 IN PROCEDURE SORT_FOLDER
     34042**LABEL   33741--CALLALT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1013 
E_PREVIOUS_CMD
     23789**DCL     27835<>CALL
E_RENFAILED
     26209**DCL     33637<>CALL    34034<>CALL
E_RESEND_NAME
     25157**DCL     31002<>CALL
E_SEND_ACKNOWLEDGE
     24777**DCL     34158<>CALL
E_SEND_ANSWER
     24701**DCL     27736<>CALL
E_SEND_FORWARD
     24853**DCL     29486<>CALL
E_SEND_FORWARD_ENCL
     24929**DCL     29557<>CALL
E_SEND_MAIL
     25005**DCL     34255<>CALL
E_SEND_NAME
     25081**DCL     34317<>CALL
E_STATUS_CCONTEXT_FMT
     22544**DCL     29084<>CALL
E_STATUS_DMSGS_FMT
     22772**DCL     29201<>CALL
E_STATUS_FOLDER_FMT
     22392**DCL     29055<>CALL
E_STATUS_HMSGS_FMT
     23000**DCL     29282<>CALL
E_STATUS_NMSGS_FMT
     22848**DCL     29228<>CALL
E_STATUS_POSITION_FMT
     22620**DCL     29172<>CALL
E_STATUS_POSITION_OUTSIDE_FMT
     22696**DCL     29143<>CALL
E_STATUS_SCONTEXT_FMT
     22468**DCL     29113<>CALL
E_STATUS_TMSGS_FMT
     22924**DCL     29255<>CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1014 
E_TIME_FMT
     21203**DCL     31234<>CALL
E_TOOMANYSRCH
     25961**DCL     30779<>CALL
E_UNDEFENTRY
     25715**DCL     30076<>CALL    30185<>CALL    30208<>CALL    30383<>CALL
E_USEREXISTS
     25329**DCL     28173<>CALL    28299<>CALL
E_USERS_DELETED_FMT
     22240**DCL     28662<>CALL
E_USERS_DISPLAYED_FMT
     22316**DCL     29377<>CALL
E_USE_FULL_FMT
     23076**DCL     31585<>CALL
E_USE_LOST_FMT
     23152**DCL     31614<>CALL
E_USING_MSG_FMT
     21480**DCL     31492<>CALL    31507<>CALL
E_WERR
     26639**DCL     29391<>CALL    30871<>CALL    31721<>CALL
F$DCB.ACCT#
     15352**DCL     30927>>IF      30927>>IF
F$DCB.ACTPOS
     15368**DCL     15368--REDEF
F$DCB.ARS#
     15342**DCL     15342--REDEF   28407>>IF      28410>>IF      28412>>ASSIGN  30327>>IF      30330>>IF
     30332>>ASSIGN  33616>>IF      33617>>ASSIGN  34002>>IF      34005>>ASSIGN
F$DCB.ATTR
     15361**DCL     15362--REDEF
F$DCB.BORROW
     15376**DCL     15376--REDEF   15376--REDEF   15376--REDEF
F$DCB.DCBNAME.L
     15390**DCL     15390--IMP-SIZ
F$DCB.DDEV.UCOUT#
     15349**DCL     28887>>IF      29003>>IF      29375>>IF      30031>>IF
F$DCB.DVBYTE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1015 
     15345**DCL     29588<>CALL    33618>>ASSIGN  34007>>ASSIGN
F$DCB.EOMCHAR#
     15346**DCL     15346--REDEF   27794>>ASSIGN  27795>>ASSIGN
F$DCB.FCD#
     15355**DCL     27523>>IF      27576>>IF      27793>>IF      27995>>IF      29970>>IF      30884>>IF
     31794>>IF      31814>>IF
F$DCB.FLDID
     15371**DCL     15371--REDEF
F$DCB.FORM$
     15365**DCL     15365--REDEF
F$DCB.FSECT
     15381**DCL     15381--REDEF
F$DCB.FSN#
     15358**DCL     15358--REDEF   15358--REDEF   15359--REDEF
F$DCB.HEADER$
     15364**DCL     15364--REDEF
F$DCB.IXTNSIZE#
     15362**DCL     15362--REDEF
F$DCB.LASTSTA$
     15351**DCL     15351--REDEF
F$DCB.LVL
     15377**DCL     15377--REDEF
F$DCB.NAME#.C
     15352**DCL     15352--REDEF   31831>>IF      31835>>ASSIGN
F$DCB.NOEOF
     15374**DCL     15374--REDEF
F$DCB.NRECS#
     15363**DCL     15363--REDEF
F$DCB.NRECX
     15382**DCL     15382--REDEF
F$DCB.OHDR
     15374**DCL     15374--REDEF
F$DCB.ORG#
     15357**DCL     15357--REDEF
F$DCB.PRECNO
     15380**DCL     15380--REDEF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1016 
F$DCB.RCSZ
     15386**DCL     15386--REDEF
F$DCB.RES#
     15353**DCL     15353--REDEF
F$DCB.SETX
     15365**DCL     15365--REDEF
F$DCB.TAB$
     15365**DCL     15365--REDEF
F$DCB.TDA
     15379**DCL     15380--REDEF
F$DCB.WSN#
     15353**DCL     15353--REDEF
FID_ACCT
     18720**DCL     18810--DCLINIT 18900--DCLINIT 30912--ASSIGN
FID_ACCT.ACCT#
     18720**DCL     28499<<ASSIGN  29862<<ASSIGN  29919--ASSIGN  30892<<ASSIGN  30910<<ASSIGN  30927>>IF
FID_ASN
     18765**DCL     18812--DCLINIT 30925>>ASSIGN
FID_NAME
     18706**DCL     18810--DCLINIT 28518--ASSIGN  29881--ASSIGN  30911--ASSIGN
FID_NAME.L#
     18706**DCL     28520<<ASSIGN  29883<<ASSIGN  30891<<ASSIGN
FID_NAME.NAME#
     18706**DCL     28519<<ASSIGN  29882<<ASSIGN  30890<<ASSIGN  30927>>IF
FID_NAME IN PROCEDURE UPDATE$MAIL
     33327**DCL     33524--ASSIGN  33730--ASSIGN
FID_NAME.L# IN PROCEDURE UPDATE$MAIL
     33327**DCL     33527<<ASSIGN  33733<<ASSIGN
FID_NAME.NAME# IN PROCEDURE UPDATE$MAIL
     33327**DCL     33525<<CALLBLT 33526>>CALLBLT 33731<<CALLBLT 33732>>CALLBLT
FID_PASS
     18734**DCL     18811--DCLINIT 18897--DCLINIT 30915--ASSIGN
FID_PASS.PASS#
     18734**DCL     28500<<ASSIGN  29863<<ASSIGN  30893<<ASSIGN
FID_RES
     18767**DCL     18812--DCLINIT 30924>>ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1017 
FID_RESULTS
     18780**DCL     18813--DCLINIT 30895<<ASSIGN
FID_RESULTS.ACCT
     18780**DCL     30908>>IF
FID_RESULTS.PASS
     18780**DCL     30913>>IF
FID_RESULTS.RES
     18780**DCL     30922>>IF
FID_RESULTS.SN
     18780**DCL     30916>>IF
FID_RESULTS.WSN
     18780**DCL     30919>>IF
FID_SN
     18748**DCL     18811--DCLINIT 30918--ASSIGN
FID_WSN
     18762**DCL     18811--DCLINIT 30921--ASSIGN
FID_WSN.WSN#
     18762**DCL     30894<<ASSIGN
FILE_NONE
     18268**DCL     31533<>CALL    32039<>CALL
FILE_NONE.V
     18269**DCL     18268--DCLINIT
FILE_SHARE
     18245**DCL     31519<>CALL    31534<>CALL    32025<>CALL    32040<>CALL
FILE_SHARE.V
     18246**DCL     18245--DCLINIT
FIND_ENCL IN PROCEDURE PROCESS_CMD
     28740**LABEL   28747--EXIT
FINISH_MOVE_CMD IN PROCEDURE INIT$SELECT_OPTS
     32434**LABEL   32432--GOTO
FIX_CONTEXT
     32206**PROC    27687--CALL    27710--CALL    29472--CALL    30988--CALL
FLDPTR$ IN PROCEDURE SORT_FOLDER
     33710**DCL     33825<<ASSIGN  33827<<ASSIGN  33829<<ASSIGN  33831<<ASSIGN  33845>>IF      33848>>IF
     33862>>IF      33862>>IF      33862>>IF      33876>>IF      33876>>IF      33876>>IF      33880>>IF
     33880>>IF      33880>>IF      33887>>IF      33887>>IF      33887>>IF      33910>>IF      33910>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1018 
     33910>>IF      33910>>IF      33910>>IF      33910>>IF      33930>>ASSIGN  33931>>ASSIGN  33931>>ASSIGN
     33932>>ASSIGN  33939>>ASSIGN  33940>>ASSIGN  33940>>ASSIGN  33941>>ASSIGN
FMT IN PROCEDURE REPORT_ACTIVITY
     32112**DCL     32085--PROC    32160<>CALL
FMT.L# IN PROCEDURE REPORT_ACTIVITY
     32112**DCL     32112--IMP-SIZ 32158>>IF      32160>>CALL    32163>>ASSIGN  32163>>ASSIGN
FMT.NAME# IN PROCEDURE REPORT_ACTIVITY
     32112**DCL     32158>>IF      32163--ASSIGN
FOLDER_SPEC IN PROCEDURE GET_FOLDERNAME
     31908**DCL     31897--PROC    31952<>CALL
FOLDER_WAS_OPEN
     16620**DCL     27871<<ASSIGN  29808<<ASSIGN  29969>>ASSIGN  31347<<ASSIGN  31357<<ASSIGN  31376>>IF
FOLD_BUSY IN PROCEDURE LINK_RUNIT
     32027**LABEL   32046--GOTO
FOLD_BUSY IN PROCEDURE PROCESS_CMD
     31521**LABEL   31540--GOTO
FOLD_CREATE IN PROCEDURE PROCESS_CMD
     31416**LABEL   31443--EXIT
FOUND_CHAR IN PROCEDURE SORT_FOLDER
     33899**LABEL   33864--GOTO    33884--GOTO
FOUND_UBIN IN PROCEDURE SORT_FOLDER
     33799**LABEL   33783--GOTO    33798--GOTO
FPARAM_AREA IN PROCEDURE UPDATE$MAIL
     33301**DCL     33531--ASSIGN  33538--ASSIGN  33737--ASSIGN  33744--ASSIGN
FPT_CORRES
     19202**DCL     28163<>CALL    31771<>CALL
FPT_CORRES.V
     19202**DCL     19202--DCLINIT
FPT_CORRES.V.DCB1#
     19202**DCL     28161<<ASSIGN  31769<<ASSIGN
FPT_CORRES.V.DCB2#
     19203**DCL     28162<<ASSIGN  31770<<ASSIGN
FPT_INT
     18529**DCL     27313<>CALL
FPT_INT.V
     18529**DCL     18529--DCLINIT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1019 
FPT_LINK
     19220**DCL     31981<>CALL
FPT_LINK.ACCT_
     19220**DCL     34332<<ASSIGN
FPT_LINK.CP_CMD_
     19221**DCL     29787<<ASSIGN  29790<<ASSIGN  29795<<ASSIGN
FPT_LINK.NAME_
     19220**DCL     34331<<ASSIGN
FPT_LINK.PASS_
     19220**DCL     29794<<ASSIGN
FPT_LINK.PSID_
     19221**DCL     29793<<ASSIGN
FPT_LINK.V
     19222**DCL     19222--DCLINIT
FPT_PRECORD
     20268**DCL     33554<>CALL    33760<>CALL
FPT_PRECORD.V
     20270**DCL     20268--DCLINIT
FWD_NEXT IN PROCEDURE PROCESS_CMD
     29484**LABEL   29531--GOTO    29540--GOTO
F_FDSLO
     20519**DCL     29070<>CALL    29099<>CALL    29128<>CALL    29188<>CALL    29216<>CALL    29243<>CALL
     29270<>CALL    29297<>CALL    29922<>CALL    29948<>CALL
F_FDSLO.DCB#
     20552**DCL     27573<<ASSIGN  29038<<ASSIGN  29921<<ASSIGN
F_FDSLO.FMT_
     20523**DCL     29055<>CALL    29058<<ASSIGN  29084<>CALL    29087<<ASSIGN  29113<>CALL    29116<<ASSIGN
     29143<>CALL    29146<<ASSIGN  29172<>CALL    29175<<ASSIGN  29201<>CALL    29204<<ASSIGN  29228<>CALL
     29231<<ASSIGN  29255<>CALL    29258<<ASSIGN  29282<>CALL    29285<<ASSIGN  29904<>CALL    29907<<ASSIGN
     29934<>CALL    29937<<ASSIGN
F_FDSLO.NVECS#
     20547**DCL     29039<<ASSIGN  29069<<ASSIGN  29157<<ASSIGN  29186<<ASSIGN  29190<<ASSIGN  29920<<ASSIGN
     29923<<ASSIGN
F_FDSME
     20292**DCL     27449<>CALL    31250<>CALL    31599<>CALL    31630<>CALL    32175<>CALL
F_FDSME.FMT_
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1020 
     20296**DCL     27441<>CALL    31234<>CALL    31237<<ASSIGN  31585<>CALL    31588<<ASSIGN  31614<>CALL
     31617<<ASSIGN  32132<>CALL    32135<<ASSIGN  32160<>CALL    32163<<ASSIGN
F_FDSME.NVECS#
     20320**DCL     27423<<ASSIGN  31249<<ASSIGN  31574<<ASSIGN  31628<<ASSIGN  32121<<ASSIGN  32150<<ASSIGN
GET$MESSAGE
     32577**PROC    27693--CALL    27755--CALL    27912--CALL    28022--CALL    28672--CALL    28709--CALL
     28924--CALL    29506--CALL    30005--CALL    30044--CALL    31025--CALL    31261--CALL    31294--CALL
GET_ANSI_TIME
     18154**DCL     32861<>CALL
GET_ANSI_TIME.V
     18158**DCL     18154--DCLINIT
GET_ENCL IN PROCEDURE PROCESS_CMD
     28732**LABEL   28736--GOTO
GET_ENCL_REC IN PROCEDURE PROCESS_CMD
     29579**LABEL   29585--GOTO
GET_FOLDERNAME
     31897**PROC    28069--CALL    31449--CALL    31491--CALL    31506--CALL    31526--CALL    32032--CALL
GET_NEW_MSGNUM IN PROCEDURE SORT_FOLDER
     34051**PROC    33987--CALL    33994--CALL
GET_NEXT_CONTEXT IN PROCEDURE GET$MESSAGE
     32705**LABEL   32676--GOTO    32678--GOTO    32682--GOTO
GET_PREV_CONTEXT IN PROCEDURE GET$MESSAGE
     32786**LABEL   32764--GOTO
GET_TIME
     19722**DCL     29893<>CALL    31223<>CALL
GET_TIME.V
     19726**DCL     19722--DCLINIT
GET_WILD_FOLDER
     31810**PROC    28521--CALL    28539--CALL    29888--CALL    29960--CALL
HEADER_FIELD# IN PROCEDURE UPDATE$MAIL
     33105**DCL     33092--PROC    33413--IF      33719>>IF      33768>>IF      33823>>DOSELCT
HEADER_MCB IN PROCEDURE ASSIGN_A_MESSAGE_ID
     32856**DCL     32871<>CALL
HEADER_MCB.ADDRESS$ IN PROCEDURE ASSIGN_A_MESSAGE_ID
     32856**DCL     32873>>ASSIGN
HEADER_MCB.FREE_HEAD$ IN PROCEDURE ASSIGN_A_MESSAGE_ID
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1021 
     32856**DCL     32869<<ASSIGN
HEADER_MCB.HI_SEGMENT$ IN PROCEDURE ASSIGN_A_MESSAGE_ID
     32856**DCL     32868<<ASSIGN  32872>>ASSIGN
HEADER_MCB.MIN_SIZE IN PROCEDURE ASSIGN_A_MESSAGE_ID
     32857**DCL     32866<<ASSIGN
HEADER_MCB.SEGMENT_BASE$ IN PROCEDURE ASSIGN_A_MESSAGE_ID
     32856**DCL     32867<<ASSIGN
HEADER_MCB.SIZE IN PROCEDURE ASSIGN_A_MESSAGE_ID
     32856**DCL     32864<<ASSIGN
HEADER_MCB.TYPE IN PROCEDURE ASSIGN_A_MESSAGE_ID
     32856**DCL     32865<<ASSIGN
HEADER_MCB.WKSZ IN PROCEDURE ASSIGN_A_MESSAGE_ID
     32856**DCL     32870<<ASSIGN
HELP_PARAM
     18446**DCL     29701<>CALL    29704<>CALL    29706<>CALL
HELP_PARAM.HELP$
     18456**DCL     29699<<ASSIGN
HELP_PARAM.MORE#
     18459**DCL     29700<<ASSIGN
HIGH IN PROCEDURE SORT_FOLDER
     33705**DCL     33789<<ASSIGN  33791>>ASSIGN  33796<<ASSIGN  33799>>IF      33871<<ASSIGN  33873>>ASSIGN
     33882<<ASSIGN  33885>>IF
HINDX IN PROCEDURE COPY_FOLDER
     33509**DCL     33564<<ASSIGN
HINDX IN PROCEDURE SORT_FOLDER
     33689**DCL     33993<<ASSIGN  33994<>CALL
HMAX IN PROCEDURE COPY_FOLDER
     33513**DCL     33518<<ASSIGN  33577>>IF      33579<<ASSIGN
HMAX IN PROCEDURE SORT_FOLDER
     33693**DCL     33718<<ASSIGN  33770>>IF      33773<<ASSIGN  33834>>IF      33841<<ASSIGN  33848>>IF
HOLE IN PROCEDURE COPY_FOLDER
     33515**DCL     33574<<ASSIGN  33587>>IF      33595>>IF      33597>>IF      33600>>DOWHILE 33607>>IF
     33609>>IF
HOLE IN PROCEDURE SORT_FOLDER
     33712**DCL     33810--CALL    33810--CALL    33926<>CALL    33926<>CALL    33950<>CALL    33950<>CALL
HOLE.MSG_NUM IN PROCEDURE SORT_FOLDER
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1022 
     33713**DCL     33811<<ASSIGN  33817<<ASSIGN  33927<<ASSIGN  33936<<ASSIGN  33953<<ASSIGN  34057>>IF
HOLE.SORT# IN PROCEDURE SORT_FOLDER
     33714**DCL     33782>>IF      33792>>IF      33795>>IF      33801>>IF      33812<<ASSIGN  33818<<ASSIGN
     33860>>IF      33861>>ASSIGN  33874>>IF      33875>>ASSIGN  33904>>ASSIGN  33906>>ASSIGN  33908>>ASSIGN
     33918>>ASSIGN  33928<<ASSIGN  33937<<ASSIGN  33946>>IF      33954<<ASSIGN
HOLE$ IN PROCEDURE COPY_FOLDER
     33511**DCL     33515--IMP-PTR 33516<<ASSIGN  33574>>ASSIGN  33587>>IF      33595>>IF      33597>>IF
     33600>>DOWHILE 33607>>IF      33609>>IF
HOLE$ IN PROCEDURE SORT_FOLDER
     33691**DCL     33712--IMP-PTR 33715<<ASSIGN  33721>>ASSIGN  33782>>IF      33792>>IF      33795>>IF
     33801>>IF      33810>>CALL    33810>>CALL    33811>>ASSIGN  33812>>ASSIGN  33817>>ASSIGN  33818>>ASSIGN
     33841>>ASSIGN  33860>>IF      33861>>ASSIGN  33874>>IF      33875>>ASSIGN  33904>>ASSIGN  33906>>ASSIGN
     33908>>ASSIGN  33918>>ASSIGN  33926>>CALL    33926>>CALL    33927>>ASSIGN  33928>>ASSIGN  33936>>ASSIGN
     33937>>ASSIGN  33946>>IF      33950>>CALL    33950>>CALL    33953>>ASSIGN  33954>>ASSIGN  34057>>IF
I IN PROCEDURE GET_NEW_MSGNUM
     34054**DCL     34056<<DOINDEX 34057>>IF      34059>>ASSIGN
I IN PROCEDURE SORT_FOLDER
     33709**DCL     33903<<DOINDEX 33904>>ASSIGN  33905>>IF      33906>>ASSIGN  33908>>ASSIGN  33917>>ASSIGN
ID
     16859**DCL     32862<<CALLBLT 32863>>CALLBLT 32875>>ASSIGN
IGNORE IN PROCEDURE DEL_NAMEMAP_ENTRIES
     31879**LABEL   31879--CALLALT
IGNORE_YC1
     27231**LABEL   27228--CALLALT
IGNORE_YC2
     27236**LABEL   27233--CALLALT
IGNORE_YC3
     27241**LABEL   27238--CALLALT
IGNORE_YC4
     27241**LABEL   27243--CALLALT
INDX IN PROCEDURE UPDATE$MAIL
     33101**DCL     33352<<ASSIGN  33356<>CALL    33361<>CALL    33375<>CALL    33381<<ASSIGN  33381>>ASSIGN
     33434<<ASSIGN  33435>>DOWHILE 33436<>CALL    33438>>IF      33441<>CALL    33443<>CALL    33446<<ASSIGN
     33446>>ASSIGN  33526<<CALLBLT 33527>>ASSIGN  33732<<CALLBLT 33733>>ASSIGN
INDX1
     16608**DCL     16861--IMP-SIZ 27365<<DOINDEX 27366>>ASSIGN  27400<<DOINDEX 27401>>ASSIGN  27480<<ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1023 
     27481<>CALL    27688<<ASSIGN  27696<<ASSIGN  27696>>ASSIGN  27699>>IF      27701<>CALL    27711<<ASSIGN
     27784<<ASSIGN  27784>>ASSIGN  27787>>IF      27789<>CALL    27860<<ASSIGN  27920<<ASSIGN  27920>>ASSIGN
     27977<>CALL    28018<<ASSIGN  28023<<ASSIGN  28023>>ASSIGN  28026<>CALL    28045<<DOINDEX 28046>>ASSIGN
     28140<<DOINDEX 28141>>ASSIGN  28329<<DOINDEX 28330>>ASSIGN  28477<<DOINDEX 28478>>ASSIGN  28509<<CALLBLT
     28516<<CALLBLT 28517>>ASSIGN  28551<<CALLBLT 28609<<CALLBLT 28669<<ASSIGN  28695<<ASSIGN  28695>>ASSIGN
     28700<>CALL    28727<<DOINDEX 28728>>ASSIGN  28840<<CALLBLT 28846>>IF      28851>>ASSIGN  28852>>ASSIGN
     28852>>ASSIGN  28857>>IF      28857>>IF      28857>>IF      28897<<DOINDEX 28898>>ASSIGN  29335<<CALLBLT
     29340>>IF      29345>>ASSIGN  29346>>ASSIGN  29346>>ASSIGN  29351>>IF      29351>>IF      29351>>IF
     29460<<DOINDEX 29461>>ASSIGN  29473<<ASSIGN  29507<<ASSIGN  29507>>ASSIGN  29577<<DOINDEX 29623>>IF
     29625<>CALL    29846<<DOINDEX 29847>>ASSIGN  29872<<CALLBLT 29879<<CALLBLT 29880>>ASSIGN  29982<<DOINDEX
     29983>>ASSIGN  30000<<ASSIGN  30014<<ASSIGN  30014>>ASSIGN  30031>>IF      30033<>CALL    30041<<ASSIGN
     30058<<ASSIGN  30058>>ASSIGN  30063<>CALL    30544<<ASSIGN  30545<>CALL    30547<<ASSIGN  30548>>ASSIGN
     30548>>ASSIGN  30559<<DOINDEX 30561>>ASSIGN  30718>>ASSIGN  30868<<ASSIGN  30869>>ASSIGN  30869>>ASSIGN
     30976<<DOINDEX 30977>>ASSIGN  30989<<ASSIGN  31026<<ASSIGN  31026>>ASSIGN  31063>>IF      31065<>CALL
     31258<<ASSIGN  31275<<ASSIGN  31275>>ASSIGN  31282<>CALL    31291<<ASSIGN  31308<<ASSIGN  31308>>ASSIGN
     31313<>CALL    31334<<DOINDEX 31335>>DOCASE  31365<<DOINDEX 31366>>ASSIGN
INDX1 IN PROCEDURE INIT$SELECT_OPTS
     32232**DCL     32262<<DOINDEX 32263>>ASSIGN  32263>>ASSIGN  32265>>ASSIGN  32265>>ASSIGN  32340<<DOINDEX
     32341>>ASSIGN  32343>>ASSIGN  32415<<DOINDEX 32416>>ASSIGN  32416>>ASSIGN  32418>>ASSIGN  32418>>ASSIGN
     32449<<DOINDEX 32450>>ASSIGN  32465>>ASSIGN  32485>>ASSIGN  32488>>ASSIGN  32494>>IF      32530<<DOINDEX
     32531>>ASSIGN  32531>>ASSIGN  32533>>ASSIGN  32533>>ASSIGN
INDX1 IN PROCEDURE TRANSFORM_DOMAIN
     34103**DCL     34123<<ASSIGN  34127>>CALLBLT 34129>>CALLBLT
INDX1_CHARS
     16861**DCL     30548<<ASSIGN  30548>>ASSIGN  30869<<ASSIGN  30869>>ASSIGN
INDX2
     16609**DCL     27861<<ASSIGN  27961<<ASSIGN  27961>>ASSIGN  27978>>IF      27980<>CALL    28005>>ASSIGN
     28187<<DOINDEX 28188>>ASSIGN  28346<<DOINDEX 28347>>ASSIGN  28464<<ASSIGN  28526<<ASSIGN  28526>>ASSIGN
     28545<>CALL    28550<<ASSIGN  28567<<ASSIGN  28567>>ASSIGN  28595<<ASSIGN  28595>>ASSIGN  28598<>CALL
     28608<<ASSIGN  28632<<ASSIGN  28632>>ASSIGN  28653<<ASSIGN  28653>>ASSIGN  28662<>CALL    28731<<CALLBLT
     28741>>IF      28767<>CALL    28790<>CALL    28798<>CALL    28800<>CALL    28806<<ASSIGN  28815<<ASSIGN
     28815>>ASSIGN  28865<<ASSIGN  28865>>ASSIGN  28879<<ASSIGN  28879>>ASSIGN  28887>>IF      28889<>CALL
     28920<<ASSIGN  28945<<ASSIGN  28945>>ASSIGN  29003>>IF      29005<>CALL    29301<<ASSIGN  29310<<ASSIGN
     29310>>ASSIGN  29359<<ASSIGN  29359>>ASSIGN  29371<<ASSIGN  29371>>ASSIGN  29375>>IF      29377<>CALL
     29816<<ASSIGN  29951<<ASSIGN  29963<<ASSIGN  29963>>ASSIGN  29977<>CALL    30265<<DOINDEX 30266>>ASSIGN
     30676<<DOINDEX 30677>>ASSIGN  30719<<ASSIGN  30720>>ASSIGN  30725>>ASSIGN  30725>>ASSIGN  30806<<DOINDEX
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1024 
     30807>>ASSIGN  34290<<ASSIGN  34292>>DOWHILE 34293>>IF      34293>>IF      34295<<ASSIGN  34295>>ASSIGN
     34302>>ASSIGN  34303>>ASSIGN
INDX2 IN PROCEDURE INIT$SELECT_OPTS
     32233**DCL     32293<<DOINDEX 32294>>IF      32294>>IF      32301>>IF      32310>>ASSIGN  32313<<ASSIGN
     32313>>ASSIGN  32321>>IF      32328<<ASSIGN  32328>>ASSIGN  32338<<ASSIGN  32340>>DOINDEX 32367<<DOINDEX
     32368>>IF      32368>>IF      32375>>IF      32382>>ASSIGN  32384>>ASSIGN  32384>>ASSIGN  32387<<ASSIGN
     32387>>ASSIGN  32395>>IF      32402<<ASSIGN  32402>>ASSIGN  32407<<ASSIGN  32408>>ASSIGN  32408>>ASSIGN
     32410>>ASSIGN  32410>>ASSIGN  32413<<ASSIGN  32413>>ASSIGN  32415>>DOINDEX
INDX2 IN PROCEDURE TRANSFORM_DOMAIN
     34104**DCL     34122<<DOINDEX 34124>>ASSIGN  34125>>IF      34127>>CALLBLT 34127>>CALLBLT 34129>>CALLBLT
     34129>>CALLBLT
INDX3
     16610**DCL     28202<<DOINDEX 28203>>ASSIGN  28357<<DOINDEX 28358>>ASSIGN  28766<<DOINDEX 28767<>CALL
     28845<<DOINDEX 28855>>CALL    28864<>CALL    28875<<DOINDEX 28876>>CALL    28880<>CALL    29578<<DOINDEX
     29579<>CALL    29588<>CALL    29633<<CALLBLT 29639>>ASSIGN  29783<<ASSIGN  29785>>CALLBLT 30134<<DOINDEX
     30135>>ASSIGN  30273<<DOINDEX 30274>>ASSIGN
INDX4
     16611**DCL     29782<<ASSIGN  29784>>ASSIGN  29785>>CALLBLT 30783<<DOINDEX 30784>>IF      30787>>ASSIGN
     30789>>ASSIGN  30795<<DOINDEX 30796>>ASSIGN  30840>>ASSIGN  30841>>ASSIGN  30845>>ASSIGN  30847>>ASSIGN
     30849>>CALLBLT 31679<<DOINDEX 31680>>ASSIGN  31790<<DOINDEX 31791>>IF      31791>>IF      31794>>IF
     31796>>ASSIGN  32055<<DOINDEX 32056>>ASSIGN
INIT$SELECT_OPTS
     32223**PROC    27686--CALL    27709--CALL    27865--CALL    28017--CALL    28667--CALL    28915--CALL
     29469--CALL    29986--CALL    30040--CALL    30985--CALL    31151--CALL    31257--CALL    31290--CALL
INIT_CONTEXT
     32186**PROC    27454--CALL    27455--CALL    31135--CALL    31136--CALL    31635--CALL    31636--CALL
     32261--CALL    32281--CALL    32355--CALL    32444--CALL
KEY_VALUE
     16485**DCL     27328<<ASSIGN  27329<>CALL
LAST IN PROCEDURE SORT_FOLDER
     33707**DCL     33716<<ASSIGN  33770>>IF      33776>>IF      33779>>IF      33781>>DOINDEX 33789>>ASSIGN
     33803>>IF      33807<<ASSIGN  33807>>ASSIGN  33808>>ASSIGN  33816<<ASSIGN  33816>>ASSIGN  33817>>ASSIGN
     33818>>ASSIGN  33834>>IF      33854>>IF      33857>>IF      33859>>DOINDEX 33871>>ASSIGN  33890>>IF
     33895>>IF      33903>>DOINDEX 33905>>IF      33923<<ASSIGN  33923>>ASSIGN  33924>>ASSIGN  33935<<ASSIGN
     33935>>ASSIGN  33936>>ASSIGN  33937>>ASSIGN  33945>>DOINDEX 33948<<ASSIGN  33948>>ASSIGN  33949>>ASSIGN
     34015>>ASSIGN  34017>>ASSIGN  34018>>ASSIGN  34056>>DOINDEX
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1025 
LAST_COMMAND_CODE
     16892**DCL     28896<<ASSIGN  29402>>IF      29643>>IF      29719>>IF      29998<<ASSIGN  30413>>IF
     30483>>IF      31072>>IF      31169>>IF
LEN IN PROCEDURE BUILD_LINK_TO_SEND_CMD
     34238**DCL     34270<<ASSIGN  34278>>ASSIGN  34279>>ASSIGN  34281>>ASSIGN  34298>>ASSIGN  34299>>ASSIGN
     34300<<ASSIGN  34300>>ASSIGN  34301>>ASSIGN  34303>>ASSIGN  34304>>ASSIGN  34305>>ASSIGN
LINK_CCBUF
     16513**DCL     19221--DCLINIT 29787--ASSIGN  34245<<ASSIGN
LINK_CCBUF.L#
     16513**DCL     29776<<ASSIGN  29783>>ASSIGN  29784<<ASSIGN  29784>>ASSIGN  34269>>CALLBLT 34282<<ASSIGN
     34306<<ASSIGN
LINK_CCBUF.NAME#
     16513**DCL     29777<<ASSIGN  29785<<CALLBLT 34269<<CALLBLT 34278<<ASSIGN  34279<<ASSIGN  34288<>CALL
     34298<<ASSIGN  34299<<ASSIGN  34301<<ASSIGN  34303<<ASSIGN  34304<<ASSIGN
LINK_RUNIT
     31969**PROC    27767--CALL    29603--CALL    29792--CALL    31043--CALL    31165--CALL    34178--CALL
LIST_LOOP IN PROCEDURE PROCESS_CMD
     28855**LABEL   28863--CALLALT 28866--GOTO
LI_FOLD_ALL IN PROCEDURE PROCESS_CMD
     29862**LABEL   29840--GOTO
LI_FOLD_ERR1 IN PROCEDURE PROCESS_CMD
     29886**LABEL   29889--CALLALT
LI_FOLD_ERR2 IN PROCEDURE PROCESS_CMD
     29955**LABEL   29961--CALLALT
LOW IN PROCEDURE SORT_FOLDER
     33706**DCL     33788<<ASSIGN  33791>>ASSIGN  33793<<ASSIGN  33799>>IF      33870<<ASSIGN  33873>>ASSIGN
     33878<<ASSIGN  33885>>IF      33894<<ASSIGN  33894>>ASSIGN  33895>>IF
LOWER_UPPER
     15332**DCL     28554>>CALLBLT 28612>>CALLBLT 28843>>CALLBLT 29338>>CALLBLT 30174>>CALLBLT 30373>>CALLBLT
M$CLOSE
      7824**DCL-ENT 27554--CALL    27579--CALL    27766--CALL    27782--CALL    27998--CALL    28116--CALL
     28455--CALL    28524--CALL    28660--CALL    28783--CALL    29395--CALL    29530--CALL    29539--CALL
     29543--CALL    29597--CALL    29621--CALL    29972--CALL    30340--CALL    30346--CALL    30398--CALL
     30888--CALL    31061--CALL    31485--CALL    31522--CALL    31667--CALL    31797--CALL    31817--CALL
     32028--CALL    33523--CALL    33626--CALL    33629--CALL    33640--CALL    33729--CALL    34021--CALL
     34024--CALL    34037--CALL    34177--CALL    34193--CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1026 
M$CMNDF_NUM
     16893**DCL     27523--IF      27553>>ASSIGN  27793--IF      27794--ASSIGN  30884--IF      30887>>ASSIGN
     30947<>CALL    30952>>ASSIGN
M$CORRES
      7829**DCL-ENT 28163--CALL    31771--CALL
M$DELREC
      7826**DCL-ENT 30397--CALL    31879--CALL
M$DEQ
      7891**DCL-ENT 27967--CALL    31732--CALL    32835--CALL    33075--CALL    33081--CALL    33479--CALL
     33481--CALL    33487--CALL
M$EDIT
     20626**DCL     31057>>ASSIGN  31060>>ASSIGN
M$ENCL
     20628**DCL     28758<>CALL    28782>>ASSIGN  29574>>ASSIGN  29588<>CALL    29588--CALL    29594<>CALL
M$ENQ
      7890**DCL-ENT 27910--CALL    31519--CALL    31533--CALL    31534--CALL    32025--CALL    32039--CALL
     32040--CALL    32826--CALL    33053--CALL    33335--CALL    33402--CALL
M$EXIT
      7836**DCL-ENT 27414--CALL    29398--CALL    31713--CALL
M$FID
      7887**DCL-ENT 30898--CALL
M$INT
      7879**DCL-ENT 27313--CALL
M$LDEV
      7824**DCL-ENT 30479--CALL
M$LINK
      7836**DCL-ENT 31981--CALL
M$LM
     20625**DCL     30927--IF      30927--IF
M$LO_NUM
     14992**DCL     27573>>ASSIGN  27574>>IF      27581>>ASSIGN  30049<>CALL    30468<>CALL    30470<>CALL
     30475<>CALL    31299<>CALL
M$MAIL_CENTRAL_NUM
     14980**DCL     27357<>CALL
M$MAIL_FILE_NUM
     14978**DCL     27360<>CALL    27363<>CALL    27375<>CALL    27385>>ASSIGN  27500<>CALL    27770<>CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1027 
     27775<>CALL    27899<>CALL    27922<>CALL    27926<>CALL    27945<>CALL    27953<>CALL    27959<>CALL
     28004<>CALL    28080<>CALL    28129<>CALL    28146<>CALL    28161>>ASSIGN  28167<>CALL    28256<>CALL
     28293<>CALL    28307<>CALL    28451<>CALL    28558<>CALL    28566<>CALL    28574<>CALL    28583<>CALL
     28616<>CALL    28631<>CALL    28639<>CALL    28648<>CALL    28651<>CALL    28689<>CALL    28693<>CALL
     28732<>CALL    28767<>CALL    28790<>CALL    28792<>CALL    28812<>CALL    28939<>CALL    28960<>CALL
     28963<>CALL    28981<>CALL    28995<>CALL    29388<>CALL    29392<>CALL    29394>>ASSIGN  29526<>CALL
     29535<>CALL    29579<>CALL    29606<>CALL    29611<>CALL    29628<>CALL    29806<>CALL    29975<>CALL
     30022<>CALL    30026<>CALL    30056<>CALL    30073<>CALL    30194<>CALL    30206<>CALL    30408<>CALL
     30866<>CALL    30872<>CALL    30873<>CALL    31038<>CALL    31046<>CALL    31051<>CALL    31068<>CALL
     31273<>CALL    31276<>CALL    31306<>CALL    31346<>CALL    31370<>CALL    31379<>CALL    31384<>CALL
     31418<>CALL    31434<>CALL    31440<>CALL    31480<>CALL    31484>>ASSIGN  31488<>CALL    31503<>CALL
     31521>>ASSIGN  31547<>CALL    31554<>CALL    31665<>CALL    31666>>ASSIGN  31692<>CALL    31712<>CALL
     31722<>CALL    31769>>ASSIGN  31791>>IF      31976<>CALL    32027>>ASSIGN  32064<>CALL    32613<>CALL
     32631<>CALL    32632<>CALL    32735<>CALL    33334<>CALL    33356<>CALL    33361<>CALL    33375<>CALL
     33436<>CALL    33441<>CALL    33441<>CALL    33443<>CALL    33473<>CALL    33519--ASSIGN  33521>>ASSIGN
     33532>>ASSIGN  33625>>ASSIGN  33632<>CALL    33725--ASSIGN  33727>>ASSIGN  33738>>ASSIGN  33965>>ASSIGN
     34020>>ASSIGN  34027<>CALL    34181<>CALL    34186<>CALL
M$MAIL_GLOBAL_NUM
     14982**DCL     27342<>CALL    27346>>ASSIGN  28162>>ASSIGN  29307<>CALL    29349<>CALL    29368<>CALL
     31770>>ASSIGN  31791>>IF
M$ME_NUM
     14990**DCL     27311<>CALL    27483<>CALL    27490<>CALL    27502<>CALL    27694<>CALL    27757<>CALL
     27918<>CALL    28070<>CALL    28684<>CALL    29515<>CALL    30188<>CALL    30402<>CALL    31034<>CALL
     31266<>CALL    31450<>CALL    31492<>CALL    31507<>CALL    31700<>CALL    32830<>CALL    33517<>CALL
     33717<>CALL
M$NAME
     20623**DCL     28407--IF      28410--IF      28412--ASSIGN  28454>>ASSIGN  28659>>ASSIGN  30214>>ASSIGN
     30327--IF      30330--IF      30332--ASSIGN
M$OPEN
      7824**DCL-ENT 27310--CALL    27318--CALL    27756--CALL    28324--CALL    28607--CALL    29519--CALL
     29573--CALL    29618--CALL    30316--CALL    30393--CALL    30935--CALL    31058--CALL    31823--CALL
     33535--CALL    33542--CALL    33741--CALL    33748--CALL    34173--CALL
M$OUT_NUM
     16618**DCL     28760<>CALL    28777<>CALL    28825<>CALL    28827>>ASSIGN  28830<>CALL    28906<>CALL
     28908>>ASSIGN  28911<>CALL    29013<>CALL    29015>>ASSIGN  29018<>CALL    29029<>CALL    29031>>ASSIGN
     29034<>CALL    29320<>CALL    29322>>ASSIGN  29325<>CALL    29830<>CALL    29832>>ASSIGN  29835<>CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1028 
     29988<>CALL    29990>>ASSIGN  29993<>CALL
M$PRECORD
      7828**DCL-ENT 33554--CALL    33760--CALL    33966--CALL
M$READ
      7825**DCL-ENT 28404--CALL    30325--CALL    33055--CALL    33548--CALL    33754--CALL    33970--CALL
M$SI_NUM
     14994**DCL     27311<>CALL    27555<>CALL    27795--ASSIGN  30959<>CALL
M$TIME
      7891**DCL-ENT 29893--CALL    31223--CALL    32861--CALL
M$WAIT
      7882**DCL-ENT 31694--CALL
M$WORK_NUM
     14984**DCL     27765>>ASSIGN  27781>>ASSIGN  27878<>CALL    27883<>CALL    27903<>CALL    27907>>ASSIGN
     27908>>ASSIGN  27911<>CALL    27922<>CALL    27945<>CALL    27966<>CALL    27988<>CALL    27989<>CALL
     27995--IF      27997>>ASSIGN  28064<>CALL    28110<>CALL    28115>>ASSIGN  28122<>CALL    28501>>ASSIGN
     28531<>CALL    29520>>ASSIGN  29526<>CALL    29535<>CALL    29617>>ASSIGN  29620>>ASSIGN  29864>>ASSIGN
     29886<>CALL    29889<>CALL    29958<>CALL    29961<>CALL    29970--IF      31814--IF      31816>>ASSIGN
     31831--IF      31835--ASSIGN  31842<>CALL    31854<>CALL    33536>>ASSIGN  33624<>CALL    33627>>ASSIGN
     33639>>ASSIGN  33742>>ASSIGN  34019<>CALL    34022>>ASSIGN  34036>>ASSIGN  34176>>ASSIGN  34192>>ASSIGN
M$WRITE
      7825**DCL-ENT 28422--CALL    28775--CALL    30345--CALL    33619--CALL    34010--CALL
M$XCON
      7879**DCL-ENT 27312--CALL
M$XXX
      7836**DCL-ENT 27292--CALL
M$YC
      7838**DCL-ENT 27228--CALL    27233--CALL    27238--CALL    27243--CALL
MADE_OLD
     16624**DCL     27462<<ASSIGN  28957<<ASSIGN  30025<<ASSIGN  33066>>IF      33069<<ASSIGN
MAIL_CMD
     16153**DCL     16205--DCLINIT
MAIL_CMD$
     16163**DCL     27301<<ASSIGN  27409>>CALL
MAIL_FILE$ IN PROCEDURE COPY_FOLDER
     33512**DCL     33519<<ASSIGN  33616>>IF      33617>>ASSIGN  33618>>ASSIGN
MAIL_FILE$ IN PROCEDURE SORT_FOLDER
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1029 
     33692**DCL     33725<<ASSIGN  34002>>IF      34005>>ASSIGN  34007>>ASSIGN
MAIL_NODES
     16151**DCL     16205--DCLINIT
MAIL_NODES$
     16161**DCL     27300<<ASSIGN  27481>>CALL    27506>>CALL
MAIL_PROG_NAME
     18514**DCL     18450--DCLINIT
MAIL_PROMPT
     16697**DCL     27409<>CALL    27506<>CALL
MAKE_NEW_CONTEXT IN PROCEDURE GET$MESSAGE
     32818**LABEL   32698--GOTO    32779--GOTO
MATCH_FOUND IN PROCEDURE GET_WILD_FOLDER
     31840**LABEL   31838--GOTO
MID IN PROCEDURE SORT_FOLDER
     33708**DCL     33781<<DOINDEX 33782>>IF      33791<<ASSIGN  33792>>IF      33793>>ASSIGN  33795>>IF
     33796>>ASSIGN  33801>>IF      33802<<ASSIGN  33802>>ASSIGN  33803>>IF      33808>>ASSIGN  33810>>CALL
     33810>>CALL    33811>>ASSIGN  33812>>ASSIGN  33859<<DOINDEX 33860>>IF      33861>>ASSIGN  33873<<ASSIGN
     33874>>IF      33875>>ASSIGN  33878>>ASSIGN  33882>>ASSIGN  33889<<ASSIGN  33889>>ASSIGN  33890>>IF
     33903>>DOINDEX 33917<<ASSIGN  33918>>ASSIGN  33924>>ASSIGN  33926>>CALL    33926>>CALL    33927>>ASSIGN
     33928>>ASSIGN  33945<<DOINDEX 33946>>IF      33949>>ASSIGN  33950>>CALL    33950>>CALL    33953>>ASSIGN
     33954>>ASSIGN
MODIFY_LIST
     16154**DCL     16205--DCLINIT
MODIFY_LIST$
     16164**DCL     27302<<ASSIGN  30110>>CALL
MODIFY_USER
     16155**DCL     16205--DCLINIT
MODIFY_USER$
     16165**DCL     27303<<ASSIGN  30240>>CALL
MOD_CASE_END IN PROCEDURE PROCESS_CMD
     30188**LABEL   30077--GOTO
NAME IN PROCEDURE BUILD_LINK_TO_SEND_CMD
     34236**DCL     34209--PROC    34245>>ASSIGN
NAME.L# IN PROCEDURE BUILD_LINK_TO_SEND_CMD
     34236**DCL     34236--IMP-SIZ 34245>>ASSIGN  34270>>ASSIGN
NAME IN PROCEDURE TRANSFORM_DOMAIN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1030 
     34099**DCL     34070--PROC
NAME.L# IN PROCEDURE TRANSFORM_DOMAIN
     34099**DCL     34099--IMP-SIZ 34123>>ASSIGN  34124<<ASSIGN  34124>>ASSIGN  34127>>CALLBLT 34129>>CALLBLT
NAME.NAME# IN PROCEDURE TRANSFORM_DOMAIN
     34099**DCL     34127<<CALLBLT 34129<<CALLBLT
NAME_KEY
     19188**DCL     19074--DCLINIT 19075--DCLINIT 19103--DCLINIT 19140--DCLINIT 19141--DCLINIT 28417--CALL
     30338--CALL
NAME_KEY.L#
     19188**DCL     28397<<ASSIGN  28426<<ASSIGN  30319<<ASSIGN  30350<<ASSIGN  30396<<ASSIGN  31869<<ASSIGN
NAME_KEY.NAME#
     19188**DCL     28395<<CALLBLT 28427<<ASSIGN  28435<>CALL    28442<>CALL    30317<<CALLBLT 30351<<ASSIGN
     30358<>CALL    30363<>CALL    30368<<CALLBLT 30375<>CALL    30379<>CALL    30394<<CALLBLT 31873<<ASSIGN
     31874>>IF
NEED_FOLDER
     31748**PROC    27854--CALL    28014--CALL    28704--CALL    28804--CALL    28893--CALL    29010--CALL
     29026--CALL    29632--CALL    29981--CALL    31149--CALL    31690--CALL
NEED_GLOBAL IN PROCEDURE NEED_FOLDER
     31766**ENTRY   28280--CALL    28602--CALL    30199--CALL
NEED_TITLE_BAR
     16482**DCL     27674<<ASSIGN  32254<<ASSIGN
NEED_UPDATE IN PROCEDURE NEED_FOLDER
     31757**ENTRY   27682--CALL    27705--CALL    27857--CALL    28133--CALL    28549--CALL    28666--CALL
     29457--CALL    30037--CALL    30068--CALL    30537--CALL    30973--CALL    31126--CALL    31155--CALL
     31254--CALL    31287--CALL
NEW_FLAG
     16614**DCL     27501>>IF      27503<<ASSIGN  31693>>IF      31695<<ASSIGN  31701<<ASSIGN  33061<<ASSIGN
     33063<<ASSIGN
NEW_NUM IN PROCEDURE COPY_FOLDER
     33514**DCL     33584<<ASSIGN  33585>>DOWHILE 33586<<ASSIGN  33586>>ASSIGN  33587>>IF      33589>>ASSIGN
NEW_NUM IN PROCEDURE SORT_FOLDER
     33694**DCL     33988>>ASSIGN  33995>>ASSIGN  34059<<ASSIGN
NEXT$ IN PROCEDURE SORT_FOLDER
     33704**DCL     33906<<ASSIGN  33908<<ASSIGN  33910>>IF      33910>>IF      33910>>IF
NEXT_COMMAND_ECHO#
     16890**DCL     27484<<ASSIGN  27488>>IF      27491<<ASSIGN  31330<<ASSIGN  31658<<ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1031 
NEXT_COMMAND_TEXT
     16888**DCL     27544<<ASSIGN  27612<<ASSIGN  27639<<ASSIGN  27817<<ASSIGN  27844<<ASSIGN  29423<<ASSIGN
     29448<<ASSIGN  29664<<ASSIGN  29689<<ASSIGN  29740<<ASSIGN  29765<<ASSIGN  30434<<ASSIGN  30459<<ASSIGN
     30504<<ASSIGN  30529<<ASSIGN  31093<<ASSIGN  31118<<ASSIGN  31190<<ASSIGN  31215<<ASSIGN  31657<<ASSIGN
NEXT_COMMAND_TEXT.L#
     16888**DCL     27477>>IF      27480>>ASSIGN  27485<<ASSIGN  27492<<ASSIGN  29453<<ASSIGN  29694<<ASSIGN
     31321<<ASSIGN  31658>>IF
NEXT_COMMAND_TEXT.NAME#
     16888**DCL     27481<>CALL    27794<<ASSIGN  27795<<ASSIGN  27797>>IF      27824>>IF
NEXT_NUM IN PROCEDURE UPDATE$MAIL
     33102**DCL     33433<<ASSIGN  33437<<ASSIGN  33437>>ASSIGN  33438>>IF      33441<>CALL    33453>>ASSIGN
     33454>>ASSIGN  33545<<ASSIGN  33546<<ASSIGN  33573<<ASSIGN  33573>>ASSIGN  33585>>DOWHILE 33594>>IF
     33602>>IF      33623>>ASSIGN  33642<<ASSIGN  33648<<ASSIGN  33751<<ASSIGN  33752<<ASSIGN  34015<<ASSIGN
     34039<<ASSIGN  34045<<ASSIGN
NIL_PTR IN PROCEDURE SORT_FOLDER
     33945**LABEL   33846--GOTO    33955--EXIT
NODES$
     16273**DCL     16261--IMP-PTR 27299<>CALL    27300>>ASSIGN  27301>>ASSIGN  27302>>ASSIGN  27303>>ASSIGN
     27304>>ASSIGN  27305>>ASSIGN
NODES_TO_USE
     16261**DCL     27300>>ASSIGN  27301>>ASSIGN  27302>>ASSIGN  27303>>ASSIGN  27304>>ASSIGN  27305>>ASSIGN
NONE
     16623**DCL     28670<<ASSIGN  28673<<ASSIGN  28700<>CALL    28921<<ASSIGN  28925<<ASSIGN  29005<>CALL
     30042<<ASSIGN  30045<<ASSIGN  30063<>CALL    31259<<ASSIGN  31262<<ASSIGN  31282<>CALL    31292<<ASSIGN
     31295<<ASSIGN  31313<>CALL
NON_WILD_DEL_LIST IN PROCEDURE PROCESS_CMD
     28582**LABEL   28551--CALLALT
NON_WILD_DEL_USER IN PROCEDURE PROCESS_CMD
     28647**LABEL   28609--CALLALT
NON_WILD_DI_LIST IN PROCEDURE PROCESS_CMD
     28874**LABEL   28840--CALLALT
NON_WILD_DI_USER IN PROCEDURE PROCESS_CMD
     29367**LABEL   29335--CALLALT
NO_FOLD IN PROCEDURE LINK_RUNIT
     32052**LABEL   32034--GOTO
NO_FOLD IN PROCEDURE PROCESS_CMD
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1032 
     31676**LABEL   31376--GOTO    31528--GOTO    31670--GOTO
NO_FOLDER IN PROCEDURE NEED_FOLDER
     31751**LABEL   31758--GOTO    31767--GOTO
NO_FOLD_ERR IN PROCEDURE PROCESS_CMD
     31672**LABEL   31440--CALLALT 31446--GOTO    31488--CALLALT 31498--GOTO    31503--CALLALT
NO_HEADER IN PROCEDURE GET$MESSAGE
     32803**LABEL   32624--GOTO    32723--GOTO    32745--GOTO
NO_MATCH_DI_LIST IN PROCEDURE PROCESS_CMD
     28868**LABEL   28855--CALLALT 28860--GOTO
NO_MATCH_DI_USER IN PROCEDURE PROCESS_CMD
     29361**LABEL   29357--CALLALT
NO_MORE IN PROCEDURE PROCESS_CMD
     29712**LABEL   29704--CALLALT 29706--CALLALT
NO_MORE IN PROCEDURE UPDATE$MAIL
     33384**LABEL   33348--GOTO    33356--CALLALT
NO_PROFILE IN PROCEDURE PROCESS_CMD
     31663**LABEL   31547--CALLALT
NO_SPACE IN PROCEDURE INIT$SELECT_OPTS
     32561**LABEL   32506--CALLALT 32545--CALLALT
NO_UPDATE IN PROCEDURE NEED_FOLDER
     31761**LABEL   31768--GOTO
NULL_ENTRY IN PROCEDURE PROCESS_CMD
     30854**LABEL   30816--GOTO
NUM_MESSAGES_PROCESSED
     18102**DCL     27591>>IF      31649<<ASSIGN  32837<<ASSIGN  32837>>ASSIGN
OLD_MSGNUM IN PROCEDURE GET_NEW_MSGNUM
     34053**DCL     34051--PROC    34057>>IF
OLD_TYPE IN PROCEDURE COPY_FOLDER
     33507**DCL     33544<<ASSIGN  33560>>IF      33562<<ASSIGN
OLD_TYPE IN PROCEDURE SORT_FOLDER
     33687**DCL     33750<<ASSIGN
OPEN_COMMAND_STREAM
     20037**DCL     30935<>CALL
OPEN_COMMAND_STREAM.ACCT_
     20041**DCL     30912<<ASSIGN
OPEN_COMMAND_STREAM.ACSVEH_
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1033 
     20039**DCL     20040--REDEF
OPEN_COMMAND_STREAM.ALTKEYS_
     20045**DCL     20046--REDEF   20046--REDEF
OPEN_COMMAND_STREAM.HDR_
     20044**DCL     20045--REDEF
OPEN_COMMAND_STREAM.NAME_
     20038**DCL     30911<<ASSIGN
OPEN_COMMAND_STREAM.PASS_
     20039**DCL     30915<<ASSIGN
OPEN_COMMAND_STREAM.SN_
     20037**DCL     30918<<ASSIGN
OPEN_COMMAND_STREAM.TAB_
     20043**DCL     20044--REDEF
OPEN_COMMAND_STREAM.UHL_
     20037**DCL     20038--REDEF   20038--REDEF
OPEN_COMMAND_STREAM.V
     20046**DCL     20037--DCLINIT
OPEN_COMMAND_STREAM.V.ASN#
     20056**DCL     30925<<ASSIGN
OPEN_COMMAND_STREAM.V.FSN#
     20077**DCL     20077--REDEF   20077--REDEF
OPEN_COMMAND_STREAM.V.INITZ.SCRUB#
     20047**DCL     30934<<ASSIGN
OPEN_COMMAND_STREAM.V.RES#
     20061**DCL     30924<<ASSIGN
OPEN_COMMAND_STREAM.V.SETDCB#
     20047**DCL     30931<<ASSIGN  30933<<ASSIGN  30937>>IF
OPEN_COMMAND_STREAM.WSN_
     20043**DCL     20043--REDEF   30921<<ASSIGN
OPEN_COMMAND_STREAM_DEFAULT
     19921**DCL     27310<>CALL
OPEN_COMMAND_STREAM_DEFAULT.ACSVEH_
     19923**DCL     19924--REDEF
OPEN_COMMAND_STREAM_DEFAULT.ALTKEYS_
     19929**DCL     19930--REDEF   19930--REDEF
OPEN_COMMAND_STREAM_DEFAULT.HDR_
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1034 
     19928**DCL     19929--REDEF
OPEN_COMMAND_STREAM_DEFAULT.TAB_
     19927**DCL     19928--REDEF
OPEN_COMMAND_STREAM_DEFAULT.UHL_
     19921**DCL     19922--REDEF   19922--REDEF
OPEN_COMMAND_STREAM_DEFAULT.V
     19930**DCL     19921--DCLINIT
OPEN_COMMAND_STREAM_DEFAULT.V.FSN#
     19961**DCL     19961--REDEF   19961--REDEF
OPEN_COMMAND_STREAM_DEFAULT.WSN_
     19927**DCL     19927--REDEF
OPEN_ENCL
     20150**DCL     28758<>CALL
OPEN_ENCL.ACSVEH_
     20152**DCL     20153--REDEF
OPEN_ENCL.ALTKEYS_
     20158**DCL     20159--REDEF   20159--REDEF
OPEN_ENCL.HDR_
     20157**DCL     20158--REDEF
OPEN_ENCL.TAB_
     20156**DCL     20157--REDEF
OPEN_ENCL.UHL_
     20150**DCL     20151--REDEF   20151--REDEF
OPEN_ENCL.V
     20159**DCL     20150--DCLINIT
OPEN_ENCL.V.FSN#
     20190**DCL     20190--REDEF   20190--REDEF
OPEN_ENCL.WSN_
     20156**DCL     20156--REDEF
OPEN_FORWARD_ENCL_FILE
     19554**DCL     29573<>CALL
OPEN_FORWARD_ENCL_FILE.ACSVEH_
     19556**DCL     19557--REDEF
OPEN_FORWARD_ENCL_FILE.ALTKEYS_
     19562**DCL     19563--REDEF   19563--REDEF
OPEN_FORWARD_ENCL_FILE.HDR_
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1035 
     19561**DCL     19562--REDEF
OPEN_FORWARD_ENCL_FILE.TAB_
     19560**DCL     19561--REDEF
OPEN_FORWARD_ENCL_FILE.UHL_
     19554**DCL     19555--REDEF   19555--REDEF
OPEN_FORWARD_ENCL_FILE.V
     19563**DCL     19554--DCLINIT
OPEN_FORWARD_ENCL_FILE.V.FSN#
     19594**DCL     19594--REDEF   19594--REDEF
OPEN_FORWARD_ENCL_FILE.WSN_
     19560**DCL     19560--REDEF
OPEN_FORWARD_FILE
     19435**DCL     29519<>CALL
OPEN_FORWARD_FILE.ACSVEH_
     19437**DCL     19438--REDEF
OPEN_FORWARD_FILE.ALTKEYS_
     19443**DCL     19444--REDEF   19444--REDEF
OPEN_FORWARD_FILE.HDR_
     19442**DCL     19443--REDEF
OPEN_FORWARD_FILE.TAB_
     19441**DCL     19442--REDEF
OPEN_FORWARD_FILE.UHL_
     19435**DCL     19436--REDEF   19436--REDEF
OPEN_FORWARD_FILE.V
     19444**DCL     19435--DCLINIT
OPEN_FORWARD_FILE.V.FSN#
     19475**DCL     19475--REDEF   19475--REDEF
OPEN_FORWARD_FILE.WSN_
     19441**DCL     19441--REDEF
OPEN_NAME_MAP
     19016**DCL     28324<>CALL    28607<>CALL    30316<>CALL    30393<>CALL
OPEN_NAME_MAP.ACSVEH_
     19018**DCL     19019--REDEF
OPEN_NAME_MAP.ALTKEYS_
     19024**DCL     19025--REDEF   19025--REDEF
OPEN_NAME_MAP.HDR_
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1036 
     19023**DCL     19024--REDEF
OPEN_NAME_MAP.TAB_
     19022**DCL     19023--REDEF
OPEN_NAME_MAP.UHL_
     19016**DCL     19017--REDEF   19017--REDEF
OPEN_NAME_MAP.V
     19025**DCL     19016--DCLINIT
OPEN_NAME_MAP.V.FSN#
     19056**DCL     19056--REDEF   19056--REDEF
OPEN_NAME_MAP.WSN_
     19022**DCL     19022--REDEF
OPEN_NEXT
     18895**DCL     31823<>CALL
OPEN_NEXT.ACSVEH_
     18897**DCL     18898--REDEF
OPEN_NEXT.ALTKEYS_
     18903**DCL     18904--REDEF   18904--REDEF
OPEN_NEXT.HDR_
     18902**DCL     18903--REDEF
OPEN_NEXT.NAME_
     18896**DCL     28518<<ASSIGN  28522<<ASSIGN  29881<<ASSIGN  29950<<ASSIGN  31847<<ASSIGN
OPEN_NEXT.TAB_
     18901**DCL     18902--REDEF
OPEN_NEXT.UHL_
     18895**DCL     18896--REDEF   18896--REDEF
OPEN_NEXT.V
     18904**DCL     18895--DCLINIT
OPEN_NEXT.V.FSN#
     18935**DCL     18935--REDEF   18935--REDEF
OPEN_NEXT.WSN_
     18901**DCL     18901--REDEF
OPEN_OUTPUT_STREAM_DEFAULT
     19802**DCL     27318<>CALL
OPEN_OUTPUT_STREAM_DEFAULT.ACSVEH_
     19804**DCL     19805--REDEF
OPEN_OUTPUT_STREAM_DEFAULT.ALTKEYS_
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1037 
     19810**DCL     19811--REDEF   19811--REDEF
OPEN_OUTPUT_STREAM_DEFAULT.HDR_
     19809**DCL     19810--REDEF
OPEN_OUTPUT_STREAM_DEFAULT.TAB_
     19808**DCL     19809--REDEF
OPEN_OUTPUT_STREAM_DEFAULT.UHL_
     19802**DCL     19803--REDEF   19803--REDEF
OPEN_OUTPUT_STREAM_DEFAULT.V
     19811**DCL     19802--DCLINIT
OPEN_OUTPUT_STREAM_DEFAULT.V.FSN#
     19842**DCL     19842--REDEF   19842--REDEF
OPEN_OUTPUT_STREAM_DEFAULT.WSN_
     19808**DCL     19808--REDEF
OPEN_SEND_FILE
     19315**DCL     27756<>CALL    34173<>CALL
OPEN_SEND_FILE.ACSVEH_
     19317**DCL     19318--REDEF
OPEN_SEND_FILE.ALTKEYS_
     19323**DCL     19324--REDEF   19324--REDEF
OPEN_SEND_FILE.HDR_
     19322**DCL     19323--REDEF
OPEN_SEND_FILE.TAB_
     19321**DCL     19322--REDEF
OPEN_SEND_FILE.UHL_
     19315**DCL     19316--REDEF   19316--REDEF
OPEN_SEND_FILE.V
     19324**DCL     19315--DCLINIT
OPEN_SEND_FILE.V.FSN#
     19355**DCL     19355--REDEF   19355--REDEF
OPEN_SEND_FILE.WSN_
     19321**DCL     19321--REDEF
OPT$SEED
     18120**DCL     28939<>CALL    29526<>CALL    29535<>CALL    31038<>CALL
OPT_BYPASS
     18112**DCL     27461<<ASSIGN  31325<<ASSIGN  31395<<ASSIGN  31654>>IF
OPT_FID
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1038 
     18115**DCL     18809--DCLINIT 29773<<ASSIGN  30897<<ASSIGN
OPT_NOUPDATE
     18113**DCL     27460<<ASSIGN  27618>>IF      31324<<ASSIGN  31337<<ASSIGN  31341>>IF      31364<<ASSIGN
     31400<<ASSIGN  31406<<ASSIGN
OPT_RECEIVERS
     18114**DCL     27715<<ASSIGN  27720<<ASSIGN  27722<<ASSIGN  27758>>IF      27763<>CALL
OPT_SEED
     18118**DCL     28894<<ASSIGN  28895--ASSIGN  28901<>CALL    28902>>IF      28928>>IF      29458<<ASSIGN
     29459--ASSIGN  29464<>CALL    29465>>IF      29508>>IF      30974<<ASSIGN  30975--ASSIGN  30980<>CALL
     30981>>IF      31027>>IF
OPT_SEED$
     18119**DCL     18120--IMP-PTR 28895<<ASSIGN  28904<<ASSIGN  28928>>IF      28939>>CALL    29459<<ASSIGN
     29467<<ASSIGN  29508>>IF      29526>>CALL    29535>>CALL    30975<<ASSIGN  30983<<ASSIGN  31027>>IF
     31038>>CALL
OTHER_CRITERIA IN PROCEDURE INIT$SELECT_OPTS
     32434**LABEL   32427--GOTO
OUT$
     16548**DCL     16561--REDEF   27409<>CALL    27416>>ASSIGN  27481<>CALL    27506<>CALL    27508>>IF
     27509>>ASSIGN  27684>>IF      27686>>CALL    27707>>IF      27709>>CALL    27716>>IF      27718>>DOCASE
     27863>>IF      27865>>CALL    27876>>IF      27878>>CALL    27883>>CALL    28015>>IF      28017>>CALL
     28041>>IF      28044>>ASSIGN  28140>>DOINDEX 28141>>ASSIGN  28284>>ASSIGN  28284>>ASSIGN  28299>>CALL
     28299>>CALL    28313>>CALL    28313>>CALL    28329>>DOINDEX 28330>>ASSIGN  28398>>ASSIGN  28398>>ASSIGN
     28407>>IF      28407>>IF      28470>>IF      28473>>ASSIGN  28551>>CALLBLT 28551>>CALLBLT 28553>>ASSIGN
     28553>>ASSIGN  28554>>CALLBLT 28554>>CALLBLT 28554>>CALLBLT 28554>>CALLBLT 28582>>ASSIGN  28582>>ASSIGN
     28609>>CALLBLT 28609>>CALLBLT 28611>>ASSIGN  28611>>ASSIGN  28612>>CALLBLT 28612>>CALLBLT 28612>>CALLBLT
     28612>>CALLBLT 28647>>ASSIGN  28647>>ASSIGN  28667>>CALL    28727>>DOINDEX 28728>>ASSIGN  28807>>IF
     28822>>ASSIGN  28822>>ASSIGN  28833>>IF      28840>>CALLBLT 28840>>CALLBLT 28842>>ASSIGN  28842>>ASSIGN
     28843>>CALLBLT 28843>>CALLBLT 28843>>CALLBLT 28843>>CALLBLT 28850>>ASSIGN  28850>>ASSIGN  28857>>IF
     28857>>IF      28874>>ASSIGN  28874>>ASSIGN  28897>>DOINDEX 28898>>ASSIGN  29011>>IF      29013>>CALL
     29027>>IF      29029>>CALL    29302>>IF      29317>>ASSIGN  29317>>ASSIGN  29328>>IF      29335>>CALLBLT
     29335>>CALLBLT 29337>>ASSIGN  29337>>ASSIGN  29338>>CALLBLT 29338>>CALLBLT 29338>>CALLBLT 29338>>CALLBLT
     29344>>ASSIGN  29344>>ASSIGN  29351>>IF      29351>>IF      29367>>ASSIGN  29367>>ASSIGN  29383>>IF
     29460>>DOINDEX 29461>>ASSIGN  29633>>CALLBLT 29633>>CALLBLT 29699>>ASSIGN  29772>>ASSIGN  29774>>IF
     29778>>ASSIGN  29822>>IF      29827>>ASSIGN  29827>>ASSIGN  29838>>IF      29842>>ASSIGN  29982>>DOINDEX
     29983>>ASSIGN  30038>>IF      30040>>CALL    30072>>ASSIGN  30072>>ASSIGN  30110<>CALL    30127>>IF
     30133>>ASSIGN  30158>>DOCASE  30203>>ASSIGN  30203>>ASSIGN  30204>>ASSIGN  30205>>ASSIGN  30205>>ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1039 
     30240<>CALL    30250>>IF      30264>>ASSIGN  30306>>DOCASE  30468>>CALL    30559>>DOINDEX 30561>>ASSIGN
     30718>>ASSIGN  30881>>IF      30897>>ASSIGN  30897>>ASSIGN  30901>>CALL    30976>>DOINDEX 30977>>ASSIGN
     31127>>IF      31131>>CALL    31151>>CALL    31255>>IF      31257>>CALL    31288>>IF      31290>>CALL
     31334>>DOINDEX 31335>>DOCASE  31365>>DOINDEX 31366>>ASSIGN  34288<>CALL
OUTBUF
     16853**DCL     20310--DCLINIT 20312--DCLINIT 20424--DCLINIT 20426--DCLINIT 20537--DCLINIT 20539--DCLINIT
     27407<<ASSIGN  27409<>CALL
OUTDCB
     16617**DCL     27574>>IF      27576--IF      27578>>ASSIGN  27581<<ASSIGN  28814<>CALL    28827<<ASSIGN
     28864<>CALL    28880<>CALL    28887--IF      28908<<ASSIGN  28932<>CALL    28938<>CALL    28939<>CALL
     29003--IF      29015<<ASSIGN  29022<>CALL    29031<<ASSIGN  29038>>ASSIGN  29309<>CALL    29322<<ASSIGN
     29358<>CALL    29370<>CALL    29375--IF      29832<<ASSIGN  29921>>ASSIGN  29949<>CALL    29962<>CALL
     29990<<ASSIGN  30008<>CALL    30013<>CALL    30031--IF
OUTERR
     16561**DCL     27413<>CALL    27566<>CALL    30114<>CALL    30244<>CALL
OUTERR.ERR#
     16591**DCL     27514>>DOSELCT
P$B
     15409**DCL     28758<>CALL    28825<>CALL    28906<>CALL    29013<>CALL    29029<>CALL    29320<>CALL
     29830<>CALL    29988<>CALL    30468<>CALL
P$B.CODE
     15417**DCL     27416>>ASSIGN  27509>>ASSIGN  27718>>DOCASE  28047>>DOCASE  28204>>DOCASE  28348>>DOCASE
     28359>>DOCASE  28479>>DOCASE  28729>>DOCASE  28823>>IF      28899>>DOCASE  29318>>IF      29462>>DOCASE
     29828>>IF      29848>>DOCASE  29984>>DOCASE  30136>>DOCASE  30158>>DOCASE  30267>>DOCASE  30275>>DOCASE
     30306>>DOCASE  30566>>IF      30573>>IF      30580>>IF      30587>>IF      30594>>IF      30601>>IF
     30608>>IF      30619>>IF      30626>>IF      30633>>IF      30640>>IF      30647>>IF      30661>>IF
     30678>>DOCASE  30697>>IF      30715>>IF      30728>>IF      30744>>IF      30766>>IF      30792>>IF
     30808>>DOCASE  30978>>DOCASE  31131<>CALL    31335>>DOCASE  31367>>DOCASE  32252>>DOCASE  32258>>DOCASE
     32286>>IF      32348>>DOCASE  32360>>IF      32451>>DOSELCT
P$B.CPOS
     15435**DCL     30719>>ASSIGN  32481<>CALL    32556<>CALL
P$B.NSUBLKS
     15421**DCL     27684>>IF      27707>>IF      27716>>IF      27863>>IF      27876>>IF      28015>>IF
     28041>>IF      28045>>DOINDEX 28140>>DOINDEX 28187>>DOINDEX 28202>>DOINDEX 28329>>DOINDEX 28346>>DOINDEX
     28357>>DOINDEX 28470>>IF      28477>>DOINDEX 28727>>DOINDEX 28807>>IF      28822>>ASSIGN  28833>>IF
     28897>>DOINDEX 29011>>IF      29027>>IF      29302>>IF      29317>>ASSIGN  29328>>IF      29383>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1040 
     29460>>DOINDEX 29774>>IF      29822>>IF      29827>>ASSIGN  29838>>IF      29846>>DOINDEX 29982>>DOINDEX
     30038>>IF      30127>>IF      30134>>DOINDEX 30250>>IF      30265>>DOINDEX 30273>>DOINDEX 30559>>DOINDEX
     30676>>DOINDEX 30777>>IF      30795>>DOINDEX 30806>>DOINDEX 30881>>IF      30976>>DOINDEX 31127>>IF
     31255>>IF      31288>>IF      31334>>DOINDEX 31365>>DOINDEX 32242>>IF      32429>>IF      32449>>DOINDEX
     32469>>IF      32494>>IF      34114>>ASSIGN  34122>>DOINDEX
P$B.SUBLK$
     15442**DCL     27686<>CALL    27709<>CALL    27718>>DOCASE  27865<>CALL    27878<>CALL    27883<>CALL
     28017<>CALL    28044>>ASSIGN  28046>>ASSIGN  28141>>ASSIGN  28145>>ASSIGN  28145>>ASSIGN  28152>>CALL
     28152>>CALL    28173>>CALL    28173>>CALL    28188>>ASSIGN  28203>>ASSIGN  28284>>ASSIGN  28284>>ASSIGN
     28299>>CALL    28299>>CALL    28313>>CALL    28313>>CALL    28330>>ASSIGN  28347>>ASSIGN  28358>>ASSIGN
     28398>>ASSIGN  28398>>ASSIGN  28407>>IF      28407>>IF      28473>>ASSIGN  28478>>ASSIGN  28551>>CALLBLT
     28551>>CALLBLT 28553>>ASSIGN  28553>>ASSIGN  28554>>CALLBLT 28554>>CALLBLT 28554>>CALLBLT 28554>>CALLBLT
     28582>>ASSIGN  28582>>ASSIGN  28609>>CALLBLT 28609>>CALLBLT 28611>>ASSIGN  28611>>ASSIGN  28612>>CALLBLT
     28612>>CALLBLT 28612>>CALLBLT 28612>>CALLBLT 28647>>ASSIGN  28647>>ASSIGN  28667<>CALL    28728>>ASSIGN
     28822>>ASSIGN  28840>>CALLBLT 28840>>CALLBLT 28842>>ASSIGN  28842>>ASSIGN  28843>>CALLBLT 28843>>CALLBLT
     28843>>CALLBLT 28843>>CALLBLT 28850>>ASSIGN  28850>>ASSIGN  28857>>IF      28857>>IF      28874>>ASSIGN
     28874>>ASSIGN  28898>>ASSIGN  28901>>CALL    28901>>CALL    29013>>CALL    29029>>CALL    29317>>ASSIGN
     29335>>CALLBLT 29335>>CALLBLT 29337>>ASSIGN  29337>>ASSIGN  29338>>CALLBLT 29338>>CALLBLT 29338>>CALLBLT
     29338>>CALLBLT 29344>>ASSIGN  29344>>ASSIGN  29351>>IF      29351>>IF      29367>>ASSIGN  29367>>ASSIGN
     29461>>ASSIGN  29464>>CALL    29464>>CALL    29633>>CALLBLT 29633>>CALLBLT 29699>>ASSIGN  29772>>ASSIGN
     29778>>ASSIGN  29827>>ASSIGN  29842>>ASSIGN  29847>>ASSIGN  29983>>ASSIGN  30040<>CALL    30072>>ASSIGN
     30072>>ASSIGN  30133>>ASSIGN  30135>>ASSIGN  30203>>ASSIGN  30203>>ASSIGN  30204>>ASSIGN  30205>>ASSIGN
     30205>>ASSIGN  30264>>ASSIGN  30266>>ASSIGN  30274>>ASSIGN  30561>>ASSIGN  30566>>IF      30573>>IF
     30580>>IF      30587>>IF      30594>>IF      30601>>IF      30608>>IF      30615>>CALLBLT 30615>>CALLBLT
     30619>>IF      30626>>IF      30633>>IF      30640>>IF      30647>>IF      30660>>ASSIGN  30677>>ASSIGN
     30697>>IF      30715>>IF      30715>>IF      30715>>IF      30718>>ASSIGN  30718>>ASSIGN  30728>>IF
     30730>>ASSIGN  30731>>ASSIGN  30731>>ASSIGN  30744>>IF      30744>>IF      30747>>ASSIGN  30751>>ASSIGN
     30752>>ASSIGN  30752>>ASSIGN  30766>>IF      30766>>IF      30769>>ASSIGN  30773>>ASSIGN  30774>>ASSIGN
     30774>>ASSIGN  30792>>IF      30796>>ASSIGN  30807>>ASSIGN  30897>>ASSIGN  30897>>ASSIGN  30901>>CALL
     30977>>ASSIGN  30980>>CALL    30980>>CALL    31131>>CALL    31151<>CALL    31257<>CALL    31290<>CALL
     31335>>DOCASE  31366>>ASSIGN  32252>>DOCASE  32258>>DOCASE  32286>>IF      32348>>DOCASE  32360>>IF
     32450>>ASSIGN  32460>>ASSIGN  32472>>ASSIGN  32476>>ASSIGN  34114>>ASSIGN  34124>>ASSIGN  34127>>CALLBLT
     34127>>CALLBLT 34129>>CALLBLT 34129>>CALLBLT
P$S
     15455**DCL     28901<>CALL    29464<>CALL    30980<>CALL
P$S.CODE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1041 
     15461**DCL     30563>>DOCASE
P$S.COUNT
     15478**DCL     15481--IMP-SIZ 28049>>ASSIGN  28051>>ASSIGN  28056>>ASSIGN  28145>>ASSIGN  28206>>ASSIGN
     28208>>ASSIGN  28210>>ASSIGN  28211>>ASSIGN  28213>>ASSIGN  28215>>ASSIGN  28284>>ASSIGN  28350>>ASSIGN
     28352>>ASSIGN  28361>>ASSIGN  28363>>ASSIGN  28365>>ASSIGN  28366>>ASSIGN  28368>>ASSIGN  28370>>ASSIGN
     28398>>ASSIGN  28407>>IF      28481>>ASSIGN  28483>>ASSIGN  28488>>ASSIGN  28551>>CALLBLT 28553>>ASSIGN
     28554>>CALLBLT 28554>>CALLBLT 28582>>ASSIGN  28609>>CALLBLT 28611>>ASSIGN  28612>>CALLBLT 28612>>CALLBLT
     28647>>ASSIGN  28840>>CALLBLT 28842>>ASSIGN  28843>>CALLBLT 28843>>CALLBLT 28850>>ASSIGN  28857>>IF
     28874>>ASSIGN  28901>>CALL    29335>>CALLBLT 29337>>ASSIGN  29338>>CALLBLT 29338>>CALLBLT 29344>>ASSIGN
     29351>>IF      29367>>ASSIGN  29464>>CALL    29633>>CALLBLT 29773>>ASSIGN  29776>>ASSIGN  29777>>ASSIGN
     29779>>IF      29782>>ASSIGN  29785>>CALLBLT 29850>>ASSIGN  29852>>ASSIGN  29857>>ASSIGN  30072>>ASSIGN
     30138>>ASSIGN  30140>>ASSIGN  30142>>ASSIGN  30143>>ASSIGN  30145>>ASSIGN  30147>>ASSIGN  30203>>ASSIGN
     30204>>ASSIGN  30205>>ASSIGN  30269>>ASSIGN  30271>>ASSIGN  30277>>ASSIGN  30279>>ASSIGN  30281>>ASSIGN
     30282>>ASSIGN  30284>>ASSIGN  30286>>ASSIGN  30615>>CALLBLT 30680>>ASSIGN  30682>>ASSIGN  30686>>ASSIGN
     30715>>IF      30730>>ASSIGN  30731>>ASSIGN  30744>>IF      30747>>ASSIGN  30751>>ASSIGN  30752>>ASSIGN
     30766>>IF      30769>>ASSIGN  30773>>ASSIGN  30774>>ASSIGN  30810>>ASSIGN  30812>>ASSIGN  30814>>ASSIGN
     30815>>ASSIGN  30818>>ASSIGN  30897>>ASSIGN  30980>>CALL    34115>>IF      34121>>ASSIGN  34124>>ASSIGN
     34127>>CALLBLT 34129>>CALLBLT
P$S.CPOS
     15470**DCL     30901<>CALL
P$S.TEXT
     15481**DCL     28049>>ASSIGN  28051>>ASSIGN  28056>>ASSIGN  28145>>ASSIGN  28206>>ASSIGN  28208>>ASSIGN
     28210>>ASSIGN  28213>>ASSIGN  28215>>ASSIGN  28284>>ASSIGN  28350>>ASSIGN  28352>>ASSIGN  28361>>ASSIGN
     28363>>ASSIGN  28365>>ASSIGN  28368>>ASSIGN  28370>>ASSIGN  28398--ASSIGN  28407>>IF      28481>>ASSIGN
     28483>>ASSIGN  28488>>ASSIGN  28551>>CALLBLT 28553--ASSIGN  28554<<CALLBLT 28554>>CALLBLT 28582>>ASSIGN
     28609>>CALLBLT 28611--ASSIGN  28612<<CALLBLT 28612>>CALLBLT 28647>>ASSIGN  28840>>CALLBLT 28842--ASSIGN
     28843<<CALLBLT 28843>>CALLBLT 28850>>ASSIGN  28857>>IF      28874>>ASSIGN  29335>>CALLBLT 29337--ASSIGN
     29338<<CALLBLT 29338>>CALLBLT 29344>>ASSIGN  29351>>IF      29367>>ASSIGN  29633>>CALLBLT 29773>>ASSIGN
     29777>>ASSIGN  29785>>CALLBLT 29850>>ASSIGN  29852>>ASSIGN  29857>>ASSIGN  30072>>ASSIGN  30138>>ASSIGN
     30140>>ASSIGN  30142>>ASSIGN  30145>>ASSIGN  30147>>ASSIGN  30203>>ASSIGN  30205>>ASSIGN  30269>>ASSIGN
     30271>>ASSIGN  30277>>ASSIGN  30279>>ASSIGN  30281>>ASSIGN  30284>>ASSIGN  30286>>ASSIGN  30615>>CALLBLT
     30680>>ASSIGN  30682>>ASSIGN  30686>>ASSIGN  30731>>ASSIGN  30752>>ASSIGN  30774>>ASSIGN  30810>>ASSIGN
     30812>>ASSIGN  30815>>ASSIGN  30818>>ASSIGN  30897>>ASSIGN  34121>>ASSIGN  34127>>CALLBLT 34129>>CALLBLT
P$S.TEXTC$
     15473**DCL     28152>>CALL    28152>>CALL    28173>>CALL    28173>>CALL    28299>>CALL    28299>>CALL
     28313>>CALL    28313>>CALL    28731>>CALLBLT 28731>>CALLBLT 29699>>ASSIGN  32460>>ASSIGN  32472>>ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1042 
     34117>>CALL    34117>>CALL
PAGESIZE
     16606**DCL     28735>>ASSIGN  29584>>ASSIGN
PRINT_HEADER#
     16852**DCL     27896<<ASSIGN  27916>>IF
PRINT_LDEV
     20241**DCL     30479<>CALL
PRINT_LDEV.V
     20243**DCL     20241--DCLINIT
PROCESS_CMD
     27665**PROC    27468--CALL    27511--CALL
PROCESS_INVERSE IN PROCEDURE GET$MESSAGE
     32726**LABEL   32597--GOTO
PROCESS_MODLIST_SUBC IN PROCEDURE PROCESS_CMD
     30158**LABEL   30129--GOTO
PTR1$
     16595**DCL     28046<<ASSIGN  28047>>DOCASE  28049>>ASSIGN  28049>>ASSIGN  28051>>ASSIGN  28051>>ASSIGN
     28056>>ASSIGN  28056>>ASSIGN  28478<<ASSIGN  28479>>DOCASE  28481>>ASSIGN  28481>>ASSIGN  28483>>ASSIGN
     28483>>ASSIGN  28488>>ASSIGN  28488>>ASSIGN  28728<<ASSIGN  28729>>DOCASE  28731>>CALLBLT 28731>>CALLBLT
     28758>>CALL    29847<<ASSIGN  29848>>DOCASE  29850>>ASSIGN  29850>>ASSIGN  29852>>ASSIGN  29852>>ASSIGN
     29857>>ASSIGN  29857>>ASSIGN  30677<<ASSIGN  30678>>DOCASE  30680>>ASSIGN  30680>>ASSIGN  30682>>ASSIGN
     30682>>ASSIGN  30686>>ASSIGN  30686>>ASSIGN  30807<<ASSIGN  30808>>DOCASE  30810>>ASSIGN  30810>>ASSIGN
     30812>>ASSIGN  30812>>ASSIGN  30814>>ASSIGN  30815>>ASSIGN  30815>>ASSIGN  30818>>ASSIGN  30818>>ASSIGN
     31868<<ASSIGN  31871<>CALL
PTR1$ IN PROCEDURE INIT$SELECT_OPTS
     32228**DCL     32450<<ASSIGN  32451>>DOSELCT 32460>>ASSIGN  32469>>IF      32472>>ASSIGN  32476<<ASSIGN
     32476>>ASSIGN  32481>>CALL    32506<>CALL    32556>>CALL
PTR2$
     16596**DCL     28188<<ASSIGN  28202>>DOINDEX 28203>>ASSIGN  28347<<ASSIGN  28348>>DOCASE  28350>>ASSIGN
     28350>>ASSIGN  28352>>ASSIGN  28352>>ASSIGN  28357>>DOINDEX 28358>>ASSIGN  30133<<ASSIGN  30134>>DOINDEX
     30135>>ASSIGN  30266<<ASSIGN  30267>>DOCASE  30269>>ASSIGN  30269>>ASSIGN  30271>>ASSIGN  30271>>ASSIGN
     30273>>DOINDEX 30274>>ASSIGN
PTR2$ IN PROCEDURE INIT$SELECT_OPTS
     32229**DCL     32460<<ASSIGN  32461<>CALL    32472<<ASSIGN  32473<>CALL
PTR3$
     16597**DCL     28203<<ASSIGN  28204>>DOCASE  28206>>ASSIGN  28206>>ASSIGN  28208>>ASSIGN  28208>>ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1043 
     28210>>ASSIGN  28210>>ASSIGN  28211>>ASSIGN  28213>>ASSIGN  28213>>ASSIGN  28215>>ASSIGN  28215>>ASSIGN
     28217>>ASSIGN  28358<<ASSIGN  28359>>DOCASE  28361>>ASSIGN  28361>>ASSIGN  28363>>ASSIGN  28363>>ASSIGN
     28365>>ASSIGN  28365>>ASSIGN  28366>>ASSIGN  28368>>ASSIGN  28368>>ASSIGN  28370>>ASSIGN  28370>>ASSIGN
     28372>>ASSIGN  30135<<ASSIGN  30136>>DOCASE  30138>>ASSIGN  30138>>ASSIGN  30140>>ASSIGN  30140>>ASSIGN
     30142>>ASSIGN  30142>>ASSIGN  30143>>ASSIGN  30145>>ASSIGN  30145>>ASSIGN  30147>>ASSIGN  30147>>ASSIGN
     30149>>ASSIGN  30274<<ASSIGN  30275>>DOCASE  30277>>ASSIGN  30277>>ASSIGN  30279>>ASSIGN  30279>>ASSIGN
     30281>>ASSIGN  30281>>ASSIGN  30282>>ASSIGN  30284>>ASSIGN  30284>>ASSIGN  30286>>ASSIGN  30286>>ASSIGN
     30288>>ASSIGN
PTR4$
     16598**DCL     16600--REDEF   30758<<ASSIGN  30759>>IF      30794<<ASSIGN  30795>>DOINDEX 30796>>ASSIGN
PTR4R$.SEGID
     16602**DCL     30759>>IF
PUT_AT_END_CHAR IN PROCEDURE SORT_FOLDER
     33932**LABEL   33855--GOTO    33867--GOTO    33891--GOTO    33896--GOTO
PUT_AT_END_UBIN IN PROCEDURE SORT_FOLDER
     33814**LABEL   33777--GOTO    33785--GOTO    33804--GOTO
PUT_PROFILE
     32893**PROC    27899--CALL    28080--CALL    28693--CALL    28963--CALL    28981--CALL    29388--CALL
     29806--CALL    30026--CALL    30866--CALL    30873--CALL    31276--CALL    31346--CALL    31976--CALL
     33334--CALL
P_PCB
     15504**DCL     16086--DCLINIT
P_PCB.NCHARS
     15651**DCL     16487--IMP-SIZ 30720>>ASSIGN  30725>>ASSIGN  30725>>ASSIGN  31159>>ASSIGN  31160>>ASSIGN
P_PCB.TEXT$
     15505**DCL     16487--IMP-PTR 30725>>ASSIGN  31160>>ASSIGN
READCMD_ERR IN PROCEDURE PROCESS_CMD
     30952**LABEL   30940--GOTO
READ_AGAIN IN PROCEDURE COPY_FOLDER
     33548**LABEL   33556--GOTO
READ_AGAIN_1 IN PROCEDURE SORT_FOLDER
     33754**LABEL   33762--GOTO
READ_LOOP IN PROCEDURE COPY_FOLDER
     33547**LABEL   33549--EXIT
READ_NAME_MAP
     19140**DCL     28404<>CALL    30325<>CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1044 
READ_NAME_MAP.STATION_
     19143**DCL     19144--REDEF
READ_NAME_MAP.V
     19144**DCL     19140--DCLINIT
READ_NAME_MAP.V.DVBYTE.REREAD#
     19155**DCL     19155--REDEF
READ_NAME_MAP.V.INDX#
     19153**DCL     19153--REDEF
READ_OLD IN PROCEDURE UPDATE$MAIL
     33241**DCL     33548<>CALL    33754<>CALL    33970<>CALL
READ_OLD.BUF_ IN PROCEDURE UPDATE$MAIL
     33243**DCL     33543<<ASSIGN  33553<<ASSIGN  33749<<ASSIGN  33759<<ASSIGN
READ_OLD.STATION_ IN PROCEDURE UPDATE$MAIL
     33244**DCL     33245--REDEF
READ_OLD.V IN PROCEDURE UPDATE$MAIL
     33245**DCL     33241--DCLINIT
READ_OLD.V.DVBYTE.REREAD# IN PROCEDURE UPDATE$MAIL
     33256**DCL     33256--REDEF
READ_OLD.V.INDX# IN PROCEDURE UPDATE$MAIL
     33254**DCL     33254--REDEF
READ_PROFILE IN PROCEDURE PUT_PROFILE
     32913**DCL     33055<>CALL
READ_PROFILE.BUF_ IN PROCEDURE PUT_PROFILE
     32915**DCL     33050<<ASSIGN
READ_PROFILE.STATION_ IN PROCEDURE PUT_PROFILE
     32916**DCL     32917--REDEF
READ_PROFILE.V IN PROCEDURE PUT_PROFILE
     32917**DCL     32913--DCLINIT
READ_PROFILE.V.DCB# IN PROCEDURE PUT_PROFILE
     32917**DCL     33049<<ASSIGN
READ_PROFILE.V.DVBYTE.REREAD# IN PROCEDURE PUT_PROFILE
     32928**DCL     32928--REDEF
READ_PROFILE.V.INDX# IN PROCEDURE PUT_PROFILE
     32926**DCL     32926--REDEF
RECS_DELETED IN PROCEDURE UPDATE$MAIL
     33103**DCL     33336<<ASSIGN  33364<<ASSIGN  33364>>ASSIGN  33387>>ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1045 
RELATIVE_FUNCTIONS IN PROCEDURE INIT$SELECT_OPTS
     32258**LABEL   32324--EXIT    32398--EXIT
RELEASE_GRANULES IN PROCEDURE UPDATE$MAIL
     33463**LABEL   33411--GOTO
RENUMBER# IN PROCEDURE UPDATE$MAIL
     33104**DCL     33092--PROC    33393>>IF      33545>>IF      33567>>IF      33751>>IF
RENUMBER_LOOP IN PROCEDURE SORT_FOLDER
     33968**LABEL   33973--EXIT
RENUM_OPEN IN PROCEDURE UPDATE$MAIL
     33176**DCL     33535<>CALL    33542<>CALL    33741<>CALL    33748<>CALL
RENUM_OPEN.ACCT_ IN PROCEDURE UPDATE$MAIL
     33180**DCL     33528<<ASSIGN  33734<<ASSIGN
RENUM_OPEN.ACSVEH_ IN PROCEDURE UPDATE$MAIL
     33178**DCL     33179--REDEF
RENUM_OPEN.ALTKEYS_ IN PROCEDURE UPDATE$MAIL
     33184**DCL     33185--REDEF   33185--REDEF
RENUM_OPEN.FPARAM_ IN PROCEDURE UPDATE$MAIL
     33181**DCL     33531<<ASSIGN  33537<<ASSIGN  33737<<ASSIGN  33743<<ASSIGN
RENUM_OPEN.HDR_ IN PROCEDURE UPDATE$MAIL
     33183**DCL     33184--REDEF
RENUM_OPEN.IFPARAM_ IN PROCEDURE UPDATE$MAIL
     33181**DCL     33534<<ASSIGN  33538<<ASSIGN  33740<<ASSIGN  33744<<ASSIGN
RENUM_OPEN.NAME_ IN PROCEDURE UPDATE$MAIL
     33177**DCL     33524<<ASSIGN  33730<<ASSIGN
RENUM_OPEN.PASS_ IN PROCEDURE UPDATE$MAIL
     33178**DCL     33529<<ASSIGN  33735<<ASSIGN
RENUM_OPEN.TAB_ IN PROCEDURE UPDATE$MAIL
     33182**DCL     33183--REDEF
RENUM_OPEN.UHL_ IN PROCEDURE UPDATE$MAIL
     33176**DCL     33177--REDEF   33177--REDEF
RENUM_OPEN.V IN PROCEDURE UPDATE$MAIL
     33185**DCL     33176--DCLINIT
RENUM_OPEN.V.ACS# IN PROCEDURE UPDATE$MAIL
     33196**DCL     33530<<ASSIGN  33736<<ASSIGN
RENUM_OPEN.V.DCB# IN PROCEDURE UPDATE$MAIL
     33185**DCL     33532<<ASSIGN  33536<<ASSIGN  33738<<ASSIGN  33742<<ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1046 
RENUM_OPEN.V.EXIST# IN PROCEDURE UPDATE$MAIL
     33189**DCL     33540<<ASSIGN  33746<<ASSIGN
RENUM_OPEN.V.FSN# IN PROCEDURE UPDATE$MAIL
     33216**DCL     33216--REDEF   33216--REDEF
RENUM_OPEN.V.FUN# IN PROCEDURE UPDATE$MAIL
     33195**DCL     33533<<ASSIGN  33539<<ASSIGN  33739<<ASSIGN  33745<<ASSIGN
RENUM_OPEN.V.ORG# IN PROCEDURE UPDATE$MAIL
     33196**DCL     33541<<ASSIGN  33747<<ASSIGN
RENUM_OPEN.WSN_ IN PROCEDURE UPDATE$MAIL
     33182**DCL     33182--REDEF
REOPENED_FOLDER
     16621**DCL     31322<<ASSIGN  31377<<ASSIGN  31563>>IF
REOPEN_FILE
     19664**DCL     29618<>CALL    31058<>CALL
REOPEN_FILE.ACSVEH_
     19666**DCL     19667--REDEF
REOPEN_FILE.ALTKEYS_
     19672**DCL     19673--REDEF   19673--REDEF
REOPEN_FILE.HDR_
     19671**DCL     19672--REDEF
REOPEN_FILE.TAB_
     19670**DCL     19671--REDEF
REOPEN_FILE.UHL_
     19664**DCL     19665--REDEF   19665--REDEF
REOPEN_FILE.V
     19673**DCL     19664--DCLINIT
REOPEN_FILE.V.DCB#
     19673**DCL     29617<<ASSIGN  31057<<ASSIGN
REOPEN_FILE.V.FSN#
     19704**DCL     19704--REDEF   19704--REDEF
REOPEN_FILE.WSN_
     19670**DCL     19670--REDEF
REPARSE IN PROCEDURE PROCESS_CMD
     30092**LABEL   30115--GOTO    30152--CALLALT
REPARSE_USER IN PROCEDURE PROCESS_CMD
     30240**LABEL   30245--GOTO    30293--CALLALT 30342--GOTO    30384--GOTO
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1047 
REPORT_ACTIVITY
     32085**PROC    27701--CALL    27789--CALL    27977--CALL    27980--CALL    28026--CALL    28545--CALL
     28598--CALL    28662--CALL    28700--CALL    28798--CALL    28800--CALL    28889--CALL    29005--CALL
     29377--CALL    29625--CALL    29977--CALL    30033--CALL    30063--CALL    31065--CALL    31282--CALL
     31313--CALL
RESET_#1
     18347**DCL     27228<>CALL
RESET_#1.V
     18348**DCL     18347--DCLINIT
RESET_#1_CMD
     18352**DCL     18347--DCLINIT
RESET_#2
     18370**DCL     27233<>CALL
RESET_#2.V
     18371**DCL     18370--DCLINIT
RESET_#2_CMD
     18375**DCL     18370--DCLINIT
RESET_#3
     18393**DCL     27238<>CALL
RESET_#3.V
     18394**DCL     18393--DCLINIT
RESET_#3_CMD
     18398**DCL     18393--DCLINIT
RESET_#4
     18416**DCL     27243<>CALL
RESET_#4.V
     18417**DCL     18416--DCLINIT
RESET_#4_CMD
     18421**DCL     18416--DCLINIT
RESULT$ IN PROCEDURE GET$MESSAGE
     32581**DCL     32648<>CALL    32650<>CALL    32665<>CALL    32673<>CALL    32759<>CALL    32761<>CALL
RETURN_MESSAGE IN PROCEDURE GET$MESSAGE
     32824**LABEL   32703--GOTO    32784--GOTO
SELECT_CURRENT
     16619**DCL     31144<<ASSIGN  31150<<ASSIGN  31646<<ASSIGN  32455<<ASSIGN  32612>>IF      32734>>IF
     32824>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1048 
SELECT_FIRST IN PROCEDURE INIT$SELECT_OPTS
     32333**LABEL   32289--GOTO
SELECT_LAST IN PROCEDURE INIT$SELECT_OPTS
     32407**LABEL   32363--GOTO
SEND_CMD
     16152**DCL     16208--DCLINIT
SEND_CMD$
     16162**DCL     27304<<ASSIGN  34288>>CALL
SET_XCON
     18544**DCL     27312<>CALL
SET_XCON.V
     18545**DCL     18544--DCLINIT
SITE$ IN PROCEDURE TRANSFORM_DOMAIN
     34102**DCL     34114<<ASSIGN  34115>>IF      34117>>CALL    34117>>CALL    34121>>ASSIGN  34121>>ASSIGN
SITENAME IN PROCEDURE TRANSFORM_DOMAIN
     34073**DCL     34070--PROC    34115--IF      34121<<ASSIGN
SIZE
     16855**DCL     27408<<ASSIGN  27409<>CALL    30204<<ASSIGN  30320>>ASSIGN  34277<<ASSIGN  34278>>ASSIGN
     34278>>ASSIGN  34279>>ASSIGN  34281<<ASSIGN  34281>>ASSIGN  34282>>ASSIGN  34288<>CALL    34302<<ASSIGN
     34303>>ASSIGN  34303>>ASSIGN  34304>>ASSIGN  34305<<ASSIGN  34305>>ASSIGN  34306>>ASSIGN
SIZE IN PROCEDURE SORT_FOLDER
     33695**DCL     33696--IMP-SIZ 33808<<ASSIGN  33810>>CALL    33810>>CALL    33810<>CALL    33924<<ASSIGN
     33926<>CALL    33949<<ASSIGN  33950<>CALL
SORT_FOLDER IN PROCEDURE UPDATE$MAIL
     33654**PROC    33451--CALL
SORT_LOOP IN PROCEDURE SORT_FOLDER
     33753**LABEL   33755--EXIT
SPLIT_CHAR IN PROCEDURE SORT_FOLDER
     33871**LABEL   33886--GOTO    33898--GOTO
SPLIT_UBIN IN PROCEDURE SORT_FOLDER
     33789**LABEL   33800--GOTO
SR_LOOP IN PROCEDURE COPY_FOLDER
     33600**LABEL   33605--EXIT
START_BLK IN PROCEDURE INIT$SELECT_OPTS
     32234**DCL     32241<<ASSIGN  32431<<ASSIGN  32449>>DOINDEX 32494>>IF
STASH IN PROCEDURE SORT_FOLDER
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1049 
     33701**DCL     33837<>CALL    33837<>CALL
STASH$ IN PROCEDURE SORT_FOLDER
     33702**DCL     33721<<ASSIGN  33722>>ASSIGN  33836>>ASSIGN  33837>>CALL    33840<<ASSIGN  33840>>ASSIGN
     33841>>ASSIGN  33861>>ASSIGN  33875>>ASSIGN  33904>>ASSIGN  33906>>ASSIGN  33908>>ASSIGN  33918>>ASSIGN
     33929>>ASSIGN  33938>>ASSIGN
STASH_LEN IN PROCEDURE SORT_FOLDER
     33700**DCL     33701--IMP-SIZ 33723<<ASSIGN  33837>>CALL    33837>>CALL    33837<>CALL    33848>>IF
     33928>>ASSIGN  33929>>ASSIGN  33932<<ASSIGN  33932>>ASSIGN  33937>>ASSIGN  33938>>ASSIGN  33941<<ASSIGN
     33941>>ASSIGN
STATUS_SAVE IN PROCEDURE GET$MESSAGE
     32582**DCL     32659<<ASSIGN  32669>>ASSIGN  32672>>ASSIGN
SUBSTITUTE# IN PROCEDURE REPORT_ACTIVITY
     32114**DCL     32085--PROC    32117>>IF
SYSACCT
     19238**DCL     18451--DCLINIT 34332--ASSIGN
TEMP
     18110**DCL     30615<<CALLBLT 30616>>ASSIGN
TEMP$ IN PROCEDURE SORT_FOLDER
     33703**DCL     33836<<ASSIGN  33837>>CALL    33861<<ASSIGN  33862>>IF      33862>>IF      33862>>IF
     33875<<ASSIGN  33876>>IF      33876>>IF      33876>>IF      33880>>IF      33880>>IF      33880>>IF
     33887>>IF      33887>>IF      33887>>IF      33904<<ASSIGN  33910>>IF      33910>>IF      33910>>IF
     33918<<ASSIGN  33929<<ASSIGN  33930>>ASSIGN  33931>>ASSIGN  33931>>ASSIGN  33938<<ASSIGN  33939>>ASSIGN
     33940>>ASSIGN  33940>>ASSIGN
TEMPBUF
     16854**DCL     30203<<ASSIGN  30320--ASSIGN
TEMPLATE IN PROCEDURE SORT_FOLDER
     33696**DCL     33810<>CALL    33810<>CALL
TRANSFORM_DOMAIN
     34070**PROC    28220--CALL    28377--CALL    30152--CALL    30293--CALL
UPDATE$MAIL
     33092**PROC    29385--CALL    31129--CALL    31131--CALL    31343--CALL
USER_NAME
     23290**DCL     27324<>CALL    27357<>CALL    27360<>CALL    27763<>CALL    27878<>CALL    27883<>CALL
     31370<>CALL    31418<>CALL    31423<>CALL    31488<>CALL    31503<>CALL    34174<>CALL
USER_NAME.L#
     23290**DCL     27323<<ASSIGN  28237>>ASSIGN  31500<<ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1050 
USER_NAME.NAME#
     23290**DCL     27323--ASSIGN  28229>>IF      28232>>ASSIGN  28238>>ASSIGN  28989>>IF      31498>>IF
     31501<<ASSIGN  31502<<ASSIGN
VALUE IN PROCEDURE GET$MESSAGE
     32580**DCL     32650<>CALL    32651>>IF      32673<>CALL    32675>>IF      32761<>CALL    32762>>IF
VALUE IN PROCEDURE REPORT_ACTIVITY
     32086**DCL     32085--PROC    32117>>IF      32149--ASSIGN
VALUE1 IN PROCEDURE INIT$SELECT_OPTS
     32230**DCL     32461<>CALL    32462>>IF      32465>>ASSIGN  32479>>IF      32488>>ASSIGN
VALUE2 IN PROCEDURE INIT$SELECT_OPTS
     32231**DCL     32473<>CALL    32474>>IF      32479>>IF      32485>>ASSIGN
VECT_ARRAY
     20620**DCL     20322--DCLINIT 20436--DCLINIT 20549--DCLINIT 27424<<ASSIGN  29043<<ASSIGN  29098<<ASSIGN
     29127<<ASSIGN  29161<<ASSIGN  29215<<ASSIGN  29242<<ASSIGN  29269<<ASSIGN  29296<<ASSIGN  29918<<ASSIGN
     29919<<ASSIGN  31248<<ASSIGN  31573<<ASSIGN  31629<<ASSIGN  32149<<ASSIGN
VLP_KEY IN PROCEDURE UPDATE$MAIL
     33296**DCL     33241--DCLINIT 33242--DCLINIT 33282--DCLINIT 34008--ASSIGN
VLP_KEY.NUM IN PROCEDURE UPDATE$MAIL
     33299**DCL     33574>>ASSIGN  33575<<ASSIGN  33595>>IF      33596<<ASSIGN  33597>>IF      33600>>DOWHILE
     33607>>IF      33608<<ASSIGN  33609>>IF      33811>>ASSIGN  33817>>ASSIGN  33927>>ASSIGN  33936>>ASSIGN
     33953>>ASSIGN  33993>>ASSIGN  33995<<ASSIGN
VLP_KEY.TYPE IN PROCEDURE UPDATE$MAIL
     33298**DCL     33560>>IF      33562>>ASSIGN  33569>>DOCASE  33766>>IF      33978>>DOCASE
VM$CONTEXT
     18044**DCL     29073<>CALL    29102<>CALL
VM$CONTEXT.FLAGS
     18053**DCL     32193<<ASSIGN  32822<<ASSIGN
VM$CONTEXT.FLAGS.INVERSE
     18054**DCL     32424<<ASSIGN  32595>>IF
VM$CONTEXT.FLAGS.NEXT
     18056**DCL     32351<<ASSIGN  32695>>IF
VM$CONTEXT.FLAGS.PREV
     18058**DCL     32423<<ASSIGN  32776>>IF
VM$CONTEXT.MESSAGE_POINTER
     18045**DCL     29130>>IF      29161--ASSIGN  29639<<ASSIGN  31143<<ASSIGN  31647<<ASSIGN  32190<<ASSIGN
     32274<<ASSIGN  32274>>ASSIGN  32275>>ASSIGN  32276>>ASSIGN  32286>>IF      32294>>IF      32294>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1051 
     32301>>IF      32308>>ASSIGN  32360>>IF      32368>>IF      32368>>IF      32375>>IF      32382>>ASSIGN
     32528<<ASSIGN  32528>>ASSIGN  32612<<ASSIGN  32688<<ASSIGN  32734<<ASSIGN  32769<<ASSIGN  32824<<ASSIGN
VM$CONTEXT.MESSAGE_SET.HIGH
     18064**DCL     28716>>IF      31141<<ASSIGN  31644<<ASSIGN  32208>>IF      32212<<ASSIGN  32265<<ASSIGN
     32265>>ASSIGN  32276<<ASSIGN  32294>>IF      32301>>IF      32310<<ASSIGN  32310>>ASSIGN  32335<<ASSIGN
     32335>>ASSIGN  32343<<ASSIGN  32343>>ASSIGN  32368>>IF      32382<<ASSIGN  32410<<ASSIGN  32410>>ASSIGN
     32418<<ASSIGN  32418>>ASSIGN  32457<<ASSIGN  32485<<ASSIGN  32488<<ASSIGN  32499<<ASSIGN  32499>>ASSIGN
     32518<<ASSIGN  32533<<ASSIGN  32533>>ASSIGN  32604>>IF      32636>>IF      32747>>IF      32796>>ASSIGN
     32821<<ASSIGN
VM$CONTEXT.MESSAGE_SET.LOW
     18062**DCL     28716>>IF      31140<<ASSIGN  31643<<ASSIGN  32208>>IF      32263<<ASSIGN  32263>>ASSIGN
     32275<<ASSIGN  32294>>IF      32308<<ASSIGN  32333<<ASSIGN  32333>>ASSIGN  32341<<ASSIGN  32341>>ASSIGN
     32368>>IF      32375>>IF      32384<<ASSIGN  32384>>ASSIGN  32408<<ASSIGN  32408>>ASSIGN  32416<<ASSIGN
     32416>>ASSIGN  32456<<ASSIGN  32465<<ASSIGN  32498<<ASSIGN  32498>>ASSIGN  32503--ASSIGN  32517<<ASSIGN
     32531<<ASSIGN  32531>>ASSIGN  32541--ASSIGN  32604>>IF      32636>>IF      32717>>ASSIGN  32747>>IF
     32820<<ASSIGN
VM$CONTEXT.NUM_ENTRIES
     18049**DCL     31142<<ASSIGN  31639<<ASSIGN  31645<<ASSIGN  32192<<ASSIGN  32208>>IF      32262>>DOINDEX
     32268<<ASSIGN  32268>>ASSIGN  32277<<ASSIGN  32293>>DOINDEX 32312<<ASSIGN  32321>>IF      32337<<ASSIGN
     32340>>DOINDEX 32341>>ASSIGN  32343>>ASSIGN  32345<<ASSIGN  32345>>ASSIGN  32367>>DOINDEX 32386<<ASSIGN
     32407>>ASSIGN  32412<<ASSIGN  32420<<ASSIGN  32420>>ASSIGN  32458<<ASSIGN  32489<<ASSIGN  32489>>ASSIGN
     32497<<ASSIGN  32497>>ASSIGN  32503>>ASSIGN  32514>>IF      32519<<ASSIGN  32529<<ASSIGN  32529>>ASSIGN
     32530>>DOINDEX 32541>>ASSIGN  32588>>IF      32601>>DOWHILE 32620>>IF      32729>>ASSIGN  32818<<ASSIGN
VM$CONTEXT.SET_INDX
     18051**DCL     27672<<ASSIGN  27673<<ASSIGN  32598>>IF      32601>>DOWHILE 32604>>IF      32604>>IF
     32620>>IF      32636>>IF      32636>>IF      32710<<ASSIGN  32710>>ASSIGN  32717>>ASSIGN  32726>>IF
     32729<<ASSIGN  32732>>DOWHILE 32742>>IF      32747>>IF      32747>>IF      32791<<ASSIGN  32791>>ASSIGN
     32796>>ASSIGN  32819<<ASSIGN
VM$CONTEXT.TRUTH_TREE$
     18047**DCL     28716>>IF      32191<<ASSIGN  32269<<ASSIGN  32269>>ASSIGN  32347<<ASSIGN  32347>>ASSIGN
     32422<<ASSIGN  32422>>ASSIGN  32506<>CALL    32536>>IF      32545<>CALL    32545<>CALL    32549<<ASSIGN
     32645>>IF      32648<>CALL    32665<>CALL    32756>>IF      32759<>CALL
VM$RADDRESS
     17398**DCL     30656--ASSIGN  30694<<ASSIGN  30841<<ASSIGN
VM$RADDRESS.ACCT
     17421**DCL     27370>>IF      31549>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1052 
VM$RADDRESS.FOLDER
     17413**DCL     17414--REDEF   27370>>IF      31549>>IF
VM$UADDRESS.FOLDER
     17449**DCL     17450--REDEF
VM$UADDRESS.TYPE
     17446**DCL     30845<<ASSIGN
VM$UADDRESS.USER_NAME.COUNT
     17458**DCL     30847<<ASSIGN
VM$UADDRESS.USER_NAME.TEXT
     17459**DCL     30849<<CALLBLT
VMA$ADD_RENTRY_SORTED
     16391**DCL-ENT 28249--CALL    28442--CALL    30166--CALL    30363--CALL
VMA$ADD_UENTRY_SORTED
     16392**DCL-ENT 28244--CALL    28435--CALL    30163--CALL    30358--CALL
VMA$DEL_LIST
     16394**DCL-ENT 28566--CALL    28583--CALL    28631--CALL    28651--CALL
VMA$DEL_RENTRY
     16395**DCL-ENT 30180--CALL    30379--CALL
VMA$DEL_UENTRY
     16396**DCL-ENT 30176--CALL    30375--CALL
VMA$ENLARGE_SEGMENT
     16397**DCL-ENT 27276--CALL    27277--CALL    27278--CALL    27279--CALL    27280--CALL    27281--CALL
     30545--CALL    30835--CALL    33552--CALL    33578--CALL    33720--CALL    33758--CALL    33772--CALL
     33835--CALL    33851--CALL    34029--CALL
VMA$GET_ADD_RECORD
     16473**DCL-ENT 28732--CALL
VMA$GET_LIST
     16400**DCL-ENT 28146--CALL    28167--CALL    28293--CALL    28307--CALL    28648--CALL    28876--CALL
     29368--CALL    30073--CALL    30206--CALL
VMA$GET_LIST_NEXT
     16402**DCL-ENT 28558--CALL    28574--CALL    28616--CALL    28639--CALL    28812--CALL    28855--CALL
     29307--CALL    29349--CALL
VMA$GET_NEXT_ENTRY
     16399**DCL-ENT 31871--CALL
VMA$GET_SITE_NAME
     16398**DCL-ENT 27329--CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1053 
VMA$MOREMEM
     16403**DCL-ENT 16095--DCLINIT
VMA$OPEN_ENCL_SEGS
     16415**DCL-ENT 27284--CALL
VMA$OPEN_FOLDER
     16404**DCL-ENT 28064--CALL    31379--CALL    31384--CALL    31434--CALL    31440--CALL    31854--CALL
VMA$OPEN_GLOBAL
     16405**DCL-ENT 27342--CALL
VMA$OPEN_SRCH_LIST
     16413**DCL-ENT 27862--CALL    28805--CALL    31354--CALL    31360--CALL
VMA$PUT_ADD_RECORD
     16416**DCL-ENT 28792--CALL    29594--CALL
VMA$PUT_LIST
     16406**DCL-ENT 28256--CALL    28451--CALL    30194--CALL    30408--CALL
VMA$SHRINK_SEGMENT
     16414**DCL-ENT 34028--CALL
VMB$FIND_DEFAULT
     16407**DCL-ENT 27357--CALL
VMB$TESTREG
     16412**DCL-ENT 31423--CALL
VMB$USE_DEFAULT
     16409**DCL-ENT 27360--CALL    31418--CALL    31488--CALL    31503--CALL
VMB$USE_SAME
     16411**DCL-ENT 33632--CALL    34027--CALL
VMB$USE_SPECIFIED
     16408**DCL-ENT 27878--CALL    27883--CALL    31370--CALL
VMD$DEL_ENCL
     16456**DCL-ENT 28790--CALL
VMD$DI_FOLDER
     16410**DCL-ENT 29949--CALL    29962--CALL
VMD$DI_HEADER
     16417**DCL-ENT 27694--CALL    27757--CALL    27918--CALL    28684--CALL    28932--CALL    29515--CALL
     30013--CALL    30049--CALL    31034--CALL    31266--CALL    31299--CALL    32830--CALL
VMD$DI_LIST
     16418**DCL-ENT 28814--CALL    28864--CALL    28880--CALL    30188--CALL
VMD$DI_MESSAGE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1054 
     16419**DCL-ENT 28939--CALL    29526--CALL    29535--CALL
VMD$DI_PROFILE
     16420**DCL-ENT 29022--CALL
VMD$DI_USER
     16421**DCL-ENT 29309--CALL    29358--CALL    29370--CALL    30402--CALL
VMD$EJECT
     16423**DCL-ENT 28938--CALL    30008--CALL    30475--CALL
VMD$ERRMSG
     16427**DCL-ENT 27441--CALL    27541--CALL    27609--CALL    27636--CALL    27736--CALL    27808--CALL
     27835--CALL    28094--CALL    29055--CALL    29084--CALL    29113--CALL    29143--CALL    29172--CALL
     29201--CALL    29228--CALL    29255--CALL    29282--CALL    29414--CALL    29439--CALL    29486--CALL
     29557--CALL    29655--CALL    29680--CALL    29731--CALL    29756--CALL    29904--CALL    29934--CALL
     30096--CALL    30224--CALL    30425--CALL    30450--CALL    30495--CALL    30520--CALL    31002--CALL
     31084--CALL    31109--CALL    31181--CALL    31206--CALL    31234--CALL    31464--CALL    31585--CALL
     31614--CALL    32002--CALL    32132--CALL    32160--CALL    34158--CALL    34255--CALL    34317--CALL
VMD$GETNODES
     16447**DCL-ENT 27299--CALL
VMD$GET_ENCL
     16454**DCL-ENT 28767--CALL    29579--CALL
VMD$GET_HEADER
     16448**DCL-ENT 27770--CALL    27775--CALL    27926--CALL    27953--CALL    29606--CALL    29611--CALL
     31046--CALL    31051--CALL    34181--CALL    34186--CALL
VMD$GET_HEADER_NEXT
     16449**DCL-ENT 32613--CALL    33356--CALL    33436--CALL
VMD$GET_HEADER_PREV
     16450**DCL-ENT 32735--CALL
VMD$GET_PROFILE
     16452**DCL-ENT 27363--CALL    27903--CALL    27911--CALL    28004--CALL    28129--CALL    29628--CALL
     29889--CALL    29961--CALL    29975--CALL    31068--CALL    31547--CALL    32064--CALL
VMD$PUT_ENCL
     16455**DCL-ENT 29588--CALL
VMD$PUT_HEADER
     16451**DCL-ENT 27959--CALL    28689--CALL    28960--CALL    28995--CALL    30022--CALL    30056--CALL
     31273--CALL    31306--CALL    32631--CALL    33375--CALL
VMD$PUT_ID
     16457**DCL-ENT 32632--CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1055 
VMD$PUT_PROFILE
     16453**DCL-ENT 27375--CALL    27966--CALL    28110--CALL    31480--CALL    31554--CALL    33073--CALL
     33473--CALL    33624--CALL    34019--CALL
VMD$WRITE_BUF
     16458**DCL-ENT 27449--CALL    29070--CALL    29099--CALL    29128--CALL    29188--CALL    29216--CALL
     29243--CALL    29270--CALL    29297--CALL    29922--CALL    29948--CALL    31250--CALL    31599--CALL
     31630--CALL    32175--CALL
VME$ACKNOWLEDGE
     16459**DCL-ENT 34174--CALL
VME$ANSWER
     16460**DCL-ENT 27763--CALL
VMF$FROM
     16461**DCL-ENT 27324--CALL
VMF$MAKE_ADDRESS1
     16462**DCL-ENT 29042--CALL    31572--CALL    31952--CALL
VMF$MAKE_ADDRESS1PASS
     16463**DCL-ENT 34276--CALL
VMM$COMBINE_MESSAGE
     16466**DCL-ENT 27922--CALL
VMM$COPY_MESSAGE
     16464**DCL-ENT 27945--CALL    33441--CALL
VMM$DELETE_MESSAGE
     16465**DCL-ENT 33361--CALL    33443--CALL
VMM$EDIT_MESSAGE_OUT
     16467**DCL-ENT 31038--CALL
VMO$ABORT
     16469**DCL-ENT 16083--DCLINIT
VMO$XCON
     16468**DCL-ENT 18545--DCLINIT
VMO_REMEMBER
     16480**DCL     27336<<REMEMBR
VMS$FMT_SELECT
     16470**DCL-ENT 29073--CALL    29102--CALL
VMS$MOVE_SELECT
     16472**DCL-ENT 32506--CALL    32545--CALL
VMS$SELECT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1056 
     16471**DCL-ENT 32648--CALL    32665--CALL    32759--CALL
VMX$MRL IN PROCEDURE SORT_FOLDER
     33711**DCL-ENT 33810--CALL    33837--CALL    33926--CALL    33950--CALL
VMX$OCTBIN
     16475**DCL-ENT 28901--CALL    29464--CALL    30980--CALL
VM_ADDLIST$
     14921**DCL     17368--IMP-PTR 28146<>CALL    28167<>CALL    28183>>ASSIGN  28256<>CALL    28293<>CALL
     28307<>CALL    28328>>ASSIGN  28451<>CALL    28558<>CALL    28574<>CALL    28583<>CALL    28616<>CALL
     28639<>CALL    28648<>CALL    28651<>CALL    28812<>CALL    28855<>CALL    28876<>CALL    29307<>CALL
     29349<>CALL    29368<>CALL    30073<>CALL    30194<>CALL    30206<>CALL    30408<>CALL    31868>>ASSIGN
     31871<>CALL
VM_ADDLIST_
     14945**DCL     27278<>CALL
VM_ADDRESS_SPEC$
     16166**DCL     27305<<ASSIGN
VM_ADD_HEAD.HEAD$
     17378**DCL     31868>>ASSIGN
VM_ADD_HEAD.NUM_ENTRIES
     17371**DCL     28183<<ASSIGN  28328<<ASSIGN
VM_BLANK_LINE_FMT
     20630**DCL     20411--DCLINIT 20413--DCLINIT
VM_CENTRAL_FOLDER
     17700**DCL     27357<>CALL
VM_CENTRAL_FOLDER.ACCT
     17703**DCL     28034>>ASSIGN  28465>>ASSIGN  29817>>ASSIGN
VM_CENTRAL_FOLDER.FOLDER
     17705**DCL     28035>>ASSIGN  28507>>ASSIGN  29870>>ASSIGN
VM_COUNT_FMT
     21036**DCL     28026<>CALL
VM_CURRENT_FOLDER
     17753**DCL     27360<>CALL    29042<>CALL    31369>>ASSIGN  31370<>CALL    31378<<ASSIGN  31379<>CALL
     31384<>CALL    31418<>CALL    31434<>CALL    31440<>CALL    31449<>CALL    31488<>CALL    31491<>CALL
     31503<>CALL    31506<>CALL    31526<>CALL    31572<>CALL    32032<>CALL    33632<>CALL    34027<>CALL
     34276<>CALL
VM_CURRENT_FOLDER.ACCT
     17756**DCL     27378>>IF      28493>>IF      30668>>ASSIGN  31430>>ASSIGN  33528--ASSIGN  33734--ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1057 
VM_CURRENT_FOLDER.FLAGS
     17776**DCL     27220<<ASSIGN  29396<<ASSIGN  31352<<ASSIGN  31429<<ASSIGN
VM_CURRENT_FOLDER.FLAGS.OPEN
     17787**DCL     27387<<ASSIGN  27498>>IF      27900<<ASSIGN  28010<<ASSIGN  28127>>IF      29380>>IF
     29626>>IF      29808>>ASSIGN  29809<<ASSIGN  29969<<ASSIGN  29973>>IF      31066>>IF      31331>>IF
     31415>>IF      31486<<ASSIGN  31523<<ASSIGN  31669<<ASSIGN  31749>>IF      31758>>IF      31767>>IF
     31977<<ASSIGN  32020<<ASSIGN  32029<<ASSIGN  32062>>IF      33038>>IF      33522<<ASSIGN  33728<<ASSIGN
VM_CURRENT_FOLDER.FLAGS.UPDATE
     17777**DCL     27897>>IF      28078>>IF      28946>>IF      29386>>IF      29803>>IF      30015>>IF
     31344>>IF      31512>>IF      31536<<ASSIGN  31759>>IF      31768>>IF      31974>>IF      32021>>IF
     32042<<ASSIGN  32626>>IF      33330>>IF
VM_CURRENT_FOLDER.FOLDER
     17758**DCL     27369>>ASSIGN  27378>>IF      28493>>IF      30669>>ASSIGN  31431>>ASSIGN  31548>>ASSIGN
     33525>>CALLBLT 33731>>CALLBLT
VM_CURRENT_FOLDER.NRECS
     17772**DCL     33337>>IF      33337>>ASSIGN
VM_CURRENT_FOLDER.PASS
     17760**DCL     30670>>ASSIGN  31432>>ASSIGN  33529--ASSIGN  33735--ASSIGN
VM_CURRENT_FOLDER.SITENAME
     17762**DCL     30671>>ASSIGN  31433>>ASSIGN
VM_CURRENT_FOLDER.UGRANS
     17774**DCL     31567>>IF      33463>>IF
VM_CURRENT_FOLDER.USER_NAME.COUNT
     17792**DCL     34291>>ASSIGN
VM_CURRENT_FOLDER.USER_NAME.TEXT
     17793**DCL     34293>>IF
VM_CURRENT_FOLDER_SAVE
     17805**DCL     31369<<ASSIGN  31378>>ASSIGN
VM_DEFAULT_NODES
     16204**DCL     16234--DCLINIT
VM_DETACH_DELETE_OK_FMT
     23393**DCL     28798<>CALL
VM_DETACH_OK_FMT
     23317**DCL     28800<>CALL
VM_DI_FIRST_CMD
     24002**DCL     29414<>CALL    29423>>ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1058 
VM_DI_FIRST_CMD.NAME#
     24002**DCL     29412>>IF
VM_DI_LAST_CMD
     24306**DCL     29731<>CALL    29740>>ASSIGN
VM_DI_LAST_CMD.NAME#
     24306**DCL     29729>>IF
VM_DI_NEXT_CMD
     23622**DCL     30425<>CALL    30434>>ASSIGN
VM_DI_NEXT_CMD.NAME#
     23622**DCL     30423>>IF
VM_DI_PREVIOUS_CMD
     23850**DCL     30495<>CALL    30504>>ASSIGN
VM_DI_PREVIOUS_CMD.NAME#
     23850**DCL     30493>>IF
VM_DI_REST_CMD
     24458**DCL     31084<>CALL    31093>>ASSIGN
VM_DI_REST_CMD.NAME#
     24458**DCL     31082>>IF
VM_DI_THIS_CMD
     24154**DCL     29655<>CALL    29664>>ASSIGN  31181<>CALL    31190>>ASSIGN
VM_DI_THIS_CMD.NAME#
     24154**DCL     29653>>IF      31179>>IF
VM_ENCLLIST$
     14936**DCL     17494--IMP-PTR 28739>>ASSIGN  29576>>ASSIGN  29577>>DOINDEX
VM_ENCLLIST_
     14952**DCL     28732<>CALL    28792<>CALL    29594<>CALL
VM_ENCLOS.FLAGS.DELETED
     17530**DCL     28742>>IF      28791<<ASSIGN  28797>>IF
VM_ENCLOS.NEXT$
     17525**DCL     28749>>IF      28753>>ASSIGN  29592>>ASSIGN
VM_ENCLOS.NRECS
     17538**DCL     28766>>DOINDEX 28790<>CALL    29578>>DOINDEX
VM_ENCLOS.TYPE
     17540**DCL     28741>>IF      29579>>CALL    29588>>CALL
VM_ENCLREC.VALUE.COUNT
     17562**DCL     17572--IMP-SIZ
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1059 
VM_ENCLREC$
     14938**DCL     17556--IMP-PTR 28767<>CALL    28772>>ASSIGN  28790<>CALL    29579<>CALL    29588<>CALL
VM_ENCLREC_
     14953**DCL     28735<<ASSIGN  28735>>ASSIGN  29584<<ASSIGN  29584>>ASSIGN
VM_ENCL_HEAD.HEAD$
     17504**DCL     28739>>ASSIGN  29576>>ASSIGN
VM_ENCL_HEAD.NUM_ENTRIES
     17497**DCL     29577>>DOINDEX
VM_END_CMD
     24610**DCL     27541<>CALL    27544>>ASSIGN  27609<>CALL    27612>>ASSIGN
VM_END_NOUPDATE_CMD
     23470**DCL     27636<>CALL    27639>>ASSIGN  32002<>CALL    32011<<ASSIGN  32011>>ASSIGN
VM_END_NOUPDATE_CMD.NAME#
     23470**DCL     32000>>IF
VM_FILERES
     18225**DCL     18245--DCLINIT 18268--DCLINIT
VM_FOLDER_DELETED_FMT
     20884**DCL     28545<>CALL
VM_FOLDER_DISPLAYED_FMT
     20960**DCL     29977<>CALL
VM_FOLDER_HEADER1_FMT
     20732**DCL     29904<>CALL
VM_FOLDER_HEADER1_FMT.L#
     20732**DCL     29907>>ASSIGN
VM_FOLDER_HEADER1_FMT.NAME#
     20732**DCL     29902>>IF      29907--ASSIGN
VM_FOLDER_HEADER2_FMT
     20808**DCL     29934<>CALL
VM_FOLDER_HEADER2_FMT.L#
     20808**DCL     29937>>ASSIGN
VM_FOLDER_HEADER2_FMT.NAME#
     20808**DCL     29932>>IF      29937--ASSIGN
VM_FORWARD_ENCL_NAME
     15148**DCL     19555--DCLINIT
VM_FORWARD_FILE_NAME
     15121**DCL     19436--DCLINIT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1060 
VM_FORWARD_FILE_PASS
     15161**DCL     19437--DCLINIT 19556--DCLINIT
VM_GREETING_FMT
     20656**DCL     27441<>CALL
VM_HEADER
     17113**DCL     27694<>CALL    27757<>CALL    27918<>CALL    28684<>CALL    28932<>CALL    29515<>CALL
     30013<>CALL    30049<>CALL    31034<>CALL    31266<>CALL    31299<>CALL    32830<>CALL
VM_HEADER.CREATION_DATE
     17116**DCL     32860>>ASSIGN  33782>>IF      33792>>IF      33795>>IF      33801>>IF      33812>>ASSIGN
     33818>>ASSIGN
VM_HEADER.FREE$
     17193**DCL     32869>>ASSIGN
VM_HEADER.FROM$
     17205**DCL     28989>>IF      28989>>IF      33825>>ASSIGN
VM_HEADER.HEADER_SIZE
     17114**DCL     32870>>ASSIGN
VM_HEADER.NEXT$
     17195**DCL     32868>>ASSIGN  32872<<ASSIGN
VM_HEADER.NUM_RECORDS
     17124**DCL     33364>>ASSIGN
VM_HEADER.REFERENCE$
     17207**DCL     33827>>ASSIGN
VM_HEADER.STATUS.ACK
     17132**DCL     27927>>IF
VM_HEADER.STATUS.BROADCAST
     17164**DCL     27758>>IF
VM_HEADER.STATUS.CRYPT
     17138**DCL     28928>>IF      29508>>IF      31027>>IF
VM_HEADER.STATUS.DEL
     17148**DCL     27936<<ASSIGN  27955>>IF      27958<<ASSIGN  28678>>IF      28686<<ASSIGN  31268>>IF
     31272<<ASSIGN  33358>>IF
VM_HEADER.STATUS.DELIVERY
     17162**DCL     27927>>IF
VM_HEADER.STATUS.ENCL
     17178**DCL     28711>>IF      29525>>IF      29534>>IF      29547>>IF
VM_HEADER.STATUS.EXAM
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1061 
     17146**DCL     28949>>IF      28958<<ASSIGN  28974>>IF      32659>>ASSIGN  32660<<ASSIGN  32660>>ASSIGN
     32669<<ASSIGN  32672<<ASSIGN
VM_HEADER.STATUS.MAKE_OLD
     17143**DCL     27937>>IF      27940<<ASSIGN  28678>>IF      28954>>IF      28959<<ASSIGN  28974>>IF
     30015>>IF      30021<<ASSIGN  32677>>IF      33370>>IF      33374<<ASSIGN
VM_HEADER.STATUS.MARK
     17152**DCL     30051>>IF      30055<<ASSIGN  31300>>IF      31305<<ASSIGN
VM_HEADER.STATUS.OLD
     17140**DCL     27939<<ASSIGN  27942>>IF      28678>>IF      28949>>IF      28954>>IF      30015>>IF
     33373<<ASSIGN  33378>>IF
VM_HEADER.STATUS.RR
     17136**DCL     27935<<ASSIGN  28986>>IF      28994<<ASSIGN
VM_HEADER.STATUS.RRACK
     17174**DCL     27927>>IF
VM_HEADER.SUBJECT$
     17215**DCL     33829>>ASSIGN
VM_HEADER.TO$
     17217**DCL     33831>>ASSIGN
VM_HEADER.UNIQUE_ID$
     17219**DCL     32626>>IF      32632>>CALL    32632>>CALL    32873<<ASSIGN  32874>>ASSIGN  32875>>ASSIGN
     32875>>ASSIGN
VM_HEADER$
     14917**DCL     17113--IMP-PTR 17472--IMP-PTR 27694>>CALL    27757>>CALL    27758>>IF      27918>>CALL
     27927>>IF      27927>>IF      27927>>IF      27935>>ASSIGN  27936>>ASSIGN  27937>>IF      27939>>ASSIGN
     27940>>ASSIGN  27942>>IF      27955>>IF      27958>>ASSIGN  28678>>IF      28678>>IF      28678>>IF
     28684>>CALL    28686>>ASSIGN  28711>>IF      28928>>IF      28932>>CALL    28949>>IF      28949>>IF
     28954>>IF      28954>>IF      28958>>ASSIGN  28959>>ASSIGN  28974>>IF      28974>>IF      28986>>IF
     28989>>IF      28989>>IF      28994>>ASSIGN  29508>>IF      29515>>CALL    29525>>IF      29534>>IF
     29547>>IF      30013>>CALL    30015>>IF      30015>>IF      30021>>ASSIGN  30049>>CALL    30051>>IF
     30055>>ASSIGN  31027>>IF      31034>>CALL    31266>>CALL    31268>>IF      31272>>ASSIGN  31299>>CALL
     31300>>IF      31305>>ASSIGN  32626>>IF      32632>>CALL    32632>>CALL    32659>>ASSIGN  32660>>ASSIGN
     32660>>ASSIGN  32669>>ASSIGN  32672>>ASSIGN  32677>>IF      32830>>CALL    32860>>ASSIGN  32867>>ASSIGN
     32868>>ASSIGN  32869>>ASSIGN  32870>>ASSIGN  32872>>ASSIGN  32873>>ASSIGN  32874>>ASSIGN  32875>>ASSIGN
     32875>>ASSIGN  33358>>IF      33364>>ASSIGN  33370>>IF      33373>>ASSIGN  33374>>ASSIGN  33378>>IF
     33587>>IF      33589>>ASSIGN  33782>>IF      33792>>IF      33795>>IF      33801>>IF      33812>>ASSIGN
     33818>>ASSIGN  33825>>ASSIGN  33827>>ASSIGN  33829>>ASSIGN  33831>>ASSIGN  33987>>CALL    33988>>ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1062 
VM_HEADER_
     14942**DCL     27276<>CALL    33543>>ASSIGN  33552<>CALL    33553>>ASSIGN  33615>>ASSIGN  33749>>ASSIGN
     33758<>CALL    33759>>ASSIGN  34000>>ASSIGN
VM_HEADRES
     18285**DCL     18304--DCLINIT 18324--DCLINIT
VM_HEADRES.RES#
     18287**DCL     32825<<ASSIGN  33401<<ASSIGN
VM_ID.MESSAGE_NUMBER
     17473**DCL     33587>>IF      33589<<ASSIGN  33987<>CALL    33988<<ASSIGN
VM_LISTKEY
     17300**DCL     28146<>CALL    28256<>CALL    28307<>CALL    28557>>ASSIGN  28558<>CALL    28566<>CALL
     28571>>ASSIGN  28573<<ASSIGN  28574<>CALL    28583<>CALL    28812<>CALL    28814<>CALL    28855<>CALL
     28864<>CALL    28876<>CALL    28880<>CALL    30073<>CALL    30188<>CALL    30194<>CALL
VM_LISTKEY.COUNT
     17301**DCL     28561>>ASSIGN  28861>>ASSIGN
VM_LISTKEY.TEXT
     17304**DCL     28145<<ASSIGN  28166>>ASSIGN  28306<<ASSIGN  28556<<ASSIGN  28561--ASSIGN  28582<<ASSIGN
     28810<<ASSIGN  28848<<ASSIGN  28850<<ASSIGN  28851<<ASSIGN  28852<<ASSIGN  28852>>ASSIGN  28857>>IF
     28861--ASSIGN  28874<<ASSIGN  30072<<ASSIGN
VM_LISTKEY2
     17317**DCL     28557<<ASSIGN  28571<<ASSIGN  28573>>ASSIGN
VM_LISTS_DELETED_FMT
     22073**DCL     28598<>CALL
VM_LISTS_DISPLAYED_FMT
     22149**DCL     28889<>CALL
VM_LIST_FIRST_CMD
     24078**DCL     29439<>CALL    29448>>ASSIGN
VM_LIST_FIRST_CMD.NAME#
     24078**DCL     29437>>IF
VM_LIST_LAST_CMD
     24382**DCL     29756<>CALL    29765>>ASSIGN
VM_LIST_LAST_CMD.NAME#
     24382**DCL     29754>>IF
VM_LIST_NEXT_CMD
     23698**DCL     30450<>CALL    30459>>ASSIGN
VM_LIST_NEXT_CMD.NAME#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1063 
     23698**DCL     30448>>IF
VM_LIST_PREVIOUS_CMD
     23926**DCL     30520<>CALL    30529>>ASSIGN
VM_LIST_PREVIOUS_CMD.NAME#
     23926**DCL     30518>>IF
VM_LIST_REST_CMD
     24534**DCL     31109<>CALL    31118>>ASSIGN
VM_LIST_REST_CMD.NAME#
     24534**DCL     31107>>IF
VM_LIST_THIS_CMD
     24230**DCL     29680<>CALL    29689>>ASSIGN  31206<>CALL    31215>>ASSIGN
VM_LIST_THIS_CMD.NAME#
     24230**DCL     29678>>IF      31204>>IF
VM_MAILCG_SETSTA.MYSTATION#
     15208**DCL     27334<<CALLBLT 27335<<CALLBLT
VM_MAIL_ACCT
     15013**DCL     19021--DCLINIT
VM_MAIL_ACCT.ACCT#
     15013**DCL     27378>>IF
VM_MAIL_SETUP
     25218**DCL     28094<>CALL    31464<>CALL
VM_MAIL_SETUP.L#
     25218**DCL     28108>>ASSIGN  31478>>ASSIGN
VM_MAIL_SETUP.NAME#
     25218**DCL     28092>>IF      28109>>ASSIGN  31462>>IF      31479>>ASSIGN
VM_MODIFY_LIST_PROMPT
     16723**DCL     30096<>CALL
VM_MODIFY_LIST_PROMPT.L#
     16723**DCL     30110>>CALL
VM_MODIFY_LIST_PROMPT.NAME#
     16723**DCL     30094>>IF      30110--CALL
VM_MODIFY_USER_PROMPT
     16799**DCL     30224<>CALL
VM_MODIFY_USER_PROMPT.L#
     16799**DCL     30240>>CALL
VM_MODIFY_USER_PROMPT.NAME#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1064 
     16799**DCL     30222>>IF      30240--CALL
VM_MSGS_COPIED_FMT
     21845**DCL     27977<>CALL
VM_MSGS_DELETED_FMT
     21541**DCL     27980<>CALL    28700<>CALL
VM_MSGS_DISPLAYED_FMT
     21921**DCL     29005<>CALL
VM_MSGS_LISTED_FMT
     21997**DCL     30033<>CALL
VM_MSGS_MARKED_FMT
     21693**DCL     30063<>CALL
VM_MSGS_UNDELETED_FMT
     21617**DCL     31282<>CALL
VM_MSGS_UNMARKED_FMT
     21769**DCL     31313<>CALL
VM_NAME_MAP_NAME
     15040**DCL     19017--DCLINIT
VM_NATL_PAIRS
     16232**DCL     27299<>CALL
VM_NEXT_CMD
     23546**DCL     27808<>CALL    27817>>ASSIGN
VM_NEXT_CMD.NAME#
     23546**DCL     27806>>IF
VM_NODEFID
     16388**DCL     27299<>CALL
VM_NODENAMES
     16275**DCL     27299<>CALL
VM_NO_MESSAGE_FMT
     21112**DCL     27701<>CALL    27789<>CALL    29625<>CALL    31065<>CALL    32132<>CALL
VM_NO_MESSAGE_FMT.L#
     21112**DCL     32135>>ASSIGN
VM_NO_MESSAGE_FMT.NAME#
     21112**DCL     32130>>IF      32135--ASSIGN
VM_PARSEAREA_
     14949**DCL     27281<>CALL    27282<<ASSIGN  27282>>ASSIGN  27283<<ASSIGN  27283>>ASSIGN  27289>>ASSIGN
VM_PREVIOUS_CMD
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1065 
     23774**DCL     27835<>CALL    27844>>ASSIGN
VM_PREVIOUS_CMD.NAME#
     23774**DCL     27833>>IF
VM_PROFILE
     16937**DCL     28081<<ASSIGN  30552--ASSIGN  31451<<ASSIGN
VM_PROFILE.EDITOR$
     17003**DCL     30758>>ASSIGN  30762>>ASSIGN  30764<<ASSIGN  30772<<ASSIGN  30773>>ASSIGN  30774>>ASSIGN
     30774>>ASSIGN
VM_PROFILE.FILE_FOLDER$
     16990**DCL     27370>>IF      27370>>IF      27370>>IF      27374<<ASSIGN  30653>>IF      30658<<ASSIGN
     30663>>ASSIGN  30665<<ASSIGN  30692<<ASSIGN  30694>>ASSIGN  31549>>IF      31549>>IF      31549>>IF
     31553<<ASSIGN
VM_PROFILE.FREE$
     16970**DCL     28082<<ASSIGN  30554>>ASSIGN  30865<<ASSIGN  31452<<ASSIGN
VM_PROFILE.GRANULES
     16984**DCL     30616<<ASSIGN  31567>>IF      31567>>IF
VM_PROFILE.HIGH_RECS
     17001**DCL     33337>>IF      33337<<ASSIGN  33415>>IF      33463>>IF      33623<<ASSIGN
VM_PROFILE.HI_MESSAGE_NUMBER
     16982**DCL     27931<<ASSIGN  27931>>ASSIGN  27945<>CALL    28926<<ASSIGN  28926>>ASSIGN  29296--ASSIGN
     30011<<ASSIGN  30011>>ASSIGN  32212>>ASSIGN  33059>>IF      33071<<ASSIGN  33401>>ASSIGN  33410<<ASSIGN
     33415>>IF      33435>>DOWHILE 33453<<ASSIGN  33546>>ASSIGN  33642>>ASSIGN  33648>>ASSIGN  33752>>ASSIGN
     34017<<ASSIGN  34039>>ASSIGN  34045>>ASSIGN
VM_PROFILE.LOW_DEL_NUM
     16998**DCL     28687>>IF      28688<<ASSIGN  33415>>IF      33455<<ASSIGN  33463>>IF      33469<<ASSIGN
VM_PROFILE.NAME_KEY
     16996**DCL     28084<<CALLBLT 31454<<CALLBLT
VM_PROFILE.NEXT$
     16972**DCL     28083<<ASSIGN  30556>>ASSIGN  30864<<ASSIGN  31453<<ASSIGN
VM_PROFILE.NUM_DEL_MESSAGES
     16978**DCL     28005<<ASSIGN  28005>>ASSIGN  28691<<ASSIGN  28691>>ASSIGN  29215--ASSIGN  31274<<ASSIGN
     31274>>ASSIGN  33345>>IF      33384<<ASSIGN
VM_PROFILE.NUM_LOST
     17007**DCL     31601>>IF      31601>>IF      31629--ASSIGN  33385<<ASSIGN
VM_PROFILE.NUM_MESSAGES
     16974**DCL     27932<<ASSIGN  27932>>ASSIGN  28978>>ASSIGN  29269--ASSIGN  31137>>IF      31637>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1066 
     33064<<ASSIGN  33353<<ASSIGN  33357<<ASSIGN  33357>>ASSIGN  33363<<ASSIGN  33363>>ASSIGN  33407>>IF
     33454<<ASSIGN  34018<<ASSIGN
VM_PROFILE.NUM_MOLD_MESSAGES
     16980**DCL     28962<<ASSIGN  28962>>ASSIGN  28974>>IF      28978<<ASSIGN  30024<<ASSIGN  30024>>ASSIGN
     33345>>IF      33386<<ASSIGN
VM_PROFILE.NUM_NEW_MESSAGES
     16976**DCL     27944<<ASSIGN  27944>>ASSIGN  29242--ASSIGN  33065<<ASSIGN  33068<<ASSIGN  33068>>ASSIGN
     33354<<ASSIGN  33380<<ASSIGN  33380>>ASSIGN
VM_PROFILE.OPT.ANS_RECEIVERS
     16959**DCL     27715>>ASSIGN  30568<<ASSIGN  30570<<ASSIGN
VM_PROFILE.OPT.AUTO_EDIT
     16951**DCL     30589<<ASSIGN  30591<<ASSIGN
VM_PROFILE.OPT.COMBINE
     16955**DCL     27927>>IF      30596<<ASSIGN  30598<<ASSIGN
VM_PROFILE.OPT.DELIVERY_RECEIPT
     16957**DCL     30603<<ASSIGN  30605<<ASSIGN
VM_PROFILE.OPT.DEL_ON_DETACH
     16965**DCL     28789>>IF      30575<<ASSIGN  30577<<ASSIGN
VM_PROFILE.OPT.DISPTRACE
     16953**DCL     30610<<ASSIGN  30612<<ASSIGN
VM_PROFILE.OPT.EXT_ADDR_DISP
     16963**DCL     30582<<ASSIGN  30584<<ASSIGN
VM_PROFILE.OPT.FCOPY
     16943**DCL     30628<<ASSIGN  30630<<ASSIGN
VM_PROFILE.OPT.HEADERS
     16941**DCL     27896>>ASSIGN  28682>>IF      30047>>IF      30621<<ASSIGN  30623<<ASSIGN  31264>>IF
     31297>>IF
VM_PROFILE.OPT.PAGE
     16949**DCL     28936>>IF      30001>>ASSIGN  30635<<ASSIGN  30637<<ASSIGN
VM_PROFILE.OPT.PREPROCESS
     16961**DCL     30642<<ASSIGN  30644<<ASSIGN
VM_PROFILE.OPT.RENUMBER
     16947**DCL     29385<>CALL    30649<<ASSIGN  30651<<ASSIGN  31343<>CALL
VM_PROFILE.OPT.RETURN_RECEIPT
     16945**DCL     30699<<ASSIGN  30701<<ASSIGN
VM_PROFILE.PROFILE_SIZE
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1067 
     16968**DCL     30547>>ASSIGN  30552>>ASSIGN  30868>>ASSIGN
VM_PROFILE.RECS_DELETED
     16999**DCL     33387<<ASSIGN  33387>>ASSIGN  33415>>IF      33463>>IF      33622<<ASSIGN  34016<<ASSIGN
VM_PROFILE.REPLY_TO$
     17005**DCL     30707>>IF      30710>>ASSIGN  30712<<ASSIGN  30723<<ASSIGN  30724>>ASSIGN  30725>>ASSIGN
     30725>>ASSIGN
VM_PROFILE.SEARCH_LIST$
     16992**DCL     27366<<ASSIGN  27401<<ASSIGN  30784>>IF      30787>>ASSIGN  30789<<ASSIGN  30840<<ASSIGN
     30841>>ASSIGN  30845>>ASSIGN  30847>>ASSIGN  30849>>CALLBLT 31680<<ASSIGN  32056<<ASSIGN
VM_PROFILE.SETUP
     16986**DCL     31657>>ASSIGN
VM_PROFILE.SETUP.COUNT
     16988**DCL     28108<<ASSIGN  30728<<ASSIGN  30730<<ASSIGN  31478<<ASSIGN
VM_PROFILE.SETUP.TEXT
     16989**DCL     28109<<ASSIGN  30731<<ASSIGN  31479<<ASSIGN
VM_PROFILE.SIGNED$
     16994**DCL     30737>>IF      30740>>ASSIGN  30742<<ASSIGN  30750<<ASSIGN  30751>>ASSIGN  30752>>ASSIGN
     30752>>ASSIGN
VM_PROFILE.WORK_AREA
     17011**DCL     28083--ASSIGN  30552--ASSIGN  30555--ASSIGN  31453--ASSIGN
VM_PROFILE$
     14919**DCL     16937--IMP-PTR 27366>>ASSIGN  27370>>IF      27370>>IF      27370>>IF      27374>>ASSIGN
     27401>>ASSIGN  27715>>ASSIGN  27896>>ASSIGN  27927>>IF      27931>>ASSIGN  27931>>ASSIGN  27932>>ASSIGN
     27932>>ASSIGN  27944>>ASSIGN  27944>>ASSIGN  27945>>CALL    28005>>ASSIGN  28005>>ASSIGN  28081>>ASSIGN
     28082>>ASSIGN  28083>>ASSIGN  28083>>ASSIGN  28084>>CALLBLT 28108>>ASSIGN  28109>>ASSIGN  28682>>IF
     28687>>IF      28688>>ASSIGN  28691>>ASSIGN  28691>>ASSIGN  28789>>IF      28926>>ASSIGN  28926>>ASSIGN
     28936>>IF      28962>>ASSIGN  28962>>ASSIGN  28974>>IF      28978>>ASSIGN  28978>>ASSIGN  29215>>ASSIGN
     29242>>ASSIGN  29269>>ASSIGN  29296>>ASSIGN  29385>>CALL    30001>>ASSIGN  30011>>ASSIGN  30011>>ASSIGN
     30024>>ASSIGN  30024>>ASSIGN  30047>>IF      30547>>ASSIGN  30548>>ASSIGN  30552>>ASSIGN  30552>>ASSIGN
     30552>>ASSIGN  30554>>ASSIGN  30555>>ASSIGN  30556>>ASSIGN  30568>>ASSIGN  30570>>ASSIGN  30575>>ASSIGN
     30577>>ASSIGN  30582>>ASSIGN  30584>>ASSIGN  30589>>ASSIGN  30591>>ASSIGN  30596>>ASSIGN  30598>>ASSIGN
     30603>>ASSIGN  30605>>ASSIGN  30610>>ASSIGN  30612>>ASSIGN  30616>>ASSIGN  30621>>ASSIGN  30623>>ASSIGN
     30628>>ASSIGN  30630>>ASSIGN  30635>>ASSIGN  30637>>ASSIGN  30642>>ASSIGN  30644>>ASSIGN  30649>>ASSIGN
     30651>>ASSIGN  30653>>IF      30658>>ASSIGN  30663>>ASSIGN  30665>>ASSIGN  30692>>ASSIGN  30694>>ASSIGN
     30699>>ASSIGN  30701>>ASSIGN  30707>>IF      30710>>ASSIGN  30712>>ASSIGN  30723>>ASSIGN  30724>>ASSIGN
     30725>>ASSIGN  30725>>ASSIGN  30728>>ASSIGN  30730>>ASSIGN  30731>>ASSIGN  30737>>IF      30740>>ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1068 
     30742>>ASSIGN  30750>>ASSIGN  30751>>ASSIGN  30752>>ASSIGN  30752>>ASSIGN  30758>>ASSIGN  30762>>ASSIGN
     30764>>ASSIGN  30772>>ASSIGN  30773>>ASSIGN  30774>>ASSIGN  30774>>ASSIGN  30784>>IF      30787>>ASSIGN
     30789>>ASSIGN  30840>>ASSIGN  30841>>ASSIGN  30845>>ASSIGN  30847>>ASSIGN  30849>>CALLBLT 30864>>ASSIGN
     30865>>ASSIGN  30869>>ASSIGN  31137>>IF      31264>>IF      31274>>ASSIGN  31274>>ASSIGN  31297>>IF
     31343>>CALL    31451>>ASSIGN  31452>>ASSIGN  31453>>ASSIGN  31453>>ASSIGN  31454>>CALLBLT 31478>>ASSIGN
     31479>>ASSIGN  31549>>IF      31549>>IF      31549>>IF      31553>>ASSIGN  31567>>IF      31567>>IF
     31601>>IF      31601>>IF      31629>>ASSIGN  31637>>IF      31657>>ASSIGN  31680>>ASSIGN  32056>>ASSIGN
     32212>>ASSIGN  33059>>IF      33064>>ASSIGN  33065>>ASSIGN  33068>>ASSIGN  33068>>ASSIGN  33071>>ASSIGN
     33337>>IF      33337>>ASSIGN  33345>>IF      33345>>IF      33353>>ASSIGN  33354>>ASSIGN  33357>>ASSIGN
     33357>>ASSIGN  33363>>ASSIGN  33363>>ASSIGN  33380>>ASSIGN  33380>>ASSIGN  33384>>ASSIGN  33385>>ASSIGN
     33386>>ASSIGN  33387>>ASSIGN  33387>>ASSIGN  33401>>ASSIGN  33407>>IF      33410>>ASSIGN  33415>>IF
     33415>>IF      33415>>IF      33415>>IF      33435>>DOWHILE 33453>>ASSIGN  33454>>ASSIGN  33455>>ASSIGN
     33463>>IF      33463>>IF      33463>>IF      33469>>ASSIGN  33546>>ASSIGN  33622>>ASSIGN  33623>>ASSIGN
     33642>>ASSIGN  33648>>ASSIGN  33752>>ASSIGN  34016>>ASSIGN  34017>>ASSIGN  34018>>ASSIGN  34039>>ASSIGN
     34045>>ASSIGN
VM_PROFILE_
     14944**DCL     27277<>CALL    30542>>IF      30544>>ASSIGN  30835<>CALL
VM_PROKEY IN PROCEDURE PUT_PROFILE
     33032**DCL     32913--DCLINIT 32914--DCLINIT
VM_PRORES
     18211**DCL     18176--DCLINIT 18195--DCLINIT
VM_PROSTUB IN PROCEDURE PUT_PROFILE
     32945**DCL     33050--ASSIGN
VM_PROSTUB.HI_MESSAGE_NUMBER IN PROCEDURE PUT_PROFILE
     32990**DCL     33059>>IF      33071>>ASSIGN
VM_PROSTUB.NUM_MESSAGES IN PROCEDURE PUT_PROFILE
     32982**DCL     33064>>ASSIGN
VM_PROSTUB.NUM_NEW_MESSAGES IN PROCEDURE PUT_PROFILE
     32984**DCL     33065>>ASSIGN
VM_RADDRESS
     17591**DCL     28064--CALL    30694>>ASSIGN  30830--ASSIGN  30841>>ASSIGN  31434--CALL    31440--CALL
     31854--CALL    31871<>CALL
VM_RADDRESS.ACCT
     17614**DCL     28034<<ASSIGN  28049<<ASSIGN  28465<<ASSIGN  28481<<ASSIGN  28493>>IF      28499>>ASSIGN
     29817<<ASSIGN  29850<<ASSIGN  29862>>ASSIGN  30668<<ASSIGN  30680<<ASSIGN  30689>>IF      30797<<ASSIGN
     30810<<ASSIGN  31430<<ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1069 
VM_RADDRESS.FLAGS
     17596**DCL     30674<<ASSIGN  30803<<ASSIGN
VM_RADDRESS.FOLDER
     17606**DCL     17607--REDEF   28035<<ASSIGN  28051<<ASSIGN  28466<<ASSIGN  28483<<ASSIGN  28493>>IF
     28505>>IF      28507<<ASSIGN  28508>>ASSIGN  29818<<ASSIGN  29852<<ASSIGN  29868>>IF      29870<<ASSIGN
     29871>>ASSIGN  30669<<ASSIGN  30682<<ASSIGN  30689>>IF      30798<<ASSIGN  30812<<ASSIGN  31431<<ASSIGN
     31834--ASSIGN  31835<<ASSIGN
VM_RADDRESS.NEXT$
     17592**DCL     30672<<ASSIGN  30801<<ASSIGN
VM_RADDRESS.NOMAD.FOLDER
     17608**DCL     27369<<ASSIGN  31548<<ASSIGN
VM_RADDRESS.PASS
     17611**DCL     28036<<ASSIGN  28056<<ASSIGN  28467<<ASSIGN  28488<<ASSIGN  28500>>ASSIGN  29819<<ASSIGN
     29857<<ASSIGN  29863>>ASSIGN  30670<<ASSIGN  30686<<ASSIGN  30799<<ASSIGN  30818<<ASSIGN  31432<<ASSIGN
VM_RADDRESS.PREV$
     17594**DCL     30673<<ASSIGN  30802<<ASSIGN
VM_RADDRESS.SITENAME
     17613**DCL     28037<<ASSIGN  28468<<ASSIGN  29820<<ASSIGN  30671<<ASSIGN  30800<<ASSIGN  31433<<ASSIGN
VM_RADDRESS.TYPE
     17603**DCL     28469<<ASSIGN  29821<<ASSIGN  30675<<ASSIGN  30804<<ASSIGN
VM_RESEND_NAME
     25142**DCL     31002<>CALL    31017--CALLBLT 31017--CALLBLT
VM_RESEND_NAME.L#
     25142**DCL     31016>>ASSIGN
VM_RESEND_NAME.NAME#
     25142**DCL     31000>>IF
VM_SEARCH_INFO
     17913**DCL     27357<>CALL    27360<>CALL    27862<>CALL    27878<>CALL    27883<>CALL    28805<>CALL
     28864<>CALL    28880<>CALL    31354<>CALL    31360<>CALL    31370<>CALL    31418<>CALL    31488<>CALL
     31503<>CALL
VM_SEARCH_INFO.ACTIVE
     17922**DCL     27862>>IF      28805>>IF      31353>>IF      31358>>IF      31677<<ASSIGN  31801<<ASSIGN
     32053<<ASSIGN
VM_SEARCH_INFO.CURRENT
     17926**DCL     27377<<ASSIGN  27390<<ASSIGN  27395<<ASSIGN  27398>>IF      31372<<ASSIGN  31375<<ASSIGN
     31381<<ASSIGN  31386<<ASSIGN  31420<<ASSIGN  31678<<ASSIGN  32054<<ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1070 
VM_SEARCH_INFO.DCB#
     17916**DCL     27346<<ASSIGN  27383<<ASSIGN  27383>>ASSIGN  27385<<ASSIGN  28855<>CALL    28876<>CALL
     31791>>IF      31791>>IF      31794--IF      31796>>ASSIGN
VM_SEARCH_INFO.GLOBAL
     17924**DCL     27347<<ASSIGN  27352<<ASSIGN
VM_SEARCH_INFO.NUM_ENTRIES
     17914**DCL     27345<<ASSIGN  27351<<ASSIGN  27378>>IF      27382<<ASSIGN  27382>>ASSIGN  28845>>DOINDEX
     28875>>DOINDEX 31790>>DOINDEX
VM_SELECT
     18077**DCL     32648<>CALL    32665<>CALL    32759<>CALL
VM_SELECT.ERROR
     18078**DCL     32807<>CALL
VM_SELECT.ERR_POS#
     18085**DCL     32806<>CALL
VM_SELECT$
     14927**DCL     32189>>ASSIGN
VM_SELECT_
     14948**DCL     27280<>CALL    27282>>ASSIGN  27283>>ASSIGN
VM_SEND_ACKNOWLEDGE
     24762**DCL     34158<>CALL    34172<>CALL
VM_SEND_ACKNOWLEDGE.NAME#
     24762**DCL     34156>>IF
VM_SEND_ANSWER
     24686**DCL     27736<>CALL    27750<>CALL
VM_SEND_ANSWER.NAME#
     24686**DCL     27734>>IF
VM_SEND_FILE_NAME
     15094**DCL     19316--DCLINIT
VM_SEND_FORWARD
     24838**DCL     29486<>CALL    29500<>CALL
VM_SEND_FORWARD.NAME#
     24838**DCL     29484>>IF
VM_SEND_FORWARD_ENCL
     24914**DCL     29557<>CALL    29571<>CALL
VM_SEND_FORWARD_ENCL.NAME#
     24914**DCL     29555>>IF
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1071 
VM_SEND_MAIL
     24990**DCL     34255<>CALL
VM_SEND_MAIL.L#
     24990**DCL     34270>>ASSIGN
VM_SEND_MAIL.NAME#
     24990**DCL     34253>>IF      34269>>CALLBLT
VM_SEND_NAME
     25066**DCL     34317<>CALL    34331--ASSIGN
VM_SEND_NAME.NAME#
     25066**DCL     34315>>IF
VM_SITENAME
     15190**DCL     27329<>CALL    28339>>ASSIGN  28390>>IF      30259>>ASSIGN  30312>>IF      30389>>IF
     31874>>IF
VM_STATUS_CCONTEXT_FMT
     22529**DCL     29084<>CALL
VM_STATUS_CCONTEXT_FMT.L#
     22529**DCL     29087>>ASSIGN
VM_STATUS_CCONTEXT_FMT.NAME#
     22529**DCL     29082>>IF      29087--ASSIGN
VM_STATUS_DMSGS_FMT
     22757**DCL     29201<>CALL
VM_STATUS_DMSGS_FMT.L#
     22757**DCL     29204>>ASSIGN
VM_STATUS_DMSGS_FMT.NAME#
     22757**DCL     29199>>IF      29204--ASSIGN
VM_STATUS_FOLDER_FMT
     22377**DCL     29055<>CALL
VM_STATUS_FOLDER_FMT.L#
     22377**DCL     29058>>ASSIGN
VM_STATUS_FOLDER_FMT.NAME#
     22377**DCL     29053>>IF      29058--ASSIGN
VM_STATUS_HMSGS_FMT
     22985**DCL     29282<>CALL
VM_STATUS_HMSGS_FMT.L#
     22985**DCL     29285>>ASSIGN
VM_STATUS_HMSGS_FMT.NAME#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1072 
     22985**DCL     29280>>IF      29285--ASSIGN
VM_STATUS_NMSGS_FMT
     22833**DCL     29228<>CALL
VM_STATUS_NMSGS_FMT.L#
     22833**DCL     29231>>ASSIGN
VM_STATUS_NMSGS_FMT.NAME#
     22833**DCL     29226>>IF      29231--ASSIGN
VM_STATUS_POSITION_FMT
     22605**DCL     29172<>CALL
VM_STATUS_POSITION_FMT.L#
     22605**DCL     29175>>ASSIGN
VM_STATUS_POSITION_FMT.NAME#
     22605**DCL     29170>>IF      29175--ASSIGN
VM_STATUS_POSITION_OUTSIDE_FMT
     22681**DCL     29143<>CALL
VM_STATUS_POSITION_OUTSIDE_FMT.L#
     22681**DCL     29146>>ASSIGN
VM_STATUS_POSITION_OUTSIDE_FMT.NAME#
     22681**DCL     29141>>IF      29146--ASSIGN
VM_STATUS_SCONTEXT_FMT
     22453**DCL     29113<>CALL
VM_STATUS_SCONTEXT_FMT.L#
     22453**DCL     29116>>ASSIGN
VM_STATUS_SCONTEXT_FMT.NAME#
     22453**DCL     29111>>IF      29116--ASSIGN
VM_STATUS_TMSGS_FMT
     22909**DCL     29255<>CALL
VM_STATUS_TMSGS_FMT.L#
     22909**DCL     29258>>ASSIGN
VM_STATUS_TMSGS_FMT.NAME#
     22909**DCL     29253>>IF      29258--ASSIGN
VM_TIME_FMT
     21188**DCL     31234<>CALL
VM_TIME_FMT.L#
     21188**DCL     31237>>ASSIGN
VM_TIME_FMT.NAME#
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1073 
     21188**DCL     31232>>IF      31237--ASSIGN
VM_UADDRESS
     17627**DCL     30824--ASSIGN  31871<>CALL
VM_UADDRESS.FOLDER
     17642**DCL     17643--REDEF
VM_UADDRESS.NAME_KEY
     17640**DCL     31873>>ASSIGN
VM_UADDRESS.SITENAME
     17649**DCL     31874>>IF      31874>>IF
VM_UADDRESS.USER_NAME.COUNT
     17651**DCL     30805<<ASSIGN  30814<<ASSIGN  30816>>IF      30821>>IF      30824>>ASSIGN  30842>>IF
     30847>>ASSIGN  30849>>CALLBLT
VM_UADDRESS.USER_NAME.TEXT
     17652**DCL     30815<<ASSIGN  30824--ASSIGN  30849>>CALLBLT
VM_USERKEY
     17334**DCL     28167<>CALL    28293<>CALL    28451<>CALL    28615>>ASSIGN  28616<>CALL    28631<>CALL
     28636>>ASSIGN  28638<<ASSIGN  28639<>CALL    28648<>CALL    28651<>CALL    29307<>CALL    29309<>CALL
     29349<>CALL    29358<>CALL    29368<>CALL    29370<>CALL    30206<>CALL    30402<>CALL    30408<>CALL
VM_USERKEY.COUNT
     17335**DCL     28619>>ASSIGN  29355>>ASSIGN
VM_USERKEY.TEXT
     17338**DCL     28166<<ASSIGN  28284<<ASSIGN  28288>>IF      28306>>ASSIGN  28614<<ASSIGN  28619--ASSIGN
     28647<<ASSIGN  29305<<ASSIGN  29342<<ASSIGN  29344<<ASSIGN  29345<<ASSIGN  29346<<ASSIGN  29346>>ASSIGN
     29351>>IF      29355--ASSIGN  29367<<ASSIGN  30205<<ASSIGN  30327>>IF
VM_USERKEY2
     17351**DCL     28615<<ASSIGN  28636<<ASSIGN  28638>>ASSIGN
VM_USERS_DELETED_FMT
     22225**DCL     28662<>CALL
VM_USERS_DISPLAYED_FMT
     22301**DCL     29377<>CALL
VM_USE_FULL_FMT
     23061**DCL     31585<>CALL
VM_USE_FULL_FMT.L#
     23061**DCL     31588>>ASSIGN
VM_USE_FULL_FMT.NAME#
     23061**DCL     31583>>IF      31588--ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1074 
VM_USE_LOST_FMT
     23137**DCL     31614<>CALL
VM_USE_LOST_FMT.L#
     23137**DCL     31617>>ASSIGN
VM_USE_LOST_FMT.NAME#
     23137**DCL     31612>>IF      31617--ASSIGN
VM_WILDCARD
     17994**DCL     28563<>CALL    28621<>CALL    28863<>CALL    29357<>CALL    31836<>CALL
VM_WILDCARD.INPUT_
     18000**DCL     28561<<ASSIGN  28619<<ASSIGN  28861<<ASSIGN  29355<<ASSIGN  31834<<ASSIGN
VM_WILDCARD.PATTERN_
     17995**DCL     28517<<ASSIGN  28553<<ASSIGN  28611<<ASSIGN  28842<<ASSIGN  29337<<ASSIGN  29880<<ASSIGN
VM_WORK$
     14925**DCL     30548>>ASSIGN  30868>>ASSIGN  30869>>ASSIGN
VM_WORK_
     14947**DCL     27279<>CALL    30542>>IF      30544>>ASSIGN  30545<>CALL    33516>>ASSIGN  33518>>ASSIGN
     33578<>CALL    33579>>ASSIGN  33715>>ASSIGN  33718>>ASSIGN  33720<>CALL    33772<>CALL    33773>>ASSIGN
     33835<>CALL    33848>>IF      33851<>CALL    34028<>CALL    34029<>CALL
VM_WORK_FOLDER
     17859**DCL     27878<>CALL    27883<>CALL    28064<>CALL    28069<>CALL    29949<>CALL    29962<>CALL
     31854<>CALL
VM_WORK_FOLDER.FLAGS
     17882**DCL     28063<<ASSIGN  31853<<ASSIGN
VM_WORK_FOLDER.FLAGS.FOLDER_SPEC
     17889**DCL     28066<<ASSIGN
VM_WORK_FOLDER.FLAGS.OPEN
     17893**DCL     28000<<ASSIGN
VM_WORK_FOLDER.FLAGS.UPDATE
     17883**DCL     27887>>IF
VM_WORK_FOLDER.SITENAME
     17868**DCL     28067<<ASSIGN
WAIT30
     18134**DCL     31694<>CALL
WAIT30.V
     18135**DCL     18134--DCLINIT
WHICH_CONTEXT
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1075 
     18095**DCL     27671<<ASSIGN  32434<<ASSIGN  32527<<ASSIGN  32551<<ASSIGN  32688>>ASSIGN  32769>>ASSIGN
WHICH_CONTEXT IN PROCEDURE INIT_CONTEXT
     32187**DCL     32186--PROC    32189>>ASSIGN  32189>>ASSIGN  32190>>ASSIGN  32191>>ASSIGN  32192>>ASSIGN
     32193>>ASSIGN
WILD
     16625**DCL     28511<<ASSIGN  28514<<ASSIGN  28536>>IF      29874<<ASSIGN  29877<<ASSIGN  29955>>DOWHILE
     31822>>DOWHILE 31843>>IF
WILDCARD_PATTERN
     16486**DCL     28508<<ASSIGN  28509>>CALLBLT 28516>>CALLBLT 28517--ASSIGN  29871<<ASSIGN  29872>>CALLBLT
     29879>>CALLBLT 29880--ASSIGN
WORK_STRING
     16541**DCL     28070--CALL    28417--CALL    29042<>CALL    29073<>CALL    29102<>CALL    30338--CALL
     31019<>CALL    31161<>CALL    31450--CALL    31492--CALL    31507--CALL    31527--CALL    31572<>CALL
     31952<>CALL    32033--CALL    34276<>CALL
WORK_STRING.L#
     16541**DCL     28068<<ASSIGN  28412<<ASSIGN  28414<<ASSIGN  29041<<ASSIGN  29043>>ASSIGN  29072<<ASSIGN
     29098>>ASSIGN  29101<<ASSIGN  29127>>ASSIGN  30332<<ASSIGN  30335<<ASSIGN  31016<<ASSIGN  31159<<ASSIGN
     31448<<ASSIGN  31490<<ASSIGN  31505<<ASSIGN  31525<<ASSIGN  31571<<ASSIGN  31573>>ASSIGN  31951<<ASSIGN
     31953>>IF      31955<<ASSIGN  32031<<ASSIGN  34275<<ASSIGN  34277>>ASSIGN  34302>>ASSIGN
WORK_STRING.NAME#
     16541**DCL     19142--DCLINIT 19143--DCLINIT 28068--ASSIGN  28407>>IF      28415<<ASSIGN  29041--ASSIGN
     29043--ASSIGN  29072--ASSIGN  29098--ASSIGN  29101--ASSIGN  29127--ASSIGN  30172<<ASSIGN  30174>>CALLBLT
     30327>>IF      30336<<ASSIGN  30371<<ASSIGN  30373>>CALLBLT 31017<<CALLBLT 31160<<ASSIGN  31448--ASSIGN
     31490--ASSIGN  31505--ASSIGN  31525--ASSIGN  31571--ASSIGN  31573--ASSIGN  31951--ASSIGN  31956<<ASSIGN
     32031--ASSIGN  34275--ASSIGN  34278>>ASSIGN  34293>>IF      34299>>ASSIGN  34303>>ASSIGN
WORK_UTS
     16613**DCL     18158--DCLINIT 19726--DCLINIT 29918--ASSIGN  31248--ASSIGN  32860<<ASSIGN
WRITEIT IN PROCEDURE COPY_FOLDER
     33510**DCL     33566<<ASSIGN  33583<<ASSIGN  33585>>DOWHILE 33590<<ASSIGN  33594<<ASSIGN  33598<<ASSIGN
     33604<<ASSIGN  33610<<ASSIGN  33614>>IF
WRITE_ENCL
     20213**DCL     28775<>CALL
WRITE_ENCL.BUF_.BOUND
     20213**DCL     28773<<ASSIGN  28774<<ASSIGN
WRITE_ENCL.BUF_.BUF$
     20215**DCL     28772<<ASSIGN
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1076 
WRITE_ENCL.STATION_
     20215**DCL     20215--REDEF
WRITE_ENCL.V
     20216**DCL     20213--DCLINIT
WRITE_ENCL.V.DVBYTE.VFC#
     20222**DCL     20222--REDEF
WRITE_ERROR IN PROCEDURE PROCESS_CMD
     31701**LABEL   28693--CALLALT 28963--CALLALT 28981--CALLALT 29806--CALLALT 30026--CALLALT 31276--CALLALT
WRITE_NAME_MAP
     19103**DCL     28422<>CALL    30345<>CALL
WRITE_NAME_MAP.BUF_
     19103**DCL     28398<<ASSIGN  30320<<ASSIGN
WRITE_NAME_MAP.STATION_
     19105**DCL     19105--REDEF
WRITE_NAME_MAP.V
     19106**DCL     19103--DCLINIT
WRITE_NAME_MAP.V.DVBYTE.VFC#
     19112**DCL     19112--REDEF
WRITE_NEW IN PROCEDURE UPDATE$MAIL
     33282**DCL     33619<>CALL    34010<>CALL
WRITE_NEW.BUF_ IN PROCEDURE UPDATE$MAIL
     33282**DCL     33615<<ASSIGN  33616<<ASSIGN  34000<<ASSIGN  34003<<ASSIGN
WRITE_NEW.BUF_.BOUND IN PROCEDURE UPDATE$MAIL
     33282**DCL     33617<<ASSIGN  34005<<ASSIGN
WRITE_NEW.KEY_ IN PROCEDURE UPDATE$MAIL
     33282**DCL     34008<<ASSIGN
WRITE_NEW.STATION_ IN PROCEDURE UPDATE$MAIL
     33284**DCL     33284--REDEF
WRITE_NEW.V IN PROCEDURE UPDATE$MAIL
     33285**DCL     33282--DCLINIT
WRITE_NEW.V.DVBYTE IN PROCEDURE UPDATE$MAIL
     33290**DCL     33618<<ASSIGN  34007<<ASSIGN
WRITE_NEW.V.DVBYTE.VFC# IN PROCEDURE UPDATE$MAIL
     33291**DCL     33291--REDEF
X$ALLOCATE
     16476**DCL-ENT 30657--CALL    30722--CALL    30749--CALL    30771--CALL    30832--CALL    30838--CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1077 
     32871--CALL
X$DEALLOCATE
     16477**DCL-ENT 30664--CALL    30711--CALL    30741--CALL    30763--CALL    30788--CALL
X$DEC_CONVERT
     16041**DCL-ENT 32461--CALL    32473--CALL    32650--CALL    32673--CALL    32761--CALL
X$MCB
     18091**DCL     30657<>CALL    30664<>CALL    30711<>CALL    30722<>CALL    30741<>CALL    30749<>CALL
     30763<>CALL    30771<>CALL    30788<>CALL    30832<>CALL    30838<>CALL    32506<>CALL    32545<>CALL
X$MCB.ADDRESS$
     18091**DCL     30658>>ASSIGN  30663<<ASSIGN  30710<<ASSIGN  30723>>ASSIGN  30740<<ASSIGN  30750>>ASSIGN
     30762<<ASSIGN  30772>>ASSIGN  30787<<ASSIGN  30840>>ASSIGN
X$MCB.ERR
     18092**DCL     31737<>CALL
X$MCB.FREE_HEAD$
     18091**DCL     30554<<ASSIGN  30865>>ASSIGN  32501<<ASSIGN  32539<<ASSIGN
X$MCB.HI_SEGMENT$
     18091**DCL     30556<<ASSIGN  30864>>ASSIGN  32504<<ASSIGN  32505>>ASSIGN  32543<<ASSIGN  32544>>ASSIGN
X$MCB.SEGMENT_BASE$
     18091**DCL     30555<<ASSIGN  32503<<ASSIGN  32504>>ASSIGN  32541<<ASSIGN  32543>>ASSIGN
X$MCB.SIZE
     18091**DCL     30656<<ASSIGN  30720<<ASSIGN  30724>>ASSIGN  30747<<ASSIGN  30769<<ASSIGN  30824<<ASSIGN
     30830<<ASSIGN
X$MCB.TYPE
     18091**DCL     30557<<ASSIGN  30721<<ASSIGN  30748<<ASSIGN  30770<<ASSIGN  32502<<ASSIGN  32540<<ASSIGN
X$MCB.WKSZ
     18091**DCL     30552<<ASSIGN  30837<<ASSIGN  30837>>ASSIGN  32505<<ASSIGN  32544<<ASSIGN
X$STRING
     14912**DCL     28152--CALL    28173--CALL    28299--CALL    28313--CALL    32632<>CALL    34117--CALL
X$STRING.SIZ
     14913**DCL     14914--IMP-SIZ 28152>>CALL    28173>>CALL    28299>>CALL    28313>>CALL    28731>>CALLBLT
     28989>>IF      30724<<ASSIGN  30725>>ASSIGN  30751<<ASSIGN  30752>>ASSIGN  30773<<ASSIGN  30774>>ASSIGN
     31017>>CALLBLT 32632>>CALL    32874<<ASSIGN  32875>>ASSIGN  34117>>CALL
X$STRING.TEXT
     14914**DCL     28731>>CALLBLT 28989>>IF      30725<<ASSIGN  30752<<ASSIGN  30774<<ASSIGN  31017>>CALLBLT
     32875<<ASSIGN
X$WILDCMP
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1078 
     16474**DCL-ENT 28563--CALL    28621--CALL    28863--CALL    29357--CALL    31836--CALL
XTX$ADAPT
     16068**DCL-ENT 16147--DCLINIT
XUG$GETCMD.ERR#
     15710**DCL     28760<>CALL    28830<>CALL    28911<>CALL    29018<>CALL    29034<>CALL    29325<>CALL
     29835<>CALL    29993<>CALL    30470<>CALL
XUG$GETCMD.OUT$
     15704**DCL     15710--REDEF
XUG_GETCMD$
     16024**DCL     15699--IMP-PTR 27290<>CALL    28760>>CALL    28830>>CALL    28911>>CALL    29018>>CALL
     29034>>CALL    29325>>CALL    29835>>CALL    29993>>CALL    30470>>CALL
XUR$ALLMSG
     14650**DCL-ENT 29706--CALL
XUR$BREAK
     14643**DCL-ENT 18529--DCLINIT
XUR$CLRENABLE
     14646**DCL-ENT 27467--CALL    32065--CALL    32072--CALL
XUR$DISABLE
     14644**DCL-ENT 27314--CALL    27919--CALL    28030--CALL    28323--CALL    28606--CALL    28685--CALL
     28953--CALL    28980--CALL    30020--CALL    30054--CALL    30315--CALL    30392--CALL    31271--CALL
     31304--CALL    31329--CALL    31970--CALL    33333--CALL
XUR$ECHO
     14634**DCL-ENT 27483--CALL    27490--CALL
XUR$ENABLE
     14645**DCL-ENT 27646--CALL    27968--CALL    28457--CALL    28661--CALL    28694--CALL    28965--CALL
     28983--CALL    30027--CALL    30057--CALL    30341--CALL    30347--CALL    30399--CALL    31278--CALL
     31307--CALL    31686--CALL    31730--CALL    33483--CALL    33489--CALL
XUR$ERRMSG
     14639**DCL-ENT 27413--CALL    27566--CALL    27651--CALL    27760--CALL    27889--CALL    27988--CALL
     27989--CALL    28053--CALL    28121--CALL    28122--CALL    28152--CALL    28173--CALL    28290--CALL
     28299--CALL    28313--CALL    28417--CALL    28485--CALL    28496--CALL    28530--CALL    28531--CALL
     28589--CALL    28706--CALL    28712--CALL    28720--CALL    28743--CALL    28750--CALL    28760--CALL
     28769--CALL    28777--CALL    28830--CALL    28911--CALL    28933--CALL    28942--CALL    29018--CALL
     29034--CALL    29325--CALL    29391--CALL    29392--CALL    29512--CALL    29529--CALL    29538--CALL
     29712--CALL    29835--CALL    29854--CALL    29886--CALL    29958--CALL    29993--CALL    30076--CALL
     30114--CALL    30185--CALL    30208--CALL    30244--CALL    30338--CALL    30383--CALL    30470--CALL
PL6.E3A0      #001=VMO$MAIL File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:19 Page:1079 
     30684--CALL    30779--CALL    30871--CALL    30872--CALL    30902--CALL    30958--CALL    31031--CALL
     31527--CALL    31530--CALL    31537--CALL    31664--CALL    31665--CALL    31674--CALL    31676--CALL
     31711--CALL    31712--CALL    31721--CALL    31722--CALL    31729--CALL    31737--CALL    31751--CALL
     31761--CALL    31773--CALL    31842--CALL    32018--CALL    32033--CALL    32036--CALL    32043--CALL
     32052--CALL    32071--CALL    32482--CALL    32557--CALL    32561--CALL    32807--CALL    32831--CALL
     33404--CALL    33477--CALL    33492--CALL    33517--CALL    33637--CALL    33638--CALL    33647--CALL
     33717--CALL    34034--CALL    34035--CALL    34044--CALL    34117--CALL
XUR$ERRPTR
     14632**DCL-ENT 27412--CALL    27565--CALL    30113--CALL    30243--CALL    30901--CALL    32481--CALL
     32556--CALL    32806--CALL
XUR$GETCMD
     14631**DCL-ENT 27409--CALL    27481--CALL    27506--CALL    30110--CALL    30240--CALL    34288--CALL
XUR$HELP
     14648**DCL-ENT 29701--CALL
XUR$INFOMSG
     14640**DCL-ENT 27502--CALL    28070--CALL    31450--CALL    31492--CALL    31507--CALL    31700--CALL
XUR$INIT
     14636**DCL-ENT 27290--CALL
XUR$MOREMSG
     14649**DCL-ENT 29704--CALL
XUR$OPENOUT
     14653**DCL-ENT 28758--CALL    28825--CALL    28906--CALL    29013--CALL    29029--CALL    29320--CALL
     29830--CALL    29988--CALL    30468--CALL
XUR$SETDCBS
     14635**DCL-ENT 27311--CALL    27555--CALL    30947--CALL    30959--CALL
XUR$SETERRMSG
     14641**DCL-ENT 27294--CALL
XUR_ERROR
     27514**LABEL   27486--GOTO    27506--CALLALT
XUR_INIT
     16073**DCL     27290<>CALL
XUR_INIT.WORKR_
     16087**DCL     16088--REDEF
XUR_INIT.WORK_
     16088**DCL     27289<<ASSIGN

PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1080 
     6809        1        /*T***********************************************************/
     6810        2        /*T*                                                         */
     6811        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     6812        4        /*T*                                                         */
     6813        5        /*T***********************************************************/
     6814        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     6815        7        /*******************************************************************/
     6816        8        /*F*    NAME:        VMO$CLEANUP
     6817        9                PURPOSE:     To exit in an orderly manner from MAIL.
     6818       10                DESCRIPTION: All dcbs will be closed, EXIT CONTROL reset,
     6819       11                             and anything else necessary to shut MAIL down
     6820       12                             cleanly.
     6821       13        */
     6822       14
     6823       15        /*******************************************************************/
     6824       16        VMO$CLEANUP: PROC;
     6825       17        /***** Include files *****/
     6826       18        %INCLUDE CP_6;
     6827     5577        %INCLUDE CP_6_SUBS;
     6828     6117        %INCLUDE VM_DATA_R;
     6829     6548        %INCLUDE VM_MACRO_C;
     6830     7816        /***** Fpts *****/
     6831     7817        %FPT_CLOSE (FPTN=CLOSE_SAVE,DISP=SAVE);
     6832     7859        %FPT_CLOSE (FPTN=CLOSE_SCRATCH,DISP=SCRATCH);
     6833     7901        %F$DCB;
     6834     7958        %VM_FOLDER_INFO (NAME=VM_CURRENT_FOLDER, STCLASS=SYMREF);
     6835     8010    1   DCL M$OUT_NUM UBIN SYMREF;
     6836     8011        %EJECT;
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1081 
     6837     8012    1       VM_CURRENT_FOLDER.FLAGS.UPDATE = %NO#;
     6838     8013        /*
     6839     8014             ***** Close all dcbs ...
     6840     8015        */
     6841     8016    1       IF DCBADDR(M$SI_NUM) -> F$DCB.FCD#
     6842     8017    1       THEN                            /* Close it */
     6843     8018    2       DO;
     6844     8019    2           CLOSE_SAVE.V.DCB# = M$SI_NUM;
     6845     8020    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_SI);
     6846     8021    2       END;
     6847     8022    1   IGNORE_SI:
     6848     8023    1       IF DCBADDR(M$NODE_NUM) -> F$DCB.FCD#
     6849     8024    1       THEN                            /* Close it */
     6850     8025    2       DO;
     6851     8026    2           CLOSE_SAVE.V.DCB# = M$NODE_NUM;
     6852     8027    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_NODE);
     6853     8028    2       END;
     6854     8029    1   IGNORE_NODE:;
     6855     8030    1       IF DCBADDR(M$LO_NUM) -> F$DCB.FCD#
     6856     8031    1       THEN
     6857     8032    2       DO;                          /* Close it */
     6858     8033    2           CLOSE_SAVE.V.DCB# = M$LO_NUM;
     6859     8034    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_LO);
     6860     8035    2       END;
     6861     8036    1   IGNORE_LO:
     6862     8037    1       IF DCBADDR(M$MAIL_FILE_NUM) -> F$DCB.FCD#
     6863     8038    1       THEN                            /* Close it */
     6864     8039    2       DO;
     6865     8040    2           CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;
     6866     8041    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_MAIL_FILE);
     6867     8042    2       END;
     6868     8043
     6869     8044    1   IGNORE_MAIL_FILE:
     6870     8045    1       IF DCBADDR(M$ME_NUM) -> F$DCB.FCD#
     6871     8046    1       THEN                            /* Close it */
     6872     8047    2       DO;
     6873     8048    2           CLOSE_SAVE.V.DCB# = M$ME_NUM;
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1082 
     6874     8049    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_ME);
     6875     8050    2       END;
     6876     8051
     6877     8052    1   IGNORE_ME:
     6878     8053    1       IF DCBADDR(M$OUT_NUM) -> F$DCB.FCD#
     6879     8054    1       THEN                            /* Close it */
     6880     8055    2       DO;
     6881     8056    2           CLOSE_SAVE.V.DCB# = M$OUT_NUM;
     6882     8057    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_OUT);
     6883     8058    2       END;
     6884     8059
     6885     8060    1   IGNORE_OUT:
     6886     8061                  /* Do not close M$WORK as this may result in a partially renumbered
     6887     8062                  folder replacing the old one */
     6888     8063    1       RETURN;
     6889     8064    1   END VMO$CLEANUP;
     6890     8065        %EOD;

PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1083 
--  Include file information  --

   VM_MACRO_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMO$CLEANUP.

   Procedure VMO$CLEANUP requires 77 words for executable code.
   Procedure VMO$CLEANUP requires 4 words of local(AUTO) storage.

PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1084 

 Object Unit name= VMO$CLEANUP                                File name= VMO$MAIL.:VMB6TOU
 UTS= AUG 20 '97 15:23:57.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11   Data  even  none    60     74  VMO$CLEANUP
   12   Proc  even  none    77    115  VMO$CLEANUP
   13  RoData even  none     2      2  VMO$CLEANUP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    12      0   yes            yes      Std        0  VMO$CLEANUP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1085 

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
     VM_SITENAME                           VM_MAILCG_SETSTA                      VM_CURRENT_FOLDER
     M$OUT_NUM

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1086 


     6809        1        /*T***********************************************************/
     6810        2        /*T*                                                         */
     6811        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     6812        4        /*T*                                                         */
     6813        5        /*T***********************************************************/
     6814        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     6815        7        /*******************************************************************/
     6816        8        /*F*    NAME:        VMO$CLEANUP
     6817        9                PURPOSE:     To exit in an orderly manner from MAIL.
     6818       10                DESCRIPTION: All dcbs will be closed, EXIT CONTROL reset,
     6819       11                             and anything else necessary to shut MAIL down
     6820       12                             cleanly.
     6821       13        */
     6822       14
     6823       15        /*******************************************************************/
     6824       16        VMO$CLEANUP: PROC;

     16 12 000000   000000 700200 xent  VMO$CLEANUP  TSX0  ! X66_AUTO_0
        12 000001   000004 000000                    ZERO    4,0

     6825       17        /***** Include files *****/
     6826       18        %INCLUDE CP_6;
     6827     5577        %INCLUDE CP_6_SUBS;
     6828     6117        %INCLUDE VM_DATA_R;
     6829     6548        %INCLUDE VM_MACRO_C;
     6830     7816        /***** Fpts *****/
     6831     7817        %FPT_CLOSE (FPTN=CLOSE_SAVE,DISP=SAVE);
     6832     7859        %FPT_CLOSE (FPTN=CLOSE_SCRATCH,DISP=SCRATCH);
     6833     7901        %F$DCB;
     6834     7958        %VM_FOLDER_INFO (NAME=VM_CURRENT_FOLDER, STCLASS=SYMREF);
     6835     8010    1   DCL M$OUT_NUM UBIN SYMREF;
     6836     8011        %EJECT;
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1087 
     6837     8012    1       VM_CURRENT_FOLDER.FLAGS.UPDATE = %NO#;

   8012 12 000002   000000 236000 13                 LDQ     0
        12 000003   000023 356000 xsym               ANSQ    VM_CURRENT_FOLDER+19

     6838     8013        /*
     6839     8014             ***** Close all dcbs ...
     6840     8015        */
     6841     8016    1       IF DCBADDR(M$SI_NUM) -> F$DCB.FCD#

   8016 12 000004   000001 470400 13                 LDP0    1
        12 000005   000000 471500                    LDP1    0,,PR0
        12 000006   000000 720000 xsym               LXL0    M$SI_NUM
        12 000007   100000 473510                    LDP3    0,X0,PR1
        12 000010   300031 236100                    LDQ     25,,PR3
        12 000011   020000 316007                    CANQ    8192,DL
        12 000012   000020 600000 12                 TZE     IGNORE_SI

     6842     8017    1       THEN                            /* Close it */
     6843     8018    2       DO;

     6844     8019    2           CLOSE_SAVE.V.DCB# = M$SI_NUM;

   8019 12 000013   000032 740000 11                 STX0    CLOSE_SAVE+26

     6845     8020    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_SI);

   8020 12 000014   000000 630400 11                 EPPR0   CLOSE_SAVE
        12 000015   450001 713400                    CLIMB   alt,close
        12 000016   406000 401760                    pmme    nvectors=13
        12 000017   000020 702000 12                 TSX2    IGNORE_SI

     6846     8021    2       END;

     6847     8022    1   IGNORE_SI:
     6848     8023    1       IF DCBADDR(M$NODE_NUM) -> F$DCB.FCD#

PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1088 
   8023 12 000020   000001 470400 13    IGNORE_SI    LDP0    1
        12 000021   000000 471500                    LDP1    0,,PR0
        12 000022   000000 720000 xsym               LXL0    M$NODE_NUM
        12 000023   100000 473510                    LDP3    0,X0,PR1
        12 000024   300031 236100                    LDQ     25,,PR3
        12 000025   020000 316007                    CANQ    8192,DL
        12 000026   000034 600000 12                 TZE     IGNORE_NODE

     6849     8024    1       THEN                            /* Close it */
     6850     8025    2       DO;

     6851     8026    2           CLOSE_SAVE.V.DCB# = M$NODE_NUM;

   8026 12 000027   000032 740000 11                 STX0    CLOSE_SAVE+26

     6852     8027    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_NODE);

   8027 12 000030   000000 630400 11                 EPPR0   CLOSE_SAVE
        12 000031   450001 713400                    CLIMB   alt,close
        12 000032   406000 401760                    pmme    nvectors=13
        12 000033   000034 702000 12                 TSX2    IGNORE_NODE

     6853     8028    2       END;

   8023 12 000034                       IGNORE_NODE  null
     6854     8029    1   IGNORE_NODE:;
     6855     8030    1       IF DCBADDR(M$LO_NUM) -> F$DCB.FCD#

   8030 12 000034   000001 470400 13                 LDP0    1
        12 000035   000000 471500                    LDP1    0,,PR0
        12 000036   000000 720000 xsym               LXL0    M$LO_NUM
        12 000037   100000 473510                    LDP3    0,X0,PR1
        12 000040   300031 236100                    LDQ     25,,PR3
        12 000041   020000 316007                    CANQ    8192,DL
        12 000042   000050 600000 12                 TZE     IGNORE_LO

     6856     8031    1       THEN
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1089 
     6857     8032    2       DO;                          /* Close it */

     6858     8033    2           CLOSE_SAVE.V.DCB# = M$LO_NUM;

   8033 12 000043   000032 740000 11                 STX0    CLOSE_SAVE+26

     6859     8034    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_LO);

   8034 12 000044   000000 630400 11                 EPPR0   CLOSE_SAVE
        12 000045   450001 713400                    CLIMB   alt,close
        12 000046   406000 401760                    pmme    nvectors=13
        12 000047   000050 702000 12                 TSX2    IGNORE_LO

     6860     8035    2       END;

     6861     8036    1   IGNORE_LO:
     6862     8037    1       IF DCBADDR(M$MAIL_FILE_NUM) -> F$DCB.FCD#

   8037 12 000050   000001 470400 13    IGNORE_LO    LDP0    1
        12 000051   000000 471500                    LDP1    0,,PR0
        12 000052   000000 720000 xsym               LXL0    M$MAIL_FILE_NUM
        12 000053   100000 473510                    LDP3    0,X0,PR1
        12 000054   300031 236100                    LDQ     25,,PR3
        12 000055   020000 316007                    CANQ    8192,DL
        12 000056   000064 600000 12                 TZE     IGNORE_MAIL_FILE

     6863     8038    1       THEN                            /* Close it */
     6864     8039    2       DO;

     6865     8040    2           CLOSE_SAVE.V.DCB# = M$MAIL_FILE_NUM;

   8040 12 000057   000032 740000 11                 STX0    CLOSE_SAVE+26

     6866     8041    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_MAIL_FILE);

   8041 12 000060   000000 630400 11                 EPPR0   CLOSE_SAVE
        12 000061   450001 713400                    CLIMB   alt,close
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1090 
        12 000062   406000 401760                    pmme    nvectors=13
        12 000063   000064 702000 12                 TSX2    IGNORE_MAIL_FILE

     6867     8042    2       END;

     6868     8043
     6869     8044    1   IGNORE_MAIL_FILE:
     6870     8045    1       IF DCBADDR(M$ME_NUM) -> F$DCB.FCD#

   8045 12 000064   000001 470400 13    IGNORE_MAIL* LDP0    1
        12 000065   000000 471500                    LDP1    0,,PR0
        12 000066   000000 720000 xsym               LXL0    M$ME_NUM
        12 000067   100000 473510                    LDP3    0,X0,PR1
        12 000070   300031 236100                    LDQ     25,,PR3
        12 000071   020000 316007                    CANQ    8192,DL
        12 000072   000100 600000 12                 TZE     IGNORE_ME

     6871     8046    1       THEN                            /* Close it */
     6872     8047    2       DO;

     6873     8048    2           CLOSE_SAVE.V.DCB# = M$ME_NUM;

   8048 12 000073   000032 740000 11                 STX0    CLOSE_SAVE+26

     6874     8049    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_ME);

   8049 12 000074   000000 630400 11                 EPPR0   CLOSE_SAVE
        12 000075   450001 713400                    CLIMB   alt,close
        12 000076   406000 401760                    pmme    nvectors=13
        12 000077   000100 702000 12                 TSX2    IGNORE_ME

     6875     8050    2       END;

     6876     8051
     6877     8052    1   IGNORE_ME:
     6878     8053    1       IF DCBADDR(M$OUT_NUM) -> F$DCB.FCD#

PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1091 
   8053 12 000100   000001 470400 13    IGNORE_ME    LDP0    1
        12 000101   000000 471500                    LDP1    0,,PR0
        12 000102   000000 720000 xsym               LXL0    M$OUT_NUM
        12 000103   100000 473510                    LDP3    0,X0,PR1
        12 000104   300031 236100                    LDQ     25,,PR3
        12 000105   020000 316007                    CANQ    8192,DL
        12 000106   000114 600000 12                 TZE     IGNORE_OUT

     6879     8054    1       THEN                            /* Close it */
     6880     8055    2       DO;

     6881     8056    2           CLOSE_SAVE.V.DCB# = M$OUT_NUM;

   8056 12 000107   000032 740000 11                 STX0    CLOSE_SAVE+26

     6882     8057    2           CALL M$CLOSE (CLOSE_SAVE) ALTRET(IGNORE_OUT);

   8057 12 000110   000000 630400 11                 EPPR0   CLOSE_SAVE
        12 000111   450001 713400                    CLIMB   alt,close
        12 000112   406000 401760                    pmme    nvectors=13
        12 000113   000114 702000 12                 TSX2    IGNORE_OUT

     6883     8058    2       END;

     6884     8059
     6885     8060    1   IGNORE_OUT:
     6886     8061                  /* Do not close M$WORK as this may result in a partially renumbered
     6887     8062                  folder replacing the old one */
     6888     8063    1       RETURN;

   8063 12 000114   000000 702200 xent  IGNORE_OUT   TSX2  ! X66_ARET

CLOSE_SAVE
 Sect OctLoc
  11     000   000003 777640   000032 006000   000000 177640   000000 006014    ................
  11     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     030*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1092 
  11     034   000220 000000   000000 000000                                    ........

CLOSE_SCRATCH
 Sect OctLoc
  11     036   000003 777640   000070 006000   000000 177640   000000 006014    .....8..........
  11     042   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     066*  000000 177640   000000 006014   000000 000001   000000 000040    ...............
  11     072   000220 000000   000000 000000                                    ........

(unnamed)
 Sect OctLoc
  13     000   377777 777777   000000 006003                                    ........
     6889     8064    1   END VMO$CLEANUP;
     6890     8065        %EOD;

PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1093 
--  Include file information  --

   VM_MACRO_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMO$CLEANUP.
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1094 

 **** Variables and constants ****

  ****  Section 011  Data  VMO$CLEANUP

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1080)  r     1 CLOSE_SAVE                36-0-0/d STRC(1080)  r     1 CLOSE_SCRATCH

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$JIT$                     0-0-0/w PTR               1 B$TCB$
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/w UBIN              1 M$DO_NUM
     0-0-0/w UBIN        r     1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN        r     1 M$MAIL_FILE_NUM
     0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN        r     1 M$ME_NUM
     0-0-0/w UBIN        r     1 M$NODE_NUM                 0-0-0/w UBIN        r     1 M$OUT_NUM
     0-0-0/w UBIN        r     1 M$SI_NUM                   0-0-0/w UBIN              1 M$WORK_NUM
     0-0-0/w PTR               1 VM_ADDLIST$                0-0-0/d VECT              1 VM_ADDLIST_
     0-0-0/w PTR               1 VM_ADDREC$                 0-0-0/d VECT              1 VM_ADDREC_
     0-0-0/w PTR               1 VM_COPY$                   0-0-0/d VECT              1 VM_COPY_
     0-0-0/w STRC(2529)  r     1 VM_CURRENT_FOLDER          0-0-0/w PTR               1 VM_ENCLLIST$
     0-0-0/d VECT              1 VM_ENCLLIST_               0-0-0/w PTR               1 VM_ENCLREC$
     0-0-0/d VECT              1 VM_ENCLREC_                0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME
     0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME       0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS
     0-0-0/w PTR               1 VM_HEADER$                 0-0-0/d VECT              1 VM_HEADER_
     0-0-0/d VECT              1 VM_HEADER_INIT_            0-0-0/w PTR               1 VM_INPUT$
     0-0-0/d VECT              1 VM_INPUT_                  0-0-0/c STRC(72)          1 VM_MAILCG_NAME
     0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA           0-0-0/c STRC(72)          1 VM_MAIL_ACCT
     0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME           0-0-0/w PTR               1 VM_PARSEAREA$
     0-0-0/d VECT              1 VM_PARSEAREA_              0-0-0/w PTR               1 VM_PROFILE$
     0-0-0/d VECT              1 VM_PROFILE_                0-0-0/w PTR               1 VM_SELECT$
     0-0-0/d VECT              1 VM_SELECT_                 0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME
     0-0-0/c CHAR(8)           1 VM_SITENAME                0-0-0/w PTR               1 VM_WORK$
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1095 
     0-0-0/d VECT              1 VM_WORK_

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0N  NULL        r     1 M$DO
     0-0-0N  NULL        r     1 M$LO                       0-0-0N  NULL        r     1 M$MAIL_CENTRAL
     0-0-0N  NULL        r     1 M$MAIL_COMGROUP            0-0-0N  NULL        r     1 M$MAIL_FILE
     0-0-0N  NULL        r     1 M$MAIL_GLOBAL              0-0-0N  NULL        r     1 M$ME
     0-0-0N  NULL        r     1 M$NODE                     0-0-0N  NULL        r     1 M$SI
     0-0-0N  NULL        r     1 M$UC                       0-0-0N  NULL        r     1 M$WORK
     0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VMO$CLEANUP requires 77 words for executable code.
   Procedure VMO$CLEANUP requires 4 words of local(AUTO) storage.
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1096 
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1097 
          MINI XREF LISTING

CLOSE_SAVE
      7840**DCL      8020<>CALL     8027<>CALL     8034<>CALL     8041<>CALL     8049<>CALL     8057<>CALL
CLOSE_SAVE.SN_
      7840**DCL      7840--REDEF
CLOSE_SAVE.UTL_
      7841**DCL      7841--REDEF
CLOSE_SAVE.V
      7845**DCL      7840--DCLINIT
CLOSE_SAVE.V.DCB#
      7846**DCL      8019<<ASSIGN   8026<<ASSIGN   8033<<ASSIGN   8040<<ASSIGN   8048<<ASSIGN   8056<<ASSIGN
CLOSE_SAVE.V.EXPIRE#
      7855**DCL      7855--REDEF
CLOSE_SAVE.V.TYPE#
      7853**DCL      7853--REDEF
CLOSE_SAVE.V.XTNSIZE#
      7850**DCL      7850--REDEF    7852--REDEF
CLOSE_SCRATCH.SN_
      7882**DCL      7882--REDEF
CLOSE_SCRATCH.UTL_
      7883**DCL      7883--REDEF
CLOSE_SCRATCH.V
      7887**DCL      7882--DCLINIT
CLOSE_SCRATCH.V.EXPIRE#
      7897**DCL      7897--REDEF
CLOSE_SCRATCH.V.TYPE#
      7895**DCL      7895--REDEF
CLOSE_SCRATCH.V.XTNSIZE#
      7892**DCL      7892--REDEF    7894--REDEF
ERRMSG_FID.L#
      6393**DCL      6393--IMP-SIZ
F$DCB.ACTPOS
      7934**DCL      7934--REDEF
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1098 
F$DCB.ARS#
      7908**DCL      7908--REDEF
F$DCB.ATTR
      7927**DCL      7928--REDEF
F$DCB.BORROW
      7942**DCL      7942--REDEF    7942--REDEF    7942--REDEF
F$DCB.DCBNAME.L
      7956**DCL      7956--IMP-SIZ
F$DCB.EOMCHAR#
      7912**DCL      7912--REDEF
F$DCB.FCD#
      7921**DCL      8016>>IF       8023>>IF       8030>>IF       8037>>IF       8045>>IF       8053>>IF
F$DCB.FLDID
      7937**DCL      7937--REDEF
F$DCB.FORM$
      7931**DCL      7931--REDEF
F$DCB.FSECT
      7947**DCL      7947--REDEF
F$DCB.FSN#
      7924**DCL      7924--REDEF    7924--REDEF    7925--REDEF
F$DCB.HEADER$
      7930**DCL      7930--REDEF
F$DCB.IXTNSIZE#
      7928**DCL      7928--REDEF
F$DCB.LASTSTA$
      7917**DCL      7917--REDEF
F$DCB.LVL
      7943**DCL      7943--REDEF
F$DCB.NAME#.C
      7918**DCL      7918--REDEF
F$DCB.NOEOF
      7940**DCL      7940--REDEF
F$DCB.NRECS#
      7929**DCL      7929--REDEF
F$DCB.NRECX
      7948**DCL      7948--REDEF
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1099 
F$DCB.OHDR
      7940**DCL      7940--REDEF
F$DCB.ORG#
      7923**DCL      7923--REDEF
F$DCB.PRECNO
      7946**DCL      7946--REDEF
F$DCB.RCSZ
      7952**DCL      7952--REDEF
F$DCB.RES#
      7919**DCL      7919--REDEF
F$DCB.SETX
      7931**DCL      7931--REDEF
F$DCB.TAB$
      7931**DCL      7931--REDEF
F$DCB.TDA
      7945**DCL      7946--REDEF
F$DCB.WSN#
      7919**DCL      7919--REDEF
IGNORE_LO
      8037**LABEL    8034--CALLALT
IGNORE_MAIL_FILE
      8045**LABEL    8041--CALLALT
IGNORE_ME
      8053**LABEL    8049--CALLALT
IGNORE_NODE
      8023**LABEL    8027--CALLALT
IGNORE_OUT
      8063**LABEL    8057--CALLALT
IGNORE_SI
      8023**LABEL    8020--CALLALT
M$CLOSE
      5505**DCL-ENT  8020--CALL     8027--CALL     8034--CALL     8041--CALL     8049--CALL     8057--CALL
M$LO_NUM
      6318**DCL      8030--IF       8033>>ASSIGN
M$MAIL_FILE_NUM
      6304**DCL      8037--IF       8040>>ASSIGN
PL6.E3A0      #002=VMO$CLEANUP File=VMO$MAIL.:VMB6TSI                            WED 08/20/97 15:23 Page:1100 
M$ME_NUM
      6316**DCL      8045--IF       8048>>ASSIGN
M$NODE_NUM
      6321**DCL      8023--IF       8026>>ASSIGN
M$OUT_NUM
      8010**DCL      8053--IF       8056>>ASSIGN
M$SI_NUM
      6320**DCL      8016--IF       8019>>ASSIGN
VM_CURRENT_FOLDER.FLAGS.UPDATE
      7992**DCL      8012<<ASSIGN
X$STRING.SIZ
      6239**DCL      6240--IMP-SIZ

PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1101 
     6891        1        /*T***********************************************************/
     6892        2        /*T*                                                         */
     6893        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     6894        4        /*T*                                                         */
     6895        5        /*T***********************************************************/
     6896        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     6897        7        VMO$XCON: PROC ASYNC;
     6898        8        %INCLUDE CP_6;
     6899     5567        %INCLUDE VM_MACRO_C;
     6900     6835        %INCLUDE VM_PERR_C;
     6901     7130        %INCLUDE B_ERRORS_C;
     6902     8257        %INCLUDE CP_6_SUBS;
     6903     8797        %INCLUDE VM_DATA_R;
     6904     9228        %FPT_XCON (FPTN=RESET,STCLASS=CONSTANT);
     6905     9242        %VM_KEYTYPES;
     6906     9263        %VM_PROFILE (NAME=VM_PROSTUB,STCLASS=AUTO); /* Big enuff for fixed fields */
     6907     9350        %VM_PROKEY (STCLASS=CONSTANT);
     6908     9365        %FPT_READ (FPTN=READ_PROFILE,KEY=VM_PROKEY,KEYS=YES,DCB=M$MAIL_FILE,STCLASS=STATIC);
     6909     9404        %FPT_ENQ (FPTN=ENQ_PROFILE, STCLASS=CONSTANT,
     6910     9405             DCB=M$MAIL_FILE,
     6911     9406             RNAME=VM_PRORES,
     6912     9407             SHARE=NONE,
     6913     9408             WAIT=YES);
     6914     9426        %VM_PRORES;
     6915     9440        %VLP_ERRCODE (FPTN=E_PROWRERR,FCG="VM",MID="O",
     6916     9441                  ERR#=%E$PROWRERR,STCLASS=CONSTANT);
     6917     9486        /*E*      ERROR: VMO-E$PROWRERR-0
     6918     9487                  MESSAGE: Error writing PROFILE record, some new mail may be lost.
     6919     9488        */
     6920     9489              %B$TCB (STCLASS="BASED(B$TCB$)");
     6921     9492        %VM_PROFILE;
     6922     9579    1   DCL VMD$PUT_PROFILE ENTRY(1) ALTRET;
     6923     9580        %INCLUDE XUR_ENTRY;
     6924     9612        %B$ALT;
     6925     9620        /***** External routines *****/
     6926     9621    1   DCL VMO$CLEANUP ENTRY;
     6927     9622        /***** Symref data *****/
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1102 
     6928     9623        %VM_FOLDER_INFO (NAME=VM_CURRENT_FOLDER,STCLASS="SYMREF");
     6929     9675        %EJECT;
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1103 
     6930     9676    1       CALL M$XCON (RESET);              /* Incase the stuff below dosen't work
     6931     9677                                                   either */
     6932     9678    1       IF VM_CURRENT_FOLDER.FLAGS.OPEN AND VM_CURRENT_FOLDER.FLAGS.UPDATE THEN
     6933     9679    2       DO;
     6934     9680    2           READ_PROFILE.BUF_ = VECTOR(VM_PROSTUB);
     6935     9681    2           CALL M$ENQ (ENQ_PROFILE) ALTRET(ALT);
     6936     9682    2           CALL M$READ (READ_PROFILE) /* Get fixed fields */
     6937     9683    3           WHENALTRETURN DO;
     6938     9684    3               IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$LD THEN GOTO ALT;
     6939     9685    3           END;
     6940     9686    2           VM_PROFILE.NUM_MESSAGES = VM_PROSTUB.NUM_MESSAGES;
     6941     9687    2           VM_PROFILE.NUM_NEW_MESSAGES = VM_PROSTUB.NUM_NEW_MESSAGES;
     6942     9688    2           VM_PROFILE.HI_MESSAGE_NUMBER = VM_PROSTUB.HI_MESSAGE_NUMBER;
     6943     9689    2           CALL VMD$PUT_PROFILE(M$MAIL_FILE_NUM) ALTRET(ALT);
     6944     9690    2       END;
     6945     9691    2       DO WHILE ('0'B);
     6946     9692    2   ALT:
     6947     9693    2           CALL XUR$ERRMSG(B$TCB.ALT$->B$ALT.ERR);
     6948     9694    2           CALL XUR$ERRMSG(E_PROWRERR);
     6949     9695    2       END;
     6950     9696        /*
     6951     9697             ***** Close all dcbs properly ...
     6952     9698        */
     6953     9699    1       CALL VMO$CLEANUP;
     6954     9700        /*
     6955     9701             ***** If the current folder is still marked
     6956     9702                   as open, then signal mailman that we are closed ...
     6957     9703        */
     6958     9704    1       CALL M$MERCS;
     6959     9705    1   END;
     6960     9706        %EOD;

PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1104 
--  Include file information  --

   XUR_ENTRY.:LIB_E05  cannot be made into a system file and is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMO$XCON.

   Procedure VMO$XCON requires 60 words for executable code.
   Procedure VMO$XCON requires 118 words of local(AUTO) storage.

PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1105 

 Object Unit name= VMO$XCON                                   File name= VMO$MAIL.:VMB6TOU
 UTS= AUG 20 '97 15:24:12.72 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11  RoData even  UTS     19     23  VMO$XCON
   12   Data  even  none    16     20  VMO$XCON
   13   Proc  even  none    60     74  VMO$XCON
   14  RoData even  none     5      5  VMO$XCON

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    13      0   yes            yes     Async       0  VMO$XCON
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1106 

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 VMD$PUT_PROFILE
         yes           Std       0 VMO$CLEANUP
 yes     yes           Std       7 XUR$ERRMSG
                       nStd      0 X66_AAUTO
                       nStd      0 X66_AARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
     VM_SITENAME                           VM_MAILCG_SETSTA                      VM_CURRENT_FOLDER
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1107 

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1108 


     6891        1        /*T***********************************************************/
     6892        2        /*T*                                                         */
     6893        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     6894        4        /*T*                                                         */
     6895        5        /*T***********************************************************/
     6896        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     6897        7        VMO$XCON: PROC ASYNC;

      7 13 000000   000000 700200 xent  VMO$XCON     TSX0  ! X66_AAUTO
        13 000001   000166 000000                    ZERO    118,0

     6898        8        %INCLUDE CP_6;
     6899     5567        %INCLUDE VM_MACRO_C;
     6900     6835        %INCLUDE VM_PERR_C;
     6901     7130        %INCLUDE B_ERRORS_C;
     6902     8257        %INCLUDE CP_6_SUBS;
     6903     8797        %INCLUDE VM_DATA_R;
     6904     9228        %FPT_XCON (FPTN=RESET,STCLASS=CONSTANT);
     6905     9242        %VM_KEYTYPES;
     6906     9263        %VM_PROFILE (NAME=VM_PROSTUB,STCLASS=AUTO); /* Big enuff for fixed fields */
     6907     9350        %VM_PROKEY (STCLASS=CONSTANT);
     6908     9365       %FPT_READ (FPTN=READ_PROFILE,KEY=VM_PROKEY,KEYS=YES,DCB=M$MAIL_FILE,STCLASS=STATIC);
     6909     9404        %FPT_ENQ (FPTN=ENQ_PROFILE, STCLASS=CONSTANT,
     6910     9405             DCB=M$MAIL_FILE,
     6911     9406             RNAME=VM_PRORES,
     6912     9407             SHARE=NONE,
     6913     9408             WAIT=YES);
     6914     9426        %VM_PRORES;
     6915     9440        %VLP_ERRCODE (FPTN=E_PROWRERR,FCG="VM",MID="O",
     6916     9441                  ERR#=%E$PROWRERR,STCLASS=CONSTANT);
     6917     9486        /*E*      ERROR: VMO-E$PROWRERR-0
     6918     9487                  MESSAGE: Error writing PROFILE record, some new mail may be lost.
     6919     9488        */
     6920     9489              %B$TCB (STCLASS="BASED(B$TCB$)");
     6921     9492        %VM_PROFILE;
     6922     9579    1   DCL VMD$PUT_PROFILE ENTRY(1) ALTRET;
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1109 
     6923     9580        %INCLUDE XUR_ENTRY;
     6924     9612        %B$ALT;
     6925     9620        /***** External routines *****/
     6926     9621    1   DCL VMO$CLEANUP ENTRY;
     6927     9622        /***** Symref data *****/
     6928     9623        %VM_FOLDER_INFO (NAME=VM_CURRENT_FOLDER,STCLASS="SYMREF");
     6929     9675        %EJECT;
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1110 
     6930     9676    1       CALL M$XCON (RESET);              /* Incase the stuff below dosen't work

   9676 13 000002   000000 630400 11                 EPPR0   RESET
        13 000003   010003 713400                    CLIMB   4099
        13 000004   400400 401760                    pmme    nvectors=2

     6931     9677                                                   either */
     6932     9678    1       IF VM_CURRENT_FOLDER.FLAGS.OPEN AND VM_CURRENT_FOLDER.FLAGS.UPDATE THEN

   9678 13 000005   000023 236000 xsym               LDQ     VM_CURRENT_FOLDER+19
        13 000006   010000 316003                    CANQ    4096,DU
        13 000007   000051 600000 13                 TZE     s:9691
        13 000010   000023 234000 xsym               SZN     VM_CURRENT_FOLDER+19
        13 000011   000051 605000 13                 TPL     s:9691

     6933     9679    2       DO;

     6934     9680    2           READ_PROFILE.BUF_ = VECTOR(VM_PROSTUB);

   9680 13 000012   000000 235000 14                 LDA     0
        13 000013   200164 452500                    STP2    VM_PROSTUB+113,,AUTO
        13 000014   200164 236100                    LDQ     VM_PROSTUB+113,,AUTO
        13 000015   000003 036003                    ADLQ    3,DU
        13 000016   000004 757000 12                 STAQ    READ_PROFILE+4

     6935     9681    2           CALL M$ENQ (ENQ_PROFILE) ALTRET(ALT);

   9681 13 000017   000010 630400 11                 EPPR0   ENQ_PROFILE
        13 000020   420002 713400                    CLIMB   alt,+8194
        13 000021   401000 401760                    pmme    nvectors=3
        13 000022   000052 702000 13                 TSX2    ALT

     6936     9682    2           CALL M$READ (READ_PROFILE) /* Get fixed fields */

   9682 13 000023   000000 630400 12                 EPPR0   READ_PROFILE
        13 000024   440000 713400                    CLIMB   alt,read
        13 000025   401400 401760                    pmme    nvectors=4
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1111 
        13 000026   000030 702000 13                 TSX2    s:9684
        13 000027   000036 710000 13                 TRA     s:9686

     6937     9683    3           WHENALTRETURN DO;

     6938     9684    3               IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$LD THEN GOTO ALT;

   9684 13 000030   000000 470400 xsym               LDP0    B$TCB$
        13 000031   000000 471500                    LDP1    0,,PR0
        13 000032   100102 236100                    LDQ     66,,PR1
        13 000033   377770 376007                    ANQ     131064,DL
        13 000034   000070 116007                    CMPQ    56,DL
        13 000035   000052 601000 13                 TNZ     ALT

     6939     9685    3           END;

     6940     9686    2           VM_PROFILE.NUM_MESSAGES = VM_PROSTUB.NUM_MESSAGES;

   9686 13 000036   000000 470400 xsym               LDP0    VM_PROFILE$
        13 000037   200010 235100                    LDA     VM_PROSTUB+5,,AUTO
        13 000040   000005 755100                    STA     5,,PR0

     6941     9687    2           VM_PROFILE.NUM_NEW_MESSAGES = VM_PROSTUB.NUM_NEW_MESSAGES;

   9687 13 000041   200011 236100                    LDQ     VM_PROSTUB+6,,AUTO
        13 000042   000006 756100                    STQ     6,,PR0

     6942     9688    2           VM_PROFILE.HI_MESSAGE_NUMBER = VM_PROSTUB.HI_MESSAGE_NUMBER;

   9688 13 000043   200014 235100                    LDA     VM_PROSTUB+9,,AUTO
        13 000044   000011 755100                    STA     9,,PR0

     6943     9689    2           CALL VMD$PUT_PROFILE(M$MAIL_FILE_NUM) ALTRET(ALT);

   9689 13 000045   000002 630400 14                 EPPR0   2
        13 000046   000001 631400 14                 EPPR1   1
        13 000047   000000 701000 xent               TSX1    VMD$PUT_PROFILE
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1112 
        13 000050   000052 702000 13                 TSX2    ALT

     6944     9690    2       END;

     6945     9691    2       DO WHILE ('0'B);

   9691 13 000051   000066 710000 13                 TRA     s:9699

     6946     9692    2   ALT:
     6947     9693    2           CALL XUR$ERRMSG(B$TCB.ALT$->B$ALT.ERR);

   9693 13 000052   000000 470400 xsym  ALT          LDP0    B$TCB$
        13 000053   000000 471500                    LDP1    0,,PR0
        13 000054   100102 633500                    EPPR3   66,,PR1
        13 000055   200164 453500                    STP3    VM_PROSTUB+113,,AUTO
        13 000056   200164 630500                    EPPR0   VM_PROSTUB+113,,AUTO
        13 000057   000001 631400 14                 EPPR1   1
        13 000060   000000 701000 xent               TSX1    XUR$ERRMSG
        13 000061   000000 011000                    NOP     0

     6948     9694    2           CALL XUR$ERRMSG(E_PROWRERR);

   9694 13 000062   000003 630400 14                 EPPR0   3
        13 000063   000001 631400 14                 EPPR1   1
        13 000064   000000 701000 xent               TSX1    XUR$ERRMSG
        13 000065   000000 011000                    NOP     0

     6949     9695    2       END;

     6950     9696        /*
     6951     9697             ***** Close all dcbs properly ...
     6952     9698        */
     6953     9699    1       CALL VMO$CLEANUP;

   9699 13 000066   000004 631400 14                 EPPR1   4
        13 000067   000000 701000 xent               TSX1    VMO$CLEANUP
        13 000070   000000 011000                    NOP     0
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1113 

     6954     9700        /*
     6955     9701             ***** If the current folder is still marked
     6956     9702                   as open, then signal mailman that we are closed ...
     6957     9703        */
     6958     9704    1       CALL M$MERCS;

   9704 13 000071   010014 713400                    CLIMB   4108
        13 000072   000000 401760                    pmme    nvectors=0

     6959     9705    1   END;

   9705 13 000073   000000 702200 xent               TSX2  ! X66_AARET

RESET
 Sect OctLoc
  11     000   000001 777640   000004 006000   000000 177640   000000 006014    ................
  11     004   000000 000000   000000 000000                                    ........

VM_PROKEY
 Sect OctLoc
  11     006   001001 ******                                                    ....

ENQ_PROFILE
 Sect OctLoc
  11     010   000003 777640   000016 006000   000001 777640   000016 006000    ................
  11     014   000000 177640   000000 006014   000000 540000   777777 777777    ................
  11     020   000000 000000   000000 000000                                    ........

E_PROWRERR
 Sect OctLoc
  11     022   261517 001620                                                    ....

READ_PROFILE
 Sect OctLoc
  12     000   000005 777640   000010 006000   000000 377640   000006 006000    ................
  12     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1114 
  12     010   000000 600000   000000 000000   000000 000000   000000 000000    ................
  12     014   000000 000000   000000 000000                                    ........

VM_PRORES
 Sect OctLoc
  12     016   007120 122117   106111 114105                                    .PROFILE

(unnamed)
 Sect OctLoc
  14     000   000160 777640   000001 000000   000000 006000   000022 006000    .p..............
  14     004   000000 000000                                                    ....
     6960     9706        %EOD;

PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1115 
--  Include file information  --

   XUR_ENTRY.:LIB_E05  cannot be made into a system file and is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMO$XCON.
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1116 

 **** Variables and constants ****

  ****  Section 011 RoData VMO$XCON

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    10-0-0/d STRC(360)   r     1 ENQ_PROFILE               22-0-0/w STRC        r     1 E_PROWRERR
     0-0-0/d STRC(216)   r     1 RESET                      6-0-0/c STRC(18)    r     1 VM_PROKEY

  ****  Section 012  Data  VMO$XCON

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(504)   r     1 READ_PROFILE              16-0-0/c STRC(72)    r     1 VM_PRORES

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w STRC(4068)  r     1 VM_PROSTUB

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/w UBIN              1 M$DO_NUM
     0-0-0/w UBIN              1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN        r     1 M$MAIL_FILE_NUM
     0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN              1 M$ME_NUM
     0-0-0/w UBIN              1 M$NODE_NUM                 0-0-0/w UBIN              1 M$SI_NUM
     0-0-0/w UBIN              1 M$WORK_NUM                 0-0-0/w PTR               1 VM_ADDLIST$
     0-0-0/d VECT              1 VM_ADDLIST_                0-0-0/w PTR               1 VM_ADDREC$
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1117 
     0-0-0/d VECT              1 VM_ADDREC_                 0-0-0/w PTR               1 VM_COPY$
     0-0-0/d VECT              1 VM_COPY_                   0-0-0/w STRC(2529)  r     1 VM_CURRENT_FOLDER
     0-0-0/w PTR               1 VM_ENCLLIST$               0-0-0/d VECT              1 VM_ENCLLIST_
     0-0-0/w PTR               1 VM_ENCLREC$                0-0-0/d VECT              1 VM_ENCLREC_
     0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME       0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME
     0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS       0-0-0/w PTR               1 VM_HEADER$
     0-0-0/d VECT              1 VM_HEADER_                 0-0-0/d VECT              1 VM_HEADER_INIT_
     0-0-0/w PTR               1 VM_INPUT$                  0-0-0/d VECT              1 VM_INPUT_
     0-0-0/c STRC(72)          1 VM_MAILCG_NAME             0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA
     0-0-0/c STRC(72)          1 VM_MAIL_ACCT               0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME
     0-0-0/w PTR               1 VM_PARSEAREA$              0-0-0/d VECT              1 VM_PARSEAREA_
     0-0-0/w PTR         r     1 VM_PROFILE$                0-0-0/d VECT              1 VM_PROFILE_
     0-0-0/w PTR               1 VM_SELECT$                 0-0-0/d VECT              1 VM_SELECT_
     0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME          0-0-0/c CHAR(8)           1 VM_SITENAME
     0-0-0/w PTR               1 VM_WORK$                   0-0-0/d VECT              1 VM_WORK_

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$MAIL_CENTRAL             0-0-0N  NULL        r     1 M$MAIL_COMGROUP
     0-0-0N  NULL        r     1 M$MAIL_FILE                0-0-0N  NULL        r     1 M$MAIL_GLOBAL
     0-0-0N  NULL        r     1 M$ME                       0-0-0N  NULL        r     1 M$NODE
     0-0-0N  NULL        r     1 M$SI                       0-0-0N  NULL        r     1 M$UC
     0-0-0N  NULL        r     1 M$WORK                     0-0-0/w STRC(4068)  r     1 VM_PROFILE
     0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VMO$XCON requires 60 words for executable code.
   Procedure VMO$XCON requires 118 words of local(AUTO) storage.
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1118 
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1119 
          MINI XREF LISTING

ALT
      9693**LABEL    9681--CALLALT  9684--GOTO     9689--CALLALT
B$ALT.CODE
      9614**DCL      9614--REDEF    9615--REDEF    9615--REDEF
B$ALT.ERR
      9615**DCL      9693<>CALL
B$ALT.ERR.CODE
      9616**DCL      9684>>IF
B$ALT.ERR.ERR#
      9616**DCL      9616--REDEF
B$ALT.EVID
      9615**DCL      9615--REDEF    9615--REDEF
B$TCB.ALT$
      9490**DCL      9684>>IF       9693>>CALL
B$TCB$
      9005**DCL      9490--IMP-PTR  9684>>IF       9693>>CALL
ENQ_PROFILE
      9419**DCL      9681<>CALL
ENQ_PROFILE.V
      9420**DCL      9419--DCLINIT
ERRMSG_FID.L#
      9073**DCL      9073--IMP-SIZ
E_PROWRERR
      9453**DCL      9694<>CALL
M$ENQ
      5561**DCL-ENT  9681--CALL
M$MAIL_FILE_NUM
      8984**DCL      9689<>CALL
M$MERCS
      5552**DCL-ENT  9704--CALL
M$READ
      5496**DCL-ENT  9682--CALL
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1120 
M$XCON
      5550**DCL-ENT  9676--CALL
READ_PROFILE
      9382**DCL      9682<>CALL
READ_PROFILE.BUF_
      9384**DCL      9680<<ASSIGN
READ_PROFILE.STATION_
      9385**DCL      9386--REDEF
READ_PROFILE.V
      9386**DCL      9382--DCLINIT
READ_PROFILE.V.DVBYTE.REREAD#
      9397**DCL      9397--REDEF
READ_PROFILE.V.INDX#
      9395**DCL      9395--REDEF
RESET
      9239**DCL      9676<>CALL
RESET.V
      9240**DCL      9239--DCLINIT
VMD$PUT_PROFILE
      9579**DCL-ENT  9689--CALL
VMO$CLEANUP
      9621**DCL-ENT  9699--CALL
VM_CURRENT_FOLDER.FLAGS.OPEN
      9667**DCL      9678>>IF
VM_CURRENT_FOLDER.FLAGS.UPDATE
      9657**DCL      9678>>IF
VM_PROFILE.HI_MESSAGE_NUMBER
      9547**DCL      9688<<ASSIGN
VM_PROFILE.NUM_MESSAGES
      9539**DCL      9686<<ASSIGN
VM_PROFILE.NUM_NEW_MESSAGES
      9541**DCL      9687<<ASSIGN
VM_PROFILE$
      8925**DCL      9502--IMP-PTR  9686>>ASSIGN   9687>>ASSIGN   9688>>ASSIGN
VM_PROKEY
      9360**DCL      9382--DCLINIT  9383--DCLINIT
PL6.E3A0      #003=VMO$XCON File=VMO$MAIL.:VMB6TSI                               WED 08/20/97 15:24 Page:1121 
VM_PRORES
      9436**DCL      9419--DCLINIT
VM_PROSTUB
      9273**DCL      9680--ASSIGN
VM_PROSTUB.HI_MESSAGE_NUMBER
      9318**DCL      9688>>ASSIGN
VM_PROSTUB.NUM_MESSAGES
      9310**DCL      9686>>ASSIGN
VM_PROSTUB.NUM_NEW_MESSAGES
      9312**DCL      9687>>ASSIGN
X$STRING.SIZ
      8919**DCL      8920--IMP-SIZ
XUR$ERRMSG
      9595**DCL-ENT  9693--CALL     9694--CALL

PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1122 
     6961        1        /*T***********************************************************/
     6962        2        /*T*                                                         */
     6963        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     6964        4        /*T*                                                         */
     6965        5        /*T***********************************************************/
     6966        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     6967        7        VMO$ABORT: PROC;
     6968        8        %INCLUDE CP_6;
     6969     5567        %INCLUDE VM_MACRO_C;
     6970     6835        %INCLUDE VM_PERR_C;
     6971     7130        %INCLUDE VM_SUBS_C;
     6972     7390        %INCLUDE CP_6_SUBS;
     6973     7930        %INCLUDE VM_DATA_R;
     6974     8361        %INCLUDE XUR_ENTRY;
     6975     8393        %F$DCB;
     6976     8450        %B$TCB (STCLASS="BASED(B$TCB$)");
     6977     8453        %B$ALT;
     6978     8461        %VM_PROFILE;
     6979     8548        %VM_FOLDER_INFO (NAME=VM_CURRENT_FOLDER,STCLASS="SYMREF");
     6980     8600        %VM_FOLDER_INFO (NAME=VM_WORK_FOLDER,STCLASS="SYMREF");
     6981     8652        %FPT_CLOSE (FPTN=CLOSE_SAVE,DISP=SAVE);
     6982     8694        %VLP_ERRCODE (FPTN=ERROR);
     6983     8739              %VLP_ERRCODE (FPTN=E_FOLDEROLD,FCG="VM",MID="O",
     6984     8740              ERR#=%E$FOLDEROLD,STCLASS=CONSTANT);
     6985     8785    1   DCL VMD$GET_PROFILE ENTRY(1) ALTRET;
     6986     8786
     6987     8787
     6988     8788    1   DCL VMO_REMEMBER REMEMBER SYMREF;
     6989     8789    1   DCL BREAK_TYPE UBIN SYMREF;
     6990     8790    1   DCL FOLDER_WAS_OPEN BIT(1) SYMREF;
     6991     8791    1   DCL INDX2 UBIN SYMREF;
     6992     8792    1   DCL CURRENT_MESSAGE_NUMBER SBIN WORD SYMREF;
     6993     8793
     6994     8794    1       CURRENT_MESSAGE_NUMBER = 0;
     6995     8795
     6996     8796        /*
     6997     8797             ***** Clear any breaks...
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1123 
     6998     8798        */
     6999     8799    1       CALL XUR$CLRENABLE;
     7000     8800    1       IF BREAK_TYPE > 0
     7001     8801    2       THEN DO;
     7002     8802    2           IF DCBADDR(M$WORK_NUM) -> F$DCB.FCD# THEN
     7003     8803    3           DO;
     7004     8804    3               CLOSE_SAVE.V.DCB# = M$WORK_NUM;
     7005     8805    3               CALL M$CLOSE(CLOSE_SAVE);
     7006     8806    3           END;
     7007     8807    2           VM_WORK_FOLDER.FLAGS.OPEN = %NO#;
     7008     8808        /*
     7009     8809             ***** Restore the profile for the current folder ...
     7010     8810        */
     7011     8811    2           VM_CURRENT_FOLDER.FLAGS.OPEN = FOLDER_WAS_OPEN;
     7012     8812    2           CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);
     7013     8813    2           IF BREAK_TYPE = %CMD_COPY_MESSAGE OR BREAK_TYPE = %CMD_MOVE_MESSAGE
     7014     8814    2           THEN
     7015     8815    2               VM_PROFILE.NUM_DEL_MESSAGES = VM_PROFILE.NUM_DEL_MESSAGES + INDX2;
     7016     8816    2       END;
     7017     8817
     7018     8818    2       DO NEVER;
     7019     8819    2   BAD_PROFILE:
     7020     8820    2           ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     7021     8821    2           CALL XUR$ERRMSG(E_FOLDEROLD,B$TCB.ALT$->B$ALT.DCB#);
     7022     8822    2           CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);
     7023     8823    2       END;
     7024     8824    1       UNWIND TO VMO_REMEMBER;
     7025     8825    1   END VMO$ABORT;

PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1124 
--  Include file information  --

   XUR_ENTRY.:LIB_E05  cannot be made into a system file and is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMO$ABORT.

   Procedure VMO$ABORT requires 60 words for executable code.
   Procedure VMO$ABORT requires 6 words of local(AUTO) storage.

    No errors detected in file VMO$MAIL.:VMB6TSI    .

PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1125 

 Object Unit name= VMO$ABORT                                  File name= VMO$MAIL.:VMB6TOU
 UTS= AUG 20 '97 15:24:29.52 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11   Data  even  none    31     37  VMO$ABORT
   12  RoData even  UTS      1      1  VMO$ABORT
   13   Proc  even  none    60     74  VMO$ABORT
   14  RoData even  none     9     11  VMO$ABORT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    13      0   yes            yes      Std        0  VMO$ABORT
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1126 

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 XUR$CLRENABLE
 yes     yes           Std       1 VMD$GET_PROFILE
 yes     yes           Std       7 XUR$ERRMSG
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_AUNWIND

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
     VM_SITENAME                           VM_MAILCG_SETSTA                      VM_CURRENT_FOLDER
     VM_WORK_FOLDER                        VMO_REMEMBER                          BREAK_TYPE
     FOLDER_WAS_OPEN                       INDX2                                 CURRENT_MESSAGE_NUMBER
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1127 

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1128 


     6961        1        /*T***********************************************************/
     6962        2        /*T*                                                         */
     6963        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     6964        4        /*T*                                                         */
     6965        5        /*T***********************************************************/
     6966        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     6967        7        VMO$ABORT: PROC;

      7 13 000000   000000 700200 xent  VMO$ABORT    TSX0  ! X66_AUTO_0
        13 000001   000006 000000                    ZERO    6,0

     6968        8        %INCLUDE CP_6;
     6969     5567        %INCLUDE VM_MACRO_C;
     6970     6835        %INCLUDE VM_PERR_C;
     6971     7130        %INCLUDE VM_SUBS_C;
     6972     7390        %INCLUDE CP_6_SUBS;
     6973     7930        %INCLUDE VM_DATA_R;
     6974     8361        %INCLUDE XUR_ENTRY;
     6975     8393        %F$DCB;
     6976     8450        %B$TCB (STCLASS="BASED(B$TCB$)");
     6977     8453        %B$ALT;
     6978     8461        %VM_PROFILE;
     6979     8548        %VM_FOLDER_INFO (NAME=VM_CURRENT_FOLDER,STCLASS="SYMREF");
     6980     8600        %VM_FOLDER_INFO (NAME=VM_WORK_FOLDER,STCLASS="SYMREF");
     6981     8652        %FPT_CLOSE (FPTN=CLOSE_SAVE,DISP=SAVE);
     6982     8694        %VLP_ERRCODE (FPTN=ERROR);
     6983     8739              %VLP_ERRCODE (FPTN=E_FOLDEROLD,FCG="VM",MID="O",
     6984     8740              ERR#=%E$FOLDEROLD,STCLASS=CONSTANT);
     6985     8785    1   DCL VMD$GET_PROFILE ENTRY(1) ALTRET;
     6986     8786
     6987     8787
     6988     8788    1   DCL VMO_REMEMBER REMEMBER SYMREF;
     6989     8789    1   DCL BREAK_TYPE UBIN SYMREF;
     6990     8790    1   DCL FOLDER_WAS_OPEN BIT(1) SYMREF;
     6991     8791    1   DCL INDX2 UBIN SYMREF;
     6992     8792    1   DCL CURRENT_MESSAGE_NUMBER SBIN WORD SYMREF;
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1129 
     6993     8793
     6994     8794    1       CURRENT_MESSAGE_NUMBER = 0;

   8794 13 000002   000000 450000 xsym               STZ     CURRENT_MESSAGE_NUMBER

     6995     8795
     6996     8796        /*
     6997     8797             ***** Clear any breaks...
     6998     8798        */
     6999     8799    1       CALL XUR$CLRENABLE;

   8799 13 000003   000000 631400 14                 EPPR1   0
        13 000004   000000 701000 xent               TSX1    XUR$CLRENABLE
        13 000005   000000 011000                    NOP     0

     7000     8800    1       IF BREAK_TYPE > 0

   8800 13 000006   000000 235000 xsym               LDA     BREAK_TYPE
        13 000007   000047 600000 13                 TZE     s:8818

     7001     8801    2       THEN DO;

     7002     8802    2           IF DCBADDR(M$WORK_NUM) -> F$DCB.FCD# THEN

   8802 13 000010   000001 470400 14                 LDP0    1
        13 000011   000000 471500                    LDP1    0,,PR0
        13 000012   000000 720000 xsym               LXL0    M$WORK_NUM
        13 000013   100000 473510                    LDP3    0,X0,PR1
        13 000014   300031 236100                    LDQ     25,,PR3
        13 000015   020000 316007                    CANQ    8192,DL
        13 000016   000023 600000 13                 TZE     s:8807

     7003     8803    3           DO;

     7004     8804    3               CLOSE_SAVE.V.DCB# = M$WORK_NUM;

   8804 13 000017   000032 740000 11                 STX0    CLOSE_SAVE+26
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1130 

     7005     8805    3               CALL M$CLOSE(CLOSE_SAVE);

   8805 13 000020   000000 630400 11                 EPPR0   CLOSE_SAVE
        13 000021   050001 713400                    CLIMB   close
        13 000022   406000 401760                    pmme    nvectors=13

     7006     8806    3           END;

     7007     8807    2           VM_WORK_FOLDER.FLAGS.OPEN = %NO#;

   8807 13 000023   000002 236000 14                 LDQ     2
        13 000024   000023 356000 xsym               ANSQ    VM_WORK_FOLDER+19

     7008     8808        /*
     7009     8809             ***** Restore the profile for the current folder ...
     7010     8810        */
     7011     8811    2           VM_CURRENT_FOLDER.FLAGS.OPEN = FOLDER_WAS_OPEN;

   8811 13 000025   000000 236000 xsym               LDQ     FOLDER_WAS_OPEN
        13 000026   000005 772000                    QRL     5
        13 000027   000023 676000 xsym               ERQ     VM_CURRENT_FOLDER+19
        13 000030   010000 376003                    ANQ     4096,DU
        13 000031   000023 656000 xsym               ERSQ    VM_CURRENT_FOLDER+19

     7012     8812    2           CALL VMD$GET_PROFILE (M$MAIL_FILE_NUM) ALTRET(BAD_PROFILE);

   8812 13 000032   000004 630400 14                 EPPR0   4
        13 000033   000003 631400 14                 EPPR1   3
        13 000034   000000 701000 xent               TSX1    VMD$GET_PROFILE
        13 000035   000050 702000 13                 TSX2    BAD_PROFILE

     7013     8813    2           IF BREAK_TYPE = %CMD_COPY_MESSAGE OR BREAK_TYPE = %CMD_MOVE_MESSAGE

   8813 13 000036   000000 235000 xsym               LDA     BREAK_TYPE
        13 000037   000003 115007                    CMPA    3,DL
        13 000040   000043 600000 13                 TZE     s:8815
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1131 
        13 000041   000033 115007                    CMPA    27,DL
        13 000042   000047 601000 13                 TNZ     s:8818

     7014     8814    2           THEN
     7015     8815    2               VM_PROFILE.NUM_DEL_MESSAGES = VM_PROFILE.NUM_DEL_MESSAGES + INDX2;

   8815 13 000043   000000 470400 xsym               LDP0    VM_PROFILE$
        13 000044   000007 236100                    LDQ     7,,PR0
        13 000045   000000 036000 xsym               ADLQ    INDX2
        13 000046   000007 756100                    STQ     7,,PR0

     7016     8816    2       END;

     7017     8817
     7018     8818    2       DO NEVER;

   8818 13 000047   000071 710000 13                 TRA     s:8824

     7019     8819    2   BAD_PROFILE:
     7020     8820    2           ERROR = B$TCB.ALT$ -> B$ALT.ERR;

   8820 13 000050   000000 470400 xsym  BAD_PROFILE  LDP0    B$TCB$
        13 000051   000000 471500                    LDP1    0,,PR0
        13 000052   100102 236100                    LDQ     66,,PR1
        13 000053   000036 756000 11                 STQ     ERROR

     7021     8821    2           CALL XUR$ERRMSG(E_FOLDEROLD,B$TCB.ALT$->B$ALT.DCB#);

   8821 13 000054   000000 471500                    LDP1    0,,PR0
        13 000055   100101 633500                    EPPR3   65,,PR1
        13 000056   200005 453500                    STP3    5,,AUTO
        13 000057   000006 236000 14                 LDQ     6
        13 000060   200004 756100                    STQ     4,,AUTO
        13 000061   200004 630500                    EPPR0   4,,AUTO
        13 000062   000005 631400 14                 EPPR1   5
        13 000063   000000 701000 xent               TSX1    XUR$ERRMSG
        13 000064   000000 011000                    NOP     0
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1132 

     7022     8822    2           CALL XUR$ERRMSG(ERROR,M$MAIL_FILE_NUM);

   8822 13 000065   000007 630400 14                 EPPR0   7
        13 000066   000005 631400 14                 EPPR1   5
        13 000067   000000 701000 xent               TSX1    XUR$ERRMSG
        13 000070   000000 011000                    NOP     0

     7023     8823    2       END;

     7024     8824    1       UNWIND TO VMO_REMEMBER;

   8824 13 000071   000000 237200 xsym               LDAQ  ! VMO_REMEMBER
        13 000072   000000 700200 xent               TSX0  ! X66_AUNWIND
        13 000073   000000 000200                    ZERO    0,128

CLOSE_SAVE
 Sect OctLoc
  11     000   000003 777640   000032 006000   000000 177640   000000 006014    ................
  11     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     030*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
  11     034   000220 000000   000000 000000                                    ........

ERROR
 Sect OctLoc
  11     036   000000 000000                                                    ....

E_FOLDEROLD
 Sect OctLoc
  12     000   261517 010060                                                    ...0

(unnamed)
 Sect OctLoc
  14     000   000000 000000   000000 006003   767777 777777   000001 000000    ................
  14     004   000000 006000   000002 000000   000000 006000   000036 006000    ................
  14     010   000000 006000                                                    ....
     7025     8825    1   END VMO$ABORT;
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1133 

PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1134 
--  Include file information  --

   XUR_ENTRY.:LIB_E05  cannot be made into a system file and is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMO$ABORT.
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1135 

 **** Variables and constants ****

  ****  Section 011  Data  VMO$ABORT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1080)  r     1 CLOSE_SAVE                36-0-0/w STRC        r     1 ERROR

  ****  Section 012 RoData VMO$ABORT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 E_FOLDEROLD

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/w UBIN        r     1 BREAK_TYPE
     0-0-0/w SBIN        r     1 CURRENT_MESSAGE_NUMBER
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/b BIT         r     1 FOLDER_WAS_OPEN
     0-0-0/w UBIN        r     1 INDX2                      0-0-0/w UBIN              1 M$DO_NUM
     0-0-0/w UBIN              1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN        r     1 M$MAIL_FILE_NUM
     0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN              1 M$ME_NUM
     0-0-0/w UBIN              1 M$NODE_NUM                 0-0-0/w UBIN              1 M$SI_NUM
     0-0-0/w UBIN        r     1 M$WORK_NUM                 0-0-0/d REMB        r     1 VMO_REMEMBER
     0-0-0/w PTR               1 VM_ADDLIST$                0-0-0/d VECT              1 VM_ADDLIST_
     0-0-0/w PTR               1 VM_ADDREC$                 0-0-0/d VECT              1 VM_ADDREC_
     0-0-0/w PTR               1 VM_COPY$                   0-0-0/d VECT              1 VM_COPY_
     0-0-0/w STRC(2529)  r     1 VM_CURRENT_FOLDER          0-0-0/w PTR               1 VM_ENCLLIST$
     0-0-0/d VECT              1 VM_ENCLLIST_               0-0-0/w PTR               1 VM_ENCLREC$
     0-0-0/d VECT              1 VM_ENCLREC_                0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1136 
     0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME       0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS
     0-0-0/w PTR               1 VM_HEADER$                 0-0-0/d VECT              1 VM_HEADER_
     0-0-0/d VECT              1 VM_HEADER_INIT_            0-0-0/w PTR               1 VM_INPUT$
     0-0-0/d VECT              1 VM_INPUT_                  0-0-0/c STRC(72)          1 VM_MAILCG_NAME
     0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA           0-0-0/c STRC(72)          1 VM_MAIL_ACCT
     0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME           0-0-0/w PTR               1 VM_PARSEAREA$
     0-0-0/d VECT              1 VM_PARSEAREA_              0-0-0/w PTR         r     1 VM_PROFILE$
     0-0-0/d VECT              1 VM_PROFILE_                0-0-0/w PTR               1 VM_SELECT$
     0-0-0/d VECT              1 VM_SELECT_                 0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME
     0-0-0/c CHAR(8)           1 VM_SITENAME                0-0-0/w PTR               1 VM_WORK$
     0-0-0/d VECT              1 VM_WORK_                   0-0-0/w STRC(2529)  r     1 VM_WORK_FOLDER

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0N  NULL        r     1 M$DO
     0-0-0N  NULL        r     1 M$LO                       0-0-0N  NULL        r     1 M$MAIL_CENTRAL
     0-0-0N  NULL        r     1 M$MAIL_COMGROUP            0-0-0N  NULL        r     1 M$MAIL_FILE
     0-0-0N  NULL        r     1 M$MAIL_GLOBAL              0-0-0N  NULL        r     1 M$ME
     0-0-0N  NULL        r     1 M$NODE                     0-0-0N  NULL        r     1 M$SI
     0-0-0N  NULL        r     1 M$UC                       0-0-0N  NULL        r     1 M$WORK
     0-0-0/w STRC(4068)  r     1 VM_PROFILE                 0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VMO$ABORT requires 60 words for executable code.
   Procedure VMO$ABORT requires 6 words of local(AUTO) storage.

    No errors detected in file VMO$MAIL.:VMB6TSI    .
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1137 
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1138 
          MINI XREF LISTING

B$ALT.CODE
      8455**DCL      8455--REDEF    8456--REDEF    8456--REDEF
B$ALT.DCB#
      8456**DCL      8821<>CALL
B$ALT.ERR
      8456**DCL      8820>>ASSIGN
B$ALT.ERR.ERR#
      8457**DCL      8457--REDEF
B$ALT.EVID
      8456**DCL      8456--REDEF    8456--REDEF
B$TCB.ALT$
      8451**DCL      8820>>ASSIGN   8821>>CALL
B$TCB$
      8138**DCL      8451--IMP-PTR  8820>>ASSIGN   8821>>CALL
BAD_PROFILE
      8820**LABEL    8812--CALLALT
BREAK_TYPE
      8789**DCL      8800>>IF       8813>>IF       8813>>IF
CLOSE_SAVE
      8675**DCL      8805<>CALL
CLOSE_SAVE.SN_
      8675**DCL      8675--REDEF
CLOSE_SAVE.UTL_
      8676**DCL      8676--REDEF
CLOSE_SAVE.V
      8680**DCL      8675--DCLINIT
CLOSE_SAVE.V.DCB#
      8681**DCL      8804<<ASSIGN
CLOSE_SAVE.V.EXPIRE#
      8690**DCL      8690--REDEF
CLOSE_SAVE.V.TYPE#
      8688**DCL      8688--REDEF
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1139 
CLOSE_SAVE.V.XTNSIZE#
      8685**DCL      8685--REDEF    8687--REDEF
CURRENT_MESSAGE_NUMBER
      8792**DCL      8794<<ASSIGN
ERRMSG_FID.L#
      8206**DCL      8206--IMP-SIZ
ERROR
      8706**DCL      8820<<ASSIGN   8822<>CALL
E_FOLDEROLD
      8752**DCL      8821<>CALL
F$DCB.ACTPOS
      8426**DCL      8426--REDEF
F$DCB.ARS#
      8400**DCL      8400--REDEF
F$DCB.ATTR
      8419**DCL      8420--REDEF
F$DCB.BORROW
      8434**DCL      8434--REDEF    8434--REDEF    8434--REDEF
F$DCB.DCBNAME.L
      8448**DCL      8448--IMP-SIZ
F$DCB.EOMCHAR#
      8404**DCL      8404--REDEF
F$DCB.FCD#
      8413**DCL      8802>>IF
F$DCB.FLDID
      8429**DCL      8429--REDEF
F$DCB.FORM$
      8423**DCL      8423--REDEF
F$DCB.FSECT
      8439**DCL      8439--REDEF
F$DCB.FSN#
      8416**DCL      8416--REDEF    8416--REDEF    8417--REDEF
F$DCB.HEADER$
      8422**DCL      8422--REDEF
F$DCB.IXTNSIZE#
      8420**DCL      8420--REDEF
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1140 
F$DCB.LASTSTA$
      8409**DCL      8409--REDEF
F$DCB.LVL
      8435**DCL      8435--REDEF
F$DCB.NAME#.C
      8410**DCL      8410--REDEF
F$DCB.NOEOF
      8432**DCL      8432--REDEF
F$DCB.NRECS#
      8421**DCL      8421--REDEF
F$DCB.NRECX
      8440**DCL      8440--REDEF
F$DCB.OHDR
      8432**DCL      8432--REDEF
F$DCB.ORG#
      8415**DCL      8415--REDEF
F$DCB.PRECNO
      8438**DCL      8438--REDEF
F$DCB.RCSZ
      8444**DCL      8444--REDEF
F$DCB.RES#
      8411**DCL      8411--REDEF
F$DCB.SETX
      8423**DCL      8423--REDEF
F$DCB.TAB$
      8423**DCL      8423--REDEF
F$DCB.TDA
      8437**DCL      8438--REDEF
F$DCB.WSN#
      8411**DCL      8411--REDEF
FOLDER_WAS_OPEN
      8790**DCL      8811>>ASSIGN
INDX2
      8791**DCL      8815>>ASSIGN
M$CLOSE
      5495**DCL-ENT  8805--CALL
PL6.E3A0      #004=VMO$ABORT File=VMO$MAIL.:VMB6TSI                              WED 08/20/97 15:24 Page:1141 
M$MAIL_FILE_NUM
      8117**DCL      8812<>CALL     8822<>CALL
M$WORK_NUM
      8123**DCL      8802--IF       8804>>ASSIGN
VMD$GET_PROFILE
      8785**DCL-ENT  8812--CALL
VMO_REMEMBER
      8788**DCL      8824>>UNWIND
VM_CURRENT_FOLDER.FLAGS.OPEN
      8592**DCL      8811<<ASSIGN
VM_PROFILE.NUM_DEL_MESSAGES
      8512**DCL      8815<<ASSIGN   8815>>ASSIGN
VM_PROFILE$
      8058**DCL      8471--IMP-PTR  8815>>ASSIGN   8815>>ASSIGN
VM_WORK_FOLDER.FLAGS.OPEN
      8644**DCL      8807<<ASSIGN
X$STRING.SIZ
      8052**DCL      8053--IMP-SIZ
XUR$CLRENABLE
      8383**DCL-ENT  8799--CALL
XUR$ERRMSG
      8376**DCL-ENT  8821--CALL     8822--CALL
