VERSION E05

PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:1    
        1        1        /*M* OCD$DOWNER KEYINs internal routines to handle ZAP functions */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8        %SET LISTSUB='1'B;
        9        9        /*
       10       10
       11       11          ###    ###   ####     #    ####    ###   #   #  #   #  #####  ####
       12       12         # # #  #   #  #   #   ###   #   #  # # #  #   #  #   #  #      #   #
       13       13         # # #  #      #   #  # #    #   #  # # #  #   #  ##  #  #      #   #
       14       14         #  ##  #      #   #   ###   #   #  #  ##  # # #  # # #  ####   ####
       15       15         #   #  #      #   #    # #  #   #  #   #  # # #  #  ##  #      # #
       16       16         #   #  #   #  #   #   ###   #   #  #   #  # # #  #   #  #      #  #
       17       17          ###    ###   ####     #    ####    ###    # #   #   #  #####  #   #
       18       18
       19       19                                                                          */
       20       20                                                /**/
       21       21                                                /**/
       22       22        OCD$DOWNER:PROC;
       23       23                                                /**/
       24       24        %INCLUDE JG_GHOSTS_C;
       25      114                                                /**/
       26      115        %INCLUDE OCI_SUBS_C;
       27      213        %INCLUDE OCD_SUBS_C;
       28      231                                                /**/
       29      232        %INCLUDE OC_SUBS_C;
       30      963                                                /**/
       31      964        %INCLUDE CP_6;
       32     1045        %INCLUDE OC_DAT_R;
       33     1206        %INCLUDE OUT_SUBS_C;
       34     1329        %INCLUDE OCD_DATA_R;
       35     1342                                                /**/
       36     1343    1   DCL M$CSCG DCB;
       37     1344                                                /**/
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:2    
       38     1345    1   DCL OCD$SHUTDN ENTRY;
       39     1346
       40     1347             %FPT_TIME      (FPTN=ZAP_ENTRY,
       41     1348                                 TIME=OCD_ZAPTIME,
       42     1349                                 DEST=LOCAL,
       43     1350                                 SOURCE=CLOCK);
       44     1369                                                /**/
       45     1370                                                /**/
       46     1371             %FPT_WRITE     (FPTN=WRITE_PREZAP,
       47     1372                                 DCB=M$CSCG,
       48     1373                                 STATION=WR_STA,
       49     1374                                 BP=YES,
       50     1375                                 BUF=WPZAP_BUF,
       51     1376                                 WAIT=YES,
       52     1377                                 EVENT=OC_WRDN_O);
       53     1408                                                /**/
       54     1409             %VLP_STATION (FPTN=WR_STA);
       55     1436    1   DCL XFER# UBIN WORD STATIC;
       56     1437                                                /**/
       57     1438    1   DCL 1 WPZAP_BUF STATIC,
       58     1439    1            2 VECT# UBIN BYTE UNAL,
       59     1440    1            2 KIN# UBIN BYTE UNAL,
       60     1441    1            2 CADDR UBIN HALF UNAL INIT(0);
       61     1442                                                /**/
       62     1443    1   DCL I SBIN WORD STATIC;
       63     1444                                                /**/
       64     1445        %EJECT;
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:3    
       65     1446                                                /**/
       66     1447        /*
       67     1448             Begin  O C D $ D O W N E R  main
       68     1449                                                */
       69     1450                                                /**/
       70     1451                                           /* In phase 2 of a ZAP, KEYIN
       71     1452                                              calls PIG to dismount all
       72     1453                                              packsets.   */
       73     1454                                                /**/
       74     1455    1   OCD$DOPIG: ENTRY;
       75     1456    1   OCD$DPIG: ;
       76     1457    1        XFER# = 0;
       77     1458    1        WR_STA.STATION#='PIG';
       78     1459    1        WPZAP_BUF.VECT# = 0;
       79     1460    1        WPZAP_BUF.KIN# = 14 /* KEY_SETDSMTZ# */;
       80     1461    1        OCD_ZAPPHASE = 2 /* OCD_PIG# */;
       81     1462    1        CALL M$TIME (ZAP_ENTRY) ALTRET (WHO_CARES1);
       82     1463    1   WHO_CARES1:;
       83     1464    1        GOTO WRITE_IT;
       84     1465                                                /**/
       85     1466                                           /* At the completion of phase 2,
       86     1467                                              PIG sends a message to KEYIN
       87     1468                                              (which brings us here).  Now,
       88     1469                                              in phase 3, KEYIN calls MONKEY
       89     1470                                              to "X" all users.   */
       90     1471                                                /**/
       91     1472    1   OCD$MONKEY: ENTRY;
       92     1473    1   OCD$MONK: ;
       93     1474    1        XFER# = 1;
       94     1475    1        WR_STA.STATION#='MONKEY';
       95     1476    1        WPZAP_BUF.VECT# = 6 /* MKV_OCA$KMISC# */;
       96     1477    1        WPZAP_BUF.KIN# = 10 /* KEY_MNKZAP2# */;
       97     1478    1        OCD_ZAPPHASE = 3 /* OCD_MONKEY_X# */;
       98     1479    1        CALL M$TIME (ZAP_ENTRY) ALTRET (WHO_CARES2);
       99     1480    1   WHO_CARES2:;
      100     1481    1        GOTO WRITE_IT;
      101     1482                                                /**/
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:4    
      102     1483                                           /* After all the MING ghosts
      103     1484                                              have responded in phase 4,
      104     1485                                              KEYIN will send a message to
      105     1486                                              ELF to close the ERRLOG, and
      106     1487                                              ZAP itself.         */
      107     1488                                                /**/
      108     1489    1   OCD$ELF: ENTRY;
      109     1490    1   OCD$E:;
      110     1491    1        XFER# = 4;
      111     1492    1        WR_STA.STATION# = 'ELF';
      112     1493    1        WPZAP_BUF.VECT# = 0;
      113     1494    1        WPZAP_BUF.KIN# =55 /* KEY_ZAP# */;
      114     1495    1        OCD_ZAPPHASE = 5 /* OCD_ELF# */;
      115     1496    1        CALL M$TIME (ZAP_ENTRY) ALTRET (TOO_BAD1);
      116     1497    1   TOO_BAD1:;
      117     1498    1        GOTO WRITE_IT;
      118     1499                                                /**/
      119     1500                                           /* In the 6th phase, SLUG is
      120     1501                                              is sent a message to
      121     1502                                              close :ACCTLG, and ZAP itself */
      122     1503                                                /**/
      123     1504    1   OCD$SLUG: ENTRY;
      124     1505    1   OCD$SLG:;
      125     1506    1        XFER# = 5;
      126     1507    1        WR_STA.STATION# = 'SLUG';
      127     1508    1        WPZAP_BUF.VECT# = 0;
      128     1509    1        WPZAP_BUF.KIN# = 55 /* KEY_ZAP# */;
      129     1510    1        OCD_ZAPPHASE = 6 /* OCD_SLUG2# */;
      130     1511    1        CALL M$TIME (ZAP_ENTRY) ALTRET (TOO_BAD2);
      131     1512    1   TOO_BAD2:;
      132     1513    1        GOTO WRITE_IT;
      133     1514                                                /**/
      134     1515                                           /* After SLUG responds in
      135     1516                                              phase 6, KEYIN will send a
      136     1517                                              a message to MONKEY for
      137     1518                                              the final shutdown. We are
      138     1519                                              now in phase 7 (BYE BYE!). */
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:5    
      139     1520                                                /**/
      140     1521                                                /**/
      141     1522    1   OCD$LASTMNK: ENTRY;
      142     1523    1   OCD$LASTMONK: ;
      143     1524    1        XFER# = 2;
      144     1525    1        WR_STA.STATION#='MONKEY';
      145     1526    1        WPZAP_BUF.VECT# = 6 /* MKV_OCA$KMISC# */;
      146     1527    1        WPZAP_BUF.KIN# = 11 /* KEY_MNKZAP3# */;
      147     1528    1        OCD_ZAPPHASE = 7 /* OCD_MONKEY_FINAL# */;
      148     1529    1        CALL M$TIME (ZAP_ENTRY) ALTRET (WHO_CARES3);
      149     1530    1   WHO_CARES3:;
      150     1531    1        GOTO WRITE_IT;
      151     1532                                                /**/
      152     1533    1   WRITE_IT: ;
      153     1534    1        CALL M$WRITE (WRITE_PREZAP) ALTRET (OH_WELL);
      154     1535                                                /**/
      155     1536                                                /**/
      156     1537                                           /* Attempt to keep the ZAP going
      157     1538                                                despite ALTRETs */
      158     1539    2        DO WHILE ('0'B /*FALSE#*/);
      159     1540    2   OH_WELL:  ;
      160     1541    3             DO CASE (XFER#);
      161     1542    3             CASE (0);
      162     1543    3                GOTO OCD$MONK;
      163     1544    3             CASE (1);
      164     1545    3                GOTO OCD$REST2;
      165     1546    3             CASE (3);
      166     1547    3                GOTO OCD$E;
      167     1548    3             CASE (4);
      168     1549    3                GOTO OCD$SLG;
      169     1550    3             CASE (5);
      170     1551    3                CALL OCD$SHUTDN;
      171     1552    3             CASE (ELSE);
      172     1553    3                RETURN;
      173     1554    3             END;                          /* CASE XFER# */
      174     1555    2   END_CASE: ;
      175     1556    2           END;                            /* DO WHILE */
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:6    
      176     1557    1        RETURN;
      177     1558                                                /**/
      178     1559                                           /* At the conclusion of phase
      179     1560                                              3, MONKEY sends KEYIN a
      180     1561                                              message.  Now we enter
      181     1562                                              phase 4, in which KEYIN calls
      182     1563                                              the remaining MING ghosts.   */
      183     1564                                                /**/
      184     1565    1   OCD$REST: ENTRY;
      185     1566    1   OCD$REST2: ;
      186     1567    1        XFER# = 3;
      187     1568                                                /**/
      188     1569    1        OC_ZIPALL = '1'B /*TRUE#*/;
      189     1570                                                /**/
      190     1571    1        WPZAP_BUF.VECT# = 0;
      191     1572    1        WPZAP_BUF.KIN# = 55 /* KEY_ZAP# */;
      192     1573    1        OCD_ZAPPHASE = 4;
      193     1574    1        CALL M$TIME (ZAP_ENTRY) ALTRET (WHO_CARES4);
      194     1575    1   WHO_CARES4:;
      195     1576                                                /**/
      196     1577    2        DO I = 0 TO 15/*JG_MING#    */;
      197     1578                                                /**/
      198     1579    2             WR_STA.STATION# = OCD_GHOSTS.NAME(I);
      199     1580                                                /**/
      200     1581    2             IF WR_STA.STATION# ~= ' '
      201     1582    2             THEN
      202     1583    3             DO;
      203     1584    3                  CALL M$WRITE (WRITE_PREZAP) ALTRET (IGNORE);
      204     1585    3                  OCD_GHOSTS.SENT(I) = '1'B /*TRUE#*/;
      205     1586    3                END;                       /* DO IF NON NULL */
      206     1587    3             DO WHILE ('0'B /*FALSE#*/);
      207     1588                                           /* Assume (for the time being)
      208     1589                                                that any ALTRET implies that
      209     1590                                                the message didn't get there*/
      210     1591
      211     1592    3   IGNORE:        ;
      212     1593    3                  OCD_GHOSTS.BACK(I) = '1'B /*TRUE#*/;
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:7    
      213     1594    3                END;                       /* DO WHILE ALTRET */
      214     1595                                                /**/
      215     1596                                                /**/
      216     1597    2           END;                            /* DO I = 0 TO MING */
      217     1598                                                /**/
      218     1599    1        RETURN;
      219     1600                                                /**/
      220     1601    1   END OCD$DOWNER;
      221     1602        %EOD;

PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:8    
--  Include file information  --

   OCD_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OUT_SUBS_C.:E05TOU  is referenced.
   OC$MESSHD_C.:E05TOU  is referenced.
   OC_DAT_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   OCD_SUBS_C.:E05TOU  is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure OCD$DOWNER.

   Procedure OCD$DOWNER requires 163 words for executable code.
   Procedure OCD$DOWNER requires 4 words of local(AUTO) storage.

PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:9    

 Object Unit name= OCD$DOWNER                                 File name= OCD$DOWNER.:E05TOU
 UTS= JUL 30 '97 03:55:25.92 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$CSCG
    2   Data  even  none    35     43  OCD$DOWNER
    3  RoData even  UTS      5      5  OCD$DOWNER
    4   Proc  even  none   163    243  OCD$DOWNER
    5  RoData even  none     2      2  OCD$DOWNER

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes            yes      Std        0  OCD$DOWNER
     4      3                  yes      Std        0  OCD$DOPIG
     4     24                  yes      Std        0  OCD$MONKEY
     4     46                  yes      Std        0  OCD$ELF
     4     70                  yes      Std        0  OCD$SLUG
     4    113                  yes      Std        0  OCD$LASTMNK
     4    166                  yes      Std        0  OCD$REST

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 OCD$SHUTDN
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:10   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  OC_INTMSG                             OC_MESSBUF
     OC_MSGBUFFER                          OC_PARAM                              OC_CONSOLE$
     OC_DIR                                OC_INTBIT                             OC_MASK
     OC_ZIPALL                             OCD_GHOSTS                            OCD_ZAPPHASE
     OCD_ZAPTIME                           M$CSCG                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:11   


        1        1        /*M* OCD$DOWNER KEYINs internal routines to handle ZAP functions */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8        %SET LISTSUB='1'B;
        9        9        /*
       10       10
       11       11          ###    ###   ####     #    ####    ###   #   #  #   #  #####  ####
       12       12         # # #  #   #  #   #   ###   #   #  # # #  #   #  #   #  #      #   #
       13       13         # # #  #      #   #  # #    #   #  # # #  #   #  ##  #  #      #   #
       14       14         #  ##  #      #   #   ###   #   #  #  ##  # # #  # # #  ####   ####
       15       15         #   #  #      #   #    # #  #   #  #   #  # # #  #  ##  #      # #
       16       16         #   #  #   #  #   #   ###   #   #  #   #  # # #  #   #  #      #  #
       17       17          ###    ###   ####     #    ####    ###    # #   #   #  #####  #   #
       18       18
       19       19                                                                          */
       20       20                                                /**/
       21       21                                                /**/
       22       22        OCD$DOWNER:PROC;

     22  4 000000   000000 700200 xent  OCD$DOWNER   TSX0  ! X66_AUTO_0
         4 000001   000004 000000                    ZERO    4,0
         4 000002   000005 710000 4                  TRA     OCD$DPIG

       23       23                                                /**/
       24       24        %INCLUDE JG_GHOSTS_C;
       25      114                                                /**/
       26      115        %INCLUDE OCI_SUBS_C;
       27      213        %INCLUDE OCD_SUBS_C;
       28      231                                                /**/
       29      232        %INCLUDE OC_SUBS_C;
       30      963                                                /**/
       31      964        %INCLUDE CP_6;
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:12   
       32     1045        %INCLUDE OC_DAT_R;
       33     1206        %INCLUDE OUT_SUBS_C;
       34     1329        %INCLUDE OCD_DATA_R;
       35     1342                                                /**/
       36     1343    1   DCL M$CSCG DCB;
       37     1344                                                /**/
       38     1345    1   DCL OCD$SHUTDN ENTRY;
       39     1346
       40     1347             %FPT_TIME      (FPTN=ZAP_ENTRY,
       41     1348                                 TIME=OCD_ZAPTIME,
       42     1349                                 DEST=LOCAL,
       43     1350                                 SOURCE=CLOCK);
       44     1369                                                /**/
       45     1370                                                /**/
       46     1371             %FPT_WRITE     (FPTN=WRITE_PREZAP,
       47     1372                                 DCB=M$CSCG,
       48     1373                                 STATION=WR_STA,
       49     1374                                 BP=YES,
       50     1375                                 BUF=WPZAP_BUF,
       51     1376                                 WAIT=YES,
       52     1377                                 EVENT=OC_WRDN_O);
       53     1408                                                /**/
       54     1409             %VLP_STATION (FPTN=WR_STA);
       55     1436    1   DCL XFER# UBIN WORD STATIC;
       56     1437                                                /**/
       57     1438    1   DCL 1 WPZAP_BUF STATIC,
       58     1439    1            2 VECT# UBIN BYTE UNAL,
       59     1440    1            2 KIN# UBIN BYTE UNAL,
       60     1441    1            2 CADDR UBIN HALF UNAL INIT(0);
       61     1442                                                /**/
       62     1443    1   DCL I SBIN WORD STATIC;
       63     1444                                                /**/
       64     1445        %EJECT;
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:13   
       65     1446                                                /**/
       66     1447        /*
       67     1448             Begin  O C D $ D O W N E R  main
       68     1449                                                */
       69     1450                                                /**/
       70     1451                                           /* In phase 2 of a ZAP, KEYIN
       71     1452                                              calls PIG to dismount all
       72     1453                                              packsets.   */
       73     1454                                                /**/
       74     1455    1   OCD$DOPIG: ENTRY;

   1455  4 000003   000000 700200 xent  OCD$DOPIG    TSX0  ! X66_AUTO_0
         4 000004   000004 000000                    ZERO    4,0

   1439  4 000005                       OCD$DPIG     null
       75     1456    1   OCD$DPIG: ;
       76     1457    1        XFER# = 0;

   1457  4 000005   000040 450000 2                  STZ     XFER#

       77     1458    1        WR_STA.STATION#='PIG';

   1458  4 000006   040000 100400                    MLR     fill='040'O
         4 000007   000000 000003 3                  ADSC9   0                        cn=0,n=3
         4 000010   000030 000010 2                  ADSC9   WR_STA                   cn=0,n=8

       78     1459    1        WPZAP_BUF.VECT# = 0;

   1459  4 000011   000000 236003                    LDQ     0,DU
         4 000012   000041 552040 2                  STBQ    WPZAP_BUF,'40'O

       79     1460    1        WPZAP_BUF.KIN# = 14 /* KEY_SETDSMTZ# */;

   1460  4 000013   000016 236003                    LDQ     14,DU
         4 000014   000041 552020 2                  STBQ    WPZAP_BUF,'20'O

       80     1461    1        OCD_ZAPPHASE = 2 /* OCD_PIG# */;
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:14   

   1461  4 000015   002000 236003                    LDQ     1024,DU
         4 000016   000000 756000 xsym               STQ     OCD_ZAPPHASE

       81     1462    1        CALL M$TIME (ZAP_ENTRY) ALTRET (WHO_CARES1);

   1462  4 000017   000000 630400 2                  EPPR0   ZAP_ENTRY
         4 000020   420004 713400                    CLIMB   alt,+8196
         4 000021   402000 401760                    pmme    nvectors=5
         4 000022   000023 702000 4                  TSX2    WHO_CARES1

   1461  4 000023                       WHO_CARES1   null
       82     1463    1   WHO_CARES1:;
       83     1464    1        GOTO WRITE_IT;

   1464  4 000023   000135 710000 4                  TRA     WRITE_IT

       84     1465                                                /**/
       85     1466                                           /* At the completion of phase 2,
       86     1467                                              PIG sends a message to KEYIN
       87     1468                                              (which brings us here).  Now,
       88     1469                                              in phase 3, KEYIN calls MONKEY
       89     1470                                              to "X" all users.   */
       90     1471                                                /**/
       91     1472    1   OCD$MONKEY: ENTRY;

   1472  4 000024   000000 700200 xent  OCD$MONKEY   TSX0  ! X66_AUTO_0
         4 000025   000004 000000                    ZERO    4,0

   1461  4 000026                       OCD$MONK     null
       92     1473    1   OCD$MONK: ;
       93     1474    1        XFER# = 1;

   1474  4 000026   000001 235007                    LDA     1,DL
         4 000027   000040 755000 2                  STA     XFER#

       94     1475    1        WR_STA.STATION#='MONKEY';
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:15   

   1475  4 000030   040000 100400                    MLR     fill='040'O
         4 000031   000001 000006 3                  ADSC9   1                        cn=0,n=6
         4 000032   000030 000010 2                  ADSC9   WR_STA                   cn=0,n=8

       95     1476    1        WPZAP_BUF.VECT# = 6 /* MKV_OCA$KMISC# */;

   1476  4 000033   006000 236003                    LDQ     3072,DU
         4 000034   000041 552040 2                  STBQ    WPZAP_BUF,'40'O

       96     1477    1        WPZAP_BUF.KIN# = 10 /* KEY_MNKZAP2# */;

   1477  4 000035   000012 236003                    LDQ     10,DU
         4 000036   000041 552020 2                  STBQ    WPZAP_BUF,'20'O

       97     1478    1        OCD_ZAPPHASE = 3 /* OCD_MONKEY_X# */;

   1478  4 000037   003000 236003                    LDQ     1536,DU
         4 000040   000000 756000 xsym               STQ     OCD_ZAPPHASE

       98     1479    1        CALL M$TIME (ZAP_ENTRY) ALTRET (WHO_CARES2);

   1479  4 000041   000000 630400 2                  EPPR0   ZAP_ENTRY
         4 000042   420004 713400                    CLIMB   alt,+8196
         4 000043   402000 401760                    pmme    nvectors=5
         4 000044   000045 702000 4                  TSX2    WHO_CARES2

   1478  4 000045                       WHO_CARES2   null
       99     1480    1   WHO_CARES2:;
      100     1481    1        GOTO WRITE_IT;

   1481  4 000045   000135 710000 4                  TRA     WRITE_IT

      101     1482                                                /**/
      102     1483                                           /* After all the MING ghosts
      103     1484                                              have responded in phase 4,
      104     1485                                              KEYIN will send a message to
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:16   
      105     1486                                              ELF to close the ERRLOG, and
      106     1487                                              ZAP itself.         */
      107     1488                                                /**/
      108     1489    1   OCD$ELF: ENTRY;

   1489  4 000046   000000 700200 xent  OCD$ELF      TSX0  ! X66_AUTO_0
         4 000047   000004 000000                    ZERO    4,0

   1478  4 000050                       OCD$E        null
      109     1490    1   OCD$E:;
      110     1491    1        XFER# = 4;

   1491  4 000050   000004 235007                    LDA     4,DL
         4 000051   000040 755000 2                  STA     XFER#

      111     1492    1        WR_STA.STATION# = 'ELF';

   1492  4 000052   040000 100400                    MLR     fill='040'O
         4 000053   000003 000003 3                  ADSC9   3                        cn=0,n=3
         4 000054   000030 000010 2                  ADSC9   WR_STA                   cn=0,n=8

      112     1493    1        WPZAP_BUF.VECT# = 0;

   1493  4 000055   000000 236003                    LDQ     0,DU
         4 000056   000041 552040 2                  STBQ    WPZAP_BUF,'40'O

      113     1494    1        WPZAP_BUF.KIN# =55 /* KEY_ZAP# */;

   1494  4 000057   000067 236003                    LDQ     55,DU
         4 000060   000041 552020 2                  STBQ    WPZAP_BUF,'20'O

      114     1495    1        OCD_ZAPPHASE = 5 /* OCD_ELF# */;

   1495  4 000061   005000 236003                    LDQ     2560,DU
         4 000062   000000 756000 xsym               STQ     OCD_ZAPPHASE

      115     1496    1        CALL M$TIME (ZAP_ENTRY) ALTRET (TOO_BAD1);
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:17   

   1496  4 000063   000000 630400 2                  EPPR0   ZAP_ENTRY
         4 000064   420004 713400                    CLIMB   alt,+8196
         4 000065   402000 401760                    pmme    nvectors=5
         4 000066   000067 702000 4                  TSX2    TOO_BAD1

   1495  4 000067                       TOO_BAD1     null
      116     1497    1   TOO_BAD1:;
      117     1498    1        GOTO WRITE_IT;

   1498  4 000067   000135 710000 4                  TRA     WRITE_IT

      118     1499                                                /**/
      119     1500                                           /* In the 6th phase, SLUG is
      120     1501                                              is sent a message to
      121     1502                                              close :ACCTLG, and ZAP itself */
      122     1503                                                /**/
      123     1504    1   OCD$SLUG: ENTRY;

   1504  4 000070   000000 700200 xent  OCD$SLUG     TSX0  ! X66_AUTO_0
         4 000071   000004 000000                    ZERO    4,0

   1495  4 000072                       OCD$SLG      null
      124     1505    1   OCD$SLG:;
      125     1506    1        XFER# = 5;

   1506  4 000072   000005 235007                    LDA     5,DL
         4 000073   000040 755000 2                  STA     XFER#

      126     1507    1        WR_STA.STATION# = 'SLUG';

   1507  4 000074   000004 236000 3                  LDQ     4
         4 000075   000044 737000                    LLS     36
         4 000076   000035 236000 xsym               LDQ     B_VECTNIL+29
         4 000077   000030 757000 2                  STAQ    WR_STA

      127     1508    1        WPZAP_BUF.VECT# = 0;
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:18   

   1508  4 000100   000000 236003                    LDQ     0,DU
         4 000101   000041 552040 2                  STBQ    WPZAP_BUF,'40'O

      128     1509    1        WPZAP_BUF.KIN# = 55 /* KEY_ZAP# */;

   1509  4 000102   000067 236003                    LDQ     55,DU
         4 000103   000041 552020 2                  STBQ    WPZAP_BUF,'20'O

      129     1510    1        OCD_ZAPPHASE = 6 /* OCD_SLUG2# */;

   1510  4 000104   006000 236003                    LDQ     3072,DU
         4 000105   000000 756000 xsym               STQ     OCD_ZAPPHASE

      130     1511    1        CALL M$TIME (ZAP_ENTRY) ALTRET (TOO_BAD2);

   1511  4 000106   000000 630400 2                  EPPR0   ZAP_ENTRY
         4 000107   420004 713400                    CLIMB   alt,+8196
         4 000110   402000 401760                    pmme    nvectors=5
         4 000111   000112 702000 4                  TSX2    TOO_BAD2

   1510  4 000112                       TOO_BAD2     null
      131     1512    1   TOO_BAD2:;
      132     1513    1        GOTO WRITE_IT;

   1513  4 000112   000135 710000 4                  TRA     WRITE_IT

      133     1514                                                /**/
      134     1515                                           /* After SLUG responds in
      135     1516                                              phase 6, KEYIN will send a
      136     1517                                              a message to MONKEY for
      137     1518                                              the final shutdown. We are
      138     1519                                              now in phase 7 (BYE BYE!). */
      139     1520                                                /**/
      140     1521                                                /**/
      141     1522    1   OCD$LASTMNK: ENTRY;

PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:19   
   1522  4 000113   000000 700200 xent  OCD$LASTMNK  TSX0  ! X66_AUTO_0
         4 000114   000004 000000                    ZERO    4,0

   1510  4 000115                       OCD$LASTMONK null
      142     1523    1   OCD$LASTMONK: ;
      143     1524    1        XFER# = 2;

   1524  4 000115   000002 235007                    LDA     2,DL
         4 000116   000040 755000 2                  STA     XFER#

      144     1525    1        WR_STA.STATION#='MONKEY';

   1525  4 000117   040000 100400                    MLR     fill='040'O
         4 000120   000001 000006 3                  ADSC9   1                        cn=0,n=6
         4 000121   000030 000010 2                  ADSC9   WR_STA                   cn=0,n=8

      145     1526    1        WPZAP_BUF.VECT# = 6 /* MKV_OCA$KMISC# */;

   1526  4 000122   006000 236003                    LDQ     3072,DU
         4 000123   000041 552040 2                  STBQ    WPZAP_BUF,'40'O

      146     1527    1        WPZAP_BUF.KIN# = 11 /* KEY_MNKZAP3# */;

   1527  4 000124   000013 236003                    LDQ     11,DU
         4 000125   000041 552020 2                  STBQ    WPZAP_BUF,'20'O

      147     1528    1        OCD_ZAPPHASE = 7 /* OCD_MONKEY_FINAL# */;

   1528  4 000126   007000 236003                    LDQ     3584,DU
         4 000127   000000 756000 xsym               STQ     OCD_ZAPPHASE

      148     1529    1        CALL M$TIME (ZAP_ENTRY) ALTRET (WHO_CARES3);

   1529  4 000130   000000 630400 2                  EPPR0   ZAP_ENTRY
         4 000131   420004 713400                    CLIMB   alt,+8196
         4 000132   402000 401760                    pmme    nvectors=5
         4 000133   000134 702000 4                  TSX2    WHO_CARES3
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:20   

   1528  4 000134                       WHO_CARES3   null
      149     1530    1   WHO_CARES3:;
      150     1531    1        GOTO WRITE_IT;

   1531  4 000134   000135 710000 4                  TRA     WRITE_IT

   1528  4 000135                       WRITE_IT     null
      151     1532                                                /**/
      152     1533    1   WRITE_IT: ;
      153     1534    1        CALL M$WRITE (WRITE_PREZAP) ALTRET (OH_WELL);

   1534  4 000135   000014 630400 2                  EPPR0   WRITE_PREZAP
         4 000136   440001 713400                    CLIMB   alt,write
         4 000137   401400 401760                    pmme    nvectors=4
         4 000140   000142 702000 4                  TSX2    OH_WELL

      154     1535                                                /**/
      155     1536                                                /**/
      156     1537                                           /* Attempt to keep the ZAP going
      157     1538                                                despite ALTRETs */
      158     1539    2        DO WHILE ('0'B /*FALSE#*/);

   1539  4 000141   000165 710000 4                  TRA     END_CASE

   1534  4 000142                       OH_WELL      null
      159     1540    2   OH_WELL:  ;
      160     1541    3             DO CASE (XFER#);

   1541  4 000142   000040 235000 2                  LDA     XFER#
         4 000143   000006 115007                    CMPA    6,DL
         4 000144   000146 602005 4                  TNC     OH_WELL+4,AL
         4 000145   000164 710000 4                  TRA     s:1553
         4 000146   000154 710000 4                  TRA     s:1543
         4 000147   000155 710000 4                  TRA     s:1545
         4 000150   000164 710000 4                  TRA     s:1553
         4 000151   000156 710000 4                  TRA     s:1547
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:21   
         4 000152   000157 710000 4                  TRA     s:1549
         4 000153   000160 710000 4                  TRA     s:1551

      161     1542    3             CASE (0);

      162     1543    3                GOTO OCD$MONK;

   1543  4 000154   000026 710000 4                  TRA     OCD$MONK

      163     1544    3             CASE (1);

      164     1545    3                GOTO OCD$REST2;

   1545  4 000155   000170 710000 4                  TRA     OCD$REST2

      165     1546    3             CASE (3);

      166     1547    3                GOTO OCD$E;

   1547  4 000156   000050 710000 4                  TRA     OCD$E

      167     1548    3             CASE (4);

      168     1549    3                GOTO OCD$SLG;

   1549  4 000157   000072 710000 4                  TRA     OCD$SLG

      169     1550    3             CASE (5);

      170     1551    3                CALL OCD$SHUTDN;

   1551  4 000160   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 000161   000000 701000 xent               TSX1    OCD$SHUTDN
         4 000162   000000 011000                    NOP     0
         4 000163   000165 710000 4                  TRA     END_CASE

      171     1552    3             CASE (ELSE);
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:22   

      172     1553    3                RETURN;

   1553  4 000164   000000 702200 xent               TSX2  ! X66_ARET

      173     1554    3             END;                          /* CASE XFER# */

   1553  4 000165                       END_CASE     null
      174     1555    2   END_CASE: ;
      175     1556    2           END;                            /* DO WHILE */

      176     1557    1        RETURN;

   1557  4 000165   000000 702200 xent               TSX2  ! X66_ARET

      177     1558                                                /**/
      178     1559                                           /* At the conclusion of phase
      179     1560                                              3, MONKEY sends KEYIN a
      180     1561                                              message.  Now we enter
      181     1562                                              phase 4, in which KEYIN calls
      182     1563                                              the remaining MING ghosts.   */
      183     1564                                                /**/
      184     1565    1   OCD$REST: ENTRY;

   1565  4 000166   000000 700200 xent  OCD$REST     TSX0  ! X66_AUTO_0
         4 000167   000004 000000                    ZERO    4,0

   1552  4 000170                       OCD$REST2    null
      185     1566    1   OCD$REST2: ;
      186     1567    1        XFER# = 3;

   1567  4 000170   000003 235007                    LDA     3,DL
         4 000171   000040 755000 2                  STA     XFER#

      187     1568                                                /**/
      188     1569    1        OC_ZIPALL = '1'B /*TRUE#*/;

PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:23   
   1569  4 000172   400000 236003                    LDQ     -131072,DU
         4 000173   000000 756000 xsym               STQ     OC_ZIPALL

      189     1570                                                /**/
      190     1571    1        WPZAP_BUF.VECT# = 0;

   1571  4 000174   000000 236003                    LDQ     0,DU
         4 000175   000041 552040 2                  STBQ    WPZAP_BUF,'40'O

      191     1572    1        WPZAP_BUF.KIN# = 55 /* KEY_ZAP# */;

   1572  4 000176   000067 236003                    LDQ     55,DU
         4 000177   000041 552020 2                  STBQ    WPZAP_BUF,'20'O

      192     1573    1        OCD_ZAPPHASE = 4;

   1573  4 000200   004000 236003                    LDQ     2048,DU
         4 000201   000000 756000 xsym               STQ     OCD_ZAPPHASE

      193     1574    1        CALL M$TIME (ZAP_ENTRY) ALTRET (WHO_CARES4);

   1574  4 000202   000000 630400 2                  EPPR0   ZAP_ENTRY
         4 000203   420004 713400                    CLIMB   alt,+8196
         4 000204   402000 401760                    pmme    nvectors=5
         4 000205   000206 702000 4                  TSX2    WHO_CARES4

   1573  4 000206                       WHO_CARES4   null
      194     1575    1   WHO_CARES4:;
      195     1576                                                /**/
      196     1577    2        DO I = 0 TO 15/*JG_MING#    */;

   1577  4 000206   000042 450000 2                  STZ     I

      197     1578                                                /**/
      198     1579    2             WR_STA.STATION# = OCD_GHOSTS.NAME(I);

   1579  4 000207   000042 236000 2                  LDQ     I
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:24   
         4 000210   000014 402007                    MPY     12,DL
         4 000211   040000 100406                    MLR     fill='040'O
         4 000212   000001 000010 xsym               ADSC9   OCD_GHOSTS+1,Q           cn=0,n=8
         4 000213   000030 000010 2                  ADSC9   WR_STA                   cn=0,n=8

      199     1580                                                /**/
      200     1581    2             IF WR_STA.STATION# ~= ' '

   1581  4 000214   000030 237000 2                  LDAQ    WR_STA
         4 000215   000000 117000 5                  CMPAQ   0
         4 000216   000230 600000 4                  TZE     s:1587

      201     1582    2             THEN
      202     1583    3             DO;

      203     1584    3                  CALL M$WRITE (WRITE_PREZAP) ALTRET (IGNORE);

   1584  4 000217   000014 630400 2                  EPPR0   WRITE_PREZAP
         4 000220   440001 713400                    CLIMB   alt,write
         4 000221   401400 401760                    pmme    nvectors=4
         4 000222   000231 702000 4                  TSX2    IGNORE

      204     1585    3                  OCD_GHOSTS.SENT(I) = '1'B /*TRUE#*/;

   1585  4 000223   000042 236000 2                  LDQ     I
         4 000224   000003 402007                    MPY     3,DL
         4 000225   000000 620006                    EAX0    0,QL
         4 000226   400000 236003                    LDQ     -131072,DU
         4 000227   000000 256010 xsym               ORSQ    OCD_GHOSTS,X0

      205     1586    3                END;                       /* DO IF NON NULL */

      206     1587    3             DO WHILE ('0'B /*FALSE#*/);

   1587  4 000230   000236 710000 4                  TRA     s:1597

   1583  4 000231                       IGNORE       null
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:25   
      207     1588                                           /* Assume (for the time being)
      208     1589                                                that any ALTRET implies that
      209     1590                                                the message didn't get there*/
      210     1591
      211     1592    3   IGNORE:        ;
      212     1593    3                  OCD_GHOSTS.BACK(I) = '1'B /*TRUE#*/;

   1593  4 000231   000042 236000 2                  LDQ     I
         4 000232   000003 402007                    MPY     3,DL
         4 000233   000000 620006                    EAX0    0,QL
         4 000234   200000 236003                    LDQ     65536,DU
         4 000235   000000 256010 xsym               ORSQ    OCD_GHOSTS,X0

      213     1594    3                END;                       /* DO WHILE ALTRET */

      214     1595                                                /**/
      215     1596                                                /**/
      216     1597    2           END;                            /* DO I = 0 TO MING */

   1597  4 000236   000042 054000 2                  AOS     I
         4 000237   000042 235000 2                  LDA     I
         4 000240   000017 115007                    CMPA    15,DL
         4 000241   000207 604400 4                  TMOZ    s:1579

      217     1598                                                /**/
      218     1599    1        RETURN;

   1599  4 000242   000000 702200 xent               TSX2  ! X66_ARET
      219     1600                                                /**/
      220     1601    1   END OCD$DOWNER;
      221     1602        %EOD;

PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:26   
--  Include file information  --

   OCD_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OUT_SUBS_C.:E05TOU  is referenced.
   OC$MESSHD_C.:E05TOU  is referenced.
   OC_DAT_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   OCD_SUBS_C.:E05TOU  is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure OCD$DOWNER.
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:27   

 **** Variables and constants ****

  ****  Section 002  Data  OCD$DOWNER

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    42-0-0/w SBIN        r     1 I                         41-0-0/b STRC        r     1 WPZAP_BUF
    14-0-0/d STRC(432)   r     1 WRITE_PREZAP              30-0-0/w STRC(288)   r     1 WR_STA
    40-0-0/w UBIN        r     1 XFER#                      0-0-0/d STRC(432)   r     1 ZAP_ENTRY

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(108)   r     1 OCD_GHOSTS(0:8191)
     0-0-0/c UBIN(9)     r     1 OCD_ZAPPHASE               0-0-0/c CHAR(11)    r     1 OCD_ZAPTIME
     0-0-0/w PTR         r     1 OC_CONSOLE$                0-0-0/w BIT         r     1 OC_ZIPALL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0N  NULL        r     1 M$CSCG


   Procedure OCD$DOWNER requires 163 words for executable code.
   Procedure OCD$DOWNER requires 4 words of local(AUTO) storage.
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:28   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:29   
          MINI XREF LISTING

I
      1443**DCL      1577<<DOINDEX  1579>>ASSIGN   1585>>ASSIGN   1593>>ASSIGN
IGNORE
      1583**LABEL    1584--CALLALT
M$TIME
      1040**DCL-ENT  1462--CALL     1479--CALL     1496--CALL     1511--CALL     1529--CALL     1574--CALL
M$WRITE
       974**DCL-ENT  1534--CALL     1584--CALL
OCD$E
      1478**LABEL    1547--GOTO
OCD$MONK
      1461**LABEL    1543--GOTO
OCD$REST2
      1552**LABEL    1545--GOTO
OCD$SHUTDN
      1345**DCL-ENT  1551--CALL
OCD$SLG
      1495**LABEL    1549--GOTO
OCD_GHOSTS.BACK
      1338**DCL      1593<<ASSIGN
OCD_GHOSTS.NAME
      1338**DCL      1579>>ASSIGN
OCD_GHOSTS.SENT
      1338**DCL      1585<<ASSIGN
OCD_ZAPPHASE
      1338**DCL      1461<<ASSIGN   1478<<ASSIGN   1495<<ASSIGN   1510<<ASSIGN   1528<<ASSIGN   1573<<ASSIGN
OCD_ZAPTIME
      1338**DCL      1363--DCLINIT  1364--DCLINIT
OC_CONSOLE.ATTR
      1159**DCL      1159--REDEF
OC_CONSOLE.ATTRO
      1160**DCL      1160--REDEF
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:30   
OC_CONSOLE.CID
      1158**DCL      1159--REDEF
OC_CONSOLE.STATION
      1157**DCL      1157--REDEF
OC_CONSOLE$
      1156**DCL      1157--IMP-PTR
OC_DIR
      1199**DCL      1199--REDEF
OC_INTBIT
      1199**DCL      1200--REDEF
OC_INTMSG
      1076**DCL      1089--REDEF
OC_INTMSG.FLAGS
      1083**DCL      1084--REDEF
OC_INTMSG.MESS
      1089**DCL      1089--REDEF
OC_INTMSG.MSGID
      1079**DCL      1080--REDEF
OC_INTMSG.WSN
      1086**DCL      1087--REDEF
OC_MASK
      1200**DCL      1200--REDEF
OC_MESSBUF
      1091**DCL      1106--REDEF    1120--REDEF
OC_MESSBUF.FLAGS
      1098**DCL      1099--REDEF
OC_MESSBUF.MESS
      1104**DCL      1104--REDEF
OC_MESSBUF.MSGID
      1094**DCL      1095--REDEF
OC_MESSBUF.WSN
      1101**DCL      1102--REDEF
OC_MESSBUF1.FLAGS
      1113**DCL      1114--REDEF
OC_MESSBUF1.LEN
      1119**DCL      1119--REDEF
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:31   
OC_MESSBUF1.MSGID
      1109**DCL      1110--REDEF
OC_MESSBUF1.WSN
      1116**DCL      1117--REDEF
OC_MSGBUFFER
      1122**DCL      1137--REDEF
OC_MSGBUFFER.FLAGS
      1129**DCL      1130--REDEF
OC_MSGBUFFER.MESS
      1135**DCL      1135--REDEF
OC_MSGBUFFER.MSGID
      1125**DCL      1126--REDEF
OC_MSGBUFFER.WSN
      1132**DCL      1133--REDEF
OC_MSGBUFFER2.FLAGS
      1144**DCL      1145--REDEF
OC_MSGBUFFER2.MSGID
      1140**DCL      1141--REDEF
OC_MSGBUFFER2.WSN
      1147**DCL      1148--REDEF
OC_PARAM
      1155**DCL      1155--REDEF
OC_QUEUE.PARMC
      1154**DCL      1154--REDEF
OC_ZIPALL
      1201**DCL      1569<<ASSIGN
OH_WELL
      1534**LABEL    1534--CALLALT
TOO_BAD1
      1495**LABEL    1496--CALLALT
TOO_BAD2
      1510**LABEL    1511--CALLALT
WHO_CARES1
      1461**LABEL    1462--CALLALT
WHO_CARES2
      1478**LABEL    1479--CALLALT
PL6.E3A0      #001=OCD$DOWNER File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:32   
WHO_CARES3
      1528**LABEL    1529--CALLALT
WHO_CARES4
      1573**LABEL    1574--CALLALT
WPZAP_BUF
      1438**DCL      1395--DCLINIT  1396--DCLINIT
WPZAP_BUF.KIN#
      1440**DCL      1460<<ASSIGN   1477<<ASSIGN   1494<<ASSIGN   1509<<ASSIGN   1527<<ASSIGN   1572<<ASSIGN
WPZAP_BUF.VECT#
      1439**DCL      1459<<ASSIGN   1476<<ASSIGN   1493<<ASSIGN   1508<<ASSIGN   1526<<ASSIGN   1571<<ASSIGN
WRITE_IT
      1528**LABEL    1464--GOTO     1481--GOTO     1498--GOTO     1513--GOTO     1531--GOTO
WRITE_PREZAP
      1394**DCL      1534<>CALL     1584<>CALL
WRITE_PREZAP.STATION_
      1396**DCL      1396--REDEF
WRITE_PREZAP.V
      1397**DCL      1394--DCLINIT
WRITE_PREZAP.V.DVBYTE.VFC#
      1403**DCL      1403--REDEF
WR_STA
      1421**DCL      1396--DCLINIT
WR_STA.MSGIDXT
      1431**DCL      1434--REDEF
WR_STA.STATION#
      1425**DCL      1458<<ASSIGN   1475<<ASSIGN   1492<<ASSIGN   1507<<ASSIGN   1525<<ASSIGN   1579<<ASSIGN
      1581>>IF
XFER#
      1436**DCL      1457<<ASSIGN   1474<<ASSIGN   1491<<ASSIGN   1506<<ASSIGN   1524<<ASSIGN   1541>>DOCASE
      1567<<ASSIGN
ZAP_ENTRY
      1361**DCL      1462<>CALL     1479<>CALL     1496<>CALL     1511<>CALL     1529<>CALL     1574<>CALL
ZAP_ENTRY.V
      1365**DCL      1361--DCLINIT

PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:33   
      222        1        /*M* OCD$MARKEM KEYINs routine to mark ghosts that are done
      223        2                  cleaning up during zap process */
      224        3        /*T***********************************************************/
      225        4        /*T*                                                         */
      226        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      227        6        /*T*                                                         */
      228        7        /*T***********************************************************/
      229        8        %SET LISTSUB='1'B;
      230        9        /*
      231       10          ###    ###   ####     #    #   #   ###   ####   #   #  #####  #   #
      232       11         # # #  #   #  #   #   ###   ## ##  #   #  #   #  #  #   #      ## ##
      233       12         # # #  #      #   #  # #    # # #  #   #  #   #  # #    #      # # #
      234       13         #  ##  #      #   #   ###   #   #  #####  ####   ##     ####   #   #
      235       14         #   #  #      #   #    # #  #   #  #   #  # #    # #    #      #   #
      236       15         #   #  #   #  #   #   ###   #   #  #   #  #  #   #  #   #      #   #
      237       16          ###    ###   ####     #    #   #  #   #  #   #  #   #  #####  #   #
      238       17                                                                          */
      239       18                                                /**/
      240       19        OCD$MARKEM: PROC (STATION);
      241       20                                                /**/
      242       21    1   DCL STATION CHAR(8) UNAL;
      243       22                                                /**/
      244       23    1   DCL I SBIN WORD STATIC ALIGNED;
      245       24                                                /**/
      246       25    1   DCL OCD$ELF ENTRY;
      247       26                                                /**/
      248       27        %INCLUDE JG_GHOSTS_C;
      249      117                                                /**/
      250      118        %INCLUDE OCI_SUBS_C;
      251      216        %INCLUDE OC_SUBS_C;
      252      947        %INCLUDE OCD_DATA_R;
      253      960                                                /**/
      254      961        %EJECT;
PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:34   
      255      962                                                /**/
      256      963        /*
      257      964
      258      965             Begin  O C D $ M A R K E M   main
      259      966                                                     */
      260      967                                                /**/
      261      968
      262      969    2        DO I = 0 TO 15/*JG_MING#    */;
      263      970                                                /**/
      264      971    2             IF OCD_GHOSTS.NAME(I) = STATION
      265      972    2             THEN
      266      973    3             DO;
      267      974    3                  OCD_GHOSTS.BACK(I) = '1'B /*TRUE#*/;
      268      975    3                  GOTO CHECK_ALL;
      269      976    3                END;                       /* DO IF FOUND */
      270      977    2           END;                            /* DO I */
      271      978                                                /**/
      272      979                                           /* Cant find the station, eh?
      273      980                                                Odd, but ignore it */
      274      981    1        RETURN;
      275      982                                                /**/
      276      983                                                /**/
      277      984    1   CHECK_ALL: ;
      278      985    2        DO I = 0 TO 15/*JG_MING#    */;
      279      986    2             IF OCD_GHOSTS.SENT(I)
      280      987    2                  AND
      281      988    2                  ~OCD_GHOSTS.BACK(I)
      282      989    2             THEN
      283      990    2                  RETURN;
      284      991    2           END;                            /* DO I */
      285      992                                                /**/
      286      993                                                /**/
      287      994                                                /**/
      288      995                                           /* If we get here, then all ghosts
      289      996                                                have reported back */
      290      997                                           /* Close down KEYINs files on
      291      998                                                the #SYS pack */
PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:35   
      292      999    1        CALL OCD$ELF;
      293     1000                                                /**/
      294     1001    1        RETURN;
      295     1002                                                /**/
      296     1003    1   END OCD$MARKEM;
      297     1004        %EOD;

PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:36   
--  Include file information  --

   OCD_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure OCD$MARKEM.

   Procedure OCD$MARKEM requires 40 words for executable code.
   Procedure OCD$MARKEM requires 4 words of local(AUTO) storage.

PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:37   

 Object Unit name= OCD$MARKEM                                 File name= OCD$DOWNER.:E05TOU
 UTS= JUL 30 '97 03:55:50.80 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     1      1  OCD$MARKEM
    1   Proc  even  none    40     50  OCD$MARKEM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  OCD$MARKEM

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 OCD$ELF
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     OCD_GHOSTS                            B_VECTNIL
PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:38   


      222        1        /*M* OCD$MARKEM KEYINs routine to mark ghosts that are done
      223        2                  cleaning up during zap process */
      224        3        /*T***********************************************************/
      225        4        /*T*                                                         */
      226        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      227        6        /*T*                                                         */
      228        7        /*T***********************************************************/
      229        8        %SET LISTSUB='1'B;
      230        9        /*
      231       10          ###    ###   ####     #    #   #   ###   ####   #   #  #####  #   #
      232       11         # # #  #   #  #   #   ###   ## ##  #   #  #   #  #  #   #      ## ##
      233       12         # # #  #      #   #  # #    # # #  #   #  #   #  # #    #      # # #
      234       13         #  ##  #      #   #   ###   #   #  #####  ####   ##     ####   #   #
      235       14         #   #  #      #   #    # #  #   #  #   #  # #    # #    #      #   #
      236       15         #   #  #   #  #   #   ###   #   #  #   #  #  #   #  #   #      #   #
      237       16          ###    ###   ####     #    #   #  #   #  #   #  #   #  #####  #   #
      238       17                                                                          */
      239       18                                                /**/
      240       19        OCD$MARKEM: PROC (STATION);

     19  1 000000   000000 700200 xent  OCD$MARKEM   TSX0  ! X66_AUTO_1
         1 000001   000004 000001                    ZERO    4,1

      241       20                                                /**/
      242       21    1   DCL STATION CHAR(8) UNAL;
      243       22                                                /**/
      244       23    1   DCL I SBIN WORD STATIC ALIGNED;
      245       24                                                /**/
      246       25    1   DCL OCD$ELF ENTRY;
      247       26                                                /**/
      248       27        %INCLUDE JG_GHOSTS_C;
      249      117                                                /**/
      250      118        %INCLUDE OCI_SUBS_C;
      251      216        %INCLUDE OC_SUBS_C;
      252      947        %INCLUDE OCD_DATA_R;
      253      960                                                /**/
PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:39   
      254      961        %EJECT;
PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:40   
      255      962                                                /**/
      256      963        /*
      257      964
      258      965             Begin  O C D $ M A R K E M   main
      259      966                                                     */
      260      967                                                /**/
      261      968
      262      969    2        DO I = 0 TO 15/*JG_MING#    */;

    969  1 000002   000000 450000 0                  STZ     I

      263      970                                                /**/
      264      971    2             IF OCD_GHOSTS.NAME(I) = STATION

    971  1 000003   000000 236000 0                  LDQ     I
         1 000004   000014 402007                    MPY     12,DL
         1 000005   200003 470500                    LDP0    @STATION,,AUTO
         1 000006   040100 106406                    CMPC    fill='040'O
         1 000007   000001 000010 xsym               ADSC9   OCD_GHOSTS+1,Q           cn=0,n=8
         1 000010   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 000011   000020 601000 1                  TNZ     s:977

      265      972    2             THEN
      266      973    3             DO;

      267      974    3                  OCD_GHOSTS.BACK(I) = '1'B /*TRUE#*/;

    974  1 000012   000000 236000 0                  LDQ     I
         1 000013   000003 402007                    MPY     3,DL
         1 000014   000000 620006                    EAX0    0,QL
         1 000015   200000 236003                    LDQ     65536,DU
         1 000016   000000 256010 xsym               ORSQ    OCD_GHOSTS,X0

      268      975    3                  GOTO CHECK_ALL;

    975  1 000017   000025 710000 1                  TRA     CHECK_ALL

PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:41   
      269      976    3                END;                       /* DO IF FOUND */
      270      977    2           END;                            /* DO I */

    977  1 000020   000000 054000 0                  AOS     I
         1 000021   000000 235000 0                  LDA     I
         1 000022   000017 115007                    CMPA    15,DL
         1 000023   000003 604400 1                  TMOZ    s:971

      271      978                                                /**/
      272      979                                           /* Cant find the station, eh?
      273      980                                                Odd, but ignore it */
      274      981    1        RETURN;

    981  1 000024   000000 702200 xent               TSX2  ! X66_ARET

    971  1 000025                       CHECK_ALL    null
      275      982                                                /**/
      276      983                                                /**/
      277      984    1   CHECK_ALL: ;
      278      985    2        DO I = 0 TO 15/*JG_MING#    */;

    985  1 000025   000000 450000 0                  STZ     I

      279      986    2             IF OCD_GHOSTS.SENT(I)

    986  1 000026   000000 236000 0                  LDQ     I
         1 000027   000003 402007                    MPY     3,DL
         1 000030   000000 234006 xsym               SZN     OCD_GHOSTS,QL
         1 000031   000040 605000 1                  TPL     s:991
         1 000032   000000 236006 xsym               LDQ     OCD_GHOSTS,QL
         1 000033   000001 736000                    QLS     1
         1 000034   400000 376003                    ANQ     -131072,DU
         1 000035   400000 676003                    ERQ     -131072,DU
         1 000036   000040 600000 1                  TZE     s:991

      280      987    2                  AND
      281      988    2                  ~OCD_GHOSTS.BACK(I)
PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:42   
      282      989    2             THEN
      283      990    2                  RETURN;

    990  1 000037   000000 702200 xent               TSX2  ! X66_ARET

      284      991    2           END;                            /* DO I */

    991  1 000040   000000 054000 0                  AOS     I
         1 000041   000000 235000 0                  LDA     I
         1 000042   000017 115007                    CMPA    15,DL
         1 000043   000026 604400 1                  TMOZ    s:986

      285      992                                                /**/
      286      993                                                /**/
      287      994                                                /**/
      288      995                                           /* If we get here, then all ghosts
      289      996                                                have reported back */
      290      997                                           /* Close down KEYINs files on
      291      998                                                the #SYS pack */
      292      999    1        CALL OCD$ELF;

    999  1 000044   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000045   000000 701000 xent               TSX1    OCD$ELF
         1 000046   000000 011000                    NOP     0

      293     1000                                                /**/
      294     1001    1        RETURN;

   1001  1 000047   000000 702200 xent               TSX2  ! X66_ARET
      295     1002                                                /**/
      296     1003    1   END OCD$MARKEM;
      297     1004        %EOD;

PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:43   
--  Include file information  --

   OCD_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure OCD$MARKEM.
PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:44   

 **** Variables and constants ****

  ****  Section 000  Data  OCD$MARKEM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 I

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @STATION                  *0-0-0/c CHAR(8)     r     1 STATION

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(108)   r     1 OCD_GHOSTS(0:8191)


   Procedure OCD$MARKEM requires 40 words for executable code.
   Procedure OCD$MARKEM requires 4 words of local(AUTO) storage.
PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:45   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=OCD$MARKEM File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:46   
          MINI XREF LISTING

CHECK_ALL
       971**LABEL     975--GOTO
I
        23**DCL       969<<DOINDEX   971>>IF        974>>ASSIGN    985<<DOINDEX   986>>IF        986>>IF
OCD$ELF
        25**DCL-ENT   999--CALL
OCD_GHOSTS.BACK
       956**DCL       974<<ASSIGN    986>>IF
OCD_GHOSTS.NAME
       956**DCL       971>>IF
OCD_GHOSTS.SENT
       956**DCL       986>>IF
STATION
        21**DCL        19--PROC      971>>IF

PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:47   
      298        1        /*M* OCD$SHUTDN KEYINs internal routine to close down all internally
      299        2                       used files and inform MONKEY of KEYIN shutdown */
      300        3        /*T***********************************************************/
      301        4        /*T*                                                         */
      302        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      303        6        /*T*                                                         */
      304        7        /*T***********************************************************/
      305        8        %SET LISTSUB='1'B;
      306        9        /*
      307       10          ###    ###   ####     #     ###   #   #  #   #  #####  ####   #   #
      308       11         # # #  #   #  #   #   ###   #   #  #   #  #   #    #    #   #  #   #
      309       12         # # #  #      #   #  # #    #      #   #  #   #    #    #   #  ##  #
      310       13         #  ##  #      #   #   ###    ###   #####  #   #    #    #   #  # # #
      311       14         #   #  #      #   #    # #      #  #   #  #   #    #    #   #  #  ##
      312       15         #   #  #   #  #   #   ###   #   #  #   #  #   #    #    #   #  #   #
      313       16          ###    ###   ####     #     ###   #   #   ###     #    ####   #   #
      314       17                                                                          */
      315       18                                                /**/
      316       19        OCD$SHUTDN: PROC;
      317       20                                                /**/
      318       21                                                /**/
      319       22        %INCLUDE OC_SUBS_C;
      320      753        %INCLUDE OCI_SUBS_C;
      321      851                                                /**/
      322      852        %INCLUDE CP_6;
      323      933        %INCLUDE OC_DAT_R;
      324     1094                                                /**/
      325     1095    1   DCL OCD$LASTMNK ENTRY;
      326     1096                                                /**/
      327     1097    1   DCL M$CSCG DCB;
      328     1098    1   DCL F$TEMPLATE DCB;
      329     1099    1   DCL F$HISTFILE DCB;
      330     1100    1   DCL M$HLP DCB;
      331     1101                                                /**/
      332     1102                                                /**/
      333     1103             %FPT_CLOSE     (FPTN=CLOSE_TEMPLATE,
      334     1104                                 DCB=F$TEMPLATE,
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:48   
      335     1105                                 DISP=SAVE);
      336     1147                                                /**/
      337     1148             %FPT_CLOSE     (FPTN=CLOSE_HISTFILE,
      338     1149                                 DCB=F$HISTFILE,
      339     1150                                 DISP=SAVE);
      340     1192                                                /**/
      341     1193             %FPT_CLOSE     (FPTN=CLOSE_HLP,
      342     1194                                 DCB=M$HLP,
      343     1195                                 DISP=SAVE);
      344     1237                                                /**/
      345     1238    1        OC_NOACT = '1'B /*TRUE#*/;               /* No more activity will be allowed */
      346     1239                                                /**/
      347     1240    1        OC_LIST = '0'B /*FALSE#*/;
      348     1241    1        CALL M$CLOSE (CLOSE_HISTFILE) ALTRET(WELL_WHO);
      349     1242    1   WELL_WHO: ;
      350     1243    1        CALL M$CLOSE (CLOSE_TEMPLATE) ALTRET(CARES_ANYWAY);
      351     1244    1   CARES_ANYWAY: ;
      352     1245    1        CALL M$CLOSE (CLOSE_HLP) ALTRET(NOT_ME);
      353     1246    1   NOT_ME: ;
      354     1247                                      /* Issue the final shutdown message
      355     1248                                           to MONKEY */
      356     1249    1        CALL OCD$LASTMNK;
      357     1250                                                /**/
      358     1251    1        RETURN;
      359     1252                                                /**/
      360     1253    1   END OCD$SHUTDN;

PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:49   
--  Include file information  --

   OC$MESSHD_C.:E05TOU  is referenced.
   OC_DAT_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure OCD$SHUTDN.

   Procedure OCD$SHUTDN requires 21 words for executable code.
   Procedure OCD$SHUTDN requires 4 words of local(AUTO) storage.

    No errors detected in file OCD$DOWNER.:E05TSI    .

PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:50   

 Object Unit name= OCD$SHUTDN                                 File name= OCD$DOWNER.:E05TOU
 UTS= JUL 30 '97 03:55:59.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$CSCG
    2   DCB   even  none     0      0  F$TEMPLATE
    3   DCB   even  none     0      0  F$HISTFILE
    4   DCB   even  none     0      0  M$HLP
    5   Data  even  none    90    132  OCD$SHUTDN
    6   Proc  even  none    21     25  OCD$SHUTDN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     6      0   yes            yes      Std        0  OCD$SHUTDN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 OCD$LASTMNK
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:51   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  OC_INTMSG                             OC_MESSBUF
     OC_MSGBUFFER                          OC_PARAM                              OC_CONSOLE$
     OC_DIR                                OC_INTBIT                             OC_MASK
     OC_NOACT                              OC_LIST                               M$CSCG
     F$TEMPLATE                            F$HISTFILE                            M$HLP
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:52   


      298        1        /*M* OCD$SHUTDN KEYINs internal routine to close down all internally
      299        2                       used files and inform MONKEY of KEYIN shutdown */
      300        3        /*T***********************************************************/
      301        4        /*T*                                                         */
      302        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      303        6        /*T*                                                         */
      304        7        /*T***********************************************************/
      305        8        %SET LISTSUB='1'B;
      306        9        /*
      307       10          ###    ###   ####     #     ###   #   #  #   #  #####  ####   #   #
      308       11         # # #  #   #  #   #   ###   #   #  #   #  #   #    #    #   #  #   #
      309       12         # # #  #      #   #  # #    #      #   #  #   #    #    #   #  ##  #
      310       13         #  ##  #      #   #   ###    ###   #####  #   #    #    #   #  # # #
      311       14         #   #  #      #   #    # #      #  #   #  #   #    #    #   #  #  ##
      312       15         #   #  #   #  #   #   ###   #   #  #   #  #   #    #    #   #  #   #
      313       16          ###    ###   ####     #     ###   #   #   ###     #    ####   #   #
      314       17                                                                          */
      315       18                                                /**/
      316       19        OCD$SHUTDN: PROC;

     19  6 000000   000000 700200 xent  OCD$SHUTDN   TSX0  ! X66_AUTO_0
         6 000001   000004 000000                    ZERO    4,0

      317       20                                                /**/
      318       21                                                /**/
      319       22        %INCLUDE OC_SUBS_C;
      320      753        %INCLUDE OCI_SUBS_C;
      321      851                                                /**/
      322      852        %INCLUDE CP_6;
      323      933        %INCLUDE OC_DAT_R;
      324     1094                                                /**/
      325     1095    1   DCL OCD$LASTMNK ENTRY;
      326     1096                                                /**/
      327     1097    1   DCL M$CSCG DCB;
      328     1098    1   DCL F$TEMPLATE DCB;
      329     1099    1   DCL F$HISTFILE DCB;
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:53   
      330     1100    1   DCL M$HLP DCB;
      331     1101                                                /**/
      332     1102                                                /**/
      333     1103             %FPT_CLOSE     (FPTN=CLOSE_TEMPLATE,
      334     1104                                 DCB=F$TEMPLATE,
      335     1105                                 DISP=SAVE);
      336     1147                                                /**/
      337     1148             %FPT_CLOSE     (FPTN=CLOSE_HISTFILE,
      338     1149                                 DCB=F$HISTFILE,
      339     1150                                 DISP=SAVE);
      340     1192                                                /**/
      341     1193             %FPT_CLOSE     (FPTN=CLOSE_HLP,
      342     1194                                 DCB=M$HLP,
      343     1195                                 DISP=SAVE);
      344     1237                                                /**/
      345     1238    1        OC_NOACT = '1'B /*TRUE#*/;              /* No more activity will be allowed */

   1238  6 000002   400000 236003                    LDQ     -131072,DU
         6 000003   000000 756000 xsym               STQ     OC_NOACT

      346     1239                                                /**/
      347     1240    1        OC_LIST = '0'B /*FALSE#*/;

   1240  6 000004   000000 450000 xsym               STZ     OC_LIST

      348     1241    1        CALL M$CLOSE (CLOSE_HISTFILE) ALTRET(WELL_WHO);

   1241  6 000005   000036 630400 5                  EPPR0   CLOSE_HISTFILE
         6 000006   450001 713400                    CLIMB   alt,close
         6 000007   406000 401760                    pmme    nvectors=13
         6 000010   000011 702000 6                  TSX2    WELL_WHO

   1240  6 000011                       WELL_WHO     null
      349     1242    1   WELL_WHO: ;
      350     1243    1        CALL M$CLOSE (CLOSE_TEMPLATE) ALTRET(CARES_ANYWAY);

   1243  6 000011   000000 630400 5                  EPPR0   CLOSE_TEMPLATE
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:54   
         6 000012   450001 713400                    CLIMB   alt,close
         6 000013   406000 401760                    pmme    nvectors=13
         6 000014   000015 702000 6                  TSX2    CARES_ANYWAY

   1240  6 000015                       CARES_ANYWAY null
      351     1244    1   CARES_ANYWAY: ;
      352     1245    1        CALL M$CLOSE (CLOSE_HLP) ALTRET(NOT_ME);

   1245  6 000015   000074 630400 5                  EPPR0   CLOSE_HLP
         6 000016   450001 713400                    CLIMB   alt,close
         6 000017   406000 401760                    pmme    nvectors=13
         6 000020   000021 702000 6                  TSX2    NOT_ME

   1240  6 000021                       NOT_ME       null
      353     1246    1   NOT_ME: ;
      354     1247                                      /* Issue the final shutdown message
      355     1248                                           to MONKEY */
      356     1249    1        CALL OCD$LASTMNK;

   1249  6 000021   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 000022   000000 701000 xent               TSX1    OCD$LASTMNK
         6 000023   000000 011000                    NOP     0

      357     1250                                                /**/
      358     1251    1        RETURN;

   1251  6 000024   000000 702200 xent               TSX2  ! X66_ARET
      359     1252                                                /**/
      360     1253    1   END OCD$SHUTDN;

PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:55   
--  Include file information  --

   OC$MESSHD_C.:E05TOU  is referenced.
   OC_DAT_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure OCD$SHUTDN.
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:56   

 **** Variables and constants ****

  ****  Section 005  Data  OCD$SHUTDN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    36-0-0/d STRC(1080)  r     1 CLOSE_HISTFILE            74-0-0/d STRC(1080)  r     1 CLOSE_HLP
     0-0-0/d STRC(1080)  r     1 CLOSE_TEMPLATE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 OC_CONSOLE$                0-0-0/w BIT         r     1 OC_LIST
     0-0-0/w BIT         r     1 OC_NOACT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0N  NULL        r     1 F$HISTFILE                 0-0-0N  NULL        r     1 F$TEMPLATE
     0-0-0N  NULL        r     1 M$HLP


   Procedure OCD$SHUTDN requires 21 words for executable code.
   Procedure OCD$SHUTDN requires 4 words of local(AUTO) storage.

    No errors detected in file OCD$DOWNER.:E05TSI    .
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:57   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:58   
          MINI XREF LISTING

CARES_ANYWAY
      1240**LABEL    1243--CALLALT
CLOSE_HISTFILE
      1173**DCL      1241<>CALL
CLOSE_HISTFILE.SN_
      1173**DCL      1173--REDEF
CLOSE_HISTFILE.UTL_
      1174**DCL      1174--REDEF
CLOSE_HISTFILE.V
      1178**DCL      1173--DCLINIT
CLOSE_HISTFILE.V.EXPIRE#
      1188**DCL      1188--REDEF
CLOSE_HISTFILE.V.TYPE#
      1186**DCL      1186--REDEF
CLOSE_HISTFILE.V.XTNSIZE#
      1183**DCL      1183--REDEF    1185--REDEF
CLOSE_HLP
      1218**DCL      1245<>CALL
CLOSE_HLP.SN_
      1218**DCL      1218--REDEF
CLOSE_HLP.UTL_
      1219**DCL      1219--REDEF
CLOSE_HLP.V
      1223**DCL      1218--DCLINIT
CLOSE_HLP.V.EXPIRE#
      1233**DCL      1233--REDEF
CLOSE_HLP.V.TYPE#
      1231**DCL      1231--REDEF
CLOSE_HLP.V.XTNSIZE#
      1228**DCL      1228--REDEF    1230--REDEF
CLOSE_TEMPLATE
      1128**DCL      1243<>CALL
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:59   
CLOSE_TEMPLATE.SN_
      1128**DCL      1128--REDEF
CLOSE_TEMPLATE.UTL_
      1129**DCL      1129--REDEF
CLOSE_TEMPLATE.V
      1133**DCL      1128--DCLINIT
CLOSE_TEMPLATE.V.EXPIRE#
      1143**DCL      1143--REDEF
CLOSE_TEMPLATE.V.TYPE#
      1141**DCL      1141--REDEF
CLOSE_TEMPLATE.V.XTNSIZE#
      1138**DCL      1138--REDEF    1140--REDEF
M$CLOSE
       861**DCL-ENT  1241--CALL     1243--CALL     1245--CALL
NOT_ME
      1240**LABEL    1245--CALLALT
OCD$LASTMNK
      1095**DCL-ENT  1249--CALL
OC_CONSOLE.ATTR
      1047**DCL      1047--REDEF
OC_CONSOLE.ATTRO
      1048**DCL      1048--REDEF
OC_CONSOLE.CID
      1046**DCL      1047--REDEF
OC_CONSOLE.STATION
      1045**DCL      1045--REDEF
OC_CONSOLE$
      1044**DCL      1045--IMP-PTR
OC_DIR
      1087**DCL      1087--REDEF
OC_INTBIT
      1087**DCL      1088--REDEF
OC_INTMSG
       964**DCL       977--REDEF
OC_INTMSG.FLAGS
       971**DCL       972--REDEF
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:60   
OC_INTMSG.MESS
       977**DCL       977--REDEF
OC_INTMSG.MSGID
       967**DCL       968--REDEF
OC_INTMSG.WSN
       974**DCL       975--REDEF
OC_LIST
      1090**DCL      1240<<ASSIGN
OC_MASK
      1088**DCL      1088--REDEF
OC_MESSBUF
       979**DCL       994--REDEF    1008--REDEF
OC_MESSBUF.FLAGS
       986**DCL       987--REDEF
OC_MESSBUF.MESS
       992**DCL       992--REDEF
OC_MESSBUF.MSGID
       982**DCL       983--REDEF
OC_MESSBUF.WSN
       989**DCL       990--REDEF
OC_MESSBUF1.FLAGS
      1001**DCL      1002--REDEF
OC_MESSBUF1.LEN
      1007**DCL      1007--REDEF
OC_MESSBUF1.MSGID
       997**DCL       998--REDEF
OC_MESSBUF1.WSN
      1004**DCL      1005--REDEF
OC_MSGBUFFER
      1010**DCL      1025--REDEF
OC_MSGBUFFER.FLAGS
      1017**DCL      1018--REDEF
OC_MSGBUFFER.MESS
      1023**DCL      1023--REDEF
OC_MSGBUFFER.MSGID
      1013**DCL      1014--REDEF
PL6.E3A0      #003=OCD$SHUTDN File=OCD$DOWNER.:E05TSI                            WED 07/30/97 03:55 Page:61   
OC_MSGBUFFER.WSN
      1020**DCL      1021--REDEF
OC_MSGBUFFER2.FLAGS
      1032**DCL      1033--REDEF
OC_MSGBUFFER2.MSGID
      1028**DCL      1029--REDEF
OC_MSGBUFFER2.WSN
      1035**DCL      1036--REDEF
OC_NOACT
      1089**DCL      1238<<ASSIGN
OC_PARAM
      1043**DCL      1043--REDEF
OC_QUEUE.PARMC
      1042**DCL      1042--REDEF
WELL_WHO
      1240**LABEL    1241--CALLALT
