VERSION B06

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:1    
        1        1        /*M* NODEATER - Build :NODES file for use by MOVE and MAIL and SCOTTY. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*F**
        9        9        *
       10       10        *   NAME:  VWN$NODEATER
       11       11        *
       12       12        *   PURPOSE:
       13       13        *       To build the :NODES file for use by MOVE, SCOTTY, et al.
       14       14        *
       15       15        *   DESCRIPTION:
       16       16        *       NODEATER reads user input and builds a node's representation of
       17       17        *       the network in :NODES.
       18       18        *
       19       19        *   REFERENCE:
       20       20        *       See the appropriate Architecture File document for a description
       21       21        *       of the :NODES file.
       22       22        *
       23       23        ****/
       24       24
       25       25        /*D**
       26       26        *
       27       27        *   NAME:  VWN$NODEATER
       28       28        *
       29       29        *   CALL:
       30       30        *       Main program.
       31       31        *
       32       32        *   PARAMETERS:
       33       33        *       None.
       34       34        *
       35       35        *   INTERFACE:
       36       36        *       Uses the parser and the XUR$ routines.
       37       37        *
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:2    
       38       38        *   ENVIRONMENT:
       39       39        *       A large network may require a lot of memory, which is obtained
       40       40        *       dynamically.
       41       41        *
       42       42        *   INPUT:
       43       43        *       Input is read from the SI stream via XUR$GETCMD.
       44       44        *
       45       45        *   OUTPUT:
       46       46        *       :NODES in the current FMA is overwritten.
       47       47        *
       48       48        *   SCRATCH:
       49       49        *       None.
       50       50        *
       51       51        *   DESCRIPTION:
       52       52        *       The NODEATER program builds the :NODES file for use by MOVE and
       53       53        *       SCOTTY, the file transporters.  This file is also used by MAILMAN
       54       54        *       and other processors which need to interrogate the network info.
       55       55        *
       56       56        ****/
       57       57
       58       58        VWN$NODEATER: PROC MAIN NOAUTO;
       59       59
       60       60        /****
       61       61        *
       62       62        *   %INCLUDEs
       63       63        *
       64       64        ****/
       65       65
       66       66        %INCLUDE CP_6;
       67     5625        %INCLUDE CP_6_SUBS;
       68     6165        %INCLUDE B$JIT;
       69     6768        %INCLUDE B$TABLES_C;
       70     6876        %INCLUDE XU_MACRO_C;
       71     9982        %INCLUDE XUH_MACRO_C;
       72    10066        %INCLUDE XUR_ENTRY;
       73    10098        %INCLUDE VW_NODEATER_E;
       74    10154        %INCLUDE VWN_ERRS_E;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:3    
       75    10317        %INCLUDE VW_FPTS_M;
       76    10738
       77    10739        /****
       78    10740        *
       79    10741        *   FPTs
       80    10742        *
       81    10743        ****/
       82    10744
       83    10745        %FPT_WRITE(FPTN=WRITE_NODE,
       84    10746                   DCB=M$NODE,
       85    10747                   BUF=NODEREC,
       86    10748                   KEY=NODEKEY,
       87    10749                   NEWKEY=YES);
       88    10780
       89    10781        %FPT_READ(FPTN=READ_SEQUEN,
       90    10782                  DCB=M$NODE,
       91    10783                  BUF=NODEREC,
       92    10784                  KEY=NODEKEY,
       93    10785                  KEYR=YES);
       94    10824
       95    10825        %FPT_PFIL(FPTN=PFIL_NODE,
       96    10826                  DCB=M$NODE,
       97    10827                  BOF=YES);
       98    10842
       99    10843        %FPT_DELREC(FPTN=DELREC_NODE,
      100    10844                    DCB=M$NODE,
      101    10845                    KEY=NODEKEY);
      102    10864
      103    10865        %VLP_ATTR(FPTN=ACC_NODE);
      104    10879
      105    10880        %VLP_ACCESS(ACCT='?',
      106    10881                    NOLIST=YES,
      107    10882                    EXEC=YES,
      108    10883                    LAST=";");
      109    10900
      110    10901                  %VLP_ATTR(FPTN=ACS_NODE);
      111    10915
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:4    
      112    10916        %VLP_ACSVEH(VEHICLE='MOVE',
      113    10917                    READ=YES);
      114    10934
      115    10935                  %VLP_ACSVEH(VEHICLE='SCOTTY',
      116    10936                  READ=YES);
      117    10953
      118    10954                  %VLP_ACSVEH(VEHICLE='SEND',
      119    10955                  READ=YES);
      120    10972
      121    10973                  %VLP_ACSVEH(VEHICLE='MAIL',
      122    10974                  READ=YES);
      123    10991
      124    10992                  %VLP_ACSVEH(VEHICLE='MAILMAN',
      125    10993                  READ=YES);
      126    11010
      127    11011                  %VLP_ACSVEH(VEHICLE='MOVE_TEST',
      128    11012                  READ=YES);
      129    11029
      130    11030                  %VLP_ACSVEH(VEHICLE='SCOTTY_TEST',
      131    11031                  READ=YES);
      132    11048
      133    11049                  %VLP_ACSVEH(VEHICLE='SEND_TEST',
      134    11050                  READ=YES);
      135    11067
      136    11068                  %VLP_ACSVEH(VEHICLE='MAIL_TEST',
      137    11069                  READ=YES);
      138    11086
      139    11087                  %VLP_ACSVEH(VEHICLE='MAILMAN_TEST',
      140    11088                  READ=YES,
      141    11089                  LAST=";");
      142    11106
      143    11107                  %P_PCB;
      144    11306
      145    11307        %PARSE$OUT;
      146    11352
      147    11353        %PARSE$SYM;
      148    11391
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:5    
      149    11392        %F$DCB(DCBN=DUMMY);
      150    11449
      151    11450        %FPT_GDS(RESULTS=VLP_VECTOR,
      152    11451                 SEGSIZE=1024);
      153    11467        %VLP_VECTOR(SEGID='6010'O);
      154    11482
      155    11483        %FPT_EXIT;
      156    11498
      157    11499        %B$ALT;
      158    11507
      159    11508        %B$TCB;
      160    11511
      161    11512        %XUR_INIT(SYNTAX=YES,
      162    11513                  PCB=P_PCB);
      163    11612
      164    11613        %XUH_PARAM;
      165    11674
      166    11675                  %B$XL_UPPER;
      167    11679
      168    11680        /****
      169    11681        *
      170    11682        *   DCBs and external references
      171    11683        *
      172    11684        ****/
      173    11685
      174    11686    1   DCL M$SI                           DCB;
      175    11687    1   DCL M$LO                           DCB;
      176    11688    1   DCL M$NODE                         DCB;
      177    11689    1   DCL M$DO                           DCB;
      178    11690
      179    11691    1   DCL VWN_COMMAND SYMREF             BIT(36);
      180    11692    1   DCL B$TCB$ SYMREF                  PTR;
      181    11693    1   DCL B$JIT$ SYMREF                  PTR;
      182    11694    1   DCL 1 B_VERSION SYMREF,
      183    11695    1         2 L UNAL                     UBIN BYTE,
      184    11696    1         2 C UNAL                     CHAR(B_VERSION.L);
      185    11697
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:6    
      186    11698        /****
      187    11699        *
      188    11700        *   Working storage
      189    11701        *
      190    11702        ****/
      191    11703
      192    11704    1   DCL IAMPTR                         PTR;
      193    11705    1   DCL BLK$                           PTR;
      194    11706    1   DCL NODEPTR                        PTR;
      195    11707    1   DCL PATHPTR                        PTR;
      196    11708    1   DCL P                              PTR;
      197    11709    1   DCL Q                              PTR;
      198    11710    1   DCL R                              PTR;
      199    11711
      200    11712    1   DCL I                              SBIN;
      201    11713    1   DCL J                              SBIN;
      202    11714    1   DCL K                              SBIN;
      203    11715    1   DCL L                              SBIN;
      204    11716    1   DCL TOT_TIME                       SBIN;
      205    11717    1   DCL LVL                            SBIN;
      206    11718    1   DCL MAXLVL                         SBIN;
      207    11719    1   DCL NODECNT                        SBIN;
      208    11720    1   DCL WDSLEFT                        SBIN;
      209    11721
      210    11722    1   DCL PTR$(0:63)                     PTR;
      211    11723    1   DCL IDX(0:63)                      SBIN;
      212    11724
      213    11725    1   DCL PROMPT CONSTANT                CHAR(1) INIT('>');
      214    11726
      215    11727    1   DCL IAM                            CHAR(8);
      216    11728    1   DCL HOLD                           CHAR(8);
      217    11729    1   DCL DIRECTORY_NODE                 CHAR(8);
      218    11730
      219    11731    1   DCL 1 ERRMSGFID CONSTANT,
      220    11732    1         2 L UNAL                     UBIN BYTE INIT(15),
      221    11733    1         2 C UNAL                     CHAR(39) INIT(':VWERRMSG.:SYS');
      222    11734
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:7    
      223    11735    1   DCL 1 ANODE BASED(NODEPTR),
      224    11736    1         2 NAME                       CHAR(8),
      225    11737    1         2 DONE                       BIT(1),
      226    11738    1         2 VISIT                      BIT(1),
      227    11739    1         2 *                          BIT(7),
      228    11740    1         2 TYPE UNAL                  UBIN BYTE,
      229    11741    1         2 COUNT UNAL                 UBIN HALF;
      230    11742
      231    11743    1   DCL 1 APATH BASED(PATHPTR),
      232    11744    1         2 NAME                       CHAR(8),
      233    11745    1         2 DEST                       CHAR(8),
      234    11746    1         2 ACCT CHAR (8),
      235    11747    1         2 MODE UNAL                  UBIN HALF,
      236    11748    1         2 SPEED UNAL                 UBIN HALF,
      237    11749    1         2 PTR$                       PTR;
      238    11750
      239    11751    1   DCL 1 U1,
      240    11752    1         2 L UNAL                     UBIN BYTE,
      241    11753    1         2 C UNAL                     CHAR(31);
      242    11754
      243    11755    1   DCL 1 U2,
      244    11756    1         2 L UNAL                     UBIN BYTE,
      245    11757    1         2 C UNAL                     CHAR(31);
      246    11758
      247    11759    1   DCL 1 ERR BASED ALIGNED,                /* #21743                             */
      248    11760    1         2 FCG                        BIT(18),
      249    11761    1         2 MON                        BIT(1),
      250    11762    1         2 CODE UNAL                  UBIN(14),
      251    11763    1         2 SEV UNAL                   UBIN(3);
      252    11764
      253    11765        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:8    
      254    11766        /****
      255    11767        *
      256    11768        *   Initialize data, greet the user, set up memory, etc.
      257    11769        *
      258    11770        ****/
      259    11771
      260    11772    1           CALL XUR$INIT(XUR_INIT);
      261    11773    1           CALL XUR$SETDCBS(,DCBNUM(M$LO));
      262    11774    1           CALL XUR$SETERRMSG(ERRMSGFID);
      263    11775
      264    11776        /****
      265    11777        *
      266    11778        *   Build the :NODES file in the current FMA.
      267    11779        *
      268    11780        ****/
      269    11781
      270    11782    1           ACCT_NODE.ACCT#=B$JIT$->B$JIT.FACCN;
      271    11783
      272    11784        /****
      273    11785        *
      274    11786        *   Acquire memory for the tables.
      275    11787        *
      276    11788        ****/
      277    11789
      278    11790    1           CALL M$GDS(FPT_GDS) ALTRET(ERR_MEM);
      279    11791    1           WDSLEFT=1024;
      280    11792    1           NODEPTR=VLP_VECTOR.PTR$;
      281    11793    1           PATHPTR=VLP_VECTOR.PTR$;
      282    11794
      283    11795        /****
      284    11796        *
      285    11797        *   Indicate that no IAM node has been found, set the count of nodes to zero.
      286    11798        *
      287    11799        ****/
      288    11800
      289    11801    1           IAM=' ';
      290    11802    1           IAMPTR=ADDR(NIL);
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:9    
      291    11803    1           NODECNT=0;
      292    11804
      293    11805        /****
      294    11806        *
      295    11807        *   Supply the access vehicles for the :NODES file, then open it output.
      296    11808        *   Note that this will not delete an existing :NODES file now, since the
      297    11809        *   new file isn't cataloged until EOJ.
      298    11810        *
      299    11811        ****/
      300    11812
      301    11813    1           OPEN_NODE.ACCESS_=VECTOR(ACC_NODE);
      302    11814    1           OPEN_NODE.ACSVEH_=VECTOR(ACS_NODE);
      303    11815    1           OPEN_NODE.V.FUN#=%CREATE#;
      304    11816    1           CALL M$OPEN(OPEN_NODE) ALTRET(ERR_OUT);
      305    11817
      306    11818        /****
      307    11819        *
      308    11820        *   Greet the user.
      309    11821        *
      310    11822        ****/
      311    11823
      312    11824    1           CALL XUR$ERRMSG(%E$VWN_HITHER,,,VECTOR(B_VERSION));
      313    11825
      314    11826        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:10   
      315    11827        /****
      316    11828        *
      317    11829        *   Read commands from M$SI until END or EOF and parse them, then
      318    11830        *   go to the proper routine.
      319    11831        *
      320    11832        ****/
      321    11833
      322    11834    1   READ_COMMAND:
      323    11835    2           CALL XUR$GETCMD(VWN_COMMAND,BLK$,VECTOR(PROMPT)) WHENALTRETURN DO;
      324    11836    2              CALL XUR$ECHOIF(DCBNUM(M$DO));
      325    11837    2              IF P_PCB.HI_CHAR>0 THEN
      326    11838    2                 CALL XUR$ERRPTR(,DCBNUM(M$DO));
      327    11839    2              CALL XUR$ERRMSG(BLK$);
      328    11840    3              IF ADDR(BLK$)->ERR.MON THEN DO; /* #21743                          */
      329    11841    3                 FPT_EXIT.V.STEPCC#=6;
      330    11842    3                 CALL M$EXIT(FPT_EXIT);
      331    11843    3                 END;
      332    11844    2              GOTO READ_COMMAND;
      333    11845    2              END;
      334    11846    1           CALL XUR$ECHOIF(DCBNUM(M$LO));
      335    11847
      336    11848        /****
      337    11849        *
      338    11850        *   Do the proper routine based on the major command.
      339    11851        *
      340    11852        ****/
      341    11853
      342    11854    1           BLK$=P_PCB.OUT$->OUT$BLK.SUBLK$(0);
      343    11855    2           DO SELECT(OUT$BLK.CODE);
      344    11856
      345    11857        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:11   
      346    11858        /****
      347    11859        *
      348    11860        *   Process the IAM command:  Check for duplicates and stow it.
      349    11861        *
      350    11862        ****/
      351    11863
      352    11864    2              SELECT(%N_IAM#);
      353    11865    3              IF IAM~=' ' THEN DO;
      354    11866    3                 CALL XUR$ERRMSG(%E$VWN_DUPIAM);
      355    11867    3                 FPT_EXIT.V.STEPCC#=4;
      356    11868    3                 END;
      357    11869    3              ELSE DO;
      358    11870    3                 P=OUT$BLK.SUBLK$(0);
      359    11871    3                 CALL XLATE(IAM,B$XL_UPPER,P->OUT$SYM.TEXT);
      360    11872    3                 END;
      361    11873    2              GOTO READ_COMMAND;
      362    11874
      363    11875        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:12   
      364    11876        /****
      365    11877        *
      366    11878        *   Process the SYNON commands:  Write to :NODES to check for
      367    11879        *   duplicates.  Note that this will not alter an existing :NODES
      368    11880        *   file since the one being built is not cataloged until EOJ.
      369    11881        *
      370    11882        ****/
      371    11883
      372    11884    2              SELECT(%N_SYNON#);
      373    11885
      374    11886        /****
      375    11887        *
      376    11888        *   First fetch the node name and stow it in the record.
      377    11889        *
      378    11890        ****/
      379    11891
      380    11892    2              P=OUT$BLK.SUBLK$(0);
      381    11893    2              CALL XLATE(NODEREC,B$XL_UPPER,P->OUT$SYM.TEXT);
      382    11894
      383    11895        /****
      384    11896        *
      385    11897        *   Next fetch the node's synonym, which must not be the name of another node.
      386    11898        *
      387    11899        ****/
      388    11900
      389    11901    2              P=OUT$BLK.SUBLK$(1);
      390    11902    2              CALL XLATE(NODEKEY.C,B$XL_UPPER,P->OUT$SYM.TEXT);
      391    11903
      392    11904        /****
      393    11905        *
      394    11906        *   Synonym records are only 8 data bytes.  Write the "real" name of the node
      395    11907        *   keyed by the synonym.  Since ONEWKEY is (by default) NO, this write will
      396    11908        *   ALTRET if duplicate node/synonym already exists in the new file.
      397    11909        *
      398    11910        ****/
      399    11911
      400    11912    2              NODEKEY.L=8;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:13   
      401    11913    2              WRITE_NODE.BUF_.BOUND=7;
      402    11914    3              CALL M$WRITE(WRITE_NODE) WHENALTRETURN DO;
      403    11915    3                 CALL XUR$ERRMSG(%E$VWN_DUPSYN);
      404    11916    3                 FPT_EXIT.V.STEPCC#=4;
      405    11917    3                 END;
      406    11918    2              GOTO READ_COMMAND;
      407    11919
      408    11920        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:14   
      409    11921        /****
      410    11922        *
      411    11923        *   Process the NODE commands:  Check for duplicates, then stow the
      412    11924        *   node block in memory, along with its options.
      413    11925        *
      414    11926        ****/
      415    11927
      416    11928    2              SELECT(%N_NODE#);
      417    11929
      418    11930        /****
      419    11931        *
      420    11932        *   First, acquire enough additional memory to stow the node header and
      421    11933        *   all the path elements attached to this node.
      422    11934        *
      423    11935        ****/
      424    11936
      425    11937    3              DO WHILE(WDSLEFT<SIZEW(APATH)*(OUT$BLK.NSUBLKS-1)+SIZEW(ANODE));
      426    11938    3                 CALL M$GDS(FPT_GDS) ALTRET(ERR_MEM);
      427    11939    3                 WDSLEFT=WDSLEFT+1024;
      428    11940    3                 END;
      429    11941
      430    11942        /****
      431    11943        *
      432    11944        *   Initialize the node header to defaults:  TYPE=CP-6.
      433    11945        *
      434    11946        ****/
      435    11947
      436    11948    2              ANODE='0'B;
      437    11949    2              ANODE.TYPE=%N_TYPE#;
      438    11950
      439    11951        /****
      440    11952        *
      441    11953        *   Fetch the node's name.  Then walk through all the existing node
      442    11954        *   headers looking for duplicates.  Note that this doesn't check for
      443    11955        *   duplicates in the synonyms, which have already been written.
      444    11956        *
      445    11957        ****/
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:15   
      446    11958
      447    11959    2              P=OUT$BLK.SUBLK$(0);
      448    11960    2              CALL XLATE(ANODE.NAME,B$XL_UPPER,P->OUT$SYM.TEXT);
      449    11961
      450    11962    2              Q=VLP_VECTOR.PTR$;
      451    11963    3              DO WHILE(POFFW(NODEPTR,Q)~=0);
      452    11964    4                 IF ANODE.NAME=Q->ANODE.NAME THEN DO;
      453    11965    4                    CALL XUR$ERRMSG(%E$VWN_DUPNOD);
      454    11966    4                    FPT_EXIT.V.STEPCC#=4;
      455    11967    4                    GOTO READ_COMMAND;
      456    11968    4                    END;
      457    11969    3                 Q=PINCRW(Q,Q->ANODE.COUNT*SIZEW(APATH)+SIZEW(ANODE));
      458    11970    3                 END;
      459    11971
      460    11972        /****
      461    11973        *
      462    11974        *   Check for TYPE being specified.  If it is, stow it in the header.
      463    11975        *
      464    11976        ****/
      465    11977
      466    11978    2              I=1;
      467    11979    2              P=OUT$BLK.SUBLK$(1);
      468    11980    3              IF P->OUT$BLK.CODE~=%N_PATHELT# THEN DO;
      469    11981    3                 I=2;
      470    11982    3                 ANODE.TYPE=P->OUT$BLK.CODE;
      471    11983    3                 END;
      472    11984
      473    11985        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:16   
      474    11986        /****
      475    11987        *
      476    11988        *   Process each PATH sub-option, check to ensure that a node is
      477    11989        *   not connected to itself.
      478    11990        *
      479    11991        ****/
      480    11992
      481    11993    2              PATHPTR=PINCRW(PATHPTR,SIZEW(ANODE));
      482    11994    2              WDSLEFT=WDSLEFT-SIZEW(ANODE);
      483    11995
      484    11996        /****
      485    11997        *
      486    11998        *   Walk through each PATH sub-option.
      487    11999        *
      488    12000        ****/
      489    12001
      490    12002    3              DO WHILE(I<OUT$BLK.NSUBLKS);
      491    12003        /****
      492    12004        *  Check to see if path elements are given for EXTERNALly defined
      493    12005        *  nodes.  If so, it's an error
      494    12006        ****/
      495    12007    3                 IF(ANODE.TYPE = %N_EXTERNAL#) AND (OUT$BLK.NSUBLKS > 2)
      496    12008    4                 THEN DO;
      497    12009    4                    CALL XUR$ERRMSG(%E$VWN_NOPATHS);
      498    12010    4                    FPT_EXIT.V.STEPCC# = 4;
      499    12011    4                    GOTO READ_COMMAND;
      500    12012    4                    END;                   /* if external node and path is given */
      501    12013    3                 P=OUT$BLK.SUBLK$(I);
      502    12014
      503    12015        /****
      504    12016        *
      505    12017        *   Initialize this path element to its defaults:  DIALUP, 2400 baud.
      506    12018        *
      507    12019        ****/
      508    12020
      509    12021    3                 APATH='0'B;
      510    12022    3                 APATH.MODE=%N_DIALUP#;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:17   
      511    12023    3                 APATH.SPEED=5;
      512    12024    3                 APATH.NAME = ' ';
      513    12025    3                 APATH.ACCT = ' ';
      514    12026
      515    12027        /****
      516    12028        *
      517    12029        *   Fetch the path name (WSN) or directory account and stow it.
      518    12030        *
      519    12031        ****/
      520    12032
      521    12033    3                 Q=P->OUT$BLK.SUBLK$(0);
      522    12034    4                 DO CASE (Q->OUT$BLK.CODE);
      523    12035    4                  CASE (%N_PATHNAME#);
      524    12036    4                    CALL XLATE(APATH.NAME,B$XL_UPPER,Q->OUT$SYM.TEXT);
      525    12037    4                  CASE (%N_DIRECTORY#);
      526    12038    4                    CALL XLATE(APATH.ACCT,B$XL_UPPER,Q->OUT$SYM.TEXT);
      527    12039    4                  END;
      528    12040
      529    12041        /****
      530    12042        *
      531    12043        *   Now fetch the name of the node found at the end of this path and stow it.
      532    12044        *
      533    12045        ****/
      534    12046
      535    12047    3                 Q=P->OUT$BLK.SUBLK$(1);
      536    12048    3                 CALL XLATE(APATH.DEST,B$XL_UPPER,Q->OUT$SYM.TEXT);
      537    12049
      538    12050        /****
      539    12051        *
      540    12052        *   Make sure we're not connected to ourself.
      541    12053        *
      542    12054        ****/
      543    12055
      544    12056    4                 IF ANODE.NAME=APATH.DEST THEN DO;
      545    12057    4                    CALL XUR$ERRMSG(%E$VWN_INCEST);
      546    12058    4                    FPT_EXIT.V.STEPCC#=4;
      547    12059    4                    END;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:18   
      548    12060
      549    12061        /****
      550    12062        *
      551    12063        *   Now check for a baud rate/connection mode specification, which may be
      552    12064        *   entered in any order (or omitted).
      553    12065        *
      554    12066        ****/
      555    12067
      556    12068    4                 ELSE DO;
      557    12069    5                    IF P->OUT$BLK.NSUBLKS>2 THEN DO;
      558    12070    5                       Q=P->OUT$BLK.SUBLK$(2);
      559    12071
      560    12072        /****
      561    12073        *
      562    12074        *   Speed is a decimal integer <9 digits (wow!).  Presumably it is a
      563    12075        *   reasonable value such as 2400, 4800, etc.; however, this code allows
      564    12076        *   any value <1,000,000,000 to be specified.  The speed is encoded in
      565    12077        *   the file as a power of two:  0 indicates 75 baud or less (ugh!), 1 is
      566    12078        *   76-150 baud, 2 is 151-300 baud, 3 is 301-600 baud, etc.  Obviously,
      567    12079        *   then the speed is only an approximation, but that's all it's good for
      568    12080        *   anyway.
      569    12081        *
      570    12082        ****/
      571    12083
      572    12084    6                       IF Q->OUT$BLK.CODE>=%N_SPEED# THEN DO;
      573    12085    6                          CALL CHARBIN(J,Q->OUT$SYM.TEXT);
      574    12086    6                          APATH.SPEED=0;
      575    12087    7                          DO WHILE(J>75);
      576    12088    7                             J=J/2;
      577    12089    7                             APATH.SPEED=APATH.SPEED+1;
      578    12090    7                             END;
      579    12091    6                          END;
      580    12092
      581    12093        /****
      582    12094        *
      583    12095        *   If this is hardwire/dialup, just stow it.
      584    12096        *
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:19   
      585    12097        ****/
      586    12098
      587    12099    5                       ELSE
      588    12100    5                          APATH.MODE=Q->OUT$BLK.CODE;
      589    12101    5                       END;
      590    12102
      591    12103        /****
      592    12104        *
      593    12105        *   If both speed and mode were specified, process the other option.
      594    12106        *
      595    12107        ****/
      596    12108
      597    12109    5                    IF P->OUT$BLK.NSUBLKS>3 THEN DO;
      598    12110    5                       Q=P->OUT$BLK.SUBLK$(3);
      599    12111    6                       IF Q->OUT$BLK.CODE>=%N_SPEED# THEN DO;
      600    12112    6                          CALL CHARBIN(J,Q->OUT$SYM.TEXT);
      601    12113    6                          APATH.SPEED=0;
      602    12114    7                          DO WHILE(J>75);
      603    12115    7                             J=J/2;
      604    12116    7                             APATH.SPEED=APATH.SPEED+1;
      605    12117    7                             END;
      606    12118    6                          END;
      607    12119    5                       ELSE
      608    12120    5                          APATH.MODE=Q->OUT$BLK.CODE;
      609    12121    5                       END;
      610    12122
      611    12123        /****
      612    12124        *
      613    12125        *   Tally another path element attached to this node and move on.
      614    12126        *
      615    12127        ****/
      616    12128
      617    12129    4                    ANODE.COUNT=ANODE.COUNT+1;
      618    12130    4                    PATHPTR=PINCRW(PATHPTR,SIZEW(APATH));
      619    12131    4                    WDSLEFT=WDSLEFT-SIZEW(APATH);
      620    12132
      621    12133    4                    END;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:20   
      622    12134    3                 I=I+1;
      623    12135
      624    12136    3                 END /* of path suboption loop */;
      625    12137
      626    12138        /****
      627    12139        *
      628    12140        *   Point to more freespace and count another node processed.
      629    12141        *
      630    12142        ****/
      631    12143
      632    12144    2              NODEPTR=PATHPTR;
      633    12145    2              NODECNT=NODECNT+1;
      634    12146    2              GOTO READ_COMMAND;
      635    12147
      636    12148        /****
      637    12149        *
      638    12150        *   We were unable to expand memory to hold all the tables.
      639    12151        *
      640    12152        ****/
      641    12153
      642    12154    2   ERR_MEM:
      643    12155    2              CALL XUR$ERRMSG(%E$VWN_OUTMEM);
      644    12156    2              FPT_EXIT.V.STEPCC#=4;
      645    12157    2              CALL M$EXIT(FPT_EXIT);
      646    12158
      647    12159        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:21   
      648    12160        /****
      649    12161        *
      650    12162        *   Do END processing.  Check that IAM and at least one NODE command
      651    12163        *   have been entered; then sequentially read the :NODES file we
      652    12164        *   have open for the synonym records to ensure that each of them is
      653    12165        *   defined by a NODE command (in memory).
      654    12166        *
      655    12167        ****/
      656    12168
      657    12169    2              SELECT(%N_END#);
      658    12170
      659    12171        /****
      660    12172        *
      661    12173        *   Is IAM defined?  We must know our identity.
      662    12174        *
      663    12175        ****/
      664    12176
      665    12177    3              IF IAM=' ' THEN DO;
      666    12178    3                 CALL XUR$ERRMSG(%E$VWN_WHOAMI);
      667    12179    3                 FPT_EXIT.V.STEPCC#=4;
      668    12180    3                 END;
      669    12181
      670    12182        /****
      671    12183        *
      672    12184        *   We must also be connected to someone else, otherwise this is a
      673    12185        *   nowhere network.
      674    12186        *
      675    12187        ****/
      676    12188
      677    12189    3              IF NODECNT=0 THEN DO;
      678    12190    3                 CALL XUR$ERRMSG(%E$VWN_NONODE);
      679    12191    3                 FPT_EXIT.V.STEPCC#=4;
      680    12192    3                 CALL M$EXIT(FPT_EXIT);
      681    12193    3                 END;
      682    12194
      683    12195        /****
      684    12196        *
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:22   
      685    12197        *   Rewind the :NODES file and read it sequentially.  Then compare the
      686    12198        *   data portion (which is a node name) to the nodes defined in memory
      687    12199        *   to ensure that all the synonyms define real nodes.
      688    12200        *
      689    12201        ****/
      690    12202
      691    12203    2              CALL M$PFIL(PFIL_NODE);
      692    12204    3              DO WHILE('1'B);
      693    12205    3                 CALL M$READ(READ_SEQUEN) ALTRET(EOF_SYNON);
      694    12206    3                 P=VLP_VECTOR.PTR$;
      695    12207    4                 DO WHILE(POFFW(NODEPTR,P)~=0);
      696    12208    4                    IF NODEREC=P->ANODE.NAME THEN
      697    12209    4                       GOTO YES_SYNON;
      698    12210    4                    P=PINCRW(P,P->ANODE.COUNT*SIZEW(APATH)+SIZEW(ANODE));
      699    12211    4                    END;
      700    12212
      701    12213        /****
      702    12214        *
      703    12215        *   If we fall off the end of the list, this node is undefined.
      704    12216        *
      705    12217        ****/
      706    12218
      707    12219    3                 CALL INDEX(I,' ',NODEREC,0);
      708    12220    3                 U1.L=I;
      709    12221    3                 U1.C=SUBSTR(NODEREC,0,I);
      710    12222    3                 CALL XUR$ERRMSG(%E$VWN_UNDNOD,,,VECTOR(U1));
      711    12223    3                 FPT_EXIT.V.STEPCC#=4;
      712    12224
      713    12225        /****
      714    12226        *
      715    12227        *   This synonym is properly defined.
      716    12228        *
      717    12229        ****/
      718    12230
      719    12231    3   YES_SYNON:    ;
      720    12232    3                 END;
      721    12233
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:23   
      722    12234        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:24   
      723    12235        /****
      724    12236        *
      725    12237        *   Verify that all the destination nodes have been defined.  Do this by
      726    12238        *   walking through all the node path sub-options and making sure that a
      727    12239        *   node header exists by the name specified.
      728    12240        *
      729    12241        ****/
      730    12242
      731    12243    2   EOF_SYNON:
      732    12244    2              P=VLP_VECTOR.PTR$;
      733    12245
      734    12246        /****
      735    12247        *
      736    12248        *   NODEPTR marks the beginning of freespace, so it also marks the end
      737    12249        *   of the memory tables.
      738    12250        *
      739    12251        ****/
      740    12252
      741    12253    3              DO WHILE(POFFW(NODEPTR,P)~=0);
      742    12254
      743    12255        /****
      744    12256        *
      745    12257        *   Pick up the pointer to the IAM node on the way.  We'll use this later.
      746    12258        *
      747    12259        ****/
      748    12260
      749    12261    3                 IF IAM=P->ANODE.NAME THEN
      750    12262    3                    IAMPTR=P;
      751    12263
      752    12264        /****
      753    12265        *
      754    12266        *   Point to the path sub-option list for this node, then walk through it
      755    12267        *   comparing the node names to all the node names in memory until a match
      756    12268        *   is found.
      757    12269        *
      758    12270        ****/
      759    12271
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:25   
      760    12272    3                 Q=PINCRW(P,SIZEW(ANODE));
      761    12273    3                 I=0;
      762    12274    4                 DO WHILE(I<P->ANODE.COUNT);
      763    12275    4                    R=VLP_VECTOR.PTR$;
      764    12276    5                    DO WHILE(POFFW(NODEPTR,R)~=0);
      765    12277    5                       IF R->ANODE.NAME=Q->APATH.DEST THEN
      766    12278    5                          GOTO YES_DEST;
      767    12279    5                       R=PINCRW(R,R->ANODE.COUNT*SIZEW(APATH)+SIZEW(ANODE));
      768    12280    5                       END;
      769    12281
      770    12282        /****
      771    12283        *
      772    12284        *   If we fall off the end of the list, this node isn't defined.
      773    12285        *
      774    12286        ****/
      775    12287
      776    12288    4                    CALL INDEX(J,' ',Q->APATH.DEST,0);
      777    12289    4                    U1.L=J;
      778    12290    4                    U1.C=SUBSTR(Q->APATH.DEST,0,J);
      779    12291    4                    CALL XUR$ERRMSG(%E$VWN_UNDNOD,,,VECTOR(U1));
      780    12292    4                    FPT_EXIT.V.STEPCC#=4;
      781    12293
      782    12294        /****
      783    12295        *
      784    12296        *   Check to ensure that the path type matches the type of the destination
      785    12297        *   node.  Paths to EXTERNAL nodes must be via disk directories, and paths
      786    12298        *   to non-EXTERNAL must not be.
      787    12299        *
      788    12300        ****/
      789    12301    4   YES_DEST:
      790    12302    4                    IF Q -> APATH.ACCT = ' '
      791    12303    4                      AND R -> ANODE.TYPE = %N_EXTERNAL#
      792    12304    5                    THEN DO;
      793    12305    5                       CALL INDEX (J, ' ', P -> ANODE.NAME);
      794    12306    5                       U1.L = J;
      795    12307    5                       U1.C = P -> ANODE.NAME;
      796    12308    5                       CALL INDEX (J, ' ', R -> ANODE.NAME);
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:26   
      797    12309    5                       U2.L = J;
      798    12310    5                       U2.C = R -> ANODE.NAME;
      799    12311    5                       CALL XUR$ERRMSG (%E$VWN_ISEXTERNAL,,,VECTOR(U2),VECTOR(U1));
      800    12312    5                       FPT_EXIT.V.STEPCC#=4;
      801    12313    5                       Q -> APATH.ACCT = 'BLORTCH!';
      802    12314    5                       END;
      803    12315    4                    IF Q -> APATH.ACCT ~= ' '
      804    12316    4                      AND R -> ANODE.TYPE ~= %N_EXTERNAL#
      805    12317    5                    THEN DO;
      806    12318    5                       CALL INDEX (J, ' ', P -> ANODE.NAME);
      807    12319    5                       U1.L = J;
      808    12320    5                       U1.C = P -> ANODE.NAME;
      809    12321    5                       CALL INDEX (J, ' ', R -> ANODE.NAME);
      810    12322    5                       U2.L = J;
      811    12323    5                       U2.C = R -> ANODE.NAME;
      812    12324    5                       CALL XUR$ERRMSG (%E$VWN_NOTEXTERNAL,,,VECTOR(U1),VECTOR(U2));
      813    12325    5                       FPT_EXIT.V.STEPCC#=4;
      814    12326    5                       R=ADDR(NIL);
      815    12327    5                       Q -> APATH.ACCT = ' ';
      816    12328    5                       END;
      817    12329
      818    12330        /****
      819    12331        *
      820    12332        *   This path is properly defined, move on to the next one.  Build a chain
      821    12333        *   of nodes through memory to save searching for them again later.
      822    12334        *
      823    12335        ****/
      824    12336
      825    12337    4                    Q->APATH.PTR$=R;
      826    12338    4                    I=I+1;
      827    12339    4                    Q=PINCRW(Q,SIZEW(APATH));
      828    12340    4                    END;
      829    12341
      830    12342        /****
      831    12343        *
      832    12344        *   Move on to the next node header.
      833    12345        *
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:27   
      834    12346        ****/
      835    12347
      836    12348    3                 P=Q;
      837    12349    3                 END;
      838    12350
      839    12351        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:28   
      840    12352        /****
      841    12353        *
      842    12354        *   Verify that the IAM command has been entered; if so, we have
      843    12355        *   passed all the validity checks.  Write the *IAM record to the
      844    12356        *   file and start the path report/node building process.
      845    12357        *
      846    12358        ****/
      847    12359
      848    12360    3              IF IAMPTR=ADDR(NIL) THEN DO;
      849    12361    3                 CALL XUR$ERRMSG(%E$VWN_IAMUND);
      850    12362    3                 FPT_EXIT.V.STEPCC#=4;
      851    12363    3                 END;
      852    12364
      853    12365        /****
      854    12366        *
      855    12367        *   If errors have occurred, don't process farther, since we're likely
      856    12368        *   to get all bolixed up trying to trace paths to non-existent nodes.
      857    12369        *
      858    12370        ****/
      859    12371
      860    12372    3              IF FPT_EXIT.V.STEPCC#>0 THEN DO;
      861    12373    3                 CALL XUR$ERRMSG(%E$VWN_GIVEUP);
      862    12374    3                 CALL M$EXIT(FPT_EXIT);
      863    12375    3                 END;
      864    12376
      865    12377        /****
      866    12378        *
      867    12379        *   Write the *IAM synonym record and its companion, LOCAL.
      868    12380        *
      869    12381        ****/
      870    12382
      871    12383    2              NODEKEY.C='*IAM';
      872    12384    2              NODEKEY.L=8;
      873    12385    2              NODEREC=IAM;
      874    12386    2              WRITE_NODE.BUF_.BOUND=7;
      875    12387    2              CALL M$WRITE(WRITE_NODE) ALTRET(ERR_OUT);
      876    12388    2              NODEKEY.C='LOCAL';
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:29   
      877    12389    2              CALL M$WRITE(WRITE_NODE) ALTRET(ERR_OUT);
      878    12390
      879    12391        /****
      880    12392        *
      881    12393        *   That's all we write for this node, so flag it as done.
      882    12394        *
      883    12395        ****/
      884    12396
      885    12397    2              IAMPTR->ANODE.DONE='1'B;
      886    12398    2              NODECNT=NODECNT-1;
      887    12399
      888    12400        /****
      889    12401        *
      890    12402        *   Print out the report header.
      891    12403        *
      892    12404        ****/
      893    12405
      894    12406    2              CALL INDEX(I,' ',IAM,0);
      895    12407    2              U1.L=I;
      896    12408    2              U1.C=SUBSTR(IAM,0,I);
      897    12409    2              CALL XUR$ERRMSG(%E$VWN_PTHLN1,,DCBNUM(M$LO),VECTOR(U1));
      898    12410
      899    12411        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:30   
      900    12412        /****
      901    12413        *
      902    12414        *   Creating the :NODES records involves chasing paths from the top
      903    12415        *   (IAM) node through the PATH sub-records until the desired level
      904    12416        *   (MAXLVL) is reached.  If the node at MAXLVL is not flagged as
      905    12417        *   "DONE", this (chain of) path(s) is the shortest distance from
      906    12418        *   IAM to this node.  Only the first path in the chain is written
      907    12419        *   to the :NODES file, since it is assumed that the node at the end
      908    12420        *   of that path knows the name of the next path, etc.  The path
      909    12421        *   chains are run from MAXLVL=1 to the depth necessary to find a
      910    12422        *   path to all the nodes defined, up to a maximum of MAXLVL=63.
      911    12423        *
      912    12424        ****/
      913    12425
      914    12426    2              MAXLVL=1;
      915    12427
      916    12428        /****
      917    12429        *
      918    12430        *   When the node count reaches 0, we have located paths to all the
      919    12431        *   nodes defined.
      920    12432        *
      921    12433        ****/
      922    12434
      923    12435    3              DO WHILE(NODECNT>0);
      924    12436    3                 LVL=0;
      925    12437    3                 P=IAMPTR;
      926    12438
      927    12439        /****
      928    12440        *
      929    12441        *   When we reach a node, mark it as "visited".  Since the network is
      930    12442        *   rarely a nice tree (more like a bush), this stops us from going
      931    12443        *   around in circles.  If we encounter a visited node on the way down,
      932    12444        *   there's no point in going further, since we've already been here.
      933    12445        *
      934    12446        ****/
      935    12447
      936    12448    3   PUSH:
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:31   
      937    12449    3                 P->ANODE.VISIT='1'B;
      938    12450
      939    12451        /****
      940    12452        *
      941    12453        *   Walk down MAXLVL steps via each path.
      942    12454        *
      943    12455        ****/
      944    12456
      945    12457    3                 I=0;
      946    12458    4                 DO WHILE(I<P->ANODE.COUNT);
      947    12459
      948    12460        /****
      949    12461        *
      950    12462        *   Record the path information (a pointer to the header and the
      951    12463        *   offset (index) to the path) at this level.
      952    12464        *
      953    12465        ****/
      954    12466
      955    12467    4                    Q=PINCRW(P,I*SIZEW(APATH)+SIZEW(ANODE));
      956    12468    4                    PTR$(LVL)=P;
      957    12469    4                    IDX(LVL)=I;
      958    12470    4                    LVL=LVL+1;
      959    12471
      960    12472        /****
      961    12473        *
      962    12474        *   See if we need to go farther down.  If so, and if we haven't been here
      963    12475        *   already (VISIT='0'B), simulate recursion.  A recursive routine would
      964    12476        *   probably be more elegant, but it is also somewhat harder to debug and
      965    12477        *   maintain.
      966    12478        *
      967    12479        ****/
      968    12480
      969    12481    5                    IF LVL<MAXLVL THEN DO;
      970    12482    6                       IF Q->APATH.PTR$->ANODE.VISIT='0'B THEN DO;
      971    12483    6                          P=Q->APATH.PTR$;
      972    12484    6                          GOTO PUSH;
      973    12485    6                          END;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:32   
      974    12486    5                       LVL=LVL-1;
      975    12487    5                       GOTO PULL;
      976    12488    5                       END;
      977    12489
      978    12490        /****
      979    12491        *
      980    12492        *   We have reached the desired level in our travels.  Now look around
      981    12493        *   and see if this node has been recorded (DONE='0'B).  If it hasn't,
      982    12494        *   write the path information to :NODES and print the entire path on
      983    12495        *   the path report.  Note that only the first step in the path is
      984    12496        *   recorded in the :NODES file.
      985    12497        *
      986    12498        ****/
      987    12499
      988    12500    4                    LVL=LVL-1;
      989    12501    4                    R=Q->APATH.PTR$;
      990    12502    5                    IF R->ANODE.DONE='0'B THEN DO;
      991    12503
      992    12504        /****
      993    12505        *
      994    12506        *   Define this node and count another node done.
      995    12507        *
      996    12508        ****/
      997    12509
      998    12510    5                       R->ANODE.DONE='1'B;
      999    12511    5                       NODECNT=NODECNT-1;
     1000    12512
     1001    12513        /****
     1002    12514        *
     1003    12515        *   Build the :NODES record.  They key is the name of the node, not the
     1004    12516        *   path.  The path name in the record is the name of the first path
     1005    12517        *   (WSN) towards this node, and the node name in the record is the name
     1006    12518        *   of the node found at the end of the first path.  We also record the
     1007    12519        *   type of the final node, so we can tell what is legal to send to this
     1008    12520        *   node, and the type of the node at the end of the first step, so we
     1009    12521        *   can determine what JCL is needed.  We calculate the time for one
     1010    12522        *   granule to traverse all the steps by adding up the times for each
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:33   
     1011    12523        *   individual step.
     1012    12524        *
     1013    12525        ****/
     1014    12526
     1015    12527    5                       NODEKEY.C=Q->APATH.DEST;
     1016    12528    5                       R=PINCRW(PTR$(0),IDX(0)*SIZEW(APATH)+SIZEW(ANODE));
     1017    12529    5                       DIRECTORY_NODE = IAM;
     1018    12530
     1019    12531        /****
     1020    12532        *
     1021    12533        *   Slug in the path information.  TOT_TIME is initialized to zero and will be
     1022    12534        *   filled in as we walk across the chain of paths.
     1023    12535        *
     1024    12536        ****/
     1025    12537
     1026    12538    5                       NODEOVR.PATH_NAME = R -> APATH.NAME;
     1027    12539    5                       NODEOVR.NODE_NAME = R -> APATH.DEST;
     1028    12540    5                       NODEOVR.TYPE_DEST=Q->APATH.PTR$->ANODE.TYPE;
     1029    12541    5                       NODEOVR.TYPE_PATH=R->APATH.PTR$->ANODE.TYPE;
     1030    12542    5                       TOT_TIME=0;
     1031    12543
     1032    12544        /****
     1033    12545        *
     1034    12546        *   Print the header for this node
     1035    12547        *
     1036    12548        ****/
     1037    12549
     1038    12550    5                       CALL INDEX1(J,' ',NODEKEY.C,0);
     1039    12551    5                       K=MAXIMUM(0,NODEOVR.TYPE_DEST-%N_TYPE#);
     1040    12552    5                       U1.L=J;
     1041    12553    5                       U1.C=SUBSTR(NODEKEY.C,0,J);
     1042    12554    5                       U2.L=TYPE.L(K);
     1043    12555    5                       U2.C=SUBSTR(TYPE.C(K),0,TYPE.L(K));
     1044    12556    5                       CALL XUR$ERRMSG(%E$VWN_PTHLN2,,DCBNUM(M$LO),VECTOR(U1),
     1045    12557    5                         VECTOR(U2));
     1046    12558
     1047    12559        /****
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:34   
     1048    12560        *
     1049    12561        *   Now walk down the path from *IAM to this node.  We clear the VISIT bit
     1050    12562        *   at each level (for housecleaning), then print the report.  Also compute
     1051    12563        *   the time for one granule's transit (wildly fudged).
     1052    12564        *
     1053    12565        ****/
     1054    12566
     1055    12567    5                       J=0;
     1056    12568    6                       DO WHILE(J<=LVL);
     1057    12569    6                          PTR$(J)->ANODE.VISIT='0'B;
     1058    12570    6                          R=PINCRW(PTR$(J),IDX(J)*SIZEW(APATH)+SIZEW(ANODE));
     1059    12571
     1060    12572        /****
     1061    12573        *
     1062    12574        *   Print the name of the path and the node name at the end of that path.
     1063    12575        *
     1064    12576        ****/
     1065    12577
     1066    12578    6                          CALL INDEX1(K,' ',R->APATH.NAME,0);
     1067    12579    6                          CALL INDEX1(L,' ',R->APATH.DEST,0);
     1068    12580    6                          U1.L=K;
     1069    12581    6                          U1.C=SUBSTR(R->APATH.NAME,0,K);
     1070    12582    6                          U2.L=L;
     1071    12583    6                          U2.C=SUBSTR(R->APATH.DEST,0,L);
     1072    12584    6                          IF R -> APATH.PTR$ -> ANODE.TYPE = %N_EXTERNAL#
     1073    12585    7                          THEN DO;
     1074    12586
     1075    12587                                           /* output the account if node is external  */
     1076    12588    7                             CALL INDEX1(K,' ',R->APATH.ACCT,0);
     1077    12589    7                             U1.L = K;
     1078    12590    7                             U1.C = SUBSTR(R->APATH.ACCT,0,K);
     1079    12591
     1080    12592    7                             CALL XUR$ERRMSG(%E$VWN_EXTERNAL,,DCBNUM(M$LO),
     1081    12593    7                               VECTOR(U1),VECTOR(U2));
     1082    12594
     1083    12595    7                             NODEOVR.ACCT = R -> APATH.ACCT;
     1084    12596    7                             NODEOVR.NODE_NAME = DIRECTORY_NODE;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:35   
     1085    12597
     1086    12598    7                             GOTO NEXT_STEP;
     1087    12599
     1088    12600    7                             END;
     1089    12601
     1090    12602    6                          ELSE
     1091    12603    6                             CALL XUR$ERRMSG(%E$VWN_PTHLN3,,DCBNUM(M$LO),
     1092    12604    6                               VECTOR(U1),VECTOR(U2));
     1093    12605
     1094    12606        /****
     1095    12607        *
     1096    12608        *   Recompute the speed.  This is only approximate for weird baud rates.
     1097    12609        *
     1098    12610        ****/
     1099    12611
     1100    12612    6                          K=R->APATH.SPEED;
     1101    12613    6                          L=75;
     1102    12614    7                          DO WHILE(K>0);
     1103    12615    7                             L=L*2;
     1104    12616    7                             K=K-1;
     1105    12617    7                             END;
     1106    12618    6                          CALL BINCHAR(HOLD,L);
     1107    12619    6                          K=0;
     1108    12620    7                          DO WHILE(SUBSTR(HOLD,K,1)='0');
     1109    12621    7                             K=K+1;
     1110    12622    7                             END;
     1111    12623    6                          U2.C=SUBSTR(HOLD,K,8-K);
     1112    12624    6                          U2.L=8-K;
     1113    12625
     1114    12626        /****
     1115    12627        *
     1116    12628        *   Slug in "hardwire" or "dialup".
     1117    12629        *
     1118    12630        ****/
     1119    12631
     1120    12632    6                          K=MAXIMUM(0,R->APATH.MODE-%N_DIALUP#);
     1121    12633    6                          U1.L=MODE.L(K);
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:36   
     1122    12634    6                          U1.C=SUBSTR(MODE.C(K),0,MODE.L(K));
     1123    12635
     1124    12636        /****
     1125    12637        *
     1126    12638        *   Print the speed and connection mode.
     1127    12639        *
     1128    12640        ****/
     1129    12641
     1130    12642    6                          CALL XUR$ERRMSG(%E$VWN_PTHLN4,,DCBNUM(M$LO),VECTOR(U1),
     1131    12643    6                            VECTOR(U2));
     1132    12644
     1133    12645        /****
     1134    12646        *
     1135    12647        *   Compute the approximate transit time for one granule (L is the approximate
     1136    12648        *   baud rate computed above).
     1137    12649        *
     1138    12650        *       4096 bytes/granule * 8 bits/byte / L bits/second = N seconds/granule
     1139    12651        *
     1140    12652        *   Multiply this by 10 (for tenths of seconds) and add a fudge factor of
     1141    12653        *   50% overhead (wow!) plus another second per granule.  This stuff is only
     1142    12654        *   approximate anyway.
     1143    12655        *
     1144    12656        ****/
     1145    12657
     1146    12658    6                          TOT_TIME=TOT_TIME+(4096*8*10*3/2)/L+10;
     1147    12659
     1148    12660        /****
     1149    12661        *
     1150    12662        *   Remember the name of the node we've just reached, so that if the final
     1151    12663        *   destination is an external node we can record the last non-external
     1152    12664        *   node's name in the external-node record.
     1153    12665        */
     1154    12666
     1155    12667    6                          DIRECTORY_NODE = R -> APATH.DEST;
     1156    12668
     1157    12669        /****
     1158    12670        *
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:37   
     1159    12671        *   Move on to the next step.
     1160    12672        *
     1161    12673        ****/
     1162    12674
     1163    12675    6   NEXT_STEP:
     1164    12676    6                          J=J+1;
     1165    12677    6                          END;
     1166    12678
     1167    12679        /****
     1168    12680        *
     1169    12681        *   Slug in the accumulated time/granule, then print it.
     1170    12682        *
     1171    12683        ****/
     1172    12684
     1173    12685    5                       NODEOVR.TIME=TOT_TIME;
     1174    12686    5                       CALL BINCHAR(HOLD,TOT_TIME);
     1175    12687    5                       J=0;
     1176    12688    6                       DO WHILE(J<6 AND SUBSTR(HOLD,J,1)='0');
     1177    12689    6                          J=J+1;
     1178    12690    6                          END;
     1179    12691    5                       U1.L=7-J;
     1180    12692    5                       U1.C=SUBSTR(HOLD,J,7-J);
     1181    12693    5                       U2.L=1;
     1182    12694    5                       U2.C=SUBSTR(HOLD,7,1);
     1183    12695    5                       CALL XUR$ERRMSG(%E$VWN_PTHLN5,,DCBNUM(M$LO),VECTOR(U1),
     1184    12696    5                         VECTOR(U2));
     1185    12697
     1186    12698        /****
     1187    12699        *
     1188    12700        *   Finally!  Write this node definition to the file.
     1189    12701        *
     1190    12702        ****/
     1191    12703
     1192    12704    5                       WRITE_NODE.BUF_.BOUND=21;
     1193    12705    5                       CALL M$WRITE(WRITE_NODE) ALTRET(ERR_OUT);
     1194    12706
     1195    12707        /****
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:38   
     1196    12708        *
     1197    12709        *   Stop if we're done.
     1198    12710        *
     1199    12711        ****/
     1200    12712
     1201    12713    5                       IF NODECNT<=0 THEN
     1202    12714    5                          GOTO FILE_BUILT;
     1203    12715    5                       END;
     1204    12716
     1205    12717    4   PULL:
     1206    12718    4                    I=I+1;
     1207    12719    4                    END;
     1208    12720
     1209    12721        /****
     1210    12722        *
     1211    12723        *   Go back up a level, across one (if possible) and down to MAXLVL again.
     1212    12724        *
     1213    12725        ****/
     1214    12726
     1215    12727    3                 LVL=LVL-1;
     1216    12728    4                 IF LVL>=0 THEN DO;
     1217    12729    4                    P=PTR$(LVL);
     1218    12730    4                    I=IDX(LVL);
     1219    12731    4                    GOTO PULL;
     1220    12732    4                    END;
     1221    12733
     1222    12734        /****
     1223    12735        *
     1224    12736        *   All the nodes at this level have been located.  Move on to the next
     1225    12737        *   level, but don't do more than 63 levels.  If the network is bigger
     1226    12738        *   than this, some nodes are unreachable or you need another system.
     1227    12739        *
     1228    12740        ****/
     1229    12741
     1230    12742    3                 MAXLVL=MAXLVL+1;
     1231    12743    3                 IF MAXLVL>63 THEN
     1232    12744    3                    GOTO INACCESSIBLE;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:39   
     1233    12745    3                 END;
     1234    12746
     1235    12747    2              END;
     1236    12748
     1237    12749        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:40   
     1238    12750        /****
     1239    12751        *
     1240    12752        *   All nodes have been defined; close files and go to EOJ.
     1241    12753        *
     1242    12754        ****/
     1243    12755
     1244    12756    1   FILE_BUILT:
     1245    12757    1           CALL M$CLOSE(CLOSE_NODE);
     1246    12758    1           CALL XUR$CLOSE_DCBS;
     1247    12759    1           CALL M$EXIT(FPT_EXIT);
     1248    12760
     1249    12761        /****
     1250    12762        *
     1251    12763        *   We couldn't reach one or more nodes in 63 steps.  Flag these guys
     1252    12764        *   as inaccessible and abort the build.
     1253    12765        *
     1254    12766        ****/
     1255    12767
     1256    12768    1   INACCESSIBLE:
     1257    12769    1           P=VLP_VECTOR.PTR$;
     1258    12770    2           DO WHILE(POFFW(NODEPTR,P)~=0);
     1259    12771    3              IF P->ANODE.DONE='0'B THEN DO;
     1260    12772    3                 CALL INDEX(I,' ',P->ANODE.NAME);
     1261    12773    3                 U1.L=I;
     1262    12774    3                 U1.C=SUBSTR(P->ANODE.NAME,0,I);
     1263    12775    3                 CALL XUR$ERRMSG(%E$VWN_CANTGO,,,VECTOR(U1));
     1264    12776    3                 END;
     1265    12777    2              P=PINCRW(P,SIZEW(ANODE)+P->ANODE.COUNT*SIZEW(APATH));
     1266    12778    2              END;
     1267    12779    1           GOTO FILE_BUILT;
     1268    12780
     1269    12781        /****
     1270    12782        *
     1271    12783        *   Something happened trying to write the output file.  Abort!
     1272    12784        *
     1273    12785        ****/
     1274    12786
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:41   
     1275    12787    1   ERR_OUT:
     1276    12788    1           CALL XUR$ERRMSG(B$TCB$->B$TCB.ALT$->B$ALT.ERR,DCBNUM(M$NODE));
     1277    12789    1           FPT_EXIT.V.STEPCC#=4;
     1278    12790    1           CALL M$EXIT(FPT_EXIT);
     1279    12791
     1280    12792    1   END;

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:42   
--  Include file information  --

   VW_FPTS_M.:VMB6TOU  cannot be made into a system file and is referenced.
   VWN_ERRS_E.:VMB6TOU  is referenced.
   VW_NODEATER_E.:VMB6TOU  is referenced.
   XUR_ENTRY.:LIB_E05  cannot be made into a system file and is referenced.
   XUH_MACRO_C.:LIB_E05  is referenced.
   XU_MACRO_C.:LIB_E05  is referenced.
   B$TABLES_C.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VWN$NODEATER.

   Procedure VWN$NODEATER requires 1264 words for executable code.
   Procedure VWN$NODEATER is declared NOAUTO and requires 486 words of local(STATIC) storage.

    No errors detected in file VWN$NODEATER.:VMB6TSI    .

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:43   

 Object Unit name= VWN$NODEATER                               File name= VWN$NODEATER.:VMB6TOU
 UTS= AUG 20 '97 15:46:17.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none   486    746  VWN$NODEATER
    1   DCB   even  none     0      0  M$UC
    2  RtLbCm even  none     2      2  ACCT_NODE
    3  RoData even  UTS     49     61  VWN$NODEATER
    4   DCB   even  none     0      0  M$SI
    5   DCB   even  none     0      0  M$LO
    6   DCB   even  none     0      0  M$NODE
    7   DCB   even  none     0      0  M$DO
    8   Proc  even  none  1264   2360  VWN$NODEATER
    9  RoData even  none    80    120  VWN$NODEATER

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     8      0   yes            yes      Main       0  VWN$NODEATER

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0    274  P_PCB
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:44   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
 yes     yes           Std       6 XUR$GETCMD
 yes     yes           Std       2 XTX$ADAPT
 yes     yes           Std       4 XUR$SETDCBS
         yes           Std       2 XUR$CLOSE_DCBS
 yes     yes           Std       1 XUR$ECHOIF
 yes     yes           Std       3 XUR$INIT
 yes     yes           Std       1 XUR$SETERRMSG
 yes     yes           Std       2 XUR$ERRPTR
 yes     yes           Std       7 XUR$ERRMSG
                       nStd      0 X66_MSTATIC
                       nStd      0 X66_MSRET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    B$XL_UPPER$                           M$SI
     M$LO                                  M$NODE                                M$DO
     VWN_COMMAND                           B$TCB$                                B$JIT$
     B_VERSION

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:45   


        1        1        /*M* NODEATER - Build :NODES file for use by MOVE and MAIL and SCOTTY. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*F**
        9        9        *
       10       10        *   NAME:  VWN$NODEATER
       11       11        *
       12       12        *   PURPOSE:
       13       13        *       To build the :NODES file for use by MOVE, SCOTTY, et al.
       14       14        *
       15       15        *   DESCRIPTION:
       16       16        *       NODEATER reads user input and builds a node's representation of
       17       17        *       the network in :NODES.
       18       18        *
       19       19        *   REFERENCE:
       20       20        *       See the appropriate Architecture File document for a description
       21       21        *       of the :NODES file.
       22       22        *
       23       23        ****/
       24       24
       25       25        /*D**
       26       26        *
       27       27        *   NAME:  VWN$NODEATER
       28       28        *
       29       29        *   CALL:
       30       30        *       Main program.
       31       31        *
       32       32        *   PARAMETERS:
       33       33        *       None.
       34       34        *
       35       35        *   INTERFACE:
       36       36        *       Uses the parser and the XUR$ routines.
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:46   
       37       37        *
       38       38        *   ENVIRONMENT:
       39       39        *       A large network may require a lot of memory, which is obtained
       40       40        *       dynamically.
       41       41        *
       42       42        *   INPUT:
       43       43        *       Input is read from the SI stream via XUR$GETCMD.
       44       44        *
       45       45        *   OUTPUT:
       46       46        *       :NODES in the current FMA is overwritten.
       47       47        *
       48       48        *   SCRATCH:
       49       49        *       None.
       50       50        *
       51       51        *   DESCRIPTION:
       52       52        *       The NODEATER program builds the :NODES file for use by MOVE and
       53       53        *       SCOTTY, the file transporters.  This file is also used by MAILMAN
       54       54        *       and other processors which need to interrogate the network info.
       55       55        *
       56       56        ****/
       57       57
       58       58        VWN$NODEATER: PROC MAIN NOAUTO;

     58  8 000000   000000 700200 xent  VWN$NODEATER TSX0  ! X66_MSTATIC
         8 000001   000000 000000 0                  ZERO    0,0

       59       59
       60       60        /****
       61       61        *
       62       62        *   %INCLUDEs
       63       63        *
       64       64        ****/
       65       65
       66       66        %INCLUDE CP_6;
       67     5625        %INCLUDE CP_6_SUBS;
       68     6165        %INCLUDE B$JIT;
       69     6768        %INCLUDE B$TABLES_C;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:47   
       70     6876        %INCLUDE XU_MACRO_C;
       71     9982        %INCLUDE XUH_MACRO_C;
       72    10066        %INCLUDE XUR_ENTRY;
       73    10098        %INCLUDE VW_NODEATER_E;
       74    10154        %INCLUDE VWN_ERRS_E;
       75    10317        %INCLUDE VW_FPTS_M;
       76    10738
       77    10739        /****
       78    10740        *
       79    10741        *   FPTs
       80    10742        *
       81    10743        ****/
       82    10744
       83    10745        %FPT_WRITE(FPTN=WRITE_NODE,
       84    10746                   DCB=M$NODE,
       85    10747                   BUF=NODEREC,
       86    10748                   KEY=NODEKEY,
       87    10749                   NEWKEY=YES);
       88    10780
       89    10781        %FPT_READ(FPTN=READ_SEQUEN,
       90    10782                  DCB=M$NODE,
       91    10783                  BUF=NODEREC,
       92    10784                  KEY=NODEKEY,
       93    10785                  KEYR=YES);
       94    10824
       95    10825        %FPT_PFIL(FPTN=PFIL_NODE,
       96    10826                  DCB=M$NODE,
       97    10827                  BOF=YES);
       98    10842
       99    10843        %FPT_DELREC(FPTN=DELREC_NODE,
      100    10844                    DCB=M$NODE,
      101    10845                    KEY=NODEKEY);
      102    10864
      103    10865        %VLP_ATTR(FPTN=ACC_NODE);
      104    10879
      105    10880        %VLP_ACCESS(ACCT='?',
      106    10881                    NOLIST=YES,
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:48   
      107    10882                    EXEC=YES,
      108    10883                    LAST=";");
      109    10900
      110    10901                  %VLP_ATTR(FPTN=ACS_NODE);
      111    10915
      112    10916        %VLP_ACSVEH(VEHICLE='MOVE',
      113    10917                    READ=YES);
      114    10934
      115    10935                  %VLP_ACSVEH(VEHICLE='SCOTTY',
      116    10936                  READ=YES);
      117    10953
      118    10954                  %VLP_ACSVEH(VEHICLE='SEND',
      119    10955                  READ=YES);
      120    10972
      121    10973                  %VLP_ACSVEH(VEHICLE='MAIL',
      122    10974                  READ=YES);
      123    10991
      124    10992                  %VLP_ACSVEH(VEHICLE='MAILMAN',
      125    10993                  READ=YES);
      126    11010
      127    11011                  %VLP_ACSVEH(VEHICLE='MOVE_TEST',
      128    11012                  READ=YES);
      129    11029
      130    11030                  %VLP_ACSVEH(VEHICLE='SCOTTY_TEST',
      131    11031                  READ=YES);
      132    11048
      133    11049                  %VLP_ACSVEH(VEHICLE='SEND_TEST',
      134    11050                  READ=YES);
      135    11067
      136    11068                  %VLP_ACSVEH(VEHICLE='MAIL_TEST',
      137    11069                  READ=YES);
      138    11086
      139    11087                  %VLP_ACSVEH(VEHICLE='MAILMAN_TEST',
      140    11088                  READ=YES,
      141    11089                  LAST=";");
      142    11106
      143    11107                  %P_PCB;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:49   
      144    11306
      145    11307        %PARSE$OUT;
      146    11352
      147    11353        %PARSE$SYM;
      148    11391
      149    11392        %F$DCB(DCBN=DUMMY);
      150    11449
      151    11450        %FPT_GDS(RESULTS=VLP_VECTOR,
      152    11451                 SEGSIZE=1024);
      153    11467        %VLP_VECTOR(SEGID='6010'O);
      154    11482
      155    11483        %FPT_EXIT;
      156    11498
      157    11499        %B$ALT;
      158    11507
      159    11508        %B$TCB;
      160    11511
      161    11512        %XUR_INIT(SYNTAX=YES,
      162    11513                  PCB=P_PCB);
      163    11612
      164    11613        %XUH_PARAM;
      165    11674
      166    11675                  %B$XL_UPPER;
      167    11679
      168    11680        /****
      169    11681        *
      170    11682        *   DCBs and external references
      171    11683        *
      172    11684        ****/
      173    11685
      174    11686    1   DCL M$SI                           DCB;
      175    11687    1   DCL M$LO                           DCB;
      176    11688    1   DCL M$NODE                         DCB;
      177    11689    1   DCL M$DO                           DCB;
      178    11690
      179    11691    1   DCL VWN_COMMAND SYMREF             BIT(36);
      180    11692    1   DCL B$TCB$ SYMREF                  PTR;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:50   
      181    11693    1   DCL B$JIT$ SYMREF                  PTR;
      182    11694    1   DCL 1 B_VERSION SYMREF,
      183    11695    1         2 L UNAL                     UBIN BYTE,
      184    11696    1         2 C UNAL                     CHAR(B_VERSION.L);
      185    11697
      186    11698        /****
      187    11699        *
      188    11700        *   Working storage
      189    11701        *
      190    11702        ****/
      191    11703
      192    11704    1   DCL IAMPTR                         PTR;
      193    11705    1   DCL BLK$                           PTR;
      194    11706    1   DCL NODEPTR                        PTR;
      195    11707    1   DCL PATHPTR                        PTR;
      196    11708    1   DCL P                              PTR;
      197    11709    1   DCL Q                              PTR;
      198    11710    1   DCL R                              PTR;
      199    11711
      200    11712    1   DCL I                              SBIN;
      201    11713    1   DCL J                              SBIN;
      202    11714    1   DCL K                              SBIN;
      203    11715    1   DCL L                              SBIN;
      204    11716    1   DCL TOT_TIME                       SBIN;
      205    11717    1   DCL LVL                            SBIN;
      206    11718    1   DCL MAXLVL                         SBIN;
      207    11719    1   DCL NODECNT                        SBIN;
      208    11720    1   DCL WDSLEFT                        SBIN;
      209    11721
      210    11722    1   DCL PTR$(0:63)                     PTR;
      211    11723    1   DCL IDX(0:63)                      SBIN;
      212    11724
      213    11725    1   DCL PROMPT CONSTANT                CHAR(1) INIT('>');
      214    11726
      215    11727    1   DCL IAM                            CHAR(8);
      216    11728    1   DCL HOLD                           CHAR(8);
      217    11729    1   DCL DIRECTORY_NODE                 CHAR(8);
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:51   
      218    11730
      219    11731    1   DCL 1 ERRMSGFID CONSTANT,
      220    11732    1         2 L UNAL                     UBIN BYTE INIT(15),
      221    11733    1         2 C UNAL                     CHAR(39) INIT(':VWERRMSG.:SYS');
      222    11734
      223    11735    1   DCL 1 ANODE BASED(NODEPTR),
      224    11736    1         2 NAME                       CHAR(8),
      225    11737    1         2 DONE                       BIT(1),
      226    11738    1         2 VISIT                      BIT(1),
      227    11739    1         2 *                          BIT(7),
      228    11740    1         2 TYPE UNAL                  UBIN BYTE,
      229    11741    1         2 COUNT UNAL                 UBIN HALF;
      230    11742
      231    11743    1   DCL 1 APATH BASED(PATHPTR),
      232    11744    1         2 NAME                       CHAR(8),
      233    11745    1         2 DEST                       CHAR(8),
      234    11746    1         2 ACCT CHAR (8),
      235    11747    1         2 MODE UNAL                  UBIN HALF,
      236    11748    1         2 SPEED UNAL                 UBIN HALF,
      237    11749    1         2 PTR$                       PTR;
      238    11750
      239    11751    1   DCL 1 U1,
      240    11752    1         2 L UNAL                     UBIN BYTE,
      241    11753    1         2 C UNAL                     CHAR(31);
      242    11754
      243    11755    1   DCL 1 U2,
      244    11756    1         2 L UNAL                     UBIN BYTE,
      245    11757    1         2 C UNAL                     CHAR(31);
      246    11758
      247    11759    1   DCL 1 ERR BASED ALIGNED,                /* #21743                             */
      248    11760    1         2 FCG                        BIT(18),
      249    11761    1         2 MON                        BIT(1),
      250    11762    1         2 CODE UNAL                  UBIN(14),
      251    11763    1         2 SEV UNAL                   UBIN(3);
      252    11764
      253    11765        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:52   
      254    11766        /****
      255    11767        *
      256    11768        *   Initialize data, greet the user, set up memory, etc.
      257    11769        *
      258    11770        ****/
      259    11771
      260    11772    1           CALL XUR$INIT(XUR_INIT);

  11772  8 000002   000001 630400 9                  EPPR0   1
         8 000003   000000 631400 9                  EPPR1   0
         8 000004   000000 701000 xent               TSX1    XUR$INIT
         8 000005   000000 011000                    NOP     0

      261    11773    1           CALL XUR$SETDCBS(,DCBNUM(M$LO));

  11773  8 000006   000000 236007 xsym               LDQ     M$LO,DL
         8 000007   000740 756000 0                  STQ     U2+8
         8 000010   000740 630400 0                  EPPR0   U2+8
         8 000011   000743 450400 0                  STP0    U2+11
         8 000012   000003 236000 9                  LDQ     3
         8 000013   000742 756000 0                  STQ     U2+10
         8 000014   000742 630400 0                  EPPR0   U2+10
         8 000015   000002 631400 9                  EPPR1   2
         8 000016   000000 701000 xent               TSX1    XUR$SETDCBS
         8 000017   000000 011000                    NOP     0

      262    11774    1           CALL XUR$SETERRMSG(ERRMSGFID);

  11774  8 000020   000004 630400 9                  EPPR0   4
         8 000021   000000 631400 9                  EPPR1   0
         8 000022   000000 701000 xent               TSX1    XUR$SETERRMSG
         8 000023   000000 011000                    NOP     0

      263    11775
      264    11776        /****
      265    11777        *
      266    11778        *   Build the :NODES file in the current FMA.
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:53   
      267    11779        *
      268    11780        ****/
      269    11781
      270    11782    1           ACCT_NODE.ACCT#=B$JIT$->B$JIT.FACCN;

  11782  8 000024   000000 470400 xsym               LDP0    B$JIT$
         8 000025   000006 237100                    LDAQ    6,,PR0
         8 000026   000000 757000 2                  STAQ    ACCT_NODE

      271    11783
      272    11784        /****
      273    11785        *
      274    11786        *   Acquire memory for the tables.
      275    11787        *
      276    11788        ****/
      277    11789
      278    11790    1           CALL M$GDS(FPT_GDS) ALTRET(ERR_MEM);

  11790  8 000027   000312 630400 0                  EPPR0   FPT_GDS
         8 000030   430001 713400                    CLIMB   alt,gds
         8 000031   400400 401760                    pmme    nvectors=2
         8 000032   000717 702000 8                  TSX2    ERR_MEM

      279    11791    1           WDSLEFT=1024;

  11791  8 000033   002000 235007                    LDA     1024,DL
         8 000034   000511 755000 0                  STA     WDSLEFT

      280    11792    1           NODEPTR=VLP_VECTOR.PTR$;

  11792  8 000035   000321 236000 0                  LDQ     VLP_VECTOR+1
         8 000036   000474 756000 0                  STQ     NODEPTR

      281    11793    1           PATHPTR=VLP_VECTOR.PTR$;

  11793  8 000037   000475 756000 0                  STQ     PATHPTR

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:54   
      282    11794
      283    11795        /****
      284    11796        *
      285    11797        *   Indicate that no IAM node has been found, set the count of nodes to zero.
      286    11798        *
      287    11799        ****/
      288    11800
      289    11801    1           IAM=' ';

  11801  8 000040   000005 235000 9                  LDA     5
         8 000041   000005 236000 9                  LDQ     5
         8 000042   000712 757000 0                  STAQ    IAM

      290    11802    1           IAMPTR=ADDR(NIL);

  11802  8 000043   000003 236000 9                  LDQ     3
         8 000044   000472 756000 0                  STQ     IAMPTR

      291    11803    1           NODECNT=0;

  11803  8 000045   000510 450000 0                  STZ     NODECNT

      292    11804
      293    11805        /****
      294    11806        *
      295    11807        *   Supply the access vehicles for the :NODES file, then open it output.
      296    11808        *   Note that this will not delete an existing :NODES file now, since the
      297    11809        *   new file isn't cataloged until EOJ.
      298    11810        *
      299    11811        ****/
      300    11812
      301    11813    1           OPEN_NODE.ACCESS_=VECTOR(ACC_NODE);

  11813  8 000046   000006 237000 9                  LDAQ    6
         8 000047   000014 757000 0                  STAQ    OPEN_NODE+10

      302    11814    1           OPEN_NODE.ACSVEH_=VECTOR(ACS_NODE);
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:55   

  11814  8 000050   000010 237000 9                  LDAQ    8
         8 000051   000016 757000 0                  STAQ    OPEN_NODE+12

      303    11815    1           OPEN_NODE.V.FUN#=%CREATE#;

  11815  8 000052   003000 236007                    LDQ     1536,DL
         8 000053   000047 552010 0                  STBQ    OPEN_NODE+37,'10'O

      304    11816    1           CALL M$OPEN(OPEN_NODE) ALTRET(ERR_OUT);

  11816  8 000054   000002 630400 0                  EPPR0   OPEN_NODE
         8 000055   450000 713400                    CLIMB   alt,open
         8 000056   410400 401760                    pmme    nvectors=18
         8 000057   002336 702000 8                  TSX2    ERR_OUT

      305    11817
      306    11818        /****
      307    11819        *
      308    11820        *   Greet the user.
      309    11821        *
      310    11822        ****/
      311    11823
      312    11824    1           CALL XUR$ERRMSG(%E$VWN_HITHER,,,VECTOR(B_VERSION));

  11824  8 000060   000000 236000 xsym               LDQ     B_VERSION
         8 000061   000033 772000                    QRL     27
         8 000062   000001 620006                    EAX0    1,QL
         8 000063   000000 635010                    EAA     0,X0
         8 000064   000002 771000                    ARL     2
         8 000065   000140 135007                    SBLA    96,DL
         8 000066   000012 236000 9                  LDQ     10
         8 000067   000740 757000 0                  STAQ    U2+8
         8 000070   000740 630400 0                  EPPR0   U2+8
         8 000071   000745 450400 0                  STP0    U2+13
         8 000072   000003 236000 9                  LDQ     3
         8 000073   000744 756000 0                  STQ     U2+12
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:56   
         8 000074   000015 235000 9                  LDA     13
         8 000075   000742 757000 0                  STAQ    U2+10
         8 000076   000742 630400 0                  EPPR0   U2+10
         8 000077   000013 631400 9                  EPPR1   11
         8 000100   000000 701000 xent               TSX1    XUR$ERRMSG
         8 000101   000000 011000                    NOP     0

      313    11825
      314    11826        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:57   
      315    11827        /****
      316    11828        *
      317    11829        *   Read commands from M$SI until END or EOF and parse them, then
      318    11830        *   go to the proper routine.
      319    11831        *
      320    11832        ****/
      321    11833
      322    11834    1   READ_COMMAND:
      323    11835    2           CALL XUR$GETCMD(VWN_COMMAND,BLK$,VECTOR(PROMPT)) WHENALTRETURN DO;

  11835  8 000102   000021 630400 9     READ_COMMAND EPPR0   17
         8 000103   000020 631400 9                  EPPR1   16
         8 000104   000000 701000 xent               TSX1    XUR$GETCMD
         8 000105   000107 702000 8                  TSX2    s:11836
         8 000106   000150 710000 8                  TRA     s:11846

      324    11836    2              CALL XUR$ECHOIF(DCBNUM(M$DO));

  11836  8 000107   000000 236007 xsym               LDQ     M$DO,DL
         8 000110   000740 756000 0                  STQ     U2+8
         8 000111   000740 630400 0                  EPPR0   U2+8
         8 000112   000741 450400 0                  STP0    U2+9
         8 000113   000741 630400 0                  EPPR0   U2+9
         8 000114   000000 631400 9                  EPPR1   0
         8 000115   000000 701000 xent               TSX1    XUR$ECHOIF
         8 000116   000000 011000                    NOP     0

      325    11837    2              IF P_PCB.HI_CHAR>0 THEN

  11837  8 000117   000306 235000 0                  LDA     P_PCB+10
         8 000120   000133 600000 8                  TZE     s:11839

      326    11838    2                 CALL XUR$ERRPTR(,DCBNUM(M$DO));

  11838  8 000121   000000 236007 xsym               LDQ     M$DO,DL
         8 000122   000740 756000 0                  STQ     U2+8
         8 000123   000740 630400 0                  EPPR0   U2+8
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:58   
         8 000124   000743 450400 0                  STP0    U2+11
         8 000125   000003 236000 9                  LDQ     3
         8 000126   000742 756000 0                  STQ     U2+10
         8 000127   000742 630400 0                  EPPR0   U2+10
         8 000130   000002 631400 9                  EPPR1   2
         8 000131   000000 701000 xent               TSX1    XUR$ERRPTR
         8 000132   000000 011000                    NOP     0

      327    11839    2              CALL XUR$ERRMSG(BLK$);

  11839  8 000133   000022 630400 9                  EPPR0   18
         8 000134   000000 631400 9                  EPPR1   0
         8 000135   000000 701000 xent               TSX1    XUR$ERRMSG
         8 000136   000000 011000                    NOP     0

      328    11840    3              IF ADDR(BLK$)->ERR.MON THEN DO; /* #21743                          */

  11840  8 000137   000473 236000 0                  LDQ     BLK$
         8 000140   400000 316007                    CANQ    -131072,DL
         8 000141   000147 600000 8                  TZE     s:11844

      329    11841    3                 FPT_EXIT.V.STEPCC#=6;

  11841  8 000142   006000 236003                    LDQ     3072,DU
         8 000143   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      330    11842    3                 CALL M$EXIT(FPT_EXIT);

  11842  8 000144   000322 630400 0                  EPPR0   FPT_EXIT
         8 000145   000001 713400                    CLIMB   exit
         8 000146   400400 401760                    pmme    nvectors=2

      331    11843    3                 END;

      332    11844    2              GOTO READ_COMMAND;

  11844  8 000147   000102 710000 8                  TRA     READ_COMMAND
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:59   

      333    11845    2              END;
      334    11846    1           CALL XUR$ECHOIF(DCBNUM(M$LO));

  11846  8 000150   000000 236007 xsym               LDQ     M$LO,DL
         8 000151   000740 756000 0                  STQ     U2+8
         8 000152   000740 630400 0                  EPPR0   U2+8
         8 000153   000741 450400 0                  STP0    U2+9
         8 000154   000741 630400 0                  EPPR0   U2+9
         8 000155   000000 631400 9                  EPPR1   0
         8 000156   000000 701000 xent               TSX1    XUR$ECHOIF
         8 000157   000000 011000                    NOP     0

      335    11847
      336    11848        /****
      337    11849        *
      338    11850        *   Do the proper routine based on the major command.
      339    11851        *
      340    11852        ****/
      341    11853
      342    11854    1           BLK$=P_PCB.OUT$->OUT$BLK.SUBLK$(0);

  11854  8 000160   000277 470400 0                  LDP0    P_PCB+3
         8 000161   000003 236100                    LDQ     3,,PR0
         8 000162   000473 756000 0                  STQ     BLK$

      343    11855    2           DO SELECT(OUT$BLK.CODE);

  11855  8 000163   000473 471400 0                  LDP1    BLK$
         8 000164   100000 236100                    LDQ     0,,PR1
         8 000165   777777 376007                    ANQ     -1,DL
         8 000166   000013 116007                    CMPQ    11,DL
         8 000167   000200 602000 8                  TNC     s:11855+13
         8 000170   000301 600000 8                  TZE     s:11937
         8 000171   000014 116007                    CMPQ    12,DL
         8 000172   002246 602000 8                  TNC     FILE_BUILT
         8 000173   000232 600000 8                  TZE     s:11892
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:60   
         8 000174   100000 720100                    LXL0    0,,PR1
         8 000175   000020 100003                    CMPX0   16,DU
         8 000176   002246 601000 8                  TNZ     FILE_BUILT
         8 000177   000731 710000 8                  TRA     s:12177
         8 000200   100000 720100                    LXL0    0,,PR1
         8 000201   000012 100003                    CMPX0   10,DU
         8 000202   002246 601000 8                  TNZ     FILE_BUILT
         8 000203   000204 710000 8                  TRA     s:11865

      344    11856
      345    11857        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:61   
      346    11858        /****
      347    11859        *
      348    11860        *   Process the IAM command:  Check for duplicates and stow it.
      349    11861        *
      350    11862        ****/
      351    11863
      352    11864    2              SELECT(%N_IAM#);

      353    11865    3              IF IAM~=' ' THEN DO;

  11865  8 000204   000712 237000 0                  LDAQ    IAM
         8 000205   000024 117000 9                  CMPAQ   20
         8 000206   000216 600000 8                  TZE     s:11870

      354    11866    3                 CALL XUR$ERRMSG(%E$VWN_DUPIAM);

  11866  8 000207   000027 630400 9                  EPPR0   23
         8 000210   000000 631400 9                  EPPR1   0
         8 000211   000000 701000 xent               TSX1    XUR$ERRMSG
         8 000212   000000 011000                    NOP     0

      355    11867    3                 FPT_EXIT.V.STEPCC#=4;

  11867  8 000213   004000 236003                    LDQ     2048,DU
         8 000214   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      356    11868    3                 END;

  11868  8 000215   000231 710000 8                  TRA     s:11873

      357    11869    3              ELSE DO;

      358    11870    3                 P=OUT$BLK.SUBLK$(0);

  11870  8 000216   100003 236100                    LDQ     3,,PR1
         8 000217   000476 756000 0                  STQ     P

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:62   
      359    11871    3                 CALL XLATE(IAM,B$XL_UPPER,P->OUT$SYM.TEXT);

  11871  8 000220   000476 473400 0                  LDP3    P
         8 000221   300004 236100                    LDQ     4,,PR3
         8 000222   000033 772000                    QRL     27
         8 000223   000000 621006                    EAX1    0,QL
         8 000224   000000 474400 xsym               LDP4    B$XL_UPPER$
         8 000225   040000 160540                    MVT     fill='040'O
         8 000226   300004 200011                    ADSC9   4,,PR3                   cn=1,n=*X1
         8 000227   000712 000010 0                  ADSC9   IAM                      cn=0,n=8
         8 000230   400000 000100                    ARG     0,,PR4

      360    11872    3                 END;

      361    11873    2              GOTO READ_COMMAND;

  11873  8 000231   000102 710000 8                  TRA     READ_COMMAND

      362    11874
      363    11875        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:63   
      364    11876        /****
      365    11877        *
      366    11878        *   Process the SYNON commands:  Write to :NODES to check for
      367    11879        *   duplicates.  Note that this will not alter an existing :NODES
      368    11880        *   file since the one being built is not cataloged until EOJ.
      369    11881        *
      370    11882        ****/
      371    11883
      372    11884    2              SELECT(%N_SYNON#);

      373    11885
      374    11886        /****
      375    11887        *
      376    11888        *   First fetch the node name and stow it in the record.
      377    11889        *
      378    11890        ****/
      379    11891
      380    11892    2              P=OUT$BLK.SUBLK$(0);

  11892  8 000232   100003 236100                    LDQ     3,,PR1
         8 000233   000476 756000 0                  STQ     P

      381    11893    2              CALL XLATE(NODEREC,B$XL_UPPER,P->OUT$SYM.TEXT);

  11893  8 000234   000476 473400 0                  LDP3    P
         8 000235   300004 236100                    LDQ     4,,PR3
         8 000236   000033 772000                    QRL     27
         8 000237   000000 620006                    EAX0    0,QL
         8 000240   000000 474400 xsym               LDP4    B$XL_UPPER$
         8 000241   040000 160540                    MVT     fill='040'O
         8 000242   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
         8 000243   000155 000026 0                  ADSC9   NODEOVR                  cn=0,n=22
         8 000244   400000 000100                    ARG     0,,PR4

      382    11894
      383    11895        /****
      384    11896        *
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:64   
      385    11897        *   Next fetch the node's synonym, which must not be the name of another node.
      386    11898        *
      387    11899        ****/
      388    11900
      389    11901    2              P=OUT$BLK.SUBLK$(1);

  11901  8 000245   100004 236100                    LDQ     4,,PR1
         8 000246   000476 756000 0                  STQ     P

      390    11902    2              CALL XLATE(NODEKEY.C,B$XL_UPPER,P->OUT$SYM.TEXT);

  11902  8 000247   000476 473400 0                  LDP3    P
         8 000250   300004 236100                    LDQ     4,,PR3
         8 000251   000033 772000                    QRL     27
         8 000252   000000 620006                    EAX0    0,QL
         8 000253   040000 160540                    MVT     fill='040'O
         8 000254   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
         8 000255   000152 200010 0                  ADSC9   NODEKEY                  cn=1,n=8
         8 000256   400000 000100                    ARG     0,,PR4

      391    11903
      392    11904        /****
      393    11905        *
      394    11906        *   Synonym records are only 8 data bytes.  Write the "real" name of the node
      395    11907        *   keyed by the synonym.  Since ONEWKEY is (by default) NO, this write will
      396    11908        *   ALTRET if duplicate node/synonym already exists in the new file.
      397    11909        *
      398    11910        ****/
      399    11911
      400    11912    2              NODEKEY.L=8;

  11912  8 000257   010000 236003                    LDQ     4096,DU
         8 000260   000152 552040 0                  STBQ    NODEKEY,'40'O

      401    11913    2              WRITE_NODE.BUF_.BOUND=7;

  11913  8 000261   000170 236000 0                  LDQ     WRITE_NODE+4
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:65   
         8 000262   177777 376007                    ANQ     65535,DL
         8 000263   000030 276000 9                  ORQ     24
         8 000264   000170 756000 0                  STQ     WRITE_NODE+4

      402    11914    3              CALL M$WRITE(WRITE_NODE) WHENALTRETURN DO;

  11914  8 000265   000164 630400 0                  EPPR0   WRITE_NODE
         8 000266   440001 713400                    CLIMB   alt,write
         8 000267   401400 401760                    pmme    nvectors=4
         8 000270   000272 702000 8                  TSX2    s:11915
         8 000271   000300 710000 8                  TRA     s:11918

      403    11915    3                 CALL XUR$ERRMSG(%E$VWN_DUPSYN);

  11915  8 000272   000032 630400 9                  EPPR0   26
         8 000273   000000 631400 9                  EPPR1   0
         8 000274   000000 701000 xent               TSX1    XUR$ERRMSG
         8 000275   000000 011000                    NOP     0

      404    11916    3                 FPT_EXIT.V.STEPCC#=4;

  11916  8 000276   004000 236003                    LDQ     2048,DU
         8 000277   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      405    11917    3                 END;

      406    11918    2              GOTO READ_COMMAND;

  11918  8 000300   000102 710000 8                  TRA     READ_COMMAND

      407    11919
      408    11920        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:66   
      409    11921        /****
      410    11922        *
      411    11923        *   Process the NODE commands:  Check for duplicates, then stow the
      412    11924        *   node block in memory, along with its options.
      413    11925        *
      414    11926        ****/
      415    11927
      416    11928    2              SELECT(%N_NODE#);

      417    11929
      418    11930        /****
      419    11931        *
      420    11932        *   First, acquire enough additional memory to stow the node header and
      421    11933        *   all the path elements attached to this node.
      422    11934        *
      423    11935        ****/
      424    11936
      425    11937    3              DO WHILE(WDSLEFT<SIZEW(APATH)*(OUT$BLK.NSUBLKS-1)+SIZEW(ANODE));

  11937  8 000301   000310 710000 8                  TRA     s:11940

      426    11938    3                 CALL M$GDS(FPT_GDS) ALTRET(ERR_MEM);

  11938  8 000302   000312 630400 0                  EPPR0   FPT_GDS
         8 000303   430001 713400                    CLIMB   alt,gds
         8 000304   400400 401760                    pmme    nvectors=2
         8 000305   000717 702000 8                  TSX2    ERR_MEM

      427    11939    3                 WDSLEFT=WDSLEFT+1024;

  11939  8 000306   002000 236007                    LDQ     1024,DL
         8 000307   000511 056000 0                  ASQ     WDSLEFT

      428    11940    3                 END;

  11940  8 000310   000473 470400 0                  LDP0    BLK$
         8 000311   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:67   
         8 000312   000017 772000                    QRL     15
         8 000313   000033 376000 9                  ANQ     27
         8 000314   000005 136007                    SBLQ    5,DL
         8 000315   000511 116000 0                  CMPQ    WDSLEFT
         8 000316   000302 605400 8                  TPNZ    s:11938

      429    11941
      430    11942        /****
      431    11943        *
      432    11944        *   Initialize the node header to defaults:  TYPE=CP-6.
      433    11945        *
      434    11946        ****/
      435    11947
      436    11948    2              ANODE='0'B;

  11948  8 000317   000474 471400 0                  LDP1    NODEPTR
         8 000320   000100 100400                    MLR     fill='000'O
         8 000321   000034 000001 9                  ADSC9   28                       cn=0,n=1
         8 000322   100000 000014                    ADSC9   0,,PR1                   cn=0,n=12

      437    11949    2              ANODE.TYPE=%N_TYPE#;

  11949  8 000323   000100 101400                    MRL     fill='000'O
         8 000324   000035 000004 9                  ADSC9   29                       cn=0,n=4
         8 000325   100002 200001                    ADSC9   2,,PR1                   cn=1,n=1

      438    11950
      439    11951        /****
      440    11952        *
      441    11953        *   Fetch the node's name.  Then walk through all the existing node
      442    11954        *   headers looking for duplicates.  Note that this doesn't check for
      443    11955        *   duplicates in the synonyms, which have already been written.
      444    11956        *
      445    11957        ****/
      446    11958
      447    11959    2              P=OUT$BLK.SUBLK$(0);

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:68   
  11959  8 000326   000473 470400 0                  LDP0    BLK$
         8 000327   000003 236100                    LDQ     3,,PR0
         8 000330   000476 756000 0                  STQ     P

      448    11960    2              CALL XLATE(ANODE.NAME,B$XL_UPPER,P->OUT$SYM.TEXT);

  11960  8 000331   000476 473400 0                  LDP3    P
         8 000332   300004 236100                    LDQ     4,,PR3
         8 000333   000033 772000                    QRL     27
         8 000334   000000 620006                    EAX0    0,QL
         8 000335   000000 474400 xsym               LDP4    B$XL_UPPER$
         8 000336   040100 160540                    MVT     fill='040'O
         8 000337   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
         8 000340   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         8 000341   400000 000100                    ARG     0,,PR4

      449    11961
      450    11962    2              Q=VLP_VECTOR.PTR$;

  11962  8 000342   000321 236000 0                  LDQ     VLP_VECTOR+1
         8 000343   000477 756000 0                  STQ     Q

      451    11963    3              DO WHILE(POFFW(NODEPTR,Q)~=0);

  11963  8 000344   000373 710000 8                  TRA     s:11970

      452    11964    4                 IF ANODE.NAME=Q->ANODE.NAME THEN DO;

  11964  8 000345   000474 470400 0                  LDP0    NODEPTR
         8 000346   000477 471400 0                  LDP1    Q
         8 000347   040100 106500                    CMPC    fill='040'O
         8 000350   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         8 000351   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         8 000352   000362 601000 8                  TNZ     s:11969

      453    11965    4                    CALL XUR$ERRMSG(%E$VWN_DUPNOD);

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:69   
  11965  8 000353   000037 630400 9                  EPPR0   31
         8 000354   000000 631400 9                  EPPR1   0
         8 000355   000000 701000 xent               TSX1    XUR$ERRMSG
         8 000356   000000 011000                    NOP     0

      454    11966    4                    FPT_EXIT.V.STEPCC#=4;

  11966  8 000357   004000 236003                    LDQ     2048,DU
         8 000360   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      455    11967    4                    GOTO READ_COMMAND;

  11967  8 000361   000102 710000 8                  TRA     READ_COMMAND

      456    11968    4                    END;
      457    11969    3                 Q=PINCRW(Q,Q->ANODE.COUNT*SIZEW(APATH)+SIZEW(ANODE));

  11969  8 000362   000000 100500                    MLR     fill='000'O
         8 000363   100002 400002                    ADSC9   2,,PR1                   cn=2,n=2
         8 000364   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 000365   000740 220000 0                  LDX0    U2+8
         8 000366   000000 636010                    EAQ     0,X0
         8 000367   000003 736000                    QLS     3
         8 000370   000003 036003                    ADLQ    3,DU
         8 000371   000477 036000 0                  ADLQ    Q
         8 000372   000477 756000 0                  STQ     Q

      458    11970    3                 END;

  11970  8 000373   000477 235000 0                  LDA     Q
         8 000374   000022 771000                    ARL     18
         8 000375   000740 755000 0                  STA     U2+8
         8 000376   000474 236000 0                  LDQ     NODEPTR
         8 000377   000022 772000                    QRL     18
         8 000400   000740 136000 0                  SBLQ    U2+8
         8 000401   000345 601000 8                  TNZ     s:11964

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:70   
      459    11971
      460    11972        /****
      461    11973        *
      462    11974        *   Check for TYPE being specified.  If it is, stow it in the header.
      463    11975        *
      464    11976        ****/
      465    11977
      466    11978    2              I=1;

  11978  8 000402   000001 236007                    LDQ     1,DL
         8 000403   000501 756000 0                  STQ     I

      467    11979    2              P=OUT$BLK.SUBLK$(1);

  11979  8 000404   000473 470400 0                  LDP0    BLK$
         8 000405   000004 236100                    LDQ     4,,PR0
         8 000406   000476 756000 0                  STQ     P

      468    11980    3              IF P->OUT$BLK.CODE~=%N_PATHELT# THEN DO;

  11980  8 000407   000476 471400 0                  LDP1    P
         8 000410   100000 720100                    LXL0    0,,PR1
         8 000411   000310 100003                    CMPX0   200,DU
         8 000412   000421 600000 8                  TZE     s:11993

      469    11981    3                 I=2;

  11981  8 000413   000002 235007                    LDA     2,DL
         8 000414   000501 755000 0                  STA     I

      470    11982    3                 ANODE.TYPE=P->OUT$BLK.CODE;

  11982  8 000415   000474 473400 0                  LDP3    NODEPTR
         8 000416   000100 101500                    MRL     fill='000'O
         8 000417   100000 400002                    ADSC9   0,,PR1                   cn=2,n=2
         8 000420   300002 200001                    ADSC9   2,,PR3                   cn=1,n=1

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:71   
      471    11983    3                 END;

      472    11984
      473    11985        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:72   
      474    11986        /****
      475    11987        *
      476    11988        *   Process each PATH sub-option, check to ensure that a node is
      477    11989        *   not connected to itself.
      478    11990        *
      479    11991        ****/
      480    11992
      481    11993    2              PATHPTR=PINCRW(PATHPTR,SIZEW(ANODE));

  11993  8 000421   000475 236000 0                  LDQ     PATHPTR
         8 000422   000003 036003                    ADLQ    3,DU
         8 000423   000475 756000 0                  STQ     PATHPTR

      482    11994    2              WDSLEFT=WDSLEFT-SIZEW(ANODE);

  11994  8 000424   000003 336007                    LCQ     3,DL
         8 000425   000511 056000 0                  ASQ     WDSLEFT

      483    11995
      484    11996        /****
      485    11997        *
      486    11998        *   Walk through each PATH sub-option.
      487    11999        *
      488    12000        ****/
      489    12001
      490    12002    3              DO WHILE(I<OUT$BLK.NSUBLKS);

  12002  8 000426   000473 470400 0                  LDP0    BLK$
         8 000427   000001 236100                    LDQ     1,,PR0
         8 000430   000022 772000                    QRL     18
         8 000431   000501 116000 0                  CMPQ    I
         8 000432   000713 604400 8                  TMOZ    s:12144

      491    12003        /****
      492    12004        *  Check to see if path elements are given for EXTERNALly defined
      493    12005        *  nodes.  If so, it's an error
      494    12006        ****/
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:73   
      495    12007    3                 IF(ANODE.TYPE = %N_EXTERNAL#) AND (OUT$BLK.NSUBLKS > 2)

  12007  8 000433   000474 470400 0                  LDP0    NODEPTR
         8 000434   000000 101500                    MRL     fill='000'O
         8 000435   000002 200001                    ADSC9   2,,PR0                   cn=1,n=1
         8 000436   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 000437   000740 236000 0                  LDQ     U2+8
         8 000440   000157 116007                    CMPQ    111,DL
         8 000441   000455 601000 8                  TNZ     s:12013
         8 000442   000473 471400 0                  LDP1    BLK$
         8 000443   100001 220100                    LDX0    1,,PR1
         8 000444   000003 100003                    CMPX0   3,DU
         8 000445   000455 602000 8                  TNC     s:12013

      496    12008    4                 THEN DO;

      497    12009    4                    CALL XUR$ERRMSG(%E$VWN_NOPATHS);

  12009  8 000446   000041 630400 9                  EPPR0   33
         8 000447   000000 631400 9                  EPPR1   0
         8 000450   000000 701000 xent               TSX1    XUR$ERRMSG
         8 000451   000000 011000                    NOP     0

      498    12010    4                    FPT_EXIT.V.STEPCC# = 4;

  12010  8 000452   004000 236003                    LDQ     2048,DU
         8 000453   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      499    12011    4                    GOTO READ_COMMAND;

  12011  8 000454   000102 710000 8                  TRA     READ_COMMAND

      500    12012    4                    END;                   /* if external node and path is given */
      501    12013    3                 P=OUT$BLK.SUBLK$(I);

  12013  8 000455   000473 471400 0                  LDP1    BLK$
         8 000456   000501 720000 0                  LXL0    I
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:74   
         8 000457   100003 236110                    LDQ     3,X0,PR1
         8 000460   000476 756000 0                  STQ     P

      502    12014
      503    12015        /****
      504    12016        *
      505    12017        *   Initialize this path element to its defaults:  DIALUP, 2400 baud.
      506    12018        *
      507    12019        ****/
      508    12020
      509    12021    3                 APATH='0'B;

  12021  8 000461   000475 473400 0                  LDP3    PATHPTR
         8 000462   000100 100400                    MLR     fill='000'O
         8 000463   000034 000001 9                  ADSC9   28                       cn=0,n=1
         8 000464   300000 000040                    ADSC9   0,,PR3                   cn=0,n=32

      510    12022    3                 APATH.MODE=%N_DIALUP#;

  12022  8 000465   000024 221003                    LDX1    20,DU
         8 000466   300006 741100                    STX1    6,,PR3

      511    12023    3                 APATH.SPEED=5;

  12023  8 000467   000005 222003                    LDX2    5,DU
         8 000470   300006 442100                    SXL2    6,,PR3

      512    12024    3                 APATH.NAME = ' ';

  12024  8 000471   000005 235000 9                  LDA     5
         8 000472   000005 236000 9                  LDQ     5
         8 000473   300000 755100                    STA     0,,PR3
         8 000474   300001 756100                    STQ     1,,PR3

      513    12025    3                 APATH.ACCT = ' ';

  12025  8 000475   000005 235000 9                  LDA     5
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:75   
         8 000476   000005 236000 9                  LDQ     5
         8 000477   300004 755100                    STA     4,,PR3
         8 000500   300005 756100                    STQ     5,,PR3

      514    12026
      515    12027        /****
      516    12028        *
      517    12029        *   Fetch the path name (WSN) or directory account and stow it.
      518    12030        *
      519    12031        ****/
      520    12032
      521    12033    3                 Q=P->OUT$BLK.SUBLK$(0);

  12033  8 000501   000476 471400 0                  LDP1    P
         8 000502   100003 236100                    LDQ     3,,PR1
         8 000503   000477 756000 0                  STQ     Q

      522    12034    4                 DO CASE (Q->OUT$BLK.CODE);

  12034  8 000504   000477 474400 0                  LDP4    Q
         8 000505   400000 723100                    LXL3    0,,PR4
         8 000506   000005 103003                    CMPX3   5,DU
         8 000507   000511 602013 8                  TNC     s:12034+5,X3
         8 000510   000537 710000 8                  TRA     s:12047
         8 000511   000537 710000 8                  TRA     s:12047
         8 000512   000537 710000 8                  TRA     s:12047
         8 000513   000537 710000 8                  TRA     s:12047
         8 000514   000516 710000 8                  TRA     s:12036
         8 000515   000527 710000 8                  TRA     s:12038

      523    12035    4                  CASE (%N_PATHNAME#);

      524    12036    4                    CALL XLATE(APATH.NAME,B$XL_UPPER,Q->OUT$SYM.TEXT);

  12036  8 000516   400004 236100                    LDQ     4,,PR4
         8 000517   000033 772000                    QRL     27
         8 000520   000000 624006                    EAX4    0,QL
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:76   
         8 000521   000000 475400 xsym               LDP5    B$XL_UPPER$
         8 000522   040100 160540                    MVT     fill='040'O
         8 000523   400004 200014                    ADSC9   4,,PR4                   cn=1,n=*X4
         8 000524   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
         8 000525   500000 000100                    ARG     0,,PR5
         8 000526   000537 710000 8                  TRA     s:12047

      525    12037    4                  CASE (%N_DIRECTORY#);

      526    12038    4                    CALL XLATE(APATH.ACCT,B$XL_UPPER,Q->OUT$SYM.TEXT);

  12038  8 000527   400004 236100                    LDQ     4,,PR4
         8 000530   000033 772000                    QRL     27
         8 000531   000000 624006                    EAX4    0,QL
         8 000532   000000 475400 xsym               LDP5    B$XL_UPPER$
         8 000533   040100 160540                    MVT     fill='040'O
         8 000534   400004 200014                    ADSC9   4,,PR4                   cn=1,n=*X4
         8 000535   300004 000010                    ADSC9   4,,PR3                   cn=0,n=8
         8 000536   500000 000100                    ARG     0,,PR5

      527    12039    4                  END;

      528    12040
      529    12041        /****
      530    12042        *
      531    12043        *   Now fetch the name of the node found at the end of this path and stow it.
      532    12044        *
      533    12045        ****/
      534    12046
      535    12047    3                 Q=P->OUT$BLK.SUBLK$(1);

  12047  8 000537   100004 236100                    LDQ     4,,PR1
         8 000540   000477 756000 0                  STQ     Q

      536    12048    3                 CALL XLATE(APATH.DEST,B$XL_UPPER,Q->OUT$SYM.TEXT);

  12048  8 000541   000477 474400 0                  LDP4    Q
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:77   
         8 000542   400004 236100                    LDQ     4,,PR4
         8 000543   000033 772000                    QRL     27
         8 000544   000000 623006                    EAX3    0,QL
         8 000545   000000 475400 xsym               LDP5    B$XL_UPPER$
         8 000546   040100 160540                    MVT     fill='040'O
         8 000547   400004 200013                    ADSC9   4,,PR4                   cn=1,n=*X3
         8 000550   300002 000010                    ADSC9   2,,PR3                   cn=0,n=8
         8 000551   500000 000100                    ARG     0,,PR5

      537    12049
      538    12050        /****
      539    12051        *
      540    12052        *   Make sure we're not connected to ourself.
      541    12053        *
      542    12054        ****/
      543    12055
      544    12056    4                 IF ANODE.NAME=APATH.DEST THEN DO;

  12056  8 000552   040100 106500                    CMPC    fill='040'O
         8 000553   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         8 000554   300002 000010                    ADSC9   2,,PR3                   cn=0,n=8
         8 000555   000565 601000 8                  TNZ     s:12069

      545    12057    4                    CALL XUR$ERRMSG(%E$VWN_INCEST);

  12057  8 000556   000043 630400 9                  EPPR0   35
         8 000557   000000 631400 9                  EPPR1   0
         8 000560   000000 701000 xent               TSX1    XUR$ERRMSG
         8 000561   000000 011000                    NOP     0

      546    12058    4                    FPT_EXIT.V.STEPCC#=4;

  12058  8 000562   004000 236003                    LDQ     2048,DU
         8 000563   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      547    12059    4                    END;

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:78   
  12059  8 000564   000705 710000 8                  TRA     s:12134

      548    12060
      549    12061        /****
      550    12062        *
      551    12063        *   Now check for a baud rate/connection mode specification, which may be
      552    12064        *   entered in any order (or omitted).
      553    12065        *
      554    12066        ****/
      555    12067
      556    12068    4                 ELSE DO;

      557    12069    5                    IF P->OUT$BLK.NSUBLKS>2 THEN DO;

  12069  8 000565   100001 223100                    LDX3    1,,PR1
         8 000566   000003 103003                    CMPX3   3,DU
         8 000567   000624 602000 8                  TNC     s:12109

      558    12070    5                       Q=P->OUT$BLK.SUBLK$(2);

  12070  8 000570   100005 236100                    LDQ     5,,PR1
         8 000571   000477 756000 0                  STQ     Q

      559    12071
      560    12072        /****
      561    12073        *
      562    12074        *   Speed is a decimal integer <9 digits (wow!).  Presumably it is a
      563    12075        *   reasonable value such as 2400, 4800, etc.; however, this code allows
      564    12076        *   any value <1,000,000,000 to be specified.  The speed is encoded in
      565    12077        *   the file as a power of two:  0 indicates 75 baud or less (ugh!), 1 is
      566    12078        *   76-150 baud, 2 is 151-300 baud, 3 is 301-600 baud, etc.  Obviously,
      567    12079        *   then the speed is only an approximation, but that's all it's good for
      568    12080        *   anyway.
      569    12081        *
      570    12082        ****/
      571    12083
      572    12084    6                       IF Q->OUT$BLK.CODE>=%N_SPEED# THEN DO;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:79   

  12084  8 000572   000477 474400 0                  LDP4    Q
         8 000573   400000 724100                    LXL4    0,,PR4
         8 000574   000036 104003                    CMPX4   30,DU
         8 000575   000623 602000 8                  TNC     s:12100

      573    12085    6                          CALL CHARBIN(J,Q->OUT$SYM.TEXT);

  12085  8 000576   400004 236100                    LDQ     4,,PR4
         8 000577   000033 772000                    QRL     27
         8 000600   000000 625006                    EAX5    0,QL
         8 000601   000000 305540                    DTB
         8 000602   400004 230015                    NDSC9   4,,PR4                   cn=1,s=nosgn,sf=0,n=*X5
         8 000603   000502 000004 0                  NDSC9   J                        cn=0,s=lsgnf,sf=0,n=4

      574    12086    6                          APATH.SPEED=0;

  12086  8 000604   000000 226003                    LDX6    0,DU
         8 000605   300006 446100                    SXL6    6,,PR3

      575    12087    7                          DO WHILE(J>75);

  12087  8 000606   000502 235000 0                  LDA     J
         8 000607   000113 115007                    CMPA    75,DL
         8 000610   000624 604400 8                  TMOZ    s:12109

      576    12088    7                             J=J/2;

  12088  8 000611   000502 236000 0                  LDQ     J
         8 000612   000002 506007                    DIV     2,DL
         8 000613   000502 756000 0                  STQ     J

      577    12089    7                             APATH.SPEED=APATH.SPEED+1;

  12089  8 000614   000475 470400 0                  LDP0    PATHPTR
         8 000615   000006 720100                    LXL0    6,,PR0
         8 000616   000001 621010                    EAX1    1,X0
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:80   
         8 000617   000006 441100                    SXL1    6,,PR0

      578    12090    7                             END;

  12090  8 000620   000113 116007                    CMPQ    75,DL
         8 000621   000611 605400 8                  TPNZ    s:12088

      579    12091    6                          END;

  12091  8 000622   000624 710000 8                  TRA     s:12109

      580    12092
      581    12093        /****
      582    12094        *
      583    12095        *   If this is hardwire/dialup, just stow it.
      584    12096        *
      585    12097        ****/
      586    12098
      587    12099    5                       ELSE
      588    12100    5                          APATH.MODE=Q->OUT$BLK.CODE;

  12100  8 000623   300006 744100                    STX4    6,,PR3

      589    12101    5                       END;

      590    12102
      591    12103        /****
      592    12104        *
      593    12105        *   If both speed and mode were specified, process the other option.
      594    12106        *
      595    12107        ****/
      596    12108
      597    12109    5                    IF P->OUT$BLK.NSUBLKS>3 THEN DO;

  12109  8 000624   000476 470400 0                  LDP0    P
         8 000625   000001 220100                    LDX0    1,,PR0
         8 000626   000004 100003                    CMPX0   4,DU
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:81   
         8 000627   000666 602000 8                  TNC     s:12129

      598    12110    5                       Q=P->OUT$BLK.SUBLK$(3);

  12110  8 000630   000006 236100                    LDQ     6,,PR0
         8 000631   000477 756000 0                  STQ     Q

      599    12111    6                       IF Q->OUT$BLK.CODE>=%N_SPEED# THEN DO;

  12111  8 000632   000477 471400 0                  LDP1    Q
         8 000633   100000 721100                    LXL1    0,,PR1
         8 000634   000036 101003                    CMPX1   30,DU
         8 000635   000664 602000 8                  TNC     s:12120

      600    12112    6                          CALL CHARBIN(J,Q->OUT$SYM.TEXT);

  12112  8 000636   100004 236100                    LDQ     4,,PR1
         8 000637   000033 772000                    QRL     27
         8 000640   000000 622006                    EAX2    0,QL
         8 000641   000000 305540                    DTB
         8 000642   100004 230012                    NDSC9   4,,PR1                   cn=1,s=nosgn,sf=0,n=*X2
         8 000643   000502 000004 0                  NDSC9   J                        cn=0,s=lsgnf,sf=0,n=4

      601    12113    6                          APATH.SPEED=0;

  12113  8 000644   000000 223003                    LDX3    0,DU
         8 000645   000475 473400 0                  LDP3    PATHPTR
         8 000646   300006 443100                    SXL3    6,,PR3

      602    12114    7                          DO WHILE(J>75);

  12114  8 000647   000502 235000 0                  LDA     J
         8 000650   000113 115007                    CMPA    75,DL
         8 000651   000666 604400 8                  TMOZ    s:12129

      603    12115    7                             J=J/2;

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:82   
  12115  8 000652   000502 236000 0                  LDQ     J
         8 000653   000002 506007                    DIV     2,DL
         8 000654   000502 756000 0                  STQ     J

      604    12116    7                             APATH.SPEED=APATH.SPEED+1;

  12116  8 000655   000475 470400 0                  LDP0    PATHPTR
         8 000656   000006 720100                    LXL0    6,,PR0
         8 000657   000001 621010                    EAX1    1,X0
         8 000660   000006 441100                    SXL1    6,,PR0

      605    12117    7                             END;

  12117  8 000661   000113 116007                    CMPQ    75,DL
         8 000662   000652 605400 8                  TPNZ    s:12115

      606    12118    6                          END;

  12118  8 000663   000666 710000 8                  TRA     s:12129

      607    12119    5                       ELSE
      608    12120    5                          APATH.MODE=Q->OUT$BLK.CODE;

  12120  8 000664   000475 473400 0                  LDP3    PATHPTR
         8 000665   300006 741100                    STX1    6,,PR3

      609    12121    5                       END;

      610    12122
      611    12123        /****
      612    12124        *
      613    12125        *   Tally another path element attached to this node and move on.
      614    12126        *
      615    12127        ****/
      616    12128
      617    12129    4                    ANODE.COUNT=ANODE.COUNT+1;

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:83   
  12129  8 000666   000474 470400 0                  LDP0    NODEPTR
         8 000667   000000 101500                    MRL     fill='000'O
         8 000670   000002 400002                    ADSC9   2,,PR0                   cn=2,n=2
         8 000671   000741 000004 0                  ADSC9   U2+9                     cn=0,n=4
         8 000672   000741 236000 0                  LDQ     U2+9
         8 000673   000001 036007                    ADLQ    1,DL
         8 000674   000740 756000 0                  STQ     U2+8
         8 000675   000100 101400                    MRL     fill='000'O
         8 000676   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 000677   000002 400002                    ADSC9   2,,PR0                   cn=2,n=2

      618    12130    4                    PATHPTR=PINCRW(PATHPTR,SIZEW(APATH));

  12130  8 000700   000475 236000 0                  LDQ     PATHPTR
         8 000701   000010 036003                    ADLQ    8,DU
         8 000702   000475 756000 0                  STQ     PATHPTR

      619    12131    4                    WDSLEFT=WDSLEFT-SIZEW(APATH);

  12131  8 000703   000010 336007                    LCQ     8,DL
         8 000704   000511 056000 0                  ASQ     WDSLEFT

      620    12132
      621    12133    4                    END;

      622    12134    3                 I=I+1;

  12134  8 000705   000501 054000 0                  AOS     I

      623    12135
      624    12136    3                 END /* of path suboption loop */;

  12136  8 000706   000473 470400 0                  LDP0    BLK$
         8 000707   000001 236100                    LDQ     1,,PR0
         8 000710   000022 772000                    QRL     18
         8 000711   000501 116000 0                  CMPQ    I
         8 000712   000433 605400 8                  TPNZ    s:12007
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:84   

      625    12137
      626    12138        /****
      627    12139        *
      628    12140        *   Point to more freespace and count another node processed.
      629    12141        *
      630    12142        ****/
      631    12143
      632    12144    2              NODEPTR=PATHPTR;

  12144  8 000713   000475 236000 0                  LDQ     PATHPTR
         8 000714   000474 756000 0                  STQ     NODEPTR

      633    12145    2              NODECNT=NODECNT+1;

  12145  8 000715   000510 054000 0                  AOS     NODECNT

      634    12146    2              GOTO READ_COMMAND;

  12146  8 000716   000102 710000 8                  TRA     READ_COMMAND

      635    12147
      636    12148        /****
      637    12149        *
      638    12150        *   We were unable to expand memory to hold all the tables.
      639    12151        *
      640    12152        ****/
      641    12153
      642    12154    2   ERR_MEM:
      643    12155    2              CALL XUR$ERRMSG(%E$VWN_OUTMEM);

  12155  8 000717   000045 630400 9     ERR_MEM      EPPR0   37
         8 000720   000000 631400 9                  EPPR1   0
         8 000721   000000 701000 xent               TSX1    XUR$ERRMSG
         8 000722   000000 011000                    NOP     0

      644    12156    2              FPT_EXIT.V.STEPCC#=4;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:85   

  12156  8 000723   004000 236003                    LDQ     2048,DU
         8 000724   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      645    12157    2              CALL M$EXIT(FPT_EXIT);

  12157  8 000725   000322 630400 0                  EPPR0   FPT_EXIT
         8 000726   000001 713400                    CLIMB   exit
         8 000727   400400 401760                    pmme    nvectors=2
         8 000730   002246 710000 8                  TRA     FILE_BUILT

      646    12158
      647    12159        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:86   
      648    12160        /****
      649    12161        *
      650    12162        *   Do END processing.  Check that IAM and at least one NODE command
      651    12163        *   have been entered; then sequentially read the :NODES file we
      652    12164        *   have open for the synonym records to ensure that each of them is
      653    12165        *   defined by a NODE command (in memory).
      654    12166        *
      655    12167        ****/
      656    12168
      657    12169    2              SELECT(%N_END#);

      658    12170
      659    12171        /****
      660    12172        *
      661    12173        *   Is IAM defined?  We must know our identity.
      662    12174        *
      663    12175        ****/
      664    12176
      665    12177    3              IF IAM=' ' THEN DO;

  12177  8 000731   000712 237000 0                  LDAQ    IAM
         8 000732   000024 117000 9                  CMPAQ   20
         8 000733   000742 601000 8                  TNZ     s:12189

      666    12178    3                 CALL XUR$ERRMSG(%E$VWN_WHOAMI);

  12178  8 000734   000047 630400 9                  EPPR0   39
         8 000735   000000 631400 9                  EPPR1   0
         8 000736   000000 701000 xent               TSX1    XUR$ERRMSG
         8 000737   000000 011000                    NOP     0

      667    12179    3                 FPT_EXIT.V.STEPCC#=4;

  12179  8 000740   004000 236003                    LDQ     2048,DU
         8 000741   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      668    12180    3                 END;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:87   

      669    12181
      670    12182        /****
      671    12183        *
      672    12184        *   We must also be connected to someone else, otherwise this is a
      673    12185        *   nowhere network.
      674    12186        *
      675    12187        ****/
      676    12188
      677    12189    3              IF NODECNT=0 THEN DO;

  12189  8 000742   000510 235000 0                  LDA     NODECNT
         8 000743   000755 601000 8                  TNZ     s:12203

      678    12190    3                 CALL XUR$ERRMSG(%E$VWN_NONODE);

  12190  8 000744   000051 630400 9                  EPPR0   41
         8 000745   000000 631400 9                  EPPR1   0
         8 000746   000000 701000 xent               TSX1    XUR$ERRMSG
         8 000747   000000 011000                    NOP     0

      679    12191    3                 FPT_EXIT.V.STEPCC#=4;

  12191  8 000750   004000 236003                    LDQ     2048,DU
         8 000751   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      680    12192    3                 CALL M$EXIT(FPT_EXIT);

  12192  8 000752   000322 630400 0                  EPPR0   FPT_EXIT
         8 000753   000001 713400                    CLIMB   exit
         8 000754   400400 401760                    pmme    nvectors=2

      681    12193    3                 END;

      682    12194
      683    12195        /****
      684    12196        *
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:88   
      685    12197        *   Rewind the :NODES file and read it sequentially.  Then compare the
      686    12198        *   data portion (which is a node name) to the nodes defined in memory
      687    12199        *   to ensure that all the synonyms define real nodes.
      688    12200        *
      689    12201        ****/
      690    12202
      691    12203    2              CALL M$PFIL(PFIL_NODE);

  12203  8 000755   000216 630400 0                  EPPR0   PFIL_NODE
         8 000756   040004 713400                    CLIMB   16388
         8 000757   400000 401760                    pmme    nvectors=1

      692    12204    3              DO WHILE('1'B);

      693    12205    3                 CALL M$READ(READ_SEQUEN) ALTRET(EOF_SYNON);

  12205  8 000760   000200 630400 0                  EPPR0   READ_SEQUEN
         8 000761   440000 713400                    CLIMB   alt,read
         8 000762   401400 401760                    pmme    nvectors=4
         8 000763   001044 702000 8                  TSX2    EOF_SYNON

      694    12206    3                 P=VLP_VECTOR.PTR$;

  12206  8 000764   000321 236000 0                  LDQ     VLP_VECTOR+1
         8 000765   000476 756000 0                  STQ     P

      695    12207    4                 DO WHILE(POFFW(NODEPTR,P)~=0);

  12207  8 000766   001005 710000 8                  TRA     s:12211

      696    12208    4                    IF NODEREC=P->ANODE.NAME THEN

  12208  8 000767   000476 470400 0                  LDP0    P
         8 000770   040100 106400                    CMPC    fill='040'O
         8 000771   000155 000026 0                  ADSC9   NODEOVR                  cn=0,n=22
         8 000772   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         8 000773   001043 600000 8                  TZE     YES_SYNON
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:89   

      697    12209    4                       GOTO YES_SYNON;
      698    12210    4                    P=PINCRW(P,P->ANODE.COUNT*SIZEW(APATH)+SIZEW(ANODE));

  12210  8 000774   000000 100500                    MLR     fill='000'O
         8 000775   000002 400002                    ADSC9   2,,PR0                   cn=2,n=2
         8 000776   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 000777   000740 220000 0                  LDX0    U2+8
         8 001000   000000 636010                    EAQ     0,X0
         8 001001   000003 736000                    QLS     3
         8 001002   000003 036003                    ADLQ    3,DU
         8 001003   000476 036000 0                  ADLQ    P
         8 001004   000476 756000 0                  STQ     P

      699    12211    4                    END;

  12211  8 001005   000476 235000 0                  LDA     P
         8 001006   000022 771000                    ARL     18
         8 001007   000740 755000 0                  STA     U2+8
         8 001010   000474 236000 0                  LDQ     NODEPTR
         8 001011   000022 772000                    QRL     18
         8 001012   000740 136000 0                  SBLQ    U2+8
         8 001013   000767 601000 8                  TNZ     s:12208

      700    12212
      701    12213        /****
      702    12214        *
      703    12215        *   If we fall off the end of the list, this node is undefined.
      704    12216        *
      705    12217        ****/
      706    12218
      707    12219    3                 CALL INDEX(I,' ',NODEREC,0);

  12219  8 001014   000000 124400                    SCM     mask='000'O
         8 001015   000155 000026 0                  ADSC9   NODEOVR                  cn=0,n=22
         8 001016   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001017   000501 000000 0                  ARG     I
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:90   

      708    12220    3                 U1.L=I;

  12220  8 001020   000501 236000 0                  LDQ     I
         8 001021   000033 736000                    QLS     27
         8 001022   000720 552040 0                  STBQ    U1,'40'O

      709    12221    3                 U1.C=SUBSTR(NODEREC,0,I);

  12221  8 001023   000501 720000 0                  LXL0    I
         8 001024   040000 100440                    MLR     fill='040'O
         8 001025   000155 000010 0                  ADSC9   NODEOVR                  cn=0,n=*X0
         8 001026   000720 200037 0                  ADSC9   U1                       cn=1,n=31

      710    12222    3                 CALL XUR$ERRMSG(%E$VWN_UNDNOD,,,VECTOR(U1));

  12222  8 001027   000055 236000 9                  LDQ     45
         8 001030   000003 235000 9                  LDA     3
         8 001031   000742 757000 0                  STAQ    U2+10
         8 001032   000003 236000 9                  LDQ     3
         8 001033   000056 235000 9                  LDA     46
         8 001034   000740 757000 0                  STAQ    U2+8
         8 001035   000740 630400 0                  EPPR0   U2+8
         8 001036   000013 631400 9                  EPPR1   11
         8 001037   000000 701000 xent               TSX1    XUR$ERRMSG
         8 001040   000000 011000                    NOP     0

      711    12223    3                 FPT_EXIT.V.STEPCC#=4;

  12223  8 001041   004000 236003                    LDQ     2048,DU
         8 001042   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

  12223  8 001043                       YES_SYNON    null
      712    12224
      713    12225        /****
      714    12226        *
      715    12227        *   This synonym is properly defined.
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:91   
      716    12228        *
      717    12229        ****/
      718    12230
      719    12231    3   YES_SYNON:    ;
      720    12232    3                 END;

  12232  8 001043   000760 710000 8                  TRA     s:12205

      721    12233
      722    12234        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:92   
      723    12235        /****
      724    12236        *
      725    12237        *   Verify that all the destination nodes have been defined.  Do this by
      726    12238        *   walking through all the node path sub-options and making sure that a
      727    12239        *   node header exists by the name specified.
      728    12240        *
      729    12241        ****/
      730    12242
      731    12243    2   EOF_SYNON:
      732    12244    2              P=VLP_VECTOR.PTR$;

  12244  8 001044   000321 236000 0     EOF_SYNON    LDQ     VLP_VECTOR+1
         8 001045   000476 756000 0                  STQ     P

      733    12245
      734    12246        /****
      735    12247        *
      736    12248        *   NODEPTR marks the beginning of freespace, so it also marks the end
      737    12249        *   of the memory tables.
      738    12250        *
      739    12251        ****/
      740    12252
      741    12253    3              DO WHILE(POFFW(NODEPTR,P)~=0);

  12253  8 001046   001340 710000 8                  TRA     s:12349

      742    12254
      743    12255        /****
      744    12256        *
      745    12257        *   Pick up the pointer to the IAM node on the way.  We'll use this later.
      746    12258        *
      747    12259        ****/
      748    12260
      749    12261    3                 IF IAM=P->ANODE.NAME THEN

  12261  8 001047   000476 470400 0                  LDP0    P
         8 001050   040100 106400                    CMPC    fill='040'O
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:93   
         8 001051   000712 000010 0                  ADSC9   IAM                      cn=0,n=8
         8 001052   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         8 001053   001056 601000 8                  TNZ     s:12272

      750    12262    3                    IAMPTR=P;

  12262  8 001054   000476 236000 0                  LDQ     P
         8 001055   000472 756000 0                  STQ     IAMPTR

      751    12263
      752    12264        /****
      753    12265        *
      754    12266        *   Point to the path sub-option list for this node, then walk through it
      755    12267        *   comparing the node names to all the node names in memory until a match
      756    12268        *   is found.
      757    12269        *
      758    12270        ****/
      759    12271
      760    12272    3                 Q=PINCRW(P,SIZEW(ANODE));

  12272  8 001056   000476 236000 0                  LDQ     P
         8 001057   000003 036003                    ADLQ    3,DU
         8 001060   000477 756000 0                  STQ     Q

      761    12273    3                 I=0;

  12273  8 001061   000501 450000 0                  STZ     I

      762    12274    4                 DO WHILE(I<P->ANODE.COUNT);

  12274  8 001062   000000 101500                    MRL     fill='000'O
         8 001063   000002 400002                    ADSC9   2,,PR0                   cn=2,n=2
         8 001064   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 001065   000740 236000 0                  LDQ     U2+8
         8 001066   000501 116000 0                  CMPQ    I
         8 001067   001336 604400 8                  TMOZ    s:12348

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:94   
      763    12275    4                    R=VLP_VECTOR.PTR$;

  12275  8 001070   000321 236000 0                  LDQ     VLP_VECTOR+1
         8 001071   000500 756000 0                  STQ     R

      764    12276    5                    DO WHILE(POFFW(NODEPTR,R)~=0);

  12276  8 001072   001112 710000 8                  TRA     s:12280

      765    12277    5                       IF R->ANODE.NAME=Q->APATH.DEST THEN

  12277  8 001073   000500 470400 0                  LDP0    R
         8 001074   000477 471400 0                  LDP1    Q
         8 001075   040100 106500                    CMPC    fill='040'O
         8 001076   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         8 001077   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         8 001100   001151 600000 8                  TZE     YES_DEST

      766    12278    5                          GOTO YES_DEST;
      767    12279    5                       R=PINCRW(R,R->ANODE.COUNT*SIZEW(APATH)+SIZEW(ANODE));

  12279  8 001101   000000 100500                    MLR     fill='000'O
         8 001102   000002 400002                    ADSC9   2,,PR0                   cn=2,n=2
         8 001103   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 001104   000740 220000 0                  LDX0    U2+8
         8 001105   000000 636010                    EAQ     0,X0
         8 001106   000003 736000                    QLS     3
         8 001107   000003 036003                    ADLQ    3,DU
         8 001110   000500 036000 0                  ADLQ    R
         8 001111   000500 756000 0                  STQ     R

      768    12280    5                       END;

  12280  8 001112   000500 235000 0                  LDA     R
         8 001113   000022 771000                    ARL     18
         8 001114   000740 755000 0                  STA     U2+8
         8 001115   000474 236000 0                  LDQ     NODEPTR
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:95   
         8 001116   000022 772000                    QRL     18
         8 001117   000740 136000 0                  SBLQ    U2+8
         8 001120   001073 601000 8                  TNZ     s:12277

      769    12281
      770    12282        /****
      771    12283        *
      772    12284        *   If we fall off the end of the list, this node isn't defined.
      773    12285        *
      774    12286        ****/
      775    12287
      776    12288    4                    CALL INDEX(J,' ',Q->APATH.DEST,0);

  12288  8 001121   000477 470400 0                  LDP0    Q
         8 001122   000000 124500                    SCM     mask='000'O
         8 001123   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         8 001124   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001125   000502 000000 0                  ARG     J

      777    12289    4                    U1.L=J;

  12289  8 001126   000502 236000 0                  LDQ     J
         8 001127   000033 736000                    QLS     27
         8 001130   000720 552040 0                  STBQ    U1,'40'O

      778    12290    4                    U1.C=SUBSTR(Q->APATH.DEST,0,J);

  12290  8 001131   000502 720000 0                  LXL0    J
         8 001132   040000 100540                    MLR     fill='040'O
         8 001133   000002 000010                    ADSC9   2,,PR0                   cn=0,n=*X0
         8 001134   000720 200037 0                  ADSC9   U1                       cn=1,n=31

      779    12291    4                    CALL XUR$ERRMSG(%E$VWN_UNDNOD,,,VECTOR(U1));

  12291  8 001135   000055 236000 9                  LDQ     45
         8 001136   000003 235000 9                  LDA     3
         8 001137   000742 757000 0                  STAQ    U2+10
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:96   
         8 001140   000003 236000 9                  LDQ     3
         8 001141   000056 235000 9                  LDA     46
         8 001142   000740 757000 0                  STAQ    U2+8
         8 001143   000740 630400 0                  EPPR0   U2+8
         8 001144   000013 631400 9                  EPPR1   11
         8 001145   000000 701000 xent               TSX1    XUR$ERRMSG
         8 001146   000000 011000                    NOP     0

      780    12292    4                    FPT_EXIT.V.STEPCC#=4;

  12292  8 001147   004000 236003                    LDQ     2048,DU
         8 001150   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      781    12293
      782    12294        /****
      783    12295        *
      784    12296        *   Check to ensure that the path type matches the type of the destination
      785    12297        *   node.  Paths to EXTERNAL nodes must be via disk directories, and paths
      786    12298        *   to non-EXTERNAL must not be.
      787    12299        *
      788    12300        ****/
      789    12301    4   YES_DEST:
      790    12302    4                    IF Q -> APATH.ACCT = ' '

  12302  8 001151   000477 470400 0     YES_DEST     LDP0    Q
         8 001152   040000 106500                    CMPC    fill='040'O
         8 001153   000004 000010                    ADSC9   4,,PR0                   cn=0,n=8
         8 001154   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001155   001234 601000 8                  TNZ     s:12315
         8 001156   000500 471400 0                  LDP1    R
         8 001157   000000 101500                    MRL     fill='000'O
         8 001160   100002 200001                    ADSC9   2,,PR1                   cn=1,n=1
         8 001161   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 001162   000740 236000 0                  LDQ     U2+8
         8 001163   000157 116007                    CMPQ    111,DL
         8 001164   001234 601000 8                  TNZ     s:12315

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:97   
      791    12303    4                      AND R -> ANODE.TYPE = %N_EXTERNAL#
      792    12304    5                    THEN DO;

      793    12305    5                       CALL INDEX (J, ' ', P -> ANODE.NAME);

  12305  8 001165   000476 473400 0                  LDP3    P
         8 001166   000000 124500                    SCM     mask='000'O
         8 001167   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
         8 001170   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001171   000502 000000 0                  ARG     J

      794    12306    5                       U1.L = J;

  12306  8 001172   000502 236000 0                  LDQ     J
         8 001173   000033 736000                    QLS     27
         8 001174   000720 552040 0                  STBQ    U1,'40'O

      795    12307    5                       U1.C = P -> ANODE.NAME;

  12307  8 001175   040000 100500                    MLR     fill='040'O
         8 001176   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
         8 001177   000720 200037 0                  ADSC9   U1                       cn=1,n=31

      796    12308    5                       CALL INDEX (J, ' ', R -> ANODE.NAME);

  12308  8 001200   000000 124500                    SCM     mask='000'O
         8 001201   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         8 001202   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001203   000502 000000 0                  ARG     J

      797    12309    5                       U2.L = J;

  12309  8 001204   000502 236000 0                  LDQ     J
         8 001205   000033 736000                    QLS     27
         8 001206   000730 552040 0                  STBQ    U2,'40'O

      798    12310    5                       U2.C = R -> ANODE.NAME;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:98   

  12310  8 001207   040000 100500                    MLR     fill='040'O
         8 001210   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         8 001211   000730 200037 0                  ADSC9   U2                       cn=1,n=31

      799    12311    5                       CALL XUR$ERRMSG (%E$VWN_ISEXTERNAL,,,VECTOR(U2),VECTOR(U1));

  12311  8 001212   000055 236000 9                  LDQ     45
         8 001213   000744 756000 0                  STQ     U2+12
         8 001214   000064 236000 9                  LDQ     52
         8 001215   000003 235000 9                  LDA     3
         8 001216   000742 757000 0                  STAQ    U2+10
         8 001217   000003 236000 9                  LDQ     3
         8 001220   000065 235000 9                  LDA     53
         8 001221   000740 757000 0                  STAQ    U2+8
         8 001222   000740 630400 0                  EPPR0   U2+8
         8 001223   000062 631400 9                  EPPR1   50
         8 001224   000000 701000 xent               TSX1    XUR$ERRMSG
         8 001225   000000 011000                    NOP     0

      800    12312    5                       FPT_EXIT.V.STEPCC#=4;

  12312  8 001226   004000 236003                    LDQ     2048,DU
         8 001227   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      801    12313    5                       Q -> APATH.ACCT = 'BLORTCH!';

  12313  8 001230   000477 470400 0                  LDP0    Q
         8 001231   000054 237000 3                  LDAQ    ERRMSGFID+10
         8 001232   000004 755100                    STA     4,,PR0
         8 001233   000005 756100                    STQ     5,,PR0

      802    12314    5                       END;

      803    12315    4                    IF Q -> APATH.ACCT ~= ' '

  12315  8 001234   040000 106500                    CMPC    fill='040'O
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:99   
         8 001235   000004 000010                    ADSC9   4,,PR0                   cn=0,n=8
         8 001236   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001237   001321 600000 8                  TZE     s:12337
         8 001240   000500 471400 0                  LDP1    R
         8 001241   000000 101500                    MRL     fill='000'O
         8 001242   100002 200001                    ADSC9   2,,PR1                   cn=1,n=1
         8 001243   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 001244   000740 236000 0                  LDQ     U2+8
         8 001245   000157 116007                    CMPQ    111,DL
         8 001246   001321 600000 8                  TZE     s:12337

      804    12316    4                      AND R -> ANODE.TYPE ~= %N_EXTERNAL#
      805    12317    5                    THEN DO;

      806    12318    5                       CALL INDEX (J, ' ', P -> ANODE.NAME);

  12318  8 001247   000476 473400 0                  LDP3    P
         8 001250   000000 124500                    SCM     mask='000'O
         8 001251   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
         8 001252   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001253   000502 000000 0                  ARG     J

      807    12319    5                       U1.L = J;

  12319  8 001254   000502 236000 0                  LDQ     J
         8 001255   000033 736000                    QLS     27
         8 001256   000720 552040 0                  STBQ    U1,'40'O

      808    12320    5                       U1.C = P -> ANODE.NAME;

  12320  8 001257   040000 100500                    MLR     fill='040'O
         8 001260   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
         8 001261   000720 200037 0                  ADSC9   U1                       cn=1,n=31

      809    12321    5                       CALL INDEX (J, ' ', R -> ANODE.NAME);

  12321  8 001262   000000 124500                    SCM     mask='000'O
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:100  
         8 001263   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         8 001264   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001265   000502 000000 0                  ARG     J

      810    12322    5                       U2.L = J;

  12322  8 001266   000502 236000 0                  LDQ     J
         8 001267   000033 736000                    QLS     27
         8 001270   000730 552040 0                  STBQ    U2,'40'O

      811    12323    5                       U2.C = R -> ANODE.NAME;

  12323  8 001271   040000 100500                    MLR     fill='040'O
         8 001272   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         8 001273   000730 200037 0                  ADSC9   U2                       cn=1,n=31

      812    12324    5                       CALL XUR$ERRMSG (%E$VWN_NOTEXTERNAL,,,VECTOR(U1),VECTOR(U2));

  12324  8 001274   000064 236000 9                  LDQ     52
         8 001275   000744 756000 0                  STQ     U2+12
         8 001276   000055 236000 9                  LDQ     45
         8 001277   000003 235000 9                  LDA     3
         8 001300   000742 757000 0                  STAQ    U2+10
         8 001301   000003 236000 9                  LDQ     3
         8 001302   000067 235000 9                  LDA     55
         8 001303   000740 757000 0                  STAQ    U2+8
         8 001304   000740 630400 0                  EPPR0   U2+8
         8 001305   000062 631400 9                  EPPR1   50
         8 001306   000000 701000 xent               TSX1    XUR$ERRMSG
         8 001307   000000 011000                    NOP     0

      813    12325    5                       FPT_EXIT.V.STEPCC#=4;

  12325  8 001310   004000 236003                    LDQ     2048,DU
         8 001311   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      814    12326    5                       R=ADDR(NIL);
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:101  

  12326  8 001312   000003 236000 9                  LDQ     3
         8 001313   000500 756000 0                  STQ     R

      815    12327    5                       Q -> APATH.ACCT = ' ';

  12327  8 001314   000477 470400 0                  LDP0    Q
         8 001315   000005 235000 9                  LDA     5
         8 001316   000005 236000 9                  LDQ     5
         8 001317   000004 755100                    STA     4,,PR0
         8 001320   000005 756100                    STQ     5,,PR0

      816    12328    5                       END;

      817    12329
      818    12330        /****
      819    12331        *
      820    12332        *   This path is properly defined, move on to the next one.  Build a chain
      821    12333        *   of nodes through memory to save searching for them again later.
      822    12334        *
      823    12335        ****/
      824    12336
      825    12337    4                    Q->APATH.PTR$=R;

  12337  8 001321   000500 236000 0                  LDQ     R
         8 001322   000007 756100                    STQ     7,,PR0

      826    12338    4                    I=I+1;

  12338  8 001323   000501 054000 0                  AOS     I

      827    12339    4                    Q=PINCRW(Q,SIZEW(APATH));

  12339  8 001324   000477 236000 0                  LDQ     Q
         8 001325   000010 036003                    ADLQ    8,DU
         8 001326   000477 756000 0                  STQ     Q

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:102  
      828    12340    4                    END;

  12340  8 001327   000476 470400 0                  LDP0    P
         8 001330   000000 101500                    MRL     fill='000'O
         8 001331   000002 400002                    ADSC9   2,,PR0                   cn=2,n=2
         8 001332   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 001333   000740 236000 0                  LDQ     U2+8
         8 001334   000501 116000 0                  CMPQ    I
         8 001335   001070 605400 8                  TPNZ    s:12275

      829    12341
      830    12342        /****
      831    12343        *
      832    12344        *   Move on to the next node header.
      833    12345        *
      834    12346        ****/
      835    12347
      836    12348    3                 P=Q;

  12348  8 001336   000477 236000 0                  LDQ     Q
         8 001337   000476 756000 0                  STQ     P

      837    12349    3                 END;

  12349  8 001340   000476 235000 0                  LDA     P
         8 001341   000022 771000                    ARL     18
         8 001342   000740 755000 0                  STA     U2+8
         8 001343   000474 236000 0                  LDQ     NODEPTR
         8 001344   000022 772000                    QRL     18
         8 001345   000740 136000 0                  SBLQ    U2+8
         8 001346   001047 601000 8                  TNZ     s:12261

      838    12350
      839    12351        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:103  
      840    12352        /****
      841    12353        *
      842    12354        *   Verify that the IAM command has been entered; if so, we have
      843    12355        *   passed all the validity checks.  Write the *IAM record to the
      844    12356        *   file and start the path report/node building process.
      845    12357        *
      846    12358        ****/
      847    12359
      848    12360    3              IF IAMPTR=ADDR(NIL) THEN DO;

  12360  8 001347   000472 236000 0                  LDQ     IAMPTR
         8 001350   000003 116000 9                  CMPQ    3
         8 001351   001360 601000 8                  TNZ     s:12372

      849    12361    3                 CALL XUR$ERRMSG(%E$VWN_IAMUND);

  12361  8 001352   000071 630400 9                  EPPR0   57
         8 001353   000000 631400 9                  EPPR1   0
         8 001354   000000 701000 xent               TSX1    XUR$ERRMSG
         8 001355   000000 011000                    NOP     0

      850    12362    3                 FPT_EXIT.V.STEPCC#=4;

  12362  8 001356   004000 236003                    LDQ     2048,DU
         8 001357   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

      851    12363    3                 END;

      852    12364
      853    12365        /****
      854    12366        *
      855    12367        *   If errors have occurred, don't process farther, since we're likely
      856    12368        *   to get all bolixed up trying to trace paths to non-existent nodes.
      857    12369        *
      858    12370        ****/
      859    12371
      860    12372    3              IF FPT_EXIT.V.STEPCC#>0 THEN DO;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:104  

  12372  8 001360   000326 236000 0                  LDQ     FPT_EXIT+4
         8 001361   777000 316003                    CANQ    -512,DU
         8 001362   001372 600000 8                  TZE     s:12383

      861    12373    3                 CALL XUR$ERRMSG(%E$VWN_GIVEUP);

  12373  8 001363   000073 630400 9                  EPPR0   59
         8 001364   000000 631400 9                  EPPR1   0
         8 001365   000000 701000 xent               TSX1    XUR$ERRMSG
         8 001366   000000 011000                    NOP     0

      862    12374    3                 CALL M$EXIT(FPT_EXIT);

  12374  8 001367   000322 630400 0                  EPPR0   FPT_EXIT
         8 001370   000001 713400                    CLIMB   exit
         8 001371   400400 401760                    pmme    nvectors=2

      863    12375    3                 END;

      864    12376
      865    12377        /****
      866    12378        *
      867    12379        *   Write the *IAM synonym record and its companion, LOCAL.
      868    12380        *
      869    12381        ****/
      870    12382
      871    12383    2              NODEKEY.C='*IAM';

  12383  8 001372   040000 100400                    MLR     fill='040'O
         8 001373   000056 000004 3                  ADSC9   ERRMSGFID+12             cn=0,n=4
         8 001374   000152 200010 0                  ADSC9   NODEKEY                  cn=1,n=8

      872    12384    2              NODEKEY.L=8;

  12384  8 001375   010000 236003                    LDQ     4096,DU
         8 001376   000152 552040 0                  STBQ    NODEKEY,'40'O
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:105  

      873    12385    2              NODEREC=IAM;

  12385  8 001377   040000 100400                    MLR     fill='040'O
         8 001400   000712 000010 0                  ADSC9   IAM                      cn=0,n=8
         8 001401   000155 000026 0                  ADSC9   NODEOVR                  cn=0,n=22

      874    12386    2              WRITE_NODE.BUF_.BOUND=7;

  12386  8 001402   000170 236000 0                  LDQ     WRITE_NODE+4
         8 001403   177777 376007                    ANQ     65535,DL
         8 001404   000030 276000 9                  ORQ     24
         8 001405   000170 756000 0                  STQ     WRITE_NODE+4

      875    12387    2              CALL M$WRITE(WRITE_NODE) ALTRET(ERR_OUT);

  12387  8 001406   000164 630400 0                  EPPR0   WRITE_NODE
         8 001407   440001 713400                    CLIMB   alt,write
         8 001410   401400 401760                    pmme    nvectors=4
         8 001411   002336 702000 8                  TSX2    ERR_OUT

      876    12388    2              NODEKEY.C='LOCAL';

  12388  8 001412   040000 100400                    MLR     fill='040'O
         8 001413   000057 000005 3                  ADSC9   ERRMSGFID+13             cn=0,n=5
         8 001414   000152 200010 0                  ADSC9   NODEKEY                  cn=1,n=8

      877    12389    2              CALL M$WRITE(WRITE_NODE) ALTRET(ERR_OUT);

  12389  8 001415   000164 630400 0                  EPPR0   WRITE_NODE
         8 001416   440001 713400                    CLIMB   alt,write
         8 001417   401400 401760                    pmme    nvectors=4
         8 001420   002336 702000 8                  TSX2    ERR_OUT

      878    12390
      879    12391        /****
      880    12392        *
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:106  
      881    12393        *   That's all we write for this node, so flag it as done.
      882    12394        *
      883    12395        ****/
      884    12396
      885    12397    2              IAMPTR->ANODE.DONE='1'B;

  12397  8 001421   000472 470400 0                  LDP0    IAMPTR
         8 001422   003100 060400                    CSL     bolr='003'O
         8 001423   000074 000001 9                  BDSC    60                       by=0,bit=0,n=1
         8 001424   000002 000001                    BDSC    2,,PR0                   by=0,bit=0,n=1

      886    12398    2              NODECNT=NODECNT-1;

  12398  8 001425   000001 336007                    LCQ     1,DL
         8 001426   000510 056000 0                  ASQ     NODECNT

      887    12399
      888    12400        /****
      889    12401        *
      890    12402        *   Print out the report header.
      891    12403        *
      892    12404        ****/
      893    12405
      894    12406    2              CALL INDEX(I,' ',IAM,0);

  12406  8 001427   000000 124400                    SCM     mask='000'O
         8 001430   000712 000010 0                  ADSC9   IAM                      cn=0,n=8
         8 001431   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001432   000501 000000 0                  ARG     I

      895    12407    2              U1.L=I;

  12407  8 001433   000501 236000 0                  LDQ     I
         8 001434   000033 736000                    QLS     27
         8 001435   000720 552040 0                  STBQ    U1,'40'O

      896    12408    2              U1.C=SUBSTR(IAM,0,I);
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:107  

  12408  8 001436   000501 720000 0                  LXL0    I
         8 001437   040000 100440                    MLR     fill='040'O
         8 001440   000712 000010 0                  ADSC9   IAM                      cn=0,n=*X0
         8 001441   000720 200037 0                  ADSC9   U1                       cn=1,n=31

      897    12409    2              CALL XUR$ERRMSG(%E$VWN_PTHLN1,,DCBNUM(M$LO),VECTOR(U1));

  12409  8 001442   000000 236007 xsym               LDQ     M$LO,DL
         8 001443   000740 756000 0                  STQ     U2+8
         8 001444   000055 236000 9                  LDQ     45
         8 001445   000745 756000 0                  STQ     U2+13
         8 001446   000740 631400 0                  EPPR1   U2+8
         8 001447   000744 451400 0                  STP1    U2+12
         8 001450   000003 236000 9                  LDQ     3
         8 001451   000076 235000 9                  LDA     62
         8 001452   000742 757000 0                  STAQ    U2+10
         8 001453   000742 630400 0                  EPPR0   U2+10
         8 001454   000013 631400 9                  EPPR1   11
         8 001455   000000 701000 xent               TSX1    XUR$ERRMSG
         8 001456   000000 011000                    NOP     0

      898    12410
      899    12411        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:108  
      900    12412        /****
      901    12413        *
      902    12414        *   Creating the :NODES records involves chasing paths from the top
      903    12415        *   (IAM) node through the PATH sub-records until the desired level
      904    12416        *   (MAXLVL) is reached.  If the node at MAXLVL is not flagged as
      905    12417        *   "DONE", this (chain of) path(s) is the shortest distance from
      906    12418        *   IAM to this node.  Only the first path in the chain is written
      907    12419        *   to the :NODES file, since it is assumed that the node at the end
      908    12420        *   of that path knows the name of the next path, etc.  The path
      909    12421        *   chains are run from MAXLVL=1 to the depth necessary to find a
      910    12422        *   path to all the nodes defined, up to a maximum of MAXLVL=63.
      911    12423        *
      912    12424        ****/
      913    12425
      914    12426    2              MAXLVL=1;

  12426  8 001457   000001 235007                    LDA     1,DL
         8 001460   000507 755000 0                  STA     MAXLVL

      915    12427
      916    12428        /****
      917    12429        *
      918    12430        *   When the node count reaches 0, we have located paths to all the
      919    12431        *   nodes defined.
      920    12432        *
      921    12433        ****/
      922    12434
      923    12435    3              DO WHILE(NODECNT>0);

  12435  8 001461   000510 236000 0                  LDQ     NODECNT
         8 001462   002246 604400 8                  TMOZ    FILE_BUILT

      924    12436    3                 LVL=0;

  12436  8 001463   000506 450000 0                  STZ     LVL

      925    12437    3                 P=IAMPTR;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:109  

  12437  8 001464   000472 236000 0                  LDQ     IAMPTR
         8 001465   000476 756000 0                  STQ     P

      926    12438
      927    12439        /****
      928    12440        *
      929    12441        *   When we reach a node, mark it as "visited".  Since the network is
      930    12442        *   rarely a nice tree (more like a bush), this stops us from going
      931    12443        *   around in circles.  If we encounter a visited node on the way down,
      932    12444        *   there's no point in going further, since we've already been here.
      933    12445        *
      934    12446        ****/
      935    12447
      936    12448    3   PUSH:
      937    12449    3                 P->ANODE.VISIT='1'B;

  12449  8 001466   000476 470400 0     PUSH         LDP0    P
         8 001467   003100 060400                    CSL     bolr='003'O
         8 001470   000074 000001 9                  BDSC    60                       by=0,bit=0,n=1
         8 001471   000002 010001                    BDSC    2,,PR0                   by=0,bit=1,n=1

      938    12450
      939    12451        /****
      940    12452        *
      941    12453        *   Walk down MAXLVL steps via each path.
      942    12454        *
      943    12455        ****/
      944    12456
      945    12457    3                 I=0;

  12457  8 001472   000501 450000 0                  STZ     I

      946    12458    4                 DO WHILE(I<P->ANODE.COUNT);

  12458  8 001473   000000 101500                    MRL     fill='000'O
         8 001474   000002 400002                    ADSC9   2,,PR0                   cn=2,n=2
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:110  
         8 001475   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 001476   000740 236000 0                  LDQ     U2+8
         8 001477   000501 116000 0                  CMPQ    I
         8 001500   002227 604400 8                  TMOZ    s:12727

      947    12459
      948    12460        /****
      949    12461        *
      950    12462        *   Record the path information (a pointer to the header and the
      951    12463        *   offset (index) to the path) at this level.
      952    12464        *
      953    12465        ****/
      954    12466
      955    12467    4                    Q=PINCRW(P,I*SIZEW(APATH)+SIZEW(ANODE));

  12467  8 001501   000501 236000 0                  LDQ     I
         8 001502   000025 736000                    QLS     21
         8 001503   000003 036003                    ADLQ    3,DU
         8 001504   000476 036000 0                  ADLQ    P
         8 001505   000477 756000 0                  STQ     Q

      956    12468    4                    PTR$(LVL)=P;

  12468  8 001506   000476 236000 0                  LDQ     P
         8 001507   000506 720000 0                  LXL0    LVL
         8 001510   000512 756010 0                  STQ     PTR$,X0

      957    12469    4                    IDX(LVL)=I;

  12469  8 001511   000501 235000 0                  LDA     I
         8 001512   000612 755010 0                  STA     IDX,X0

      958    12470    4                    LVL=LVL+1;

  12470  8 001513   000506 054000 0                  AOS     LVL

      959    12471
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:111  
      960    12472        /****
      961    12473        *
      962    12474        *   See if we need to go farther down.  If so, and if we haven't been here
      963    12475        *   already (VISIT='0'B), simulate recursion.  A recursive routine would
      964    12476        *   probably be more elegant, but it is also somewhat harder to debug and
      965    12477        *   maintain.
      966    12478        *
      967    12479        ****/
      968    12480
      969    12481    5                    IF LVL<MAXLVL THEN DO;

  12481  8 001514   000506 236000 0                  LDQ     LVL
         8 001515   000507 116000 0                  CMPQ    MAXLVL
         8 001516   001533 605000 8                  TPL     s:12500

      970    12482    6                       IF Q->APATH.PTR$->ANODE.VISIT='0'B THEN DO;

  12482  8 001517   000477 470400 0                  LDP0    Q
         8 001520   000007 471500                    LDP1    7,,PR0
         8 001521   000000 066500                    CMPB    filb='0'B
         8 001522   100002 010001                    BDSC    2,,PR1                   by=0,bit=1,n=1
         8 001523   000034 000022 9                  BDSC    28                       by=0,bit=0,n=18
         8 001524   001530 601000 8                  TNZ     s:12486

      971    12483    6                          P=Q->APATH.PTR$;

  12483  8 001525   000007 236100                    LDQ     7,,PR0
         8 001526   000476 756000 0                  STQ     P

      972    12484    6                          GOTO PUSH;

  12484  8 001527   001466 710000 8                  TRA     PUSH

      973    12485    6                          END;
      974    12486    5                       LVL=LVL-1;

  12486  8 001530   000001 336007                    LCQ     1,DL
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:112  
         8 001531   000506 056000 0                  ASQ     LVL

      975    12487    5                       GOTO PULL;

  12487  8 001532   002217 710000 8                  TRA     PULL

      976    12488    5                       END;
      977    12489
      978    12490        /****
      979    12491        *
      980    12492        *   We have reached the desired level in our travels.  Now look around
      981    12493        *   and see if this node has been recorded (DONE='0'B).  If it hasn't,
      982    12494        *   write the path information to :NODES and print the entire path on
      983    12495        *   the path report.  Note that only the first step in the path is
      984    12496        *   recorded in the :NODES file.
      985    12497        *
      986    12498        ****/
      987    12499
      988    12500    4                    LVL=LVL-1;

  12500  8 001533   000001 336007                    LCQ     1,DL
         8 001534   000506 056000 0                  ASQ     LVL

      989    12501    4                    R=Q->APATH.PTR$;

  12501  8 001535   000477 470400 0                  LDP0    Q
         8 001536   000007 236100                    LDQ     7,,PR0
         8 001537   000500 756000 0                  STQ     R

      990    12502    5                    IF R->ANODE.DONE='0'B THEN DO;

  12502  8 001540   000500 471400 0                  LDP1    R
         8 001541   000000 066500                    CMPB    filb='0'B
         8 001542   100002 000001                    BDSC    2,,PR1                   by=0,bit=0,n=1
         8 001543   000034 000022 9                  BDSC    28                       by=0,bit=0,n=18
         8 001544   002217 601000 8                  TNZ     PULL

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:113  
      991    12503
      992    12504        /****
      993    12505        *
      994    12506        *   Define this node and count another node done.
      995    12507        *
      996    12508        ****/
      997    12509
      998    12510    5                       R->ANODE.DONE='1'B;

  12510  8 001545   003100 060400                    CSL     bolr='003'O
         8 001546   000074 000001 9                  BDSC    60                       by=0,bit=0,n=1
         8 001547   100002 000001                    BDSC    2,,PR1                   by=0,bit=0,n=1

      999    12511    5                       NODECNT=NODECNT-1;

  12511  8 001550   000001 336007                    LCQ     1,DL
         8 001551   000510 056000 0                  ASQ     NODECNT

     1000    12512
     1001    12513        /****
     1002    12514        *
     1003    12515        *   Build the :NODES record.  They key is the name of the node, not the
     1004    12516        *   path.  The path name in the record is the name of the first path
     1005    12517        *   (WSN) towards this node, and the node name in the record is the name
     1006    12518        *   of the node found at the end of the first path.  We also record the
     1007    12519        *   type of the final node, so we can tell what is legal to send to this
     1008    12520        *   node, and the type of the node at the end of the first step, so we
     1009    12521        *   can determine what JCL is needed.  We calculate the time for one
     1010    12522        *   granule to traverse all the steps by adding up the times for each
     1011    12523        *   individual step.
     1012    12524        *
     1013    12525        ****/
     1014    12526
     1015    12527    5                       NODEKEY.C=Q->APATH.DEST;

  12527  8 001552   040000 100500                    MLR     fill='040'O
         8 001553   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:114  
         8 001554   000152 200010 0                  ADSC9   NODEKEY                  cn=1,n=8

     1016    12528    5                       R=PINCRW(PTR$(0),IDX(0)*SIZEW(APATH)+SIZEW(ANODE));

  12528  8 001555   000612 236000 0                  LDQ     IDX
         8 001556   000025 736000                    QLS     21
         8 001557   000003 036003                    ADLQ    3,DU
         8 001560   000512 036000 0                  ADLQ    PTR$
         8 001561   000500 756000 0                  STQ     R

     1017    12529    5                       DIRECTORY_NODE = IAM;

  12529  8 001562   000712 237000 0                  LDAQ    IAM
         8 001563   000716 757000 0                  STAQ    DIRECTORY_NODE

     1018    12530
     1019    12531        /****
     1020    12532        *
     1021    12533        *   Slug in the path information.  TOT_TIME is initialized to zero and will be
     1022    12534        *   filled in as we walk across the chain of paths.
     1023    12535        *
     1024    12536        ****/
     1025    12537
     1026    12538    5                       NODEOVR.PATH_NAME = R -> APATH.NAME;

  12538  8 001564   000500 471400 0                  LDP1    R
         8 001565   040000 100500                    MLR     fill='040'O
         8 001566   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         8 001567   000155 000010 0                  ADSC9   NODEOVR                  cn=0,n=8

     1027    12539    5                       NODEOVR.NODE_NAME = R -> APATH.DEST;

  12539  8 001570   040000 100500                    MLR     fill='040'O
         8 001571   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         8 001572   000157 000010 0                  ADSC9   NODEOVR+2                cn=0,n=8

     1028    12540    5                       NODEOVR.TYPE_DEST=Q->APATH.PTR$->ANODE.TYPE;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:115  

  12540  8 001573   000007 473500                    LDP3    7,,PR0
         8 001574   000000 100500                    MLR     fill='000'O
         8 001575   300002 200001                    ADSC9   2,,PR3                   cn=1,n=1
         8 001576   000161 000001 0                  ADSC9   NODEOVR+4                cn=0,n=1

     1029    12541    5                       NODEOVR.TYPE_PATH=R->APATH.PTR$->ANODE.TYPE;

  12541  8 001577   100007 473500                    LDP3    7,,PR1
         8 001600   000000 100500                    MLR     fill='000'O
         8 001601   300002 200001                    ADSC9   2,,PR3                   cn=1,n=1
         8 001602   000161 400001 0                  ADSC9   NODEOVR+4                cn=2,n=1

     1030    12542    5                       TOT_TIME=0;

  12542  8 001603   000505 450000 0                  STZ     TOT_TIME

     1031    12543
     1032    12544        /****
     1033    12545        *
     1034    12546        *   Print the header for this node
     1035    12547        *
     1036    12548        ****/
     1037    12549
     1038    12550    5                       CALL INDEX1(J,' ',NODEKEY.C,0);

  12550  8 001604   000000 124400                    SCM     mask='000'O
         8 001605   000152 200010 0                  ADSC9   NODEKEY                  cn=1,n=8
         8 001606   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001607   000502 000000 0                  ARG     J

     1039    12551    5                       K=MAXIMUM(0,NODEOVR.TYPE_DEST-%N_TYPE#);

  12551  8 001610   000161 236000 0                  LDQ     NODEOVR+4
         8 001611   000033 772000                    QRL     27
         8 001612   000144 136007                    SBLQ    100,DL
         8 001613   000000 116003                    CMPQ    0,DU
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:116  
         8 001614   001616 605000 8                  TPL     s:12551+6
         8 001615   000000 236003                    LDQ     0,DU
         8 001616   000503 756000 0                  STQ     K

     1040    12552    5                       U1.L=J;

  12552  8 001617   000502 236000 0                  LDQ     J
         8 001620   000033 736000                    QLS     27
         8 001621   000720 552040 0                  STBQ    U1,'40'O

     1041    12553    5                       U1.C=SUBSTR(NODEKEY.C,0,J);

  12553  8 001622   000502 720000 0                  LXL0    J
         8 001623   040000 100440                    MLR     fill='040'O
         8 001624   000152 200010 0                  ADSC9   NODEKEY                  cn=1,n=*X0
         8 001625   000720 200037 0                  ADSC9   U1                       cn=1,n=31

     1042    12554    5                       U2.L=TYPE.L(K);

  12554  8 001626   000503 236000 0                  LDQ     K
         8 001627   000011 402007                    MPY     9,DL
         8 001630   000000 100406                    MLR     fill='000'O
         8 001631   000006 000001 3                  ADSC9   TYPE,Q                   cn=0,n=1
         8 001632   000730 000001 0                  ADSC9   U2                       cn=0,n=1

     1043    12555    5                       U2.C=SUBSTR(TYPE.C(K),0,TYPE.L(K));

  12555  8 001633   000000 101406                    MRL     fill='000'O
         8 001634   000006 000001 3                  ADSC9   TYPE,Q                   cn=0,n=1
         8 001635   000740 000002 0                  ADSC9   U2+8                     cn=0,n=2
         8 001636   000740 221000 0                  LDX1    U2+8
         8 001637   040000 100446                    MLR     fill='040'O
         8 001640   000006 200011 3                  ADSC9   TYPE,Q                   cn=1,n=*X1
         8 001641   000730 200037 0                  ADSC9   U2                       cn=1,n=31

     1044    12556    5                       CALL XUR$ERRMSG(%E$VWN_PTHLN2,,DCBNUM(M$LO),VECTOR(U1),

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:117  
  12556  8 001642   000000 236007 xsym               LDQ     M$LO,DL
         8 001643   000740 756000 0                  STQ     U2+8
         8 001644   000100 237000 9                  LDAQ    64
         8 001645   000744 757000 0                  STAQ    U2+12
         8 001646   000740 633400 0                  EPPR3   U2+8
         8 001647   000743 453400 0                  STP3    U2+11
         8 001650   000003 236000 9                  LDQ     3
         8 001651   000742 756000 0                  STQ     U2+10
         8 001652   000102 236000 9                  LDQ     66
         8 001653   000741 756000 0                  STQ     U2+9
         8 001654   000741 630400 0                  EPPR0   U2+9
         8 001655   000062 631400 9                  EPPR1   50
         8 001656   000000 701000 xent               TSX1    XUR$ERRMSG
         8 001657   000000 011000                    NOP     0

     1045    12557    5                         VECTOR(U2));
     1046    12558
     1047    12559        /****
     1048    12560        *
     1049    12561        *   Now walk down the path from *IAM to this node.  We clear the VISIT bit
     1050    12562        *   at each level (for housecleaning), then print the report.  Also compute
     1051    12563        *   the time for one granule's transit (wildly fudged).
     1052    12564        *
     1053    12565        ****/
     1054    12566
     1055    12567    5                       J=0;

  12567  8 001660   000502 450000 0                  STZ     J

     1056    12568    6                       DO WHILE(J<=LVL);

  12568  8 001661   000502 236000 0                  LDQ     J
         8 001662   000506 116000 0                  CMPQ    LVL
         8 001663   002132 605400 8                  TPNZ    s:12685

     1057    12569    6                          PTR$(J)->ANODE.VISIT='0'B;

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:118  
  12569  8 001664   000502 720000 0                  LXL0    J
         8 001665   000512 470410 0                  LDP0    PTR$,X0
         8 001666   003100 060400                    CSL     bolr='003'O
         8 001667   000034 000001 9                  BDSC    28                       by=0,bit=0,n=1
         8 001670   000002 010001                    BDSC    2,,PR0                   by=0,bit=1,n=1

     1058    12570    6                          R=PINCRW(PTR$(J),IDX(J)*SIZEW(APATH)+SIZEW(ANODE));

  12570  8 001671   000612 236010 0                  LDQ     IDX,X0
         8 001672   000003 736000                    QLS     3
         8 001673   000003 631506                    EPPR1   3,QL,PR0
         8 001674   000500 451400 0                  STP1    R

     1059    12571
     1060    12572        /****
     1061    12573        *
     1062    12574        *   Print the name of the path and the node name at the end of that path.
     1063    12575        *
     1064    12576        ****/
     1065    12577
     1066    12578    6                          CALL INDEX1(K,' ',R->APATH.NAME,0);

  12578  8 001675   000000 124500                    SCM     mask='000'O
         8 001676   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         8 001677   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001700   000503 000000 0                  ARG     K

     1067    12579    6                          CALL INDEX1(L,' ',R->APATH.DEST,0);

  12579  8 001701   000000 124500                    SCM     mask='000'O
         8 001702   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         8 001703   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001704   000504 000000 0                  ARG     L

     1068    12580    6                          U1.L=K;

  12580  8 001705   000503 236000 0                  LDQ     K
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:119  
         8 001706   000033 736000                    QLS     27
         8 001707   000720 552040 0                  STBQ    U1,'40'O

     1069    12581    6                          U1.C=SUBSTR(R->APATH.NAME,0,K);

  12581  8 001710   000503 721000 0                  LXL1    K
         8 001711   040000 100540                    MLR     fill='040'O
         8 001712   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1
         8 001713   000720 200037 0                  ADSC9   U1                       cn=1,n=31

     1070    12582    6                          U2.L=L;

  12582  8 001714   000504 236000 0                  LDQ     L
         8 001715   000033 736000                    QLS     27
         8 001716   000730 552040 0                  STBQ    U2,'40'O

     1071    12583    6                          U2.C=SUBSTR(R->APATH.DEST,0,L);

  12583  8 001717   000504 722000 0                  LXL2    L
         8 001720   040000 100540                    MLR     fill='040'O
         8 001721   100002 000012                    ADSC9   2,,PR1                   cn=0,n=*X2
         8 001722   000730 200037 0                  ADSC9   U2                       cn=1,n=31

     1072    12584    6                          IF R -> APATH.PTR$ -> ANODE.TYPE = %N_EXTERNAL#

  12584  8 001723   100007 473500                    LDP3    7,,PR1
         8 001724   000000 101500                    MRL     fill='000'O
         8 001725   300002 200001                    ADSC9   2,,PR3                   cn=1,n=1
         8 001726   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 001727   000740 236000 0                  LDQ     U2+8
         8 001730   000157 116007                    CMPQ    111,DL
         8 001731   001773 601000 8                  TNZ     s:12603

     1073    12585    7                          THEN DO;

     1074    12586
     1075    12587                                           /* output the account if node is external  */
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:120  
     1076    12588    7                             CALL INDEX1(K,' ',R->APATH.ACCT,0);

  12588  8 001732   000000 124500                    SCM     mask='000'O
         8 001733   100004 000010                    ADSC9   4,,PR1                   cn=0,n=8
         8 001734   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 001735   000503 000000 0                  ARG     K

     1077    12589    7                             U1.L = K;

  12589  8 001736   000503 236000 0                  LDQ     K
         8 001737   000033 736000                    QLS     27
         8 001740   000720 552040 0                  STBQ    U1,'40'O

     1078    12590    7                             U1.C = SUBSTR(R->APATH.ACCT,0,K);

  12590  8 001741   000503 721000 0                  LXL1    K
         8 001742   040000 100540                    MLR     fill='040'O
         8 001743   100004 000011                    ADSC9   4,,PR1                   cn=0,n=*X1
         8 001744   000720 200037 0                  ADSC9   U1                       cn=1,n=31

     1079    12591
     1080    12592    7                             CALL XUR$ERRMSG(%E$VWN_EXTERNAL,,DCBNUM(M$LO),

  12592  8 001745   000000 236007 xsym               LDQ     M$LO,DL
         8 001746   000740 756000 0                  STQ     U2+8
         8 001747   000100 237000 9                  LDAQ    64
         8 001750   000744 757000 0                  STAQ    U2+12
         8 001751   000740 633400 0                  EPPR3   U2+8
         8 001752   000743 453400 0                  STP3    U2+11
         8 001753   000003 236000 9                  LDQ     3
         8 001754   000742 756000 0                  STQ     U2+10
         8 001755   000104 236000 9                  LDQ     68
         8 001756   000741 756000 0                  STQ     U2+9
         8 001757   000741 630400 0                  EPPR0   U2+9
         8 001760   000062 631400 9                  EPPR1   50
         8 001761   000000 701000 xent               TSX1    XUR$ERRMSG
         8 001762   000000 011000                    NOP     0
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:121  

     1081    12593    7                               VECTOR(U1),VECTOR(U2));
     1082    12594
     1083    12595    7                             NODEOVR.ACCT = R -> APATH.ACCT;

  12595  8 001763   000500 470400 0                  LDP0    R
         8 001764   040000 100500                    MLR     fill='040'O
         8 001765   000004 000010                    ADSC9   4,,PR0                   cn=0,n=8
         8 001766   000155 000010 0                  ADSC9   NODEOVR                  cn=0,n=8

     1084    12596    7                             NODEOVR.NODE_NAME = DIRECTORY_NODE;

  12596  8 001767   000716 237000 0                  LDAQ    DIRECTORY_NODE
         8 001770   000157 755000 0                  STA     NODEOVR+2
         8 001771   000160 756000 0                  STQ     NODEOVR+3

     1085    12597
     1086    12598    7                             GOTO NEXT_STEP;

  12598  8 001772   002126 710000 8                  TRA     NEXT_STEP

     1087    12599
     1088    12600    7                             END;
     1089    12601
     1090    12602    6                          ELSE
     1091    12603    6                             CALL XUR$ERRMSG(%E$VWN_PTHLN3,,DCBNUM(M$LO),

  12603  8 001773   000000 236007 xsym               LDQ     M$LO,DL
         8 001774   000740 756000 0                  STQ     U2+8
         8 001775   000100 237000 9                  LDAQ    64
         8 001776   000744 757000 0                  STAQ    U2+12
         8 001777   000740 633400 0                  EPPR3   U2+8
         8 002000   000743 453400 0                  STP3    U2+11
         8 002001   000003 236000 9                  LDQ     3
         8 002002   000742 756000 0                  STQ     U2+10
         8 002003   000106 236000 9                  LDQ     70
         8 002004   000741 756000 0                  STQ     U2+9
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:122  
         8 002005   000741 630400 0                  EPPR0   U2+9
         8 002006   000062 631400 9                  EPPR1   50
         8 002007   000000 701000 xent               TSX1    XUR$ERRMSG
         8 002010   000000 011000                    NOP     0

     1092    12604    6                               VECTOR(U1),VECTOR(U2));
     1093    12605
     1094    12606        /****
     1095    12607        *
     1096    12608        *   Recompute the speed.  This is only approximate for weird baud rates.
     1097    12609        *
     1098    12610        ****/
     1099    12611
     1100    12612    6                          K=R->APATH.SPEED;

  12612  8 002011   000500 470400 0                  LDP0    R
         8 002012   000006 236100                    LDQ     6,,PR0
         8 002013   777777 376007                    ANQ     -1,DL
         8 002014   000503 756000 0                  STQ     K

     1101    12613    6                          L=75;

  12613  8 002015   000113 235007                    LDA     75,DL
         8 002016   000504 755000 0                  STA     L

     1102    12614    7                          DO WHILE(K>0);

  12614  8 002017   000000 116003                    CMPQ    0,DU
         8 002020   002026 604400 8                  TMOZ    s:12618

     1103    12615    7                             L=L*2;

  12615  8 002021   000504 236000 0                  LDQ     L
         8 002022   000504 056000 0                  ASQ     L

     1104    12616    7                             K=K-1;

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:123  
  12616  8 002023   000001 336007                    LCQ     1,DL
         8 002024   000503 056000 0                  ASQ     K

     1105    12617    7                             END;

  12617  8 002025   002021 605400 8                  TPNZ    s:12615

     1106    12618    6                          CALL BINCHAR(HOLD,L);

  12618  8 002026   000000 301400                    BTD
         8 002027   000504 000004 0                  NDSC9   L                        cn=0,s=lsgnf,sf=0,n=4
         8 002030   000714 030010 0                  NDSC9   HOLD                     cn=0,s=nosgn,sf=0,n=8

     1107    12619    6                          K=0;

  12619  8 002031   000503 450000 0                  STZ     K

     1108    12620    7                          DO WHILE(SUBSTR(HOLD,K,1)='0');

  12620  8 002032   002034 710000 8                  TRA     s:12622

     1109    12621    7                             K=K+1;

  12621  8 002033   000503 054000 0                  AOS     K

     1110    12622    7                             END;

  12622  8 002034   000503 235000 0                  LDA     K
         8 002035   040000 106405                    CMPC    fill='040'O
         8 002036   000714 000001 0                  ADSC9   HOLD,A                   cn=0,n=1
         8 002037   000107 000001 9                  ADSC9   71                       cn=0,n=1
         8 002040   002033 600000 8                  TZE     s:12621

     1111    12623    6                          U2.C=SUBSTR(HOLD,K,8-K);

  12623  8 002041   777767 620005                    EAX0    -9,AL
         8 002042   777777 660003                    ERX0    -1,DU
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:124  
         8 002043   040000 100445                    MLR     fill='040'O
         8 002044   000714 000010 0                  ADSC9   HOLD,A                   cn=0,n=*X0
         8 002045   000730 200037 0                  ADSC9   U2                       cn=1,n=31

     1112    12624    6                          U2.L=8-K;

  12624  8 002046   000010 236007                    LDQ     8,DL
         8 002047   000503 136000 0                  SBLQ    K
         8 002050   000033 736000                    QLS     27
         8 002051   000730 552040 0                  STBQ    U2,'40'O

     1113    12625
     1114    12626        /****
     1115    12627        *
     1116    12628        *   Slug in "hardwire" or "dialup".
     1117    12629        *
     1118    12630        ****/
     1119    12631
     1120    12632    6                          K=MAXIMUM(0,R->APATH.MODE-%N_DIALUP#);

  12632  8 002052   000500 470400 0                  LDP0    R
         8 002053   000006 236100                    LDQ     6,,PR0
         8 002054   000022 772000                    QRL     18
         8 002055   000024 136007                    SBLQ    20,DL
         8 002056   000000 116003                    CMPQ    0,DU
         8 002057   002061 605000 8                  TPL     s:12632+7
         8 002060   000000 236003                    LDQ     0,DU
         8 002061   000503 756000 0                  STQ     K

     1121    12633    6                          U1.L=MODE.L(K);

  12633  8 002062   000003 402007                    MPY     3,DL
         8 002063   000000 236006 3                  LDQ     MODE,QL
         8 002064   000720 552040 0                  STBQ    U1,'40'O

     1122    12634    6                          U1.C=SUBSTR(MODE.C(K),0,MODE.L(K));

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:125  
  12634  8 002065   000503 236000 0                  LDQ     K
         8 002066   000003 402007                    MPY     3,DL
         8 002067   000000 236006 3                  LDQ     MODE,QL
         8 002070   000033 772000                    QRL     27
         8 002071   000000 620006                    EAX0    0,QL
         8 002072   000503 236000 0                  LDQ     K
         8 002073   000014 402007                    MPY     12,DL
         8 002074   040000 100446                    MLR     fill='040'O
         8 002075   000000 200010 3                  ADSC9   MODE,Q                   cn=1,n=*X0
         8 002076   000720 200037 0                  ADSC9   U1                       cn=1,n=31

     1123    12635
     1124    12636        /****
     1125    12637        *
     1126    12638        *   Print the speed and connection mode.
     1127    12639        *
     1128    12640        ****/
     1129    12641
     1130    12642    6                          CALL XUR$ERRMSG(%E$VWN_PTHLN4,,DCBNUM(M$LO),VECTOR(U1),

  12642  8 002077   000000 236007 xsym               LDQ     M$LO,DL
         8 002100   000740 756000 0                  STQ     U2+8
         8 002101   000100 237000 9                  LDAQ    64
         8 002102   000744 757000 0                  STAQ    U2+12
         8 002103   000740 631400 0                  EPPR1   U2+8
         8 002104   000743 451400 0                  STP1    U2+11
         8 002105   000003 236000 9                  LDQ     3
         8 002106   000742 756000 0                  STQ     U2+10
         8 002107   000111 236000 9                  LDQ     73
         8 002110   000741 756000 0                  STQ     U2+9
         8 002111   000741 630400 0                  EPPR0   U2+9
         8 002112   000062 631400 9                  EPPR1   50
         8 002113   000000 701000 xent               TSX1    XUR$ERRMSG
         8 002114   000000 011000                    NOP     0

     1131    12643    6                            VECTOR(U2));
     1132    12644
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:126  
     1133    12645        /****
     1134    12646        *
     1135    12647        *   Compute the approximate transit time for one granule (L is the approximate
     1136    12648        *   baud rate computed above).
     1137    12649        *
     1138    12650        *       4096 bytes/granule * 8 bits/byte / L bits/second = N seconds/granule
     1139    12651        *
     1140    12652        *   Multiply this by 10 (for tenths of seconds) and add a fudge factor of
     1141    12653        *   50% overhead (wow!) plus another second per granule.  This stuff is only
     1142    12654        *   approximate anyway.
     1143    12655        *
     1144    12656        ****/
     1145    12657
     1146    12658    6                          TOT_TIME=TOT_TIME+(4096*8*10*3/2)/L+10;

  12658  8 002115   000112 236000 9                  LDQ     74
         8 002116   000504 506000 0                  DIV     L
         8 002117   000505 036000 0                  ADLQ    TOT_TIME
         8 002120   000012 036007                    ADLQ    10,DL
         8 002121   000505 756000 0                  STQ     TOT_TIME

     1147    12659
     1148    12660        /****
     1149    12661        *
     1150    12662        *   Remember the name of the node we've just reached, so that if the final
     1151    12663        *   destination is an external node we can record the last non-external
     1152    12664        *   node's name in the external-node record.
     1153    12665        */
     1154    12666
     1155    12667    6                          DIRECTORY_NODE = R -> APATH.DEST;

  12667  8 002122   000500 470400 0                  LDP0    R
         8 002123   040000 100500                    MLR     fill='040'O
         8 002124   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         8 002125   000716 000010 0                  ADSC9   DIRECTORY_NODE           cn=0,n=8

     1156    12668
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:127  
     1157    12669        /****
     1158    12670        *
     1159    12671        *   Move on to the next step.
     1160    12672        *
     1161    12673        ****/
     1162    12674
     1163    12675    6   NEXT_STEP:
     1164    12676    6                          J=J+1;

  12676  8 002126   000502 054000 0     NEXT_STEP    AOS     J

     1165    12677    6                          END;

  12677  8 002127   000502 236000 0                  LDQ     J
         8 002130   000506 116000 0                  CMPQ    LVL
         8 002131   001664 604400 8                  TMOZ    s:12569

     1166    12678
     1167    12679        /****
     1168    12680        *
     1169    12681        *   Slug in the accumulated time/granule, then print it.
     1170    12682        *
     1171    12683        ****/
     1172    12684
     1173    12685    5                       NODEOVR.TIME=TOT_TIME;

  12685  8 002132   000505 720000 0                  LXL0    TOT_TIME
         8 002133   000162 740000 0                  STX0    NODEOVR+5

     1174    12686    5                       CALL BINCHAR(HOLD,TOT_TIME);

  12686  8 002134   000000 301400                    BTD
         8 002135   000505 000004 0                  NDSC9   TOT_TIME                 cn=0,s=lsgnf,sf=0,n=4
         8 002136   000714 030010 0                  NDSC9   HOLD                     cn=0,s=nosgn,sf=0,n=8

     1175    12687    5                       J=0;

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:128  
  12687  8 002137   000502 450000 0                  STZ     J

     1176    12688    6                       DO WHILE(J<6 AND SUBSTR(HOLD,J,1)='0');

  12688  8 002140   002142 710000 8                  TRA     s:12690

     1177    12689    6                          J=J+1;

  12689  8 002141   000502 054000 0                  AOS     J

     1178    12690    6                          END;

  12690  8 002142   000502 235000 0                  LDA     J
         8 002143   000006 115007                    CMPA    6,DL
         8 002144   002151 605000 8                  TPL     s:12691
         8 002145   040000 106405                    CMPC    fill='040'O
         8 002146   000714 000001 0                  ADSC9   HOLD,A                   cn=0,n=1
         8 002147   000107 000001 9                  ADSC9   71                       cn=0,n=1
         8 002150   002141 600000 8                  TZE     s:12689

     1179    12691    5                       U1.L=7-J;

  12691  8 002151   000007 236007                    LDQ     7,DL
         8 002152   000502 136000 0                  SBLQ    J
         8 002153   000033 736000                    QLS     27
         8 002154   000720 552040 0                  STBQ    U1,'40'O

     1180    12692    5                       U1.C=SUBSTR(HOLD,J,7-J);

  12692  8 002155   777770 620005                    EAX0    -8,AL
         8 002156   777777 660003                    ERX0    -1,DU
         8 002157   040000 100445                    MLR     fill='040'O
         8 002160   000714 000010 0                  ADSC9   HOLD,A                   cn=0,n=*X0
         8 002161   000720 200037 0                  ADSC9   U1                       cn=1,n=31

     1181    12693    5                       U2.L=1;

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:129  
  12693  8 002162   001000 236003                    LDQ     512,DU
         8 002163   000730 552040 0                  STBQ    U2,'40'O

     1182    12694    5                       U2.C=SUBSTR(HOLD,7,1);

  12694  8 002164   040000 100400                    MLR     fill='040'O
         8 002165   000715 600001 0                  ADSC9   HOLD+1                   cn=3,n=1
         8 002166   000730 200037 0                  ADSC9   U2                       cn=1,n=31

     1183    12695    5                       CALL XUR$ERRMSG(%E$VWN_PTHLN5,,DCBNUM(M$LO),VECTOR(U1),

  12695  8 002167   000000 236007 xsym               LDQ     M$LO,DL
         8 002170   000740 756000 0                  STQ     U2+8
         8 002171   000100 237000 9                  LDAQ    64
         8 002172   000744 757000 0                  STAQ    U2+12
         8 002173   000740 630400 0                  EPPR0   U2+8
         8 002174   000743 450400 0                  STP0    U2+11
         8 002175   000003 236000 9                  LDQ     3
         8 002176   000742 756000 0                  STQ     U2+10
         8 002177   000114 236000 9                  LDQ     76
         8 002200   000741 756000 0                  STQ     U2+9
         8 002201   000741 630400 0                  EPPR0   U2+9
         8 002202   000062 631400 9                  EPPR1   50
         8 002203   000000 701000 xent               TSX1    XUR$ERRMSG
         8 002204   000000 011000                    NOP     0

     1184    12696    5                         VECTOR(U2));
     1185    12697
     1186    12698        /****
     1187    12699        *
     1188    12700        *   Finally!  Write this node definition to the file.
     1189    12701        *
     1190    12702        ****/
     1191    12703
     1192    12704    5                       WRITE_NODE.BUF_.BOUND=21;

  12704  8 002205   000170 236000 0                  LDQ     WRITE_NODE+4
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:130  
         8 002206   177777 376007                    ANQ     65535,DL
         8 002207   000115 276000 9                  ORQ     77
         8 002210   000170 756000 0                  STQ     WRITE_NODE+4

     1193    12705    5                       CALL M$WRITE(WRITE_NODE) ALTRET(ERR_OUT);

  12705  8 002211   000164 630400 0                  EPPR0   WRITE_NODE
         8 002212   440001 713400                    CLIMB   alt,write
         8 002213   401400 401760                    pmme    nvectors=4
         8 002214   002336 702000 8                  TSX2    ERR_OUT

     1194    12706
     1195    12707        /****
     1196    12708        *
     1197    12709        *   Stop if we're done.
     1198    12710        *
     1199    12711        ****/
     1200    12712
     1201    12713    5                       IF NODECNT<=0 THEN

  12713  8 002215   000510 235000 0                  LDA     NODECNT
         8 002216   002246 604400 8                  TMOZ    FILE_BUILT

     1202    12714    5                          GOTO FILE_BUILT;
     1203    12715    5                       END;

     1204    12716
     1205    12717    4   PULL:
     1206    12718    4                    I=I+1;

  12718  8 002217   000501 054000 0     PULL         AOS     I

     1207    12719    4                    END;

  12719  8 002220   000476 470400 0                  LDP0    P
         8 002221   000000 101500                    MRL     fill='000'O
         8 002222   000002 400002                    ADSC9   2,,PR0                   cn=2,n=2
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:131  
         8 002223   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 002224   000740 236000 0                  LDQ     U2+8
         8 002225   000501 116000 0                  CMPQ    I
         8 002226   001501 605400 8                  TPNZ    s:12467

     1208    12720
     1209    12721        /****
     1210    12722        *
     1211    12723        *   Go back up a level, across one (if possible) and down to MAXLVL again.
     1212    12724        *
     1213    12725        ****/
     1214    12726
     1215    12727    3                 LVL=LVL-1;

  12727  8 002227   000001 336007                    LCQ     1,DL
         8 002230   000506 056000 0                  ASQ     LVL

     1216    12728    4                 IF LVL>=0 THEN DO;

  12728  8 002231   002240 604000 8                  TMI     s:12742

     1217    12729    4                    P=PTR$(LVL);

  12729  8 002232   000506 720000 0                  LXL0    LVL
         8 002233   000512 236010 0                  LDQ     PTR$,X0
         8 002234   000476 756000 0                  STQ     P

     1218    12730    4                    I=IDX(LVL);

  12730  8 002235   000612 235010 0                  LDA     IDX,X0
         8 002236   000501 755000 0                  STA     I

     1219    12731    4                    GOTO PULL;

  12731  8 002237   002217 710000 8                  TRA     PULL

     1220    12732    4                    END;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:132  
     1221    12733
     1222    12734        /****
     1223    12735        *
     1224    12736        *   All the nodes at this level have been located.  Move on to the next
     1225    12737        *   level, but don't do more than 63 levels.  If the network is bigger
     1226    12738        *   than this, some nodes are unreachable or you need another system.
     1227    12739        *
     1228    12740        ****/
     1229    12741
     1230    12742    3                 MAXLVL=MAXLVL+1;

  12742  8 002240   000507 054000 0                  AOS     MAXLVL

     1231    12743    3                 IF MAXLVL>63 THEN

  12743  8 002241   000507 235000 0                  LDA     MAXLVL
         8 002242   000077 115007                    CMPA    63,DL
         8 002243   002257 605400 8                  TPNZ    INACCESSIBLE

     1232    12744    3                    GOTO INACCESSIBLE;
     1233    12745    3                 END;

  12745  8 002244   000510 235000 0                  LDA     NODECNT
         8 002245   001463 605400 8                  TPNZ    s:12436

     1234    12746
     1235    12747    2              END;

     1236    12748
     1237    12749        %EJECT;
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:133  
     1238    12750        /****
     1239    12751        *
     1240    12752        *   All nodes have been defined; close files and go to EOJ.
     1241    12753        *
     1242    12754        ****/
     1243    12755
     1244    12756    1   FILE_BUILT:
     1245    12757    1           CALL M$CLOSE(CLOSE_NODE);

  12757  8 002246   000114 630400 0     FILE_BUILT   EPPR0   CLOSE_NODE
         8 002247   050001 713400                    CLIMB   close
         8 002250   406000 401760                    pmme    nvectors=13

     1246    12758    1           CALL XUR$CLOSE_DCBS;

  12758  8 002251   000034 631400 9                  EPPR1   28
         8 002252   000000 701000 xent               TSX1    XUR$CLOSE_DCBS
         8 002253   000000 011000                    NOP     0

     1247    12759    1           CALL M$EXIT(FPT_EXIT);

  12759  8 002254   000322 630400 0                  EPPR0   FPT_EXIT
         8 002255   000001 713400                    CLIMB   exit
         8 002256   400400 401760                    pmme    nvectors=2

     1248    12760
     1249    12761        /****
     1250    12762        *
     1251    12763        *   We couldn't reach one or more nodes in 63 steps.  Flag these guys
     1252    12764        *   as inaccessible and abort the build.
     1253    12765        *
     1254    12766        ****/
     1255    12767
     1256    12768    1   INACCESSIBLE:
     1257    12769    1           P=VLP_VECTOR.PTR$;

  12769  8 002257   000321 236000 0     INACCESSIBLE LDQ     VLP_VECTOR+1
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:134  
         8 002260   000476 756000 0                  STQ     P

     1258    12770    2           DO WHILE(POFFW(NODEPTR,P)~=0);

  12770  8 002261   002326 710000 8                  TRA     s:12778

     1259    12771    3              IF P->ANODE.DONE='0'B THEN DO;

  12771  8 002262   000476 470400 0                  LDP0    P
         8 002263   000000 066500                    CMPB    filb='0'B
         8 002264   000002 000001                    BDSC    2,,PR0                   by=0,bit=0,n=1
         8 002265   000034 000022 9                  BDSC    28                       by=0,bit=0,n=18
         8 002266   002314 601000 8                  TNZ     s:12777

     1260    12772    3                 CALL INDEX(I,' ',P->ANODE.NAME);

  12772  8 002267   000000 124500                    SCM     mask='000'O
         8 002270   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         8 002271   000005 000001 9                  ADSC9   5                        cn=0,n=1
         8 002272   000501 000000 0                  ARG     I

     1261    12773    3                 U1.L=I;

  12773  8 002273   000501 236000 0                  LDQ     I
         8 002274   000033 736000                    QLS     27
         8 002275   000720 552040 0                  STBQ    U1,'40'O

     1262    12774    3                 U1.C=SUBSTR(P->ANODE.NAME,0,I);

  12774  8 002276   000501 720000 0                  LXL0    I
         8 002277   040000 100540                    MLR     fill='040'O
         8 002300   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         8 002301   000720 200037 0                  ADSC9   U1                       cn=1,n=31

     1263    12775    3                 CALL XUR$ERRMSG(%E$VWN_CANTGO,,,VECTOR(U1));

  12775  8 002302   000055 236000 9                  LDQ     45
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:135  
         8 002303   000003 235000 9                  LDA     3
         8 002304   000742 757000 0                  STAQ    U2+10
         8 002305   000003 236000 9                  LDQ     3
         8 002306   000117 235000 9                  LDA     79
         8 002307   000740 757000 0                  STAQ    U2+8
         8 002310   000740 630400 0                  EPPR0   U2+8
         8 002311   000013 631400 9                  EPPR1   11
         8 002312   000000 701000 xent               TSX1    XUR$ERRMSG
         8 002313   000000 011000                    NOP     0

     1264    12776    3                 END;

     1265    12777    2              P=PINCRW(P,SIZEW(ANODE)+P->ANODE.COUNT*SIZEW(APATH));

  12777  8 002314   000476 470400 0                  LDP0    P
         8 002315   000000 100500                    MLR     fill='000'O
         8 002316   000002 400002                    ADSC9   2,,PR0                   cn=2,n=2
         8 002317   000740 000004 0                  ADSC9   U2+8                     cn=0,n=4
         8 002320   000740 220000 0                  LDX0    U2+8
         8 002321   000000 636010                    EAQ     0,X0
         8 002322   000003 736000                    QLS     3
         8 002323   000003 036003                    ADLQ    3,DU
         8 002324   000476 036000 0                  ADLQ    P
         8 002325   000476 756000 0                  STQ     P

     1266    12778    2              END;

  12778  8 002326   000476 235000 0                  LDA     P
         8 002327   000022 771000                    ARL     18
         8 002330   000740 755000 0                  STA     U2+8
         8 002331   000474 236000 0                  LDQ     NODEPTR
         8 002332   000022 772000                    QRL     18
         8 002333   000740 136000 0                  SBLQ    U2+8
         8 002334   002262 601000 8                  TNZ     s:12771

     1267    12779    1           GOTO FILE_BUILT;

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:136  
  12779  8 002335   002246 710000 8                  TRA     FILE_BUILT

     1268    12780
     1269    12781        /****
     1270    12782        *
     1271    12783        *   Something happened trying to write the output file.  Abort!
     1272    12784        *
     1273    12785        ****/
     1274    12786
     1275    12787    1   ERR_OUT:
     1276    12788    1           CALL XUR$ERRMSG(B$TCB$->B$TCB.ALT$->B$ALT.ERR,DCBNUM(M$NODE));

  12788  8 002336   000000 470400 xsym  ERR_OUT      LDP0    B$TCB$
         8 002337   000000 471500                    LDP1    0,,PR0
         8 002340   000000 236007 xsym               LDQ     M$NODE,DL
         8 002341   000740 756000 0                  STQ     U2+8
         8 002342   000740 633400 0                  EPPR3   U2+8
         8 002343   000743 453400 0                  STP3    U2+11
         8 002344   100102 634500                    EPPR4   66,,PR1
         8 002345   000742 454400 0                  STP4    U2+10
         8 002346   000742 630400 0                  EPPR0   U2+10
         8 002347   000002 631400 9                  EPPR1   2
         8 002350   000000 701000 xent               TSX1    XUR$ERRMSG
         8 002351   000000 011000                    NOP     0

     1277    12789    1           FPT_EXIT.V.STEPCC#=4;

  12789  8 002352   004000 236003                    LDQ     2048,DU
         8 002353   000326 552040 0                  STBQ    FPT_EXIT+4,'40'O

     1278    12790    1           CALL M$EXIT(FPT_EXIT);

  12790  8 002354   000322 630400 0                  EPPR0   FPT_EXIT
         8 002355   000001 713400                    CLIMB   exit
         8 002356   400400 401760                    pmme    nvectors=2

     1279    12791
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:137  
     1280    12792    1   END;

  12792  8 002357   000000 702200 xent               TSX2  ! X66_MSRET

OPEN_NODE
 Sect OctLoc
   0     002   000025 777640   000046 006000   000000 177640   000000 006014    .....&..........
   0     006   000000 177640   000000 006014   000001 577640   000074 006000    .............<..
   0     012   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0     026*  000001 777640   000000 006000   000000 177640   000000 006014    ................
   0     032   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0     046*  000000 000042   000000 002001   252525 002002   000040 252520    ..."......... ..
   0     052   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   0     056   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0     062   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   0     066   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0     072   000000 000000   ****** ******                                    ........

NAME_NODE
 Sect OctLoc
   0     074   006072 116117   104105 123***                                    .:NODES.

READ_NODE
 Sect OctLoc
   0     076   000005 777640   000106 006000   000002 177640   000152 006000    .....F.......j..
   0     102   000005 377640   000155 006000   000000 177640   000000 006014    .....m..........
   0     106   000000 600000   000000 000000   000000 000000   000000 000000    ................
   0     112   000000 000000   000000 000000                                    ........

CLOSE_NODE
 Sect OctLoc
   0     114   000003 777640   000146 006000   000000 177640   000000 006014    .....f..........
   0     120   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0     144*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   0     150   000220 000000   000000 000000                                    ........

NODEKEY
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:138  
 Sect OctLoc
   0     152   010*** ******   ****** ******   ****** ******                    ............

NODEOVR
 Sect OctLoc
   0     155   ****** ******   ****** ******   ****** ******   ****** ******    ................

WRITE_NODE
 Sect OctLoc
   0     164   000003 777640   000174 006000   000002 177640   000152 006000    .....|.......j..
   0     170   000005 377640   000155 006000   000000 177640   000000 006014    .....m..........
   0     174   000000 400600   000000 000000   000000 000000   000000 000000    ................

READ_SEQUEN
 Sect OctLoc
   0     200   000005 777640   000210 006000   000002 177640   000152 006000    .............j..
   0     204   000005 377640   000155 006000   000000 177640   000000 006014    .....m..........
   0     210   000000 500000   000000 000000   000000 000000   000000 000000    ................
   0     214   000000 000000   000000 000000                                    ........

PFIL_NODE
 Sect OctLoc
   0     216   000001 777640   000220 006000   000000 400000   000000 000000    ................

DELREC_NODE
 Sect OctLoc
   0     222   000001 777640   000232 006000   000002 177640   000152 006000    .............j..
   0     226   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0     232   000000 000000   000000 000000                                    ........

ACC_NODE
 Sect OctLoc
   0     234   000000 000003   012000 077040   040040 040040   040040 ******    ......?       ..

ACS_NODE
 Sect OctLoc
   0     240   000000 000033   400000 004115   117126 105400   000006 123103    .......MOVE...SC
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:139  
   0     244   117124 124131   400000 004123   105116 104400   000004 115101    OTTY...SEND...MA
   0     250   111114 400000   007115 101111   114115 101116   400000 011115    IL...MAILMAN...M
   0     254   117126 105137   124105 123124   400000 013123   103117 124124    OVE_TEST...SCOTT
   0     260   131137 124105   123124 400000   011123 105116   104137 124105    Y_TEST...SEND_TE
   0     264   123124 400000   011115 101111   114137 124105   123124 400000    ST...MAIL_TEST..
   0     270   014115 101111   114115 101116   137124 105123   124*** ******    .MAILMAN_TEST...

P_PCB
 Sect OctLoc
   0     274   000000 006014   000000 006014   000000 006014   000000 006014    ................
   0     300   000000 000000   000000 600000   000000 000000   040042 040042    ............ " "
   0     304   000000 040000   000000 000000   000000 000000   000000 006014    .. .............
   0     310   000000 006014   000000 000000                                    ........

FPT_GDS
 Sect OctLoc
   0     312   000001 777640   000316 006000   000001 777640   000320 006000    ................
   0     316   000600 002000   ****** ******                                    ........

VLP_VECTOR
 Sect OctLoc
   0     320   000000 177640   000000 006010                                    ........

FPT_EXIT
 Sect OctLoc
   0     322   000001 777640   000326 006000   000000 177640   000000 006014    ................
   0     326   000000 000000   000000 000000                                    ........

XUR_INIT
 Sect OctLoc
   0     330   520000 000001   000000 000000   000000 000000   000000 000000    ................
   0     334   000274 006000   000000 177640   000000 006014   000000 000000    ................
   0     340   000000 006014   000000 000000   000000 000000   ****** ******    ................
   0     344   000000 177640   000000 006014   000000 000000   000000 000000    ................
   0     350   000000 177640   000000 006014   000000 000000   00000* ******    ................
   0     354   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0     374*  000000 000000   000000 000000   000000 000000                    ............
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:140  

XUH_PARAM
 Sect OctLoc
   0     400   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0     410*  000000 000000   000000 006014   000000 000000   0***** ******    ................
   0     414   000000 000000   000000 000000   003040 040040   040040 040040    .........
   0     420   040040 040040   040040 040040   040040 040040   040040 040040
   0     424   040040 040040   040040 040040   040040 040000   040040 040040               .
   0     430   040040 040040   040040 040040   040040 040040   040040 040040
   0     444*  040*** ******   ****** ******   000000 177640   000000 006014     ...............
   0     450   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0     454   000000 177640   000000 006014   000000 361101   000000 000000    ...........A....
   0     460   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0     470*  000000 000000                                                    ....

PTR$
 Sect OctLoc
   0     512   ****** ******   ****** ******   ****** ******   ****** ******    ................

IDX
 Sect OctLoc
   0     612   ****** ******   ****** ******   ****** ******   ****** ******    ................

U1
 Sect OctLoc
   0     720   ****** ******   ****** ******   ****** ******   ****** ******    ................

U2
 Sect OctLoc
   0     730   ****** ******   ****** ******   ****** ******   ****** ******    ................

(unnamed)
 Sect OctLoc
   0     740   ****** ******   ****** ******   ****** ******   ****** ******    ................

ACCT_NODE
 Sect OctLoc
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:141  
   2     000   072123 131123   040040 040040                                    :SYS

MODE
 Sect OctLoc
   3     000   006144 151141   154165 160040   040040 040040   010150 141162    .dialup     .har
   3     004   144167 151162   145040 040040                                    dwire

TYPE
 Sect OctLoc
   3     006   006103 120066   103060 060040   040006 103120   066102 060063    .CP6C00  .CP6B03
   3     012   040040 006103   120066 102060   062040 040003   103120 066040      .CP6B02  .CP6
   3     016   040040 040040   004103 120055   066040 040040   040003 103120        .CP-6    .CP
   3     022   126040 040040   040040 004103   120055 126040   040040 040005    V     .CP-V    .
   3     026   107103 117123   063040 040040   005107 103117   123070 040040    GCOS3   .GCOS8
   3     032   040007 107103   117123 066120   106040 005107   103117 123066     .GCOS6PF .GCOS6
   3     036   040040 040010   105130 124105   122116 101114                       .EXTERNAL

PROMPT
 Sect OctLoc
   3     041   076*** ******                                                    >...

ERRMSGFID
 Sect OctLoc
   3     042   017072 126127   105122 122115   123107 056072   123131 123040    .:VWERRMSG.:SYS
   3     046   040040 040040   040040 040040   040040 040040   040040 040040
   3     052   040040 040040   040040 040040

(unnamed)
 Sect OctLoc
   3     054   102114 117122   124103 110041   052111 101115   114117 103101    BLORTCH!*IAMLOCA
   3     060   114040 040040                                                    L

(unnamed)
 Sect OctLoc
   9     000   000001 000000   000330 006000   000002 000000   000000 006014    ................
   9     004   000042 006000   040040 040040   000003 777640   000234 006000    ."..    ........
   9     010   000033 777640   000240 006000   000000 006000   000004 000000    ................
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:142  
   9     014   262716 000000   000014 006000   000000 177640   000041 006000    .............!..
   9     020   000003 000000   000000 006000   000473 006000   000016 006000    ................
   9     024   040040 040040   040040 040040   262716 000010   000026 006000            ........
   9     030   000001 600000   262716 000020   000031 006000   000007 777770    ................
   9     034   000000 000000   000000 000144   262716 000030   000036 006000    .......d........
   9     040   262716 000250   000040 006000   262716 000040   000042 006000    ..... ..... ."..
   9     044   262716 000050   000044 006000   262716 000070   000046 006000    ...(.$.....8.&..
   9     050   262716 000100   000050 006000   000007 777640   000720 006000    ...@.(..........
   9     054   262716 000110   000052 006000   000054 006000   000000 000000    ...H.*...,......
   9     060   000007 777640   000730 006000   000005 000000   262716 000230    ................
   9     064   000060 006000   000063 006000   262716 000220   000066 006000    .0...3.......6..
   9     070   262716 000120   000070 006000   262716 000130   000072 006000    ...P.8.....X.:..
   9     074   400000 000000   262716 000150   000075 006000   262716 000160    .......h.=.....p
   9     100   000052 006000   000060 006000   000077 006000   262716 000240    .*...0...?......
   9     104   000103 006000   262716 000170   000105 006000   060040 040040    .C.....x.E..0
   9     110   262716 000200   000110 006000   000001 700000   262716 000210    .....H..........
   9     114   000113 006000   000005 200000   262716 000140   000116 006000    .K.........`.N..

PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:143  
--  Include file information  --

   VW_FPTS_M.:VMB6TOU  cannot be made into a system file and is referenced.
   VWN_ERRS_E.:VMB6TOU  is referenced.
   VW_NODEATER_E.:VMB6TOU  is referenced.
   XUR_ENTRY.:LIB_E05  cannot be made into a system file and is referenced.
   XUH_MACRO_C.:LIB_E05  is referenced.
   XU_MACRO_C.:LIB_E05  is referenced.
   B$TABLES_C.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VWN$NODEATER.
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:144  

 **** Variables and constants ****

  ****  Section 000  Data  VWN$NODEATER

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   234-0-0/w STRC(126)   r     1 ACC_NODE                 240-0-0/w STRC(981)   r     1 ACS_NODE
   473-0-0/w PTR         r     1 BLK$                     114-0-0/d STRC(1080)  r     1 CLOSE_NODE
   222-0-0/d STRC(360)   r     1 DELREC_NODE              716-0-0/c CHAR(8)     r     1 DIRECTORY_NODE
   322-0-0/d STRC(216)   r     1 FPT_EXIT                 312-0-0/d STRC(216)   r     1 FPT_GDS
   714-0-0/c CHAR(8)     r     1 HOLD                     501-0-0/w SBIN        r     1 I
   712-0-0/c CHAR(8)     r     1 IAM                      472-0-0/w PTR         r     1 IAMPTR
   612-0-0/w SBIN        r     1 IDX(0:63)                502-0-0/w SBIN        r     1 J
   503-0-0/w SBIN        r     1 K                        504-0-0/w SBIN        r     1 L
   506-0-0/w SBIN        r     1 LVL                      507-0-0/w SBIN        r     1 MAXLVL
    74-0-0/c STRC(63)    r     1 NAME_NODE                510-0-0/w SBIN        r     1 NODECNT
   152-0-0/c STRC(81)    r     1 NODEKEY                  155-0-0/c STRC(198)   r     1 NODEOVR
   474-0-0/w PTR         r     1 NODEPTR                  155-0-0/c CHAR(22)    r     1 NODEREC
     2-0-0/d STRC(2088)  r     1 OPEN_NODE                476-0-0/w PTR         r     1 P
   475-0-0/w PTR         r     1 PATHPTR                  216-0-0/d STRC(144)   r     1 PFIL_NODE
   512-0-0/w PTR         r     1 PTR$(0:63)               274-0-0/w STRC(504)   r     1 P_PCB
   477-0-0/w PTR         r     1 Q                        500-0-0/w PTR         r     1 R
    76-0-0/d STRC(504)   r     1 READ_NODE                200-0-0/d STRC(504)   r     1 READ_SEQUEN
   505-0-0/w SBIN        r     1 TOT_TIME                 720-0-0/c STRC(288)   r     1 U1
   730-0-0/c STRC(288)   r     1 U2                       320-0-0/d STRC(72)    r     1 VLP_VECTOR
   511-0-0/w SBIN        r     1 WDSLEFT                  164-0-0/d STRC(432)   r     1 WRITE_NODE
   400-0-0/d STRC(2052)        1 XUH_PARAM                330-0-0/d STRC(1404)  r     1 XUR_INIT

  ****  Section 002 RtLmCm ACCT_NODE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(72)    r     1 ACCT_NODE

  ****  Section 003 RoData VWN$NODEATER
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:145  

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    42-0-0/c STRC(360)   r     1 ERRMSGFID                  0-0-0/c STRC(108)   r     1 MODE(0:1)
    41-0-0/c CHAR        r     1 PROMPT                     6-0-0/c STRC(81)    r     1 TYPE(0:11)

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/w PTR         r     1 B$XL_UPPER$                0-0-0/c ASTR(9)     r     1 B_VERSION
     0-0-0/b BIT         r     1 VWN_COMMAND

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(108)   r     1 ANODE                      0-0-0/w STRC(288)   r     1 APATH
     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/d STRC(4608)  r     1 B$XL_UPPER
     0-0-0/d ASTR(3528)  r     1 DUMMY                      0-0-0/w STRC        r     1 ERR
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$NODE                     0-0-0N  NULL        r     1 M$SI
     0-0-0N  NULL        r     1 M$UC                       0-0-0/w STRC(144)   r     1 OUT$BLK
     0-0-0/w ASTR(153)   r     1 OUT$SYM


   Procedure VWN$NODEATER requires 1264 words for executable code.
   Procedure VWN$NODEATER is declared NOAUTO and requires 486 words of local(STATIC) storage.

    No errors detected in file VWN$NODEATER.:VMB6TSI    .
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:146  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:147  
          MINI XREF LISTING

ACCT_NODE
     10503**DCL     10420--DCLINIT
ACCT_NODE.ACCT#
     10503**DCL     11782<<ASSIGN
ACC_NODE
     10876**DCL     11813--ASSIGN
ACC_NODE.Q
     10877**DCL     10876--DCLINIT
ACS_NODE
     10912**DCL     11814--ASSIGN
ACS_NODE.Q
     10913**DCL     10912--DCLINIT
ANODE
     11735**DCL     11937--DOWHILE 11948<<ASSIGN  11969--ASSIGN  11993--ASSIGN  11994--ASSIGN  12210--ASSIGN
     12272--ASSIGN  12279--ASSIGN  12467--ASSIGN  12528--ASSIGN  12570--ASSIGN  12777--ASSIGN
ANODE.COUNT
     11741**DCL     11969>>ASSIGN  12129<<ASSIGN  12129>>ASSIGN  12210>>ASSIGN  12274>>DOWHILE 12279>>ASSIGN
     12458>>DOWHILE 12777>>ASSIGN
ANODE.DONE
     11737**DCL     12397<<ASSIGN  12502>>IF      12510<<ASSIGN  12771>>IF
ANODE.NAME
     11736**DCL     11960<<CALLBLT 11964>>IF      11964>>IF      12056>>IF      12208>>IF      12261>>IF
     12277>>IF      12305>>CALLBLT 12307>>ASSIGN  12308>>CALLBLT 12310>>ASSIGN  12318>>CALLBLT 12320>>ASSIGN
     12321>>CALLBLT 12323>>ASSIGN  12772>>CALLBLT 12774>>ASSIGN
ANODE.TYPE
     11740**DCL     11949<<ASSIGN  11982<<ASSIGN  12007>>IF      12302>>IF      12315>>IF      12540>>ASSIGN
     12541>>ASSIGN  12584>>IF
ANODE.VISIT
     11738**DCL     12449<<ASSIGN  12482>>IF      12569<<ASSIGN
APATH
     11743**DCL     11937--DOWHILE 11969--ASSIGN  12021<<ASSIGN  12130--ASSIGN  12131--ASSIGN  12210--ASSIGN
     12279--ASSIGN  12339--ASSIGN  12467--ASSIGN  12528--ASSIGN  12570--ASSIGN  12777--ASSIGN
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:148  
APATH.ACCT
     11746**DCL     12025<<ASSIGN  12038<<CALLBLT 12302>>IF      12313<<ASSIGN  12315>>IF      12327<<ASSIGN
     12588>>CALLBLT 12590>>ASSIGN  12595>>ASSIGN
APATH.DEST
     11745**DCL     12048<<CALLBLT 12056>>IF      12277>>IF      12288>>CALLBLT 12290>>ASSIGN  12527>>ASSIGN
     12539>>ASSIGN  12579>>CALLBLT 12583>>ASSIGN  12667>>ASSIGN
APATH.MODE
     11747**DCL     12022<<ASSIGN  12100<<ASSIGN  12120<<ASSIGN  12632>>ASSIGN
APATH.NAME
     11744**DCL     12024<<ASSIGN  12036<<CALLBLT 12538>>ASSIGN  12578>>CALLBLT 12581>>ASSIGN
APATH.PTR$
     11749**DCL     12337<<ASSIGN  12482>>IF      12483>>ASSIGN  12501>>ASSIGN  12540>>ASSIGN  12541>>ASSIGN
     12584>>IF
APATH.SPEED
     11748**DCL     12023<<ASSIGN  12086<<ASSIGN  12089<<ASSIGN  12089>>ASSIGN  12113<<ASSIGN  12116<<ASSIGN
     12116>>ASSIGN  12612>>ASSIGN
B$ALT.CODE
     11501**DCL     11501--REDEF   11502--REDEF   11502--REDEF
B$ALT.ERR
     11502**DCL     12788<>CALL
B$ALT.ERR.ERR#
     11503**DCL     11503--REDEF
B$ALT.EVID
     11502**DCL     11502--REDEF   11502--REDEF
B$JIT.CPFLAGS1.SLEAZE
      6586**DCL      6586--REDEF
B$JIT.ERR.MID
      6493**DCL      6493--REDEF
B$JIT.FACCN
      6492**DCL     11782>>ASSIGN
B$JIT.JRESPEAK
      6654**DCL      6655--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
      6763**DCL      6763--REDEF    6764--REDEF
B$JIT.PNR
      6667**DCL      6667--REDEF
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:149  
B$JIT.TSLINE
      6761**DCL      6762--REDEF
B$JIT$
     11693**DCL      6487--IMP-PTR 11782>>ASSIGN
B$TCB.ALT$
     11509**DCL     12788>>CALL
B$TCB$
     11692**DCL     12788>>CALL
B$XL_UPPER
     11677**DCL     11871>>CALLBLT 11893>>CALLBLT 11902>>CALLBLT 11960>>CALLBLT 12036>>CALLBLT 12038>>CALLBLT
     12048>>CALLBLT
B$XL_UPPER$
     11676**DCL     11677--IMP-PTR 11871>>CALLBLT 11893>>CALLBLT 11902>>CALLBLT 11960>>CALLBLT 12036>>CALLBLT
     12038>>CALLBLT 12048>>CALLBLT
BLK$
     11705**DCL     11313--IMP-PTR 11360--IMP-PTR 11835<>CALL    11839<>CALL    11840--IF      11854<<ASSIGN
     11855>>DOSELCT 11870>>ASSIGN  11892>>ASSIGN  11901>>ASSIGN  11937>>DOWHILE 11959>>ASSIGN  11979>>ASSIGN
     12002>>DOWHILE 12007>>IF      12013>>ASSIGN
B_VERSION
     11694**DCL     11824--CALL
B_VERSION.L
     11695**DCL     11696--IMP-SIZ 11824>>CALL
CLOSE_NODE
     10575**DCL     12757<>CALL
CLOSE_NODE.SN_
     10575**DCL     10575--REDEF
CLOSE_NODE.UTL_
     10576**DCL     10576--REDEF
CLOSE_NODE.V
     10580**DCL     10575--DCLINIT
CLOSE_NODE.V.EXPIRE#
     10590**DCL     10590--REDEF
CLOSE_NODE.V.TYPE#
     10588**DCL     10588--REDEF
CLOSE_NODE.V.XTNSIZE#
     10585**DCL     10585--REDEF   10587--REDEF
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:150  
DELREC_NODE.V
     10859**DCL     10856--DCLINIT
DIRECTORY_NODE
     11729**DCL     12529<<ASSIGN  12596>>ASSIGN  12667<<ASSIGN
DUMMY.ACTPOS
     11425**DCL     11425--REDEF
DUMMY.ARS#
     11399**DCL     11399--REDEF
DUMMY.ATTR
     11418**DCL     11419--REDEF
DUMMY.BORROW
     11433**DCL     11433--REDEF   11433--REDEF   11433--REDEF
DUMMY.DCBNAME.L
     11447**DCL     11447--IMP-SIZ
DUMMY.EOMCHAR#
     11403**DCL     11403--REDEF
DUMMY.FLDID
     11428**DCL     11428--REDEF
DUMMY.FORM$
     11422**DCL     11422--REDEF
DUMMY.FSECT
     11438**DCL     11438--REDEF
DUMMY.FSN#
     11415**DCL     11415--REDEF   11415--REDEF   11416--REDEF
DUMMY.HEADER$
     11421**DCL     11421--REDEF
DUMMY.IXTNSIZE#
     11419**DCL     11419--REDEF
DUMMY.LASTSTA$
     11408**DCL     11408--REDEF
DUMMY.LVL
     11434**DCL     11434--REDEF
DUMMY.NAME#.C
     11409**DCL     11409--REDEF
DUMMY.NOEOF
     11431**DCL     11431--REDEF
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:151  
DUMMY.NRECS#
     11420**DCL     11420--REDEF
DUMMY.NRECX
     11439**DCL     11439--REDEF
DUMMY.OHDR
     11431**DCL     11431--REDEF
DUMMY.ORG#
     11414**DCL     11414--REDEF
DUMMY.PRECNO
     11437**DCL     11437--REDEF
DUMMY.RCSZ
     11443**DCL     11443--REDEF
DUMMY.RES#
     11410**DCL     11410--REDEF
DUMMY.SETX
     11422**DCL     11422--REDEF
DUMMY.TAB$
     11422**DCL     11422--REDEF
DUMMY.TDA
     11436**DCL     11437--REDEF
DUMMY.WSN#
     11410**DCL     11410--REDEF
EOF_SYNON
     12244**LABEL   12205--CALLALT
ERR.MON
     11761**DCL     11840>>IF
ERRMSGFID
     11731**DCL     11774<>CALL
ERR_MEM
     12155**LABEL   11790--CALLALT 11938--CALLALT
ERR_OUT
     12788**LABEL   11816--CALLALT 12387--CALLALT 12389--CALLALT 12705--CALLALT
FILE_BUILT
     12757**LABEL   12714--GOTO    12779--GOTO
FPT_EXIT
     11494**DCL     11842<>CALL    12157<>CALL    12192<>CALL    12374<>CALL    12759<>CALL    12790<>CALL
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:152  
FPT_EXIT.V
     11494**DCL     11494--DCLINIT
FPT_EXIT.V.STEPCC#
     11495**DCL     11495--REDEF   11841<<ASSIGN  11867<<ASSIGN  11916<<ASSIGN  11966<<ASSIGN  12010<<ASSIGN
     12058<<ASSIGN  12156<<ASSIGN  12179<<ASSIGN  12191<<ASSIGN  12223<<ASSIGN  12292<<ASSIGN  12312<<ASSIGN
     12325<<ASSIGN  12362<<ASSIGN  12372>>IF      12789<<ASSIGN
FPT_GDS
     11462**DCL     11790<>CALL    11938<>CALL
FPT_GDS.V
     11462**DCL     11462--DCLINIT
HOLD
     11728**DCL     12618<<CALLBLT 12620>>DOWHILE 12623>>ASSIGN  12686<<CALLBLT 12688>>DOWHILE 12692>>ASSIGN
     12694>>ASSIGN
I
     11712**DCL     11978<<ASSIGN  11981<<ASSIGN  12002>>DOWHILE 12013>>ASSIGN  12134<<ASSIGN  12134>>ASSIGN
     12219<<CALLBLT 12220>>ASSIGN  12221>>ASSIGN  12273<<ASSIGN  12274>>DOWHILE 12338<<ASSIGN  12338>>ASSIGN
     12406<<CALLBLT 12407>>ASSIGN  12408>>ASSIGN  12457<<ASSIGN  12458>>DOWHILE 12467>>ASSIGN  12469>>ASSIGN
     12718<<ASSIGN  12718>>ASSIGN  12730<<ASSIGN  12772<<CALLBLT 12773>>ASSIGN  12774>>ASSIGN
IAM
     11727**DCL     11801<<ASSIGN  11865>>IF      11871<<CALLBLT 12177>>IF      12261>>IF      12385>>ASSIGN
     12406>>CALLBLT 12408>>ASSIGN  12529>>ASSIGN
IAMPTR
     11704**DCL     11802<<ASSIGN  12262<<ASSIGN  12360>>IF      12397>>ASSIGN  12437>>ASSIGN
IDX
     11723**DCL     12469<<ASSIGN  12528>>ASSIGN  12570>>ASSIGN  12730>>ASSIGN
INACCESSIBLE
     12769**LABEL   12744--GOTO
J
     11713**DCL     12085<<CALLBLT 12087>>DOWHILE 12088<<ASSIGN  12088>>ASSIGN  12112<<CALLBLT 12114>>DOWHILE
     12115<<ASSIGN  12115>>ASSIGN  12288<<CALLBLT 12289>>ASSIGN  12290>>ASSIGN  12305<<CALLBLT 12306>>ASSIGN
     12308<<CALLBLT 12309>>ASSIGN  12318<<CALLBLT 12319>>ASSIGN  12321<<CALLBLT 12322>>ASSIGN  12550<<CALLBLT
     12552>>ASSIGN  12553>>ASSIGN  12567<<ASSIGN  12568>>DOWHILE 12569>>ASSIGN  12570>>ASSIGN  12570>>ASSIGN
     12676<<ASSIGN  12676>>ASSIGN  12687<<ASSIGN  12688>>DOWHILE 12688>>DOWHILE 12689<<ASSIGN  12689>>ASSIGN
     12691>>ASSIGN  12692>>ASSIGN  12692>>ASSIGN
K
     11714**DCL     12551<<ASSIGN  12554>>ASSIGN  12555>>ASSIGN  12555>>ASSIGN  12578<<CALLBLT 12580>>ASSIGN
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:153  
     12581>>ASSIGN  12588<<CALLBLT 12589>>ASSIGN  12590>>ASSIGN  12612<<ASSIGN  12614>>DOWHILE 12616<<ASSIGN
     12616>>ASSIGN  12619<<ASSIGN  12620>>DOWHILE 12621<<ASSIGN  12621>>ASSIGN  12623>>ASSIGN  12623>>ASSIGN
     12624>>ASSIGN  12632<<ASSIGN  12633>>ASSIGN  12634>>ASSIGN  12634>>ASSIGN
L
     11715**DCL     12579<<CALLBLT 12582>>ASSIGN  12583>>ASSIGN  12613<<ASSIGN  12615<<ASSIGN  12615>>ASSIGN
     12618>>CALLBLT 12658>>ASSIGN
LVL
     11717**DCL     12436<<ASSIGN  12468>>ASSIGN  12469>>ASSIGN  12470<<ASSIGN  12470>>ASSIGN  12481>>IF
     12486<<ASSIGN  12486>>ASSIGN  12500<<ASSIGN  12500>>ASSIGN  12568>>DOWHILE 12727<<ASSIGN  12727>>ASSIGN
     12728>>IF      12729>>ASSIGN  12730>>ASSIGN
M$CLOSE
      5553**DCL-ENT 12757--CALL
M$DO
     11689**DCL     11836<>CALL    11838<>CALL
M$EXIT
      5565**DCL-ENT 11842--CALL    12157--CALL    12192--CALL    12374--CALL    12759--CALL    12790--CALL
M$GDS
      5588**DCL-ENT 11790--CALL    11938--CALL
M$LO
     11687**DCL     11773<>CALL    11846<>CALL    12409<>CALL    12556<>CALL    12592<>CALL    12603<>CALL
     12642<>CALL    12695<>CALL
M$NODE
     11688**DCL     12788<>CALL
M$OPEN
      5553**DCL-ENT 11816--CALL
M$PFIL
      5555**DCL-ENT 12203--CALL
M$READ
      5554**DCL-ENT 12205--CALL
M$WRITE
      5554**DCL-ENT 11914--CALL    12387--CALL    12389--CALL    12705--CALL
MAXLVL
     11718**DCL     12426<<ASSIGN  12481>>IF      12742<<ASSIGN  12742>>ASSIGN  12743>>IF
MODE.C
     10610**DCL     12634>>ASSIGN
MODE.L
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:154  
     10609**DCL     12633>>ASSIGN  12634>>ASSIGN
NAME_NODE
     10487**DCL     10416--DCLINIT
NEXT_STEP
     12676**LABEL   12598--GOTO
NODECNT
     11719**DCL     11803<<ASSIGN  12145<<ASSIGN  12145>>ASSIGN  12189>>IF      12398<<ASSIGN  12398>>ASSIGN
     12435>>DOWHILE 12511<<ASSIGN  12511>>ASSIGN  12713>>IF
NODEKEY
     10631**DCL     10527--DCLINIT 10528--DCLINIT 10766--DCLINIT 10802--DCLINIT 10803--DCLINIT 10856--DCLINIT
     10857--DCLINIT
NODEKEY.C
     10633**DCL     11902<<CALLBLT 12383<<ASSIGN  12388<<ASSIGN  12527<<ASSIGN  12550>>CALLBLT 12553>>ASSIGN
NODEKEY.L
     10632**DCL     11912<<ASSIGN  12384<<ASSIGN
NODEOVR
     10642**DCL     10737--REDEF
NODEOVR.ACCT
     10662**DCL     12595<<ASSIGN
NODEOVR.NODE_NAME
     10671**DCL     12539<<ASSIGN  12596<<ASSIGN
NODEOVR.PATH_NAME
     10651**DCL     10662--REDEF   12538<<ASSIGN
NODEOVR.TIME
     10729**DCL     12685<<ASSIGN
NODEOVR.TYPE_DEST
     10681**DCL     12540<<ASSIGN  12551>>ASSIGN
NODEOVR.TYPE_PATH
     10700**DCL     12541<<ASSIGN
NODEPTR
     11706**DCL     11735--IMP-PTR 11792<<ASSIGN  11948>>ASSIGN  11949>>ASSIGN  11960>>CALLBLT 11963>>DOWHILE
     11964>>IF      11982>>ASSIGN  12007>>IF      12056>>IF      12129>>ASSIGN  12129>>ASSIGN  12144<<ASSIGN
     12207>>DOWHILE 12253>>DOWHILE 12276>>DOWHILE 12770>>DOWHILE
NODEREC
     10737**DCL     10529--DCLINIT 10530--DCLINIT 10767--DCLINIT 10768--DCLINIT 10804--DCLINIT 10805--DCLINIT
     11893<<CALLBLT 12208>>IF      12219>>CALLBLT 12221>>ASSIGN  12385<<ASSIGN
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:155  
OPEN_NODE
     10415**DCL     11816<>CALL
OPEN_NODE.ACCESS_
     10417**DCL     11813<<ASSIGN
OPEN_NODE.ACSVEH_
     10417**DCL     10418--REDEF   11814<<ASSIGN
OPEN_NODE.ALTKEYS_
     10423**DCL     10424--REDEF   10424--REDEF
OPEN_NODE.HDR_
     10422**DCL     10423--REDEF
OPEN_NODE.TAB_
     10421**DCL     10422--REDEF
OPEN_NODE.UHL_
     10415**DCL     10416--REDEF   10416--REDEF
OPEN_NODE.V
     10424**DCL     10415--DCLINIT
OPEN_NODE.V.FSN#
     10455**DCL     10455--REDEF   10455--REDEF
OPEN_NODE.V.FUN#
     10434**DCL     11815<<ASSIGN
OPEN_NODE.WSN_
     10421**DCL     10421--REDEF
OUT$BLK.CODE
     11321**DCL     11855>>DOSELCT 11980>>IF      11982>>ASSIGN  12034>>DOCASE  12084>>IF      12100>>ASSIGN
     12111>>IF      12120>>ASSIGN
OUT$BLK.NSUBLKS
     11325**DCL     11937>>DOWHILE 12002>>DOWHILE 12007>>IF      12069>>IF      12109>>IF
OUT$BLK.SUBLK$
     11346**DCL     11854>>ASSIGN  11870>>ASSIGN  11892>>ASSIGN  11901>>ASSIGN  11959>>ASSIGN  11979>>ASSIGN
     12013>>ASSIGN  12033>>ASSIGN  12047>>ASSIGN  12070>>ASSIGN  12110>>ASSIGN
OUT$SYM.COUNT
     11383**DCL     11386--IMP-SIZ 11871>>CALLBLT 11893>>CALLBLT 11902>>CALLBLT 11960>>CALLBLT 12036>>CALLBLT
     12038>>CALLBLT 12048>>CALLBLT 12085>>CALLBLT 12112>>CALLBLT
OUT$SYM.TEXT
     11386**DCL     11871>>CALLBLT 11893>>CALLBLT 11902>>CALLBLT 11960>>CALLBLT 12036>>CALLBLT 12038>>CALLBLT
     12048>>CALLBLT 12085>>CALLBLT 12112>>CALLBLT
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:156  
P
     11708**DCL     11870<<ASSIGN  11871>>CALLBLT 11871>>CALLBLT 11892<<ASSIGN  11893>>CALLBLT 11893>>CALLBLT
     11901<<ASSIGN  11902>>CALLBLT 11902>>CALLBLT 11959<<ASSIGN  11960>>CALLBLT 11960>>CALLBLT 11979<<ASSIGN
     11980>>IF      11982>>ASSIGN  12013<<ASSIGN  12033>>ASSIGN  12047>>ASSIGN  12069>>IF      12070>>ASSIGN
     12109>>IF      12110>>ASSIGN  12206<<ASSIGN  12207>>DOWHILE 12208>>IF      12210<<ASSIGN  12210>>ASSIGN
     12210>>ASSIGN  12244<<ASSIGN  12253>>DOWHILE 12261>>IF      12262>>ASSIGN  12272>>ASSIGN  12274>>DOWHILE
     12305>>CALLBLT 12307>>ASSIGN  12318>>CALLBLT 12320>>ASSIGN  12348<<ASSIGN  12437<<ASSIGN  12449>>ASSIGN
     12458>>DOWHILE 12467>>ASSIGN  12468>>ASSIGN  12483<<ASSIGN  12729<<ASSIGN  12769<<ASSIGN  12770>>DOWHILE
     12771>>IF      12772>>CALLBLT 12774>>ASSIGN  12777<<ASSIGN  12777>>ASSIGN  12777>>ASSIGN
PATHPTR
     11707**DCL     11743--IMP-PTR 11793<<ASSIGN  11993<<ASSIGN  11993>>ASSIGN  12021>>ASSIGN  12022>>ASSIGN
     12023>>ASSIGN  12024>>ASSIGN  12025>>ASSIGN  12036>>CALLBLT 12038>>CALLBLT 12048>>CALLBLT 12056>>IF
     12086>>ASSIGN  12089>>ASSIGN  12089>>ASSIGN  12100>>ASSIGN  12113>>ASSIGN  12116>>ASSIGN  12116>>ASSIGN
     12120>>ASSIGN  12130<<ASSIGN  12130>>ASSIGN  12144>>ASSIGN
PFIL_NODE
     10838**DCL     12203<>CALL
PFIL_NODE.V
     10838**DCL     10838--DCLINIT
PROMPT
     11725**DCL     11835--CALL
PTR$
     11722**DCL     12468<<ASSIGN  12528>>ASSIGN  12569>>ASSIGN  12570>>ASSIGN  12729>>ASSIGN
PULL
     12718**LABEL   12487--GOTO    12731--GOTO
PUSH
     12449**LABEL   12484--GOTO
P_PCB
     11125**DCL     11548--DCLINIT
P_PCB.HI_CHAR
     11276**DCL     11837>>IF
P_PCB.OUT$
     11138**DCL     11854>>ASSIGN
Q
     11709**DCL     11962<<ASSIGN  11963>>DOWHILE 11964>>IF      11969<<ASSIGN  11969>>ASSIGN  11969>>ASSIGN
     12033<<ASSIGN  12034>>DOCASE  12036>>CALLBLT 12036>>CALLBLT 12038>>CALLBLT 12038>>CALLBLT 12047<<ASSIGN
     12048>>CALLBLT 12048>>CALLBLT 12070<<ASSIGN  12084>>IF      12085>>CALLBLT 12085>>CALLBLT 12100>>ASSIGN
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:157  
     12110<<ASSIGN  12111>>IF      12112>>CALLBLT 12112>>CALLBLT 12120>>ASSIGN  12272<<ASSIGN  12277>>IF
     12288>>CALLBLT 12290>>ASSIGN  12302>>IF      12313>>ASSIGN  12315>>IF      12327>>ASSIGN  12337>>ASSIGN
     12339<<ASSIGN  12339>>ASSIGN  12348>>ASSIGN  12467<<ASSIGN  12482>>IF      12483>>ASSIGN  12501>>ASSIGN
     12527>>ASSIGN  12540>>ASSIGN
R
     11710**DCL     12275<<ASSIGN  12276>>DOWHILE 12277>>IF      12279<<ASSIGN  12279>>ASSIGN  12279>>ASSIGN
     12302>>IF      12308>>CALLBLT 12310>>ASSIGN  12315>>IF      12321>>CALLBLT 12323>>ASSIGN  12326<<ASSIGN
     12337>>ASSIGN  12501<<ASSIGN  12502>>IF      12510>>ASSIGN  12528<<ASSIGN  12538>>ASSIGN  12539>>ASSIGN
     12541>>ASSIGN  12570<<ASSIGN  12578>>CALLBLT 12579>>CALLBLT 12581>>ASSIGN  12583>>ASSIGN  12584>>IF
     12588>>CALLBLT 12590>>ASSIGN  12595>>ASSIGN  12612>>ASSIGN  12632>>ASSIGN  12667>>ASSIGN
READ_COMMAND
     11835**LABEL   11844--GOTO    11873--GOTO    11918--GOTO    11967--GOTO    12011--GOTO    12146--GOTO
READ_NODE.STATION_
     10530**DCL     10531--REDEF
READ_NODE.V
     10531**DCL     10527--DCLINIT
READ_NODE.V.DVBYTE.REREAD#
     10542**DCL     10542--REDEF
READ_NODE.V.INDX#
     10540**DCL     10540--REDEF
READ_SEQUEN
     10802**DCL     12205<>CALL
READ_SEQUEN.STATION_
     10805**DCL     10806--REDEF
READ_SEQUEN.V
     10806**DCL     10802--DCLINIT
READ_SEQUEN.V.DVBYTE.REREAD#
     10817**DCL     10817--REDEF
READ_SEQUEN.V.INDX#
     10815**DCL     10815--REDEF
TOT_TIME
     11716**DCL     12542<<ASSIGN  12658<<ASSIGN  12658>>ASSIGN  12685>>ASSIGN  12686>>CALLBLT
TYPE.C
     10621**DCL     12555>>ASSIGN
TYPE.L
     10620**DCL     12554>>ASSIGN  12555>>ASSIGN
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:158  
U1
     11751**DCL     12222--CALL    12291--CALL    12311--CALL    12324--CALL    12409--CALL    12556--CALL
     12592--CALL    12603--CALL    12642--CALL    12695--CALL    12775--CALL
U1.C
     11753**DCL     12221<<ASSIGN  12290<<ASSIGN  12307<<ASSIGN  12320<<ASSIGN  12408<<ASSIGN  12553<<ASSIGN
     12581<<ASSIGN  12590<<ASSIGN  12634<<ASSIGN  12692<<ASSIGN  12774<<ASSIGN
U1.L
     11752**DCL     12220<<ASSIGN  12289<<ASSIGN  12306<<ASSIGN  12319<<ASSIGN  12407<<ASSIGN  12552<<ASSIGN
     12580<<ASSIGN  12589<<ASSIGN  12633<<ASSIGN  12691<<ASSIGN  12773<<ASSIGN
U2
     11755**DCL     12311--CALL    12324--CALL    12556--CALL    12592--CALL    12603--CALL    12642--CALL
     12695--CALL
U2.C
     11757**DCL     12310<<ASSIGN  12323<<ASSIGN  12555<<ASSIGN  12583<<ASSIGN  12623<<ASSIGN  12694<<ASSIGN
U2.L
     11756**DCL     12309<<ASSIGN  12322<<ASSIGN  12554<<ASSIGN  12582<<ASSIGN  12624<<ASSIGN  12693<<ASSIGN
VLP_VECTOR
     11478**DCL     11462--DCLINIT
VLP_VECTOR.PTR$
     11480**DCL     11792>>ASSIGN  11793>>ASSIGN  11962>>ASSIGN  12206>>ASSIGN  12244>>ASSIGN  12275>>ASSIGN
     12769>>ASSIGN
VLP_VECTOR.W2
     11479**DCL     11480--REDEF
VWN_COMMAND
     11691**DCL     11835<>CALL
WDSLEFT
     11720**DCL     11791<<ASSIGN  11937>>DOWHILE 11939<<ASSIGN  11939>>ASSIGN  11994<<ASSIGN  11994>>ASSIGN
     12131<<ASSIGN  12131>>ASSIGN
WRITE_NODE
     10766**DCL     11914<>CALL    12387<>CALL    12389<>CALL    12705<>CALL
WRITE_NODE.BUF_.BOUND
     10766**DCL     11913<<ASSIGN  12386<<ASSIGN  12704<<ASSIGN
WRITE_NODE.STATION_
     10768**DCL     10768--REDEF
WRITE_NODE.V
     10769**DCL     10766--DCLINIT
PL6.E3A0      #001=VWN$NODEATER File=VWN$NODEATER.:VMB6TSI                       WED 08/20/97 15:46 Page:159  
WRITE_NODE.V.DVBYTE.VFC#
     10775**DCL     10775--REDEF
XTX$ADAPT
     11530**DCL-ENT 11609--DCLINIT
XUR$CLOSE_DCBS
     10084**DCL-ENT 12758--CALL
XUR$ECHOIF
     10075**DCL-ENT 11836--CALL    11846--CALL
XUR$ERRMSG
     10081**DCL-ENT 11824--CALL    11839--CALL    11866--CALL    11915--CALL    11965--CALL    12009--CALL
     12057--CALL    12155--CALL    12178--CALL    12190--CALL    12222--CALL    12291--CALL    12311--CALL
     12324--CALL    12361--CALL    12373--CALL    12409--CALL    12556--CALL    12592--CALL    12603--CALL
     12642--CALL    12695--CALL    12775--CALL    12788--CALL
XUR$ERRPTR
     10074**DCL-ENT 11838--CALL
XUR$GETCMD
     10073**DCL-ENT 11835--CALL
XUR$INIT
     10078**DCL-ENT 11772--CALL
XUR$SETDCBS
     10077**DCL-ENT 11773--CALL
XUR$SETERRMSG
     10083**DCL-ENT 11774--CALL
XUR_INIT
     11535**DCL     11772<>CALL
XUR_INIT.WORKR_
     11549**DCL     11550--REDEF
YES_DEST
     12302**LABEL   12278--GOTO
YES_SYNON
     12223**LABEL   12209--GOTO
