
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:1    
        1        1        /*M* ZIU$RPLY   IDSII   APPLY DEL-STO-MOD JRNL RECORDS FOR ROLL  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        ZIU$RPLY:PROC NOAUTO ALTRET;
        8        8
        9        9    1   DCL 1 I_O_TAB BASED(DATA$) ALIGNED,
       10       10    1         2 HW (0:2047) UBIN HALF UNAL,
       11       11    1         2 ELEM (0:2047) REDEF HW,
       12       12    1           3 * UBIN(2) UNAL,
       13       13    1           3 VAL UBIN(16) UNAL;
       14       14    1   DCL REC_WRD UBIN WORD STATIC UNAL;
       15       15    1   DCL 1 REC REDEF REC_WRD,
       16       16    1         2 TYPE UBIN HALF UNAL,
       17       17    1         2 LEN UBIN HALF UNAL;
       18       18    1   DCL ZEROS BIT(36) CONSTANT INIT('0'B);
       19       19    1   DCL BIT_LEN UBIN(36);
       20       20    1   DCL BIT_STRING BIT(BIT_LEN) BASED;
       21       21
       22       22    1   DCL END$ PTR STATIC;
       23       23    1   DCL BOTTOM$ PTR STATIC;
       24       24    1   DCL KEY$ PTR STATIC;
       25       25
       26       26    1   DCL TOSTR CHAR(N) BASED(END$);
       27       27    1   DCL FROMSTR CHAR(N) BASED(REC$);
       28       28    1   DCL STRING CHAR(N) BASED;
       29       29    1   DCL N UBIN STATIC;
       30       30    1   DCL WRD UBIN WORD BASED CALIGNED;
       31       31    1   DCL HLFWRD UBIN HALF BASED CALIGNED;
       32       32    1   DCL JREC_NO UBIN WORD SYMREF;
       33       33    1   DCL FRST_OFF UBIN HALF STATIC UNAL;
       34       34    1   DCL LAST_OFF UBIN HALF STATIC UNAL;
       35       35    1   DCL SHIFT_SZ UBIN HALF STATIC UNAL;
       36       36    1   DCL REC_OFF UBIN HALF STATIC UNAL;
       37       37    1   DCL NXT_OFF UBIN HALF STATIC UNAL;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:2    
       38       38    1   DCL REC_DIFF SBIN HALF STATIC UNAL;
       39       39    1   DCL ZERO$ PTR SYMREF;
       40       40
       41       41        /*
       42       42               Buffer management  table  and  data.
       43       43        */
       44       44    1   DCL 1 BUFTBL (0:255) STATIC SYMDEF UNAL,
       45       45    1         2 PTR$ PTR UNAL,
       46       46    1         2 PGNO UBIN WORD UNAL,
       47       47    1         2 FIDX SBIN HALF UNAL,
       48       48    1         2 NXTHSH SBIN BYTE UNAL,
       49       49    1         2 BUSY BIT(1) UNAL,
       50       50    1         2 * BIT(8) UNAL,
       51       51    1         2 Q,
       52       52    1           3 PRI SBIN HALF UNAL,
       53       53    1           3 NXT SBIN HALF UNAL;
       54       54
       55       55    1   DCL CURR_BUF_CNT SBIN WORD STATIC ALIGNED;
       56       56    1   DCL HSHBUF (0:310) SBIN HALF STATIC UNAL;
       57       57    1   DCL HSHINDX SBIN WORD STATIC ALIGNED;
       58       58    1   DCL HSHTEMP SBIN WORD STATIC ALIGNED;
       59       59
       60       60    1   DCL FIRSTBUF SBIN WORD STATIC ALIGNED;
       61       61    1   DCL LASTBUF SBIN WORD STATIC ALIGNED;
       62       62    1   DCL NHSHBUFS SBIN WORD STATIC ALIGNED INIT(311);
       63       63    1   DCL BUFNO SBIN WORD STATIC ALIGNED;
       64       64    1   DCL USABLE_BUFS SBIN WORD STATIC ALIGNED;
       65       65    1   DCL BUFER CHAR(4096) BASED CALIGNED;
       66       66    1   DCL NBUFS SBIN WORD SYMREF ALIGNED;
       67       67    1   DCL XBUFS SBIN WORD SYMREF ALIGNED;
       68       68    1   DCL FIDREM SBIN WORD STATIC ALIGNED; /* Last used fid indx */
       69       69    1   DCL PGREM SBIN WORD STATIC ALIGNED; /* Previos page in buffer */
       70       70    1   DCL NXT_AVAIL_BUF SBIN WORD STATIC ALIGNED;
       71       71    1   DCL 1 ROLLKEY STATIC ALIGNED,
       72       72    1         2 LEN UBIN BYTE UNAL,
       73       73    1         2 VAL CHAR(254) CALIGNED;
       74       74    1   DCL INDXKEY REDEF ROLLKEY CHAR(255) ALIGNED;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:3    
       75       75    1   DCL FOUND BIT(1) STATIC UNAL;
       76       76
       77       77
       78       78         %SUB HASH_ALGORITHM = "MOD(FIDX * PGNO,NHSHBUFS)";
       79       79
       80       80
       81       81    1   DCL SYS_FUNC_READ ENTRY ALTRET;
       82       82    1   DCL SYS_FUNC_WRIT ENTRY ALTRET;
       83       83    1   DCL SYS_FUNC_TSTAMP ENTRY ALTRET;
       84       84    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
       85       85    1   DCL SYS_FUNC_RELDCB ENTRY ALTRET;
       86       86    1   DCL SYS_FUNC_CHECK ENTRY ALTRET;
       87       87    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
       88       88    1   DCL SYS_FUNC_PREC ENTRY ALTRET;
       89       89    1   DCL SYS_FUNC_DELREC ENTRY ALTRET;
       90       90    1   DCL ZERO_SUP ENTRY(3);
       91       91    1   DCL CHKSUM ENTRY;
       92       92    1   DCL CHKJRNL ENTRY;
       93       93    1   DCL SHIFT_ARRAY ENTRY(3);
       94       94    1   DCL ASSOC_DCB ENTRY(1) ALTRET;
       95       95    1   DCL STR_USER_FIDID ENTRY(3) ALTRET;
       96       96    1   DCL QUE_UP ENTRY(1);
       97       97    1   DCL DE_QUE ENTRY(1);
       98       98    1   DCL QUE_LAST ENTRY(1);
       99       99    1   DCL FIND_FID ENTRY(1) ALTRET;
      100      100    1   DCL OPEN_FID ENTRY ALTRET;
      101      101    1   DCL FIND_USER_FIDID ENTRY(3) ALTRET;
      102      102    1   DCL ZIU$CGOPN ENTRY(2) ALTRET;
      103      103    1   DCL ZIU$CGMSG ENTRY(2) ALTRET;
      104      104    1   DCL ZIU$CGDEL ENTRY(2) ALTRET;
      105      105
      106      106
      107      107         %INCLUDE ZI_DBU_ROLL;
      108      191         %ROLL_SUBS;
      109      210         %ROLL_LIST;
      110      269         %INCLUDE ZI$PG_STRUCTS;
      111      372         %DATA_PG;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:4    
      112      391         %INCLUDE CP_6_SUBS;
      113      931         %INCLUDE ZI_ERRORS_SUBS;
      114     1451         %INCLUDE CP_6;
      115     1532         %F$DCB;
      116     1589         %B$TCB;
      117     1592         %B$EXCFR;
      118     1610         %FPT_OPEN;
      119     1719         %VLP_SN(FPTN=PSN,N=1);
      120     1732         %INCLUDE ZI$JRNL;
      121     1840         %JRNL_REC;
      122     1915         %ZI$CGMSG(STCLASS="BASED(JRNL$)");
      123     1952         %ZI$CGDEL(STCLASS="BASED(JRNL$)");
      124     1963         %INCLUDE B_ERRORS_C;
      125     3090         %INCLUDE ZI_GLOBAL_DBUTIL;
      126     3268         %SYS_FUNC;
      127     3360         %MISC_DCLS;
      128     3413
      129     3414         %SUB OFFSET# = "2047 -";
      130     3415
      131     3416        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:5    
      132     3417        /*
      133     3418                 INITIAL BUFFER MANAGEMENT STUFF
      134     3419        */
      135     3420    1   INIT_BUFTBL: ENTRY ALTRET;
      136     3421
      137     3422    1       BUFTBL.Q.PRI(0) = 0;
      138     3423    1       BUFTBL.Q.NXT(0) = 0; /* Entry 0 used only to maintain queue */
      139     3424
      140     3425    1       USABLE_BUFS = NBUFS + XBUFS; /* I/O BUFFERS + Read ahead buffers */
      141     3426    1       IF USABLE_BUFS > 255 THEN /* Max managable buffers is 255 */
      142     3427    1           USABLE_BUFS = 255;
      143     3428
      144     3429    2       DO X = 1 TO USABLE_BUFS;
      145     3430    2           BUFTBL.PTR$(X) = ADDR(I_O_BUF(X-1)); /*  Zero base array */
      146     3431    2           BUFTBL.PGNO(X) = 0;
      147     3432    2           BUFTBL.FIDX(X) = 0;
      148     3433    2           BUFTBL.NXTHSH(X) = -1;
      149     3434    2           BUFTBL.BUSY(X) = %NO#;
      150     3435    2           BUFTBL.Q.PRI(X) = -1;
      151     3436    2           BUFTBL.Q.NXT(X) = -1;
      152     3437    2           END;
      153     3438    1       CURR_BUF_CNT = 1;
      154     3439    2       DO X = 0 TO NHSHBUFS;
      155     3440    2           HSHBUF(X) = -1;
      156     3441    2           END;
      157     3442    1       RETURN;
      158     3443
      159     3444        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:6    
      160     3445        /*       FLUSH ALL I/O BUFFERS   */
      161     3446    1   FLUSH_BUFFERS: ENTRY ALTRET;
      162     3447
      163     3448    2       DO X = 1 TO USABLE_BUFS;
      164     3449    2           IF BUFTBL.FIDX(X) > 0 AND BUFTBL.PGNO(X) > 0 THEN
      165     3450    2               CALL WRITE_PAGE(X) ALTRET(ALTRTN);
      166     3451    2           END;
      167     3452    1       RETURN;
      168     3453        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:7    
      169     3454        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:8    
      170     3455        /*
      171     3456                 PROCESS JOURNAL FID RECORD BY FINDING FID ENTRY AND OPENING
      172     3457        */
      173     3458    1   PROCESS_FID: ENTRY ALTRET;
      174     3459
      175     3460    1       CALL FIND_FID(FIDX);
      176     3461    1       CALL STR_USER_FIDID(FILE.USER#,FILE.DCB#,FIDX) ALTRET(ALTRTN);
      177     3462
      178     3463    1       IF DCBX = -1 THEN
      179     3464    2       DO;
      180     3465         /*E* ERROR: ZIU-DBU#RFID-C
      181     3466                    MESSAGE: File ID received from journal does not agree with
      182     3467                             file ID opened. SYSID= %U1 for file %FN.       */
      183     3468    2           ERR_INSERT.CNT(0) = 7;
      184     3469    2           CALL BINCHAR(ERR_INSERT.TEXT(0),USER.SYSID(FILE.USER#));
      185     3470    2           DCBSF = FIDLIST.DCB#(FIDX);
      186     3471    2           ERRCODESF.ERR# = DBU#RFID;
      187     3472    2           MSGCODE = ERRCODE_RDEF;
      188     3473    2           CALL SYS_FUNC_ERRMSG;
      189     3474    2           ALTRETURN;
      190     3475    2           END;
      191     3476
      192     3477    1       IF FIDLIST.DCB#(FIDX) < 1 THEN
      193     3478    2       DO;
      194     3479    2           CALL ASSOC_DCB(FIDX) ALTRET(ALTRTN);
      195     3480    2           CALL QUE_UP(FIDX);
      196     3481    2           END;
      197     3482    1       IF FILE.COMGROUP THEN
      198     3483    1           CALL ZIU$CGOPN(,FIDLIST.DCB#(FIDX)) ALTRET(ALTRTN);
      199     3484    2       ELSE DO;
      200     3485    2           CALL OPEN_FID ALTRET(ALTRTN);
      201     3486    2           IF FIDLIST.ORG#(FIDX) = %KEYED# THEN
      202     3487    3           DO;
      203     3488    3               FIDX = FIDX + 1; /* Bump up indx to the keyed file entry */
      204     3489    3               IF FIDLIST.DCB#(FIDX) < 1 THEN
      205     3490    4               DO;
      206     3491    4                   CALL ASSOC_DCB(FIDX) ALTRET(ALTRTN);
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:9    
      207     3492    4                   CALL QUE_UP(FIDX);
      208     3493    4                   END;
      209     3494    3               CALL OPEN_FID ALTRET(ALTRTN);
      210     3495    3               FIDX = FIDX - 1;
      211     3496    3               END;
      212     3497    2           END;
      213     3498
      214     3499
      215     3500    1       RETURN;
      216     3501        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:10   
      217     3502        /*
      218     3503                 PROCESS  STORING   JRNL    RECORD
      219     3504        */
      220     3505    1   PROCESS_STO: ENTRY ALTRET;
      221     3506
      222     3507    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);
      223     3508    1       CALL READ_PAGE ALTRET(ALTRTN);
      224     3509
      225     3510    1       IF JREC.LINE > DATA_PG.OFF_LN.SEC AND /* LINE > LINES ALLOCATED */
      226     3511    1          JREC.LINE - DATA_PG.OFF_LN.SEC > 1 THEN
      227     3512    2       DO;
      228     3513    2           J = DATA_PG.OFF_LN.SEC + 1; /* Set J to first unused line */
      229     3514
      230     3515    3           DO X = J TO JREC.LINE - 1; /* BUILD OUT OFFSET ARRAY */
      231     3516    3               I_O_TAB.HW(OFFSET# X) = 131072 + X + 1; /* POINT TO NEXT */
      232     3517    3               DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC - 2;
      233     3518    3               END;
      234     3519
      235     3520    2           I_O_TAB.HW(OFFSET# JREC.LINE) = 131072; /* SET LAST OFSET .400000*/
      236     3521    2           DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC - 2;
      237     3522    2           IF DATA_PG.OFF_LN.FIR = 0 THEN
      238     3523    2               DATA_PG.OFF_LN.FIR = J;
      239     3524    3           ELSE DO; /* Link extension of array into old list */
      240     3525    3               X = I_O_TAB.HW(OFFSET# 2037);
      241     3526    4               DO WHILE(I_O_TAB.HW(OFFSET# X) ~= 131072);
      242     3527    4                   X = I_O_TAB.HW(OFFSET# X) - 131072;
      243     3528    4                   END;
      244     3529    3               I_O_TAB.HW(OFFSET# X) = 131072 + DATA_PG.OFF_LN.SEC +1;
      245     3530    3               END;
      246     3531    2           DATA_PG.OFF_LN.SEC = JREC.LINE;
      247     3532    2           END;
      248     3533
      249     3534    1       IF I_O_TAB.HW(OFFSET# JREC.LINE) > 0 AND
      250     3535    1          I_O_TAB.HW(OFFSET# JREC.LINE) < 131072 THEN
      251     3536    2       DO;
      252     3537         /*E* ERROR: ZIU-DBU#RSTO-C
      253     3538                 MESSAGE: Call to STORE a record at a used line on page# %U1
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:11   
      254     3539                          at line# %U2 of file %FN.                       */
      255     3540    2           ERRCODESF.ERR# = DBU#RSTO;
      256     3541    2           CALL FILL_ERROR_INFO;
      257     3542    2           CALL SYS_FUNC_ERRMSG;
      258     3543    2           ALTRETURN;
      259     3544    2           END;
      260     3545
      261     3546    1       REC$ = PINCRC(DATA$,JREC.OFFSET+12);
      262     3547    1       N = JREC.LENGTH;
      263     3548    1       REC$ -> STRING = JREC.VALUE;
      264     3549
      265     3550    1       IF I_O_TAB.HW(OFFSET# JREC.LINE) = 0 THEN
      266     3551    1           DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC-2;
      267     3552    2       ELSE DO; /* Modify offset array to branch avil line offsets
      268     3553         around the offset just stored. */
      269     3554    2           I_O_TAB.HW(OFFSET# 2037) = I_O_TAB.HW(OFFSET# 2037) + 131072;
      270     3555    2           J = I_O_TAB.HW(OFFSET# 2037);
      271     3556    2           X = 2037;
      272     3557    2           NXT_OFF = I_O_TAB.HW(OFFSET# JREC.LINE);
      273     3558    3           DO WHILE(J < JREC.LINE+131072 AND J > 131072);
      274     3559    3               X = J - 131072;
      275     3560    3               J = I_O_TAB.HW(OFFSET# X);
      276     3561    3               END;
      277     3562    2           I_O_TAB.HW(OFFSET# X) = NXT_OFF;
      278     3563    2           I_O_TAB.HW(OFFSET# 2037) = I_O_TAB.HW(OFFSET# 2037) - 131072;
      279     3564    2           END;
      280     3565
      281     3566    1       I_O_TAB.HW(OFFSET# JREC.LINE) = JREC.OFFSET;
      282     3567    1       DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC - JREC.LENGTH;
      283     3568
      284     3569    1       CALL BUILD_HEADER ALTRET(ALTRTN);
      285     3570
      286     3571    1       RETURN;
      287     3572         %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:12   
      288     3573        /*
      289     3574                 PROCESS  DELETE  THE  JOURNAL  RECORD  FROM  FILE
      290     3575        */
      291     3576    1   PROCESS_DEL: ENTRY ALTRET;
      292     3577
      293     3578    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);
      294     3579    1       CALL READ_PAGE ALTRET(ALTRTN);
      295     3580
      296     3581    1       IF I_O_TAB.HW(OFFSET# JREC.LINE) = 0
      297     3582    1          OR I_O_TAB.HW(OFFSET# JREC.LINE) >= 131072 THEN
      298     3583    2       DO;
      299     3584         /*E* ERROR: ZIU-DBU#RDEL-C
      300     3585                 MESSAGE: Call to DELETE a non-existent record on page# %U1
      301     3586                          at line# %U2 of file %FN.                     */
      302     3587    2           ERRCODESF.ERR# = DBU#RDEL;
      303     3588    2           CALL FILL_ERROR_INFO;
      304     3589    2           CALL SYS_FUNC_ERRMSG;
      305     3590    2           ALTRETURN;
      306     3591    2           END;
      307     3592
      308     3593    1       REC_OFF = I_O_TAB.HW(OFFSET# JREC.LINE); /* Set pointer to record */
      309     3594    1       REC$ = PINCRC(DATA$,REC_OFF+12);
      310     3595
      311     3596    1       REC_WRD = REC$->WRD; /* Save rec type and size */
      312     3597    1       END$ = PINCRC(REC$,REC.LEN); /* Point to nxt record */
      313     3598
      314     3599         /*
      315     3600            Find the position of the first empty data byte and store offset.
      316     3601         */
      317     3602    1       LAST_OFF = (I_O_TAB.ELEM.VAL(6) -
      318     3603    1          (I_O_TAB.ELEM.VAL(7) +
      319     3604    1          ((I_O_TAB.ELEM.VAL(11)+1) *2)));
      320     3605    1       BOTTOM$ = PINCRC(DATA$,LAST_OFF+12);
      321     3606
      322     3607    1       N = LAST_OFF - REC_OFF;
      323     3608    1       SHIFT_SZ = N;
      324     3609    1       REC$ -> STRING = END$ -> STRING; /* Shift data page up */
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:13   
      325     3610
      326     3611    1       BOTTOM$ = PINCRC(BOTTOM$,-1*REC.LEN); /* Shift bottom ptr up */
      327     3612    1       BIT_LEN = REC.LEN * 9;
      328     3613    1       BOTTOM$->BIT_STRING = ZEROS;
      329     3614         /*
      330     3615            Now the data is modified - modify offset array and header info.
      331     3616         */
      332     3617    2       DO X = 0 TO DATA_PG.OFF_LN.SEC;
      333     3618    2           IF I_O_TAB.HW(OFFSET# X) > REC_OFF
      334     3619    2              AND I_O_TAB.HW(OFFSET# X) < 131072 THEN
      335     3620    2               I_O_TAB.HW(OFFSET# X) = I_O_TAB.HW(OFFSET# X) - REC.LEN;
      336     3621    2           END;
      337     3622
      338     3623    1       DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC + REC.LEN;
      339     3624
      340     3625    1       CALL BUILD_HEADER ALTRET(ALTRTN);
      341     3626
      342     3627    1       RETURN;
      343     3628        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:14   
      344     3629        /*
      345     3630                 PROCESS MODIFY THE FILE PAGE WITH JOURNAL RECORD
      346     3631        */
      347     3632    1   PROCESS_MOD: ENTRY ALTRET;
      348     3633
      349     3634    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);
      350     3635    1       CALL READ_PAGE ALTRET(ALTRTN);
      351     3636
      352     3637    1       REC_OFF = I_O_TAB.HW(OFFSET# JREC.LINE);
      353     3638    1       REC$ = PINCRC(DATA$,REC_OFF+12);
      354     3639    1       REC_WRD = REC$ -> WRD;
      355     3640    1       REC_DIFF = JREC.LENGTH - REC.LEN; /* CALC DIFF BETWEEN TWO RECS */
      356     3641    1       N = JREC.LENGTH; /* Set size of based string array */
      357     3642
      358     3643    1       REC$ = ADDR(JREC.VALUE);
      359     3644    1       IF REC.TYPE ~= REC$ -> HLFWRD THEN
      360     3645    2       DO;
      361     3646         /*E* ERROR: ZIU-DBU#RMOD-C
      362     3647                    MESSAGE: Mismatch in record types on a MODIFY call on page# %U1
      363     3648                             at line# %U2 of file %FN.              */
      364     3649    2           ERRCODESF.ERR# = DBU#RMOD;
      365     3650    2           CALL FILL_ERROR_INFO;
      366     3651    2           CALL SYS_FUNC_ERRMSG;
      367     3652    2           ALTRETURN;
      368     3653    2           END;
      369     3654
      370     3655    1       REC$ = PINCRC(DATA$,REC_OFF+12);
      371     3656
      372     3657    1       IF REC_DIFF < 0 THEN /* New rec is smaller than old - compress */
      373     3658    2       DO; /* page. First find end of data. */
      374     3659    2           LAST_OFF = (I_O_TAB.ELEM.VAL(6) -
      375     3660    2              (I_O_TAB.ELEM.VAL(7) +
      376     3661    2              ((I_O_TAB.ELEM.VAL(11)+1) *2)));
      377     3662    2           BOTTOM$ = PINCRC(DATA$,LAST_OFF+12);
      378     3663
      379     3664    2           END$ = PINCRC(REC$,REC.LEN); /* Set ptr to end of data rec */
      380     3665    2           REC$ = PINCRC(REC$,JREC.LENGTH); /* Set ptr to end of new rec */
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:15   
      381     3666    2           N = LAST_OFF -(REC_OFF + JREC.LENGTH); /* SET len of shift */
      382     3667    2           REC$ -> STRING = END$ -> STRING; /* * * SHIFT UP * * */
      383     3668         /* Zero out bottom */
      384     3669    2           BOTTOM$ = PINCRC(BOTTOM$,REC_DIFF);
      385     3670    2           BIT_LEN = -1*REC_DIFF;
      386     3671    2           BOTTOM$->BIT_STRING = ZEROS;
      387     3672
      388     3673    2           REC$ = PINCRC(DATA$,REC_OFF+12); /* Reset record pointer */
      389     3674    2           END;
      390     3675
      391     3676    1       IF REC_DIFF > 0 THEN /* New rec is larger than old - */
      392     3677    2       DO; /* Expand data page to accomadate*/
      393     3678    2           LAST_OFF = (I_O_TAB.ELEM.VAL(6) -
      394     3679    2              (I_O_TAB.ELEM.VAL(7) +
      395     3680    2              ((I_O_TAB.ELEM.VAL(11)+1) *2)))+12;
      396     3681    2           N = LAST_OFF -(REC_OFF + REC.LEN); /* Set len of shift */
      397     3682    2           END$ = PINCRC(REC$,JREC.LENGTH);
      398     3683    2           REC$ = PINCRC(REC$,REC.LEN);
      399     3684
      400     3685
      401     3686    2           CALL SHIFT_ARRAY(FROMSTR,TOSTR,N); /* BMAP MRL subroutine */
      402     3687    2           REC$ = PINCRC(DATA$,REC_OFF+12); /* Reset record ptr */
      403     3688    2           END;
      404     3689
      405     3690    1       N = JREC.LENGTH; /* Make actual string change */
      406     3691    1       REC$ -> STRING = JREC.VALUE;
      407     3692
      408     3693    1       IF REC_DIFF ~= 0 THEN
      409     3694    2       DO;
      410     3695    2           DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC - REC_DIFF;
      411     3696         /* Modify offset arrary */
      412     3697    3           DO X = 0 TO DATA_PG.OFF_LN.SEC;
      413     3698    3               IF I_O_TAB.HW(OFFSET# X) > REC_OFF AND
      414     3699    3                  I_O_TAB.HW(OFFSET# X) < 131072 THEN
      415     3700    3                   I_O_TAB.HW(OFFSET# X) = I_O_TAB.HW(OFFSET# X) + REC_DIFF;
      416     3701    3               END;
      417     3702    2           END;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:16   
      418     3703    1       CALL BUILD_HEADER ALTRET(ALTRTN);
      419     3704    1       RETURN;
      420     3705        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:17   
      421     3706        /*
      422     3707              PROCESS MODIFY OF CHANGED SET POINTERS DO TO STORE OR DELETE
      423     3708        */
      424     3709    1   PROCESS_SET: ENTRY ALTRET;
      425     3710
      426     3711    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);
      427     3712    1       CALL READ_PAGE ALTRET(ALTRTN);
      428     3713
      429     3714    1       REC$ = PINCRC(DATA$,JREC.OFFSET+12);
      430     3715    1       N = JREC.LENGTH;
      431     3716
      432     3717    1       REC$ -> STRING = JREC.VALUE;
      433     3718
      434     3719    1       IF DATA_PG.CHKSUM_WD ~= 0 THEN
      435     3720    2       DO;
      436     3721    2           CALL CHKSUM;
      437     3722    2           DATA_PG.CHKSUM_WD = ICHKSUM;
      438     3723    2           END;
      439     3724
      440     3725    1       RETURN;
      441     3726        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:18   
      442     3727        /*
      443     3728              TAKE CHECKSUM OF PAGE AND CHECK AGAINST IDS AFTER IMAGE CHECKSUM
      444     3729        */
      445     3730    1   PROCESS_SUM: ENTRY ALTRET;
      446     3731
      447     3732    1       CALL FIND_USER_FIDID(CKSM.USER#,CKSM.DCB#,FIDX);
      448     3733    1       CALL READ_PAGE ALTRET(ALTRTN);
      449     3734
      450     3735    1       CALL CHKJRNL; /* BMAP routine returns chksum value in ICHKSUM */
      451     3736
      452     3737    1       IF ICHKSUM ~= CKSM.CKSM THEN
      453     3738    2       DO;
      454     3739         /*E* ERROR: ZIU-DBU#RCHK-C
      455     3740                    MESSAGE: Page reconstruction warning - occurrence on page# %U1
      456     3741                             in file %FN - Journal record# %U2.       */
      457     3742    2           ERRCODESF.ERR# = DBU#RCHK;
      458     3743    2           ERR_INSERT.CNT(0) = 11;
      459     3744    2           CALL BINCHAR(ERR_INSERT.TEXT(0),CKSM.PAGE);
      460     3745    2           CALL ZERO_SUP(ERR_INSERT.TEXT(0),30,'1'B);
      461     3746    2           ERR_INSERT.CNT(1) = 11;
      462     3747    2           CALL BINCHAR(ERR_INSERT.TEXT(1),JREC_NO);
      463     3748    2           CALL ZERO_SUP(ERR_INSERT.TEXT(1),30,'1'B);
      464     3749    2           DCBSF = FIDLIST.DCB#(FIDX);
      465     3750    2           MSGCODE = ERRCODE_RDEF;
      466     3751    2           ERRFLGSF = 2;
      467     3752    2           CALL SYS_FUNC_ERRMSG;
      468     3753    2           STEPCC=4;
      469     3754    2           END;
      470     3755
      471     3756    1       RETURN;
      472     3757        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:19   
      473     3758        /*
      474     3759                  P R O C E S S     I N D E X E D   S T O R E  &  M O D I F Y
      475     3760        */
      476     3761    1   PROCESS_ISTO: ENTRY ALTRET;
      477     3762
      478     3763    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);
      479     3764    1       IF FIDLIST.DCB#(FIDX) < 1 THEN
      480     3765    2       DO;
      481     3766    2           CALL ASSOC_DCB(FIDX);
      482     3767    2           CALL QUE_UP(FIDX);
      483     3768    2           CALL OPEN_FID ALTRET(ALTRTN);
      484     3769    2           END;
      485     3770
      486     3771    1       DCBSF = FIDLIST.DCB#(FIDX);
      487     3772    1       CALL FIND_KEY ALTRET(ALTRTN);
      488     3773
      489     3774         /*E* ERROR: ZIU-DBU#IRSTO-C
      490     3775           MESSAGE: Call to STORE a record which already exists for SYSID# %U1
      491     3776                    in file %FN.                                            */
      492     3777         /*E* ERROR: ZIU-DBU#IRMOD-C
      493     3778           MESSAGE: Call to MODIFY a record which does not exist for SYSID# %U1
      494     3779                    in file %FN.                                            */
      495     3780
      496     3781    1       IF (FOUND = %YES# AND JREC.TYPE = T#IMOD) OR
      497     3782    1          (FOUND = %NO# AND JREC.TYPE = T#ISTO) THEN
      498     3783    2       DO;
      499     3784    2           ENCRP_SEEDSF = FIDLIST.CRPT_B(FIDX);
      500     3785    2           INDXKEYSF = INDXKEY;
      501     3786    2           CALL SYS_FUNC_WRIT ALTRET(ALTRTN);
      502     3787    2           FIDLIST.MOD#(FIDX) = 1;
      503     3788    2           IF DCBADDR(DCBSF) -> F$DCB.RDL0# > 3 THEN
      504     3789    3           DO;
      505     3790    3               CALL SYS_FUNC_CLOS;
      506     3791    3               CALL OPEN_FID ALTRET(ALTRTN);
      507     3792    3               END;
      508     3793    2           END;
      509     3794    2       ELSE DO;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:20   
      510     3795    2           IF JREC.TYPE = T#IMOD THEN
      511     3796    2               ERRCODESF.ERR# = DBU#IRMOD;
      512     3797    2           ELSE
      513     3798    2               ERRCODESF.ERR# = DBU#IRSTO;
      514     3799    2           CALL BINCHAR(ERR_INSERT.TEXT(0),USER.SYSID(FILE.USER#));
      515     3800    2           MSGCODE = ERRCODE_RDEF;
      516     3801    2           CALL SYS_FUNC_ERRMSG;
      517     3802    2           ALTRETURN;
      518     3803    2           END;
      519     3804
      520     3805    1       RETURN;
      521     3806        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:21   
      522     3807        /*
      523     3808                 P R O C E S S   I N D E X E D    D E L E T E
      524     3809        */
      525     3810    1   PROCESS_IDEL: ENTRY ALTRET;
      526     3811
      527     3812    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);
      528     3813    1       IF FIDLIST.DCB#(FIDX) < 1 THEN
      529     3814    2       DO;
      530     3815    2           CALL ASSOC_DCB(FIDX);
      531     3816    2           CALL QUE_UP(FIDX);
      532     3817    2           CALL OPEN_FID ALTRET(ALTRTN);
      533     3818    2           END;
      534     3819
      535     3820    1       DCBSF = FIDLIST.DCB#(FIDX);
      536     3821    1       CALL FIND_KEY ALTRET(ALTRTN);
      537     3822
      538     3823         /*E* ERROR: ZIU-DBU#IRDEL-C
      539     3824           MESSAGE: Call to DELETE a record which does not exist for SYSID# %U1
      540     3825                    in file %FN.                                            */
      541     3826
      542     3827    1       IF FOUND = %YES# THEN
      543     3828    2       DO;
      544     3829    2           INDXKEYSF = INDXKEY;
      545     3830    2           CALL SYS_FUNC_DELREC ALTRET(ALTRTN);
      546     3831    2           FIDLIST.MOD#(FIDX) = 1;
      547     3832    2           END;
      548     3833    2       ELSE DO;
      549     3834    2           ERR_INSERT.CNT(0) = 7;
      550     3835    2           CALL BINCHAR(ERR_INSERT.TEXT(0),USER.SYSID(FILE.USER#));
      551     3836    2           ERRCODESF.ERR# = DBU#RKDEL;
      552     3837    2           MSGCODE = ERRCODE_RDEF;
      553     3838    2           CALL SYS_FUNC_ERRMSG;
      554     3839    2           ALTRETURN;
      555     3840    2           END;
      556     3841
      557     3842    1       RETURN;
      558     3843        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:22   
      559     3844    1   PROCESS_KSTO: ENTRY ALTRET;
      560     3845
      561     3846    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);
      562     3847    1       FIDX = FIDX + 1; /* Bump up indx by 1 to get keyed file */
      563     3848    1       IF FIDLIST.DCB#(FIDX) < 1 THEN
      564     3849    2       DO;
      565     3850    2           CALL ASSOC_DCB(FIDX);
      566     3851    2           CALL QUE_UP(FIDX);
      567     3852    2           CALL OPEN_FID ALTRET(ALTRTN);
      568     3853    2           END;
      569     3854
      570     3855    1       DCBSF = FIDLIST.DCB#(FIDX);
      571     3856    1       CALL FIND_KEY ALTRET(ALTRTN); /* Call M$PREREC to get key */
      572     3857
      573     3858    1       IF FOUND = %YES# THEN
      574     3859    2       DO;
      575     3860         /*E* ERROR: ZIU-DBU#RKSTO-C
      576     3861              MESSAGE: Call to STORE an alternate key which already exists
      577     3862                       for SYSID# %U1 in file %FN.                          */
      578     3863    2           ERR_INSERT.CNT(0) = 7;
      579     3864    2           CALL BINCHAR(ERR_INSERT.TEXT(0),USER.SYSID(FILE.USER#));
      580     3865    2           ERRCODESF.ERR# = DBU#RKSTO;
      581     3866    2           MSGCODE = ERRCODE_RDEF;
      582     3867    2           CALL SYS_FUNC_ERRMSG;
      583     3868    2           ALTRETURN;
      584     3869    2           END;
      585     3870    2       ELSE DO;
      586     3871    2           BUFLNSF = 0;
      587     3872    2           ENCRP_SEEDSF = '0'B;
      588     3873    2           VFCSF = %NO#;
      589     3874    2           KEYVSF = ROLLKEY;
      590     3875    2           CALL SYS_FUNC_WRIT ALTRET(ALTRTN);
      591     3876    2           FIDLIST.MOD#(FIDX) = 1; /* File modified flag */
      592     3877    2           IF DCBADDR(DCBSF) -> F$DCB.RDL0# > 3 THEN
      593     3878    3           DO;
      594     3879    3               CALL SYS_FUNC_CLOS;
      595     3880    3               CALL OPEN_FID ALTRET(ALTRTN);
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:23   
      596     3881    3               END;
      597     3882    2           END;
      598     3883    1       RETURN;
      599     3884        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:24   
      600     3885    1   PROCESS_CGMSG: ENTRY ALTRET;
      601     3886
      602     3887    1       CALL FIND_USER_FIDID(ZI$CGMSG.USER#,ZI$CGMSG.DCB#,FIDX);
      603     3888    2       IF FIDLIST.DCB#(FIDX) = 0 THEN DO;
      604     3889    2           CALL ASSOC_DCB(FIDX);
      605     3890    2           CALL QUE_UP(FIDX);
      606     3891    2           CALL ZIU$CGOPN(,FIDLIST.DCB#(FIDX)) ALTRET(ALTRTN);
      607     3892    2           END;
      608     3893    1       CALL ZIU$CGMSG(JRNL$,FIDLIST.DCB#(FIDX)) ALTRET(ALTRTN);
      609     3894    1       RETURN;
      610     3895        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:25   
      611     3896    1   PROCESS_CGDEL: ENTRY ALTRET;
      612     3897
      613     3898    1       CALL FIND_USER_FIDID(ZI$CGDEL.USER#,ZI$CGDEL.DCB#,FIDX);
      614     3899    2       IF FIDLIST.DCB#(FIDX) = 0 THEN DO;
      615     3900    2           CALL ASSOC_DCB(FIDX);
      616     3901    2           CALL QUE_UP(FIDX);
      617     3902    2           CALL ZIU$CGOPN(,FIDLIST.DCB#(FIDX)) ALTRET(ALTRTN);
      618     3903    2           END;
      619     3904    1       CALL ZIU$CGDEL(JRNL$,FIDLIST.DCB#(FIDX)) ALTRET(ALTRTN);
      620     3905    1       USER.CGMSGID(ZI$CGDEL.USER#) = '0'B;
      621     3906    1       RETURN;
      622     3907        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:26   
      623     3908        /*
      624     3909                 PROCESS   DELETE  ALTERNATE  KEY
      625     3910        */
      626     3911    1   PROCESS_KDEL: ENTRY ALTRET;
      627     3912
      628     3913    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);
      629     3914    1       FIDX = FIDX + 1; /* Bump up indx by 1 to get keyed file */
      630     3915    1       IF FIDLIST.DCB#(FIDX) < 1 THEN
      631     3916    2       DO;
      632     3917    2           CALL ASSOC_DCB(FIDX);
      633     3918    2           CALL QUE_UP(FIDX);
      634     3919    2           CALL OPEN_FID ALTRET(ALTRTN);
      635     3920    2           END;
      636     3921
      637     3922    1       DCBSF = FIDLIST.DCB#(FIDX);
      638     3923    1       CALL FIND_KEY ALTRET(ALTRTN); /* Call M$PREREC to get key */
      639     3924
      640     3925    1       IF FOUND = %NO# THEN
      641     3926    2       DO;
      642     3927         /*E* ERROR: ZIU-DBU#RKDEL-C
      643     3928              MESSAGE: Call to DELETE an alternate key which does not exist
      644     3929                       for SYSID# %U1 in file %FN.                          */
      645     3930    2           ERR_INSERT.CNT(0) = 7;
      646     3931    2           CALL BINCHAR(ERR_INSERT.TEXT(0),USER.SYSID(FILE.USER#));
      647     3932    2           ERRCODESF.ERR# = DBU#RKSTO;
      648     3933    2           MSGCODE = ERRCODE_RDEF;
      649     3934    2           CALL SYS_FUNC_ERRMSG;
      650     3935    2           ALTRETURN;
      651     3936    2           END;
      652     3937    2       ELSE DO;
      653     3938    2           KEYVSF = ROLLKEY;
      654     3939    2           CALL SYS_FUNC_DELREC ALTRET(ALTRTN);
      655     3940    2           FIDLIST.MOD#(FIDX) = 1;
      656     3941    2           END;
      657     3942    1       RETURN;
      658     3943        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:27   
      659     3944        /*
      660     3945              FIND   JOURNAL  RECORD  ALTERNATE  KEY
      661     3946        */
      662     3947    1   FIND_KEY: PROC ALTRET;
      663     3948
      664     3949    2   /**/ COUNTSF = 0;
      665     3950    2       IF DCBADDR(DCBSF)->F$DCB.ORG# = %INDEXED# THEN
      666     3951    3       DO;
      667     3952    3           KEY$ = ADDR(JREC.VALUE);
      668     3953    3           KEY$ = PINCRC(KEY$,DCBADDR(DCBSF)->F$DCB.KEYX#);
      669     3954    3           N = DCBADDR(DCBSF) -> F$DCB.KEYL#;
      670     3955    3           INDXKEY = KEY$ -> STRING;
      671     3956    3           BUFLNSF = N - 1;
      672     3957    3           INDXKEYSF = INDXKEY;
      673     3958    3           INDEXSF = 1;
      674     3959    3           END;
      675     3960    3       ELSE DO;
      676     3961    3           ROLLKEY.LEN = JREC.LENGTH;
      677     3962    3           ROLLKEY.VAL = JREC.VALUE;
      678     3963    3           KEYVSF = ROLLKEY;
      679     3964    3           END;
      680     3965    2       CALL SYS_FUNC_PREC ALTRET(ALTRTN);
      681     3966
      682     3967    2       IF NO_KEYSF = %YES# THEN
      683     3968    2           FOUND = %NO#;
      684     3969    2       ELSE
      685     3970    2           FOUND= %YES#;
      686     3971    2       RETURN;
      687     3972    2   ALTRTN:
      688     3973    2       ALTRETURN;
      689     3974    2   END FIND_KEY;
      690     3975        /*
      691     3976              ADJUST  HEADER  INFO  TO REFLECT  CHANGE  AND CHECK CHECKSUM
      692     3977        */
      693     3978    1   BUILD_HEADER: PROC ALTRET;
      694     3979
      695     3980        /* TIMESTAMP:
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:28   
      696     3981              TSTAMPSF = VECTOR(DATA_PG.SYS_WRDS.DATE);
      697     3982              DATESF   = VECTOR(NIL);
      698     3983              SOURCESF = %CLOCK#;
      699     3984              DESTSF   = %UTS#;
      700     3985              CALL SYS_FUNC_TSTAMP;   */
      701     3986    2       IF JREC.TYPE = T#MOD THEN
      702     3987    2           GOTO CHK_SUM;
      703     3988
      704     3989    2   OFF_LN:
      705     3990         /*    Link deleted line into avail line chain */
      706     3991    2       IF JREC.TYPE = T#DEL THEN
      707     3992    3       DO; /* I_O_TAB.HW(OFFSET# 2037) is the first avil line# */
      708     3993    3           I_O_TAB.HW(OFFSET# 2037) = I_O_TAB.HW(OFFSET# 2037) + 131072;
      709     3994    3           J = I_O_TAB.HW(OFFSET# 2037);
      710     3995    3           X = 2037;
      711     3996    4           DO WHILE(J > 131072 AND J < 131072 + JREC.LINE);
      712     3997    4               X = J - 131072;
      713     3998    4               J = I_O_TAB.HW(OFFSET# X);
      714     3999    4               END;
      715     4000    3           I_O_TAB.HW(OFFSET# X) = 131072 + JREC.LINE;
      716     4001    3           I_O_TAB.HW(OFFSET# JREC.LINE) = J;
      717     4002    3           I_O_TAB.HW(OFFSET# 2037) = I_O_TAB.HW(OFFSET# 2037)-131072;
      718     4003    3           END;
      719     4004
      720     4005         /*    SET  THE CURRENT HIGHLINE NUMBER */
      721     4006
      722     4007    2       IF JREC.LINE > DATA_PG.OFF_LN.SEC THEN
      723     4008    2           DATA_PG.OFF_LN.SEC = JREC.LINE;
      724     4009
      725     4010    2   CHK_SUM:
      726     4011    2       IF DATA_PG.CHKSUM_WD ~= 0 THEN
      727     4012    3       DO;
      728     4013    3           CALL CHKSUM; /* BMAP routine rtrns chksum in ICHKSUM */
      729     4014    3           DATA_PG.CHKSUM_WD = ICHKSUM;
      730     4015    3           END;
      731     4016    2       FIDLIST.MOD#(FIDX) = 1; /* File modified flag */
      732     4017    2       RETURN;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:29   
      733     4018    2   END BUILD_HEADER;
      734     4019        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:30   
      735     4020        /*
      736     4021                 FILL  IN  ERROR  INFORMATION
      737     4022        */
      738     4023    1   FILL_ERROR_INFO: PROC;
      739     4024
      740     4025    2       CALL BINCHAR(ERR_INSERT.TEXT(0),JREC.PAGE);
      741     4026    2       CALL BINCHAR(ERR_INSERT.TEXT(1),JREC.LINE);
      742     4027    2       CALL ZERO_SUP(ERR_INSERT.TEXT(0),30,'1'B /* LEFT JUSTIFY */);
      743     4028    2       CALL ZERO_SUP(ERR_INSERT.TEXT(1),30,'1'B);
      744     4029
      745     4030    2       ERR_INSERT.CNT(0) = 11;
      746     4031    2       ERR_INSERT.CNT(1) = 3;
      747     4032    2       DCBSF = FIDLIST.DCB#(FIDX); /* ERRMSG NEEDS DCB TO GET FILENAME */
      748     4033
      749     4034    2       MSGCODE = ERRCODE_RDEF;
      750     4035
      751     4036    2       RETURN;
      752     4037    2   END FILL_ERROR_INFO;
      753     4038        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:31   
      754     4039        /*
      755     4040                     READ   AND   WRITE   ROUTINES
      756     4041        */
      757     4042    1   READ_PAGE: PROC ALTRET;
      758     4043
      759     4044    2   DCL CURR_FIDX SBIN WORD STATIC INIT(0);
      760     4045    2   DCL CURR_PAGE UBIN WORD STATIC INIT(0);
      761     4046
      762     4047
      763     4048    2       CALL FIND_BUF(FIDX,JREC.PAGE,BUFNO);
      764     4049    2       IF BUFNO ~= -1 THEN /* page is already in memory */
      765     4050    3       DO;
      766     4051    3           DATA$ = BUFTBL.PTR$(BUFNO);
      767     4052    3           CALL QUE_BUF_LAST(BUFNO);
      768     4053    3           RETURN;
      769     4054    3           END;
      770     4055    3       ELSE DO;
      771     4056    3           CALL GET_BUF(FIDX,JREC.PAGE,BUFNO) ALTRET(ALTREAD);
      772     4057    3           IF FIDLIST.DCB#(FIDX) = 0 THEN
      773     4058    4           DO;
      774     4059    4               CALL ASSOC_DCB(FIDX);
      775     4060    4               CALL QUE_UP(FIDX);
      776     4061    4               CALL OPEN_FID;
      777     4062    4               END;
      778     4063
      779     4064    4           DO WHILE(BUFTBL.BUSY(BUFNO) = %YES#);
      780     4065         /* We will wait in this loop until the last i/o on this
      781     4066            buffer has completed at which time the event will wake
      782     4067            up ZIU$EVENT and the busy bit will be reset.
      783     4068         */
      784     4069    4               END;
      785     4070    3    /**/   DCBSF = FIDLIST.DCB#(FIDX);
      786     4071    3    /**/   BUFSF = VECTOR(BUFTBL.PTR$(BUFNO) -> BUFER);
      787     4072    3    /**/   KEYSF = %YES#;
      788     4073    3    /**/   BUFLNSF = 4096;
      789     4074    3    /**/   ENCRP_SEEDSF = FIDLIST.CRPT_B(FIDX);
      790     4075    3    /**/   FULLSF = %YES#;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:32   
      791     4076    3    /**/   KEYVSF.IDSKEY = JREC.PAGE;
      792     4077    3    /**/   WAITSF = %YES#;
      793     4078    3           CALL SYS_FUNC_READ ALTRET(ALTREAD);
      794     4079    3           DATA$ = BUFTBL.PTR$(BUFNO);
      795     4080    3           CALL QUE_BUF_LAST(BUFNO); /* Que as most recently used BUFFER */
      796     4081    3           CALL QUE_LAST(FIDX); /* Put this file in as most recently used
      797     4082         in the DCB QUE. */
      798     4083    3           RETURN;
      799     4084    3           END;
      800     4085
      801     4086    2   ALTREAD:
      802     4087    2       ALTRETURN;
      803     4088    2   END READ_PAGE;
      804     4089        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:33   
      805     4090    1   WRITE_PAGE: PROC(BUFNO) ALTRET;
      806     4091    2   DCL BUFNO SBIN;
      807     4092
      808     4093    2   /**/ DCBSF = FIDLIST.DCB#(BUFTBL.FIDX(BUFNO));
      809     4094    2       IF DCBSF = 0 THEN
      810     4095    3       DO; /* Get a dcb to use for this write */
      811     4096    3           FIDREM = FIDX;
      812     4097    3           FIDX = BUFTBL.FIDX(BUFNO); /* This is the fid num to write */
      813     4098    3           CALL ASSOC_DCB(FIDX);
      814     4099    3           CALL QUE_UP(FIDX);
      815     4100    3           CALL OPEN_FID;
      816     4101    3           FIDX = FIDREM;
      817     4102    3           END;
      818     4103
      819     4104    2   /**/ BUFSF = VECTOR(BUFTBL.PTR$(BUFNO) -> BUFER);
      820     4105    2   /**/ BUFLNSF = 4096;
      821     4106    2   /**/ VFCSF = %NO#;
      822     4107    2   /**/ ENCRP_SEEDSF = FIDLIST.CRPT_B(FIDX);
      823     4108    2   /**/ KEYVSF.IDSKEY = BUFTBL.PGNO(BUFNO);
      824     4109    2   /**/ WAITSF = %NO#; /* No wait write */
      825     4110    2   /**/ EVENTSF = BUFNO; /* Let the bufno be event number of I/O */
      826     4111    2       BUFTBL.BUSY(BUFNO) = %YES#; /* Buffer is busy during I/O */
      827     4112    2   /**/ FULLSF = %YES#;
      828     4113    2       CALL SYS_FUNC_WRIT ALTRET(ALTWRIT);
      829     4114    2       RETURN;
      830     4115
      831     4116    2   ALTWRIT:
      832     4117    2       ALTRETURN;
      833     4118    2   END WRITE_PAGE;
      834     4119        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:34   
      835     4120        /*
      836     4121               THE following procedures are routines used to keep track
      837     4122           of the buffers used for I/O. The buffer table can keep track
      838     4123           of up to 255 buffers. Each buffer may be hashed to using the
      839     4124            page number and index of the fid in the fid table that the
      840     4125           buffer is to contain.
      841     4126        */
      842     4127    1   FIND_BUF: PROC(FIDX,PGNO,BUFNO); /* Find buffer by hashing */
      843     4128    2   DCL FIDX SBIN;
      844     4129    2   DCL PGNO UBIN;
      845     4130    2   DCL BUFNO SBIN;
      846     4131
      847     4132    2       HSHINDX = HASH_ALGORITHM;
      848     4133    2       BUFNO = HSHBUF(HSHINDX);
      849     4134    2       IF HSHBUF(HSHINDX) = -1 THEN
      850     4135    2           RETURN; /* PAGE IS NOT IN MEMORY */
      851     4136
      852     4137    2       BUFNO = HSHBUF(HSHINDX);
      853     4138    2       IF BUFTBL.FIDX(BUFNO)~=FIDX OR
      854     4139    2          BUFTBL.PGNO(BUFNO)~=PGNO THEN /* NOT DIRECT HIT */
      855     4140    3       DO; /* SEARCH FOR THE PAGE UNTIL FOUND OR END OF CHAIN */
      856     4141    3           HSHINDX = BUFTBL.NXTHSH(BUFNO);
      857     4142    4           DO WHILE(HSHINDX ~= -1 AND (BUFTBL.FIDX(HSHINDX) ~= FIDX OR
      858     4143    4              BUFTBL.PGNO(HSHINDX) ~= PGNO));
      859     4144    4               HSHINDX = BUFTBL.NXTHSH(HSHINDX);
      860     4145    4               END;
      861     4146    3           BUFNO = HSHINDX; /* RETURN WITH PAGE FOUND OR A -1 */
      862     4147    3           END;
      863     4148    2       RETURN;
      864     4149    2   END FIND_BUF;
      865     4150        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:35   
      866     4151        /*
      867     4152              QUE BUFFER AS LAST USED  ie THE MOST RECENTLY USED.
      868     4153        */
      869     4154    1   QUE_BUF_LAST: PROC(BUFNO);
      870     4155    2   DCL BUFNO SBIN;
      871     4156
      872     4157    2       LASTBUF = BUFTBL.Q.PRI(0);
      873     4158    2       FIRSTBUF= BUFTBL.Q.NXT(0);
      874     4159
      875     4160    2       IF LASTBUF = BUFNO THEN
      876     4161    2           RETURN; /* Buffer already queued last */
      877     4162    2       IF BUFTBL.Q.NXT(BUFNO) = -1 THEN
      878     4163    3       DO; /* Enter buffer into the queue (last) */
      879     4164    3           BUFTBL.Q.NXT(BUFNO) = 0;
      880     4165    3           BUFTBL.Q.PRI(BUFNO) = LASTBUF;
      881     4166    3           BUFTBL.Q.PRI(0) = BUFNO;
      882     4167    3           BUFTBL.Q.NXT(LASTBUF) = BUFNO;
      883     4168    3           END;
      884     4169    3       ELSE DO; /* RE-QUEUE buffer into the last position */
      885     4170    3           BUFTBL.Q.PRI(BUFTBL.Q.NXT(BUFNO)) = BUFTBL.Q.PRI(BUFNO);
      886     4171    3           BUFTBL.Q.NXT(BUFTBL.Q.PRI(BUFNO)) = BUFTBL.Q.NXT(BUFNO);
      887     4172    3           BUFTBL.Q.PRI(BUFNO) = LASTBUF;
      888     4173    3           BUFTBL.Q.NXT(BUFNO) = 0;
      889     4174    3           BUFTBL.Q.NXT(LASTBUF) = BUFNO;
      890     4175    3           BUFTBL.Q.PRI(0) = BUFNO;
      891     4176    3           END;
      892     4177    2       RETURN;
      893     4178    2   END QUE_BUF_LAST;
      894     4179        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:36   
      895     4180        /*
      896     4181                 ALLOCATE A BUFFER TO THE REQUESTING CALLER
      897     4182        */
      898     4183    1   GET_BUF: PROC(FIDX,PGNO,BUFNO) ALTRET;
      899     4184    2   DCL FIDX SBIN;
      900     4185    2   DCL PGNO UBIN;
      901     4186    2   DCL BUFNO SBIN;
      902     4187
      903     4188        /* If there are any buffers yet unused then allocate one of then */
      904     4189    2       IF CURR_BUF_CNT <= USABLE_BUFS-1 THEN
      905     4190    3       DO;
      906     4191    3           BUFNO = CURR_BUF_CNT;
      907     4192    3           BUFTBL.FIDX(BUFNO) = FIDX;
      908     4193    3           BUFTBL.PGNO(BUFNO) = PGNO;
      909     4194    3           CALL ENTER_BUF(FIDX,PGNO,BUFNO); /* Place buffer in hash tbl */
      910     4195    3           CURR_BUF_CNT = CURR_BUF_CNT + 1;
      911     4196    3           NXT_AVAIL_BUF = CURR_BUF_CNT;
      912     4197    3           END;
      913     4198    3       ELSE DO; /* Else release buffer least recently used */
      914     4199    3           BUFNO = NXT_AVAIL_BUF;
      915     4200    3           BUFTBL.FIDX(BUFNO) = FIDX;
      916     4201    3           BUFTBL.PGNO(BUFNO) = PGNO;
      917     4202    3           CALL ENTER_BUF(FIDX,PGNO,BUFNO); /* Enter in new hash indx */
      918     4203    3           CALL QUE_BUF_LAST(BUFNO);
      919     4204         /*  Assign a new next available */
      920     4205    3           NXT_AVAIL_BUF = BUFTBL.Q.NXT(0); /* Least recently used */
      921     4206    3           FIDREM = BUFTBL.FIDX(NXT_AVAIL_BUF);
      922     4207    3           PGREM = BUFTBL.PGNO(NXT_AVAIL_BUF);
      923     4208    3           CALL REMOVE_BUF(FIDREM,PGREM,NXT_AVAIL_BUF); /* Remove from old HASH */
      924     4209    3           CALL WRITE_PAGE(NXT_AVAIL_BUF) ALTRET(ALTRTN);
      925     4210    3           END;
      926     4211    2       RETURN;
      927     4212    2   ALTRTN: ALTRETURN;
      928     4213    2   END GET_BUF;
      929     4214        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:37   
      930     4215        /*
      931     4216              Enter the assigned buffer into the hash table
      932     4217        */
      933     4218    1   ENTER_BUF: PROC(FIDX,PGNO,BUFNO);
      934     4219    2   DCL FIDX SBIN;
      935     4220    2   DCL PGNO UBIN;
      936     4221    2   DCL BUFNO SBIN;
      937     4222
      938     4223    2       HSHINDX = HASH_ALGORITHM;
      939     4224    2       IF HSHBUF(HSHINDX) = -1 THEN
      940     4225    3       DO; /* First to hash to this location */
      941     4226    3           HSHBUF(HSHINDX) = BUFNO;
      942     4227    3           RETURN;
      943     4228    3           END;
      944     4229    3       ELSE DO; /* Find end of collosion chain */
      945     4230    3           HSHINDX = HSHBUF(HSHINDX);
      946     4231    4           DO WHILE(BUFTBL.NXTHSH(HSHINDX) ~= -1);
      947     4232    4               IF HSHINDX = BUFNO THEN
      948     4233    4                   RETURN; /*  Buffer already hashed here */
      949     4234    4               HSHINDX = BUFTBL.NXTHSH(HSHINDX);
      950     4235    4               END;
      951     4236    3           BUFTBL.NXTHSH(HSHINDX) = BUFNO; /* Enter at end of coll chain */
      952     4237    3           END;
      953     4238    2       RETURN;
      954     4239    2   END ENTER_BUF;
      955     4240        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:38   
      956     4241        /*
      957     4242              Remove a buffer from its current hash location for re-location
      958     4243        */
      959     4244    1   REMOVE_BUF: PROC(FIDX,PGNO,BUFNO);
      960     4245    2   DCL FIDX SBIN;
      961     4246    2   DCL PGNO UBIN;
      962     4247    2   DCL BUFNO SBIN;
      963     4248
      964     4249    2       HSHINDX = HASH_ALGORITHM;
      965     4250    2       IF HSHBUF(HSHINDX) = -1 THEN
      966     4251    2           RETURN; /* Not currently in hash tbl */
      967     4252    2       IF HSHBUF(HSHINDX) = BUFNO THEN /* Direct hit??? */
      968     4253    3       DO;
      969     4254    3           HSHBUF(HSHINDX) = BUFTBL.NXTHSH(BUFNO);
      970     4255    3           BUFTBL.NXTHSH(BUFNO) = -1;
      971     4256    3           RETURN;
      972     4257    3           END;
      973     4258
      974     4259    2       HSHINDX = HSHBUF(HSHINDX);
      975     4260    3       DO WHILE(HSHINDX ~= -1 AND HSHINDX ~= BUFNO);
      976     4261    3           HSHTEMP = HSHINDX;
      977     4262    3           HSHINDX = BUFTBL.NXTHSH(HSHINDX);
      978     4263    3           END;
      979     4264
      980     4265    2       IF HSHINDX ~= -1 THEN
      981     4266    3       DO; /* Buffer found in hash collosin chain */
      982     4267    3           BUFTBL.NXTHSH(HSHTEMP) = BUFTBL.NXTHSH(BUFNO);
      983     4268    3           BUFTBL.NXTHSH(BUFNO) = -1;
      984     4269    3           END;
      985     4270    2       RETURN;
      986     4271    2   END REMOVE_BUF;
      987     4272    1   ALTRTN:
      988     4273    1       ALTRETURN;
      989     4274    1   END ZIU$RPLY;
      990     4275        %EOD;

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:39   
--  Include file information  --

   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   ZI$JRNL.:ZIC0TOU  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI_ERRORS_SUBS.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI_DBU_ROLL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$RPLY.

   Procedure ZIU$RPLY requires 2172 words for executable code.
   Procedure ZIU$RPLY is declared NOAUTO and requires 1362 words of local(STATIC) storage.

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:40   

 Object Unit name= ZIU$RPLY                                   File name= ZIU$RPLY.:ZIC0TOU
 UTS= SEP 05 '97 13:31:04.92 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none  1362   2522  ZIU$RPLY
    1  RoData even  UTS      1      1  ZIU$RPLY
    2   DCB   even  none     0      0  M$UC
    3   DCB   even  none     0      0  M$LO
    4   Proc  even  none  2172   4174  ZIU$RPLY
    5  RoData even  none    32     40  ZIU$RPLY

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes    yes     yes      Std        0  ZIU$RPLY
     4      2          yes     yes      Std        0  INIT_BUFTBL
     4     64          yes     yes      Std        0  FLUSH_BUFFERS
     4    110          yes     yes      Std        0  PROCESS_FID
     4    263          yes     yes      Std        0  PROCESS_STO
     4    647          yes     yes      Std        0  PROCESS_DEL
     4   1122          yes     yes      Std        0  PROCESS_MOD
     4   1525          yes     yes      Std        0  PROCESS_SET
     4   1577          yes     yes      Std        0  PROCESS_SUM
     4   1701          yes     yes      Std        0  PROCESS_ISTO
     4   2067          yes     yes      Std        0  PROCESS_IDEL
     4   2206          yes     yes      Std        0  PROCESS_KSTO
     4   2346          yes     yes      Std        0  PROCESS_CGMSG
     4   2426          yes     yes      Std        0  PROCESS_CGDEL
     4   2515          yes     yes      Std        0  PROCESS_KDEL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:41   

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0     15  BUFTBL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 FIND_FID
         yes           Std       1 QUE_UP
 yes     yes           Std       2 ZIU$CGOPN
         yes           Std       3 SHIFT_ARRAY
         yes           Std       0 CHKSUM
 yes     yes           Std       2 ZIU$CGMSG
 yes     yes           Std       2 ZIU$CGDEL
 yes     yes           Std       3 STR_USER_FIDID
 yes     yes           Std       1 ASSOC_DCB
 yes     yes           Std       0 OPEN_FID
 yes     yes           Std       3 FIND_USER_FIDID
         yes           Std       0 CHKJRNL
 yes     yes           Std       0 SYS_FUNC_CLOS
         yes           Std       3 ZERO_SUP
 yes     yes           Std       0 SYS_FUNC_WRIT
 yes     yes           Std       0 SYS_FUNC_DELREC
 yes     yes           Std       0 SYS_FUNC_ERRMSG
 yes     yes           Std       0 SYS_FUNC_PREC
 yes     yes           Std       0 SYS_FUNC_READ
         yes           Std       1 QUE_LAST
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:42   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     JREC_NO                               ZERO$                                 NBUFS
     XBUFS                                 FID$                                  DCBLIST$
     USER$                                 FID_INDXS$                            FID_INDXS
     NXT_AVIL_FIDSLOT                      NXT_AVIL_DCBSLOT                      LAST_UNUSED_DCBSLOT
     USER                                  NO                                    FIRST
     LAST                                  MAX_DCBINDX                           MAX_FIDINDX
     FIDX                                  DCBX                                  BRK_ROLL
     DATA$                                 M$UC                                  JRNL$
     BLKLSF                                KEYLSF                                KEYXSF
     DCBSF                                 ORGSF                                 KEYSF
     KEYVSF                                ACSSF                                 NOTIMESF
     FUNSF                                 ASNSF                                 TESTSF
     XTENSIZESF                            DISPSF                                WAITSF
     VFCSF                                 FULLSF                                BKUPSF
     BUFLNSF                               BUFSF                                 SOURCESF
     DESTSF                                DATESF                                TIMESF
     UTSSF                                 DAYSF                                 TSTAMPSF
     ENCRP_SEEDSF                          ERRCODESF                             MSGCODE
     INCL_ERR                              ERR_INSERT                            FIDSF_RD
     ACNT                                  EXISTSF                               SHARESF
     DCBNMSF                               KEYRSF                                NO_KEYSF
     REASGNSF                              CARRY_ATTRIBUTESF                     SUBMESSF
     SPKY_OPNSF                            POSSF                                 ERRFLGSF
     MERGESF                               FSA_FLAG                              RELGSF
     UNUSED                                HELPCODE                              COUNTSF
     INDEXSF                               GAP                                   PSNSF
     ACNTSF                                KEY_SHADWSF                           REC$
     RB                                    RE                                    IE
     IB                                    CNT                                   ICNT
     RCNT                                  SCNT                                  FIRST_SET
     RETCNT                                DMPCNT                                KCNT
     ACNT_IDX                              I                                     J
     K                                     X                                     STEPCC
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:43   
     I_O_BUF$                              OUT_INDX                              I_O_SIZE
     REC_DATA_LN                           M$LO                                  B$TCB$
     B$ROS$                                B$JIT$                                KEYFID
     I_O_KEY                               RESTART                               BREAK_FLAG
     ICHKSUM                               ITMCNT                                GAP1

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:44   


        1        1        /*M* ZIU$RPLY   IDSII   APPLY DEL-STO-MOD JRNL RECORDS FOR ROLL  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        ZIU$RPLY:PROC NOAUTO ALTRET;

      7  4 000000   000000 741200 0     ZIU$RPLY     STX1  ! 0
         4 000001   000003 710000 4                  TRA     s:3422

        8        8
        9        9    1   DCL 1 I_O_TAB BASED(DATA$) ALIGNED,
       10       10    1         2 HW (0:2047) UBIN HALF UNAL,
       11       11    1         2 ELEM (0:2047) REDEF HW,
       12       12    1           3 * UBIN(2) UNAL,
       13       13    1           3 VAL UBIN(16) UNAL;
       14       14    1   DCL REC_WRD UBIN WORD STATIC UNAL;
       15       15    1   DCL 1 REC REDEF REC_WRD,
       16       16    1         2 TYPE UBIN HALF UNAL,
       17       17    1         2 LEN UBIN HALF UNAL;
       18       18    1   DCL ZEROS BIT(36) CONSTANT INIT('0'B);
       19       19    1   DCL BIT_LEN UBIN(36);
       20       20    1   DCL BIT_STRING BIT(BIT_LEN) BASED;
       21       21
       22       22    1   DCL END$ PTR STATIC;
       23       23    1   DCL BOTTOM$ PTR STATIC;
       24       24    1   DCL KEY$ PTR STATIC;
       25       25
       26       26    1   DCL TOSTR CHAR(N) BASED(END$);
       27       27    1   DCL FROMSTR CHAR(N) BASED(REC$);
       28       28    1   DCL STRING CHAR(N) BASED;
       29       29    1   DCL N UBIN STATIC;
       30       30    1   DCL WRD UBIN WORD BASED CALIGNED;
       31       31    1   DCL HLFWRD UBIN HALF BASED CALIGNED;
       32       32    1   DCL JREC_NO UBIN WORD SYMREF;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:45   
       33       33    1   DCL FRST_OFF UBIN HALF STATIC UNAL;
       34       34    1   DCL LAST_OFF UBIN HALF STATIC UNAL;
       35       35    1   DCL SHIFT_SZ UBIN HALF STATIC UNAL;
       36       36    1   DCL REC_OFF UBIN HALF STATIC UNAL;
       37       37    1   DCL NXT_OFF UBIN HALF STATIC UNAL;
       38       38    1   DCL REC_DIFF SBIN HALF STATIC UNAL;
       39       39    1   DCL ZERO$ PTR SYMREF;
       40       40
       41       41        /*
       42       42               Buffer management  table  and  data.
       43       43        */
       44       44    1   DCL 1 BUFTBL (0:255) STATIC SYMDEF UNAL,
       45       45    1         2 PTR$ PTR UNAL,
       46       46    1         2 PGNO UBIN WORD UNAL,
       47       47    1         2 FIDX SBIN HALF UNAL,
       48       48    1         2 NXTHSH SBIN BYTE UNAL,
       49       49    1         2 BUSY BIT(1) UNAL,
       50       50    1         2 * BIT(8) UNAL,
       51       51    1         2 Q,
       52       52    1           3 PRI SBIN HALF UNAL,
       53       53    1           3 NXT SBIN HALF UNAL;
       54       54
       55       55    1   DCL CURR_BUF_CNT SBIN WORD STATIC ALIGNED;
       56       56    1   DCL HSHBUF (0:310) SBIN HALF STATIC UNAL;
       57       57    1   DCL HSHINDX SBIN WORD STATIC ALIGNED;
       58       58    1   DCL HSHTEMP SBIN WORD STATIC ALIGNED;
       59       59
       60       60    1   DCL FIRSTBUF SBIN WORD STATIC ALIGNED;
       61       61    1   DCL LASTBUF SBIN WORD STATIC ALIGNED;
       62       62    1   DCL NHSHBUFS SBIN WORD STATIC ALIGNED INIT(311);
       63       63    1   DCL BUFNO SBIN WORD STATIC ALIGNED;
       64       64    1   DCL USABLE_BUFS SBIN WORD STATIC ALIGNED;
       65       65    1   DCL BUFER CHAR(4096) BASED CALIGNED;
       66       66    1   DCL NBUFS SBIN WORD SYMREF ALIGNED;
       67       67    1   DCL XBUFS SBIN WORD SYMREF ALIGNED;
       68       68    1   DCL FIDREM SBIN WORD STATIC ALIGNED; /* Last used fid indx */
       69       69    1   DCL PGREM SBIN WORD STATIC ALIGNED; /* Previos page in buffer */
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:46   
       70       70    1   DCL NXT_AVAIL_BUF SBIN WORD STATIC ALIGNED;
       71       71    1   DCL 1 ROLLKEY STATIC ALIGNED,
       72       72    1         2 LEN UBIN BYTE UNAL,
       73       73    1         2 VAL CHAR(254) CALIGNED;
       74       74    1   DCL INDXKEY REDEF ROLLKEY CHAR(255) ALIGNED;
       75       75    1   DCL FOUND BIT(1) STATIC UNAL;
       76       76
       77       77
       78       78         %SUB HASH_ALGORITHM = "MOD(FIDX * PGNO,NHSHBUFS)";
       79       79
       80       80
       81       81    1   DCL SYS_FUNC_READ ENTRY ALTRET;
       82       82    1   DCL SYS_FUNC_WRIT ENTRY ALTRET;
       83       83    1   DCL SYS_FUNC_TSTAMP ENTRY ALTRET;
       84       84    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
       85       85    1   DCL SYS_FUNC_RELDCB ENTRY ALTRET;
       86       86    1   DCL SYS_FUNC_CHECK ENTRY ALTRET;
       87       87    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
       88       88    1   DCL SYS_FUNC_PREC ENTRY ALTRET;
       89       89    1   DCL SYS_FUNC_DELREC ENTRY ALTRET;
       90       90    1   DCL ZERO_SUP ENTRY(3);
       91       91    1   DCL CHKSUM ENTRY;
       92       92    1   DCL CHKJRNL ENTRY;
       93       93    1   DCL SHIFT_ARRAY ENTRY(3);
       94       94    1   DCL ASSOC_DCB ENTRY(1) ALTRET;
       95       95    1   DCL STR_USER_FIDID ENTRY(3) ALTRET;
       96       96    1   DCL QUE_UP ENTRY(1);
       97       97    1   DCL DE_QUE ENTRY(1);
       98       98    1   DCL QUE_LAST ENTRY(1);
       99       99    1   DCL FIND_FID ENTRY(1) ALTRET;
      100      100    1   DCL OPEN_FID ENTRY ALTRET;
      101      101    1   DCL FIND_USER_FIDID ENTRY(3) ALTRET;
      102      102    1   DCL ZIU$CGOPN ENTRY(2) ALTRET;
      103      103    1   DCL ZIU$CGMSG ENTRY(2) ALTRET;
      104      104    1   DCL ZIU$CGDEL ENTRY(2) ALTRET;
      105      105
      106      106
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:47   
      107      107         %INCLUDE ZI_DBU_ROLL;
      108      191         %ROLL_SUBS;
      109      210         %ROLL_LIST;
      110      269         %INCLUDE ZI$PG_STRUCTS;
      111      372         %DATA_PG;
      112      391         %INCLUDE CP_6_SUBS;
      113      931         %INCLUDE ZI_ERRORS_SUBS;
      114     1451         %INCLUDE CP_6;
      115     1532         %F$DCB;
      116     1589         %B$TCB;
      117     1592         %B$EXCFR;
      118     1610         %FPT_OPEN;
      119     1719         %VLP_SN(FPTN=PSN,N=1);
      120     1732         %INCLUDE ZI$JRNL;
      121     1840         %JRNL_REC;
      122     1915         %ZI$CGMSG(STCLASS="BASED(JRNL$)");
      123     1952         %ZI$CGDEL(STCLASS="BASED(JRNL$)");
      124     1963         %INCLUDE B_ERRORS_C;
      125     3090         %INCLUDE ZI_GLOBAL_DBUTIL;
      126     3268         %SYS_FUNC;
      127     3360         %MISC_DCLS;
      128     3413
      129     3414         %SUB OFFSET# = "2047 -";
      130     3415
      131     3416        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:48   
      132     3417        /*
      133     3418                 INITIAL BUFFER MANAGEMENT STUFF
      134     3419        */
      135     3420    1   INIT_BUFTBL: ENTRY ALTRET;

   3420  4 000002   000000 741200 0     INIT_BUFTBL  STX1  ! 0

      136     3421
      137     3422    1       BUFTBL.Q.PRI(0) = 0;

   3422  4 000003   000000 220003                    LDX0    0,DU
         4 000004   000020 740000 0                  STX0    BUFTBL+3

      138     3423    1       BUFTBL.Q.NXT(0) = 0; /* Entry 0 used only to maintain queue */

   3423  4 000005   000020 440000 0                  SXL0    BUFTBL+3

      139     3424
      140     3425    1       USABLE_BUFS = NBUFS + XBUFS; /* I/O BUFFERS + Read ahead buffers */

   3425  4 000006   000000 236000 xsym               LDQ     NBUFS
         4 000007   000000 036000 xsym               ADLQ    XBUFS
         4 000010   002260 756000 0                  STQ     USABLE_BUFS

      141     3426    1       IF USABLE_BUFS > 255 THEN /* Max managable buffers is 255 */

   3426  4 000011   000377 116007                    CMPQ    255,DL
         4 000012   000015 604400 4                  TMOZ    s:3429

      142     3427    1           USABLE_BUFS = 255;

   3427  4 000013   000377 235007                    LDA     255,DL
         4 000014   002260 755000 0                  STA     USABLE_BUFS

      143     3428
      144     3429    2       DO X = 1 TO USABLE_BUFS;

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:49   
   3429  4 000015   000001 235007                    LDA     1,DL
         4 000016   000000 755000 xsym               STA     X
         4 000017   000042 710000 4                  TRA     s:3437+1

      145     3430    2           BUFTBL.PTR$(X) = ADDR(I_O_BUF(X-1)); /*  Zero base array */

   3430  4 000020   000000 235000 xsym               LDA     X
         4 000021   000002 735000                    ALS     2
         4 000022   000000 236000 xsym               LDQ     X
         4 000023   000034 736000                    QLS     28
         4 000024   002000 136003                    SBLQ    1024,DU
         4 000025   000000 036000 xsym               ADLQ    I_O_BUF$
         4 000026   000015 756005 0                  STQ     BUFTBL,AL

      146     3431    2           BUFTBL.PGNO(X) = 0;

   3431  4 000027   000016 450005 0                  STZ     BUFTBL+1,AL

      147     3432    2           BUFTBL.FIDX(X) = 0;

   3432  4 000030   000000 220003                    LDX0    0,DU
         4 000031   000017 740005 0                  STX0    BUFTBL+2,AL

      148     3433    2           BUFTBL.NXTHSH(X) = -1;

   3433  4 000032   777000 236007                    LDQ     -512,DL
         4 000033   000017 256005 0                  ORSQ    BUFTBL+2,AL

      149     3434    2           BUFTBL.BUSY(X) = %NO#;

   3434  4 000034   000000 236000 5                  LDQ     0
         4 000035   000017 356005 0                  ANSQ    BUFTBL+2,AL

      150     3435    2           BUFTBL.Q.PRI(X) = -1;

   3435  4 000036   777777 221003                    LDX1    -1,DU
         4 000037   000020 741005 0                  STX1    BUFTBL+3,AL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:50   

      151     3436    2           BUFTBL.Q.NXT(X) = -1;

   3436  4 000040   000020 441005 0                  SXL1    BUFTBL+3,AL

      152     3437    2           END;

   3437  4 000041   000000 054000 xsym               AOS     X
         4 000042   000000 236000 xsym               LDQ     X
         4 000043   002260 116000 0                  CMPQ    USABLE_BUFS
         4 000044   000020 604400 4                  TMOZ    s:3430

      153     3438    1       CURR_BUF_CNT = 1;

   3438  4 000045   000001 235007                    LDA     1,DL
         4 000046   002015 755000 0                  STA     CURR_BUF_CNT

      154     3439    2       DO X = 0 TO NHSHBUFS;

   3439  4 000047   000000 450000 xsym               STZ     X
         4 000050   000057 710000 4                  TRA     s:3441+1

      155     3440    2           HSHBUF(X) = -1;

   3440  4 000051   000000 235000 xsym               LDA     X
         4 000052   000001 735000                    ALS     1
         4 000053   000005 101400                    MRL     fill='000'O
         4 000054   000001 000004 5                  ADSC9   1                        cn=0,n=4
         4 000055   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2

      156     3441    2           END;

   3441  4 000056   000000 054000 xsym               AOS     X
         4 000057   000000 236000 xsym               LDQ     X
         4 000060   002256 116000 0                  CMPQ    NHSHBUFS
         4 000061   000051 604400 4                  TMOZ    s:3440

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:51   
      157     3442    1       RETURN;

   3442  4 000062   000000 221200 0                  LDX1  ! 0
         4 000063   000001 702211                    TSX2  ! 1,X1

      158     3443
      159     3444        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:52   
      160     3445        /*       FLUSH ALL I/O BUFFERS   */
      161     3446    1   FLUSH_BUFFERS: ENTRY ALTRET;

   3446  4 000064   000000 741200 0     FLUSH_BUFFE* STX1  ! 0

      162     3447
      163     3448    2       DO X = 1 TO USABLE_BUFS;

   3448  4 000065   000001 235007                    LDA     1,DL
         4 000066   000000 755000 xsym               STA     X
         4 000067   000103 710000 4                  TRA     s:3451+1

      164     3449    2           IF BUFTBL.FIDX(X) > 0 AND BUFTBL.PGNO(X) > 0 THEN

   3449  4 000070   000000 235000 xsym               LDA     X
         4 000071   000002 735000                    ALS     2
         4 000072   000017 220005 0                  LDX0    BUFTBL+2,AL
         4 000073   000102 604400 4                  TMOZ    s:3451
         4 000074   000016 235005 0                  LDA     BUFTBL+1,AL
         4 000075   000102 600000 4                  TZE     s:3451

      165     3450    2               CALL WRITE_PAGE(X) ALTRET(ALTRTN);

   3450  4 000076   000002 236000 5                  LDQ     2
         4 000077   002473 756000 0                  STQ     CURR_PAGE+2
         4 000100   003277 701000 4                  TSX1    WRITE_PAGE
         4 000101   004172 702000 4                  TSX2    ALTRTN

      166     3451    2           END;

   3451  4 000102   000000 054000 xsym               AOS     X
         4 000103   000000 236000 xsym               LDQ     X
         4 000104   002260 116000 0                  CMPQ    USABLE_BUFS
         4 000105   000070 604400 4                  TMOZ    s:3449

      167     3452    1       RETURN;

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:53   
   3452  4 000106   000000 221200 0                  LDX1  ! 0
         4 000107   000001 702211                    TSX2  ! 1,X1

      168     3453        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:54   
      169     3454        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:55   
      170     3455        /*
      171     3456                 PROCESS JOURNAL FID RECORD BY FINDING FID ENTRY AND OPENING
      172     3457        */
      173     3458    1   PROCESS_FID: ENTRY ALTRET;

   3458  4 000110   000000 741200 0     PROCESS_FID  STX1  ! 0

      174     3459
      175     3460    1       CALL FIND_FID(FIDX);

   3460  4 000111   000004 630400 5                  EPPR0   4
         4 000112   000003 631400 5                  EPPR1   3
         4 000113   000000 701000 xent               TSX1    FIND_FID
         4 000114   000000 011000                    NOP     0

      176     3461    1       CALL STR_USER_FIDID(FILE.USER#,FILE.DCB#,FIDX) ALTRET(ALTRTN);

   3461  4 000115   000004 236000 5                  LDQ     4
         4 000116   002520 756000 0                  STQ     @BUFNO+3
         4 000117   000000 236000 xsym               LDQ     JRNL$
         4 000120   000006 036000 5                  ADLQ    6
         4 000121   002517 756000 0                  STQ     @BUFNO+2
         4 000122   000000 236000 xsym               LDQ     JRNL$
         4 000123   000007 036000 5                  ADLQ    7
         4 000124   002516 756000 0                  STQ     @BUFNO+1
         4 000125   002516 630400 0                  EPPR0   @BUFNO+1
         4 000126   000005 631400 5                  EPPR1   5
         4 000127   000000 701000 xent               TSX1    STR_USER_FIDID
         4 000130   004172 702000 4                  TSX2    ALTRTN

      177     3462
      178     3463    1       IF DCBX = -1 THEN

   3463  4 000131   000000 235000 xsym               LDA     DCBX
         4 000132   000001 115000 5                  CMPA    1
         4 000133   000171 601000 4                  TNZ     s:3477

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:56   
      179     3464    2       DO;

      180     3465         /*E* ERROR: ZIU-DBU#RFID-C
      181     3466                    MESSAGE: File ID received from journal does not agree with
      182     3467                             file ID opened. SYSID= %U1 for file %FN.       */
      183     3468    2           ERR_INSERT.CNT(0) = 7;

   3468  4 000134   007000 236003                    LDQ     3584,DU
         4 000135   000000 552040 xsym               STBQ    ERR_INSERT,'40'O

      184     3469    2           CALL BINCHAR(ERR_INSERT.TEXT(0),USER.SYSID(FILE.USER#));

   3469  4 000136   000000 470400 xsym               LDP0    JRNL$
         4 000137   000001 236100                    LDQ     1,,PR0
         4 000140   000022 772000                    QRL     18
         4 000141   000777 376007                    ANQ     511,DL
         4 000142   000005 402007                    MPY     5,DL
         4 000143   000000 236006 xsym               LDQ     USER,QL
         4 000144   000022 772000                    QRL     18
         4 000145   000000 235003                    LDA     0,DU
         4 000146   002516 757000 0                  STAQ    @BUFNO+1
         4 000147   000000 301400                    BTD
         4 000150   002516 000010 0                  NDSC9   @BUFNO+1                 cn=0,s=lsgnf,sf=0,n=8
         4 000151   000000 230036 xsym               NDSC9   ERR_INSERT               cn=1,s=nosgn,sf=0,n=30

      185     3470    2           DCBSF = FIDLIST.DCB#(FIDX);

   3470  4 000152   000000 236000 xsym               LDQ     FIDX
         4 000153   000021 402007                    MPY     17,DL
         4 000154   000000 471400 xsym               LDP1    FID$
         4 000155   100017 220106                    LDX0    15,QL,PR1
         4 000156   000000 740000 xsym               STX0    DCBSF

      186     3471    2           ERRCODESF.ERR# = DBU#RFID;

   3471  4 000157   000000 236000 xsym               LDQ     ERRCODESF
         4 000160   000010 376000 5                  ANQ     8
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:57   
         4 000161   215040 276007                    ORQ     72224,DL
         4 000162   000000 756000 xsym               STQ     ERRCODESF

      187     3472    2           MSGCODE = ERRCODE_RDEF;

   3472  4 000163   000000 756000 xsym               STQ     MSGCODE

      188     3473    2           CALL SYS_FUNC_ERRMSG;

   3473  4 000164   000011 631400 5                  EPPR1   9
         4 000165   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 000166   000000 011000                    NOP     0

      189     3474    2           ALTRETURN;

   3474  4 000167   000000 221200 0                  LDX1  ! 0
         4 000170   000000 702211                    TSX2  ! 0,X1

      190     3475    2           END;
      191     3476
      192     3477    1       IF FIDLIST.DCB#(FIDX) < 1 THEN

   3477  4 000171   000000 236000 xsym               LDQ     FIDX
         4 000172   000021 402007                    MPY     17,DL
         4 000173   000000 470400 xsym               LDP0    FID$
         4 000174   000017 220106                    LDX0    15,QL,PR0
         4 000175   000206 601000 4                  TNZ     s:3482

      193     3478    2       DO;

      194     3479    2           CALL ASSOC_DCB(FIDX) ALTRET(ALTRTN);

   3479  4 000176   000004 630400 5                  EPPR0   4
         4 000177   000003 631400 5                  EPPR1   3
         4 000200   000000 701000 xent               TSX1    ASSOC_DCB
         4 000201   004172 702000 4                  TSX2    ALTRTN

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:58   
      195     3480    2           CALL QUE_UP(FIDX);

   3480  4 000202   000004 630400 5                  EPPR0   4
         4 000203   000003 631400 5                  EPPR1   3
         4 000204   000000 701000 xent               TSX1    QUE_UP
         4 000205   000000 011000                    NOP     0

      196     3481    2           END;

      197     3482    1       IF FILE.COMGROUP THEN

   3482  4 000206   000000 470400 xsym               LDP0    JRNL$
         4 000207   000003 236100                    LDQ     3,,PR0
         4 000210   020000 316003                    CANQ    8192,DU
         4 000211   000225 600000 4                  TZE     s:3485

      198     3483    1           CALL ZIU$CGOPN(,FIDLIST.DCB#(FIDX)) ALTRET(ALTRTN);

   3483  4 000212   000000 236000 xsym               LDQ     FIDX
         4 000213   000021 402003                    MPY     17,DU
         4 000214   000017 036003                    ADLQ    15,DU
         4 000215   000000 036000 xsym               ADLQ    FID$
         4 000216   000013 235000 5                  LDA     11
         4 000217   002516 757000 0                  STAQ    @BUFNO+1
         4 000220   002516 630400 0                  EPPR0   @BUFNO+1
         4 000221   000012 631400 5                  EPPR1   10
         4 000222   000000 701000 xent               TSX1    ZIU$CGOPN
         4 000223   004172 702000 4                  TSX2    ALTRTN
         4 000224   000261 710000 4                  TRA     s:3500

      199     3484    2       ELSE DO;

      200     3485    2           CALL OPEN_FID ALTRET(ALTRTN);

   3485  4 000225   000011 631400 5                  EPPR1   9
         4 000226   000000 701000 xent               TSX1    OPEN_FID
         4 000227   004172 702000 4                  TSX2    ALTRTN
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:59   

      201     3486    2           IF FIDLIST.ORG#(FIDX) = %KEYED# THEN

   3486  4 000230   000000 236000 xsym               LDQ     FIDX
         4 000231   000021 402007                    MPY     17,DL
         4 000232   000000 470400 xsym               LDP0    FID$
         4 000233   000015 236106                    LDQ     13,QL,PR0
         4 000234   777000 376007                    ANQ     -512,DL
         4 000235   002000 116007                    CMPQ    1024,DL
         4 000236   000261 601000 4                  TNZ     s:3500

      202     3487    3           DO;

      203     3488    3               FIDX = FIDX + 1; /* Bump up indx to the keyed file entry */

   3488  4 000237   000000 054000 xsym               AOS     FIDX

      204     3489    3               IF FIDLIST.DCB#(FIDX) < 1 THEN

   3489  4 000240   000000 236000 xsym               LDQ     FIDX
         4 000241   000021 402007                    MPY     17,DL
         4 000242   000017 220106                    LDX0    15,QL,PR0
         4 000243   000254 601000 4                  TNZ     s:3494

      205     3490    4               DO;

      206     3491    4                   CALL ASSOC_DCB(FIDX) ALTRET(ALTRTN);

   3491  4 000244   000004 630400 5                  EPPR0   4
         4 000245   000003 631400 5                  EPPR1   3
         4 000246   000000 701000 xent               TSX1    ASSOC_DCB
         4 000247   004172 702000 4                  TSX2    ALTRTN

      207     3492    4                   CALL QUE_UP(FIDX);

   3492  4 000250   000004 630400 5                  EPPR0   4
         4 000251   000003 631400 5                  EPPR1   3
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:60   
         4 000252   000000 701000 xent               TSX1    QUE_UP
         4 000253   000000 011000                    NOP     0

      208     3493    4                   END;

      209     3494    3               CALL OPEN_FID ALTRET(ALTRTN);

   3494  4 000254   000011 631400 5                  EPPR1   9
         4 000255   000000 701000 xent               TSX1    OPEN_FID
         4 000256   004172 702000 4                  TSX2    ALTRTN

      210     3495    3               FIDX = FIDX - 1;

   3495  4 000257   000001 336007                    LCQ     1,DL
         4 000260   000000 056000 xsym               ASQ     FIDX

      211     3496    3               END;

      212     3497    2           END;

      213     3498
      214     3499
      215     3500    1       RETURN;

   3500  4 000261   000000 221200 0                  LDX1  ! 0
         4 000262   000001 702211                    TSX2  ! 1,X1

      216     3501        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:61   
      217     3502        /*
      218     3503                 PROCESS  STORING   JRNL    RECORD
      219     3504        */
      220     3505    1   PROCESS_STO: ENTRY ALTRET;

   3505  4 000263   000000 741200 0     PROCESS_STO  STX1  ! 0

      221     3506
      222     3507    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);

   3507  4 000264   000004 236000 5                  LDQ     4
         4 000265   002520 756000 0                  STQ     @BUFNO+3
         4 000266   000000 236000 xsym               LDQ     JRNL$
         4 000267   000006 036000 5                  ADLQ    6
         4 000270   002517 756000 0                  STQ     @BUFNO+2
         4 000271   000000 236000 xsym               LDQ     JRNL$
         4 000272   000007 036000 5                  ADLQ    7
         4 000273   002516 756000 0                  STQ     @BUFNO+1
         4 000274   002516 630400 0                  EPPR0   @BUFNO+1
         4 000275   000005 631400 5                  EPPR1   5
         4 000276   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 000277   000000 011000                    NOP     0

      223     3508    1       CALL READ_PAGE ALTRET(ALTRTN);

   3508  4 000300   003127 701000 4                  TSX1    READ_PAGE
         4 000301   004172 702000 4                  TSX2    ALTRTN

      224     3509
      225     3510    1       IF JREC.LINE > DATA_PG.OFF_LN.SEC AND /* LINE > LINES ALLOCATED */

   3510  4 000302   000000 470400 xsym               LDP0    JRNL$
         4 000303   000003 236100                    LDQ     3,,PR0
         4 000304   777777 376007                    ANQ     -1,DL
         4 000305   002516 756000 0                  STQ     @BUFNO+1
         4 000306   000000 471400 xsym               LDP1    DATA$
         4 000307   100005 236100                    LDQ     5,,PR1
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:62   
         4 000310   777777 376007                    ANQ     -1,DL
         4 000311   002516 116000 0                  CMPQ    @BUFNO+1
         4 000312   000441 605000 4                  TPL     s:3534
         4 000313   002517 756000 0                  STQ     @BUFNO+2
         4 000314   000003 236100                    LDQ     3,,PR0
         4 000315   777777 376007                    ANQ     -1,DL
         4 000316   002517 136000 0                  SBLQ    @BUFNO+2
         4 000317   000001 116007                    CMPQ    1,DL
         4 000320   000441 604400 4                  TMOZ    s:3534

      226     3511    1          JREC.LINE - DATA_PG.OFF_LN.SEC > 1 THEN
      227     3512    2       DO;

      228     3513    2           J = DATA_PG.OFF_LN.SEC + 1; /* Set J to first unused line */

   3513  4 000321   100005 236100                    LDQ     5,,PR1
         4 000322   777777 376007                    ANQ     -1,DL
         4 000323   000001 036007                    ADLQ    1,DL
         4 000324   000000 756000 xsym               STQ     J

      229     3514
      230     3515    3           DO X = J TO JREC.LINE - 1; /* BUILD OUT OFFSET ARRAY */

   3515  4 000325   000000 756000 xsym               STQ     X
         4 000326   000345 710000 4                  TRA     s:3518+1

      231     3516    3               I_O_TAB.HW(OFFSET# X) = 131072 + X + 1; /* POINT TO NEXT */

   3516  4 000327   000000 236000 xsym               LDQ     X
         4 000330   400001 036007                    ADLQ    -131071,DL
         4 000331   002516 756000 0                  STQ     @BUFNO+1
         4 000332   000000 335000 xsym               LCA     X
         4 000333   000001 735000                    ALS     1
         4 000334   000000 470400 xsym               LDP0    DATA$
         4 000335   000105 101400                    MRL     fill='000'O
         4 000336   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 000337   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:63   

      232     3517    3               DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC - 2;

   3517  4 000340   000000 470400 xsym               LDP0    DATA$
         4 000341   000003 720100                    LXL0    3,,PR0
         4 000342   777776 621010                    EAX1    -2,X0
         4 000343   000003 441100                    SXL1    3,,PR0

      233     3518    3               END;

   3518  4 000344   000000 054000 xsym               AOS     X
         4 000345   000000 470400 xsym               LDP0    JRNL$
         4 000346   000003 236100                    LDQ     3,,PR0
         4 000347   777777 376007                    ANQ     -1,DL
         4 000350   000000 116000 xsym               CMPQ    X
         4 000351   000327 605400 4                  TPNZ    s:3516

      234     3519
      235     3520    2           I_O_TAB.HW(OFFSET# JREC.LINE) = 131072; /* SET LAST OFSET .400000*/

   3520  4 000352   000001 736000                    QLS     1
         4 000353   000001 676000 5                  ERQ     1
         4 000354   000001 036007                    ADLQ    1,DL
         4 000355   000000 471400 xsym               LDP1    DATA$
         4 000356   000106 101400                    MRL     fill='000'O
         4 000357   000014 000004 5                  ADSC9   12                       cn=0,n=4
         4 000360   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2

      236     3521    2           DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC - 2;

   3521  4 000361   000000 470400 xsym               LDP0    DATA$
         4 000362   000003 720100                    LXL0    3,,PR0
         4 000363   777776 621010                    EAX1    -2,X0
         4 000364   000003 441100                    SXL1    3,,PR0

      237     3522    2           IF DATA_PG.OFF_LN.FIR = 0 THEN

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:64   
   3522  4 000365   000005 220100                    LDX0    5,,PR0
         4 000366   000372 601000 4                  TNZ     s:3525

      238     3523    2               DATA_PG.OFF_LN.FIR = J;

   3523  4 000367   000000 722000 xsym               LXL2    J
         4 000370   000005 742100                    STX2    5,,PR0
         4 000371   000435 710000 4                  TRA     s:3531

      239     3524    3           ELSE DO; /* Link extension of array into old list */

      240     3525    3               X = I_O_TAB.HW(OFFSET# 2037);

   3525  4 000372   000005 236100                    LDQ     5,,PR0
         4 000373   000022 772000                    QRL     18
         4 000374   000000 756000 xsym               STQ     X

      241     3526    4               DO WHILE(I_O_TAB.HW(OFFSET# X) ~= 131072);

   3526  4 000375   000000 335000 xsym               LCA     X
         4 000376   000001 735000                    ALS     1
         4 000377   000000 101505                    MRL     fill='000'O
         4 000400   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 000401   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 000402   002516 236000 0                  LDQ     @BUFNO+1
         4 000403   400000 116007                    CMPQ    -131072,DL
         4 000404   000426 600000 4                  TZE     s:3529

      242     3527    4                   X = I_O_TAB.HW(OFFSET# X) - 131072;

   3527  4 000405   000000 335000 xsym               LCA     X
         4 000406   000001 735000                    ALS     1
         4 000407   000000 470400 xsym               LDP0    DATA$
         4 000410   000000 101505                    MRL     fill='000'O
         4 000411   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 000412   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 000413   002516 236000 0                  LDQ     @BUFNO+1
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:65   
         4 000414   400000 136007                    SBLQ    -131072,DL
         4 000415   000000 756000 xsym               STQ     X

      243     3528    4                   END;

   3528  4 000416   000000 335000 xsym               LCA     X
         4 000417   000001 735000                    ALS     1
         4 000420   000000 101505                    MRL     fill='000'O
         4 000421   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 000422   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 000423   002516 236000 0                  LDQ     @BUFNO+1
         4 000424   400000 116007                    CMPQ    -131072,DL
         4 000425   000405 601000 4                  TNZ     s:3527

      244     3529    3               I_O_TAB.HW(OFFSET# X) = 131072 + DATA_PG.OFF_LN.SEC +1;

   3529  4 000426   000005 236100                    LDQ     5,,PR0
         4 000427   777777 376007                    ANQ     -1,DL
         4 000430   400001 036007                    ADLQ    -131071,DL
         4 000431   002516 756000 0                  STQ     @BUFNO+1
         4 000432   000105 101400                    MRL     fill='000'O
         4 000433   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 000434   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

      245     3530    3               END;

      246     3531    2           DATA_PG.OFF_LN.SEC = JREC.LINE;

   3531  4 000435   000000 470400 xsym               LDP0    JRNL$
         4 000436   000003 720100                    LXL0    3,,PR0
         4 000437   000000 471400 xsym               LDP1    DATA$
         4 000440   100005 440100                    SXL0    5,,PR1

      247     3532    2           END;

      248     3533
      249     3534    1       IF I_O_TAB.HW(OFFSET# JREC.LINE) > 0 AND
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:66   

   3534  4 000441   000003 236100                    LDQ     3,,PR0
         4 000442   777777 376007                    ANQ     -1,DL
         4 000443   000001 736000                    QLS     1
         4 000444   000001 676000 5                  ERQ     1
         4 000445   000001 036007                    ADLQ    1,DL
         4 000446   000000 101506                    MRL     fill='000'O
         4 000447   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2
         4 000450   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 000451   002516 236000 0                  LDQ     @BUFNO+1
         4 000452   000000 116003                    CMPQ    0,DU
         4 000453   000502 600000 4                  TZE     s:3546
         4 000454   000003 236100                    LDQ     3,,PR0
         4 000455   777777 376007                    ANQ     -1,DL
         4 000456   000001 736000                    QLS     1
         4 000457   000001 676000 5                  ERQ     1
         4 000460   000001 036007                    ADLQ    1,DL
         4 000461   000000 101506                    MRL     fill='000'O
         4 000462   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2
         4 000463   002517 000004 0                  ADSC9   @BUFNO+2                 cn=0,n=4
         4 000464   002517 236000 0                  LDQ     @BUFNO+2
         4 000465   400000 116007                    CMPQ    -131072,DL
         4 000466   000502 605000 4                  TPL     s:3546

      250     3535    1          I_O_TAB.HW(OFFSET# JREC.LINE) < 131072 THEN
      251     3536    2       DO;

      252     3537         /*E* ERROR: ZIU-DBU#RSTO-C
      253     3538                 MESSAGE: Call to STORE a record at a used line on page# %U1
      254     3539                          at line# %U2 of file %FN.                       */
      255     3540    2           ERRCODESF.ERR# = DBU#RSTO;

   3540  4 000467   000000 236000 xsym               LDQ     ERRCODESF
         4 000470   000010 376000 5                  ANQ     8
         4 000471   214760 276007                    ORQ     72176,DL
         4 000472   000000 756000 xsym               STQ     ERRCODESF

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:67   
      256     3541    2           CALL FILL_ERROR_INFO;

   3541  4 000473   003063 701000 4                  TSX1    FILL_ERROR_INFO
         4 000474   000000 011000                    NOP     0

      257     3542    2           CALL SYS_FUNC_ERRMSG;

   3542  4 000475   000011 631400 5                  EPPR1   9
         4 000476   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 000477   000000 011000                    NOP     0

      258     3543    2           ALTRETURN;

   3543  4 000500   000000 221200 0                  LDX1  ! 0
         4 000501   000000 702211                    TSX2  ! 0,X1

      259     3544    2           END;
      260     3545
      261     3546    1       REC$ = PINCRC(DATA$,JREC.OFFSET+12);

   3546  4 000502   000004 236100                    LDQ     4,,PR0
         4 000503   000022 772000                    QRL     18
         4 000504   000020 736000                    QLS     16
         4 000505   000003 036003                    ADLQ    3,DU
         4 000506   000000 036000 xsym               ADLQ    DATA$
         4 000507   000000 756000 xsym               STQ     REC$

      262     3547    1       N = JREC.LENGTH;

   3547  4 000510   000003 236100                    LDQ     3,,PR0
         4 000511   000022 772000                    QRL     18
         4 000512   000006 756000 0                  STQ     N

      263     3548    1       REC$ -> STRING = JREC.VALUE;

   3548  4 000513   000003 220100                    LDX0    3,,PR0
         4 000514   000000 473400 xsym               LDP3    REC$
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:68   
         4 000515   000000 621006                    EAX1    0,QL
         4 000516   040140 100540                    MLR     fill='040'O
         4 000517   000004 400010                    ADSC9   4,,PR0                   cn=2,n=*X0
         4 000520   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1

      264     3549
      265     3550    1       IF I_O_TAB.HW(OFFSET# JREC.LINE) = 0 THEN

   3550  4 000521   000000 470400 xsym               LDP0    JRNL$
         4 000522   000003 236100                    LDQ     3,,PR0
         4 000523   777777 376007                    ANQ     -1,DL
         4 000524   000001 736000                    QLS     1
         4 000525   000001 676000 5                  ERQ     1
         4 000526   000001 036007                    ADLQ    1,DL
         4 000527   000000 471400 xsym               LDP1    DATA$
         4 000530   000000 101506                    MRL     fill='000'O
         4 000531   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2
         4 000532   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 000533   002516 236000 0                  LDQ     @BUFNO+1
         4 000534   000000 116003                    CMPQ    0,DU
         4 000535   000542 601000 4                  TNZ     s:3554

      266     3551    1           DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC-2;

   3551  4 000536   100003 720100                    LXL0    3,,PR1
         4 000537   777776 621010                    EAX1    -2,X0
         4 000540   100003 441100                    SXL1    3,,PR1
         4 000541   000617 710000 4                  TRA     s:3566

      267     3552    2       ELSE DO; /* Modify offset array to branch avil line offsets

      268     3553         around the offset just stored. */
      269     3554    2           I_O_TAB.HW(OFFSET# 2037) = I_O_TAB.HW(OFFSET# 2037) + 131072;

   3554  4 000542   100005 220100                    LDX0    5,,PR1
         4 000543   400000 621010                    EAX1    -131072,X0
         4 000544   100005 741100                    STX1    5,,PR1
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:69   

      270     3555    2           J = I_O_TAB.HW(OFFSET# 2037);

   3555  4 000545   100005 236100                    LDQ     5,,PR1
         4 000546   000022 772000                    QRL     18
         4 000547   000000 756000 xsym               STQ     J

      271     3556    2           X = 2037;

   3556  4 000550   003765 235007                    LDA     2037,DL
         4 000551   000000 755000 xsym               STA     X

      272     3557    2           NXT_OFF = I_O_TAB.HW(OFFSET# JREC.LINE);

   3557  4 000552   000003 236100                    LDQ     3,,PR0
         4 000553   777777 376007                    ANQ     -1,DL
         4 000554   000001 736000                    QLS     1
         4 000555   000001 676000 5                  ERQ     1
         4 000556   000001 036007                    ADLQ    1,DL
         4 000557   000000 100506                    MLR     fill='000'O
         4 000560   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2
         4 000561   000013 000002 0                  ADSC9   NXT_OFF                  cn=0,n=2

      273     3558    3           DO WHILE(J < JREC.LINE+131072 AND J > 131072);

   3558  4 000562   000574 710000 4                  TRA     s:3561

      274     3559    3               X = J - 131072;

   3559  4 000563   000000 235000 xsym               LDA     J
         4 000564   400000 135007                    SBLA    -131072,DL
         4 000565   000000 755000 xsym               STA     X

      275     3560    3               J = I_O_TAB.HW(OFFSET# X);

   3560  4 000566   000000 531000                    NEG     0
         4 000567   000001 735000                    ALS     1
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:70   
         4 000570   000000 470400 xsym               LDP0    DATA$
         4 000571   000000 101505                    MRL     fill='000'O
         4 000572   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 000573   000000 000004 xsym               ADSC9   J                        cn=0,n=4

      276     3561    3               END;

   3561  4 000574   000000 470400 xsym               LDP0    JRNL$
         4 000575   000003 236100                    LDQ     3,,PR0
         4 000576   777777 376007                    ANQ     -1,DL
         4 000577   400000 036007                    ADLQ    -131072,DL
         4 000600   000000 116000 xsym               CMPQ    J
         4 000601   000605 604400 4                  TMOZ    s:3562
         4 000602   000000 235000 xsym               LDA     J
         4 000603   400000 115007                    CMPA    -131072,DL
         4 000604   000563 605400 4                  TPNZ    s:3559

      277     3562    2           I_O_TAB.HW(OFFSET# X) = NXT_OFF;

   3562  4 000605   000000 335000 xsym               LCA     X
         4 000606   000001 735000                    ALS     1
         4 000607   000000 471400 xsym               LDP1    DATA$
         4 000610   000105 100400                    MLR     fill='000'O
         4 000611   000013 000002 0                  ADSC9   NXT_OFF                  cn=0,n=2
         4 000612   101777 400002                    ADSC9   1023,A,PR1               cn=2,n=2

      278     3563    2           I_O_TAB.HW(OFFSET# 2037) = I_O_TAB.HW(OFFSET# 2037) - 131072;

   3563  4 000613   000000 470400 xsym               LDP0    DATA$
         4 000614   000005 220100                    LDX0    5,,PR0
         4 000615   400000 621010                    EAX1    -131072,X0
         4 000616   000005 741100                    STX1    5,,PR0

      279     3564    2           END;

      280     3565
      281     3566    1       I_O_TAB.HW(OFFSET# JREC.LINE) = JREC.OFFSET;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:71   

   3566  4 000617   000000 470400 xsym               LDP0    JRNL$
         4 000620   000003 236100                    LDQ     3,,PR0
         4 000621   777777 376007                    ANQ     -1,DL
         4 000622   000001 736000                    QLS     1
         4 000623   000001 676000 5                  ERQ     1
         4 000624   000001 036007                    ADLQ    1,DL
         4 000625   000000 471400 xsym               LDP1    DATA$
         4 000626   000106 100500                    MLR     fill='000'O
         4 000627   000004 000002                    ADSC9   4,,PR0                   cn=0,n=2
         4 000630   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2

      282     3567    1       DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC - JREC.LENGTH;

   3567  4 000631   000000 470400 xsym               LDP0    JRNL$
         4 000632   000003 236100                    LDQ     3,,PR0
         4 000633   000022 772000                    QRL     18
         4 000634   002516 756000 0                  STQ     @BUFNO+1
         4 000635   000000 471400 xsym               LDP1    DATA$
         4 000636   100003 236100                    LDQ     3,,PR1
         4 000637   777777 376007                    ANQ     -1,DL
         4 000640   002516 136000 0                  SBLQ    @BUFNO+1
         4 000641   000000 620006                    EAX0    0,QL
         4 000642   100003 440100                    SXL0    3,,PR1

      283     3568
      284     3569    1       CALL BUILD_HEADER ALTRET(ALTRTN);

   3569  4 000643   002730 701000 4                  TSX1    BUILD_HEADER
         4 000644   004172 702000 4                  TSX2    ALTRTN

      285     3570
      286     3571    1       RETURN;

   3571  4 000645   000000 221200 0                  LDX1  ! 0
         4 000646   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:72   
      287     3572         %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:73   
      288     3573        /*
      289     3574                 PROCESS  DELETE  THE  JOURNAL  RECORD  FROM  FILE
      290     3575        */
      291     3576    1   PROCESS_DEL: ENTRY ALTRET;

   3576  4 000647   000000 741200 0     PROCESS_DEL  STX1  ! 0

      292     3577
      293     3578    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);

   3578  4 000650   000004 236000 5                  LDQ     4
         4 000651   002520 756000 0                  STQ     @BUFNO+3
         4 000652   000000 236000 xsym               LDQ     JRNL$
         4 000653   000006 036000 5                  ADLQ    6
         4 000654   002517 756000 0                  STQ     @BUFNO+2
         4 000655   000000 236000 xsym               LDQ     JRNL$
         4 000656   000007 036000 5                  ADLQ    7
         4 000657   002516 756000 0                  STQ     @BUFNO+1
         4 000660   002516 630400 0                  EPPR0   @BUFNO+1
         4 000661   000005 631400 5                  EPPR1   5
         4 000662   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 000663   000000 011000                    NOP     0

      294     3579    1       CALL READ_PAGE ALTRET(ALTRTN);

   3579  4 000664   003127 701000 4                  TSX1    READ_PAGE
         4 000665   004172 702000 4                  TSX2    ALTRTN

      295     3580
      296     3581    1       IF I_O_TAB.HW(OFFSET# JREC.LINE) = 0

   3581  4 000666   000000 470400 xsym               LDP0    JRNL$
         4 000667   000003 236100                    LDQ     3,,PR0
         4 000670   777777 376007                    ANQ     -1,DL
         4 000671   000001 736000                    QLS     1
         4 000672   000001 676000 5                  ERQ     1
         4 000673   000001 036007                    ADLQ    1,DL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:74   
         4 000674   000000 471400 xsym               LDP1    DATA$
         4 000675   000000 101506                    MRL     fill='000'O
         4 000676   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2
         4 000677   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 000700   002516 236000 0                  LDQ     @BUFNO+1
         4 000701   000000 116003                    CMPQ    0,DU
         4 000702   000716 600000 4                  TZE     s:3587
         4 000703   000003 236100                    LDQ     3,,PR0
         4 000704   777777 376007                    ANQ     -1,DL
         4 000705   000001 736000                    QLS     1
         4 000706   000001 676000 5                  ERQ     1
         4 000707   000001 036007                    ADLQ    1,DL
         4 000710   000000 101506                    MRL     fill='000'O
         4 000711   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2
         4 000712   002517 000004 0                  ADSC9   @BUFNO+2                 cn=0,n=4
         4 000713   002517 236000 0                  LDQ     @BUFNO+2
         4 000714   400000 116007                    CMPQ    -131072,DL
         4 000715   000731 604000 4                  TMI     s:3593

      297     3582    1          OR I_O_TAB.HW(OFFSET# JREC.LINE) >= 131072 THEN
      298     3583    2       DO;

      299     3584         /*E* ERROR: ZIU-DBU#RDEL-C
      300     3585                 MESSAGE: Call to DELETE a non-existent record on page# %U1
      301     3586                          at line# %U2 of file %FN.                     */
      302     3587    2           ERRCODESF.ERR# = DBU#RDEL;

   3587  4 000716   000000 236000 xsym               LDQ     ERRCODESF
         4 000717   000010 376000 5                  ANQ     8
         4 000720   215000 276007                    ORQ     72192,DL
         4 000721   000000 756000 xsym               STQ     ERRCODESF

      303     3588    2           CALL FILL_ERROR_INFO;

   3588  4 000722   003063 701000 4                  TSX1    FILL_ERROR_INFO
         4 000723   000000 011000                    NOP     0

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:75   
      304     3589    2           CALL SYS_FUNC_ERRMSG;

   3589  4 000724   000011 631400 5                  EPPR1   9
         4 000725   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 000726   000000 011000                    NOP     0

      305     3590    2           ALTRETURN;

   3590  4 000727   000000 221200 0                  LDX1  ! 0
         4 000730   000000 702211                    TSX2  ! 0,X1

      306     3591    2           END;
      307     3592
      308     3593    1       REC_OFF = I_O_TAB.HW(OFFSET# JREC.LINE); /* Set pointer to record */

   3593  4 000731   000003 236100                    LDQ     3,,PR0
         4 000732   777777 376007                    ANQ     -1,DL
         4 000733   000001 736000                    QLS     1
         4 000734   000001 676000 5                  ERQ     1
         4 000735   000001 036007                    ADLQ    1,DL
         4 000736   000000 100506                    MLR     fill='000'O
         4 000737   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2
         4 000740   000012 000002 0                  ADSC9   REC_OFF                  cn=0,n=2

      309     3594    1       REC$ = PINCRC(DATA$,REC_OFF+12);

   3594  4 000741   000012 236000 0                  LDQ     REC_OFF
         4 000742   777777 376003                    ANQ     -1,DU
         4 000743   000002 772000                    QRL     2
         4 000744   000003 036003                    ADLQ    3,DU
         4 000745   000000 036000 xsym               ADLQ    DATA$
         4 000746   000000 756000 xsym               STQ     REC$

      310     3595
      311     3596    1       REC_WRD = REC$->WRD; /* Save rec type and size */

   3596  4 000747   000000 473400 xsym               LDP3    REC$
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:76   
         4 000750   000000 100500                    MLR     fill='000'O
         4 000751   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
         4 000752   000001 000004 0                  ADSC9   REC_WRD                  cn=0,n=4

      312     3597    1       END$ = PINCRC(REC$,REC.LEN); /* Point to nxt record */

   3597  4 000753   000001 236000 0                  LDQ     REC_WRD
         4 000754   777777 376007                    ANQ     -1,DL
         4 000755   000020 736000                    QLS     16
         4 000756   000000 036000 xsym               ADLQ    REC$
         4 000757   000003 756000 0                  STQ     END$

      313     3598
      314     3599         /*
      315     3600            Find the position of the first empty data byte and store offset.
      316     3601         */
      317     3602    1       LAST_OFF = (I_O_TAB.ELEM.VAL(6) -

   3602  4 000760   100003 236100                    LDQ     3,,PR1
         4 000761   177777 376007                    ANQ     65535,DL
         4 000762   002516 756000 0                  STQ     @BUFNO+1
         4 000763   100005 236100                    LDQ     5,,PR1
         4 000764   000001 736000                    QLS     1
         4 000765   377776 376007                    ANQ     131070,DL
         4 000766   002516 036000 0                  ADLQ    @BUFNO+1
         4 000767   002517 756000 0                  STQ     @BUFNO+2
         4 000770   100003 236100                    LDQ     3,,PR1
         4 000771   000022 772000                    QRL     18
         4 000772   177777 376007                    ANQ     65535,DL
         4 000773   002517 136000 0                  SBLQ    @BUFNO+2
         4 000774   777776 620006                    EAX0    -2,QL
         4 000775   000010 740000 0                  STX0    LAST_OFF

      318     3603    1          (I_O_TAB.ELEM.VAL(7) +
      319     3604    1          ((I_O_TAB.ELEM.VAL(11)+1) *2)));
      320     3605    1       BOTTOM$ = PINCRC(DATA$,LAST_OFF+12);

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:77   
   3605  4 000776   000010 236000 0                  LDQ     LAST_OFF
         4 000777   777777 376003                    ANQ     -1,DU
         4 001000   000002 772000                    QRL     2
         4 001001   000003 036003                    ADLQ    3,DU
         4 001002   000000 036000 xsym               ADLQ    DATA$
         4 001003   000004 756000 0                  STQ     BOTTOM$

      321     3606
      322     3607    1       N = LAST_OFF - REC_OFF;

   3607  4 001004   000012 235000 0                  LDA     REC_OFF
         4 001005   000022 771000                    ARL     18
         4 001006   002516 755000 0                  STA     @BUFNO+1
         4 001007   000010 236000 0                  LDQ     LAST_OFF
         4 001010   000022 772000                    QRL     18
         4 001011   002516 136000 0                  SBLQ    @BUFNO+1
         4 001012   000006 756000 0                  STQ     N

      323     3608    1       SHIFT_SZ = N;

   3608  4 001013   000000 621006                    EAX1    0,QL
         4 001014   000011 741000 0                  STX1    SHIFT_SZ

      324     3609    1       REC$ -> STRING = END$ -> STRING; /* Shift data page up */

   3609  4 001015   000003 474400 0                  LDP4    END$
         4 001016   000006 722000 0                  LXL2    N
         4 001017   040140 100540                    MLR     fill='040'O
         4 001020   400000 000012                    ADSC9   0,,PR4                   cn=0,n=*X2
         4 001021   300000 000012                    ADSC9   0,,PR3                   cn=0,n=*X2

      325     3610
      326     3611    1       BOTTOM$ = PINCRC(BOTTOM$,-1*REC.LEN); /* Shift bottom ptr up */

   3611  4 001022   000001 236000 0                  LDQ     REC_WRD
         4 001023   777777 376007                    ANQ     -1,DL
         4 001024   000020 736000                    QLS     16
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:78   
         4 001025   000001 676000 5                  ERQ     1
         4 001026   000001 036007                    ADLQ    1,DL
         4 001027   000004 036000 0                  ADLQ    BOTTOM$
         4 001030   000004 756000 0                  STQ     BOTTOM$

      327     3612    1       BIT_LEN = REC.LEN * 9;

   3612  4 001031   000001 236000 0                  LDQ     REC_WRD
         4 001032   777777 376007                    ANQ     -1,DL
         4 001033   000011 402007                    MPY     9,DL
         4 001034   000002 756000 0                  STQ     BIT_LEN

      328     3613    1       BOTTOM$->BIT_STRING = ZEROS;

   3613  4 001035   000004 470400 0                  LDP0    BOTTOM$
         4 001036   000000 622006                    EAX2    0,QL
         4 001037   003140 060400                    CSL     bolr='003'O
         4 001040   000000 000044 1                  BDSC    ZEROS                    by=0,bit=0,n=36
         4 001041   000000 000012                    BDSC    0,,PR0                   by=0,bit=0,n=*X2

      329     3614         /*
      330     3615            Now the data is modified - modify offset array and header info.
      331     3616         */
      332     3617    2       DO X = 0 TO DATA_PG.OFF_LN.SEC;

   3617  4 001042   000000 450000 xsym               STZ     X
         4 001043   001101 710000 4                  TRA     s:3621+1

      333     3618    2           IF I_O_TAB.HW(OFFSET# X) > REC_OFF

   3618  4 001044   000000 335000 xsym               LCA     X
         4 001045   000001 735000                    ALS     1
         4 001046   000000 470400 xsym               LDP0    DATA$
         4 001047   000000 101505                    MRL     fill='000'O
         4 001050   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 001051   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 001052   000012 236000 0                  LDQ     REC_OFF
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:79   
         4 001053   000022 772000                    QRL     18
         4 001054   002516 116000 0                  CMPQ    @BUFNO+1
         4 001055   001100 605000 4                  TPL     s:3621
         4 001056   000000 101505                    MRL     fill='000'O
         4 001057   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 001060   002517 000004 0                  ADSC9   @BUFNO+2                 cn=0,n=4
         4 001061   002517 236000 0                  LDQ     @BUFNO+2
         4 001062   400000 116007                    CMPQ    -131072,DL
         4 001063   001100 605000 4                  TPL     s:3621

      334     3619    2              AND I_O_TAB.HW(OFFSET# X) < 131072 THEN
      335     3620    2               I_O_TAB.HW(OFFSET# X) = I_O_TAB.HW(OFFSET# X) - REC.LEN;

   3620  4 001064   000001 236000 0                  LDQ     REC_WRD
         4 001065   777777 376007                    ANQ     -1,DL
         4 001066   002516 756000 0                  STQ     @BUFNO+1
         4 001067   000000 101505                    MRL     fill='000'O
         4 001070   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 001071   002517 000004 0                  ADSC9   @BUFNO+2                 cn=0,n=4
         4 001072   002517 236000 0                  LDQ     @BUFNO+2
         4 001073   002516 136000 0                  SBLQ    @BUFNO+1
         4 001074   002520 756000 0                  STQ     @BUFNO+3
         4 001075   000105 101400                    MRL     fill='000'O
         4 001076   002520 000004 0                  ADSC9   @BUFNO+3                 cn=0,n=4
         4 001077   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

      336     3621    2           END;

   3621  4 001100   000000 054000 xsym               AOS     X
         4 001101   000000 470400 xsym               LDP0    DATA$
         4 001102   000005 236100                    LDQ     5,,PR0
         4 001103   777777 376007                    ANQ     -1,DL
         4 001104   000000 116000 xsym               CMPQ    X
         4 001105   001044 605000 4                  TPL     s:3618

      337     3622
      338     3623    1       DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC + REC.LEN;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:80   

   3623  4 001106   000001 236000 0                  LDQ     REC_WRD
         4 001107   777777 376007                    ANQ     -1,DL
         4 001110   002516 756000 0                  STQ     @BUFNO+1
         4 001111   000003 236100                    LDQ     3,,PR0
         4 001112   777777 376007                    ANQ     -1,DL
         4 001113   002516 036000 0                  ADLQ    @BUFNO+1
         4 001114   000000 620006                    EAX0    0,QL
         4 001115   000003 440100                    SXL0    3,,PR0

      339     3624
      340     3625    1       CALL BUILD_HEADER ALTRET(ALTRTN);

   3625  4 001116   002730 701000 4                  TSX1    BUILD_HEADER
         4 001117   004172 702000 4                  TSX2    ALTRTN

      341     3626
      342     3627    1       RETURN;

   3627  4 001120   000000 221200 0                  LDX1  ! 0
         4 001121   000001 702211                    TSX2  ! 1,X1

      343     3628        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:81   
      344     3629        /*
      345     3630                 PROCESS MODIFY THE FILE PAGE WITH JOURNAL RECORD
      346     3631        */
      347     3632    1   PROCESS_MOD: ENTRY ALTRET;

   3632  4 001122   000000 741200 0     PROCESS_MOD  STX1  ! 0

      348     3633
      349     3634    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);

   3634  4 001123   000004 236000 5                  LDQ     4
         4 001124   002520 756000 0                  STQ     @BUFNO+3
         4 001125   000000 236000 xsym               LDQ     JRNL$
         4 001126   000006 036000 5                  ADLQ    6
         4 001127   002517 756000 0                  STQ     @BUFNO+2
         4 001130   000000 236000 xsym               LDQ     JRNL$
         4 001131   000007 036000 5                  ADLQ    7
         4 001132   002516 756000 0                  STQ     @BUFNO+1
         4 001133   002516 630400 0                  EPPR0   @BUFNO+1
         4 001134   000005 631400 5                  EPPR1   5
         4 001135   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 001136   000000 011000                    NOP     0

      350     3635    1       CALL READ_PAGE ALTRET(ALTRTN);

   3635  4 001137   003127 701000 4                  TSX1    READ_PAGE
         4 001140   004172 702000 4                  TSX2    ALTRTN

      351     3636
      352     3637    1       REC_OFF = I_O_TAB.HW(OFFSET# JREC.LINE);

   3637  4 001141   000000 470400 xsym               LDP0    JRNL$
         4 001142   000003 236100                    LDQ     3,,PR0
         4 001143   777777 376007                    ANQ     -1,DL
         4 001144   000001 736000                    QLS     1
         4 001145   000001 676000 5                  ERQ     1
         4 001146   000001 036007                    ADLQ    1,DL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:82   
         4 001147   000000 471400 xsym               LDP1    DATA$
         4 001150   000000 100506                    MLR     fill='000'O
         4 001151   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2
         4 001152   000012 000002 0                  ADSC9   REC_OFF                  cn=0,n=2

      353     3638    1       REC$ = PINCRC(DATA$,REC_OFF+12);

   3638  4 001153   000012 236000 0                  LDQ     REC_OFF
         4 001154   777777 376003                    ANQ     -1,DU
         4 001155   000002 772000                    QRL     2
         4 001156   000003 036003                    ADLQ    3,DU
         4 001157   000000 036000 xsym               ADLQ    DATA$
         4 001160   000000 756000 xsym               STQ     REC$

      354     3639    1       REC_WRD = REC$ -> WRD;

   3639  4 001161   000000 473400 xsym               LDP3    REC$
         4 001162   000000 100500                    MLR     fill='000'O
         4 001163   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
         4 001164   000001 000004 0                  ADSC9   REC_WRD                  cn=0,n=4

      355     3640    1       REC_DIFF = JREC.LENGTH - REC.LEN; /* CALC DIFF BETWEEN TWO RECS */

   3640  4 001165   000001 236000 0                  LDQ     REC_WRD
         4 001166   777777 376007                    ANQ     -1,DL
         4 001167   002516 756000 0                  STQ     @BUFNO+1
         4 001170   000003 236100                    LDQ     3,,PR0
         4 001171   000022 772000                    QRL     18
         4 001172   002516 136000 0                  SBLQ    @BUFNO+1
         4 001173   000000 620006                    EAX0    0,QL
         4 001174   000014 740000 0                  STX0    REC_DIFF

      356     3641    1       N = JREC.LENGTH; /* Set size of based string array */

   3641  4 001175   000003 236100                    LDQ     3,,PR0
         4 001176   000022 772000                    QRL     18
         4 001177   000006 756000 0                  STQ     N
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:83   

      357     3642
      358     3643    1       REC$ = ADDR(JREC.VALUE);

   3643  4 001200   000000 236000 xsym               LDQ     JRNL$
         4 001201   000015 036000 5                  ADLQ    13
         4 001202   000000 756000 xsym               STQ     REC$

      359     3644    1       IF REC.TYPE ~= REC$ -> HLFWRD THEN

   3644  4 001203   000000 473400 xsym               LDP3    REC$
         4 001204   000000 101500                    MRL     fill='000'O
         4 001205   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2
         4 001206   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 001207   000001 236000 0                  LDQ     REC_WRD
         4 001210   000022 772000                    QRL     18
         4 001211   002516 116000 0                  CMPQ    @BUFNO+1
         4 001212   001226 600000 4                  TZE     s:3655

      360     3645    2       DO;

      361     3646         /*E* ERROR: ZIU-DBU#RMOD-C
      362     3647                    MESSAGE: Mismatch in record types on a MODIFY call on page# %U1
      363     3648                             at line# %U2 of file %FN.              */
      364     3649    2           ERRCODESF.ERR# = DBU#RMOD;

   3649  4 001213   000000 236000 xsym               LDQ     ERRCODESF
         4 001214   000010 376000 5                  ANQ     8
         4 001215   215020 276007                    ORQ     72208,DL
         4 001216   000000 756000 xsym               STQ     ERRCODESF

      365     3650    2           CALL FILL_ERROR_INFO;

   3650  4 001217   003063 701000 4                  TSX1    FILL_ERROR_INFO
         4 001220   000000 011000                    NOP     0

      366     3651    2           CALL SYS_FUNC_ERRMSG;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:84   

   3651  4 001221   000011 631400 5                  EPPR1   9
         4 001222   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 001223   000000 011000                    NOP     0

      367     3652    2           ALTRETURN;

   3652  4 001224   000000 221200 0                  LDX1  ! 0
         4 001225   000000 702211                    TSX2  ! 0,X1

      368     3653    2           END;
      369     3654
      370     3655    1       REC$ = PINCRC(DATA$,REC_OFF+12);

   3655  4 001226   000012 236000 0                  LDQ     REC_OFF
         4 001227   777777 376003                    ANQ     -1,DU
         4 001230   000002 772000                    QRL     2
         4 001231   000003 036003                    ADLQ    3,DU
         4 001232   000000 036000 xsym               ADLQ    DATA$
         4 001233   000000 756000 xsym               STQ     REC$

      371     3656
      372     3657    1       IF REC_DIFF < 0 THEN /* New rec is smaller than old - compress */

   3657  4 001234   000000 100003                    CMPX0   0,DU
         4 001235   001342 605000 4                  TPL     s:3676

      373     3658    2       DO; /* page. First find end of data. */

      374     3659    2           LAST_OFF = (I_O_TAB.ELEM.VAL(6) -

   3659  4 001236   100003 236100                    LDQ     3,,PR1
         4 001237   177777 376007                    ANQ     65535,DL
         4 001240   002516 756000 0                  STQ     @BUFNO+1
         4 001241   100005 236100                    LDQ     5,,PR1
         4 001242   000001 736000                    QLS     1
         4 001243   377776 376007                    ANQ     131070,DL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:85   
         4 001244   002516 036000 0                  ADLQ    @BUFNO+1
         4 001245   002517 756000 0                  STQ     @BUFNO+2
         4 001246   100003 236100                    LDQ     3,,PR1
         4 001247   000022 772000                    QRL     18
         4 001250   177777 376007                    ANQ     65535,DL
         4 001251   002517 136000 0                  SBLQ    @BUFNO+2
         4 001252   777776 621006                    EAX1    -2,QL
         4 001253   000010 741000 0                  STX1    LAST_OFF

      375     3660    2              (I_O_TAB.ELEM.VAL(7) +
      376     3661    2              ((I_O_TAB.ELEM.VAL(11)+1) *2)));
      377     3662    2           BOTTOM$ = PINCRC(DATA$,LAST_OFF+12);

   3662  4 001254   000010 236000 0                  LDQ     LAST_OFF
         4 001255   777777 376003                    ANQ     -1,DU
         4 001256   000002 772000                    QRL     2
         4 001257   000003 036003                    ADLQ    3,DU
         4 001260   000000 036000 xsym               ADLQ    DATA$
         4 001261   000004 756000 0                  STQ     BOTTOM$

      378     3663
      379     3664    2           END$ = PINCRC(REC$,REC.LEN); /* Set ptr to end of data rec */

   3664  4 001262   000001 236000 0                  LDQ     REC_WRD
         4 001263   777777 376007                    ANQ     -1,DL
         4 001264   000020 736000                    QLS     16
         4 001265   000000 036000 xsym               ADLQ    REC$
         4 001266   000003 756000 0                  STQ     END$

      380     3665    2           REC$ = PINCRC(REC$,JREC.LENGTH); /* Set ptr to end of new rec */

   3665  4 001267   000003 236100                    LDQ     3,,PR0
         4 001270   000022 772000                    QRL     18
         4 001271   000020 736000                    QLS     16
         4 001272   000000 036000 xsym               ADLQ    REC$
         4 001273   000000 756000 xsym               STQ     REC$

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:86   
      381     3666    2           N = LAST_OFF -(REC_OFF + JREC.LENGTH); /* SET len of shift */

   3666  4 001274   000003 236100                    LDQ     3,,PR0
         4 001275   000022 772000                    QRL     18
         4 001276   002516 756000 0                  STQ     @BUFNO+1
         4 001277   000012 236000 0                  LDQ     REC_OFF
         4 001300   000022 772000                    QRL     18
         4 001301   002516 036000 0                  ADLQ    @BUFNO+1
         4 001302   002517 756000 0                  STQ     @BUFNO+2
         4 001303   000010 236000 0                  LDQ     LAST_OFF
         4 001304   000022 772000                    QRL     18
         4 001305   002517 136000 0                  SBLQ    @BUFNO+2
         4 001306   000006 756000 0                  STQ     N

      382     3667    2           REC$ -> STRING = END$ -> STRING; /* * * SHIFT UP * * */

   3667  4 001307   000003 473400 0                  LDP3    END$
         4 001310   000000 622006                    EAX2    0,QL
         4 001311   000000 474400 xsym               LDP4    REC$
         4 001312   000006 723000 0                  LXL3    N
         4 001313   040140 100540                    MLR     fill='040'O
         4 001314   300000 000012                    ADSC9   0,,PR3                   cn=0,n=*X2
         4 001315   400000 000013                    ADSC9   0,,PR4                   cn=0,n=*X3

      383     3668         /* Zero out bottom */
      384     3669    2           BOTTOM$ = PINCRC(BOTTOM$,REC_DIFF);

   3669  4 001316   000014 236000 0                  LDQ     REC_DIFF
         4 001317   777777 376003                    ANQ     -1,DU
         4 001320   000002 732000                    QRS     2
         4 001321   000004 036000 0                  ADLQ    BOTTOM$
         4 001322   000004 756000 0                  STQ     BOTTOM$

      385     3670    2           BIT_LEN = -1*REC_DIFF;

   3670  4 001323   000014 235000 0                  LDA     REC_DIFF
         4 001324   000022 731000                    ARS     18
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:87   
         4 001325   000000 531000                    NEG     0
         4 001326   000002 755000 0                  STA     BIT_LEN

      386     3671    2           BOTTOM$->BIT_STRING = ZEROS;

   3671  4 001327   000004 470400 0                  LDP0    BOTTOM$
         4 001330   000000 622005                    EAX2    0,AL
         4 001331   003140 060400                    CSL     bolr='003'O
         4 001332   000000 000044 1                  BDSC    ZEROS                    by=0,bit=0,n=36
         4 001333   000000 000012                    BDSC    0,,PR0                   by=0,bit=0,n=*X2

      387     3672
      388     3673    2           REC$ = PINCRC(DATA$,REC_OFF+12); /* Reset record pointer */

   3673  4 001334   000012 236000 0                  LDQ     REC_OFF
         4 001335   777777 376003                    ANQ     -1,DU
         4 001336   000002 772000                    QRL     2
         4 001337   000003 036003                    ADLQ    3,DU
         4 001340   000000 036000 xsym               ADLQ    DATA$
         4 001341   000000 756000 xsym               STQ     REC$

      389     3674    2           END;

      390     3675
      391     3676    1       IF REC_DIFF > 0 THEN /* New rec is larger than old - */

   3676  4 001342   000000 100003                    CMPX0   0,DU
         4 001343   001430 604400 4                  TMOZ    s:3690

      392     3677    2       DO; /* Expand data page to accomadate*/

      393     3678    2           LAST_OFF = (I_O_TAB.ELEM.VAL(6) -

   3678  4 001344   000000 470400 xsym               LDP0    DATA$
         4 001345   000003 236100                    LDQ     3,,PR0
         4 001346   177777 376007                    ANQ     65535,DL
         4 001347   002516 756000 0                  STQ     @BUFNO+1
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:88   
         4 001350   000005 236100                    LDQ     5,,PR0
         4 001351   000001 736000                    QLS     1
         4 001352   377776 376007                    ANQ     131070,DL
         4 001353   002516 036000 0                  ADLQ    @BUFNO+1
         4 001354   002517 756000 0                  STQ     @BUFNO+2
         4 001355   000003 236100                    LDQ     3,,PR0
         4 001356   000022 772000                    QRL     18
         4 001357   177777 376007                    ANQ     65535,DL
         4 001360   002517 136000 0                  SBLQ    @BUFNO+2
         4 001361   000012 621006                    EAX1    10,QL
         4 001362   000010 741000 0                  STX1    LAST_OFF

      394     3679    2              (I_O_TAB.ELEM.VAL(7) +
      395     3680    2              ((I_O_TAB.ELEM.VAL(11)+1) *2)))+12;
      396     3681    2           N = LAST_OFF -(REC_OFF + REC.LEN); /* Set len of shift */

   3681  4 001363   000001 236000 0                  LDQ     REC_WRD
         4 001364   777777 376007                    ANQ     -1,DL
         4 001365   002516 756000 0                  STQ     @BUFNO+1
         4 001366   000012 236000 0                  LDQ     REC_OFF
         4 001367   000022 772000                    QRL     18
         4 001370   002516 036000 0                  ADLQ    @BUFNO+1
         4 001371   002517 756000 0                  STQ     @BUFNO+2
         4 001372   000010 236000 0                  LDQ     LAST_OFF
         4 001373   000022 772000                    QRL     18
         4 001374   002517 136000 0                  SBLQ    @BUFNO+2
         4 001375   000006 756000 0                  STQ     N

      397     3682    2           END$ = PINCRC(REC$,JREC.LENGTH);

   3682  4 001376   000000 471400 xsym               LDP1    JRNL$
         4 001377   100003 236100                    LDQ     3,,PR1
         4 001400   000022 772000                    QRL     18
         4 001401   000020 736000                    QLS     16
         4 001402   000000 036000 xsym               ADLQ    REC$
         4 001403   000003 756000 0                  STQ     END$

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:89   
      398     3683    2           REC$ = PINCRC(REC$,REC.LEN);

   3683  4 001404   000001 236000 0                  LDQ     REC_WRD
         4 001405   777777 376007                    ANQ     -1,DL
         4 001406   000020 736000                    QLS     16
         4 001407   000000 036000 xsym               ADLQ    REC$
         4 001410   000000 756000 xsym               STQ     REC$

      399     3684
      400     3685
      401     3686    2           CALL SHIFT_ARRAY(FROMSTR,TOSTR,N); /* BMAP MRL subroutine */

   3686  4 001411   000016 236000 5                  LDQ     14
         4 001412   002520 756000 0                  STQ     @BUFNO+3
         4 001413   000003 236000 0                  LDQ     END$
         4 001414   000000 235000 xsym               LDA     REC$
         4 001415   002516 757000 0                  STAQ    @BUFNO+1
         4 001416   002516 630400 0                  EPPR0   @BUFNO+1
         4 001417   000005 631400 5                  EPPR1   5
         4 001420   000000 701000 xent               TSX1    SHIFT_ARRAY
         4 001421   000000 011000                    NOP     0

      402     3687    2           REC$ = PINCRC(DATA$,REC_OFF+12); /* Reset record ptr */

   3687  4 001422   000012 236000 0                  LDQ     REC_OFF
         4 001423   777777 376003                    ANQ     -1,DU
         4 001424   000002 772000                    QRL     2
         4 001425   000003 036003                    ADLQ    3,DU
         4 001426   000000 036000 xsym               ADLQ    DATA$
         4 001427   000000 756000 xsym               STQ     REC$

      403     3688    2           END;

      404     3689
      405     3690    1       N = JREC.LENGTH; /* Make actual string change */

   3690  4 001430   000000 470400 xsym               LDP0    JRNL$
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:90   
         4 001431   000003 236100                    LDQ     3,,PR0
         4 001432   000022 772000                    QRL     18
         4 001433   000006 756000 0                  STQ     N

      406     3691    1       REC$ -> STRING = JREC.VALUE;

   3691  4 001434   000003 220100                    LDX0    3,,PR0
         4 001435   000000 471400 xsym               LDP1    REC$
         4 001436   000000 621006                    EAX1    0,QL
         4 001437   040140 100540                    MLR     fill='040'O
         4 001440   000004 400010                    ADSC9   4,,PR0                   cn=2,n=*X0
         4 001441   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

      407     3692
      408     3693    1       IF REC_DIFF ~= 0 THEN

   3693  4 001442   000014 220000 0                  LDX0    REC_DIFF
         4 001443   001521 600000 4                  TZE     s:3703

      409     3694    2       DO;

      410     3695    2           DATA_PG.PG_SZ.SEC = DATA_PG.PG_SZ.SEC - REC_DIFF;

   3695  4 001444   000014 235000 0                  LDA     REC_DIFF
         4 001445   000022 731000                    ARS     18
         4 001446   002516 755000 0                  STA     @BUFNO+1
         4 001447   000000 470400 xsym               LDP0    DATA$
         4 001450   000003 236100                    LDQ     3,,PR0
         4 001451   777777 376007                    ANQ     -1,DL
         4 001452   002516 136000 0                  SBLQ    @BUFNO+1
         4 001453   000000 621006                    EAX1    0,QL
         4 001454   000003 441100                    SXL1    3,,PR0

      411     3696         /* Modify offset arrary */
      412     3697    3           DO X = 0 TO DATA_PG.OFF_LN.SEC;

   3697  4 001455   000000 450000 xsym               STZ     X
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:91   
         4 001456   001514 710000 4                  TRA     s:3701+1

      413     3698    3               IF I_O_TAB.HW(OFFSET# X) > REC_OFF AND

   3698  4 001457   000000 335000 xsym               LCA     X
         4 001460   000001 735000                    ALS     1
         4 001461   000000 470400 xsym               LDP0    DATA$
         4 001462   000000 101505                    MRL     fill='000'O
         4 001463   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 001464   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 001465   000012 236000 0                  LDQ     REC_OFF
         4 001466   000022 772000                    QRL     18
         4 001467   002516 116000 0                  CMPQ    @BUFNO+1
         4 001470   001513 605000 4                  TPL     s:3701
         4 001471   000000 101505                    MRL     fill='000'O
         4 001472   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 001473   002517 000004 0                  ADSC9   @BUFNO+2                 cn=0,n=4
         4 001474   002517 236000 0                  LDQ     @BUFNO+2
         4 001475   400000 116007                    CMPQ    -131072,DL
         4 001476   001513 605000 4                  TPL     s:3701

      414     3699    3                  I_O_TAB.HW(OFFSET# X) < 131072 THEN
      415     3700    3                   I_O_TAB.HW(OFFSET# X) = I_O_TAB.HW(OFFSET# X) + REC_DIFF;

   3700  4 001477   000014 236000 0                  LDQ     REC_DIFF
         4 001500   000022 732000                    QRS     18
         4 001501   002516 756000 0                  STQ     @BUFNO+1
         4 001502   000000 101505                    MRL     fill='000'O
         4 001503   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 001504   002517 000004 0                  ADSC9   @BUFNO+2                 cn=0,n=4
         4 001505   002517 236000 0                  LDQ     @BUFNO+2
         4 001506   002516 036000 0                  ADLQ    @BUFNO+1
         4 001507   002520 756000 0                  STQ     @BUFNO+3
         4 001510   000105 101400                    MRL     fill='000'O
         4 001511   002520 000004 0                  ADSC9   @BUFNO+3                 cn=0,n=4
         4 001512   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:92   
      416     3701    3               END;

   3701  4 001513   000000 054000 xsym               AOS     X
         4 001514   000000 470400 xsym               LDP0    DATA$
         4 001515   000005 236100                    LDQ     5,,PR0
         4 001516   777777 376007                    ANQ     -1,DL
         4 001517   000000 116000 xsym               CMPQ    X
         4 001520   001457 605000 4                  TPL     s:3698

      417     3702    2           END;

      418     3703    1       CALL BUILD_HEADER ALTRET(ALTRTN);

   3703  4 001521   002730 701000 4                  TSX1    BUILD_HEADER
         4 001522   004172 702000 4                  TSX2    ALTRTN

      419     3704    1       RETURN;

   3704  4 001523   000000 221200 0                  LDX1  ! 0
         4 001524   000001 702211                    TSX2  ! 1,X1

      420     3705        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:93   
      421     3706        /*
      422     3707              PROCESS MODIFY OF CHANGED SET POINTERS DO TO STORE OR DELETE
      423     3708        */
      424     3709    1   PROCESS_SET: ENTRY ALTRET;

   3709  4 001525   000000 741200 0     PROCESS_SET  STX1  ! 0

      425     3710
      426     3711    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);

   3711  4 001526   000004 236000 5                  LDQ     4
         4 001527   002520 756000 0                  STQ     @BUFNO+3
         4 001530   000000 236000 xsym               LDQ     JRNL$
         4 001531   000006 036000 5                  ADLQ    6
         4 001532   002517 756000 0                  STQ     @BUFNO+2
         4 001533   000000 236000 xsym               LDQ     JRNL$
         4 001534   000007 036000 5                  ADLQ    7
         4 001535   002516 756000 0                  STQ     @BUFNO+1
         4 001536   002516 630400 0                  EPPR0   @BUFNO+1
         4 001537   000005 631400 5                  EPPR1   5
         4 001540   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 001541   000000 011000                    NOP     0

      427     3712    1       CALL READ_PAGE ALTRET(ALTRTN);

   3712  4 001542   003127 701000 4                  TSX1    READ_PAGE
         4 001543   004172 702000 4                  TSX2    ALTRTN

      428     3713
      429     3714    1       REC$ = PINCRC(DATA$,JREC.OFFSET+12);

   3714  4 001544   000000 470400 xsym               LDP0    JRNL$
         4 001545   000004 236100                    LDQ     4,,PR0
         4 001546   000022 772000                    QRL     18
         4 001547   000020 736000                    QLS     16
         4 001550   000003 036003                    ADLQ    3,DU
         4 001551   000000 036000 xsym               ADLQ    DATA$
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:94   
         4 001552   000000 756000 xsym               STQ     REC$

      430     3715    1       N = JREC.LENGTH;

   3715  4 001553   000003 236100                    LDQ     3,,PR0
         4 001554   000022 772000                    QRL     18
         4 001555   000006 756000 0                  STQ     N

      431     3716
      432     3717    1       REC$ -> STRING = JREC.VALUE;

   3717  4 001556   000003 220100                    LDX0    3,,PR0
         4 001557   000000 471400 xsym               LDP1    REC$
         4 001560   000000 621006                    EAX1    0,QL
         4 001561   040140 100540                    MLR     fill='040'O
         4 001562   000004 400010                    ADSC9   4,,PR0                   cn=2,n=*X0
         4 001563   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

      433     3718
      434     3719    1       IF DATA_PG.CHKSUM_WD ~= 0 THEN

   3719  4 001564   000000 470400 xsym               LDP0    DATA$
         4 001565   000002 235100                    LDA     2,,PR0
         4 001566   001575 600000 4                  TZE     s:3725

      435     3720    2       DO;

      436     3721    2           CALL CHKSUM;

   3721  4 001567   000011 631400 5                  EPPR1   9
         4 001570   000000 701000 xent               TSX1    CHKSUM
         4 001571   000000 011000                    NOP     0

      437     3722    2           DATA_PG.CHKSUM_WD = ICHKSUM;

   3722  4 001572   000000 470400 xsym               LDP0    DATA$
         4 001573   000000 235000 xsym               LDA     ICHKSUM
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:95   
         4 001574   000002 755100                    STA     2,,PR0

      438     3723    2           END;

      439     3724
      440     3725    1       RETURN;

   3725  4 001575   000000 221200 0                  LDX1  ! 0
         4 001576   000001 702211                    TSX2  ! 1,X1

      441     3726        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:96   
      442     3727        /*
      443     3728              TAKE CHECKSUM OF PAGE AND CHECK AGAINST IDS AFTER IMAGE CHECKSUM
      444     3729        */
      445     3730    1   PROCESS_SUM: ENTRY ALTRET;

   3730  4 001577   000000 741200 0     PROCESS_SUM  STX1  ! 0

      446     3731
      447     3732    1       CALL FIND_USER_FIDID(CKSM.USER#,CKSM.DCB#,FIDX);

   3732  4 001600   000004 236000 5                  LDQ     4
         4 001601   002520 756000 0                  STQ     @BUFNO+3
         4 001602   000000 236000 xsym               LDQ     JRNL$
         4 001603   000006 036000 5                  ADLQ    6
         4 001604   002517 756000 0                  STQ     @BUFNO+2
         4 001605   000000 236000 xsym               LDQ     JRNL$
         4 001606   000007 036000 5                  ADLQ    7
         4 001607   002516 756000 0                  STQ     @BUFNO+1
         4 001610   002516 630400 0                  EPPR0   @BUFNO+1
         4 001611   000005 631400 5                  EPPR1   5
         4 001612   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 001613   000000 011000                    NOP     0

      448     3733    1       CALL READ_PAGE ALTRET(ALTRTN);

   3733  4 001614   003127 701000 4                  TSX1    READ_PAGE
         4 001615   004172 702000 4                  TSX2    ALTRTN

      449     3734
      450     3735    1       CALL CHKJRNL; /* BMAP routine returns chksum value in ICHKSUM */

   3735  4 001616   000011 631400 5                  EPPR1   9
         4 001617   000000 701000 xent               TSX1    CHKJRNL
         4 001620   000000 011000                    NOP     0

      451     3736
      452     3737    1       IF ICHKSUM ~= CKSM.CKSM THEN
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:97   

   3737  4 001621   000000 470400 xsym               LDP0    JRNL$
         4 001622   000000 236000 xsym               LDQ     ICHKSUM
         4 001623   000003 116100                    CMPQ    3,,PR0
         4 001624   001677 600000 4                  TZE     s:3756

      453     3738    2       DO;

      454     3739         /*E* ERROR: ZIU-DBU#RCHK-C
      455     3740                    MESSAGE: Page reconstruction warning - occurrence on page# %U1
      456     3741                             in file %FN - Journal record# %U2.       */
      457     3742    2           ERRCODESF.ERR# = DBU#RCHK;

   3742  4 001625   000000 236000 xsym               LDQ     ERRCODESF
         4 001626   000010 376000 5                  ANQ     8
         4 001627   215060 276007                    ORQ     72240,DL
         4 001630   000000 756000 xsym               STQ     ERRCODESF

      458     3743    2           ERR_INSERT.CNT(0) = 11;

   3743  4 001631   013000 236003                    LDQ     5632,DU
         4 001632   000000 552040 xsym               STBQ    ERR_INSERT,'40'O

      459     3744    2           CALL BINCHAR(ERR_INSERT.TEXT(0),CKSM.PAGE);

   3744  4 001633   000002 235100                    LDA     2,,PR0
         4 001634   000044 773000                    LRL     36
         4 001635   002516 757000 0                  STAQ    @BUFNO+1
         4 001636   000000 301400                    BTD
         4 001637   002516 000010 0                  NDSC9   @BUFNO+1                 cn=0,s=lsgnf,sf=0,n=8
         4 001640   000000 230036 xsym               NDSC9   ERR_INSERT               cn=1,s=nosgn,sf=0,n=30

      460     3745    2           CALL ZERO_SUP(ERR_INSERT.TEXT(0),30,'1'B);

   3745  4 001641   000021 630400 5                  EPPR0   17
         4 001642   000005 631400 5                  EPPR1   5
         4 001643   000000 701000 xent               TSX1    ZERO_SUP
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:98   
         4 001644   000000 011000                    NOP     0

      461     3746    2           ERR_INSERT.CNT(1) = 11;

   3746  4 001645   013000 236003                    LDQ     5632,DU
         4 001646   000010 552040 xsym               STBQ    ERR_INSERT+8,'40'O

      462     3747    2           CALL BINCHAR(ERR_INSERT.TEXT(1),JREC_NO);

   3747  4 001647   000000 235000 xsym               LDA     JREC_NO
         4 001650   000044 773000                    LRL     36
         4 001651   002516 757000 0                  STAQ    @BUFNO+1
         4 001652   000000 301400                    BTD
         4 001653   002516 000010 0                  NDSC9   @BUFNO+1                 cn=0,s=lsgnf,sf=0,n=8
         4 001654   000010 230036 xsym               NDSC9   ERR_INSERT+8             cn=1,s=nosgn,sf=0,n=30

      463     3748    2           CALL ZERO_SUP(ERR_INSERT.TEXT(1),30,'1'B);

   3748  4 001655   000024 630400 5                  EPPR0   20
         4 001656   000005 631400 5                  EPPR1   5
         4 001657   000000 701000 xent               TSX1    ZERO_SUP
         4 001660   000000 011000                    NOP     0

      464     3749    2           DCBSF = FIDLIST.DCB#(FIDX);

   3749  4 001661   000000 236000 xsym               LDQ     FIDX
         4 001662   000021 402007                    MPY     17,DL
         4 001663   000000 470400 xsym               LDP0    FID$
         4 001664   000017 220106                    LDX0    15,QL,PR0
         4 001665   000000 740000 xsym               STX0    DCBSF

      465     3750    2           MSGCODE = ERRCODE_RDEF;

   3750  4 001666   000000 235000 xsym               LDA     ERRCODESF
         4 001667   000000 755000 xsym               STA     MSGCODE

      466     3751    2           ERRFLGSF = 2;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:99   

   3751  4 001670   002000 236003                    LDQ     1024,DU
         4 001671   000000 756000 xsym               STQ     ERRFLGSF

      467     3752    2           CALL SYS_FUNC_ERRMSG;

   3752  4 001672   000011 631400 5                  EPPR1   9
         4 001673   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 001674   000000 011000                    NOP     0

      468     3753    2           STEPCC=4;

   3753  4 001675   000004 235007                    LDA     4,DL
         4 001676   000000 755000 xsym               STA     STEPCC

      469     3754    2           END;

      470     3755
      471     3756    1       RETURN;

   3756  4 001677   000000 221200 0                  LDX1  ! 0
         4 001700   000001 702211                    TSX2  ! 1,X1

      472     3757        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:100  
      473     3758        /*
      474     3759                  P R O C E S S     I N D E X E D   S T O R E  &  M O D I F Y
      475     3760        */
      476     3761    1   PROCESS_ISTO: ENTRY ALTRET;

   3761  4 001701   000000 741200 0     PROCESS_ISTO STX1  ! 0

      477     3762
      478     3763    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);

   3763  4 001702   000004 236000 5                  LDQ     4
         4 001703   002520 756000 0                  STQ     @BUFNO+3
         4 001704   000000 236000 xsym               LDQ     JRNL$
         4 001705   000006 036000 5                  ADLQ    6
         4 001706   002517 756000 0                  STQ     @BUFNO+2
         4 001707   000000 236000 xsym               LDQ     JRNL$
         4 001710   000007 036000 5                  ADLQ    7
         4 001711   002516 756000 0                  STQ     @BUFNO+1
         4 001712   002516 630400 0                  EPPR0   @BUFNO+1
         4 001713   000005 631400 5                  EPPR1   5
         4 001714   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 001715   000000 011000                    NOP     0

      479     3764    1       IF FIDLIST.DCB#(FIDX) < 1 THEN

   3764  4 001716   000000 236000 xsym               LDQ     FIDX
         4 001717   000021 402007                    MPY     17,DL
         4 001720   000000 470400 xsym               LDP0    FID$
         4 001721   000017 220106                    LDX0    15,QL,PR0
         4 001722   001736 601000 4                  TNZ     s:3771

      480     3765    2       DO;

      481     3766    2           CALL ASSOC_DCB(FIDX);

   3766  4 001723   000004 630400 5                  EPPR0   4
         4 001724   000003 631400 5                  EPPR1   3
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:101  
         4 001725   000000 701000 xent               TSX1    ASSOC_DCB
         4 001726   000000 011000                    NOP     0

      482     3767    2           CALL QUE_UP(FIDX);

   3767  4 001727   000004 630400 5                  EPPR0   4
         4 001730   000003 631400 5                  EPPR1   3
         4 001731   000000 701000 xent               TSX1    QUE_UP
         4 001732   000000 011000                    NOP     0

      483     3768    2           CALL OPEN_FID ALTRET(ALTRTN);

   3768  4 001733   000011 631400 5                  EPPR1   9
         4 001734   000000 701000 xent               TSX1    OPEN_FID
         4 001735   004172 702000 4                  TSX2    ALTRTN

      484     3769    2           END;

      485     3770
      486     3771    1       DCBSF = FIDLIST.DCB#(FIDX);

   3771  4 001736   000000 236000 xsym               LDQ     FIDX
         4 001737   000021 402007                    MPY     17,DL
         4 001740   000000 470400 xsym               LDP0    FID$
         4 001741   000017 220106                    LDX0    15,QL,PR0
         4 001742   000000 740000 xsym               STX0    DCBSF

      487     3772    1       CALL FIND_KEY ALTRET(ALTRTN);

   3772  4 001743   002634 701000 4                  TSX1    FIND_KEY
         4 001744   004172 702000 4                  TSX2    ALTRTN

      488     3773
      489     3774         /*E* ERROR: ZIU-DBU#IRSTO-C
      490     3775           MESSAGE: Call to STORE a record which already exists for SYSID# %U1
      491     3776                    in file %FN.                                            */
      492     3777         /*E* ERROR: ZIU-DBU#IRMOD-C
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:102  
      493     3778           MESSAGE: Call to MODIFY a record which does not exist for SYSID# %U1
      494     3779                    in file %FN.                                            */
      495     3780
      496     3781    1       IF (FOUND = %YES# AND JREC.TYPE = T#IMOD) OR

   3781  4 001745   002364 234000 0                  SZN     FOUND
         4 001746   001754 605000 4                  TPL     s:3781+7
         4 001747   000000 470400 xsym               LDP0    JRNL$
         4 001750   000001 236100                    LDQ     1,,PR0
         4 001751   777000 376003                    ANQ     -512,DU
         4 001752   022000 116003                    CMPQ    9216,DU
         4 001753   001763 600000 4                  TZE     s:3784
         4 001754   002364 234000 0                  SZN     FOUND
         4 001755   002025 604000 4                  TMI     s:3795
         4 001756   000000 470400 xsym               LDP0    JRNL$
         4 001757   000001 236100                    LDQ     1,,PR0
         4 001760   777000 376003                    ANQ     -512,DU
         4 001761   020000 116003                    CMPQ    8192,DU
         4 001762   002025 601000 4                  TNZ     s:3795

      497     3782    1          (FOUND = %NO# AND JREC.TYPE = T#ISTO) THEN
      498     3783    2       DO;

      499     3784    2           ENCRP_SEEDSF = FIDLIST.CRPT_B(FIDX);

   3784  4 001763   000000 236000 xsym               LDQ     FIDX
         4 001764   000021 402007                    MPY     17,DL
         4 001765   000000 471400 xsym               LDP1    FID$
         4 001766   100016 236106                    LDQ     14,QL,PR1
         4 001767   000000 756000 xsym               STQ     ENCRP_SEEDSF

      500     3785    2           INDXKEYSF = INDXKEY;

   3785  4 001770   040000 100400                    MLR     fill='040'O
         4 001771   002264 000377 0                  ADSC9   ROLLKEY                  cn=0,n=255
         4 001772   000000 000377 xsym               ADSC9   KEYVSF                   cn=0,n=255

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:103  
      501     3786    2           CALL SYS_FUNC_WRIT ALTRET(ALTRTN);

   3786  4 001773   000011 631400 5                  EPPR1   9
         4 001774   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 001775   004172 702000 4                  TSX2    ALTRTN

      502     3787    2           FIDLIST.MOD#(FIDX) = 1;

   3787  4 001776   000000 236000 xsym               LDQ     FIDX
         4 001777   000021 402007                    MPY     17,DL
         4 002000   000000 470400 xsym               LDP0    FID$
         4 002001   000000 620006                    EAX0    0,QL
         4 002002   000015 236106                    LDQ     13,QL,PR0
         4 002003   000027 376000 5                  ANQ     23
         4 002004   000001 276007                    ORQ     1,DL
         4 002005   000015 756110                    STQ     13,X0,PR0

      503     3788    2           IF DCBADDR(DCBSF) -> F$DCB.RDL0# > 3 THEN

   3788  4 002006   000030 470400 5                  LDP0    24
         4 002007   000000 471500                    LDP1    0,,PR0
         4 002010   000000 220000 xsym               LDX0    DCBSF
         4 002011   100000 473510                    LDP3    0,X0,PR1
         4 002012   300003 236100                    LDQ     3,,PR3
         4 002013   000777 376003                    ANQ     511,DU
         4 002014   000004 116003                    CMPQ    4,DU
         4 002015   002065 602000 4                  TNC     s:3805

      504     3789    3           DO;

      505     3790    3               CALL SYS_FUNC_CLOS;

   3790  4 002016   000011 631400 5                  EPPR1   9
         4 002017   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 002020   000000 011000                    NOP     0

      506     3791    3               CALL OPEN_FID ALTRET(ALTRTN);
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:104  

   3791  4 002021   000011 631400 5                  EPPR1   9
         4 002022   000000 701000 xent               TSX1    OPEN_FID
         4 002023   004172 702000 4                  TSX2    ALTRTN

      507     3792    3               END;

      508     3793    2           END;

   3793  4 002024   002065 710000 4                  TRA     s:3805

      509     3794    2       ELSE DO;

      510     3795    2           IF JREC.TYPE = T#IMOD THEN

   3795  4 002025   000000 470400 xsym               LDP0    JRNL$
         4 002026   000001 236100                    LDQ     1,,PR0
         4 002027   777000 376003                    ANQ     -512,DU
         4 002030   022000 116003                    CMPQ    9216,DU
         4 002031   002037 601000 4                  TNZ     s:3798

      511     3796    2               ERRCODESF.ERR# = DBU#IRMOD;

   3796  4 002032   000000 236000 xsym               LDQ     ERRCODESF
         4 002033   000010 376000 5                  ANQ     8
         4 002034   216320 276007                    ORQ     72912,DL
         4 002035   000000 756000 xsym               STQ     ERRCODESF
         4 002036   002043 710000 4                  TRA     s:3799

      512     3797    2           ELSE
      513     3798    2               ERRCODESF.ERR# = DBU#IRSTO;

   3798  4 002037   000000 236000 xsym               LDQ     ERRCODESF
         4 002040   000010 376000 5                  ANQ     8
         4 002041   216300 276007                    ORQ     72896,DL
         4 002042   000000 756000 xsym               STQ     ERRCODESF

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:105  
      514     3799    2           CALL BINCHAR(ERR_INSERT.TEXT(0),USER.SYSID(FILE.USER#));

   3799  4 002043   000001 236100                    LDQ     1,,PR0
         4 002044   000022 772000                    QRL     18
         4 002045   000777 376007                    ANQ     511,DL
         4 002046   000005 402007                    MPY     5,DL
         4 002047   000000 236006 xsym               LDQ     USER,QL
         4 002050   000022 772000                    QRL     18
         4 002051   000000 235003                    LDA     0,DU
         4 002052   002516 757000 0                  STAQ    @BUFNO+1
         4 002053   000000 301400                    BTD
         4 002054   002516 000010 0                  NDSC9   @BUFNO+1                 cn=0,s=lsgnf,sf=0,n=8
         4 002055   000000 230036 xsym               NDSC9   ERR_INSERT               cn=1,s=nosgn,sf=0,n=30

      515     3800    2           MSGCODE = ERRCODE_RDEF;

   3800  4 002056   000000 236000 xsym               LDQ     ERRCODESF
         4 002057   000000 756000 xsym               STQ     MSGCODE

      516     3801    2           CALL SYS_FUNC_ERRMSG;

   3801  4 002060   000011 631400 5                  EPPR1   9
         4 002061   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 002062   000000 011000                    NOP     0

      517     3802    2           ALTRETURN;

   3802  4 002063   000000 221200 0                  LDX1  ! 0
         4 002064   000000 702211                    TSX2  ! 0,X1

      518     3803    2           END;
      519     3804
      520     3805    1       RETURN;

   3805  4 002065   000000 221200 0                  LDX1  ! 0
         4 002066   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:106  
      521     3806        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:107  
      522     3807        /*
      523     3808                 P R O C E S S   I N D E X E D    D E L E T E
      524     3809        */
      525     3810    1   PROCESS_IDEL: ENTRY ALTRET;

   3810  4 002067   000000 741200 0     PROCESS_IDEL STX1  ! 0

      526     3811
      527     3812    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);

   3812  4 002070   000004 236000 5                  LDQ     4
         4 002071   002520 756000 0                  STQ     @BUFNO+3
         4 002072   000000 236000 xsym               LDQ     JRNL$
         4 002073   000006 036000 5                  ADLQ    6
         4 002074   002517 756000 0                  STQ     @BUFNO+2
         4 002075   000000 236000 xsym               LDQ     JRNL$
         4 002076   000007 036000 5                  ADLQ    7
         4 002077   002516 756000 0                  STQ     @BUFNO+1
         4 002100   002516 630400 0                  EPPR0   @BUFNO+1
         4 002101   000005 631400 5                  EPPR1   5
         4 002102   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 002103   000000 011000                    NOP     0

      528     3813    1       IF FIDLIST.DCB#(FIDX) < 1 THEN

   3813  4 002104   000000 236000 xsym               LDQ     FIDX
         4 002105   000021 402007                    MPY     17,DL
         4 002106   000000 470400 xsym               LDP0    FID$
         4 002107   000017 220106                    LDX0    15,QL,PR0
         4 002110   002124 601000 4                  TNZ     s:3820

      529     3814    2       DO;

      530     3815    2           CALL ASSOC_DCB(FIDX);

   3815  4 002111   000004 630400 5                  EPPR0   4
         4 002112   000003 631400 5                  EPPR1   3
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:108  
         4 002113   000000 701000 xent               TSX1    ASSOC_DCB
         4 002114   000000 011000                    NOP     0

      531     3816    2           CALL QUE_UP(FIDX);

   3816  4 002115   000004 630400 5                  EPPR0   4
         4 002116   000003 631400 5                  EPPR1   3
         4 002117   000000 701000 xent               TSX1    QUE_UP
         4 002120   000000 011000                    NOP     0

      532     3817    2           CALL OPEN_FID ALTRET(ALTRTN);

   3817  4 002121   000011 631400 5                  EPPR1   9
         4 002122   000000 701000 xent               TSX1    OPEN_FID
         4 002123   004172 702000 4                  TSX2    ALTRTN

      533     3818    2           END;

      534     3819
      535     3820    1       DCBSF = FIDLIST.DCB#(FIDX);

   3820  4 002124   000000 236000 xsym               LDQ     FIDX
         4 002125   000021 402007                    MPY     17,DL
         4 002126   000000 470400 xsym               LDP0    FID$
         4 002127   000017 220106                    LDX0    15,QL,PR0
         4 002130   000000 740000 xsym               STX0    DCBSF

      536     3821    1       CALL FIND_KEY ALTRET(ALTRTN);

   3821  4 002131   002634 701000 4                  TSX1    FIND_KEY
         4 002132   004172 702000 4                  TSX2    ALTRTN

      537     3822
      538     3823         /*E* ERROR: ZIU-DBU#IRDEL-C
      539     3824           MESSAGE: Call to DELETE a record which does not exist for SYSID# %U1
      540     3825                    in file %FN.                                            */
      541     3826
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:109  
      542     3827    1       IF FOUND = %YES# THEN

   3827  4 002133   002364 234000 0                  SZN     FOUND
         4 002134   002154 605000 4                  TPL     s:3834

      543     3828    2       DO;

      544     3829    2           INDXKEYSF = INDXKEY;

   3829  4 002135   040000 100400                    MLR     fill='040'O
         4 002136   002264 000377 0                  ADSC9   ROLLKEY                  cn=0,n=255
         4 002137   000000 000377 xsym               ADSC9   KEYVSF                   cn=0,n=255

      545     3830    2           CALL SYS_FUNC_DELREC ALTRET(ALTRTN);

   3830  4 002140   000011 631400 5                  EPPR1   9
         4 002141   000000 701000 xent               TSX1    SYS_FUNC_DELREC
         4 002142   004172 702000 4                  TSX2    ALTRTN

      546     3831    2           FIDLIST.MOD#(FIDX) = 1;

   3831  4 002143   000000 236000 xsym               LDQ     FIDX
         4 002144   000021 402007                    MPY     17,DL
         4 002145   000000 470400 xsym               LDP0    FID$
         4 002146   000000 620006                    EAX0    0,QL
         4 002147   000015 236106                    LDQ     13,QL,PR0
         4 002150   000027 376000 5                  ANQ     23
         4 002151   000001 276007                    ORQ     1,DL
         4 002152   000015 756110                    STQ     13,X0,PR0

      547     3832    2           END;

   3832  4 002153   002204 710000 4                  TRA     s:3842

      548     3833    2       ELSE DO;

      549     3834    2           ERR_INSERT.CNT(0) = 7;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:110  

   3834  4 002154   007000 236003                    LDQ     3584,DU
         4 002155   000000 552040 xsym               STBQ    ERR_INSERT,'40'O

      550     3835    2           CALL BINCHAR(ERR_INSERT.TEXT(0),USER.SYSID(FILE.USER#));

   3835  4 002156   000000 470400 xsym               LDP0    JRNL$
         4 002157   000001 236100                    LDQ     1,,PR0
         4 002160   000022 772000                    QRL     18
         4 002161   000777 376007                    ANQ     511,DL
         4 002162   000005 402007                    MPY     5,DL
         4 002163   000000 236006 xsym               LDQ     USER,QL
         4 002164   000022 772000                    QRL     18
         4 002165   000000 235003                    LDA     0,DU
         4 002166   002516 757000 0                  STAQ    @BUFNO+1
         4 002167   000000 301400                    BTD
         4 002170   002516 000010 0                  NDSC9   @BUFNO+1                 cn=0,s=lsgnf,sf=0,n=8
         4 002171   000000 230036 xsym               NDSC9   ERR_INSERT               cn=1,s=nosgn,sf=0,n=30

      551     3836    2           ERRCODESF.ERR# = DBU#RKDEL;

   3836  4 002172   000000 236000 xsym               LDQ     ERRCODESF
         4 002173   000010 376000 5                  ANQ     8
         4 002174   216200 276007                    ORQ     72832,DL
         4 002175   000000 756000 xsym               STQ     ERRCODESF

      552     3837    2           MSGCODE = ERRCODE_RDEF;

   3837  4 002176   000000 756000 xsym               STQ     MSGCODE

      553     3838    2           CALL SYS_FUNC_ERRMSG;

   3838  4 002177   000011 631400 5                  EPPR1   9
         4 002200   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 002201   000000 011000                    NOP     0

      554     3839    2           ALTRETURN;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:111  

   3839  4 002202   000000 221200 0                  LDX1  ! 0
         4 002203   000000 702211                    TSX2  ! 0,X1

      555     3840    2           END;
      556     3841
      557     3842    1       RETURN;

   3842  4 002204   000000 221200 0                  LDX1  ! 0
         4 002205   000001 702211                    TSX2  ! 1,X1

      558     3843        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:112  
      559     3844    1   PROCESS_KSTO: ENTRY ALTRET;

   3844  4 002206   000000 741200 0     PROCESS_KSTO STX1  ! 0

      560     3845
      561     3846    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);

   3846  4 002207   000004 236000 5                  LDQ     4
         4 002210   002520 756000 0                  STQ     @BUFNO+3
         4 002211   000000 236000 xsym               LDQ     JRNL$
         4 002212   000006 036000 5                  ADLQ    6
         4 002213   002517 756000 0                  STQ     @BUFNO+2
         4 002214   000000 236000 xsym               LDQ     JRNL$
         4 002215   000007 036000 5                  ADLQ    7
         4 002216   002516 756000 0                  STQ     @BUFNO+1
         4 002217   002516 630400 0                  EPPR0   @BUFNO+1
         4 002220   000005 631400 5                  EPPR1   5
         4 002221   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 002222   000000 011000                    NOP     0

      562     3847    1       FIDX = FIDX + 1; /* Bump up indx by 1 to get keyed file */

   3847  4 002223   000000 054000 xsym               AOS     FIDX

      563     3848    1       IF FIDLIST.DCB#(FIDX) < 1 THEN

   3848  4 002224   000000 236000 xsym               LDQ     FIDX
         4 002225   000021 402007                    MPY     17,DL
         4 002226   000000 470400 xsym               LDP0    FID$
         4 002227   000017 220106                    LDX0    15,QL,PR0
         4 002230   002244 601000 4                  TNZ     s:3855

      564     3849    2       DO;

      565     3850    2           CALL ASSOC_DCB(FIDX);

   3850  4 002231   000004 630400 5                  EPPR0   4
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:113  
         4 002232   000003 631400 5                  EPPR1   3
         4 002233   000000 701000 xent               TSX1    ASSOC_DCB
         4 002234   000000 011000                    NOP     0

      566     3851    2           CALL QUE_UP(FIDX);

   3851  4 002235   000004 630400 5                  EPPR0   4
         4 002236   000003 631400 5                  EPPR1   3
         4 002237   000000 701000 xent               TSX1    QUE_UP
         4 002240   000000 011000                    NOP     0

      567     3852    2           CALL OPEN_FID ALTRET(ALTRTN);

   3852  4 002241   000011 631400 5                  EPPR1   9
         4 002242   000000 701000 xent               TSX1    OPEN_FID
         4 002243   004172 702000 4                  TSX2    ALTRTN

      568     3853    2           END;

      569     3854
      570     3855    1       DCBSF = FIDLIST.DCB#(FIDX);

   3855  4 002244   000000 236000 xsym               LDQ     FIDX
         4 002245   000021 402007                    MPY     17,DL
         4 002246   000000 470400 xsym               LDP0    FID$
         4 002247   000017 220106                    LDX0    15,QL,PR0
         4 002250   000000 740000 xsym               STX0    DCBSF

      571     3856    1       CALL FIND_KEY ALTRET(ALTRTN); /* Call M$PREREC to get key */

   3856  4 002251   002634 701000 4                  TSX1    FIND_KEY
         4 002252   004172 702000 4                  TSX2    ALTRTN

      572     3857
      573     3858    1       IF FOUND = %YES# THEN

   3858  4 002253   002364 234000 0                  SZN     FOUND
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:114  
         4 002254   002305 605000 4                  TPL     s:3871

      574     3859    2       DO;

      575     3860         /*E* ERROR: ZIU-DBU#RKSTO-C
      576     3861              MESSAGE: Call to STORE an alternate key which already exists
      577     3862                       for SYSID# %U1 in file %FN.                          */
      578     3863    2           ERR_INSERT.CNT(0) = 7;

   3863  4 002255   007000 236003                    LDQ     3584,DU
         4 002256   000000 552040 xsym               STBQ    ERR_INSERT,'40'O

      579     3864    2           CALL BINCHAR(ERR_INSERT.TEXT(0),USER.SYSID(FILE.USER#));

   3864  4 002257   000000 470400 xsym               LDP0    JRNL$
         4 002260   000001 236100                    LDQ     1,,PR0
         4 002261   000022 772000                    QRL     18
         4 002262   000777 376007                    ANQ     511,DL
         4 002263   000005 402007                    MPY     5,DL
         4 002264   000000 236006 xsym               LDQ     USER,QL
         4 002265   000022 772000                    QRL     18
         4 002266   000000 235003                    LDA     0,DU
         4 002267   002516 757000 0                  STAQ    @BUFNO+1
         4 002270   000000 301400                    BTD
         4 002271   002516 000010 0                  NDSC9   @BUFNO+1                 cn=0,s=lsgnf,sf=0,n=8
         4 002272   000000 230036 xsym               NDSC9   ERR_INSERT               cn=1,s=nosgn,sf=0,n=30

      580     3865    2           ERRCODESF.ERR# = DBU#RKSTO;

   3865  4 002273   000000 236000 xsym               LDQ     ERRCODESF
         4 002274   000010 376000 5                  ANQ     8
         4 002275   216160 276007                    ORQ     72816,DL
         4 002276   000000 756000 xsym               STQ     ERRCODESF

      581     3866    2           MSGCODE = ERRCODE_RDEF;

   3866  4 002277   000000 756000 xsym               STQ     MSGCODE
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:115  

      582     3867    2           CALL SYS_FUNC_ERRMSG;

   3867  4 002300   000011 631400 5                  EPPR1   9
         4 002301   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 002302   000000 011000                    NOP     0

      583     3868    2           ALTRETURN;

   3868  4 002303   000000 221200 0                  LDX1  ! 0
         4 002304   000000 702211                    TSX2  ! 0,X1

      584     3869    2           END;
      585     3870    2       ELSE DO;

      586     3871    2           BUFLNSF = 0;

   3871  4 002305   000000 450000 xsym               STZ     BUFLNSF

      587     3872    2           ENCRP_SEEDSF = '0'B;

   3872  4 002306   000000 450000 xsym               STZ     ENCRP_SEEDSF

      588     3873    2           VFCSF = %NO#;

   3873  4 002307   000000 450000 xsym               STZ     VFCSF

      589     3874    2           KEYVSF = ROLLKEY;

   3874  4 002310   000000 100400                    MLR     fill='000'O
         4 002311   002264 000377 0                  ADSC9   ROLLKEY                  cn=0,n=255
         4 002312   000000 000377 xsym               ADSC9   KEYVSF                   cn=0,n=255

      590     3875    2           CALL SYS_FUNC_WRIT ALTRET(ALTRTN);

   3875  4 002313   000011 631400 5                  EPPR1   9
         4 002314   000000 701000 xent               TSX1    SYS_FUNC_WRIT
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:116  
         4 002315   004172 702000 4                  TSX2    ALTRTN

      591     3876    2           FIDLIST.MOD#(FIDX) = 1; /* File modified flag */

   3876  4 002316   000000 236000 xsym               LDQ     FIDX
         4 002317   000021 402007                    MPY     17,DL
         4 002320   000000 470400 xsym               LDP0    FID$
         4 002321   000000 620006                    EAX0    0,QL
         4 002322   000015 236106                    LDQ     13,QL,PR0
         4 002323   000027 376000 5                  ANQ     23
         4 002324   000001 276007                    ORQ     1,DL
         4 002325   000015 756110                    STQ     13,X0,PR0

      592     3877    2           IF DCBADDR(DCBSF) -> F$DCB.RDL0# > 3 THEN

   3877  4 002326   000030 470400 5                  LDP0    24
         4 002327   000000 471500                    LDP1    0,,PR0
         4 002330   000000 220000 xsym               LDX0    DCBSF
         4 002331   100000 473510                    LDP3    0,X0,PR1
         4 002332   300003 236100                    LDQ     3,,PR3
         4 002333   000777 376003                    ANQ     511,DU
         4 002334   000004 116003                    CMPQ    4,DU
         4 002335   002344 602000 4                  TNC     s:3883

      593     3878    3           DO;

      594     3879    3               CALL SYS_FUNC_CLOS;

   3879  4 002336   000011 631400 5                  EPPR1   9
         4 002337   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 002340   000000 011000                    NOP     0

      595     3880    3               CALL OPEN_FID ALTRET(ALTRTN);

   3880  4 002341   000011 631400 5                  EPPR1   9
         4 002342   000000 701000 xent               TSX1    OPEN_FID
         4 002343   004172 702000 4                  TSX2    ALTRTN
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:117  

      596     3881    3               END;

      597     3882    2           END;

      598     3883    1       RETURN;

   3883  4 002344   000000 221200 0                  LDX1  ! 0
         4 002345   000001 702211                    TSX2  ! 1,X1

      599     3884        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:118  
      600     3885    1   PROCESS_CGMSG: ENTRY ALTRET;

   3885  4 002346   000000 741200 0     PROCESS_CGM* STX1  ! 0

      601     3886
      602     3887    1       CALL FIND_USER_FIDID(ZI$CGMSG.USER#,ZI$CGMSG.DCB#,FIDX);

   3887  4 002347   000004 236000 5                  LDQ     4
         4 002350   002520 756000 0                  STQ     @BUFNO+3
         4 002351   000000 236000 xsym               LDQ     JRNL$
         4 002352   000006 036000 5                  ADLQ    6
         4 002353   002517 756000 0                  STQ     @BUFNO+2
         4 002354   000000 236000 xsym               LDQ     JRNL$
         4 002355   000007 036000 5                  ADLQ    7
         4 002356   002516 756000 0                  STQ     @BUFNO+1
         4 002357   002516 630400 0                  EPPR0   @BUFNO+1
         4 002360   000005 631400 5                  EPPR1   5
         4 002361   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 002362   000000 011000                    NOP     0

      603     3888    2       IF FIDLIST.DCB#(FIDX) = 0 THEN DO;

   3888  4 002363   000000 236000 xsym               LDQ     FIDX
         4 002364   000021 402007                    MPY     17,DL
         4 002365   000000 470400 xsym               LDP0    FID$
         4 002366   000017 220106                    LDX0    15,QL,PR0
         4 002367   002412 601000 4                  TNZ     s:3893

      604     3889    2           CALL ASSOC_DCB(FIDX);

   3889  4 002370   000004 630400 5                  EPPR0   4
         4 002371   000003 631400 5                  EPPR1   3
         4 002372   000000 701000 xent               TSX1    ASSOC_DCB
         4 002373   000000 011000                    NOP     0

      605     3890    2           CALL QUE_UP(FIDX);

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:119  
   3890  4 002374   000004 630400 5                  EPPR0   4
         4 002375   000003 631400 5                  EPPR1   3
         4 002376   000000 701000 xent               TSX1    QUE_UP
         4 002377   000000 011000                    NOP     0

      606     3891    2           CALL ZIU$CGOPN(,FIDLIST.DCB#(FIDX)) ALTRET(ALTRTN);

   3891  4 002400   000000 236000 xsym               LDQ     FIDX
         4 002401   000021 402003                    MPY     17,DU
         4 002402   000017 036003                    ADLQ    15,DU
         4 002403   000000 036000 xsym               ADLQ    FID$
         4 002404   000013 235000 5                  LDA     11
         4 002405   002516 757000 0                  STAQ    @BUFNO+1
         4 002406   002516 630400 0                  EPPR0   @BUFNO+1
         4 002407   000012 631400 5                  EPPR1   10
         4 002410   000000 701000 xent               TSX1    ZIU$CGOPN
         4 002411   004172 702000 4                  TSX2    ALTRTN

      607     3892    2           END;

      608     3893    1       CALL ZIU$CGMSG(JRNL$,FIDLIST.DCB#(FIDX)) ALTRET(ALTRTN);

   3893  4 002412   000000 236000 xsym               LDQ     FIDX
         4 002413   000021 402003                    MPY     17,DU
         4 002414   000017 036003                    ADLQ    15,DU
         4 002415   000000 036000 xsym               ADLQ    FID$
         4 002416   000031 235000 5                  LDA     25
         4 002417   002516 757000 0                  STAQ    @BUFNO+1
         4 002420   002516 630400 0                  EPPR0   @BUFNO+1
         4 002421   000012 631400 5                  EPPR1   10
         4 002422   000000 701000 xent               TSX1    ZIU$CGMSG
         4 002423   004172 702000 4                  TSX2    ALTRTN

      609     3894    1       RETURN;

   3894  4 002424   000000 221200 0                  LDX1  ! 0
         4 002425   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:120  

      610     3895        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:121  
      611     3896    1   PROCESS_CGDEL: ENTRY ALTRET;

   3896  4 002426   000000 741200 0     PROCESS_CGD* STX1  ! 0

      612     3897
      613     3898    1       CALL FIND_USER_FIDID(ZI$CGDEL.USER#,ZI$CGDEL.DCB#,FIDX);

   3898  4 002427   000004 236000 5                  LDQ     4
         4 002430   002520 756000 0                  STQ     @BUFNO+3
         4 002431   000000 236000 xsym               LDQ     JRNL$
         4 002432   000006 036000 5                  ADLQ    6
         4 002433   002517 756000 0                  STQ     @BUFNO+2
         4 002434   000000 236000 xsym               LDQ     JRNL$
         4 002435   000007 036000 5                  ADLQ    7
         4 002436   002516 756000 0                  STQ     @BUFNO+1
         4 002437   002516 630400 0                  EPPR0   @BUFNO+1
         4 002440   000005 631400 5                  EPPR1   5
         4 002441   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 002442   000000 011000                    NOP     0

      614     3899    2       IF FIDLIST.DCB#(FIDX) = 0 THEN DO;

   3899  4 002443   000000 236000 xsym               LDQ     FIDX
         4 002444   000021 402007                    MPY     17,DL
         4 002445   000000 470400 xsym               LDP0    FID$
         4 002446   000017 220106                    LDX0    15,QL,PR0
         4 002447   002472 601000 4                  TNZ     s:3904

      615     3900    2           CALL ASSOC_DCB(FIDX);

   3900  4 002450   000004 630400 5                  EPPR0   4
         4 002451   000003 631400 5                  EPPR1   3
         4 002452   000000 701000 xent               TSX1    ASSOC_DCB
         4 002453   000000 011000                    NOP     0

      616     3901    2           CALL QUE_UP(FIDX);

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:122  
   3901  4 002454   000004 630400 5                  EPPR0   4
         4 002455   000003 631400 5                  EPPR1   3
         4 002456   000000 701000 xent               TSX1    QUE_UP
         4 002457   000000 011000                    NOP     0

      617     3902    2           CALL ZIU$CGOPN(,FIDLIST.DCB#(FIDX)) ALTRET(ALTRTN);

   3902  4 002460   000000 236000 xsym               LDQ     FIDX
         4 002461   000021 402003                    MPY     17,DU
         4 002462   000017 036003                    ADLQ    15,DU
         4 002463   000000 036000 xsym               ADLQ    FID$
         4 002464   000013 235000 5                  LDA     11
         4 002465   002516 757000 0                  STAQ    @BUFNO+1
         4 002466   002516 630400 0                  EPPR0   @BUFNO+1
         4 002467   000012 631400 5                  EPPR1   10
         4 002470   000000 701000 xent               TSX1    ZIU$CGOPN
         4 002471   004172 702000 4                  TSX2    ALTRTN

      618     3903    2           END;

      619     3904    1       CALL ZIU$CGDEL(JRNL$,FIDLIST.DCB#(FIDX)) ALTRET(ALTRTN);

   3904  4 002472   000000 236000 xsym               LDQ     FIDX
         4 002473   000021 402003                    MPY     17,DU
         4 002474   000017 036003                    ADLQ    15,DU
         4 002475   000000 036000 xsym               ADLQ    FID$
         4 002476   000031 235000 5                  LDA     25
         4 002477   002516 757000 0                  STAQ    @BUFNO+1
         4 002500   002516 630400 0                  EPPR0   @BUFNO+1
         4 002501   000012 631400 5                  EPPR1   10
         4 002502   000000 701000 xent               TSX1    ZIU$CGDEL
         4 002503   004172 702000 4                  TSX2    ALTRTN

      620     3905    1       USER.CGMSGID(ZI$CGDEL.USER#) = '0'B;

   3905  4 002504   000000 470400 xsym               LDP0    JRNL$
         4 002505   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:123  
         4 002506   000022 772000                    QRL     18
         4 002507   000777 376007                    ANQ     511,DL
         4 002510   000005 402007                    MPY     5,DL
         4 002511   000003 450006 xsym               STZ     USER+3,QL
         4 002512   000004 450006 xsym               STZ     USER+4,QL

      621     3906    1       RETURN;

   3906  4 002513   000000 221200 0                  LDX1  ! 0
         4 002514   000001 702211                    TSX2  ! 1,X1

      622     3907        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:124  
      623     3908        /*
      624     3909                 PROCESS   DELETE  ALTERNATE  KEY
      625     3910        */
      626     3911    1   PROCESS_KDEL: ENTRY ALTRET;

   3911  4 002515   000000 741200 0     PROCESS_KDEL STX1  ! 0

      627     3912
      628     3913    1       CALL FIND_USER_FIDID(JREC.USER#,JREC.DCB#,FIDX);

   3913  4 002516   000004 236000 5                  LDQ     4
         4 002517   002520 756000 0                  STQ     @BUFNO+3
         4 002520   000000 236000 xsym               LDQ     JRNL$
         4 002521   000006 036000 5                  ADLQ    6
         4 002522   002517 756000 0                  STQ     @BUFNO+2
         4 002523   000000 236000 xsym               LDQ     JRNL$
         4 002524   000007 036000 5                  ADLQ    7
         4 002525   002516 756000 0                  STQ     @BUFNO+1
         4 002526   002516 630400 0                  EPPR0   @BUFNO+1
         4 002527   000005 631400 5                  EPPR1   5
         4 002530   000000 701000 xent               TSX1    FIND_USER_FIDID
         4 002531   000000 011000                    NOP     0

      629     3914    1       FIDX = FIDX + 1; /* Bump up indx by 1 to get keyed file */

   3914  4 002532   000000 054000 xsym               AOS     FIDX

      630     3915    1       IF FIDLIST.DCB#(FIDX) < 1 THEN

   3915  4 002533   000000 236000 xsym               LDQ     FIDX
         4 002534   000021 402007                    MPY     17,DL
         4 002535   000000 470400 xsym               LDP0    FID$
         4 002536   000017 220106                    LDX0    15,QL,PR0
         4 002537   002553 601000 4                  TNZ     s:3922

      631     3916    2       DO;

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:125  
      632     3917    2           CALL ASSOC_DCB(FIDX);

   3917  4 002540   000004 630400 5                  EPPR0   4
         4 002541   000003 631400 5                  EPPR1   3
         4 002542   000000 701000 xent               TSX1    ASSOC_DCB
         4 002543   000000 011000                    NOP     0

      633     3918    2           CALL QUE_UP(FIDX);

   3918  4 002544   000004 630400 5                  EPPR0   4
         4 002545   000003 631400 5                  EPPR1   3
         4 002546   000000 701000 xent               TSX1    QUE_UP
         4 002547   000000 011000                    NOP     0

      634     3919    2           CALL OPEN_FID ALTRET(ALTRTN);

   3919  4 002550   000011 631400 5                  EPPR1   9
         4 002551   000000 701000 xent               TSX1    OPEN_FID
         4 002552   004172 702000 4                  TSX2    ALTRTN

      635     3920    2           END;

      636     3921
      637     3922    1       DCBSF = FIDLIST.DCB#(FIDX);

   3922  4 002553   000000 236000 xsym               LDQ     FIDX
         4 002554   000021 402007                    MPY     17,DL
         4 002555   000000 470400 xsym               LDP0    FID$
         4 002556   000017 220106                    LDX0    15,QL,PR0
         4 002557   000000 740000 xsym               STX0    DCBSF

      638     3923    1       CALL FIND_KEY ALTRET(ALTRTN); /* Call M$PREREC to get key */

   3923  4 002560   002634 701000 4                  TSX1    FIND_KEY
         4 002561   004172 702000 4                  TSX2    ALTRTN

      639     3924
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:126  
      640     3925    1       IF FOUND = %NO# THEN

   3925  4 002562   002364 234000 0                  SZN     FOUND
         4 002563   002614 604000 4                  TMI     s:3938

      641     3926    2       DO;

      642     3927         /*E* ERROR: ZIU-DBU#RKDEL-C
      643     3928              MESSAGE: Call to DELETE an alternate key which does not exist
      644     3929                       for SYSID# %U1 in file %FN.                          */
      645     3930    2           ERR_INSERT.CNT(0) = 7;

   3930  4 002564   007000 236003                    LDQ     3584,DU
         4 002565   000000 552040 xsym               STBQ    ERR_INSERT,'40'O

      646     3931    2           CALL BINCHAR(ERR_INSERT.TEXT(0),USER.SYSID(FILE.USER#));

   3931  4 002566   000000 470400 xsym               LDP0    JRNL$
         4 002567   000001 236100                    LDQ     1,,PR0
         4 002570   000022 772000                    QRL     18
         4 002571   000777 376007                    ANQ     511,DL
         4 002572   000005 402007                    MPY     5,DL
         4 002573   000000 236006 xsym               LDQ     USER,QL
         4 002574   000022 772000                    QRL     18
         4 002575   000000 235003                    LDA     0,DU
         4 002576   002516 757000 0                  STAQ    @BUFNO+1
         4 002577   000000 301400                    BTD
         4 002600   002516 000010 0                  NDSC9   @BUFNO+1                 cn=0,s=lsgnf,sf=0,n=8
         4 002601   000000 230036 xsym               NDSC9   ERR_INSERT               cn=1,s=nosgn,sf=0,n=30

      647     3932    2           ERRCODESF.ERR# = DBU#RKSTO;

   3932  4 002602   000000 236000 xsym               LDQ     ERRCODESF
         4 002603   000010 376000 5                  ANQ     8
         4 002604   216160 276007                    ORQ     72816,DL
         4 002605   000000 756000 xsym               STQ     ERRCODESF

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:127  
      648     3933    2           MSGCODE = ERRCODE_RDEF;

   3933  4 002606   000000 756000 xsym               STQ     MSGCODE

      649     3934    2           CALL SYS_FUNC_ERRMSG;

   3934  4 002607   000011 631400 5                  EPPR1   9
         4 002610   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 002611   000000 011000                    NOP     0

      650     3935    2           ALTRETURN;

   3935  4 002612   000000 221200 0                  LDX1  ! 0
         4 002613   000000 702211                    TSX2  ! 0,X1

      651     3936    2           END;
      652     3937    2       ELSE DO;

      653     3938    2           KEYVSF = ROLLKEY;

   3938  4 002614   000000 100400                    MLR     fill='000'O
         4 002615   002264 000377 0                  ADSC9   ROLLKEY                  cn=0,n=255
         4 002616   000000 000377 xsym               ADSC9   KEYVSF                   cn=0,n=255

      654     3939    2           CALL SYS_FUNC_DELREC ALTRET(ALTRTN);

   3939  4 002617   000011 631400 5                  EPPR1   9
         4 002620   000000 701000 xent               TSX1    SYS_FUNC_DELREC
         4 002621   004172 702000 4                  TSX2    ALTRTN

      655     3940    2           FIDLIST.MOD#(FIDX) = 1;

   3940  4 002622   000000 236000 xsym               LDQ     FIDX
         4 002623   000021 402007                    MPY     17,DL
         4 002624   000000 470400 xsym               LDP0    FID$
         4 002625   000000 620006                    EAX0    0,QL
         4 002626   000015 236106                    LDQ     13,QL,PR0
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:128  
         4 002627   000027 376000 5                  ANQ     23
         4 002630   000001 276007                    ORQ     1,DL
         4 002631   000015 756110                    STQ     13,X0,PR0

      656     3941    2           END;

      657     3942    1       RETURN;

   3942  4 002632   000000 221200 0                  LDX1  ! 0
         4 002633   000001 702211                    TSX2  ! 1,X1

      658     3943        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:129  
      659     3944        /*
      660     3945              FIND   JOURNAL  RECORD  ALTERNATE  KEY
      661     3946        */
      662     3947    1   FIND_KEY: PROC ALTRET;

   3947  4 002634   002464 741200 0     FIND_KEY     STX1  ! PSN+4

      663     3948
      664     3949    2   /**/ COUNTSF = 0;

   3949  4 002635   000000 450000 xsym               STZ     COUNTSF

      665     3950    2       IF DCBADDR(DCBSF)->F$DCB.ORG# = %INDEXED# THEN

   3950  4 002636   000030 470400 5                  LDP0    24
         4 002637   000000 471500                    LDP1    0,,PR0
         4 002640   000000 220000 xsym               LDX0    DCBSF
         4 002641   100000 473510                    LDP3    0,X0,PR1
         4 002642   300032 236100                    LDQ     26,,PR3
         4 002643   777000 376003                    ANQ     -512,DU
         4 002644   006000 116003                    CMPQ    3072,DU
         4 002645   002700 601000 4                  TNZ     s:3961

      666     3951    3       DO;

      667     3952    3           KEY$ = ADDR(JREC.VALUE);

   3952  4 002646   000000 236000 xsym               LDQ     JRNL$
         4 002647   000015 036000 5                  ADLQ    13
         4 002650   000005 756000 0                  STQ     KEY$

      668     3953    3           KEY$ = PINCRC(KEY$,DCBADDR(DCBSF)->F$DCB.KEYX#);

   3953  4 002651   300036 236100                    LDQ     30,,PR3
         4 002652   000022 772000                    QRL     18
         4 002653   000020 736000                    QLS     16
         4 002654   000005 036000 0                  ADLQ    KEY$
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:130  
         4 002655   000005 756000 0                  STQ     KEY$

      669     3954    3           N = DCBADDR(DCBSF) -> F$DCB.KEYL#;

   3954  4 002656   300036 236100                    LDQ     30,,PR3
         4 002657   000011 772000                    QRL     9
         4 002660   000777 376007                    ANQ     511,DL
         4 002661   000006 756000 0                  STQ     N

      670     3955    3           INDXKEY = KEY$ -> STRING;

   3955  4 002662   000005 474400 0                  LDP4    KEY$
         4 002663   000000 622006                    EAX2    0,QL
         4 002664   040000 100540                    MLR     fill='040'O
         4 002665   400000 000012                    ADSC9   0,,PR4                   cn=0,n=*X2
         4 002666   002264 000377 0                  ADSC9   ROLLKEY                  cn=0,n=255

      671     3956    3           BUFLNSF = N - 1;

   3956  4 002667   000006 235000 0                  LDA     N
         4 002670   000001 135007                    SBLA    1,DL
         4 002671   000000 755000 xsym               STA     BUFLNSF

      672     3957    3           INDXKEYSF = INDXKEY;

   3957  4 002672   040000 100400                    MLR     fill='040'O
         4 002673   002264 000377 0                  ADSC9   ROLLKEY                  cn=0,n=255
         4 002674   000000 000377 xsym               ADSC9   KEYVSF                   cn=0,n=255

      673     3958    3           INDEXSF = 1;

   3958  4 002675   000001 236007                    LDQ     1,DL
         4 002676   000000 756000 xsym               STQ     INDEXSF

      674     3959    3           END;

   3959  4 002677   002713 710000 4                  TRA     s:3965
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:131  

      675     3960    3       ELSE DO;

      676     3961    3           ROLLKEY.LEN = JREC.LENGTH;

   3961  4 002700   000000 474400 xsym               LDP4    JRNL$
         4 002701   400003 236100                    LDQ     3,,PR4
         4 002702   000011 736000                    QLS     9
         4 002703   002264 552040 0                  STBQ    ROLLKEY,'40'O

      677     3962    3           ROLLKEY.VAL = JREC.VALUE;

   3962  4 002704   400003 222100                    LDX2    3,,PR4
         4 002705   040000 100540                    MLR     fill='040'O
         4 002706   400004 400012                    ADSC9   4,,PR4                   cn=2,n=*X2
         4 002707   002264 200376 0                  ADSC9   ROLLKEY                  cn=1,n=254

      678     3963    3           KEYVSF = ROLLKEY;

   3963  4 002710   000000 100400                    MLR     fill='000'O
         4 002711   002264 000377 0                  ADSC9   ROLLKEY                  cn=0,n=255
         4 002712   000000 000377 xsym               ADSC9   KEYVSF                   cn=0,n=255

      679     3964    3           END;

      680     3965    2       CALL SYS_FUNC_PREC ALTRET(ALTRTN);

   3965  4 002713   000011 631400 5                  EPPR1   9
         4 002714   000000 701000 xent               TSX1    SYS_FUNC_PREC
         4 002715   002726 702000 4                  TSX2    ALTRTN

      681     3966
      682     3967    2       IF NO_KEYSF = %YES# THEN

   3967  4 002716   000000 234000 xsym               SZN     NO_KEYSF
         4 002717   002722 605000 4                  TPL     s:3970

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:132  
      683     3968    2           FOUND = %NO#;

   3968  4 002720   002364 450000 0                  STZ     FOUND
         4 002721   002724 710000 4                  TRA     s:3971

      684     3969    2       ELSE
      685     3970    2           FOUND= %YES#;

   3970  4 002722   400000 236003                    LDQ     -131072,DU
         4 002723   002364 756000 0                  STQ     FOUND

      686     3971    2       RETURN;

   3971  4 002724   002464 221200 0                  LDX1  ! PSN+4
         4 002725   000001 702211                    TSX2  ! 1,X1

      687     3972    2   ALTRTN:
      688     3973    2       ALTRETURN;

   3973  4 002726   002464 221200 0     ALTRTN       LDX1  ! PSN+4
         4 002727   000000 702211                    TSX2  ! 0,X1

      689     3974    2   END FIND_KEY;
      690     3975        /*
      691     3976              ADJUST  HEADER  INFO  TO REFLECT  CHANGE  AND CHECK CHECKSUM
      692     3977        */
      693     3978    1   BUILD_HEADER: PROC ALTRET;

   3978  4 002730   002465 741200 0     BUILD_HEADER STX1  ! PSN+5

      694     3979
      695     3980        /* TIMESTAMP:
      696     3981              TSTAMPSF = VECTOR(DATA_PG.SYS_WRDS.DATE);
      697     3982              DATESF   = VECTOR(NIL);
      698     3983              SOURCESF = %CLOCK#;
      699     3984              DESTSF   = %UTS#;
      700     3985              CALL SYS_FUNC_TSTAMP;   */
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:133  
      701     3986    2       IF JREC.TYPE = T#MOD THEN

   3986  4 002731   000000 470400 xsym               LDP0    JRNL$
         4 002732   000001 236100                    LDQ     1,,PR0
         4 002733   777000 376003                    ANQ     -512,DU
         4 002734   010000 116003                    CMPQ    4096,DU
         4 002735   003040 600000 4                  TZE     CHK_SUM

      702     3987    2           GOTO CHK_SUM;
      703     3988
      704     3989    2   OFF_LN:
      705     3990         /*    Link deleted line into avail line chain */
      706     3991    2       IF JREC.TYPE = T#DEL THEN

   3991  4 002736   007000 116003       OFF_LN       CMPQ    3584,DU
         4 002737   003025 601000 4                  TNZ     s:4007

      707     3992    3       DO; /* I_O_TAB.HW(OFFSET# 2037) is the first avil line# */

      708     3993    3           I_O_TAB.HW(OFFSET# 2037) = I_O_TAB.HW(OFFSET# 2037) + 131072;

   3993  4 002740   000000 471400 xsym               LDP1    DATA$
         4 002741   100005 220100                    LDX0    5,,PR1
         4 002742   400000 622010                    EAX2    -131072,X0
         4 002743   100005 742100                    STX2    5,,PR1

      709     3994    3           J = I_O_TAB.HW(OFFSET# 2037);

   3994  4 002744   100005 236100                    LDQ     5,,PR1
         4 002745   000022 772000                    QRL     18
         4 002746   000000 756000 xsym               STQ     J

      710     3995    3           X = 2037;

   3995  4 002747   003765 235007                    LDA     2037,DL
         4 002750   000000 755000 xsym               STA     X

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:134  
      711     3996    4           DO WHILE(J > 131072 AND J < 131072 + JREC.LINE);

   3996  4 002751   002763 710000 4                  TRA     s:3999

      712     3997    4               X = J - 131072;

   3997  4 002752   000000 235000 xsym               LDA     J
         4 002753   400000 135007                    SBLA    -131072,DL
         4 002754   000000 755000 xsym               STA     X

      713     3998    4               J = I_O_TAB.HW(OFFSET# X);

   3998  4 002755   000000 531000                    NEG     0
         4 002756   000001 735000                    ALS     1
         4 002757   000000 470400 xsym               LDP0    DATA$
         4 002760   000000 101505                    MRL     fill='000'O
         4 002761   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 002762   000000 000004 xsym               ADSC9   J                        cn=0,n=4

      714     3999    4               END;

   3999  4 002763   000000 235000 xsym               LDA     J
         4 002764   400000 115007                    CMPA    -131072,DL
         4 002765   002774 604400 4                  TMOZ    s:4000
         4 002766   000000 470400 xsym               LDP0    JRNL$
         4 002767   000003 236100                    LDQ     3,,PR0
         4 002770   777777 376007                    ANQ     -1,DL
         4 002771   400000 036007                    ADLQ    -131072,DL
         4 002772   000000 116000 xsym               CMPQ    J
         4 002773   002752 605400 4                  TPNZ    s:3997

      715     4000    3           I_O_TAB.HW(OFFSET# X) = 131072 + JREC.LINE;

   4000  4 002774   000000 470400 xsym               LDP0    JRNL$
         4 002775   000003 236100                    LDQ     3,,PR0
         4 002776   777777 376007                    ANQ     -1,DL
         4 002777   400000 036007                    ADLQ    -131072,DL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:135  
         4 003000   002516 756000 0                  STQ     @BUFNO+1
         4 003001   000000 335000 xsym               LCA     X
         4 003002   000001 735000                    ALS     1
         4 003003   000000 471400 xsym               LDP1    DATA$
         4 003004   000105 101400                    MRL     fill='000'O
         4 003005   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 003006   101777 400002                    ADSC9   1023,A,PR1               cn=2,n=2

      716     4001    3           I_O_TAB.HW(OFFSET# JREC.LINE) = J;

   4001  4 003007   000000 470400 xsym               LDP0    JRNL$
         4 003010   000003 236100                    LDQ     3,,PR0
         4 003011   777777 376007                    ANQ     -1,DL
         4 003012   000001 736000                    QLS     1
         4 003013   000001 676000 5                  ERQ     1
         4 003014   000001 036007                    ADLQ    1,DL
         4 003015   000000 471400 xsym               LDP1    DATA$
         4 003016   000106 101400                    MRL     fill='000'O
         4 003017   000000 000004 xsym               ADSC9   J                        cn=0,n=4
         4 003020   101777 400002                    ADSC9   1023,Q,PR1               cn=2,n=2

      717     4002    3           I_O_TAB.HW(OFFSET# 2037) = I_O_TAB.HW(OFFSET# 2037)-131072;

   4002  4 003021   000000 470400 xsym               LDP0    DATA$
         4 003022   000005 220100                    LDX0    5,,PR0
         4 003023   400000 621010                    EAX1    -131072,X0
         4 003024   000005 741100                    STX1    5,,PR0

      718     4003    3           END;

      719     4004
      720     4005         /*    SET  THE CURRENT HIGHLINE NUMBER */
      721     4006
      722     4007    2       IF JREC.LINE > DATA_PG.OFF_LN.SEC THEN

   4007  4 003025   000000 470400 xsym               LDP0    JRNL$
         4 003026   000003 236100                    LDQ     3,,PR0
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:136  
         4 003027   777777 376007                    ANQ     -1,DL
         4 003030   002516 756000 0                  STQ     @BUFNO+1
         4 003031   000000 471400 xsym               LDP1    DATA$
         4 003032   100005 236100                    LDQ     5,,PR1
         4 003033   777777 376007                    ANQ     -1,DL
         4 003034   002516 116000 0                  CMPQ    @BUFNO+1
         4 003035   003040 605000 4                  TPL     CHK_SUM

      723     4008    2           DATA_PG.OFF_LN.SEC = JREC.LINE;

   4008  4 003036   000003 720100                    LXL0    3,,PR0
         4 003037   100005 440100                    SXL0    5,,PR1

      724     4009
      725     4010    2   CHK_SUM:
      726     4011    2       IF DATA_PG.CHKSUM_WD ~= 0 THEN

   4011  4 003040   000000 471400 xsym  CHK_SUM      LDP1    DATA$
         4 003041   100002 235100                    LDA     2,,PR1
         4 003042   003051 600000 4                  TZE     s:4016

      727     4012    3       DO;

      728     4013    3           CALL CHKSUM; /* BMAP routine rtrns chksum in ICHKSUM */

   4013  4 003043   000011 631400 5                  EPPR1   9
         4 003044   000000 701000 xent               TSX1    CHKSUM
         4 003045   000000 011000                    NOP     0

      729     4014    3           DATA_PG.CHKSUM_WD = ICHKSUM;

   4014  4 003046   000000 470400 xsym               LDP0    DATA$
         4 003047   000000 235000 xsym               LDA     ICHKSUM
         4 003050   000002 755100                    STA     2,,PR0

      730     4015    3           END;

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:137  
      731     4016    2       FIDLIST.MOD#(FIDX) = 1; /* File modified flag */

   4016  4 003051   000000 236000 xsym               LDQ     FIDX
         4 003052   000021 402007                    MPY     17,DL
         4 003053   000000 470400 xsym               LDP0    FID$
         4 003054   000000 620006                    EAX0    0,QL
         4 003055   000015 236106                    LDQ     13,QL,PR0
         4 003056   000027 376000 5                  ANQ     23
         4 003057   000001 276007                    ORQ     1,DL
         4 003060   000015 756110                    STQ     13,X0,PR0

      732     4017    2       RETURN;

   4017  4 003061   002465 221200 0                  LDX1  ! PSN+5
         4 003062   000001 702211                    TSX2  ! 1,X1

      733     4018    2   END BUILD_HEADER;
      734     4019        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:138  
      735     4020        /*
      736     4021                 FILL  IN  ERROR  INFORMATION
      737     4022        */
      738     4023    1   FILL_ERROR_INFO: PROC;

   4023  4 003063   002466 741200 0     FILL_ERROR_* STX1  ! PSN+6

      739     4024
      740     4025    2       CALL BINCHAR(ERR_INSERT.TEXT(0),JREC.PAGE);

   4025  4 003064   000000 470400 xsym               LDP0    JRNL$
         4 003065   000002 235100                    LDA     2,,PR0
         4 003066   000044 773000                    LRL     36
         4 003067   002516 757000 0                  STAQ    @BUFNO+1
         4 003070   000000 301400                    BTD
         4 003071   002516 000010 0                  NDSC9   @BUFNO+1                 cn=0,s=lsgnf,sf=0,n=8
         4 003072   000000 230036 xsym               NDSC9   ERR_INSERT               cn=1,s=nosgn,sf=0,n=30

      741     4026    2       CALL BINCHAR(ERR_INSERT.TEXT(1),JREC.LINE);

   4026  4 003073   000003 236100                    LDQ     3,,PR0
         4 003074   777777 376007                    ANQ     -1,DL
         4 003075   000000 235003                    LDA     0,DU
         4 003076   002516 757000 0                  STAQ    @BUFNO+1
         4 003077   000000 301400                    BTD
         4 003100   002516 000010 0                  NDSC9   @BUFNO+1                 cn=0,s=lsgnf,sf=0,n=8
         4 003101   000010 230036 xsym               NDSC9   ERR_INSERT+8             cn=1,s=nosgn,sf=0,n=30

      742     4027    2       CALL ZERO_SUP(ERR_INSERT.TEXT(0),30,'1'B /* LEFT JUSTIFY */);

   4027  4 003102   000021 630400 5                  EPPR0   17
         4 003103   000005 631400 5                  EPPR1   5
         4 003104   000000 701000 xent               TSX1    ZERO_SUP
         4 003105   000000 011000                    NOP     0

      743     4028    2       CALL ZERO_SUP(ERR_INSERT.TEXT(1),30,'1'B);

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:139  
   4028  4 003106   000024 630400 5                  EPPR0   20
         4 003107   000005 631400 5                  EPPR1   5
         4 003110   000000 701000 xent               TSX1    ZERO_SUP
         4 003111   000000 011000                    NOP     0

      744     4029
      745     4030    2       ERR_INSERT.CNT(0) = 11;

   4030  4 003112   013000 236003                    LDQ     5632,DU
         4 003113   000000 552040 xsym               STBQ    ERR_INSERT,'40'O

      746     4031    2       ERR_INSERT.CNT(1) = 3;

   4031  4 003114   003000 236003                    LDQ     1536,DU
         4 003115   000010 552040 xsym               STBQ    ERR_INSERT+8,'40'O

      747     4032    2       DCBSF = FIDLIST.DCB#(FIDX); /* ERRMSG NEEDS DCB TO GET FILENAME */

   4032  4 003116   000000 236000 xsym               LDQ     FIDX
         4 003117   000021 402007                    MPY     17,DL
         4 003120   000000 470400 xsym               LDP0    FID$
         4 003121   000017 220106                    LDX0    15,QL,PR0
         4 003122   000000 740000 xsym               STX0    DCBSF

      748     4033
      749     4034    2       MSGCODE = ERRCODE_RDEF;

   4034  4 003123   000000 235000 xsym               LDA     ERRCODESF
         4 003124   000000 755000 xsym               STA     MSGCODE

      750     4035
      751     4036    2       RETURN;

   4036  4 003125   002466 221200 0                  LDX1  ! PSN+6
         4 003126   000001 702211                    TSX2  ! 1,X1

      752     4037    2   END FILL_ERROR_INFO;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:140  
      753     4038        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:141  
      754     4039        /*
      755     4040                     READ   AND   WRITE   ROUTINES
      756     4041        */
      757     4042    1   READ_PAGE: PROC ALTRET;

   4042  4 003127   002467 741200 0     READ_PAGE    STX1  ! PSN+7

      758     4043
      759     4044    2   DCL CURR_FIDX SBIN WORD STATIC INIT(0);
      760     4045    2   DCL CURR_PAGE UBIN WORD STATIC INIT(0);
      761     4046
      762     4047
      763     4048    2       CALL FIND_BUF(FIDX,JREC.PAGE,BUFNO);

   4048  4 003130   000032 236000 5                  LDQ     26
         4 003131   002477 756000 0                  STQ     @PGNO+1
         4 003132   000000 236000 xsym               LDQ     JRNL$
         4 003133   000002 036003                    ADLQ    2,DU
         4 003134   002476 756000 0                  STQ     @FIDX+1
         4 003135   000004 236000 5                  LDQ     4
         4 003136   002475 756000 0                  STQ     @BUFNO+2
         4 003137   003412 701000 4                  TSX1    FIND_BUF
         4 003140   000000 011000                    NOP     0

      764     4049    2       IF BUFNO ~= -1 THEN /* page is already in memory */

   4049  4 003141   002257 235000 0                  LDA     BUFNO
         4 003142   000001 115000 5                  CMPA    1
         4 003143   003155 600000 4                  TZE     s:4056

      765     4050    3       DO;

      766     4051    3           DATA$ = BUFTBL.PTR$(BUFNO);

   4051  4 003144   000002 735000                    ALS     2
         4 003145   000015 236005 0                  LDQ     BUFTBL,AL
         4 003146   000000 756000 xsym               STQ     DATA$
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:142  

      767     4052    3           CALL QUE_BUF_LAST(BUFNO);

   4052  4 003147   000032 236000 5                  LDQ     26
         4 003150   002501 756000 0                  STQ     @BUFNO+2
         4 003151   003525 701000 4                  TSX1    QUE_BUF_LAST
         4 003152   000000 011000                    NOP     0

      768     4053    3           RETURN;

   4053  4 003153   002467 221200 0                  LDX1  ! PSN+7
         4 003154   000001 702211                    TSX2  ! 1,X1

      769     4054    3           END;
      770     4055    3       ELSE DO;

      771     4056    3           CALL GET_BUF(FIDX,JREC.PAGE,BUFNO) ALTRET(ALTREAD);

   4056  4 003155   000032 236000 5                  LDQ     26
         4 003156   002505 756000 0                  STQ     @PGNO+1
         4 003157   000000 236000 xsym               LDQ     JRNL$
         4 003160   000002 036003                    ADLQ    2,DU
         4 003161   002504 756000 0                  STQ     @FIDX+1
         4 003162   000004 236000 5                  LDQ     4
         4 003163   002503 756000 0                  STQ     @BUFNO+2
         4 003164   003643 701000 4                  TSX1    GET_BUF
         4 003165   003275 702000 4                  TSX2    ALTREAD

      772     4057    3           IF FIDLIST.DCB#(FIDX) = 0 THEN

   4057  4 003166   000000 236000 xsym               LDQ     FIDX
         4 003167   000021 402007                    MPY     17,DL
         4 003170   000000 470400 xsym               LDP0    FID$
         4 003171   000017 220106                    LDX0    15,QL,PR0
         4 003172   003206 601000 4                  TNZ     s:4064

      773     4058    4           DO;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:143  

      774     4059    4               CALL ASSOC_DCB(FIDX);

   4059  4 003173   000004 630400 5                  EPPR0   4
         4 003174   000003 631400 5                  EPPR1   3
         4 003175   000000 701000 xent               TSX1    ASSOC_DCB
         4 003176   000000 011000                    NOP     0

      775     4060    4               CALL QUE_UP(FIDX);

   4060  4 003177   000004 630400 5                  EPPR0   4
         4 003200   000003 631400 5                  EPPR1   3
         4 003201   000000 701000 xent               TSX1    QUE_UP
         4 003202   000000 011000                    NOP     0

      776     4061    4               CALL OPEN_FID;

   4061  4 003203   000011 631400 5                  EPPR1   9
         4 003204   000000 701000 xent               TSX1    OPEN_FID
         4 003205   000000 011000                    NOP     0

      777     4062    4               END;

      778     4063
      779     4064    4           DO WHILE(BUFTBL.BUSY(BUFNO) = %YES#);

   4064  4 003206   002257 235000 0                  LDA     BUFNO
         4 003207   000002 735000                    ALS     2
         4 003210   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 003211   000400 316007                    CANQ    256,DL
         4 003212   003220 600000 4                  TZE     s:4070

      780     4065         /* We will wait in this loop until the last i/o on this
      781     4066            buffer has completed at which time the event will wake
      782     4067            up ZIU$EVENT and the busy bit will be reset.
      783     4068         */
      784     4069    4               END;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:144  

   4069  4 003213   002257 235000 0                  LDA     BUFNO
         4 003214   000002 735000                    ALS     2
         4 003215   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 003216   000400 316007                    CANQ    256,DL
         4 003217   003213 601000 4                  TNZ     s:4069

      785     4070    3    /**/   DCBSF = FIDLIST.DCB#(FIDX);

   4070  4 003220   000000 236000 xsym               LDQ     FIDX
         4 003221   000021 402007                    MPY     17,DL
         4 003222   000000 470400 xsym               LDP0    FID$
         4 003223   000017 220106                    LDX0    15,QL,PR0
         4 003224   000000 740000 xsym               STX0    DCBSF

      786     4071    3    /**/   BUFSF = VECTOR(BUFTBL.PTR$(BUFNO) -> BUFER);

   4071  4 003225   002257 235000 0                  LDA     BUFNO
         4 003226   000002 735000                    ALS     2
         4 003227   000015 471405 0                  LDP1    BUFTBL,AL
         4 003230   000033 235000 5                  LDA     27
         4 003231   002516 451400 0                  STP1    @BUFNO+1
         4 003232   002516 236000 0                  LDQ     @BUFNO+1
         4 003233   000000 755000 xsym               STA     BUFSF
         4 003234   000001 756000 xsym               STQ     BUFSF+1

      787     4072    3    /**/   KEYSF = %YES#;

   4072  4 003235   400000 236003                    LDQ     -131072,DU
         4 003236   000000 756000 xsym               STQ     KEYSF

      788     4073    3    /**/   BUFLNSF = 4096;

   4073  4 003237   010000 235007                    LDA     4096,DL
         4 003240   000000 755000 xsym               STA     BUFLNSF

      789     4074    3    /**/   ENCRP_SEEDSF = FIDLIST.CRPT_B(FIDX);
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:145  

   4074  4 003241   000000 236000 xsym               LDQ     FIDX
         4 003242   000021 402007                    MPY     17,DL
         4 003243   000016 236106                    LDQ     14,QL,PR0
         4 003244   000000 756000 xsym               STQ     ENCRP_SEEDSF

      790     4075    3    /**/   FULLSF = %YES#;

   4075  4 003245   400000 236003                    LDQ     -131072,DU
         4 003246   000000 756000 xsym               STQ     FULLSF

      791     4076    3    /**/   KEYVSF.IDSKEY = JREC.PAGE;

   4076  4 003247   000000 471400 xsym               LDP1    JRNL$
         4 003250   000000 100500                    MLR     fill='000'O
         4 003251   100002 000004                    ADSC9   2,,PR1                   cn=0,n=4
         4 003252   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      792     4077    3    /**/   WAITSF = %YES#;

   4077  4 003253   000000 756000 xsym               STQ     WAITSF

      793     4078    3           CALL SYS_FUNC_READ ALTRET(ALTREAD);

   4078  4 003254   000011 631400 5                  EPPR1   9
         4 003255   000000 701000 xent               TSX1    SYS_FUNC_READ
         4 003256   003275 702000 4                  TSX2    ALTREAD

      794     4079    3           DATA$ = BUFTBL.PTR$(BUFNO);

   4079  4 003257   002257 235000 0                  LDA     BUFNO
         4 003260   000002 735000                    ALS     2
         4 003261   000015 236005 0                  LDQ     BUFTBL,AL
         4 003262   000000 756000 xsym               STQ     DATA$

      795     4080    3           CALL QUE_BUF_LAST(BUFNO); /* Que as most recently used BUFFER */

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:146  
   4080  4 003263   000032 236000 5                  LDQ     26
         4 003264   002501 756000 0                  STQ     @BUFNO+2
         4 003265   003525 701000 4                  TSX1    QUE_BUF_LAST
         4 003266   000000 011000                    NOP     0

      796     4081    3           CALL QUE_LAST(FIDX); /* Put this file in as most recently used

   4081  4 003267   000004 630400 5                  EPPR0   4
         4 003270   000003 631400 5                  EPPR1   3
         4 003271   000000 701000 xent               TSX1    QUE_LAST
         4 003272   000000 011000                    NOP     0

      797     4082         in the DCB QUE. */
      798     4083    3           RETURN;

   4083  4 003273   002467 221200 0                  LDX1  ! PSN+7
         4 003274   000001 702211                    TSX2  ! 1,X1

      799     4084    3           END;
      800     4085
      801     4086    2   ALTREAD:
      802     4087    2       ALTRETURN;

   4087  4 003275   002467 221200 0     ALTREAD      LDX1  ! PSN+7
         4 003276   000000 702211                    TSX2  ! 0,X1

      803     4088    2   END READ_PAGE;
      804     4089        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:147  
      805     4090    1   WRITE_PAGE: PROC(BUFNO) ALTRET;

   4090  4 003277   002472 741200 0     WRITE_PAGE   STX1  ! CURR_PAGE+1

      806     4091    2   DCL BUFNO SBIN;
      807     4092
      808     4093    2   /**/ DCBSF = FIDLIST.DCB#(BUFTBL.FIDX(BUFNO));

   4093  4 003300   002473 470400 0                  LDP0    @BUFNO
         4 003301   000000 235100                    LDA     0,,PR0
         4 003302   000001 735000                    ALS     1
         4 003303   000001 735000                    ALS     1
         4 003304   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 003305   000022 732000                    QRS     18
         4 003306   000021 402007                    MPY     17,DL
         4 003307   000000 471400 xsym               LDP1    FID$
         4 003310   100017 220106                    LDX0    15,QL,PR1
         4 003311   000000 740000 xsym               STX0    DCBSF

      809     4094    2       IF DCBSF = 0 THEN

   4094  4 003312   003340 601000 4                  TNZ     s:4104

      810     4095    3       DO; /* Get a dcb to use for this write */

      811     4096    3           FIDREM = FIDX;

   4096  4 003313   000000 235000 xsym               LDA     FIDX
         4 003314   002261 755000 0                  STA     FIDREM

      812     4097    3           FIDX = BUFTBL.FIDX(BUFNO); /* This is the fid num to write */

   4097  4 003315   000000 235100                    LDA     0,,PR0
         4 003316   000001 735000                    ALS     1
         4 003317   000001 735000                    ALS     1
         4 003320   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 003321   000022 732000                    QRS     18
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:148  
         4 003322   000000 756000 xsym               STQ     FIDX

      813     4098    3           CALL ASSOC_DCB(FIDX);

   4098  4 003323   000004 630400 5                  EPPR0   4
         4 003324   000003 631400 5                  EPPR1   3
         4 003325   000000 701000 xent               TSX1    ASSOC_DCB
         4 003326   000000 011000                    NOP     0

      814     4099    3           CALL QUE_UP(FIDX);

   4099  4 003327   000004 630400 5                  EPPR0   4
         4 003330   000003 631400 5                  EPPR1   3
         4 003331   000000 701000 xent               TSX1    QUE_UP
         4 003332   000000 011000                    NOP     0

      815     4100    3           CALL OPEN_FID;

   4100  4 003333   000011 631400 5                  EPPR1   9
         4 003334   000000 701000 xent               TSX1    OPEN_FID
         4 003335   000000 011000                    NOP     0

      816     4101    3           FIDX = FIDREM;

   4101  4 003336   002261 235000 0                  LDA     FIDREM
         4 003337   000000 755000 xsym               STA     FIDX

      817     4102    3           END;

      818     4103
      819     4104    2   /**/ BUFSF = VECTOR(BUFTBL.PTR$(BUFNO) -> BUFER);

   4104  4 003340   002473 470400 0                  LDP0    @BUFNO
         4 003341   000000 235100                    LDA     0,,PR0
         4 003342   000001 735000                    ALS     1
         4 003343   000001 735000                    ALS     1
         4 003344   000015 471405 0                  LDP1    BUFTBL,AL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:149  
         4 003345   000033 235000 5                  LDA     27
         4 003346   002516 451400 0                  STP1    @BUFNO+1
         4 003347   002516 236000 0                  LDQ     @BUFNO+1
         4 003350   000000 755000 xsym               STA     BUFSF
         4 003351   000001 756000 xsym               STQ     BUFSF+1

      820     4105    2   /**/ BUFLNSF = 4096;

   4105  4 003352   010000 235007                    LDA     4096,DL
         4 003353   000000 755000 xsym               STA     BUFLNSF

      821     4106    2   /**/ VFCSF = %NO#;

   4106  4 003354   000000 450000 xsym               STZ     VFCSF

      822     4107    2   /**/ ENCRP_SEEDSF = FIDLIST.CRPT_B(FIDX);

   4107  4 003355   000000 236000 xsym               LDQ     FIDX
         4 003356   000021 402007                    MPY     17,DL
         4 003357   000000 471400 xsym               LDP1    FID$
         4 003360   100016 236106                    LDQ     14,QL,PR1
         4 003361   000000 756000 xsym               STQ     ENCRP_SEEDSF

      823     4108    2   /**/ KEYVSF.IDSKEY = BUFTBL.PGNO(BUFNO);

   4108  4 003362   000000 235100                    LDA     0,,PR0
         4 003363   000001 735000                    ALS     1
         4 003364   000001 735000                    ALS     1
         4 003365   000002 735000                    ALS     2
         4 003366   000000 100405                    MLR     fill='000'O
         4 003367   000016 000004 0                  ADSC9   BUFTBL+1,A               cn=0,n=4
         4 003370   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      824     4109    2   /**/ WAITSF = %NO#; /* No wait write */

   4109  4 003371   000000 450000 xsym               STZ     WAITSF

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:150  
      825     4110    2   /**/ EVENTSF = BUFNO; /* Let the bufno be event number of I/O */

   4110  4 003372   000000 235100                    LDA     0,,PR0
         4 003373   000000 755000 xsym               STA     COUNTSF

      826     4111    2       BUFTBL.BUSY(BUFNO) = %YES#; /* Buffer is busy during I/O */

   4111  4 003374   000000 235100                    LDA     0,,PR0
         4 003375   000001 735000                    ALS     1
         4 003376   000001 735000                    ALS     1
         4 003377   000400 236007                    LDQ     256,DL
         4 003400   000017 256005 0                  ORSQ    BUFTBL+2,AL

      827     4112    2   /**/ FULLSF = %YES#;

   4112  4 003401   400000 236003                    LDQ     -131072,DU
         4 003402   000000 756000 xsym               STQ     FULLSF

      828     4113    2       CALL SYS_FUNC_WRIT ALTRET(ALTWRIT);

   4113  4 003403   000011 631400 5                  EPPR1   9
         4 003404   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 003405   003410 702000 4                  TSX2    ALTWRIT

      829     4114    2       RETURN;

   4114  4 003406   002472 221200 0                  LDX1  ! CURR_PAGE+1
         4 003407   000001 702211                    TSX2  ! 1,X1

      830     4115
      831     4116    2   ALTWRIT:
      832     4117    2       ALTRETURN;

   4117  4 003410   002472 221200 0     ALTWRIT      LDX1  ! CURR_PAGE+1
         4 003411   000000 702211                    TSX2  ! 0,X1

      833     4118    2   END WRITE_PAGE;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:151  
      834     4119        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:152  
      835     4120        /*
      836     4121               THE following procedures are routines used to keep track
      837     4122           of the buffers used for I/O. The buffer table can keep track
      838     4123           of up to 255 buffers. Each buffer may be hashed to using the
      839     4124            page number and index of the fid in the fid table that the
      840     4125           buffer is to contain.
      841     4126        */
      842     4127    1   FIND_BUF: PROC(FIDX,PGNO,BUFNO); /* Find buffer by hashing */

   4127  4 003412   002474 741200 0     FIND_BUF     STX1  ! @BUFNO+1

      843     4128    2   DCL FIDX SBIN;
      844     4129    2   DCL PGNO UBIN;
      845     4130    2   DCL BUFNO SBIN;
      846     4131
      847     4132    2       HSHINDX = HASH_ALGORITHM;

   4132  4 003413   002475 470400 0                  LDP0    @FIDX
         4 003414   002476 471400 0                  LDP1    @PGNO
         4 003415   000000 236100                    LDQ     0,,PR0
         4 003416   100000 402100                    MPY     0,,PR1
         4 003417   002256 506000 0                  DIV     NHSHBUFS
         4 003420   002252 755000 0                  STA     HSHINDX

      848     4133    2       BUFNO = HSHBUF(HSHINDX);

   4133  4 003421   000001 735000                    ALS     1
         4 003422   000000 100405                    MLR     fill='000'O
         4 003423   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2
         4 003424   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 003425   002516 236000 0                  LDQ     @BUFNO+1
         4 003426   000022 732000                    QRS     18
         4 003427   002477 473400 0                  LDP3    @BUFNO
         4 003430   300000 756100                    STQ     0,,PR3

      849     4134    2       IF HSHBUF(HSHINDX) = -1 THEN

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:153  
   4134  4 003431   000000 100405                    MLR     fill='000'O
         4 003432   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2
         4 003433   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 003434   002516 236000 0                  LDQ     @BUFNO+1
         4 003435   000022 732000                    QRS     18
         4 003436   000001 116000 5                  CMPQ    1
         4 003437   003442 601000 4                  TNZ     s:4137

      850     4135    2           RETURN; /* PAGE IS NOT IN MEMORY */

   4135  4 003440   002474 221200 0                  LDX1  ! @BUFNO+1
         4 003441   000001 702211                    TSX2  ! 1,X1

      851     4136
      852     4137    2       BUFNO = HSHBUF(HSHINDX);

   4137  4 003442   000000 100405                    MLR     fill='000'O
         4 003443   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2
         4 003444   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 003445   002516 236000 0                  LDQ     @BUFNO+1
         4 003446   000022 732000                    QRS     18
         4 003447   300000 756100                    STQ     0,,PR3

      853     4138    2       IF BUFTBL.FIDX(BUFNO)~=FIDX OR

   4138  4 003450   300000 235100                    LDA     0,,PR3
         4 003451   000001 735000                    ALS     1
         4 003452   000001 735000                    ALS     1
         4 003453   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 003454   000022 732000                    QRS     18
         4 003455   000000 116100                    CMPQ    0,,PR0
         4 003456   003465 601000 4                  TNZ     s:4141
         4 003457   300000 235100                    LDA     0,,PR3
         4 003460   000001 735000                    ALS     1
         4 003461   000001 735000                    ALS     1
         4 003462   000016 236005 0                  LDQ     BUFTBL+1,AL
         4 003463   100000 116100                    CMPQ    0,,PR1
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:154  
         4 003464   003523 600000 4                  TZE     s:4148

      854     4139    2          BUFTBL.PGNO(BUFNO)~=PGNO THEN /* NOT DIRECT HIT */
      855     4140    3       DO; /* SEARCH FOR THE PAGE UNTIL FOUND OR END OF CHAIN */

      856     4141    3           HSHINDX = BUFTBL.NXTHSH(BUFNO);

   4141  4 003465   300000 235100                    LDA     0,,PR3
         4 003466   000001 735000                    ALS     1
         4 003467   000001 735000                    ALS     1
         4 003470   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 003471   000022 736000                    QLS     18
         4 003472   000033 732000                    QRS     27
         4 003473   002252 756000 0                  STQ     HSHINDX

      857     4142    4           DO WHILE(HSHINDX ~= -1 AND (BUFTBL.FIDX(HSHINDX) ~= FIDX OR

   4142  4 003474   003503 710000 4                  TRA     s:4145

      858     4143    4              BUFTBL.PGNO(HSHINDX) ~= PGNO));
      859     4144    4               HSHINDX = BUFTBL.NXTHSH(HSHINDX);

   4144  4 003475   002252 235000 0                  LDA     HSHINDX
         4 003476   000002 735000                    ALS     2
         4 003477   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 003500   000022 736000                    QLS     18
         4 003501   000033 732000                    QRS     27
         4 003502   002252 756000 0                  STQ     HSHINDX

      860     4145    4               END;

   4145  4 003503   000001 116000 5                  CMPQ    1
         4 003504   003520 600000 4                  TZE     s:4146
         4 003505   002475 470400 0                  LDP0    @FIDX
         4 003506   002252 235000 0                  LDA     HSHINDX
         4 003507   000002 735000                    ALS     2
         4 003510   000017 236005 0                  LDQ     BUFTBL+2,AL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:155  
         4 003511   000022 732000                    QRS     18
         4 003512   000000 116100                    CMPQ    0,,PR0
         4 003513   003475 601000 4                  TNZ     s:4144
         4 003514   002476 471400 0                  LDP1    @PGNO
         4 003515   000016 236005 0                  LDQ     BUFTBL+1,AL
         4 003516   100000 116100                    CMPQ    0,,PR1
         4 003517   003475 601000 4                  TNZ     s:4144

      861     4146    3           BUFNO = HSHINDX; /* RETURN WITH PAGE FOUND OR A -1 */

   4146  4 003520   002477 470400 0                  LDP0    @BUFNO
         4 003521   002252 235000 0                  LDA     HSHINDX
         4 003522   000000 755100                    STA     0,,PR0

      862     4147    3           END;

      863     4148    2       RETURN;

   4148  4 003523   002474 221200 0                  LDX1  ! @BUFNO+1
         4 003524   000001 702211                    TSX2  ! 1,X1

      864     4149    2   END FIND_BUF;
      865     4150        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:156  
      866     4151        /*
      867     4152              QUE BUFFER AS LAST USED  ie THE MOST RECENTLY USED.
      868     4153        */
      869     4154    1   QUE_BUF_LAST: PROC(BUFNO);

   4154  4 003525   002500 741200 0     QUE_BUF_LAST STX1  ! @BUFNO+1

      870     4155    2   DCL BUFNO SBIN;
      871     4156
      872     4157    2       LASTBUF = BUFTBL.Q.PRI(0);

   4157  4 003526   000020 235000 0                  LDA     BUFTBL+3
         4 003527   000022 731000                    ARS     18
         4 003530   002255 755000 0                  STA     LASTBUF

      873     4158    2       FIRSTBUF= BUFTBL.Q.NXT(0);

   4158  4 003531   000020 236000 0                  LDQ     BUFTBL+3
         4 003532   000022 736000                    QLS     18
         4 003533   000022 732000                    QRS     18
         4 003534   002254 756000 0                  STQ     FIRSTBUF

      874     4159
      875     4160    2       IF LASTBUF = BUFNO THEN

   4160  4 003535   002501 470400 0                  LDP0    @BUFNO
         4 003536   002255 236000 0                  LDQ     LASTBUF
         4 003537   000000 116100                    CMPQ    0,,PR0
         4 003540   003542 601000 4                  TNZ     s:4162

      876     4161    2           RETURN; /* Buffer already queued last */

   4161  4 003541   000001 702211                    TSX2  ! 1,X1

      877     4162    2       IF BUFTBL.Q.NXT(BUFNO) = -1 THEN

   4162  4 003542   000000 235100                    LDA     0,,PR0
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:157  
         4 003543   000001 735000                    ALS     1
         4 003544   000001 735000                    ALS     1
         4 003545   000020 720005 0                  LXL0    BUFTBL+3,AL
         4 003546   777777 100003                    CMPX0   -1,DU
         4 003547   003571 601000 4                  TNZ     s:4170

      878     4163    3       DO; /* Enter buffer into the queue (last) */

      879     4164    3           BUFTBL.Q.NXT(BUFNO) = 0;

   4164  4 003550   000000 235100                    LDA     0,,PR0
         4 003551   000001 735000                    ALS     1
         4 003552   000001 735000                    ALS     1
         4 003553   000000 220003                    LDX0    0,DU
         4 003554   000020 440005 0                  SXL0    BUFTBL+3,AL

      880     4165    3           BUFTBL.Q.PRI(BUFNO) = LASTBUF;

   4165  4 003555   000000 235100                    LDA     0,,PR0
         4 003556   000001 735000                    ALS     1
         4 003557   000001 735000                    ALS     1
         4 003560   000000 621006                    EAX1    0,QL
         4 003561   000020 741005 0                  STX1    BUFTBL+3,AL

      881     4166    3           BUFTBL.Q.PRI(0) = BUFNO;

   4166  4 003562   000000 721100                    LXL1    0,,PR0
         4 003563   000020 741000 0                  STX1    BUFTBL+3

      882     4167    3           BUFTBL.Q.NXT(LASTBUF) = BUFNO;

   4167  4 003564   002255 235000 0                  LDA     LASTBUF
         4 003565   000002 735000                    ALS     2
         4 003566   000000 722100                    LXL2    0,,PR0
         4 003567   000020 442005 0                  SXL2    BUFTBL+3,AL

      883     4168    3           END;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:158  

   4168  4 003570   003641 710000 4                  TRA     s:4177

      884     4169    3       ELSE DO; /* RE-QUEUE buffer into the last position */

      885     4170    3           BUFTBL.Q.PRI(BUFTBL.Q.NXT(BUFNO)) = BUFTBL.Q.PRI(BUFNO);

   4170  4 003571   000000 235100                    LDA     0,,PR0
         4 003572   000001 735000                    ALS     1
         4 003573   000001 735000                    ALS     1
         4 003574   000020 236005 0                  LDQ     BUFTBL+3,AL
         4 003575   000022 736000                    QLS     18
         4 003576   000021 732000                    QRS     17
         4 003577   000001 736000                    QLS     1
         4 003600   000000 235100                    LDA     0,,PR0
         4 003601   000001 735000                    ALS     1
         4 003602   000001 735000                    ALS     1
         4 003603   000020 220005 0                  LDX0    BUFTBL+3,AL
         4 003604   000020 740006 0                  STX0    BUFTBL+3,QL

      886     4171    3           BUFTBL.Q.NXT(BUFTBL.Q.PRI(BUFNO)) = BUFTBL.Q.NXT(BUFNO);

   4171  4 003605   000000 235100                    LDA     0,,PR0
         4 003606   000001 735000                    ALS     1
         4 003607   000001 735000                    ALS     1
         4 003610   000020 236005 0                  LDQ     BUFTBL+3,AL
         4 003611   000021 732000                    QRS     17
         4 003612   000034 376000 5                  ANQ     28
         4 003613   000001 736000                    QLS     1
         4 003614   000000 235100                    LDA     0,,PR0
         4 003615   000001 735000                    ALS     1
         4 003616   000001 735000                    ALS     1
         4 003617   000020 720005 0                  LXL0    BUFTBL+3,AL
         4 003620   000020 440006 0                  SXL0    BUFTBL+3,QL

      887     4172    3           BUFTBL.Q.PRI(BUFNO) = LASTBUF;

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:159  
   4172  4 003621   000000 235100                    LDA     0,,PR0
         4 003622   000001 735000                    ALS     1
         4 003623   000001 735000                    ALS     1
         4 003624   002255 720000 0                  LXL0    LASTBUF
         4 003625   000020 740005 0                  STX0    BUFTBL+3,AL

      888     4173    3           BUFTBL.Q.NXT(BUFNO) = 0;

   4173  4 003626   000000 235100                    LDA     0,,PR0
         4 003627   000001 735000                    ALS     1
         4 003630   000001 735000                    ALS     1
         4 003631   000000 221003                    LDX1    0,DU
         4 003632   000020 441005 0                  SXL1    BUFTBL+3,AL

      889     4174    3           BUFTBL.Q.NXT(LASTBUF) = BUFNO;

   4174  4 003633   002255 235000 0                  LDA     LASTBUF
         4 003634   000002 735000                    ALS     2
         4 003635   000000 722100                    LXL2    0,,PR0
         4 003636   000020 442005 0                  SXL2    BUFTBL+3,AL

      890     4175    3           BUFTBL.Q.PRI(0) = BUFNO;

   4175  4 003637   000000 723100                    LXL3    0,,PR0
         4 003640   000020 743000 0                  STX3    BUFTBL+3

      891     4176    3           END;

      892     4177    2       RETURN;

   4177  4 003641   002500 221200 0                  LDX1  ! @BUFNO+1
         4 003642   000001 702211                    TSX2  ! 1,X1

      893     4178    2   END QUE_BUF_LAST;
      894     4179        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:160  
      895     4180        /*
      896     4181                 ALLOCATE A BUFFER TO THE REQUESTING CALLER
      897     4182        */
      898     4183    1   GET_BUF: PROC(FIDX,PGNO,BUFNO) ALTRET;

   4183  4 003643   002502 741200 0     GET_BUF      STX1  ! @BUFNO+1

      899     4184    2   DCL FIDX SBIN;
      900     4185    2   DCL PGNO UBIN;
      901     4186    2   DCL BUFNO SBIN;
      902     4187
      903     4188        /* If there are any buffers yet unused then allocate one of then */
      904     4189    2       IF CURR_BUF_CNT <= USABLE_BUFS-1 THEN

   4189  4 003644   002015 236000 0                  LDQ     CURR_BUF_CNT
         4 003645   002260 116000 0                  CMPQ    USABLE_BUFS
         4 003646   003700 605000 4                  TPL     s:4199

      905     4190    3       DO;

      906     4191    3           BUFNO = CURR_BUF_CNT;

   4191  4 003647   002505 470400 0                  LDP0    @BUFNO
         4 003650   000000 756100                    STQ     0,,PR0

      907     4192    3           BUFTBL.FIDX(BUFNO) = FIDX;

   4192  4 003651   000000 235100                    LDA     0,,PR0
         4 003652   000001 735000                    ALS     1
         4 003653   000001 735000                    ALS     1
         4 003654   002503 471400 0                  LDP1    @FIDX
         4 003655   100000 720100                    LXL0    0,,PR1
         4 003656   000017 740005 0                  STX0    BUFTBL+2,AL

      908     4193    3           BUFTBL.PGNO(BUFNO) = PGNO;

   4193  4 003657   000000 235100                    LDA     0,,PR0
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:161  
         4 003660   000001 735000                    ALS     1
         4 003661   000001 735000                    ALS     1
         4 003662   002504 473400 0                  LDP3    @PGNO
         4 003663   000000 620005                    EAX0    0,AL
         4 003664   300000 235100                    LDA     0,,PR3
         4 003665   000016 755010 0                  STA     BUFTBL+1,X0

      909     4194    3           CALL ENTER_BUF(FIDX,PGNO,BUFNO); /* Place buffer in hash tbl */

   4194  4 003666   002504 237000 0                  LDAQ    @PGNO
         4 003667   002510 757000 0                  STAQ    @FIDX+1
         4 003670   002503 236000 0                  LDQ     @FIDX
         4 003671   002507 756000 0                  STQ     @BUFNO+2
         4 003672   003763 701000 4                  TSX1    ENTER_BUF
         4 003673   000000 011000                    NOP     0

      910     4195    3           CURR_BUF_CNT = CURR_BUF_CNT + 1;

   4195  4 003674   002015 054000 0                  AOS     CURR_BUF_CNT

      911     4196    3           NXT_AVAIL_BUF = CURR_BUF_CNT;

   4196  4 003675   002015 235000 0                  LDA     CURR_BUF_CNT
         4 003676   002263 755000 0                  STA     NXT_AVAIL_BUF

      912     4197    3           END;

   4197  4 003677   003757 710000 4                  TRA     s:4211

      913     4198    3       ELSE DO; /* Else release buffer least recently used */

      914     4199    3           BUFNO = NXT_AVAIL_BUF;

   4199  4 003700   002505 470400 0                  LDP0    @BUFNO
         4 003701   002263 235000 0                  LDA     NXT_AVAIL_BUF
         4 003702   000000 755100                    STA     0,,PR0

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:162  
      915     4200    3           BUFTBL.FIDX(BUFNO) = FIDX;

   4200  4 003703   000000 235100                    LDA     0,,PR0
         4 003704   000001 735000                    ALS     1
         4 003705   000001 735000                    ALS     1
         4 003706   002503 471400 0                  LDP1    @FIDX
         4 003707   100000 720100                    LXL0    0,,PR1
         4 003710   000017 740005 0                  STX0    BUFTBL+2,AL

      916     4201    3           BUFTBL.PGNO(BUFNO) = PGNO;

   4201  4 003711   000000 235100                    LDA     0,,PR0
         4 003712   000001 735000                    ALS     1
         4 003713   000001 735000                    ALS     1
         4 003714   002504 473400 0                  LDP3    @PGNO
         4 003715   000000 620005                    EAX0    0,AL
         4 003716   300000 235100                    LDA     0,,PR3
         4 003717   000016 755010 0                  STA     BUFTBL+1,X0

      917     4202    3           CALL ENTER_BUF(FIDX,PGNO,BUFNO); /* Enter in new hash indx */

   4202  4 003720   002504 237000 0                  LDAQ    @PGNO
         4 003721   002510 757000 0                  STAQ    @FIDX+1
         4 003722   002503 236000 0                  LDQ     @FIDX
         4 003723   002507 756000 0                  STQ     @BUFNO+2
         4 003724   003763 701000 4                  TSX1    ENTER_BUF
         4 003725   000000 011000                    NOP     0

      918     4203    3           CALL QUE_BUF_LAST(BUFNO);

   4203  4 003726   002505 236000 0                  LDQ     @BUFNO
         4 003727   002501 756000 0                  STQ     @BUFNO
         4 003730   003525 701000 4                  TSX1    QUE_BUF_LAST
         4 003731   000000 011000                    NOP     0

      919     4204         /*  Assign a new next available */
      920     4205    3           NXT_AVAIL_BUF = BUFTBL.Q.NXT(0); /* Least recently used */
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:163  

   4205  4 003732   000020 236000 0                  LDQ     BUFTBL+3
         4 003733   000022 736000                    QLS     18
         4 003734   000022 732000                    QRS     18
         4 003735   002263 756000 0                  STQ     NXT_AVAIL_BUF

      921     4206    3           FIDREM = BUFTBL.FIDX(NXT_AVAIL_BUF);

   4206  4 003736   002263 235000 0                  LDA     NXT_AVAIL_BUF
         4 003737   000002 735000                    ALS     2
         4 003740   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 003741   000022 732000                    QRS     18
         4 003742   002261 756000 0                  STQ     FIDREM

      922     4207    3           PGREM = BUFTBL.PGNO(NXT_AVAIL_BUF);

   4207  4 003743   000016 235005 0                  LDA     BUFTBL+1,AL
         4 003744   002262 755000 0                  STA     PGREM

      923     4208    3           CALL REMOVE_BUF(FIDREM,PGREM,NXT_AVAIL_BUF); /* Remove from old HASH */

   4208  4 003745   000036 237000 5                  LDAQ    30
         4 003746   002514 757000 0                  STAQ    @FIDX+1
         4 003747   000035 236000 5                  LDQ     29
         4 003750   002513 756000 0                  STQ     @BUFNO+2
         4 003751   004050 701000 4                  TSX1    REMOVE_BUF
         4 003752   000000 011000                    NOP     0

      924     4209    3           CALL WRITE_PAGE(NXT_AVAIL_BUF) ALTRET(ALTRTN);

   4209  4 003753   000037 236000 5                  LDQ     31
         4 003754   002473 756000 0                  STQ     @BUFNO
         4 003755   003277 701000 4                  TSX1    WRITE_PAGE
         4 003756   003761 702000 4                  TSX2    ALTRTN

      925     4210    3           END;

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:164  
      926     4211    2       RETURN;

   4211  4 003757   002502 221200 0                  LDX1  ! @BUFNO+1
         4 003760   000001 702211                    TSX2  ! 1,X1

      927     4212    2   ALTRTN: ALTRETURN;

   4212  4 003761   002502 221200 0     ALTRTN       LDX1  ! @BUFNO+1
         4 003762   000000 702211                    TSX2  ! 0,X1

      928     4213    2   END GET_BUF;
      929     4214        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:165  
      930     4215        /*
      931     4216              Enter the assigned buffer into the hash table
      932     4217        */
      933     4218    1   ENTER_BUF: PROC(FIDX,PGNO,BUFNO);

   4218  4 003763   002506 741200 0     ENTER_BUF    STX1  ! @BUFNO+1

      934     4219    2   DCL FIDX SBIN;
      935     4220    2   DCL PGNO UBIN;
      936     4221    2   DCL BUFNO SBIN;
      937     4222
      938     4223    2       HSHINDX = HASH_ALGORITHM;

   4223  4 003764   002507 470400 0                  LDP0    @FIDX
         4 003765   002510 471400 0                  LDP1    @PGNO
         4 003766   000000 236100                    LDQ     0,,PR0
         4 003767   100000 402100                    MPY     0,,PR1
         4 003770   002256 506000 0                  DIV     NHSHBUFS
         4 003771   002252 755000 0                  STA     HSHINDX

      939     4224    2       IF HSHBUF(HSHINDX) = -1 THEN

   4224  4 003772   000001 735000                    ALS     1
         4 003773   000000 100405                    MLR     fill='000'O
         4 003774   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2
         4 003775   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 003776   002516 236000 0                  LDQ     @BUFNO+1
         4 003777   000022 732000                    QRS     18
         4 004000   000001 116000 5                  CMPQ    1
         4 004001   004007 601000 4                  TNZ     s:4230

      940     4225    3       DO; /* First to hash to this location */

      941     4226    3           HSHBUF(HSHINDX) = BUFNO;

   4226  4 004002   002511 473400 0                  LDP3    @BUFNO
         4 004003   000005 101500                    MRL     fill='000'O
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:166  
         4 004004   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
         4 004005   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2

      942     4227    3           RETURN;

   4227  4 004006   000001 702211                    TSX2  ! 1,X1

      943     4228    3           END;
      944     4229    3       ELSE DO; /* Find end of collosion chain */

      945     4230    3           HSHINDX = HSHBUF(HSHINDX);

   4230  4 004007   000000 100405                    MLR     fill='000'O
         4 004010   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2
         4 004011   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 004012   002516 236000 0                  LDQ     @BUFNO+1
         4 004013   000022 732000                    QRS     18
         4 004014   002252 756000 0                  STQ     HSHINDX

      946     4231    4           DO WHILE(BUFTBL.NXTHSH(HSHINDX) ~= -1);

   4231  4 004015   004032 710000 4                  TRA     s:4235

      947     4232    4               IF HSHINDX = BUFNO THEN

   4232  4 004016   002511 470400 0                  LDP0    @BUFNO
         4 004017   002252 236000 0                  LDQ     HSHINDX
         4 004020   000000 116100                    CMPQ    0,,PR0
         4 004021   004024 601000 4                  TNZ     s:4234

      948     4233    4                   RETURN; /*  Buffer already hashed here */

   4233  4 004022   002506 221200 0                  LDX1  ! @BUFNO+1
         4 004023   000001 702211                    TSX2  ! 1,X1

      949     4234    4               HSHINDX = BUFTBL.NXTHSH(HSHINDX);

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:167  
   4234  4 004024   002252 235000 0                  LDA     HSHINDX
         4 004025   000002 735000                    ALS     2
         4 004026   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 004027   000022 736000                    QLS     18
         4 004030   000033 732000                    QRS     27
         4 004031   002252 756000 0                  STQ     HSHINDX

      950     4235    4               END;

   4235  4 004032   002252 235000 0                  LDA     HSHINDX
         4 004033   000002 735000                    ALS     2
         4 004034   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 004035   777000 376007                    ANQ     -512,DL
         4 004036   777000 116007                    CMPQ    -512,DL
         4 004037   004016 601000 4                  TNZ     s:4232

      951     4236    3           BUFTBL.NXTHSH(HSHINDX) = BUFNO; /* Enter at end of coll chain */

   4236  4 004040   002511 470400 0                  LDP0    @BUFNO
         4 004041   000000 236100                    LDQ     0,,PR0
         4 004042   000011 736000                    QLS     9
         4 004043   000017 676005 0                  ERQ     BUFTBL+2,AL
         4 004044   777000 376007                    ANQ     -512,DL
         4 004045   000017 656005 0                  ERSQ    BUFTBL+2,AL

      952     4237    3           END;

      953     4238    2       RETURN;

   4238  4 004046   002506 221200 0                  LDX1  ! @BUFNO+1
         4 004047   000001 702211                    TSX2  ! 1,X1

      954     4239    2   END ENTER_BUF;
      955     4240        %EJECT;
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:168  
      956     4241        /*
      957     4242              Remove a buffer from its current hash location for re-location
      958     4243        */
      959     4244    1   REMOVE_BUF: PROC(FIDX,PGNO,BUFNO);

   4244  4 004050   002512 741200 0     REMOVE_BUF   STX1  ! @BUFNO+1

      960     4245    2   DCL FIDX SBIN;
      961     4246    2   DCL PGNO UBIN;
      962     4247    2   DCL BUFNO SBIN;
      963     4248
      964     4249    2       HSHINDX = HASH_ALGORITHM;

   4249  4 004051   002513 470400 0                  LDP0    @FIDX
         4 004052   002514 471400 0                  LDP1    @PGNO
         4 004053   000000 236100                    LDQ     0,,PR0
         4 004054   100000 402100                    MPY     0,,PR1
         4 004055   002256 506000 0                  DIV     NHSHBUFS
         4 004056   002252 755000 0                  STA     HSHINDX

      965     4250    2       IF HSHBUF(HSHINDX) = -1 THEN

   4250  4 004057   000001 735000                    ALS     1
         4 004060   000000 100405                    MLR     fill='000'O
         4 004061   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2
         4 004062   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 004063   002516 236000 0                  LDQ     @BUFNO+1
         4 004064   000022 732000                    QRS     18
         4 004065   000001 116000 5                  CMPQ    1
         4 004066   004070 601000 4                  TNZ     s:4252

      966     4251    2           RETURN; /* Not currently in hash tbl */

   4251  4 004067   000001 702211                    TSX2  ! 1,X1

      967     4252    2       IF HSHBUF(HSHINDX) = BUFNO THEN /* Direct hit??? */

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:169  
   4252  4 004070   002515 473400 0                  LDP3    @BUFNO
         4 004071   000000 100405                    MLR     fill='000'O
         4 004072   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2
         4 004073   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 004074   002516 236000 0                  LDQ     @BUFNO+1
         4 004075   000022 732000                    QRS     18
         4 004076   300000 116100                    CMPQ    0,,PR3
         4 004077   004123 601000 4                  TNZ     s:4259

      968     4253    3       DO;

      969     4254    3           HSHBUF(HSHINDX) = BUFTBL.NXTHSH(BUFNO);

   4254  4 004100   300000 235100                    LDA     0,,PR3
         4 004101   000001 735000                    ALS     1
         4 004102   000001 735000                    ALS     1
         4 004103   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 004104   000022 736000                    QLS     18
         4 004105   000033 732000                    QRS     27
         4 004106   002516 756000 0                  STQ     @BUFNO+1
         4 004107   002252 235000 0                  LDA     HSHINDX
         4 004110   000001 735000                    ALS     1
         4 004111   000005 101400                    MRL     fill='000'O
         4 004112   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 004113   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2

      970     4255    3           BUFTBL.NXTHSH(BUFNO) = -1;

   4255  4 004114   300000 235100                    LDA     0,,PR3
         4 004115   000001 735000                    ALS     1
         4 004116   000001 735000                    ALS     1
         4 004117   777000 236007                    LDQ     -512,DL
         4 004120   000017 256005 0                  ORSQ    BUFTBL+2,AL

      971     4256    3           RETURN;

   4256  4 004121   002512 221200 0                  LDX1  ! @BUFNO+1
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:170  
         4 004122   000001 702211                    TSX2  ! 1,X1

      972     4257    3           END;
      973     4258
      974     4259    2       HSHINDX = HSHBUF(HSHINDX);

   4259  4 004123   000000 100405                    MLR     fill='000'O
         4 004124   002016 000002 0                  ADSC9   HSHBUF,A                 cn=0,n=2
         4 004125   002516 000004 0                  ADSC9   @BUFNO+1                 cn=0,n=4
         4 004126   002516 236000 0                  LDQ     @BUFNO+1
         4 004127   000022 732000                    QRS     18
         4 004130   002252 756000 0                  STQ     HSHINDX

      975     4260    3       DO WHILE(HSHINDX ~= -1 AND HSHINDX ~= BUFNO);

   4260  4 004131   004141 710000 4                  TRA     s:4263

      976     4261    3           HSHTEMP = HSHINDX;

   4261  4 004132   002252 235000 0                  LDA     HSHINDX
         4 004133   002253 755000 0                  STA     HSHTEMP

      977     4262    3           HSHINDX = BUFTBL.NXTHSH(HSHINDX);

   4262  4 004134   000002 735000                    ALS     2
         4 004135   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 004136   000022 736000                    QLS     18
         4 004137   000033 732000                    QRS     27
         4 004140   002252 756000 0                  STQ     HSHINDX

      978     4263    3           END;

   4263  4 004141   000001 116000 5                  CMPQ    1
         4 004142   004146 600000 4                  TZE     s:4265
         4 004143   002515 470400 0                  LDP0    @BUFNO
         4 004144   000000 116100                    CMPQ    0,,PR0
         4 004145   004132 601000 4                  TNZ     s:4261
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:171  

      979     4264
      980     4265    2       IF HSHINDX ~= -1 THEN

   4265  4 004146   000001 116000 5                  CMPQ    1
         4 004147   004170 600000 4                  TZE     s:4270

      981     4266    3       DO; /* Buffer found in hash collosin chain */

      982     4267    3           BUFTBL.NXTHSH(HSHTEMP) = BUFTBL.NXTHSH(BUFNO);

   4267  4 004150   002253 235000 0                  LDA     HSHTEMP
         4 004151   000002 735000                    ALS     2
         4 004152   002515 470400 0                  LDP0    @BUFNO
         4 004153   000000 620005                    EAX0    0,AL
         4 004154   000000 235100                    LDA     0,,PR0
         4 004155   000001 735000                    ALS     1
         4 004156   000001 735000                    ALS     1
         4 004157   000017 236005 0                  LDQ     BUFTBL+2,AL
         4 004160   000017 676010 0                  ERQ     BUFTBL+2,X0
         4 004161   777000 376007                    ANQ     -512,DL
         4 004162   000017 656010 0                  ERSQ    BUFTBL+2,X0

      983     4268    3           BUFTBL.NXTHSH(BUFNO) = -1;

   4268  4 004163   000000 235100                    LDA     0,,PR0
         4 004164   000001 735000                    ALS     1
         4 004165   000001 735000                    ALS     1
         4 004166   777000 236007                    LDQ     -512,DL
         4 004167   000017 256005 0                  ORSQ    BUFTBL+2,AL

      984     4269    3           END;

      985     4270    2       RETURN;

   4270  4 004170   002512 221200 0                  LDX1  ! @BUFNO+1
         4 004171   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:172  

      986     4271    2   END REMOVE_BUF;
      987     4272    1   ALTRTN:
      988     4273    1       ALTRETURN;

   4273  4 004172   000000 221200 0     ALTRTN       LDX1  ! 0
         4 004173   000000 702211                    TSX2  ! 0,X1

BUFTBL
 Sect OctLoc
   0     015   ****** ******   ****** ******   ****** ******   ****** ******    ................

HSHBUF
 Sect OctLoc
   0    2016   ****** ******   ****** ******   ****** ******   ****** ******    ................

NHSHBUFS
 Sect OctLoc
   0    2256   000000 000467                                                    ....

ROLLKEY
 Sect OctLoc
   0    2264   ****** ******   ****** ******   ****** ******   ****** ******    ................

FPT_OPEN
 Sect OctLoc
   0    2366   000025 777640   002432 006000   000000 177640   000000 006014    ................
   0    2372   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0    2432*  000000 000042   000000 000000   252525 000000   000040 252520    ..."......... ..
   0    2436   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   0    2442   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    2446   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   0    2452   040040 040040   000000 000000   000000 000000   000000 000000        ............
   0    2456   000000 000000   ****** ******                                    ........

PSN
 Sect OctLoc
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:173  
   0    2460   000000 000001   040040 040040   040040 ******                    ....      ..

(unnamed)
 Sect OctLoc
   0    2463   ****** ******   ****** ******   ****** ******   ****** ******    ................

CURR_FIDX
 Sect OctLoc
   0    2470   000000 000000                                                    ....

CURR_PAGE
 Sect OctLoc
   0    2471   000000 000000                                                    ....

ZEROS
 Sect OctLoc
   1     000   000000 000000                                                    ....

(unnamed)
 Sect OctLoc
   5     000   777777 777377   777777 777777   000000 006000   000001 000000    ................
   5     004   000000 006000   000003 000000   000001 400000   000001 200000    ................
   5     010   777777 400007   000000 000000   000002 000000   000000 006014    ................
   5     014   000000 400000   000004 400000   000006 006000   000000 000036    ................
   5     020   400000 000000   000000 206000   000017 006000   000020 006000    ................
   5     024   000010 206000   000017 006000   000020 006000   777777 777000    ................
   5     030   000000 006003   000000 006000   002257 006000   001777 777640    ................
   5     034   777777 777776   002261 006000   002262 006000   002263 006000    ................
      989     4274    1   END ZIU$RPLY;
      990     4275        %EOD;

PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:174  
--  Include file information  --

   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   ZI$JRNL.:ZIC0TOU  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI_ERRORS_SUBS.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI_DBU_ROLL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$RPLY.

   Procedure ZIU$RPLY requires 2172 words for executable code.
   Procedure ZIU$RPLY is declared NOAUTO and requires 1362 words of local(STATIC) storage.
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:175  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:176  
          MINI XREF LISTING

ALTREAD IN PROCEDURE READ_PAGE
      4087**LABEL    4056--CALLALT  4078--CALLALT
ALTRTN
      4273**LABEL    3450--CALLALT  3461--CALLALT  3479--CALLALT  3483--CALLALT  3485--CALLALT  3491--CALLALT
      3494--CALLALT  3508--CALLALT  3569--CALLALT  3579--CALLALT  3625--CALLALT  3635--CALLALT  3703--CALLALT
      3712--CALLALT  3733--CALLALT  3768--CALLALT  3772--CALLALT  3786--CALLALT  3791--CALLALT  3817--CALLALT
      3821--CALLALT  3830--CALLALT  3852--CALLALT  3856--CALLALT  3875--CALLALT  3880--CALLALT  3891--CALLALT
      3893--CALLALT  3902--CALLALT  3904--CALLALT  3919--CALLALT  3923--CALLALT  3939--CALLALT
ALTRTN IN PROCEDURE FIND_KEY
      3973**LABEL    3965--CALLALT
ALTRTN IN PROCEDURE GET_BUF
      4212**LABEL    4209--CALLALT
ALTWRIT IN PROCEDURE WRITE_PAGE
      4117**LABEL    4113--CALLALT
ASSOC_DCB
        94**DCL-ENT  3479--CALL     3491--CALL     3766--CALL     3815--CALL     3850--CALL     3889--CALL
      3900--CALL     3917--CALL     4059--CALL     4098--CALL
B$EXCFR.ASL
      1593**DCL      1593--REDEF
B$EXCFR.ERR.ERR#
      1607**DCL      1607--REDEF
B$EXCFR.EVID
      1606**DCL      1606--REDEF    1607--REDEF
B$EXCFR.IR
      1594**DCL      1594--REDEF
B$EXCFR.PREVSZ
      1593**DCL      1593--REDEF
B$EXCFR.SUBC
      1605**DCL      1605--REDEF    1606--REDEF    1606--REDEF
BERC.DCB#
      1883**DCL      1884--REDEF
BIT_LEN
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:177  
        19**DCL        20--IMP-SIZ  3612<<ASSIGN   3613>>ASSIGN   3670<<ASSIGN   3671>>ASSIGN
BIT_STRING
        20**DCL      3613<<ASSIGN   3671<<ASSIGN
BOTTOM$
        23**DCL      3605<<ASSIGN   3611<<ASSIGN   3611>>ASSIGN   3613>>ASSIGN   3662<<ASSIGN   3669<<ASSIGN
      3669>>ASSIGN   3671>>ASSIGN
BUFER
        65**DCL      4071--ASSIGN   4104--ASSIGN
BUFLNSF
      3298**DCL      3871<<ASSIGN   3956<<ASSIGN   4073<<ASSIGN   4105<<ASSIGN
BUFNO
        63**DCL      4048<>CALL     4049>>IF       4051>>ASSIGN   4052<>CALL     4056<>CALL     4064>>DOWHILE
      4071>>ASSIGN   4079>>ASSIGN   4080<>CALL
BUFNO IN PROCEDURE ENTER_BUF
      4221**DCL      4218--PROC     4226>>ASSIGN   4232>>IF       4236>>ASSIGN
BUFNO IN PROCEDURE FIND_BUF
      4130**DCL      4127--PROC     4133<<ASSIGN   4137<<ASSIGN   4138>>IF       4138>>IF       4141>>ASSIGN
      4146<<ASSIGN
BUFNO IN PROCEDURE GET_BUF
      4186**DCL      4183--PROC     4191<<ASSIGN   4192>>ASSIGN   4193>>ASSIGN   4194<>CALL     4199<<ASSIGN
      4200>>ASSIGN   4201>>ASSIGN   4202<>CALL     4203<>CALL
BUFNO IN PROCEDURE QUE_BUF_LAST
      4155**DCL      4154--PROC     4160>>IF       4162>>IF       4164>>ASSIGN   4165>>ASSIGN   4166>>ASSIGN
      4167>>ASSIGN   4170>>ASSIGN   4170>>ASSIGN   4171>>ASSIGN   4171>>ASSIGN   4172>>ASSIGN   4173>>ASSIGN
      4174>>ASSIGN   4175>>ASSIGN
BUFNO IN PROCEDURE REMOVE_BUF
      4247**DCL      4244--PROC     4252>>IF       4254>>ASSIGN   4255>>ASSIGN   4260>>DOWHILE  4267>>ASSIGN
      4268>>ASSIGN
BUFNO IN PROCEDURE WRITE_PAGE
      4091**DCL      4090--PROC     4093>>ASSIGN   4097>>ASSIGN   4104>>ASSIGN   4108>>ASSIGN   4110>>ASSIGN
      4111>>ASSIGN
BUFSF
      3299**DCL      4071<<ASSIGN   4104<<ASSIGN
BUFTBL.BUSY
        49**DCL      3434<<ASSIGN   4064>>DOWHILE  4111<<ASSIGN
BUFTBL.FIDX
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:178  
        47**DCL      3432<<ASSIGN   3449>>IF       4093>>ASSIGN   4097>>ASSIGN   4138>>IF       4142>>DOWHILE
      4192<<ASSIGN   4200<<ASSIGN   4206>>ASSIGN
BUFTBL.NXTHSH
        48**DCL      3433<<ASSIGN   4141>>ASSIGN   4144>>ASSIGN   4231>>DOWHILE  4234>>ASSIGN   4236<<ASSIGN
      4254>>ASSIGN   4255<<ASSIGN   4262>>ASSIGN   4267<<ASSIGN   4267>>ASSIGN   4268<<ASSIGN
BUFTBL.PGNO
        46**DCL      3431<<ASSIGN   3449>>IF       4108>>ASSIGN   4138>>IF       4142>>DOWHILE  4193<<ASSIGN
      4201<<ASSIGN   4207>>ASSIGN
BUFTBL.PTR$
        45**DCL      3430<<ASSIGN   4051>>ASSIGN   4071>>ASSIGN   4079>>ASSIGN   4104>>ASSIGN
BUFTBL.Q.NXT
        53**DCL      3423<<ASSIGN   3436<<ASSIGN   4158>>ASSIGN   4162>>IF       4164<<ASSIGN   4167<<ASSIGN
      4170>>ASSIGN   4171<<ASSIGN   4171>>ASSIGN   4173<<ASSIGN   4174<<ASSIGN   4205>>ASSIGN
BUFTBL.Q.PRI
        52**DCL      3422<<ASSIGN   3435<<ASSIGN   4157>>ASSIGN   4165<<ASSIGN   4166<<ASSIGN   4170<<ASSIGN
      4170>>ASSIGN   4171>>ASSIGN   4172<<ASSIGN   4175<<ASSIGN
BUILD_HEADER
      3978**PROC     3569--CALL     3625--CALL     3703--CALL
CHKJRNL
        92**DCL-ENT  3735--CALL
CHKSUM
        91**DCL-ENT  3721--CALL     4013--CALL
CHK_SUM IN PROCEDURE BUILD_HEADER
      4011**LABEL    3987--GOTO
CKSM.CKSM
      1878**DCL      3737>>IF
CKSM.DCB#
      1876**DCL      3732<>CALL
CKSM.PAGE
      1877**DCL      3744>>CALLBLT
CKSM.USER#
      1875**DCL      3732<>CALL
COUNTSF
      3349**DCL      3350--REDEF    3949<<ASSIGN
CURR_BUF_CNT
        55**DCL      3438<<ASSIGN   4189>>IF       4191>>ASSIGN   4195<<ASSIGN   4195>>ASSIGN   4196>>ASSIGN
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:179  
DATA$
       373**DCL         9--IMP-PTR   374--IMP-PTR  3510>>IF       3510>>IF       3513>>ASSIGN   3516>>ASSIGN
      3517>>ASSIGN   3517>>ASSIGN   3520>>ASSIGN   3521>>ASSIGN   3521>>ASSIGN   3522>>IF       3523>>ASSIGN
      3525>>ASSIGN   3526>>DOWHILE  3527>>ASSIGN   3529>>ASSIGN   3529>>ASSIGN   3531>>ASSIGN   3534>>IF
      3534>>IF       3546>>ASSIGN   3550>>IF       3551>>ASSIGN   3551>>ASSIGN   3554>>ASSIGN   3554>>ASSIGN
      3555>>ASSIGN   3557>>ASSIGN   3560>>ASSIGN   3562>>ASSIGN   3563>>ASSIGN   3563>>ASSIGN   3566>>ASSIGN
      3567>>ASSIGN   3567>>ASSIGN   3581>>IF       3581>>IF       3593>>ASSIGN   3594>>ASSIGN   3602>>ASSIGN
      3602>>ASSIGN   3602>>ASSIGN   3605>>ASSIGN   3617>>DOINDEX  3618>>IF       3618>>IF       3620>>ASSIGN
      3620>>ASSIGN   3623>>ASSIGN   3623>>ASSIGN   3637>>ASSIGN   3638>>ASSIGN   3655>>ASSIGN   3659>>ASSIGN
      3659>>ASSIGN   3659>>ASSIGN   3662>>ASSIGN   3673>>ASSIGN   3678>>ASSIGN   3678>>ASSIGN   3678>>ASSIGN
      3687>>ASSIGN   3695>>ASSIGN   3695>>ASSIGN   3697>>DOINDEX  3698>>IF       3698>>IF       3700>>ASSIGN
      3700>>ASSIGN   3714>>ASSIGN   3719>>IF       3722>>ASSIGN   3993>>ASSIGN   3993>>ASSIGN   3994>>ASSIGN
      3998>>ASSIGN   4000>>ASSIGN   4001>>ASSIGN   4002>>ASSIGN   4002>>ASSIGN   4007>>IF       4008>>ASSIGN
      4011>>IF       4014>>ASSIGN   4051<<ASSIGN   4079<<ASSIGN
DATA_PG.ACT_DATA
       386**DCL       387--REDEF     388--REDEF     389--REDEF
DATA_PG.CHKSUM_WD
       378**DCL      3719>>IF       3722<<ASSIGN   4011>>IF       4014<<ASSIGN
DATA_PG.OFF_LN.FIR
       384**DCL      3522>>IF       3523<<ASSIGN
DATA_PG.OFF_LN.SEC
       385**DCL      3510>>IF       3510>>IF       3513>>ASSIGN   3529>>ASSIGN   3531<<ASSIGN   3617>>DOINDEX
      3697>>DOINDEX  4007>>IF       4008<<ASSIGN
DATA_PG.PG_SZ.SEC
       381**DCL      3517<<ASSIGN   3517>>ASSIGN   3521<<ASSIGN   3521>>ASSIGN   3551<<ASSIGN   3551>>ASSIGN
      3567<<ASSIGN   3567>>ASSIGN   3623<<ASSIGN   3623>>ASSIGN   3695<<ASSIGN   3695>>ASSIGN
DCBLIST$
       218**DCL       241--IMP-PTR
DCBSF
      3278**DCL      3470<<ASSIGN   3749<<ASSIGN   3771<<ASSIGN   3788--IF       3820<<ASSIGN   3855<<ASSIGN
      3877--IF       3922<<ASSIGN   3950--IF       3953--ASSIGN   3954--ASSIGN   4032<<ASSIGN   4070<<ASSIGN
      4093<<ASSIGN   4094>>IF
DCBX
       266**DCL      3463>>IF
ENCRP_SEEDSF
      3307**DCL      3308--REDEF    3784<<ASSIGN   3872<<ASSIGN   4074<<ASSIGN   4107<<ASSIGN
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:180  
END$
        22**DCL        26--IMP-PTR  3597<<ASSIGN   3609>>ASSIGN   3664<<ASSIGN   3667>>ASSIGN   3682<<ASSIGN
      3686>>CALL
ENTER_BUF
      4218**PROC     4194--CALL     4202--CALL
ERRCODESF
      3309**DCL      3314--REDEF
ERRCODESF.ERR#
      3312**DCL      3471<<ASSIGN   3540<<ASSIGN   3587<<ASSIGN   3649<<ASSIGN   3742<<ASSIGN   3796<<ASSIGN
      3798<<ASSIGN   3836<<ASSIGN   3865<<ASSIGN   3932<<ASSIGN
ERRCODE_RDEF
      3314**DCL      3472>>ASSIGN   3750>>ASSIGN   3800>>ASSIGN   3837>>ASSIGN   3866>>ASSIGN   3933>>ASSIGN
      4034>>ASSIGN
ERRFLGSF
      3338**DCL      3751<<ASSIGN
ERR_INSERT.CNT
      3323**DCL      3468<<ASSIGN   3743<<ASSIGN   3746<<ASSIGN   3834<<ASSIGN   3863<<ASSIGN   3930<<ASSIGN
      4030<<ASSIGN   4031<<ASSIGN
ERR_INSERT.TEXT
      3324**DCL      3469<<CALLBLT  3744<<CALLBLT  3745<>CALL     3747<<CALLBLT  3748<>CALL     3799<<CALLBLT
      3835<<CALLBLT  3864<<CALLBLT  3931<<CALLBLT  4025<<CALLBLT  4026<<CALLBLT  4027<>CALL     4028<>CALL
EVENTSF
      3350**DCL      4110<<ASSIGN
F$DCB.ACTPOS
      1565**DCL      1565--REDEF
F$DCB.ARS#
      1539**DCL      1539--REDEF
F$DCB.ATTR
      1558**DCL      1559--REDEF
F$DCB.BORROW
      1573**DCL      1573--REDEF    1573--REDEF    1573--REDEF
F$DCB.DCBNAME.L
      1587**DCL      1587--IMP-SIZ
F$DCB.EOMCHAR#
      1543**DCL      1543--REDEF
F$DCB.FLDID
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:181  
      1568**DCL      1568--REDEF
F$DCB.FORM$
      1562**DCL      1562--REDEF
F$DCB.FSECT
      1578**DCL      1578--REDEF
F$DCB.FSN#
      1555**DCL      1555--REDEF    1555--REDEF    1556--REDEF
F$DCB.HEADER$
      1561**DCL      1561--REDEF
F$DCB.IXTNSIZE#
      1559**DCL      1559--REDEF
F$DCB.KEYL#
      1556**DCL      3954>>ASSIGN
F$DCB.KEYX#
      1556**DCL      3953>>ASSIGN
F$DCB.LASTSTA$
      1548**DCL      1548--REDEF
F$DCB.LVL
      1574**DCL      1574--REDEF
F$DCB.NAME#.C
      1549**DCL      1549--REDEF
F$DCB.NOEOF
      1571**DCL      1571--REDEF
F$DCB.NRECS#
      1560**DCL      1560--REDEF
F$DCB.NRECX
      1579**DCL      1579--REDEF
F$DCB.OHDR
      1571**DCL      1571--REDEF
F$DCB.ORG#
      1554**DCL      1554--REDEF    3950>>IF
F$DCB.PRECNO
      1577**DCL      1577--REDEF
F$DCB.RCSZ
      1583**DCL      1583--REDEF
F$DCB.RDL0#
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:182  
      1543**DCL      3788>>IF       3877>>IF
F$DCB.RES#
      1550**DCL      1550--REDEF
F$DCB.SETX
      1562**DCL      1562--REDEF
F$DCB.TAB$
      1562**DCL      1562--REDEF
F$DCB.TDA
      1576**DCL      1577--REDEF
F$DCB.WSN#
      1550**DCL      1550--REDEF
FID$
       217**DCL       221--IMP-PTR  3470>>ASSIGN   3477>>IF       3483>>CALL     3486>>IF       3489>>IF
      3749>>ASSIGN   3764>>IF       3771>>ASSIGN   3784>>ASSIGN   3787>>ASSIGN   3813>>IF       3820>>ASSIGN
      3831>>ASSIGN   3848>>IF       3855>>ASSIGN   3876>>ASSIGN   3888>>IF       3891>>CALL     3893>>CALL
      3899>>IF       3902>>CALL     3904>>CALL     3915>>IF       3922>>ASSIGN   3940>>ASSIGN   4016>>ASSIGN
      4032>>ASSIGN   4057>>IF       4070>>ASSIGN   4074>>ASSIGN   4093>>ASSIGN   4107>>ASSIGN
FIDLIST.CRPT
       230**DCL       231--REDEF
FIDLIST.CRPT_B
       231**DCL      3784>>ASSIGN   4074>>ASSIGN   4107>>ASSIGN
FIDLIST.DCB#
       232**DCL      3470>>ASSIGN   3477>>IF       3483<>CALL     3489>>IF       3749>>ASSIGN   3764>>IF
      3771>>ASSIGN   3813>>IF       3820>>ASSIGN   3848>>IF       3855>>ASSIGN   3888>>IF       3891<>CALL
      3893<>CALL     3899>>IF       3902<>CALL     3904<>CALL     3915>>IF       3922>>ASSIGN   4032>>ASSIGN
      4057>>IF       4070>>ASSIGN   4093>>ASSIGN
FIDLIST.MOD#
       229**DCL      3787<<ASSIGN   3831<<ASSIGN   3876<<ASSIGN   3940<<ASSIGN   4016<<ASSIGN
FIDLIST.ORG#
       228**DCL      3486>>IF
FIDREM
        68**DCL      4096<<ASSIGN   4101>>ASSIGN   4206<<ASSIGN   4208<>CALL
FIDSF_RD
      3325**DCL      3326--REDEF
FIDX
       265**DCL      3460<>CALL     3461<>CALL     3470>>ASSIGN   3477>>IF       3479<>CALL     3480<>CALL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:183  
      3483>>CALL     3486>>IF       3488<<ASSIGN   3488>>ASSIGN   3489>>IF       3491<>CALL     3492<>CALL
      3495<<ASSIGN   3495>>ASSIGN   3507<>CALL     3578<>CALL     3634<>CALL     3711<>CALL     3732<>CALL
      3749>>ASSIGN   3763<>CALL     3764>>IF       3766<>CALL     3767<>CALL     3771>>ASSIGN   3784>>ASSIGN
      3787>>ASSIGN   3812<>CALL     3813>>IF       3815<>CALL     3816<>CALL     3820>>ASSIGN   3831>>ASSIGN
      3846<>CALL     3847<<ASSIGN   3847>>ASSIGN   3848>>IF       3850<>CALL     3851<>CALL     3855>>ASSIGN
      3876>>ASSIGN   3887<>CALL     3888>>IF       3889<>CALL     3890<>CALL     3891>>CALL     3893>>CALL
      3898<>CALL     3899>>IF       3900<>CALL     3901<>CALL     3902>>CALL     3904>>CALL     3913<>CALL
      3914<<ASSIGN   3914>>ASSIGN   3915>>IF       3917<>CALL     3918<>CALL     3922>>ASSIGN   3940>>ASSIGN
      4016>>ASSIGN   4032>>ASSIGN   4048<>CALL     4056<>CALL     4057>>IF       4059<>CALL     4060<>CALL
      4070>>ASSIGN   4074>>ASSIGN   4081<>CALL     4096>>ASSIGN   4097<<ASSIGN   4098<>CALL     4099<>CALL
      4101<<ASSIGN   4107>>ASSIGN
FIDX IN PROCEDURE ENTER_BUF
      4219**DCL      4218--PROC     4223>>ASSIGN
FIDX IN PROCEDURE FIND_BUF
      4128**DCL      4127--PROC     4132>>ASSIGN   4138>>IF       4142>>DOWHILE
FIDX IN PROCEDURE GET_BUF
      4184**DCL      4183--PROC     4192>>ASSIGN   4194<>CALL     4200>>ASSIGN   4202<>CALL
FIDX IN PROCEDURE REMOVE_BUF
      4245**DCL      4244--PROC     4249>>ASSIGN
FILE.COMGROUP
      1852**DCL      3482>>IF
FILE.DCB#
      1846**DCL      3461<>CALL
FILE.USER#
      1845**DCL      3461<>CALL     3469>>CALLBLT  3799>>CALLBLT  3835>>CALLBLT  3864>>CALLBLT  3931>>CALLBLT
FILL_ERROR_INFO
      4023**PROC     3541--CALL     3588--CALL     3650--CALL
FIND_BUF
      4127**PROC     4048--CALL
FIND_FID
        99**DCL-ENT  3460--CALL
FIND_KEY
      3947**PROC     3772--CALL     3821--CALL     3856--CALL     3923--CALL
FIND_USER_FIDID
       101**DCL-ENT  3507--CALL     3578--CALL     3634--CALL     3711--CALL     3732--CALL     3763--CALL
      3812--CALL     3846--CALL     3887--CALL     3898--CALL     3913--CALL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:184  
FIRSTBUF
        60**DCL      4158<<ASSIGN
FOUND
        75**DCL      3781>>IF       3781>>IF       3827>>IF       3858>>IF       3925>>IF       3968<<ASSIGN
      3970<<ASSIGN
FPT_OPEN.ACSVEH_
      1677**DCL      1678--REDEF
FPT_OPEN.ALTKEYS_
      1683**DCL      1684--REDEF    1684--REDEF
FPT_OPEN.HDR_
      1682**DCL      1683--REDEF
FPT_OPEN.TAB_
      1681**DCL      1682--REDEF
FPT_OPEN.UHL_
      1675**DCL      1676--REDEF    1676--REDEF
FPT_OPEN.V
      1684**DCL      1675--DCLINIT
FPT_OPEN.V.FSN#
      1715**DCL      1715--REDEF    1715--REDEF
FPT_OPEN.WSN_
      1681**DCL      1681--REDEF
FROMSTR
        27**DCL      3686<>CALL
FULLSF
      3296**DCL      4075<<ASSIGN   4112<<ASSIGN
GET_BUF
      4183**PROC     4056--CALL
HELPCODE
      3343**DCL      3348--REDEF
HLFWRD
        31**DCL      3644>>IF
HSHBUF
        56**DCL      3440<<ASSIGN   4133>>ASSIGN   4134>>IF       4137>>ASSIGN   4224>>IF       4226<<ASSIGN
      4230>>ASSIGN   4250>>IF       4252>>IF       4254<<ASSIGN   4259>>ASSIGN
HSHINDX
        57**DCL      4132<<ASSIGN   4133>>ASSIGN   4134>>IF       4137>>ASSIGN   4141<<ASSIGN   4142>>DOWHILE
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:185  
      4142>>DOWHILE  4142>>DOWHILE  4144<<ASSIGN   4144>>ASSIGN   4146>>ASSIGN   4223<<ASSIGN   4224>>IF
      4226>>ASSIGN   4230<<ASSIGN   4230>>ASSIGN   4231>>DOWHILE  4232>>IF       4234<<ASSIGN   4234>>ASSIGN
      4236>>ASSIGN   4249<<ASSIGN   4250>>IF       4252>>IF       4254>>ASSIGN   4259<<ASSIGN   4259>>ASSIGN
      4260>>DOWHILE  4260>>DOWHILE  4261>>ASSIGN   4262<<ASSIGN   4262>>ASSIGN   4265>>IF
HSHTEMP
        58**DCL      4261<<ASSIGN   4267>>ASSIGN
ICHKSUM
      3408**DCL      3409--REDEF    3722>>ASSIGN   3737>>IF       4014>>ASSIGN
INDEXSF
      3351**DCL      3958<<ASSIGN
INDXKEY
        74**DCL      3785>>ASSIGN   3829>>ASSIGN   3955<<ASSIGN   3957>>ASSIGN
INDXKEYSF
      3286**DCL      3785<<ASSIGN   3829<<ASSIGN   3957<<ASSIGN
I_O_BUF
      3387**DCL      3430--ASSIGN
I_O_BUF$
      3386**DCL      3387--IMP-PTR  3430>>ASSIGN
I_O_TAB.ELEM.VAL
        13**DCL      3602>>ASSIGN   3602>>ASSIGN   3602>>ASSIGN   3659>>ASSIGN   3659>>ASSIGN   3659>>ASSIGN
      3678>>ASSIGN   3678>>ASSIGN   3678>>ASSIGN
I_O_TAB.HW
        10**DCL        11--REDEF    3516<<ASSIGN   3520<<ASSIGN   3525>>ASSIGN   3526>>DOWHILE  3527>>ASSIGN
      3529<<ASSIGN   3534>>IF       3534>>IF       3550>>IF       3554<<ASSIGN   3554>>ASSIGN   3555>>ASSIGN
      3557>>ASSIGN   3560>>ASSIGN   3562<<ASSIGN   3563<<ASSIGN   3563>>ASSIGN   3566<<ASSIGN   3581>>IF
      3581>>IF       3593>>ASSIGN   3618>>IF       3618>>IF       3620<<ASSIGN   3620>>ASSIGN   3637>>ASSIGN
      3698>>IF       3698>>IF       3700<<ASSIGN   3700>>ASSIGN   3993<<ASSIGN   3993>>ASSIGN   3994>>ASSIGN
      3998>>ASSIGN   4000<<ASSIGN   4001<<ASSIGN   4002<<ASSIGN   4002>>ASSIGN
J
      3382**DCL      3513<<ASSIGN   3515>>DOINDEX  3523>>ASSIGN   3555<<ASSIGN   3558>>DOWHILE  3558>>DOWHILE
      3559>>ASSIGN   3560<<ASSIGN   3994<<ASSIGN   3996>>DOWHILE  3996>>DOWHILE  3997>>ASSIGN   3998<<ASSIGN
      4001>>ASSIGN
JREC.DCB#
      1866**DCL      3507<>CALL     3578<>CALL     3634<>CALL     3711<>CALL     3763<>CALL     3812<>CALL
      3846<>CALL     3913<>CALL
JREC.LENGTH
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:186  
      1868**DCL      1871--IMP-SIZ  3547>>ASSIGN   3548>>ASSIGN   3567>>ASSIGN   3640>>ASSIGN   3641>>ASSIGN
      3665>>ASSIGN   3666>>ASSIGN   3682>>ASSIGN   3690>>ASSIGN   3691>>ASSIGN   3715>>ASSIGN   3717>>ASSIGN
      3961>>ASSIGN   3962>>ASSIGN
JREC.LINE
      1869**DCL      3510>>IF       3510>>IF       3515>>DOINDEX  3520>>ASSIGN   3531>>ASSIGN   3534>>IF
      3534>>IF       3550>>IF       3557>>ASSIGN   3558>>DOWHILE  3566>>ASSIGN   3581>>IF       3581>>IF
      3593>>ASSIGN   3637>>ASSIGN   3996>>DOWHILE  4000>>ASSIGN   4001>>ASSIGN   4007>>IF       4008>>ASSIGN
      4026>>CALLBLT
JREC.OFFSET
      1870**DCL      3546>>ASSIGN   3566>>ASSIGN   3714>>ASSIGN
JREC.PAGE
      1867**DCL      4025>>CALLBLT  4048<>CALL     4056<>CALL     4076>>ASSIGN
JREC.TYPE
      1864**DCL      3781>>IF       3781>>IF       3795>>IF       3986>>IF       3991>>IF
JREC.USER#
      1865**DCL      3507<>CALL     3578<>CALL     3634<>CALL     3711<>CALL     3763<>CALL     3812<>CALL
      3846<>CALL     3913<>CALL
JREC.VALUE
      1871**DCL      3548>>ASSIGN   3643--ASSIGN   3691>>ASSIGN   3717>>ASSIGN   3952--ASSIGN   3962>>ASSIGN
JREC_NO
        32**DCL      3747>>CALLBLT
JRNL$
      1841**DCL      1842--IMP-PTR  1862--IMP-PTR  1872--IMP-PTR  1879--IMP-PTR  1885--IMP-PTR  1917--IMP-PTR
      1953--IMP-PTR  3461>>CALL     3461>>CALL     3469>>CALLBLT  3482>>IF       3507>>CALL     3507>>CALL
      3510>>IF       3510>>IF       3515>>DOINDEX  3520>>ASSIGN   3531>>ASSIGN   3534>>IF       3534>>IF
      3546>>ASSIGN   3547>>ASSIGN   3548>>ASSIGN   3548>>ASSIGN   3550>>IF       3557>>ASSIGN   3558>>DOWHILE
      3566>>ASSIGN   3566>>ASSIGN   3567>>ASSIGN   3578>>CALL     3578>>CALL     3581>>IF       3581>>IF
      3593>>ASSIGN   3634>>CALL     3634>>CALL     3637>>ASSIGN   3640>>ASSIGN   3641>>ASSIGN   3643>>ASSIGN
      3665>>ASSIGN   3666>>ASSIGN   3682>>ASSIGN   3690>>ASSIGN   3691>>ASSIGN   3691>>ASSIGN   3711>>CALL
      3711>>CALL     3714>>ASSIGN   3715>>ASSIGN   3717>>ASSIGN   3717>>ASSIGN   3732>>CALL     3732>>CALL
      3737>>IF       3744>>CALLBLT  3763>>CALL     3763>>CALL     3781>>IF       3781>>IF       3795>>IF
      3799>>CALLBLT  3812>>CALL     3812>>CALL     3835>>CALLBLT  3846>>CALL     3846>>CALL     3864>>CALLBLT
      3887>>CALL     3887>>CALL     3893<>CALL     3898>>CALL     3898>>CALL     3904<>CALL     3905>>ASSIGN
      3913>>CALL     3913>>CALL     3931>>CALLBLT  3952>>ASSIGN   3961>>ASSIGN   3962>>ASSIGN   3962>>ASSIGN
      3986>>IF       3991>>IF       3996>>DOWHILE  4000>>ASSIGN   4001>>ASSIGN   4007>>IF       4008>>ASSIGN
      4025>>CALLBLT  4026>>CALLBLT  4048>>CALL     4056>>CALL     4076>>ASSIGN
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:187  
KEY$
        24**DCL      3952<<ASSIGN   3953<<ASSIGN   3953>>ASSIGN   3955>>ASSIGN
KEYSF
      3280**DCL      4072<<ASSIGN
KEYVSF
      3281**DCL      3286--REDEF    3874<<ASSIGN   3938<<ASSIGN   3963<<ASSIGN
KEYVSF.IDSKEY
      3284**DCL      4076<<ASSIGN   4108<<ASSIGN
KEYVSF.WD_ONE
      3283**DCL      3284--REDEF
LASTBUF
        61**DCL      4157<<ASSIGN   4160>>IF       4165>>ASSIGN   4167>>ASSIGN   4172>>ASSIGN   4174>>ASSIGN
LAST_OFF
        34**DCL      3602<<ASSIGN   3605>>ASSIGN   3607>>ASSIGN   3659<<ASSIGN   3662>>ASSIGN   3666>>ASSIGN
      3678<<ASSIGN   3681>>ASSIGN
MSGCODE
      3315**DCL      3316--REDEF    3472<<ASSIGN   3750<<ASSIGN   3800<<ASSIGN   3837<<ASSIGN   3866<<ASSIGN
      3933<<ASSIGN   4034<<ASSIGN
N
        29**DCL        26--IMP-SIZ    27--IMP-SIZ    28--IMP-SIZ  3547<<ASSIGN   3548>>ASSIGN   3607<<ASSIGN
      3608>>ASSIGN   3609>>ASSIGN   3609>>ASSIGN   3641<<ASSIGN   3666<<ASSIGN   3667>>ASSIGN   3667>>ASSIGN
      3681<<ASSIGN   3686>>CALL     3686>>CALL     3686<>CALL     3690<<ASSIGN   3691>>ASSIGN   3715<<ASSIGN
      3717>>ASSIGN   3954<<ASSIGN   3955>>ASSIGN   3956>>ASSIGN
NBUFS
        66**DCL      3425>>ASSIGN
NHSHBUFS
        62**DCL      3439>>DOINDEX  4132>>ASSIGN   4223>>ASSIGN   4249>>ASSIGN
NO_KEYSF
      3332**DCL      3967>>IF
NXT_AVAIL_BUF
        70**DCL      4196<<ASSIGN   4199>>ASSIGN   4205<<ASSIGN   4206>>ASSIGN   4207>>ASSIGN   4208<>CALL
      4209<>CALL
NXT_OFF
        37**DCL      3557<<ASSIGN   3562>>ASSIGN
OPEN_FID
       100**DCL-ENT  3485--CALL     3494--CALL     3768--CALL     3791--CALL     3817--CALL     3852--CALL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:188  
      3880--CALL     3919--CALL     4061--CALL     4100--CALL
PGNO IN PROCEDURE ENTER_BUF
      4220**DCL      4218--PROC     4223>>ASSIGN
PGNO IN PROCEDURE FIND_BUF
      4129**DCL      4127--PROC     4132>>ASSIGN   4138>>IF       4142>>DOWHILE
PGNO IN PROCEDURE GET_BUF
      4185**DCL      4183--PROC     4193>>ASSIGN   4194<>CALL     4201>>ASSIGN   4202<>CALL
PGNO IN PROCEDURE REMOVE_BUF
      4246**DCL      4244--PROC     4249>>ASSIGN
PGREM
        69**DCL      4207<<ASSIGN   4208<>CALL
QUE_BUF_LAST
      4154**PROC     4052--CALL     4080--CALL     4203--CALL
QUE_LAST
        98**DCL-ENT  4081--CALL
QUE_UP
        96**DCL-ENT  3480--CALL     3492--CALL     3767--CALL     3816--CALL     3851--CALL     3890--CALL
      3901--CALL     3918--CALL     4060--CALL     4099--CALL
READ_PAGE
      4042**PROC     3508--CALL     3579--CALL     3635--CALL     3712--CALL     3733--CALL
REC.LEN
        17**DCL      3597>>ASSIGN   3611>>ASSIGN   3612>>ASSIGN   3620>>ASSIGN   3623>>ASSIGN   3640>>ASSIGN
      3664>>ASSIGN   3681>>ASSIGN   3683>>ASSIGN
REC.TYPE
        16**DCL      3644>>IF
REC$
      3367**DCL        27--IMP-PTR  3390--IMP-PTR  3546<<ASSIGN   3548>>ASSIGN   3594<<ASSIGN   3596>>ASSIGN
      3597>>ASSIGN   3609>>ASSIGN   3638<<ASSIGN   3639>>ASSIGN   3643<<ASSIGN   3644>>IF       3655<<ASSIGN
      3664>>ASSIGN   3665<<ASSIGN   3665>>ASSIGN   3667>>ASSIGN   3673<<ASSIGN   3682>>ASSIGN   3683<<ASSIGN
      3683>>ASSIGN   3686>>CALL     3687<<ASSIGN   3691>>ASSIGN   3714<<ASSIGN   3717>>ASSIGN
REC_DATA_LN
      3395**DCL      3394--IMP-SIZ
REC_DIFF
        38**DCL      3640<<ASSIGN   3657>>IF       3669>>ASSIGN   3670>>ASSIGN   3676>>IF       3693>>IF
      3695>>ASSIGN   3700>>ASSIGN
REC_OFF
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:189  
        36**DCL      3593<<ASSIGN   3594>>ASSIGN   3607>>ASSIGN   3618>>IF       3637<<ASSIGN   3638>>ASSIGN
      3655>>ASSIGN   3666>>ASSIGN   3673>>ASSIGN   3681>>ASSIGN   3687>>ASSIGN   3698>>IF
REC_WRD
        14**DCL        15--REDEF    3596<<ASSIGN   3639<<ASSIGN
REMOVE_BUF
      4244**PROC     4208--CALL
ROLLKEY
        71**DCL        74--REDEF    3874>>ASSIGN   3938>>ASSIGN   3963>>ASSIGN
ROLLKEY.LEN
        72**DCL      3961<<ASSIGN
ROLLKEY.VAL
        73**DCL      3962<<ASSIGN
SHIFT_ARRAY
        93**DCL-ENT  3686--CALL
SHIFT_SZ
        35**DCL      3608<<ASSIGN
STEPCC
      3385**DCL      3753<<ASSIGN
STRING
        28**DCL      3548<<ASSIGN   3609<<ASSIGN   3609>>ASSIGN   3667<<ASSIGN   3667>>ASSIGN   3691<<ASSIGN
      3717<<ASSIGN   3955>>ASSIGN
STR_USER_FIDID
        95**DCL-ENT  3461--CALL
SYS_FUNC_CLOS
        87**DCL-ENT  3790--CALL     3879--CALL
SYS_FUNC_DELREC
        89**DCL-ENT  3830--CALL     3939--CALL
SYS_FUNC_ERRMSG
        84**DCL-ENT  3473--CALL     3542--CALL     3589--CALL     3651--CALL     3752--CALL     3801--CALL
      3838--CALL     3867--CALL     3934--CALL
SYS_FUNC_PREC
        88**DCL-ENT  3965--CALL
SYS_FUNC_READ
        81**DCL-ENT  4078--CALL
SYS_FUNC_WRIT
        82**DCL-ENT  3786--CALL     3875--CALL     4113--CALL
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:190  
TOSTR
        26**DCL      3686<>CALL
USABLE_BUFS
        64**DCL      3425<<ASSIGN   3426>>IF       3427<<ASSIGN   3429>>DOINDEX  3448>>DOINDEX  4189>>IF
USER.CGMSGID
       250**DCL      3905<<ASSIGN
USER.SYSID
       246**DCL      3469>>CALLBLT  3799>>CALLBLT  3835>>CALLBLT  3864>>CALLBLT  3931>>CALLBLT
VFCSF
      3295**DCL      3873<<ASSIGN   4106<<ASSIGN
WAITSF
      3294**DCL      4077<<ASSIGN   4109<<ASSIGN
WRD
        30**DCL      3596>>ASSIGN   3639>>ASSIGN
WRITE_PAGE
      4090**PROC     3450--CALL     4209--CALL
X
      3384**DCL      3429<<DOINDEX  3430>>ASSIGN   3430>>ASSIGN   3431>>ASSIGN   3432>>ASSIGN   3433>>ASSIGN
      3434>>ASSIGN   3435>>ASSIGN   3436>>ASSIGN   3439<<DOINDEX  3440>>ASSIGN   3448<<DOINDEX  3449>>IF
      3449>>IF       3450<>CALL     3515<<DOINDEX  3516>>ASSIGN   3516>>ASSIGN   3525<<ASSIGN   3526>>DOWHILE
      3527<<ASSIGN   3527>>ASSIGN   3529>>ASSIGN   3556<<ASSIGN   3559<<ASSIGN   3560>>ASSIGN   3562>>ASSIGN
      3617<<DOINDEX  3618>>IF       3618>>IF       3620>>ASSIGN   3620>>ASSIGN   3697<<DOINDEX  3698>>IF
      3698>>IF       3700>>ASSIGN   3700>>ASSIGN   3995<<ASSIGN   3997<<ASSIGN   3998>>ASSIGN   4000>>ASSIGN
XBUFS
        67**DCL      3425>>ASSIGN
ZEROS
        18**DCL      3613>>ASSIGN   3671>>ASSIGN
ZERO_SUP
        90**DCL-ENT  3745--CALL     3748--CALL     4027--CALL     4028--CALL
ZI$CGDEL.DCB#
      1957**DCL      3898<>CALL
ZI$CGDEL.USER#
      1956**DCL      3898<>CALL     3905>>ASSIGN
ZI$CGMSG.DCB#
      1921**DCL      3887<>CALL
ZI$CGMSG.MSGATTR.MSGIDXT
PL6.E3A0      #001=ZIU$RPLY File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:191  
      1944**DCL      1947--REDEF
ZI$CGMSG.USER#
      1920**DCL      3887<>CALL
ZIU$CGDEL
       104**DCL-ENT  3904--CALL
ZIU$CGMSG
       103**DCL-ENT  3893--CALL
ZIU$CGOPN
       102**DCL-ENT  3483--CALL     3891--CALL     3902--CALL

PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:192  
      991        1        /*T***********************************************************/
      992        2        /*T*                                                         */
      993        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      994        4        /*T*                                                         */
      995        5        /*T***********************************************************/
      996        6
      997        7        /*
      998        8                 OPEN FILE IN FIDLIST(FIDX)
      999        9        */
     1000       10        OPEN_FID: PROC ALTRET;
     1001       11
     1002       12    1   DCL REC$ PTR SYMREF;
     1003       13    1   DCL 1 FD BASED(REC$),
     1004       14    1         2 NAME CHAR(32) UNAL,
     1005       15    1         2 ACNT CHAR(8) UNAL,
     1006       16    1         2 PASS CHAR(8) UNAL,
     1007       17    1         2 PSN CHAR(6) UNAL,
     1008       18    1         2 ORG# UBIN BYTE UNAL,
     1009       19    1         2 * CHAR(5) UNAL,
     1010       20    1         2 DCB# UBIN HALF UNAL;
     1011       21    1   DCL B$TCB$ PTR SYMREF;
     1012       22
     1013       23
     1014       24         %INCLUDE ZI_DBU_ROLL;
     1015      108         %ROLL_SUBS;
     1016      127         %ROLL_LIST;
     1017      186         %INCLUDE ZI_GLOBAL_DBUTIL;
     1018      364         %SYS_FUNC;
     1019      456         %INCLUDE CP_6_SUBS;
     1020      996         %INCLUDE ZI_ERRORS_SUBS;
     1021     1516         %INCLUDE CP_6;
     1022     1597         %F$DCB;
     1023     1654         %B$TCB;
     1024     1657         %B$EXCFR;
     1025     1675         %FPT_OPEN;
     1026     1784         %VLP_SN(FPTN=PSN,N=1);
     1027     1797         %INCLUDE B_ERRORS_C;
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:193  
     1028     2924
     1029     2925    1   DCL DE_QUE ENTRY(1);
     1030     2926    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
     1031     2927    1   DCL SYS_FUNC_RELDCB ENTRY ALTRET;
     1032     2928    1   DCL XSF$LOCCODT ENTRY(2) ALTRET;
     1033     2929    1   DCL FIT$ PTR SYMREF ALIGNED;
     1034     2930    1   DCL CODE7 UBIN SYMREF ALIGNED;
     1035     2931    1   DCL FILE_INFO(0:1023) UBIN SYMREF ALIGNED;
     1036     2932         %INCLUDE FM$FIT;
     1037     3153         %CODE07(BASED="BASED(FIT$)");
     1038     3156
     1039     3157    1       REC$ = ADDR(FIDLIST(FIDX));
     1040     3158
     1041     3159    1       DCBSF = FD.DCB#;
     1042     3160    1       IF DCBADDR(DCBSF) -> F$DCB.FCD# = %YES# THEN
     1043     3161    1           RETURN; /* File is open already */
     1044     3162
     1045     3163    1       PSN.SN#(0) = FD.PSN;
     1046     3164    1       FPT_OPEN.IFPARAM_ = VECTOR(NIL);
     1047     3165    1       FPT_OPEN.FPARAM_ = VECTOR(FILE_INFO);
     1048     3166    1       FPT_OPEN.V.OPER.TEST# = TESTSF;
     1049     3167    1       FPT_OPEN.NAME_ = VECTOR(FD.NAME);
     1050     3168    1       FPT_OPEN.PASS_ = VECTOR(FD.PASS);
     1051     3169    1       FPT_OPEN.ACCT_ = VECTOR(FD.ACNT);
     1052     3170    1       FPT_OPEN.SN_ = VECTOR(PSN);
     1053     3171    1       FPT_OPEN.V.DCB#= FD.DCB#;
     1054     3172    1       FPT_OPEN.V.ORG#= FD.ORG#;
     1055     3173    1       FPT_OPEN.V.FUN#= %UPDATE#;
     1056     3174    1       FPT_OPEN.V.ASN#= %FILE#;
     1057     3175    1       FPT_OPEN.V.ACS#= %DIRECT#;
     1058     3176
     1059     3177    1       CALL M$OPEN(FPT_OPEN) ALTRET(ALTOPEN);
     1060     3178    1       RETURN;
     1061     3179    1   ALTOPEN:
     1062     3180    1       IF FD.PASS ~= ' ' THEN
     1063     3181    2       DO;
     1064     3182    2           FIT$=ADDR(FILE_INFO);
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:194  
     1065     3183    2           CALL XSF$LOCCODT(FIT$, CODE7) ALTRET(ALT_ERR);
     1066     3184    2           CODE07.PASS = FD.PASS;
     1067     3185    2           CALL M$OPEN(FPT_OPEN) ALTRET(ALT_ERR);
     1068     3186    2           RETURN;
     1069     3187    2           END;
     1070     3188    1   ALT_ERR:
     1071     3189    1       MONITOR_ERR = B$TCB$->B$TCB.ALT$->B$EXCFR.ERR;
     1072     3190    1       INCL_ERR = %YES#;
     1073     3191    1       CALL SYS_FUNC_ERRMSG;
     1074     3192    1       CALL DE_QUE(FIDX);
     1075     3193    1       FIDLIST.DCB#(FIDX) = 0;
     1076     3194    1       CALL SYS_FUNC_RELDCB;
     1077     3195    1       ALTRETURN;
     1078     3196    1   END OPEN_FID;
     1079     3197        %EOD;

PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:195  
--  Include file information  --

   FM$FIT.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI_ERRORS_SUBS.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI_DBU_ROLL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure OPEN_FID.

   Procedure OPEN_FID requires 103 words for executable code.
   Procedure OPEN_FID requires 4 words of local(AUTO) storage.

PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:196  

 Object Unit name= OPEN_FID                                   File name= ZIU$RPLY.:ZIC0TOU
 UTS= SEP 05 '97 13:31:43.08 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none    62     76  OPEN_FID
    2   Proc  even  none   103    147  OPEN_FID
    3  RoData even  none    17     21  OPEN_FID

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        0  OPEN_FID

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 XSF$LOCCODT
         yes           Std       1 DE_QUE
 yes     yes           Std       0 SYS_FUNC_RELDCB
 yes     yes           Std       0 SYS_FUNC_ERRMSG
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:197  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     REC$                                  B$TCB$                                FID$
     DCBLIST$                              USER$                                 FID_INDXS$
     FID_INDXS                             NXT_AVIL_FIDSLOT                      NXT_AVIL_DCBSLOT
     LAST_UNUSED_DCBSLOT                   USER                                  NO
     FIRST                                 LAST                                  MAX_DCBINDX
     MAX_FIDINDX                           FIDX                                  DCBX
     BRK_ROLL                              BLKLSF                                KEYLSF
     KEYXSF                                DCBSF                                 ORGSF
     KEYSF                                 KEYVSF                                ACSSF
     NOTIMESF                              FUNSF                                 ASNSF
     TESTSF                                XTENSIZESF                            DISPSF
     WAITSF                                VFCSF                                 FULLSF
     BKUPSF                                BUFLNSF                               BUFSF
     SOURCESF                              DESTSF                                DATESF
     TIMESF                                UTSSF                                 DAYSF
     TSTAMPSF                              ENCRP_SEEDSF                          ERRCODESF
     MSGCODE                               INCL_ERR                              ERR_INSERT
     FIDSF_RD                              ACNT                                  EXISTSF
     SHARESF                               DCBNMSF                               KEYRSF
     NO_KEYSF                              REASGNSF                              CARRY_ATTRIBUTESF
     SUBMESSF                              SPKY_OPNSF                            POSSF
     ERRFLGSF                              MERGESF                               FSA_FLAG
     RELGSF                                UNUSED                                HELPCODE
     COUNTSF                               INDEXSF                               GAP
     PSNSF                                 ACNTSF                                KEY_SHADWSF
     M$UC                                  FIT$                                  CODE7
     FILE_INFO
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:198  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:199  


      991        1        /*T***********************************************************/
      992        2        /*T*                                                         */
      993        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      994        4        /*T*                                                         */
      995        5        /*T***********************************************************/
      996        6
      997        7        /*
      998        8                 OPEN FILE IN FIDLIST(FIDX)
      999        9        */
     1000       10        OPEN_FID: PROC ALTRET;

     10  2 000000   000000 700200 xent  OPEN_FID     TSX0  ! X66_AUTO_0
         2 000001   000004 000000                    ZERO    4,0

     1001       11
     1002       12    1   DCL REC$ PTR SYMREF;
     1003       13    1   DCL 1 FD BASED(REC$),
     1004       14    1         2 NAME CHAR(32) UNAL,
     1005       15    1         2 ACNT CHAR(8) UNAL,
     1006       16    1         2 PASS CHAR(8) UNAL,
     1007       17    1         2 PSN CHAR(6) UNAL,
     1008       18    1         2 ORG# UBIN BYTE UNAL,
     1009       19    1         2 * CHAR(5) UNAL,
     1010       20    1         2 DCB# UBIN HALF UNAL;
     1011       21    1   DCL B$TCB$ PTR SYMREF;
     1012       22
     1013       23
     1014       24         %INCLUDE ZI_DBU_ROLL;
     1015      108         %ROLL_SUBS;
     1016      127         %ROLL_LIST;
     1017      186         %INCLUDE ZI_GLOBAL_DBUTIL;
     1018      364         %SYS_FUNC;
     1019      456         %INCLUDE CP_6_SUBS;
     1020      996         %INCLUDE ZI_ERRORS_SUBS;
     1021     1516         %INCLUDE CP_6;
     1022     1597         %F$DCB;
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:200  
     1023     1654         %B$TCB;
     1024     1657         %B$EXCFR;
     1025     1675         %FPT_OPEN;
     1026     1784         %VLP_SN(FPTN=PSN,N=1);
     1027     1797         %INCLUDE B_ERRORS_C;
     1028     2924
     1029     2925    1   DCL DE_QUE ENTRY(1);
     1030     2926    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
     1031     2927    1   DCL SYS_FUNC_RELDCB ENTRY ALTRET;
     1032     2928    1   DCL XSF$LOCCODT ENTRY(2) ALTRET;
     1033     2929    1   DCL FIT$ PTR SYMREF ALIGNED;
     1034     2930    1   DCL CODE7 UBIN SYMREF ALIGNED;
     1035     2931    1   DCL FILE_INFO(0:1023) UBIN SYMREF ALIGNED;
     1036     2932         %INCLUDE FM$FIT;
     1037     3153         %CODE07(BASED="BASED(FIT$)");
     1038     3156
     1039     3157    1       REC$ = ADDR(FIDLIST(FIDX));

   3157  2 000002   000000 236000 xsym               LDQ     FIDX
         2 000003   000021 402003                    MPY     17,DU
         2 000004   000000 036000 xsym               ADLQ    FID$
         2 000005   000000 756000 xsym               STQ     REC$

     1040     3158
     1041     3159    1       DCBSF = FD.DCB#;

   3159  2 000006   000000 470400 xsym               LDP0    REC$
         2 000007   000000 100500                    MLR     fill='000'O
         2 000010   000017 000002                    ADSC9   15,,PR0                  cn=0,n=2
         2 000011   000000 000002 xsym               ADSC9   DCBSF                    cn=0,n=2

     1042     3160    1       IF DCBADDR(DCBSF) -> F$DCB.FCD# = %YES# THEN

   3160  2 000012   000000 471400 3                  LDP1    0
         2 000013   100000 473500                    LDP3    0,,PR1
         2 000014   000000 220000 xsym               LDX0    DCBSF
         2 000015   300000 474510                    LDP4    0,X0,PR3
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:201  
         2 000016   400031 236100                    LDQ     25,,PR4
         2 000017   020000 316007                    CANQ    8192,DL
         2 000020   000022 600000 2                  TZE     s:3163

     1043     3161    1           RETURN; /* File is open already */

   3161  2 000021   000000 702200 xent               TSX2  ! X66_ARET

     1044     3162
     1045     3163    1       PSN.SN#(0) = FD.PSN;

   3163  2 000022   040000 100500                    MLR     fill='040'O
         2 000023   000014 000006                    ADSC9   12,,PR0                  cn=0,n=6
         2 000024   000073 000006 1                  ADSC9   PSN+1                    cn=0,n=6

     1046     3164    1       FPT_OPEN.IFPARAM_ = VECTOR(NIL);

   3164  2 000025   000002 237000 3                  LDAQ    2
         2 000026   000026 757000 1                  STAQ    FPT_OPEN+22

     1047     3165    1       FPT_OPEN.FPARAM_ = VECTOR(FILE_INFO);

   3165  2 000027   000004 237000 3                  LDAQ    4
         2 000030   000030 757000 1                  STAQ    FPT_OPEN+24

     1048     3166    1       FPT_OPEN.V.OPER.TEST# = TESTSF;

   3166  2 000031   000000 236000 xsym               LDQ     TESTSF
         2 000032   000026 772000                    QRL     22
         2 000033   000044 676000 1                  ERQ     FPT_OPEN+36
         2 000034   020000 376007                    ANQ     8192,DL
         2 000035   000044 656000 1                  ERSQ    FPT_OPEN+36

     1049     3167    1       FPT_OPEN.NAME_ = VECTOR(FD.NAME);

   3167  2 000036   000006 235000 3                  LDA     6
         2 000037   000000 236000 xsym               LDQ     REC$
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:202  
         2 000040   000006 757000 1                  STAQ    FPT_OPEN+6

     1050     3168    1       FPT_OPEN.PASS_ = VECTOR(FD.PASS);

   3168  2 000041   000007 235000 3                  LDA     7
         2 000042   000000 236000 xsym               LDQ     REC$
         2 000043   000012 036003                    ADLQ    10,DU
         2 000044   000010 757000 1                  STAQ    FPT_OPEN+8

     1051     3169    1       FPT_OPEN.ACCT_ = VECTOR(FD.ACNT);

   3169  2 000045   000007 235000 3                  LDA     7
         2 000046   000000 236000 xsym               LDQ     REC$
         2 000047   000010 036003                    ADLQ    8,DU
         2 000050   000024 757000 1                  STAQ    FPT_OPEN+20

     1052     3170    1       FPT_OPEN.SN_ = VECTOR(PSN);

   3170  2 000051   000010 237000 3                  LDAQ    8
         2 000052   000002 757000 1                  STAQ    FPT_OPEN+2

     1053     3171    1       FPT_OPEN.V.DCB#= FD.DCB#;

   3171  2 000053   000000 100500                    MLR     fill='000'O
         2 000054   000017 000002                    ADSC9   15,,PR0                  cn=0,n=2
         2 000055   000044 000002 1                  ADSC9   FPT_OPEN+36              cn=0,n=2

     1054     3172    1       FPT_OPEN.V.ORG#= FD.ORG#;

   3172  2 000056   000000 100500                    MLR     fill='000'O
         2 000057   000015 400001                    ADSC9   13,,PR0                  cn=2,n=1
         2 000060   000046 400001 1                  ADSC9   FPT_OPEN+38              cn=2,n=1

     1055     3173    1       FPT_OPEN.V.FUN#= %UPDATE#;

   3173  2 000061   001000 236007                    LDQ     512,DL
         2 000062   000045 552010 1                  STBQ    FPT_OPEN+37,'10'O
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:203  

     1056     3174    1       FPT_OPEN.V.ASN#= %FILE#;

   3174  2 000063   000001 236007                    LDQ     1,DL
         2 000064   000045 552004 1                  STBQ    FPT_OPEN+37,'04'O

     1057     3175    1       FPT_OPEN.V.ACS#= %DIRECT#;

   3175  2 000065   000002 236007                    LDQ     2,DL
         2 000066   000046 552004 1                  STBQ    FPT_OPEN+38,'04'O

     1058     3176
     1059     3177    1       CALL M$OPEN(FPT_OPEN) ALTRET(ALTOPEN);

   3177  2 000067   000000 630400 1                  EPPR0   FPT_OPEN
         2 000070   450000 713400                    CLIMB   alt,open
         2 000071   410400 401760                    pmme    nvectors=18
         2 000072   000074 702000 2                  TSX2    ALTOPEN

     1060     3178    1       RETURN;

   3178  2 000073   000000 702200 xent               TSX2  ! X66_ARET

     1061     3179    1   ALTOPEN:
     1062     3180    1       IF FD.PASS ~= ' ' THEN

   3180  2 000074   000000 470400 xsym  ALTOPEN      LDP0    REC$
         2 000075   040000 106500                    CMPC    fill='040'O
         2 000076   000012 000010                    ADSC9   10,,PR0                  cn=0,n=8
         2 000077   000012 000001 3                  ADSC9   10                       cn=0,n=1
         2 000100   000121 600000 2                  TZE     ALT_ERR

     1063     3181    2       DO;

     1064     3182    2           FIT$=ADDR(FILE_INFO);

   3182  2 000101   000005 236000 3                  LDQ     5
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:204  
         2 000102   000000 756000 xsym               STQ     FIT$

     1065     3183    2           CALL XSF$LOCCODT(FIT$, CODE7) ALTRET(ALT_ERR);

   3183  2 000103   000014 630400 3                  EPPR0   12
         2 000104   000013 631400 3                  EPPR1   11
         2 000105   000000 701000 xent               TSX1    XSF$LOCCODT
         2 000106   000121 702000 2                  TSX2    ALT_ERR

     1066     3184    2           CODE07.PASS = FD.PASS;

   3184  2 000107   000000 470400 xsym               LDP0    REC$
         2 000110   000000 471400 xsym               LDP1    FIT$
         2 000111   040100 100500                    MLR     fill='040'O
         2 000112   000012 000010                    ADSC9   10,,PR0                  cn=0,n=8
         2 000113   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8

     1067     3185    2           CALL M$OPEN(FPT_OPEN) ALTRET(ALT_ERR);

   3185  2 000114   000000 630400 1                  EPPR0   FPT_OPEN
         2 000115   450000 713400                    CLIMB   alt,open
         2 000116   410400 401760                    pmme    nvectors=18
         2 000117   000121 702000 2                  TSX2    ALT_ERR

     1068     3186    2           RETURN;

   3186  2 000120   000000 702200 xent               TSX2  ! X66_ARET

     1069     3187    2           END;
     1070     3188    1   ALT_ERR:
     1071     3189    1       MONITOR_ERR = B$TCB$->B$TCB.ALT$->B$EXCFR.ERR;

   3189  2 000121   000000 470400 xsym  ALT_ERR      LDP0    B$TCB$
         2 000122   000000 471500                    LDP1    0,,PR0
         2 000123   100102 236100                    LDQ     66,,PR1
         2 000124   000000 756000 xsym               STQ     MSGCODE

PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:205  
     1072     3190    1       INCL_ERR = %YES#;

   3190  2 000125   400000 236003                    LDQ     -131072,DU
         2 000126   000000 756000 xsym               STQ     INCL_ERR

     1073     3191    1       CALL SYS_FUNC_ERRMSG;

   3191  2 000127   000016 631400 3                  EPPR1   14
         2 000130   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         2 000131   000000 011000                    NOP     0

     1074     3192    1       CALL DE_QUE(FIDX);

   3192  2 000132   000020 630400 3                  EPPR0   16
         2 000133   000017 631400 3                  EPPR1   15
         2 000134   000000 701000 xent               TSX1    DE_QUE
         2 000135   000000 011000                    NOP     0

     1075     3193    1       FIDLIST.DCB#(FIDX) = 0;

   3193  2 000136   000000 236000 xsym               LDQ     FIDX
         2 000137   000021 402007                    MPY     17,DL
         2 000140   000000 220003                    LDX0    0,DU
         2 000141   000000 470400 xsym               LDP0    FID$
         2 000142   000017 740106                    STX0    15,QL,PR0

     1076     3194    1       CALL SYS_FUNC_RELDCB;

   3194  2 000143   000016 631400 3                  EPPR1   14
         2 000144   000000 701000 xent               TSX1    SYS_FUNC_RELDCB
         2 000145   000000 011000                    NOP     0

     1077     3195    1       ALTRETURN;

   3195  2 000146   000000 702200 xent               TSX2  ! X66_AALT

FPT_OPEN
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:206  
 Sect OctLoc
   1     000   000025 777640   000044 006000   000000 177640   000000 006014    .....$..........
   1     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     044*  000000 000042   000000 000000   252525 000000   000040 252520    ..."......... ..
   1     050   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1     054   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     060   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     064   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     070   000000 000000   ****** ******                                    ........

PSN
 Sect OctLoc
   1     072   000000 000001   040040 040040   040040 ******                    ....      ..

(unnamed)
 Sect OctLoc
   3     000   000000 006003   000000 000000   000000 177640   000000 006014    ................
   3     004   001777 777640   000000 006000   000007 777640   000001 777640    ................
   3     010   000003 777640   000072 006000   040040 040040   000002 000000    .....:..    ....
   3     014   000000 006000   000000 006000   000000 000000   000001 000000    ................
   3     020   000000 006000                                                    ....
     1078     3196    1   END OPEN_FID;
     1079     3197        %EOD;

PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:207  
--  Include file information  --

   FM$FIT.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI_ERRORS_SUBS.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI_DBU_ROLL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure OPEN_FID.

   Procedure OPEN_FID requires 103 words for executable code.
   Procedure OPEN_FID requires 4 words of local(AUTO) storage.
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:208  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:209  
          MINI XREF LISTING

ALTOPEN
      3180**LABEL    3177--CALLALT
ALT_ERR
      3189**LABEL    3183--CALLALT  3185--CALLALT
B$EXCFR.ASL
      1658**DCL      1658--REDEF
B$EXCFR.ERR
      1672**DCL      3189>>ASSIGN
B$EXCFR.ERR.ERR#
      1672**DCL      1672--REDEF
B$EXCFR.EVID
      1671**DCL      1671--REDEF    1672--REDEF
B$EXCFR.IR
      1659**DCL      1659--REDEF
B$EXCFR.PREVSZ
      1658**DCL      1658--REDEF
B$EXCFR.SUBC
      1670**DCL      1670--REDEF    1671--REDEF    1671--REDEF
B$TCB.ALT$
      1655**DCL      3189>>ASSIGN
B$TCB$
        21**DCL      3189>>ASSIGN
CODE07.PASS
      3154**DCL      3184<<ASSIGN
CODE7
      2930**DCL      3183<>CALL
COUNTSF
       445**DCL       446--REDEF
DCBLIST$
       135**DCL       158--IMP-PTR
DCBSF
       374**DCL      3159<<ASSIGN   3160--IF
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:210  
DE_QUE
      2925**DCL-ENT  3192--CALL
ENCRP_SEEDSF
       403**DCL       404--REDEF
ERRCODESF
       405**DCL       410--REDEF
F$DCB.ACTPOS
      1630**DCL      1630--REDEF
F$DCB.ARS#
      1604**DCL      1604--REDEF
F$DCB.ATTR
      1623**DCL      1624--REDEF
F$DCB.BORROW
      1638**DCL      1638--REDEF    1638--REDEF    1638--REDEF
F$DCB.DCBNAME.L
      1652**DCL      1652--IMP-SIZ
F$DCB.EOMCHAR#
      1608**DCL      1608--REDEF
F$DCB.FCD#
      1617**DCL      3160>>IF
F$DCB.FLDID
      1633**DCL      1633--REDEF
F$DCB.FORM$
      1627**DCL      1627--REDEF
F$DCB.FSECT
      1643**DCL      1643--REDEF
F$DCB.FSN#
      1620**DCL      1620--REDEF    1620--REDEF    1621--REDEF
F$DCB.HEADER$
      1626**DCL      1626--REDEF
F$DCB.IXTNSIZE#
      1624**DCL      1624--REDEF
F$DCB.LASTSTA$
      1613**DCL      1613--REDEF
F$DCB.LVL
      1639**DCL      1639--REDEF
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:211  
F$DCB.NAME#.C
      1614**DCL      1614--REDEF
F$DCB.NOEOF
      1636**DCL      1636--REDEF
F$DCB.NRECS#
      1625**DCL      1625--REDEF
F$DCB.NRECX
      1644**DCL      1644--REDEF
F$DCB.OHDR
      1636**DCL      1636--REDEF
F$DCB.ORG#
      1619**DCL      1619--REDEF
F$DCB.PRECNO
      1642**DCL      1642--REDEF
F$DCB.RCSZ
      1648**DCL      1648--REDEF
F$DCB.RES#
      1615**DCL      1615--REDEF
F$DCB.SETX
      1627**DCL      1627--REDEF
F$DCB.TAB$
      1627**DCL      1627--REDEF
F$DCB.TDA
      1641**DCL      1642--REDEF
F$DCB.WSN#
      1615**DCL      1615--REDEF
FD.ACNT
        15**DCL      3169--ASSIGN
FD.DCB#
        20**DCL      3159>>ASSIGN   3171>>ASSIGN
FD.NAME
        14**DCL      3167--ASSIGN
FD.ORG#
        18**DCL      3172>>ASSIGN
FD.PASS
        16**DCL      3168--ASSIGN   3180>>IF       3184>>ASSIGN
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:212  
FD.PSN
        17**DCL      3163>>ASSIGN
FID$
       134**DCL       138--IMP-PTR  3157>>ASSIGN   3193>>ASSIGN
FIDLIST
       138**DCL      3157--ASSIGN
FIDLIST.CRPT
       147**DCL       148--REDEF
FIDLIST.DCB#
       149**DCL      3193<<ASSIGN
FIDSF_RD
       421**DCL       422--REDEF
FIDX
       182**DCL      3157>>ASSIGN   3192<>CALL     3193>>ASSIGN
FILE_INFO
      2931**DCL      3165--ASSIGN   3182--ASSIGN
FIT$
      2929**DCL      3154--IMP-PTR  3182<<ASSIGN   3183<>CALL     3184>>ASSIGN
FPT_OPEN
      1740**DCL      3177<>CALL     3185<>CALL
FPT_OPEN.ACCT_
      1744**DCL      3169<<ASSIGN
FPT_OPEN.ACSVEH_
      1742**DCL      1743--REDEF
FPT_OPEN.ALTKEYS_
      1748**DCL      1749--REDEF    1749--REDEF
FPT_OPEN.FPARAM_
      1745**DCL      3165<<ASSIGN
FPT_OPEN.HDR_
      1747**DCL      1748--REDEF
FPT_OPEN.IFPARAM_
      1745**DCL      3164<<ASSIGN
FPT_OPEN.NAME_
      1741**DCL      3167<<ASSIGN
FPT_OPEN.PASS_
      1742**DCL      3168<<ASSIGN
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:213  
FPT_OPEN.SN_
      1740**DCL      3170<<ASSIGN
FPT_OPEN.TAB_
      1746**DCL      1747--REDEF
FPT_OPEN.UHL_
      1740**DCL      1741--REDEF    1741--REDEF
FPT_OPEN.V
      1749**DCL      1740--DCLINIT
FPT_OPEN.V.ACS#
      1760**DCL      3175<<ASSIGN
FPT_OPEN.V.ASN#
      1759**DCL      3174<<ASSIGN
FPT_OPEN.V.DCB#
      1749**DCL      3171<<ASSIGN
FPT_OPEN.V.FSN#
      1780**DCL      1780--REDEF    1780--REDEF
FPT_OPEN.V.FUN#
      1759**DCL      3173<<ASSIGN
FPT_OPEN.V.OPER.TEST#
      1751**DCL      3166<<ASSIGN
FPT_OPEN.V.ORG#
      1760**DCL      3172<<ASSIGN
FPT_OPEN.WSN_
      1746**DCL      1746--REDEF
HELPCODE
       439**DCL       444--REDEF
INCL_ERR
       417**DCL      3190<<ASSIGN
KEYVSF
       377**DCL       382--REDEF
KEYVSF.WD_ONE
       379**DCL       380--REDEF
M$OPEN
      1525**DCL-ENT  3177--CALL     3185--CALL
MONITOR_ERR
       412**DCL      3189<<ASSIGN
PL6.E3A0      #002=OPEN_FID File=ZIU$RPLY.:ZIC0TSI                               FRI 09/05/97 13:31 Page:214  
MSGCODE
       411**DCL       412--REDEF
PSN
      1795**DCL      3170--ASSIGN
PSN.SN#
      1795**DCL      3163<<ASSIGN
REC$
        12**DCL        13--IMP-PTR  3157<<ASSIGN   3159>>ASSIGN   3163>>ASSIGN   3167>>ASSIGN   3168>>ASSIGN
      3169>>ASSIGN   3171>>ASSIGN   3172>>ASSIGN   3180>>IF       3184>>ASSIGN
SYS_FUNC_ERRMSG
      2926**DCL-ENT  3191--CALL
SYS_FUNC_RELDCB
      2927**DCL-ENT  3194--CALL
TESTSF
       387**DCL      3166>>ASSIGN
XSF$LOCCODT
      2928**DCL-ENT  3183--CALL

PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:215  
     1080        1        /*M* ZIU$EVENT   IDSII  NOWAIT I-O  EVENT CONTROL    */
     1081        2        /*T***********************************************************/
     1082        3        /*T*                                                         */
     1083        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1084        5        /*T*                                                         */
     1085        6        /*T***********************************************************/
     1086        7        ZIU$EVENT: PROC ASYNC;
     1087        8
     1088        9    1   DCL 1 BUFTBL (0:255) SYMREF UNAL,
     1089       10    1         2 PTR$ PTR UNAL,
     1090       11    1         2 PGNO UBIN WORD UNAL,
     1091       12    1         2 FIDX SBIN HALF UNAL,
     1092       13    1         2 NXTHSH SBIN BYTE UNAL,
     1093       14    1         2 BUSY BIT(1) UNAL,
     1094       15    1         2 * BIT(8) UNAL,
     1095       16    1         2 Q,
     1096       17    1           3 PRI SBIN HALF UNAL,
     1097       18    1           3 NXT SBIN HALF UNAL;
     1098       19
     1099       20         %INCLUDE CP_6;
     1100      101         %B$EVNT;
     1101      114         %B$EXCFR;
     1102      132         %B$TCB;
     1103      135         %B$ECCB;
     1104      143         %B$NWIO;
     1105      228         %SUB_EXC;
     1106      275         %INCLUDE CP_6_SUBS;
     1107      815         %INCLUDE ZI_GLOBAL_DBUTIL;
     1108      993         %SYS_FUNC;
     1109     1085         %MISC_DCLS;
     1110     1138
     1111     1139    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
     1112     1140    1   DCL B$ECCB$ PTR SYMREF;
     1113     1141    1   DCL STK$ PTR STATIC;
     1114     1142
     1115     1143    1       STK$ = B$TCB$ -> B$TCB.STK$;
     1116     1144
PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:216  
     1117     1145    2       DO INHIBIT;
     1118     1146    3           DO CASE(STK$->B$EXCFR.ECC); /* EXECP COND FRAME SHOULD BE I-O EVENT */
     1119     1147    3           CASE(%ECC_EVENT#);
     1120     1148    3               IF STK$ -> B$NWIO.EVID <= 255 AND
     1121     1149    3                  STK$ -> B$NWIO.ERR.CODE = 0 THEN
     1122     1150    4               DO;
     1123     1151    4                   BUFTBL.BUSY(STK$ -> B$NWIO.EVID) = %NO#;
     1124     1152    4                   END;
     1125     1153    4               ELSE DO;
     1126     1154         /*E* ERROR: ZIU-DBU#NWIO-C
     1127     1155                            MESSAGE: NO WAIT I/O ERROR - condition code %U1 */
     1128     1156    4                   CALL BINCHAR(ERR_INSERT.TEXT(0),STK$->B$NWIO.ERR.CODE);
     1129     1157    4                   ERR_INSERT.CNT(0) = 10;
     1130     1158    4                   CALL SYS_FUNC_ERRMSG;
     1131     1159    4                   END;
     1132     1160    3               RETURN;
     1133     1161
     1134     1162    3           CASE(ELSE);
     1135     1163
     1136     1164    3               END; /*CASE */
     1137     1165    2           END; /* INHIBIT */
     1138     1166    1   END ZIU$EVENT;

PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:217  
--  Include file information  --

   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$EVENT.

   Procedure ZIU$EVENT requires 38 words for executable code.
   Procedure ZIU$EVENT requires 6 words of local(AUTO) storage.

    No errors detected in file ZIU$RPLY.:ZIC0TSI    .

PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:218  

 Object Unit name= ZIU$EVENT                                  File name= ZIU$RPLY.:ZIC0TOU
 UTS= SEP 05 '97 13:31:55.32 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$LO
    2   Data  even  none     1      1  ZIU$EVENT
    3   Proc  even  none    38     46  ZIU$EVENT
    4  RoData even  none     2      2  ZIU$EVENT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes            yes     Async       0  ZIU$EVENT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 SYS_FUNC_ERRMSG
                       nStd      0 X66_AAUTO
                       nStd      0 X66_AARET
PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:219  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     BUFTBL                                M$UC                                  BLKLSF
     KEYLSF                                KEYXSF                                DCBSF
     ORGSF                                 KEYSF                                 KEYVSF
     ACSSF                                 NOTIMESF                              FUNSF
     ASNSF                                 TESTSF                                XTENSIZESF
     DISPSF                                WAITSF                                VFCSF
     FULLSF                                BKUPSF                                BUFLNSF
     BUFSF                                 SOURCESF                              DESTSF
     DATESF                                TIMESF                                UTSSF
     DAYSF                                 TSTAMPSF                              ENCRP_SEEDSF
     ERRCODESF                             MSGCODE                               INCL_ERR
     ERR_INSERT                            FIDSF_RD                              ACNT
     EXISTSF                               SHARESF                               DCBNMSF
     KEYRSF                                NO_KEYSF                              REASGNSF
     CARRY_ATTRIBUTESF                     SUBMESSF                              SPKY_OPNSF
     POSSF                                 ERRFLGSF                              MERGESF
     FSA_FLAG                              RELGSF                                UNUSED
     HELPCODE                              COUNTSF                               INDEXSF
     GAP                                   PSNSF                                 ACNTSF
     KEY_SHADWSF                           REC$                                  RB
     RE                                    IE                                    IB
     CNT                                   ICNT                                  RCNT
     SCNT                                  FIRST_SET                             RETCNT
     DMPCNT                                KCNT                                  ACNT_IDX
     I                                     J                                     K
     X                                     STEPCC                                I_O_BUF$
     OUT_INDX                              I_O_SIZE                              REC_DATA_LN
     M$LO                                  B$TCB$                                B$ROS$
     B$JIT$                                KEYFID                                I_O_KEY
     RESTART                               BREAK_FLAG                            ICHKSUM
     ITMCNT                                GAP1                                  B$ECCB$
PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:220  


     1080        1        /*M* ZIU$EVENT   IDSII  NOWAIT I-O  EVENT CONTROL    */
     1081        2        /*T***********************************************************/
     1082        3        /*T*                                                         */
     1083        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1084        5        /*T*                                                         */
     1085        6        /*T***********************************************************/
     1086        7        ZIU$EVENT: PROC ASYNC;

      7  3 000000   000000 700200 xent  ZIU$EVENT    TSX0  ! X66_AAUTO
         3 000001   000006 000000                    ZERO    6,0

     1087        8
     1088        9    1   DCL 1 BUFTBL (0:255) SYMREF UNAL,
     1089       10    1         2 PTR$ PTR UNAL,
     1090       11    1         2 PGNO UBIN WORD UNAL,
     1091       12    1         2 FIDX SBIN HALF UNAL,
     1092       13    1         2 NXTHSH SBIN BYTE UNAL,
     1093       14    1         2 BUSY BIT(1) UNAL,
     1094       15    1         2 * BIT(8) UNAL,
     1095       16    1         2 Q,
     1096       17    1           3 PRI SBIN HALF UNAL,
     1097       18    1           3 NXT SBIN HALF UNAL;
     1098       19
     1099       20         %INCLUDE CP_6;
     1100      101         %B$EVNT;
     1101      114         %B$EXCFR;
     1102      132         %B$TCB;
     1103      135         %B$ECCB;
     1104      143         %B$NWIO;
     1105      228         %SUB_EXC;
     1106      275         %INCLUDE CP_6_SUBS;
     1107      815         %INCLUDE ZI_GLOBAL_DBUTIL;
     1108      993         %SYS_FUNC;
     1109     1085         %MISC_DCLS;
     1110     1138
     1111     1139    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:221  
     1112     1140    1   DCL B$ECCB$ PTR SYMREF;
     1113     1141    1   DCL STK$ PTR STATIC;
     1114     1142
     1115     1143    1       STK$ = B$TCB$ -> B$TCB.STK$;

   1143  3 000002   000000 470400 xsym               LDP0    B$TCB$
         3 000003   000001 236100                    LDQ     1,,PR0
         3 000004   000000 756000 2                  STQ     STK$

     1116     1144
     1117     1145    2       DO INHIBIT;

     1118     1146    3           DO CASE(STK$->B$EXCFR.ECC); /* EXECP COND FRAME SHOULD BE I-O EVENT */

   1146  3 000005   000000 471600 2                  LDP1  ! STK$
         3 000006   100000 720300                    LXL0  ! 0,,PR1
         3 000007   000002 100203                    CMPX0 ! 2,DU
         3 000010   000012 602210 3                  TNC   ! s:1146+5,X0
         3 000011   000045 710200 3                  TRA   ! s:1166
         3 000012   000045 710200 3                  TRA   ! s:1166
         3 000013   000014 710200 3                  TRA   ! s:1148

     1119     1147    3           CASE(%ECC_EVENT#);

     1120     1148    3               IF STK$ -> B$NWIO.EVID <= 255 AND

   1148  3 000014   100101 235300                    LDA   ! 65,,PR1
         3 000015   000400 115207                    CMPA  ! 256,DL
         3 000016   000027 603200 3                  TRC   ! s:1156
         3 000017   100102 236300                    LDQ   ! 66,,PR1
         3 000020   377770 316207                    CANQ  ! 131064,DL
         3 000021   000027 601200 3                  TNZ   ! s:1156

     1121     1149    3                  STK$ -> B$NWIO.ERR.CODE = 0 THEN
     1122     1150    4               DO;

     1123     1151    4                   BUFTBL.BUSY(STK$ -> B$NWIO.EVID) = %NO#;
PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:222  

   1151  3 000022   100101 235300                    LDA   ! 65,,PR1
         3 000023   000002 735200                    ALS   ! 2
         3 000024   000000 236200 4                  LDQ   ! 0
         3 000025   000002 356205 xsym               ANSQ  ! BUFTBL+2,AL

     1124     1152    4                   END;

   1152  3 000026   000044 710200 3                  TRA   ! s:1160

     1125     1153    4               ELSE DO;

     1126     1154         /*E* ERROR: ZIU-DBU#NWIO-C
     1127     1155                            MESSAGE: NO WAIT I/O ERROR - condition code %U1 */
     1128     1156    4                   CALL BINCHAR(ERR_INSERT.TEXT(0),STK$->B$NWIO.ERR.CODE);

   1156  3 000027   100102 236300                    LDQ   ! 66,,PR1
         3 000030   000003 772200                    QRL   ! 3
         3 000031   037777 376207                    ANQ   ! 16383,DL
         3 000032   000000 235203                    LDA   ! 0,DU
         3 000033   200004 757300                    STAQ  ! 4,,AUTO
         3 000034   000000 301700                    BTD   !
         3 000035   200004 000010                    NDSC9   4,,AUTO                  cn=0,s=lsgnf,sf=0,n=8
         3 000036   000000 230036 xsym               NDSC9   ERR_INSERT               cn=1,s=nosgn,sf=0,n=30

     1129     1157    4                   ERR_INSERT.CNT(0) = 10;

   1157  3 000037   012000 236203                    LDQ   ! 5120,DU
         3 000040   000000 552240 xsym               STBQ  ! ERR_INSERT,'40'O

     1130     1158    4                   CALL SYS_FUNC_ERRMSG;

   1158  3 000041   000001 631600 4                  EPPR1 ! 1
         3 000042   000000 701200 xent               TSX1  ! SYS_FUNC_ERRMSG
         3 000043   000000 011200                    NOP   ! 0

     1131     1159    4                   END;
PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:223  

     1132     1160    3               RETURN;

   1160  3 000044   000000 702200 xent               TSX2  ! X66_AARET

     1133     1161
     1134     1162    3           CASE(ELSE);

     1135     1163
     1136     1164    3               END; /*CASE */

     1137     1165    2           END; /* INHIBIT */

     1138     1166    1   END ZIU$EVENT;

   1166  3 000045   000000 702200 xent               TSX2  ! X66_AARET

(unnamed)
 Sect OctLoc
   4     000   777777 777377   000000 000000                                    ........

PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:224  
--  Include file information  --

   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$EVENT.

   Procedure ZIU$EVENT requires 38 words for executable code.
   Procedure ZIU$EVENT requires 6 words of local(AUTO) storage.

    No errors detected in file ZIU$RPLY.:ZIC0TSI    .
PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:225  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:226  
          MINI XREF LISTING

B$EVNT.CODE
       103**DCL       103--REDEF     104--REDEF     104--REDEF
B$EVNT.ERR.ERR#
       105**DCL       105--REDEF
B$EVNT.EVID
       104**DCL       104--REDEF     104--REDEF
B$EXCFR.ASL
       115**DCL       115--REDEF
B$EXCFR.ECC
       115**DCL      1146>>DOCASE
B$EXCFR.ERR.ERR#
       129**DCL       129--REDEF
B$EXCFR.EVID
       128**DCL       128--REDEF     129--REDEF
B$EXCFR.IR
       116**DCL       116--REDEF
B$EXCFR.PREVSZ
       115**DCL       115--REDEF
B$EXCFR.SUBC
       127**DCL       127--REDEF     128--REDEF     128--REDEF
B$NWIO.CGPARM.MSGIDXT
       177**DCL       180--REDEF
B$NWIO.CODE
       146**DCL       146--REDEF     147--REDEF     147--REDEF
B$NWIO.ERR.CODE
       148**DCL      1148>>IF       1156>>CALLBLT
B$NWIO.ERR.ERR#
       148**DCL       148--REDEF
B$NWIO.EVID
       147**DCL       147--REDEF     147--REDEF    1148>>IF       1151>>ASSIGN
B$TCB.STK$
       133**DCL      1143>>ASSIGN
PL6.E3A0      #003=ZIU$EVENT File=ZIU$RPLY.:ZIC0TSI                              FRI 09/05/97 13:31 Page:227  
B$TCB$
      1122**DCL      1143>>ASSIGN
BUFTBL.BUSY
        14**DCL      1151<<ASSIGN
COUNTSF
      1074**DCL      1075--REDEF
ENCRP_SEEDSF
      1032**DCL      1033--REDEF
ERRCODESF
      1034**DCL      1039--REDEF
ERR_INSERT.CNT
      1048**DCL      1157<<ASSIGN
ERR_INSERT.TEXT
      1049**DCL      1156<<CALLBLT
FIDSF_RD
      1050**DCL      1051--REDEF
HELPCODE
      1068**DCL      1073--REDEF
ICHKSUM
      1133**DCL      1134--REDEF
I_O_BUF$
      1111**DCL      1112--IMP-PTR
KEYVSF
      1006**DCL      1011--REDEF
KEYVSF.WD_ONE
      1008**DCL      1009--REDEF
MSGCODE
      1040**DCL      1041--REDEF
REC$
      1092**DCL      1115--IMP-PTR
REC_DATA_LN
      1120**DCL      1119--IMP-SIZ
STK$
      1141**DCL      1143<<ASSIGN   1146>>DOCASE   1148>>IF       1148>>IF       1151>>ASSIGN   1156>>CALLBLT
SYS_FUNC_ERRMSG
      1139**DCL-ENT  1158--CALL
