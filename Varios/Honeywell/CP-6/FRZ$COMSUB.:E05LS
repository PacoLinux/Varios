VERSION E05

PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:1    
        1        1        /*M* FRZ$COMSUB Common resource management subroutines*/
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* MCL=0,MOC,MEC,CLM=3,EXM=3,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,NSO,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9           /**/
       10       10           /**/
       11       11        FRZ$DSMT: PROC (RAT);
       12       12           /**/
       13       13           /**/
       14       14        %INCLUDE FR$RAT;
       15       67        %FR$RAT (NAME=RAT,STCLASS="");
       16      107        %INCLUDE EL$TABLES;
       17      430        %INCLUDE N_FC_C;
       18      467        %INCLUDE FR_DATA_R;
       19      499        %INCLUDE NI_DATA_R;
       20      936        %INCLUDE EL_SUBS_C;
       21     1020        %INCLUDE NK_SUBS;
       22     1045        %INCLUDE FR_SUBS;
       23     1113        %INCLUDE FT$DDT;
       24     1174        %INCLUDE OC_SUBS_C;
       25     1905        %INCLUDE FM$MACROS;
       26     2280        %FM$DEV(BASED="BASED(F$CFU$)");
       27     2286        %INCLUDE CP_6_SUBS;
       28     2826           /**/
       29     2827           /**/
       30     2828        %N$REQ;
       31     2886        %NI$DCT (NAME=DCT,STCLASS=BASED);
       32     2934        %EL$MTDMT (NAME=LDMT,STCLASS="");
       33     2937           /**/
       34     2938           /**/
       35     2939    1   DCL TDCT UBIN WORD;
       36     2940    1   DCL IOQ$ PTR;
       37     2941    1   DCL DDT$ REDEF IOQ$ PTR;
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:2    
       38     2942    1   DCL DEVC BIT(36);
       39     2943    1   DCL FTI$WRFMDEV ENTRY(1) ALTRET; /* Write file mark                        */
       40     2944    1   DCL SSS$SYSTIME ENTRY(1);
       41     2945    1   DCL S_CUN UBIN WORD SYMREF; /* TEMP TILL RECOVERY */
       42     2946    1   DCL F$CFU$ PTR SYMREF;
       43     2947    1   DCL OCI$MK_WR ENTRY(7);
       44     2948    1   DCL NIQ$GET ENTRY(1) ALTRET;
       45     2949    1   DCL NIO$QUE ENTRY(1) ALTRET;
       46     2950    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
       47     2951    1   DCL FPM$DSMTOD ENTRY(1) ALTRET;
       48     2952           /**/
       49     2953    1   DCL SC_BDREM ENTRY CONV(2,0); /* REMOVE OF OPEN OR UNMOUNTED RESOURCE*/
       50     2954           /**/
       51     2955           /**/
       52     2956    1      CALL SSS$SYSTIME( LDMT.REQ_UTS );
       53     2957    1      IF RAT.FLG.OPN OR NOT RAT.FLG.RUP THEN CALL SC_BDREM;
       54     2958           /*S*  SCREECH_CODE:  FRZ-S$BDREM
       55     2959                 TYPE:          Screech
       56     2960                 MESSAGE:       Attempt to dismount an open or unmounted resource
       57     2961                 REMARKS:       FRZ$DSMT is called as a result of remove or release
       58     2962                                closes and because of the REQUEST keyin.  Each of
       59     2963                                these places should have already checked whether
       60     2964                                the resource could be dismounted.  This screech
       61     2965                                occurs when these tests fail, probably because of
       62     2966                                inconsistant resource management tables (esp. RAT)      */
       63     2967    2      IF RAT.FLG.FORM THEN DO;
       64     2968    2         RAT.FLG=RAT.FLG&%(SOLBIT|FORMBIT|DOWNBIT|SYMBBIT);
       65     2969    2         RAT.REEL.ASID=0;
       66     2970    2         RETURN;
       67     2971    2         END;
       68     2972    1      TDCT=RAT.DCTX;
       69     2973    2      IF RAT.FLG.MBIT.MTD THEN DO;
       70     2974    2         LDMT.SYSID=RAT.RES.SISID;
       71     2975    2         LDMT.VOLUME=RAT.REEL.SER;
       72     2976    2         LDMT.DEVNAME=N$DCT$(TDCT)->DCT.DEVNM;
       73     2977    2         LDMT.PSN=' ';
       74     2978    3         IF RAT.RCOD=FR_DP THEN DO;
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:3    
       75     2979    3            LDMT.PSN=LDMT.VOLUME;
       76     2980    3            CALL BINCHAR(LDMT.VOLUME,FM$DEV.VSN(TDCT));
       77     2981    3            END;
       78     2982    2         CALL ELA$SYSLOG (EL_DSMT,LDMT,SIZEW(LDMT),'0'B,1,IOQ$);
       79     2983    2         END;
       80     2984    2      DO CASE(RAT.RCOD);
       81     2985    2      CASE(FR_DP);
       82     2986    2         IF RAT.M1&%(ATTR_DD600#|ATTR_DD500#|ATTR_DD1000#|ATTR_DD1500#
       83     2987    3           |ATTR_DD400#|ATTR_DD1100#) THEN DO;
       84     2988    3            RAT.FLG=RAT.FLG&%(SOLBIT|FORMBIT|DOWNBIT|SYMBBIT|RUPBIT);
       85     2989    3            RAT.REEL.ASID=0;
       86     2990    3            RETURN;
       87     2991    3            END;
       88     2992    2         DEVC=M_DISK;
       89     2993    2      CASE(FR_MT);
       90     2994    2         DEVC=M_TAPE;
       91     2995    2      CASE(ELSE);
       92     2996    2         DEVC=M_UR;
       93     2997    2      END;
       94     2998    2      IF RAT.TYP = 'OD' THEN DO;
       95     2999    2         CALL FPM$DSMTOD (TDCT);
       96     3000    2         RAT.REEL='0'B;
       97     3001    2         RAT.FLG=RAT.FLG&%(SOLBIT|FORMBIT|DOWNBIT|SYMBBIT);
       98     3002    2         RETURN;
       99     3003    2         END;
      100     3004    1      ELSE
      101     3005    1         CALL OCI$MK_WR (DEVC,DMNT_MSG#,LENGTHC(FR_DMSGL),FR_DMSGL,RAT.REEL.SER,TDCT);
      102     3006    1      RAT.FLG=RAT.FLG&%(SOLBIT|FORMBIT|DOWNBIT|SYMBBIT);
      103     3007    1      RAT.REEL='0'B;
      104     3008    1      IF N$DCT$(TDCT)->DCT.STATUS.MSOS_PART THEN RETURN; /* can't do IO if no chan */
      105     3009    2      IF RAT.RCOD=FR_MT THEN DO;
      106     3010    2         DDT$ = N$DCT$(TDCT)->DCT.DDT$; /* Get DDT entry pointer    */
      107     3011    2         IF DDT$->FT$DDT.FMNEEDED
      108     3012    3         THEN DO; /* Need file mark before dismount     */
      109     3013    3            DDT$->FT$DDT.FMNEEDED = %NO#; /* Not needed anymore */
      110     3014    3            DDT$->FT$DDT.POSLOST = %NO#; /* Permit I/O                */
      111     3015    3            CALL FTI$WRFMDEV(TDCT) ALTRET(JUSTDSMT);
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:4    
      112     3016    3            END;
      113     3017    2         END;
      114     3018    1   JUSTDSMT: ;
      115     3019    1      CALL NIQ$GET (IOQ$);
      116     3020    1      IOQ$->N$REQ.DLA.DCTX=TDCT;
      117     3021    1      IOQ$->N$REQ.FC=%N_UNLOAD;
      118     3022    1      CALL NIO$QUE (IOQ$->N$REQ);
      119     3023    1      RETURN;
      120     3024    1   END;
      121     3025           /**/
      122     3026           /**/
      123     3027        %EOD;

PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:5    
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   FT$DDT.:E05TOU  cannot be made into a system file and is referenced.
   FR_SUBS.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N_FC_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
      No diagnostics issued in procedure FRZ$DSMT.

   Procedure FRZ$DSMT requires 195 words for executable code.
   Procedure FRZ$DSMT requires 20 words of local(AUTO) storage.

PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:6    

 Object Unit name= FRZ$DSMT                                   File name= FRZ$COMSUB.:E05TOU
 UTS= JUL 29 '97 17:25:44.16 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  FRZ$DSMT
    1   Proc  even  none   195    303  FRZ$DSMT
    2  RoData even  none    12     14  FRZ$DSMT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  FRZ$DSMT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 SSS$SYSTIME
 yes     yes           Std       1 FPM$DSMTOD
 yes     yes           Std       1 NIO$QUE
 yes     yes           Std       6 ELA$SYSLOG
         yes           Std       7 OCI$MK_WR
 yes     yes           Std       1 NIQ$GET
 yes     yes           Std       1 FTI$WRFMDEV
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:7    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BDREM                              FR_DMSGL                              N$DCT$$
     N$FQ$                                 NI$FQ$                                NI$IBUF$
     NI$RP$                                F$CFU$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:8    


        1        1        /*M* FRZ$COMSUB Common resource management subroutines*/
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* MCL=0,MOC,MEC,CLM=3,EXM=3,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,NSO,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9           /**/
       10       10           /**/
       11       11        FRZ$DSMT: PROC (RAT);

     11  1 000000   000000 700200 xent  FRZ$DSMT     TSX0  ! X66_AUTO_1
         1 000001   000024 000001                    ZERO    20,1

       12       12           /**/
       13       13           /**/
       14       14        %INCLUDE FR$RAT;
       15       67        %FR$RAT (NAME=RAT,STCLASS="");
       16      107        %INCLUDE EL$TABLES;
       17      430        %INCLUDE N_FC_C;
       18      467        %INCLUDE FR_DATA_R;
       19      499        %INCLUDE NI_DATA_R;
       20      936        %INCLUDE EL_SUBS_C;
       21     1020        %INCLUDE NK_SUBS;
       22     1045        %INCLUDE FR_SUBS;
       23     1113        %INCLUDE FT$DDT;
       24     1174        %INCLUDE OC_SUBS_C;
       25     1905        %INCLUDE FM$MACROS;
       26     2280        %FM$DEV(BASED="BASED(F$CFU$)");
       27     2286        %INCLUDE CP_6_SUBS;
       28     2826           /**/
       29     2827           /**/
       30     2828        %N$REQ;
       31     2886        %NI$DCT (NAME=DCT,STCLASS=BASED);
       32     2934        %EL$MTDMT (NAME=LDMT,STCLASS="");
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:9    
       33     2937           /**/
       34     2938           /**/
       35     2939    1   DCL TDCT UBIN WORD;
       36     2940    1   DCL IOQ$ PTR;
       37     2941    1   DCL DDT$ REDEF IOQ$ PTR;
       38     2942    1   DCL DEVC BIT(36);
       39     2943    1   DCL FTI$WRFMDEV ENTRY(1) ALTRET; /* Write file mark                        */
       40     2944    1   DCL SSS$SYSTIME ENTRY(1);
       41     2945    1   DCL S_CUN UBIN WORD SYMREF; /* TEMP TILL RECOVERY */
       42     2946    1   DCL F$CFU$ PTR SYMREF;
       43     2947    1   DCL OCI$MK_WR ENTRY(7);
       44     2948    1   DCL NIQ$GET ENTRY(1) ALTRET;
       45     2949    1   DCL NIO$QUE ENTRY(1) ALTRET;
       46     2950    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
       47     2951    1   DCL FPM$DSMTOD ENTRY(1) ALTRET;
       48     2952           /**/
       49     2953    1   DCL SC_BDREM ENTRY CONV(2,0); /* REMOVE OF OPEN OR UNMOUNTED RESOURCE*/
       50     2954           /**/
       51     2955           /**/
       52     2956    1      CALL SSS$SYSTIME( LDMT.REQ_UTS );

   2956  1 000002   200012 630500                    EPPR0   LDMT+6,,AUTO
         1 000003   200016 450500                    STP0    DEVC+1,,AUTO
         1 000004   200016 630500                    EPPR0   DEVC+1,,AUTO
         1 000005   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000006   000000 701000 xent               TSX1    SSS$SYSTIME
         1 000007   000000 011000                    NOP     0

       53     2957    1      IF RAT.FLG.OPN OR NOT RAT.FLG.RUP THEN CALL SC_BDREM;

   2957  1 000010   200003 470500                    LDP0    @RAT,,AUTO
         1 000011   000010 236100                    LDQ     8,,PR0
         1 000012   000020 316007                    CANQ    16,DL
         1 000013   000016 601000 1                  TNZ     s:2957+6
         1 000014   000004 316007                    CANQ    4,DL
         1 000015   000020 601000 1                  TNZ     s:2967

PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:10   
   2957  1 000016   000000 713400 xsym               CLIMB   SC_BDREM
         1 000017   000000 600000 xsid               climb   nvectors=         0

       54     2958           /*S*  SCREECH_CODE:  FRZ-S$BDREM
       55     2959                 TYPE:          Screech
       56     2960                 MESSAGE:       Attempt to dismount an open or unmounted resource
       57     2961                 REMARKS:       FRZ$DSMT is called as a result of remove or release
       58     2962                                closes and because of the REQUEST keyin.  Each of
       59     2963                                these places should have already checked whether
       60     2964                                the resource could be dismounted.  This screech
       61     2965                                occurs when these tests fail, probably because of
       62     2966                                inconsistant resource management tables (esp. RAT)      */
       63     2967    2      IF RAT.FLG.FORM THEN DO;

   2967  1 000020   200003 470500                    LDP0    @RAT,,AUTO
         1 000021   000010 236100                    LDQ     8,,PR0
         1 000022   000010 316007                    CANQ    8,DL
         1 000023   000034 600000 1                  TZE     s:2972

       64     2968    2         RAT.FLG=RAT.FLG&%(SOLBIT|FORMBIT|DOWNBIT|SYMBBIT);

   2968  1 000024   000010 236100                    LDQ     8,,PR0
         1 000025   000033 736000                    QLS     27
         1 000026   113000 376003                    ANQ     38400,DU
         1 000027   000033 772000                    QRL     27
         1 000030   000010 552104                    STBQ    8,'04'O,PR0

       65     2969    2         RAT.REEL.ASID=0;

   2969  1 000031   000000 220003                    LDX0    0,DU
         1 000032   000004 740100                    STX0    4,,PR0

       66     2970    2         RETURN;

   2970  1 000033   000000 702200 xent               TSX2  ! X66_ARET

       67     2971    2         END;
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:11   
       68     2972    1      TDCT=RAT.DCTX;

   2972  1 000034   000003 236100                    LDQ     3,,PR0
         1 000035   777777 376007                    ANQ     -1,DL
         1 000036   200013 756100                    STQ     TDCT,,AUTO

       69     2973    2      IF RAT.FLG.MBIT.MTD THEN DO;

   2973  1 000037   000010 236100                    LDQ     8,,PR0
         1 000040   000400 316007                    CANQ    256,DL
         1 000041   000116 600000 1                  TZE     s:2984

       70     2974    2         LDMT.SYSID=RAT.RES.SISID;

   2974  1 000042   000001 236100                    LDQ     1,,PR0
         1 000043   000022 732000                    QRS     18
         1 000044   200004 756100                    STQ     LDMT,,AUTO

       71     2975    2         LDMT.VOLUME=RAT.REEL.SER;

   2975  1 000045   040100 100500                    MLR     fill='040'O
         1 000046   000004 400006                    ADSC9   4,,PR0                   cn=2,n=6
         1 000047   200005 000006                    ADSC9   LDMT+1,,AUTO             cn=0,n=6

       72     2976    2         LDMT.DEVNAME=N$DCT$(TDCT)->DCT.DEVNM;

   2976  1 000050   000000 471400 xsym               LDP1    N$DCT$$
         1 000051   200013 720100                    LXL0    TDCT,,AUTO
         1 000052   100000 473510                    LDP3    0,X0,PR1
         1 000053   040100 100500                    MLR     fill='040'O
         1 000054   300002 000010                    ADSC9   2,,PR3                   cn=0,n=8
         1 000055   200010 000010                    ADSC9   LDMT+4,,AUTO             cn=0,n=8

       73     2977    2         LDMT.PSN=' ';

   2977  1 000056   040100 100400                    MLR     fill='040'O
         1 000057   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:12   
         1 000060   200006 400006                    ADSC9   LDMT+2,,AUTO             cn=2,n=6

       74     2978    3         IF RAT.RCOD=FR_DP THEN DO;

   2978  1 000061   000003 236100                    LDQ     3,,PR0
         1 000062   000740 316003                    CANQ    480,DU
         1 000063   000100 601000 1                  TNZ     s:2982

       75     2979    3            LDMT.PSN=LDMT.VOLUME;

   2979  1 000064   040100 100500                    MLR     fill='040'O
         1 000065   200005 000006                    ADSC9   LDMT+1,,AUTO             cn=0,n=6
         1 000066   200006 400006                    ADSC9   LDMT+2,,AUTO             cn=2,n=6

       76     2980    3            CALL BINCHAR(LDMT.VOLUME,FM$DEV.VSN(TDCT));

   2980  1 000067   200013 235100                    LDA     TDCT,,AUTO
         1 000070   000003 735000                    ALS     3
         1 000071   000000 473400 xsym               LDP3    F$CFU$
         1 000072   300001 235105                    LDA     1,AL,PR3
         1 000073   000044 773000                    LRL     36
         1 000074   200016 757100                    STAQ    DEVC+1,,AUTO
         1 000075   000100 301500                    BTD
         1 000076   200016 000010                    NDSC9   DEVC+1,,AUTO             cn=0,s=lsgnf,sf=0,n=8
         1 000077   200005 030006                    NDSC9   LDMT+1,,AUTO             cn=0,s=nosgn,sf=0,n=6

       77     2981    3            END;

       78     2982    2         CALL ELA$SYSLOG (EL_DSMT,LDMT,SIZEW(LDMT),'0'B,1,IOQ$);

   2982  1 000100   200014 633500                    EPPR3   IOQ$,,AUTO
         1 000101   200023 453500                    STP3    DEVC+6,,AUTO
         1 000102   000001 236000 2                  LDQ     1
         1 000103   200022 756100                    STQ     DEVC+5,,AUTO
         1 000104   000002 237000 2                  LDAQ    2
         1 000105   200020 757100                    STAQ    DEVC+3,,AUTO
         1 000106   200004 634500                    EPPR4   LDMT,,AUTO
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:13   
         1 000107   200017 454500                    STP4    DEVC+2,,AUTO
         1 000110   000004 236000 2                  LDQ     4
         1 000111   200016 756100                    STQ     DEVC+1,,AUTO
         1 000112   200016 630500                    EPPR0   DEVC+1,,AUTO
         1 000113   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000114   000000 701000 xent               TSX1    ELA$SYSLOG
         1 000115   000000 011000                    NOP     0

       79     2983    2         END;

       80     2984    2      DO CASE(RAT.RCOD);

   2984  1 000116   200003 470500                    LDP0    @RAT,,AUTO
         1 000117   000003 236100                    LDQ     3,,PR0
         1 000120   000027 772000                    QRL     23
         1 000121   000017 376007                    ANQ     15,DL
         1 000122   000002 116007                    CMPQ    2,DL
         1 000123   000125 602006 1                  TNC     s:2984+7,QL
         1 000124   000150 710000 1                  TRA     s:2996
         1 000125   000127 710000 1                  TRA     s:2986
         1 000126   000145 710000 1                  TRA     s:2994

       81     2985    2      CASE(FR_DP);

       82     2986    2         IF RAT.M1&%(ATTR_DD600#|ATTR_DD500#|ATTR_DD1000#|ATTR_DD1500#

   2986  1 000127   000006 220100                    LDX0    6,,PR0
         1 000130   167000 360003                    ANX0    60928,DU
         1 000131   000142 600000 1                  TZE     s:2992

       83     2987    3           |ATTR_DD400#|ATTR_DD1100#) THEN DO;

       84     2988    3            RAT.FLG=RAT.FLG&%(SOLBIT|FORMBIT|DOWNBIT|SYMBBIT|RUPBIT);

   2988  1 000132   000010 236100                    LDQ     8,,PR0
         1 000133   000033 736000                    QLS     27
         1 000134   117000 376003                    ANQ     40448,DU
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:14   
         1 000135   000033 772000                    QRL     27
         1 000136   000010 552104                    STBQ    8,'04'O,PR0

       85     2989    3            RAT.REEL.ASID=0;

   2989  1 000137   000000 220003                    LDX0    0,DU
         1 000140   000004 740100                    STX0    4,,PR0

       86     2990    3            RETURN;

   2990  1 000141   000000 702200 xent               TSX2  ! X66_ARET

       87     2991    3            END;
       88     2992    2         DEVC=M_DISK;

   2992  1 000142   100000 236003                    LDQ     32768,DU
         1 000143   200015 756100                    STQ     DEVC,,AUTO
         1 000144   000152 710000 1                  TRA     s:2998

       89     2993    2      CASE(FR_MT);

       90     2994    2         DEVC=M_TAPE;

   2994  1 000145   100000 236003                    LDQ     32768,DU
         1 000146   200015 756100                    STQ     DEVC,,AUTO
         1 000147   000152 710000 1                  TRA     s:2998

       91     2995    2      CASE(ELSE);

       92     2996    2         DEVC=M_UR;

   2996  1 000150   100000 236003                    LDQ     32768,DU
         1 000151   200015 756100                    STQ     DEVC,,AUTO

       93     2997    2      END;

       94     2998    2      IF RAT.TYP = 'OD' THEN DO;
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:15   

   2998  1 000152   000010 220100                    LDX0    8,,PR0
         1 000153   000000 100000 0                  CMPX0   0
         1 000154   000174 601000 1                  TNZ     s:3005

       95     2999    2         CALL FPM$DSMTOD (TDCT);

   2999  1 000155   200013 631500                    EPPR1   TDCT,,AUTO
         1 000156   200016 451500                    STP1    DEVC+1,,AUTO
         1 000157   200016 630500                    EPPR0   DEVC+1,,AUTO
         1 000160   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000161   000000 701000 xent               TSX1    FPM$DSMTOD
         1 000162   000000 011000                    NOP     0

       96     3000    2         RAT.REEL='0'B;

   3000  1 000163   200003 470500                    LDP0    @RAT,,AUTO
         1 000164   000004 450100                    STZ     4,,PR0
         1 000165   000005 450100                    STZ     5,,PR0

       97     3001    2         RAT.FLG=RAT.FLG&%(SOLBIT|FORMBIT|DOWNBIT|SYMBBIT);

   3001  1 000166   000010 236100                    LDQ     8,,PR0
         1 000167   000033 736000                    QLS     27
         1 000170   113000 376003                    ANQ     38400,DU
         1 000171   000033 772000                    QRL     27
         1 000172   000010 552104                    STBQ    8,'04'O,PR0

       98     3002    2         RETURN;

   3002  1 000173   000000 702200 xent               TSX2  ! X66_ARET

       99     3003    2         END;
      100     3004    1      ELSE
      101     3005    1         CALL OCI$MK_WR (DEVC,DMNT_MSG#,LENGTHC(FR_DMSGL),FR_DMSGL,RAT.REEL.SER,TDCT);

   3005  1 000174   200013 631500                    EPPR1   TDCT,,AUTO
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:16   
         1 000175   200023 451500                    STP1    DEVC+6,,AUTO
         1 000176   200003 236100                    LDQ     @RAT,,AUTO
         1 000177   000006 036000 2                  ADLQ    6
         1 000200   200022 756100                    STQ     DEVC+5,,AUTO
         1 000201   000010 237000 2                  LDAQ    8
         1 000202   200020 757100                    STAQ    DEVC+3,,AUTO
         1 000203   000007 236000 2                  LDQ     7
         1 000204   200017 756100                    STQ     DEVC+2,,AUTO
         1 000205   200015 633500                    EPPR3   DEVC,,AUTO
         1 000206   200016 453500                    STP3    DEVC+1,,AUTO
         1 000207   200016 630500                    EPPR0   DEVC+1,,AUTO
         1 000210   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000211   000000 701000 xent               TSX1    OCI$MK_WR
         1 000212   000000 011000                    NOP     0

      102     3006    1      RAT.FLG=RAT.FLG&%(SOLBIT|FORMBIT|DOWNBIT|SYMBBIT);

   3006  1 000213   200003 470500                    LDP0    @RAT,,AUTO
         1 000214   000010 236100                    LDQ     8,,PR0
         1 000215   000033 736000                    QLS     27
         1 000216   113000 376003                    ANQ     38400,DU
         1 000217   000033 772000                    QRL     27
         1 000220   000010 552104                    STBQ    8,'04'O,PR0

      103     3007    1      RAT.REEL='0'B;

   3007  1 000221   000004 450100                    STZ     4,,PR0
         1 000222   000005 450100                    STZ     5,,PR0

      104     3008    1      IF N$DCT$(TDCT)->DCT.STATUS.MSOS_PART THEN RETURN; /* can't do IO if no chan */

   3008  1 000223   000000 471400 xsym               LDP1    N$DCT$$
         1 000224   200013 720100                    LXL0    TDCT,,AUTO
         1 000225   100000 473510                    LDP3    0,X0,PR1
         1 000226   300027 236100                    LDQ     23,,PR3
         1 000227   002000 316003                    CANQ    1024,DU
         1 000230   000232 600000 1                  TZE     s:3009
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:17   

   3008  1 000231   000000 702200 xent               TSX2  ! X66_ARET

      105     3009    2      IF RAT.RCOD=FR_MT THEN DO;

   3009  1 000232   000003 236100                    LDQ     3,,PR0
         1 000233   000740 376003                    ANQ     480,DU
         1 000234   000040 116003                    CMPQ    32,DU
         1 000235   000257 601000 1                  TNZ     JUSTDSMT

      106     3010    2         DDT$ = N$DCT$(TDCT)->DCT.DDT$; /* Get DDT entry pointer    */

   3010  1 000236   300004 236100                    LDQ     4,,PR3
         1 000237   200014 756100                    STQ     IOQ$,,AUTO

      107     3011    2         IF DDT$->FT$DDT.FMNEEDED

   3011  1 000240   200014 473500                    LDP3    IOQ$,,AUTO
         1 000241   300006 236100                    LDQ     6,,PR3
         1 000242   000200 316007                    CANQ    128,DL
         1 000243   000257 600000 1                  TZE     JUSTDSMT

      108     3012    3         THEN DO; /* Need file mark before dismount     */

      109     3013    3            DDT$->FT$DDT.FMNEEDED = %NO#; /* Not needed anymore */

   3013  1 000244   000012 236000 2                  LDQ     10
         1 000245   300006 356100                    ANSQ    6,,PR3

      110     3014    3            DDT$->FT$DDT.POSLOST = %NO#; /* Permit I/O                */

   3014  1 000246   200014 473500                    LDP3    IOQ$,,AUTO
         1 000247   000013 236000 2                  LDQ     11
         1 000250   300006 356100                    ANSQ    6,,PR3

      111     3015    3            CALL FTI$WRFMDEV(TDCT) ALTRET(JUSTDSMT);

PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:18   
   3015  1 000251   200013 633500                    EPPR3   TDCT,,AUTO
         1 000252   200016 453500                    STP3    DEVC+1,,AUTO
         1 000253   200016 630500                    EPPR0   DEVC+1,,AUTO
         1 000254   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000255   000000 701000 xent               TSX1    FTI$WRFMDEV
         1 000256   000257 702000 1                  TSX2    JUSTDSMT

      112     3016    3            END;

      113     3017    2         END;

   3015  1 000257                       JUSTDSMT     null
      114     3018    1   JUSTDSMT: ;
      115     3019    1      CALL NIQ$GET (IOQ$);

   3019  1 000257   200014 630500                    EPPR0   IOQ$,,AUTO
         1 000260   200016 450500                    STP0    DEVC+1,,AUTO
         1 000261   200016 630500                    EPPR0   DEVC+1,,AUTO
         1 000262   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000263   000000 701000 xent               TSX1    NIQ$GET
         1 000264   000000 011000                    NOP     0

      116     3020    1      IOQ$->N$REQ.DLA.DCTX=TDCT;

   3020  1 000265   200014 470500                    LDP0    IOQ$,,AUTO
         1 000266   200013 236100                    LDQ     TDCT,,AUTO
         1 000267   000025 736000                    QLS     21
         1 000270   000001 676100                    ERQ     1,,PR0
         1 000271   777770 376003                    ANQ     -8,DU
         1 000272   000001 656100                    ERSQ    1,,PR0

      117     3021    1      IOQ$->N$REQ.FC=%N_UNLOAD;

   3021  1 000273   200014 470500                    LDP0    IOQ$,,AUTO
         1 000274   000010 236007                    LDQ     8,DL
         1 000275   000003 552104                    STBQ    3,'04'O,PR0

PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:19   
      118     3022    1      CALL NIO$QUE (IOQ$->N$REQ);

   3022  1 000276   200014 630500                    EPPR0   IOQ$,,AUTO
         1 000277   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000300   000000 701000 xent               TSX1    NIO$QUE
         1 000301   000000 011000                    NOP     0

      119     3023    1      RETURN;

   3023  1 000302   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   0     000   117104 040040                                                    OD

(unnamed)
 Sect OctLoc
   2     000   000000 000147   000003 006000   000011 006000   000002 006000    ...g............
   2     004   000000 006000   000000 000026   000004 400000   000005 006000    ................
   2     010   000003 006000   000000 006000   777777 777577   777777 773777    ................
      120     3024    1   END;
      121     3025           /**/
      122     3026           /**/
      123     3027        %EOD;

PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:20   
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   FT$DDT.:E05TOU  cannot be made into a system file and is referenced.
   FR_SUBS.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N_FC_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
      No diagnostics issued in procedure FRZ$DSMT.
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:21   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @RAT                      14-0-0/w PTR         r     1 DDT$
    15-0-0/b BIT         r     1 DEVC                      14-0-0/w PTR         r     1 IOQ$
     4-0-0/w STRC(252)   r     1 LDMT                      *0-0-0/w STRC(324)   r     1 RAT
    13-0-0/w UBIN        r     1 TDCT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 F$CFU$                     0-0-0/w CHAR        r     1 FR_DMSGL
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w STRC(288)   r     1 FM$DEV(0:0)
     0-0-0/w STRC(288)   r     1 FT$DDT                     0-0-0/w PTR         r     1 N$DCT$(0:0)
     0-0-0/d STRC(1080)  r     1 N$REQ


   Procedure FRZ$DSMT requires 195 words for executable code.
   Procedure FRZ$DSMT requires 20 words of local(AUTO) storage.
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:22   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:23   
          MINI XREF LISTING

DCT.DDT$
      2896**DCL      3010>>ASSIGN
DCT.DEVNM
      2895**DCL      2976>>ASSIGN
DCT.DP
      2915**DCL      2922--REDEF    2925--REDEF    2926--REDEF    2928--REDEF    2928--REDEF    2929--REDEF
      2930--REDEF    2930--REDEF
DCT.MPC.IOCHANX
      2923**DCL      2923--REDEF
DCT.STATUS.MSOS_PART
      2914**DCL      3008>>IF
DDT$
      2941**DCL      3010<<ASSIGN   3011>>IF       3013>>ASSIGN   3014>>ASSIGN
DEVC
      2942**DCL      2992<<ASSIGN   2994<<ASSIGN   2996<<ASSIGN   3005<>CALL
ELA$SYSLOG
      2950**DCL-ENT  2982--CALL
F$CFU$
      2946**DCL      2281--IMP-PTR  2980>>CALLBLT
FM$DEV.USERLIST
      2282**DCL      2283--REDEF
FM$DEV.VSN
      2281**DCL      2980>>CALLBLT
FPM$DSMTOD
      2951**DCL-ENT  2999--CALL
FR_DMSGL
       479**DCL      3005--CALL     3005<>CALL
FT$DDT.FMNEEDED
      1153**DCL      3011>>IF       3013<<ASSIGN
FT$DDT.POSLOST
      1148**DCL      3014<<ASSIGN
FTI$WRFMDEV
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:24   
      2943**DCL-ENT  3015--CALL
IOQ$
      2940**DCL      2941--REDEF    2982<>CALL     3019<>CALL     3020>>ASSIGN   3021>>ASSIGN   3022>>CALL
JUSTDSMT
      3015**LABEL    3015--CALLALT
LDMT
      2935**DCL      2982<>CALL     2982--CALL
LDMT.DEVNAME
      2935**DCL      2976<<ASSIGN
LDMT.PSN
      2935**DCL      2977<<ASSIGN   2979<<ASSIGN
LDMT.REQ_UTS
      2935**DCL      2956<>CALL
LDMT.SYSID
      2935**DCL      2974<<ASSIGN
LDMT.VOLUME
      2935**DCL      2975<<ASSIGN   2979>>ASSIGN   2980<<CALLBLT
N$DCT$
       931**DCL      2976>>ASSIGN   3008>>IF       3010>>ASSIGN
N$DCT$$
       797**DCL       931--IMP-PTR  2976>>ASSIGN   3008>>IF       3010>>ASSIGN
N$FQ$
       797**DCL       932--IMP-PTR
N$REQ
      2837**DCL      3022<>CALL
N$REQ.BUFADDR
      2846**DCL      2847--REDEF    2847--REDEF
N$REQ.DLA.DCTX
      2837**DCL      3020<<ASSIGN
N$REQ.DLA.DRELADDR
      2838**DCL      2838--REDEF
N$REQ.DVE.EOMCHAR
      2875**DCL      2876--REDEF
N$REQ.EAINFO
      2869**DCL      2869--REDEF
N$REQ.EAINFOX
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:25   
      2869**DCL      2870--REDEF
N$REQ.EVNTINFO
      2870**DCL      2870--REDEF
N$REQ.FC
      2840**DCL      3021<<ASSIGN
N$REQ.STATUS
      2851**DCL      2857--REDEF
N$REQ_INIT.BUFADDR
       816**DCL       817--REDEF     817--REDEF
N$REQ_INIT.DLA.DRELADDR
       808**DCL       808--REDEF
N$REQ_INIT.DVE.EOMCHAR
       845**DCL       846--REDEF
N$REQ_INIT.EAINFO
       839**DCL       839--REDEF
N$REQ_INIT.EAINFOX
       839**DCL       840--REDEF
N$REQ_INIT.EVNTINFO
       840**DCL       840--REDEF
N$REQ_INIT.STATUS
       821**DCL       827--REDEF
NI$FQ$
       857**DCL       933--IMP-PTR
NI$IBUF$
       857**DCL       933--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       867**DCL       868--REDEF     868--REDEF
NI$IMXMBX_INIT.SIZE
       869**DCL       869--REDEF
NI$REQ_INIT.DCW
       891**DCL       894--REDEF
NI$REQ_INIT.DCW.TALLY
       892**DCL       892--REDEF
NI$REQ_INIT.IDCW.EXTA
       894**DCL       894--REDEF
NI$REQ_INIT.PCW
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:26   
       896**DCL       900--REDEF
NI$REQ_INIT.SEEK
       901**DCL       902--REDEF     903--REDEF
NI$RP$
       905**DCL       935--IMP-PTR
NIO$QUE
      2949**DCL-ENT  3022--CALL
NIQ$GET
      2948**DCL-ENT  3019--CALL
NI_MBX_INIT.DCW.CONTROL.AE
       927**DCL       927--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       923**DCL       923--REDEF
OCI$MK_WR
      2947**DCL-ENT  3005--CALL
RAT
        69**DCL        11--PROC
RAT.DCTX
        87**DCL      2972>>ASSIGN
RAT.FLG
        95**DCL      2968<<ASSIGN   2968>>ASSIGN   2988<<ASSIGN   2988>>ASSIGN   3001<<ASSIGN   3001>>ASSIGN
      3006<<ASSIGN   3006>>ASSIGN
RAT.FLG.FORM
       102**DCL      2967>>IF
RAT.FLG.MBIT.MTD
        97**DCL      2973>>IF
RAT.FLG.OPN
       101**DCL      2957>>IF
RAT.FLG.RUP
       103**DCL      2957>>IF
RAT.M1
        91**DCL      2986>>IF
RAT.RCOD
        82**DCL      2978>>IF       2984>>DOCASE   3009>>IF
RAT.REEL
        88**DCL      3000<<ASSIGN   3007<<ASSIGN
PL6.E3A0      #001=FRZ$DSMT File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:27   
RAT.REEL.ASID
        89**DCL      2969<<ASSIGN   2989<<ASSIGN
RAT.REEL.SER
        90**DCL      2975>>ASSIGN   3005<>CALL
RAT.RES.SISID
        72**DCL      2974>>ASSIGN
RAT.TYP
        93**DCL      2998>>IF
SC_BDREM
      2953**DCL-ENT  2957--CALL
SSS$SYSTIME
      2944**DCL-ENT  2956--CALL
TDCT
      2939**DCL      2972<<ASSIGN   2976>>ASSIGN   2980>>CALLBLT  2999<>CALL     3005<>CALL     3008>>IF
      3010>>ASSIGN   3015<>CALL     3020>>ASSIGN

PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:28   
      124        1        /*T***********************************************************/
      125        2        /*T*                                                         */
      126        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      127        4        /*T*                                                         */
      128        5        /*T***********************************************************/
      129        6           /**/
      130        7           /**/
      131        8        FRZ$RRES: PROC (RAT,MODE);
      132        9           /**/
      133       10           /**/
      134       11        %INCLUDE A$JIT_C;
      135      446        %INCLUDE FR$RAT;
      136      499        %FR$RAT (NAME=RAT,STCLASS="");
      137      539        %INCLUDE FR_DATA_R;
      138      571        %INCLUDE FR_SUBS;
      139      639        %INCLUDE NI_DATA_R;
      140     1076        %NI$DCT (NAME=DCT,STCLASS="BASED(DCT$)");
      141     1124        %INCLUDE TD_CP6;
      142     1302           /**/
      143     1303           /**/
      144     1304    1   DCL MODE UBIN WORD;
      145     1305    1   DCL RCD SBIN;
      146     1306    1   DCL DCT$ PTR;
      147     1307    1   DCL SAVEPRIV BIT(36);
      148     1308    1   DCL OLTX REDEF SAVEPRIV UBIN WORD;
      149     1309        %FPT_SYSCON (FPTN=FPT_SYSCON,STCLASS=CONSTANT,COMPONENT=DVC,FUNCTION=PARTITION);
      150     1326        %FPT_SYSCON (FPTN=FPT$SYSCON,STCLASS=AUTO);
      151     1343    1   DCL B$JIT$ PTR SYMREF;
      152     1344    1   DCL SSS$BLOCK ENTRY;
      153     1345    1   DCL FRZ$DSMT ENTRY(1);
      154     1346    1   DCL FRS$OPSTRS ENTRY;
      155     1347    1   DCL FRS$RESSUB ENTRY(1);
      156     1348    1   DCL FRS$CLSTRS ENTRY;
      157     1349    1   DCL TDP$SYSCON ENTRY(3) ALTRET;
      158     1350           /**/
      159     1351    1   DCL SC_R2MNYP ENTRY CONV(2,0); /* MORE RES RELEASED THAN ALLOCATED */
      160     1352           /**/
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:29   
      161     1353           /**/
      162     1354    2      IF RAT.RES.ACTX~=0 THEN DO;
      163     1355    2         RAT.RES.RFLG.NOSLD='1'B;
      164     1356    2         CALL FRS$OPSTRS;
      165     1357    2         CALL FRS$RESSUB (RAT);
      166     1358    2         CALL FRS$CLSTRS;
      167     1359    2         END;
      168     1360           /**/
      169     1361    1   FRZ$RRESNA: ENTRY (RAT,MODE);
      170     1362           /**/
      171     1363    1      IF RAT.FLG.MBIT.MTD THEN CALL FRZ$DSMT (RAT);
      172     1364    1      ELSE IF RAT.RCOD=FR_DP THEN RAT.REEL.ASID=0;
      173     1365    1      CALL SSS$BLOCK;
      174     1366    1      RCD=RAT.RCOD;
      175     1367    1      IF RCD>FR_NPOOL
      176     1368    1      THEN RCD=FR_NPOOL;
      177     1369    1      FR_PRC$(MODE)->FR$PR(RCD)=FR_PRC$(MODE)->FR$PR(RCD)-1;
      178     1370    1      IF FR_PRC$(MODE)->FR$PR(RCD)<0 THEN CALL SC_R2MNYP;
      179     1371           /*S*  SCREECH_CODE:  FRZ-S$R2MANY
      180     1372                 TYPE:          Screech
      181     1373                 MESSAGE:       More resources released than were ever allocated
      182     1374                 REMARKS:       *THIS IS THE BUDDY DOEPPEL MEMORIAL SCREECH*
      183     1375                                This screech occurs when the "currently allocated"
      184     1376                                count for a resource goes negative.  The screech is
      185     1377                                done for physical resources here and for
      186     1378                                memory and pseudos in FRP$PMME (FRP-S$R2MANY).
      187     1379                                This screech occurs as a result of resource
      188     1380                                management bugs or possibly a malicious user with
      189     1381                                JIT or monitor access has changed some numbers          */
      190     1382    2      IF RAT.RES.RFLG.OLT AND RCD=FR_MT THEN DO;
      191     1383    2         IF RAT.RES.NUMB='01' THEN OLTX=0;
      192     1384    2         ELSE OLTX=1;
      193     1385    2         B$JIT$->B$JIT.OLTA(OLTX)='1'B;
      194     1386    2         END;
      195     1387    1      RAT.RES='0'B;
      196     1388    2      IF RAT.DCTX=0 THEN DO; /* Resource has disconnected */
      197     1389    2         RAT.RCOD=FR_FREE;
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:30   
      198     1390    2         RAT.FLG=%DOWNBIT;
      199     1391    2         END;
      200     1392    1      DCT$=N$DCT$(RAT.DCTX);
      201     1393    1      IF RAT.RCOD=RCD THEN IF DCT.STATUS.SYSCON_PART OR DCT.STATUS.MSOS_PART
      202     1394    2         THEN DO; /* delayed partitioning */
      203     1395    2            FPT$SYSCON=FPT_SYSCON;
      204     1396    2            FPT$SYSCON.V.DEVNM#=DCT.DEVNM;
      205     1397    2            SAVEPRIV=B$JIT.PRIV.ACTIVE;
      206     1398    2            B$JIT.PRIV.ACTIVE=%PR_SYSCON#;
      207     1399    2            CALL TDP$SYSCON(FPT$SYSCON.V,RCD,RCD);
      208     1400    2            B$JIT.PRIV.ACTIVE=SAVEPRIV;
      209     1401    2            END;
      210     1402    1      RETURN;
      211     1403    1   END;
      212     1404           /**/
      213     1405           /**/
      214     1406        %EOD;

PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:31   
--  Include file information  --

   TD_CP6.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR$RAT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   A$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FRZ$RRES.

   Procedure FRZ$RRES requires 128 words for executable code.
   Procedure FRZ$RRES requires 20 words of local(AUTO) storage.

PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:32   

 Object Unit name= FRZ$RRES                                   File name= FRZ$COMSUB.:E05TOU
 UTS= JUL 29 '97 17:25:55.44 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      9     11  FRZ$RRES
    1   Proc  even  none   128    200  FRZ$RRES
    2  RoData even  none     1      1  FRZ$RRES

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        2  FRZ$RRES
     1     22                  yes      Std        2  FRZ$RRESNA

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FRS$OPSTRS
         yes           Std       1 FRS$RESSUB
         yes           Std       0 FRS$CLSTRS
         yes           Std       1 FRZ$DSMT
         yes           Std       0 SSS$BLOCK
 yes     yes           Std       3 TDP$SYSCON
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_ARET
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:33   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_R2MNYP                             FR_PRC$                               N$DCT$$
     N$FQ$                                 NI$FQ$                                NI$IBUF$
     NI$RP$                                B$JIT$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ASLENTSID
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:34   


      124        1        /*T***********************************************************/
      125        2        /*T*                                                         */
      126        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      127        4        /*T*                                                         */
      128        5        /*T***********************************************************/
      129        6           /**/
      130        7           /**/
      131        8        FRZ$RRES: PROC (RAT,MODE);

      8  1 000000   000000 700200 xent  FRZ$RRES     TSX0  ! X66_AUTO_2
         1 000001   000024 000002                    ZERO    20,2

      132        9           /**/
      133       10           /**/
      134       11        %INCLUDE A$JIT_C;
      135      446        %INCLUDE FR$RAT;
      136      499        %FR$RAT (NAME=RAT,STCLASS="");
      137      539        %INCLUDE FR_DATA_R;
      138      571        %INCLUDE FR_SUBS;
      139      639        %INCLUDE NI_DATA_R;
      140     1076        %NI$DCT (NAME=DCT,STCLASS="BASED(DCT$)");
      141     1124        %INCLUDE TD_CP6;
      142     1302           /**/
      143     1303           /**/
      144     1304    1   DCL MODE UBIN WORD;
      145     1305    1   DCL RCD SBIN;
      146     1306    1   DCL DCT$ PTR;
      147     1307    1   DCL SAVEPRIV BIT(36);
      148     1308    1   DCL OLTX REDEF SAVEPRIV UBIN WORD;
      149     1309        %FPT_SYSCON (FPTN=FPT_SYSCON,STCLASS=CONSTANT,COMPONENT=DVC,FUNCTION=PARTITION);
      150     1326        %FPT_SYSCON (FPTN=FPT$SYSCON,STCLASS=AUTO);
      151     1343    1   DCL B$JIT$ PTR SYMREF;
      152     1344    1   DCL SSS$BLOCK ENTRY;
      153     1345    1   DCL FRZ$DSMT ENTRY(1);
      154     1346    1   DCL FRS$OPSTRS ENTRY;
      155     1347    1   DCL FRS$RESSUB ENTRY(1);
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:35   
      156     1348    1   DCL FRS$CLSTRS ENTRY;
      157     1349    1   DCL TDP$SYSCON ENTRY(3) ALTRET;
      158     1350           /**/
      159     1351    1   DCL SC_R2MNYP ENTRY CONV(2,0); /* MORE RES RELEASED THAN ALLOCATED */
      160     1352           /**/
      161     1353           /**/
      162     1354    2      IF RAT.RES.ACTX~=0 THEN DO;

   1354  1 000002   200003 470500                    LDP0    @RAT,,AUTO
         1 000003   000002 720100                    LXL0    2,,PR0
         1 000004   000021 600000 1                  TZE     s:1359

      163     1355    2         RAT.RES.RFLG.NOSLD='1'B;

   1355  1 000005   010000 236003                    LDQ     4096,DU
         1 000006   000003 256100                    ORSQ    3,,PR0

      164     1356    2         CALL FRS$OPSTRS;

   1356  1 000007   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000010   000000 701000 xent               TSX1    FRS$OPSTRS
         1 000011   000000 011000                    NOP     0

      165     1357    2         CALL FRS$RESSUB (RAT);

   1357  1 000012   200003 630500                    EPPR0   @RAT,,AUTO
         1 000013   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000014   000000 701000 xent               TSX1    FRS$RESSUB
         1 000015   000000 011000                    NOP     0

      166     1358    2         CALL FRS$CLSTRS;

   1358  1 000016   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000017   000000 701000 xent               TSX1    FRS$CLSTRS
         1 000020   000000 011000                    NOP     0

      167     1359    2         END;
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:36   

   1359  1 000021   000024 710000 1                  TRA     s:1363

      168     1360           /**/
      169     1361    1   FRZ$RRESNA: ENTRY (RAT,MODE);

   1361  1 000022   000000 700200 xent  FRZ$RRESNA   TSX0  ! X66_AUTO_2
         1 000023   000024 000002                    ZERO    20,2

      170     1362           /**/
      171     1363    1      IF RAT.FLG.MBIT.MTD THEN CALL FRZ$DSMT (RAT);

   1363  1 000024   200003 470500                    LDP0    @RAT,,AUTO
         1 000025   000010 236100                    LDQ     8,,PR0
         1 000026   000400 316007                    CANQ    256,DL
         1 000027   000035 600000 1                  TZE     s:1364

   1363  1 000030   200003 630500                    EPPR0   @RAT,,AUTO
         1 000031   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000032   000000 701000 xent               TSX1    FRZ$DSMT
         1 000033   000000 011000                    NOP     0
         1 000034   000042 710000 1                  TRA     s:1365

      172     1364    1      ELSE IF RAT.RCOD=FR_DP THEN RAT.REEL.ASID=0;

   1364  1 000035   000003 236100                    LDQ     3,,PR0
         1 000036   000740 316003                    CANQ    480,DU
         1 000037   000042 601000 1                  TNZ     s:1365

   1364  1 000040   000000 220003                    LDX0    0,DU
         1 000041   000004 740100                    STX0    4,,PR0

      173     1365    1      CALL SSS$BLOCK;

   1365  1 000042   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000043   000000 701000 xent               TSX1    SSS$BLOCK
         1 000044   000000 011000                    NOP     0
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:37   

      174     1366    1      RCD=RAT.RCOD;

   1366  1 000045   200003 470500                    LDP0    @RAT,,AUTO
         1 000046   000003 236100                    LDQ     3,,PR0
         1 000047   000027 772000                    QRL     23
         1 000050   000017 376007                    ANQ     15,DL
         1 000051   200005 756100                    STQ     RCD,,AUTO

      175     1367    1      IF RCD>FR_NPOOL

   1367  1 000052   000002 116007                    CMPQ    2,DL
         1 000053   000056 604400 1                  TMOZ    s:1369

      176     1368    1      THEN RCD=FR_NPOOL;

   1368  1 000054   000002 235007                    LDA     2,DL
         1 000055   200005 755100                    STA     RCD,,AUTO

      177     1369    1      FR_PRC$(MODE)->FR$PR(RCD)=FR_PRC$(MODE)->FR$PR(RCD)-1;

   1369  1 000056   200004 471500                    LDP1    @MODE,,AUTO
         1 000057   100000 720100                    LXL0    0,,PR1
         1 000060   000000 473410 xsym               LDP3    FR_PRC$,X0
         1 000061   200005 721100                    LXL1    RCD,,AUTO
         1 000062   000001 336007                    LCQ     1,DL
         1 000063   300000 056111                    ASQ     0,X1,PR3

      178     1370    1      IF FR_PRC$(MODE)->FR$PR(RCD)<0 THEN CALL SC_R2MNYP;

   1370  1 000064   100000 720100                    LXL0    0,,PR1
         1 000065   000000 473410 xsym               LDP3    FR_PRC$,X0
         1 000066   200005 721100                    LXL1    RCD,,AUTO
         1 000067   300000 235111                    LDA     0,X1,PR3
         1 000070   000073 605000 1                  TPL     s:1382

   1370  1 000071   000000 713400 xsym               CLIMB   SC_R2MNYP
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:38   
         1 000072   000000 600000 xsid               climb   nvectors=         0

      179     1371           /*S*  SCREECH_CODE:  FRZ-S$R2MANY
      180     1372                 TYPE:          Screech
      181     1373                 MESSAGE:       More resources released than were ever allocated
      182     1374                 REMARKS:       *THIS IS THE BUDDY DOEPPEL MEMORIAL SCREECH*
      183     1375                                This screech occurs when the "currently allocated"
      184     1376                                count for a resource goes negative.  The screech is
      185     1377                                done for physical resources here and for
      186     1378                                memory and pseudos in FRP$PMME (FRP-S$R2MANY).
      187     1379                                This screech occurs as a result of resource
      188     1380                                management bugs or possibly a malicious user with
      189     1381                                JIT or monitor access has changed some numbers          */
      190     1382    2      IF RAT.RES.RFLG.OLT AND RCD=FR_MT THEN DO;

   1382  1 000073   200003 470500                    LDP0    @RAT,,AUTO
         1 000074   000003 236100                    LDQ     3,,PR0
         1 000075   020000 316003                    CANQ    8192,DU
         1 000076   000116 600000 1                  TZE     s:1387
         1 000077   200005 235100                    LDA     RCD,,AUTO
         1 000100   000001 115007                    CMPA    1,DL
         1 000101   000116 601000 1                  TNZ     s:1387

      191     1383    2         IF RAT.RES.NUMB='01' THEN OLTX=0;

   1383  1 000102   000001 720100                    LXL0    1,,PR0
         1 000103   000010 100000 0                  CMPX0   FPT_SYSCON+8
         1 000104   000107 601000 1                  TNZ     s:1384

   1383  1 000105   200007 450100                    STZ     SAVEPRIV,,AUTO
         1 000106   000111 710000 1                  TRA     s:1385

      192     1384    2         ELSE OLTX=1;

   1384  1 000107   000001 235007                    LDA     1,DL
         1 000110   200007 755100                    STA     SAVEPRIV,,AUTO

PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:39   
      193     1385    2         B$JIT$->B$JIT.OLTA(OLTX)='1'B;

   1385  1 000111   000000 471400 xsym               LDP1    B$JIT$
         1 000112   200007 235100                    LDA     SAVEPRIV,,AUTO
         1 000113   003105 060400                    CSL     bolr='003'O
         1 000114   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         1 000115   100333 400001                    BDSC    219,A,PR1                by=2,bit=0,n=1

      194     1386    2         END;

      195     1387    1      RAT.RES='0'B;

   1387  1 000116   000100 100400                    MLR     fill='000'O
         1 000117   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000120   000001 000011                    ADSC9   1,,PR0                   cn=0,n=9

      196     1388    2      IF RAT.DCTX=0 THEN DO; /* Resource has disconnected */

   1388  1 000121   000003 720100                    LXL0    3,,PR0
         1 000122   000131 601000 1                  TNZ     s:1392

      197     1389    2         RAT.RCOD=FR_FREE;

   1389  1 000123   000003 236100                    LDQ     3,,PR0
         1 000124   000000 376000 2                  ANQ     0
         1 000125   000140 276003                    ORQ     96,DU
         1 000126   000003 756100                    STQ     3,,PR0

      198     1390    2         RAT.FLG=%DOWNBIT;

   1390  1 000127   000002 236007                    LDQ     2,DL
         1 000130   000010 552104                    STBQ    8,'04'O,PR0

      199     1391    2         END;

      200     1392    1      DCT$=N$DCT$(RAT.DCTX);

PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:40   
   1392  1 000131   000000 471400 xsym               LDP1    N$DCT$$
         1 000132   100000 236110                    LDQ     0,X0,PR1
         1 000133   200006 756100                    STQ     DCT$,,AUTO

      201     1393    1      IF RAT.RCOD=RCD THEN IF DCT.STATUS.SYSCON_PART OR DCT.STATUS.MSOS_PART

   1393  1 000134   000003 236100                    LDQ     3,,PR0
         1 000135   000027 772000                    QRL     23
         1 000136   000017 376007                    ANQ     15,DL
         1 000137   200005 116100                    CMPQ    RCD,,AUTO
         1 000140   000177 601000 1                  TNZ     s:1402

   1393  1 000141   200006 473500                    LDP3    DCT$,,AUTO
         1 000142   300027 236100                    LDQ     23,,PR3
         1 000143   004000 316003                    CANQ    2048,DU
         1 000144   000147 601000 1                  TNZ     s:1395
         1 000145   002000 316003                    CANQ    1024,DU
         1 000146   000177 600000 1                  TZE     s:1402

      202     1394    2         THEN DO; /* delayed partitioning */

      203     1395    2            FPT$SYSCON=FPT_SYSCON;

   1395  1 000147   000100 100400                    MLR     fill='000'O
         1 000150   000000 000040 0                  ADSC9   FPT_SYSCON               cn=0,n=32
         1 000151   200010 000040                    ADSC9   FPT$SYSCON,,AUTO         cn=0,n=32

      204     1396    2            FPT$SYSCON.V.DEVNM#=DCT.DEVNM;

   1396  1 000152   040100 100500                    MLR     fill='040'O
         1 000153   300002 000010                    ADSC9   2,,PR3                   cn=0,n=8
         1 000154   200015 000010                    ADSC9   FPT$SYSCON+5,,AUTO       cn=0,n=8

      205     1397    2            SAVEPRIV=B$JIT.PRIV.ACTIVE;

   1397  1 000155   000000 474400 xsym               LDP4    B$JIT$
         1 000156   400013 236100                    LDQ     11,,PR4
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:41   
         1 000157   200007 756100                    STQ     SAVEPRIV,,AUTO

      206     1398    2            B$JIT.PRIV.ACTIVE=%PR_SYSCON#;

   1398  1 000160   000020 236000 xsym               LDQ     B_VECTNIL+16
         1 000161   400013 756100                    STQ     11,,PR4

      207     1399    2            CALL TDP$SYSCON(FPT$SYSCON.V,RCD,RCD);

   1399  1 000162   200005 635500                    EPPR5   RCD,,AUTO
         1 000163   200022 455500                    STP5    FPT$SYSCON+10,,AUTO
         1 000164   200005 636500                    EPPR6   RCD,,AUTO
         1 000165   200021 456500                    STP6    FPT$SYSCON+9,,AUTO
         1 000166   200014 637500                    EPPR7   FPT$SYSCON+4,,AUTO
         1 000167   200020 457500                    STP7    FPT$SYSCON+8,,AUTO
         1 000170   200020 630500                    EPPR0   FPT$SYSCON+8,,AUTO
         1 000171   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000172   000000 701000 xent               TSX1    TDP$SYSCON
         1 000173   000000 011000                    NOP     0

      208     1400    2            B$JIT.PRIV.ACTIVE=SAVEPRIV;

   1400  1 000174   200007 236100                    LDQ     SAVEPRIV,,AUTO
         1 000175   000000 470400 xsym               LDP0    B$JIT$
         1 000176   000013 756100                    STQ     11,,PR0

      209     1401    2            END;

      210     1402    1      RETURN;

   1402  1 000177   000000 702200 xent               TSX2  ! X66_ARET

FPT_SYSCON
 Sect OctLoc
   0     000   000003 777640   000004 006000   000000 177640   000000 006014    ................
   0     004   001002 000000   040040 040040   040040 040040   0000** ******    ....        ....

PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:42   
(unnamed)
 Sect OctLoc
   0     010   060061 040040                                                    01

(unnamed)
 Sect OctLoc
   2     000   777037 777777                                                    ....
      211     1403    1   END;
      212     1404           /**/
      213     1405           /**/
      214     1406        %EOD;

PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:43   
--  Include file information  --

   TD_CP6.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR$RAT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   A$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FRZ$RRES.
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:44   

 **** Variables and constants ****

  ****  Section 000 RoData FRZ$RRES

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(288)   r     1 FPT_SYSCON

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @MODE                      3-0-0/w PTR         r     1 @RAT
     6-0-0/w PTR         r     1 DCT$                      10-0-0/d STRC(288)   r     1 FPT$SYSCON
    *0-0-0/w UBIN        r     1 MODE                       7-0-0/w UBIN        r     1 OLTX
    *0-0-0/w STRC(324)   r     1 RAT                        5-0-0/w SBIN        r     1 RCD
     7-0-0/b BIT         r     1 SAVEPRIV

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 FR_PRC$(0:0)
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(1332)  r     1 DCT
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:45   
     0-0-0/w SBIN        r     1 FR$PR(0:0)                 0-0-0/w PTR         r     1 N$DCT$(0:0)


   Procedure FRZ$RRES requires 128 words for executable code.
   Procedure FRZ$RRES requires 20 words of local(AUTO) storage.
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:46   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:47   
          MINI XREF LISTING

B$JIT.ERR.MID
       339**DCL       339--REDEF
B$JIT.OLTA
       438**DCL      1385<<ASSIGN
B$JIT.ORIGINATOR_PORT.FROM_CR
       441**DCL       441--REDEF     442--REDEF
B$JIT.PRIV.ACTIVE
       339**DCL      1397>>ASSIGN   1398<<ASSIGN   1400<<ASSIGN
B$JIT.TSLINE
       439**DCL       440--REDEF
B$JIT$
      1343**DCL       333--IMP-PTR  1385>>ASSIGN   1397>>ASSIGN   1398>>ASSIGN   1400>>ASSIGN
DCT.DEVNM
      1085**DCL      1396>>ASSIGN
DCT.DP
      1105**DCL      1112--REDEF    1115--REDEF    1116--REDEF    1118--REDEF    1118--REDEF    1119--REDEF
      1120--REDEF    1120--REDEF
DCT.MPC.IOCHANX
      1113**DCL      1113--REDEF
DCT.STATUS.MSOS_PART
      1104**DCL      1393>>IF
DCT.STATUS.SYSCON_PART
      1103**DCL      1393>>IF
DCT$
      1306**DCL      1085--IMP-PTR  1392<<ASSIGN   1393>>IF       1393>>IF       1396>>ASSIGN
FPT$SYSCON
      1337**DCL      1395<<ASSIGN
FPT$SYSCON.V
      1337**DCL      1399<>CALL
FPT$SYSCON.V.DEVNM#
      1340**DCL      1396<<ASSIGN
FPT$SYSCON.V.IOM#
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:48   
      1338**DCL      1339--REDEF    1339--REDEF
FPT_SYSCON
      1320**DCL      1395>>ASSIGN
FPT_SYSCON.V
      1320**DCL      1320--DCLINIT
FPT_SYSCON.V.IOM#
      1321**DCL      1322--REDEF    1322--REDEF
FR$PR
       554**DCL      1369<<ASSIGN   1369>>ASSIGN   1370>>IF
FRS$CLSTRS
      1348**DCL-ENT  1358--CALL
FRS$OPSTRS
      1346**DCL-ENT  1356--CALL
FRS$RESSUB
      1347**DCL-ENT  1357--CALL
FRZ$DSMT
      1345**DCL-ENT  1363--CALL
FR_PRC$
       553**DCL      1369>>ASSIGN   1369>>ASSIGN   1370>>IF
MODE
      1304**DCL         8--PROC     1361--ENTRY    1369>>ASSIGN   1369>>ASSIGN   1370>>IF
N$DCT$
      1071**DCL      1392>>ASSIGN
N$DCT$$
       937**DCL      1071--IMP-PTR  1392>>ASSIGN
N$FQ$
       937**DCL      1072--IMP-PTR
N$REQ_INIT.BUFADDR
       956**DCL       957--REDEF     957--REDEF
N$REQ_INIT.DLA.DRELADDR
       948**DCL       948--REDEF
N$REQ_INIT.DVE.EOMCHAR
       985**DCL       986--REDEF
N$REQ_INIT.EAINFO
       979**DCL       979--REDEF
N$REQ_INIT.EAINFOX
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:49   
       979**DCL       980--REDEF
N$REQ_INIT.EVNTINFO
       980**DCL       980--REDEF
N$REQ_INIT.STATUS
       961**DCL       967--REDEF
NI$FQ$
       997**DCL      1073--IMP-PTR
NI$IBUF$
       997**DCL      1073--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
      1007**DCL      1008--REDEF    1008--REDEF
NI$IMXMBX_INIT.SIZE
      1009**DCL      1009--REDEF
NI$REQ_INIT.DCW
      1031**DCL      1034--REDEF
NI$REQ_INIT.DCW.TALLY
      1032**DCL      1032--REDEF
NI$REQ_INIT.IDCW.EXTA
      1034**DCL      1034--REDEF
NI$REQ_INIT.PCW
      1036**DCL      1040--REDEF
NI$REQ_INIT.SEEK
      1041**DCL      1042--REDEF    1043--REDEF
NI$RP$
      1045**DCL      1075--IMP-PTR
NI_MBX_INIT.DCW.CONTROL.AE
      1067**DCL      1067--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      1063**DCL      1063--REDEF
OLTX
      1308**DCL      1383<<ASSIGN   1384<<ASSIGN   1385>>ASSIGN
RAT
       501**DCL         8--PROC     1357<>CALL     1361--ENTRY    1363<>CALL
RAT.DCTX
       519**DCL      1388>>IF       1392>>ASSIGN
RAT.FLG
PL6.E3A0      #002=FRZ$RRES File=FRZ$COMSUB.:E05TSI                              TUE 07/29/97 17:25 Page:50   
       527**DCL      1390<<ASSIGN
RAT.FLG.MBIT.MTD
       529**DCL      1363>>IF
RAT.RCOD
       514**DCL      1364>>IF       1366>>ASSIGN   1389<<ASSIGN   1393>>IF
RAT.REEL.ASID
       521**DCL      1364<<ASSIGN
RAT.RES
       503**DCL      1387<<ASSIGN
RAT.RES.ACTX
       507**DCL      1354>>IF
RAT.RES.NUMB
       505**DCL      1383>>IF
RAT.RES.RFLG.NOSLD
       511**DCL      1355<<ASSIGN
RAT.RES.RFLG.OLT
       510**DCL      1382>>IF
RCD
      1305**DCL      1366<<ASSIGN   1367>>IF       1368<<ASSIGN   1369>>ASSIGN   1369>>ASSIGN   1370>>IF
      1382>>IF       1393>>IF       1399<>CALL     1399<>CALL
SAVEPRIV
      1307**DCL      1308--REDEF    1397<<ASSIGN   1400>>ASSIGN
SC_R2MNYP
      1351**DCL-ENT  1370--CALL
SSS$BLOCK
      1344**DCL-ENT  1365--CALL
TDP$SYSCON
      1349**DCL-ENT  1399--CALL

PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:51   
      215        1        /*T***********************************************************/
      216        2        /*T*                                                         */
      217        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      218        4        /*T*                                                         */
      219        5        /*T***********************************************************/
      220        6           /**/
      221        7           /**/
      222        8        FRZ$GETRES: PROC (RTYPI,TM2,SID,MODE,RAT$$) ALTRET;
      223        9           /**/
      224       10           /**/
      225       11        %INCLUDE B$JIT_C;
      226      325        %B$JIT0;
      227      414        %A$JIT6X;
      228      417        %INCLUDE FR$RAT;
      229      470        %FR$RAT (NAME=RAT,STCLASS="BASED(RAT$)");
      230      510        %INCLUDE FR_DATA_R;
      231      542        %INCLUDE CP_6_SUBS;
      232     1082        %INCLUDE FR_SUBS;
      233     1150           /**/
      234     1151           /**/
      235     1152    1   DCL RCD SBIN;
      236     1153    1   DCL TM2 BIT(18) UNAL;
      237     1154    1   DCL 1 ATTR ALIGNED,
      238     1155    1         2 DENS BIT(9) UNAL,
      239     1156    1         2 * BIT(9) UNAL,
      240     1157    1         2 * BIT(18) UNAL;
      241     1158    1   DCL MODE UBIN WORD;
      242     1159    1   DCL RTYPI CHAR(2);
      243     1160    1   DCL RTYP CHAR(2) UNAL;
      244     1161    1   DCL SID UBIN WORD;
      245     1162    1   DCL RAT$$ PTR;
      246     1163    1   DCL RAT$ PTR;
      247     1164    1   DCL 1 RAT$PTR REDEF RAT$,
      248     1165    1         2 * BIT(24),2 SEGID UBIN(12) UNAL;
      249     1166    1   DCL B$JIT$ PTR SYMREF;
      250     1167    1   DCL S_MING UBIN SYMREF;
      251     1168    1   DCL S_CUN UBIN SYMREF;
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:52   
      252     1169    1   DCL SSS$BLOCKM ENTRY;
      253     1170           /**/
      254     1171        %INCLUDE FR_ERRORS_C;
      255     1202        %INCLUDE UD_SEV_C;
      256     1216           /**/
      257     1217    1   DCL 1 NOMODE CONSTANT ALIGNED,
      258     1218    1         2 FCG BIT(18) UNAL INIT('062232'O),
      259     1219    1         2 ERR UBIN(15) UNAL INIT(%E$NORSM),
      260     1220    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      261     1221    1   DCL 1 NOSYS CONSTANT ALIGNED,
      262     1222    1         2 FCG BIT(18) UNAL INIT('062232'O),
      263     1223    1         2 ERR UBIN(15) UNAL INIT(%E$NORSS),
      264     1224    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      265     1225           /**/
      266     1226           /**/
      267     1227    2      DO INHIBIT;
      268     1228    2         RTYP=RTYPI;
      269     1229    2         ATTR=TM2;
      270     1230    3         DO SELECT(RTYP);
      271     1231    3            SELECT('CL');
      272     1232    3            RCD=FR_NPOOL;
      273     1233    3            RAT$=ADDR(RTYPI); /* don't allow allocation from FRP$PMME (ps2) */
      274     1234    3            IF RAT$PTR.SEGID~=2 THEN EXIT;
      275     1235    3            B$JIT.ERR=NOSYS;
      276     1236    3            ALTRETURN;
      277     1237    3            SELECT('DP');
      278     1238    3            RCD=FR_DP;
      279     1239    3            IF NOT ATTR&%ATTR_DENS# THEN ATTR=FR_DPDFLT;
      280     1240    3            SELECT('MT','LT','FT');
      281     1241    3            RTYP='MT';
      282     1242    3            RCD=FR_MT;
      283     1243    3            IF NOT ATTR&%ATTR_DENS# THEN ATTR=FR_MTDFLT;
      284     1244    3            SELECT(ELSE);
      285     1245    3         RCD=FR_NPOOL;
      286     1246    3            END;
      287     1247    2      CALL SSS$BLOCKM;
      288     1248    2      FR_PRC$(MODE)->FR$PR(RCD)=FR_PRC$(MODE)->FR$PR(RCD)+1;
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:53   
      289     1249    2      IF FR_PRC$(MODE)->FR$PR(RCD)>FR_PRM$(MODE)->FR$PR(RCD) AND
      290     1250    2        SID > S_MING /* #28265/#34341 */
      291     1251    3      THEN DO;
      292     1252    3         B$JIT.ERR=NOMODE;
      293     1253           /*E*  ERROR:         FRZ-E$NORSM-E
      294     1254                  MESSAGE: No more of this resource available for your mode.
      295     1255                 MESSAGE1: You explicitly (via !RES or !ORES) or implicitly (by
      296     1256                           asking for a tape online without using !ORES) asked
      297     1257                           the system to allocate a resource for you.
      298     1258                           Allocating the resource would exceed the limit
      299     1259                           placed on your mode (TIMESHARING, BATCH) for this
      300     1260                           resource by the system manager.
      301     1261                 DESCRIPTION:   Current for this mode for this resource would
      302     1262                              exceed the maximum if we allocated the resource             */
      303     1263    3         GOTO GTRSX;
      304     1264    3         END;
      305     1265    2      IF RCD~=FR_MT OR FR_NXTMT$=ADDR(NIL) THEN RAT$=FR$HD$(RCD);
      306     1266    2      ELSE RAT$=FR_NXTMT$;
      307     1267    3      DO WHILE (RAT$~=ADDR(NIL));
      308     1268    3         IF RAT.TYP=RTYP
      309     1269    3           AND RAT.RES.SISID=0
      310     1270    3           AND NOT ATTR&~RAT.M1
      311     1271    3           AND NOT RAT.FLG.DOWN
      312     1272    3           AND NOT RAT.FLG.MBIT.MTD
      313     1273    4         THEN DO;
      314     1274    4            IF RCD=FR_NPOOL AND ATTR='0'B THEN ATTR=RAT.M1;
      315     1275    4            RAT.RES.M2=ATTR;
      316     1276    4            RAT.RES.SISID=SID;
      317     1277    4            IF RCD=FR_MT THEN FR_NXTMT$=RAT.LNK$;
      318     1278    4            RAT$$=RAT$;
      319     1279    4            RETURN;
      320     1280    4            END;
      321     1281    3   GTRS1: ;
      322     1282    3         RAT$=RAT.LNK$;
      323     1283    3         IF RCD=FR_MT THEN IF RAT$=FR_NXTMT$ THEN EXIT;
      324     1284    3            ELSE IF RAT$=ADDR(NIL) THEN RAT$=FR$HD$(FR_MT);
      325     1285    3         END;
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:54   
      326     1286    2      B$JIT.ERR=NOSYS;
      327     1287           /*E*  ERROR:         FRZ-E$NORSS-E
      328     1288                  MESSAGE: None of these resources are available on the system.
      329     1289                 MESSAGE1: You explicitly (via !RES or !ORES) or implicitly (by
      330     1290                           asking for a tape online without using !ORES) asked
      331     1291                           the system to allocate a resource for you.
      332     1292                           All of the system's resources of that type are
      333     1293                           either allocated or not available.
      334     1294                 DESCRIPTION:   We are out of what he wants - all in use or partitioned */
      335     1295    2   GTRSX:;
      336     1296    2      FR_PRC$(MODE)->FR$PR(RCD)=FR_PRC$(MODE)->FR$PR(RCD)-1;
      337     1297    2      ALTRETURN;
      338     1298    2         END;
      339     1299    1   END;
      340     1300           /**/
      341     1301           /**/
      342     1302        %EOD;

PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:55   
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   FR_ERRORS_C.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FR_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR$RAT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FRZ$GETRES.

   Procedure FRZ$GETRES requires 152 words for executable code.
   Procedure FRZ$GETRES requires 12 words of local(AUTO) storage.

PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:56   

 Object Unit name= FRZ$GETRES                                 File name= FRZ$COMSUB.:E05TOU
 UTS= JUL 29 '97 17:26:03.76 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      7      7  FRZ$GETRES
    1   Proc  even  none   152    230  FRZ$GETRES

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        5  FRZ$GETRES

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 SSS$BLOCKM
                       nStd      0 X66_AUTO_5
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     FR$HD$                                FR_NXTMT$                             FR_PRC$
     FR_PRM$                               FR_MTDFLT                             FR_DPDFLT
     B$JIT$                                S_MING                                B_VECTNIL
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:57   


      215        1        /*T***********************************************************/
      216        2        /*T*                                                         */
      217        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      218        4        /*T*                                                         */
      219        5        /*T***********************************************************/
      220        6           /**/
      221        7           /**/
      222        8        FRZ$GETRES: PROC (RTYPI,TM2,SID,MODE,RAT$$) ALTRET;

      8  1 000000   000000 700200 xent  FRZ$GETRES   TSX0  ! X66_AUTO_5
         1 000001   000014 000005                    ZERO    12,5

      223        9           /**/
      224       10           /**/
      225       11        %INCLUDE B$JIT_C;
      226      325        %B$JIT0;
      227      414        %A$JIT6X;
      228      417        %INCLUDE FR$RAT;
      229      470        %FR$RAT (NAME=RAT,STCLASS="BASED(RAT$)");
      230      510        %INCLUDE FR_DATA_R;
      231      542        %INCLUDE CP_6_SUBS;
      232     1082        %INCLUDE FR_SUBS;
      233     1150           /**/
      234     1151           /**/
      235     1152    1   DCL RCD SBIN;
      236     1153    1   DCL TM2 BIT(18) UNAL;
      237     1154    1   DCL 1 ATTR ALIGNED,
      238     1155    1         2 DENS BIT(9) UNAL,
      239     1156    1         2 * BIT(9) UNAL,
      240     1157    1         2 * BIT(18) UNAL;
      241     1158    1   DCL MODE UBIN WORD;
      242     1159    1   DCL RTYPI CHAR(2);
      243     1160    1   DCL RTYP CHAR(2) UNAL;
      244     1161    1   DCL SID UBIN WORD;
      245     1162    1   DCL RAT$$ PTR;
      246     1163    1   DCL RAT$ PTR;
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:58   
      247     1164    1   DCL 1 RAT$PTR REDEF RAT$,
      248     1165    1         2 * BIT(24),2 SEGID UBIN(12) UNAL;
      249     1166    1   DCL B$JIT$ PTR SYMREF;
      250     1167    1   DCL S_MING UBIN SYMREF;
      251     1168    1   DCL S_CUN UBIN SYMREF;
      252     1169    1   DCL SSS$BLOCKM ENTRY;
      253     1170           /**/
      254     1171        %INCLUDE FR_ERRORS_C;
      255     1202        %INCLUDE UD_SEV_C;
      256     1216           /**/
      257     1217    1   DCL 1 NOMODE CONSTANT ALIGNED,
      258     1218    1         2 FCG BIT(18) UNAL INIT('062232'O),
      259     1219    1         2 ERR UBIN(15) UNAL INIT(%E$NORSM),
      260     1220    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      261     1221    1   DCL 1 NOSYS CONSTANT ALIGNED,
      262     1222    1         2 FCG BIT(18) UNAL INIT('062232'O),
      263     1223    1         2 ERR UBIN(15) UNAL INIT(%E$NORSS),
      264     1224    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      265     1225           /**/
      266     1226           /**/
      267     1227    2      DO INHIBIT;

      268     1228    2         RTYP=RTYPI;

   1228  1 000002   200003 470700                    LDP0  ! @RTYPI,,AUTO
         1 000003   040100 100700                    MLR   ! fill='040'O
         1 000004   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         1 000005   200012 000002                    ADSC9   RTYP,,AUTO               cn=0,n=2

      269     1229    2         ATTR=TM2;

   1229  1 000006   200004 471700                    LDP1  ! @TM2,,AUTO
         1 000007   003100 060700                    CSL   ! bolr='003'O
         1 000010   100000 000022                    BDSC    0,,PR1                   by=0,bit=0,n=18
         1 000011   200011 000044                    BDSC    ATTR,,AUTO               by=0,bit=0,n=36

      270     1230    3         DO SELECT(RTYP);
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:59   

   1230  1 000012   200012 220300                    LDX0  ! RTYP,,AUTO
         1 000013   000002 100200 0                  CMPX0 ! NOSYS+1
         1 000014   000027 602200 1                  TNC   ! s:1230+13
         1 000015   000046 600200 1                  TZE   ! s:1238
         1 000016   000003 100200 0                  CMPX0 ! NOSYS+2
         1 000017   000024 602200 1                  TNC   ! s:1230+10
         1 000020   000055 600200 1                  TZE   ! s:1241
         1 000021   000004 100200 0                  CMPX0 ! NOSYS+3
         1 000022   000067 601200 1                  TNZ   ! s:1245
         1 000023   000055 710200 1                  TRA   ! s:1241
         1 000024   000005 100200 0                  CMPX0 ! NOSYS+4
         1 000025   000067 601200 1                  TNZ   ! s:1245
         1 000026   000055 710200 1                  TRA   ! s:1241
         1 000027   000006 100200 0                  CMPX0 ! NOSYS+5
         1 000030   000067 601200 1                  TNZ   ! s:1245
         1 000031   000032 710200 1                  TRA   ! s:1232

      271     1231    3            SELECT('CL');

      272     1232    3            RCD=FR_NPOOL;

   1232  1 000032   000002 235207                    LDA   ! 2,DL
         1 000033   200010 755300                    STA   ! RCD,,AUTO

      273     1233    3            RAT$=ADDR(RTYPI); /* don't allow allocation from FRP$PMME (ps2) */

   1233  1 000034   200003 236300                    LDQ   ! @RTYPI,,AUTO
         1 000035   200013 756300                    STQ   ! RAT$,,AUTO

      274     1234    3            IF RAT$PTR.SEGID~=2 THEN EXIT;

   1234  1 000036   200013 236300                    LDQ   ! RAT$,,AUTO
         1 000037   007777 376207                    ANQ   ! 4095,DL
         1 000040   000002 116207                    CMPQ  ! 2,DL
         1 000041   000071 601200 1                  TNZ   ! s:1247

PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:60   
      275     1235    3            B$JIT.ERR=NOSYS;

   1235  1 000042   000001 236200 0                  LDQ   ! NOSYS
         1 000043   000000 473600 xsym               LDP3  ! B$JIT$
         1 000044   300012 756300                    STQ   ! 10,,PR3

      276     1236    3            ALTRETURN;

   1236  1 000045   000000 702200 xent               TSX2  ! X66_AALT

      277     1237    3            SELECT('DP');

      278     1238    3            RCD=FR_DP;

   1238  1 000046   200010 450300                    STZ   ! RCD,,AUTO

      279     1239    3            IF NOT ATTR&%ATTR_DENS# THEN ATTR=FR_DPDFLT;

   1239  1 000047   200011 236300                    LDQ   ! ATTR,,AUTO
         1 000050   777000 376203                    ANQ   ! -512,DU
         1 000051   000071 601200 1                  TNZ   ! s:1247

   1239  1 000052   000000 236200 xsym               LDQ   ! FR_DPDFLT
         1 000053   200011 756300                    STQ   ! ATTR,,AUTO
         1 000054   000071 710200 1                  TRA   ! s:1247

      280     1240    3            SELECT('MT','LT','FT');

      281     1241    3            RTYP='MT';

   1241  1 000055   000004 221200 0                  LDX1  ! NOSYS+3
         1 000056   200012 741300                    STX1  ! RTYP,,AUTO

      282     1242    3            RCD=FR_MT;

   1242  1 000057   000001 235207                    LDA   ! 1,DL
         1 000060   200010 755300                    STA   ! RCD,,AUTO
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:61   

      283     1243    3            IF NOT ATTR&%ATTR_DENS# THEN ATTR=FR_MTDFLT;

   1243  1 000061   200011 236300                    LDQ   ! ATTR,,AUTO
         1 000062   777000 376203                    ANQ   ! -512,DU
         1 000063   000071 601200 1                  TNZ   ! s:1247

   1243  1 000064   000000 236200 xsym               LDQ   ! FR_MTDFLT
         1 000065   200011 756300                    STQ   ! ATTR,,AUTO
         1 000066   000071 710200 1                  TRA   ! s:1247

      284     1244    3            SELECT(ELSE);

      285     1245    3         RCD=FR_NPOOL;

   1245  1 000067   000002 235207                    LDA   ! 2,DL
         1 000070   200010 755300                    STA   ! RCD,,AUTO

      286     1246    3            END;

      287     1247    2      CALL SSS$BLOCKM;

   1247  1 000071   000002 631600 xsym               EPPR1 ! B_VECTNIL+2
         1 000072   000000 701200 xent               TSX1  ! SSS$BLOCKM
         1 000073   000000 011200                    NOP   ! 0

      288     1248    2      FR_PRC$(MODE)->FR$PR(RCD)=FR_PRC$(MODE)->FR$PR(RCD)+1;

   1248  1 000074   200006 470700                    LDP0  ! @MODE,,AUTO
         1 000075   000000 720300                    LXL0  ! 0,,PR0
         1 000076   000000 471610 xsym               LDP1  ! FR_PRC$,X0
         1 000077   200010 721300                    LXL1  ! RCD,,AUTO
         1 000100   100000 054311                    AOS   ! 0,X1,PR1

      289     1249    2      IF FR_PRC$(MODE)->FR$PR(RCD)>FR_PRM$(MODE)->FR$PR(RCD) AND

   1249  1 000101   000000 720300                    LXL0  ! 0,,PR0
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:62   
         1 000102   000000 471610 xsym               LDP1  ! FR_PRC$,X0
         1 000103   000000 473610 xsym               LDP3  ! FR_PRM$,X0
         1 000104   100000 236311                    LDQ   ! 0,X1,PR1
         1 000105   300000 116311                    CMPQ  ! 0,X1,PR3
         1 000106   000117 604600 1                  TMOZ  ! s:1265
         1 000107   200005 474700                    LDP4  ! @SID,,AUTO
         1 000110   000000 236200 xsym               LDQ   ! S_MING
         1 000111   400000 116300                    CMPQ  ! 0,,PR4
         1 000112   000117 603200 1                  TRC   ! s:1265

      290     1250    2        SID > S_MING /* #28265/#34341 */
      291     1251    3      THEN DO;

      292     1252    3         B$JIT.ERR=NOMODE;

   1252  1 000113   000000 236200 0                  LDQ   ! NOMODE
         1 000114   000000 475600 xsym               LDP5  ! B$JIT$
         1 000115   500012 756300                    STQ   ! 10,,PR5

      293     1253           /*E*  ERROR:         FRZ-E$NORSM-E
      294     1254                  MESSAGE: No more of this resource available for your mode.
      295     1255                 MESSAGE1: You explicitly (via !RES or !ORES) or implicitly (by
      296     1256                           asking for a tape online without using !ORES) asked
      297     1257                           the system to allocate a resource for you.
      298     1258                           Allocating the resource would exceed the limit
      299     1259                           placed on your mode (TIMESHARING, BATCH) for this
      300     1260                           resource by the system manager.
      301     1261                 DESCRIPTION:   Current for this mode for this resource would
      302     1262                              exceed the maximum if we allocated the resource            */
      303     1263    3         GOTO GTRSX;

   1263  1 000116   000220 710200 1                  TRA   ! GTRSX

      304     1264    3         END;
      305     1265    2      IF RCD~=FR_MT OR FR_NXTMT$=ADDR(NIL) THEN RAT$=FR$HD$(RCD);

   1265  1 000117   200010 235300                    LDA   ! RCD,,AUTO
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:63   
         1 000120   000001 115207                    CMPA  ! 1,DL
         1 000121   000125 601200 1                  TNZ   ! s:1265+6
         1 000122   000000 236200 xsym               LDQ   ! FR_NXTMT$
         1 000123   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 000124   000130 601200 1                  TNZ   ! s:1266

   1265  1 000125   000000 236211 xsym               LDQ   ! FR$HD$,X1
         1 000126   200013 756300                    STQ   ! RAT$,,AUTO
         1 000127   000131 710200 1                  TRA   ! s:1267

      306     1266    2      ELSE RAT$=FR_NXTMT$;

   1266  1 000130   200013 756300                    STQ   ! RAT$,,AUTO

      307     1267    3      DO WHILE (RAT$~=ADDR(NIL));

   1267  1 000131   000213 710200 1                  TRA   ! s:1285

      308     1268    3         IF RAT.TYP=RTYP

   1268  1 000132   200013 470700                    LDP0  ! RAT$,,AUTO
         1 000133   000010 220300                    LDX0  ! 8,,PR0
         1 000134   200012 100300                    CMPX0 ! RTYP,,AUTO
         1 000135   000200 601200 1                  TNZ   ! GTRS1
         1 000136   000001 221300                    LDX1  ! 1,,PR0
         1 000137   000200 601200 1                  TNZ   ! GTRS1
         1 000140   000006 236300                    LDQ   ! 6,,PR0
         1 000141   777777 376203                    ANQ   ! -1,DU
         1 000142   777777 676203                    ERQ   ! -1,DU
         1 000143   200011 376300                    ANQ   ! ATTR,,AUTO
         1 000144   000200 601200 1                  TNZ   ! GTRS1
         1 000145   000010 236300                    LDQ   ! 8,,PR0
         1 000146   000002 316207                    CANQ  ! 2,DL
         1 000147   000200 601200 1                  TNZ   ! GTRS1
         1 000150   000400 316207                    CANQ  ! 256,DL
         1 000151   000200 601200 1                  TNZ   ! GTRS1

PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:64   
      309     1269    3           AND RAT.RES.SISID=0
      310     1270    3           AND NOT ATTR&~RAT.M1
      311     1271    3           AND NOT RAT.FLG.DOWN
      312     1272    3           AND NOT RAT.FLG.MBIT.MTD
      313     1273    4         THEN DO;

      314     1274    4            IF RCD=FR_NPOOL AND ATTR='0'B THEN ATTR=RAT.M1;

   1274  1 000152   200010 235300                    LDA   ! RCD,,AUTO
         1 000153   000002 115207                    CMPA  ! 2,DL
         1 000154   000162 601200 1                  TNZ   ! s:1275
         1 000155   200011 235300                    LDA   ! ATTR,,AUTO
         1 000156   000162 601200 1                  TNZ   ! s:1275

   1274  1 000157   000006 236300                    LDQ   ! 6,,PR0
         1 000160   777777 376203                    ANQ   ! -1,DU
         1 000161   200011 756300                    STQ   ! ATTR,,AUTO

      315     1275    4            RAT.RES.M2=ATTR;

   1275  1 000162   200011 222300                    LDX2  ! ATTR,,AUTO
         1 000163   000002 742300                    STX2  ! 2,,PR0

      316     1276    4            RAT.RES.SISID=SID;

   1276  1 000164   200005 471700                    LDP1  ! @SID,,AUTO
         1 000165   100000 723300                    LXL3  ! 0,,PR1
         1 000166   000001 743300                    STX3  ! 1,,PR0

      317     1277    4            IF RCD=FR_MT THEN FR_NXTMT$=RAT.LNK$;

   1277  1 000167   200010 235300                    LDA   ! RCD,,AUTO
         1 000170   000001 115207                    CMPA  ! 1,DL
         1 000171   000174 601200 1                  TNZ   ! s:1278

   1277  1 000172   000000 236300                    LDQ   ! 0,,PR0
         1 000173   000000 756200 xsym               STQ   ! FR_NXTMT$
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:65   

      318     1278    4            RAT$$=RAT$;

   1278  1 000174   200013 236300                    LDQ   ! RAT$,,AUTO
         1 000175   200007 473700                    LDP3  ! @RAT$$,,AUTO
         1 000176   300000 756300                    STQ   ! 0,,PR3

      319     1279    4            RETURN;

   1279  1 000177   000000 702200 xent               TSX2  ! X66_ARET

      320     1280    4            END;

   1280  1 000200                       GTRS1        null
      321     1281    3   GTRS1: ;
      322     1282    3         RAT$=RAT.LNK$;

   1282  1 000200   000000 236300                    LDQ   ! 0,,PR0
         1 000201   200013 756300                    STQ   ! RAT$,,AUTO

      323     1283    3         IF RCD=FR_MT THEN IF RAT$=FR_NXTMT$ THEN EXIT;

   1283  1 000202   200010 235300                    LDA   ! RCD,,AUTO
         1 000203   000001 115207                    CMPA  ! 1,DL
         1 000204   000213 601200 1                  TNZ   ! s:1285

   1283  1 000205   000000 116200 xsym               CMPQ  ! FR_NXTMT$
         1 000206   000215 600200 1                  TZE   ! s:1286

      324     1284    3            ELSE IF RAT$=ADDR(NIL) THEN RAT$=FR$HD$(FR_MT);

   1284  1 000207   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 000210   000213 601200 1                  TNZ   ! s:1285

   1284  1 000211   000001 236200 xsym               LDQ   ! FR$HD$+1
         1 000212   200013 756300                    STQ   ! RAT$,,AUTO

PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:66   
      325     1285    3         END;

   1285  1 000213   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 000214   000132 601200 1                  TNZ   ! s:1268

      326     1286    2      B$JIT.ERR=NOSYS;

   1286  1 000215   000001 236200 0                  LDQ   ! NOSYS
         1 000216   000000 470600 xsym               LDP0  ! B$JIT$
         1 000217   000012 756300                    STQ   ! 10,,PR0

   1286  1 000220                       GTRSX        null
      327     1287           /*E*  ERROR:         FRZ-E$NORSS-E
      328     1288                  MESSAGE: None of these resources are available on the system.
      329     1289                 MESSAGE1: You explicitly (via !RES or !ORES) or implicitly (by
      330     1290                           asking for a tape online without using !ORES) asked
      331     1291                           the system to allocate a resource for you.
      332     1292                           All of the system's resources of that type are
      333     1293                           either allocated or not available.
      334     1294                 DESCRIPTION:   We are out of what he wants - all in use or partitioned */
      335     1295    2   GTRSX:;
      336     1296    2      FR_PRC$(MODE)->FR$PR(RCD)=FR_PRC$(MODE)->FR$PR(RCD)-1;

   1296  1 000220   200006 470700                    LDP0  ! @MODE,,AUTO
         1 000221   000000 720300                    LXL0  ! 0,,PR0
         1 000222   000000 471610 xsym               LDP1  ! FR_PRC$,X0
         1 000223   200010 721300                    LXL1  ! RCD,,AUTO
         1 000224   000001 336207                    LCQ   ! 1,DL
         1 000225   100000 056311                    ASQ   ! 0,X1,PR1

      337     1297    2      ALTRETURN;

   1297  1 000226   000000 702200 xent               TSX2  ! X66_AALT

      338     1298    2         END;

      339     1299    1   END;
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:67   

   1299  1 000227   000000 702200 xent               TSX2  ! X66_ARET

NOMODE
 Sect OctLoc
   0     000   062232 012304                                                    2...

NOSYS
 Sect OctLoc
   0     001   062232 012254                                                    2...

(unnamed)
 Sect OctLoc
   0     002   104120 040040   114124 040040   115124 040040   106124 040040    DP  LT  MT  FT
   0     006   103114 040040                                                    CL
      340     1300           /**/
      341     1301           /**/
      342     1302        %EOD;

PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:68   
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   FR_ERRORS_C.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FR_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR$RAT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FRZ$GETRES.
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:69   

 **** Variables and constants ****

  ****  Section 000 RoData FRZ$GETRES

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 NOMODE                     1-0-0/w STRC        r     1 NOSYS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/w PTR         r     1 @MODE                      7-0-0/w PTR         r     1 @RAT$$
     3-0-0/w PTR         r     1 @RTYPI                     5-0-0/w PTR         r     1 @SID
     4-0-0/w PTR         r     1 @TM2                      11-0-0/w STRC        r     1 ATTR
    *0-0-0/w UBIN        r     1 MODE                      13-0-0/w PTR         r     1 RAT$
    *0-0-0/w PTR         r     1 RAT$$                     13-0-0/w STRC        r     1 RAT$PTR
    10-0-0/w SBIN        r     1 RCD                       12-0-0/c CHAR(2)     r     1 RTYP
    *0-0-0/c CHAR(2)     r     1 RTYPI                     *0-0-0/w UBIN        r     1 SID
    *0-0-0/b BIT (18)    r     1 TM2

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 FR$HD$(0:3)
     0-0-0/b BIT         r     1 FR_DPDFLT                  0-0-0/b BIT         r     1 FR_MTDFLT
     0-0-0/w PTR         r     1 FR_NXTMT$
     0-0-0/w PTR         r     1 FR_PRC$(0:0)
     0-0-0/w PTR         r     1 FR_PRM$(0:0)
     0-0-0/w UBIN        r     1 S_MING

  ****  BASED and DCB variables  ****

PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:70   
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(2088)  r     1 B$JIT                      0-0-0/w SBIN        r     1 FR$PR(0:0)
     0-0-0/w STRC(324)   r     1 RAT


   Procedure FRZ$GETRES requires 152 words for executable code.
   Procedure FRZ$GETRES requires 12 words of local(AUTO) storage.
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:71   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:72   
          MINI XREF LISTING

ATTR
      1154**DCL      1229<<ASSIGN   1239>>IF       1239<<ASSIGN   1243>>IF       1243<<ASSIGN   1268>>IF
      1274>>IF       1274<<ASSIGN   1275>>ASSIGN
B$JIT.ERR
       331**DCL      1235<<ASSIGN   1252<<ASSIGN   1286<<ASSIGN
B$JIT.ERR.MID
       332**DCL       332--REDEF
B$JIT$
      1166**DCL       326--IMP-PTR  1235>>ASSIGN   1252>>ASSIGN   1286>>ASSIGN
FR$HD$
       519**DCL      1265>>ASSIGN   1284>>ASSIGN
FR$PR
       525**DCL      1248<<ASSIGN   1248>>ASSIGN   1249>>IF       1249>>IF       1296<<ASSIGN   1296>>ASSIGN
FR_DPDFLT
       538**DCL      1239>>ASSIGN
FR_MTDFLT
       537**DCL      1243>>ASSIGN
FR_NXTMT$
       520**DCL      1265>>IF       1266>>ASSIGN   1277<<ASSIGN   1283>>IF
FR_PRC$
       524**DCL      1248>>ASSIGN   1248>>ASSIGN   1249>>IF       1296>>ASSIGN   1296>>ASSIGN
FR_PRM$
       526**DCL      1249>>IF
GTRSX
      1286**LABEL    1263--GOTO
MODE
      1158**DCL         8--PROC     1248>>ASSIGN   1248>>ASSIGN   1249>>IF       1249>>IF       1296>>ASSIGN
      1296>>ASSIGN
NOMODE
      1217**DCL      1252>>ASSIGN
NOSYS
      1221**DCL      1235>>ASSIGN   1286>>ASSIGN
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:73   
RAT.FLG.DOWN
       507**DCL      1268>>IF
RAT.FLG.MBIT.MTD
       500**DCL      1268>>IF
RAT.LNK$
       473**DCL      1277>>ASSIGN   1282>>ASSIGN
RAT.M1
       494**DCL      1268>>IF       1274>>ASSIGN
RAT.RES.M2
       477**DCL      1275<<ASSIGN
RAT.RES.SISID
       475**DCL      1268>>IF       1276<<ASSIGN
RAT.TYP
       496**DCL      1268>>IF
RAT$
      1163**DCL       472--IMP-PTR  1164--REDEF    1233<<ASSIGN   1265<<ASSIGN   1266<<ASSIGN   1267>>DOWHILE
      1268>>IF       1268>>IF       1268>>IF       1268>>IF       1268>>IF       1274>>ASSIGN   1275>>ASSIGN
      1276>>ASSIGN   1277>>ASSIGN   1278>>ASSIGN   1282<<ASSIGN   1282>>ASSIGN   1283>>IF       1284>>IF
      1284<<ASSIGN
RAT$$
      1162**DCL         8--PROC     1278<<ASSIGN
RAT$PTR.SEGID
      1165**DCL      1234>>IF
RCD
      1152**DCL      1232<<ASSIGN   1238<<ASSIGN   1242<<ASSIGN   1245<<ASSIGN   1248>>ASSIGN   1248>>ASSIGN
      1249>>IF       1249>>IF       1265>>IF       1265>>ASSIGN   1274>>IF       1277>>IF       1283>>IF
      1296>>ASSIGN   1296>>ASSIGN
RTYP
      1160**DCL      1228<<ASSIGN   1230>>DOSELCT  1241<<ASSIGN   1268>>IF
RTYPI
      1159**DCL         8--PROC     1228>>ASSIGN   1233--ASSIGN
SID
      1161**DCL         8--PROC     1249>>IF       1276>>ASSIGN
SSS$BLOCKM
      1169**DCL-ENT  1247--CALL
S_MING
PL6.E3A0      #003=FRZ$GETRES File=FRZ$COMSUB.:E05TSI                            TUE 07/29/97 17:26 Page:74   
      1167**DCL      1249>>IF
TM2
      1153**DCL         8--PROC     1229>>ASSIGN

PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:75   
      343        1        /*T***********************************************************/
      344        2        /*T*                                                         */
      345        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      346        4        /*T*                                                         */
      347        5        /*T***********************************************************/
      348        6           /**/
      349        7           /**/
      350        8        FRZ$RRR: PROC (FCN,SERN,DCTX) ALTRET;
      351        9           /**/
      352       10           /**/
      353       11        %INCLUDE B$JIT_C;
      354      325        %B$JIT0;
      355      414        %A$JIT6X;
      356      417        %INCLUDE FR$RAT;
      357      470        %FR$RAT (NAME=RAT,STCLASS="BASED(RAT$)");
      358      510        %INCLUDE FR_DATA_R;
      359      542        %INCLUDE FR_SUBS;
      360      610           /**/
      361      611           /**/
      362      612    1   DCL FCN UBIN WORD;
      363      613    1   DCL SERN CHAR(6);
      364      614    1   DCL DCTX UBIN WORD;
      365      615    1   DCL RAT$ PTR;
      366      616    1   DCL SYSID UBIN WORD;
      367      617    1   DCL MODE REDEF SYSID UBIN WORD;
      368      618    1   DCL PASS BIT(1);
      369      619    1   DCL B$JIT$ PTR SYMREF;
      370      620    1   DCL FRZ$DSMT ENTRY(1);
      371      621    1   DCL FRZ$RRES ENTRY(2);
      372      622           /**/
      373      623        %INCLUDE FR_ERRORS_C;
      374      654        %INCLUDE UD_SEV_C;
      375      668           /**/
      376      669    1   DCL 1 NORES CONSTANT ALIGNED,
      377      670    1         2 FCG BIT(18) UNAL INIT('062232'O),
      378      671    1         2 ERR UBIN(15) UNAL INIT(%E$NOTUR),
      379      672    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:76   
      380      673    1   DCL 1 NRLOP CONSTANT ALIGNED,
      381      674    1         2 FCG BIT(18) UNAL INIT('062232'O),
      382      675    1         2 ERR UBIN(15) UNAL INIT(%E$NRLOPN),
      383      676    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      384      677           /**/
      385      678           /**/
      386      679    1      PASS = '1'B;
      387      680    1      SYSID=B$JIT.SYSID;
      388      681    1      RAT$=FR$HD$(FR_MT);
      389      682    1   TRYOD: ;
      390      683    2      DO WHILE (RAT$~=ADDR(NIL));
      391      684    2         IF RAT.FLG.RUP AND RAT.FLG.MBIT.MTD
      392      685    2           AND RAT.REEL.SER=SERN
      393      686    3           AND RAT.RES.SISID=SYSID THEN DO;
      394      687    3            DCTX=RAT.DCTX;
      395      688    4            IF RAT.FLG.OPN THEN DO;
      396      689    4               B$JIT.ERR=NRLOP;
      397      690           /*E*  ERROR:         FRZ-E$NRLOPN-E
      398      691           MESSAGE:         There is a DCB open to that tape or optical disk% %SN%.
      399      692                 MESSAGE1: You attempted to rewind, remove, or release a
      400      693                           tape or optical disk% (%SN)% that you still have a DCB
      401      694                           open to.
      402      695                 DESCRIPTION:   FRZ$RRR is called because of M$REW, etc. pmmes.
      403      696                                These operations are performed on serial numbers.
      404      697                                In this case, the serial number was found on a
      405      698                                drive that still shows a DCB open to it.                */
      406      699    4               ALTRETURN;
      407      700    4               END;
      408      701    3            GOTO GOTSER;
      409      702    3            END;
      410      703    2         RAT$=RAT.LNK$;
      411      704    2         END;
      412      705    2      IF PASS THEN DO;
      413      706    2         RAT$ = FR$HD$(FR_NPOOL);
      414      707    2         PASS = '0'B;
      415      708    2         GOTO TRYOD;
      416      709    2         END;
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:77   
      417      710    1      B$JIT.ERR=NORES;
      418      711           /*E*  ERROR:         FRZ-E$NOTUR-E
      419      712           MESSAGE:         That tape or optical disk% (%SN)% is not mounted.
      420      713                 MESSAGE1: You attempted to rewind, remove or release a
      421      714                           tape or optical disk% (%SN)% that you do not have
      422      715                           mounted. You must have M$OPENed to the tape at least
      423      716                           once to perform these operations.
      424      717                 DESCRIPTION:   FRZ$RRR is called because of M$REW, etc. pmmes
      425      718                                describing the tape involved by serial number.
      426      719                                This error occurs when the serial number is not
      427      720                                found mounted on as drive belonging to the user         */
      428      721    1      ALTRETURN;
      429      722    1   GOTSER:;
      430      723    2      DO CASE (FCN);
      431      724    2      CASE (FRR_REW#);
      432      725    2      CASE (FRR_REM#);
      433      726    2         IF RAT.RES.RFLG.OLT THEN GOTO RELOLT;
      434      727    2         CALL FRZ$DSMT (RAT);
      435      728    2      CASE (FRR_REL#);
      436      729    2   RELOLT: ;
      437      730    2         MODE=B$JIT.MODE;
      438      731    2         CALL FRZ$RRES (RAT,MODE);
      439      732    2      END;
      440      733    1      RETURN;
      441      734           /**/
      442      735    1   END;
      443      736           /**/
      444      737           /**/

PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:78   
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   FR_ERRORS_C.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR$RAT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FRZ$RRR.

   Procedure FRZ$RRR requires 83 words for executable code.
   Procedure FRZ$RRR requires 12 words of local(AUTO) storage.

    No errors detected in file FRZ$COMSUB.:E05TSI    .

PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:79   

 Object Unit name= FRZ$RRR                                    File name= FRZ$COMSUB.:E05TOU
 UTS= JUL 29 '97 17:26:10.00 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      2      2  FRZ$RRR
    1   Proc  even  none    83    123  FRZ$RRR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        3  FRZ$RRR

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FRZ$DSMT
         yes           Std       2 FRZ$RRES
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     FR$HD$                                B$JIT$                                B_VECTNIL
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:80   


      343        1        /*T***********************************************************/
      344        2        /*T*                                                         */
      345        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      346        4        /*T*                                                         */
      347        5        /*T***********************************************************/
      348        6           /**/
      349        7           /**/
      350        8        FRZ$RRR: PROC (FCN,SERN,DCTX) ALTRET;

      8  1 000000   000000 700200 xent  FRZ$RRR      TSX0  ! X66_AUTO_3
         1 000001   000014 000003                    ZERO    12,3

      351        9           /**/
      352       10           /**/
      353       11        %INCLUDE B$JIT_C;
      354      325        %B$JIT0;
      355      414        %A$JIT6X;
      356      417        %INCLUDE FR$RAT;
      357      470        %FR$RAT (NAME=RAT,STCLASS="BASED(RAT$)");
      358      510        %INCLUDE FR_DATA_R;
      359      542        %INCLUDE FR_SUBS;
      360      610           /**/
      361      611           /**/
      362      612    1   DCL FCN UBIN WORD;
      363      613    1   DCL SERN CHAR(6);
      364      614    1   DCL DCTX UBIN WORD;
      365      615    1   DCL RAT$ PTR;
      366      616    1   DCL SYSID UBIN WORD;
      367      617    1   DCL MODE REDEF SYSID UBIN WORD;
      368      618    1   DCL PASS BIT(1);
      369      619    1   DCL B$JIT$ PTR SYMREF;
      370      620    1   DCL FRZ$DSMT ENTRY(1);
      371      621    1   DCL FRZ$RRES ENTRY(2);
      372      622           /**/
      373      623        %INCLUDE FR_ERRORS_C;
      374      654        %INCLUDE UD_SEV_C;
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:81   
      375      668           /**/
      376      669    1   DCL 1 NORES CONSTANT ALIGNED,
      377      670    1         2 FCG BIT(18) UNAL INIT('062232'O),
      378      671    1         2 ERR UBIN(15) UNAL INIT(%E$NOTUR),
      379      672    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      380      673    1   DCL 1 NRLOP CONSTANT ALIGNED,
      381      674    1         2 FCG BIT(18) UNAL INIT('062232'O),
      382      675    1         2 ERR UBIN(15) UNAL INIT(%E$NRLOPN),
      383      676    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      384      677           /**/
      385      678           /**/
      386      679    1      PASS = '1'B;

    679  1 000002   400000 236003                    LDQ     -131072,DU
         1 000003   200010 756100                    STQ     PASS,,AUTO

      387      680    1      SYSID=B$JIT.SYSID;

    680  1 000004   000000 470400 xsym               LDP0    B$JIT$
         1 000005   000000 236100                    LDQ     0,,PR0
         1 000006   777777 376007                    ANQ     -1,DL
         1 000007   200007 756100                    STQ     SYSID,,AUTO

      388      681    1      RAT$=FR$HD$(FR_MT);

    681  1 000010   000001 236000 xsym               LDQ     FR$HD$+1
         1 000011   200006 756100                    STQ     RAT$,,AUTO

    681  1 000012                       TRYOD        null
      389      682    1   TRYOD: ;
      390      683    2      DO WHILE (RAT$~=ADDR(NIL));

    683  1 000012   000051 710000 1                  TRA     s:704

      391      684    2         IF RAT.FLG.RUP AND RAT.FLG.MBIT.MTD

    684  1 000013   200006 470500                    LDP0    RAT$,,AUTO
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:82   
         1 000014   000010 236100                    LDQ     8,,PR0
         1 000015   000004 316007                    CANQ    4,DL
         1 000016   000047 600000 1                  TZE     s:703
         1 000017   000400 316007                    CANQ    256,DL
         1 000020   000047 600000 1                  TZE     s:703
         1 000021   200004 471500                    LDP1    @SERN,,AUTO
         1 000022   040100 106500                    CMPC    fill='040'O
         1 000023   000004 400006                    ADSC9   4,,PR0                   cn=2,n=6
         1 000024   100000 000006                    ADSC9   0,,PR1                   cn=0,n=6
         1 000025   000047 601000 1                  TNZ     s:703
         1 000026   000001 236100                    LDQ     1,,PR0
         1 000027   000022 732000                    QRS     18
         1 000030   000047 604000 1                  TMI     s:703
         1 000031   200007 116100                    CMPQ    SYSID,,AUTO
         1 000032   000047 601000 1                  TNZ     s:703

      392      685    2           AND RAT.REEL.SER=SERN
      393      686    3           AND RAT.RES.SISID=SYSID THEN DO;

      394      687    3            DCTX=RAT.DCTX;

    687  1 000033   000003 236100                    LDQ     3,,PR0
         1 000034   777777 376007                    ANQ     -1,DL
         1 000035   200005 473500                    LDP3    @DCTX,,AUTO
         1 000036   300000 756100                    STQ     0,,PR3

      395      688    4            IF RAT.FLG.OPN THEN DO;

    688  1 000037   000010 236100                    LDQ     8,,PR0
         1 000040   000020 316007                    CANQ    16,DL
         1 000041   000046 600000 1                  TZE     s:701

      396      689    4               B$JIT.ERR=NRLOP;

    689  1 000042   000001 236000 0                  LDQ     NRLOP
         1 000043   000000 474400 xsym               LDP4    B$JIT$
         1 000044   400012 756100                    STQ     10,,PR4
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:83   

      397      690           /*E*  ERROR:         FRZ-E$NRLOPN-E
      398      691           MESSAGE:         There is a DCB open to that tape or optical disk% %SN%.
      399      692                 MESSAGE1: You attempted to rewind, remove, or release a
      400      693                           tape or optical disk% (%SN)% that you still have a DCB
      401      694                           open to.
      402      695                 DESCRIPTION:   FRZ$RRR is called because of M$REW, etc. pmmes.
      403      696                                These operations are performed on serial numbers.
      404      697                                In this case, the serial number was found on a
      405      698                                drive that still shows a DCB open to it.                */
      406      699    4               ALTRETURN;

    699  1 000045   000000 702200 xent               TSX2  ! X66_AALT

      407      700    4               END;
      408      701    3            GOTO GOTSER;

    701  1 000046   000066 710000 1                  TRA     GOTSER

      409      702    3            END;
      410      703    2         RAT$=RAT.LNK$;

    703  1 000047   000000 236100                    LDQ     0,,PR0
         1 000050   200006 756100                    STQ     RAT$,,AUTO

      411      704    2         END;

    704  1 000051   200006 236100                    LDQ     RAT$,,AUTO
         1 000052   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000053   000013 601000 1                  TNZ     s:684

      412      705    2      IF PASS THEN DO;

    705  1 000054   200010 234100                    SZN     PASS,,AUTO
         1 000055   000062 605000 1                  TPL     s:710

      413      706    2         RAT$ = FR$HD$(FR_NPOOL);
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:84   

    706  1 000056   000002 236000 xsym               LDQ     FR$HD$+2
         1 000057   200006 756100                    STQ     RAT$,,AUTO

      414      707    2         PASS = '0'B;

    707  1 000060   200010 450100                    STZ     PASS,,AUTO

      415      708    2         GOTO TRYOD;

    708  1 000061   000012 710000 1                  TRA     TRYOD

      416      709    2         END;
      417      710    1      B$JIT.ERR=NORES;

    710  1 000062   000000 236000 0                  LDQ     NORES
         1 000063   000000 470400 xsym               LDP0    B$JIT$
         1 000064   000012 756100                    STQ     10,,PR0

      418      711           /*E*  ERROR:         FRZ-E$NOTUR-E
      419      712           MESSAGE:         That tape or optical disk% (%SN)% is not mounted.
      420      713                 MESSAGE1: You attempted to rewind, remove or release a
      421      714                           tape or optical disk% (%SN)% that you do not have
      422      715                           mounted. You must have M$OPENed to the tape at least
      423      716                           once to perform these operations.
      424      717                 DESCRIPTION:   FRZ$RRR is called because of M$REW, etc. pmmes
      425      718                                describing the tape involved by serial number.
      426      719                                This error occurs when the serial number is not
      427      720                                found mounted on as drive belonging to the user         */
      428      721    1      ALTRETURN;

    721  1 000065   000000 702200 xent               TSX2  ! X66_AALT

    710  1 000066                       GOTSER       null
      429      722    1   GOTSER:;
      430      723    2      DO CASE (FCN);

PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:85   
    723  1 000066   200003 474500                    LDP4    @FCN,,AUTO
         1 000067   400000 235100                    LDA     0,,PR4
         1 000070   000003 115007                    CMPA    3,DL
         1 000071   000073 602005 1                  TNC     GOTSER+5,AL
         1 000072   000122 710000 1                  TRA     s:733
         1 000073   000122 710000 1                  TRA     s:733
         1 000074   000076 710000 1                  TRA     s:726
         1 000075   000106 710000 1                  TRA     RELOLT

      431      724    2      CASE (FRR_REW#);

      432      725    2      CASE (FRR_REM#);

      433      726    2         IF RAT.RES.RFLG.OLT THEN GOTO RELOLT;

    726  1 000076   000003 236100                    LDQ     3,,PR0
         1 000077   020000 316003                    CANQ    8192,DU
         1 000100   000106 601000 1                  TNZ     RELOLT

      434      727    2         CALL FRZ$DSMT (RAT);

    727  1 000101   200006 630500                    EPPR0   RAT$,,AUTO
         1 000102   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000103   000000 701000 xent               TSX1    FRZ$DSMT
         1 000104   000000 011000                    NOP     0
         1 000105   000122 710000 1                  TRA     s:733

      435      728    2      CASE (FRR_REL#);

    726  1 000106                       RELOLT       null
      436      729    2   RELOLT: ;
      437      730    2         MODE=B$JIT.MODE;

    730  1 000106   000000 475400 xsym               LDP5    B$JIT$
         1 000107   500000 236100                    LDQ     0,,PR5
         1 000110   000040 772000                    QRL     32
         1 000111   200007 756100                    STQ     SYSID,,AUTO
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:86   

      438      731    2         CALL FRZ$RRES (RAT,MODE);

    731  1 000112   200007 636500                    EPPR6   SYSID,,AUTO
         1 000113   200013 456500                    STP6    PASS+3,,AUTO
         1 000114   200006 236100                    LDQ     RAT$,,AUTO
         1 000115   200012 756100                    STQ     PASS+2,,AUTO
         1 000116   200012 630500                    EPPR0   PASS+2,,AUTO
         1 000117   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000120   000000 701000 xent               TSX1    FRZ$RRES
         1 000121   000000 011000                    NOP     0

      439      732    2      END;

      440      733    1      RETURN;

    733  1 000122   000000 702200 xent               TSX2  ! X66_ARET

NORES
 Sect OctLoc
   0     000   062232 012224                                                    2...

NRLOP
 Sect OctLoc
   0     001   062232 012214                                                    2...
      441      734           /**/
      442      735    1   END;
      443      736           /**/
      444      737           /**/

PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:87   
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   FR_ERRORS_C.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR$RAT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FRZ$RRR.
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:88   

 **** Variables and constants ****

  ****  Section 000 RoData FRZ$RRR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 NORES                      1-0-0/w STRC        r     1 NRLOP

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @DCTX                      3-0-0/w PTR         r     1 @FCN
     4-0-0/w PTR         r     1 @SERN                     *0-0-0/w UBIN        r     1 DCTX
    *0-0-0/w UBIN        r     1 FCN                        7-0-0/w UBIN        r     1 MODE
    10-0-0/b BIT         r     1 PASS                       6-0-0/w PTR         r     1 RAT$
    *0-0-0/c CHAR(6)     r     1 SERN                       7-0-0/w UBIN        r     1 SYSID

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 FR$HD$(0:3)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(2088)  r     1 B$JIT                      0-0-0/w STRC(324)   r     1 RAT


   Procedure FRZ$RRR requires 83 words for executable code.
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:89   
   Procedure FRZ$RRR requires 12 words of local(AUTO) storage.

    No errors detected in file FRZ$COMSUB.:E05TSI    .
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:90   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:91   
          MINI XREF LISTING

B$JIT.ERR
       331**DCL       689<<ASSIGN    710<<ASSIGN
B$JIT.ERR.MID
       332**DCL       332--REDEF
B$JIT.MODE
       326**DCL       730>>ASSIGN
B$JIT.SYSID
       331**DCL       680>>ASSIGN
B$JIT$
       619**DCL       326--IMP-PTR   680>>ASSIGN    689>>ASSIGN    710>>ASSIGN    730>>ASSIGN
DCTX
       614**DCL         8--PROC      687<<ASSIGN
FCN
       612**DCL         8--PROC      723>>DOCASE
FR$HD$
       519**DCL       681>>ASSIGN    706>>ASSIGN
FRZ$DSMT
       620**DCL-ENT   727--CALL
FRZ$RRES
       621**DCL-ENT   731--CALL
GOTSER
       710**LABEL     701--GOTO
MODE
       617**DCL       730<<ASSIGN    731<>CALL
NORES
       669**DCL       710>>ASSIGN
NRLOP
       673**DCL       689>>ASSIGN
PASS
       618**DCL       679<<ASSIGN    705>>IF        707<<ASSIGN
RAT
       472**DCL       727<>CALL      731<>CALL
PL6.E3A0      #004=FRZ$RRR File=FRZ$COMSUB.:E05TSI                               TUE 07/29/97 17:26 Page:92   
RAT.DCTX
       490**DCL       687>>ASSIGN
RAT.FLG.MBIT.MTD
       500**DCL       684>>IF
RAT.FLG.OPN
       504**DCL       688>>IF
RAT.FLG.RUP
       506**DCL       684>>IF
RAT.LNK$
       473**DCL       703>>ASSIGN
RAT.REEL.SER
       493**DCL       684>>IF
RAT.RES.RFLG.OLT
       481**DCL       726>>IF
RAT.RES.SISID
       475**DCL       684>>IF
RAT$
       615**DCL       472--IMP-PTR   681<<ASSIGN    683>>DOWHILE   684>>IF        684>>IF        684>>IF
       684>>IF        687>>ASSIGN    688>>IF        703<<ASSIGN    703>>ASSIGN    706<<ASSIGN    726>>IF
       727>>CALL      731>>CALL
RELOLT
       726**LABEL     726--GOTO
SERN
       613**DCL         8--PROC      684>>IF
SYSID
       616**DCL       617--REDEF     680<<ASSIGN    684>>IF
TRYOD
       681**LABEL     708--GOTO
