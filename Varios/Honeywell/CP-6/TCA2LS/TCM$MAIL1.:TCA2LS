VERSION A02

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:1    
        1        1        /*M*    TCM$MAIL1   SMTP Mail Receiver, part 1                      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        TCM$NETMAIL: PROC MAIN;
        9        9        %INCLUDE CP_6;
       10       90            %F$DCB;
       11      147            %B$TCB( STCLASS="BASED( B$TCB$)");
       12      150            %B$ALT;
       13      158        %INCLUDE CP_6_SUBS;
       14      698        %INCLUDE B_ERRORS_C;
       15     1825        %INCLUDE B$JIT;
       16     2115        %INCLUDE XU_MACRO_C;
       17     5221        %INCLUDE XU_SUBS_C;
       18     5313            %P_PCB( NAME=TCM_PCB, W=PARSEWORK, WSZ="SIZEW( PARSEWORK)",
       19     5314                    NBL=YES, C_LD='  ', C_TL='  ', CNTU=NO);
       20     5513            %PARSE$OUT( NAME=CMD, STCLASS="BASED( CMD$)");
       21     5558            %PARSE$OUT( NAME=OUT, STCLASS="BASED( OUT$)");
       22     5603            %PARSE$SYM( NAME=SYM, STCLASS="BASED( SYM$)");
       23     5641            %XUR_INIT( PCB=TCM_PCB, SYNTAX=NO, COMMANDS=NO, GOODCMD=NO);
       24     5740            %XUG_INIT( COMMANDS=NO, GOODCMD=YES);
       25     6153            %XUG_GETCMD( INDCB=M$SI, OUTDCB=M$DO, NODES=TCM_CONFIG_CMD,
       26     6154                         PROMPT=PROMPTSTRING);
       27     6492            %P_PCB( NAME=P$PCB, STCLASS="BASED( XUG_GETCMD.PCB$)");
       28     6691        %INCLUDE XUG_ENTRY;
       29     6722        %INCLUDE VM_MACRO_C;
       30     7990        %INCLUDE TCP_HEP_M;
       31     8045        %INCLUDE TCP_HEP_E;
       32     8122            %TCP$SOCKET( NAME=FS);
       33     8130            %TCP$SOCKET( NAME=LS);
       34     8138    1       DCL TCM_CMD_LCN UBIN(36) SYMREF;
       35     8139    1       DCL OLD_CMD_LCN SBIN STATIC INIT( -1);
       36     8140            %TCP$CB( NAME=CB, STCLASS=STATIC);
       37     8143            %TCP$ADMIN( STCLASS=BASED);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:2    
       38     8164        %INCLUDE TCM_COMMON_M;
       39     8195        %INCLUDE TCM_MAIL_E;
       40     8254        %INCLUDE TCM_SEND_E;
       41     8360        %INCLUDE XUD_UTS_M;
       42     8442            %XUD$UTS_ENTRIES;
       43     8474            %XUD_UTS_EQU;
       44     8485        %INCLUDE XSL_SOCKET_M;
       45     9246            %XSL$HOSTENT( STCLASS="BASED( TMP$)");
       46     9306            %XSL_SOCKINIT( FPTN=TCM_SOCKINIT, BUFSIZE=4096, STCLASS="CONSTANT SYMDEF");
       47     9429        %INCLUDE XSL_PERR_C;
       48     9484    1       DCL XSL_ERRNO SBIN SYMREF;
       49     9485
       50     9486    1       DCL TCM$ABORT ENTRY ASYNC;
       51     9487    1       DCL TCM$WRITE_AUDIT_LOG ENTRY(2);
       52     9488    1       DCL TCM$WRITE_AUDIT_ON ENTRY(2);
       53     9489    1       DCL TCM$WRITE_AUDIT_OFF ENTRY(2);
       54     9490
       55     9491    1       DCL XUR$GETCMD ENTRY(6) ALTRET;
       56     9492    1       DCL XUR$INIT ENTRY(3) ALTRET;
       57     9493
       58     9494    1       DCL TCM$LTCP_READ ENTRY(7) ALTRET;
       59     9495    1       DCL TCM$LTCP_WRITE ENTRY(2) ALTRET;
       60     9496    1       DCL TCP$OPEN ENTRY(6) ALTRET;
       61     9497    1       DCL TCP$READ_NW ENTRY(3) ALTRET;
       62     9498    1       DCL TCP$READ ENTRY(3) ALTRET;
       63     9499    1       DCL TCP$WAIT ENTRY(2);
       64     9500    1       DCL TCP$CLOSE ENTRY(1) ALTRET;
       65     9501    1       DCL TCP$RELEASE ENTRY(1) ALTRET;
       66     9502    1       DCL TCP$WRITE ENTRY(4) ALTRET;
       67     9503    1       DCL TCP$USER_TIMEOUT ENTRY(1);
       68     9504    1       DCL NET$IP2ADDR ENTRY(2) ALTRET;
       69     9505    1       DCL NET$NAME2ADDR ENTRY(2) ALTRET;
       70     9506    1       DCL NET$ADDR2IP ENTRY(2);
       71     9507    1       DCL XSL$GETHOSTBYNAME ENTRY(2) ALTRET;
       72     9508    1       DCL XSL$NTOHL ENTRY(2);
       73     9509    1       DCL XSL$SOCKINIT ENTRY(1) ALTRET;
       74     9510
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:3    
       75     9511    1       DCL B$JIT$ PTR SYMREF READONLY;
       76     9512    1       DCL B$TCB$ PTR SYMREF READONLY;
       77     9513
       78     9514    1       DCL TCM_SMTP_ROOT SBIN SYMREF;
       79     9515    1       DCL TCM_USER_ROOT SBIN SYMREF;
       80     9516    1       DCL TCM_TEXT_ROOT SBIN SYMREF;
       81     9517    1       DCL TCM_ADDR_ROOT SBIN SYMREF;
       82     9518    1       DCL TCM_TSTAMP_ROOT SBIN SYMREF;
       83     9519
       84     9520    1       DCL F$DATA DCB;
       85     9521    1       DCL F$ALIAS DCB;
       86     9522    1       DCL F$DRIBBLE DCB;
       87     9523    1       DCL F$NODES DCB;
       88     9524    1       DCL M$SI DCB;
       89     9525    1       DCL M$DO DCB;
       90     9526    1       DCL F$NOTIFY DCB;
       91     9527
       92     9528    1       DCL M$SI$ PTR;
       93     9529    1       DCL CMD$ PTR;
       94     9530    1       DCL OUT$ PTR;
       95     9531    1       DCL SYM$ REDEF OUT$ PTR;
       96     9532    1       DCL TMP$ PTR;
       97     9533    1       DCL TCM_DRIBBLE BIT(36) STATIC SYMDEF INIT( %NO#);
       98     9534    1       DCL TCM_DRIBBLE_ME BIT(36) STATIC SYMDEF INIT (%NO#);
       99     9535    1       DCL BLANK CONSTANT CHAR(1) INIT( ' ');
      100     9536    1       DCL TCM_PROGNAME CHAR(7) STATIC SYMDEF INIT( 'NETMAIL');
      101     9537    1       DCL TCM_STUCKEE CHAR(32) STATIC SYMDEF INIT( ' ');
      102     9538    1       DCL OFFCMD CONSTANT CHAR(4) INIT( 'OFF');
      103     9539    1       DCL PROMPT CONSTANT CHAR(1) INIT( '@');
      104     9540    1       DCL PROMPTSTRING CHAR(0) CONSTANT INIT( '{} ');
      105     9541    1       DCL TCM_CONFIG_CMD UBIN WORD SYMREF READONLY;
      106     9542    1       DCL TCM_TZTEXT CHAR(6) STATIC SYMDEF INIT( ' PST  ');
      107     9543    1       DCL TCM_UTOFFSET SBIN STATIC SYMDEF INIT( %( -8 * UTS_CSEC_HOUR#));
      108     9544    1       DCL B$UBIN UBIN BASED;
      109     9545    1       DCL LOCALHOSTNAME CHAR(0) CONSTANT INIT( %CONCAT( 'localhost', BINASC(0)));
      110     9546    1       DCL FEPNAMES(0:5) CHAR(12) STATIC INIT( '            '*6);
      111     9547    1       DCL B$PTR PTR BASED;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:4    
      112     9548        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:5    
      113     9549        /********** REPLY DEFINITIONS */
      114     9550        %MACRO REPLY( NUM=0, MSG="''", STC=STATIC, SIZ=0, LEN=0);
      115     9551        %LSET R$ = CHARTEXT( CONCAT( 'R', TEXTCHAR(NUM), '$'));
      116     9552        %LSET R = CHARTEXT( CONCAT( 'REPLY', TEXTCHAR(NUM)));
      117     9553        %LSET L = LENGTHC( TEXTCHAR(MSG)) - 2;
      118     9554        %IF TEXTCHAR(LEN) = '0';
      119     9555            %LSET XLEN = %L;
      120     9556        %ELSE;
      121     9557            %LSET XLEN = CHARTEXT( TEXTCHAR(LEN));
      122     9558        %ENDIF;
      123     9559        %LSET LISTEXP = %YES#;
      124     9560        %LSET LISTSUB = %YES#;
      125     9561        %LSET LISTMAC = %YES#;
      126     9562            DCL %R$ PTR CONSTANT INIT( ADDR( %R));
      127     9563            DCL 1 %R STC UNAL,
      128     9564                 2 COUNT UBIN(9) INIT( %XLEN) CALIGNED,
      129     9565                 2 TEXT CHAR( SIZ) INIT( MSG);
      130     9566        %MEND;
      131     9567            /* LEN is set when we want different length than PL6 would calculate */
      132     9568            %REPLY( NUM=220, STC=STATIC,
      133     9569                  MSG="'220           SMTP ready at HH:MM:SS MMM DD ''YY  Line ff-llll'");
              9581    1       DCL R220$ PTR CONSTANT INIT( ADDR( REPLY220));
              9582    1       DCL 1 REPLY220 STATIC UNAL,
              9583    1            2 COUNT UBIN(9) INIT( 62) CALIGNED,
              9584    1            2 TEXT CHAR( 0) INIT(
              9584                     '220           SMTP ready at HH:MM:SS MMM DD ''YY  Line ff-llll');
      134     9586            %REPLY( NUM=221,
      135     9587                  MSG="'221          Closing transmission channel'");
              9599    1       DCL R221$ PTR CONSTANT INIT( ADDR( REPLY221));
              9600    1       DCL 1 REPLY221 STATIC UNAL,
              9601    1            2 COUNT UBIN(9) INIT( 41) CALIGNED,
              9602    1            2 TEXT CHAR( 0) INIT( '221          Closing transmission channel');
      136     9604            %REPLY( NUM=250,
      137     9605                  MSG="'250 Okay'");
              9617    1       DCL R250$ PTR CONSTANT INIT( ADDR( REPLY250));
              9618    1       DCL 1 REPLY250 STATIC UNAL,
              9619    1            2 COUNT UBIN(9) INIT( 8) CALIGNED,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:6    
              9620    1            2 TEXT CHAR( 0) INIT( '250 Okay');
      138     9622            %REPLY( NUM=250OOPS,
      139     9623                  MSG="'250 Mailer glitch; queued for manual delivery'");
              9635    1       DCL R250OOPS$ PTR CONSTANT INIT( ADDR( REPLY250OOPS));
              9636    1       DCL 1 REPLY250OOPS STATIC UNAL,
              9637    1            2 COUNT UBIN(9) INIT( 45) CALIGNED,
              9638    1            2 TEXT CHAR( 0) INIT( '250 Mailer glitch; queued for manual delivery');
      140     9640            %REPLY( NUM=250A,
      141     9641                  MSG="'250          '");
              9653    1       DCL R250A$ PTR CONSTANT INIT( ADDR( REPLY250A));
              9654    1       DCL 1 REPLY250A STATIC UNAL,
              9655    1            2 COUNT UBIN(9) INIT( 13) CALIGNED,
              9656    1            2 TEXT CHAR( 0) INIT( '250          ');
      142     9658            %REPLY( NUM=250V, STC=STATIC, SIZ=255, LEN=3,
      143     9659                  MSG="'250 '");
              9671    1       DCL R250V$ PTR CONSTANT INIT( ADDR( REPLY250V));
              9672    1       DCL 1 REPLY250V STATIC UNAL,
              9673    1            2 COUNT UBIN(9) INIT( 3) CALIGNED,
              9674    1            2 TEXT CHAR( 255) INIT( '250 ');
      144     9676            %REPLY( NUM=354,
      145     9677                  MSG="'354 Start mail input'");
              9689    1       DCL R354$ PTR CONSTANT INIT( ADDR( REPLY354));
              9690    1       DCL 1 REPLY354 STATIC UNAL,
              9691    1            2 COUNT UBIN(9) INIT( 20) CALIGNED,
              9692    1            2 TEXT CHAR( 0) INIT( '354 Start mail input');
      146     9694            %REPLY( NUM=421,
      147     9695                  MSG="'421          Closing transmission channel'");
              9707    1       DCL R421$ PTR CONSTANT INIT( ADDR( REPLY421));
              9708    1       DCL 1 REPLY421 STATIC UNAL,
              9709    1            2 COUNT UBIN(9) INIT( 41) CALIGNED,
              9710    1            2 TEXT CHAR( 0) INIT( '421          Closing transmission channel');
      148     9712            %REPLY( NUM=421TO,
      149     9713                  MSG="'421 Timeout during message reception; please retransmit.'");
              9725    1       DCL R421TO$ PTR CONSTANT INIT( ADDR( REPLY421TO));
              9726    1       DCL 1 REPLY421TO STATIC UNAL,
              9727    1            2 COUNT UBIN(9) INIT( 56) CALIGNED,
              9728    1            2 TEXT CHAR( 0) INIT(
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:7    
              9728                     '421 Timeout during message reception; please retransmit.');
      150     9730            %REPLY( NUM=421ZAP,
      151     9731                  MSG="'421          Transmission channel timed out or lost data.'");
              9743    1       DCL R421ZAP$ PTR CONSTANT INIT( ADDR( REPLY421ZAP));
              9744    1       DCL 1 REPLY421ZAP STATIC UNAL,
              9745    1            2 COUNT UBIN(9) INIT( 57) CALIGNED,
              9746    1            2 TEXT CHAR( 0) INIT(
              9746                     '421          Transmission channel timed out or lost data.');
      152     9748            %REPLY( NUM=421DL,
      153     9749                  MSG="'421 Data lost in transmission; please retransmit.'");
              9761    1       DCL R421DL$ PTR CONSTANT INIT( ADDR( REPLY421DL));
              9762    1       DCL 1 REPLY421DL STATIC UNAL,
              9763    1            2 COUNT UBIN(9) INIT( 49) CALIGNED,
              9764    1            2 TEXT CHAR( 0) INIT( '421 Data lost in transmission; please retransmit.');
      154     9766            %REPLY( NUM=451,
      155     9767                  MSG="'451 Requested action aborted. Error in local processing'");
              9779    1       DCL R451$ PTR CONSTANT INIT( ADDR( REPLY451));
              9780    1       DCL 1 REPLY451 STATIC UNAL,
              9781    1            2 COUNT UBIN(9) INIT( 55) CALIGNED,
              9782    1            2 TEXT CHAR( 0) INIT(
              9782                     '451 Requested action aborted. Error in local processing');
      156     9784            %REPLY( NUM=500,
      157     9785                  MSG="'500 Command not recognized.'");
              9797    1       DCL R500$ PTR CONSTANT INIT( ADDR( REPLY500));
              9798    1       DCL 1 REPLY500 STATIC UNAL,
              9799    1            2 COUNT UBIN(9) INIT( 27) CALIGNED,
              9800    1            2 TEXT CHAR( 0) INIT( '500 Command not recognized.');
      158     9802            %REPLY( NUM=501,
      159     9803                  MSG="'501 Syntax error in parameters or arguments.'");
              9815    1       DCL R501$ PTR CONSTANT INIT( ADDR( REPLY501));
              9816    1       DCL 1 REPLY501 STATIC UNAL,
              9817    1            2 COUNT UBIN(9) INIT( 44) CALIGNED,
              9818    1            2 TEXT CHAR( 0) INIT( '501 Syntax error in parameters or arguments.');
      160     9820            %REPLY( NUM=502,
      161     9821                  MSG="'502 Command not implemented'");
              9833    1       DCL R502$ PTR CONSTANT INIT( ADDR( REPLY502));
              9834    1       DCL 1 REPLY502 STATIC UNAL,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:8    
              9835    1            2 COUNT UBIN(9) INIT( 27) CALIGNED,
              9836    1            2 TEXT CHAR( 0) INIT( '502 Command not implemented');
      162     9838            %REPLY( NUM=503,
      163     9839                  MSG="'503 Invalid command sequence'");
              9851    1       DCL R503$ PTR CONSTANT INIT( ADDR( REPLY503));
              9852    1       DCL 1 REPLY503 STATIC UNAL,
              9853    1            2 COUNT UBIN(9) INIT( 28) CALIGNED,
              9854    1            2 TEXT CHAR( 0) INIT( '503 Invalid command sequence');
      164     9856            %REPLY( NUM=550,
      165     9857                  MSG="'550 Mailbox unknown'");
              9869    1       DCL R550$ PTR CONSTANT INIT( ADDR( REPLY550));
              9870    1       DCL 1 REPLY550 STATIC UNAL,
              9871    1            2 COUNT UBIN(9) INIT( 19) CALIGNED,
              9872    1            2 TEXT CHAR( 0) INIT( '550 Mailbox unknown');
      166     9874            %REPLY( NUM=550NONODE,
      167     9875                  MSG="'550 Cannot access :NODES file to forward message'");
              9887    1       DCL R550NONODE$ PTR CONSTANT INIT( ADDR( REPLY550NONODE));
              9888    1       DCL 1 REPLY550NONODE STATIC UNAL,
              9889    1            2 COUNT UBIN(9) INIT( 48) CALIGNED,
              9890    1            2 TEXT CHAR( 0) INIT( '550 Cannot access :NODES file to forward message');
      168     9892            %REPLY( NUM=550NODOMAIN,
      169     9893                  MSG="'550 That domain is unknown to me.'");
              9905    1       DCL R550NODOMAIN$ PTR CONSTANT INIT( ADDR( REPLY550NODOMAIN));
              9906    1       DCL 1 REPLY550NODOMAIN STATIC UNAL,
              9907    1            2 COUNT UBIN(9) INIT( 33) CALIGNED,
              9908    1            2 TEXT CHAR( 0) INIT( '550 That domain is unknown to me.');
      170     9910            %REPLY( NUM=550NOSITE,
      171     9911                  MSG="'550 That CP-6 site is unknown to me.'");
              9923    1       DCL R550NOSITE$ PTR CONSTANT INIT( ADDR( REPLY550NOSITE));
              9924    1       DCL 1 REPLY550NOSITE STATIC UNAL,
              9925    1            2 COUNT UBIN(9) INIT( 36) CALIGNED,
              9926    1            2 TEXT CHAR( 0) INIT( '550 That CP-6 site is unknown to me.');
      172     9928            %REPLY( NUM=551,
      173     9929                  MSG="'551 User not local; cannot forward'");
              9941    1       DCL R551$ PTR CONSTANT INIT( ADDR( REPLY551));
              9942    1       DCL 1 REPLY551 STATIC UNAL,
              9943    1            2 COUNT UBIN(9) INIT( 34) CALIGNED,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:9    
              9944    1            2 TEXT CHAR( 0) INIT( '551 User not local; cannot forward');
      174     9946            %REPLY( NUM=552,
      175     9947                  MSG="'552 Buffer size exceeded'");
              9959    1       DCL R552$ PTR CONSTANT INIT( ADDR( REPLY552));
              9960    1       DCL 1 REPLY552 STATIC UNAL,
              9961    1            2 COUNT UBIN(9) INIT( 24) CALIGNED,
              9962    1            2 TEXT CHAR( 0) INIT( '552 Buffer size exceeded');
      176     9964            %REPLY( NUM=553,
      177     9965                  MSG="'553 Specified user name is ambiguous'");
              9977    1       DCL R553$ PTR CONSTANT INIT( ADDR( REPLY553));
              9978    1       DCL 1 REPLY553 STATIC UNAL,
              9979    1            2 COUNT UBIN(9) INIT( 36) CALIGNED,
              9980    1            2 TEXT CHAR( 0) INIT( '553 Specified user name is ambiguous');
      178     9982            %REPLY( NUM=998, STC=STATIC, LEN=22,
      179     9983                  MSG="%CONCAT('*** NETMAIL here ***',BINASC(18),BINASC(24))");
              9995    1       DCL R998$ PTR CONSTANT INIT( ADDR( REPLY998));
              9996    1       DCL 1 REPLY998 STATIC UNAL,
              9997    1            2 COUNT UBIN(9) INIT( 22) CALIGNED,
              9998    1            2 TEXT CHAR( 0) INIT( '*** NETMAIL here ***  ');
      180    10000            %REPLY( NUM=999,
      181    10001                  MSG="'$SET M$LL NO'");
             10013    1       DCL R999$ PTR CONSTANT INIT( ADDR( REPLY999));
             10014    1       DCL 1 REPLY999 STATIC UNAL,
             10015    1            2 COUNT UBIN(9) INIT( 12) CALIGNED,
             10016    1            2 TEXT CHAR( 0) INIT( '$SET M$LL NO');
      182    10018        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:10   
      183    10019        /********** STATE CONTROL AREAS */
      184    10020    1       DCL REPLY$ PTR STATIC INIT( ADDR( REPLY421));
      185    10021    1       DCL CMD_CODE UBIN STATIC INIT( 0);
      186    10022    1       DCL LAST_CMD UBIN;
      187    10023    1       DCL USER_COUNT UBIN STATIC INIT( 0);
      188    10024    1       DCL LOGGED_ON BIT(1) STATIC INIT( %FALSE);
      189    10025    1       DCL MSG_COUNT UBIN STATIC INIT( 0);
      190    10026    1       DCL TIMED_OUT BIT(1);
      191    10027    1       DCL DATA_LOST BIT(1);
      192    10028    1       DCL SUPPRESS_HEADERS BIT(1);
      193    10029    1       DCL SYNC_PHASE UBIN STATIC INIT( 0);
      194    10030    1       DCL NODES_FILE_OPEN BIT(1);
      195    10031    1       DCL X_29 BIT(1);
      196    10032    1       DCL ACKNOWLEDGE BIT(1);
      197    10033    1       DCL UTS UBIN STATIC;
      198    10034    1       DCL TCM_TCPFLAVOR BIT(1) SYMREF;
      199    10035    1       DCL TCM_SITENAME CHAR(8) STATIC SYMDEF INIT( 'LADC');
      200    10036
      201    10037        /********** BUFFER AREAS */
      202    10038        %EQU BUFSIZ = 255;
      203    10039        %MACRO BUFFER( NAME=BUFFER, STCLASS=AUTO);
      204    10040            DCL 1 NAME STCLASS,
      205    10041                 2 LEN UBIN(9) CALIGNED,
      206    10042                 2 TXT CHAR( %BUFSIZ) CALIGNED;
      207    10043        %MEND;
      208    10044            %BUFFER( NAME=HELO);        /* holds the SMTP HELO command text */
      209    10049            %BUFFER( NAME=MAIL);        /* holds the SMTP MAIL command text */
      210    10054            %BUFFER( NAME=RCPT);        /* holds the SMTP RCPT command text */
      211    10059            %BUFFER( NAME=FROM);        /* holds the From: header text */
      212    10064            %BUFFER( NAME=REPL);        /* holds the Reply-To: header text */
      213    10069            %BUFFER( NAME=SUBJ);        /* holds the Subject: header text */
      214    10074            %BUFFER( NAME=RMID);        /* holds the In-Reply-To: header text */
      215    10079            %BUFFER( NAME=MID);         /* holds the Message-Id: header text */
      216    10084            %BUFFER( NAME=FORUM);       /* holds the Forum-Transaction: header text */
      217    10089            %BUFFER( NAME=WHEN);        /* holds the Date: header text */
      218    10094            %BUFFER( NAME=LTEXT);       /* leading random text */
      219    10099            %BUFFER( NAME=TTEXT);       /* trailing random text */
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:11   
      220    10104            %BUFFER( NAME=FTEXT);       /* user-friendly From: text */
      221    10109            %BUFFER( NAME=RTEXT);       /* user-friendly Reply-To: text */
      222    10114            %BUFFER( NAME=ZTEXT);       /* scratch text buffer */
      223    10119        %SET USER_LIMIT = MAX_USERS - 1;
      224    10120            %BUFFER( NAME="USERS(0:%USER_LIMIT)");
      225    10125
      226    10126    1       DCL REWRITES SBIN;
      227    10127    1       DCL 1 REWRITE(0:%MAX_REWRITES) STATIC,
      228    10128    1            2 TYP SBIN,
      229    10129    1            2 * SBIN,
      230    10130    1            2 OLD,
      231    10131    1             3 LEN UBIN BYTE CALIGNED,
      232    10132    1             3 TXT CHAR(31) CALIGNED,
      233    10133    1            2 NEW,
      234    10134    1             3 LEN UBIN BYTE CALIGNED,
      235    10135    1             3 TXT CHAR(31) CALIGNED;
      236    10136    1       DCL LINESIZE UBIN;
      237    10137    1       DCL LINEBUF CHAR(%LINE_SIZE) STATIC;
      238    10138    1       DCL LINECHAR(0:%(LINE_SIZE-1)) REDEF LINEBUF BIT(9);
      239    10139    1       DCL PARSEWORK(0:799) UBIN WORD STATIC;
      240    10140    1       DCL MY_SITE_NAME CHAR(8) STATIC INIT( ' ');
      241    10141    1       DCL MY_SITE_NAME_L UBIN(36);
      242    10142    1       DCL MY_SITE_NAME_2 CHAR(20);
      243    10143    1       DCL OCMSG CHAR( %BUFSIZ) STATIC;
      244    10144    1       DCL CMDBUF CHAR( %BUFSIZ);
      245    10145
      246    10146    1       DCL 1 STATUS_LINE STATIC,
      247    10147    1            2 * CHAR(7) INIT( ' '),
      248    10148    1            2 MSGS CHAR(2) INIT( '  '),
      249    10149    1            2 STATUS CHAR(1) INIT( ' '),
      250    10150    1            2 LINES CHAR(4) INIT( ' '),
      251    10151    1            2 * CHAR(1) INIT( ' '),
      252    10152    1            2 CMD CHAR(4) INIT( ' '),
      253    10153    1            2 * CHAR(1) INIT( ' '),
      254    10154    1            2 RCPT_ADDR CHAR(16) INIT( ' '),
      255    10155    1            2 * CHAR(1) INIT( ' '),
      256    10156    1            2 FROM_ADDR CHAR(16) INIT( ' ');
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:12   
      257    10157    1       DCL STATUS REDEF STATUS_LINE CHAR(53);
      258    10158
      259    10159    1       DCL 1 NODES_KEY STATIC,
      260    10160    1            2 COUNT UBIN BYTE CALIGNED INIT( 8),
      261    10161    1            2 SITE CHAR(8);
      262    10162
      263    10163    1       DCL 1 DATEBUF STATIC,
      264    10164    1            2 MON CHAR(3) INIT( ' '),
      265    10165    1            2 * CHAR(1) INIT( ' '),
      266    10166    1            2 DAY CHAR(2) INIT( ' '),
      267    10167    1            2 * CHAR(2) INIT( ' '),
      268    10168    1            2 YEAR CHAR(2) INIT( ' ');
      269    10169    1       DCL DATESTRING REDEF DATEBUF CHAR(10);
      270    10170
      271    10171    1       DCL 1 TIMEBUF STATIC,
      272    10172    1            2 HOUR CHAR(2) INIT( ' '),
      273    10173    1            2 * CHAR(1) INIT( ' '),
      274    10174    1            2 MIN CHAR(2) INIT( ' '),
      275    10175    1            2 * CHAR(1) INIT( ' '),
      276    10176    1            2 SEC CHAR(2) INIT( ' ');
      277    10177    1       DCL TIMESTRING REDEF TIMEBUF CHAR(8);
      278    10178
      279    10179    1       DCL DAYBUF CHAR(3) STATIC INIT( '   ');
      280    10180
      281    10181    1       DCL DATEWORK CHAR(10);
      282    10182    1       DCL TIMEWORK CHAR(8);
      283    10183
      284    10184    1       DCL 1 ANSBUF STATIC,
      285    10185    1            2 DATE CHAR(6),
      286    10186    1            2 TIME CHAR(8);
      287    10187    1       DCL ANSSTAMP REDEF ANSBUF CHAR(14);
      288    10188    1       DCL 1 LCLBUF STATIC,
      289    10189    1            2 DATE CHAR(8),
      290    10190    1            2 * CHAR(1) INIT( ','),
      291    10191    1            2 TIME CHAR(11);
      292    10192    1       DCL LCLSTAMP REDEF LCLBUF CHAR(20);
      293    10193    1       DCL UTSVAL UBIN(36) STATIC;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:13   
      294    10194    1       DCL CMN2UTS(0:9) SBIN CONSTANT INIT(
      295    10195    1           0, 0, -5, -4, -6, -5, -7, -6, -8, -7);
      296    10196
      297    10197    1       DCL 1 DATA_KEY STATIC,
      298    10198    1            2 * UBIN(9) UNAL INIT( 3),
      299    10199    1            2 KEY UBIN(27) UNAL INIT( 0);
      300    10200
      301    10201    1       DCL TCM_XLATE_TO_UC(0:511) CHAR(1) UNAL CONSTANT SYMDEF INIT(
      302    10202    1            BINASC(0),BINASC(1),BINASC(2),BINASC(3),        /* NUL SOH STX ETX */
      303    10203    1            BINASC(4),BINASC(5),BINASC(6),BINASC(7),        /* EOT ENQ ACK BEL */
      304    10204    1            BINASC(8),BINASC(9),BINASC(10),BINASC(11),      /* BS HT LF VT */
      305    10205    1            BINASC(12),BINASC(13),BINASC(14),BINASC(15),    /* FF CR SO SI */
      306    10206    1            BINASC(16),BINASC(17),BINASC(18),BINASC(19),    /* DLE DC1 DC2 DC3 */
      307    10207    1            BINASC(20),BINASC(21),BINASC(22),BINASC(23),    /* DC4 NAK SYN ETB */
      308    10208    1            BINASC(24),BINASC(25),BINASC(26),BINASC(27),    /* CAN EM SUB ESC */
      309    10209    1            BINASC(28),BINASC(29),BINASC(30),BINASC(31),    /* FS GS RS US */
      310    10210    1            BINASC(32),BINASC(33),BINASC(34),BINASC(35),    /* SP ! " # */
      311    10211    1            BINASC(36),BINASC(37),BINASC(38),BINASC(39),    /* $ % & ' */
      312    10212    1            BINASC(40),BINASC(41),BINASC(42),BINASC(43),    /* ( ) * + */
      313    10213    1            BINASC(44),BINASC(45),BINASC(46),BINASC(47),    /* , - . / */
      314    10214    1            BINASC(48),BINASC(49),BINASC(50),BINASC(51),    /* 0 1 2 3 */
      315    10215    1            BINASC(52),BINASC(53),BINASC(54),BINASC(55),    /* 4 5 6 7 */
      316    10216    1            BINASC(56),BINASC(57),BINASC(58),BINASC(59),    /* 8 9 : ; */
      317    10217    1            BINASC(60),BINASC(61),BINASC(62),BINASC(63),    /* < = > ? */
      318    10218    1            BINASC(64),BINASC(65),BINASC(66),BINASC(67),    /* @ A B C */
      319    10219    1            BINASC(68),BINASC(69),BINASC(70),BINASC(71),    /* D E F G */
      320    10220    1            BINASC(72),BINASC(73),BINASC(74),BINASC(75),    /* H I J K */
      321    10221    1            BINASC(76),BINASC(77),BINASC(78),BINASC(79),    /* L M N O */
      322    10222    1            BINASC(80),BINASC(81),BINASC(82),BINASC(83),    /* P Q R S */
      323    10223    1            BINASC(84),BINASC(85),BINASC(86),BINASC(87),    /* T U V W */
      324    10224    1            BINASC(88),BINASC(89),BINASC(90),BINASC(91),    /* X Y Z [ */
      325    10225    1            BINASC(92),BINASC(93),BINASC(94),BINASC(95),    /* \ ] ^ _ */
      326    10226        /*
      327    10227            ***       THIS SECTION OF THE TABLE CONVERTS THE LOWER CASE
      328    10228            ***       ALPHABET TO UPPER CASE WHEN USED WITH XLATE FUNCTION.
      329    10229            ***       THE COMMENTARY REFLECTS THE NORMAL ASCII CHARACTER WHICH
      330    10230            ***       USUALLY HOLDS THE POSITION IN THE TABLE.
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:14   
      331    10231        */
      332    10232    1            BINASC(96),BINASC(65),BINASC(66),BINASC(67),    /* ' a b c */
      333    10233    1            BINASC(68),BINASC(69),BINASC(70),BINASC(71),    /* d e f g */
      334    10234    1            BINASC(72),BINASC(73),BINASC(74),BINASC(75),    /* h i j k */
      335    10235    1            BINASC(76),BINASC(77),BINASC(78),BINASC(79),    /* l m n o */
      336    10236    1            BINASC(80),BINASC(81),BINASC(82),BINASC(83),    /* p q r s */
      337    10237    1            BINASC(84),BINASC(85),BINASC(86),BINASC(87),    /* t u v w */
      338    10238    1            BINASC(88),BINASC(89),BINASC(90),BINASC(123),   /* x y z { */
      339    10239    1            BINASC(124),BINASC(125),BINASC(126),BINASC(127),/* | } ~ DEL */
      340    10240    1                        BINASC(32)*384);                    /* ALL ELSE BLANK */
      341    10241
      342    10242    1       DCL TCM_SKIP_BLANKS(0:127) CONSTANT SYMDEF UBIN(9) CALIGNED
      343    10243                /** blank=0  alphanumeric=1  special=2  control=3 **/
      344    10244    1           INIT(3*32,0,1*15,2*10,1*7,2*26,1*6,2*26,1*4,3);
      345    10245    1       DCL TCM_ILLEGAL_FROM(0:127) CONSTANT SYMDEF UBIN BYTE CALIGNED
      346    10246                /* only blank and alphanumeric are legal */
      347    10247    1           INIT(1*32,0,1*15,0*10,1*7,0*26,1*6,0*26,1*4,1);
      348    10248    1       DCL TCM_ILLEGAL_REPLYTO(0:127) CONSTANT SYMDEF UBIN BYTE CALIGNED
      349    10249                /* blank, alphanumeric, and !@.-%/ are legal */
      350    10250    1           INIT(1*32,0*2,1*3,0,1*7,0*3,0*10,1*6,0*27,1*6,0*26,1*4,1);
      351    10251
      352    10252    1       DCL HEX CHAR(16) CONSTANT INIT( '0123456789ABCDEF');
      353    10253    1       DCL HEX1 UBIN;
      354    10254    1       DCL HEX2 UBIN;
      355    10255        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:15   
      356    10256        /********** MONITOR SERVICE PARAMETER BLOCKS */
      357    10257            %FPT_CLOSE( FPTN=CLOSE_SI, STCLASS=CONSTANT, DCB=M$SI, DISP=SAVE);
      358    10299            %FPT_WRITE( FPTN=WRITE_DO, DCB=M$DO);
      359    10330            %FPT_READ( FPTN=READ_UC, BUF=LINEBUF, DCB=M$UC);
      360    10369            %FPT_WRITE( FPTN=WRITE_UC, BUF=LINEBUF, DCB=M$UC);
      361    10400            %FPT_TRMPRG( FPTN=PURGE_UC_INPUT, DCB=M$UC, PURGEINPUT=YES, STCLASS=CONSTANT);
      362    10429
      363    10430            %FPT_OPEN( FPTN=OPEN_ALIAS, DCB=F$ALIAS, FUN=IN, STCLASS=CONSTANT,
      364    10431                       NAME=ALIAS_NAME, ACCT=ALIAS_ACCT, ASN=FILE, SHARE=ALL);
      365    10540            %VLP_NAME( FPTN=ALIAS_NAME, NAME=':MAIL_CENTRAL', STCLASS=CONSTANT);
      366    10567            %VLP_ACCT( FPTN=ALIAS_ACCT, ACCT=':MAIL', STCLASS=CONSTANT);
      367    10580            %FPT_PRECORD( FPTN=POSITION_ALIAS, DCB=F$ALIAS, KEYS=YES, KEYR=YES, N=0);
      368    10601            %FPT_PFIL( FPTN=REWIND_ALIAS, DCB=F$ALIAS, BOF=YES, STCLASS=CONSTANT);
      369    10616            %FPT_CLOSE( FPTN=CLOSE_ALIAS, DCB=F$ALIAS, STCLASS=CONSTANT);
      370    10658
      371    10659            %FPT_OPEN( FPTN=OPEN_NODES, DCB=F$NODES, FUN=IN, STCLASS=CONSTANT,
      372    10660                       NAME=NODES_NAME, ACCT=NODES_ACCT, ASN=FILE, SHARE=IN);
      373    10769            %VLP_NAME( FPTN=NODES_NAME, NAME=':NODES', STCLASS=CONSTANT);
      374    10796            %VLP_ACCT( FPTN=NODES_ACCT, ACCT=':SYS', STCLASS=CONSTANT);
      375    10809            %FPT_READ( FPTN=READ_NODES, DCB=F$NODES, BUF=MY_SITE_NAME,
      376    10810                       KEY=NODES_KEY, KEYS=YES, KEYR=NO, STCLASS=CONSTANT);
      377    10849            %FPT_PRECORD( FPTN=POSITION_NODES, DCB=F$NODES, STCLASS=CONSTANT,
      378    10850                          KEY=NODES_KEY, KEYS=YES, KEYR=NO, N=0);
      379    10871            %FPT_CLOSE( FPTN=CLOSE_NODES, DCB=F$NODES, STCLASS=CONSTANT);
      380    10913
      381    10914            %FPT_OPEN( FPTN=OPEN_DRIBBLE_ME, DCB=F$DRIBBLE, ASN=DEVICE,
      382    10915                       RES='ME', STCLASS=CONSTANT);
      383    11024            %FPT_OPEN( FPTN=OPEN_DRIBBLE, STCLASS=CONSTANT, DCB=F$DRIBBLE,
      384    11025                       FUN=CREATE, EXIST=OLDFILE, ASN=FILE, CTG=YES,
      385    11026                       ORG=CONSEC, DISP=NAMED, NAME=DRIBBLE_NAME, ACCT=TCM_MESSACCT);
      386    11135            %FPT_CLOSE( FPTN=CLOSE_DRIBBLE, DCB=F$DRIBBLE, STCLASS=CONSTANT);
      387    11177            %FPT_WRITE( FPTN=WRITE_DRIBBLE, DCB=F$DRIBBLE);
      388    11208            %VLP_NAME( FPTN=DRIBBLE_NAME, NAME=':DRIBRCVD', STCLASS=CONSTANT);
      389    11235            %VLP_ACCT( FPTN=TCM_ACCOUNT, STCLASS="STATIC SYMDEF", ACCT=':SMTP');
      390    11248            %VLP_ACCT( FPTN=TCM_MESSACCT, STCLASS="STATIC SYMDEF", ACCT=':SMTP');
      391    11261
      392    11262            %FPT_OPEN( FPTN=OPEN_DATA, DCB=F$DATA, FUN=CREATE, EXIST=NEWFILE,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:16   
      393    11263                       ASN=FILE, CTG=YES, ORG=KEYED, NAME=DATA_NAME, ACCT=TCM_MESSACCT,
      394    11264                       IXTNSIZE=2, XTNSIZE=2);
      395    11373            %VLP_NAME( FPTN=DATA_NAME, NAME='$MSGxxxxxxxxxxxx');
      396    11400            %FPT_OPEN( FPTN=REOPEN_DATA, DCB=F$DATA, FUN=UPDATE, EXIST=OLDFILE,
      397    11401                       ASN=FILE, NAME=DATA_NAME, ACCT=TCM_MESSACCT);
      398    11510            %FPT_OPEN( FPTN=DELETE_DATA, DCB=F$DATA, FUN=UPDATE, DELETE=YES);
      399    11619            %FPT_READ( FPTN=REREAD_DATA, STCLASS=CONSTANT, BUF=LINEBUF,
      400    11620                       KEY=DATA_KEY, KEYS=YES, DCB=F$DATA);
      401    11659            %FPT_WRITE( FPTN=WRITE_DATA, BUF=LINEBUF, KEY=DATA_KEY, DCB=F$DATA);
      402    11690            %FPT_WRITE( FPTN=WRITE_BLANK_DATA, STCLASS=CONSTANT, BUF=NIL,
      403    11691                        KEY=DATA_KEY, DCB=F$DATA);
      404    11722            %FPT_CLOSE( FPTN=CLOSE_DATA, DCB=F$DATA, STCLASS=CONSTANT);
      405    11764
      406    11765            %FPT_OPEN( FPTN=OPEN_NOTIFY, DCB=F$NOTIFY, STCLASS=CONSTANT,
      407    11766                       ASN=FILE, FUN=CREATE, EXIST=NEWFILE, DISP=NAMED, CTG=YES,
      408    11767                       ORG=CONSEC, NAME=NOTIFY_NAME);
      409    11876            %VLP_NAME( FPTN=NOTIFY_NAME, NAME='*NOTE', STCLASS=CONSTANT);
      410    11903            %FPT_WRITE( FPTN=WRITE_NOTIFY, DCB=F$NOTIFY);
      411    11934            %FPT_CLOSE( FPTN=CLOSE_NOTIFY, DCB=F$NOTIFY, STCLASS=CONSTANT);
      412    11976
      413    11977            %FPT_LINK( FPTN=SEND_NOTIFY, CMD=NOTIFY_CMD, NAME=SEND, ACCT=COLON_SYS,
      414    11978                       STCLASS=CONSTANT);
      415    11996            %VLP_NAME( FPTN=NOTIFY_CMD, STCLASS=CONSTANT,
      416    11997                       NAME="'SEND *NOTE (GATEWAY,MAIL=SMTP Mailer)'");
      417    12024
      418    12025            %FPT_LINK( FPTN=SEND_MAIL, CMD=SEND_CMD, ACCT=COLON_SYS);
      419    12043            %VLP_NAME( FPTN=SEND_CMD, STCLASS=STATIC,
      420    12044                       NAME="'SEND $MSGxxxxxxxxxxxx (GATEWAY,MAIL=SMTP Mailer)'");
      421    12071            %VLP_NAME( FPTN=SEND, NAME='SEND', STCLASS=CONSTANT);
      422    12098            %VLP_ACCT( FPTN=COLON_SYS, ACCT=':SYS', STCLASS=CONSTANT);
      423    12111
      424    12112            %FPT_SETFMA( STCLASS=CONSTANT, ACCT=TCM_MESSACCT);
      425    12125
      426    12126            %FPT_TIME( FPTN=GET_TIMESTAMP, SOURCE=CLOCK, DEST=EXT,
      427    12127                       DATE=DATEBUF, TIME=TIMEBUF, DAY=DAYBUF, STCLASS=CONSTANT);
      428    12146            %FPT_TIME( FPTN=GET_UTS, SOURCE=CLOCK, DEST=UTS, TSTAMP=UTS, STCLASS=CONSTANT);
      429    12165            %FPT_TIME( FPTN=ANS2UTSVAL, STCLASS=CONSTANT,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:17   
      430    12166                    SOURCE=ANS, DATE="ANSBUF.DATE", TIME="ANSBUF.TIME",
      431    12167                    DEST=UTS, TSTAMP=UTSVAL);
      432    12186            %FPT_TIME( FPTN=UTSVAL2LCL, STCLASS=CONSTANT,
      433    12187                    SOURCE=UTS, TSTAMP=UTSVAL,
      434    12188                    DEST=LOCAL, DATE="LCLBUF.DATE", TIME="LCLBUF.TIME");
      435    12207
      436    12208            %FPT_SCREECH( FPTN=SCREECH1, SCODE=SUA1, STCLASS="CONSTANT SYMDEF");
      437    12222            %FPT_SCREECH( FPTN=SCREECH2, SCODE=SUA2, STCLASS="CONSTANT SYMDEF");
      438    12236            %VLP_SUA (FPTN=SUA1, SEV=5, LDCTS=YES, CWSPT=YES,
      439    12237                    FCG='TC', MID='M', CODE=1111, STCLASS=CONSTANT);
      440    12307            %VLP_SUA (FPTN=SUA2, SEV=5, LDCTS=YES, CWSPT=YES,
      441    12308                    FCG='TC', MID='M', CODE=2222, STCLASS=CONSTANT);
      442    12378
      443    12379            %FPT_PRIV( FPTN=JIT_PRIV, STCLASS="CONSTANT SYMDEF", PRIV=%PR_JIT#);
      444    12394
      445    12395            %FPT_INT( FPTN=SET_BREAK_CONTROL, UENTRY=TCM$ABORT, STCLASS=CONSTANT);
      446    12409            %FPT_WAIT( FPTN=WAIT_A_SECOND, UNITS=1, STCLASS=CONSTANT);
      447    12423            %FPT_WAIT( FPTN=WAIT_A_MIN, UNITS=60, STCLASS=CONSTANT);
      448    12437
      449    12438            %FPT_YC( FPTN=TCM_YC_OFF, CMD=OFFCMD, NOERR=YES, STCLASS="CONSTANT SYMDEF");
      450    12455
      451    12456            %FPT_KEYIN( FPTN=TCM_KEYIN, STCLASS="STATIC SYMDEF");
      452    12475
      453    12476            %FPT_PROMPT( FPTN=CLEAR_PROMPT, PROMPT=PROMPT, VFC=YES, STCLASS=CONSTANT);
      454    12504            %FPT_EOM( FPTN=SET_EOM_LF, EOMTABLE=UC_EOMTABLE, TIMEOUT=30, UTYPE=SEC);
      455    12534            %VLP_EOMTABLE( FPTN=UC_EOMTABLE, VALUES="0,36,0*14", STCLASS=CONSTANT);
             12534                /*CR&LF only*/
      456    12553            %FPT_TRMISC( FPTN=INHIBIT_OPERATOR_MESSAGES, STCLASS=CONSTANT,
      457    12554                         ANNOUNCE=NO, BROADCAST=NO, SEND=NO);
      458    12575            %FPT_TRMCTL( FPTN=SET_TRANS_EOM, TRMCTL=UC_TRMCTL, STCLASS=CONSTANT);
      459    12602            %VLP_TRMCTL( FPTN=UC_TRMCTL, ACTONTRN=YES);
      460    12642            %VM_KEYTYPES;
      461    12663            %VM_USERKEY;
      462    12679            %VM_LISTKEY;
      463    12695            %VM_LISTKEY( NAME=VM_SEARCHKEY);
      464    12711            %FPT_TRMCTL( TRMCTL=TRMCTL, STCLASS=CONSTANT);
      465    12738            %VLP_TRMCTL( FPTN=TRMCTL);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:18   
      466    12778
      467    12779            %FPT_ALIB( LIBNAME=DELTA_NAME, RETRN=NO, STCLASS=CONSTANT);
      468    12796            %VLP_NAME( FPTN=DELTA_NAME, NAME='DELTA', STCLASS=CONSTANT);
      469    12823
      470    12824            %FPT_ERRMSG( FPTN=FPT_ERRMSG, STCLASS=STATIC,
      471    12825                         SOURCE=PASS, RESULTS=VLR_ERRMSG, CODE=ERRCODE, BUF=OCMSG,
      472    12826                         FILENAME=VMERRMSG, FILEACCT=COLON_SYS);
      473    12853            %VLP_ERRCODE( FPTN=ERRCODE);
      474    12898            %VLP_NAME( FPTN=VMERRMSG, STCLASS=CONSTANT, NAME=':VMERRMSG');
      475    12925            %VLR_ERRMSG;
      476    12947            %FPT_ERRMSG( FPTN=FPT_XSERRMSG, STCLASS=STATIC,
      477    12948                         SOURCE=PASS, RESULTS=VLR_ERRMSG, CODE=ERRCODE, BUF=OCMSG,
      478    12949                         FILENAME=XSERRMSG, FILEACCT=COLON_SYS);
      479    12976            %VLP_NAME( FPTN=XSERRMSG, STCLASS=CONSTANT, NAME=':XSERRMSG');
      480    13003        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:19   
      481    13004            /******** INITIALIZATION */
      482    13005    1       CALL INDEX( UTS, '(DEBUG)', B$JIT.CCBUF)
      483    13006    2       WHENRETURN DO;
      484    13007    2           CALL M$ALIB( FPT_ALIB) ALTRET( DYING);
      485    13008    2           END;
      486    13009    2       WHENALTRETURN DO;
      487    13010    2           END;
      488    13011    1       CALL INDEX( UTS, '(TCP)', B$JIT.CCBUF)
      489    13012    2       WHENRETURN DO;
      490    13013    2           END;
      491    13014    2       WHENALTRETURN DO;
      492    13015    2           TCM_TCPFLAVOR = %NO#;
      493    13016    2           TCM_PROGNAME = 'MULMAIL';
      494    13017    2           CALL INSERT( REPLY998.TEXT, 4, 7, TCM_PROGNAME);
      495    13018    2           END;
      496    13019    1       CALL TCM$WRITE_AUDIT_ON;
      497    13020    1       IF NOT TCM_TCPFLAVOR THEN
      498    13021    2           IF B$JIT.TSLINE.LEV > 1 THEN DO;
      499    13022                    /* subdevice info is valid */
      500    13023    2               X_29 = %YES#;
      501    13024    2               XUG_INIT.ECHO# = %NEVER_ECHO#;
      502    13025    2               END;
      503    13026    1           ELSE
      504    13027    1               X_29 = %NO#;
      505    13028    2       IF B$JIT.ACCN = TCM_ACCOUNT.ACCT# THEN DO;
      506    13029    3           IF NOT TCM_TCPFLAVOR THEN DO;
      507    13030    3               CALL M$INT( SET_BREAK_CONTROL) ALTRET( DYING);
      508    13031    3               READ_UC.V.DVBYTE.TRANS# = %YES#;
      509    13032    3               END;
      510    13033    2           END;
      511    13034    1       M$SI$ = DCBADDR( DCBNUM( M$SI));
      512    13035    2       IF DCBADDR( DCBNUM( M$SI))->F$DCB.ASN# = %DEVICE# THEN DO;
      513    13036    2           CMDBUF = 'No config file specified on invocation.  I quit.';
      514    13037    2           CALL WRITEDO;
      515    13038    2           GOTO DYING;
      516    13039    2           END;
      517    13040    1       ELSE
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:20   
      518    13041    1           TCM_MESSACCT.ACCT# = M$SI$->F$DCB.ACCT#;
      519    13042    1       IF NOT TCM_TCPFLAVOR THEN
      520    13043    1           IF TCM_DRIBBLE THEN
      521    13044    1               CALL M$OPEN( OPEN_DRIBBLE) ALTRET( DYING);
      522    13045    1           ELSE
      523    13046    1               IF TCM_DRIBBLE_ME THEN
      524    13047    1                   CALL M$OPEN( OPEN_DRIBBLE_ME) ALTRET( DYING);
      525    13048    1       CALL M$SETFMA( FPT_SETFMA);
      526    13049    1       CALL INITIALIZE_CONFIGURATION ALTRET( DYING);
      527    13050    1       CALL M$SPRIV( JIT_PRIV)
      528    13051    2       WHENRETURN DO;
      529    13052    2           B$JIT.PRIV.ACTIVE.FMREAD = %YES#;  /* :NODES, ALIAS files */
      530    13053    2           B$JIT.PRIV.JOB.FMSEC = %YES#;  /* needed later for SEND */
      531    13054    2           B$JIT.MAXTMPDP = BITBIN( '377777777777'O) /* MAX INTEGER */;
      532    13055    2           END;
      533    13056    2       WHENALTRETURN DO;
      534    13057    2           END;
      535    13058    1       CALL CONCAT( STATUS, TCM_PROGNAME, ':Idle');
      536    13059    1       CALL STATUS_LINE_UPDATE;
      537    13060    1       CALL M$OPEN( OPEN_NODES)
      538    13061    2       WHENRETURN DO;
      539    13062    2           NODES_FILE_OPEN = %YES#;
      540    13063    2           NODES_KEY.SITE = '*IAM';
      541    13064    2           CALL M$READ( READ_NODES)
      542    13065    3           WHENALTRETURN DO;
      543    13066    3               END;
      544    13067    2           END;
      545    13068    2       WHENALTRETURN DO;
      546    13069    2           NODES_FILE_OPEN = %NO#;
      547    13070    2           END;
      548    13071    2       IF TCM_TCPFLAVOR THEN DO;
      549    13072    2           CALL INDEX( UTS, 'Line', REPLY220.TEXT) ALTRET( DYING);
      550    13073    2           REPLY220.COUNT = UTS - 1;
      551    13074    2           END;
      552    13075    1       ELSE
      553    13076    1           MY_SITE_NAME = TCM_SITENAME;
      554    13077    1       CALL INDEX( MY_SITE_NAME_L, ' ', MY_SITE_NAME);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:21   
      555    13078    1       CALL INSERT( REPLY220.TEXT, 4, 8, MY_SITE_NAME);
      556    13079    1       CALL INSERT( REPLY221.TEXT, 4, MY_SITE_NAME_L, MY_SITE_NAME);
      557    13080    1       CALL INSERT( REPLY250A.TEXT, 4, MY_SITE_NAME_L, MY_SITE_NAME);
      558    13081    1       CALL INSERT( REPLY421.TEXT, 4, MY_SITE_NAME_L, MY_SITE_NAME);
      559    13082    1       CALL INSERT( REPLY421ZAP.TEXT, 4, MY_SITE_NAME_L, MY_SITE_NAME);
      560    13083    1       CALL CONCAT( MY_SITE_NAME_2, ' by ',
      561    13084    1               SUBSTR( MY_SITE_NAME, 0, MY_SITE_NAME_L), ' with SMTP; ');
      562    13085    1       CALL XUR$INIT( XUR_INIT);
      563    13086    1       CALL XSL$SOCKINIT( TCM_SOCKINIT);
      564    13087    2       IF TCM_TCPFLAVOR THEN DO;
      565    13088    2   AGAIN:
      566    13089                /* OPEN SOCKET, WAIT FOR CONNECTION */
      567    13090    2           LS = %NO#;
      568    13091    2           FS = %NO#;
      569    13092    2           LS.PORT = %TCP$WKS$SMTP;
      570    13093    2           IF FEPNAMES(0) = ' ' THEN
      571    13094    2               CALL XSL$GETHOSTBYNAME( TMP$, LOCALHOSTNAME);
      572    13095    2           ELSE
      573    13096    2               CALL XSL$GETHOSTBYNAME( TMP$, FEPNAMES(0));
      574    13097    3           IF TMP$ = ADDR( NIL) THEN DO;
      575    13098    3               IF FEPNAMES(0) = ' ' THEN
      576    13099    3                   CALL CONCAT( STATUS, TCM_PROGNAME,
      577    13100    3                           ': etc:hosts has no entry for "localhost"');
      578    13101    3               ELSE
      579    13102    3                   CALL CONCAT( STATUS, TCM_PROGNAME,
      580    13103    3                           ': etc:hosts has no entry for "', FEPNAMES(0), '"');
      581    13104    3               CALL STATUS_LINE_UPDATE;
      582    13105    3               CALL M$WAIT( WAIT_A_MIN);
      583    13106    3               GOTO AGAIN;
      584    13107    3               END;
      585    13108    2           CALL XSL$NTOHL( HEX1, XSL$HOSTENT.H_ADDR_LIST$->B$PTR->B$UBIN);
      586    13109    2           LS.ADDRESS = HEX1;
      587    13110    2           CALL TCP$OPEN( TCM_CMD_LCN, LS, FS, %TCP_SERVER)
      588    13111    3           WHENALTRETURN DO;
      589    13112    3               CALL CONCAT( STATUS, TCM_PROGNAME, ':Unable to open to socket');
      590    13113    3               CALL STATUS_LINE_UPDATE;
      591    13114    3               CALL TCP$RELEASE( TCM_CMD_LCN);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:22   
      592    13115    3               CALL M$WAIT( WAIT_A_MIN);
      593    13116    3               GOTO AGAIN;
      594    13117    3               END;
      595    13118
      596    13119    2           CALL TCP$USER_TIMEOUT(24*60*60);  /* A DAY */
      597    13120    2           CALL STATUS_LINE_IDLE;
      598    13121    2           OLD_CMD_LCN = TCM_CMD_LCN;
      599    13122    2   REREAD:
      600    13123    2           TCM_CMD_LCN = OLD_CMD_LCN;
      601    13124    2           MSG_COUNT = 0;
      602    13125    2           CALL TCP$READ( TCM_CMD_LCN, VECTOR( LINEBUF), CB)
      603    13126    3           WHENALTRETURN DO;
      604    13127                    /* PROBABLY TCP GHOST DIED */
      605    13128    3               CALL CONCAT( STATUS, TCM_PROGNAME, ':Error on read');
      606    13129    3               CALL STATUS_LINE_UPDATE;
      607    13130    3               CALL TCP$RELEASE( TCM_CMD_LCN);
      608    13131    3               CALL M$WAIT( WAIT_A_MIN);
      609    13132    3               IF TCM_CMD_LCN = OLD_CMD_LCN THEN
      610    13133    3                   GOTO AGAIN;
      611    13134    3               GOTO REREAD;
      612    13135    3               END;
      613    13136
      614    13137    3           IF( ~CB.ADMIN) THEN DO;
      615    13138    3               CALL CONCAT( STATUS, TCM_PROGNAME, ':Unexpected response to connect');
      616    13139    3               CALL STATUS_LINE_UPDATE;
      617    13140    3               CALL TCP$RELEASE( TCM_CMD_LCN);
      618    13141    3               GOTO REREAD;
      619    13142    3               END;
      620    13143
      621    13144    2           TCM_CMD_LCN = ADDR( LINEBUF)->TCP$ADMIN.NEWLCN;
      622    13145
      623    13146    2           CALL STATUS_LINE_IDLE;
      624    13147    2           IF TCM_DRIBBLE THEN
      625    13148    2               CALL M$OPEN( OPEN_DRIBBLE) ALTRET( DYING);
      626    13149    2           ELSE
      627    13150    2               IF TCM_DRIBBLE_ME THEN
      628    13151    2                   CALL M$OPEN( OPEN_DRIBBLE_ME) ALTRET( DYING);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:23   
      629    13152    2           CALL M$OPEN( OPEN_NODES)
      630    13153    3           WHENRETURN DO;
      631    13154    3               NODES_FILE_OPEN = %YES#;
      632    13155    3               NODES_KEY.SITE = '*IAM';
      633    13156    3               CALL M$READ( READ_NODES)
      634    13157    4               WHENALTRETURN DO;
      635    13158    4                   END;
      636    13159    3               END;
      637    13160    3           WHENALTRETURN DO;
      638    13161    3               NODES_FILE_OPEN = %NO#;
      639    13162    3               END;
      640    13163    2           END;
      641    13164
      642    13165    1       CALL M$TIME( GET_TIMESTAMP);
      643    13166    1       SUBSTR( REPLY220.TEXT, 28, 8) = TIMESTRING;
      644    13167    1       SUBSTR( REPLY220.TEXT, 37, 10) = DATESTRING;
      645    13168    2       IF NOT TCM_TCPFLAVOR THEN DO;
      646    13169                /********* MULTICS EXPECTS TWO "PROMPTS" *********/
      647    13170    2           CALL INDEX( UTS, 'ff', REPLY220.TEXT) ALTRET( DYING);
      648    13171    2           CALL BINCHAR( SUBSTR( REPLY220.TEXT, UTS, 2), B$JIT.TSLINE.FEX);
      649    13172    2           HEX1 = B$JIT.TSLINE.PORT;
      650    13173    3           DO HEX2 = 1 TO 4;
      651    13174    3               SUBSTR( REPLY220.TEXT, UTS + 7 - HEX2, 1) =
      652    13175    3                       SUBSTR( HEX, MOD( HEX1, 16), 1);
      653    13176    3               HEX1 = HEX1 / 16;
      654    13177    3               END;
      655    13178    2           CALL M$WAIT( WAIT_A_SECOND);
      656    13179    2           CALL M$TRMPRG( PURGE_UC_INPUT)
      657    13180    3           WHENALTRETURN DO;
      658    13181    3               END;
      659    13182    2           REPLY$ = R998$;
      660    13183    2           CALL WRITE_REPLY;
      661    13184    2           CALL M$WAIT( WAIT_A_SECOND);
      662    13185    2           REPLY$ = R999$;
      663    13186    2           CALL WRITE_REPLY;
      664    13187    2           CALL M$WAIT( WAIT_A_SECOND);
      665    13188    2           END;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:24   
      666    13189    1       REPLY$ = R421$;
      667    13190    1       CALL M$OPEN( OPEN_ALIAS) ALTRET( DYING);
      668    13191    2       IF NOT TCM_TCPFLAVOR THEN DO;
      669    13192    2           CALL M$PROMPT( CLEAR_PROMPT) ALTRET( DYING);
      670    13193    2           CALL M$TRMISC( INHIBIT_OPERATOR_MESSAGES);
      671    13194    2           END;
      672    13195    1       CALL TCM$WRITE_AUDIT_LOG;
      673    13196    1       REPLY$ = R220$;
      674    13197    1       CALL WRITE_REPLY;
      675    13198    1       SYNC_PHASE = 0;
      676    13199    1       B$JIT.PRDPRM = BITBIN( '377777777777'O) /* MAX INTEGER */;
      677    13200            /********** MAINLINE LOGIC */
      678    13201    2       DO WHILE( REPLY$ ~= R221$ AND REPLY$ ~= R421$ AND REPLY$ ~= R421ZAP$);
      679    13202    2           TIMED_OUT = %NO#;
      680    13203    2           DATA_LOST = %NO#;
      681    13204    2           LAST_CMD = CMD_CODE;
      682    13205    3           IF NOT TCM_TCPFLAVOR THEN DO;
      683    13206    4               IF LOGGED_ON THEN DO;
      684    13207    4                   SET_EOM_LF.V.TIMEOUT# = 5;
      685    13208    4                   SET_EOM_LF.V.UTYPE# = %MIN#;
      686    13209    4                   END;
      687    13210    4               ELSE DO;
      688    13211    4                   SET_EOM_LF.V.TIMEOUT# = 30;
      689    13212    4                   SET_EOM_LF.V.UTYPE# = %SEC#;
      690    13213    4                   END;
      691    13214    3               CALL M$EOM( SET_EOM_LF) ALTRET( DYING);
      692    13215    3               IF B$JIT.ACCN = TCM_ACCOUNT.ACCT# AND NOT X_29 THEN
      693    13216    3                   UC_TRMCTL.FULLDUXPAPERTAPE# = %YES#;
      694    13217    3               CALL M$STRMCTL( SET_TRANS_EOM)
      695    13218    4               WHENALTRETURN DO;
      696    13219    4                   END;
      697    13220    3               END;
      698    13221    2           CALL READ_COMMAND ALTRET( CMDERR);
      699    13222    2           REPLY$ = R250$;
      700    13223    3           DO CASE( CMD_CODE);
      701    13224    3               CASE( %SMTP_HELO);
      702    13225    3                   CALL SAVE_HOST_NAME ALTRET( CMDERR);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:25   
      703    13226    3                   LOGGED_ON = %TRUE;
      704    13227    3                   CALL TCM$WRITE_AUDIT_LOG( MSG_COUNT, HELO);
      705    13228    3                   STATUS_LINE.CMD = 'HELO';
      706    13229    3                   STATUS_LINE.FROM_ADDR = SUBSTR( HELO.TXT, 0, HELO.LEN);
      707    13230    3                   CALL STATUS_LINE_UPDATE;
      708    13231    3               CASE( %SMTP_MAIL, %SMTP_SAML, %SMTP_SOML, %SMTP_SEND);
      709    13232    4                   IF LOGGED_ON THEN DO;
      710    13233    4                       CMD_CODE = %SMTP_MAIL;
      711    13234    4                       USER_COUNT = 0;
      712    13235    4                       ACKNOWLEDGE = %NO#;
      713    13236    4                       SUPPRESS_HEADERS = %YES#;
      714    13237    4                       CALL SAVE_REVERSE_PATH ALTRET( CMDERR);
      715    13238    4                       STATUS_LINE.CMD = 'MAIL';
      716    13239    4                       CALL BINCHAR( STATUS_LINE.MSGS, MSG_COUNT);
      717    13240    4                       STATUS_LINE.STATUS = ' ';
      718    13241    4                       STATUS_LINE.LINES = ' ';
      719    13242    4                       STATUS_LINE.RCPT_ADDR = ' ';
      720    13243    4                       STATUS_LINE.FROM_ADDR = SUBSTR( MAIL.TXT, 0, MAIL.LEN);
      721    13244    4                       CALL STATUS_LINE_UPDATE;
      722    13245    4                       END;
      723    13246    4                   ELSE DO;
      724    13247    4                       CMD_CODE = LAST_CMD;
      725    13248    4                       REPLY$ = R503$;
      726    13249    4                       END;
      727    13250    3               CASE( %SMTP_RCPT);
      728    13251    4                   IF LAST_CMD = %SMTP_MAIL OR LAST_CMD = %SMTP_RCPT THEN DO;
      729    13252    4                       CALL SAVE_USER_NAME ALTRET( CMDERR);
      730    13253    4                       STATUS_LINE.RCPT_ADDR =
      731    13254    4                               SUBSTR( USERS.TXT( USER_COUNT), 0, USERS.LEN( USER_COUNT
             13254                                        ));
      732    13255    4                       CALL STATUS_LINE_UPDATE;
      733    13256    4                       USER_COUNT = USER_COUNT + 1;
      734    13257    4                       END;
      735    13258    4                   ELSE DO;
      736    13259    4                       REPLY$ = R503$;
      737    13260    4                       CMD_CODE = LAST_CMD;
      738    13261    4                       END;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:26   
      739    13262    3               CASE( %SMTP_DATA);
      740    13263    4                   IF LAST_CMD = %SMTP_RCPT THEN DO;
      741    13264    4                       STATUS_LINE.STATUS = '/';
      742    13265    4                       STATUS_LINE.LINES = '0000';
      743    13266    4                       CALL STATUS_LINE_UPDATE;
      744    13267    4                       CALL BUILD_MAIL_HEADER ALTRET( CMDERR);
      745    13268    4                       IF NOT TCM_TCPFLAVOR THEN
      746    13269    4                           CALL M$WAIT( WAIT_A_SECOND);
      747    13270    4                       REPLY$ = R354$;
      748    13271    4                       CALL WRITE_REPLY;
      749    13272    4                       CALL GET_MESSAGE_DATA ALTRET( CMDERR);
      750    13273    4                       CALL SEND_MAIL_MESSAGE ALTRET( CMDERR);
      751    13274    4                       STATUS_LINE.CMD = 'sent';
      752    13275    4                       CALL STATUS_LINE_UPDATE;
      753    13276    4                       END;
      754    13277    3                   ELSE
      755    13278    3                       REPLY$ = R503$;
      756    13279    3               CASE( %SMTP_RSET);
      757    13280    3                   STATUS_LINE.CMD = 'RSET';
      758    13281    3                   STATUS_LINE.STATUS = ' ';
      759    13282    3                   STATUS_LINE.LINES = ' ';
      760    13283    3                   STATUS_LINE.RCPT_ADDR = ' ';
      761    13284    3                   STATUS_LINE.FROM_ADDR = ' ';
      762    13285    3                   CALL STATUS_LINE_UPDATE;
      763    13286    3                   USER_COUNT = 0;
      764    13287    3               CASE( %SMTP_VRFY);
      765    13288    3                   REPLY$ = R550$;
      766    13289    3                   CALL VERIFY_ADDRESS;
      767    13290    3               CASE( %SMTP_EXPN, %SMTP_HELP, %SMTP_TURN);
      768    13291    3                   REPLY$ = R502$;
      769    13292    3               CASE( %SMTP_NOOP);
      770    13293    3                   ;
      771    13294    3               CASE( %SMTP_QUIT);
      772    13295    3                   CALL CONCAT( OCMSG, SUBSTR( HELO.TXT, 0, HELO.LEN), ' off');
      773    13296    3                   CALL TELL_OPERATOR;
      774    13297    3                   REPLY$ = R221$;
      775    13298    3               CASE( %SMTP_SPIL);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:27   
      776    13299    3                   REPLY$ = R502$;  /* just in case.. */
      777    13300    3                   STATUS_LINE.CMD = 'SPIL';
      778    13301    3                   STATUS_LINE.STATUS = ' ';
      779    13302    3                   STATUS_LINE.LINES = ' ';
      780    13303    3                   STATUS_LINE.RCPT_ADDR = ' ';
      781    13304    3                   STATUS_LINE.FROM_ADDR = ' ';
      782    13305    3                   CALL STATUS_LINE_UPDATE;
      783    13306    3                   CALL SPILL_ALIASES;
      784    13307    3                   CMD_CODE = LAST_CMD;
      785    13308    3               CASE( ELSE);
      786    13309    3                   REPLY$ = R500$;
      787    13310    3                   CMD_CODE = LAST_CMD;
      788    13311    3               END/* case cmd_code */;
      789    13312    2   CMDERR:
      790    13313    3           IF NOT LOGGED_ON THEN DO;
      791    13314    4               IF TIMED_OUT AND SYNC_PHASE < 4 THEN DO;
      792    13315    5                   IF MOD( SYNC_PHASE, 2) = 1 THEN DO;
      793    13316    5                       REPLY$ = R998$;
      794    13317    5                       CALL WRITE_REPLY;
      795    13318    5                       IF NOT TCM_TCPFLAVOR THEN
      796    13319    5                           CALL M$WAIT( WAIT_A_SECOND);
      797    13320    5                       REPLY$ = R999$;
      798    13321    5                       CALL WRITE_REPLY;
      799    13322    5                       IF NOT TCM_TCPFLAVOR THEN
      800    13323    5                           CALL M$WAIT( WAIT_A_SECOND);
      801    13324    5                       END;
      802    13325    4                   REPLY$ = R220$;
      803    13326    4                   SYNC_PHASE = SYNC_PHASE + 1;
      804    13327    4                   END;
      805    13328    3               ELSE
      806    13329    3                   IF NOT TIMED_OUT AND REPLY$ ~= R221$ THEN
      807    13330    3                       REPLY$ = ADDR( NIL);
      808    13331    3               END;
      809    13332    3           IF NOT TCM_TCPFLAVOR THEN DO;
      810    13333    3               IF REPLY$ ~= R221$ AND REPLY$ ~= R421$ AND REPLY$ ~= R421ZAP$ AND
      811    13334    3                       NOT X_29 THEN
      812    13335    3                   CALL M$WAIT( WAIT_A_SECOND);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:28   
      813    13336    3               CALL M$TRMPRG( PURGE_UC_INPUT)
      814    13337    4               WHENALTRETURN DO;
      815    13338    4                   END;
      816    13339    3               END;
      817    13340    2           IF REPLY$ ~= ADDR( NIL) THEN
      818    13341    2               CALL WRITE_REPLY;
      819    13342    2           END /* while o.k. */;
      820    13343
      821    13344    2       IF TCM_TCPFLAVOR THEN DO;
      822    13345    2           CALL STATUS_LINE_IDLE;
      823    13346    2           CALL TCP$CLOSE( TCM_CMD_LCN);
      824    13347    2           CALL TCP$RELEASE( TCM_CMD_LCN);
      825    13348                /* KLUDGE, AT END OF ONE SESSION, START AGAIN */
      826    13349    2           END;
      827    13350
      828    13351            /********** FINAL CLEANUP */
      829    13352    1       CALL TCM$WRITE_AUDIT_LOG( MSG_COUNT, HELO);
      830    13353    1       CALL M$CLOSE( CLOSE_ALIAS);
      831    13354    1       CALL M$CLOSE( CLOSE_DRIBBLE);
      832    13355    1       CALL M$CLOSE( CLOSE_NODES);
      833    13356    1       IF TCM_TCPFLAVOR THEN
      834    13357    1           GOTO REREAD;
      835    13358    1       IF B$JIT.ACCN = TCM_ACCOUNT.ACCT# THEN
      836    13359    1           CALL M$YC( TCM_YC_OFF);
      837    13360    1       RETURN;  /* to IBEX */
      838    13361    1   DYING:
      839    13362    1       CALL M$SPRIV( JIT_PRIV);
      840    13363    1       B$JIT.PRIV.ACTIVE.EXMM = %YES#;  /* so we can SNAP */
      841    13364    1       CALL M$SCREECH( SCREECH1);  /* ..a SNAP, really */
      842    13365    1       CALL M$EXIT;
      843    13366            /* THAT'S ALL */
      844    13367        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:29   
      845    13368    1   INITIALIZE_CONFIGURATION: PROC ALTRET;
      846    13369
      847    13370    2       DCL ERROR_FLAG BIT(1);
      848    13371    2       DCL HAVE_A_CMD BIT(1);
      849    13372    2       DCL I SBIN;
      850    13373    2       DCL J SBIN;
      851    13374    2       DCL OPT$ PTR;
      852    13375    2       DCL SUB$ PTR;
      853    13376    2       DCL CHARS CHAR(512) BASED ALIGNED;
      854    13377
      855    13378    2       REWRITES = 0;
      856    13379    2       ERROR_FLAG = %NO#;
      857    13380    2       CALL XUG$INIT( XUG_GETCMD, XUG_INIT);
      858    13381    2   SCAN:
      859    13382    3       DO FOREVER;
      860    13383    3           HAVE_A_CMD = %NO#;
      861    13384    4           DO UNTIL( HAVE_A_CMD);
      862    13385    4               CALL XUG$GETCMD( XUG_GETCMD)
      863    13386    5               WHENRETURN DO;
      864    13387    5                   HAVE_A_CMD = %YES#;
      865    13388    5                   END;
      866    13389    5               WHENALTRETURN DO;
      867    13390    5                   IF XUG_GETCMD.ERR#.MON# AND
      868    13391    5                           XUG_GETCMD.ERR#.CODE# = %E$EOF THEN
      869    13392    5                       EXIT SCAN;
      870    13393    5                   ERROR_FLAG = %YES#;
      871    13394    5                   XUG_GETCMD.ERR_CODE = XUG_GETCMD.ERR#;
      872    13395    5                   CALL XUG$ECHOIF( XUG_GETCMD);
      873    13396    5                   CALL XUG$ERRMSG( XUG_GETCMD);
      874    13397    5                   IF XUG_GETCMD.ERR#.MON# THEN
      875    13398    5                       EXIT SCAN;
      876    13399    5                   END;
      877    13400    4               END;
      878    13401    3           OUT$ = XUG_GETCMD.OUT$;
      879    13402    3   CMD:
      880    13403    4           DO CASE( OUT.CODE);
      881    13404    4               CASE( ELSE);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:30   
      882    13405                        /* do nothing; command doesn't apply to NETMAIL */
      883    13406    4               CASE( %ADDGATE_CMD);
      884    13407    5                   IF REWRITES > %MAX_REWRITES THEN DO;
      885    13408    5                       CMDBUF = 'AddGate table overflow;  command not stored.';
      886    13409    5   TELLUSER:
      887    13410    5                       CALL WRITEDO;
      888    13411    5                       ERROR_FLAG = %YES#;
      889    13412    5                       EXIT CMD;
      890    13413    5                       END;
      891    13414    5                   IF OUT.NSUBLKS ~= 2 THEN DO;
      892    13415    5                       CMDBUF = 'AddGate command malformed;  command not stored.';
      893    13416    5                       GOTO TELLUSER;
      894    13417    5                       END;
      895    13418    4                   I = REWRITES;
      896    13419    4                   REWRITE.NEW.LEN( I) = OUT.SUBLK$(0)->SYM.COUNT;
      897    13420    4                   CALL XLATE( REWRITE.NEW.TXT( I), TCM_XLATE_TO_UC,
      898    13421    4                           OUT.SUBLK$(0)->SYM.TEXT);
      899    13422    4                   REWRITE.OLD.LEN( I) = OUT.SUBLK$(1)->SYM.COUNT;
      900    13423    4                   CALL XLATE( REWRITE.OLD.TXT( I), TCM_XLATE_TO_UC,
      901    13424    4                           OUT.SUBLK$(1)->SYM.TEXT);
      902    13425    4                   REWRITE.TYP( I) = %ADDGATE_CMD;
      903    13426    4                   REWRITES = REWRITES + 1;
      904    13427    4               CASE( %DELSITE_CMD);
      905    13428    5                   IF REWRITES > %MAX_REWRITES THEN DO;
      906    13429    5                       CMDBUF = 'DelSite table overflow;  command not stored.';
      907    13430    5                       GOTO TELLUSER;
      908    13431    5                       END;
      909    13432    5                   IF OUT.NSUBLKS ~= 1 THEN DO;
      910    13433    5                       CMDBUF = 'DelSite command malformed;  command not stored.';
      911    13434    5                       GOTO TELLUSER;
      912    13435    5                       END;
      913    13436    4                   I = REWRITES;
      914    13437    4                   REWRITE.OLD.LEN( I) = OUT.SUBLK$(0)->SYM.COUNT;
      915    13438    4                   CALL XLATE( REWRITE.OLD.TXT( I), TCM_XLATE_TO_UC,
      916    13439    4                           OUT.SUBLK$(0)->SYM.TEXT);
      917    13440    4                   REWRITE.TYP( I) = %DELSITE_CMD;
      918    13441    4                   REWRITES = REWRITES + 1;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:31   
      919    13442    4               CASE( %SET_CMD);
      920    13443    4                   OPT$ = OUT.SUBLK$(0);
      921    13444    4                   SUB$ = OPT$->OUT.SUBLK$(0);
      922    13445    5                   DO CASE( OPT$->OUT.CODE);
      923    13446    5                       CASE( %MYSITENAME);
      924    13447    5                           TCM_SITENAME = SUB$->SYM.TEXT;
      925    13448    5                       CASE( %ACCOUNT);
      926    13449    5                           TCM_ACCOUNT.ACCT# = SUB$->SYM.TEXT;
      927    13450    5                       CASE( %MESSACCT);
      928    13451    5                           TCM_MESSACCT.ACCT# = SUB$->SYM.TEXT;
      929    13452    5                       CASE( %STUCKEE);
      930    13453    5                           TCM_STUCKEE = SUB$->SYM.TEXT;
      931    13454    5                       CASE( %TIMEZONE);
      932    13455    5                           I = SUB$->SYM.CPOS;
      933    13456    5                           J = P$PCB.HI_CHAR - I;
      934    13457    5                           CALL CONCAT( TCM_TZTEXT, ' ',
      935    13458    5                                   SUBSTR( P$PCB.TEXT$->CHARS, I, J));
      936    13459    6                           DO CASE( SUB$->SYM.CODE);
      937    13460    6                               CASE( %TZUTO);
      938    13461    6                                   CALL CHARBIN( I, SUB$->OUT.SUBLK$(1)->SYM.TEXT);
      939    13462    6                                   TCM_UTOFFSET = ( ( I / 100) * %UTS_CSEC_HOUR#) +
      940    13463    6                                           MOD( I, 100) * %UTS_CSEC_MIN#;
      941    13464    6                                   IF SUB$->OUT.SUBLK$(0)->SYM.COUNT > 0 THEN
      942    13465    6                                       IF '-' = SUBSTR( SUB$->OUT.SUBLK$(0)->SYM.TEXT,
             13465                                                0, 1) THEN
      943    13466    6                                           TCM_UTOFFSET = -TCM_UTOFFSET;
      944    13467    6                               CASE( %TZMIL);
      945    13468    6                                   CALL INDEX( I, SUBSTR( SUB$->SYM.TEXT, 0, 1),
      946    13469    6                                           'MLKIHGFEDCBAZNOPQRSTUVWXY');
      947    13470    6                                   TCM_UTOFFSET = ( I - 12) * %UTS_CSEC_HOUR#;
      948    13471    6                               CASE( %TZCMN);
      949    13472    6                                   TCM_UTOFFSET = CMN2UTS( SUB$->OUT.SUBLK$(0)->SYM.
             13472                                            CODE)
      950    13473    6                                           * %UTS_CSEC_HOUR#;
      951    13474    6                               END;
      952    13475    5                       CASE( ELSE);
      953    13476                                /* do nothing; ignore this SET command */
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:32   
      954    13477    5                       END;
      955    13478    4               CASE( %IAM_CMD);
      956    13479    5                   DO I = 1 TO OUT.NSUBLKS - 1;  /* skip SITENAME */
      957    13480    5                       CALL CONCAT( FEPNAMES( I - 1), OUT.SUBLK$( I)->SYM.TEXT, BINASC(
             13480                                0));
      958    13481    5                       END;
      959    13482    4               END;
      960    13483    3           END SCAN;
      961    13484    2       CALL M$CLOSE( CLOSE_SI)
      962    13485    3       WHENALTRETURN DO;
      963    13486    3           END;
      964    13487    2       IF ERROR_FLAG THEN
      965    13488    2           ALTRETURN;
      966    13489    2       RETURN;
      967    13490
      968    13491    2       END INITIALIZE_CONFIGURATION;
      969    13492        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:33   
      970    13493    1   READ_COMMAND: PROC ALTRET;
      971    13494
      972    13495    2       CMD_CODE = 0;
      973    13496    2       CALL READ_TRANSPARENT ALTRET( BYPASS);
      974    13497    2       CALL XUR$GETCMD( TCM_SMTP_ROOT, CMD$, , LINEBUF, LINESIZE) ALTRET( COMMAND_ERROR
             13497                );
      975    13498    2       CMD_CODE = CMD.CODE;
      976    13499    2       RETURN;
      977    13500    2   BYPASS:
      978    13501    3       IF TIMED_OUT OR DATA_LOST THEN DO;
      979    13502    3           REPLY$ = R421ZAP$;
      980    13503    3           ALTRETURN;
      981    13504    3           END;
      982    13505    2       RETURN;
      983    13506    2   COMMAND_ERROR:
      984    13507    2       IF TCM_PCB.HI_CHAR = 0 THEN
      985    13508    2           REPLY$ = R500$;
      986    13509    2       ELSE
      987    13510    2           REPLY$ = R501$;
      988    13511    2       ALTRETURN;
      989    13512
      990    13513    2       END READ_COMMAND;
      991    13514        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:34   
      992    13515    1   WRITE_REPLY: PROC;
      993    13516
      994    13517    2       DCL ERR UBIN(36);
      995    13518
      996    13519    2       IF TCM_TCPFLAVOR THEN
      997    13520    2           CALL TCM$LTCP_WRITE( VECTOR( REPLY$->TEXTC.T), ERR);
      998    13521    3       ELSE DO;
      999    13522    3           WRITE_UC.BUF_ = VECTOR( REPLY$->TEXTC.T);
     1000    13523    3           CALL M$WRITE( WRITE_UC);
     1001    13524    3           END;
     1002    13525    3       IF TCM_DRIBBLE OR TCM_DRIBBLE_ME THEN DO;
     1003    13526    3           WRITE_DRIBBLE.BUF_ = VECTOR( REPLY$->TEXTC.T);
     1004    13527    3           CALL M$WRITE( WRITE_DRIBBLE);
     1005    13528    3           END;
     1006    13529    2       RETURN;
     1007    13530
     1008    13531    2       END WRITE_REPLY;
     1009    13532        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:35   
     1010    13533    1   SAVE_HOST_NAME: PROC ALTRET;
     1011    13534
     1012    13535    2       SYM$ = CMD.SUBLK$( 0);
     1013    13536    2       HELO.LEN = LINESIZE - SYM.CPOS;
     1014    13537    2       CALL CONCAT( HELO.TXT, SUBSTR( LINEBUF, SYM.CPOS, HELO.LEN));
     1015    13538    2       CALL CONCAT( OCMSG, SUBSTR( HELO.TXT, 0, HELO.LEN), ' on');
     1016    13539    2       CALL TELL_OPERATOR;
     1017    13540    2       REPLY$ = R250A$;
     1018    13541    2       RETURN;
     1019    13542
     1020    13543    2       END SAVE_HOST_NAME;
     1021    13544        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:36   
     1022    13545    1   TELL_OPERATOR: PROC;
     1023    13546
     1024    13547    2       DCL BLANK_INDEX UBIN;
     1025    13548
     1026    13549    3       IF NOT TCM_TCPFLAVOR THEN DO;
     1027    13550    3           CALL INDEX( BLANK_INDEX, '  ', OCMSG);
     1028    13551    3           TCM_KEYIN.MESS_ = VECTOR( SUBSTR( OCMSG, 0, BLANK_INDEX));
     1029    13552    3           CALL M$KEYIN( TCM_KEYIN)
     1030    13553    4           WHENALTRETURN DO;
     1031    13554    4               END;
     1032    13555    3           END;
     1033    13556    2       RETURN;
     1034    13557
     1035    13558    2       END TELL_OPERATOR;
     1036    13559        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:37   
     1037    13560    1   SAVE_REVERSE_PATH: PROC ALTRET;
     1038    13561
     1039    13562    2       SYM$ = CMD.SUBLK$(0);
     1040    13563    2       MAIL.LEN = LINESIZE - SYM.CPOS;
     1041    13564    2       CALL CONCAT( MAIL.TXT, SUBSTR( LINEBUF, SYM.CPOS, MAIL.LEN));
     1042    13565    2       RETURN;
     1043    13566
     1044    13567    2       END SAVE_REVERSE_PATH;
     1045    13568        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:38   
     1046    13569    1   SAVE_USER_NAME: PROC ALTRET;
     1047    13570
     1048    13571    2       DCL TEMP SBIN;
     1049    13572    2       DCL IDX UBIN;
     1050    13573
     1051    13574    3       IF USER_COUNT = %MAX_USERS THEN DO;
     1052    13575    3           REPLY$ = R552$;
     1053    13576    3           ALTRETURN;
     1054    13577    3           END;
     1055    13578    2       SYM$ = CMD.SUBLK$(0);
     1056    13579    2       ZTEXT.LEN = LINESIZE - SYM.CPOS;
     1057    13580    2       CALL CONCAT( ZTEXT.TXT, SUBSTR( LINEBUF, SYM.CPOS, ZTEXT.LEN));
     1058    13581    2       CALL TRIMTEXT( ZTEXT, RCPT);
     1059    13582    3       IF (SUBSTR(RCPT.TXT, RCPT.LEN -1, 1) = '.') THEN DO;
     1060    13583    3           SUBSTR(RCPT.TXT, RCPT.LEN -1, 1) = ' ';
     1061    13584    3           RCPT.LEN = RCPT.LEN - 1;
     1062    13585    3           END;
     1063    13586    3       IF SUBSTR( RCPT.TXT, 0, 1) = '@' THEN DO;
     1064    13587                /* The old convention @host:user */
     1065    13588    3           CALL INDEX( IDX, ':', RCPT.TXT)
     1066    13589    4           WHENALTRETURN DO;
     1067    13590    4               REPLY$ = R550$;
     1068    13591    4               ALTRETURN;
     1069    13592    4               END;
     1070    13593    3           ZTEXT = RCPT;
     1071    13594    3           CALL CONCAT (RCPT.TXT,SUBSTR(ZTEXT.TXT,IDX+1,ZTEXT.LEN-1-IDX),SUBSTR(ZTEXT.
             13594                    TXT,0,IDX));
     1072    13595    3           END;
     1073    13596    2       CALL FIXLOCAL( RCPT) ALTRET( NOTLOCAL);
     1074    13597    3       IF SUBSTR( RCPT.TXT, 0, 1) = '/' THEN DO;
     1075    13598                /* might be addressed to a mail folder; rewrite it if so */
     1076    13599    3           ZTEXT = RCPT;
     1077    13600    3           CALL INDEX( TEMP, '.', SUBSTR( ZTEXT.TXT, 0, ZTEXT.LEN))
     1078    13601    4           WHENRETURN DO;
     1079    13602    4               CALL CONCAT( RCPT.TXT,
     1080    13603    4                       SUBSTR( ZTEXT.TXT, TEMP, ZTEXT.LEN - TEMP),
     1081    13604    4                       SUBSTR( ZTEXT.TXT, 0, TEMP));
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:39   
     1082    13605    4               END;
     1083    13606    4           WHENALTRETURN DO;
     1084    13607    4               END;
     1085    13608    3           END;
     1086    13609    2       CALL LOOKUP_ALIAS( ADDR( RCPT))
     1087    13610    3       WHENALTRETURN DO;
     1088    13611    3           ALTRETURN;
     1089    13612    3           END;
     1090    13613    2   NOTLOCAL:
     1091    13614    2       USERS( USER_COUNT) = RCPT;
     1092    13615    2       RETURN;
     1093    13616
     1094    13617    2       END SAVE_USER_NAME;
     1095    13618        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:40   
     1096    13619    1   VERIFY_ADDRESS: PROC ALTRET;
     1097    13620
     1098    13621    2       SYM$ = CMD.SUBLK$(0);
     1099    13622    2       ZTEXT.LEN = SYM.COUNT;
     1100    13623    2       CALL INSERT( ZTEXT.TXT, 0, SYM.COUNT, SYM.TEXT);
     1101    13624    2       STATUS_LINE.CMD = 'VRFY';
     1102    13625    2       STATUS_LINE.STATUS = ' ';
     1103    13626    2       STATUS_LINE.LINES = ' ';
     1104    13627    2       STATUS_LINE.FROM_ADDR = ' ';
     1105    13628    2       STATUS_LINE.RCPT_ADDR = SUBSTR( ZTEXT.TXT, 0, ZTEXT.LEN);
     1106    13629    2       CALL STATUS_LINE_UPDATE;
     1107    13630    2       CALL TRIMTEXT( ZTEXT, TTEXT);
     1108    13631    2       CALL FIXLOCAL( TTEXT) ALTRET( NOTLOCAL);
     1109    13632    2       CALL LOOKUP_ALIAS( ADDR( TTEXT))
     1110    13633    3       WHENALTRETURN DO;
     1111    13634    3           ALTRETURN;
     1112    13635    3           END;
     1113    13636    2   NOTLOCAL:
     1114    13637    2       RETURN;
     1115    13638
     1116    13639    2       END VERIFY_ADDRESS;
     1117    13640        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:41   
     1118    13641    1   BUILD_MAIL_HEADER: PROC ALTRET;
     1119    13642
     1120    13643    2       CALL M$TIME( GET_UTS);
     1121    13644    2       CALL BINCHAR( SUBSTR( DATA_NAME.NAME#, 4, 12), UTS);
     1122    13645    2       CALL BINCHAR( SUBSTR( SEND_CMD.NAME#, 9, 12), UTS);
     1123    13646    2       OPEN_DATA.NAME_ = VECTOR( DATA_NAME);
     1124    13647    2       REOPEN_DATA.NAME_ = VECTOR( DATA_NAME);
     1125    13648    2       DELETE_DATA.NAME_ = VECTOR( DATA_NAME);
     1126    13649    2       CALL M$OPEN( OPEN_DATA) ALTRET( IOERR);
     1127    13650    2       CALL CONCAT( LINEBUF, 'TO:', ADDR( USERS( 0))->TEXTC.T);
     1128    13651    2       WRITE_DATA.BUF_.BOUND = USERS.LEN( 0) + 2;
     1129    13652    2       DATA_KEY.KEY = 1000;
     1130    13653    2       CALL M$WRITE( WRITE_DATA) ALTRET( IOERR);
     1131    13654    2       CALL M$TIME( GET_TIMESTAMP);
     1132    13655    2       DATA_KEY.KEY = 4000;
     1133    13656    2       CALL CONCAT( LINEBUF,
     1134    13657    2               'TRACE:Return-path: ', SUBSTR( MAIL.TXT, 0, MAIL.LEN));
     1135    13658    2       CALL INDEX( LINESIZE, '   ', LINEBUF);
     1136    13659    2       WRITE_DATA.BUF_.BOUND = LINESIZE - 1;
     1137    13660    2       CALL M$WRITE( WRITE_DATA) ALTRET( IOERR);
     1138    13661    2       DATA_KEY.KEY = 5000;
     1139    13662    2       CALL CONCAT( DATEWORK, DATEBUF.DAY, ' ', DATEBUF.MON, ' ', DATEBUF.YEAR);
     1140    13663    2       CALL CONCAT( TIMEWORK, TIMEBUF.HOUR, ':', TIMEBUF.MIN, ':', TIMEBUF.SEC);
     1141    13664    2       CALL CONCAT( LINEBUF, 'TRACE:Received: From ',
     1142    13665    2               SUBSTR( HELO.TXT, 0, HELO.LEN),
     1143    13666    2               SUBSTR( MY_SITE_NAME_2, 0, MY_SITE_NAME_L + 16),
     1144    13667    2               DATEWORK, TIMEWORK, TCM_TZTEXT);
     1145    13668    2       CALL INDEX( LINESIZE, '   ', LINEBUF);
     1146    13669    2       WRITE_DATA.BUF_.BOUND = LINESIZE - 1;
     1147    13670    2       CALL M$WRITE( WRITE_DATA) ALTRET( IOERR);
     1148    13671    2       RETURN;
     1149    13672    2   IOERR:
     1150    13673    2       REPLY$ = R451$;
     1151    13674    2       ALTRETURN;
     1152    13675
     1153    13676    2       END BUILD_MAIL_HEADER;
     1154    13677        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:42   
     1155    13678    1   GET_MESSAGE_DATA: PROC ALTRET;
     1156    13679
     1157    13680    2       DCL END_OF_MESSAGE BIT(1);
     1158    13681    2       DCL HEADER_LINE BIT(1);
     1159    13682    2       DCL DATE_SEEN BIT(1);
     1160    13683    2       DCL BLANK_LINE_READ BIT(1);
     1161    13684    2       DCL TEMP SBIN;
     1162    13685    2       DCL LEN SBIN;
     1163    13686    2       DCL RCVDLEN SBIN;
     1164    13687    2       DCL RCVDBUF CHAR(400);
     1165    13688    2       DCL CHR CHAR(1);
     1166    13689    2       DCL PREV_CMDCODE SBIN;
     1167    13690    2       DCL CURR_CMDCODE SBIN;
     1168    13691
     1169    13692    2       FROM.LEN = 0;
     1170    13693    2       REPL.LEN = 0;
     1171    13694    2       SUBJ.LEN = 0;
     1172    13695    2       RMID.LEN = 0;
     1173    13696    2       MID.LEN = 0;
     1174    13697    2       FORUM.LEN = 0;
     1175    13698    2       WHEN.LEN = 0;
     1176    13699    2       LTEXT.LEN = 0;
     1177    13700    2       TTEXT.LEN = 0;
     1178    13701    2       FTEXT.LEN = 0;
     1179    13702    2       RTEXT.LEN = 0;
     1180    13703    2       DATE_SEEN = %FALSE;
     1181    13704    2       HEADER_LINE = %TRUE;
     1182    13705    2       END_OF_MESSAGE = %FALSE;
     1183    13706    2       PREV_CMDCODE = -1;
     1184    13707
     1185    13708            /** LOOP TO READ ALL MESSAGE LINES & WRITE THEM TO THE MESSAGE FILE **/
     1186    13709    3       DO UNTIL END_OF_MESSAGE;
     1187    13710                /** GET NEXT LINE **/
     1188    13711    3           CALL READ_TRANSPARENT ALTRET( BLANK_LINE);
     1189    13712    3   JOIN_AFTER_READ:
     1190    13713    3           CHR = SUBSTR( LINEBUF, 0, 1);
     1191    13714    3           IF CHR = ' ' OR CHR = BITASC( '011'O) THEN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:43   
     1192    13715    4               IF PREV_CMDCODE ~= -1 THEN DO;
     1193    13716    4                   SUBSTR( LINEBUF, 0, 1) = ' ';  /* make blank */
     1194    13717    4                   CALL SEARCH( SYM.CPOS, TEMP, TCM_SKIP_BLANKS, LINEBUF);
     1195    13718    4                   SYM.CPOS = SYM.CPOS - 1;  /* include one blank */
     1196    13719    4                   CURR_CMDCODE = PREV_CMDCODE;
     1197    13720    4                   GOTO CASE_CODE;
     1198    13721    4                   END;
     1199    13722    3               ELSE
     1200    13723    3                   GOTO STD_HEADER;
     1201    13724    3           IF CHR = '.' THEN
     1202    13725    4               IF LINESIZE = 1 THEN DO;
     1203    13726                        /* A DOT ALONE MEANS EOF              */
     1204    13727    4                   CALL M$CLOSE( CLOSE_DATA);
     1205    13728    4                   END_OF_MESSAGE = %TRUE;
     1206    13729    4                   MSG_COUNT = MSG_COUNT + 1;
     1207    13730    4                   IF REPLY$ = R354$ THEN
     1208    13731    4                       REPLY$ = R250$;
     1209    13732    4                   END;
     1210    13733    4               ELSE DO;
     1211    13734                        /* A DOT WITH TEXT MEANS DOT TRANSPARENCY  */
     1212    13735    4                   LINESIZE = LINESIZE - 1;
     1213    13736    4                   SUBSTR( LINEBUF, 0, LINESIZE) = SUBSTR( LINEBUF, 1, LINESIZE);
     1214    13737    4                   END;
     1215    13738    3           ELSE
     1216    13739    4               IF HEADER_LINE THEN DO;
     1217    13740                        /* PROCESS HEADER LINES AT START OF MESSAGE     */
     1218    13741    4                   PREV_CMDCODE = -1;
     1219    13742    4                   CALL XUR$GETCMD( TCM_USER_ROOT, CMD$, , LINEBUF, LINESIZE)
     1220    13743    4                           ALTRET( STD_HEADER);
     1221    13744    4                   IF CMD$ = ADDR( NIL) OR CMD.NSUBLKS = 0 THEN
     1222    13745    4                       GOTO BLANK_LINE;
     1223    13746    4                   CURR_CMDCODE = CMD.CODE;
     1224    13747    4                   OUT$ = CMD.SUBLK$(0);
     1225    13748    4   CASE_CODE:
     1226    13749    5                   DO CASE( CURR_CMDCODE);
     1227    13750    5                       CASE( %USER_SUBJ);
     1228    13751    5                           CALL APPEND_HEADER( SUBJ);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:44   
     1229    13752    5                       CASE( %USER_MID);
     1230    13753    5                           CALL APPEND_HEADER( MID);
     1231    13754    5                       CASE( %USER_RMID);
     1232    13755    5                           CALL APPEND_HEADER( RMID);
     1233    13756    5                       CASE( %USER_FROM);
     1234    13757    5                           CALL APPEND_HEADER( FROM);
     1235    13758    5                       CASE( %USER_REPL);
     1236    13759    5                           CALL APPEND_HEADER( REPL);
     1237    13760    5                       CASE( %USER_WHEN);
     1238    13761    5                           CMD$ = OUT$;
     1239    13762    5                           CALL SET_DATESTAMP ALTRET( STD_HEADER);
     1240    13763    5                           DATE_SEEN = %TRUE;
     1241    13764    5                       CASE( %USER_FORUM);
     1242    13765    5                           CALL INSERT( SUBJ.TXT, SUBJ.LEN, ,
     1243    13766    5                                   ' [', SYM.TEXT, ']');
     1244    13767    5                           SUBJ.LEN = SUBJ.LEN + SYM.COUNT + 3;
     1245    13768    5                       CASE( %USER_ACK);
     1246    13769    5                           ACKNOWLEDGE = %YES#;
     1247    13770    5                       CASE( %USER_RCVD);
     1248    13771    5                           IF DATE_SEEN THEN
     1249    13772    5                               EXIT CASE_CODE;  /* Date: beats Received: */
     1250    13773    5                           RCVDBUF = ' ';
     1251    13774    5                           RCVDLEN = 0;
     1252    13775    5                           CALL INDEX1R( TEMP, ';', SUBSTR( LINEBUF, 0, LINESIZE))
     1253    13776    6                           WHENRETURN DO;
     1254    13777    6                               RCVDLEN = LINESIZE - TEMP;
     1255    13778    6                               CALL CONCAT( RCVDBUF, SUBSTR( LINEBUF, TEMP, RCVDLEN));
     1256    13779    6                               END;
     1257    13780    6                           WHENALTRETURN DO;
     1258    13781    6                               END;  /* No ';', so forget this chunk of header */
     1259    13782    5                           BLANK_LINE_READ = %FALSE;
     1260    13783    5   RCVD_AGAIN:
     1261    13784    5                           CALL READ_TRANSPARENT
     1262    13785    6                           WHENRETURN DO;
     1263    13786    6                               CHR = SUBSTR( LINEBUF, 0, 1);
     1264    13787    7                               IF CHR = ' ' OR CHR = BITASC( '011'O) THEN DO;
     1265    13788    7                                   CALL INSERT( RCVDBUF, RCVDLEN, LINESIZE,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:45   
     1266    13789    7                                           SUBSTR( LINEBUF, 0, LINESIZE));
     1267    13790    7                                   RCVDLEN = RCVDLEN + LINESIZE;
     1268    13791    7                                   GOTO RCVD_AGAIN;
     1269    13792    7                                   END;
     1270    13793    6                               END;
     1271    13794    6                           WHENALTRETURN DO;
     1272    13795    6                               BLANK_LINE_READ = %TRUE;
     1273    13796    6                               END;
     1274    13797                                /* At this point RCVDBUF has 'a lot' of the Received:
     1275    13798                                   header.  Look for rightmost ';' and blank out all
     1276    13799                                   text up to and including it.                     */
     1277    13800                                /* The header or other record after Received: is now
     1278    13801                                   buffered in LINEBUF waiting until we're done.    */
     1279    13802    5                           CALL INDEX1R( TEMP, ';', SUBSTR( RCVDBUF, 0, RCVDLEN))
     1280    13803    6                           WHENRETURN DO;
     1281    13804    6                               CALL INSERT( RCVDBUF, 0, TEMP + 1, ' ');
     1282    13805    6                               END;
     1283    13806    6                           WHENALTRETURN DO;
     1284    13807    6                               END;  /* No semicolon means no timestamp? */
     1285    13808    5                           CALL XUR$GETCMD(
     1286    13809    5                                   TCM_TSTAMP_ROOT, CMD$, , RCVDBUF, RCVDLEN)
     1287    13810    6                           WHENRETURN DO;
     1288    13811    6                               IF CMD$ ~= ADDR( NIL) THEN
     1289    13812    6                                   IF CMD.NSUBLKS > 0 THEN
     1290    13813    6                                       CALL SET_DATESTAMP
     1291    13814    7                                       WHENALTRETURN DO;
     1292    13815    7                                           END;
     1293    13816    6                               END;
     1294    13817    6                           WHENALTRETURN DO;
     1295    13818    6                               END;  /* Tstamp parse failed.  Forget it. */
     1296    13819                                /* We're done.  Process the buffered header line. */
     1297    13820    5                           IF BLANK_LINE_READ THEN
     1298    13821    5                               GOTO BLANK_LINE;
     1299    13822    5                           GOTO JOIN_AFTER_READ;
     1300    13823    5                       END /* case hdr$blk.code */;
     1301    13824    4   STD_HEADER:
     1302    13825    4                   END;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:46   
     1303    13826                /** WRITE LINE TO MESSAGE FILE **/
     1304    13827    4           IF REPLY$ = R354$ THEN DO;
     1305    13828    5               IF HEADER_LINE THEN DO;
     1306    13829    5                   CALL CONCAT( ZTEXT.TXT, 'TRACE:', LINEBUF);
     1307    13830    5                   LINEBUF = ZTEXT.TXT;
     1308    13831    5                   LINESIZE = LINESIZE + LENGTHC( 'TRACE:');
     1309    13832    5                   END;
     1310    13833    4               WRITE_DATA.BUF_.BOUND = LINESIZE - 1;
     1311    13834    4               DATA_KEY.KEY = DATA_KEY.KEY + 1000;
     1312    13835    4               TEMP = DATA_KEY.KEY / 1000;
     1313    13836    4               CALL BINCHAR( STATUS_LINE.LINES, TEMP);
     1314    13837    4               CALL STATUS_LINE_UPDATE;
     1315    13838    4               CALL M$WRITE( WRITE_DATA) ALTRET( IOERR);
     1316    13839    5               DO NEVER;
     1317    13840    5   IOERR:
     1318    13841    5                   REPLY$ = R451$;
     1319    13842    5                   END;
     1320    13843    4               END;
     1321    13844    4           DO NEVER;
     1322    13845    4   BLANK_LINE:
     1323    13846                    /* INDICATES END OF HEADER BLOCK      */
     1324    13847    5               IF TIMED_OUT THEN DO;
     1325    13848    5                   CALL NOTIFY_STUCKEE_READERR;
     1326    13849    5                   CALL M$CLOSE( CLOSE_DATA)
     1327    13850    6                   WHENALTRETURN DO;
     1328    13851    6                       END;
     1329    13852    5                   CALL M$OPEN( DELETE_DATA)
     1330    13853    6                   WHENALTRETURN DO;
     1331    13854    6                       END;
     1332    13855    5                   IF NOT DATA_LOST THEN
     1333    13856    5                       REPLY$ = R421TO$;
     1334    13857    5                   ALTRETURN;
     1335    13858    5                   END;
     1336    13859    4               IF DATA_LOST THEN
     1337    13860    4                   REPLY$ = R421DL$;
     1338    13861    5               ELSE DO;
     1339    13862    5                   DATA_KEY.KEY = DATA_KEY.KEY + 1000;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:47   
     1340    13863    5                   CALL M$WRITE( WRITE_BLANK_DATA) ALTRET( IOERR);
     1341    13864    5                   END;
     1342    13865    4               HEADER_LINE = %FALSE;
     1343    13866    4               END;
     1344    13867    3           END /* until end_of_message */;
     1345    13868    2       RETURN;
     1346    13869
     1347    13870    2   APPEND_HEADER: PROC( BUFF);
     1348    13871            %BUFFER( NAME=BUFF, STCLASS=);
     1349    13876
     1350    13877    3       LEN = MINIMUM( %BUFSIZ - BUFF.LEN, LINESIZE - SYM.CPOS);
     1351    13878    4       IF LEN > 0 THEN DO;
     1352    13879    4           CALL INSERT( BUFF.TXT, BUFF.LEN, LEN,
     1353    13880    4                   SUBSTR( LINEBUF, SYM.CPOS, LEN));
     1354    13881    4           BUFF.LEN = BUFF.LEN + LEN;
     1355    13882    4           END;
     1356    13883    3       PREV_CMDCODE = CURR_CMDCODE;
     1357    13884    3       RETURN;
     1358    13885
     1359    13886    3       END APPEND_HEADER;
     1360    13887        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:48   
     1361    13888    2   SET_DATESTAMP: PROC ALTRET;
     1362    13889
     1363    13890    3       DCL TZOFFSET SBIN;
     1364    13891    3       DCL DATE$ PTR;
     1365    13892    3       DCL TIME$ PTR;
     1366    13893    3       DCL ZONE$ PTR;
     1367    13894
     1368    13895    3       TEMP = CMD.NSUBLKS - 2;
     1369    13896    3       DATE$ = CMD.SUBLK$( TEMP);
     1370    13897    3       TIME$ = CMD.SUBLK$( TEMP + 1);
     1371    13898    3       ANSSTAMP = 'YYMMDDHHMM0000';
     1372    13899            /* do the year */
     1373    13900    3       CALL CHARBIN( TEMP, DATE$->OUT.SUBLK$(2)->SYM.TEXT);
     1374    13901    3       IF TEMP > 99 THEN
     1375    13902    3           TEMP = MOD( TEMP, 100);
     1376    13903    3       CALL BINCHAR( SUBSTR( ANSSTAMP, 0, 2), TEMP);
     1377    13904            /* do the month, day, hour, and minute */
     1378    13905    3       TEMP = DATE$->OUT.SUBLK$(1)->SYM.CODE;
     1379    13906    3       CALL BINCHAR( SUBSTR( ANSSTAMP, 2, 2), TEMP);
     1380    13907    3       CALL CHARBIN( TEMP, DATE$->OUT.SUBLK$(0)->SYM.TEXT);
     1381    13908    3       CALL BINCHAR( SUBSTR( ANSSTAMP, 4, 2), TEMP);
     1382    13909    3       CALL CHARBIN( TEMP, TIME$->OUT.SUBLK$(0)->SYM.TEXT);
     1383    13910    3       CALL BINCHAR( SUBSTR( ANSSTAMP, 6, 2), TEMP);
     1384    13911    3       CALL CHARBIN( TEMP, TIME$->OUT.SUBLK$(1)->SYM.TEXT);
     1385    13912    3       CALL BINCHAR( SUBSTR( ANSSTAMP, 8, 2), TEMP);
     1386    13913            /* do the second, if given */
     1387    13914    4       IF TIME$->OUT.NSUBLKS > 3 THEN DO;
     1388    13915    4           CALL CHARBIN( TEMP, TIME$->OUT.SUBLK$(2)->SYM.TEXT);
     1389    13916    4           CALL BINCHAR( SUBSTR( ANSSTAMP, 10, 2), TEMP);
     1390    13917    4           END;
     1391    13918            /* convert this to a UTS value, ignoring sender's timezone */
     1392    13919    3       CALL M$TIME( ANS2UTSVAL) ALTRET( OOPS);
     1393    13920    3       TZOFFSET = 0;  /* determine sender's offset from UTC */
     1394    13921    3       ZONE$ = TIME$->OUT.SUBLK$( TIME$->OUT.NSUBLKS - 1);
     1395    13922    3       ZONE$ = ZONE$->OUT.SUBLK$(0);
     1396    13923    4       DO CASE( ZONE$->SYM.CODE);
     1397    13924    4           CASE( %UTOFFSET);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:49   
     1398    13925    4               CALL CHARBIN( TEMP, ZONE$->OUT.SUBLK$(1)->SYM.TEXT);
     1399    13926    4               TZOFFSET = ( ( TEMP / 100) * %UTS_CSEC_HOUR#) +
     1400    13927    4                       MOD( TEMP, 100) * %UTS_CSEC_MIN#;
     1401    13928    4               IF ZONE$->OUT.SUBLK$(0)->SYM.COUNT > 0 THEN
     1402    13929    4                   IF '-' = SUBSTR( ZONE$->OUT.SUBLK$(0)->SYM.TEXT, 0, 1) THEN
     1403    13930    4                       TZOFFSET = -TZOFFSET;
     1404    13931    4           CASE( %MILITARY);
     1405    13932    4               CALL INDEX( TEMP,
     1406    13933    4                       SUBSTR( ZONE$->OUT.SUBLK$(0)->SYM.TEXT, 0, 1),
     1407    13934    4                       'MLKIHGFEDCBAZNOPQRSTUVWXY');
     1408    13935    4               TZOFFSET = ( TEMP - 12) * %UTS_CSEC_HOUR#;
     1409    13936    4           CASE( %COMMON);
     1410    13937    4               TZOFFSET = CMN2UTS( ZONE$->OUT.SUBLK$(0)->SYM.CODE) * %UTS_CSEC_HOUR#;
     1411    13938    4           END;
     1412    13939    3       CALL XUD$UTS_ADJUST( UTSVAL, UTSVAL, -TZOFFSET);  /* correction to make UTC */
     1413    13940    3       CALL XUD$UTS_ADJUST( UTSVAL, UTSVAL, TCM_UTOFFSET);
             13940                /* correction to make local time */
     1414    13941    3       CALL M$TIME( UTSVAL2LCL) ALTRET( OOPS);  /* make chars for later */
     1415    13942    3       WHEN.TXT = LCLSTAMP;
     1416    13943    3       WHEN.LEN = 14;  /* MM/DD/YY,HH:MM */
     1417    13944    3       RETURN;
     1418    13945    3   OOPS:
     1419    13946    3       ALTRETURN;
     1420    13947
     1421    13948    3       END SET_DATESTAMP;
     1422    13949
     1423    13950    2       END GET_MESSAGE_DATA;
     1424    13951        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:50   
     1425    13952    1   SEND_MAIL_MESSAGE: PROC ALTRET;
     1426    13953
     1427    13954    2       DCL COUNT UBIN;
     1428    13955    2       DCL START UBIN;
     1429    13956    2       DCL TROUBLE BIT(1);
     1430    13957
     1431    13958    2       CALL M$OPEN( REOPEN_DATA) ALTRET( OOPS);
     1432    13959    3       IF SUBJ.LEN = 0 THEN DO;
     1433    13960    3           SUBJ.TXT = '( )';
     1434    13961    3           SUBJ.LEN = 3;
     1435    13962    3           END;
     1436    13963    2       CALL WRITE_HEADER( SUBJ, 2500) ALTRET( OOPS);
     1437    13964    2       CALL WRITE_HEADER(     , 3000) ALTRET( OOPS);
     1438    13965    2       CALL WRITE_HEADER(     , 3200) ALTRET( OOPS);
     1439    13966    2       CALL WRITE_HEADER(  MID, 3750) ALTRET( OOPS);
     1440    13967    2       CALL WRITE_HEADER( RMID, 3752) ALTRET( OOPS);
     1441    13968    2       CALL WRITE_HEADER( FORUM,3754) ALTRET( OOPS);
     1442    13969    2       CALL WRITE_HEADER( WHEN, 3900) ALTRET( OOPS);
     1443    13970    2       CALL WRITE_HEADER(     , 3910) ALTRET( OOPS);
     1444    13971    2       CALL M$CLOSE( CLOSE_DATA) ALTRET( OOPS);
     1445    13972            /****** SEND MESSAGE TO ALL RECEPIENTS ******/
     1446    13973    2       SEND_MAIL.NAME_ = VECTOR( SEND);
     1447    13974    2       SEND_MAIL.CMD_ = VECTOR( SEND_CMD);
     1448    13975    2       TROUBLE = %NO#;
     1449    13976    3       DO COUNT = 1 TO USER_COUNT;
     1450    13977    3           CALL M$GTRMCTL( FPT_TRMCTL);  /* get current CTL stuff */
     1451    13978    3           TRMCTL.OUTPUTDISCARD# = %YES#; /* shut off output */
     1452    13979    3           CALL M$STRMCTL( FPT_TRMCTL);  /* tell the FEP */
     1453    13980    3           CALL M$GTRMCTL( FPT_TRMCTL);  /* wait for FEP response */
     1454    13981    3           CALL M$LINK( SEND_MAIL)
     1455    13982    4           WHENALTRETURN DO;
     1456    13983    4               ERRCODE = B$TCB.ALT$->B$ALT.ERR;
     1457    13984    4               TROUBLE = %YES#;
     1458    13985    4               END;
     1459    13986    3           TRMCTL.OUTPUTDISCARD# = %NO#; /* turn on output again */
     1460    13987    3           CALL M$STRMCTL( FPT_TRMCTL);  /* tell the FEP */
     1461    13988    3           CALL M$GTRMCTL( FPT_TRMCTL);  /* wait for FEP response */
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:51   
     1462    13989    4           IF COUNT < USER_COUNT THEN DO;
     1463    13990    4               CALL M$OPEN( REOPEN_DATA) ALTRET( OOPS);
     1464    13991    4               DATA_KEY.KEY = 1000;
     1465    13992    4               CALL M$READ( REREAD_DATA) ALTRET( OOPS);
     1466    13993    4               CALL CONCAT( LINEBUF, 'TO:', USERS.TXT( COUNT));
     1467    13994    4               WRITE_DATA.BUF_.BOUND = USERS.LEN( COUNT) + LENGTHC( 'TO:') - 1;
     1468    13995    4               CALL M$WRITE( WRITE_DATA) ALTRET( OOPS);
     1469    13996    4               CALL M$CLOSE( CLOSE_DATA) ALTRET( OOPS);
     1470    13997    4               END;
     1471    13998    3           END;
     1472    13999    2       CALL TCM$WRITE_AUDIT_LOG( MSG_COUNT, HELO);
     1473    14000    3       IF TROUBLE THEN DO;
     1474    14001    3           REPLY$ = R250OOPS$;
     1475    14002    3           IF TCM_STUCKEE ~= ' ' THEN
     1476    14003    3               CALL NOTIFY_STUCKEE;
     1477    14004    3           END;
     1478    14005    3       ELSE DO;
     1479    14006    3           CALL M$OPEN( DELETE_DATA)
     1480    14007    4           WHENALTRETURN DO;
     1481    14008    4               END;
     1482    14009    3           END;
     1483    14010    2       IF TROUBLE THEN
     1484    14011    3           IF TCM_DRIBBLE OR TCM_DRIBBLE_ME THEN DO;
     1485    14012    3               OCMSG = ' ';
     1486    14013    3               FPT_ERRMSG.BUF_ = VECTOR( OCMSG);
     1487    14014    3               CALL M$ERRMSG( FPT_ERRMSG);
     1488    14015    3               CALL GET_IOBUF_BOUND( OCMSG, COUNT);
     1489    14016    3               WRITE_DRIBBLE.BUF_ = VECTOR( SUBSTR( OCMSG, 0, COUNT));
     1490    14017    3               CALL M$WRITE( WRITE_DRIBBLE);
     1491    14018    3               END;
     1492    14019    2       RETURN;
     1493    14020    2   OOPS:
     1494    14021    2       CALL M$CLOSE( CLOSE_DATA)
     1495    14022    3       WHENALTRETURN DO;
     1496    14023    3           END;
     1497    14024    2       REPLY$ = R451$;
     1498    14025    2       ALTRETURN;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:52   
     1499    14026
     1500    14027    2       END SEND_MAIL_MESSAGE;
     1501    14028        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:53   
     1502    14029    1   NOTIFY_STUCKEE: PROC;
     1503    14030
     1504    14031    2       DCL ERRMSGBUF(0:6) CHAR(120);
     1505    14032    2       DCL F$DATA$ PTR;
     1506    14033    2       DCL I SBIN;
     1507    14034
     1508    14035    2       CALL M$OPEN( REOPEN_DATA) ALTRET( DONE);
     1509    14036    2       CALL CREATE_NOTEFILE ALTRET( BAILOUT);
     1510    14037    2       CALL CONCAT( OCMSG, 'To: ', TCM_STUCKEE);
     1511    14038    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);
     1512    14039    2       OCMSG = 'Subject: Mail delivery failure';
     1513    14040    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);
     1514    14041    2       F$DATA$ = DCBADDR( DCBNUM( F$DATA));
     1515    14042    2       CALL CONCAT( OCMSG, 'Mailgram ',
     1516    14043    2               SUBSTR( F$DATA$->F$DCB.NAME#.C, 0, F$DATA$->F$DCB.NAME#.L),
     1517    14044    2               '.', F$DATA$->F$DCB.ACCT#,
     1518    14045    2               ' could not be delivered');
     1519    14046    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);
     1520    14047    2       CALL CONCAT( OCMSG, 'to ', SUBSTR( RCPT.TXT, 0, RCPT.LEN),
     1521    14048    2               ' for the following reason, supplied by SEND:');
     1522    14049    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);
     1523    14050    2       FPT_ERRMSG.BUF_ = VECTOR( ERRMSGBUF);
     1524    14051    2       CALL M$ERRMSG( FPT_ERRMSG) ALTRET( BAILOUT);
     1525    14052    3       DO I = 1 TO VLR_ERRMSG.RECCNT;
     1526    14053    3           OCMSG = ERRMSGBUF( I - 1);
     1527    14054    3           CALL APPEND_NOTEFILE ALTRET( BAILOUT);
     1528    14055    3           END;
     1529    14056    2       CALL SEND_NOTEFILE ALTRET( BAILOUT);
     1530    14057    2   BAILOUT:
     1531    14058    2       CALL M$CLOSE( CLOSE_DATA) ALTRET( DONE);
     1532    14059    2   DONE:
     1533    14060    2       RETURN;
     1534    14061
     1535    14062    2       END NOTIFY_STUCKEE;
     1536    14063        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:54   
     1537    14064    1   NOTEFILE_STUFF: PROC ALTRET;
     1538    14065
     1539    14066    2       DCL TEMP SBIN;
     1540    14067
     1541    14068    2   OOPS:
     1542    14069    2       ALTRETURN;
     1543    14070
     1544    14071    2   CREATE_NOTEFILE: ENTRY ALTRET;
     1545    14072
     1546    14073    2       CALL M$OPEN( OPEN_NOTIFY) ALTRET( OOPS);
     1547    14074    2       RETURN;
     1548    14075
     1549    14076    2   APPEND_NOTEFILE: ENTRY ALTRET;
     1550    14077
     1551    14078    2       CALL GET_IOBUF_BOUND( OCMSG, TEMP);
     1552    14079    2       WRITE_NOTIFY.BUF_ = VECTOR( SUBSTR( OCMSG, 0, TEMP));
     1553    14080    2       CALL M$WRITE( WRITE_NOTIFY) ALTRET( OOPS);
     1554    14081    2       RETURN;
     1555    14082
     1556    14083    2   SEND_NOTEFILE: ENTRY ALTRET;
     1557    14084
     1558    14085    2       CALL M$CLOSE( CLOSE_NOTIFY) ALTRET( OOPS);
     1559    14086    2       CALL M$LINK( SEND_NOTIFY) ALTRET( OOPS);
     1560    14087    2       RETURN;
     1561    14088
     1562    14089    2       END NOTEFILE_STUFF;
     1563    14090        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:55   
     1564    14091    1   NOTIFY_STUCKEE_READERR: PROC;
     1565    14092
     1566    14093    2       DCL ERRMSGBUF(0:6) CHAR(120);
     1567    14094    2       DCL I SBIN;
     1568    14095
     1569    14096    2       IF NOT TCM_TCPFLAVOR THEN
     1570    14097    2           GOTO BAILOUT;
     1571    14098    2       CALL CREATE_NOTEFILE ALTRET( BAILOUT);
     1572    14099    2       CALL CONCAT( OCMSG, 'To: ', TCM_STUCKEE);
     1573    14100    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);
     1574    14101    2       OCMSG = 'Subject: Mail reception failure';
     1575    14102    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);
     1576    14103    2       CALL CONCAT( OCMSG, 'A mailgram could not be received');
     1577    14104    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);
     1578    14105    2       CALL CONCAT( OCMSG, 'for ', SUBSTR( RCPT.TXT, 0, RCPT.LEN),
     1579    14106    2               ' for the following reason, supplied by Socket Library:');
     1580    14107    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);
     1581    14108    2       IF XSL_ERRNO ~= 0 THEN
     1582    14109    2           ERRCODE = '302314'O | BINBIT( XSL_ERRNO, 33);
     1583    14110    2       ELSE
     1584    14111    2           IF TCP_MON_ERR THEN
     1585    14112    2               ERRCODE = TCP_MON_ERR;
     1586    14113    2           ELSE
     1587    14114    2               ERRCODE = '302314'O | BINBIT( %E$IO, 33);
     1588    14115    2       FPT_XSERRMSG.BUF_ = VECTOR( ERRMSGBUF);
     1589    14116    2       CALL M$ERRMSG( FPT_XSERRMSG) ALTRET( BAILOUT);
     1590    14117    3       DO I = 1 TO VLR_ERRMSG.RECCNT;
     1591    14118    3           OCMSG = ERRMSGBUF( I - 1);
     1592    14119    3           CALL APPEND_NOTEFILE ALTRET( BAILOUT);
     1593    14120    3           END;
     1594    14121    2       CALL SEND_NOTEFILE ALTRET( BAILOUT);
     1595    14122    2   BAILOUT:
     1596    14123    2       RETURN;
     1597    14124
     1598    14125    2       END NOTIFY_STUCKEE_READERR;
     1599    14126        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:56   
     1600    14127    1   WRITE_HEADER: PROC( TXTC, KEYVAL) ALTRET;
     1601    14128
     1602    14129    2       DCL 1 TXTC,
     1603    14130    2            2 LEN UBIN(9) CALIGNED,
     1604    14131    2            2 TXT CHAR( TXTC.LEN) CALIGNED;
     1605    14132    2       DCL KEYVAL SBIN;
     1606    14133            %BUFFER( NAME=TITLE);
     1607    14138
     1608    14139    3       DO SELECT( KEYVAL);
     1609    14140    3           SELECT( 2500);  /* SUBJ */
     1610    14141    3               TITLE.TXT = 'Subject: ';
     1611    14142    3               TITLE.LEN = 9;
     1612    14143    3               GOTO COMMON;
     1613    14144    3           SELECT( 3750);  /* MID */
     1614    14145    3               IF TXTC.LEN = 0 THEN
     1615    14146    3                   RETURN;
     1616    14147    3               TITLE.TXT = 'Message ID: ';
     1617    14148    3               TITLE.LEN = 12;
     1618    14149    3               GOTO COMMON;
     1619    14150    3           SELECT( 3752);  /* RMID */
     1620    14151    3               IF TXTC.LEN = 0 THEN
     1621    14152    3                   RETURN;
     1622    14153    3               TITLE.TXT = 'Reference ID: ';
     1623    14154    3               TITLE.LEN = 14;
     1624    14155    3               GOTO COMMON;
     1625    14156    3           SELECT( 3754);  /* FORUM */
     1626    14157    3               IF TXTC.LEN = 0 THEN
     1627    14158    3                   RETURN;
     1628    14159    3               TITLE.TXT = 'Transaction: ';
     1629    14160    3               TITLE.LEN = 13;
     1630    14161    3               GOTO COMMON;
     1631    14162    3           SELECT( 3900);  /* WHEN */
     1632    14163    3               IF TXTC.LEN = 0 THEN
     1633    14164    3                   RETURN;
     1634    14165    3               TITLE.TXT = 'Date: ';
     1635    14166    3               TITLE.LEN = 6;
     1636    14167    3   COMMON:
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:57   
     1637    14168    3               CALL CONCAT( LINEBUF, SUBSTR( TITLE.TXT, 0, TITLE.LEN));
     1638    14169    3               CALL INSERT( LINEBUF, TITLE.LEN, , TXTC.TXT);
     1639    14170    3               WRITE_DATA.BUF_.BOUND = TITLE.LEN + TXTC.LEN - 1;
     1640    14171    3           SELECT( 3910);  /* (ACK) */
     1641    14172    3               IF NOT ACKNOWLEDGE THEN
     1642    14173    3                   RETURN;
     1643    14174    3               CALL CONCAT( LINEBUF, 'RR:Yes');
     1644    14175    3               WRITE_DATA.BUF_.BOUND = 5;
     1645    14176    3           SELECT( 3000);  /* FROM */
     1646    14177    4               IF FROM.LEN = 0 THEN DO;
     1647    14178    4                   FROM.LEN = MAIL.LEN;
     1648    14179    4                   FROM.TXT = MAIL.TXT;
     1649    14180    4                   END;
     1650    14181    3               CALL DEL_TABS( FROM);
     1651    14182    3               CALL PARSE_FROM ALTRET( OOPS);
     1652    14183    3               TITLE.TXT = 'From: ';
     1653    14184    3               TITLE.LEN = 6;
     1654    14185    3               CALL CONCAT( LINEBUF, SUBSTR( TITLE.TXT, 0, TITLE.LEN));
     1655    14186    3               CALL INSERT( LINEBUF, TITLE.LEN, , SUBSTR( FTEXT.TXT, 0, FTEXT.LEN));
     1656    14187    3               WRITE_DATA.BUF_.BOUND = TITLE.LEN + FTEXT.LEN - 1;
     1657    14188    3           SELECT( 3200);  /* REPL */
     1658    14189    4               IF REPL.LEN = 0 THEN DO;
     1659    14190    5                   IF FROM.LEN > 0 THEN DO;
     1660    14191    5                       REPL.LEN = FROM.LEN;
     1661    14192    5                       REPL.TXT = FROM.TXT;
     1662    14193    5                       END;
     1663    14194    5                   ELSE DO;
     1664    14195    5                       REPL.LEN = MAIL.LEN;
     1665    14196    5                       REPL.TXT = MAIL.TXT;
     1666    14197    5                       END;
     1667    14198    4                   END;
     1668    14199    3               CALL DEL_TABS( REPL);
     1669    14200    3               CALL PARSE_REPLYTO ALTRET( OOPS);
     1670    14201    3               TITLE.TXT = 'Reply To: ';
     1671    14202    3               TITLE.LEN = 10;
     1672    14203    3               CALL CONCAT( LINEBUF, SUBSTR( TITLE.TXT, 0, TITLE.LEN));
     1673    14204    3               CALL INSERT( LINEBUF, TITLE.LEN, , SUBSTR( RTEXT.TXT, 0, RTEXT.LEN));
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:58   
     1674    14205    3               WRITE_DATA.BUF_.BOUND = TITLE.LEN + RTEXT.LEN - 1;
     1675    14206    3           END;
     1676    14207    2       DATA_KEY.KEY = KEYVAL;
     1677    14208    2       CALL M$WRITE( WRITE_DATA)
     1678    14209    3       WHENALTRETURN DO;
     1679    14210    3   OOPS:
     1680    14211    3           ALTRETURN;
     1681    14212    3           END;
     1682    14213    2       RETURN;
     1683    14214
     1684    14215    2   DEL_TABS: PROC( QTEXT);
     1685    14216
     1686    14217            %BUFFER( NAME=QTEXT, STCLASS=);
     1687    14222    3       DCL INDX SBIN;
     1688    14223    3       DCL LAST SBIN;
     1689    14224
     1690    14225    3       CALL INDEX( INDX, BITASC( '011'O), QTEXT.TXT);
     1691    14226    4       DO WHILE( INDX < QTEXT.LEN);
     1692    14227    4           SUBSTR( QTEXT.TXT, INDX, 1) = ' ';
     1693    14228    4           CALL INDEX( INDX, BITASC( '011'O), QTEXT.TXT);
     1694    14229    4           END;
     1695    14230            /* change embedded dquotes to query symbols */
     1696    14231    3       LAST = -1;
     1697    14232    3       CALL INDEX( INDX, '"', QTEXT.TXT);
     1698    14233    4       DO WHILE( INDX < QTEXT.LEN);
     1699    14234    4           IF LAST > -1 THEN
     1700    14235    4               SUBSTR( QTEXT.TXT, INDX, 1) = '?';
     1701    14236    4           LAST = INDX;
     1702    14237    4           CALL INDEX( INDX, '"', QTEXT.TXT, INDX+1);
     1703    14238    4           END;
     1704    14239    3       IF LAST > -1 THEN
     1705    14240    3           SUBSTR( QTEXT.TXT, LAST, 1) = '"';  /* restore last dquote */
     1706    14241    3       RETURN;
     1707    14242
     1708    14243    3       END DEL_TABS;
     1709    14244
     1710    14245    2       END WRITE_HEADER;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:59   
     1711    14246        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:60   
     1712    14247    1   PARSE_FROM: PROC ALTRET;
     1713    14248
     1714    14249    2       DCL TEMP SBIN;
     1715    14250    2       DCL I SBIN;
     1716    14251    2       DCL BASE SBIN;
     1717    14252    2       DCL BINGO SBIN;
     1718    14253    2       DCL ENTRYFLAG BIT(1);
     1719    14254        %EQU FROM = %NO#;
     1720    14255        %EQU REPLYTO = %YES#;
     1721    14256    2       DCL PARSEFLAG BIT(1);
     1722    14257        %EQU LEADING = %NO#;
     1723    14258        %EQU TRAILING = %YES#;
     1724    14259
     1725    14260    2       ENTRYFLAG = %FROM;
     1726    14261    2       TEMP = FROM.LEN;
     1727    14262    2       CALL XUR$GETCMD( TCM_TEXT_ROOT, CMD$, , FROM.TXT, TEMP) ALTRET( OOPS);
     1728    14263    2       GOTO COMMON;
     1729    14264
     1730    14265    2   PARSE_REPLYTO: ENTRY ALTRET;
     1731    14266
     1732    14267    2       ENTRYFLAG = %REPLYTO;
     1733    14268    2       TEMP = REPL.LEN;
     1734    14269    2       CALL XUR$GETCMD( TCM_TEXT_ROOT, CMD$, , REPL.TXT, TEMP) ALTRET( OOPS);
     1735    14270    2   COMMON:
     1736    14271    3       IF CMD.CODE = %TEXT THEN DO;
     1737    14272                /* the text was parsed as a list of words.. sigh.... */
     1738    14273    3           LTEXT.LEN = 0;
     1739    14274    3           TTEXT.LEN = 0;
     1740    14275    3           LTEXT.TXT = ' ';
     1741    14276    3           TTEXT.TXT = ' ';
     1742    14277    3           PARSEFLAG = %LEADING;
     1743    14278    3           BINGO = -1;
     1744    14279    3           BASE = -1;
     1745    14280    4           DO I = 0 TO CMD.NSUBLKS - 1;
     1746    14281    4               SYM$ = CMD.SUBLK$( I);
     1747    14282    5               IF PARSEFLAG = %LEADING THEN DO;
     1748    14283    5                   CALL INDEX( TEMP, '@', SYM.TEXT)
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:61   
     1749    14284    6                   WHENALTRETURN DO;
     1750    14285    6                       CALL INDEX( TEMP, '!', SYM.TEXT)
     1751    14286    7                       WHENALTRETURN DO;
     1752    14287    7                           IF BASE = -1 THEN
     1753    14288    7                               BASE = SYM.CPOS;
     1754    14289    7                           CALL INSERT( LTEXT.TXT, SYM.CPOS - BASE, SYM.COUNT, SYM.TEXT
             14289                                    );
     1755    14290    7                           LTEXT.LEN = SYM.CPOS - BASE + SYM.COUNT;
     1756    14291    7                           GOTO NEXT;
     1757    14292    7                           END;
     1758    14293    6                       END;
     1759    14294    5                   BINGO = I;  /* this SUBLK is holding an address */
     1760    14295    5                   PARSEFLAG = %TRAILING;
     1761    14296    5                   BASE = -1;
     1762    14297    5                   END;
     1763    14298    5               ELSE DO;
     1764    14299    5                   IF BASE = -1 THEN
     1765    14300    5                       BASE = SYM.CPOS;
     1766    14301    5                   CALL INSERT( TTEXT.TXT, SYM.CPOS - BASE, SYM.COUNT, SYM.TEXT);
     1767    14302    5                   TTEXT.LEN = SYM.CPOS - BASE + SYM.COUNT;
     1768    14303    5                   END;
     1769    14304    4   NEXT:
     1770    14305    4               END;
     1771    14306    3           IF ENTRYFLAG = %FROM OR
     1772    14307    4                   ( ENTRYFLAG = %REPLYTO AND BINGO = -1) THEN DO;
     1773    14308                    /* use trailing or leading human readable text if present */
     1774    14309    5               IF TTEXT.LEN ~= 0 THEN DO;
     1775    14310    5                   CALL TRIMTEXT( TTEXT, FTEXT);
     1776    14311    6                   IF FTEXT.LEN ~= 0 THEN DO;
     1777    14312    6                       CALL LEGALIZE( FTEXT);
     1778    14313    6                       RETURN;
     1779    14314    6                       END;
     1780    14315    5                   END;
     1781    14316    5               IF LTEXT.LEN ~= 0 THEN DO;
     1782    14317    5                   CALL TRIMTEXT( LTEXT, FTEXT);
     1783    14318    6                   IF FTEXT.LEN ~= 0 THEN DO;
     1784    14319    6                       CALL LEGALIZE( FTEXT);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:62   
     1785    14320    6                       RETURN;
     1786    14321    6                       END;
     1787    14322    5                   END;
     1788    14323    4               END;
     1789    14324    3           IF BINGO = -1 THEN
     1790    14325    3               GOTO OOPS;  /* couldn't find any text to use */
     1791    14326    3           SYM$ = CMD.SUBLK$( BINGO);
     1792    14327    3           TEMP = SYM.COUNT;
     1793    14328    3           CALL INSERT( ZTEXT.TXT, 0, TEMP, SYM.TEXT);
     1794    14329    3           ZTEXT.LEN = TEMP;
     1795    14330    3           CALL XUR$GETCMD( TCM_ADDR_ROOT, CMD$, , SYM.TEXT, TEMP) ALTRET( OOPS);
     1796    14331    3           END;
     1797    14332            /* at this point we have a parse tree for the address */
     1798    14333            /* now traverse the tree as appropriate to what we're looking for */
     1799    14334    2       OUT$ = CMD.SUBLK$(0);
     1800    14335    2       IF ENTRYFLAG = %REPLYTO THEN
     1801    14336    2           GOTO TRAVERSE_REPLYTO;
     1802    14337    2   TRAVERSE_FROM:
     1803    14338    3       DO CASE( OUT.CODE);
     1804    14339    3           CASE( %ADDRESS, %BPATH, %MAILBOX, %LOCAL, %DOMAIN);
     1805    14340    3               OUT$ = OUT.SUBLK$(0);  /* take the left-most arc */
     1806    14341    3           CASE( %PATH, %ROUTE);
     1807    14342    3               OUT$ = OUT.SUBLK$( OUT.NSUBLKS - 1);  /* take right-most arc */
     1808    14343    3           CASE( %NAME);
     1809    14344                    /* finally.. we found it */
     1810    14345    3               CALL INSERT( FTEXT.TXT, 0, SYM.COUNT, SYM.TEXT);
     1811    14346    3               FTEXT.LEN = SYM.COUNT;
     1812    14347    3               CALL LEGALIZE( FTEXT);
     1813    14348    3               RETURN;
     1814    14349    3           CASE( ELSE);
     1815    14350    3               GOTO OOPS;
     1816    14351    3           END;
     1817    14352    2       GOTO TRAVERSE_FROM;
     1818    14353    2   TRAVERSE_REPLYTO:
     1819    14354    3       DO CASE( OUT.CODE);
     1820    14355    3           CASE( %ADDRESS, %BPATH);
     1821    14356    3               OUT$ = OUT.SUBLK$(0);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:63   
     1822    14357    3           CASE( %PATH);
     1823    14358    3               OUT$ = OUT.SUBLK$( OUT.NSUBLKS - 1);
     1824    14359    3           CASE( %ROUTE, %MAILBOX);
     1825    14360                    /* stop parse here.. return remaining substring */
     1826    14361    4               IF OUT.CODE = %ROUTE THEN DO;
     1827    14362                        /* if ROUTE, have to find left-most limit */
     1828    14363    4                   TMP$ = OUT$;
     1829    14364    5                   DO WHILE( OUT.CODE ~= %NAME);
     1830    14365    5                       OUT$ = OUT.SUBLK$(0);
     1831    14366    5                       END;
     1832    14367    5                   IF SYM.COUNT = 0 THEN DO;
     1833    14368                            /* gag me with a zero-length name.. */
     1834    14369    5                       RTEXT = ZTEXT;
     1835    14370    5                       GOTO PUNT_REPLYTO;
     1836    14371    5                       END;
     1837    14372    4                   TEMP = SYM.CPOS;
     1838    14373    4                   OUT$ = TMP$;
     1839    14374    4                   END;
     1840    14375    3               ELSE
     1841    14376    3                   TEMP = SYM.CPOS;
     1842    14377    4               DO WHILE( OUT.CODE ~= %NAME);
     1843    14378    4                   OUT$ = OUT.SUBLK$( OUT.NSUBLKS - 1);
     1844    14379    4                   END;
     1845    14380    3               CALL INSERT( RTEXT.TXT, 0, SYM.CPOS+SYM.COUNT-TEMP,
     1846    14381    3                       SUBSTR( ZTEXT.TXT, TEMP, SYM.CPOS+SYM.COUNT-TEMP));
     1847    14382    3               RTEXT.LEN = SYM.CPOS + SYM.COUNT - TEMP;
     1848    14383    3   PUNT_REPLYTO:
     1849    14384    3               CALL CHECKADDR( RTEXT);
     1850    14385    3               CALL LEGALIZE( RTEXT);
     1851    14386    3               RETURN;
     1852    14387    3           CASE( ELSE);
     1853    14388    3               GOTO OOPS;
     1854    14389    3           END;
     1855    14390    2       GOTO TRAVERSE_REPLYTO;
     1856    14391    2   OOPS:
     1857    14392    2       ALTRETURN;
     1858    14393
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:64   
     1859    14394    2   LEGALIZE: PROC( QTEXT);
     1860    14395
     1861    14396            %BUFFER( NAME=QTEXT, STCLASS=);
     1862    14401
     1863    14402            /* turn mapped dquotes back into real dquotes */
     1864    14403    3       CALL INDEX( I, '?', QTEXT.TXT);
     1865    14404    4       DO WHILE( I < QTEXT.LEN);
     1866    14405    4           SUBSTR( QTEXT.TXT, I, 1) = '"';
     1867    14406    4           CALL INDEX( I, '?', QTEXT.TXT);
     1868    14407    4           END;
     1869    14408    3       IF ENTRYFLAG = %FROM THEN
     1870    14409                /* look for chars illegal in a From: field */
     1871    14410    3           CALL SEARCH( I, TEMP, TCM_ILLEGAL_FROM,
     1872    14411    3                   SUBSTR( QTEXT.TXT, 0, QTEXT.LEN)) ALTRET( DONE);
     1873    14412    3       ELSE
     1874    14413                /* look for chars illegal in a Reply-To: field */
     1875    14414    3           CALL SEARCH( I, TEMP, TCM_ILLEGAL_REPLYTO,
     1876    14415    3                   SUBSTR( QTEXT.TXT, 0, QTEXT.LEN)) ALTRET( DONE);
     1877    14416            /* an illegal character is present... have to enclose text in squotes */
     1878    14417    3       I = 0;  /* offset into source QTEXT */
     1879    14418    3       BASE = 1;  /* offset into destination ZTEXT */
     1880    14419            /* stash leading squote */
     1881    14420    3       CALL INSERT( ZTEXT.TXT, 0, 1, '''');
     1882    14421    3   LOOP:
     1883    14422    4       DO WHILE( I < QTEXT.LEN);
     1884    14423                /* look for embedded squote */
     1885    14424    4           CALL INDEX( TEMP, '''', SUBSTR( QTEXT.TXT, I, QTEXT.LEN - I))
     1886    14425    5           WHENALTRETURN DO;
     1887    14426                    /* not found, so copy remainder of source */
     1888    14427                    /* but first, look for rightmost @ to stuff squote before it */
     1889    14428                    /* ...but only if no ' ' in the text... */
     1890    14429    5               CALL INDEX( BINGO, ' ', SUBSTR( QTEXT.TXT, I, TEMP))
     1891    14430    6               WHENRETURN DO;
     1892    14431    6                   GOTO DOIT;
     1893    14432    6                   END;
     1894    14433    5               CALL INDEX1R( BINGO, '@', SUBSTR( QTEXT.TXT, I, TEMP))
     1895    14434    6               WHENRETURN DO;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:65   
     1896    14435                        /* copy remainder of source up to rightmost @ */
     1897    14436    6                   CALL INSERT( ZTEXT.TXT, BASE, BINGO, SUBSTR( QTEXT.TXT, I, BINGO));
     1898    14437    6                   BASE = BASE + BINGO;
     1899    14438    6                   I = I + BINGO;
     1900    14439                        /* stash trailing squote */
     1901    14440    6                   CALL INSERT( ZTEXT.TXT, BASE, 1, '''');
     1902    14441    6                   BASE = BASE + 1;
     1903    14442                        /* copy remainder of source after last @ (including the @) */
     1904    14443    6                   TEMP = TEMP - BINGO;
     1905    14444    6                   CALL INSERT( ZTEXT.TXT, BASE, TEMP, SUBSTR( QTEXT.TXT, I, TEMP));
     1906    14445    6                   BASE = BASE + TEMP;
     1907    14446    6                   GOTO MOVEIT;
     1908    14447    6                   END;
     1909    14448    6               WHENALTRETURN DO;
     1910    14449    6                   END;
     1911    14450    5   DOIT:
     1912    14451    5               CALL INSERT( ZTEXT.TXT, BASE, TEMP, SUBSTR( QTEXT.TXT, I, TEMP));
     1913    14452    5               BASE = BASE + TEMP;
     1914    14453    5               EXIT LOOP;
     1915    14454    5               END;
     1916    14455                /* found an embedded squote.. copy up to and including squote */
     1917    14456    4           CALL INSERT( ZTEXT.TXT, BASE, TEMP+1, SUBSTR( QTEXT.TXT, I, TEMP+1));
     1918    14457    4           BASE = BASE + TEMP + 1;
     1919    14458    4           I = I + TEMP + 1;
     1920    14459                /* double the squote in destination */
     1921    14460    4           CALL INSERT( ZTEXT.TXT, BASE, 1, '''');
     1922    14461    4           BASE = BASE + 1;
     1923    14462                /* and continue */
     1924    14463    4           END;
     1925    14464            /* stash trailing squote */
     1926    14465    3       CALL INSERT( ZTEXT.TXT, BASE, 1, '''');
     1927    14466    3       BASE = BASE + 1;
     1928    14467    3   MOVEIT:
     1929    14468            /* move new text back to original buffer */
     1930    14469    3       QTEXT.LEN = BASE;
     1931    14470    3       QTEXT.TXT = SUBSTR( ZTEXT.TXT, 0, QTEXT.LEN);
     1932    14471    3   DONE:
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:66   
     1933    14472    3       RETURN;
     1934    14473
     1935    14474    3       END LEGALIZE;
     1936    14475
     1937    14476    2       END PARSE_FROM;
     1938    14477        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:67   
     1939    14478    1   CHECKADDR: PROC( QTEXT);
     1940    14479
     1941    14480            %BUFFER( NAME=QTEXT, STCLASS=);
     1942    14485    2       DCL TEMP SBIN;
     1943    14486    2       DCL TMP2 SBIN;
     1944    14487    2       DCL I SBIN;
     1945    14488    2       DCL LEN SBIN;
     1946    14489    2       DCL TBUF CHAR(32);
     1947    14490
     1948    14491    2       CALL INDEX1R( TEMP, '.', SUBSTR( QTEXT.TXT, 0, QTEXT.LEN))
     1949    14492    3       WHENALTRETURN DO;
     1950    14493    3           CALL INDEX1R( TEMP, '@', SUBSTR( QTEXT.TXT, 0, QTEXT.LEN))
     1951    14494    4           WHENALTRETURN DO;
     1952    14495    4               TEMP = -1;
     1953    14496    4               END;
     1954    14497    3           END;
     1955    14498    2       CALL INDEX1R( TMP2, '!', SUBSTR( QTEXT.TXT, 0, QTEXT.LEN))
     1956    14499    3       WHENALTRETURN DO;
     1957    14500    3           TMP2 = -1;
     1958    14501    3           END;
     1959    14502    3       IF TEMP = -1 AND TMP2 = -1 THEN DO;
     1960    14503    3           ZTEXT = QTEXT;
     1961    14504    3           CALL FIXLOCAL( ZTEXT)
     1962    14505    4           WHENALTRETURN DO;
     1963    14506    4               END;
     1964    14507    3           CALL INDEX1R( TEMP, '@', SUBSTR( ZTEXT.TXT, 0, ZTEXT.LEN))
     1965    14508    4           WHENALTRETURN DO;
     1966    14509    4               CALL LOOKUP_ALIAS( ADDR( ZTEXT)) ALTRET( DONE);
     1967    14510    4               QTEXT = ZTEXT;
     1968    14511    4               END;
     1969    14512    3   DONE:
     1970    14513    3           RETURN;
     1971    14514    3           END;
     1972    14515    3       IF TEMP > TMP2 THEN DO;
     1973    14516                /* Reply-To: ends with a domain.  See if we know of it. */
     1974    14517    3           CALL XLATE( NODES_KEY.SITE, TCM_XLATE_TO_UC,
     1975    14518    3                   SUBSTR( QTEXT.TXT, TEMP + 1, QTEXT.LEN - TEMP - 1));
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:68   
     1976    14519    3           CALL M$PRECORD( POSITION_NODES)
     1977    14520    4           WHENALTRETURN DO;
     1978    14521                    /* Domain not known.  Add @gateway to end. */
     1979    14522    4               CALL INDEX1R( TEMP, '@', SUBSTR( QTEXT.TXT, 0, QTEXT.LEN))
     1980    14523    5               WHENRETURN DO;
     1981    14524    5                   SUBSTR( QTEXT.TXT, TEMP, 1) = '%';
     1982    14525    5                   END;
     1983    14526    5               WHENALTRETURN DO;
     1984    14527    5                   END;
     1985    14528    4               GOTO ADD_GATEWAY;
     1986    14529    4               END;
     1987    14530                /* Otherwise.. domain is known already. */
     1988    14531    3           RETURN;
     1989    14532    3           END;
     1990    14533    3       ELSE DO;
     1991    14534                /* This looks like a bang path.  Fall through. */
     1992    14535    3           END;
     1993    14536    2   ADD_GATEWAY:
     1994    14537    2       CALL CONCAT( ZTEXT.TXT, '@', SUBSTR( HELO.TXT, 0, HELO.LEN));
     1995    14538    2       ZTEXT.LEN = 1 + HELO.LEN;
     1996    14539    3       IF REWRITES > 0 THEN DO;
     1997    14540    3           CALL XLATE( TBUF, TCM_XLATE_TO_UC, SUBSTR( HELO.TXT, 0, HELO.LEN));
     1998    14541    3   ADDGATE_LOOP:
     1999    14542    4           DO I = 0 TO REWRITES - 1;
     2000    14543    5               IF REWRITE.TYP( I) = %ADDGATE_CMD THEN DO;
     2001    14544    5                   LEN = REWRITE.OLD.LEN( I);
     2002    14545    5                   IF SUBSTR( REWRITE.OLD.TXT( I), 0, LEN) =
     2003    14546    6                           SUBSTR( TBUF, 0, HELO.LEN) THEN DO;
     2004    14547    6                       ZTEXT.LEN = REWRITE.NEW.LEN( I);
     2005    14548    6                       ZTEXT.TXT = REWRITE.NEW.TXT( I);
     2006    14549    6                       EXIT ADDGATE_LOOP;
     2007    14550    6                       END;
     2008    14551    5                   END;
     2009    14552    4               END;
     2010    14553    3           END;
     2011    14554    2       CALL INSERT( QTEXT.TXT, QTEXT.LEN, ZTEXT.LEN,
     2012    14555    2               SUBSTR( ZTEXT.TXT, 0, ZTEXT.LEN));
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:69   
     2013    14556    2       QTEXT.LEN = QTEXT.LEN + ZTEXT.LEN;
     2014    14557    2       RETURN;
     2015    14558
     2016    14559    2       END CHECKADDR;
     2017    14560        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:70   
     2018    14561    1   TRIMTEXT: PROC( SOURCE, TARGET);
     2019    14562
     2020    14563            %BUFFER( NAME=SOURCE, STCLASS=);
     2021    14568            %BUFFER( NAME=TARGET, STCLASS=);
     2022    14573            %BUFFER( NAME=QTEXT);
     2023    14578
     2024    14579    2       DCL I SBIN;
     2025    14580    2       DCL J SBIN;
     2026    14581    2       DCL CHANGED BIT(1);
     2027    14582
     2028    14583    2       QTEXT = SOURCE;
     2029    14584    2       TARGET = SOURCE;
     2030    14585    2   TRIM_AGAIN:
     2031    14586    3       IF SUBSTR( QTEXT.TXT, 0, QTEXT.LEN) = ' ' THEN DO;
     2032    14587    3           TARGET.LEN = 1;
     2033    14588    3           TARGET.TXT = ' ';
     2034    14589    3           RETURN;
     2035    14590    3           END;
     2036    14591    2       CHANGED = %NO#;
     2037    14592    2       I = 0;
     2038    14593    3       DO WHILE( SUBSTR( QTEXT.TXT, I, 1) = ' ');
     2039    14594    3           I = I + 1;
     2040    14595    3           CHANGED = %YES#;
     2041    14596    3           END;
     2042    14597    2       J = QTEXT.LEN - 1;
     2043    14598    3       DO WHILE( SUBSTR( QTEXT.TXT, J, 1) = ' ');
     2044    14599    3           J = J - 1;
     2045    14600    3           CHANGED = %YES#;
     2046    14601    3           END;
     2047    14602    3       IF CHANGED THEN DO;
     2048    14603    3           CALL INSERT( TARGET.TXT, 0, 1+J-I, SUBSTR( QTEXT.TXT, I, 1+J-I));
     2049    14604    3           TARGET.LEN = 1 + J - I;
     2050    14605    3           QTEXT = TARGET;
     2051    14606    3           END;
     2052    14607    2       J = QTEXT.LEN - 1;
     2053    14608    2       IF J > 1 AND SUBSTR( QTEXT.TXT, 0, 1) = '(' AND
     2054    14609    3               SUBSTR( QTEXT.TXT, J, 1) = ')' THEN DO;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:71   
     2055    14610    3           CALL INSERT( TARGET.TXT, 0, J-1, SUBSTR( QTEXT.TXT, 1, J-1));
     2056    14611    3           TARGET.LEN = J - 1;
     2057    14612    3           QTEXT = TARGET;
     2058    14613    3           CHANGED = %YES#;
     2059    14614    3           END;
     2060    14615    2       J = QTEXT.LEN - 1;
     2061    14616    2       IF J > 1 AND SUBSTR( QTEXT.TXT, 0, 1) = '<' AND
     2062    14617    3               SUBSTR( QTEXT.TXT, J, 1) = '>' THEN DO;
     2063    14618    3           CALL INSERT( TARGET.TXT, 0, J-1, SUBSTR( QTEXT.TXT, 1, J-1));
     2064    14619    3           TARGET.LEN = J - 1;
     2065    14620    3           QTEXT = TARGET;
     2066    14621    3           CHANGED = %YES#;
     2067    14622    3           END;
     2068    14623    2       J = QTEXT.LEN - 1;
     2069    14624    2       IF J > 1 AND SUBSTR( QTEXT.TXT, 0, 1) = '"' AND
     2070    14625    3               SUBSTR( QTEXT.TXT, J, 1) = '"' THEN DO;
     2071    14626    3           CALL INSERT( TARGET.TXT, 0, J-1, SUBSTR( QTEXT.TXT, 1, J-1));
     2072    14627    3           TARGET.LEN = J - 1;
     2073    14628    3           QTEXT = TARGET;
     2074    14629    3           CHANGED = %YES#;
     2075    14630    3           END;
     2076    14631    2       IF CHANGED THEN
     2077    14632    2           GOTO TRIM_AGAIN;
     2078    14633    2       RETURN;  /* TARGET contains the trimmed text */
     2079    14634
     2080    14635    2       END TRIMTEXT;
     2081    14636        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:72   
     2082    14637    1   FIXLOCAL: PROC( TEXT) ALTRET;
     2083    14638
     2084    14639            %BUFFER( NAME=TEXT, STCLASS=);
     2085    14644    2       DCL TEMP SBIN;
     2086    14645    2       DCL TMP2 SBIN;
     2087    14646    2       DCL DIFF SBIN;
     2088    14647    2       DCL I SBIN;
     2089    14648    2       DCL LEN SBIN;
     2090    14649    2       DCL TBUF CHAR(32);
     2091    14650
     2092    14651    2   BEGINNING:
     2093    14652    2       CALL INDEX1R( TEMP, '@', SUBSTR( TEXT.TXT, 0, TEXT.LEN))
     2094    14653    3       WHENALTRETURN DO;
     2095    14654    3           RETURN;
     2096    14655    3           END;
     2097    14656    2       CALL INDEX1R( TMP2, '%', SUBSTR( TEXT.TXT, 0, TEMP))
     2098    14657    3       WHENALTRETURN DO;
     2099    14658    3           TMP2 = -1;
     2100    14659    3           END;
     2101    14660    2       DIFF = TEXT.LEN - TEMP;
     2102    14661    3       IF REWRITES > 0 THEN DO;
     2103    14662    3           CALL XLATE( TBUF, TCM_XLATE_TO_UC, SUBSTR( TEXT.TXT, TEMP, DIFF));
     2104    14663    3   DELSITE_LOOP:
     2105    14664    4           DO I = 0 TO REWRITES - 1;
     2106    14665    5               IF REWRITE.TYP( I) = %DELSITE_CMD THEN DO;
     2107    14666    5                   LEN = REWRITE.OLD.LEN( I);
     2108    14667    5                   IF SUBSTR( REWRITE.OLD.TXT( I), 0, LEN) =
     2109    14668    6                           SUBSTR( TBUF, 0, DIFF) THEN DO;
     2110    14669    6                       IF TMP2 ~= -1 THEN
     2111    14670    6                           SUBSTR( TEXT.TXT, TMP2, 1) = '@';
     2112    14671    6                       TEXT.LEN = TEMP;
     2113    14672    6                       GOTO BEGINNING;
     2114    14673    6                       END;
     2115    14674    5                   END;
     2116    14675    4               END;
     2117    14676    3           END;
     2118    14677    2       ALTRETURN;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:73   
     2119    14678
     2120    14679    2       END FIXLOCAL;
     2121    14680        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:74   
     2122    14681    1   LOOKUP_ALIAS: PROC( ADDRESS$) ALTRET;
     2123    14682
     2124    14683    2       DCL ADDRESS$ PTR;
     2125    14684    2       DCL DASH_INDEX UBIN WORD;
     2126    14685    2       DCL DOT_INDEX UBIN WORD;
     2127    14686    2       DCL MATCHLEN UBIN WORD;
     2128    14687    2       DCL MATCHSTRING CHAR( %USER_SIZE);
     2129    14688    2       DCL PCT_INDEX UBIN WORD;
     2130    14689    2       DCL SIZE UBIN;
     2131    14690    2       DCL TEMPBUF CHAR( %USER_SIZE);
     2132    14691    2       DCL TEMPCHAR( 0:%( USER_SIZE-1)) REDEF TEMPBUF UBIN BYTE CALIGNED;
     2133    14692    2       DCL TRIMMEDSIZE UBIN;
     2134    14693    2       DCL TSLEN UBIN WORD;
     2135    14694    2       DCL TSTRING CHAR( %USER_SIZE);
     2136    14695    2       DCL TVAL UBIN WORD;
     2137    14696    2       DCL USEFUL_LENGTH UBIN;
     2138    14697    2       DCL 1 USER,
     2139    14698    2            2 C UBIN BYTE CALIGNED,
     2140    14699    2            2 T CHAR( 511);
     2141    14700    2       DCL USER$ PTR;
     2142    14701
     2143    14702    2       USER$ = ADDR( USER);
     2144    14703    2       REPLY$ = R550$;
     2145    14704    3       IF TCM_DRIBBLE OR TCM_DRIBBLE_ME THEN DO;
     2146    14705    3           CALL CONCAT( OCMSG, '-->',
     2147    14706    3                   SUBSTR( ADDRESS$->TEXTC.T, 0, ADDRESS$->TEXTC.L),
     2148    14707    3                   '<--');
     2149    14708    3           WRITE_DRIBBLE.BUF_ = VECTOR(
     2150    14709    3                   SUBSTR( OCMSG, 0, 6 + ADDRESS$->TEXTC.L));
     2151    14710    3           CALL M$WRITE( WRITE_DRIBBLE);
     2152    14711    3           END;
     2153    14712    2       CALL MOVE_STRING( ADDRESS$, USER$, 511) ALTRET( GOTO_ALTRET);
     2154    14713            /* The mailbox ID may contains a sub-site specification <name%site@...,
     2155    14714            or name%site.CP6@...>.  The specified "site" must be in the :NODES file.
     2156    14715            If it is, convert the address format to suit MAIL;  if not, complain. */
     2157    14716    2       CALL INDEX1R( PCT_INDEX, '%', ADDRESS$->TEXTC.T) ALTRET( THIS_SITE);
     2158    14717    2       CALL INDEX( DOT_INDEX, '.', ADDRESS$->TEXTC.T, PCT_INDEX)
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:75   
     2159    14718    3       WHENRETURN DO;
     2160    14719    3           IF SUBSTR( ADDRESS$->TEXTC.T, DOT_INDEX+1) ~= 'CP6' AND
     2161    14720    4                   SUBSTR( ADDRESS$->TEXTC.T, DOT_INDEX + 1) ~= 'cp6' THEN DO;
     2162    14721    4               REPLY$ = R550NODOMAIN$;
     2163    14722    4               ALTRETURN;
     2164    14723    4               END;
     2165    14724    3           ADDRESS$->TEXTC.L = DOT_INDEX;
     2166    14725    3           END;
     2167    14726    3       IF NOT NODES_FILE_OPEN THEN DO;
     2168    14727    3           REPLY$ = R550NONODE$;
     2169    14728    3           ALTRETURN;
     2170    14729    3           END;
     2171    14730    2       CALL XLATE( NODES_KEY.SITE, TCM_XLATE_TO_UC,
     2172    14731    2               SUBSTR( ADDRESS$->TEXTC.T, PCT_INDEX + 1,
     2173    14732    2               DOT_INDEX - PCT_INDEX - 1));
     2174    14733    3       IF NODES_KEY.SITE ~= MY_SITE_NAME THEN DO;
     2175    14734    3           CALL M$PRECORD( POSITION_NODES)
     2176    14735    4           WHENALTRETURN DO;
     2177    14736    4               REPLY$ = R550NOSITE$;
     2178    14737    4               ALTRETURN;
     2179    14738    4               END;
     2180    14739    3           END;
     2181    14740    2       CALL SETUP_REPLY_250V;
     2182    14741    2       RETURN;
     2183    14742    2   THIS_SITE:
     2184    14743    2       IF SUBSTR( USER$->TEXTC.T, 0, 1) = '.' THEN
     2185    14744    2           SUPPRESS_HEADERS = %NO#;
     2186    14745    2       ELSE
     2187    14746    2           CALL LOOKUP_REGISTRATION( USER$, USEFUL_LENGTH) ALTRET( TRY_UNLINEING);
     2188    14747    2       CALL SETUP_REPLY_250V;
     2189    14748    2       RETURN;
     2190    14749    2   TRY_UNLINEING:
     2191    14750            /* Turn underlines in mailbox ID into blanks; try again. */
     2192    14751    2       CALL INDEX( DASH_INDEX, '_', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));
     2193    14752    3       DO WHILE( DASH_INDEX < USEFUL_LENGTH);
     2194    14753    3           SUBSTR( USER$->TEXTC.T, DASH_INDEX, 1) = ' ';
     2195    14754    3           CALL INDEX( DASH_INDEX, '_', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:76   
     2196    14755    3           END;
     2197    14756    2       CALL LOOKUP_REGISTRATION( USER$, USEFUL_LENGTH) ALTRET( TRY_UNDOTTING);
     2198    14757    2   FOUNDEM:
     2199    14758    2       CALL SETUP_REPLY_250V;
     2200    14759    2       ADDRESS$->TEXTC.T = USER$->TEXTC.T;
     2201    14760    2       RETURN;
     2202    14761    2   TRY_UNDOTTING:
     2203    14762            /* Turn dots in mailbox ID into blanks; try again. */
     2204    14763    2       CALL INDEX( DASH_INDEX, '.', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));
     2205    14764    3       DO WHILE( DASH_INDEX < USEFUL_LENGTH);
     2206    14765    3           SUBSTR( USER$->TEXTC.T, DASH_INDEX, 1) = ' ';
     2207    14766    3           CALL INDEX( DASH_INDEX, '.', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));
     2208    14767    3           END;
     2209    14768    2       CALL LOOKUP_REGISTRATION( USER$, USEFUL_LENGTH) ALTRET( TRY_UNDASHING);
     2210    14769    2       GOTO FOUNDEM;
     2211    14770    2   TRY_UNDASHING:
     2212    14771            /* Turn dashes in mailbox ID into blanks; try again. */
     2213    14772    2       CALL INDEX( DASH_INDEX, '-', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));
     2214    14773    3       DO WHILE( DASH_INDEX < USEFUL_LENGTH);
     2215    14774    3           SUBSTR( USER$->TEXTC.T, DASH_INDEX, 1) = ' ';
     2216    14775    3           CALL INDEX( DASH_INDEX, '-', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));
     2217    14776    3           END;
     2218    14777    2       CALL LOOKUP_REGISTRATION( USER$, USEFUL_LENGTH) ALTRET( NOT_REGISTERED);
     2219    14778    2       GOTO FOUNDEM;
     2220    14779    2   NOT_REGISTERED:
     2221    14780    2       IF REPLY$ ~= R550$ THEN
     2222    14781    2           ALTRETURN;
     2223    14782            /* User is not registered under the specified name.  Convert the name to
     2224    14783            upper case, and scan through the alias file looking for any registered
     2225    14784            user or list of users whose name resembles( contains) the name given to
     2226    14785            us by SMTP. If only one match occurs, return the identity of that user;
     2227    14786            if no match, respond "Unknown";  if more than one, respond "Ambiguous". */
     2228    14787    2       CALL XLATE( TSTRING, TCM_XLATE_TO_UC, USER.T);
     2229    14788    2       USER.T = TSTRING;
     2230    14789    2       POSITION_ALIAS.V.KEYS# = %YES#;
     2231    14790    2       POSITION_ALIAS.V.KEYR# = %YES#;
     2232    14791    2       POSITION_ALIAS.KEY_ = VECTOR( VM_SEARCHKEY);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:77   
     2233    14792    2       VM_SEARCHKEY.COUNT = 1;
     2234    14793    2       VM_SEARCHKEY.TYPE = %VM_TYPE_LIST;
     2235    14794    2       CALL M$PRECORD( POSITION_ALIAS)
     2236    14795    3       WHENALTRETURN DO;
     2237    14796    3           END;
     2238    14797    2       POSITION_ALIAS.V.N# = 1;
     2239    14798    2       POSITION_ALIAS.V.KEYS# = %NO#;
     2240    14799    2       MATCHLEN = 0;
     2241    14800    3       DO WHILE( VM_SEARCHKEY.COUNT ~= 0);
     2242    14801    3           TSLEN = VM_SEARCHKEY.COUNT - 1;
     2243    14802    3           TSTRING = SUBSTR( VM_SEARCHKEY.TEXT, 0, TSLEN);
     2244    14803    3           CALL INDEX( TVAL, SUBSTR( USER.T, 0, USEFUL_LENGTH), TSTRING)
     2245    14804    4           WHENRETURN DO;
     2246    14805    5               IF MATCHLEN > 0 THEN DO;
     2247    14806    5                   REPLY$ = R553$;
     2248    14807    5                   ALTRETURN;
     2249    14808    5                   END;
     2250    14809    4               MATCHLEN = TSLEN;
     2251    14810    4               MATCHSTRING = TSTRING;
     2252    14811    4               END;
     2253    14812    3           CALL M$PRECORD( POSITION_ALIAS)
     2254    14813    4           WHENALTRETURN DO;
     2255    14814    4               END;
     2256    14815    3           END;
     2257    14816    3       IF MATCHLEN > 0 THEN DO;
     2258    14817                /* Found a single user whose real name matches the info supplied by
     2259    14818                the sender.  Respond with the user's full name and mailbox ID, and
     2260    14819                clear the flag which would have suppressed SMTP headers.        */
     2261    14820    3           SUPPRESS_HEADERS = %NO#;
     2262    14821    3           CALL CONCAT( TSTRING, SUBSTR( MATCHSTRING, 0, MATCHLEN),
     2263    14822    3                   SUBSTR( USER.T, USEFUL_LENGTH, USER.C - USEFUL_LENGTH));
     2264    14823    3           TSLEN = MATCHLEN + USER.C - USEFUL_LENGTH;
     2265    14824    3           ADDRESS$->TEXTC.L = TSLEN;
     2266    14825    3           ADDRESS$->TEXTC.T = TSTRING;
     2267    14826    3           CALL INSERT( REPLY250V.TEXT, 4, ,
     2268    14827    3                   SUBSTR( MATCHSTRING, 0, MATCHLEN), ' <',
     2269    14828    3                   ADDRESS$->TEXTC.T, '@',
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:78   
     2270    14829    3                   SUBSTR( MY_SITE_NAME, 0, MY_SITE_NAME_L), '>');
     2271    14830    3           CALL SEARCHR( TSLEN, TVAL, TCM_SKIP_BLANKS, REPLY250V.TEXT);
     2272    14831    3           REPLY250V.COUNT = TSLEN + 1;
     2273    14832    3           REPLY$ = R250V$;
     2274    14833    3           RETURN;
     2275    14834    3           END;
     2276    14835    2   GOTO_ALTRET:
     2277    14836    2       ALTRETURN;
     2278    14837
     2279    14838    2   SETUP_REPLY_250V: PROC;
     2280    14839
     2281    14840    3       CALL CONCAT( REPLY250V.TEXT, '250 ', USER$->TEXTC.T,
     2282    14841    3               ' <', ADDRESS$->TEXTC.T);
     2283    14842    3       CALL SEARCHR( TSLEN, TVAL, TCM_SKIP_BLANKS, REPLY250V.TEXT);
     2284    14843    3       CALL INSERT( REPLY250V.TEXT, TSLEN+1, , '@');
     2285    14844    3       CALL INSERT( REPLY250V.TEXT, TSLEN+2, ,
     2286    14845    3               SUBSTR( MY_SITE_NAME, 0, MY_SITE_NAME_L), '>');
     2287    14846    3       CALL SEARCHR( TSLEN, TVAL, TCM_SKIP_BLANKS, REPLY250V.TEXT);
     2288    14847    3       REPLY250V.COUNT = TSLEN + 1;
     2289    14848    3       REPLY$ = R250V$;
     2290    14849    3       RETURN;
     2291    14850
     2292    14851    3       END SETUP_REPLY_250V;
     2293    14852
     2294    14853    2       END LOOKUP_ALIAS;
     2295    14854        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:79   
     2296    14855    1   LOOKUP_REGISTRATION: PROC( USER$, USEFUL_SIZE) ALTRET;
     2297    14856
     2298    14857    2       DCL SIZE UBIN;
     2299    14858    2       DCL TEMPBUF CHAR( %USER_SIZE);
     2300    14859    2       DCL TEMPCHAR( 0:%( USER_SIZE-1)) REDEF TEMPBUF UBIN BYTE CALIGNED;
     2301    14860    2       DCL TRIMMEDSIZE UBIN;
     2302    14861    2       DCL USEFUL_SIZE UBIN;
     2303    14862    2       DCL USER$ PTR;
     2304    14863
     2305    14864            /* Figure out how long the useful part of the name (minus any folder
     2306    14865            specification) actually is. */
     2307    14866    2       CALL INDEX( USEFUL_SIZE, '/', USER$->TEXTC.T)
     2308    14867    3       WHENRETURN DO;
     2309    14868    4           DO WHILE USEFUL_SIZE > 0;
     2310    14869    4               IF SUBSTR( USER$->TEXTC.T, USEFUL_SIZE - 1, 1) = ' ' THEN
     2311    14870    4                   USEFUL_SIZE = USEFUL_SIZE - 1;
     2312    14871    4               ELSE
     2313    14872    4                   EXIT;
     2314    14873    4               END;
     2315    14874    3           IF USEFUL_SIZE = 0 THEN
     2316    14875    3                 ALTRETURN; /* folder names must follow a person's name */
     2317    14876    3           END;
     2318    14877    3       WHENALTRETURN DO;
     2319    14878    3           USEFUL_SIZE = USER$->TEXTC.L;
     2320    14879    3           END;
     2321    14880            /* Translate name to upper-case-only, compress multiple
     2322    14881            blanks for alias/list lookup */
     2323    14882    2       TRIMMEDSIZE = 0;
     2324    14883    3       DO SIZE = 0 TO USEFUL_SIZE - 1;
     2325    14884    3           CALL XLATE( SUBSTR( TEMPBUF, TRIMMEDSIZE, 1), TCM_XLATE_TO_UC,
     2326    14885    3                   SUBSTR( USER$->TEXTC.T, SIZE, 1));
     2327    14886    3           IF TRIMMEDSIZE = 0 THEN
     2328    14887    3               TRIMMEDSIZE = 1;
     2329    14888    3           ELSE
     2330    14889    3               IF SUBSTR( TEMPBUF, TRIMMEDSIZE, 1) ~= ' ' OR
     2331    14890    3                       SUBSTR( TEMPBUF, TRIMMEDSIZE - 1, 1) ~= ' ' THEN
     2332    14891    3                   TRIMMEDSIZE = TRIMMEDSIZE + 1;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:80   
     2333    14892    3           END;
     2334    14893    2       POSITION_ALIAS.V.N# = 0;
     2335    14894    2       POSITION_ALIAS.V.KEYS# = %YES#;
     2336    14895    2       POSITION_ALIAS.V.KEYR# = %NO#;
     2337    14896    2       POSITION_ALIAS.KEY_ = VECTOR( VM_USERKEY);
     2338    14897    2       VM_USERKEY.COUNT = TRIMMEDSIZE + LENGTHC( VM_USERKEY.TYPE);
     2339    14898    2       VM_USERKEY.TEXT = TEMPBUF;
     2340    14899    2       CALL M$PRECORD( POSITION_ALIAS)
     2341    14900    3       WHENRETURN DO;
     2342    14901                /* Specified recipient is a user.  Reset the flag which
     2343    14902                   would cause us to suppress the SMTP headers. */
     2344    14903    3           SUPPRESS_HEADERS = %NO#;
     2345    14904    3           RETURN;
     2346    14905    3           END;
     2347    14906    2       POSITION_ALIAS.KEY_ = VECTOR( VM_LISTKEY);
     2348    14907    2       VM_LISTKEY.COUNT = TRIMMEDSIZE + LENGTHC( VM_LISTKEY.TYPE);
     2349    14908    2       VM_LISTKEY.TEXT = TEMPBUF;
     2350    14909    2       CALL M$PRECORD( POSITION_ALIAS)
     2351    14910    3       WHENRETURN DO;
     2352    14911                /* Specified recipient is a list.  All is well. */
     2353    14912    3           RETURN;
     2354    14913    3           END;
     2355    14914            /* Specified recipient is unknown. */
     2356    14915    2       ALTRETURN;
     2357    14916
     2358    14917    2       END LOOKUP_REGISTRATION;
     2359    14918        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:81   
     2360    14919    1   SPILL_ALIASES: PROC;
     2361    14920
     2362    14921    2       DCL CHR CHAR(1);
     2363    14922    2       DCL DONE BIT(1);
     2364    14923    2       DCL INTERESTING BIT(1);
     2365    14924    2       DCL WRITING BIT(1);
     2366    14925            %BUFFER( NAME=SCRATCH, STCLASS=AUTO);
     2367    14930
     2368    14931    2       DONE = %NO#;
     2369    14932    2       WRITING = %NO#;
     2370    14933    2       CALL M$PFIL( REWIND_ALIAS);
     2371    14934    2       POSITION_ALIAS.V.N# = 0;
     2372    14935    2       POSITION_ALIAS.V.KEYS# = %NO#;
     2373    14936    2       POSITION_ALIAS.V.KEYR# = %YES#;
     2374    14937    2       POSITION_ALIAS.KEY_ = VECTOR( ZTEXT);
     2375    14938    2       CALL INSERT( SCRATCH.TXT, 0, 4, '250-');
     2376    14939    2       REPLY$ = ADDR( SCRATCH);
     2377    14940    3       DO WHILE( %YES#);
     2378    14941    3           CALL M$PRECORD( POSITION_ALIAS);
     2379    14942    3           CHR = SUBSTR( ZTEXT.TXT, 0, 1);
     2380    14943    3           INTERESTING = %NO#;
     2381    14944    3           IF ASCBIN( CHR) = %VM_TYPE_LIST OR
     2382    14945    3                   ASCBIN( CHR) = %VM_TYPE_USER THEN
     2383    14946    3               INTERESTING = %YES#;
     2384    14947    4           IF ZTEXT.LEN = 0 OR ( WRITING AND NOT INTERESTING) THEN DO;
     2385    14948    4               CALL INSERT( SCRATCH.TXT, 3, 1, ' ');
     2386    14949    4               DONE = %YES#;
     2387    14950    4               END;
     2388    14951    3           IF WRITING THEN
     2389    14952    3               CALL WRITE_REPLY;
     2390    14953    3           IF DONE THEN
     2391    14954    3               EXIT;
     2392    14955    3           POSITION_ALIAS.V.N# = 1;
     2393    14956    4           IF INTERESTING THEN DO;
     2394    14957    4               WRITING = %YES#;
     2395    14958    4               CALL INSERT( SCRATCH.TXT, 4, ZTEXT.LEN - 1,
     2396    14959    4                       SUBSTR( ZTEXT.TXT, 1, ZTEXT.LEN - 1));
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:82   
     2397    14960    4               SCRATCH.LEN = ZTEXT.LEN + 3;
     2398    14961    4               END;
     2399    14962    3           ELSE
     2400    14963    3               WRITING = %NO#;
     2401    14964    3           END;
     2402    14965    2       REPLY$ = ADDR( NIL);
     2403    14966    2       RETURN;
     2404    14967
     2405    14968    2       END SPILL_ALIASES;
     2406    14969        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:83   
     2407    14970    1   READ_TRANSPARENT: PROC ALTRET;
     2408    14971
     2409    14972    2       DCL I UBIN;
     2410    14973
     2411    14974    2       IF TCM_TCPFLAVOR THEN
     2412    14975    2           CALL TCM$LTCP_READ( VECTOR( LINEBUF), 60, , , LINESIZE, , )
     2413    14976    2                   ALTRET( READ_ERROR);
     2414    14977    3       ELSE DO;
     2415    14978    3           CALL M$READ( READ_UC) ALTRET( READ_ERROR);
     2416    14979    3           LINESIZE = DCBADDR( DCBNUM( M$UC))->F$DCB.ARS#;
     2417    14980    3           END;
     2418    14981    3       IF TCM_DRIBBLE OR TCM_DRIBBLE_ME THEN DO;
     2419    14982    3           IF LINESIZE = 0 THEN
     2420    14983    3               WRITE_DRIBBLE.BUF_ = VECTOR( NIL);
     2421    14984    4           ELSE DO;
     2422    14985    4               WRITE_DRIBBLE.BUF_ = VECTOR( LINEBUF);
     2423    14986    4               WRITE_DRIBBLE.BUF_.BOUND = LINESIZE - 1;
     2424    14987    4               END;
     2425    14988    3           CALL M$WRITE( WRITE_DRIBBLE);
     2426    14989    3           END;
     2427    14990    2       IF LINESIZE = 0 THEN
     2428    14991    2           ALTRETURN;
     2429    14992    3       DO I = 0 TO LINESIZE - 1;
     2430    14993    3           LINECHAR( I) = LINECHAR( I) & '177'O;
     2431    14994    4           IF CMD_CODE = 0 AND LINECHAR( I) = ASCBIT( '\') THEN DO;
     2432    14995    4               I = I + 1;
     2433    14996    4               LINECHAR( I) = LINECHAR( I) | '600'O;
     2434    14997    4               END;
     2435    14998    3           END;
     2436    14999    3       DO WHILE LINECHAR( LINESIZE - 1) = '012'O/*LF*/;
     2437    15000    3           LINESIZE = LINESIZE - 1;
     2438    15001    3           END;
     2439    15002    3       DO WHILE LINECHAR( LINESIZE - 1) = '015'O/*CR*/;
     2440    15003    3           LINESIZE = LINESIZE - 1;
     2441    15004    3           END;
     2442    15005    2       IF LINESIZE = 0 OR LINEBUF = ' ' THEN
     2443    15006    2           ALTRETURN;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:84   
     2444    15007    2       ELSE
     2445    15008    2           RETURN;
     2446    15009    2   READ_ERROR:
     2447    15010    2       IF TCM_TCPFLAVOR THEN
     2448    15011    2           TIMED_OUT = %YES#;
     2449    15012    2       ELSE
     2450    15013    2           IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$TIMO THEN
     2451    15014    2               TIMED_OUT = %YES#;
     2452    15015    2           ELSE
     2453    15016    2               DATA_LOST = %YES#;
     2454    15017    2       LINESIZE = 0;
     2455    15018    2       ALTRETURN;
     2456    15019
     2457    15020    2       END READ_TRANSPARENT;
     2458    15021        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:85   
     2459    15022        /********** PROCEDURE TO MOVE A TEXTC STRING,
     2460    15023        STRIPPING BACKSLASHES AND( COMMENTS) AND "QUOTES"
     2461    15024        */
     2462    15025    1   MOVE_STRING: PROC( FROM$, TO$, LEN) ALTRET;
     2463    15026
     2464    15027    2       DCL COUNT UBIN;
     2465    15028    2       DCL FROM$ PTR;
     2466    15029    2       DCL LEN UBIN;
     2467    15030    2       DCL LENGTH UBIN;
     2468    15031    2       DCL START UBIN;
     2469    15032    2       DCL TO$ PTR;
     2470    15033    2       DCL SCRUNCH BIT(1) UNAL;
     2471    15034
     2472    15035    3       IF FROM$->TEXTC.L > LEN THEN DO;
     2473    15036    3           REPLY$ = R552$;
     2474    15037    3           ALTRETURN;
     2475    15038    3           END;
     2476    15039    2       GOTO CONTINUE;
     2477    15040
     2478    15041    2   MOVE_HDR: ENTRY( FROM$, TO$, LEN) ALTRET;
     2479    15042
     2480    15043    2       IF FROM$->TEXTC.L > LEN THEN
     2481    15044    2           FROM$->TEXTC.L = LEN;
     2482    15045    2   CONTINUE:
     2483    15046    3       IF FROM$->TEXTC.L = 0 THEN DO;
     2484    15047    3           TO$->TEXTC.L = 0;
     2485    15048    3           RETURN;
     2486    15049    3           END;
     2487    15050    2       COUNT = 0;
     2488    15051    2       START = 0;
     2489    15052    2       SCRUNCH = '0'B;
     2490    15053    2       IF SUBSTR( FROM$->TEXTC.T, 0, 1) = '"'
     2491    15054    3               AND SUBSTR( FROM$->TEXTC.T, FROM$->TEXTC.L-1, 1) = '"' THEN DO;
     2492    15055    3           START = 1;
     2493    15056    3           FROM$->TEXTC.L = FROM$->TEXTC.L - 2;
     2494    15057    3           SCRUNCH = '1'B;
     2495    15058    3           END;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:86   
     2496    15059    2       CALL INDEX( LENGTH, '\', FROM$->TEXTC.T, START);
     2497    15060    3       DO WHILE( LENGTH < FROM$->TEXTC.L - 1);
     2498    15061    3           LENGTH = LENGTH - START;
     2499    15062    3           SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =
     2500    15063    3                   SUBSTR( FROM$->TEXTC.T, START, LENGTH);
     2501    15064    3           COUNT = COUNT + LENGTH + 1;
     2502    15065    3           START = START + LENGTH + 2;
     2503    15066    3           TO$->TEXT_CHAR( COUNT) =
     2504    15067    3                   BITASC( ASCBIT( FROM$->TEXT_CHAR( START)) & '177'O);
     2505    15068    3           CALL INDEX( LENGTH, '\', FROM$->TEXTC.T, START);
     2506    15069    3           END;
     2507    15070    2       LENGTH = LENGTH - START;
     2508    15071    2       SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =
     2509    15072    2               SUBSTR( FROM$->TEXTC.T, START, LENGTH);
     2510    15073    2       TO$->TEXTC.L = COUNT + LENGTH;
     2511    15074    2       CALL INDEX( LENGTH, '(', TO$->TEXTC.T) ALTRET( NO_COMMENT);
     2512    15075    2       COUNT = 0;
     2513    15076    2       START = 0;
     2514    15077    3       DO WHILE( LENGTH < TO$->TEXTC.L);
     2515    15078    3           LENGTH = LENGTH - START;
     2516    15079    3           SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =
     2517    15080    3                   SUBSTR( TO$->TEXTC.T, START, LENGTH);
     2518    15081    3           COUNT = COUNT + LENGTH;
     2519    15082    4           DO WHILE TO$->TEXT_CHAR( COUNT) = ' ';
     2520    15083    4               COUNT = COUNT - 1;
     2521    15084    4               END;
     2522    15085    3           COUNT = COUNT + 1;
     2523    15086    3           TO$->TEXT_CHAR( COUNT) = ' ';
     2524    15087    3           START = START + LENGTH + 1;
     2525    15088    3           CALL INDEX( START, ')', TO$->TEXTC.T, START);
     2526    15089    4           IF START < TO$->TEXTC.L THEN DO;
     2527    15090    4               START = START + 1;
     2528    15091    5               DO WHILE START < TO$->TEXTC.L AND TO$->TEXT_CHAR( START+1) = ' ';
     2529    15092    5                   START = START + 1;
     2530    15093    5                   END;
     2531    15094    4               END;
     2532    15095    3           CALL INDEX( LENGTH, '(', TO$->TEXTC.T, START);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:87   
     2533    15096    3           END;
     2534    15097    2       LENGTH = LENGTH - START;
     2535    15098    2       SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =
     2536    15099    2               SUBSTR( TO$->TEXTC.T, START, LENGTH);
     2537    15100    2       TO$->TEXTC.L = COUNT + LENGTH;
     2538    15101    2   NO_COMMENT:
     2539    15102    3       DO WHILE TO$->TEXT_CHAR( TO$->TEXTC.L) = ' ';
     2540    15103    3           TO$->TEXTC.L = TO$->TEXTC.L - 1;
     2541    15104    3           END;
     2542    15105    2       IF SCRUNCH THEN
     2543    15106    2           SUBSTR( FROM$->TEXTC.T, 0, FROM$->TEXTC.L) =
     2544    15107    2                   SUBSTR( FROM$->TEXTC.T, 1, FROM$->TEXTC.L);
     2545    15108    2       RETURN;
     2546    15109
     2547    15110    2       END MOVE_STRING;
     2548    15111        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:88   
     2549    15112        /********** PROCEDURE TO MOVE RETURN PATH FROM MESSAGE HEADER,
     2550    15113        STRIPPING BLANKS
     2551    15114        */
     2552    15115    1   MOVE_PATH: PROC( FROM$, TO$, OFFSET) ALTRET;
     2553    15116
     2554    15117    2       DCL COUNT UBIN;
     2555    15118    2       DCL FROM$ PTR;
     2556    15119    2       DCL LENGTH UBIN;
     2557    15120    2       DCL OFFSET UBIN;
     2558    15121    2       DCL START UBIN;
     2559    15122    2       DCL TO$ PTR;
     2560    15123
     2561    15124    3       IF FROM$->TEXTC.L - OFFSET > %PATH_SIZE THEN DO;
     2562    15125    3           REPLY$ = R552$;
     2563    15126    3           ALTRETURN;
     2564    15127    3           END;
     2565    15128    2       COUNT = 0;
     2566    15129    2       START = OFFSET;
     2567    15130    2       CALL INDEX( LENGTH, ' ', FROM$->TEXTC.T, START);
     2568    15131    3       DO WHILE( LENGTH < FROM$->TEXTC.L);
     2569    15132    3           LENGTH = LENGTH - START;
     2570    15133    3           SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =
     2571    15134    3                   SUBSTR( FROM$->TEXTC.T, START, LENGTH);
     2572    15135    3           COUNT = COUNT + LENGTH;
     2573    15136    3           START = START + LENGTH + 1;
     2574    15137    4           DO WHILE( SUBSTR( FROM$->TEXTC.T, START, 1) = ' ');
     2575    15138    4               START = START + 1;
     2576    15139    4               END;
     2577    15140    3           CALL INDEX( LENGTH, ' ', FROM$->TEXTC.T, START);
     2578    15141    3           END;
     2579    15142    2       LENGTH = LENGTH - START;
     2580    15143    2       SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =
     2581    15144    2               SUBSTR( FROM$->TEXTC.T, START, LENGTH);
     2582    15145    2       TO$->TEXTC.L = COUNT + LENGTH;
     2583    15146    2       RETURN;
     2584    15147
     2585    15148    2       END MOVE_PATH;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:89   
     2586    15149        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:90   
     2587    15150    1   STATUS_LINE_UPDATE: PROC;
     2588    15151
     2589    15152    2       DCL IDLESTATUS BIT(1);
     2590    15153
     2591    15154    2       IDLESTATUS = '0'B;
     2592    15155    2   COMMON:
     2593    15156    3       IF B$JIT.PRIV.ACTIVE.JIT THEN DO;
     2594    15157    3           B$JIT.CCBUF = STATUS;
     2595    15158    3           B$JIT.CCARS = LENGTHC( STATUS);
     2596    15159    3           END;
     2597    15160    2       IF IDLESTATUS THEN
     2598    15161    2           CALL CONCAT( STATUS, TCM_PROGNAME);
     2599    15162    2       RETURN;
     2600    15163
     2601    15164    2   STATUS_LINE_IDLE: ENTRY;
     2602    15165
     2603    15166    2       IDLESTATUS = '1'B;
     2604    15167    2       CALL M$TIME( GET_TIMESTAMP);
     2605    15168    2       CALL CONCAT( STATUS, TCM_PROGNAME, ':Idle since ',
     2606    15169    2               SUBSTR( TIMESTRING, 0, 5), ' ', DAYBUF);
     2607    15170    2       GOTO COMMON;
     2608    15171
     2609    15172    2       END STATUS_LINE_UPDATE;
     2610    15173        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:91   
     2611    15174    1   WRITEDO: PROC;
     2612    15175
     2613    15176    2       DCL VLEN UBIN;
     2614    15177
     2615    15178    2       CALL GET_IOBUF_BOUND( CMDBUF, VLEN);
     2616    15179    2       IF VLEN = 0 THEN
     2617    15180    2           WRITE_DO.BUF_ = VECTOR( NIL);
     2618    15181    2       ELSE
     2619    15182    2           WRITE_DO.BUF_ = VECTOR( SUBSTR( CMDBUF, 0, VLEN));
     2620    15183    2       CALL M$WRITE( WRITE_DO);
     2621    15184    2       RETURN;
     2622    15185
     2623    15186    2       END WRITEDO;
     2624    15187
     2625    15188    1   GET_IOBUF_BOUND: PROC( BUF, VLEN);
     2626    15189
     2627    15190    2       DCL BUF CHAR( %BUFSIZ);
     2628    15191    2       DCL VLEN UBIN;
     2629    15192    2       DCL TVAL SBIN;
     2630    15193
     2631    15194    2       CALL SEARCHR( VLEN, TVAL, TCM_SKIP_BLANKS, BUF) ALTRET( BLANK_LINE);
     2632    15195    2       VLEN = VLEN + 1;
     2633    15196    2       RETURN;
     2634    15197    2   BLANK_LINE:
     2635    15198    2       VLEN = 0;
     2636    15199    2       RETURN;
     2637    15200
     2638    15201    2       END GET_IOBUF_BOUND;
     2639    15202
     2640    15203    1       END TCM$NETMAIL;
     2641    15204        %EOD;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:92   
--  Include file information  --

   XSL_PERR_C.:TCA2TOU  is referenced.
   XSL_SOCKET_M.:TCA2TOU  is referenced.
   XUD_UTS_M.:TOOLE05  is referenced.
   TCM_SEND_E.:TCA2TOU  is referenced.
   TCM_MAIL_E.:TCA2TOU  is referenced.
   TCM_COMMON_M.:TCA2TOU  cannot be made into a system file and is referenced.
   TCP_HEP_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   VM_MACRO_C.:LIBRARY  is referenced.
   XUG_ENTRY.:LIBRARY  cannot be made into a system file and is referenced.
   XU_SUBS_C.:LIBRARY  is referenced.
   XU_MACRO_C.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   B_ERRORS_C.:LIBRARY  is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$NETMAIL.

   Procedure TCM$NETMAIL requires 5691 words for executable code.
   Procedure TCM$NETMAIL requires 9394 words of local(AUTO) storage.

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:93   

 Object Unit name= TCM$NETMAIL                                File name= TCM$MAIL1.:TCA2TOU
 UTS= NOV 16 '97 14:17:15.04 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none  2360   4470  TCM$NETMAIL
    2  RoData even  UTS   1234   2322  TCM$NETMAIL
    3   DCB   even  none     0      0  F$DATA
    4   DCB   even  none     0      0  F$ALIAS
    5   DCB   even  none     0      0  F$DRIBBLE
    6   DCB   even  none     0      0  F$NODES
    7   DCB   even  none     0      0  M$SI
    8   DCB   even  none     0      0  M$DO
    9   DCB   even  none     0      0  F$NOTIFY
   10   Proc  even  none  5691  13073  TCM$NETMAIL
   11  RoData even  none   103    147  TCM$NETMAIL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    10      0   yes            yes      Main       0  TCM$NETMAIL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:94   

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1      0  TCM_PCB                            2      0  TCM_SOCKINIT
    1    216  TCM_DRIBBLE                        1    217  TCM_DRIBBLE_ME
    1    220  TCM_PROGNAME                       1    222  TCM_STUCKEE
    1    232  TCM_TZTEXT                         1    234  TCM_UTOFFSET
    1    731  TCM_SITENAME                       2     60  TCM_XLATE_TO_UC
    2    260  TCM_SKIP_BLANKS                    2    320  TCM_ILLEGAL_FROM
    2    360  TCM_ILLEGAL_REPLYTO                1   3526  TCM_ACCOUNT
    1   3530  TCM_MESSACCT                       2   1612  SCREECH1
    2   1620  SCREECH2                           2   1632  JIT_PRIV
    2   1656  TCM_YC_OFF                         1   4104  TCM_KEYIN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 XTX$ADAPT
         yes          Async      0 TCM$ABORT
         yes           Std       2 TCM$WRITE_AUDIT_ON
 yes     yes           Std       6 TCP$OPEN
         yes           Std       1 TCP$USER_TIMEOUT
 yes     yes           Std       3 TCP$READ
         yes           Std       2 XSL$NTOHL
         yes           Std       2 TCM$WRITE_AUDIT_LOG
 yes     yes           Std       1 TCP$RELEASE
 yes     yes           Std       1 TCP$CLOSE
 yes     yes           Std       3 XUR$INIT
 yes     yes           Std       1 XSL$SOCKINIT
 yes     yes           Std       2 XSL$GETHOSTBYNAME
 yes     yes           Std       2 XUG$INIT
 yes     yes           Std       1 XUG$GETCMD
 yes     yes           Std       1 XUG$ECHOIF
 yes     yes           Std       1 XUG$ERRMSG
 yes     yes           Std       6 XUR$GETCMD
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:95   
 yes     yes           Std       2 TCM$LTCP_WRITE
 yes     yes           Std       3 XUD$UTS_ADJUST
 yes     yes           Std       7 TCM$LTCP_READ
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_MAUTO
                       nStd      0 X66_INDEX
                       nStd      0 X66_MARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  TCP_MON_ERR                           TCM_CMD_LCN
     XSL_ERRNO                        r    B$JIT$                           r    B$TCB$
     TCM_SMTP_ROOT                         TCM_USER_ROOT                         TCM_TEXT_ROOT
     TCM_ADDR_ROOT                         TCM_TSTAMP_ROOT                       F$DATA
     F$ALIAS                               F$DRIBBLE                             F$NODES
     M$SI                                  M$DO                                  F$NOTIFY
r    TCM_CONFIG_CMD                        TCM_TCPFLAVOR                         B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:96   


        1        1        /*M*    TCM$MAIL1   SMTP Mail Receiver, part 1                      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        TCM$NETMAIL: PROC MAIN;

      8 10 000000   000000 700200 xent  TCM$NETMAIL  TSX0  ! X66_MAUTO
        10 000001   022262 000000                    ZERO    9394,0

        9        9        %INCLUDE CP_6;
       10       90            %F$DCB;
       11      147            %B$TCB( STCLASS="BASED( B$TCB$)");
       12      150            %B$ALT;
       13      158        %INCLUDE CP_6_SUBS;
       14      698        %INCLUDE B_ERRORS_C;
       15     1825        %INCLUDE B$JIT;
       16     2115        %INCLUDE XU_MACRO_C;
       17     5221        %INCLUDE XU_SUBS_C;
       18     5313            %P_PCB( NAME=TCM_PCB, W=PARSEWORK, WSZ="SIZEW( PARSEWORK)",
       19     5314                    NBL=YES, C_LD='  ', C_TL='  ', CNTU=NO);
       20     5513            %PARSE$OUT( NAME=CMD, STCLASS="BASED( CMD$)");
       21     5558            %PARSE$OUT( NAME=OUT, STCLASS="BASED( OUT$)");
       22     5603            %PARSE$SYM( NAME=SYM, STCLASS="BASED( SYM$)");
       23     5641            %XUR_INIT( PCB=TCM_PCB, SYNTAX=NO, COMMANDS=NO, GOODCMD=NO);
       24     5740            %XUG_INIT( COMMANDS=NO, GOODCMD=YES);
       25     6153            %XUG_GETCMD( INDCB=M$SI, OUTDCB=M$DO, NODES=TCM_CONFIG_CMD,
       26     6154                         PROMPT=PROMPTSTRING);
       27     6492            %P_PCB( NAME=P$PCB, STCLASS="BASED( XUG_GETCMD.PCB$)");
       28     6691        %INCLUDE XUG_ENTRY;
       29     6722        %INCLUDE VM_MACRO_C;
       30     7990        %INCLUDE TCP_HEP_M;
       31     8045        %INCLUDE TCP_HEP_E;
       32     8122            %TCP$SOCKET( NAME=FS);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:97   
       33     8130            %TCP$SOCKET( NAME=LS);
       34     8138    1       DCL TCM_CMD_LCN UBIN(36) SYMREF;
       35     8139    1       DCL OLD_CMD_LCN SBIN STATIC INIT( -1);
       36     8140            %TCP$CB( NAME=CB, STCLASS=STATIC);
       37     8143            %TCP$ADMIN( STCLASS=BASED);
       38     8164        %INCLUDE TCM_COMMON_M;
       39     8195        %INCLUDE TCM_MAIL_E;
       40     8254        %INCLUDE TCM_SEND_E;
       41     8360        %INCLUDE XUD_UTS_M;
       42     8442            %XUD$UTS_ENTRIES;
       43     8474            %XUD_UTS_EQU;
       44     8485        %INCLUDE XSL_SOCKET_M;
       45     9246            %XSL$HOSTENT( STCLASS="BASED( TMP$)");
       46     9306            %XSL_SOCKINIT( FPTN=TCM_SOCKINIT, BUFSIZE=4096, STCLASS="CONSTANT SYMDEF");
       47     9429        %INCLUDE XSL_PERR_C;
       48     9484    1       DCL XSL_ERRNO SBIN SYMREF;
       49     9485
       50     9486    1       DCL TCM$ABORT ENTRY ASYNC;
       51     9487    1       DCL TCM$WRITE_AUDIT_LOG ENTRY(2);
       52     9488    1       DCL TCM$WRITE_AUDIT_ON ENTRY(2);
       53     9489    1       DCL TCM$WRITE_AUDIT_OFF ENTRY(2);
       54     9490
       55     9491    1       DCL XUR$GETCMD ENTRY(6) ALTRET;
       56     9492    1       DCL XUR$INIT ENTRY(3) ALTRET;
       57     9493
       58     9494    1       DCL TCM$LTCP_READ ENTRY(7) ALTRET;
       59     9495    1       DCL TCM$LTCP_WRITE ENTRY(2) ALTRET;
       60     9496    1       DCL TCP$OPEN ENTRY(6) ALTRET;
       61     9497    1       DCL TCP$READ_NW ENTRY(3) ALTRET;
       62     9498    1       DCL TCP$READ ENTRY(3) ALTRET;
       63     9499    1       DCL TCP$WAIT ENTRY(2);
       64     9500    1       DCL TCP$CLOSE ENTRY(1) ALTRET;
       65     9501    1       DCL TCP$RELEASE ENTRY(1) ALTRET;
       66     9502    1       DCL TCP$WRITE ENTRY(4) ALTRET;
       67     9503    1       DCL TCP$USER_TIMEOUT ENTRY(1);
       68     9504    1       DCL NET$IP2ADDR ENTRY(2) ALTRET;
       69     9505    1       DCL NET$NAME2ADDR ENTRY(2) ALTRET;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:98   
       70     9506    1       DCL NET$ADDR2IP ENTRY(2);
       71     9507    1       DCL XSL$GETHOSTBYNAME ENTRY(2) ALTRET;
       72     9508    1       DCL XSL$NTOHL ENTRY(2);
       73     9509    1       DCL XSL$SOCKINIT ENTRY(1) ALTRET;
       74     9510
       75     9511    1       DCL B$JIT$ PTR SYMREF READONLY;
       76     9512    1       DCL B$TCB$ PTR SYMREF READONLY;
       77     9513
       78     9514    1       DCL TCM_SMTP_ROOT SBIN SYMREF;
       79     9515    1       DCL TCM_USER_ROOT SBIN SYMREF;
       80     9516    1       DCL TCM_TEXT_ROOT SBIN SYMREF;
       81     9517    1       DCL TCM_ADDR_ROOT SBIN SYMREF;
       82     9518    1       DCL TCM_TSTAMP_ROOT SBIN SYMREF;
       83     9519
       84     9520    1       DCL F$DATA DCB;
       85     9521    1       DCL F$ALIAS DCB;
       86     9522    1       DCL F$DRIBBLE DCB;
       87     9523    1       DCL F$NODES DCB;
       88     9524    1       DCL M$SI DCB;
       89     9525    1       DCL M$DO DCB;
       90     9526    1       DCL F$NOTIFY DCB;
       91     9527
       92     9528    1       DCL M$SI$ PTR;
       93     9529    1       DCL CMD$ PTR;
       94     9530    1       DCL OUT$ PTR;
       95     9531    1       DCL SYM$ REDEF OUT$ PTR;
       96     9532    1       DCL TMP$ PTR;
       97     9533    1       DCL TCM_DRIBBLE BIT(36) STATIC SYMDEF INIT( %NO#);
       98     9534    1       DCL TCM_DRIBBLE_ME BIT(36) STATIC SYMDEF INIT (%NO#);
       99     9535    1       DCL BLANK CONSTANT CHAR(1) INIT( ' ');
      100     9536    1       DCL TCM_PROGNAME CHAR(7) STATIC SYMDEF INIT( 'NETMAIL');
      101     9537    1       DCL TCM_STUCKEE CHAR(32) STATIC SYMDEF INIT( ' ');
      102     9538    1       DCL OFFCMD CONSTANT CHAR(4) INIT( 'OFF');
      103     9539    1       DCL PROMPT CONSTANT CHAR(1) INIT( '@');
      104     9540    1       DCL PROMPTSTRING CHAR(0) CONSTANT INIT( '{} ');
      105     9541    1       DCL TCM_CONFIG_CMD UBIN WORD SYMREF READONLY;
      106     9542    1       DCL TCM_TZTEXT CHAR(6) STATIC SYMDEF INIT( ' PST  ');
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:99   
      107     9543    1       DCL TCM_UTOFFSET SBIN STATIC SYMDEF INIT( %( -8 * UTS_CSEC_HOUR#));
      108     9544    1       DCL B$UBIN UBIN BASED;
      109     9545    1       DCL LOCALHOSTNAME CHAR(0) CONSTANT INIT( %CONCAT( 'localhost', BINASC(0)));
      110     9546    1       DCL FEPNAMES(0:5) CHAR(12) STATIC INIT( '            '*6);
      111     9547    1       DCL B$PTR PTR BASED;
      112     9548        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:100  
      113     9549        /********** REPLY DEFINITIONS */
      114     9550        %MACRO REPLY( NUM=0, MSG="''", STC=STATIC, SIZ=0, LEN=0);
      115     9551        %LSET R$ = CHARTEXT( CONCAT( 'R', TEXTCHAR(NUM), '$'));
      116     9552        %LSET R = CHARTEXT( CONCAT( 'REPLY', TEXTCHAR(NUM)));
      117     9553        %LSET L = LENGTHC( TEXTCHAR(MSG)) - 2;
      118     9554        %IF TEXTCHAR(LEN) = '0';
      119     9555            %LSET XLEN = %L;
      120     9556        %ELSE;
      121     9557            %LSET XLEN = CHARTEXT( TEXTCHAR(LEN));
      122     9558        %ENDIF;
      123     9559        %LSET LISTEXP = %YES#;
      124     9560        %LSET LISTSUB = %YES#;
      125     9561        %LSET LISTMAC = %YES#;
      126     9562            DCL %R$ PTR CONSTANT INIT( ADDR( %R));
      127     9563            DCL 1 %R STC UNAL,
      128     9564                 2 COUNT UBIN(9) INIT( %XLEN) CALIGNED,
      129     9565                 2 TEXT CHAR( SIZ) INIT( MSG);
      130     9566        %MEND;
      131     9567            /* LEN is set when we want different length than PL6 would calculate */
      132     9568            %REPLY( NUM=220, STC=STATIC,
      133     9569                  MSG="'220           SMTP ready at HH:MM:SS MMM DD ''YY  Line ff-llll'");
              9581    1       DCL R220$ PTR CONSTANT INIT( ADDR( REPLY220));
              9582    1       DCL 1 REPLY220 STATIC UNAL,
              9583    1            2 COUNT UBIN(9) INIT( 62) CALIGNED,
              9584    1            2 TEXT CHAR( 0) INIT(
              9584                     '220           SMTP ready at HH:MM:SS MMM DD ''YY  Line ff-llll');
      134     9586            %REPLY( NUM=221,
      135     9587                  MSG="'221          Closing transmission channel'");
              9599    1       DCL R221$ PTR CONSTANT INIT( ADDR( REPLY221));
              9600    1       DCL 1 REPLY221 STATIC UNAL,
              9601    1            2 COUNT UBIN(9) INIT( 41) CALIGNED,
              9602    1            2 TEXT CHAR( 0) INIT( '221          Closing transmission channel');
      136     9604            %REPLY( NUM=250,
      137     9605                  MSG="'250 Okay'");
              9617    1       DCL R250$ PTR CONSTANT INIT( ADDR( REPLY250));
              9618    1       DCL 1 REPLY250 STATIC UNAL,
              9619    1            2 COUNT UBIN(9) INIT( 8) CALIGNED,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:101  
              9620    1            2 TEXT CHAR( 0) INIT( '250 Okay');
      138     9622            %REPLY( NUM=250OOPS,
      139     9623                  MSG="'250 Mailer glitch; queued for manual delivery'");
              9635    1       DCL R250OOPS$ PTR CONSTANT INIT( ADDR( REPLY250OOPS));
              9636    1       DCL 1 REPLY250OOPS STATIC UNAL,
              9637    1            2 COUNT UBIN(9) INIT( 45) CALIGNED,
              9638    1            2 TEXT CHAR( 0) INIT( '250 Mailer glitch; queued for manual delivery');
      140     9640            %REPLY( NUM=250A,
      141     9641                  MSG="'250          '");
              9653    1       DCL R250A$ PTR CONSTANT INIT( ADDR( REPLY250A));
              9654    1       DCL 1 REPLY250A STATIC UNAL,
              9655    1            2 COUNT UBIN(9) INIT( 13) CALIGNED,
              9656    1            2 TEXT CHAR( 0) INIT( '250          ');
      142     9658            %REPLY( NUM=250V, STC=STATIC, SIZ=255, LEN=3,
      143     9659                  MSG="'250 '");
              9671    1       DCL R250V$ PTR CONSTANT INIT( ADDR( REPLY250V));
              9672    1       DCL 1 REPLY250V STATIC UNAL,
              9673    1            2 COUNT UBIN(9) INIT( 3) CALIGNED,
              9674    1            2 TEXT CHAR( 255) INIT( '250 ');
      144     9676            %REPLY( NUM=354,
      145     9677                  MSG="'354 Start mail input'");
              9689    1       DCL R354$ PTR CONSTANT INIT( ADDR( REPLY354));
              9690    1       DCL 1 REPLY354 STATIC UNAL,
              9691    1            2 COUNT UBIN(9) INIT( 20) CALIGNED,
              9692    1            2 TEXT CHAR( 0) INIT( '354 Start mail input');
      146     9694            %REPLY( NUM=421,
      147     9695                  MSG="'421          Closing transmission channel'");
              9707    1       DCL R421$ PTR CONSTANT INIT( ADDR( REPLY421));
              9708    1       DCL 1 REPLY421 STATIC UNAL,
              9709    1            2 COUNT UBIN(9) INIT( 41) CALIGNED,
              9710    1            2 TEXT CHAR( 0) INIT( '421          Closing transmission channel');
      148     9712            %REPLY( NUM=421TO,
      149     9713                  MSG="'421 Timeout during message reception; please retransmit.'");
              9725    1       DCL R421TO$ PTR CONSTANT INIT( ADDR( REPLY421TO));
              9726    1       DCL 1 REPLY421TO STATIC UNAL,
              9727    1            2 COUNT UBIN(9) INIT( 56) CALIGNED,
              9728    1            2 TEXT CHAR( 0) INIT(
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:102  
              9728                     '421 Timeout during message reception; please retransmit.');
      150     9730            %REPLY( NUM=421ZAP,
      151     9731                  MSG="'421          Transmission channel timed out or lost data.'");
              9743    1       DCL R421ZAP$ PTR CONSTANT INIT( ADDR( REPLY421ZAP));
              9744    1       DCL 1 REPLY421ZAP STATIC UNAL,
              9745    1            2 COUNT UBIN(9) INIT( 57) CALIGNED,
              9746    1            2 TEXT CHAR( 0) INIT(
              9746                     '421          Transmission channel timed out or lost data.');
      152     9748            %REPLY( NUM=421DL,
      153     9749                  MSG="'421 Data lost in transmission; please retransmit.'");
              9761    1       DCL R421DL$ PTR CONSTANT INIT( ADDR( REPLY421DL));
              9762    1       DCL 1 REPLY421DL STATIC UNAL,
              9763    1            2 COUNT UBIN(9) INIT( 49) CALIGNED,
              9764    1           2 TEXT CHAR( 0) INIT( '421 Data lost in transmission; please retransmit.');
      154     9766            %REPLY( NUM=451,
      155     9767                  MSG="'451 Requested action aborted. Error in local processing'");
              9779    1       DCL R451$ PTR CONSTANT INIT( ADDR( REPLY451));
              9780    1       DCL 1 REPLY451 STATIC UNAL,
              9781    1            2 COUNT UBIN(9) INIT( 55) CALIGNED,
              9782    1            2 TEXT CHAR( 0) INIT(
              9782                     '451 Requested action aborted. Error in local processing');
      156     9784            %REPLY( NUM=500,
      157     9785                  MSG="'500 Command not recognized.'");
              9797    1       DCL R500$ PTR CONSTANT INIT( ADDR( REPLY500));
              9798    1       DCL 1 REPLY500 STATIC UNAL,
              9799    1            2 COUNT UBIN(9) INIT( 27) CALIGNED,
              9800    1            2 TEXT CHAR( 0) INIT( '500 Command not recognized.');
      158     9802            %REPLY( NUM=501,
      159     9803                  MSG="'501 Syntax error in parameters or arguments.'");
              9815    1       DCL R501$ PTR CONSTANT INIT( ADDR( REPLY501));
              9816    1       DCL 1 REPLY501 STATIC UNAL,
              9817    1            2 COUNT UBIN(9) INIT( 44) CALIGNED,
              9818    1            2 TEXT CHAR( 0) INIT( '501 Syntax error in parameters or arguments.');
      160     9820            %REPLY( NUM=502,
      161     9821                  MSG="'502 Command not implemented'");
              9833    1       DCL R502$ PTR CONSTANT INIT( ADDR( REPLY502));
              9834    1       DCL 1 REPLY502 STATIC UNAL,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:103  
              9835    1            2 COUNT UBIN(9) INIT( 27) CALIGNED,
              9836    1            2 TEXT CHAR( 0) INIT( '502 Command not implemented');
      162     9838            %REPLY( NUM=503,
      163     9839                  MSG="'503 Invalid command sequence'");
              9851    1       DCL R503$ PTR CONSTANT INIT( ADDR( REPLY503));
              9852    1       DCL 1 REPLY503 STATIC UNAL,
              9853    1            2 COUNT UBIN(9) INIT( 28) CALIGNED,
              9854    1            2 TEXT CHAR( 0) INIT( '503 Invalid command sequence');
      164     9856            %REPLY( NUM=550,
      165     9857                  MSG="'550 Mailbox unknown'");
              9869    1       DCL R550$ PTR CONSTANT INIT( ADDR( REPLY550));
              9870    1       DCL 1 REPLY550 STATIC UNAL,
              9871    1            2 COUNT UBIN(9) INIT( 19) CALIGNED,
              9872    1            2 TEXT CHAR( 0) INIT( '550 Mailbox unknown');
      166     9874            %REPLY( NUM=550NONODE,
      167     9875                  MSG="'550 Cannot access :NODES file to forward message'");
              9887    1       DCL R550NONODE$ PTR CONSTANT INIT( ADDR( REPLY550NONODE));
              9888    1       DCL 1 REPLY550NONODE STATIC UNAL,
              9889    1            2 COUNT UBIN(9) INIT( 48) CALIGNED,
              9890    1            2 TEXT CHAR( 0) INIT( '550 Cannot access :NODES file to forward message');
      168     9892            %REPLY( NUM=550NODOMAIN,
      169     9893                  MSG="'550 That domain is unknown to me.'");
              9905    1       DCL R550NODOMAIN$ PTR CONSTANT INIT( ADDR( REPLY550NODOMAIN));
              9906    1       DCL 1 REPLY550NODOMAIN STATIC UNAL,
              9907    1            2 COUNT UBIN(9) INIT( 33) CALIGNED,
              9908    1            2 TEXT CHAR( 0) INIT( '550 That domain is unknown to me.');
      170     9910            %REPLY( NUM=550NOSITE,
      171     9911                  MSG="'550 That CP-6 site is unknown to me.'");
              9923    1       DCL R550NOSITE$ PTR CONSTANT INIT( ADDR( REPLY550NOSITE));
              9924    1       DCL 1 REPLY550NOSITE STATIC UNAL,
              9925    1            2 COUNT UBIN(9) INIT( 36) CALIGNED,
              9926    1            2 TEXT CHAR( 0) INIT( '550 That CP-6 site is unknown to me.');
      172     9928            %REPLY( NUM=551,
      173     9929                  MSG="'551 User not local; cannot forward'");
              9941    1       DCL R551$ PTR CONSTANT INIT( ADDR( REPLY551));
              9942    1       DCL 1 REPLY551 STATIC UNAL,
              9943    1            2 COUNT UBIN(9) INIT( 34) CALIGNED,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:104  
              9944    1            2 TEXT CHAR( 0) INIT( '551 User not local; cannot forward');
      174     9946            %REPLY( NUM=552,
      175     9947                  MSG="'552 Buffer size exceeded'");
              9959    1       DCL R552$ PTR CONSTANT INIT( ADDR( REPLY552));
              9960    1       DCL 1 REPLY552 STATIC UNAL,
              9961    1            2 COUNT UBIN(9) INIT( 24) CALIGNED,
              9962    1            2 TEXT CHAR( 0) INIT( '552 Buffer size exceeded');
      176     9964            %REPLY( NUM=553,
      177     9965                  MSG="'553 Specified user name is ambiguous'");
              9977    1       DCL R553$ PTR CONSTANT INIT( ADDR( REPLY553));
              9978    1       DCL 1 REPLY553 STATIC UNAL,
              9979    1            2 COUNT UBIN(9) INIT( 36) CALIGNED,
              9980    1            2 TEXT CHAR( 0) INIT( '553 Specified user name is ambiguous');
      178     9982            %REPLY( NUM=998, STC=STATIC, LEN=22,
      179     9983                  MSG="%CONCAT('*** NETMAIL here ***',BINASC(18),BINASC(24))");
              9995    1       DCL R998$ PTR CONSTANT INIT( ADDR( REPLY998));
              9996    1       DCL 1 REPLY998 STATIC UNAL,
              9997    1            2 COUNT UBIN(9) INIT( 22) CALIGNED,
              9998    1            2 TEXT CHAR( 0) INIT( '*** NETMAIL here ***  ');
      180    10000            %REPLY( NUM=999,
      181    10001                  MSG="'$SET M$LL NO'");
             10013    1       DCL R999$ PTR CONSTANT INIT( ADDR( REPLY999));
             10014    1       DCL 1 REPLY999 STATIC UNAL,
             10015    1            2 COUNT UBIN(9) INIT( 12) CALIGNED,
             10016    1            2 TEXT CHAR( 0) INIT( '$SET M$LL NO');
      182    10018        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:105  
      183    10019        /********** STATE CONTROL AREAS */
      184    10020    1       DCL REPLY$ PTR STATIC INIT( ADDR( REPLY421));
      185    10021    1       DCL CMD_CODE UBIN STATIC INIT( 0);
      186    10022    1       DCL LAST_CMD UBIN;
      187    10023    1       DCL USER_COUNT UBIN STATIC INIT( 0);
      188    10024    1       DCL LOGGED_ON BIT(1) STATIC INIT( %FALSE);
      189    10025    1       DCL MSG_COUNT UBIN STATIC INIT( 0);
      190    10026    1       DCL TIMED_OUT BIT(1);
      191    10027    1       DCL DATA_LOST BIT(1);
      192    10028    1       DCL SUPPRESS_HEADERS BIT(1);
      193    10029    1       DCL SYNC_PHASE UBIN STATIC INIT( 0);
      194    10030    1       DCL NODES_FILE_OPEN BIT(1);
      195    10031    1       DCL X_29 BIT(1);
      196    10032    1       DCL ACKNOWLEDGE BIT(1);
      197    10033    1       DCL UTS UBIN STATIC;
      198    10034    1       DCL TCM_TCPFLAVOR BIT(1) SYMREF;
      199    10035    1       DCL TCM_SITENAME CHAR(8) STATIC SYMDEF INIT( 'LADC');
      200    10036
      201    10037        /********** BUFFER AREAS */
      202    10038        %EQU BUFSIZ = 255;
      203    10039        %MACRO BUFFER( NAME=BUFFER, STCLASS=AUTO);
      204    10040            DCL 1 NAME STCLASS,
      205    10041                 2 LEN UBIN(9) CALIGNED,
      206    10042                 2 TXT CHAR( %BUFSIZ) CALIGNED;
      207    10043        %MEND;
      208    10044            %BUFFER( NAME=HELO);        /* holds the SMTP HELO command text */
      209    10049            %BUFFER( NAME=MAIL);        /* holds the SMTP MAIL command text */
      210    10054            %BUFFER( NAME=RCPT);        /* holds the SMTP RCPT command text */
      211    10059            %BUFFER( NAME=FROM);        /* holds the From: header text */
      212    10064            %BUFFER( NAME=REPL);        /* holds the Reply-To: header text */
      213    10069            %BUFFER( NAME=SUBJ);        /* holds the Subject: header text */
      214    10074            %BUFFER( NAME=RMID);        /* holds the In-Reply-To: header text */
      215    10079            %BUFFER( NAME=MID);         /* holds the Message-Id: header text */
      216    10084            %BUFFER( NAME=FORUM);       /* holds the Forum-Transaction: header text */
      217    10089            %BUFFER( NAME=WHEN);        /* holds the Date: header text */
      218    10094            %BUFFER( NAME=LTEXT);       /* leading random text */
      219    10099            %BUFFER( NAME=TTEXT);       /* trailing random text */
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:106  
      220    10104            %BUFFER( NAME=FTEXT);       /* user-friendly From: text */
      221    10109            %BUFFER( NAME=RTEXT);       /* user-friendly Reply-To: text */
      222    10114            %BUFFER( NAME=ZTEXT);       /* scratch text buffer */
      223    10119        %SET USER_LIMIT = MAX_USERS - 1;
      224    10120            %BUFFER( NAME="USERS(0:%USER_LIMIT)");
      225    10125
      226    10126    1       DCL REWRITES SBIN;
      227    10127    1       DCL 1 REWRITE(0:%MAX_REWRITES) STATIC,
      228    10128    1            2 TYP SBIN,
      229    10129    1            2 * SBIN,
      230    10130    1            2 OLD,
      231    10131    1             3 LEN UBIN BYTE CALIGNED,
      232    10132    1             3 TXT CHAR(31) CALIGNED,
      233    10133    1            2 NEW,
      234    10134    1             3 LEN UBIN BYTE CALIGNED,
      235    10135    1             3 TXT CHAR(31) CALIGNED;
      236    10136    1       DCL LINESIZE UBIN;
      237    10137    1       DCL LINEBUF CHAR(%LINE_SIZE) STATIC;
      238    10138    1       DCL LINECHAR(0:%(LINE_SIZE-1)) REDEF LINEBUF BIT(9);
      239    10139    1       DCL PARSEWORK(0:799) UBIN WORD STATIC;
      240    10140    1       DCL MY_SITE_NAME CHAR(8) STATIC INIT( ' ');
      241    10141    1       DCL MY_SITE_NAME_L UBIN(36);
      242    10142    1       DCL MY_SITE_NAME_2 CHAR(20);
      243    10143    1       DCL OCMSG CHAR( %BUFSIZ) STATIC;
      244    10144    1       DCL CMDBUF CHAR( %BUFSIZ);
      245    10145
      246    10146    1       DCL 1 STATUS_LINE STATIC,
      247    10147    1            2 * CHAR(7) INIT( ' '),
      248    10148    1            2 MSGS CHAR(2) INIT( '  '),
      249    10149    1            2 STATUS CHAR(1) INIT( ' '),
      250    10150    1            2 LINES CHAR(4) INIT( ' '),
      251    10151    1            2 * CHAR(1) INIT( ' '),
      252    10152    1            2 CMD CHAR(4) INIT( ' '),
      253    10153    1            2 * CHAR(1) INIT( ' '),
      254    10154    1            2 RCPT_ADDR CHAR(16) INIT( ' '),
      255    10155    1            2 * CHAR(1) INIT( ' '),
      256    10156    1            2 FROM_ADDR CHAR(16) INIT( ' ');
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:107  
      257    10157    1       DCL STATUS REDEF STATUS_LINE CHAR(53);
      258    10158
      259    10159    1       DCL 1 NODES_KEY STATIC,
      260    10160    1            2 COUNT UBIN BYTE CALIGNED INIT( 8),
      261    10161    1            2 SITE CHAR(8);
      262    10162
      263    10163    1       DCL 1 DATEBUF STATIC,
      264    10164    1            2 MON CHAR(3) INIT( ' '),
      265    10165    1            2 * CHAR(1) INIT( ' '),
      266    10166    1            2 DAY CHAR(2) INIT( ' '),
      267    10167    1            2 * CHAR(2) INIT( ' '),
      268    10168    1            2 YEAR CHAR(2) INIT( ' ');
      269    10169    1       DCL DATESTRING REDEF DATEBUF CHAR(10);
      270    10170
      271    10171    1       DCL 1 TIMEBUF STATIC,
      272    10172    1            2 HOUR CHAR(2) INIT( ' '),
      273    10173    1            2 * CHAR(1) INIT( ' '),
      274    10174    1            2 MIN CHAR(2) INIT( ' '),
      275    10175    1            2 * CHAR(1) INIT( ' '),
      276    10176    1            2 SEC CHAR(2) INIT( ' ');
      277    10177    1       DCL TIMESTRING REDEF TIMEBUF CHAR(8);
      278    10178
      279    10179    1       DCL DAYBUF CHAR(3) STATIC INIT( '   ');
      280    10180
      281    10181    1       DCL DATEWORK CHAR(10);
      282    10182    1       DCL TIMEWORK CHAR(8);
      283    10183
      284    10184    1       DCL 1 ANSBUF STATIC,
      285    10185    1            2 DATE CHAR(6),
      286    10186    1            2 TIME CHAR(8);
      287    10187    1       DCL ANSSTAMP REDEF ANSBUF CHAR(14);
      288    10188    1       DCL 1 LCLBUF STATIC,
      289    10189    1            2 DATE CHAR(8),
      290    10190    1            2 * CHAR(1) INIT( ','),
      291    10191    1            2 TIME CHAR(11);
      292    10192    1       DCL LCLSTAMP REDEF LCLBUF CHAR(20);
      293    10193    1       DCL UTSVAL UBIN(36) STATIC;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:108  
      294    10194    1       DCL CMN2UTS(0:9) SBIN CONSTANT INIT(
      295    10195    1           0, 0, -5, -4, -6, -5, -7, -6, -8, -7);
      296    10196
      297    10197    1       DCL 1 DATA_KEY STATIC,
      298    10198    1            2 * UBIN(9) UNAL INIT( 3),
      299    10199    1            2 KEY UBIN(27) UNAL INIT( 0);
      300    10200
      301    10201    1       DCL TCM_XLATE_TO_UC(0:511) CHAR(1) UNAL CONSTANT SYMDEF INIT(
      302    10202    1            BINASC(0),BINASC(1),BINASC(2),BINASC(3),        /* NUL SOH STX ETX */
      303    10203    1            BINASC(4),BINASC(5),BINASC(6),BINASC(7),        /* EOT ENQ ACK BEL */
      304    10204    1            BINASC(8),BINASC(9),BINASC(10),BINASC(11),      /* BS HT LF VT */
      305    10205    1            BINASC(12),BINASC(13),BINASC(14),BINASC(15),    /* FF CR SO SI */
      306    10206    1            BINASC(16),BINASC(17),BINASC(18),BINASC(19),    /* DLE DC1 DC2 DC3 */
      307    10207    1            BINASC(20),BINASC(21),BINASC(22),BINASC(23),    /* DC4 NAK SYN ETB */
      308    10208    1            BINASC(24),BINASC(25),BINASC(26),BINASC(27),    /* CAN EM SUB ESC */
      309    10209    1            BINASC(28),BINASC(29),BINASC(30),BINASC(31),    /* FS GS RS US */
      310    10210    1            BINASC(32),BINASC(33),BINASC(34),BINASC(35),    /* SP ! " # */
      311    10211    1            BINASC(36),BINASC(37),BINASC(38),BINASC(39),    /* $ % & ' */
      312    10212    1            BINASC(40),BINASC(41),BINASC(42),BINASC(43),    /* ( ) * + */
      313    10213    1            BINASC(44),BINASC(45),BINASC(46),BINASC(47),    /* , - . / */
      314    10214    1            BINASC(48),BINASC(49),BINASC(50),BINASC(51),    /* 0 1 2 3 */
      315    10215    1            BINASC(52),BINASC(53),BINASC(54),BINASC(55),    /* 4 5 6 7 */
      316    10216    1            BINASC(56),BINASC(57),BINASC(58),BINASC(59),    /* 8 9 : ; */
      317    10217    1            BINASC(60),BINASC(61),BINASC(62),BINASC(63),    /* < = > ? */
      318    10218    1            BINASC(64),BINASC(65),BINASC(66),BINASC(67),    /* @ A B C */
      319    10219    1            BINASC(68),BINASC(69),BINASC(70),BINASC(71),    /* D E F G */
      320    10220    1            BINASC(72),BINASC(73),BINASC(74),BINASC(75),    /* H I J K */
      321    10221    1            BINASC(76),BINASC(77),BINASC(78),BINASC(79),    /* L M N O */
      322    10222    1            BINASC(80),BINASC(81),BINASC(82),BINASC(83),    /* P Q R S */
      323    10223    1            BINASC(84),BINASC(85),BINASC(86),BINASC(87),    /* T U V W */
      324    10224    1            BINASC(88),BINASC(89),BINASC(90),BINASC(91),    /* X Y Z [ */
      325    10225    1            BINASC(92),BINASC(93),BINASC(94),BINASC(95),    /* \ ] ^ _ */
      326    10226        /*
      327    10227            ***       THIS SECTION OF THE TABLE CONVERTS THE LOWER CASE
      328    10228            ***       ALPHABET TO UPPER CASE WHEN USED WITH XLATE FUNCTION.
      329    10229            ***       THE COMMENTARY REFLECTS THE NORMAL ASCII CHARACTER WHICH
      330    10230            ***       USUALLY HOLDS THE POSITION IN THE TABLE.
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:109  
      331    10231        */
      332    10232    1            BINASC(96),BINASC(65),BINASC(66),BINASC(67),    /* ' a b c */
      333    10233    1            BINASC(68),BINASC(69),BINASC(70),BINASC(71),    /* d e f g */
      334    10234    1            BINASC(72),BINASC(73),BINASC(74),BINASC(75),    /* h i j k */
      335    10235    1            BINASC(76),BINASC(77),BINASC(78),BINASC(79),    /* l m n o */
      336    10236    1            BINASC(80),BINASC(81),BINASC(82),BINASC(83),    /* p q r s */
      337    10237    1            BINASC(84),BINASC(85),BINASC(86),BINASC(87),    /* t u v w */
      338    10238    1            BINASC(88),BINASC(89),BINASC(90),BINASC(123),   /* x y z { */
      339    10239    1            BINASC(124),BINASC(125),BINASC(126),BINASC(127),/* | } ~ DEL */
      340    10240    1                        BINASC(32)*384);                    /* ALL ELSE BLANK */
      341    10241
      342    10242    1       DCL TCM_SKIP_BLANKS(0:127) CONSTANT SYMDEF UBIN(9) CALIGNED
      343    10243                /** blank=0  alphanumeric=1  special=2  control=3 **/
      344    10244    1           INIT(3*32,0,1*15,2*10,1*7,2*26,1*6,2*26,1*4,3);
      345    10245    1       DCL TCM_ILLEGAL_FROM(0:127) CONSTANT SYMDEF UBIN BYTE CALIGNED
      346    10246                /* only blank and alphanumeric are legal */
      347    10247    1           INIT(1*32,0,1*15,0*10,1*7,0*26,1*6,0*26,1*4,1);
      348    10248    1       DCL TCM_ILLEGAL_REPLYTO(0:127) CONSTANT SYMDEF UBIN BYTE CALIGNED
      349    10249                /* blank, alphanumeric, and !@.-%/ are legal */
      350    10250    1           INIT(1*32,0*2,1*3,0,1*7,0*3,0*10,1*6,0*27,1*6,0*26,1*4,1);
      351    10251
      352    10252    1       DCL HEX CHAR(16) CONSTANT INIT( '0123456789ABCDEF');
      353    10253    1       DCL HEX1 UBIN;
      354    10254    1       DCL HEX2 UBIN;
      355    10255        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:110  
      356    10256        /********** MONITOR SERVICE PARAMETER BLOCKS */
      357    10257            %FPT_CLOSE( FPTN=CLOSE_SI, STCLASS=CONSTANT, DCB=M$SI, DISP=SAVE);
      358    10299            %FPT_WRITE( FPTN=WRITE_DO, DCB=M$DO);
      359    10330            %FPT_READ( FPTN=READ_UC, BUF=LINEBUF, DCB=M$UC);
      360    10369            %FPT_WRITE( FPTN=WRITE_UC, BUF=LINEBUF, DCB=M$UC);
      361    10400            %FPT_TRMPRG( FPTN=PURGE_UC_INPUT, DCB=M$UC, PURGEINPUT=YES, STCLASS=CONSTANT);
      362    10429
      363    10430            %FPT_OPEN( FPTN=OPEN_ALIAS, DCB=F$ALIAS, FUN=IN, STCLASS=CONSTANT,
      364    10431                       NAME=ALIAS_NAME, ACCT=ALIAS_ACCT, ASN=FILE, SHARE=ALL);
      365    10540            %VLP_NAME( FPTN=ALIAS_NAME, NAME=':MAIL_CENTRAL', STCLASS=CONSTANT);
      366    10567            %VLP_ACCT( FPTN=ALIAS_ACCT, ACCT=':MAIL', STCLASS=CONSTANT);
      367    10580            %FPT_PRECORD( FPTN=POSITION_ALIAS, DCB=F$ALIAS, KEYS=YES, KEYR=YES, N=0);
      368    10601            %FPT_PFIL( FPTN=REWIND_ALIAS, DCB=F$ALIAS, BOF=YES, STCLASS=CONSTANT);
      369    10616            %FPT_CLOSE( FPTN=CLOSE_ALIAS, DCB=F$ALIAS, STCLASS=CONSTANT);
      370    10658
      371    10659            %FPT_OPEN( FPTN=OPEN_NODES, DCB=F$NODES, FUN=IN, STCLASS=CONSTANT,
      372    10660                       NAME=NODES_NAME, ACCT=NODES_ACCT, ASN=FILE, SHARE=IN);
      373    10769            %VLP_NAME( FPTN=NODES_NAME, NAME=':NODES', STCLASS=CONSTANT);
      374    10796            %VLP_ACCT( FPTN=NODES_ACCT, ACCT=':SYS', STCLASS=CONSTANT);
      375    10809            %FPT_READ( FPTN=READ_NODES, DCB=F$NODES, BUF=MY_SITE_NAME,
      376    10810                       KEY=NODES_KEY, KEYS=YES, KEYR=NO, STCLASS=CONSTANT);
      377    10849            %FPT_PRECORD( FPTN=POSITION_NODES, DCB=F$NODES, STCLASS=CONSTANT,
      378    10850                          KEY=NODES_KEY, KEYS=YES, KEYR=NO, N=0);
      379    10871            %FPT_CLOSE( FPTN=CLOSE_NODES, DCB=F$NODES, STCLASS=CONSTANT);
      380    10913
      381    10914            %FPT_OPEN( FPTN=OPEN_DRIBBLE_ME, DCB=F$DRIBBLE, ASN=DEVICE,
      382    10915                       RES='ME', STCLASS=CONSTANT);
      383    11024            %FPT_OPEN( FPTN=OPEN_DRIBBLE, STCLASS=CONSTANT, DCB=F$DRIBBLE,
      384    11025                       FUN=CREATE, EXIST=OLDFILE, ASN=FILE, CTG=YES,
      385    11026                       ORG=CONSEC, DISP=NAMED, NAME=DRIBBLE_NAME, ACCT=TCM_MESSACCT);
      386    11135            %FPT_CLOSE( FPTN=CLOSE_DRIBBLE, DCB=F$DRIBBLE, STCLASS=CONSTANT);
      387    11177            %FPT_WRITE( FPTN=WRITE_DRIBBLE, DCB=F$DRIBBLE);
      388    11208            %VLP_NAME( FPTN=DRIBBLE_NAME, NAME=':DRIBRCVD', STCLASS=CONSTANT);
      389    11235            %VLP_ACCT( FPTN=TCM_ACCOUNT, STCLASS="STATIC SYMDEF", ACCT=':SMTP');
      390    11248            %VLP_ACCT( FPTN=TCM_MESSACCT, STCLASS="STATIC SYMDEF", ACCT=':SMTP');
      391    11261
      392    11262            %FPT_OPEN( FPTN=OPEN_DATA, DCB=F$DATA, FUN=CREATE, EXIST=NEWFILE,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:111  
      393    11263                       ASN=FILE, CTG=YES, ORG=KEYED, NAME=DATA_NAME, ACCT=TCM_MESSACCT,
      394    11264                       IXTNSIZE=2, XTNSIZE=2);
      395    11373            %VLP_NAME( FPTN=DATA_NAME, NAME='$MSGxxxxxxxxxxxx');
      396    11400            %FPT_OPEN( FPTN=REOPEN_DATA, DCB=F$DATA, FUN=UPDATE, EXIST=OLDFILE,
      397    11401                       ASN=FILE, NAME=DATA_NAME, ACCT=TCM_MESSACCT);
      398    11510            %FPT_OPEN( FPTN=DELETE_DATA, DCB=F$DATA, FUN=UPDATE, DELETE=YES);
      399    11619            %FPT_READ( FPTN=REREAD_DATA, STCLASS=CONSTANT, BUF=LINEBUF,
      400    11620                       KEY=DATA_KEY, KEYS=YES, DCB=F$DATA);
      401    11659            %FPT_WRITE( FPTN=WRITE_DATA, BUF=LINEBUF, KEY=DATA_KEY, DCB=F$DATA);
      402    11690            %FPT_WRITE( FPTN=WRITE_BLANK_DATA, STCLASS=CONSTANT, BUF=NIL,
      403    11691                        KEY=DATA_KEY, DCB=F$DATA);
      404    11722            %FPT_CLOSE( FPTN=CLOSE_DATA, DCB=F$DATA, STCLASS=CONSTANT);
      405    11764
      406    11765            %FPT_OPEN( FPTN=OPEN_NOTIFY, DCB=F$NOTIFY, STCLASS=CONSTANT,
      407    11766                       ASN=FILE, FUN=CREATE, EXIST=NEWFILE, DISP=NAMED, CTG=YES,
      408    11767                       ORG=CONSEC, NAME=NOTIFY_NAME);
      409    11876            %VLP_NAME( FPTN=NOTIFY_NAME, NAME='*NOTE', STCLASS=CONSTANT);
      410    11903            %FPT_WRITE( FPTN=WRITE_NOTIFY, DCB=F$NOTIFY);
      411    11934            %FPT_CLOSE( FPTN=CLOSE_NOTIFY, DCB=F$NOTIFY, STCLASS=CONSTANT);
      412    11976
      413    11977            %FPT_LINK( FPTN=SEND_NOTIFY, CMD=NOTIFY_CMD, NAME=SEND, ACCT=COLON_SYS,
      414    11978                       STCLASS=CONSTANT);
      415    11996            %VLP_NAME( FPTN=NOTIFY_CMD, STCLASS=CONSTANT,
      416    11997                       NAME="'SEND *NOTE (GATEWAY,MAIL=SMTP Mailer)'");
      417    12024
      418    12025            %FPT_LINK( FPTN=SEND_MAIL, CMD=SEND_CMD, ACCT=COLON_SYS);
      419    12043            %VLP_NAME( FPTN=SEND_CMD, STCLASS=STATIC,
      420    12044                       NAME="'SEND $MSGxxxxxxxxxxxx (GATEWAY,MAIL=SMTP Mailer)'");
      421    12071            %VLP_NAME( FPTN=SEND, NAME='SEND', STCLASS=CONSTANT);
      422    12098            %VLP_ACCT( FPTN=COLON_SYS, ACCT=':SYS', STCLASS=CONSTANT);
      423    12111
      424    12112            %FPT_SETFMA( STCLASS=CONSTANT, ACCT=TCM_MESSACCT);
      425    12125
      426    12126            %FPT_TIME( FPTN=GET_TIMESTAMP, SOURCE=CLOCK, DEST=EXT,
      427    12127                       DATE=DATEBUF, TIME=TIMEBUF, DAY=DAYBUF, STCLASS=CONSTANT);
      428    12146            %FPT_TIME( FPTN=GET_UTS, SOURCE=CLOCK, DEST=UTS, TSTAMP=UTS, STCLASS=CONSTANT);
      429    12165            %FPT_TIME( FPTN=ANS2UTSVAL, STCLASS=CONSTANT,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:112  
      430    12166                    SOURCE=ANS, DATE="ANSBUF.DATE", TIME="ANSBUF.TIME",
      431    12167                    DEST=UTS, TSTAMP=UTSVAL);
      432    12186            %FPT_TIME( FPTN=UTSVAL2LCL, STCLASS=CONSTANT,
      433    12187                    SOURCE=UTS, TSTAMP=UTSVAL,
      434    12188                    DEST=LOCAL, DATE="LCLBUF.DATE", TIME="LCLBUF.TIME");
      435    12207
      436    12208            %FPT_SCREECH( FPTN=SCREECH1, SCODE=SUA1, STCLASS="CONSTANT SYMDEF");
      437    12222            %FPT_SCREECH( FPTN=SCREECH2, SCODE=SUA2, STCLASS="CONSTANT SYMDEF");
      438    12236            %VLP_SUA (FPTN=SUA1, SEV=5, LDCTS=YES, CWSPT=YES,
      439    12237                    FCG='TC', MID='M', CODE=1111, STCLASS=CONSTANT);
      440    12307            %VLP_SUA (FPTN=SUA2, SEV=5, LDCTS=YES, CWSPT=YES,
      441    12308                    FCG='TC', MID='M', CODE=2222, STCLASS=CONSTANT);
      442    12378
      443    12379            %FPT_PRIV( FPTN=JIT_PRIV, STCLASS="CONSTANT SYMDEF", PRIV=%PR_JIT#);
      444    12394
      445    12395            %FPT_INT( FPTN=SET_BREAK_CONTROL, UENTRY=TCM$ABORT, STCLASS=CONSTANT);
      446    12409            %FPT_WAIT( FPTN=WAIT_A_SECOND, UNITS=1, STCLASS=CONSTANT);
      447    12423            %FPT_WAIT( FPTN=WAIT_A_MIN, UNITS=60, STCLASS=CONSTANT);
      448    12437
      449    12438            %FPT_YC( FPTN=TCM_YC_OFF, CMD=OFFCMD, NOERR=YES, STCLASS="CONSTANT SYMDEF");
      450    12455
      451    12456            %FPT_KEYIN( FPTN=TCM_KEYIN, STCLASS="STATIC SYMDEF");
      452    12475
      453    12476            %FPT_PROMPT( FPTN=CLEAR_PROMPT, PROMPT=PROMPT, VFC=YES, STCLASS=CONSTANT);
      454    12504            %FPT_EOM( FPTN=SET_EOM_LF, EOMTABLE=UC_EOMTABLE, TIMEOUT=30, UTYPE=SEC);
      455    12534            %VLP_EOMTABLE( FPTN=UC_EOMTABLE, VALUES="0,36,0*14", STCLASS=CONSTANT);
             12534                /*CR&LF only*/
      456    12553            %FPT_TRMISC( FPTN=INHIBIT_OPERATOR_MESSAGES, STCLASS=CONSTANT,
      457    12554                         ANNOUNCE=NO, BROADCAST=NO, SEND=NO);
      458    12575            %FPT_TRMCTL( FPTN=SET_TRANS_EOM, TRMCTL=UC_TRMCTL, STCLASS=CONSTANT);
      459    12602            %VLP_TRMCTL( FPTN=UC_TRMCTL, ACTONTRN=YES);
      460    12642            %VM_KEYTYPES;
      461    12663            %VM_USERKEY;
      462    12679            %VM_LISTKEY;
      463    12695            %VM_LISTKEY( NAME=VM_SEARCHKEY);
      464    12711            %FPT_TRMCTL( TRMCTL=TRMCTL, STCLASS=CONSTANT);
      465    12738            %VLP_TRMCTL( FPTN=TRMCTL);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:113  
      466    12778
      467    12779            %FPT_ALIB( LIBNAME=DELTA_NAME, RETRN=NO, STCLASS=CONSTANT);
      468    12796            %VLP_NAME( FPTN=DELTA_NAME, NAME='DELTA', STCLASS=CONSTANT);
      469    12823
      470    12824            %FPT_ERRMSG( FPTN=FPT_ERRMSG, STCLASS=STATIC,
      471    12825                         SOURCE=PASS, RESULTS=VLR_ERRMSG, CODE=ERRCODE, BUF=OCMSG,
      472    12826                         FILENAME=VMERRMSG, FILEACCT=COLON_SYS);
      473    12853            %VLP_ERRCODE( FPTN=ERRCODE);
      474    12898            %VLP_NAME( FPTN=VMERRMSG, STCLASS=CONSTANT, NAME=':VMERRMSG');
      475    12925            %VLR_ERRMSG;
      476    12947            %FPT_ERRMSG( FPTN=FPT_XSERRMSG, STCLASS=STATIC,
      477    12948                         SOURCE=PASS, RESULTS=VLR_ERRMSG, CODE=ERRCODE, BUF=OCMSG,
      478    12949                         FILENAME=XSERRMSG, FILEACCT=COLON_SYS);
      479    12976            %VLP_NAME( FPTN=XSERRMSG, STCLASS=CONSTANT, NAME=':XSERRMSG');
      480    13003        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:114  
      481    13004            /******** INITIALIZATION */
      482    13005    1       CALL INDEX( UTS, '(DEBUG)', B$JIT.CCBUF)

  13005 10 000002   000730 631400 1                  EPPR1   UTS
        10 000003   001760 633400 2                  EPPR3   XSERRMSG+3
        10 000004   000007 223003                    LDX3    7,DU
        10 000005   000000 470400 xsym               LDP0    B$JIT$
        10 000006   000033 630500                    EPPR0   27,,PR0
        10 000007   000400 220003                    LDX0    256,DU
        10 000010   000000 236003                    LDQ     0,DU
        10 000011   000000 701000 xent               TSX1    X66_INDEX
        10 000012   000020 710000 10                 TRA     s:13011

      483    13006    2       WHENRETURN DO;

      484    13007    2           CALL M$ALIB( FPT_ALIB) ALTRET( DYING);

  13007 10 000013   001736 630400 2                  EPPR0   FPT_ALIB
        10 000014   400007 713400                    CLIMB   alt,+7
        10 000015   401400 401760                    pmme    nvectors=4
        10 000016   001533 702000 10                 TSX2    DYING

      485    13008    2           END;

  13008 10 000017   000020 710000 10                 TRA     s:13011

      486    13009    2       WHENALTRETURN DO;

      487    13010    2           END;

      488    13011    1       CALL INDEX( UTS, '(TCP)', B$JIT.CCBUF)

  13011 10 000020   000730 631400 1                  EPPR1   UTS
        10 000021   001762 633400 2                  EPPR3   XSERRMSG+5
        10 000022   000005 223003                    LDX3    5,DU
        10 000023   000000 470400 xsym               LDP0    B$JIT$
        10 000024   000033 630500                    EPPR0   27,,PR0
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:115  
        10 000025   000400 220003                    LDX0    256,DU
        10 000026   000000 236003                    LDQ     0,DU
        10 000027   000000 701000 xent               TSX1    X66_INDEX
        10 000030   000032 710000 10                 TRA     s:13015

      489    13012    2       WHENRETURN DO;

      490    13013    2           END;

  13013 10 000031   000041 710000 10                 TRA     s:13019

      491    13014    2       WHENALTRETURN DO;

      492    13015    2           TCM_TCPFLAVOR = %NO#;

  13015 10 000032   000000 450000 xsym               STZ     TCM_TCPFLAVOR

      493    13016    2           TCM_PROGNAME = 'MULMAIL';

  13016 10 000033   040000 100400                    MLR     fill='040'O
        10 000034   001764 000007 2                  ADSC9   XSERRMSG+7               cn=0,n=7
        10 000035   000220 000007 1                  ADSC9   TCM_PROGNAME             cn=0,n=7

      494    13017    2           CALL INSERT( REPLY998.TEXT, 4, 7, TCM_PROGNAME);

  13017 10 000036   040000 100400                    MLR     fill='040'O
        10 000037   000220 000007 1                  ADSC9   TCM_PROGNAME             cn=0,n=7
        10 000040   000711 200007 1                  ADSC9   REPLY998+1               cn=1,n=7

      495    13018    2           END;

      496    13019    1       CALL TCM$WRITE_AUDIT_ON;

  13019 10 000041   000002 631400 xsym               EPPR1   B_VECTNIL+2
        10 000042   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_ON
        10 000043   000000 011000                    NOP     0

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:116  
      497    13020    1       IF NOT TCM_TCPFLAVOR THEN

  13020 10 000044   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 000045   000061 604000 10                 TMI     s:13028

      498    13021    2           IF B$JIT.TSLINE.LEV > 1 THEN DO;

  13021 10 000046   000000 470400 xsym               LDP0    B$JIT$
        10 000047   000340 236100                    LDQ     224,,PR0
        10 000050   777000 376003                    ANQ     -512,DU
        10 000051   002000 116003                    CMPQ    1024,DU
        10 000052   000060 602000 10                 TNC     s:13027

      499    13022                    /* subdevice info is valid */
      500    13023    2               X_29 = %YES#;

  13023 10 000053   400000 236003                    LDQ     -131072,DU
        10 000054   200014 756100                    STQ     X_29,,AUTO

      501    13024    2               XUG_INIT.ECHO# = %NEVER_ECHO#;

  13024 10 000055   002000 236003                    LDQ     1024,DU
        10 000056   000113 552040 1                  STBQ    XUG_INIT+21,'40'O

      502    13025    2               END;

  13025 10 000057   000061 710000 10                 TRA     s:13028

      503    13026    1           ELSE
      504    13027    1               X_29 = %NO#;

  13027 10 000060   200014 450100                    STZ     X_29,,AUTO

      505    13028    2       IF B$JIT.ACCN = TCM_ACCOUNT.ACCT# THEN DO;

  13028 10 000061   000000 470400 xsym               LDP0    B$JIT$
        10 000062   040000 106500                    CMPC    fill='040'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:117  
        10 000063   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        10 000064   003526 000010 1                  ADSC9   TCM_ACCOUNT              cn=0,n=8
        10 000065   000076 601000 10                 TNZ     s:13034

      506    13029    3           IF NOT TCM_TCPFLAVOR THEN DO;

  13029 10 000066   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 000067   000076 604000 10                 TMI     s:13034

      507    13030    3               CALL M$INT( SET_BREAK_CONTROL) ALTRET( DYING);

  13030 10 000070   001636 630400 2                  EPPR0   SET_BREAK_CONTROL
        10 000071   410002 713400                    CLIMB   alt,+4098
        10 000072   400000 401760                    pmme    nvectors=1
        10 000073   001533 702000 10                 TSX2    DYING

      508    13031    3               READ_UC.V.DVBYTE.TRANS# = %YES#;

  13031 10 000074   020000 236003                    LDQ     8192,DU
        10 000075   003461 256000 1                  ORSQ    READ_UC+11

      509    13032    3               END;

      510    13033    2           END;

      511    13034    1       M$SI$ = DCBADDR( DCBNUM( M$SI));

  13034 10 000076   000000 236007 xsym               LDQ     M$SI,DL
        10 000077   000000 470400 11                 LDP0    0
        10 000100   000000 471500                    LDP1    0,,PR0
        10 000101   100000 236106                    LDQ     0,QL,PR1
        10 000102   200003 756100                    STQ     M$SI$,,AUTO

      512    13035    2       IF DCBADDR( DCBNUM( M$SI))->F$DCB.ASN# = %DEVICE# THEN DO;

  13035 10 000103   000000 236007 xsym               LDQ     M$SI,DL
        10 000104   100000 473506                    LDP3    0,QL,PR1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:118  
        10 000105   300032 236100                    LDQ     26,,PR3
        10 000106   777000 376007                    ANQ     -512,DL
        10 000107   003000 116007                    CMPQ    1536,DL
        10 000110   000117 601000 10                 TNZ     s:13041

      513    13036    2           CMDBUF = 'No config file specified on invocation.  I quit.';

  13036 10 000111   040100 100400                    MLR     fill='040'O
        10 000112   001766 000060 2                  ADSC9   XSERRMSG+9               cn=0,n=48
        10 000113   221426 000377                    ADSC9   CMDBUF,,AUTO             cn=0,n=255

      514    13037    2           CALL WRITEDO;

  13037 10 000114   013014 701000 10                 TSX1    WRITEDO
        10 000115   000000 011000                    NOP     0

      515    13038    2           GOTO DYING;

  13038 10 000116   001533 710000 10                 TRA     DYING

      516    13039    2           END;
      517    13040    1       ELSE
      518    13041    1           TCM_MESSACCT.ACCT# = M$SI$->F$DCB.ACCT#;

  13041 10 000117   200003 473500                    LDP3    M$SI$,,AUTO
        10 000120   300020 237100                    LDAQ    16,,PR3
        10 000121   003530 757000 1                  STAQ    TCM_MESSACCT

      519    13042    1       IF NOT TCM_TCPFLAVOR THEN

  13042 10 000122   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 000123   000141 604000 10                 TMI     s:13048

      520    13043    1           IF TCM_DRIBBLE THEN

  13043 10 000124   000216 235000 1                  LDA     TCM_DRIBBLE
        10 000125   000133 600000 10                 TZE     s:13046
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:119  

      521    13044    1               CALL M$OPEN( OPEN_DRIBBLE) ALTRET( DYING);

  13044 10 000126   001112 630400 2                  EPPR0   OPEN_DRIBBLE
        10 000127   450000 713400                    CLIMB   alt,open
        10 000130   410400 401760                    pmme    nvectors=18
        10 000131   001533 702000 10                 TSX2    DYING
        10 000132   000141 710000 10                 TRA     s:13048

      522    13045    1           ELSE
      523    13046    1               IF TCM_DRIBBLE_ME THEN

  13046 10 000133   000217 235000 1                  LDA     TCM_DRIBBLE_ME
        10 000134   000141 600000 10                 TZE     s:13048

      524    13047    1                   CALL M$OPEN( OPEN_DRIBBLE_ME) ALTRET( DYING);

  13047 10 000135   001020 630400 2                  EPPR0   OPEN_DRIBBLE_ME
        10 000136   450000 713400                    CLIMB   alt,open
        10 000137   410400 401760                    pmme    nvectors=18
        10 000140   001533 702000 10                 TSX2    DYING

      525    13048    1       CALL M$SETFMA( FPT_SETFMA);

  13048 10 000141   001526 630400 2                  EPPR0   FPT_SETFMA
        10 000142   060001 713400                    CLIMB   24577
        10 000143   400400 401760                    pmme    nvectors=2

      526    13049    1       CALL INITIALIZE_CONFIGURATION ALTRET( DYING);

  13049 10 000144   001547 701000 10                 TSX1    INITIALIZE_CONFIGURATION
        10 000145   001533 702000 10                 TSX2    DYING

      527    13050    1       CALL M$SPRIV( JIT_PRIV)

  13050 10 000146   001632 630400 2                  EPPR0   JIT_PRIV
        10 000147   420012 713400                    CLIMB   alt,+8202
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:120  
        10 000150   400000 401760                    pmme    nvectors=1
        10 000151   000162 702000 10                 TSX2    s:13058

      528    13051    2       WHENRETURN DO;

      529    13052    2           B$JIT.PRIV.ACTIVE.FMREAD = %YES#;  /* :NODES, ALIAS files */

  13052 10 000152   000000 470400 xsym               LDP0    B$JIT$
        10 000153   020000 236003                    LDQ     8192,DU
        10 000154   000013 256100                    ORSQ    11,,PR0

      530    13053    2           B$JIT.PRIV.JOB.FMSEC = %YES#;  /* needed later for SEND */

  13053 10 000155   100000 236003                    LDQ     32768,DU
        10 000156   000015 256100                    ORSQ    13,,PR0

      531    13054    2           B$JIT.MAXTMPDP = BITBIN( '377777777777'O) /* MAX INTEGER */;

  13054 10 000157   000031 235000 xsym               LDA     B_VECTNIL+25
        10 000160   000241 755100                    STA     161,,PR0

      532    13055    2           END;

  13055 10 000161   000162 710000 10                 TRA     s:13058

      533    13056    2       WHENALTRETURN DO;

      534    13057    2           END;

      535    13058    1       CALL CONCAT( STATUS, TCM_PROGNAME, ':Idle');

  13058 10 000162   040000 100400                    MLR     fill='040'O
        10 000163   000220 000007 1                  ADSC9   TCM_PROGNAME             cn=0,n=7
        10 000164   003367 000007 1                  ADSC9   STATUS_LINE              cn=0,n=7
        10 000165   040000 100400                    MLR     fill='040'O
        10 000166   002002 000005 2                  ADSC9   XSERRMSG+21              cn=0,n=5
        10 000167   003370 600056 1                  ADSC9   STATUS_LINE+1            cn=3,n=46
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:121  

      536    13059    1       CALL STATUS_LINE_UPDATE;

  13059 10 000170   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 000171   000000 011000                    NOP     0

      537    13060    1       CALL M$OPEN( OPEN_NODES)

  13060 10 000172   000634 630400 2                  EPPR0   OPEN_NODES
        10 000173   450000 713400                    CLIMB   alt,open
        10 000174   410400 401760                    pmme    nvectors=18
        10 000175   000211 702000 10                 TSX2    s:13069

      538    13061    2       WHENRETURN DO;

      539    13062    2           NODES_FILE_OPEN = %YES#;

  13062 10 000176   400000 236003                    LDQ     -131072,DU
        10 000177   200013 756100                    STQ     NODES_FILE_OPEN,,AUTO

      540    13063    2           NODES_KEY.SITE = '*IAM';

  13063 10 000200   040000 100400                    MLR     fill='040'O
        10 000201   002004 000004 2                  ADSC9   XSERRMSG+23              cn=0,n=4
        10 000202   003405 200010 1                  ADSC9   NODES_KEY                cn=1,n=8

      541    13064    2           CALL M$READ( READ_NODES)

  13064 10 000203   000732 630400 2                  EPPR0   READ_NODES
        10 000204   440000 713400                    CLIMB   alt,read
        10 000205   401400 401760                    pmme    nvectors=4
        10 000206   000210 702000 10                 TSX2    s:13067
        10 000207   000210 710000 10                 TRA     s:13067

      542    13065    3           WHENALTRETURN DO;

      543    13066    3               END;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:122  

      544    13067    2           END;

  13067 10 000210   000212 710000 10                 TRA     s:13071

      545    13068    2       WHENALTRETURN DO;

      546    13069    2           NODES_FILE_OPEN = %NO#;

  13069 10 000211   200013 450100                    STZ     NODES_FILE_OPEN,,AUTO

      547    13070    2           END;

      548    13071    2       IF TCM_TCPFLAVOR THEN DO;

  13071 10 000212   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 000213   000233 605000 10                 TPL     s:13076

      549    13072    2           CALL INDEX( UTS, 'Line', REPLY220.TEXT) ALTRET( DYING);

  13072 10 000214   000730 631400 1                  EPPR1   UTS
        10 000215   002005 633400 2                  EPPR3   XSERRMSG+24
        10 000216   000004 223003                    LDX3    4,DU
        10 000217   000257 630400 1                  EPPR0   REPLY220
        10 000220   000001 220003                    LDX0    1,DU
        10 000221   000000 500510                    A9BD    0,X0,PR0
        10 000222   000075 220003                    LDX0    61,DU
        10 000223   000000 236003                    LDQ     0,DU
        10 000224   000000 701000 xent               TSX1    X66_INDEX
        10 000225   001533 710000 10                 TRA     DYING

      550    13073    2           REPLY220.COUNT = UTS - 1;

  13073 10 000226   000730 236000 1                  LDQ     UTS
        10 000227   000001 136007                    SBLQ    1,DL
        10 000230   000033 736000                    QLS     27
        10 000231   000257 552040 1                  STBQ    REPLY220,'40'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:123  

      551    13074    2           END;

  13074 10 000232   000236 710000 10                 TRA     s:13077

      552    13075    1       ELSE
      553    13076    1           MY_SITE_NAME = TCM_SITENAME;

  13076 10 000233   040000 100400                    MLR     fill='040'O
        10 000234   000731 000010 1                  ADSC9   TCM_SITENAME             cn=0,n=8
        10 000235   003265 000010 1                  ADSC9   MY_SITE_NAME             cn=0,n=8

      554    13077    1       CALL INDEX( MY_SITE_NAME_L, ' ', MY_SITE_NAME);

  13077 10 000236   000000 124400                    SCM     mask='000'O
        10 000237   003265 000010 1                  ADSC9   MY_SITE_NAME             cn=0,n=8
        10 000240   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 000241   221420 000100                    ARG     MY_SITE_NAME_L,,AUTO

      555    13078    1       CALL INSERT( REPLY220.TEXT, 4, 8, MY_SITE_NAME);

  13078 10 000242   040000 100400                    MLR     fill='040'O
        10 000243   003265 000010 1                  ADSC9   MY_SITE_NAME             cn=0,n=8
        10 000244   000260 200010 1                  ADSC9   REPLY220+1               cn=1,n=8

      556    13079    1       CALL INSERT( REPLY221.TEXT, 4, MY_SITE_NAME_L, MY_SITE_NAME);

  13079 10 000245   221420 720100                    LXL0    MY_SITE_NAME_L,,AUTO
        10 000246   040040 100400                    MLR     fill='040'O
        10 000247   003265 000010 1                  ADSC9   MY_SITE_NAME             cn=0,n=8
        10 000250   000300 200010 1                  ADSC9   REPLY221+1               cn=1,n=*X0

      557    13080    1       CALL INSERT( REPLY250A.TEXT, 4, MY_SITE_NAME_L, MY_SITE_NAME);

  13080 10 000251   040040 100400                    MLR     fill='040'O
        10 000252   003265 000010 1                  ADSC9   MY_SITE_NAME             cn=0,n=8
        10 000253   000332 200010 1                  ADSC9   REPLY250A+1              cn=1,n=*X0
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:124  

      558    13081    1       CALL INSERT( REPLY421.TEXT, 4, MY_SITE_NAME_L, MY_SITE_NAME);

  13081 10 000254   040040 100400                    MLR     fill='040'O
        10 000255   003265 000010 1                  ADSC9   MY_SITE_NAME             cn=0,n=8
        10 000256   000444 200010 1                  ADSC9   REPLY421+1               cn=1,n=*X0

      559    13082    1       CALL INSERT( REPLY421ZAP.TEXT, 4, MY_SITE_NAME_L, MY_SITE_NAME);

  13082 10 000257   040040 100400                    MLR     fill='040'O
        10 000260   003265 000010 1                  ADSC9   MY_SITE_NAME             cn=0,n=8
        10 000261   000476 200010 1                  ADSC9   REPLY421ZAP+1            cn=1,n=*X0

      560    13083    1       CALL CONCAT( MY_SITE_NAME_2, ' by ',

  13083 10 000262   002006 236000 2                  LDQ     XSERRMSG+25
        10 000263   221421 756100                    STQ     MY_SITE_NAME_2,,AUTO
        10 000264   040100 100440                    MLR     fill='040'O
        10 000265   003265 000010 1                  ADSC9   MY_SITE_NAME             cn=0,n=*X0
        10 000266   221422 000020                    ADSC9   MY_SITE_NAME_2+1,,AUTO   cn=0,n=16
        10 000267   221420 236100                    LDQ     MY_SITE_NAME_L,,AUTO
        10 000270   000020 116007                    CMPQ    16,DL
        10 000271   000277 603000 10                 TRC     s:13085
        10 000272   777757 621006                    EAX1    -17,QL
        10 000273   777777 661003                    ERX1    -1,DU
        10 000274   040146 100400                    MLR     fill='040'O
        10 000275   002007 000014 2                  ADSC9   XSERRMSG+26              cn=0,n=12
        10 000276   221422 000011                    ADSC9   MY_SITE_NAME_2+1,Q,AUTO  cn=0,n=*X1

      561    13084    1               SUBSTR( MY_SITE_NAME, 0, MY_SITE_NAME_L), ' with SMTP; ');
      562    13085    1       CALL XUR$INIT( XUR_INIT);

  13085 10 000277   000001 630400 11                 EPPR0   1
        10 000300   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000301   000000 701000 xent               TSX1    XUR$INIT
        10 000302   000000 011000                    NOP     0

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:125  
      563    13086    1       CALL XSL$SOCKINIT( TCM_SOCKINIT);

  13086 10 000303   000002 630400 11                 EPPR0   2
        10 000304   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000305   000000 701000 xent               TSX1    XSL$SOCKINIT
        10 000306   000000 011000                    NOP     0

      564    13087    2       IF TCM_TCPFLAVOR THEN DO;

  13087 10 000307   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 000310   000576 605000 10                 TPL     s:13165

      565    13088    2   AGAIN:
      566    13089                /* OPEN SOCKET, WAIT FOR CONNECTION */
      567    13090    2           LS = %NO#;

  13090 10 000311   000000 235003       AGAIN        LDA     0,DU
        10 000312   000000 236003                    LDQ     0,DU
        10 000313   000206 757000 1                  STAQ    LS

      568    13091    2           FS = %NO#;

  13091 10 000314   000000 235003                    LDA     0,DU
        10 000315   000000 236003                    LDQ     0,DU
        10 000316   000204 757000 1                  STAQ    FS

      569    13092    2           LS.PORT = %TCP$WKS$SMTP;

  13092 10 000317   000144 236003                    LDQ     100,DU
        10 000320   000207 756000 1                  STQ     LS+1

      570    13093    2           IF FEPNAMES(0) = ' ' THEN

  13093 10 000321   040000 106400                    CMPC    fill='040'O
        10 000322   000235 000014 1                  ADSC9   FEPNAMES                 cn=0,n=12
        10 000323   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 000324   000336 601000 10                 TNZ     s:13096
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:126  

      571    13094    2               CALL XSL$GETHOSTBYNAME( TMP$, LOCALHOSTNAME);

  13094 10 000325   000003 236000 11                 LDQ     3
        10 000326   222251 756100                    STQ     TVAL+2,,AUTO
        10 000327   200006 630500                    EPPR0   TMP$,,AUTO
        10 000330   222250 450500                    STP0    TVAL+1,,AUTO
        10 000331   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 000332   000020 631400 xsym               EPPR1   B_VECTNIL+16
        10 000333   000000 701000 xent               TSX1    XSL$GETHOSTBYNAME
        10 000334   000000 011000                    NOP     0
        10 000335   000346 710000 10                 TRA     s:13097

      572    13095    2           ELSE
      573    13096    2               CALL XSL$GETHOSTBYNAME( TMP$, FEPNAMES(0));

  13096 10 000336   000004 236000 11                 LDQ     4
        10 000337   222251 756100                    STQ     TVAL+2,,AUTO
        10 000340   200006 630500                    EPPR0   TMP$,,AUTO
        10 000341   222250 450500                    STP0    TVAL+1,,AUTO
        10 000342   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 000343   000020 631400 xsym               EPPR1   B_VECTNIL+16
        10 000344   000000 701000 xent               TSX1    XSL$GETHOSTBYNAME
        10 000345   000000 011000                    NOP     0

      574    13097    3           IF TMP$ = ADDR( NIL) THEN DO;

  13097 10 000346   200006 236100                    LDQ     TMP$,,AUTO
        10 000347   000001 116000 xsym               CMPQ    B_VECTNIL+1
        10 000350   000406 601000 10                 TNZ     s:13108

      575    13098    3               IF FEPNAMES(0) = ' ' THEN

  13098 10 000351   040000 106400                    CMPC    fill='040'O
        10 000352   000235 000014 1                  ADSC9   FEPNAMES                 cn=0,n=12
        10 000353   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 000354   000364 601000 10                 TNZ     s:13102
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:127  

      576    13099    3                   CALL CONCAT( STATUS, TCM_PROGNAME,

  13099 10 000355   040000 100400                    MLR     fill='040'O
        10 000356   000220 000007 1                  ADSC9   TCM_PROGNAME             cn=0,n=7
        10 000357   003367 000007 1                  ADSC9   STATUS_LINE              cn=0,n=7
        10 000360   040000 100400                    MLR     fill='040'O
        10 000361   002012 000050 2                  ADSC9   XSERRMSG+29              cn=0,n=40
        10 000362   003370 600056 1                  ADSC9   STATUS_LINE+1            cn=3,n=46
        10 000363   000400 710000 10                 TRA     s:13104

      577    13100    3                           ': etc:hosts has no entry for "localhost"');
      578    13101    3               ELSE
      579    13102    3                   CALL CONCAT( STATUS, TCM_PROGNAME,

  13102 10 000364   040000 100400                    MLR     fill='040'O
        10 000365   000220 000007 1                  ADSC9   TCM_PROGNAME             cn=0,n=7
        10 000366   003367 000007 1                  ADSC9   STATUS_LINE              cn=0,n=7
        10 000367   040000 100400                    MLR     fill='040'O
        10 000370   002012 000036 2                  ADSC9   XSERRMSG+29              cn=0,n=30
        10 000371   003370 600036 1                  ADSC9   STATUS_LINE+1            cn=3,n=30
        10 000372   040000 100400                    MLR     fill='040'O
        10 000373   000235 000014 1                  ADSC9   FEPNAMES                 cn=0,n=12
        10 000374   003400 200014 1                  ADSC9   STATUS_LINE+9            cn=1,n=12
        10 000375   040000 100400                    MLR     fill='040'O
        10 000376   000005 000001 11                 ADSC9   5                        cn=0,n=1
        10 000377   003403 200004 1                  ADSC9   STATUS_LINE+12           cn=1,n=4

      580    13103    3                           ': etc:hosts has no entry for "', FEPNAMES(0), '"');
      581    13104    3               CALL STATUS_LINE_UPDATE;

  13104 10 000400   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 000401   000000 011000                    NOP     0

      582    13105    3               CALL M$WAIT( WAIT_A_MIN);

  13105 10 000402   001650 630400 2                  EPPR0   WAIT_A_MIN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:128  
        10 000403   020006 713400                    CLIMB   8198
        10 000404   400400 401760                    pmme    nvectors=2

      583    13106    3               GOTO AGAIN;

  13106 10 000405   000311 710000 10                 TRA     AGAIN

      584    13107    3               END;
      585    13108    2           CALL XSL$NTOHL( HEX1, XSL$HOSTENT.H_ADDR_LIST$->B$PTR->B$UBIN);

  13108 10 000406   200006 470500                    LDP0    TMP$,,AUTO
        10 000407   000004 471500                    LDP1    4,,PR0
        10 000410   100000 473500                    LDP3    0,,PR1
        10 000411   222251 453500                    STP3    TVAL+2,,AUTO
        10 000412   221533 631500                    EPPR1   HEX1,,AUTO
        10 000413   222250 451500                    STP1    TVAL+1,,AUTO
        10 000414   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 000415   000020 631400 xsym               EPPR1   B_VECTNIL+16
        10 000416   000000 701000 xent               TSX1    XSL$NTOHL
        10 000417   000000 011000                    NOP     0

      586    13109    2           LS.ADDRESS = HEX1;

  13109 10 000420   221533 235100                    LDA     HEX1,,AUTO
        10 000421   000004 735000                    ALS     4
        10 000422   000206 755000 1                  STA     LS

      587    13110    2           CALL TCP$OPEN( TCM_CMD_LCN, LS, FS, %TCP_SERVER)

  13110 10 000423   000006 630400 11                 EPPR0   6
        10 000424   000022 631400 xsym               EPPR1   B_VECTNIL+18
        10 000425   000000 701000 xent               TSX1    TCP$OPEN
        10 000426   000430 702000 10                 TSX2    s:13112
        10 000427   000450 710000 10                 TRA     s:13119

      588    13111    3           WHENALTRETURN DO;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:129  
      589    13112    3               CALL CONCAT( STATUS, TCM_PROGNAME, ':Unable to open to socket');

  13112 10 000430   040000 100400                    MLR     fill='040'O
        10 000431   000220 000007 1                  ADSC9   TCM_PROGNAME             cn=0,n=7
        10 000432   003367 000007 1                  ADSC9   STATUS_LINE              cn=0,n=7
        10 000433   040000 100400                    MLR     fill='040'O
        10 000434   002024 000031 2                  ADSC9   XSERRMSG+39              cn=0,n=25
        10 000435   003370 600056 1                  ADSC9   STATUS_LINE+1            cn=3,n=46

      590    13113    3               CALL STATUS_LINE_UPDATE;

  13113 10 000436   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 000437   000000 011000                    NOP     0

      591    13114    3               CALL TCP$RELEASE( TCM_CMD_LCN);

  13114 10 000440   000006 630400 11                 EPPR0   6
        10 000441   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000442   000000 701000 xent               TSX1    TCP$RELEASE
        10 000443   000000 011000                    NOP     0

      592    13115    3               CALL M$WAIT( WAIT_A_MIN);

  13115 10 000444   001650 630400 2                  EPPR0   WAIT_A_MIN
        10 000445   020006 713400                    CLIMB   8198
        10 000446   400400 401760                    pmme    nvectors=2

      593    13116    3               GOTO AGAIN;

  13116 10 000447   000311 710000 10                 TRA     AGAIN

      594    13117    3               END;
      595    13118
      596    13119    2           CALL TCP$USER_TIMEOUT(24*60*60);  /* A DAY */

  13119 10 000450   000013 630400 11                 EPPR0   11
        10 000451   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:130  
        10 000452   000000 701000 xent               TSX1    TCP$USER_TIMEOUT
        10 000453   000000 011000                    NOP     0

      597    13120    2           CALL STATUS_LINE_IDLE;

  13120 10 000454   012767 701000 10                 TSX1    STATUS_LINE_IDLE
        10 000455   000000 011000                    NOP     0

      598    13121    2           OLD_CMD_LCN = TCM_CMD_LCN;

  13121 10 000456   000000 235000 xsym               LDA     TCM_CMD_LCN
        10 000457   000210 755000 1                  STA     OLD_CMD_LCN

      599    13122    2   REREAD:
      600    13123    2           TCM_CMD_LCN = OLD_CMD_LCN;

  13123 10 000460   000210 235000 1     REREAD       LDA     OLD_CMD_LCN
        10 000461   000000 755000 xsym               STA     TCM_CMD_LCN

      601    13124    2           MSG_COUNT = 0;

  13124 10 000462   000726 450000 1                  STZ     MSG_COUNT

      602    13125    2           CALL TCP$READ( TCM_CMD_LCN, VECTOR( LINEBUF), CB)

  13125 10 000463   000016 630400 11                 EPPR0   14
        10 000464   000021 631400 xsym               EPPR1   B_VECTNIL+17
        10 000465   000000 701000 xent               TSX1    TCP$READ
        10 000466   000470 702000 10                 TSX2    s:13128
        10 000467   000514 710000 10                 TRA     s:13137

      603    13126    3           WHENALTRETURN DO;

      604    13127                    /* PROBABLY TCP GHOST DIED */
      605    13128    3               CALL CONCAT( STATUS, TCM_PROGNAME, ':Error on read');

  13128 10 000470   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:131  
        10 000471   000220 000007 1                  ADSC9   TCM_PROGNAME             cn=0,n=7
        10 000472   003367 000007 1                  ADSC9   STATUS_LINE              cn=0,n=7
        10 000473   040000 100400                    MLR     fill='040'O
        10 000474   002033 000016 2                  ADSC9   XSERRMSG+46              cn=0,n=14
        10 000475   003370 600056 1                  ADSC9   STATUS_LINE+1            cn=3,n=46

      606    13129    3               CALL STATUS_LINE_UPDATE;

  13129 10 000476   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 000477   000000 011000                    NOP     0

      607    13130    3               CALL TCP$RELEASE( TCM_CMD_LCN);

  13130 10 000500   000006 630400 11                 EPPR0   6
        10 000501   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000502   000000 701000 xent               TSX1    TCP$RELEASE
        10 000503   000000 011000                    NOP     0

      608    13131    3               CALL M$WAIT( WAIT_A_MIN);

  13131 10 000504   001650 630400 2                  EPPR0   WAIT_A_MIN
        10 000505   020006 713400                    CLIMB   8198
        10 000506   400400 401760                    pmme    nvectors=2

      609    13132    3               IF TCM_CMD_LCN = OLD_CMD_LCN THEN

  13132 10 000507   000000 236000 xsym               LDQ     TCM_CMD_LCN
        10 000510   000513 604000 10                 TMI     s:13134
        10 000511   000210 116000 1                  CMPQ    OLD_CMD_LCN
        10 000512   000311 600000 10                 TZE     AGAIN

      610    13133    3                   GOTO AGAIN;
      611    13134    3               GOTO REREAD;

  13134 10 000513   000460 710000 10                 TRA     REREAD

      612    13135    3               END;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:132  
      613    13136
      614    13137    3           IF( ~CB.ADMIN) THEN DO;

  13137 10 000514   000211 236000 1                  LDQ     CB
        10 000515   400000 376003                    ANQ     -131072,DU
        10 000516   400000 676003                    ERQ     -131072,DU
        10 000517   000535 600000 10                 TZE     s:13144

      615    13138    3               CALL CONCAT( STATUS, TCM_PROGNAME, ':Unexpected response to connect');

  13138 10 000520   040000 100400                    MLR     fill='040'O
        10 000521   000220 000007 1                  ADSC9   TCM_PROGNAME             cn=0,n=7
        10 000522   003367 000007 1                  ADSC9   STATUS_LINE              cn=0,n=7
        10 000523   040000 100400                    MLR     fill='040'O
        10 000524   002037 000037 2                  ADSC9   XSERRMSG+50              cn=0,n=31
        10 000525   003370 600056 1                  ADSC9   STATUS_LINE+1            cn=3,n=46

      616    13139    3               CALL STATUS_LINE_UPDATE;

  13139 10 000526   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 000527   000000 011000                    NOP     0

      617    13140    3               CALL TCP$RELEASE( TCM_CMD_LCN);

  13140 10 000530   000006 630400 11                 EPPR0   6
        10 000531   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000532   000000 701000 xent               TSX1    TCP$RELEASE
        10 000533   000000 011000                    NOP     0

      618    13141    3               GOTO REREAD;

  13141 10 000534   000460 710000 10                 TRA     REREAD

      619    13142    3               END;
      620    13143
      621    13144    2           TCM_CMD_LCN = ADDR( LINEBUF)->TCP$ADMIN.NEWLCN;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:133  
  13144 10 000535   001530 235000 1                  LDA     LINEBUF+3
        10 000536   000000 755000 xsym               STA     TCM_CMD_LCN

      622    13145
      623    13146    2           CALL STATUS_LINE_IDLE;

  13146 10 000537   012767 701000 10                 TSX1    STATUS_LINE_IDLE
        10 000540   000000 011000                    NOP     0

      624    13147    2           IF TCM_DRIBBLE THEN

  13147 10 000541   000216 235000 1                  LDA     TCM_DRIBBLE
        10 000542   000550 600000 10                 TZE     s:13150

      625    13148    2               CALL M$OPEN( OPEN_DRIBBLE) ALTRET( DYING);

  13148 10 000543   001112 630400 2                  EPPR0   OPEN_DRIBBLE
        10 000544   450000 713400                    CLIMB   alt,open
        10 000545   410400 401760                    pmme    nvectors=18
        10 000546   001533 702000 10                 TSX2    DYING
        10 000547   000556 710000 10                 TRA     s:13152

      626    13149    2           ELSE
      627    13150    2               IF TCM_DRIBBLE_ME THEN

  13150 10 000550   000217 236000 1                  LDQ     TCM_DRIBBLE_ME
        10 000551   000556 600000 10                 TZE     s:13152

      628    13151    2                   CALL M$OPEN( OPEN_DRIBBLE_ME) ALTRET( DYING);

  13151 10 000552   001020 630400 2                  EPPR0   OPEN_DRIBBLE_ME
        10 000553   450000 713400                    CLIMB   alt,open
        10 000554   410400 401760                    pmme    nvectors=18
        10 000555   001533 702000 10                 TSX2    DYING

      629    13152    2           CALL M$OPEN( OPEN_NODES)

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:134  
  13152 10 000556   000634 630400 2                  EPPR0   OPEN_NODES
        10 000557   450000 713400                    CLIMB   alt,open
        10 000560   410400 401760                    pmme    nvectors=18
        10 000561   000575 702000 10                 TSX2    s:13161

      630    13153    3           WHENRETURN DO;

      631    13154    3               NODES_FILE_OPEN = %YES#;

  13154 10 000562   400000 236003                    LDQ     -131072,DU
        10 000563   200013 756100                    STQ     NODES_FILE_OPEN,,AUTO

      632    13155    3               NODES_KEY.SITE = '*IAM';

  13155 10 000564   040000 100400                    MLR     fill='040'O
        10 000565   002004 000004 2                  ADSC9   XSERRMSG+23              cn=0,n=4
        10 000566   003405 200010 1                  ADSC9   NODES_KEY                cn=1,n=8

      633    13156    3               CALL M$READ( READ_NODES)

  13156 10 000567   000732 630400 2                  EPPR0   READ_NODES
        10 000570   440000 713400                    CLIMB   alt,read
        10 000571   401400 401760                    pmme    nvectors=4
        10 000572   000574 702000 10                 TSX2    s:13159
        10 000573   000574 710000 10                 TRA     s:13159

      634    13157    4               WHENALTRETURN DO;

      635    13158    4                   END;

      636    13159    3               END;

  13159 10 000574   000576 710000 10                 TRA     s:13165

      637    13160    3           WHENALTRETURN DO;

      638    13161    3               NODES_FILE_OPEN = %NO#;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:135  

  13161 10 000575   200013 450100                    STZ     NODES_FILE_OPEN,,AUTO

      639    13162    3               END;

      640    13163    2           END;

      641    13164
      642    13165    1       CALL M$TIME( GET_TIMESTAMP);

  13165 10 000576   001532 630400 2                  EPPR0   GET_TIMESTAMP
        10 000577   020004 713400                    CLIMB   8196
        10 000600   402000 401760                    pmme    nvectors=5

      643    13166    1       SUBSTR( REPLY220.TEXT, 28, 8) = TIMESTRING;

  13166 10 000601   040000 100400                    MLR     fill='040'O
        10 000602   003413 000010 1                  ADSC9   TIMEBUF                  cn=0,n=8
        10 000603   000266 200010 1                  ADSC9   REPLY220+7               cn=1,n=8

      644    13167    1       SUBSTR( REPLY220.TEXT, 37, 10) = DATESTRING;

  13167 10 000604   040000 100400                    MLR     fill='040'O
        10 000605   003410 000012 1                  ADSC9   DATEBUF                  cn=0,n=10
        10 000606   000270 400012 1                  ADSC9   REPLY220+9               cn=2,n=10

      645    13168    2       IF NOT TCM_TCPFLAVOR THEN DO;

  13168 10 000607   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 000610   000705 604000 10                 TMI     s:13189

      646    13169                /********* MULTICS EXPECTS TWO "PROMPTS" *********/
      647    13170    2           CALL INDEX( UTS, 'ff', REPLY220.TEXT) ALTRET( DYING);

  13170 10 000611   000000 120400                    SCD
        10 000612   000257 200075 1                  ADSC9   REPLY220                 cn=1,n=61
        10 000613   002047 000002 2                  ADSC9   XSERRMSG+58              cn=0,n=2
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:136  
        10 000614   000730 000000 1                  ARG     UTS
        10 000615   000620 607000 10                 TTF     s:13171
        10 000616   000730 054000 1                  AOS     UTS
        10 000617   001533 710000 10                 TRA     DYING

      648    13171    2           CALL BINCHAR( SUBSTR( REPLY220.TEXT, UTS, 2), B$JIT.TSLINE.FEX);

  13171 10 000620   000000 470400 xsym               LDP0    B$JIT$
        10 000621   000337 236100                    LDQ     223,,PR0
        10 000622   000033 772000                    QRL     27
        10 000623   000000 235003                    LDA     0,DU
        10 000624   222250 757100                    STAQ    TVAL+1,,AUTO
        10 000625   000730 235000 1                  LDA     UTS
        10 000626   000005 301500                    BTD
        10 000627   222250 000010                    NDSC9   TVAL+1,,AUTO             cn=0,s=lsgnf,sf=0,n=8
        10 000630   000257 230002 1                  NDSC9   REPLY220,A               cn=1,s=nosgn,sf=0,n=2

      649    13172    2           HEX1 = B$JIT.TSLINE.PORT;

  13172 10 000631   000337 236100                    LDQ     223,,PR0
        10 000632   777777 376007                    ANQ     -1,DL
        10 000633   221533 756100                    STQ     HEX1,,AUTO

      650    13173    3           DO HEX2 = 1 TO 4;

  13173 10 000634   000001 235007                    LDA     1,DL
        10 000635   221534 755100                    STA     HEX2,,AUTO

      651    13174    3               SUBSTR( REPLY220.TEXT, UTS + 7 - HEX2, 1) =

  13174 10 000636   000730 236000 1                  LDQ     UTS
        10 000637   221534 136100                    SBLQ    HEX2,,AUTO
        10 000640   222250 756100                    STQ     TVAL+1,,AUTO
        10 000641   221533 236100                    LDQ     HEX1,,AUTO
        10 000642   000017 376007                    ANQ     15,DL
        10 000643   222250 235100                    LDA     TVAL+1,,AUTO
        10 000644   040005 100406                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:137  
        10 000645   000420 000001 2                  ADSC9   HEX,Q                    cn=0,n=1
        10 000646   000261 000001 1                  ADSC9   REPLY220+2,A             cn=0,n=1

      652    13175    3                       SUBSTR( HEX, MOD( HEX1, 16), 1);
      653    13176    3               HEX1 = HEX1 / 16;

  13176 10 000647   221533 236100                    LDQ     HEX1,,AUTO
        10 000650   000004 772000                    QRL     4
        10 000651   221533 756100                    STQ     HEX1,,AUTO

      654    13177    3               END;

  13177 10 000652   221534 235100                    LDA     HEX2,,AUTO
        10 000653   000001 035007                    ADLA    1,DL
        10 000654   221534 755100                    STA     HEX2,,AUTO
        10 000655   000005 115007                    CMPA    5,DL
        10 000656   000636 602000 10                 TNC     s:13174

      655    13178    2           CALL M$WAIT( WAIT_A_SECOND);

  13178 10 000657   001642 630400 2                  EPPR0   WAIT_A_SECOND
        10 000660   020006 713400                    CLIMB   8198
        10 000661   400400 401760                    pmme    nvectors=2

      656    13179    2           CALL M$TRMPRG( PURGE_UC_INPUT)

  13179 10 000662   000462 630400 2                  EPPR0   PURGE_UC_INPUT
        10 000663   560004 713400                    CLIMB   alt,+57348
        10 000664   400400 401760                    pmme    nvectors=2
        10 000665   000667 702000 10                 TSX2    s:13182
        10 000666   000667 710000 10                 TRA     s:13182

      657    13180    3           WHENALTRETURN DO;

      658    13181    3               END;

      659    13182    2           REPLY$ = R998$;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:138  

  13182 10 000667   000044 236000 2                  LDQ     R998$
        10 000670   000722 756000 1                  STQ     REPLY$

      660    13183    2           CALL WRITE_REPLY;

  13183 10 000671   002312 701000 10                 TSX1    WRITE_REPLY
        10 000672   000000 011000                    NOP     0

      661    13184    2           CALL M$WAIT( WAIT_A_SECOND);

  13184 10 000673   001642 630400 2                  EPPR0   WAIT_A_SECOND
        10 000674   020006 713400                    CLIMB   8198
        10 000675   400400 401760                    pmme    nvectors=2

      662    13185    2           REPLY$ = R999$;

  13185 10 000676   000045 236000 2                  LDQ     R999$
        10 000677   000722 756000 1                  STQ     REPLY$

      663    13186    2           CALL WRITE_REPLY;

  13186 10 000700   002312 701000 10                 TSX1    WRITE_REPLY
        10 000701   000000 011000                    NOP     0

      664    13187    2           CALL M$WAIT( WAIT_A_SECOND);

  13187 10 000702   001642 630400 2                  EPPR0   WAIT_A_SECOND
        10 000703   020006 713400                    CLIMB   8198
        10 000704   400400 401760                    pmme    nvectors=2

      665    13188    2           END;

      666    13189    1       REPLY$ = R421$;

  13189 10 000705   000024 236000 2                  LDQ     R421$
        10 000706   000722 756000 1                  STQ     REPLY$
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:139  

      667    13190    1       CALL M$OPEN( OPEN_ALIAS) ALTRET( DYING);

  13190 10 000707   000472 630400 2                  EPPR0   OPEN_ALIAS
        10 000710   450000 713400                    CLIMB   alt,open
        10 000711   410400 401760                    pmme    nvectors=18
        10 000712   001533 702000 10                 TSX2    DYING

      668    13191    2       IF NOT TCM_TCPFLAVOR THEN DO;

  13191 10 000713   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 000714   000724 604000 10                 TMI     s:13195

      669    13192    2           CALL M$PROMPT( CLEAR_PROMPT) ALTRET( DYING);

  13192 10 000715   001666 630400 2                  EPPR0   CLEAR_PROMPT
        10 000716   560002 713400                    CLIMB   alt,+57346
        10 000717   401000 401760                    pmme    nvectors=3
        10 000720   001533 702000 10                 TSX2    DYING

      670    13193    2           CALL M$TRMISC( INHIBIT_OPERATOR_MESSAGES);

  13193 10 000721   001710 630400 2                  EPPR0   INHIBIT_OPERATOR_MESSAGES
        10 000722   160020 713400                    CLIMB   57360
        10 000723   400400 401760                    pmme    nvectors=2

      671    13194    2           END;

      672    13195    1       CALL TCM$WRITE_AUDIT_LOG;

  13195 10 000724   000002 631400 xsym               EPPR1   B_VECTNIL+2
        10 000725   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_LOG
        10 000726   000000 011000                    NOP     0

      673    13196    1       REPLY$ = R220$;

  13196 10 000727   000015 236000 2                  LDQ     R220$
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:140  
        10 000730   000722 756000 1                  STQ     REPLY$

      674    13197    1       CALL WRITE_REPLY;

  13197 10 000731   002312 701000 10                 TSX1    WRITE_REPLY
        10 000732   000000 011000                    NOP     0

      675    13198    1       SYNC_PHASE = 0;

  13198 10 000733   000727 450000 1                  STZ     SYNC_PHASE

      676    13199    1       B$JIT.PRDPRM = BITBIN( '377777777777'O) /* MAX INTEGER */;

  13199 10 000734   000031 235000 xsym               LDA     B_VECTNIL+25
        10 000735   000000 470400 xsym               LDP0    B$JIT$
        10 000736   000242 755100                    STA     162,,PR0

      677    13200            /********** MAINLINE LOGIC */
      678    13201    2       DO WHILE( REPLY$ ~= R221$ AND REPLY$ ~= R421$ AND REPLY$ ~= R421ZAP$);

  13201 10 000737   001454 710000 10                 TRA     s:13342

      679    13202    2           TIMED_OUT = %NO#;

  13202 10 000740   200010 450100                    STZ     TIMED_OUT,,AUTO

      680    13203    2           DATA_LOST = %NO#;

  13203 10 000741   200011 450100                    STZ     DATA_LOST,,AUTO

      681    13204    2           LAST_CMD = CMD_CODE;

  13204 10 000742   000723 235000 1                  LDA     CMD_CODE
        10 000743   200007 755100                    STA     LAST_CMD,,AUTO

      682    13205    3           IF NOT TCM_TCPFLAVOR THEN DO;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:141  
  13205 10 000744   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 000745   001015 604000 10                 TMI     s:13221

      683    13206    4               IF LOGGED_ON THEN DO;

  13206 10 000746   000725 234000 1                  SZN     LOGGED_ON
        10 000747   000761 605000 10                 TPL     s:13211

      684    13207    4                   SET_EOM_LF.V.TIMEOUT# = 5;

  13207 10 000750   004132 236000 1                  LDQ     SET_EOM_LF+8
        10 000751   000021 376000 11                 ANQ     17
        10 000752   000005 276003                    ORQ     5,DU
        10 000753   004132 756000 1                  STQ     SET_EOM_LF+8

      685    13208    4                   SET_EOM_LF.V.UTYPE# = %MIN#;

  13208 10 000754   004132 236000 1                  LDQ     SET_EOM_LF+8
        10 000755   000022 376000 11                 ANQ     18
        10 000756   002000 276003                    ORQ     1024,DU
        10 000757   004132 756000 1                  STQ     SET_EOM_LF+8

      686    13209    4                   END;

  13209 10 000760   000771 710000 10                 TRA     s:13214

      687    13210    4               ELSE DO;

      688    13211    4                   SET_EOM_LF.V.TIMEOUT# = 30;

  13211 10 000761   004132 236000 1                  LDQ     SET_EOM_LF+8
        10 000762   000021 376000 11                 ANQ     17
        10 000763   000036 276003                    ORQ     30,DU
        10 000764   004132 756000 1                  STQ     SET_EOM_LF+8

      689    13212    4                   SET_EOM_LF.V.UTYPE# = %SEC#;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:142  
  13212 10 000765   004132 236000 1                  LDQ     SET_EOM_LF+8
        10 000766   000022 376000 11                 ANQ     18
        10 000767   001000 276003                    ORQ     512,DU
        10 000770   004132 756000 1                  STQ     SET_EOM_LF+8

      690    13213    4                   END;

      691    13214    3               CALL M$EOM( SET_EOM_LF) ALTRET( DYING);

  13214 10 000771   004122 630400 1                  EPPR0   SET_EOM_LF
        10 000772   560003 713400                    CLIMB   alt,+57347
        10 000773   401000 401760                    pmme    nvectors=3
        10 000774   001533 702000 10                 TSX2    DYING

      692    13215    3               IF B$JIT.ACCN = TCM_ACCOUNT.ACCT# AND NOT X_29 THEN

  13215 10 000775   000000 470400 xsym               LDP0    B$JIT$
        10 000776   040000 106500                    CMPC    fill='040'O
        10 000777   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        10 001000   003526 000010 1                  ADSC9   TCM_ACCOUNT              cn=0,n=8
        10 001001   001010 601000 10                 TNZ     s:13217
        10 001002   200014 234100                    SZN     X_29,,AUTO
        10 001003   001010 604000 10                 TMI     s:13217

      693    13216    3                   UC_TRMCTL.FULLDUXPAPERTAPE# = %YES#;

  13216 10 001004   004134 236000 1                  LDQ     UC_TRMCTL
        10 001005   000023 376000 11                 ANQ     19
        10 001006   010000 276007                    ORQ     4096,DL
        10 001007   004134 756000 1                  STQ     UC_TRMCTL

      694    13217    3               CALL M$STRMCTL( SET_TRANS_EOM)

  13217 10 001010   001716 630400 2                  EPPR0   SET_TRANS_EOM
        10 001011   560000 713400                    CLIMB   alt,+57344
        10 001012   401000 401760                    pmme    nvectors=3
        10 001013   001015 702000 10                 TSX2    s:13221
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:143  
        10 001014   001015 710000 10                 TRA     s:13221

      695    13218    4               WHENALTRETURN DO;

      696    13219    4                   END;

      697    13220    3               END;

      698    13221    2           CALL READ_COMMAND ALTRET( CMDERR);

  13221 10 001015   002240 701000 10                 TSX1    READ_COMMAND
        10 001016   001352 702000 10                 TSX2    CMDERR

      699    13222    2           REPLY$ = R250$;

  13222 10 001017   000017 236000 2                  LDQ     R250$
        10 001020   000722 756000 1                  STQ     REPLY$

      700    13223    3           DO CASE( CMD_CODE);

  13223 10 001021   000723 235000 1                  LDA     CMD_CODE
        10 001022   000020 115007                    CMPA    16,DL
        10 001023   001025 602005 10                 TNC     s:13223+4,AL
        10 001024   001346 710000 10                 TRA     s:13309
        10 001025   001346 710000 10                 TRA     s:13309
        10 001026   001045 710000 10                 TRA     s:13225
        10 001027   001075 710000 10                 TRA     s:13232
        10 001030   001146 710000 10                 TRA     s:13251
        10 001031   001201 710000 10                 TRA     s:13263
        10 001032   001243 710000 10                 TRA     s:13280
        10 001033   001075 710000 10                 TRA     s:13232
        10 001034   001075 710000 10                 TRA     s:13232
        10 001035   001075 710000 10                 TRA     s:13232
        10 001036   001265 710000 10                 TRA     s:13288
        10 001037   001272 710000 10                 TRA     s:13291
        10 001040   001272 710000 10                 TRA     s:13291
        10 001041   001352 710000 10                 TRA     CMDERR
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:144  
        10 001042   001272 710000 10                 TRA     s:13291
        10 001043   001275 710000 10                 TRA     s:13295
        10 001044   001317 710000 10                 TRA     s:13299

      701    13224    3               CASE( %SMTP_HELO);

      702    13225    3                   CALL SAVE_HOST_NAME ALTRET( CMDERR);

  13225 10 001045   002404 701000 10                 TSX1    SAVE_HOST_NAME
        10 001046   001352 702000 10                 TSX2    CMDERR

      703    13226    3                   LOGGED_ON = %TRUE;

  13226 10 001047   400000 236003                    LDQ     -131072,DU
        10 001050   000725 756000 1                  STQ     LOGGED_ON

      704    13227    3                   CALL TCM$WRITE_AUDIT_LOG( MSG_COUNT, HELO);

  13227 10 001051   200016 630500                    EPPR0   HELO,,AUTO
        10 001052   222251 450500                    STP0    TVAL+2,,AUTO
        10 001053   000024 236000 11                 LDQ     20
        10 001054   222250 756100                    STQ     TVAL+1,,AUTO
        10 001055   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 001056   000020 631400 xsym               EPPR1   B_VECTNIL+16
        10 001057   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_LOG
        10 001060   000000 011000                    NOP     0

      705    13228    3                   STATUS_LINE.CMD = 'HELO';

  13228 10 001061   040000 100400                    MLR     fill='040'O
        10 001062   002050 000004 2                  ADSC9   XSERRMSG+59              cn=0,n=4
        10 001063   003372 600004 1                  ADSC9   STATUS_LINE+3            cn=3,n=4

      706    13229    3                   STATUS_LINE.FROM_ADDR = SUBSTR( HELO.TXT, 0, HELO.LEN);

  13229 10 001064   200016 236100                    LDQ     HELO,,AUTO
        10 001065   000033 772000                    QRL     27
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:145  
        10 001066   000000 620006                    EAX0    0,QL
        10 001067   040000 100540                    MLR     fill='040'O
        10 001070   200016 200010                    ADSC9   HELO,,AUTO               cn=1,n=*X0
        10 001071   003400 200020 1                  ADSC9   STATUS_LINE+9            cn=1,n=16

      707    13230    3                   CALL STATUS_LINE_UPDATE;

  13230 10 001072   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 001073   000000 011000                    NOP     0
        10 001074   001352 710000 10                 TRA     CMDERR

      708    13231    3               CASE( %SMTP_MAIL, %SMTP_SAML, %SMTP_SOML, %SMTP_SEND);

      709    13232    4                   IF LOGGED_ON THEN DO;

  13232 10 001075   000725 234000 1                  SZN     LOGGED_ON
        10 001076   001141 605000 10                 TPL     s:13247

      710    13233    4                       CMD_CODE = %SMTP_MAIL;

  13233 10 001077   000002 235007                    LDA     2,DL
        10 001100   000723 755000 1                  STA     CMD_CODE

      711    13234    4                       USER_COUNT = 0;

  13234 10 001101   000724 450000 1                  STZ     USER_COUNT

      712    13235    4                       ACKNOWLEDGE = %NO#;

  13235 10 001102   200015 450100                    STZ     ACKNOWLEDGE,,AUTO

      713    13236    4                       SUPPRESS_HEADERS = %YES#;

  13236 10 001103   400000 236003                    LDQ     -131072,DU
        10 001104   200012 756100                    STQ     SUPPRESS_HEADERS,,AUTO

      714    13237    4                       CALL SAVE_REVERSE_PATH ALTRET( CMDERR);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:146  

  13237 10 001105   002474 701000 10                 TSX1    SAVE_REVERSE_PATH
        10 001106   001352 702000 10                 TSX2    CMDERR

      715    13238    4                       STATUS_LINE.CMD = 'MAIL';

  13238 10 001107   040000 100400                    MLR     fill='040'O
        10 001110   002051 000004 2                  ADSC9   XSERRMSG+60              cn=0,n=4
        10 001111   003372 600004 1                  ADSC9   STATUS_LINE+3            cn=3,n=4

      716    13239    4                       CALL BINCHAR( STATUS_LINE.MSGS, MSG_COUNT);

  13239 10 001112   000726 235000 1                  LDA     MSG_COUNT
        10 001113   000044 773000                    LRL     36
        10 001114   222250 757100                    STAQ    TVAL+1,,AUTO
        10 001115   000000 301500                    BTD
        10 001116   222250 000010                    NDSC9   TVAL+1,,AUTO             cn=0,s=lsgnf,sf=0,n=8
        10 001117   003370 630002 1                  NDSC9   STATUS_LINE+1            cn=3,s=nosgn,sf=0,n=2

      717    13240    4                       STATUS_LINE.STATUS = ' ';

  13240 10 001120   000040 236003                    LDQ     32,DU
        10 001121   003371 552020 1                  STBQ    STATUS_LINE+2,'20'O

      718    13241    4                       STATUS_LINE.LINES = ' ';

  13241 10 001122   040000 100400                    MLR     fill='040'O
        10 001123   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 001124   003371 400004 1                  ADSC9   STATUS_LINE+2            cn=2,n=4

      719    13242    4                       STATUS_LINE.RCPT_ADDR = ' ';

  13242 10 001125   040000 100400                    MLR     fill='040'O
        10 001126   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 001127   003374 000020 1                  ADSC9   STATUS_LINE+5            cn=0,n=16

      720    13243    4                       STATUS_LINE.FROM_ADDR = SUBSTR( MAIL.TXT, 0, MAIL.LEN);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:147  

  13243 10 001130   200116 236100                    LDQ     MAIL,,AUTO
        10 001131   000033 772000                    QRL     27
        10 001132   000000 620006                    EAX0    0,QL
        10 001133   040000 100540                    MLR     fill='040'O
        10 001134   200116 200010                    ADSC9   MAIL,,AUTO               cn=1,n=*X0
        10 001135   003400 200020 1                  ADSC9   STATUS_LINE+9            cn=1,n=16

      721    13244    4                       CALL STATUS_LINE_UPDATE;

  13244 10 001136   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 001137   000000 011000                    NOP     0

      722    13245    4                       END;

  13245 10 001140   001352 710000 10                 TRA     CMDERR

      723    13246    4                   ELSE DO;

      724    13247    4                       CMD_CODE = LAST_CMD;

  13247 10 001141   200007 235100                    LDA     LAST_CMD,,AUTO
        10 001142   000723 755000 1                  STA     CMD_CODE

      725    13248    4                       REPLY$ = R503$;

  13248 10 001143   000034 236000 2                  LDQ     R503$
        10 001144   000722 756000 1                  STQ     REPLY$

      726    13249    4                       END;

  13249 10 001145   001352 710000 10                 TRA     CMDERR

      727    13250    3               CASE( %SMTP_RCPT);

      728    13251    4                   IF LAST_CMD = %SMTP_MAIL OR LAST_CMD = %SMTP_RCPT THEN DO;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:148  
  13251 10 001146   200007 235100                    LDA     LAST_CMD,,AUTO
        10 001147   000002 115007                    CMPA    2,DL
        10 001150   001153 600000 10                 TZE     s:13252
        10 001151   000003 115007                    CMPA    3,DL
        10 001152   001175 601000 10                 TNZ     s:13259

      729    13252    4                       CALL SAVE_USER_NAME ALTRET( CMDERR);

  13252 10 001153   002515 701000 10                 TSX1    SAVE_USER_NAME
        10 001154   001352 702000 10                 TSX2    CMDERR

      730    13253    4                       STATUS_LINE.RCPT_ADDR =

  13253 10 001155   000724 235000 1                  LDA     USER_COUNT
        10 001156   000006 735000                    ALS     6
        10 001157   201716 236105                    LDQ     USERS,AL,AUTO
        10 001160   000033 772000                    QRL     27
        10 001161   000724 235000 1                  LDA     USER_COUNT
        10 001162   000010 735000                    ALS     8
        10 001163   000000 620006                    EAX0    0,QL
        10 001164   040000 100545                    MLR     fill='040'O
        10 001165   201716 200010                    ADSC9   USERS,A,AUTO             cn=1,n=*X0
        10 001166   003374 000020 1                  ADSC9   STATUS_LINE+5            cn=0,n=16

      731    13254    4                              SUBSTR( USERS.TXT( USER_COUNT), 0, USERS.LEN( USER_COUNT
             13254                                        ));
      732    13255    4                       CALL STATUS_LINE_UPDATE;

  13255 10 001167   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 001170   000000 011000                    NOP     0

      733    13256    4                       USER_COUNT = USER_COUNT + 1;

  13256 10 001171   000724 235000 1                  LDA     USER_COUNT
        10 001172   000001 035007                    ADLA    1,DL
        10 001173   000724 755000 1                  STA     USER_COUNT

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:149  
      734    13257    4                       END;

  13257 10 001174   001352 710000 10                 TRA     CMDERR

      735    13258    4                   ELSE DO;

      736    13259    4                       REPLY$ = R503$;

  13259 10 001175   000034 236000 2                  LDQ     R503$
        10 001176   000722 756000 1                  STQ     REPLY$

      737    13260    4                       CMD_CODE = LAST_CMD;

  13260 10 001177   000723 755000 1                  STA     CMD_CODE

      738    13261    4                       END;

  13261 10 001200   001352 710000 10                 TRA     CMDERR

      739    13262    3               CASE( %SMTP_DATA);

      740    13263    4                   IF LAST_CMD = %SMTP_RCPT THEN DO;

  13263 10 001201   200007 235100                    LDA     LAST_CMD,,AUTO
        10 001202   000003 115007                    CMPA    3,DL
        10 001203   001240 601000 10                 TNZ     s:13278

      741    13264    4                       STATUS_LINE.STATUS = '/';

  13264 10 001204   000057 236003                    LDQ     47,DU
        10 001205   003371 552020 1                  STBQ    STATUS_LINE+2,'20'O

      742    13265    4                       STATUS_LINE.LINES = '0000';

  13265 10 001206   040000 100400                    MLR     fill='040'O
        10 001207   002052 000004 2                  ADSC9   XSERRMSG+61              cn=0,n=4
        10 001210   003371 400004 1                  ADSC9   STATUS_LINE+2            cn=2,n=4
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:150  

      743    13266    4                       CALL STATUS_LINE_UPDATE;

  13266 10 001211   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 001212   000000 011000                    NOP     0

      744    13267    4                       CALL BUILD_MAIL_HEADER ALTRET( CMDERR);

  13267 10 001213   003000 701000 10                 TSX1    BUILD_MAIL_HEADER
        10 001214   001352 702000 10                 TSX2    CMDERR

      745    13268    4                       IF NOT TCM_TCPFLAVOR THEN

  13268 10 001215   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 001216   001222 604000 10                 TMI     s:13270

      746    13269    4                           CALL M$WAIT( WAIT_A_SECOND);

  13269 10 001217   001642 630400 2                  EPPR0   WAIT_A_SECOND
        10 001220   020006 713400                    CLIMB   8198
        10 001221   400400 401760                    pmme    nvectors=2

      747    13270    4                       REPLY$ = R354$;

  13270 10 001222   000023 236000 2                  LDQ     R354$
        10 001223   000722 756000 1                  STQ     REPLY$

      748    13271    4                       CALL WRITE_REPLY;

  13271 10 001224   002312 701000 10                 TSX1    WRITE_REPLY
        10 001225   000000 011000                    NOP     0

      749    13272    4                       CALL GET_MESSAGE_DATA ALTRET( CMDERR);

  13272 10 001226   003260 701000 10                 TSX1    GET_MESSAGE_DATA
        10 001227   001352 702000 10                 TSX2    CMDERR

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:151  
      750    13273    4                       CALL SEND_MAIL_MESSAGE ALTRET( CMDERR);

  13273 10 001230   004407 701000 10                 TSX1    SEND_MAIL_MESSAGE
        10 001231   001352 702000 10                 TSX2    CMDERR

      751    13274    4                       STATUS_LINE.CMD = 'sent';

  13274 10 001232   040000 100400                    MLR     fill='040'O
        10 001233   002053 000004 2                  ADSC9   XSERRMSG+62              cn=0,n=4
        10 001234   003372 600004 1                  ADSC9   STATUS_LINE+3            cn=3,n=4

      752    13275    4                       CALL STATUS_LINE_UPDATE;

  13275 10 001235   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 001236   000000 011000                    NOP     0

      753    13276    4                       END;

  13276 10 001237   001352 710000 10                 TRA     CMDERR

      754    13277    3                   ELSE
      755    13278    3                       REPLY$ = R503$;

  13278 10 001240   000034 236000 2                  LDQ     R503$
        10 001241   000722 756000 1                  STQ     REPLY$
        10 001242   001352 710000 10                 TRA     CMDERR

      756    13279    3               CASE( %SMTP_RSET);

      757    13280    3                   STATUS_LINE.CMD = 'RSET';

  13280 10 001243   040000 100400                    MLR     fill='040'O
        10 001244   002054 000004 2                  ADSC9   XSERRMSG+63              cn=0,n=4
        10 001245   003372 600004 1                  ADSC9   STATUS_LINE+3            cn=3,n=4

      758    13281    3                   STATUS_LINE.STATUS = ' ';

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:152  
  13281 10 001246   000040 236003                    LDQ     32,DU
        10 001247   003371 552020 1                  STBQ    STATUS_LINE+2,'20'O

      759    13282    3                   STATUS_LINE.LINES = ' ';

  13282 10 001250   040000 100400                    MLR     fill='040'O
        10 001251   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 001252   003371 400004 1                  ADSC9   STATUS_LINE+2            cn=2,n=4

      760    13283    3                   STATUS_LINE.RCPT_ADDR = ' ';

  13283 10 001253   040000 100400                    MLR     fill='040'O
        10 001254   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 001255   003374 000020 1                  ADSC9   STATUS_LINE+5            cn=0,n=16

      761    13284    3                   STATUS_LINE.FROM_ADDR = ' ';

  13284 10 001256   040000 100400                    MLR     fill='040'O
        10 001257   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 001260   003400 200020 1                  ADSC9   STATUS_LINE+9            cn=1,n=16

      762    13285    3                   CALL STATUS_LINE_UPDATE;

  13285 10 001261   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 001262   000000 011000                    NOP     0

      763    13286    3                   USER_COUNT = 0;

  13286 10 001263   000724 450000 1                  STZ     USER_COUNT
        10 001264   001352 710000 10                 TRA     CMDERR

      764    13287    3               CASE( %SMTP_VRFY);

      765    13288    3                   REPLY$ = R550$;

  13288 10 001265   000035 236000 2                  LDQ     R550$
        10 001266   000722 756000 1                  STQ     REPLY$
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:153  

      766    13289    3                   CALL VERIFY_ADDRESS;

  13289 10 001267   002712 701000 10                 TSX1    VERIFY_ADDRESS
        10 001270   000000 011000                    NOP     0
        10 001271   001352 710000 10                 TRA     CMDERR

      767    13290    3               CASE( %SMTP_EXPN, %SMTP_HELP, %SMTP_TURN);

      768    13291    3                   REPLY$ = R502$;

  13291 10 001272   000033 236000 2                  LDQ     R502$
        10 001273   000722 756000 1                  STQ     REPLY$
        10 001274   001352 710000 10                 TRA     CMDERR

      769    13292    3               CASE( %SMTP_NOOP);

      770    13293    3                   ;
      771    13294    3               CASE( %SMTP_QUIT);

      772    13295    3                   CALL CONCAT( OCMSG, SUBSTR( HELO.TXT, 0, HELO.LEN), ' off');

  13295 10 001275   200016 236100                    LDQ     HELO,,AUTO
        10 001276   000033 772000                    QRL     27
        10 001277   000000 620006                    EAX0    0,QL
        10 001300   040000 100540                    MLR     fill='040'O
        10 001301   200016 200010                    ADSC9   HELO,,AUTO               cn=1,n=*X0
        10 001302   003267 000377 1                  ADSC9   OCMSG                    cn=0,n=255
        10 001303   000377 116007                    CMPQ    255,DL
        10 001304   001312 603000 10                 TRC     s:13296
        10 001305   777400 620006                    EAX0    -256,QL
        10 001306   777777 660003                    ERX0    -1,DU
        10 001307   040046 100400                    MLR     fill='040'O
        10 001310   002055 000004 2                  ADSC9   XSERRMSG+64              cn=0,n=4
        10 001311   003267 000010 1                  ADSC9   OCMSG,Q                  cn=0,n=*X0

      773    13296    3                   CALL TELL_OPERATOR;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:154  

  13296 10 001312   002447 701000 10                 TSX1    TELL_OPERATOR
        10 001313   000000 011000                    NOP     0

      774    13297    3                   REPLY$ = R221$;

  13297 10 001314   000016 236000 2                  LDQ     R221$
        10 001315   000722 756000 1                  STQ     REPLY$
        10 001316   001352 710000 10                 TRA     CMDERR

      775    13298    3               CASE( %SMTP_SPIL);

      776    13299    3                   REPLY$ = R502$;  /* just in case.. */

  13299 10 001317   000033 236000 2                  LDQ     R502$
        10 001320   000722 756000 1                  STQ     REPLY$

      777    13300    3                   STATUS_LINE.CMD = 'SPIL';

  13300 10 001321   040000 100400                    MLR     fill='040'O
        10 001322   002056 000004 2                  ADSC9   XSERRMSG+65              cn=0,n=4
        10 001323   003372 600004 1                  ADSC9   STATUS_LINE+3            cn=3,n=4

      778    13301    3                   STATUS_LINE.STATUS = ' ';

  13301 10 001324   000040 236003                    LDQ     32,DU
        10 001325   003371 552020 1                  STBQ    STATUS_LINE+2,'20'O

      779    13302    3                   STATUS_LINE.LINES = ' ';

  13302 10 001326   040000 100400                    MLR     fill='040'O
        10 001327   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 001330   003371 400004 1                  ADSC9   STATUS_LINE+2            cn=2,n=4

      780    13303    3                   STATUS_LINE.RCPT_ADDR = ' ';

  13303 10 001331   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:155  
        10 001332   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 001333   003374 000020 1                  ADSC9   STATUS_LINE+5            cn=0,n=16

      781    13304    3                   STATUS_LINE.FROM_ADDR = ' ';

  13304 10 001334   040000 100400                    MLR     fill='040'O
        10 001335   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 001336   003400 200020 1                  ADSC9   STATUS_LINE+9            cn=1,n=16

      782    13305    3                   CALL STATUS_LINE_UPDATE;

  13305 10 001337   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 001340   000000 011000                    NOP     0

      783    13306    3                   CALL SPILL_ALIASES;

  13306 10 001341   011340 701000 10                 TSX1    SPILL_ALIASES
        10 001342   000000 011000                    NOP     0

      784    13307    3                   CMD_CODE = LAST_CMD;

  13307 10 001343   200007 235100                    LDA     LAST_CMD,,AUTO
        10 001344   000723 755000 1                  STA     CMD_CODE
        10 001345   001352 710000 10                 TRA     CMDERR

      785    13308    3               CASE( ELSE);

      786    13309    3                   REPLY$ = R500$;

  13309 10 001346   000031 236000 2                  LDQ     R500$
        10 001347   000722 756000 1                  STQ     REPLY$

      787    13310    3                   CMD_CODE = LAST_CMD;

  13310 10 001350   200007 235100                    LDA     LAST_CMD,,AUTO
        10 001351   000723 755000 1                  STA     CMD_CODE

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:156  
      788    13311    3               END/* case cmd_code */;

      789    13312    2   CMDERR:
      790    13313    3           IF NOT LOGGED_ON THEN DO;

  13313 10 001352   000725 234000 1     CMDERR       SZN     LOGGED_ON
        10 001353   001424 604000 10                 TMI     s:13332

      791    13314    4               IF TIMED_OUT AND SYNC_PHASE < 4 THEN DO;

  13314 10 001354   200010 234100                    SZN     TIMED_OUT,,AUTO
        10 001355   001415 605000 10                 TPL     s:13329
        10 001356   000727 235000 1                  LDA     SYNC_PHASE
        10 001357   000004 115007                    CMPA    4,DL
        10 001360   001415 603000 10                 TRC     s:13329

      792    13315    5                   IF MOD( SYNC_PHASE, 2) = 1 THEN DO;

  13315 10 001361   000727 236000 1                  LDQ     SYNC_PHASE
        10 001362   000001 376007                    ANQ     1,DL
        10 001363   000001 116007                    CMPQ    1,DL
        10 001364   001407 601000 10                 TNZ     s:13325

      793    13316    5                       REPLY$ = R998$;

  13316 10 001365   000044 236000 2                  LDQ     R998$
        10 001366   000722 756000 1                  STQ     REPLY$

      794    13317    5                       CALL WRITE_REPLY;

  13317 10 001367   002312 701000 10                 TSX1    WRITE_REPLY
        10 001370   000000 011000                    NOP     0

      795    13318    5                       IF NOT TCM_TCPFLAVOR THEN

  13318 10 001371   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 001372   001376 604000 10                 TMI     s:13320
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:157  

      796    13319    5                           CALL M$WAIT( WAIT_A_SECOND);

  13319 10 001373   001642 630400 2                  EPPR0   WAIT_A_SECOND
        10 001374   020006 713400                    CLIMB   8198
        10 001375   400400 401760                    pmme    nvectors=2

      797    13320    5                       REPLY$ = R999$;

  13320 10 001376   000045 236000 2                  LDQ     R999$
        10 001377   000722 756000 1                  STQ     REPLY$

      798    13321    5                       CALL WRITE_REPLY;

  13321 10 001400   002312 701000 10                 TSX1    WRITE_REPLY
        10 001401   000000 011000                    NOP     0

      799    13322    5                       IF NOT TCM_TCPFLAVOR THEN

  13322 10 001402   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 001403   001407 604000 10                 TMI     s:13325

      800    13323    5                           CALL M$WAIT( WAIT_A_SECOND);

  13323 10 001404   001642 630400 2                  EPPR0   WAIT_A_SECOND
        10 001405   020006 713400                    CLIMB   8198
        10 001406   400400 401760                    pmme    nvectors=2

      801    13324    5                       END;

      802    13325    4                   REPLY$ = R220$;

  13325 10 001407   000015 236000 2                  LDQ     R220$
        10 001410   000722 756000 1                  STQ     REPLY$

      803    13326    4                   SYNC_PHASE = SYNC_PHASE + 1;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:158  
  13326 10 001411   000727 235000 1                  LDA     SYNC_PHASE
        10 001412   000001 035007                    ADLA    1,DL
        10 001413   000727 755000 1                  STA     SYNC_PHASE

      804    13327    4                   END;

  13327 10 001414   001424 710000 10                 TRA     s:13332

      805    13328    3               ELSE
      806    13329    3                   IF NOT TIMED_OUT AND REPLY$ ~= R221$ THEN

  13329 10 001415   200010 234100                    SZN     TIMED_OUT,,AUTO
        10 001416   001424 604000 10                 TMI     s:13332
        10 001417   000722 236000 1                  LDQ     REPLY$
        10 001420   000016 116000 2                  CMPQ    R221$
        10 001421   001424 600000 10                 TZE     s:13332

      807    13330    3                       REPLY$ = ADDR( NIL);

  13330 10 001422   000001 236000 xsym               LDQ     B_VECTNIL+1
        10 001423   000722 756000 1                  STQ     REPLY$

      808    13331    3               END;

      809    13332    3           IF NOT TCM_TCPFLAVOR THEN DO;

  13332 10 001424   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 001425   001447 604000 10                 TMI     s:13340

      810    13333    3               IF REPLY$ ~= R221$ AND REPLY$ ~= R421$ AND REPLY$ ~= R421ZAP$ AND

  13333 10 001426   000722 236000 1                  LDQ     REPLY$
        10 001427   000016 116000 2                  CMPQ    R221$
        10 001430   001442 600000 10                 TZE     s:13336
        10 001431   000024 116000 2                  CMPQ    R421$
        10 001432   001442 600000 10                 TZE     s:13336
        10 001433   000026 116000 2                  CMPQ    R421ZAP$
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:159  
        10 001434   001442 600000 10                 TZE     s:13336
        10 001435   200014 234100                    SZN     X_29,,AUTO
        10 001436   001442 604000 10                 TMI     s:13336

      811    13334    3                       NOT X_29 THEN
      812    13335    3                   CALL M$WAIT( WAIT_A_SECOND);

  13335 10 001437   001642 630400 2                  EPPR0   WAIT_A_SECOND
        10 001440   020006 713400                    CLIMB   8198
        10 001441   400400 401760                    pmme    nvectors=2

      813    13336    3               CALL M$TRMPRG( PURGE_UC_INPUT)

  13336 10 001442   000462 630400 2                  EPPR0   PURGE_UC_INPUT
        10 001443   560004 713400                    CLIMB   alt,+57348
        10 001444   400400 401760                    pmme    nvectors=2
        10 001445   001447 702000 10                 TSX2    s:13340
        10 001446   001447 710000 10                 TRA     s:13340

      814    13337    4               WHENALTRETURN DO;

      815    13338    4                   END;

      816    13339    3               END;

      817    13340    2           IF REPLY$ ~= ADDR( NIL) THEN

  13340 10 001447   000722 236000 1                  LDQ     REPLY$
        10 001450   000001 116000 xsym               CMPQ    B_VECTNIL+1
        10 001451   001454 600000 10                 TZE     s:13342

      818    13341    2               CALL WRITE_REPLY;

  13341 10 001452   002312 701000 10                 TSX1    WRITE_REPLY
        10 001453   000000 011000                    NOP     0

      819    13342    2           END /* while o.k. */;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:160  

  13342 10 001454   000722 236000 1                  LDQ     REPLY$
        10 001455   000016 116000 2                  CMPQ    R221$
        10 001456   001463 600000 10                 TZE     s:13344
        10 001457   000024 116000 2                  CMPQ    R421$
        10 001460   001463 600000 10                 TZE     s:13344
        10 001461   000026 116000 2                  CMPQ    R421ZAP$
        10 001462   000740 601000 10                 TNZ     s:13202

      820    13343
      821    13344    2       IF TCM_TCPFLAVOR THEN DO;

  13344 10 001463   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 001464   001477 605000 10                 TPL     s:13352

      822    13345    2           CALL STATUS_LINE_IDLE;

  13345 10 001465   012767 701000 10                 TSX1    STATUS_LINE_IDLE
        10 001466   000000 011000                    NOP     0

      823    13346    2           CALL TCP$CLOSE( TCM_CMD_LCN);

  13346 10 001467   000006 630400 11                 EPPR0   6
        10 001470   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 001471   000000 701000 xent               TSX1    TCP$CLOSE
        10 001472   000000 011000                    NOP     0

      824    13347    2           CALL TCP$RELEASE( TCM_CMD_LCN);

  13347 10 001473   000006 630400 11                 EPPR0   6
        10 001474   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 001475   000000 701000 xent               TSX1    TCP$RELEASE
        10 001476   000000 011000                    NOP     0

      825    13348                /* KLUDGE, AT END OF ONE SESSION, START AGAIN */
      826    13349    2           END;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:161  
      827    13350
      828    13351            /********** FINAL CLEANUP */
      829    13352    1       CALL TCM$WRITE_AUDIT_LOG( MSG_COUNT, HELO);

  13352 10 001477   200016 630500                    EPPR0   HELO,,AUTO
        10 001500   222251 450500                    STP0    TVAL+2,,AUTO
        10 001501   000024 236000 11                 LDQ     20
        10 001502   222250 756100                    STQ     TVAL+1,,AUTO
        10 001503   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 001504   000020 631400 xsym               EPPR1   B_VECTNIL+16
        10 001505   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_LOG
        10 001506   000000 011000                    NOP     0

      830    13353    1       CALL M$CLOSE( CLOSE_ALIAS);

  13353 10 001507   000576 630400 2                  EPPR0   CLOSE_ALIAS
        10 001510   050001 713400                    CLIMB   close
        10 001511   406000 401760                    pmme    nvectors=13

      831    13354    1       CALL M$CLOSE( CLOSE_DRIBBLE);

  13354 10 001512   001204 630400 2                  EPPR0   CLOSE_DRIBBLE
        10 001513   050001 713400                    CLIMB   close
        10 001514   406000 401760                    pmme    nvectors=13

      832    13355    1       CALL M$CLOSE( CLOSE_NODES);

  13355 10 001515   000762 630400 2                  EPPR0   CLOSE_NODES
        10 001516   050001 713400                    CLIMB   close
        10 001517   406000 401760                    pmme    nvectors=13

      833    13356    1       IF TCM_TCPFLAVOR THEN

  13356 10 001520   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 001521   000460 604000 10                 TMI     REREAD

      834    13357    1           GOTO REREAD;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:162  
      835    13358    1       IF B$JIT.ACCN = TCM_ACCOUNT.ACCT# THEN

  13358 10 001522   000000 470400 xsym               LDP0    B$JIT$
        10 001523   040000 106500                    CMPC    fill='040'O
        10 001524   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        10 001525   003526 000010 1                  ADSC9   TCM_ACCOUNT              cn=0,n=8
        10 001526   001532 601000 10                 TNZ     s:13360

      836    13359    1           CALL M$YC( TCM_YC_OFF);

  13359 10 001527   001656 630400 2                  EPPR0   TCM_YC_OFF
        10 001530   000011 713400                    CLIMB   9
        10 001531   401000 401760                    pmme    nvectors=3

      837    13360    1       RETURN;  /* to IBEX */

  13360 10 001532   000000 702200 xent               TSX2  ! X66_MARET

      838    13361    1   DYING:
      839    13362    1       CALL M$SPRIV( JIT_PRIV);

  13362 10 001533   001632 630400 2     DYING        EPPR0   JIT_PRIV
        10 001534   020012 713400                    CLIMB   8202
        10 001535   400000 401760                    pmme    nvectors=1

      840    13363    1       B$JIT.PRIV.ACTIVE.EXMM = %YES#;  /* so we can SNAP */

  13363 10 001536   000000 470400 xsym               LDP0    B$JIT$
        10 001537   000002 236007                    LDQ     2,DL
        10 001540   000013 256100                    ORSQ    11,,PR0

      841    13364    1       CALL M$SCREECH( SCREECH1);  /* ..a SNAP, really */

  13364 10 001541   001612 630400 2                  EPPR0   SCREECH1
        10 001542   000013 713400                    CLIMB   11
        10 001543   401000 401760                    pmme    nvectors=3

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:163  
      842    13365    1       CALL M$EXIT;

  13365 10 001544   000001 713400                    CLIMB   exit
        10 001545   000000 401760                    pmme    nvectors=0
        10 001546   013072 710000 10                 TRA     s:15203

      843    13366            /* THAT'S ALL */
      844    13367        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:164  
      845    13368    1   INITIALIZE_CONFIGURATION: PROC ALTRET;

  13368 10 001547   221536 741300       INITIALIZE_* STX1  ! HEX2+2,,AUTO

      846    13369
      847    13370    2       DCL ERROR_FLAG BIT(1);
      848    13371    2       DCL HAVE_A_CMD BIT(1);
      849    13372    2       DCL I SBIN;
      850    13373    2       DCL J SBIN;
      851    13374    2       DCL OPT$ PTR;
      852    13375    2       DCL SUB$ PTR;
      853    13376    2       DCL CHARS CHAR(512) BASED ALIGNED;
      854    13377
      855    13378    2       REWRITES = 0;

  13378 10 001550   221416 450100                    STZ     REWRITES,,AUTO

      856    13379    2       ERROR_FLAG = %NO#;

  13379 10 001551   221537 450100                    STZ     ERROR_FLAG,,AUTO

      857    13380    2       CALL XUG$INIT( XUG_GETCMD, XUG_INIT);

  13380 10 001552   000025 630400 11                 EPPR0   21
        10 001553   000020 631400 xsym               EPPR1   B_VECTNIL+16
        10 001554   000000 701000 xent               TSX1    XUG$INIT
        10 001555   000000 011000                    NOP     0

      858    13381    2   SCAN:
      859    13382    3       DO FOREVER;

  13382 10 001556                       SCAN         null
      860    13383    3           HAVE_A_CMD = %NO#;

  13383 10 001556   221540 450100                    STZ     HAVE_A_CMD,,AUTO

      861    13384    4           DO UNTIL( HAVE_A_CMD);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:165  

      862    13385    4               CALL XUG$GETCMD( XUG_GETCMD)

  13385 10 001557   000025 630400 11                 EPPR0   21
        10 001560   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 001561   000000 701000 xent               TSX1    XUG$GETCMD
        10 001562   001566 702000 10                 TSX2    s:13390

      863    13386    5               WHENRETURN DO;

      864    13387    5                   HAVE_A_CMD = %YES#;

  13387 10 001563   400000 236003                    LDQ     -131072,DU
        10 001564   221540 756100                    STQ     HAVE_A_CMD,,AUTO

      865    13388    5                   END;

  13388 10 001565   001614 710000 10                 TRA     s:13400

      866    13389    5               WHENALTRETURN DO;

      867    13390    5                   IF XUG_GETCMD.ERR#.MON# AND

  13390 10 001566   000133 236000 1                  LDQ     XUG_GETCMD+1
        10 001567   400000 316007                    CANQ    -131072,DL
        10 001570   001575 600000 10                 TZE     s:13393
        10 001571   000133 236000 1                  LDQ     XUG_GETCMD+1
        10 001572   377770 376007                    ANQ     131064,DL
        10 001573   000060 116007                    CMPQ    48,DL
        10 001574   002225 600000 10                 TZE     s:13484

      868    13391    5                           XUG_GETCMD.ERR#.CODE# = %E$EOF THEN
      869    13392    5                       EXIT SCAN;
      870    13393    5                   ERROR_FLAG = %YES#;

  13393 10 001575   400000 236003                    LDQ     -131072,DU
        10 001576   221537 756100                    STQ     ERROR_FLAG,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:166  

      871    13394    5                   XUG_GETCMD.ERR_CODE = XUG_GETCMD.ERR#;

  13394 10 001577   000133 236000 1                  LDQ     XUG_GETCMD+1
        10 001600   000142 756000 1                  STQ     XUG_GETCMD+8

      872    13395    5                   CALL XUG$ECHOIF( XUG_GETCMD);

  13395 10 001601   000025 630400 11                 EPPR0   21
        10 001602   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 001603   000000 701000 xent               TSX1    XUG$ECHOIF
        10 001604   000000 011000                    NOP     0

      873    13396    5                   CALL XUG$ERRMSG( XUG_GETCMD);

  13396 10 001605   000025 630400 11                 EPPR0   21
        10 001606   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 001607   000000 701000 xent               TSX1    XUG$ERRMSG
        10 001610   000000 011000                    NOP     0

      874    13397    5                   IF XUG_GETCMD.ERR#.MON# THEN

  13397 10 001611   000133 236000 1                  LDQ     XUG_GETCMD+1
        10 001612   400000 316007                    CANQ    -131072,DL
        10 001613   002225 601000 10                 TNZ     s:13484

      875    13398    5                       EXIT SCAN;
      876    13399    5                   END;

      877    13400    4               END;

  13400 10 001614   221540 234100                    SZN     HAVE_A_CMD,,AUTO
        10 001615   001557 605000 10                 TPL     s:13385

      878    13401    3           OUT$ = XUG_GETCMD.OUT$;

  13401 10 001616   000133 236000 1                  LDQ     XUG_GETCMD+1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:167  
        10 001617   200005 756100                    STQ     OUT$,,AUTO

      879    13402    3   CMD:
      880    13403    4           DO CASE( OUT.CODE);

  13403 10 001620   200005 470500       CMD          LDP0    OUT$,,AUTO
        10 001621   000000 236100                    LDQ     0,,PR0
        10 001622   777777 376007                    ANQ     -1,DL
        10 001623   000145 136007                    SBLQ    101,DL
        10 001624   000007 116007                    CMPQ    7,DL
        10 001625   001627 602006 10                 TNC     CMD+7,QL
        10 001626   001556 710000 10                 TRA     SCAN
        10 001627   002162 710000 10                 TRA     s:13479
        10 001630   002224 710000 10                 TRA     s:13483
        10 001631   002224 710000 10                 TRA     s:13483
        10 001632   001636 710000 10                 TRA     s:13407
        10 001633   002224 710000 10                 TRA     s:13483
        10 001634   001724 710000 10                 TRA     s:13428
        10 001635   001770 710000 10                 TRA     s:13443

      881    13404    4               CASE( ELSE);

      882    13405                        /* do nothing; command doesn't apply to NETMAIL */
      883    13406    4               CASE( %ADDGATE_CMD);

      884    13407    5                   IF REWRITES > %MAX_REWRITES THEN DO;

  13407 10 001636   221416 235100                    LDA     REWRITES,,AUTO
        10 001637   000024 115007                    CMPA    20,DL
        10 001640   001651 604400 10                 TMOZ    s:13414

      885    13408    5                       CMDBUF = 'AddGate table overflow;  command not stored.';

  13408 10 001641   040100 100400                    MLR     fill='040'O
        10 001642   002057 000054 2                  ADSC9   XSERRMSG+66              cn=0,n=44
        10 001643   221426 000377                    ADSC9   CMDBUF,,AUTO             cn=0,n=255

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:168  
      886    13409    5   TELLUSER:
      887    13410    5                       CALL WRITEDO;

  13410 10 001644   013014 701000 10    TELLUSER     TSX1    WRITEDO
        10 001645   000000 011000                    NOP     0

      888    13411    5                       ERROR_FLAG = %YES#;

  13411 10 001646   400000 236003                    LDQ     -131072,DU
        10 001647   221537 756100                    STQ     ERROR_FLAG,,AUTO

      889    13412    5                       EXIT CMD;

  13412 10 001650   002224 710000 10                 TRA     s:13483

      890    13413    5                       END;
      891    13414    5                   IF OUT.NSUBLKS ~= 2 THEN DO;

  13414 10 001651   000001 220100                    LDX0    1,,PR0
        10 001652   000002 100003                    CMPX0   2,DU
        10 001653   001660 600000 10                 TZE     s:13418

      892    13415    5                       CMDBUF = 'AddGate command malformed;  command not stored.';

  13415 10 001654   040100 100400                    MLR     fill='040'O
        10 001655   002072 000057 2                  ADSC9   XSERRMSG+77              cn=0,n=47
        10 001656   221426 000377                    ADSC9   CMDBUF,,AUTO             cn=0,n=255

      893    13416    5                       GOTO TELLUSER;

  13416 10 001657   001644 710000 10                 TRA     TELLUSER

      894    13417    5                       END;
      895    13418    4                   I = REWRITES;

  13418 10 001660   221541 755100                    STA     I,,AUTO

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:169  
      896    13419    4                   REWRITE.NEW.LEN( I) = OUT.SUBLK$(0)->SYM.COUNT;

  13419 10 001661   221541 236100                    LDQ     I,,AUTO
        10 001662   000022 402007                    MPY     18,DL
        10 001663   000003 471500                    LDP1    3,,PR0
        10 001664   000000 621006                    EAX1    0,QL
        10 001665   100004 236100                    LDQ     4,,PR1
        10 001666   000745 676011 1                  ERQ     REWRITE+10,X1
        10 001667   777000 376003                    ANQ     -512,DU
        10 001670   000745 656011 1                  ERSQ    REWRITE+10,X1

      897    13420    4                   CALL XLATE( REWRITE.NEW.TXT( I), TCM_XLATE_TO_UC,

  13420 10 001671   100004 236100                    LDQ     4,,PR1
        10 001672   000033 772000                    QRL     27
        10 001673   000000 622006                    EAX2    0,QL
        10 001674   221541 236100                    LDQ     I,,AUTO
        10 001675   000110 402007                    MPY     72,DL
        10 001676   040006 160540                    MVT     fill='040'O
        10 001677   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        10 001700   000745 200037 1                  ADSC9   REWRITE+10,Q             cn=1,n=31
        10 001701   000060 000000 2                  ARG     TCM_XLATE_TO_UC

      898    13421    4                           OUT.SUBLK$(0)->SYM.TEXT);
      899    13422    4                   REWRITE.OLD.LEN( I) = OUT.SUBLK$(1)->SYM.COUNT;

  13422 10 001702   000004 473500                    LDP3    4,,PR0
        10 001703   300004 236100                    LDQ     4,,PR3
        10 001704   000735 676011 1                  ERQ     REWRITE+2,X1
        10 001705   777000 376003                    ANQ     -512,DU
        10 001706   000735 656011 1                  ERSQ    REWRITE+2,X1

      900    13423    4                   CALL XLATE( REWRITE.OLD.TXT( I), TCM_XLATE_TO_UC,

  13423 10 001707   300004 236100                    LDQ     4,,PR3
        10 001710   000033 772000                    QRL     27
        10 001711   000000 623006                    EAX3    0,QL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:170  
        10 001712   221541 236100                    LDQ     I,,AUTO
        10 001713   000110 402007                    MPY     72,DL
        10 001714   040006 160540                    MVT     fill='040'O
        10 001715   300004 200013                    ADSC9   4,,PR3                   cn=1,n=*X3
        10 001716   000735 200037 1                  ADSC9   REWRITE+2,Q              cn=1,n=31
        10 001717   000060 000000 2                  ARG     TCM_XLATE_TO_UC

      901    13424    4                           OUT.SUBLK$(1)->SYM.TEXT);
      902    13425    4                   REWRITE.TYP( I) = %ADDGATE_CMD;

  13425 10 001720   000150 235007                    LDA     104,DL
        10 001721   000733 755011 1                  STA     REWRITE,X1

      903    13426    4                   REWRITES = REWRITES + 1;

  13426 10 001722   221416 054100                    AOS     REWRITES,,AUTO
        10 001723   001556 710000 10                 TRA     SCAN

      904    13427    4               CASE( %DELSITE_CMD);

      905    13428    5                   IF REWRITES > %MAX_REWRITES THEN DO;

  13428 10 001724   221416 235100                    LDA     REWRITES,,AUTO
        10 001725   000024 115007                    CMPA    20,DL
        10 001726   001733 604400 10                 TMOZ    s:13432

      906    13429    5                       CMDBUF = 'DelSite table overflow;  command not stored.';

  13429 10 001727   040100 100400                    MLR     fill='040'O
        10 001730   002106 000054 2                  ADSC9   XSERRMSG+89              cn=0,n=44
        10 001731   221426 000377                    ADSC9   CMDBUF,,AUTO             cn=0,n=255

      907    13430    5                       GOTO TELLUSER;

  13430 10 001732   001644 710000 10                 TRA     TELLUSER

      908    13431    5                       END;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:171  
      909    13432    5                   IF OUT.NSUBLKS ~= 1 THEN DO;

  13432 10 001733   000001 220100                    LDX0    1,,PR0
        10 001734   000001 100003                    CMPX0   1,DU
        10 001735   001742 600000 10                 TZE     s:13436

      910    13433    5                       CMDBUF = 'DelSite command malformed;  command not stored.';

  13433 10 001736   040100 100400                    MLR     fill='040'O
        10 001737   002121 000057 2                  ADSC9   XSERRMSG+100             cn=0,n=47
        10 001740   221426 000377                    ADSC9   CMDBUF,,AUTO             cn=0,n=255

      911    13434    5                       GOTO TELLUSER;

  13434 10 001741   001644 710000 10                 TRA     TELLUSER

      912    13435    5                       END;
      913    13436    4                   I = REWRITES;

  13436 10 001742   221541 755100                    STA     I,,AUTO

      914    13437    4                   REWRITE.OLD.LEN( I) = OUT.SUBLK$(0)->SYM.COUNT;

  13437 10 001743   221541 236100                    LDQ     I,,AUTO
        10 001744   000022 402007                    MPY     18,DL
        10 001745   000003 471500                    LDP1    3,,PR0
        10 001746   000000 621006                    EAX1    0,QL
        10 001747   100004 236100                    LDQ     4,,PR1
        10 001750   000735 676011 1                  ERQ     REWRITE+2,X1
        10 001751   777000 376003                    ANQ     -512,DU
        10 001752   000735 656011 1                  ERSQ    REWRITE+2,X1

      915    13438    4                   CALL XLATE( REWRITE.OLD.TXT( I), TCM_XLATE_TO_UC,

  13438 10 001753   100004 236100                    LDQ     4,,PR1
        10 001754   000033 772000                    QRL     27
        10 001755   000000 622006                    EAX2    0,QL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:172  
        10 001756   221541 236100                    LDQ     I,,AUTO
        10 001757   000110 402007                    MPY     72,DL
        10 001760   040006 160540                    MVT     fill='040'O
        10 001761   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        10 001762   000735 200037 1                  ADSC9   REWRITE+2,Q              cn=1,n=31
        10 001763   000060 000000 2                  ARG     TCM_XLATE_TO_UC

      916    13439    4                           OUT.SUBLK$(0)->SYM.TEXT);
      917    13440    4                   REWRITE.TYP( I) = %DELSITE_CMD;

  13440 10 001764   000152 235007                    LDA     106,DL
        10 001765   000733 755011 1                  STA     REWRITE,X1

      918    13441    4                   REWRITES = REWRITES + 1;

  13441 10 001766   221416 054100                    AOS     REWRITES,,AUTO
        10 001767   001556 710000 10                 TRA     SCAN

      919    13442    4               CASE( %SET_CMD);

      920    13443    4                   OPT$ = OUT.SUBLK$(0);

  13443 10 001770   000003 236100                    LDQ     3,,PR0
        10 001771   221543 756100                    STQ     OPT$,,AUTO

      921    13444    4                   SUB$ = OPT$->OUT.SUBLK$(0);

  13444 10 001772   221543 471500                    LDP1    OPT$,,AUTO
        10 001773   100003 236100                    LDQ     3,,PR1
        10 001774   221544 756100                    STQ     SUB$,,AUTO

      922    13445    5                   DO CASE( OPT$->OUT.CODE);

  13445 10 001775   100000 236100                    LDQ     0,,PR1
        10 001776   777777 376007                    ANQ     -1,DL
        10 001777   000360 136007                    SBLQ    240,DL
        10 002000   000006 116007                    CMPQ    6,DL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:173  
        10 002001   002003 602006 10                 TNC     s:13445+6,QL
        10 002002   001556 710000 10                 TRA     SCAN
        10 002003   002011 710000 10                 TRA     s:13447
        10 002004   002021 710000 10                 TRA     s:13449
        10 002005   002031 710000 10                 TRA     s:13451
        10 002006   002041 710000 10                 TRA     s:13453
        10 002007   002161 710000 10                 TRA     s:13477
        10 002010   002051 710000 10                 TRA     s:13455

      923    13446    5                       CASE( %MYSITENAME);

      924    13447    5                           TCM_SITENAME = SUB$->SYM.TEXT;

  13447 10 002011   221544 473500                    LDP3    SUB$,,AUTO
        10 002012   300004 236100                    LDQ     4,,PR3
        10 002013   000033 772000                    QRL     27
        10 002014   000000 620006                    EAX0    0,QL
        10 002015   040000 100540                    MLR     fill='040'O
        10 002016   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
        10 002017   000731 000010 1                  ADSC9   TCM_SITENAME             cn=0,n=8
        10 002020   001556 710000 10                 TRA     SCAN

      925    13448    5                       CASE( %ACCOUNT);

      926    13449    5                           TCM_ACCOUNT.ACCT# = SUB$->SYM.TEXT;

  13449 10 002021   221544 473500                    LDP3    SUB$,,AUTO
        10 002022   300004 236100                    LDQ     4,,PR3
        10 002023   000033 772000                    QRL     27
        10 002024   000000 620006                    EAX0    0,QL
        10 002025   040000 100540                    MLR     fill='040'O
        10 002026   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
        10 002027   003526 000010 1                  ADSC9   TCM_ACCOUNT              cn=0,n=8
        10 002030   001556 710000 10                 TRA     SCAN

      927    13450    5                       CASE( %MESSACCT);

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:174  
      928    13451    5                           TCM_MESSACCT.ACCT# = SUB$->SYM.TEXT;

  13451 10 002031   221544 473500                    LDP3    SUB$,,AUTO
        10 002032   300004 236100                    LDQ     4,,PR3
        10 002033   000033 772000                    QRL     27
        10 002034   000000 620006                    EAX0    0,QL
        10 002035   040000 100540                    MLR     fill='040'O
        10 002036   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
        10 002037   003530 000010 1                  ADSC9   TCM_MESSACCT             cn=0,n=8
        10 002040   001556 710000 10                 TRA     SCAN

      929    13452    5                       CASE( %STUCKEE);

      930    13453    5                           TCM_STUCKEE = SUB$->SYM.TEXT;

  13453 10 002041   221544 473500                    LDP3    SUB$,,AUTO
        10 002042   300004 236100                    LDQ     4,,PR3
        10 002043   000033 772000                    QRL     27
        10 002044   000000 620006                    EAX0    0,QL
        10 002045   040000 100540                    MLR     fill='040'O
        10 002046   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
        10 002047   000222 000040 1                  ADSC9   TCM_STUCKEE              cn=0,n=32
        10 002050   001556 710000 10                 TRA     SCAN

      931    13454    5                       CASE( %TIMEZONE);

      932    13455    5                           I = SUB$->SYM.CPOS;

  13455 10 002051   221544 473500                    LDP3    SUB$,,AUTO
        10 002052   300002 235100                    LDA     2,,PR3
        10 002053   221541 755100                    STA     I,,AUTO

      933    13456    5                           J = P$PCB.HI_CHAR - I;

  13456 10 002054   000135 474400 1                  LDP4    XUG_GETCMD+3
        10 002055   400012 236100                    LDQ     10,,PR4
        10 002056   221541 136100                    SBLQ    I,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:175  
        10 002057   221542 756100                    STQ     J,,AUTO

      934    13457    5                           CALL CONCAT( TCM_TZTEXT, ' ',

  13457 10 002060   400000 475500                    LDP5    0,,PR4
        10 002061   040000 236003                    LDQ     16384,DU
        10 002062   000232 756000 1                  STQ     TCM_TZTEXT
        10 002063   221542 720100                    LXL0    J,,AUTO
        10 002064   040000 100545                    MLR     fill='040'O
        10 002065   500000 000010                    ADSC9   0,A,PR5                  cn=0,n=*X0
        10 002066   000232 200005 1                  ADSC9   TCM_TZTEXT               cn=1,n=5

      935    13458    5                                   SUBSTR( P$PCB.TEXT$->CHARS, I, J));
      936    13459    6                           DO CASE( SUB$->SYM.CODE);

  13459 10 002067   221544 470500                    LDP0    SUB$,,AUTO
        10 002070   000000 236100                    LDQ     0,,PR0
        10 002071   777777 376007                    ANQ     -1,DL
        10 002072   000170 136007                    SBLQ    120,DL
        10 002073   000003 116007                    CMPQ    3,DL
        10 002074   002076 602006 10                 TNC     s:13459+7,QL
        10 002075   001556 710000 10                 TRA     SCAN
        10 002076   002101 710000 10                 TRA     s:13461
        10 002077   002140 710000 10                 TRA     s:13468
        10 002100   002153 710000 10                 TRA     s:13472

      937    13460    6                               CASE( %TZUTO);

      938    13461    6                                   CALL CHARBIN( I, SUB$->OUT.SUBLK$(1)->SYM.TEXT);

  13461 10 002101   000004 471500                    LDP1    4,,PR0
        10 002102   100004 236100                    LDQ     4,,PR1
        10 002103   000033 772000                    QRL     27
        10 002104   000000 620006                    EAX0    0,QL
        10 002105   000100 305540                    DTB
        10 002106   100004 230010                    NDSC9   4,,PR1                   cn=1,s=nosgn,sf=0,n=*X0
        10 002107   221541 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:176  

      939    13462    6                                   TCM_UTOFFSET = ( ( I / 100) * %UTS_CSEC_HOUR#) +

  13462 10 002110   221541 236100                    LDQ     I,,AUTO
        10 002111   000144 506007                    DIV     100,DL
        10 002112   222250 756100                    STQ     TVAL+1,,AUTO
        10 002113   221541 236100                    LDQ     I,,AUTO
        10 002114   000144 506007                    DIV     100,DL
        10 002115   222251 755100                    STA     TVAL+2,,AUTO
        10 002116   222250 236100                    LDQ     TVAL+1,,AUTO
        10 002117   000074 402007                    MPY     60,DL
        10 002120   222251 036100                    ADLQ    TVAL+2,,AUTO
        10 002121   013560 402007                    MPY     6000,DL
        10 002122   000234 756000 1                  STQ     TCM_UTOFFSET

      940    13463    6                                           MOD( I, 100) * %UTS_CSEC_MIN#;
      941    13464    6                                   IF SUB$->OUT.SUBLK$(0)->SYM.COUNT > 0 THEN

  13464 10 002123   000003 471500                    LDP1    3,,PR0
        10 002124   100004 236100                    LDQ     4,,PR1
        10 002125   777000 316003                    CANQ    -512,DU
        10 002126   001556 600000 10                 TZE     SCAN

      942    13465    6                                       IF '-' = SUBSTR( SUB$->OUT.SUBLK$(0)->SYM.TEXT,
             13465                                                0, 1) THEN

  13465 10 002127   100004 236100                    LDQ     4,,PR1
        10 002130   000033 772000                    QRL     27
        10 002131   100004 236100                    LDQ     4,,PR1
        10 002132   000777 376003                    ANQ     511,DU
        10 002133   000055 116003                    CMPQ    45,DU
        10 002134   001556 601000 10                 TNZ     SCAN

      943    13466    6                                           TCM_UTOFFSET = -TCM_UTOFFSET;

  13466 10 002135   000234 335000 1                  LCA     TCM_UTOFFSET
        10 002136   000234 755000 1                  STA     TCM_UTOFFSET
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:177  
        10 002137   001556 710000 10                 TRA     SCAN

      944    13467    6                               CASE( %TZMIL);

      945    13468    6                                   CALL INDEX( I, SUBSTR( SUB$->SYM.TEXT, 0, 1),

  13468 10 002140   000004 236100                    LDQ     4,,PR0
        10 002141   000033 772000                    QRL     27
        10 002142   000100 124400                    SCM     mask='000'O
        10 002143   002135 000031 2                  ADSC9   XSERRMSG+112             cn=0,n=25
        10 002144   000004 200001                    ADSC9   4,,PR0                   cn=1,n=1
        10 002145   221541 000100                    ARG     I,,AUTO

      946    13469    6                                           'MLKIHGFEDCBAZNOPQRSTUVWXY');
      947    13470    6                                   TCM_UTOFFSET = ( I - 12) * %UTS_CSEC_HOUR#;

  13470 10 002146   221541 236100                    LDQ     I,,AUTO
        10 002147   000027 402000 11                 MPY     23
        10 002150   000030 136000 11                 SBLQ    24
        10 002151   000234 756000 1                  STQ     TCM_UTOFFSET
        10 002152   001556 710000 10                 TRA     SCAN

      948    13471    6                               CASE( %TZCMN);

      949    13472    6                                   TCM_UTOFFSET = CMN2UTS( SUB$->OUT.SUBLK$(0)->SYM.
             13472                                            CODE)

  13472 10 002153   000003 471500                    LDP1    3,,PR0
        10 002154   100000 720100                    LXL0    0,,PR1
        10 002155   000046 236010 2                  LDQ     CMN2UTS,X0
        10 002156   000027 402000 11                 MPY     23
        10 002157   000234 756000 1                  STQ     TCM_UTOFFSET

      950    13473    6                                           * %UTS_CSEC_HOUR#;
      951    13474    6                               END;

  13474 10 002160   001556 710000 10                 TRA     SCAN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:178  

      952    13475    5                       CASE( ELSE);

      953    13476                                /* do nothing; ignore this SET command */
      954    13477    5                       END;

  13477 10 002161   001556 710000 10                 TRA     SCAN

      955    13478    4               CASE( %IAM_CMD);

      956    13479    5                   DO I = 1 TO OUT.NSUBLKS - 1;  /* skip SITENAME */

  13479 10 002162   000001 235007                    LDA     1,DL
        10 002163   221541 755100                    STA     I,,AUTO
        10 002164   002220 710000 10                 TRA     s:13481+1

      957    13480    5                      CALL CONCAT( FEPNAMES( I - 1), OUT.SUBLK$( I)->SYM.TEXT, BINASC(
             13480                                0));

  13480 10 002165   200005 470500                    LDP0    OUT$,,AUTO
        10 002166   221541 720100                    LXL0    I,,AUTO
        10 002167   000003 471510                    LDP1    3,X0,PR0
        10 002170   100004 236100                    LDQ     4,,PR1
        10 002171   000033 772000                    QRL     27
        10 002172   000000 621006                    EAX1    0,QL
        10 002173   221541 236100                    LDQ     I,,AUTO
        10 002174   000014 402007                    MPY     12,DL
        10 002175   040006 100540                    MLR     fill='040'O
        10 002176   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        10 002177   000232 000014 1                  ADSC9   TCM_TZTEXT,Q             cn=0,n=12
        10 002200   000000 636011                    EAQ     0,X1
        10 002201   000022 772000                    QRL     18
        10 002202   000014 116007                    CMPQ    12,DL
        10 002203   002217 603000 10                 TRC     s:13481
        10 002204   000000 635011                    EAA     0,X1
        10 002205   000022 771000                    ARL     18
        10 002206   222250 755100                    STA     TVAL+1,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:179  
        10 002207   221541 236100                    LDQ     I,,AUTO
        10 002210   000014 402007                    MPY     12,DL
        10 002211   222250 036100                    ADLQ    TVAL+1,,AUTO
        10 002212   777763 621011                    EAX1    -13,X1
        10 002213   777777 661003                    ERX1    -1,DU
        10 002214   040046 100400                    MLR     fill='040'O
        10 002215   000031 000001 11                 ADSC9   25                       cn=0,n=1
        10 002216   000232 000011 1                  ADSC9   TCM_TZTEXT,Q             cn=0,n=*X1

      958    13481    5                       END;

  13481 10 002217   221541 054100                    AOS     I,,AUTO
        10 002220   000001 236100                    LDQ     1,,PR0
        10 002221   000022 772000                    QRL     18
        10 002222   221541 116100                    CMPQ    I,,AUTO
        10 002223   002165 605400 10                 TPNZ    s:13480

      959    13482    4               END;

      960    13483    3           END SCAN;

  13483 10 002224   001556 710000 10                 TRA     SCAN

      961    13484    2       CALL M$CLOSE( CLOSE_SI)

  13484 10 002225   000424 630400 2                  EPPR0   CLOSE_SI
        10 002226   450001 713400                    CLIMB   alt,close
        10 002227   406000 401760                    pmme    nvectors=13
        10 002230   002232 702000 10                 TSX2    s:13487
        10 002231   002232 710000 10                 TRA     s:13487

      962    13485    3       WHENALTRETURN DO;

      963    13486    3           END;

      964    13487    2       IF ERROR_FLAG THEN

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:180  
  13487 10 002232   221537 234100                    SZN     ERROR_FLAG,,AUTO
        10 002233   002236 605000 10                 TPL     s:13489

      965    13488    2           ALTRETURN;

  13488 10 002234   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002235   000000 702211                    TSX2  ! 0,X1

      966    13489    2       RETURN;

  13489 10 002236   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002237   000001 702211                    TSX2  ! 1,X1

      967    13490
      968    13491    2       END INITIALIZE_CONFIGURATION;
      969    13492        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:181  
      970    13493    1   READ_COMMAND: PROC ALTRET;

  13493 10 002240   221536 741300       READ_COMMAND STX1  ! HEX2+2,,AUTO

      971    13494
      972    13495    2       CMD_CODE = 0;

  13495 10 002241   000723 450000 1                  STZ     CMD_CODE

      973    13496    2       CALL READ_TRANSPARENT ALTRET( BYPASS);

  13496 10 002242   011456 701000 10                 TSX1    READ_TRANSPARENT
        10 002243   002267 702000 10                 TSX2    BYPASS

      974    13497    2      CALL XUR$GETCMD( TCM_SMTP_ROOT, CMD$, , LINEBUF, LINESIZE) ALTRET( COMMAND_ERROR
             13497                );

  13497 10 002244   221417 630500                    EPPR0   LINESIZE,,AUTO
        10 002245   222254 450500                    STP0    TVAL+5,,AUTO
        10 002246   000015 236000 11                 LDQ     13
        10 002247   000001 235000 xsym               LDA     B_VECTNIL+1
        10 002250   222252 757100                    STAQ    TVAL+3,,AUTO
        10 002251   200004 631500                    EPPR1   CMD$,,AUTO
        10 002252   222251 451500                    STP1    TVAL+2,,AUTO
        10 002253   000032 236000 11                 LDQ     26
        10 002254   222250 756100                    STQ     TVAL+1,,AUTO
        10 002255   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 002256   000023 631400 xsym               EPPR1   B_VECTNIL+19
        10 002257   000000 701000 xent               TSX1    XUR$GETCMD
        10 002260   002301 702000 10                 TSX2    COMMAND_ERROR

      975    13498    2       CMD_CODE = CMD.CODE;

  13498 10 002261   200004 470500                    LDP0    CMD$,,AUTO
        10 002262   000000 236100                    LDQ     0,,PR0
        10 002263   777777 376007                    ANQ     -1,DL
        10 002264   000723 756000 1                  STQ     CMD_CODE
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:182  

      976    13499    2       RETURN;

  13499 10 002265   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002266   000001 702211                    TSX2  ! 1,X1

      977    13500    2   BYPASS:
      978    13501    3       IF TIMED_OUT OR DATA_LOST THEN DO;

  13501 10 002267   200010 234100       BYPASS       SZN     TIMED_OUT,,AUTO
        10 002270   002273 604000 10                 TMI     s:13502
        10 002271   200011 234100                    SZN     DATA_LOST,,AUTO
        10 002272   002277 605000 10                 TPL     s:13505

      979    13502    3           REPLY$ = R421ZAP$;

  13502 10 002273   000026 236000 2                  LDQ     R421ZAP$
        10 002274   000722 756000 1                  STQ     REPLY$

      980    13503    3           ALTRETURN;

  13503 10 002275   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002276   000000 702211                    TSX2  ! 0,X1

      981    13504    3           END;
      982    13505    2       RETURN;

  13505 10 002277   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002300   000001 702211                    TSX2  ! 1,X1

      983    13506    2   COMMAND_ERROR:
      984    13507    2       IF TCM_PCB.HI_CHAR = 0 THEN

  13507 10 002301   000012 235000 1     COMMAND_ERR* LDA     TCM_PCB+10
        10 002302   002306 601000 10                 TNZ     s:13510

      985    13508    2           REPLY$ = R500$;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:183  

  13508 10 002303   000031 236000 2                  LDQ     R500$
        10 002304   000722 756000 1                  STQ     REPLY$
        10 002305   002310 710000 10                 TRA     s:13511

      986    13509    2       ELSE
      987    13510    2           REPLY$ = R501$;

  13510 10 002306   000032 236000 2                  LDQ     R501$
        10 002307   000722 756000 1                  STQ     REPLY$

      988    13511    2       ALTRETURN;

  13511 10 002310   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002311   000000 702211                    TSX2  ! 0,X1

      989    13512
      990    13513    2       END READ_COMMAND;
      991    13514        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:184  
      992    13515    1   WRITE_REPLY: PROC;

  13515 10 002312   221644 741300       WRITE_REPLY  STX1  ! VLEN+61,,AUTO

      993    13516
      994    13517    2       DCL ERR UBIN(36);
      995    13518
      996    13519    2       IF TCM_TCPFLAVOR THEN

  13519 10 002313   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 002314   002341 605000 10                 TPL     s:13522

      997    13520    2           CALL TCM$LTCP_WRITE( VECTOR( REPLY$->TEXTC.T), ERR);

  13520 10 002315   000722 470400 1                  LDP0    REPLY$
        10 002316   000100 101500                    MRL     fill='000'O
        10 002317   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 002320   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 002321   222250 220100                    LDX0    TVAL+1,,AUTO
        10 002322   000000 635010                    EAA     0,X0
        10 002323   000002 771000                    ARL     2
        10 002324   000140 135007                    SBLA    96,DL
        10 002325   000722 236000 1                  LDQ     REPLY$
        10 002326   200000 036007                    ADLQ    65536,DL
        10 002327   222252 757100                    STAQ    TVAL+3,,AUTO
        10 002330   221645 631500                    EPPR1   ERR,,AUTO
        10 002331   222255 451500                    STP1    TVAL+6,,AUTO
        10 002332   222252 633500                    EPPR3   TVAL+3,,AUTO
        10 002333   222254 453500                    STP3    TVAL+5,,AUTO
        10 002334   222254 630500                    EPPR0   TVAL+5,,AUTO
        10 002335   000020 631400 xsym               EPPR1   B_VECTNIL+16
        10 002336   000000 701000 xent               TSX1    TCM$LTCP_WRITE
        10 002337   000000 011000                    NOP     0
        10 002340   002357 710000 10                 TRA     s:13525

      998    13521    3       ELSE DO;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:185  
      999    13522    3           WRITE_UC.BUF_ = VECTOR( REPLY$->TEXTC.T);

  13522 10 002341   000722 470400 1                  LDP0    REPLY$
        10 002342   000100 101500                    MRL     fill='000'O
        10 002343   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 002344   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 002345   222250 220100                    LDX0    TVAL+1,,AUTO
        10 002346   000000 635010                    EAA     0,X0
        10 002347   000002 771000                    ARL     2
        10 002350   000140 135007                    SBLA    96,DL
        10 002351   000722 236000 1                  LDQ     REPLY$
        10 002352   200000 036007                    ADLQ    65536,DL
        10 002353   003470 757000 1                  STAQ    WRITE_UC+4

     1000    13523    3           CALL M$WRITE( WRITE_UC);

  13523 10 002354   003464 630400 1                  EPPR0   WRITE_UC
        10 002355   040001 713400                    CLIMB   write
        10 002356   401400 401760                    pmme    nvectors=4

     1001    13524    3           END;

     1002    13525    3       IF TCM_DRIBBLE OR TCM_DRIBBLE_ME THEN DO;

  13525 10 002357   000216 235000 1                  LDA     TCM_DRIBBLE
        10 002360   002363 601000 10                 TNZ     s:13526
        10 002361   000217 236000 1                  LDQ     TCM_DRIBBLE_ME
        10 002362   002402 600000 10                 TZE     s:13529

     1003    13526    3           WRITE_DRIBBLE.BUF_ = VECTOR( REPLY$->TEXTC.T);

  13526 10 002363   000722 470400 1                  LDP0    REPLY$
        10 002364   000100 101500                    MRL     fill='000'O
        10 002365   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 002366   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 002367   222250 220100                    LDX0    TVAL+1,,AUTO
        10 002370   000000 636010                    EAQ     0,X0
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:186  
        10 002371   000022 772000                    QRL     18
        10 002372   000064 737000                    LLS     52
        10 002373   000140 135007                    SBLA    96,DL
        10 002374   000722 236000 1                  LDQ     REPLY$
        10 002375   200000 036007                    ADLQ    65536,DL
        10 002376   003516 757000 1                  STAQ    WRITE_DRIBBLE+4

     1004    13527    3           CALL M$WRITE( WRITE_DRIBBLE);

  13527 10 002377   003512 630400 1                  EPPR0   WRITE_DRIBBLE
        10 002400   040001 713400                    CLIMB   write
        10 002401   401400 401760                    pmme    nvectors=4

     1005    13528    3           END;

     1006    13529    2       RETURN;

  13529 10 002402   221644 221300                    LDX1  ! VLEN+61,,AUTO
        10 002403   000001 702211                    TSX2  ! 1,X1

     1007    13530
     1008    13531    2       END WRITE_REPLY;
     1009    13532        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:187  
     1010    13533    1   SAVE_HOST_NAME: PROC ALTRET;

  13533 10 002404   221536 741300       SAVE_HOST_N* STX1  ! HEX2+2,,AUTO

     1011    13534
     1012    13535    2       SYM$ = CMD.SUBLK$( 0);

  13535 10 002405   200004 470500                    LDP0    CMD$,,AUTO
        10 002406   000003 236100                    LDQ     3,,PR0
        10 002407   200005 756100                    STQ     OUT$,,AUTO

     1013    13536    2       HELO.LEN = LINESIZE - SYM.CPOS;

  13536 10 002410   200005 471500                    LDP1    OUT$,,AUTO
        10 002411   221417 236100                    LDQ     LINESIZE,,AUTO
        10 002412   100002 136100                    SBLQ    2,,PR1
        10 002413   000033 736000                    QLS     27
        10 002414   200016 552140                    STBQ    HELO,'40'O,AUTO

     1014    13537    2       CALL CONCAT( HELO.TXT, SUBSTR( LINEBUF, SYM.CPOS, HELO.LEN));

  13537 10 002415   100002 235100                    LDA     2,,PR1
        10 002416   200016 236100                    LDQ     HELO,,AUTO
        10 002417   000033 772000                    QRL     27
        10 002420   000000 620006                    EAX0    0,QL
        10 002421   040100 100445                    MLR     fill='040'O
        10 002422   001525 000010 1                  ADSC9   LINEBUF,A                cn=0,n=*X0
        10 002423   200016 200377                    ADSC9   HELO,,AUTO               cn=1,n=255

     1015    13538    2       CALL CONCAT( OCMSG, SUBSTR( HELO.TXT, 0, HELO.LEN), ' on');

  13538 10 002424   200016 236100                    LDQ     HELO,,AUTO
        10 002425   000033 772000                    QRL     27
        10 002426   000000 620006                    EAX0    0,QL
        10 002427   040000 100540                    MLR     fill='040'O
        10 002430   200016 200010                    ADSC9   HELO,,AUTO               cn=1,n=*X0
        10 002431   003267 000377 1                  ADSC9   OCMSG                    cn=0,n=255
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:188  
        10 002432   000377 116007                    CMPQ    255,DL
        10 002433   002441 603000 10                 TRC     s:13539
        10 002434   777400 620006                    EAX0    -256,QL
        10 002435   777777 660003                    ERX0    -1,DU
        10 002436   040046 100400                    MLR     fill='040'O
        10 002437   001774 000003 2                  ADSC9   XSERRMSG+15              cn=0,n=3
        10 002440   003267 000010 1                  ADSC9   OCMSG,Q                  cn=0,n=*X0

     1016    13539    2       CALL TELL_OPERATOR;

  13539 10 002441   002447 701000 10                 TSX1    TELL_OPERATOR
        10 002442   000000 011000                    NOP     0

     1017    13540    2       REPLY$ = R250A$;

  13540 10 002443   000021 236000 2                  LDQ     R250A$
        10 002444   000722 756000 1                  STQ     REPLY$

     1018    13541    2       RETURN;

  13541 10 002445   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002446   000001 702211                    TSX2  ! 1,X1

     1019    13542
     1020    13543    2       END SAVE_HOST_NAME;
     1021    13544        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:189  
     1022    13545    1   TELL_OPERATOR: PROC;

  13545 10 002447   221540 741300       TELL_OPERAT* STX1  ! HAVE_A_CMD,,AUTO

     1023    13546
     1024    13547    2       DCL BLANK_INDEX UBIN;
     1025    13548
     1026    13549    3       IF NOT TCM_TCPFLAVOR THEN DO;

  13549 10 002450   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 002451   002472 604000 10                 TMI     s:13556

     1027    13550    3           CALL INDEX( BLANK_INDEX, '  ', OCMSG);

  13550 10 002452   000000 120400                    SCD
        10 002453   003267 000377 1                  ADSC9   OCMSG                    cn=0,n=255
        10 002454   002144 000002 2                  ADSC9   XSERRMSG+119             cn=0,n=2
        10 002455   221541 000100                    ARG     BLANK_INDEX,,AUTO
        10 002456   002460 607000 10                 TTF     s:13551
        10 002457   221541 054100                    AOS     BLANK_INDEX,,AUTO

     1028    13551    3           TCM_KEYIN.MESS_ = VECTOR( SUBSTR( OCMSG, 0, BLANK_INDEX));

  13551 10 002460   221541 235100                    LDA     BLANK_INDEX,,AUTO
        10 002461   000020 735000                    ALS     16
        10 002462   000140 135007                    SBLA    96,DL
        10 002463   000033 236000 11                 LDQ     27
        10 002464   004106 757000 1                  STAQ    TCM_KEYIN+2

     1029    13552    3           CALL M$KEYIN( TCM_KEYIN)

  13552 10 002465   004104 630400 1                  EPPR0   TCM_KEYIN
        10 002466   520000 713400                    CLIMB   alt,+40960
        10 002467   401400 401760                    pmme    nvectors=4
        10 002470   002472 702000 10                 TSX2    s:13556
        10 002471   002472 710000 10                 TRA     s:13556

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:190  
     1030    13553    4           WHENALTRETURN DO;

     1031    13554    4               END;

     1032    13555    3           END;

     1033    13556    2       RETURN;

  13556 10 002472   221540 221300                    LDX1  ! HAVE_A_CMD,,AUTO
        10 002473   000001 702211                    TSX2  ! 1,X1

     1034    13557
     1035    13558    2       END TELL_OPERATOR;
     1036    13559        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:191  
     1037    13560    1   SAVE_REVERSE_PATH: PROC ALTRET;

  13560 10 002474   221536 741300       SAVE_REVERS* STX1  ! HEX2+2,,AUTO

     1038    13561
     1039    13562    2       SYM$ = CMD.SUBLK$(0);

  13562 10 002475   200004 470500                    LDP0    CMD$,,AUTO
        10 002476   000003 236100                    LDQ     3,,PR0
        10 002477   200005 756100                    STQ     OUT$,,AUTO

     1040    13563    2       MAIL.LEN = LINESIZE - SYM.CPOS;

  13563 10 002500   200005 471500                    LDP1    OUT$,,AUTO
        10 002501   221417 236100                    LDQ     LINESIZE,,AUTO
        10 002502   100002 136100                    SBLQ    2,,PR1
        10 002503   000033 736000                    QLS     27
        10 002504   200116 552140                    STBQ    MAIL,'40'O,AUTO

     1041    13564    2       CALL CONCAT( MAIL.TXT, SUBSTR( LINEBUF, SYM.CPOS, MAIL.LEN));

  13564 10 002505   100002 235100                    LDA     2,,PR1
        10 002506   200116 236100                    LDQ     MAIL,,AUTO
        10 002507   000033 772000                    QRL     27
        10 002510   000000 620006                    EAX0    0,QL
        10 002511   040100 100445                    MLR     fill='040'O
        10 002512   001525 000010 1                  ADSC9   LINEBUF,A                cn=0,n=*X0
        10 002513   200116 200377                    ADSC9   MAIL,,AUTO               cn=1,n=255

     1042    13565    2       RETURN;

  13565 10 002514   000001 702211                    TSX2  ! 1,X1

     1043    13566
     1044    13567    2       END SAVE_REVERSE_PATH;
     1045    13568        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:192  
     1046    13569    1   SAVE_USER_NAME: PROC ALTRET;

  13569 10 002515   221536 741300       SAVE_USER_N* STX1  ! HEX2+2,,AUTO

     1047    13570
     1048    13571    2       DCL TEMP SBIN;
     1049    13572    2       DCL IDX UBIN;
     1050    13573
     1051    13574    3       IF USER_COUNT = %MAX_USERS THEN DO;

  13574 10 002516   000724 235000 1                  LDA     USER_COUNT
        10 002517   000175 115007                    CMPA    125,DL
        10 002520   002524 601000 10                 TNZ     s:13578

     1052    13575    3           REPLY$ = R552$;

  13575 10 002521   000042 236000 2                  LDQ     R552$
        10 002522   000722 756000 1                  STQ     REPLY$

     1053    13576    3           ALTRETURN;

  13576 10 002523   000000 702211                    TSX2  ! 0,X1

     1054    13577    3           END;
     1055    13578    2       SYM$ = CMD.SUBLK$(0);

  13578 10 002524   200004 470500                    LDP0    CMD$,,AUTO
        10 002525   000003 236100                    LDQ     3,,PR0
        10 002526   200005 756100                    STQ     OUT$,,AUTO

     1056    13579    2       ZTEXT.LEN = LINESIZE - SYM.CPOS;

  13579 10 002527   200005 471500                    LDP1    OUT$,,AUTO
        10 002530   221417 236100                    LDQ     LINESIZE,,AUTO
        10 002531   100002 136100                    SBLQ    2,,PR1
        10 002532   000033 736000                    QLS     27
        10 002533   201616 552140                    STBQ    ZTEXT,'40'O,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:193  

     1057    13580    2       CALL CONCAT( ZTEXT.TXT, SUBSTR( LINEBUF, SYM.CPOS, ZTEXT.LEN));

  13580 10 002534   100002 235100                    LDA     2,,PR1
        10 002535   201616 236100                    LDQ     ZTEXT,,AUTO
        10 002536   000033 772000                    QRL     27
        10 002537   000000 620006                    EAX0    0,QL
        10 002540   040100 100445                    MLR     fill='040'O
        10 002541   001525 000010 1                  ADSC9   LINEBUF,A                cn=0,n=*X0
        10 002542   201616 200377                    ADSC9   ZTEXT,,AUTO              cn=1,n=255

     1058    13581    2       CALL TRIMTEXT( ZTEXT, RCPT);

  13581 10 002543   200216 633500                    EPPR3   RCPT,,AUTO
        10 002544   221660 453500                    STP3    @SOURCE+1,,AUTO
        10 002545   201616 634500                    EPPR4   ZTEXT,,AUTO
        10 002546   221657 454500                    STP4    PARSEFLAG+3,,AUTO
        10 002547   007404 701000 10                 TSX1    TRIMTEXT
        10 002550   000000 011000                    NOP     0

     1059    13582    3       IF (SUBSTR(RCPT.TXT, RCPT.LEN -1, 1) = '.') THEN DO;

  13582 10 002551   200216 236100                    LDQ     RCPT,,AUTO
        10 002552   000033 772000                    QRL     27
        10 002553   040000 106506                    CMPC    fill='040'O
        10 002554   200216 000001                    ADSC9   RCPT,Q,AUTO              cn=0,n=1
        10 002555   000034 000001 11                 ADSC9   28                       cn=0,n=1
        10 002556   002565 601000 10                 TNZ     s:13586

     1060    13583    3           SUBSTR(RCPT.TXT, RCPT.LEN -1, 1) = ' ';

  13583 10 002557   040106 100400                    MLR     fill='040'O
        10 002560   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 002561   200216 000001                    ADSC9   RCPT,Q,AUTO              cn=0,n=1

     1061    13584    3           RCPT.LEN = RCPT.LEN - 1;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:194  
  13584 10 002562   200216 236100                    LDQ     RCPT,,AUTO
        10 002563   777000 036003                    ADLQ    -512,DU
        10 002564   200216 552140                    STBQ    RCPT,'40'O,AUTO

     1062    13585    3           END;

     1063    13586    3       IF SUBSTR( RCPT.TXT, 0, 1) = '@' THEN DO;

  13586 10 002565   200216 236100                    LDQ     RCPT,,AUTO
        10 002566   000777 376003                    ANQ     511,DU
        10 002567   000100 116003                    CMPQ    64,DU
        10 002570   002626 601000 10                 TNZ     s:13596

     1064    13587                /* The old convention @host:user */
     1065    13588    3           CALL INDEX( IDX, ':', RCPT.TXT)

  13588 10 002571   000000 124500                    SCM     mask='000'O
        10 002572   200216 200377                    ADSC9   RCPT,,AUTO               cn=1,n=255
        10 002573   000035 000001 11                 ADSC9   29                       cn=0,n=1
        10 002574   221540 000100                    ARG     IDX,,AUTO
        10 002575   002577 606400 10                 TTN     s:13590
        10 002576   002603 710000 10                 TRA     s:13593

     1066    13589    4           WHENALTRETURN DO;

     1067    13590    4               REPLY$ = R550$;

  13590 10 002577   000035 236000 2                  LDQ     R550$
        10 002600   000722 756000 1                  STQ     REPLY$

     1068    13591    4               ALTRETURN;

  13591 10 002601   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002602   000000 702211                    TSX2  ! 0,X1

     1069    13592    4               END;
     1070    13593    3           ZTEXT = RCPT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:195  

  13593 10 002603   000100 100500                    MLR     fill='000'O
        10 002604   200216 000400                    ADSC9   RCPT,,AUTO               cn=0,n=256
        10 002605   201616 000400                    ADSC9   ZTEXT,,AUTO              cn=0,n=256

     1071    13594    3           CALL CONCAT (RCPT.TXT,SUBSTR(ZTEXT.TXT,IDX+1,ZTEXT.LEN-1-IDX),SUBSTR(ZTEXT.
             13594                    TXT,0,IDX));

  13594 10 002606   201616 236100                    LDQ     ZTEXT,,AUTO
        10 002607   000033 772000                    QRL     27
        10 002610   221540 136100                    SBLQ    IDX,,AUTO
        10 002611   777777 620006                    EAX0    -1,QL
        10 002612   221540 235100                    LDA     IDX,,AUTO
        10 002613   040100 100545                    MLR     fill='040'O
        10 002614   201616 400010                    ADSC9   ZTEXT,A,AUTO             cn=2,n=*X0
        10 002615   200216 200377                    ADSC9   RCPT,,AUTO               cn=1,n=255
        10 002616   000400 116007                    CMPQ    256,DL
        10 002617   002626 605000 10                 TPL     s:13596
        10 002620   777377 620006                    EAX0    -257,QL
        10 002621   777777 660003                    ERX0    -1,DU
        10 002622   000000 621005                    EAX1    0,AL
        10 002623   040146 100540                    MLR     fill='040'O
        10 002624   201616 200011                    ADSC9   ZTEXT,,AUTO              cn=1,n=*X1
        10 002625   200216 000010                    ADSC9   RCPT,Q,AUTO              cn=0,n=*X0

     1072    13595    3           END;

     1073    13596    2       CALL FIXLOCAL( RCPT) ALTRET( NOTLOCAL);

  13596 10 002626   200216 630500                    EPPR0   RCPT,,AUTO
        10 002627   221675 450500                    STP0    TBUF+9,,AUTO
        10 002630   007660 701000 10                 TSX1    FIXLOCAL
        10 002631   002703 702000 10                 TSX2    NOTLOCAL

     1074    13597    3       IF SUBSTR( RCPT.TXT, 0, 1) = '/' THEN DO;

  13597 10 002632   200216 236100                    LDQ     RCPT,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:196  
        10 002633   000777 376003                    ANQ     511,DU
        10 002634   000057 116003                    CMPQ    47,DU
        10 002635   002672 601000 10                 TNZ     s:13609

     1075    13598                /* might be addressed to a mail folder; rewrite it if so */
     1076    13599    3           ZTEXT = RCPT;

  13599 10 002636   000100 100500                    MLR     fill='000'O
        10 002637   200216 000400                    ADSC9   RCPT,,AUTO               cn=0,n=256
        10 002640   201616 000400                    ADSC9   ZTEXT,,AUTO              cn=0,n=256

     1077    13600    3           CALL INDEX( TEMP, '.', SUBSTR( ZTEXT.TXT, 0, ZTEXT.LEN))

  13600 10 002641   201616 236100                    LDQ     ZTEXT,,AUTO
        10 002642   000033 772000                    QRL     27
        10 002643   000000 620006                    EAX0    0,QL
        10 002644   000000 124540                    SCM     mask='000'O
        10 002645   201616 200010                    ADSC9   ZTEXT,,AUTO              cn=1,n=*X0
        10 002646   000034 000001 11                 ADSC9   28                       cn=0,n=1
        10 002647   221537 000100                    ARG     TEMP,,AUTO
        10 002650   002672 606400 10                 TTN     s:13609

     1078    13601    4           WHENRETURN DO;

     1079    13602    4               CALL CONCAT( RCPT.TXT,

  13602 10 002651   201616 236100                    LDQ     ZTEXT,,AUTO
        10 002652   000033 772000                    QRL     27
        10 002653   221537 136100                    SBLQ    TEMP,,AUTO
        10 002654   000000 620006                    EAX0    0,QL
        10 002655   221537 235100                    LDA     TEMP,,AUTO
        10 002656   040100 100545                    MLR     fill='040'O
        10 002657   201616 200010                    ADSC9   ZTEXT,A,AUTO             cn=1,n=*X0
        10 002660   200216 200377                    ADSC9   RCPT,,AUTO               cn=1,n=255
        10 002661   000377 116007                    CMPQ    255,DL
        10 002662   002671 605000 10                 TPL     s:13605
        10 002663   777400 620006                    EAX0    -256,QL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:197  
        10 002664   777777 660003                    ERX0    -1,DU
        10 002665   000000 621005                    EAX1    0,AL
        10 002666   040146 100540                    MLR     fill='040'O
        10 002667   201616 200011                    ADSC9   ZTEXT,,AUTO              cn=1,n=*X1
        10 002670   200216 200010                    ADSC9   RCPT,Q,AUTO              cn=1,n=*X0

     1080    13603    4                       SUBSTR( ZTEXT.TXT, TEMP, ZTEXT.LEN - TEMP),
     1081    13604    4                       SUBSTR( ZTEXT.TXT, 0, TEMP));
     1082    13605    4               END;

  13605 10 002671   002672 710000 10                 TRA     s:13609

     1083    13606    4           WHENALTRETURN DO;

     1084    13607    4               END;

     1085    13608    3           END;

     1086    13609    2       CALL LOOKUP_ALIAS( ADDR( RCPT))

  13609 10 002672   200216 630500                    EPPR0   RCPT,,AUTO
        10 002673   222256 450500                    STP0    TVAL+7,,AUTO
        10 002674   222256 631500                    EPPR1   TVAL+7,,AUTO
        10 002675   221675 451500                    STP1    TBUF+9,,AUTO
        10 002676   010001 701000 10                 TSX1    LOOKUP_ALIAS
        10 002677   002701 702000 10                 TSX2    s:13611
        10 002700   002703 710000 10                 TRA     NOTLOCAL

     1087    13610    3       WHENALTRETURN DO;

     1088    13611    3           ALTRETURN;

  13611 10 002701   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002702   000000 702211                    TSX2  ! 0,X1

     1089    13612    3           END;
     1090    13613    2   NOTLOCAL:
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:198  
     1091    13614    2       USERS( USER_COUNT) = RCPT;

  13614 10 002703   000724 235000 1     NOTLOCAL     LDA     USER_COUNT
        10 002704   000010 735000                    ALS     8
        10 002705   000105 100500                    MLR     fill='000'O
        10 002706   200216 000400                    ADSC9   RCPT,,AUTO               cn=0,n=256
        10 002707   201716 000400                    ADSC9   USERS,A,AUTO             cn=0,n=256

     1092    13615    2       RETURN;

  13615 10 002710   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002711   000001 702211                    TSX2  ! 1,X1

     1093    13616
     1094    13617    2       END SAVE_USER_NAME;
     1095    13618        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:199  
     1096    13619    1   VERIFY_ADDRESS: PROC ALTRET;

  13619 10 002712   221536 741300       VERIFY_ADDR* STX1  ! HEX2+2,,AUTO

     1097    13620
     1098    13621    2       SYM$ = CMD.SUBLK$(0);

  13621 10 002713   200004 470500                    LDP0    CMD$,,AUTO
        10 002714   000003 236100                    LDQ     3,,PR0
        10 002715   200005 756100                    STQ     OUT$,,AUTO

     1099    13622    2       ZTEXT.LEN = SYM.COUNT;

  13622 10 002716   200005 471500                    LDP1    OUT$,,AUTO
        10 002717   100004 236100                    LDQ     4,,PR1
        10 002720   201616 552140                    STBQ    ZTEXT,'40'O,AUTO

     1100    13623    2       CALL INSERT( ZTEXT.TXT, 0, SYM.COUNT, SYM.TEXT);

  13623 10 002721   100004 236100                    LDQ     4,,PR1
        10 002722   000033 772000                    QRL     27
        10 002723   000000 620006                    EAX0    0,QL
        10 002724   000000 622006                    EAX2    0,QL
        10 002725   040140 100540                    MLR     fill='040'O
        10 002726   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        10 002727   201616 200012                    ADSC9   ZTEXT,,AUTO              cn=1,n=*X2

     1101    13624    2       STATUS_LINE.CMD = 'VRFY';

  13624 10 002730   040000 100400                    MLR     fill='040'O
        10 002731   002145 000004 2                  ADSC9   XSERRMSG+120             cn=0,n=4
        10 002732   003372 600004 1                  ADSC9   STATUS_LINE+3            cn=3,n=4

     1102    13625    2       STATUS_LINE.STATUS = ' ';

  13625 10 002733   000040 236003                    LDQ     32,DU
        10 002734   003371 552020 1                  STBQ    STATUS_LINE+2,'20'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:200  

     1103    13626    2       STATUS_LINE.LINES = ' ';

  13626 10 002735   040000 100400                    MLR     fill='040'O
        10 002736   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 002737   003371 400004 1                  ADSC9   STATUS_LINE+2            cn=2,n=4

     1104    13627    2       STATUS_LINE.FROM_ADDR = ' ';

  13627 10 002740   040000 100400                    MLR     fill='040'O
        10 002741   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 002742   003400 200020 1                  ADSC9   STATUS_LINE+9            cn=1,n=16

     1105    13628    2       STATUS_LINE.RCPT_ADDR = SUBSTR( ZTEXT.TXT, 0, ZTEXT.LEN);

  13628 10 002743   201616 236100                    LDQ     ZTEXT,,AUTO
        10 002744   000033 772000                    QRL     27
        10 002745   000000 620006                    EAX0    0,QL
        10 002746   040000 100540                    MLR     fill='040'O
        10 002747   201616 200010                    ADSC9   ZTEXT,,AUTO              cn=1,n=*X0
        10 002750   003374 000020 1                  ADSC9   STATUS_LINE+5            cn=0,n=16

     1106    13629    2       CALL STATUS_LINE_UPDATE;

  13629 10 002751   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 002752   000000 011000                    NOP     0

     1107    13630    2       CALL TRIMTEXT( ZTEXT, TTEXT);

  13630 10 002753   201316 630500                    EPPR0   TTEXT,,AUTO
        10 002754   221660 450500                    STP0    @SOURCE+1,,AUTO
        10 002755   201616 631500                    EPPR1   ZTEXT,,AUTO
        10 002756   221657 451500                    STP1    PARSEFLAG+3,,AUTO
        10 002757   007404 701000 10                 TSX1    TRIMTEXT
        10 002760   000000 011000                    NOP     0

     1108    13631    2       CALL FIXLOCAL( TTEXT) ALTRET( NOTLOCAL);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:201  

  13631 10 002761   201316 630500                    EPPR0   TTEXT,,AUTO
        10 002762   221675 450500                    STP0    TBUF+9,,AUTO
        10 002763   007660 701000 10                 TSX1    FIXLOCAL
        10 002764   002776 702000 10                 TSX2    NOTLOCAL

     1109    13632    2       CALL LOOKUP_ALIAS( ADDR( TTEXT))

  13632 10 002765   201316 630500                    EPPR0   TTEXT,,AUTO
        10 002766   222257 450500                    STP0    TVAL+8,,AUTO
        10 002767   222257 631500                    EPPR1   TVAL+8,,AUTO
        10 002770   221675 451500                    STP1    TBUF+9,,AUTO
        10 002771   010001 701000 10                 TSX1    LOOKUP_ALIAS
        10 002772   002774 702000 10                 TSX2    s:13634
        10 002773   002776 710000 10                 TRA     NOTLOCAL

     1110    13633    3       WHENALTRETURN DO;

     1111    13634    3           ALTRETURN;

  13634 10 002774   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 002775   000000 702211                    TSX2  ! 0,X1

     1112    13635    3           END;
     1113    13636    2   NOTLOCAL:
     1114    13637    2       RETURN;

  13637 10 002776   221536 221300       NOTLOCAL     LDX1  ! HEX2+2,,AUTO
        10 002777   000001 702211                    TSX2  ! 1,X1

     1115    13638
     1116    13639    2       END VERIFY_ADDRESS;
     1117    13640        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:202  
     1118    13641    1   BUILD_MAIL_HEADER: PROC ALTRET;

  13641 10 003000   221536 741300       BUILD_MAIL_* STX1  ! HEX2+2,,AUTO

     1119    13642
     1120    13643    2       CALL M$TIME( GET_UTS);

  13643 10 003001   001546 630400 2                  EPPR0   GET_UTS
        10 003002   020004 713400                    CLIMB   8196
        10 003003   402000 401760                    pmme    nvectors=5

     1121    13644    2       CALL BINCHAR( SUBSTR( DATA_NAME.NAME#, 4, 12), UTS);

  13644 10 003004   000730 235000 1                  LDA     UTS
        10 003005   000044 773000                    LRL     36
        10 003006   222250 757100                    STAQ    TVAL+1,,AUTO
        10 003007   000000 301500                    BTD
        10 003010   222250 000010                    NDSC9   TVAL+1,,AUTO             cn=0,s=lsgnf,sf=0,n=8
        10 003011   003625 230014 1                  NDSC9   DATA_NAME+1              cn=1,s=nosgn,sf=0,n=12

     1122    13645    2       CALL BINCHAR( SUBSTR( SEND_CMD.NAME#, 9, 12), UTS);

  13645 10 003012   000730 235000 1                  LDA     UTS
        10 003013   000044 773000                    LRL     36
        10 003014   222250 757100                    STAQ    TVAL+1,,AUTO
        10 003015   000000 301500                    BTD
        10 003016   222250 000010                    NDSC9   TVAL+1,,AUTO             cn=0,s=lsgnf,sf=0,n=8
        10 003017   004070 430014 1                  NDSC9   SEND_CMD+2               cn=2,s=nosgn,sf=0,n=12

     1123    13646    2       OPEN_DATA.NAME_ = VECTOR( DATA_NAME);

  13646 10 003020   000036 237000 11                 LDAQ    30
        10 003021   003540 757000 1                  STAQ    OPEN_DATA+6

     1124    13647    2       REOPEN_DATA.NAME_ = VECTOR( DATA_NAME);

  13647 10 003022   000036 237000 11                 LDAQ    30
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:203  
        10 003023   003640 757000 1                  STAQ    REOPEN_DATA+6

     1125    13648    2       DELETE_DATA.NAME_ = VECTOR( DATA_NAME);

  13648 10 003024   000036 237000 11                 LDAQ    30
        10 003025   003732 757000 1                  STAQ    DELETE_DATA+6

     1126    13649    2       CALL M$OPEN( OPEN_DATA) ALTRET( IOERR);

  13649 10 003026   003532 630400 1                  EPPR0   OPEN_DATA
        10 003027   450000 713400                    CLIMB   alt,open
        10 003030   410400 401760                    pmme    nvectors=18
        10 003031   003254 702000 10                 TSX2    IOERR

     1127    13650    2       CALL CONCAT( LINEBUF, 'TO:', ADDR( USERS( 0))->TEXTC.T);

  13650 10 003032   201716 236100                    LDQ     USERS,,AUTO
        10 003033   000033 772000                    QRL     27
        10 003034   000000 620006                    EAX0    0,QL
        10 003035   002146 236000 2                  LDQ     XSERRMSG+121
        10 003036   001525 552070 1                  STBQ    LINEBUF,'70'O
        10 003037   040000 100540                    MLR     fill='040'O
        10 003040   201716 200010                    ADSC9   USERS,,AUTO              cn=1,n=*X0
        10 003041   001525 600374 1                  ADSC9   LINEBUF                  cn=3,n=252

     1128    13651    2       WRITE_DATA.BUF_.BOUND = USERS.LEN( 0) + 2;

  13651 10 003042   201716 236100                    LDQ     USERS,,AUTO
        10 003043   000033 772000                    QRL     27
        10 003044   000002 036007                    ADLQ    2,DL
        10 003045   000020 736000                    QLS     16
        10 003046   004022 676000 1                  ERQ     WRITE_DATA+4
        10 003047   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 003050   004022 656000 1                  ERSQ    WRITE_DATA+4

     1129    13652    2       DATA_KEY.KEY = 1000;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:204  
  13652 10 003051   001750 236007                    LDQ     1000,DL
        10 003052   003430 552034 1                  STBQ    DATA_KEY,'34'O

     1130    13653    2       CALL M$WRITE( WRITE_DATA) ALTRET( IOERR);

  13653 10 003053   004016 630400 1                  EPPR0   WRITE_DATA
        10 003054   440001 713400                    CLIMB   alt,write
        10 003055   401400 401760                    pmme    nvectors=4
        10 003056   003254 702000 10                 TSX2    IOERR

     1131    13654    2       CALL M$TIME( GET_TIMESTAMP);

  13654 10 003057   001532 630400 2                  EPPR0   GET_TIMESTAMP
        10 003060   020004 713400                    CLIMB   8196
        10 003061   402000 401760                    pmme    nvectors=5

     1132    13655    2       DATA_KEY.KEY = 4000;

  13655 10 003062   007640 236007                    LDQ     4000,DL
        10 003063   003430 552034 1                  STBQ    DATA_KEY,'34'O

     1133    13656    2       CALL CONCAT( LINEBUF,

  13656 10 003064   200116 236100                    LDQ     MAIL,,AUTO
        10 003065   000033 772000                    QRL     27
        10 003066   040000 100400                    MLR     fill='040'O
        10 003067   002147 000023 2                  ADSC9   XSERRMSG+122             cn=0,n=19
        10 003070   001525 000023 1                  ADSC9   LINEBUF                  cn=0,n=19
        10 003071   000000 620006                    EAX0    0,QL
        10 003072   040000 100540                    MLR     fill='040'O
        10 003073   200116 200010                    ADSC9   MAIL,,AUTO               cn=1,n=*X0
        10 003074   001531 600354 1                  ADSC9   LINEBUF+4                cn=3,n=236

     1134    13657    2               'TRACE:Return-path: ', SUBSTR( MAIL.TXT, 0, MAIL.LEN));
     1135    13658    2       CALL INDEX( LINESIZE, '   ', LINEBUF);

  13658 10 003075   221417 631500                    EPPR1   LINESIZE,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:205  
        10 003076   002144 633400 2                  EPPR3   XSERRMSG+119
        10 003077   000003 223003                    LDX3    3,DU
        10 003100   001525 630400 1                  EPPR0   LINEBUF
        10 003101   000377 220003                    LDX0    255,DU
        10 003102   000000 236003                    LDQ     0,DU
        10 003103   000000 701000 xent               TSX1    X66_INDEX
        10 003104   000000 011000                    NOP     0

     1136    13659    2       WRITE_DATA.BUF_.BOUND = LINESIZE - 1;

  13659 10 003105   221417 236100                    LDQ     LINESIZE,,AUTO
        10 003106   000001 136007                    SBLQ    1,DL
        10 003107   000020 736000                    QLS     16
        10 003110   004022 676000 1                  ERQ     WRITE_DATA+4
        10 003111   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 003112   004022 656000 1                  ERSQ    WRITE_DATA+4

     1137    13660    2       CALL M$WRITE( WRITE_DATA) ALTRET( IOERR);

  13660 10 003113   004016 630400 1                  EPPR0   WRITE_DATA
        10 003114   440001 713400                    CLIMB   alt,write
        10 003115   401400 401760                    pmme    nvectors=4
        10 003116   003254 702000 10                 TSX2    IOERR

     1138    13661    2       DATA_KEY.KEY = 5000;

  13661 10 003117   011610 236007                    LDQ     5000,DL
        10 003120   003430 552034 1                  STBQ    DATA_KEY,'34'O

     1139    13662    2       CALL CONCAT( DATEWORK, DATEBUF.DAY, ' ', DATEBUF.MON, ' ', DATEBUF.YEAR);

  13662 10 003121   003411 220000 1                  LDX0    DATEBUF+1
        10 003122   221526 740100                    STX0    DATEWORK,,AUTO
        10 003123   040000 236007                    LDQ     16384,DL
        10 003124   221526 552110                    STBQ    DATEWORK,'10'O,AUTO
        10 003125   040100 100400                    MLR     fill='040'O
        10 003126   003410 000003 1                  ADSC9   DATEBUF                  cn=0,n=3
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:206  
        10 003127   221526 600003                    ADSC9   DATEWORK,,AUTO           cn=3,n=3
        10 003130   221527 552110                    STBQ    DATEWORK+1,'10'O,AUTO
        10 003131   040100 100400                    MLR     fill='040'O
        10 003132   003412 000002 1                  ADSC9   DATEBUF+2                cn=0,n=2
        10 003133   221527 600003                    ADSC9   DATEWORK+1,,AUTO         cn=3,n=3

     1140    13663    2       CALL CONCAT( TIMEWORK, TIMEBUF.HOUR, ':', TIMEBUF.MIN, ':', TIMEBUF.SEC);

  13663 10 003134   003413 220000 1                  LDX0    TIMEBUF
        10 003135   221531 740100                    STX0    TIMEWORK,,AUTO
        10 003136   072000 236007                    LDQ     29696,DL
        10 003137   221531 552110                    STBQ    TIMEWORK,'10'O,AUTO
        10 003140   040100 100400                    MLR     fill='040'O
        10 003141   003413 600002 1                  ADSC9   TIMEBUF                  cn=3,n=2
        10 003142   221531 600002                    ADSC9   TIMEWORK,,AUTO           cn=3,n=2
        10 003143   000072 236003                    LDQ     58,DU
        10 003144   221532 552120                    STBQ    TIMEWORK+1,'20'O,AUTO
        10 003145   003414 721000 1                  LXL1    TIMEBUF+1
        10 003146   221532 441100                    SXL1    TIMEWORK+1,,AUTO

     1141    13664    2       CALL CONCAT( LINEBUF, 'TRACE:Received: From ',

  13664 10 003147   200016 236100                    LDQ     HELO,,AUTO
        10 003150   000033 772000                    QRL     27
        10 003151   040000 100400                    MLR     fill='040'O
        10 003152   002154 000025 2                  ADSC9   XSERRMSG+127             cn=0,n=21
        10 003153   001525 000025 1                  ADSC9   LINEBUF                  cn=0,n=21
        10 003154   000000 620006                    EAX0    0,QL
        10 003155   040000 100540                    MLR     fill='040'O
        10 003156   200016 200010                    ADSC9   HELO,,AUTO               cn=1,n=*X0
        10 003157   001532 200352 1                  ADSC9   LINEBUF+5                cn=1,n=234
        10 003160   000352 116007                    CMPQ    234,DL
        10 003161   003230 603000 10                 TRC     s:13668
        10 003162   221420 720100                    LXL0    MY_SITE_NAME_L,,AUTO
        10 003163   000020 621010                    EAX1    16,X0
        10 003164   777425 622006                    EAX2    -235,QL
        10 003165   777777 662003                    ERX2    -1,DU
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:207  
        10 003166   040046 100540                    MLR     fill='040'O
        10 003167   221421 000011                    ADSC9   MY_SITE_NAME_2,,AUTO     cn=0,n=*X1
        10 003170   001532 200012 1                  ADSC9   LINEBUF+5,Q              cn=1,n=*X2
        10 003171   000000 622006                    EAX2    0,QL
        10 003172   221420 036100                    ADLQ    MY_SITE_NAME_L,,AUTO
        10 003173   000332 116007                    CMPQ    218,DL
        10 003174   003230 603000 10                 TRC     s:13668
        10 003175   222250 756100                    STQ     TVAL+1,,AUTO
        10 003176   000000 636012                    EAQ     0,X2
        10 003177   000022 772000                    QRL     18
        10 003200   221420 036100                    ADLQ    MY_SITE_NAME_L,,AUTO
        10 003201   222250 722100                    LXL2    TVAL+1,,AUTO
        10 003202   777445 622012                    EAX2    -219,X2
        10 003203   777777 662003                    ERX2    -1,DU
        10 003204   040046 100500                    MLR     fill='040'O
        10 003205   221526 000012                    ADSC9   DATEWORK,,AUTO           cn=0,n=10
        10 003206   001536 200012 1                  ADSC9   LINEBUF+9,Q              cn=1,n=*X2
        10 003207   222251 756100                    STQ     TVAL+2,,AUTO
        10 003210   222250 236100                    LDQ     TVAL+1,,AUTO
        10 003211   000320 116007                    CMPQ    208,DL
        10 003212   003230 603000 10                 TRC     s:13668
        10 003213   777457 623006                    EAX3    -209,QL
        10 003214   777777 663003                    ERX3    -1,DU
        10 003215   222251 235100                    LDA     TVAL+2,,AUTO
        10 003216   040045 100500                    MLR     fill='040'O
        10 003217   221531 000010                    ADSC9   TIMEWORK,,AUTO           cn=0,n=8
        10 003220   001540 600013 1                  ADSC9   LINEBUF+11,A             cn=3,n=*X3
        10 003221   000310 116007                    CMPQ    200,DL
        10 003222   003230 603000 10                 TRC     s:13668
        10 003223   777467 624006                    EAX4    -201,QL
        10 003224   777777 664003                    ERX4    -1,DU
        10 003225   040045 100400                    MLR     fill='040'O
        10 003226   000232 000006 1                  ADSC9   TCM_TZTEXT               cn=0,n=6
        10 003227   001542 600014 1                  ADSC9   LINEBUF+13,A             cn=3,n=*X4

     1142    13665    2               SUBSTR( HELO.TXT, 0, HELO.LEN),
     1143    13666    2               SUBSTR( MY_SITE_NAME_2, 0, MY_SITE_NAME_L + 16),
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:208  
     1144    13667    2               DATEWORK, TIMEWORK, TCM_TZTEXT);
     1145    13668    2       CALL INDEX( LINESIZE, '   ', LINEBUF);

  13668 10 003230   221417 631500                    EPPR1   LINESIZE,,AUTO
        10 003231   002144 633400 2                  EPPR3   XSERRMSG+119
        10 003232   000003 223003                    LDX3    3,DU
        10 003233   001525 630400 1                  EPPR0   LINEBUF
        10 003234   000377 220003                    LDX0    255,DU
        10 003235   000000 236003                    LDQ     0,DU
        10 003236   000000 701000 xent               TSX1    X66_INDEX
        10 003237   000000 011000                    NOP     0

     1146    13669    2       WRITE_DATA.BUF_.BOUND = LINESIZE - 1;

  13669 10 003240   221417 236100                    LDQ     LINESIZE,,AUTO
        10 003241   000001 136007                    SBLQ    1,DL
        10 003242   000020 736000                    QLS     16
        10 003243   004022 676000 1                  ERQ     WRITE_DATA+4
        10 003244   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 003245   004022 656000 1                  ERSQ    WRITE_DATA+4

     1147    13670    2       CALL M$WRITE( WRITE_DATA) ALTRET( IOERR);

  13670 10 003246   004016 630400 1                  EPPR0   WRITE_DATA
        10 003247   440001 713400                    CLIMB   alt,write
        10 003250   401400 401760                    pmme    nvectors=4
        10 003251   003254 702000 10                 TSX2    IOERR

     1148    13671    2       RETURN;

  13671 10 003252   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 003253   000001 702211                    TSX2  ! 1,X1

     1149    13672    2   IOERR:
     1150    13673    2       REPLY$ = R451$;

  13673 10 003254   000030 236000 2     IOERR        LDQ     R451$
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:209  
        10 003255   000722 756000 1                  STQ     REPLY$

     1151    13674    2       ALTRETURN;

  13674 10 003256   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 003257   000000 702211                    TSX2  ! 0,X1

     1152    13675
     1153    13676    2       END BUILD_MAIL_HEADER;
     1154    13677        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:210  
     1155    13678    1   GET_MESSAGE_DATA: PROC ALTRET;

  13678 10 003260   221536 741300       GET_MESSAGE* STX1  ! HEX2+2,,AUTO

     1156    13679
     1157    13680    2       DCL END_OF_MESSAGE BIT(1);
     1158    13681    2       DCL HEADER_LINE BIT(1);
     1159    13682    2       DCL DATE_SEEN BIT(1);
     1160    13683    2       DCL BLANK_LINE_READ BIT(1);
     1161    13684    2       DCL TEMP SBIN;
     1162    13685    2       DCL LEN SBIN;
     1163    13686    2       DCL RCVDLEN SBIN;
     1164    13687    2       DCL RCVDBUF CHAR(400);
     1165    13688    2       DCL CHR CHAR(1);
     1166    13689    2       DCL PREV_CMDCODE SBIN;
     1167    13690    2       DCL CURR_CMDCODE SBIN;
     1168    13691
     1169    13692    2       FROM.LEN = 0;

  13692 10 003261   000000 236003                    LDQ     0,DU
        10 003262   200316 552140                    STBQ    FROM,'40'O,AUTO

     1170    13693    2       REPL.LEN = 0;

  13693 10 003263   200416 552140                    STBQ    REPL,'40'O,AUTO

     1171    13694    2       SUBJ.LEN = 0;

  13694 10 003264   200516 552140                    STBQ    SUBJ,'40'O,AUTO

     1172    13695    2       RMID.LEN = 0;

  13695 10 003265   200616 552140                    STBQ    RMID,'40'O,AUTO

     1173    13696    2       MID.LEN = 0;

  13696 10 003266   200716 552140                    STBQ    MID,'40'O,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:211  

     1174    13697    2       FORUM.LEN = 0;

  13697 10 003267   201016 552140                    STBQ    FORUM,'40'O,AUTO

     1175    13698    2       WHEN.LEN = 0;

  13698 10 003270   201116 552140                    STBQ    WHEN,'40'O,AUTO

     1176    13699    2       LTEXT.LEN = 0;

  13699 10 003271   201216 552140                    STBQ    LTEXT,'40'O,AUTO

     1177    13700    2       TTEXT.LEN = 0;

  13700 10 003272   201316 552140                    STBQ    TTEXT,'40'O,AUTO

     1178    13701    2       FTEXT.LEN = 0;

  13701 10 003273   201416 552140                    STBQ    FTEXT,'40'O,AUTO

     1179    13702    2       RTEXT.LEN = 0;

  13702 10 003274   201516 552140                    STBQ    RTEXT,'40'O,AUTO

     1180    13703    2       DATE_SEEN = %FALSE;

  13703 10 003275   221541 450100                    STZ     DATE_SEEN,,AUTO

     1181    13704    2       HEADER_LINE = %TRUE;

  13704 10 003276   400000 236003                    LDQ     -131072,DU
        10 003277   221540 756100                    STQ     HEADER_LINE,,AUTO

     1182    13705    2       END_OF_MESSAGE = %FALSE;

  13705 10 003300   221537 450100                    STZ     END_OF_MESSAGE,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:212  

     1183    13706    2       PREV_CMDCODE = -1;

  13706 10 003301   000001 335007                    LCA     1,DL
        10 003302   221713 755100                    STA     PREV_CMDCODE,,AUTO

     1184    13707
     1185    13708            /** LOOP TO READ ALL MESSAGE LINES & WRITE THEM TO THE MESSAGE FILE **/
     1186    13709    3       DO UNTIL END_OF_MESSAGE;

     1187    13710                /** GET NEXT LINE **/
     1188    13711    3           CALL READ_TRANSPARENT ALTRET( BLANK_LINE);

  13711 10 003303   011456 701000 10                 TSX1    READ_TRANSPARENT
        10 003304   004007 702000 10                 TSX2    BLANK_LINE

     1189    13712    3   JOIN_AFTER_READ:
     1190    13713    3           CHR = SUBSTR( LINEBUF, 0, 1);

  13713 10 003305   001525 236000 1     JOIN_AFTER_* LDQ     LINEBUF
        10 003306   777000 376003                    ANQ     -512,DU
        10 003307   000031 276000 11                 ORQ     25
        10 003310   221712 756100                    STQ     CHR,,AUTO

     1191    13714    3           IF CHR = ' ' OR CHR = BITASC( '011'O) THEN

  13714 10 003311   221712 236100                    LDQ     CHR,,AUTO
        10 003312   777000 376003                    ANQ     -512,DU
        10 003313   040000 116003                    CMPQ    16384,DU
        10 003314   003321 600000 10                 TZE     s:13715
        10 003315   221712 236100                    LDQ     CHR,,AUTO
        10 003316   777000 376003                    ANQ     -512,DU
        10 003317   011000 116003                    CMPQ    4608,DU
        10 003320   003345 601000 10                 TNZ     s:13724

     1192    13715    4               IF PREV_CMDCODE ~= -1 THEN DO;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:213  
  13715 10 003321   221713 235100                    LDA     PREV_CMDCODE,,AUTO
        10 003322   000027 115000 xsym               CMPA    B_VECTNIL+23
        10 003323   003734 600000 10                 TZE     STD_HEADER

     1193    13716    4                   SUBSTR( LINEBUF, 0, 1) = ' ';  /* make blank */

  13716 10 003324   040000 236003                    LDQ     16384,DU
        10 003325   001525 552040 1                  STBQ    LINEBUF,'40'O

     1194    13717    4                   CALL SEARCH( SYM.CPOS, TEMP, TCM_SKIP_BLANKS, LINEBUF);

  13717 10 003326   200005 470500                    LDP0    OUT$,,AUTO
        10 003327   000000 164400                    TCT
        10 003330   001525 000377 1                  ADSC9   LINEBUF                  cn=0,n=255
        10 003331   000260 000000 2                  ARG     TCM_SKIP_BLANKS
        10 003332   000002 000100                    ARG     2,,PR0
        10 003333   000002 235100                    LDA     2,,PR0
        10 003334   000033 771000                    ARL     27
        10 003335   221543 755100                    STA     TEMP,,AUTO
        10 003336   000002 551140                    STBA    2,'40'O,PR0

     1195    13718    4                   SYM.CPOS = SYM.CPOS - 1;  /* include one blank */

  13718 10 003337   000002 235100                    LDA     2,,PR0
        10 003340   000001 135007                    SBLA    1,DL
        10 003341   000002 755100                    STA     2,,PR0

     1196    13719    4                   CURR_CMDCODE = PREV_CMDCODE;

  13719 10 003342   221713 235100                    LDA     PREV_CMDCODE,,AUTO
        10 003343   221714 755100                    STA     CURR_CMDCODE,,AUTO

     1197    13720    4                   GOTO CASE_CODE;

  13720 10 003344   003436 710000 10                 TRA     CASE_CODE

     1198    13721    4                   END;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:214  
     1199    13722    3               ELSE
     1200    13723    3                   GOTO STD_HEADER;
     1201    13724    3           IF CHR = '.' THEN

  13724 10 003345   221712 236100                    LDQ     CHR,,AUTO
        10 003346   777000 376003                    ANQ     -512,DU
        10 003347   056000 116003                    CMPQ    23552,DU
        10 003350   003402 601000 10                 TNZ     s:13739

     1202    13725    4               IF LINESIZE = 1 THEN DO;

  13725 10 003351   221417 235100                    LDA     LINESIZE,,AUTO
        10 003352   000001 115007                    CMPA    1,DL
        10 003353   003372 601000 10                 TNZ     s:13735

     1203    13726                        /* A DOT ALONE MEANS EOF              */
     1204    13727    4                   CALL M$CLOSE( CLOSE_DATA);

  13727 10 003354   001300 630400 2                  EPPR0   CLOSE_DATA
        10 003355   050001 713400                    CLIMB   close
        10 003356   406000 401760                    pmme    nvectors=13

     1205    13728    4                   END_OF_MESSAGE = %TRUE;

  13728 10 003357   400000 236003                    LDQ     -131072,DU
        10 003360   221537 756100                    STQ     END_OF_MESSAGE,,AUTO

     1206    13729    4                   MSG_COUNT = MSG_COUNT + 1;

  13729 10 003361   000726 235000 1                  LDA     MSG_COUNT
        10 003362   000001 035007                    ADLA    1,DL
        10 003363   000726 755000 1                  STA     MSG_COUNT

     1207    13730    4                   IF REPLY$ = R354$ THEN

  13730 10 003364   000722 236000 1                  LDQ     REPLY$
        10 003365   000023 116000 2                  CMPQ    R354$
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:215  
        10 003366   003734 601000 10                 TNZ     STD_HEADER

     1208    13731    4                       REPLY$ = R250$;

  13731 10 003367   000017 236000 2                  LDQ     R250$
        10 003370   000722 756000 1                  STQ     REPLY$

     1209    13732    4                   END;

  13732 10 003371   003734 710000 10                 TRA     STD_HEADER

     1210    13733    4               ELSE DO;

     1211    13734                        /* A DOT WITH TEXT MEANS DOT TRANSPARENCY  */
     1212    13735    4                   LINESIZE = LINESIZE - 1;

  13735 10 003372   000001 135007                    SBLA    1,DL
        10 003373   221417 755100                    STA     LINESIZE,,AUTO

     1213    13736    4                   SUBSTR( LINEBUF, 0, LINESIZE) = SUBSTR( LINEBUF, 1, LINESIZE);

  13736 10 003374   000000 620005                    EAX0    0,AL
        10 003375   221417 721100                    LXL1    LINESIZE,,AUTO
        10 003376   040040 100440                    MLR     fill='040'O
        10 003377   001525 200010 1                  ADSC9   LINEBUF                  cn=1,n=*X0
        10 003400   001525 000011 1                  ADSC9   LINEBUF                  cn=0,n=*X1

     1214    13737    4                   END;

  13737 10 003401   003734 710000 10                 TRA     STD_HEADER

     1215    13738    3           ELSE
     1216    13739    4               IF HEADER_LINE THEN DO;

  13739 10 003402   221540 234100                    SZN     HEADER_LINE,,AUTO
        10 003403   003734 605000 10                 TPL     STD_HEADER

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:216  
     1217    13740                        /* PROCESS HEADER LINES AT START OF MESSAGE     */
     1218    13741    4                   PREV_CMDCODE = -1;

  13741 10 003404   000001 335007                    LCA     1,DL
        10 003405   221713 755100                    STA     PREV_CMDCODE,,AUTO

     1219    13742    4                   CALL XUR$GETCMD( TCM_USER_ROOT, CMD$, , LINEBUF, LINESIZE)

  13742 10 003406   221417 630500                    EPPR0   LINESIZE,,AUTO
        10 003407   222254 450500                    STP0    TVAL+5,,AUTO
        10 003410   000015 236000 11                 LDQ     13
        10 003411   000001 235000 xsym               LDA     B_VECTNIL+1
        10 003412   222252 757100                    STAQ    TVAL+3,,AUTO
        10 003413   200004 631500                    EPPR1   CMD$,,AUTO
        10 003414   222251 451500                    STP1    TVAL+2,,AUTO
        10 003415   000040 236000 11                 LDQ     32
        10 003416   222250 756100                    STQ     TVAL+1,,AUTO
        10 003417   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 003420   000023 631400 xsym               EPPR1   B_VECTNIL+19
        10 003421   000000 701000 xent               TSX1    XUR$GETCMD
        10 003422   003734 702000 10                 TSX2    STD_HEADER

     1220    13743    4                           ALTRET( STD_HEADER);
     1221    13744    4                   IF CMD$ = ADDR( NIL) OR CMD.NSUBLKS = 0 THEN

  13744 10 003423   200004 236100                    LDQ     CMD$,,AUTO
        10 003424   000001 116000 xsym               CMPQ    B_VECTNIL+1
        10 003425   004007 600000 10                 TZE     BLANK_LINE
        10 003426   200004 470500                    LDP0    CMD$,,AUTO
        10 003427   000001 220100                    LDX0    1,,PR0
        10 003430   004007 600000 10                 TZE     BLANK_LINE

     1222    13745    4                       GOTO BLANK_LINE;
     1223    13746    4                   CURR_CMDCODE = CMD.CODE;

  13746 10 003431   000000 236100                    LDQ     0,,PR0
        10 003432   777777 376007                    ANQ     -1,DL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:217  
        10 003433   221714 756100                    STQ     CURR_CMDCODE,,AUTO

     1224    13747    4                   OUT$ = CMD.SUBLK$(0);

  13747 10 003434   000003 236100                    LDQ     3,,PR0
        10 003435   200005 756100                    STQ     OUT$,,AUTO

     1225    13748    4   CASE_CODE:
     1226    13749    5                   DO CASE( CURR_CMDCODE);

  13749 10 003436   221714 235100       CASE_CODE    LDA     CURR_CMDCODE,,AUTO
        10 003437   000024 135007                    SBLA    20,DL
        10 003440   000011 115007                    CMPA    9,DL
        10 003441   003443 602005 10                 TNC     CASE_CODE+5,AL
        10 003442   003734 710000 10                 TRA     STD_HEADER
        10 003443   003473 710000 10                 TRA     s:13757
        10 003444   003454 710000 10                 TRA     s:13751
        10 003445   003500 710000 10                 TRA     s:13759
        10 003446   003505 710000 10                 TRA     s:13761
        10 003447   003514 710000 10                 TRA     s:13765
        10 003450   003461 710000 10                 TRA     s:13753
        10 003451   003466 710000 10                 TRA     s:13755
        10 003452   003574 710000 10                 TRA     s:13769
        10 003453   003577 710000 10                 TRA     s:13771

     1227    13750    5                       CASE( %USER_SUBJ);

     1228    13751    5                           CALL APPEND_HEADER( SUBJ);

  13751 10 003454   200516 630500                    EPPR0   SUBJ,,AUTO
        10 003455   221717 450500                    STP0    CURR_CMDCODE+3,,AUTO
        10 003456   004054 701000 10                 TSX1    APPEND_HEADER
        10 003457   000000 011000                    NOP     0
        10 003460   003734 710000 10                 TRA     STD_HEADER

     1229    13752    5                       CASE( %USER_MID);

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:218  
     1230    13753    5                           CALL APPEND_HEADER( MID);

  13753 10 003461   200716 630500                    EPPR0   MID,,AUTO
        10 003462   221717 450500                    STP0    CURR_CMDCODE+3,,AUTO
        10 003463   004054 701000 10                 TSX1    APPEND_HEADER
        10 003464   000000 011000                    NOP     0
        10 003465   003734 710000 10                 TRA     STD_HEADER

     1231    13754    5                       CASE( %USER_RMID);

     1232    13755    5                           CALL APPEND_HEADER( RMID);

  13755 10 003466   200616 630500                    EPPR0   RMID,,AUTO
        10 003467   221717 450500                    STP0    CURR_CMDCODE+3,,AUTO
        10 003470   004054 701000 10                 TSX1    APPEND_HEADER
        10 003471   000000 011000                    NOP     0
        10 003472   003734 710000 10                 TRA     STD_HEADER

     1233    13756    5                       CASE( %USER_FROM);

     1234    13757    5                           CALL APPEND_HEADER( FROM);

  13757 10 003473   200316 630500                    EPPR0   FROM,,AUTO
        10 003474   221717 450500                    STP0    CURR_CMDCODE+3,,AUTO
        10 003475   004054 701000 10                 TSX1    APPEND_HEADER
        10 003476   000000 011000                    NOP     0
        10 003477   003734 710000 10                 TRA     STD_HEADER

     1235    13758    5                       CASE( %USER_REPL);

     1236    13759    5                           CALL APPEND_HEADER( REPL);

  13759 10 003500   200416 630500                    EPPR0   REPL,,AUTO
        10 003501   221717 450500                    STP0    CURR_CMDCODE+3,,AUTO
        10 003502   004054 701000 10                 TSX1    APPEND_HEADER
        10 003503   000000 011000                    NOP     0
        10 003504   003734 710000 10                 TRA     STD_HEADER
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:219  

     1237    13760    5                       CASE( %USER_WHEN);

     1238    13761    5                           CMD$ = OUT$;

  13761 10 003505   200005 236100                    LDQ     OUT$,,AUTO
        10 003506   200004 756100                    STQ     CMD$,,AUTO

     1239    13762    5                           CALL SET_DATESTAMP ALTRET( STD_HEADER);

  13762 10 003507   004123 701000 10                 TSX1    SET_DATESTAMP
        10 003510   003734 702000 10                 TSX2    STD_HEADER

     1240    13763    5                           DATE_SEEN = %TRUE;

  13763 10 003511   400000 236003                    LDQ     -131072,DU
        10 003512   221541 756100                    STQ     DATE_SEEN,,AUTO
        10 003513   003734 710000 10                 TRA     STD_HEADER

     1241    13764    5                       CASE( %USER_FORUM);

     1242    13765    5                           CALL INSERT( SUBJ.TXT, SUBJ.LEN, ,

  13765 10 003514   200005 470500                    LDP0    OUT$,,AUTO
        10 003515   000004 236100                    LDQ     4,,PR0
        10 003516   000033 772000                    QRL     27
        10 003517   000000 620006                    EAX0    0,QL
        10 003520   200516 236100                    LDQ     SUBJ,,AUTO
        10 003521   000033 772000                    QRL     27
        10 003522   777400 621006                    EAX1    -256,QL
        10 003523   777777 661003                    ERX1    -1,DU
        10 003524   040146 100400                    MLR     fill='040'O
        10 003525   002162 000002 2                  ADSC9   XSERRMSG+133             cn=0,n=2
        10 003526   200516 200011                    ADSC9   SUBJ,Q,AUTO              cn=1,n=*X1
        10 003527   222250 756100                    STQ     TVAL+1,,AUTO
        10 003530   000000 636011                    EAQ     0,X1
        10 003531   000022 772000                    QRL     18
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:220  
        10 003532   000003 116007                    CMPQ    3,DL
        10 003533   003562 602000 10                 TNC     s:13767
        10 003534   777776 622011                    EAX2    -2,X1
        10 003535   222250 236100                    LDQ     TVAL+1,,AUTO
        10 003536   040146 100540                    MLR     fill='040'O
        10 003537   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
        10 003540   200516 600012                    ADSC9   SUBJ,Q,AUTO              cn=3,n=*X2
        10 003541   000000 635010                    EAA     0,X0
        10 003542   000022 771000                    ARL     18
        10 003543   222251 755100                    STA     TVAL+2,,AUTO
        10 003544   000000 636011                    EAQ     0,X1
        10 003545   000022 772000                    QRL     18
        10 003546   222251 136100                    SBLQ    TVAL+2,,AUTO
        10 003547   000002 116007                    CMPQ    2,DL
        10 003550   003562 604400 10                 TMOZ    s:13767
        10 003551   222252 756100                    STQ     TVAL+3,,AUTO
        10 003552   000000 636010                    EAQ     0,X0
        10 003553   000022 772000                    QRL     18
        10 003554   222250 036100                    ADLQ    TVAL+1,,AUTO
        10 003555   222252 720100                    LXL0    TVAL+3,,AUTO
        10 003556   777776 621010                    EAX1    -2,X0
        10 003557   040146 100400                    MLR     fill='040'O
        10 003560   000041 000001 11                 ADSC9   33                       cn=0,n=1
        10 003561   200516 600011                    ADSC9   SUBJ,Q,AUTO              cn=3,n=*X1

     1243    13766    5                                   ' [', SYM.TEXT, ']');
     1244    13767    5                           SUBJ.LEN = SUBJ.LEN + SYM.COUNT + 3;

  13767 10 003562   000004 236100                    LDQ     4,,PR0
        10 003563   000033 772000                    QRL     27
        10 003564   222250 756100                    STQ     TVAL+1,,AUTO
        10 003565   200516 236100                    LDQ     SUBJ,,AUTO
        10 003566   000033 772000                    QRL     27
        10 003567   222250 036100                    ADLQ    TVAL+1,,AUTO
        10 003570   000003 036007                    ADLQ    3,DL
        10 003571   000033 736000                    QLS     27
        10 003572   200516 552140                    STBQ    SUBJ,'40'O,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:221  
        10 003573   003734 710000 10                 TRA     STD_HEADER

     1245    13768    5                       CASE( %USER_ACK);

     1246    13769    5                           ACKNOWLEDGE = %YES#;

  13769 10 003574   400000 236003                    LDQ     -131072,DU
        10 003575   200015 756100                    STQ     ACKNOWLEDGE,,AUTO
        10 003576   003734 710000 10                 TRA     STD_HEADER

     1247    13770    5                       CASE( %USER_RCVD);

     1248    13771    5                           IF DATE_SEEN THEN

  13771 10 003577   221541 234100                    SZN     DATE_SEEN,,AUTO
        10 003600   003734 604000 10                 TMI     STD_HEADER

     1249    13772    5                               EXIT CASE_CODE;  /* Date: beats Received: */
     1250    13773    5                           RCVDBUF = ' ';

  13773 10 003601   040100 100400                    MLR     fill='040'O
        10 003602   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 003603   221546 000620                    ADSC9   RCVDBUF,,AUTO            cn=0,n=400

     1251    13774    5                           RCVDLEN = 0;

  13774 10 003604   221545 450100                    STZ     RCVDLEN,,AUTO

     1252    13775    5                           CALL INDEX1R( TEMP, ';', SUBSTR( LINEBUF, 0, LINESIZE))

  13775 10 003605   221417 236100                    LDQ     LINESIZE,,AUTO
        10 003606   221417 720100                    LXL0    LINESIZE,,AUTO
        10 003607   000000 125440                    SCMR    mask='000'O
        10 003610   001525 000010 1                  ADSC9   LINEBUF                  cn=0,n=*X0
        10 003611   000042 000001 11                 ADSC9   34                       cn=0,n=1
        10 003612   221543 000100                    ARG     TEMP,,AUTO
        10 003613   003627 606400 10                 TTN     s:13782
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:222  
        10 003614   221543 054100                    AOS     TEMP,,AUTO
        10 003615   221543 156100                    SSQ     TEMP,,AUTO

     1253    13776    6                           WHENRETURN DO;

     1254    13777    6                               RCVDLEN = LINESIZE - TEMP;

  13777 10 003616   221417 236100                    LDQ     LINESIZE,,AUTO
        10 003617   221543 136100                    SBLQ    TEMP,,AUTO
        10 003620   221545 756100                    STQ     RCVDLEN,,AUTO

     1255    13778    6                               CALL CONCAT( RCVDBUF, SUBSTR( LINEBUF, TEMP, RCVDLEN));

  13778 10 003621   000000 621006                    EAX1    0,QL
        10 003622   221543 236100                    LDQ     TEMP,,AUTO
        10 003623   040100 100446                    MLR     fill='040'O
        10 003624   001525 000011 1                  ADSC9   LINEBUF,Q                cn=0,n=*X1
        10 003625   221546 000620                    ADSC9   RCVDBUF,,AUTO            cn=0,n=400

     1256    13779    6                               END;

  13779 10 003626   003627 710000 10                 TRA     s:13782

     1257    13780    6                           WHENALTRETURN DO;

     1258    13781    6                               END;  /* No ';', so forget this chunk of header */

     1259    13782    5                           BLANK_LINE_READ = %FALSE;

  13782 10 003627   221542 450100                    STZ     BLANK_LINE_READ,,AUTO

     1260    13783    5   RCVD_AGAIN:
     1261    13784    5                           CALL READ_TRANSPARENT

  13784 10 003630   011456 701000 10    RCVD_AGAIN   TSX1    READ_TRANSPARENT
        10 003631   003660 702000 10                 TSX2    s:13795

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:223  
     1262    13785    6                           WHENRETURN DO;

     1263    13786    6                               CHR = SUBSTR( LINEBUF, 0, 1);

  13786 10 003632   001525 236000 1                  LDQ     LINEBUF
        10 003633   777000 376003                    ANQ     -512,DU
        10 003634   000031 276000 11                 ORQ     25
        10 003635   221712 756100                    STQ     CHR,,AUTO

     1264    13787    7                               IF CHR = ' ' OR CHR = BITASC( '011'O) THEN DO;

  13787 10 003636   221712 236100                    LDQ     CHR,,AUTO
        10 003637   777000 376003                    ANQ     -512,DU
        10 003640   040000 116003                    CMPQ    16384,DU
        10 003641   003646 600000 10                 TZE     s:13788
        10 003642   221712 236100                    LDQ     CHR,,AUTO
        10 003643   777000 376003                    ANQ     -512,DU
        10 003644   011000 116003                    CMPQ    4608,DU
        10 003645   003657 601000 10                 TNZ     s:13791+1

     1265    13788    7                                   CALL INSERT( RCVDBUF, RCVDLEN, LINESIZE,

  13788 10 003646   221417 720100                    LXL0    LINESIZE,,AUTO
        10 003647   221545 235100                    LDA     RCVDLEN,,AUTO
        10 003650   040145 100440                    MLR     fill='040'O
        10 003651   001525 000010 1                  ADSC9   LINEBUF                  cn=0,n=*X0
        10 003652   221546 000010                    ADSC9   RCVDBUF,A,AUTO           cn=0,n=*X0

     1266    13789    7                                           SUBSTR( LINEBUF, 0, LINESIZE));
     1267    13790    7                                   RCVDLEN = RCVDLEN + LINESIZE;

  13790 10 003653   221545 236100                    LDQ     RCVDLEN,,AUTO
        10 003654   221417 036100                    ADLQ    LINESIZE,,AUTO
        10 003655   221545 756100                    STQ     RCVDLEN,,AUTO

     1268    13791    7                                   GOTO RCVD_AGAIN;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:224  
  13791 10 003656   003630 710000 10                 TRA     RCVD_AGAIN
        10 003657   003662 710000 10                 TRA     s:13802

     1269    13792    7                                   END;
     1270    13793    6                               END;
     1271    13794    6                           WHENALTRETURN DO;

     1272    13795    6                               BLANK_LINE_READ = %TRUE;

  13795 10 003660   400000 236003                    LDQ     -131072,DU
        10 003661   221542 756100                    STQ     BLANK_LINE_READ,,AUTO

     1273    13796    6                               END;

     1274    13797                                /* At this point RCVDBUF has 'a lot' of the Received:
     1275    13798                                   header.  Look for rightmost ';' and blank out all
     1276    13799                                   text up to and including it.                     */
     1277    13800                                /* The header or other record after Received: is now
     1278    13801                                   buffered in LINEBUF waiting until we're done.    */
     1279    13802    5                           CALL INDEX1R( TEMP, ';', SUBSTR( RCVDBUF, 0, RCVDLEN))

  13802 10 003662   221545 236100                    LDQ     RCVDLEN,,AUTO
        10 003663   221545 720100                    LXL0    RCVDLEN,,AUTO
        10 003664   000000 125540                    SCMR    mask='000'O
        10 003665   221546 000010                    ADSC9   RCVDBUF,,AUTO            cn=0,n=*X0
        10 003666   000042 000001 11                 ADSC9   34                       cn=0,n=1
        10 003667   221543 000100                    ARG     TEMP,,AUTO
        10 003670   003701 606400 10                 TTN     s:13808
        10 003671   221543 054100                    AOS     TEMP,,AUTO
        10 003672   221543 156100                    SSQ     TEMP,,AUTO

     1280    13803    6                           WHENRETURN DO;

     1281    13804    6                               CALL INSERT( RCVDBUF, 0, TEMP + 1, ' ');

  13804 10 003673   221543 721100                    LXL1    TEMP,,AUTO
        10 003674   000001 622011                    EAX2    1,X1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:225  
        10 003675   040140 100400                    MLR     fill='040'O
        10 003676   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 003677   221546 000012                    ADSC9   RCVDBUF,,AUTO            cn=0,n=*X2

     1282    13805    6                               END;

  13805 10 003700   003701 710000 10                 TRA     s:13808

     1283    13806    6                           WHENALTRETURN DO;

     1284    13807    6                               END;  /* No semicolon means no timestamp? */

     1285    13808    5                           CALL XUR$GETCMD(

  13808 10 003701   221545 630500                    EPPR0   RCVDLEN,,AUTO
        10 003702   222254 450500                    STP0    TVAL+5,,AUTO
        10 003703   221546 631500                    EPPR1   RCVDBUF,,AUTO
        10 003704   222253 451500                    STP1    TVAL+4,,AUTO
        10 003705   000001 236000 xsym               LDQ     B_VECTNIL+1
        10 003706   222252 756100                    STQ     TVAL+3,,AUTO
        10 003707   200004 633500                    EPPR3   CMD$,,AUTO
        10 003710   222251 453500                    STP3    TVAL+2,,AUTO
        10 003711   000043 236000 11                 LDQ     35
        10 003712   222250 756100                    STQ     TVAL+1,,AUTO
        10 003713   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 003714   000023 631400 xsym               EPPR1   B_VECTNIL+19
        10 003715   000000 701000 xent               TSX1    XUR$GETCMD
        10 003716   003731 702000 10                 TSX2    s:13820

     1286    13809    5                                   TCM_TSTAMP_ROOT, CMD$, , RCVDBUF, RCVDLEN)
     1287    13810    6                           WHENRETURN DO;

     1288    13811    6                               IF CMD$ ~= ADDR( NIL) THEN

  13811 10 003717   200004 236100                    LDQ     CMD$,,AUTO
        10 003720   000001 116000 xsym               CMPQ    B_VECTNIL+1
        10 003721   003730 600000 10                 TZE     s:13816
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:226  

     1289    13812    6                                   IF CMD.NSUBLKS > 0 THEN

  13812 10 003722   200004 470500                    LDP0    CMD$,,AUTO
        10 003723   000001 220100                    LDX0    1,,PR0
        10 003724   003730 600000 10                 TZE     s:13816

     1290    13813    6                                       CALL SET_DATESTAMP

  13813 10 003725   004123 701000 10                 TSX1    SET_DATESTAMP
        10 003726   003730 702000 10                 TSX2    s:13816
        10 003727   003730 710000 10                 TRA     s:13816

     1291    13814    7                                       WHENALTRETURN DO;

     1292    13815    7                                           END;

     1293    13816    6                               END;

  13816 10 003730   003731 710000 10                 TRA     s:13820

     1294    13817    6                           WHENALTRETURN DO;

     1295    13818    6                               END;  /* Tstamp parse failed.  Forget it. */

     1296    13819                                /* We're done.  Process the buffered header line. */
     1297    13820    5                           IF BLANK_LINE_READ THEN

  13820 10 003731   221542 234100                    SZN     BLANK_LINE_READ,,AUTO
        10 003732   004007 604000 10                 TMI     BLANK_LINE

     1298    13821    5                               GOTO BLANK_LINE;
     1299    13822    5                           GOTO JOIN_AFTER_READ;

  13822 10 003733   003305 710000 10                 TRA     JOIN_AFTER_READ

     1300    13823    5                       END /* case hdr$blk.code */;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:227  

     1301    13824    4   STD_HEADER:
     1302    13825    4                   END;

  13825 10 003734                       STD_HEADER   null
     1303    13826                /** WRITE LINE TO MESSAGE FILE **/
     1304    13827    4           IF REPLY$ = R354$ THEN DO;

  13827 10 003734   000722 236000 1                  LDQ     REPLY$
        10 003735   000023 116000 2                  CMPQ    R354$
        10 003736   004006 601000 10                 TNZ     s:13844

     1305    13828    5               IF HEADER_LINE THEN DO;

  13828 10 003737   221540 234100                    SZN     HEADER_LINE,,AUTO
        10 003740   003755 605000 10                 TPL     s:13833

     1306    13829    5                   CALL CONCAT( ZTEXT.TXT, 'TRACE:', LINEBUF);

  13829 10 003741   040100 100400                    MLR     fill='040'O
        10 003742   002147 000006 2                  ADSC9   XSERRMSG+122             cn=0,n=6
        10 003743   201616 200006                    ADSC9   ZTEXT,,AUTO              cn=1,n=6
        10 003744   040100 100400                    MLR     fill='040'O
        10 003745   001525 000371 1                  ADSC9   LINEBUF                  cn=0,n=249
        10 003746   201617 600371                    ADSC9   ZTEXT+1,,AUTO            cn=3,n=249

     1307    13830    5                   LINEBUF = ZTEXT.TXT;

  13830 10 003747   040000 100500                    MLR     fill='040'O
        10 003750   201616 200377                    ADSC9   ZTEXT,,AUTO              cn=1,n=255
        10 003751   001525 000377 1                  ADSC9   LINEBUF                  cn=0,n=255

     1308    13831    5                   LINESIZE = LINESIZE + LENGTHC( 'TRACE:');

  13831 10 003752   221417 235100                    LDA     LINESIZE,,AUTO
        10 003753   000006 035007                    ADLA    6,DL
        10 003754   221417 755100                    STA     LINESIZE,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:228  

     1309    13832    5                   END;

     1310    13833    4               WRITE_DATA.BUF_.BOUND = LINESIZE - 1;

  13833 10 003755   221417 236100                    LDQ     LINESIZE,,AUTO
        10 003756   000001 136007                    SBLQ    1,DL
        10 003757   000020 736000                    QLS     16
        10 003760   004022 676000 1                  ERQ     WRITE_DATA+4
        10 003761   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 003762   004022 656000 1                  ERSQ    WRITE_DATA+4

     1311    13834    4               DATA_KEY.KEY = DATA_KEY.KEY + 1000;

  13834 10 003763   003430 236000 1                  LDQ     DATA_KEY
        10 003764   001750 036007                    ADLQ    1000,DL
        10 003765   003430 552034 1                  STBQ    DATA_KEY,'34'O

     1312    13835    4               TEMP = DATA_KEY.KEY / 1000;

  13835 10 003766   003430 236000 1                  LDQ     DATA_KEY
        10 003767   000032 376000 xsym               ANQ     B_VECTNIL+26
        10 003770   001750 506007                    DIV     1000,DL
        10 003771   221543 756100                    STQ     TEMP,,AUTO

     1313    13836    4               CALL BINCHAR( STATUS_LINE.LINES, TEMP);

  13836 10 003772   000000 301500                    BTD
        10 003773   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4
        10 003774   003371 430004 1                  NDSC9   STATUS_LINE+2            cn=2,s=nosgn,sf=0,n=4

     1314    13837    4               CALL STATUS_LINE_UPDATE;

  13837 10 003775   012745 701000 10                 TSX1    STATUS_LINE_UPDATE
        10 003776   000000 011000                    NOP     0

     1315    13838    4               CALL M$WRITE( WRITE_DATA) ALTRET( IOERR);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:229  

  13838 10 003777   004016 630400 1                  EPPR0   WRITE_DATA
        10 004000   440001 713400                    CLIMB   alt,write
        10 004001   401400 401760                    pmme    nvectors=4
        10 004002   004004 702000 10                 TSX2    IOERR

     1316    13839    5               DO NEVER;

  13839 10 004003   004006 710000 10                 TRA     s:13844

     1317    13840    5   IOERR:
     1318    13841    5                   REPLY$ = R451$;

  13841 10 004004   000030 236000 2     IOERR        LDQ     R451$
        10 004005   000722 756000 1                  STQ     REPLY$

     1319    13842    5                   END;

     1320    13843    4               END;

     1321    13844    4           DO NEVER;

  13844 10 004006   004050 710000 10                 TRA     s:13867

     1322    13845    4   BLANK_LINE:
     1323    13846                    /* INDICATES END OF HEADER BLOCK      */
     1324    13847    5               IF TIMED_OUT THEN DO;

  13847 10 004007   200010 234100       BLANK_LINE   SZN     TIMED_OUT,,AUTO
        10 004010   004033 605000 10                 TPL     s:13859

     1325    13848    5                   CALL NOTIFY_STUCKEE_READERR;

  13848 10 004011   005162 701000 10                 TSX1    NOTIFY_STUCKEE_READERR
        10 004012   000000 011000                    NOP     0

     1326    13849    5                   CALL M$CLOSE( CLOSE_DATA)
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:230  

  13849 10 004013   001300 630400 2                  EPPR0   CLOSE_DATA
        10 004014   450001 713400                    CLIMB   alt,close
        10 004015   406000 401760                    pmme    nvectors=13
        10 004016   004020 702000 10                 TSX2    s:13852
        10 004017   004020 710000 10                 TRA     s:13852

     1327    13850    6                   WHENALTRETURN DO;

     1328    13851    6                       END;

     1329    13852    5                   CALL M$OPEN( DELETE_DATA)

  13852 10 004020   003724 630400 1                  EPPR0   DELETE_DATA
        10 004021   450000 713400                    CLIMB   alt,open
        10 004022   410400 401760                    pmme    nvectors=18
        10 004023   004025 702000 10                 TSX2    s:13855
        10 004024   004025 710000 10                 TRA     s:13855

     1330    13853    6                   WHENALTRETURN DO;

     1331    13854    6                       END;

     1332    13855    5                   IF NOT DATA_LOST THEN

  13855 10 004025   200011 234100                    SZN     DATA_LOST,,AUTO
        10 004026   004031 604000 10                 TMI     s:13857

     1333    13856    5                       REPLY$ = R421TO$;

  13856 10 004027   000025 236000 2                  LDQ     R421TO$
        10 004030   000722 756000 1                  STQ     REPLY$

     1334    13857    5                   ALTRETURN;

  13857 10 004031   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 004032   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:231  

     1335    13858    5                   END;
     1336    13859    4               IF DATA_LOST THEN

  13859 10 004033   200011 234100                    SZN     DATA_LOST,,AUTO
        10 004034   004040 605000 10                 TPL     s:13862

     1337    13860    4                   REPLY$ = R421DL$;

  13860 10 004035   000027 236000 2                  LDQ     R421DL$
        10 004036   000722 756000 1                  STQ     REPLY$
        10 004037   004047 710000 10                 TRA     s:13865

     1338    13861    5               ELSE DO;

     1339    13862    5                   DATA_KEY.KEY = DATA_KEY.KEY + 1000;

  13862 10 004040   003430 236000 1                  LDQ     DATA_KEY
        10 004041   001750 036007                    ADLQ    1000,DL
        10 004042   003430 552034 1                  STBQ    DATA_KEY,'34'O

     1340    13863    5                   CALL M$WRITE( WRITE_BLANK_DATA) ALTRET( IOERR);

  13863 10 004043   001264 630400 2                  EPPR0   WRITE_BLANK_DATA
        10 004044   440001 713400                    CLIMB   alt,write
        10 004045   401400 401760                    pmme    nvectors=4
        10 004046   004004 702000 10                 TSX2    IOERR

     1341    13864    5                   END;

     1342    13865    4               HEADER_LINE = %FALSE;

  13865 10 004047   221540 450100                    STZ     HEADER_LINE,,AUTO

     1343    13866    4               END;

     1344    13867    3           END /* until end_of_message */;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:232  

  13867 10 004050   221537 234100                    SZN     END_OF_MESSAGE,,AUTO
        10 004051   003303 605000 10                 TPL     s:13711

     1345    13868    2       RETURN;

  13868 10 004052   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 004053   000001 702211                    TSX2  ! 1,X1

     1346    13869
     1347    13870    2   APPEND_HEADER: PROC( BUFF);

  13870 10 004054   221716 741300       APPEND_HEAD* STX1  ! CURR_CMDCODE+2,,AUTO

     1348    13871            %BUFFER( NAME=BUFF, STCLASS=);
     1349    13876
     1350    13877    3       LEN = MINIMUM( %BUFSIZ - BUFF.LEN, LINESIZE - SYM.CPOS);

  13877 10 004055   200005 470500                    LDP0    OUT$,,AUTO
        10 004056   221417 236100                    LDQ     LINESIZE,,AUTO
        10 004057   000002 136100                    SBLQ    2,,PR0
        10 004060   221717 471500                    LDP1    @BUFF,,AUTO
        10 004061   000100 101500                    MRL     fill='000'O
        10 004062   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 004063   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 004064   222251 756100                    STQ     TVAL+2,,AUTO
        10 004065   000377 236007                    LDQ     255,DL
        10 004066   222250 136100                    SBLQ    TVAL+1,,AUTO
        10 004067   222251 116100                    CMPQ    TVAL+2,,AUTO
        10 004070   004072 604400 10                 TMOZ    s:13877+13
        10 004071   222251 236100                    LDQ     TVAL+2,,AUTO
        10 004072   221544 756100                    STQ     LEN,,AUTO

     1351    13878    4       IF LEN > 0 THEN DO;

  13878 10 004073   000000 116003                    CMPQ    0,DU
        10 004074   004117 604400 10                 TMOZ    s:13883
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:233  

     1352    13879    4           CALL INSERT( BUFF.TXT, BUFF.LEN, LEN,

  13879 10 004075   000002 235100                    LDA     2,,PR0
        10 004076   000100 101500                    MRL     fill='000'O
        10 004077   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 004100   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 004101   222250 236100                    LDQ     TVAL+1,,AUTO
        10 004102   221544 720100                    LXL0    LEN,,AUTO
        10 004103   040146 100445                    MLR     fill='040'O
        10 004104   001525 000010 1                  ADSC9   LINEBUF,A                cn=0,n=*X0
        10 004105   100000 200010                    ADSC9   0,Q,PR1                  cn=1,n=*X0

     1353    13880    4                   SUBSTR( LINEBUF, SYM.CPOS, LEN));
     1354    13881    4           BUFF.LEN = BUFF.LEN + LEN;

  13881 10 004106   000100 101500                    MRL     fill='000'O
        10 004107   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 004110   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 004111   222250 236100                    LDQ     TVAL+1,,AUTO
        10 004112   221544 036100                    ADLQ    LEN,,AUTO
        10 004113   222251 756100                    STQ     TVAL+2,,AUTO
        10 004114   000100 101500                    MRL     fill='000'O
        10 004115   222251 000004                    ADSC9   TVAL+2,,AUTO             cn=0,n=4
        10 004116   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     1355    13882    4           END;

     1356    13883    3       PREV_CMDCODE = CURR_CMDCODE;

  13883 10 004117   221714 235100                    LDA     CURR_CMDCODE,,AUTO
        10 004120   221713 755100                    STA     PREV_CMDCODE,,AUTO

     1357    13884    3       RETURN;

  13884 10 004121   221716 221300                    LDX1  ! CURR_CMDCODE+2,,AUTO
        10 004122   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:234  

     1358    13885
     1359    13886    3       END APPEND_HEADER;
     1360    13887        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:235  
     1361    13888    2   SET_DATESTAMP: PROC ALTRET;

  13888 10 004123   221716 741300       SET_DATESTA* STX1  ! CURR_CMDCODE+2,,AUTO

     1362    13889
     1363    13890    3       DCL TZOFFSET SBIN;
     1364    13891    3       DCL DATE$ PTR;
     1365    13892    3       DCL TIME$ PTR;
     1366    13893    3       DCL ZONE$ PTR;
     1367    13894
     1368    13895    3       TEMP = CMD.NSUBLKS - 2;

  13895 10 004124   200004 470500                    LDP0    CMD$,,AUTO
        10 004125   000001 236100                    LDQ     1,,PR0
        10 004126   000022 772000                    QRL     18
        10 004127   000002 136007                    SBLQ    2,DL
        10 004130   221543 756100                    STQ     TEMP,,AUTO

     1369    13896    3       DATE$ = CMD.SUBLK$( TEMP);

  13896 10 004131   000003 236106                    LDQ     3,QL,PR0
        10 004132   221720 756100                    STQ     DATE$,,AUTO

     1370    13897    3       TIME$ = CMD.SUBLK$( TEMP + 1);

  13897 10 004133   221543 720100                    LXL0    TEMP,,AUTO
        10 004134   000004 236110                    LDQ     4,X0,PR0
        10 004135   221721 756100                    STQ     TIME$,,AUTO

     1371    13898    3       ANSSTAMP = 'YYMMDDHHMM0000';

  13898 10 004136   040000 100400                    MLR     fill='040'O
        10 004137   002163 000016 2                  ADSC9   XSERRMSG+134             cn=0,n=14
        10 004140   003416 000016 1                  ADSC9   ANSBUF                   cn=0,n=14

     1372    13899            /* do the year */
     1373    13900    3       CALL CHARBIN( TEMP, DATE$->OUT.SUBLK$(2)->SYM.TEXT);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:236  

  13900 10 004141   221720 471500                    LDP1    DATE$,,AUTO
        10 004142   100005 473500                    LDP3    5,,PR1
        10 004143   300004 236100                    LDQ     4,,PR3
        10 004144   000033 772000                    QRL     27
        10 004145   000000 622006                    EAX2    0,QL
        10 004146   000100 305540                    DTB
        10 004147   300004 230012                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X2
        10 004150   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4

     1374    13901    3       IF TEMP > 99 THEN

  13901 10 004151   221543 235100                    LDA     TEMP,,AUTO
        10 004152   000143 115007                    CMPA    99,DL
        10 004153   004157 604400 10                 TMOZ    s:13903

     1375    13902    3           TEMP = MOD( TEMP, 100);

  13902 10 004154   221543 236100                    LDQ     TEMP,,AUTO
        10 004155   000144 506007                    DIV     100,DL
        10 004156   221543 755100                    STA     TEMP,,AUTO

     1376    13903    3       CALL BINCHAR( SUBSTR( ANSSTAMP, 0, 2), TEMP);

  13903 10 004157   000000 301500                    BTD
        10 004160   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4
        10 004161   003416 030002 1                  NDSC9   ANSBUF                   cn=0,s=nosgn,sf=0,n=2

     1377    13904            /* do the month, day, hour, and minute */
     1378    13905    3       TEMP = DATE$->OUT.SUBLK$(1)->SYM.CODE;

  13905 10 004162   100004 473500                    LDP3    4,,PR1
        10 004163   300000 236100                    LDQ     0,,PR3
        10 004164   777777 376007                    ANQ     -1,DL
        10 004165   221543 756100                    STQ     TEMP,,AUTO

     1379    13906    3       CALL BINCHAR( SUBSTR( ANSSTAMP, 2, 2), TEMP);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:237  

  13906 10 004166   000000 301500                    BTD
        10 004167   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4
        10 004170   003416 430002 1                  NDSC9   ANSBUF                   cn=2,s=nosgn,sf=0,n=2

     1380    13907    3       CALL CHARBIN( TEMP, DATE$->OUT.SUBLK$(0)->SYM.TEXT);

  13907 10 004171   100003 473500                    LDP3    3,,PR1
        10 004172   300004 236100                    LDQ     4,,PR3
        10 004173   000033 772000                    QRL     27
        10 004174   000000 620006                    EAX0    0,QL
        10 004175   000100 305540                    DTB
        10 004176   300004 230010                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X0
        10 004177   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4

     1381    13908    3       CALL BINCHAR( SUBSTR( ANSSTAMP, 4, 2), TEMP);

  13908 10 004200   000000 301500                    BTD
        10 004201   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4
        10 004202   003417 030002 1                  NDSC9   ANSBUF+1                 cn=0,s=nosgn,sf=0,n=2

     1382    13909    3       CALL CHARBIN( TEMP, TIME$->OUT.SUBLK$(0)->SYM.TEXT);

  13909 10 004203   221721 473500                    LDP3    TIME$,,AUTO
        10 004204   300003 474500                    LDP4    3,,PR3
        10 004205   400004 236100                    LDQ     4,,PR4
        10 004206   000033 772000                    QRL     27
        10 004207   000000 620006                    EAX0    0,QL
        10 004210   000100 305540                    DTB
        10 004211   400004 230010                    NDSC9   4,,PR4                   cn=1,s=nosgn,sf=0,n=*X0
        10 004212   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4

     1383    13910    3       CALL BINCHAR( SUBSTR( ANSSTAMP, 6, 2), TEMP);

  13910 10 004213   000000 301500                    BTD
        10 004214   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4
        10 004215   003417 430002 1                  NDSC9   ANSBUF+1                 cn=2,s=nosgn,sf=0,n=2
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:238  

     1384    13911    3       CALL CHARBIN( TEMP, TIME$->OUT.SUBLK$(1)->SYM.TEXT);

  13911 10 004216   300004 474500                    LDP4    4,,PR3
        10 004217   400004 236100                    LDQ     4,,PR4
        10 004220   000033 772000                    QRL     27
        10 004221   000000 620006                    EAX0    0,QL
        10 004222   000100 305540                    DTB
        10 004223   400004 230010                    NDSC9   4,,PR4                   cn=1,s=nosgn,sf=0,n=*X0
        10 004224   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4

     1385    13912    3       CALL BINCHAR( SUBSTR( ANSSTAMP, 8, 2), TEMP);

  13912 10 004225   000000 301500                    BTD
        10 004226   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4
        10 004227   003420 030002 1                  NDSC9   ANSBUF+2                 cn=0,s=nosgn,sf=0,n=2

     1386    13913            /* do the second, if given */
     1387    13914    4       IF TIME$->OUT.NSUBLKS > 3 THEN DO;

  13914 10 004230   300001 220100                    LDX0    1,,PR3
        10 004231   000004 100003                    CMPX0   4,DU
        10 004232   004245 602000 10                 TNC     s:13919

     1388    13915    4           CALL CHARBIN( TEMP, TIME$->OUT.SUBLK$(2)->SYM.TEXT);

  13915 10 004233   300005 474500                    LDP4    5,,PR3
        10 004234   400004 236100                    LDQ     4,,PR4
        10 004235   000033 772000                    QRL     27
        10 004236   000000 622006                    EAX2    0,QL
        10 004237   000100 305540                    DTB
        10 004240   400004 230012                    NDSC9   4,,PR4                   cn=1,s=nosgn,sf=0,n=*X2
        10 004241   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4

     1389    13916    4           CALL BINCHAR( SUBSTR( ANSSTAMP, 10, 2), TEMP);

  13916 10 004242   000000 301500                    BTD
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:239  
        10 004243   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4
        10 004244   003420 430002 1                  NDSC9   ANSBUF+2                 cn=2,s=nosgn,sf=0,n=2

     1390    13917    4           END;

     1391    13918            /* convert this to a UTS value, ignoring sender's timezone */
     1392    13919    3       CALL M$TIME( ANS2UTSVAL) ALTRET( OOPS);

  13919 10 004245   001562 630400 2                  EPPR0   ANS2UTSVAL
        10 004246   420004 713400                    CLIMB   alt,+8196
        10 004247   402000 401760                    pmme    nvectors=5
        10 004250   004405 702000 10                 TSX2    OOPS

     1393    13920    3       TZOFFSET = 0;  /* determine sender's offset from UTC */

  13920 10 004251   221717 450100                    STZ     TZOFFSET,,AUTO

     1394    13921    3       ZONE$ = TIME$->OUT.SUBLK$( TIME$->OUT.NSUBLKS - 1);

  13921 10 004252   221721 470500                    LDP0    TIME$,,AUTO
        10 004253   000001 220100                    LDX0    1,,PR0
        10 004254   000002 236110                    LDQ     2,X0,PR0
        10 004255   221722 756100                    STQ     ZONE$,,AUTO

     1395    13922    3       ZONE$ = ZONE$->OUT.SUBLK$(0);

  13922 10 004256   221722 471500                    LDP1    ZONE$,,AUTO
        10 004257   100003 236100                    LDQ     3,,PR1
        10 004260   221722 756100                    STQ     ZONE$,,AUTO

     1396    13923    4       DO CASE( ZONE$->SYM.CODE);

  13923 10 004261   221722 471500                    LDP1    ZONE$,,AUTO
        10 004262   100000 236100                    LDQ     0,,PR1
        10 004263   777777 376007                    ANQ     -1,DL
        10 004264   000066 136007                    SBLQ    54,DL
        10 004265   000003 116007                    CMPQ    3,DL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:240  
        10 004266   004270 602006 10                 TNC     s:13923+7,QL
        10 004267   004353 710000 10                 TRA     s:13939
        10 004270   004273 710000 10                 TRA     s:13925
        10 004271   004332 710000 10                 TRA     s:13932
        10 004272   004346 710000 10                 TRA     s:13937

     1397    13924    4           CASE( %UTOFFSET);

     1398    13925    4               CALL CHARBIN( TEMP, ZONE$->OUT.SUBLK$(1)->SYM.TEXT);

  13925 10 004273   100004 473500                    LDP3    4,,PR1
        10 004274   300004 236100                    LDQ     4,,PR3
        10 004275   000033 772000                    QRL     27
        10 004276   000000 621006                    EAX1    0,QL
        10 004277   000100 305540                    DTB
        10 004300   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
        10 004301   221543 000004                    NDSC9   TEMP,,AUTO               cn=0,s=lsgnf,sf=0,n=4

     1399    13926    4               TZOFFSET = ( ( TEMP / 100) * %UTS_CSEC_HOUR#) +

  13926 10 004302   221543 236100                    LDQ     TEMP,,AUTO
        10 004303   000144 506007                    DIV     100,DL
        10 004304   222250 756100                    STQ     TVAL+1,,AUTO
        10 004305   221543 236100                    LDQ     TEMP,,AUTO
        10 004306   000144 506007                    DIV     100,DL
        10 004307   222251 755100                    STA     TVAL+2,,AUTO
        10 004310   222250 236100                    LDQ     TVAL+1,,AUTO
        10 004311   000074 402007                    MPY     60,DL
        10 004312   222251 036100                    ADLQ    TVAL+2,,AUTO
        10 004313   013560 402007                    MPY     6000,DL
        10 004314   221717 756100                    STQ     TZOFFSET,,AUTO

     1400    13927    4                       MOD( TEMP, 100) * %UTS_CSEC_MIN#;
     1401    13928    4               IF ZONE$->OUT.SUBLK$(0)->SYM.COUNT > 0 THEN

  13928 10 004315   100003 473500                    LDP3    3,,PR1
        10 004316   300004 236100                    LDQ     4,,PR3
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:241  
        10 004317   777000 316003                    CANQ    -512,DU
        10 004320   004353 600000 10                 TZE     s:13939

     1402    13929    4                   IF '-' = SUBSTR( ZONE$->OUT.SUBLK$(0)->SYM.TEXT, 0, 1) THEN

  13929 10 004321   300004 236100                    LDQ     4,,PR3
        10 004322   000033 772000                    QRL     27
        10 004323   300004 236100                    LDQ     4,,PR3
        10 004324   000777 376003                    ANQ     511,DU
        10 004325   000055 116003                    CMPQ    45,DU
        10 004326   004353 601000 10                 TNZ     s:13939

     1403    13930    4                       TZOFFSET = -TZOFFSET;

  13930 10 004327   221717 335100                    LCA     TZOFFSET,,AUTO
        10 004330   221717 755100                    STA     TZOFFSET,,AUTO
        10 004331   004353 710000 10                 TRA     s:13939

     1404    13931    4           CASE( %MILITARY);

     1405    13932    4               CALL INDEX( TEMP,

  13932 10 004332   100003 473500                    LDP3    3,,PR1
        10 004333   300004 236100                    LDQ     4,,PR3
        10 004334   000033 772000                    QRL     27
        10 004335   000100 124400                    SCM     mask='000'O
        10 004336   002135 000031 2                  ADSC9   XSERRMSG+112             cn=0,n=25
        10 004337   300004 200001                    ADSC9   4,,PR3                   cn=1,n=1
        10 004340   221543 000100                    ARG     TEMP,,AUTO

     1406    13933    4                       SUBSTR( ZONE$->OUT.SUBLK$(0)->SYM.TEXT, 0, 1),
     1407    13934    4                       'MLKIHGFEDCBAZNOPQRSTUVWXY');
     1408    13935    4               TZOFFSET = ( TEMP - 12) * %UTS_CSEC_HOUR#;

  13935 10 004341   221543 236100                    LDQ     TEMP,,AUTO
        10 004342   000027 402000 11                 MPY     23
        10 004343   000030 136000 11                 SBLQ    24
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:242  
        10 004344   221717 756100                    STQ     TZOFFSET,,AUTO
        10 004345   004353 710000 10                 TRA     s:13939

     1409    13936    4           CASE( %COMMON);

     1410    13937    4               TZOFFSET = CMN2UTS( ZONE$->OUT.SUBLK$(0)->SYM.CODE) * %UTS_CSEC_HOUR#;

  13937 10 004346   100003 473500                    LDP3    3,,PR1
        10 004347   300000 721100                    LXL1    0,,PR3
        10 004350   000046 236011 2                  LDQ     CMN2UTS,X1
        10 004351   000027 402000 11                 MPY     23
        10 004352   221717 756100                    STQ     TZOFFSET,,AUTO

     1411    13938    4           END;

     1412    13939    3       CALL XUD$UTS_ADJUST( UTSVAL, UTSVAL, -TZOFFSET);  /* correction to make UTC */

  13939 10 004353   221717 335100                    LCA     TZOFFSET,,AUTO
        10 004354   222250 755100                    STA     TVAL+1,,AUTO
        10 004355   222250 633500                    EPPR3   TVAL+1,,AUTO
        10 004356   222253 453500                    STP3    TVAL+4,,AUTO
        10 004357   000044 236000 11                 LDQ     36
        10 004360   222252 756100                    STQ     TVAL+3,,AUTO
        10 004361   222251 756100                    STQ     TVAL+2,,AUTO
        10 004362   222251 630500                    EPPR0   TVAL+2,,AUTO
        10 004363   000021 631400 xsym               EPPR1   B_VECTNIL+17
        10 004364   000000 701000 xent               TSX1    XUD$UTS_ADJUST
        10 004365   000000 011000                    NOP     0

     1413    13940    3       CALL XUD$UTS_ADJUST( UTSVAL, UTSVAL, TCM_UTOFFSET);
             13940                /* correction to make local time */

  13940 10 004366   000045 630400 11                 EPPR0   37
        10 004367   000021 631400 xsym               EPPR1   B_VECTNIL+17
        10 004370   000000 701000 xent               TSX1    XUD$UTS_ADJUST
        10 004371   000000 011000                    NOP     0

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:243  
     1414    13941    3       CALL M$TIME( UTSVAL2LCL) ALTRET( OOPS);  /* make chars for later */

  13941 10 004372   001576 630400 2                  EPPR0   UTSVAL2LCL
        10 004373   420004 713400                    CLIMB   alt,+8196
        10 004374   402000 401760                    pmme    nvectors=5
        10 004375   004405 702000 10                 TSX2    OOPS

     1415    13942    3       WHEN.TXT = LCLSTAMP;

  13942 10 004376   040100 100400                    MLR     fill='040'O
        10 004377   003422 000024 1                  ADSC9   LCLBUF                   cn=0,n=20
        10 004400   201116 200377                    ADSC9   WHEN,,AUTO               cn=1,n=255

     1416    13943    3       WHEN.LEN = 14;  /* MM/DD/YY,HH:MM */

  13943 10 004401   016000 236003                    LDQ     7168,DU
        10 004402   201116 552140                    STBQ    WHEN,'40'O,AUTO

     1417    13944    3       RETURN;

  13944 10 004403   221716 221300                    LDX1  ! CURR_CMDCODE+2,,AUTO
        10 004404   000001 702211                    TSX2  ! 1,X1

     1418    13945    3   OOPS:
     1419    13946    3       ALTRETURN;

  13946 10 004405   221716 221300       OOPS         LDX1  ! CURR_CMDCODE+2,,AUTO
        10 004406   000000 702211                    TSX2  ! 0,X1

     1420    13947
     1421    13948    3       END SET_DATESTAMP;
     1422    13949
     1423    13950    2       END GET_MESSAGE_DATA;
     1424    13951        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:244  
     1425    13952    1   SEND_MAIL_MESSAGE: PROC ALTRET;

  13952 10 004407   221536 741300       SEND_MAIL_M* STX1  ! HEX2+2,,AUTO

     1426    13953
     1427    13954    2       DCL COUNT UBIN;
     1428    13955    2       DCL START UBIN;
     1429    13956    2       DCL TROUBLE BIT(1);
     1430    13957
     1431    13958    2       CALL M$OPEN( REOPEN_DATA) ALTRET( OOPS);

  13958 10 004410   003632 630400 1                  EPPR0   REOPEN_DATA
        10 004411   450000 713400                    CLIMB   alt,open
        10 004412   410400 401760                    pmme    nvectors=18
        10 004413   004721 702000 10                 TSX2    OOPS

     1432    13959    3       IF SUBJ.LEN = 0 THEN DO;

  13959 10 004414   200516 236100                    LDQ     SUBJ,,AUTO
        10 004415   777000 316003                    CANQ    -512,DU
        10 004416   004424 601000 10                 TNZ     s:13963

     1433    13960    3           SUBJ.TXT = '( )';

  13960 10 004417   040100 100400                    MLR     fill='040'O
        10 004420   002167 000003 2                  ADSC9   XSERRMSG+138             cn=0,n=3
        10 004421   200516 200377                    ADSC9   SUBJ,,AUTO               cn=1,n=255

     1434    13961    3           SUBJ.LEN = 3;

  13961 10 004422   003000 236003                    LDQ     1536,DU
        10 004423   200516 552140                    STBQ    SUBJ,'40'O,AUTO

     1435    13962    3           END;

     1436    13963    2       CALL WRITE_HEADER( SUBJ, 2500) ALTRET( OOPS);

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:245  
  13963 10 004424   000051 236000 11                 LDQ     41
        10 004425   221544 756100                    STQ     LEN,,AUTO
        10 004426   200516 630500                    EPPR0   SUBJ,,AUTO
        10 004427   221543 450500                    STP0    TEMP,,AUTO
        10 004430   005311 701000 10                 TSX1    WRITE_HEADER
        10 004431   004721 702000 10                 TSX2    OOPS

     1437    13964    2       CALL WRITE_HEADER(     , 3000) ALTRET( OOPS);

  13964 10 004432   000053 236000 11                 LDQ     43
        10 004433   221544 756100                    STQ     LEN,,AUTO
        10 004434   000001 236000 xsym               LDQ     B_VECTNIL+1
        10 004435   221543 756100                    STQ     TEMP,,AUTO
        10 004436   005311 701000 10                 TSX1    WRITE_HEADER
        10 004437   004721 702000 10                 TSX2    OOPS

     1438    13965    2       CALL WRITE_HEADER(     , 3200) ALTRET( OOPS);

  13965 10 004440   000055 236000 11                 LDQ     45
        10 004441   221544 756100                    STQ     LEN,,AUTO
        10 004442   000001 236000 xsym               LDQ     B_VECTNIL+1
        10 004443   221543 756100                    STQ     TEMP,,AUTO
        10 004444   005311 701000 10                 TSX1    WRITE_HEADER
        10 004445   004721 702000 10                 TSX2    OOPS

     1439    13966    2       CALL WRITE_HEADER(  MID, 3750) ALTRET( OOPS);

  13966 10 004446   000057 236000 11                 LDQ     47
        10 004447   221544 756100                    STQ     LEN,,AUTO
        10 004450   200716 630500                    EPPR0   MID,,AUTO
        10 004451   221543 450500                    STP0    TEMP,,AUTO
        10 004452   005311 701000 10                 TSX1    WRITE_HEADER
        10 004453   004721 702000 10                 TSX2    OOPS

     1440    13967    2       CALL WRITE_HEADER( RMID, 3752) ALTRET( OOPS);

  13967 10 004454   000061 236000 11                 LDQ     49
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:246  
        10 004455   221544 756100                    STQ     LEN,,AUTO
        10 004456   200616 630500                    EPPR0   RMID,,AUTO
        10 004457   221543 450500                    STP0    TEMP,,AUTO
        10 004460   005311 701000 10                 TSX1    WRITE_HEADER
        10 004461   004721 702000 10                 TSX2    OOPS

     1441    13968    2       CALL WRITE_HEADER( FORUM,3754) ALTRET( OOPS);

  13968 10 004462   000063 236000 11                 LDQ     51
        10 004463   221544 756100                    STQ     LEN,,AUTO
        10 004464   201016 630500                    EPPR0   FORUM,,AUTO
        10 004465   221543 450500                    STP0    TEMP,,AUTO
        10 004466   005311 701000 10                 TSX1    WRITE_HEADER
        10 004467   004721 702000 10                 TSX2    OOPS

     1442    13969    2       CALL WRITE_HEADER( WHEN, 3900) ALTRET( OOPS);

  13969 10 004470   000065 236000 11                 LDQ     53
        10 004471   221544 756100                    STQ     LEN,,AUTO
        10 004472   201116 630500                    EPPR0   WHEN,,AUTO
        10 004473   221543 450500                    STP0    TEMP,,AUTO
        10 004474   005311 701000 10                 TSX1    WRITE_HEADER
        10 004475   004721 702000 10                 TSX2    OOPS

     1443    13970    2       CALL WRITE_HEADER(     , 3910) ALTRET( OOPS);

  13970 10 004476   000067 236000 11                 LDQ     55
        10 004477   221544 756100                    STQ     LEN,,AUTO
        10 004500   000001 236000 xsym               LDQ     B_VECTNIL+1
        10 004501   221543 756100                    STQ     TEMP,,AUTO
        10 004502   005311 701000 10                 TSX1    WRITE_HEADER
        10 004503   004721 702000 10                 TSX2    OOPS

     1444    13971    2       CALL M$CLOSE( CLOSE_DATA) ALTRET( OOPS);

  13971 10 004504   001300 630400 2                  EPPR0   CLOSE_DATA
        10 004505   450001 713400                    CLIMB   alt,close
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:247  
        10 004506   406000 401760                    pmme    nvectors=13
        10 004507   004721 702000 10                 TSX2    OOPS

     1445    13972            /****** SEND MESSAGE TO ALL RECEPIENTS ******/
     1446    13973    2       SEND_MAIL.NAME_ = VECTOR( SEND);

  13973 10 004510   000070 237000 11                 LDAQ    56
        10 004511   004046 757000 1                  STAQ    SEND_MAIL

     1447    13974    2       SEND_MAIL.CMD_ = VECTOR( SEND_CMD);

  13974 10 004512   000072 237000 11                 LDAQ    58
        10 004513   004056 757000 1                  STAQ    SEND_MAIL+8

     1448    13975    2       TROUBLE = %NO#;

  13975 10 004514   221541 450100                    STZ     TROUBLE,,AUTO

     1449    13976    3       DO COUNT = 1 TO USER_COUNT;

  13976 10 004515   000001 235007                    LDA     1,DL
        10 004516   221537 755100                    STA     COUNT,,AUTO
        10 004517   004630 710000 10                 TRA     s:13998+3

     1450    13977    3           CALL M$GTRMCTL( FPT_TRMCTL);  /* get current CTL stuff */

  13977 10 004520   001726 630400 2                  EPPR0   FPT_TRMCTL
        10 004521   160001 713400                    CLIMB   57345
        10 004522   401000 401760                    pmme    nvectors=3

     1451    13978    3           TRMCTL.OUTPUTDISCARD# = %YES#; /* shut off output */

  13978 10 004523   004372 236000 1                  LDQ     TRMCTL
        10 004524   000074 376000 11                 ANQ     60
        10 004525   000002 276003                    ORQ     2,DU
        10 004526   004372 756000 1                  STQ     TRMCTL

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:248  
     1452    13979    3           CALL M$STRMCTL( FPT_TRMCTL);  /* tell the FEP */

  13979 10 004527   001726 630400 2                  EPPR0   FPT_TRMCTL
        10 004530   160000 713400                    CLIMB   57344
        10 004531   401000 401760                    pmme    nvectors=3

     1453    13980    3           CALL M$GTRMCTL( FPT_TRMCTL);  /* wait for FEP response */

  13980 10 004532   001726 630400 2                  EPPR0   FPT_TRMCTL
        10 004533   160001 713400                    CLIMB   57345
        10 004534   401000 401760                    pmme    nvectors=3

     1454    13981    3           CALL M$LINK( SEND_MAIL)

  13981 10 004535   004046 630400 1                  EPPR0   SEND_MAIL
        10 004536   400005 713400                    CLIMB   alt,+5
        10 004537   403000 401760                    pmme    nvectors=7
        10 004540   004542 702000 10                 TSX2    s:13983
        10 004541   004550 710000 10                 TRA     s:13986

     1455    13982    4           WHENALTRETURN DO;

     1456    13983    4               ERRCODE = B$TCB.ALT$->B$ALT.ERR;

  13983 10 004542   000000 470400 xsym               LDP0    B$TCB$
        10 004543   000000 471500                    LDP1    0,,PR0
        10 004544   100102 236100                    LDQ     66,,PR1
        10 004545   004430 756000 1                  STQ     ERRCODE

     1457    13984    4               TROUBLE = %YES#;

  13984 10 004546   400000 236003                    LDQ     -131072,DU
        10 004547   221541 756100                    STQ     TROUBLE,,AUTO

     1458    13985    4               END;

     1459    13986    3           TRMCTL.OUTPUTDISCARD# = %NO#; /* turn on output again */
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:249  

  13986 10 004550   000074 236000 11                 LDQ     60
        10 004551   004372 356000 1                  ANSQ    TRMCTL

     1460    13987    3           CALL M$STRMCTL( FPT_TRMCTL);  /* tell the FEP */

  13987 10 004552   001726 630400 2                  EPPR0   FPT_TRMCTL
        10 004553   160000 713400                    CLIMB   57344
        10 004554   401000 401760                    pmme    nvectors=3

     1461    13988    3           CALL M$GTRMCTL( FPT_TRMCTL);  /* wait for FEP response */

  13988 10 004555   001726 630400 2                  EPPR0   FPT_TRMCTL
        10 004556   160001 713400                    CLIMB   57345
        10 004557   401000 401760                    pmme    nvectors=3

     1462    13989    4           IF COUNT < USER_COUNT THEN DO;

  13989 10 004560   221537 236100                    LDQ     COUNT,,AUTO
        10 004561   000724 116000 1                  CMPQ    USER_COUNT
        10 004562   004625 603000 10                 TRC     s:13998

     1463    13990    4               CALL M$OPEN( REOPEN_DATA) ALTRET( OOPS);

  13990 10 004563   003632 630400 1                  EPPR0   REOPEN_DATA
        10 004564   450000 713400                    CLIMB   alt,open
        10 004565   410400 401760                    pmme    nvectors=18
        10 004566   004721 702000 10                 TSX2    OOPS

     1464    13991    4               DATA_KEY.KEY = 1000;

  13991 10 004567   001750 236007                    LDQ     1000,DL
        10 004570   003430 552034 1                  STBQ    DATA_KEY,'34'O

     1465    13992    4               CALL M$READ( REREAD_DATA) ALTRET( OOPS);

  13992 10 004571   001246 630400 2                  EPPR0   REREAD_DATA
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:250  
        10 004572   440000 713400                    CLIMB   alt,read
        10 004573   401400 401760                    pmme    nvectors=4
        10 004574   004721 702000 10                 TSX2    OOPS

     1466    13993    4               CALL CONCAT( LINEBUF, 'TO:', USERS.TXT( COUNT));

  13993 10 004575   002146 236000 2                  LDQ     XSERRMSG+121
        10 004576   001525 552070 1                  STBQ    LINEBUF,'70'O
        10 004577   221537 235100                    LDA     COUNT,,AUTO
        10 004600   000010 735000                    ALS     8
        10 004601   040000 100505                    MLR     fill='040'O
        10 004602   201716 200374                    ADSC9   USERS,A,AUTO             cn=1,n=252
        10 004603   001525 600374 1                  ADSC9   LINEBUF                  cn=3,n=252

     1467    13994    4               WRITE_DATA.BUF_.BOUND = USERS.LEN( COUNT) + LENGTHC( 'TO:') - 1;

  13994 10 004604   221537 235100                    LDA     COUNT,,AUTO
        10 004605   000006 735000                    ALS     6
        10 004606   201716 236105                    LDQ     USERS,AL,AUTO
        10 004607   000033 772000                    QRL     27
        10 004610   000002 036007                    ADLQ    2,DL
        10 004611   000020 736000                    QLS     16
        10 004612   004022 676000 1                  ERQ     WRITE_DATA+4
        10 004613   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 004614   004022 656000 1                  ERSQ    WRITE_DATA+4

     1468    13995    4               CALL M$WRITE( WRITE_DATA) ALTRET( OOPS);

  13995 10 004615   004016 630400 1                  EPPR0   WRITE_DATA
        10 004616   440001 713400                    CLIMB   alt,write
        10 004617   401400 401760                    pmme    nvectors=4
        10 004620   004721 702000 10                 TSX2    OOPS

     1469    13996    4               CALL M$CLOSE( CLOSE_DATA) ALTRET( OOPS);

  13996 10 004621   001300 630400 2                  EPPR0   CLOSE_DATA
        10 004622   450001 713400                    CLIMB   alt,close
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:251  
        10 004623   406000 401760                    pmme    nvectors=13
        10 004624   004721 702000 10                 TSX2    OOPS

     1470    13997    4               END;

     1471    13998    3           END;

  13998 10 004625   221537 235100                    LDA     COUNT,,AUTO
        10 004626   000001 035007                    ADLA    1,DL
        10 004627   221537 755100                    STA     COUNT,,AUTO
        10 004630   000724 236000 1                  LDQ     USER_COUNT
        10 004631   221537 116100                    CMPQ    COUNT,,AUTO
        10 004632   004520 603000 10                 TRC     s:13977

     1472    13999    2       CALL TCM$WRITE_AUDIT_LOG( MSG_COUNT, HELO);

  13999 10 004633   200016 630500                    EPPR0   HELO,,AUTO
        10 004634   222251 450500                    STP0    TVAL+2,,AUTO
        10 004635   000024 236000 11                 LDQ     20
        10 004636   222250 756100                    STQ     TVAL+1,,AUTO
        10 004637   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 004640   000020 631400 xsym               EPPR1   B_VECTNIL+16
        10 004641   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_LOG
        10 004642   000000 011000                    NOP     0

     1473    14000    3       IF TROUBLE THEN DO;

  14000 10 004643   221541 234100                    SZN     TROUBLE,,AUTO
        10 004644   004656 605000 10                 TPL     s:14006

     1474    14001    3           REPLY$ = R250OOPS$;

  14001 10 004645   000020 236000 2                  LDQ     R250OOPS$
        10 004646   000722 756000 1                  STQ     REPLY$

     1475    14002    3           IF TCM_STUCKEE ~= ' ' THEN

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:252  
  14002 10 004647   040000 106400                    CMPC    fill='040'O
        10 004650   000222 000040 1                  ADSC9   TCM_STUCKEE              cn=0,n=32
        10 004651   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 004652   004663 600000 10                 TZE     s:14010

     1476    14003    3               CALL NOTIFY_STUCKEE;

  14003 10 004653   004732 701000 10                 TSX1    NOTIFY_STUCKEE
        10 004654   000000 011000                    NOP     0

     1477    14004    3           END;

  14004 10 004655   004663 710000 10                 TRA     s:14010

     1478    14005    3       ELSE DO;

     1479    14006    3           CALL M$OPEN( DELETE_DATA)

  14006 10 004656   003724 630400 1                  EPPR0   DELETE_DATA
        10 004657   450000 713400                    CLIMB   alt,open
        10 004660   410400 401760                    pmme    nvectors=18
        10 004661   004663 702000 10                 TSX2    s:14010
        10 004662   004663 710000 10                 TRA     s:14010

     1480    14007    4           WHENALTRETURN DO;

     1481    14008    4               END;

     1482    14009    3           END;

     1483    14010    2       IF TROUBLE THEN

  14010 10 004663   221541 234100                    SZN     TROUBLE,,AUTO
        10 004664   004717 605000 10                 TPL     s:14019

     1484    14011    3           IF TCM_DRIBBLE OR TCM_DRIBBLE_ME THEN DO;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:253  
  14011 10 004665   000216 235000 1                  LDA     TCM_DRIBBLE
        10 004666   004671 601000 10                 TNZ     s:14012
        10 004667   000217 236000 1                  LDQ     TCM_DRIBBLE_ME
        10 004670   004717 600000 10                 TZE     s:14019

     1485    14012    3               OCMSG = ' ';

  14012 10 004671   040000 100400                    MLR     fill='040'O
        10 004672   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 004673   003267 000377 1                  ADSC9   OCMSG                    cn=0,n=255

     1486    14013    3               FPT_ERRMSG.BUF_ = VECTOR( OCMSG);

  14013 10 004674   000076 237000 11                 LDAQ    62
        10 004675   004402 757000 1                  STAQ    FPT_ERRMSG+4

     1487    14014    3               CALL M$ERRMSG( FPT_ERRMSG);

  14014 10 004676   004376 630400 1                  EPPR0   FPT_ERRMSG
        10 004677   020000 713400                    CLIMB   8192
        10 004700   405000 401760                    pmme    nvectors=11

     1488    14015    3               CALL GET_IOBUF_BOUND( OCMSG, COUNT);

  14015 10 004701   221537 630500                    EPPR0   COUNT,,AUTO
        10 004702   222246 450500                    STP0    @BUF+1,,AUTO
        10 004703   000033 236000 11                 LDQ     27
        10 004704   222245 756100                    STQ     TEMP+2,,AUTO
        10 004705   013043 701000 10                 TSX1    GET_IOBUF_BOUND
        10 004706   000000 011000                    NOP     0

     1489    14016    3               WRITE_DRIBBLE.BUF_ = VECTOR( SUBSTR( OCMSG, 0, COUNT));

  14016 10 004707   221537 235100                    LDA     COUNT,,AUTO
        10 004710   000020 735000                    ALS     16
        10 004711   000140 135007                    SBLA    96,DL
        10 004712   000033 236000 11                 LDQ     27
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:254  
        10 004713   003516 757000 1                  STAQ    WRITE_DRIBBLE+4

     1490    14017    3               CALL M$WRITE( WRITE_DRIBBLE);

  14017 10 004714   003512 630400 1                  EPPR0   WRITE_DRIBBLE
        10 004715   040001 713400                    CLIMB   write
        10 004716   401400 401760                    pmme    nvectors=4

     1491    14018    3               END;

     1492    14019    2       RETURN;

  14019 10 004717   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 004720   000001 702211                    TSX2  ! 1,X1

     1493    14020    2   OOPS:
     1494    14021    2       CALL M$CLOSE( CLOSE_DATA)

  14021 10 004721   001300 630400 2     OOPS         EPPR0   CLOSE_DATA
        10 004722   450001 713400                    CLIMB   alt,close
        10 004723   406000 401760                    pmme    nvectors=13
        10 004724   004726 702000 10                 TSX2    s:14024
        10 004725   004726 710000 10                 TRA     s:14024

     1495    14022    3       WHENALTRETURN DO;

     1496    14023    3           END;

     1497    14024    2       REPLY$ = R451$;

  14024 10 004726   000030 236000 2                  LDQ     R451$
        10 004727   000722 756000 1                  STQ     REPLY$

     1498    14025    2       ALTRETURN;

  14025 10 004730   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 004731   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:255  

     1499    14026
     1500    14027    2       END SEND_MAIL_MESSAGE;
     1501    14028        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:256  
     1502    14029    1   NOTIFY_STUCKEE: PROC;

  14029 10 004732   221542 741300       NOTIFY_STUC* STX1  ! BLANK_LINE_READ,,AUTO

     1503    14030
     1504    14031    2       DCL ERRMSGBUF(0:6) CHAR(120);
     1505    14032    2       DCL F$DATA$ PTR;
     1506    14033    2       DCL I SBIN;
     1507    14034
     1508    14035    2       CALL M$OPEN( REOPEN_DATA) ALTRET( DONE);

  14035 10 004733   003632 630400 1                  EPPR0   REOPEN_DATA
        10 004734   450000 713400                    CLIMB   alt,open
        10 004735   410400 401760                    pmme    nvectors=18
        10 004736   005111 702000 10                 TSX2    DONE

     1509    14036    2       CALL CREATE_NOTEFILE ALTRET( BAILOUT);

  14036 10 004737   005116 701000 10                 TSX1    CREATE_NOTEFILE
        10 004740   005105 702000 10                 TSX2    BAILOUT

     1510    14037    2       CALL CONCAT( OCMSG, 'To: ', TCM_STUCKEE);

  14037 10 004741   002170 236000 2                  LDQ     XSERRMSG+139
        10 004742   003267 756000 1                  STQ     OCMSG
        10 004743   040000 100400                    MLR     fill='040'O
        10 004744   000222 000040 1                  ADSC9   TCM_STUCKEE              cn=0,n=32
        10 004745   003270 000373 1                  ADSC9   OCMSG+1                  cn=0,n=251

     1511    14038    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);

  14038 10 004746   005125 701000 10                 TSX1    APPEND_NOTEFILE
        10 004747   005105 702000 10                 TSX2    BAILOUT

     1512    14039    2       OCMSG = 'Subject: Mail delivery failure';

  14039 10 004750   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:257  
        10 004751   002171 000036 2                  ADSC9   XSERRMSG+140             cn=0,n=30
        10 004752   003267 000377 1                  ADSC9   OCMSG                    cn=0,n=255

     1513    14040    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);

  14040 10 004753   005125 701000 10                 TSX1    APPEND_NOTEFILE
        10 004754   005105 702000 10                 TSX2    BAILOUT

     1514    14041    2       F$DATA$ = DCBADDR( DCBNUM( F$DATA));

  14041 10 004755   000000 236007 xsym               LDQ     F$DATA,DL
        10 004756   000000 470400 11                 LDP0    0
        10 004757   000000 471500                    LDP1    0,,PR0
        10 004760   100000 236106                    LDQ     0,QL,PR1
        10 004761   222065 756100                    STQ     F$DATA$,,AUTO

     1515    14042    2       CALL CONCAT( OCMSG, 'Mailgram ',

  14042 10 004762   222065 473500                    LDP3    F$DATA$,,AUTO
        10 004763   300010 236100                    LDQ     8,,PR3
        10 004764   000033 772000                    QRL     27
        10 004765   040000 100400                    MLR     fill='040'O
        10 004766   002201 000011 2                  ADSC9   XSERRMSG+148             cn=0,n=9
        10 004767   003267 000011 1                  ADSC9   OCMSG                    cn=0,n=9
        10 004770   000000 620006                    EAX0    0,QL
        10 004771   040000 100540                    MLR     fill='040'O
        10 004772   300010 200010                    ADSC9   8,,PR3                   cn=1,n=*X0
        10 004773   003271 200366 1                  ADSC9   OCMSG+2                  cn=1,n=246
        10 004774   000366 116007                    CMPQ    246,DL
        10 004775   005021 603000 10                 TRC     s:14046
        10 004776   777411 620006                    EAX0    -247,QL
        10 004777   777777 660003                    ERX0    -1,DU
        10 005000   040046 100400                    MLR     fill='040'O
        10 005001   000034 000001 11                 ADSC9   28                       cn=0,n=1
        10 005002   003271 200010 1                  ADSC9   OCMSG+2,Q                cn=1,n=*X0
        10 005003   000365 116007                    CMPQ    245,DL
        10 005004   005021 603000 10                 TRC     s:14046
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:258  
        10 005005   777412 620006                    EAX0    -246,QL
        10 005006   777777 660003                    ERX0    -1,DU
        10 005007   040046 100500                    MLR     fill='040'O
        10 005010   300020 000010                    ADSC9   16,,PR3                  cn=0,n=8
        10 005011   003271 400010 1                  ADSC9   OCMSG+2,Q                cn=2,n=*X0
        10 005012   000355 116007                    CMPQ    237,DL
        10 005013   005021 603000 10                 TRC     s:14046
        10 005014   777422 620006                    EAX0    -238,QL
        10 005015   777777 660003                    ERX0    -1,DU
        10 005016   040046 100400                    MLR     fill='040'O
        10 005017   002204 000027 2                  ADSC9   XSERRMSG+151             cn=0,n=23
        10 005020   003273 400010 1                  ADSC9   OCMSG+4,Q                cn=2,n=*X0

     1516    14043    2               SUBSTR( F$DATA$->F$DCB.NAME#.C, 0, F$DATA$->F$DCB.NAME#.L),
     1517    14044    2               '.', F$DATA$->F$DCB.ACCT#,
     1518    14045    2               ' could not be delivered');
     1519    14046    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);

  14046 10 005021   005125 701000 10                 TSX1    APPEND_NOTEFILE
        10 005022   005105 702000 10                 TSX2    BAILOUT

     1520    14047    2       CALL CONCAT( OCMSG, 'to ', SUBSTR( RCPT.TXT, 0, RCPT.LEN),

  14047 10 005023   200216 236100                    LDQ     RCPT,,AUTO
        10 005024   000033 772000                    QRL     27
        10 005025   000000 620006                    EAX0    0,QL
        10 005026   002026 236000 2                  LDQ     XSERRMSG+41
        10 005027   000075 376000 11                 ANQ     61
        10 005030   000040 276007                    ORQ     32,DL
        10 005031   003267 756000 1                  STQ     OCMSG
        10 005032   040000 100540                    MLR     fill='040'O
        10 005033   200216 200010                    ADSC9   RCPT,,AUTO               cn=1,n=*X0
        10 005034   003267 600374 1                  ADSC9   OCMSG                    cn=3,n=252
        10 005035   000000 636010                    EAQ     0,X0
        10 005036   000022 772000                    QRL     18
        10 005037   000374 116007                    CMPQ    252,DL
        10 005040   005051 603000 10                 TRC     s:14049
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:259  
        10 005041   222250 740100                    STX0    TVAL+1,,AUTO
        10 005042   777403 620010                    EAX0    -253,X0
        10 005043   777777 660003                    ERX0    -1,DU
        10 005044   222250 235100                    LDA     TVAL+1,,AUTO
        10 005045   000022 771000                    ARL     18
        10 005046   040045 100400                    MLR     fill='040'O
        10 005047   002212 000054 2                  ADSC9   XSERRMSG+157             cn=0,n=44
        10 005050   003267 600010 1                  ADSC9   OCMSG,A                  cn=3,n=*X0

     1521    14048    2               ' for the following reason, supplied by SEND:');
     1522    14049    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);

  14049 10 005051   005125 701000 10                 TSX1    APPEND_NOTEFILE
        10 005052   005105 702000 10                 TSX2    BAILOUT

     1523    14050    2       FPT_ERRMSG.BUF_ = VECTOR( ERRMSGBUF);

  14050 10 005053   000100 235000 11                 LDA     64
        10 005054   222250 452500                    STP2    TVAL+1,,AUTO
        10 005055   222250 236100                    LDQ     TVAL+1,,AUTO
        10 005056   021543 036003                    ADLQ    9059,DU
        10 005057   004402 757000 1                  STAQ    FPT_ERRMSG+4

     1524    14051    2       CALL M$ERRMSG( FPT_ERRMSG) ALTRET( BAILOUT);

  14051 10 005060   004376 630400 1                  EPPR0   FPT_ERRMSG
        10 005061   420000 713400                    CLIMB   alt,+8192
        10 005062   405000 401760                    pmme    nvectors=11
        10 005063   005105 702000 10                 TSX2    BAILOUT

     1525    14052    3       DO I = 1 TO VLR_ERRMSG.RECCNT;

  14052 10 005064   000001 235007                    LDA     1,DL
        10 005065   222066 755100                    STA     I,,AUTO
        10 005066   005077 710000 10                 TRA     s:14055+1

     1526    14053    3           OCMSG = ERRMSGBUF( I - 1);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:260  

  14053 10 005067   222066 236100                    LDQ     I,,AUTO
        10 005070   000170 402007                    MPY     120,DL
        10 005071   040000 100506                    MLR     fill='040'O
        10 005072   221505 000170                    ADSC9   CMDBUF+47,Q,AUTO         cn=0,n=120
        10 005073   003267 000377 1                  ADSC9   OCMSG                    cn=0,n=255

     1527    14054    3           CALL APPEND_NOTEFILE ALTRET( BAILOUT);

  14054 10 005074   005125 701000 10                 TSX1    APPEND_NOTEFILE
        10 005075   005105 702000 10                 TSX2    BAILOUT

     1528    14055    3           END;

  14055 10 005076   222066 054100                    AOS     I,,AUTO
        10 005077   004432 236000 1                  LDQ     VLR_ERRMSG
        10 005100   000777 376007                    ANQ     511,DL
        10 005101   222066 116100                    CMPQ    I,,AUTO
        10 005102   005067 605000 10                 TPL     s:14053

     1529    14056    2       CALL SEND_NOTEFILE ALTRET( BAILOUT);

  14056 10 005103   005147 701000 10                 TSX1    SEND_NOTEFILE
        10 005104   005105 702000 10                 TSX2    BAILOUT

     1530    14057    2   BAILOUT:
     1531    14058    2       CALL M$CLOSE( CLOSE_DATA) ALTRET( DONE);

  14058 10 005105   001300 630400 2     BAILOUT      EPPR0   CLOSE_DATA
        10 005106   450001 713400                    CLIMB   alt,close
        10 005107   406000 401760                    pmme    nvectors=13
        10 005110   005111 702000 10                 TSX2    DONE

     1532    14059    2   DONE:
     1533    14060    2       RETURN;

  14060 10 005111   221542 221300       DONE         LDX1  ! BLANK_LINE_READ,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:261  
        10 005112   000001 702211                    TSX2  ! 1,X1

     1534    14061
     1535    14062    2       END NOTIFY_STUCKEE;
     1536    14063        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:262  
     1537    14064    1   NOTEFILE_STUFF: PROC ALTRET;

  14064 10 005113   222242 741300       NOTEFILE_ST* STX1  ! I+1,,AUTO

     1538    14065
     1539    14066    2       DCL TEMP SBIN;
     1540    14067
     1541    14068    2   OOPS:
     1542    14069    2       ALTRETURN;

  14069 10 005114   222242 221300       OOPS         LDX1  ! I+1,,AUTO
        10 005115   000000 702211                    TSX2  ! 0,X1

     1543    14070
     1544    14071    2   CREATE_NOTEFILE: ENTRY ALTRET;

  14071 10 005116   222242 741300       CREATE_NOTE* STX1  ! I+1,,AUTO

     1545    14072
     1546    14073    2       CALL M$OPEN( OPEN_NOTIFY) ALTRET( OOPS);

  14073 10 005117   001336 630400 2                  EPPR0   OPEN_NOTIFY
        10 005120   450000 713400                    CLIMB   alt,open
        10 005121   410400 401760                    pmme    nvectors=18
        10 005122   005114 702000 10                 TSX2    OOPS

     1547    14074    2       RETURN;

  14074 10 005123   222242 221300                    LDX1  ! I+1,,AUTO
        10 005124   000001 702211                    TSX2  ! 1,X1

     1548    14075
     1549    14076    2   APPEND_NOTEFILE: ENTRY ALTRET;

  14076 10 005125   222242 741300       APPEND_NOTE* STX1  ! I+1,,AUTO

     1550    14077
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:263  
     1551    14078    2       CALL GET_IOBUF_BOUND( OCMSG, TEMP);

  14078 10 005126   222243 630500                    EPPR0   TEMP,,AUTO
        10 005127   222246 450500                    STP0    @BUF+1,,AUTO
        10 005130   000033 236000 11                 LDQ     27
        10 005131   222245 756100                    STQ     TEMP+2,,AUTO
        10 005132   013043 701000 10                 TSX1    GET_IOBUF_BOUND
        10 005133   000000 011000                    NOP     0

     1552    14079    2       WRITE_NOTIFY.BUF_ = VECTOR( SUBSTR( OCMSG, 0, TEMP));

  14079 10 005134   222243 235100                    LDA     TEMP,,AUTO
        10 005135   000020 735000                    ALS     16
        10 005136   000140 135007                    SBLA    96,DL
        10 005137   000033 236000 11                 LDQ     27
        10 005140   004036 757000 1                  STAQ    WRITE_NOTIFY+4

     1553    14080    2       CALL M$WRITE( WRITE_NOTIFY) ALTRET( OOPS);

  14080 10 005141   004032 630400 1                  EPPR0   WRITE_NOTIFY
        10 005142   440001 713400                    CLIMB   alt,write
        10 005143   401400 401760                    pmme    nvectors=4
        10 005144   005114 702000 10                 TSX2    OOPS

     1554    14081    2       RETURN;

  14081 10 005145   222242 221300                    LDX1  ! I+1,,AUTO
        10 005146   000001 702211                    TSX2  ! 1,X1

     1555    14082
     1556    14083    2   SEND_NOTEFILE: ENTRY ALTRET;

  14083 10 005147   222242 741300       SEND_NOTEFI* STX1  ! I+1,,AUTO

     1557    14084
     1558    14085    2       CALL M$CLOSE( CLOSE_NOTIFY) ALTRET( OOPS);

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:264  
  14085 10 005150   001432 630400 2                  EPPR0   CLOSE_NOTIFY
        10 005151   450001 713400                    CLIMB   alt,close
        10 005152   406000 401760                    pmme    nvectors=13
        10 005153   005114 702000 10                 TSX2    OOPS

     1559    14086    2       CALL M$LINK( SEND_NOTIFY) ALTRET( OOPS);

  14086 10 005154   001470 630400 2                  EPPR0   SEND_NOTIFY
        10 005155   400005 713400                    CLIMB   alt,+5
        10 005156   403000 401760                    pmme    nvectors=7
        10 005157   005114 702000 10                 TSX2    OOPS

     1560    14087    2       RETURN;

  14087 10 005160   222242 221300                    LDX1  ! I+1,,AUTO
        10 005161   000001 702211                    TSX2  ! 1,X1

     1561    14088
     1562    14089    2       END NOTEFILE_STUFF;
     1563    14090        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:265  
     1564    14091    1   NOTIFY_STUCKEE_READERR: PROC;

  14091 10 005162   221716 741300       NOTIFY_STUC* STX1  ! CURR_CMDCODE+2,,AUTO

     1565    14092
     1566    14093    2       DCL ERRMSGBUF(0:6) CHAR(120);
     1567    14094    2       DCL I SBIN;
     1568    14095
     1569    14096    2       IF NOT TCM_TCPFLAVOR THEN

  14096 10 005163   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 005164   005307 605000 10                 TPL     BAILOUT

     1570    14097    2           GOTO BAILOUT;
     1571    14098    2       CALL CREATE_NOTEFILE ALTRET( BAILOUT);

  14098 10 005165   005116 701000 10                 TSX1    CREATE_NOTEFILE
        10 005166   005307 702000 10                 TSX2    BAILOUT

     1572    14099    2       CALL CONCAT( OCMSG, 'To: ', TCM_STUCKEE);

  14099 10 005167   002170 236000 2                  LDQ     XSERRMSG+139
        10 005170   003267 756000 1                  STQ     OCMSG
        10 005171   040000 100400                    MLR     fill='040'O
        10 005172   000222 000040 1                  ADSC9   TCM_STUCKEE              cn=0,n=32
        10 005173   003270 000373 1                  ADSC9   OCMSG+1                  cn=0,n=251

     1573    14100    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);

  14100 10 005174   005125 701000 10                 TSX1    APPEND_NOTEFILE
        10 005175   005307 702000 10                 TSX2    BAILOUT

     1574    14101    2       OCMSG = 'Subject: Mail reception failure';

  14101 10 005176   040000 100400                    MLR     fill='040'O
        10 005177   002225 000037 2                  ADSC9   XSERRMSG+168             cn=0,n=31
        10 005200   003267 000377 1                  ADSC9   OCMSG                    cn=0,n=255
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:266  

     1575    14102    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);

  14102 10 005201   005125 701000 10                 TSX1    APPEND_NOTEFILE
        10 005202   005307 702000 10                 TSX2    BAILOUT

     1576    14103    2       CALL CONCAT( OCMSG, 'A mailgram could not be received');

  14103 10 005203   040000 100400                    MLR     fill='040'O
        10 005204   002235 000040 2                  ADSC9   XSERRMSG+176             cn=0,n=32
        10 005205   003267 000377 1                  ADSC9   OCMSG                    cn=0,n=255

     1577    14104    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);

  14104 10 005206   005125 701000 10                 TSX1    APPEND_NOTEFILE
        10 005207   005307 702000 10                 TSX2    BAILOUT

     1578    14105    2       CALL CONCAT( OCMSG, 'for ', SUBSTR( RCPT.TXT, 0, RCPT.LEN),

  14105 10 005210   200216 236100                    LDQ     RCPT,,AUTO
        10 005211   000033 772000                    QRL     27
        10 005212   000000 620006                    EAX0    0,QL
        10 005213   002245 236000 2                  LDQ     XSERRMSG+184
        10 005214   003267 756000 1                  STQ     OCMSG
        10 005215   040000 100540                    MLR     fill='040'O
        10 005216   200216 200010                    ADSC9   RCPT,,AUTO               cn=1,n=*X0
        10 005217   003270 000373 1                  ADSC9   OCMSG+1                  cn=0,n=251
        10 005220   000000 636010                    EAQ     0,X0
        10 005221   000022 772000                    QRL     18
        10 005222   000373 116007                    CMPQ    251,DL
        10 005223   005234 603000 10                 TRC     s:14107
        10 005224   222250 740100                    STX0    TVAL+1,,AUTO
        10 005225   777404 620010                    EAX0    -252,X0
        10 005226   777777 660003                    ERX0    -1,DU
        10 005227   222250 235100                    LDA     TVAL+1,,AUTO
        10 005230   000022 771000                    ARL     18
        10 005231   040045 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:267  
        10 005232   002246 000066 2                  ADSC9   XSERRMSG+185             cn=0,n=54
        10 005233   003270 000010 1                  ADSC9   OCMSG+1,A                cn=0,n=*X0

     1579    14106    2               ' for the following reason, supplied by Socket Library:');
     1580    14107    2       CALL APPEND_NOTEFILE ALTRET( BAILOUT);

  14107 10 005234   005125 701000 10                 TSX1    APPEND_NOTEFILE
        10 005235   005307 702000 10                 TSX2    BAILOUT

     1581    14108    2       IF XSL_ERRNO ~= 0 THEN

  14108 10 005236   000000 235000 xsym               LDA     XSL_ERRNO
        10 005237   005245 600000 10                 TZE     s:14111

     1582    14109    2           ERRCODE = '302314'O | BINBIT( XSL_ERRNO, 33);

  14109 10 005240   000000 236000 xsym               LDQ     XSL_ERRNO
        10 005241   000003 736000                    QLS     3
        10 005242   302314 276003                    ORQ     99532,DU
        10 005243   004430 756000 1                  STQ     ERRCODE
        10 005244   005255 710000 10                 TRA     s:14115

     1583    14110    2       ELSE
     1584    14111    2           IF TCP_MON_ERR THEN

  14111 10 005245   000000 236000 xsym               LDQ     TCP_MON_ERR
        10 005246   005251 600000 10                 TZE     s:14114

     1585    14112    2               ERRCODE = TCP_MON_ERR;

  14112 10 005247   004430 756000 1                  STQ     ERRCODE
        10 005250   005255 710000 10                 TRA     s:14115

     1586    14113    2           ELSE
     1587    14114    2               ERRCODE = '302314'O | BINBIT( %E$IO, 33);

  14114 10 005251   000005 236007                    LDQ     5,DL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:268  
        10 005252   000003 736000                    QLS     3
        10 005253   302314 276003                    ORQ     99532,DU
        10 005254   004430 756000 1                  STQ     ERRCODE

     1588    14115    2       FPT_XSERRMSG.BUF_ = VECTOR( ERRMSGBUF);

  14115 10 005255   000100 235000 11                 LDA     64
        10 005256   222250 452500                    STP2    TVAL+1,,AUTO
        10 005257   222250 236100                    LDQ     TVAL+1,,AUTO
        10 005260   021717 036003                    ADLQ    9167,DU
        10 005261   004442 757000 1                  STAQ    FPT_XSERRMSG+4

     1589    14116    2       CALL M$ERRMSG( FPT_XSERRMSG) ALTRET( BAILOUT);

  14116 10 005262   004436 630400 1                  EPPR0   FPT_XSERRMSG
        10 005263   420000 713400                    CLIMB   alt,+8192
        10 005264   405000 401760                    pmme    nvectors=11
        10 005265   005307 702000 10                 TSX2    BAILOUT

     1590    14117    3       DO I = 1 TO VLR_ERRMSG.RECCNT;

  14117 10 005266   000001 235007                    LDA     1,DL
        10 005267   222241 755100                    STA     I,,AUTO
        10 005270   005301 710000 10                 TRA     s:14120+1

     1591    14118    3           OCMSG = ERRMSGBUF( I - 1);

  14118 10 005271   222241 236100                    LDQ     I,,AUTO
        10 005272   000170 402007                    MPY     120,DL
        10 005273   040000 100506                    MLR     fill='040'O
        10 005274   221661 000170                    ADSC9   @TARGET+1,Q,AUTO         cn=0,n=120
        10 005275   003267 000377 1                  ADSC9   OCMSG                    cn=0,n=255

     1592    14119    3           CALL APPEND_NOTEFILE ALTRET( BAILOUT);

  14119 10 005276   005125 701000 10                 TSX1    APPEND_NOTEFILE
        10 005277   005307 702000 10                 TSX2    BAILOUT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:269  

     1593    14120    3           END;

  14120 10 005300   222241 054100                    AOS     I,,AUTO
        10 005301   004432 236000 1                  LDQ     VLR_ERRMSG
        10 005302   000777 376007                    ANQ     511,DL
        10 005303   222241 116100                    CMPQ    I,,AUTO
        10 005304   005271 605000 10                 TPL     s:14118

     1594    14121    2       CALL SEND_NOTEFILE ALTRET( BAILOUT);

  14121 10 005305   005147 701000 10                 TSX1    SEND_NOTEFILE
        10 005306   005307 702000 10                 TSX2    BAILOUT

     1595    14122    2   BAILOUT:
     1596    14123    2       RETURN;

  14123 10 005307   221716 221300       BAILOUT      LDX1  ! CURR_CMDCODE+2,,AUTO
        10 005310   000001 702211                    TSX2  ! 1,X1

     1597    14124
     1598    14125    2       END NOTIFY_STUCKEE_READERR;
     1599    14126        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:270  
     1600    14127    1   WRITE_HEADER: PROC( TXTC, KEYVAL) ALTRET;

  14127 10 005311   221542 741300       WRITE_HEADER STX1  ! BLANK_LINE_READ,,AUTO

     1601    14128
     1602    14129    2       DCL 1 TXTC,
     1603    14130    2            2 LEN UBIN(9) CALIGNED,
     1604    14131    2            2 TXT CHAR( TXTC.LEN) CALIGNED;
     1605    14132    2       DCL KEYVAL SBIN;
     1606    14133            %BUFFER( NAME=TITLE);
     1607    14138
     1608    14139    3       DO SELECT( KEYVAL);

  14139 10 005312   221544 470500                    LDP0    @KEYVAL,,AUTO
        10 005313   000000 236100                    LDQ     0,,PR0
        10 005314   007252 116007                    CMPQ    3754,DL
        10 005315   005325 604000 10                 TMI     s:14139+11
        10 005316   005406 600000 10                 TZE     s:14157
        10 005317   007474 116007                    CMPQ    3900,DL
        10 005320   005655 604000 10                 TMI     s:14207
        10 005321   005424 600000 10                 TZE     s:14163
        10 005322   007506 116007                    CMPQ    3910,DL
        10 005323   005655 601000 10                 TNZ     s:14207
        10 005324   005475 710000 10                 TRA     s:14172
        10 005325   007246 116007                    CMPQ    3750,DL
        10 005326   005333 604000 10                 TMI     s:14139+17
        10 005327   005352 600000 10                 TZE     s:14145
        10 005330   007250 116007                    CMPQ    3752,DL
        10 005331   005655 601000 10                 TNZ     s:14207
        10 005332   005370 710000 10                 TRA     s:14151
        10 005333   005670 116007                    CMPQ    3000,DL
        10 005334   005341 604000 10                 TMI     s:14139+23
        10 005335   005510 600000 10                 TZE     s:14177
        10 005336   006200 116007                    CMPQ    3200,DL
        10 005337   005655 601000 10                 TNZ     s:14207
        10 005340   005567 710000 10                 TRA     s:14189
        10 005341   004704 116007                    CMPQ    2500,DL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:271  
        10 005342   005655 601000 10                 TNZ     s:14207
        10 005343   005344 710000 10                 TRA     s:14141

     1609    14140    3           SELECT( 2500);  /* SUBJ */

     1610    14141    3               TITLE.TXT = 'Subject: ';

  14141 10 005344   040100 100400                    MLR     fill='040'O
        10 005345   002171 000011 2                  ADSC9   XSERRMSG+140             cn=0,n=9
        10 005346   221545 200377                    ADSC9   TITLE,,AUTO              cn=1,n=255

     1611    14142    3               TITLE.LEN = 9;

  14142 10 005347   011000 236003                    LDQ     4608,DU
        10 005350   221545 552140                    STBQ    TITLE,'40'O,AUTO

     1612    14143    3               GOTO COMMON;

  14143 10 005351   005441 710000 10                 TRA     COMMON

     1613    14144    3           SELECT( 3750);  /* MID */

     1614    14145    3               IF TXTC.LEN = 0 THEN

  14145 10 005352   221543 471500                    LDP1    @TXTC,,AUTO
        10 005353   000100 101500                    MRL     fill='000'O
        10 005354   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 005355   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 005356   222250 236100                    LDQ     TVAL+1,,AUTO
        10 005357   000000 116003                    CMPQ    0,DU
        10 005360   005362 601000 10                 TNZ     s:14147

     1615    14146    3                   RETURN;

  14146 10 005361   000001 702211                    TSX2  ! 1,X1

     1616    14147    3               TITLE.TXT = 'Message ID: ';
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:272  

  14147 10 005362   040100 100400                    MLR     fill='040'O
        10 005363   002264 000014 2                  ADSC9   XSERRMSG+199             cn=0,n=12
        10 005364   221545 200377                    ADSC9   TITLE,,AUTO              cn=1,n=255

     1617    14148    3               TITLE.LEN = 12;

  14148 10 005365   014000 236003                    LDQ     6144,DU
        10 005366   221545 552140                    STBQ    TITLE,'40'O,AUTO

     1618    14149    3               GOTO COMMON;

  14149 10 005367   005441 710000 10                 TRA     COMMON

     1619    14150    3           SELECT( 3752);  /* RMID */

     1620    14151    3               IF TXTC.LEN = 0 THEN

  14151 10 005370   221543 471500                    LDP1    @TXTC,,AUTO
        10 005371   000100 101500                    MRL     fill='000'O
        10 005372   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 005373   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 005374   222250 236100                    LDQ     TVAL+1,,AUTO
        10 005375   000000 116003                    CMPQ    0,DU
        10 005376   005400 601000 10                 TNZ     s:14153

     1621    14152    3                   RETURN;

  14152 10 005377   000001 702211                    TSX2  ! 1,X1

     1622    14153    3               TITLE.TXT = 'Reference ID: ';

  14153 10 005400   040100 100400                    MLR     fill='040'O
        10 005401   002267 000016 2                  ADSC9   XSERRMSG+202             cn=0,n=14
        10 005402   221545 200377                    ADSC9   TITLE,,AUTO              cn=1,n=255

     1623    14154    3               TITLE.LEN = 14;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:273  

  14154 10 005403   016000 236003                    LDQ     7168,DU
        10 005404   221545 552140                    STBQ    TITLE,'40'O,AUTO

     1624    14155    3               GOTO COMMON;

  14155 10 005405   005441 710000 10                 TRA     COMMON

     1625    14156    3           SELECT( 3754);  /* FORUM */

     1626    14157    3               IF TXTC.LEN = 0 THEN

  14157 10 005406   221543 471500                    LDP1    @TXTC,,AUTO
        10 005407   000100 101500                    MRL     fill='000'O
        10 005410   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 005411   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 005412   222250 236100                    LDQ     TVAL+1,,AUTO
        10 005413   000000 116003                    CMPQ    0,DU
        10 005414   005416 601000 10                 TNZ     s:14159

     1627    14158    3                   RETURN;

  14158 10 005415   000001 702211                    TSX2  ! 1,X1

     1628    14159    3               TITLE.TXT = 'Transaction: ';

  14159 10 005416   040100 100400                    MLR     fill='040'O
        10 005417   002273 000015 2                  ADSC9   XSERRMSG+206             cn=0,n=13
        10 005420   221545 200377                    ADSC9   TITLE,,AUTO              cn=1,n=255

     1629    14160    3               TITLE.LEN = 13;

  14160 10 005421   015000 236003                    LDQ     6656,DU
        10 005422   221545 552140                    STBQ    TITLE,'40'O,AUTO

     1630    14161    3               GOTO COMMON;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:274  
  14161 10 005423   005441 710000 10                 TRA     COMMON

     1631    14162    3           SELECT( 3900);  /* WHEN */

     1632    14163    3               IF TXTC.LEN = 0 THEN

  14163 10 005424   221543 471500                    LDP1    @TXTC,,AUTO
        10 005425   000100 101500                    MRL     fill='000'O
        10 005426   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 005427   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 005430   222250 236100                    LDQ     TVAL+1,,AUTO
        10 005431   000000 116003                    CMPQ    0,DU
        10 005432   005434 601000 10                 TNZ     s:14165

     1633    14164    3                   RETURN;

  14164 10 005433   000001 702211                    TSX2  ! 1,X1

     1634    14165    3               TITLE.TXT = 'Date: ';

  14165 10 005434   040100 100400                    MLR     fill='040'O
        10 005435   002277 000006 2                  ADSC9   XSERRMSG+210             cn=0,n=6
        10 005436   221545 200377                    ADSC9   TITLE,,AUTO              cn=1,n=255

     1635    14166    3               TITLE.LEN = 6;

  14166 10 005437   006000 236003                    LDQ     3072,DU
        10 005440   221545 552140                    STBQ    TITLE,'40'O,AUTO

     1636    14167    3   COMMON:
     1637    14168    3               CALL CONCAT( LINEBUF, SUBSTR( TITLE.TXT, 0, TITLE.LEN));

  14168 10 005441   221545 236100       COMMON       LDQ     TITLE,,AUTO
        10 005442   000033 772000                    QRL     27
        10 005443   000000 620006                    EAX0    0,QL
        10 005444   040000 100540                    MLR     fill='040'O
        10 005445   221545 200010                    ADSC9   TITLE,,AUTO              cn=1,n=*X0
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:275  
        10 005446   001525 000377 1                  ADSC9   LINEBUF                  cn=0,n=255

     1638    14169    3               CALL INSERT( LINEBUF, TITLE.LEN, , TXTC.TXT);

  14169 10 005447   221543 471500                    LDP1    @TXTC,,AUTO
        10 005450   000100 101500                    MRL     fill='000'O
        10 005451   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 005452   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 005453   222250 220100                    LDX0    TVAL+1,,AUTO
        10 005454   221545 236100                    LDQ     TITLE,,AUTO
        10 005455   000033 772000                    QRL     27
        10 005456   777400 622006                    EAX2    -256,QL
        10 005457   777777 662003                    ERX2    -1,DU
        10 005460   040046 100540                    MLR     fill='040'O
        10 005461   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        10 005462   001525 000012 1                  ADSC9   LINEBUF,Q                cn=0,n=*X2

     1639    14170    3               WRITE_DATA.BUF_.BOUND = TITLE.LEN + TXTC.LEN - 1;

  14170 10 005463   000100 101500                    MRL     fill='000'O
        10 005464   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 005465   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 005466   222250 036100                    ADLQ    TVAL+1,,AUTO
        10 005467   000001 136007                    SBLQ    1,DL
        10 005470   000020 736000                    QLS     16
        10 005471   004022 676000 1                  ERQ     WRITE_DATA+4
        10 005472   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 005473   004022 656000 1                  ERSQ    WRITE_DATA+4
        10 005474   005655 710000 10                 TRA     s:14207

     1640    14171    3           SELECT( 3910);  /* (ACK) */

     1641    14172    3               IF NOT ACKNOWLEDGE THEN

  14172 10 005475   200015 234100                    SZN     ACKNOWLEDGE,,AUTO
        10 005476   005500 604000 10                 TMI     s:14174

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:276  
     1642    14173    3                   RETURN;

  14173 10 005477   000001 702211                    TSX2  ! 1,X1

     1643    14174    3               CALL CONCAT( LINEBUF, 'RR:Yes');

  14174 10 005500   040000 100400                    MLR     fill='040'O
        10 005501   002301 000006 2                  ADSC9   XSERRMSG+212             cn=0,n=6
        10 005502   001525 000377 1                  ADSC9   LINEBUF                  cn=0,n=255

     1644    14175    3               WRITE_DATA.BUF_.BOUND = 5;

  14175 10 005503   004022 236000 1                  LDQ     WRITE_DATA+4
        10 005504   177777 376007                    ANQ     65535,DL
        10 005505   000101 276000 11                 ORQ     65
        10 005506   004022 756000 1                  STQ     WRITE_DATA+4
        10 005507   005655 710000 10                 TRA     s:14207

     1645    14176    3           SELECT( 3000);  /* FROM */

     1646    14177    4               IF FROM.LEN = 0 THEN DO;

  14177 10 005510   200316 236100                    LDQ     FROM,,AUTO
        10 005511   777000 316003                    CANQ    -512,DU
        10 005512   005520 601000 10                 TNZ     s:14181

     1647    14178    4                   FROM.LEN = MAIL.LEN;

  14178 10 005513   200116 236100                    LDQ     MAIL,,AUTO
        10 005514   200316 552140                    STBQ    FROM,'40'O,AUTO

     1648    14179    4                   FROM.TXT = MAIL.TXT;

  14179 10 005515   040100 100500                    MLR     fill='040'O
        10 005516   200116 200377                    ADSC9   MAIL,,AUTO               cn=1,n=255
        10 005517   200316 200377                    ADSC9   FROM,,AUTO               cn=1,n=255

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:277  
     1649    14180    4                   END;

     1650    14181    3               CALL DEL_TABS( FROM);

  14181 10 005520   200316 631500                    EPPR1   FROM,,AUTO
        10 005521   221647 451500                    STP1    ERR+2,,AUTO
        10 005522   005671 701000 10                 TSX1    DEL_TABS
        10 005523   000000 011000                    NOP     0

     1651    14182    3               CALL PARSE_FROM ALTRET( OOPS);

  14182 10 005524   006000 701000 10                 TSX1    PARSE_FROM
        10 005525   005665 702000 10                 TSX2    OOPS

     1652    14183    3               TITLE.TXT = 'From: ';

  14183 10 005526   040100 100400                    MLR     fill='040'O
        10 005527   002303 000006 2                  ADSC9   XSERRMSG+214             cn=0,n=6
        10 005530   221545 200377                    ADSC9   TITLE,,AUTO              cn=1,n=255

     1653    14184    3               TITLE.LEN = 6;

  14184 10 005531   006000 236003                    LDQ     3072,DU
        10 005532   221545 552140                    STBQ    TITLE,'40'O,AUTO

     1654    14185    3               CALL CONCAT( LINEBUF, SUBSTR( TITLE.TXT, 0, TITLE.LEN));

  14185 10 005533   221545 236100                    LDQ     TITLE,,AUTO
        10 005534   000033 772000                    QRL     27
        10 005535   000000 620006                    EAX0    0,QL
        10 005536   040000 100540                    MLR     fill='040'O
        10 005537   221545 200010                    ADSC9   TITLE,,AUTO              cn=1,n=*X0
        10 005540   001525 000377 1                  ADSC9   LINEBUF                  cn=0,n=255

     1655    14186    3               CALL INSERT( LINEBUF, TITLE.LEN, , SUBSTR( FTEXT.TXT, 0, FTEXT.LEN));

  14186 10 005541   201416 236100                    LDQ     FTEXT,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:278  
        10 005542   000033 772000                    QRL     27
        10 005543   000000 620006                    EAX0    0,QL
        10 005544   221545 236100                    LDQ     TITLE,,AUTO
        10 005545   000033 772000                    QRL     27
        10 005546   777400 621006                    EAX1    -256,QL
        10 005547   777777 661003                    ERX1    -1,DU
        10 005550   040046 100540                    MLR     fill='040'O
        10 005551   201416 200010                    ADSC9   FTEXT,,AUTO              cn=1,n=*X0
        10 005552   001525 000011 1                  ADSC9   LINEBUF,Q                cn=0,n=*X1

     1656    14187    3               WRITE_DATA.BUF_.BOUND = TITLE.LEN + FTEXT.LEN - 1;

  14187 10 005553   201416 236100                    LDQ     FTEXT,,AUTO
        10 005554   000033 772000                    QRL     27
        10 005555   222250 756100                    STQ     TVAL+1,,AUTO
        10 005556   221545 236100                    LDQ     TITLE,,AUTO
        10 005557   000033 772000                    QRL     27
        10 005560   222250 036100                    ADLQ    TVAL+1,,AUTO
        10 005561   000001 136007                    SBLQ    1,DL
        10 005562   000020 736000                    QLS     16
        10 005563   004022 676000 1                  ERQ     WRITE_DATA+4
        10 005564   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 005565   004022 656000 1                  ERSQ    WRITE_DATA+4
        10 005566   005655 710000 10                 TRA     s:14207

     1657    14188    3           SELECT( 3200);  /* REPL */

     1658    14189    4               IF REPL.LEN = 0 THEN DO;

  14189 10 005567   200416 236100                    LDQ     REPL,,AUTO
        10 005570   777000 316003                    CANQ    -512,DU
        10 005571   005607 601000 10                 TNZ     s:14199

     1659    14190    5                   IF FROM.LEN > 0 THEN DO;

  14190 10 005572   200316 236100                    LDQ     FROM,,AUTO
        10 005573   777000 316003                    CANQ    -512,DU
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:279  
        10 005574   005602 600000 10                 TZE     s:14195

     1660    14191    5                       REPL.LEN = FROM.LEN;

  14191 10 005575   200416 552140                    STBQ    REPL,'40'O,AUTO

     1661    14192    5                       REPL.TXT = FROM.TXT;

  14192 10 005576   040100 100500                    MLR     fill='040'O
        10 005577   200316 200377                    ADSC9   FROM,,AUTO               cn=1,n=255
        10 005600   200416 200377                    ADSC9   REPL,,AUTO               cn=1,n=255

     1662    14193    5                       END;

  14193 10 005601   005607 710000 10                 TRA     s:14199

     1663    14194    5                   ELSE DO;

     1664    14195    5                       REPL.LEN = MAIL.LEN;

  14195 10 005602   200116 236100                    LDQ     MAIL,,AUTO
        10 005603   200416 552140                    STBQ    REPL,'40'O,AUTO

     1665    14196    5                       REPL.TXT = MAIL.TXT;

  14196 10 005604   040100 100500                    MLR     fill='040'O
        10 005605   200116 200377                    ADSC9   MAIL,,AUTO               cn=1,n=255
        10 005606   200416 200377                    ADSC9   REPL,,AUTO               cn=1,n=255

     1666    14197    5                       END;

     1667    14198    4                   END;

     1668    14199    3               CALL DEL_TABS( REPL);

  14199 10 005607   200416 631500                    EPPR1   REPL,,AUTO
        10 005610   221647 451500                    STP1    ERR+2,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:280  
        10 005611   005671 701000 10                 TSX1    DEL_TABS
        10 005612   000000 011000                    NOP     0

     1669    14200    3               CALL PARSE_REPLYTO ALTRET( OOPS);

  14200 10 005613   006025 701000 10                 TSX1    PARSE_REPLYTO
        10 005614   005665 702000 10                 TSX2    OOPS

     1670    14201    3               TITLE.TXT = 'Reply To: ';

  14201 10 005615   040100 100400                    MLR     fill='040'O
        10 005616   002305 000012 2                  ADSC9   XSERRMSG+216             cn=0,n=10
        10 005617   221545 200377                    ADSC9   TITLE,,AUTO              cn=1,n=255

     1671    14202    3               TITLE.LEN = 10;

  14202 10 005620   012000 236003                    LDQ     5120,DU
        10 005621   221545 552140                    STBQ    TITLE,'40'O,AUTO

     1672    14203    3               CALL CONCAT( LINEBUF, SUBSTR( TITLE.TXT, 0, TITLE.LEN));

  14203 10 005622   221545 236100                    LDQ     TITLE,,AUTO
        10 005623   000033 772000                    QRL     27
        10 005624   000000 620006                    EAX0    0,QL
        10 005625   040000 100540                    MLR     fill='040'O
        10 005626   221545 200010                    ADSC9   TITLE,,AUTO              cn=1,n=*X0
        10 005627   001525 000377 1                  ADSC9   LINEBUF                  cn=0,n=255

     1673    14204    3               CALL INSERT( LINEBUF, TITLE.LEN, , SUBSTR( RTEXT.TXT, 0, RTEXT.LEN));

  14204 10 005630   201516 236100                    LDQ     RTEXT,,AUTO
        10 005631   000033 772000                    QRL     27
        10 005632   000000 620006                    EAX0    0,QL
        10 005633   221545 236100                    LDQ     TITLE,,AUTO
        10 005634   000033 772000                    QRL     27
        10 005635   777400 621006                    EAX1    -256,QL
        10 005636   777777 661003                    ERX1    -1,DU
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:281  
        10 005637   040046 100540                    MLR     fill='040'O
        10 005640   201516 200010                    ADSC9   RTEXT,,AUTO              cn=1,n=*X0
        10 005641   001525 000011 1                  ADSC9   LINEBUF,Q                cn=0,n=*X1

     1674    14205    3               WRITE_DATA.BUF_.BOUND = TITLE.LEN + RTEXT.LEN - 1;

  14205 10 005642   201516 236100                    LDQ     RTEXT,,AUTO
        10 005643   000033 772000                    QRL     27
        10 005644   222250 756100                    STQ     TVAL+1,,AUTO
        10 005645   221545 236100                    LDQ     TITLE,,AUTO
        10 005646   000033 772000                    QRL     27
        10 005647   222250 036100                    ADLQ    TVAL+1,,AUTO
        10 005650   000001 136007                    SBLQ    1,DL
        10 005651   000020 736000                    QLS     16
        10 005652   004022 676000 1                  ERQ     WRITE_DATA+4
        10 005653   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 005654   004022 656000 1                  ERSQ    WRITE_DATA+4

     1675    14206    3           END;

     1676    14207    2       DATA_KEY.KEY = KEYVAL;

  14207 10 005655   221544 470500                    LDP0    @KEYVAL,,AUTO
        10 005656   000000 236100                    LDQ     0,,PR0
        10 005657   003430 552034 1                  STBQ    DATA_KEY,'34'O

     1677    14208    2       CALL M$WRITE( WRITE_DATA)

  14208 10 005660   004016 630400 1                  EPPR0   WRITE_DATA
        10 005661   440001 713400                    CLIMB   alt,write
        10 005662   401400 401760                    pmme    nvectors=4
        10 005663   005665 702000 10                 TSX2    OOPS
        10 005664   005667 710000 10                 TRA     s:14213

     1678    14209    3       WHENALTRETURN DO;

     1679    14210    3   OOPS:
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:282  
     1680    14211    3           ALTRETURN;

  14211 10 005665   221542 221300       OOPS         LDX1  ! BLANK_LINE_READ,,AUTO
        10 005666   000000 702211                    TSX2  ! 0,X1

     1681    14212    3           END;
     1682    14213    2       RETURN;

  14213 10 005667   221542 221300                    LDX1  ! BLANK_LINE_READ,,AUTO
        10 005670   000001 702211                    TSX2  ! 1,X1

     1683    14214
     1684    14215    2   DEL_TABS: PROC( QTEXT);

  14215 10 005671   221646 741300       DEL_TABS     STX1  ! ERR+1,,AUTO

     1685    14216
     1686    14217            %BUFFER( NAME=QTEXT, STCLASS=);
     1687    14222    3       DCL INDX SBIN;
     1688    14223    3       DCL LAST SBIN;
     1689    14224
     1690    14225    3       CALL INDEX( INDX, BITASC( '011'O), QTEXT.TXT);

  14225 10 005672   221647 470500                    LDP0    @QTEXT,,AUTO
        10 005673   000000 124500                    SCM     mask='000'O
        10 005674   000000 200377                    ADSC9   0,,PR0                   cn=1,n=255
        10 005675   000102 000001 11                 ADSC9   66                       cn=0,n=1
        10 005676   221650 000100                    ARG     INDX,,AUTO

     1691    14226    4       DO WHILE( INDX < QTEXT.LEN);

  14226 10 005677   000100 101500                    MRL     fill='000'O
        10 005700   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 005701   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 005702   222250 236100                    LDQ     TVAL+1,,AUTO
        10 005703   221650 116100                    CMPQ    INDX,,AUTO
        10 005704   005724 604400 10                 TMOZ    s:14231
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:283  

     1692    14227    4           SUBSTR( QTEXT.TXT, INDX, 1) = ' ';

  14227 10 005705   221647 470500                    LDP0    @QTEXT,,AUTO
        10 005706   221650 235100                    LDA     INDX,,AUTO
        10 005707   040105 100400                    MLR     fill='040'O
        10 005710   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 005711   000000 200001                    ADSC9   0,A,PR0                  cn=1,n=1

     1693    14228    4           CALL INDEX( INDX, BITASC( '011'O), QTEXT.TXT);

  14228 10 005712   000000 124500                    SCM     mask='000'O
        10 005713   000000 200377                    ADSC9   0,,PR0                   cn=1,n=255
        10 005714   000102 000001 11                 ADSC9   66                       cn=0,n=1
        10 005715   221650 000100                    ARG     INDX,,AUTO

     1694    14229    4           END;

  14229 10 005716   000100 101500                    MRL     fill='000'O
        10 005717   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 005720   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 005721   222250 236100                    LDQ     TVAL+1,,AUTO
        10 005722   221650 116100                    CMPQ    INDX,,AUTO
        10 005723   005705 605400 10                 TPNZ    s:14227

     1695    14230            /* change embedded dquotes to query symbols */
     1696    14231    3       LAST = -1;

  14231 10 005724   000001 335007                    LCA     1,DL
        10 005725   221651 755100                    STA     LAST,,AUTO

     1697    14232    3       CALL INDEX( INDX, '"', QTEXT.TXT);

  14232 10 005726   000000 124500                    SCM     mask='000'O
        10 005727   000000 200377                    ADSC9   0,,PR0                   cn=1,n=255
        10 005730   000005 000001 11                 ADSC9   5                        cn=0,n=1
        10 005731   221650 000100                    ARG     INDX,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:284  

     1698    14233    4       DO WHILE( INDX < QTEXT.LEN);

  14233 10 005732   000100 101500                    MRL     fill='000'O
        10 005733   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 005734   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 005735   222250 236100                    LDQ     TVAL+1,,AUTO
        10 005736   221650 116100                    CMPQ    INDX,,AUTO
        10 005737   005771 604400 10                 TMOZ    s:14239

     1699    14234    4           IF LAST > -1 THEN

  14234 10 005740   221651 235100                    LDA     LAST,,AUTO
        10 005741   005747 604000 10                 TMI     s:14236

     1700    14235    4               SUBSTR( QTEXT.TXT, INDX, 1) = '?';

  14235 10 005742   221647 470500                    LDP0    @QTEXT,,AUTO
        10 005743   221650 236100                    LDQ     INDX,,AUTO
        10 005744   040106 100400                    MLR     fill='040'O
        10 005745   000103 000001 11                 ADSC9   67                       cn=0,n=1
        10 005746   000000 200001                    ADSC9   0,Q,PR0                  cn=1,n=1

     1701    14236    4           LAST = INDX;

  14236 10 005747   221650 236100                    LDQ     INDX,,AUTO
        10 005750   221651 756100                    STQ     LAST,,AUTO

     1702    14237    4           CALL INDEX( INDX, '"', QTEXT.TXT, INDX+1);

  14237 10 005751   777401 620006                    EAX0    -255,QL
        10 005752   777777 660003                    ERX0    -1,DU
        10 005753   000001 036007                    ADLQ    1,DL
        10 005754   221647 470500                    LDP0    @QTEXT,,AUTO
        10 005755   221650 235100                    LDA     INDX,,AUTO
        10 005756   000000 124545                    SCM     mask='000'O
        10 005757   000000 400010                    ADSC9   0,A,PR0                  cn=2,n=*X0
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:285  
        10 005760   000005 000001 11                 ADSC9   5                        cn=0,n=1
        10 005761   221650 000100                    ARG     INDX,,AUTO
        10 005762   221650 056100                    ASQ     INDX,,AUTO

     1703    14238    4           END;

  14238 10 005763   000100 101500                    MRL     fill='000'O
        10 005764   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 005765   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 005766   222250 236100                    LDQ     TVAL+1,,AUTO
        10 005767   221650 116100                    CMPQ    INDX,,AUTO
        10 005770   005740 605400 10                 TPNZ    s:14234

     1704    14239    3       IF LAST > -1 THEN

  14239 10 005771   221651 235100                    LDA     LAST,,AUTO
        10 005772   005776 604000 10                 TMI     s:14241

     1705    14240    3           SUBSTR( QTEXT.TXT, LAST, 1) = '"';  /* restore last dquote */

  14240 10 005773   040105 100400                    MLR     fill='040'O
        10 005774   000005 000001 11                 ADSC9   5                        cn=0,n=1
        10 005775   000000 200001                    ADSC9   0,A,PR0                  cn=1,n=1

     1706    14241    3       RETURN;

  14241 10 005776   221646 221300                    LDX1  ! ERR+1,,AUTO
        10 005777   000001 702211                    TSX2  ! 1,X1

     1707    14242
     1708    14243    3       END DEL_TABS;
     1709    14244
     1710    14245    2       END WRITE_HEADER;
     1711    14246        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:286  
     1712    14247    1   PARSE_FROM: PROC ALTRET;

  14247 10 006000   221646 741300       PARSE_FROM   STX1  ! ERR+1,,AUTO

     1713    14248
     1714    14249    2       DCL TEMP SBIN;
     1715    14250    2       DCL I SBIN;
     1716    14251    2       DCL BASE SBIN;
     1717    14252    2       DCL BINGO SBIN;
     1718    14253    2       DCL ENTRYFLAG BIT(1);
     1719    14254        %EQU FROM = %NO#;
     1720    14255        %EQU REPLYTO = %YES#;
     1721    14256    2       DCL PARSEFLAG BIT(1);
     1722    14257        %EQU LEADING = %NO#;
     1723    14258        %EQU TRAILING = %YES#;
     1724    14259
     1725    14260    2       ENTRYFLAG = %FROM;

  14260 10 006001   221653 450100                    STZ     ENTRYFLAG,,AUTO

     1726    14261    2       TEMP = FROM.LEN;

  14261 10 006002   200316 236100                    LDQ     FROM,,AUTO
        10 006003   000033 772000                    QRL     27
        10 006004   221647 756100                    STQ     TEMP,,AUTO

     1727    14262    2       CALL XUR$GETCMD( TCM_TEXT_ROOT, CMD$, , FROM.TXT, TEMP) ALTRET( OOPS);

  14262 10 006005   221647 630500                    EPPR0   TEMP,,AUTO
        10 006006   222254 450500                    STP0    TVAL+5,,AUTO
        10 006007   222255 452500                    STP2    TVAL+6,,AUTO
        10 006010   222255 236100                    LDQ     TVAL+6,,AUTO
        10 006011   000104 036000 11                 ADLQ    68
        10 006012   000001 235000 xsym               LDA     B_VECTNIL+1
        10 006013   222252 757100                    STAQ    TVAL+3,,AUTO
        10 006014   200004 631500                    EPPR1   CMD$,,AUTO
        10 006015   222251 451500                    STP1    TVAL+2,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:287  
        10 006016   000105 236000 11                 LDQ     69
        10 006017   222250 756100                    STQ     TVAL+1,,AUTO
        10 006020   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 006021   000023 631400 xsym               EPPR1   B_VECTNIL+19
        10 006022   000000 701000 xent               TSX1    XUR$GETCMD
        10 006023   006567 702000 10                 TSX2    OOPS

     1728    14263    2       GOTO COMMON;

  14263 10 006024   006052 710000 10                 TRA     COMMON

     1729    14264
     1730    14265    2   PARSE_REPLYTO: ENTRY ALTRET;

  14265 10 006025   221646 741300       PARSE_REPLY* STX1  ! ERR+1,,AUTO

     1731    14266
     1732    14267    2       ENTRYFLAG = %REPLYTO;

  14267 10 006026   400000 236003                    LDQ     -131072,DU
        10 006027   221653 756100                    STQ     ENTRYFLAG,,AUTO

     1733    14268    2       TEMP = REPL.LEN;

  14268 10 006030   200416 236100                    LDQ     REPL,,AUTO
        10 006031   000033 772000                    QRL     27
        10 006032   221647 756100                    STQ     TEMP,,AUTO

     1734    14269    2       CALL XUR$GETCMD( TCM_TEXT_ROOT, CMD$, , REPL.TXT, TEMP) ALTRET( OOPS);

  14269 10 006033   221647 630500                    EPPR0   TEMP,,AUTO
        10 006034   222254 450500                    STP0    TVAL+5,,AUTO
        10 006035   222255 452500                    STP2    TVAL+6,,AUTO
        10 006036   222255 236100                    LDQ     TVAL+6,,AUTO
        10 006037   000106 036000 11                 ADLQ    70
        10 006040   000001 235000 xsym               LDA     B_VECTNIL+1
        10 006041   222252 757100                    STAQ    TVAL+3,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:288  
        10 006042   200004 631500                    EPPR1   CMD$,,AUTO
        10 006043   222251 451500                    STP1    TVAL+2,,AUTO
        10 006044   000105 236000 11                 LDQ     69
        10 006045   222250 756100                    STQ     TVAL+1,,AUTO
        10 006046   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 006047   000023 631400 xsym               EPPR1   B_VECTNIL+19
        10 006050   000000 701000 xent               TSX1    XUR$GETCMD
        10 006051   006567 702000 10                 TSX2    OOPS

     1735    14270    2   COMMON:
     1736    14271    3       IF CMD.CODE = %TEXT THEN DO;

  14271 10 006052   200004 470500       COMMON       LDP0    CMD$,,AUTO
        10 006053   000000 720100                    LXL0    0,,PR0
        10 006054   000037 100003                    CMPX0   31,DU
        10 006055   006351 601000 10                 TNZ     s:14334

     1737    14272                /* the text was parsed as a list of words.. sigh.... */
     1738    14273    3           LTEXT.LEN = 0;

  14273 10 006056   000000 236003                    LDQ     0,DU
        10 006057   201216 552140                    STBQ    LTEXT,'40'O,AUTO

     1739    14274    3           TTEXT.LEN = 0;

  14274 10 006060   201316 552140                    STBQ    TTEXT,'40'O,AUTO

     1740    14275    3           LTEXT.TXT = ' ';

  14275 10 006061   040100 100400                    MLR     fill='040'O
        10 006062   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 006063   201216 200377                    ADSC9   LTEXT,,AUTO              cn=1,n=255

     1741    14276    3           TTEXT.TXT = ' ';

  14276 10 006064   040100 100400                    MLR     fill='040'O
        10 006065   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:289  
        10 006066   201316 200377                    ADSC9   TTEXT,,AUTO              cn=1,n=255

     1742    14277    3           PARSEFLAG = %LEADING;

  14277 10 006067   221654 450100                    STZ     PARSEFLAG,,AUTO

     1743    14278    3           BINGO = -1;

  14278 10 006070   000001 335007                    LCA     1,DL
        10 006071   221652 755100                    STA     BINGO,,AUTO

     1744    14279    3           BASE = -1;

  14279 10 006072   221651 755100                    STA     BASE,,AUTO

     1745    14280    4           DO I = 0 TO CMD.NSUBLKS - 1;

  14280 10 006073   221650 450100                    STZ     I,,AUTO
        10 006074   006230 710000 10                 TRA     NEXT+1

     1746    14281    4               SYM$ = CMD.SUBLK$( I);

  14281 10 006075   200004 470500                    LDP0    CMD$,,AUTO
        10 006076   221650 720100                    LXL0    I,,AUTO
        10 006077   000003 236110                    LDQ     3,X0,PR0
        10 006100   200005 756100                    STQ     OUT$,,AUTO

     1747    14282    5               IF PARSEFLAG = %LEADING THEN DO;

  14282 10 006101   221654 234100                    SZN     PARSEFLAG,,AUTO
        10 006102   006173 604000 10                 TMI     s:14299

     1748    14283    5                   CALL INDEX( TEMP, '@', SYM.TEXT)

  14283 10 006103   200005 471500                    LDP1    OUT$,,AUTO
        10 006104   100004 236100                    LDQ     4,,PR1
        10 006105   000033 772000                    QRL     27
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:290  
        10 006106   000000 621006                    EAX1    0,QL
        10 006107   000000 124540                    SCM     mask='000'O
        10 006110   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        10 006111   000107 000001 11                 ADSC9   71                       cn=0,n=1
        10 006112   221647 000100                    ARG     TEMP,,AUTO
        10 006113   006115 606400 10                 TTN     s:14285
        10 006114   006164 710000 10                 TRA     s:14294

     1749    14284    6                   WHENALTRETURN DO;

     1750    14285    6                       CALL INDEX( TEMP, '!', SYM.TEXT)

  14285 10 006115   200005 470500                    LDP0    OUT$,,AUTO
        10 006116   000004 236100                    LDQ     4,,PR0
        10 006117   000033 772000                    QRL     27
        10 006120   000000 620006                    EAX0    0,QL
        10 006121   000000 124540                    SCM     mask='000'O
        10 006122   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
        10 006123   000110 000001 11                 ADSC9   72                       cn=0,n=1
        10 006124   221647 000100                    ARG     TEMP,,AUTO
        10 006125   006127 606400 10                 TTN     s:14287
        10 006126   006164 710000 10                 TRA     s:14294

     1751    14286    7                       WHENALTRETURN DO;

     1752    14287    7                           IF BASE = -1 THEN

  14287 10 006127   221651 235100                    LDA     BASE,,AUTO
        10 006130   000027 115000 xsym               CMPA    B_VECTNIL+23
        10 006131   006135 601000 10                 TNZ     s:14289

     1753    14288    7                               BASE = SYM.CPOS;

  14288 10 006132   200005 470500                    LDP0    OUT$,,AUTO
        10 006133   000002 235100                    LDA     2,,PR0
        10 006134   221651 755100                    STA     BASE,,AUTO

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:291  
     1754    14289    7                          CALL INSERT( LTEXT.TXT, SYM.CPOS - BASE, SYM.COUNT, SYM.TEXT
             14289                                    );

  14289 10 006135   200005 470500                    LDP0    OUT$,,AUTO
        10 006136   000002 236100                    LDQ     2,,PR0
        10 006137   221651 136100                    SBLQ    BASE,,AUTO
        10 006140   222250 756100                    STQ     TVAL+1,,AUTO
        10 006141   000004 236100                    LDQ     4,,PR0
        10 006142   000033 772000                    QRL     27
        10 006143   000000 620006                    EAX0    0,QL
        10 006144   000000 621006                    EAX1    0,QL
        10 006145   222250 236100                    LDQ     TVAL+1,,AUTO
        10 006146   040146 100540                    MLR     fill='040'O
        10 006147   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
        10 006150   201216 200011                    ADSC9   LTEXT,Q,AUTO             cn=1,n=*X1

     1755    14290    7                           LTEXT.LEN = SYM.CPOS - BASE + SYM.COUNT;

  14290 10 006151   000002 236100                    LDQ     2,,PR0
        10 006152   221651 136100                    SBLQ    BASE,,AUTO
        10 006153   222250 756100                    STQ     TVAL+1,,AUTO
        10 006154   000004 236100                    LDQ     4,,PR0
        10 006155   000033 772000                    QRL     27
        10 006156   222251 756100                    STQ     TVAL+2,,AUTO
        10 006157   222250 236100                    LDQ     TVAL+1,,AUTO
        10 006160   222251 036100                    ADLQ    TVAL+2,,AUTO
        10 006161   000033 736000                    QLS     27
        10 006162   201216 552140                    STBQ    LTEXT,'40'O,AUTO

     1756    14291    7                           GOTO NEXT;

  14291 10 006163   006227 710000 10                 TRA     NEXT

     1757    14292    7                           END;
     1758    14293    6                       END;

     1759    14294    5                   BINGO = I;  /* this SUBLK is holding an address */
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:292  

  14294 10 006164   221650 235100                    LDA     I,,AUTO
        10 006165   221652 755100                    STA     BINGO,,AUTO

     1760    14295    5                   PARSEFLAG = %TRAILING;

  14295 10 006166   400000 236003                    LDQ     -131072,DU
        10 006167   221654 756100                    STQ     PARSEFLAG,,AUTO

     1761    14296    5                   BASE = -1;

  14296 10 006170   000001 335007                    LCA     1,DL
        10 006171   221651 755100                    STA     BASE,,AUTO

     1762    14297    5                   END;

  14297 10 006172   006227 710000 10                 TRA     NEXT

     1763    14298    5               ELSE DO;

     1764    14299    5                   IF BASE = -1 THEN

  14299 10 006173   221651 235100                    LDA     BASE,,AUTO
        10 006174   000027 115000 xsym               CMPA    B_VECTNIL+23
        10 006175   006201 601000 10                 TNZ     s:14301

     1765    14300    5                       BASE = SYM.CPOS;

  14300 10 006176   200005 471500                    LDP1    OUT$,,AUTO
        10 006177   100002 235100                    LDA     2,,PR1
        10 006200   221651 755100                    STA     BASE,,AUTO

     1766    14301    5                   CALL INSERT( TTEXT.TXT, SYM.CPOS - BASE, SYM.COUNT, SYM.TEXT);

  14301 10 006201   200005 471500                    LDP1    OUT$,,AUTO
        10 006202   100002 236100                    LDQ     2,,PR1
        10 006203   221651 136100                    SBLQ    BASE,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:293  
        10 006204   222250 756100                    STQ     TVAL+1,,AUTO
        10 006205   100004 236100                    LDQ     4,,PR1
        10 006206   000033 772000                    QRL     27
        10 006207   000000 621006                    EAX1    0,QL
        10 006210   000000 622006                    EAX2    0,QL
        10 006211   222250 236100                    LDQ     TVAL+1,,AUTO
        10 006212   040146 100540                    MLR     fill='040'O
        10 006213   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        10 006214   201316 200012                    ADSC9   TTEXT,Q,AUTO             cn=1,n=*X2

     1767    14302    5                   TTEXT.LEN = SYM.CPOS - BASE + SYM.COUNT;

  14302 10 006215   100002 236100                    LDQ     2,,PR1
        10 006216   221651 136100                    SBLQ    BASE,,AUTO
        10 006217   222250 756100                    STQ     TVAL+1,,AUTO
        10 006220   100004 236100                    LDQ     4,,PR1
        10 006221   000033 772000                    QRL     27
        10 006222   222251 756100                    STQ     TVAL+2,,AUTO
        10 006223   222250 236100                    LDQ     TVAL+1,,AUTO
        10 006224   222251 036100                    ADLQ    TVAL+2,,AUTO
        10 006225   000033 736000                    QLS     27
        10 006226   201316 552140                    STBQ    TTEXT,'40'O,AUTO

     1768    14303    5                   END;

     1769    14304    4   NEXT:
     1770    14305    4               END;

  14305 10 006227   221650 054100       NEXT         AOS     I,,AUTO
        10 006230   200004 470500                    LDP0    CMD$,,AUTO
        10 006231   000001 236100                    LDQ     1,,PR0
        10 006232   000022 772000                    QRL     18
        10 006233   221650 116100                    CMPQ    I,,AUTO
        10 006234   006075 605400 10                 TPNZ    s:14281

     1771    14306    3           IF ENTRYFLAG = %FROM OR

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:294  
  14306 10 006235   221653 234100                    SZN     ENTRYFLAG,,AUTO
        10 006236   006243 605000 10                 TPL     s:14309
        10 006237   006307 605000 10                 TPL     s:14324
        10 006240   221652 235100                    LDA     BINGO,,AUTO
        10 006241   000027 115000 xsym               CMPA    B_VECTNIL+23
        10 006242   006307 601000 10                 TNZ     s:14324

     1772    14307    4                   ( ENTRYFLAG = %REPLYTO AND BINGO = -1) THEN DO;

     1773    14308                    /* use trailing or leading human readable text if present */
     1774    14309    5               IF TTEXT.LEN ~= 0 THEN DO;

  14309 10 006243   201316 236100                    LDQ     TTEXT,,AUTO
        10 006244   777000 316003                    CANQ    -512,DU
        10 006245   006265 600000 10                 TZE     s:14316

     1775    14310    5                   CALL TRIMTEXT( TTEXT, FTEXT);

  14310 10 006246   201416 631500                    EPPR1   FTEXT,,AUTO
        10 006247   221660 451500                    STP1    @SOURCE+1,,AUTO
        10 006250   201316 633500                    EPPR3   TTEXT,,AUTO
        10 006251   221657 453500                    STP3    PARSEFLAG+3,,AUTO
        10 006252   007404 701000 10                 TSX1    TRIMTEXT
        10 006253   000000 011000                    NOP     0

     1776    14311    6                   IF FTEXT.LEN ~= 0 THEN DO;

  14311 10 006254   201416 236100                    LDQ     FTEXT,,AUTO
        10 006255   777000 316003                    CANQ    -512,DU
        10 006256   006265 600000 10                 TZE     s:14316

     1777    14312    6                       CALL LEGALIZE( FTEXT);

  14312 10 006257   201416 630500                    EPPR0   FTEXT,,AUTO
        10 006260   221657 450500                    STP0    PARSEFLAG+3,,AUTO
        10 006261   006571 701000 10                 TSX1    LEGALIZE
        10 006262   000000 011000                    NOP     0
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:295  

     1778    14313    6                       RETURN;

  14313 10 006263   221646 221300                    LDX1  ! ERR+1,,AUTO
        10 006264   000001 702211                    TSX2  ! 1,X1

     1779    14314    6                       END;
     1780    14315    5                   END;
     1781    14316    5               IF LTEXT.LEN ~= 0 THEN DO;

  14316 10 006265   201216 236100                    LDQ     LTEXT,,AUTO
        10 006266   777000 316003                    CANQ    -512,DU
        10 006267   006307 600000 10                 TZE     s:14324

     1782    14317    5                   CALL TRIMTEXT( LTEXT, FTEXT);

  14317 10 006270   201416 630500                    EPPR0   FTEXT,,AUTO
        10 006271   221660 450500                    STP0    @SOURCE+1,,AUTO
        10 006272   201216 631500                    EPPR1   LTEXT,,AUTO
        10 006273   221657 451500                    STP1    PARSEFLAG+3,,AUTO
        10 006274   007404 701000 10                 TSX1    TRIMTEXT
        10 006275   000000 011000                    NOP     0

     1783    14318    6                   IF FTEXT.LEN ~= 0 THEN DO;

  14318 10 006276   201416 236100                    LDQ     FTEXT,,AUTO
        10 006277   777000 316003                    CANQ    -512,DU
        10 006300   006307 600000 10                 TZE     s:14324

     1784    14319    6                       CALL LEGALIZE( FTEXT);

  14319 10 006301   201416 630500                    EPPR0   FTEXT,,AUTO
        10 006302   221657 450500                    STP0    PARSEFLAG+3,,AUTO
        10 006303   006571 701000 10                 TSX1    LEGALIZE
        10 006304   000000 011000                    NOP     0

     1785    14320    6                       RETURN;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:296  

  14320 10 006305   221646 221300                    LDX1  ! ERR+1,,AUTO
        10 006306   000001 702211                    TSX2  ! 1,X1

     1786    14321    6                       END;
     1787    14322    5                   END;
     1788    14323    4               END;
     1789    14324    3           IF BINGO = -1 THEN

  14324 10 006307   221652 235100                    LDA     BINGO,,AUTO
        10 006310   000027 115000 xsym               CMPA    B_VECTNIL+23
        10 006311   006567 600000 10                 TZE     OOPS

     1790    14325    3               GOTO OOPS;  /* couldn't find any text to use */
     1791    14326    3           SYM$ = CMD.SUBLK$( BINGO);

  14326 10 006312   200004 470500                    LDP0    CMD$,,AUTO
        10 006313   000003 236105                    LDQ     3,AL,PR0
        10 006314   200005 756100                    STQ     OUT$,,AUTO

     1792    14327    3           TEMP = SYM.COUNT;

  14327 10 006315   200005 471500                    LDP1    OUT$,,AUTO
        10 006316   100004 236100                    LDQ     4,,PR1
        10 006317   000033 772000                    QRL     27
        10 006320   221647 756100                    STQ     TEMP,,AUTO

     1793    14328    3           CALL INSERT( ZTEXT.TXT, 0, TEMP, SYM.TEXT);

  14328 10 006321   100004 236100                    LDQ     4,,PR1
        10 006322   000033 772000                    QRL     27
        10 006323   000000 620006                    EAX0    0,QL
        10 006324   221647 721100                    LXL1    TEMP,,AUTO
        10 006325   040140 100540                    MLR     fill='040'O
        10 006326   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        10 006327   201616 200011                    ADSC9   ZTEXT,,AUTO              cn=1,n=*X1

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:297  
     1794    14329    3           ZTEXT.LEN = TEMP;

  14329 10 006330   221647 236100                    LDQ     TEMP,,AUTO
        10 006331   000033 736000                    QLS     27
        10 006332   201616 552140                    STBQ    ZTEXT,'40'O,AUTO

     1795    14330    3           CALL XUR$GETCMD( TCM_ADDR_ROOT, CMD$, , SYM.TEXT, TEMP) ALTRET( OOPS);

  14330 10 006333   221647 633500                    EPPR3   TEMP,,AUTO
        10 006334   222254 453500                    STP3    TVAL+5,,AUTO
        10 006335   200005 236100                    LDQ     OUT$,,AUTO
        10 006336   000111 036000 11                 ADLQ    73
        10 006337   000001 235000 xsym               LDA     B_VECTNIL+1
        10 006340   222252 757100                    STAQ    TVAL+3,,AUTO
        10 006341   200004 634500                    EPPR4   CMD$,,AUTO
        10 006342   222251 454500                    STP4    TVAL+2,,AUTO
        10 006343   000112 236000 11                 LDQ     74
        10 006344   222250 756100                    STQ     TVAL+1,,AUTO
        10 006345   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 006346   000023 631400 xsym               EPPR1   B_VECTNIL+19
        10 006347   000000 701000 xent               TSX1    XUR$GETCMD
        10 006350   006567 702000 10                 TSX2    OOPS

     1796    14331    3           END;

     1797    14332            /* at this point we have a parse tree for the address */
     1798    14333            /* now traverse the tree as appropriate to what we're looking for */
     1799    14334    2       OUT$ = CMD.SUBLK$(0);

  14334 10 006351   200004 470500                    LDP0    CMD$,,AUTO
        10 006352   000003 236100                    LDQ     3,,PR0
        10 006353   200005 756100                    STQ     OUT$,,AUTO

     1800    14335    2       IF ENTRYFLAG = %REPLYTO THEN

  14335 10 006354   221653 234100                    SZN     ENTRYFLAG,,AUTO
        10 006355   006427 604000 10                 TMI     TRAVERSE_REPLYTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:298  

     1801    14336    2           GOTO TRAVERSE_REPLYTO;
     1802    14337    2   TRAVERSE_FROM:
     1803    14338    3       DO CASE( OUT.CODE);

  14338 10 006356   200005 470500       TRAVERSE_FR* LDP0    OUT$,,AUTO
        10 006357   000000 236100                    LDQ     0,,PR0
        10 006360   777777 376007                    ANQ     -1,DL
        10 006361   000041 136007                    SBLQ    33,DL
        10 006362   000012 116007                    CMPQ    10,DL
        10 006363   006365 602006 10                 TNC     TRAVERSE_FROM+7,QL
        10 006364   006425 710000 10                 TRA     s:14350
        10 006365   006377 710000 10                 TRA     s:14340
        10 006366   006377 710000 10                 TRA     s:14340
        10 006367   006402 710000 10                 TRA     s:14342
        10 006370   006425 710000 10                 TRA     s:14350
        10 006371   006425 710000 10                 TRA     s:14350
        10 006372   006377 710000 10                 TRA     s:14340
        10 006373   006377 710000 10                 TRA     s:14340
        10 006374   006402 710000 10                 TRA     s:14342
        10 006375   006377 710000 10                 TRA     s:14340
        10 006376   006406 710000 10                 TRA     s:14345

     1804    14339    3           CASE( %ADDRESS, %BPATH, %MAILBOX, %LOCAL, %DOMAIN);

     1805    14340    3               OUT$ = OUT.SUBLK$(0);  /* take the left-most arc */

  14340 10 006377   000003 236100                    LDQ     3,,PR0
        10 006400   200005 756100                    STQ     OUT$,,AUTO
        10 006401   006426 710000 10                 TRA     s:14352

     1806    14341    3           CASE( %PATH, %ROUTE);

     1807    14342    3               OUT$ = OUT.SUBLK$( OUT.NSUBLKS - 1);  /* take right-most arc */

  14342 10 006402   000001 220100                    LDX0    1,,PR0
        10 006403   000002 236110                    LDQ     2,X0,PR0
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:299  
        10 006404   200005 756100                    STQ     OUT$,,AUTO
        10 006405   006426 710000 10                 TRA     s:14352

     1808    14343    3           CASE( %NAME);

     1809    14344                    /* finally.. we found it */
     1810    14345    3               CALL INSERT( FTEXT.TXT, 0, SYM.COUNT, SYM.TEXT);

  14345 10 006406   000004 236100                    LDQ     4,,PR0
        10 006407   000033 772000                    QRL     27
        10 006410   000000 620006                    EAX0    0,QL
        10 006411   000000 621006                    EAX1    0,QL
        10 006412   040140 100540                    MLR     fill='040'O
        10 006413   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
        10 006414   201416 200011                    ADSC9   FTEXT,,AUTO              cn=1,n=*X1

     1811    14346    3               FTEXT.LEN = SYM.COUNT;

  14346 10 006415   000004 236100                    LDQ     4,,PR0
        10 006416   201416 552140                    STBQ    FTEXT,'40'O,AUTO

     1812    14347    3               CALL LEGALIZE( FTEXT);

  14347 10 006417   201416 631500                    EPPR1   FTEXT,,AUTO
        10 006420   221657 451500                    STP1    PARSEFLAG+3,,AUTO
        10 006421   006571 701000 10                 TSX1    LEGALIZE
        10 006422   000000 011000                    NOP     0

     1813    14348    3               RETURN;

  14348 10 006423   221646 221300                    LDX1  ! ERR+1,,AUTO
        10 006424   000001 702211                    TSX2  ! 1,X1

     1814    14349    3           CASE( ELSE);

     1815    14350    3               GOTO OOPS;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:300  
  14350 10 006425   006567 710000 10                 TRA     OOPS

     1816    14351    3           END;

     1817    14352    2       GOTO TRAVERSE_FROM;

  14352 10 006426   006356 710000 10                 TRA     TRAVERSE_FROM

     1818    14353    2   TRAVERSE_REPLYTO:
     1819    14354    3       DO CASE( OUT.CODE);

  14354 10 006427   200005 470500       TRAVERSE_RE* LDP0    OUT$,,AUTO
        10 006430   000000 236100                    LDQ     0,,PR0
        10 006431   777777 376007                    ANQ     -1,DL
        10 006432   000041 136007                    SBLQ    33,DL
        10 006433   000010 116007                    CMPQ    8,DL
        10 006434   006436 602006 10                 TNC     TRAVERSE_REPLYTO+7,QL
        10 006435   006565 710000 10                 TRA     s:14388
        10 006436   006446 710000 10                 TRA     s:14356
        10 006437   006446 710000 10                 TRA     s:14356
        10 006440   006451 710000 10                 TRA     s:14358
        10 006441   006565 710000 10                 TRA     s:14388
        10 006442   006565 710000 10                 TRA     s:14388
        10 006443   006455 710000 10                 TRA     s:14361
        10 006444   006565 710000 10                 TRA     s:14388
        10 006445   006455 710000 10                 TRA     s:14361

     1820    14355    3           CASE( %ADDRESS, %BPATH);

     1821    14356    3               OUT$ = OUT.SUBLK$(0);

  14356 10 006446   000003 236100                    LDQ     3,,PR0
        10 006447   200005 756100                    STQ     OUT$,,AUTO
        10 006450   006566 710000 10                 TRA     s:14390

     1822    14357    3           CASE( %PATH);

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:301  
     1823    14358    3               OUT$ = OUT.SUBLK$( OUT.NSUBLKS - 1);

  14358 10 006451   000001 220100                    LDX0    1,,PR0
        10 006452   000002 236110                    LDQ     2,X0,PR0
        10 006453   200005 756100                    STQ     OUT$,,AUTO
        10 006454   006566 710000 10                 TRA     s:14390

     1824    14359    3           CASE( %ROUTE, %MAILBOX);

     1825    14360                    /* stop parse here.. return remaining substring */
     1826    14361    4               IF OUT.CODE = %ROUTE THEN DO;

  14361 10 006455   000000 720100                    LXL0    0,,PR0
        10 006456   000050 100003                    CMPX0   40,DU
        10 006457   006510 601000 10                 TNZ     s:14376

     1827    14362                        /* if ROUTE, have to find left-most limit */
     1828    14363    4                   TMP$ = OUT$;

  14363 10 006460   200005 236100                    LDQ     OUT$,,AUTO
        10 006461   200006 756100                    STQ     TMP$,,AUTO

     1829    14364    5                   DO WHILE( OUT.CODE ~= %NAME);

  14364 10 006462   000000 720100                    LXL0    0,,PR0
        10 006463   000052 100003                    CMPX0   42,DU
        10 006464   006474 600000 10                 TZE     s:14367

     1830    14365    5                       OUT$ = OUT.SUBLK$(0);

  14365 10 006465   200005 470500                    LDP0    OUT$,,AUTO
        10 006466   000003 236100                    LDQ     3,,PR0
        10 006467   200005 756100                    STQ     OUT$,,AUTO

     1831    14366    5                       END;

  14366 10 006470   200005 470500                    LDP0    OUT$,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:302  
        10 006471   000000 720100                    LXL0    0,,PR0
        10 006472   000052 100003                    CMPX0   42,DU
        10 006473   006465 601000 10                 TNZ     s:14365

     1832    14367    5                   IF SYM.COUNT = 0 THEN DO;

  14367 10 006474   000004 236100                    LDQ     4,,PR0
        10 006475   777000 316003                    CANQ    -512,DU
        10 006476   006503 601000 10                 TNZ     s:14372

     1833    14368                            /* gag me with a zero-length name.. */
     1834    14369    5                       RTEXT = ZTEXT;

  14369 10 006477   000100 100500                    MLR     fill='000'O
        10 006500   201616 000400                    ADSC9   ZTEXT,,AUTO              cn=0,n=256
        10 006501   201516 000400                    ADSC9   RTEXT,,AUTO              cn=0,n=256

     1835    14370    5                       GOTO PUNT_REPLYTO;

  14370 10 006502   006553 710000 10                 TRA     PUNT_REPLYTO

     1836    14371    5                       END;
     1837    14372    4                   TEMP = SYM.CPOS;

  14372 10 006503   000002 235100                    LDA     2,,PR0
        10 006504   221647 755100                    STA     TEMP,,AUTO

     1838    14373    4                   OUT$ = TMP$;

  14373 10 006505   200006 236100                    LDQ     TMP$,,AUTO
        10 006506   200005 756100                    STQ     OUT$,,AUTO

     1839    14374    4                   END;

  14374 10 006507   006512 710000 10                 TRA     s:14377

     1840    14375    3               ELSE
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:303  
     1841    14376    3                   TEMP = SYM.CPOS;

  14376 10 006510   000002 235100                    LDA     2,,PR0
        10 006511   221647 755100                    STA     TEMP,,AUTO

     1842    14377    4               DO WHILE( OUT.CODE ~= %NAME);

  14377 10 006512   200005 470500                    LDP0    OUT$,,AUTO
        10 006513   000000 720100                    LXL0    0,,PR0
        10 006514   000052 100003                    CMPX0   42,DU
        10 006515   006526 600000 10                 TZE     s:14380

     1843    14378    4                   OUT$ = OUT.SUBLK$( OUT.NSUBLKS - 1);

  14378 10 006516   200005 470500                    LDP0    OUT$,,AUTO
        10 006517   000001 220100                    LDX0    1,,PR0
        10 006520   000002 236110                    LDQ     2,X0,PR0
        10 006521   200005 756100                    STQ     OUT$,,AUTO

     1844    14379    4                   END;

  14379 10 006522   200005 470500                    LDP0    OUT$,,AUTO
        10 006523   000000 720100                    LXL0    0,,PR0
        10 006524   000052 100003                    CMPX0   42,DU
        10 006525   006516 601000 10                 TNZ     s:14378

     1845    14380    3               CALL INSERT( RTEXT.TXT, 0, SYM.CPOS+SYM.COUNT-TEMP,

  14380 10 006526   000004 236100                    LDQ     4,,PR0
        10 006527   000033 772000                    QRL     27
        10 006530   000002 036100                    ADLQ    2,,PR0
        10 006531   221647 136100                    SBLQ    TEMP,,AUTO
        10 006532   222250 756100                    STQ     TVAL+1,,AUTO
        10 006533   000004 236100                    LDQ     4,,PR0
        10 006534   000033 772000                    QRL     27
        10 006535   000002 036100                    ADLQ    2,,PR0
        10 006536   221647 136100                    SBLQ    TEMP,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:304  
        10 006537   000000 620006                    EAX0    0,QL
        10 006540   221647 235100                    LDA     TEMP,,AUTO
        10 006541   222250 721100                    LXL1    TVAL+1,,AUTO
        10 006542   040140 100545                    MLR     fill='040'O
        10 006543   201616 200010                    ADSC9   ZTEXT,A,AUTO             cn=1,n=*X0
        10 006544   201516 200011                    ADSC9   RTEXT,,AUTO              cn=1,n=*X1

     1846    14381    3                       SUBSTR( ZTEXT.TXT, TEMP, SYM.CPOS+SYM.COUNT-TEMP));
     1847    14382    3               RTEXT.LEN = SYM.CPOS + SYM.COUNT - TEMP;

  14382 10 006545   000004 236100                    LDQ     4,,PR0
        10 006546   000033 772000                    QRL     27
        10 006547   000002 036100                    ADLQ    2,,PR0
        10 006550   221647 136100                    SBLQ    TEMP,,AUTO
        10 006551   000033 736000                    QLS     27
        10 006552   201516 552140                    STBQ    RTEXT,'40'O,AUTO

     1848    14383    3   PUNT_REPLYTO:
     1849    14384    3               CALL CHECKADDR( RTEXT);

  14384 10 006553   201516 631500       PUNT_REPLYTO EPPR1   RTEXT,,AUTO
        10 006554   221657 451500                    STP1    PARSEFLAG+3,,AUTO
        10 006555   007055 701000 10                 TSX1    CHECKADDR
        10 006556   000000 011000                    NOP     0

     1850    14385    3               CALL LEGALIZE( RTEXT);

  14385 10 006557   201516 630500                    EPPR0   RTEXT,,AUTO
        10 006560   221657 450500                    STP0    PARSEFLAG+3,,AUTO
        10 006561   006571 701000 10                 TSX1    LEGALIZE
        10 006562   000000 011000                    NOP     0

     1851    14386    3               RETURN;

  14386 10 006563   221646 221300                    LDX1  ! ERR+1,,AUTO
        10 006564   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:305  
     1852    14387    3           CASE( ELSE);

     1853    14388    3               GOTO OOPS;

  14388 10 006565   006567 710000 10                 TRA     OOPS

     1854    14389    3           END;

     1855    14390    2       GOTO TRAVERSE_REPLYTO;

  14390 10 006566   006427 710000 10                 TRA     TRAVERSE_REPLYTO

     1856    14391    2   OOPS:
     1857    14392    2       ALTRETURN;

  14392 10 006567   221646 221300       OOPS         LDX1  ! ERR+1,,AUTO
        10 006570   000000 702211                    TSX2  ! 0,X1

     1858    14393
     1859    14394    2   LEGALIZE: PROC( QTEXT);

  14394 10 006571   221656 741300       LEGALIZE     STX1  ! PARSEFLAG+2,,AUTO

     1860    14395
     1861    14396            %BUFFER( NAME=QTEXT, STCLASS=);
     1862    14401
     1863    14402            /* turn mapped dquotes back into real dquotes */
     1864    14403    3       CALL INDEX( I, '?', QTEXT.TXT);

  14403 10 006572   221657 470500                    LDP0    @QTEXT,,AUTO
        10 006573   000000 124500                    SCM     mask='000'O
        10 006574   000000 200377                    ADSC9   0,,PR0                   cn=1,n=255
        10 006575   000103 000001 11                 ADSC9   67                       cn=0,n=1
        10 006576   221650 000100                    ARG     I,,AUTO

     1865    14404    4       DO WHILE( I < QTEXT.LEN);

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:306  
  14404 10 006577   000100 101500                    MRL     fill='000'O
        10 006600   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 006601   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 006602   222250 236100                    LDQ     TVAL+1,,AUTO
        10 006603   221650 116100                    CMPQ    I,,AUTO
        10 006604   006624 604400 10                 TMOZ    s:14408

     1866    14405    4           SUBSTR( QTEXT.TXT, I, 1) = '"';

  14405 10 006605   221657 470500                    LDP0    @QTEXT,,AUTO
        10 006606   221650 235100                    LDA     I,,AUTO
        10 006607   040105 100400                    MLR     fill='040'O
        10 006610   000005 000001 11                 ADSC9   5                        cn=0,n=1
        10 006611   000000 200001                    ADSC9   0,A,PR0                  cn=1,n=1

     1867    14406    4           CALL INDEX( I, '?', QTEXT.TXT);

  14406 10 006612   000000 124500                    SCM     mask='000'O
        10 006613   000000 200377                    ADSC9   0,,PR0                   cn=1,n=255
        10 006614   000103 000001 11                 ADSC9   67                       cn=0,n=1
        10 006615   221650 000100                    ARG     I,,AUTO

     1868    14407    4           END;

  14407 10 006616   000100 101500                    MRL     fill='000'O
        10 006617   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 006620   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 006621   222250 236100                    LDQ     TVAL+1,,AUTO
        10 006622   221650 116100                    CMPQ    I,,AUTO
        10 006623   006605 605400 10                 TPNZ    s:14405

     1869    14408    3       IF ENTRYFLAG = %FROM THEN

  14408 10 006624   221653 234100                    SZN     ENTRYFLAG,,AUTO
        10 006625   006644 604000 10                 TMI     s:14414

     1870    14409                /* look for chars illegal in a From: field */
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:307  
     1871    14410    3           CALL SEARCH( I, TEMP, TCM_ILLEGAL_FROM,

  14410 10 006626   000100 101500                    MRL     fill='000'O
        10 006627   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 006630   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 006631   222250 220100                    LDX0    TVAL+1,,AUTO
        10 006632   000000 164540                    TCT
        10 006633   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        10 006634   000320 000000 2                  ARG     TCM_ILLEGAL_FROM
        10 006635   221650 000100                    ARG     I,,AUTO
        10 006636   221650 235100                    LDA     I,,AUTO
        10 006637   000033 771000                    ARL     27
        10 006640   221647 755100                    STA     TEMP,,AUTO
        10 006641   221650 551140                    STBA    I,'40'O,AUTO
        10 006642   007053 606400 10                 TTN     DONE
        10 006643   006661 710000 10                 TRA     s:14417

     1872    14411    3                   SUBSTR( QTEXT.TXT, 0, QTEXT.LEN)) ALTRET( DONE);
     1873    14412    3       ELSE
     1874    14413                /* look for chars illegal in a Reply-To: field */
     1875    14414    3           CALL SEARCH( I, TEMP, TCM_ILLEGAL_REPLYTO,

  14414 10 006644   000100 101500                    MRL     fill='000'O
        10 006645   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 006646   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 006647   222250 220100                    LDX0    TVAL+1,,AUTO
        10 006650   000000 164540                    TCT
        10 006651   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        10 006652   000360 000000 2                  ARG     TCM_ILLEGAL_REPLYTO
        10 006653   221650 000100                    ARG     I,,AUTO
        10 006654   221650 235100                    LDA     I,,AUTO
        10 006655   000033 771000                    ARL     27
        10 006656   221647 755100                    STA     TEMP,,AUTO
        10 006657   221650 551140                    STBA    I,'40'O,AUTO
        10 006660   007053 606400 10                 TTN     DONE

     1876    14415    3                   SUBSTR( QTEXT.TXT, 0, QTEXT.LEN)) ALTRET( DONE);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:308  
     1877    14416            /* an illegal character is present... have to enclose text in squotes */
     1878    14417    3       I = 0;  /* offset into source QTEXT */

  14417 10 006661   221650 450100                    STZ     I,,AUTO

     1879    14418    3       BASE = 1;  /* offset into destination ZTEXT */

  14418 10 006662   000001 236007                    LDQ     1,DL
        10 006663   221651 756100                    STQ     BASE,,AUTO

     1880    14419            /* stash leading squote */
     1881    14420    3       CALL INSERT( ZTEXT.TXT, 0, 1, '''');

  14420 10 006664   000047 236003                    LDQ     39,DU
        10 006665   201616 552120                    STBQ    ZTEXT,'20'O,AUTO

     1882    14421    3   LOOP:
     1883    14422    4       DO WHILE( I < QTEXT.LEN);

  14422 10 006666   000100 101500       LOOP         MRL     fill='000'O
        10 006667   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 006670   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 006671   222250 236100                    LDQ     TVAL+1,,AUTO
        10 006672   221650 116100                    CMPQ    I,,AUTO
        10 006673   007034 604400 10                 TMOZ    s:14465

     1884    14423                /* look for embedded squote */
     1885    14424    4           CALL INDEX( TEMP, '''', SUBSTR( QTEXT.TXT, I, QTEXT.LEN - I))

  14424 10 006674   221657 470500                    LDP0    @QTEXT,,AUTO
        10 006675   000100 101500                    MRL     fill='000'O
        10 006676   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 006677   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 006700   222250 236100                    LDQ     TVAL+1,,AUTO
        10 006701   221650 136100                    SBLQ    I,,AUTO
        10 006702   000000 620006                    EAX0    0,QL
        10 006703   221650 235100                    LDA     I,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:309  
        10 006704   000000 124545                    SCM     mask='000'O
        10 006705   000000 200010                    ADSC9   0,A,PR0                  cn=1,n=*X0
        10 006706   000113 000001 11                 ADSC9   75                       cn=0,n=1
        10 006707   221647 000100                    ARG     TEMP,,AUTO
        10 006710   006712 606400 10                 TTN     s:14429
        10 006711   007004 710000 10                 TRA     s:14456

     1886    14425    5           WHENALTRETURN DO;

     1887    14426                    /* not found, so copy remainder of source */
     1888    14427                    /* but first, look for rightmost @ to stuff squote before it */
     1889    14428                    /* ...but only if no ' ' in the text... */
     1890    14429    5               CALL INDEX( BINGO, ' ', SUBSTR( QTEXT.TXT, I, TEMP))

  14429 10 006712   221657 470500                    LDP0    @QTEXT,,AUTO
        10 006713   221647 720100                    LXL0    TEMP,,AUTO
        10 006714   221650 235100                    LDA     I,,AUTO
        10 006715   000000 124545                    SCM     mask='000'O
        10 006716   000000 200010                    ADSC9   0,A,PR0                  cn=1,n=*X0
        10 006717   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 006720   221652 000100                    ARG     BINGO,,AUTO
        10 006721   006723 606400 10                 TTN     s:14433

     1891    14430    6               WHENRETURN DO;

     1892    14431    6                   GOTO DOIT;

  14431 10 006722   006772 710000 10                 TRA     DOIT

     1893    14432    6                   END;
     1894    14433    5               CALL INDEX1R( BINGO, '@', SUBSTR( QTEXT.TXT, I, TEMP))

  14433 10 006723   221647 236100                    LDQ     TEMP,,AUTO
        10 006724   221657 470500                    LDP0    @QTEXT,,AUTO
        10 006725   221647 720100                    LXL0    TEMP,,AUTO
        10 006726   221650 235100                    LDA     I,,AUTO
        10 006727   000000 125545                    SCMR    mask='000'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:310  
        10 006730   000000 200010                    ADSC9   0,A,PR0                  cn=1,n=*X0
        10 006731   000107 000001 11                 ADSC9   71                       cn=0,n=1
        10 006732   221652 000100                    ARG     BINGO,,AUTO
        10 006733   006772 606400 10                 TTN     DOIT
        10 006734   221652 054100                    AOS     BINGO,,AUTO
        10 006735   221652 156100                    SSQ     BINGO,,AUTO

     1895    14434    6               WHENRETURN DO;

     1896    14435                        /* copy remainder of source up to rightmost @ */
     1897    14436    6                   CALL INSERT( ZTEXT.TXT, BASE, BINGO, SUBSTR( QTEXT.TXT, I, BINGO));

  14436 10 006736   221652 721100                    LXL1    BINGO,,AUTO
        10 006737   221651 236100                    LDQ     BASE,,AUTO
        10 006740   040146 100545                    MLR     fill='040'O
        10 006741   000000 200011                    ADSC9   0,A,PR0                  cn=1,n=*X1
        10 006742   201616 200011                    ADSC9   ZTEXT,Q,AUTO             cn=1,n=*X1

     1898    14437    6                   BASE = BASE + BINGO;

  14437 10 006743   221652 036100                    ADLQ    BINGO,,AUTO
        10 006744   221651 756100                    STQ     BASE,,AUTO

     1899    14438    6                   I = I + BINGO;

  14438 10 006745   221650 236100                    LDQ     I,,AUTO
        10 006746   221652 036100                    ADLQ    BINGO,,AUTO
        10 006747   221650 756100                    STQ     I,,AUTO

     1900    14439                        /* stash trailing squote */
     1901    14440    6                   CALL INSERT( ZTEXT.TXT, BASE, 1, '''');

  14440 10 006750   221651 235100                    LDA     BASE,,AUTO
        10 006751   040105 100400                    MLR     fill='040'O
        10 006752   000113 000001 11                 ADSC9   75                       cn=0,n=1
        10 006753   201616 200001                    ADSC9   ZTEXT,A,AUTO             cn=1,n=1

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:311  
     1902    14441    6                   BASE = BASE + 1;

  14441 10 006754   221651 054100                    AOS     BASE,,AUTO

     1903    14442                        /* copy remainder of source after last @ (including the @) */
     1904    14443    6                   TEMP = TEMP - BINGO;

  14443 10 006755   221647 236100                    LDQ     TEMP,,AUTO
        10 006756   221652 136100                    SBLQ    BINGO,,AUTO
        10 006757   221647 756100                    STQ     TEMP,,AUTO

     1905    14444    6                   CALL INSERT( ZTEXT.TXT, BASE, TEMP, SUBSTR( QTEXT.TXT, I, TEMP));

  14444 10 006760   000000 620006                    EAX0    0,QL
        10 006761   221650 235100                    LDA     I,,AUTO
        10 006762   221647 722100                    LXL2    TEMP,,AUTO
        10 006763   221651 236100                    LDQ     BASE,,AUTO
        10 006764   040146 100545                    MLR     fill='040'O
        10 006765   000000 200010                    ADSC9   0,A,PR0                  cn=1,n=*X0
        10 006766   201616 200012                    ADSC9   ZTEXT,Q,AUTO             cn=1,n=*X2

     1906    14445    6                   BASE = BASE + TEMP;

  14445 10 006767   221647 036100                    ADLQ    TEMP,,AUTO
        10 006770   221651 756100                    STQ     BASE,,AUTO

     1907    14446    6                   GOTO MOVEIT;

  14446 10 006771   007041 710000 10                 TRA     MOVEIT

     1908    14447    6                   END;
     1909    14448    6               WHENALTRETURN DO;

     1910    14449    6                   END;

     1911    14450    5   DOIT:
     1912    14451    5               CALL INSERT( ZTEXT.TXT, BASE, TEMP, SUBSTR( QTEXT.TXT, I, TEMP));
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:312  

  14451 10 006772   221657 470500       DOIT         LDP0    @QTEXT,,AUTO
        10 006773   221647 720100                    LXL0    TEMP,,AUTO
        10 006774   221650 235100                    LDA     I,,AUTO
        10 006775   221651 236100                    LDQ     BASE,,AUTO
        10 006776   040146 100545                    MLR     fill='040'O
        10 006777   000000 200010                    ADSC9   0,A,PR0                  cn=1,n=*X0
        10 007000   201616 200010                    ADSC9   ZTEXT,Q,AUTO             cn=1,n=*X0

     1913    14452    5               BASE = BASE + TEMP;

  14452 10 007001   221647 036100                    ADLQ    TEMP,,AUTO
        10 007002   221651 756100                    STQ     BASE,,AUTO

     1914    14453    5               EXIT LOOP;

  14453 10 007003   007034 710000 10                 TRA     s:14465

     1915    14454    5               END;
     1916    14455                /* found an embedded squote.. copy up to and including squote */
     1917    14456    4           CALL INSERT( ZTEXT.TXT, BASE, TEMP+1, SUBSTR( QTEXT.TXT, I, TEMP+1));

  14456 10 007004   221647 720100                    LXL0    TEMP,,AUTO
        10 007005   000001 621010                    EAX1    1,X0
        10 007006   221651 236100                    LDQ     BASE,,AUTO
        10 007007   040146 100545                    MLR     fill='040'O
        10 007010   000000 200011                    ADSC9   0,A,PR0                  cn=1,n=*X1
        10 007011   201616 200011                    ADSC9   ZTEXT,Q,AUTO             cn=1,n=*X1

     1918    14457    4           BASE = BASE + TEMP + 1;

  14457 10 007012   221647 036100                    ADLQ    TEMP,,AUTO
        10 007013   000001 036007                    ADLQ    1,DL
        10 007014   221651 756100                    STQ     BASE,,AUTO

     1919    14458    4           I = I + TEMP + 1;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:313  
  14458 10 007015   221650 236100                    LDQ     I,,AUTO
        10 007016   221647 036100                    ADLQ    TEMP,,AUTO
        10 007017   000001 036007                    ADLQ    1,DL
        10 007020   221650 756100                    STQ     I,,AUTO

     1920    14459                /* double the squote in destination */
     1921    14460    4           CALL INSERT( ZTEXT.TXT, BASE, 1, '''');

  14460 10 007021   221651 235100                    LDA     BASE,,AUTO
        10 007022   040105 100400                    MLR     fill='040'O
        10 007023   000113 000001 11                 ADSC9   75                       cn=0,n=1
        10 007024   201616 200001                    ADSC9   ZTEXT,A,AUTO             cn=1,n=1

     1922    14461    4           BASE = BASE + 1;

  14461 10 007025   221651 054100                    AOS     BASE,,AUTO

     1923    14462                /* and continue */
     1924    14463    4           END;

  14463 10 007026   000100 101500                    MRL     fill='000'O
        10 007027   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 007030   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 007031   222250 236100                    LDQ     TVAL+1,,AUTO
        10 007032   221650 116100                    CMPQ    I,,AUTO
        10 007033   006674 605400 10                 TPNZ    s:14424

     1925    14464            /* stash trailing squote */
     1926    14465    3       CALL INSERT( ZTEXT.TXT, BASE, 1, '''');

  14465 10 007034   221651 235100                    LDA     BASE,,AUTO
        10 007035   040105 100400                    MLR     fill='040'O
        10 007036   000113 000001 11                 ADSC9   75                       cn=0,n=1
        10 007037   201616 200001                    ADSC9   ZTEXT,A,AUTO             cn=1,n=1

     1927    14466    3       BASE = BASE + 1;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:314  
  14466 10 007040   221651 054100                    AOS     BASE,,AUTO

     1928    14467    3   MOVEIT:
     1929    14468            /* move new text back to original buffer */
     1930    14469    3       QTEXT.LEN = BASE;

  14469 10 007041   000100 101500       MOVEIT       MRL     fill='000'O
        10 007042   221651 000004                    ADSC9   BASE,,AUTO               cn=0,n=4
        10 007043   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     1931    14470    3       QTEXT.TXT = SUBSTR( ZTEXT.TXT, 0, QTEXT.LEN);

  14470 10 007044   000100 101500                    MRL     fill='000'O
        10 007045   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 007046   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 007047   222250 220100                    LDX0    TVAL+1,,AUTO
        10 007050   040100 100540                    MLR     fill='040'O
        10 007051   201616 200010                    ADSC9   ZTEXT,,AUTO              cn=1,n=*X0
        10 007052   000000 200377                    ADSC9   0,,PR0                   cn=1,n=255

     1932    14471    3   DONE:
     1933    14472    3       RETURN;

  14472 10 007053   221656 221300       DONE         LDX1  ! PARSEFLAG+2,,AUTO
        10 007054   000001 702211                    TSX2  ! 1,X1

     1934    14473
     1935    14474    3       END LEGALIZE;
     1936    14475
     1937    14476    2       END PARSE_FROM;
     1938    14477        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:315  
     1939    14478    1   CHECKADDR: PROC( QTEXT);

  14478 10 007055   221656 741300       CHECKADDR    STX1  ! PARSEFLAG+2,,AUTO

     1940    14479
     1941    14480            %BUFFER( NAME=QTEXT, STCLASS=);
     1942    14485    2       DCL TEMP SBIN;
     1943    14486    2       DCL TMP2 SBIN;
     1944    14487    2       DCL I SBIN;
     1945    14488    2       DCL LEN SBIN;
     1946    14489    2       DCL TBUF CHAR(32);
     1947    14490
     1948    14491    2       CALL INDEX1R( TEMP, '.', SUBSTR( QTEXT.TXT, 0, QTEXT.LEN))

  14491 10 007056   221657 470500                    LDP0    @QTEXT,,AUTO
        10 007057   000100 101500                    MRL     fill='000'O
        10 007060   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 007061   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 007062   222250 220100                    LDX0    TVAL+1,,AUTO
        10 007063   000000 636010                    EAQ     0,X0
        10 007064   000022 772000                    QRL     18
        10 007065   000000 125540                    SCMR    mask='000'O
        10 007066   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        10 007067   000034 000001 11                 ADSC9   28                       cn=0,n=1
        10 007070   221660 000100                    ARG     TEMP,,AUTO
        10 007071   007075 606400 10                 TTN     s:14493
        10 007072   221660 054100                    AOS     TEMP,,AUTO
        10 007073   221660 156100                    SSQ     TEMP,,AUTO
        10 007074   007116 710000 10                 TRA     s:14498

     1949    14492    3       WHENALTRETURN DO;

     1950    14493    3           CALL INDEX1R( TEMP, '@', SUBSTR( QTEXT.TXT, 0, QTEXT.LEN))

  14493 10 007075   221657 470500                    LDP0    @QTEXT,,AUTO
        10 007076   000100 101500                    MRL     fill='000'O
        10 007077   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:316  
        10 007100   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 007101   222250 220100                    LDX0    TVAL+1,,AUTO
        10 007102   000000 636010                    EAQ     0,X0
        10 007103   000022 772000                    QRL     18
        10 007104   000000 125540                    SCMR    mask='000'O
        10 007105   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        10 007106   000107 000001 11                 ADSC9   71                       cn=0,n=1
        10 007107   221660 000100                    ARG     TEMP,,AUTO
        10 007110   007114 606400 10                 TTN     s:14495
        10 007111   221660 054100                    AOS     TEMP,,AUTO
        10 007112   221660 156100                    SSQ     TEMP,,AUTO
        10 007113   007116 710000 10                 TRA     s:14498

     1951    14494    4           WHENALTRETURN DO;

     1952    14495    4               TEMP = -1;

  14495 10 007114   000001 335007                    LCA     1,DL
        10 007115   221660 755100                    STA     TEMP,,AUTO

     1953    14496    4               END;

     1954    14497    3           END;

     1955    14498    2       CALL INDEX1R( TMP2, '!', SUBSTR( QTEXT.TXT, 0, QTEXT.LEN))

  14498 10 007116   221657 470500                    LDP0    @QTEXT,,AUTO
        10 007117   000100 101500                    MRL     fill='000'O
        10 007120   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 007121   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 007122   222250 220100                    LDX0    TVAL+1,,AUTO
        10 007123   000000 636010                    EAQ     0,X0
        10 007124   000022 772000                    QRL     18
        10 007125   000000 125540                    SCMR    mask='000'O
        10 007126   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        10 007127   000110 000001 11                 ADSC9   72                       cn=0,n=1
        10 007130   221661 000100                    ARG     TMP2,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:317  
        10 007131   007135 606400 10                 TTN     s:14500
        10 007132   221661 054100                    AOS     TMP2,,AUTO
        10 007133   221661 156100                    SSQ     TMP2,,AUTO
        10 007134   007137 710000 10                 TRA     s:14502

     1956    14499    3       WHENALTRETURN DO;

     1957    14500    3           TMP2 = -1;

  14500 10 007135   000001 335007                    LCA     1,DL
        10 007136   221661 755100                    STA     TMP2,,AUTO

     1958    14501    3           END;

     1959    14502    3       IF TEMP = -1 AND TMP2 = -1 THEN DO;

  14502 10 007137   221660 235100                    LDA     TEMP,,AUTO
        10 007140   000027 115000 xsym               CMPA    B_VECTNIL+23
        10 007141   007205 601000 10                 TNZ     s:14515
        10 007142   221661 236100                    LDQ     TMP2,,AUTO
        10 007143   000027 116000 xsym               CMPQ    B_VECTNIL+23
        10 007144   007205 601000 10                 TNZ     s:14515

     1960    14503    3           ZTEXT = QTEXT;

  14503 10 007145   221657 470500                    LDP0    @QTEXT,,AUTO
        10 007146   000100 100500                    MLR     fill='000'O
        10 007147   000000 000400                    ADSC9   0,,PR0                   cn=0,n=256
        10 007150   201616 000400                    ADSC9   ZTEXT,,AUTO              cn=0,n=256

     1961    14504    3           CALL FIXLOCAL( ZTEXT)

  14504 10 007151   201616 631500                    EPPR1   ZTEXT,,AUTO
        10 007152   221675 451500                    STP1    TBUF+9,,AUTO
        10 007153   007660 701000 10                 TSX1    FIXLOCAL
        10 007154   007156 702000 10                 TSX2    s:14507
        10 007155   007156 710000 10                 TRA     s:14507
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:318  

     1962    14505    4           WHENALTRETURN DO;

     1963    14506    4               END;

     1964    14507    3           CALL INDEX1R( TEMP, '@', SUBSTR( ZTEXT.TXT, 0, ZTEXT.LEN))

  14507 10 007156   201616 236100                    LDQ     ZTEXT,,AUTO
        10 007157   000033 772000                    QRL     27
        10 007160   000000 620006                    EAX0    0,QL
        10 007161   000000 125540                    SCMR    mask='000'O
        10 007162   201616 200010                    ADSC9   ZTEXT,,AUTO              cn=1,n=*X0
        10 007163   000107 000001 11                 ADSC9   71                       cn=0,n=1
        10 007164   221660 000100                    ARG     TEMP,,AUTO
        10 007165   007171 606400 10                 TTN     s:14509
        10 007166   221660 054100                    AOS     TEMP,,AUTO
        10 007167   221660 156100                    SSQ     TEMP,,AUTO
        10 007170   007203 710000 10                 TRA     DONE

     1965    14508    4           WHENALTRETURN DO;

     1966    14509    4               CALL LOOKUP_ALIAS( ADDR( ZTEXT)) ALTRET( DONE);

  14509 10 007171   201616 630500                    EPPR0   ZTEXT,,AUTO
        10 007172   222260 450500                    STP0    TVAL+9,,AUTO
        10 007173   222260 631500                    EPPR1   TVAL+9,,AUTO
        10 007174   221675 451500                    STP1    TBUF+9,,AUTO
        10 007175   010001 701000 10                 TSX1    LOOKUP_ALIAS
        10 007176   007203 702000 10                 TSX2    DONE

     1967    14510    4               QTEXT = ZTEXT;

  14510 10 007177   221657 470500                    LDP0    @QTEXT,,AUTO
        10 007200   000100 100500                    MLR     fill='000'O
        10 007201   201616 000400                    ADSC9   ZTEXT,,AUTO              cn=0,n=256
        10 007202   000000 000400                    ADSC9   0,,PR0                   cn=0,n=256

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:319  
     1968    14511    4               END;

     1969    14512    3   DONE:
     1970    14513    3           RETURN;

  14513 10 007203   221656 221300       DONE         LDX1  ! PARSEFLAG+2,,AUTO
        10 007204   000001 702211                    TSX2  ! 1,X1

     1971    14514    3           END;
     1972    14515    3       IF TEMP > TMP2 THEN DO;

  14515 10 007205   221660 236100                    LDQ     TEMP,,AUTO
        10 007206   221661 116100                    CMPQ    TMP2,,AUTO
        10 007207   007256 604400 10                 TMOZ    ADD_GATEWAY

     1973    14516                /* Reply-To: ends with a domain.  See if we know of it. */
     1974    14517    3           CALL XLATE( NODES_KEY.SITE, TCM_XLATE_TO_UC,

  14517 10 007210   221657 470500                    LDP0    @QTEXT,,AUTO
        10 007211   000100 101500                    MRL     fill='000'O
        10 007212   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 007213   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 007214   222250 236100                    LDQ     TVAL+1,,AUTO
        10 007215   221660 136100                    SBLQ    TEMP,,AUTO
        10 007216   777777 620006                    EAX0    -1,QL
        10 007217   040000 160545                    MVT     fill='040'O
        10 007220   000000 400010                    ADSC9   0,A,PR0                  cn=2,n=*X0
        10 007221   003405 200010 1                  ADSC9   NODES_KEY                cn=1,n=8
        10 007222   000060 000000 2                  ARG     TCM_XLATE_TO_UC

     1975    14518    3                   SUBSTR( QTEXT.TXT, TEMP + 1, QTEXT.LEN - TEMP - 1));
     1976    14519    3           CALL M$PRECORD( POSITION_NODES)

  14519 10 007223   000750 630400 2                  EPPR0   POSITION_NODES
        10 007224   440003 713400                    CLIMB   alt,+16387
        10 007225   401000 401760                    pmme    nvectors=3
        10 007226   007230 702000 10                 TSX2    s:14522
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:320  
        10 007227   007254 710000 10                 TRA     s:14531

     1977    14520    4           WHENALTRETURN DO;

     1978    14521                    /* Domain not known.  Add @gateway to end. */
     1979    14522    4               CALL INDEX1R( TEMP, '@', SUBSTR( QTEXT.TXT, 0, QTEXT.LEN))

  14522 10 007230   221657 470500                    LDP0    @QTEXT,,AUTO
        10 007231   000100 101500                    MRL     fill='000'O
        10 007232   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 007233   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 007234   222250 220100                    LDX0    TVAL+1,,AUTO
        10 007235   000000 636010                    EAQ     0,X0
        10 007236   000022 772000                    QRL     18
        10 007237   000000 125540                    SCMR    mask='000'O
        10 007240   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        10 007241   000107 000001 11                 ADSC9   71                       cn=0,n=1
        10 007242   221660 000100                    ARG     TEMP,,AUTO
        10 007243   007253 606400 10                 TTN     s:14528
        10 007244   221660 054100                    AOS     TEMP,,AUTO
        10 007245   221660 156100                    SSQ     TEMP,,AUTO

     1980    14523    5               WHENRETURN DO;

     1981    14524    5                   SUBSTR( QTEXT.TXT, TEMP, 1) = '%';

  14524 10 007246   221660 235100                    LDA     TEMP,,AUTO
        10 007247   040105 100400                    MLR     fill='040'O
        10 007250   000114 000001 11                 ADSC9   76                       cn=0,n=1
        10 007251   000000 200001                    ADSC9   0,A,PR0                  cn=1,n=1

     1982    14525    5                   END;

  14525 10 007252   007253 710000 10                 TRA     s:14528

     1983    14526    5               WHENALTRETURN DO;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:321  
     1984    14527    5                   END;

     1985    14528    4               GOTO ADD_GATEWAY;

  14528 10 007253   007256 710000 10                 TRA     ADD_GATEWAY

     1986    14529    4               END;
     1987    14530                /* Otherwise.. domain is known already. */
     1988    14531    3           RETURN;

  14531 10 007254   221656 221300                    LDX1  ! PARSEFLAG+2,,AUTO
        10 007255   000001 702211                    TSX2  ! 1,X1

     1989    14532    3           END;
     1990    14533    3       ELSE DO;

     1991    14534                /* This looks like a bang path.  Fall through. */
     1992    14535    3           END;

     1993    14536    2   ADD_GATEWAY:
     1994    14537    2       CALL CONCAT( ZTEXT.TXT, '@', SUBSTR( HELO.TXT, 0, HELO.LEN));

  14537 10 007256   200016 236100       ADD_GATEWAY  LDQ     HELO,,AUTO
        10 007257   000033 772000                    QRL     27
        10 007260   000000 620006                    EAX0    0,QL
        10 007261   000100 236003                    LDQ     64,DU
        10 007262   201616 552120                    STBQ    ZTEXT,'20'O,AUTO
        10 007263   040100 100540                    MLR     fill='040'O
        10 007264   200016 200010                    ADSC9   HELO,,AUTO               cn=1,n=*X0
        10 007265   201616 400376                    ADSC9   ZTEXT,,AUTO              cn=2,n=254

     1995    14538    2       ZTEXT.LEN = 1 + HELO.LEN;

  14538 10 007266   200016 236100                    LDQ     HELO,,AUTO
        10 007267   000033 772000                    QRL     27
        10 007270   000001 036007                    ADLQ    1,DL
        10 007271   000033 736000                    QLS     27
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:322  
        10 007272   201616 552140                    STBQ    ZTEXT,'40'O,AUTO

     1996    14539    3       IF REWRITES > 0 THEN DO;

  14539 10 007273   221416 235100                    LDA     REWRITES,,AUTO
        10 007274   007346 604400 10                 TMOZ    s:14554

     1997    14540    3           CALL XLATE( TBUF, TCM_XLATE_TO_UC, SUBSTR( HELO.TXT, 0, HELO.LEN));

  14540 10 007275   200016 236100                    LDQ     HELO,,AUTO
        10 007276   000033 772000                    QRL     27
        10 007277   000000 620006                    EAX0    0,QL
        10 007300   040100 160540                    MVT     fill='040'O
        10 007301   200016 200010                    ADSC9   HELO,,AUTO               cn=1,n=*X0
        10 007302   221664 000040                    ADSC9   TBUF,,AUTO               cn=0,n=32
        10 007303   000060 000000 2                  ARG     TCM_XLATE_TO_UC

     1998    14541    3   ADDGATE_LOOP:
     1999    14542    4           DO I = 0 TO REWRITES - 1;

  14542 10 007304   221662 450100       ADDGATE_LOOP STZ     I,,AUTO
        10 007305   007343 710000 10                 TRA     s:14552+1

     2000    14543    5               IF REWRITE.TYP( I) = %ADDGATE_CMD THEN DO;

  14543 10 007306   221662 236100                    LDQ     I,,AUTO
        10 007307   000022 402007                    MPY     18,DL
        10 007310   000733 235006 1                  LDA     REWRITE,QL
        10 007311   000150 115007                    CMPA    104,DL
        10 007312   007342 601000 10                 TNZ     s:14552

     2001    14544    5                   LEN = REWRITE.OLD.LEN( I);

  14544 10 007313   000735 236006 1                  LDQ     REWRITE+2,QL
        10 007314   000033 772000                    QRL     27
        10 007315   221663 756100                    STQ     LEN,,AUTO

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:323  
     2002    14545    5                   IF SUBSTR( REWRITE.OLD.TXT( I), 0, LEN) =

  14545 10 007316   200016 236100                    LDQ     HELO,,AUTO
        10 007317   000033 772000                    QRL     27
        10 007320   000000 620006                    EAX0    0,QL
        10 007321   221662 236100                    LDQ     I,,AUTO
        10 007322   000110 402007                    MPY     72,DL
        10 007323   221663 721100                    LXL1    LEN,,AUTO
        10 007324   040140 106446                    CMPC    fill='040'O
        10 007325   000735 200011 1                  ADSC9   REWRITE+2,Q              cn=1,n=*X1
        10 007326   221664 000010                    ADSC9   TBUF,,AUTO               cn=0,n=*X0
        10 007327   007342 601000 10                 TNZ     s:14552

     2003    14546    6                           SUBSTR( TBUF, 0, HELO.LEN) THEN DO;

     2004    14547    6                       ZTEXT.LEN = REWRITE.NEW.LEN( I);

  14547 10 007330   221662 236100                    LDQ     I,,AUTO
        10 007331   000022 402007                    MPY     18,DL
        10 007332   000745 236006 1                  LDQ     REWRITE+10,QL
        10 007333   201616 552140                    STBQ    ZTEXT,'40'O,AUTO

     2005    14548    6                       ZTEXT.TXT = REWRITE.NEW.TXT( I);

  14548 10 007334   221662 236100                    LDQ     I,,AUTO
        10 007335   000110 402007                    MPY     72,DL
        10 007336   040100 100406                    MLR     fill='040'O
        10 007337   000745 200037 1                  ADSC9   REWRITE+10,Q             cn=1,n=31
        10 007340   201616 200377                    ADSC9   ZTEXT,,AUTO              cn=1,n=255

     2006    14549    6                       EXIT ADDGATE_LOOP;

  14549 10 007341   007346 710000 10                 TRA     s:14554

     2007    14550    6                       END;
     2008    14551    5                   END;
     2009    14552    4               END;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:324  

  14552 10 007342   221662 054100                    AOS     I,,AUTO
        10 007343   221662 236100                    LDQ     I,,AUTO
        10 007344   221416 116100                    CMPQ    REWRITES,,AUTO
        10 007345   007306 604000 10                 TMI     s:14543

     2010    14553    3           END;

     2011    14554    2       CALL INSERT( QTEXT.TXT, QTEXT.LEN, ZTEXT.LEN,

  14554 10 007346   201616 236100                    LDQ     ZTEXT,,AUTO
        10 007347   000033 772000                    QRL     27
        10 007350   221657 470500                    LDP0    @QTEXT,,AUTO
        10 007351   000100 101500                    MRL     fill='000'O
        10 007352   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 007353   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 007354   000000 620006                    EAX0    0,QL
        10 007355   222250 236100                    LDQ     TVAL+1,,AUTO
        10 007356   222251 756100                    STQ     TVAL+2,,AUTO
        10 007357   201616 236100                    LDQ     ZTEXT,,AUTO
        10 007360   000033 772000                    QRL     27
        10 007361   000000 621006                    EAX1    0,QL
        10 007362   222251 235100                    LDA     TVAL+2,,AUTO
        10 007363   040145 100540                    MLR     fill='040'O
        10 007364   201616 200010                    ADSC9   ZTEXT,,AUTO              cn=1,n=*X0
        10 007365   000000 200011                    ADSC9   0,A,PR0                  cn=1,n=*X1

     2012    14555    2               SUBSTR( ZTEXT.TXT, 0, ZTEXT.LEN));
     2013    14556    2       QTEXT.LEN = QTEXT.LEN + ZTEXT.LEN;

  14556 10 007366   201616 236100                    LDQ     ZTEXT,,AUTO
        10 007367   000033 772000                    QRL     27
        10 007370   222250 756100                    STQ     TVAL+1,,AUTO
        10 007371   000100 101500                    MRL     fill='000'O
        10 007372   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 007373   222251 000004                    ADSC9   TVAL+2,,AUTO             cn=0,n=4
        10 007374   222251 236100                    LDQ     TVAL+2,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:325  
        10 007375   222250 036100                    ADLQ    TVAL+1,,AUTO
        10 007376   222252 756100                    STQ     TVAL+3,,AUTO
        10 007377   000100 101500                    MRL     fill='000'O
        10 007400   222252 000004                    ADSC9   TVAL+3,,AUTO             cn=0,n=4
        10 007401   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     2014    14557    2       RETURN;

  14557 10 007402   221656 221300                    LDX1  ! PARSEFLAG+2,,AUTO
        10 007403   000001 702211                    TSX2  ! 1,X1

     2015    14558
     2016    14559    2       END CHECKADDR;
     2017    14560        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:326  
     2018    14561    1   TRIMTEXT: PROC( SOURCE, TARGET);

  14561 10 007404   221656 741300       TRIMTEXT     STX1  ! PARSEFLAG+2,,AUTO

     2019    14562
     2020    14563            %BUFFER( NAME=SOURCE, STCLASS=);
     2021    14568            %BUFFER( NAME=TARGET, STCLASS=);
     2022    14573            %BUFFER( NAME=QTEXT);
     2023    14578
     2024    14579    2       DCL I SBIN;
     2025    14580    2       DCL J SBIN;
     2026    14581    2       DCL CHANGED BIT(1);
     2027    14582
     2028    14583    2       QTEXT = SOURCE;

  14583 10 007405   221657 470500                    LDP0    @SOURCE,,AUTO
        10 007406   000100 100500                    MLR     fill='000'O
        10 007407   000000 000400                    ADSC9   0,,PR0                   cn=0,n=256
        10 007410   221661 000400                    ADSC9   QTEXT,,AUTO              cn=0,n=256

     2029    14584    2       TARGET = SOURCE;

  14584 10 007411   221660 471500                    LDP1    @TARGET,,AUTO
        10 007412   000100 100500                    MLR     fill='000'O
        10 007413   000000 000400                    ADSC9   0,,PR0                   cn=0,n=256
        10 007414   100000 000400                    ADSC9   0,,PR1                   cn=0,n=256

     2030    14585    2   TRIM_AGAIN:
     2031    14586    3       IF SUBSTR( QTEXT.TXT, 0, QTEXT.LEN) = ' ' THEN DO;

  14586 10 007415   221661 236100       TRIM_AGAIN   LDQ     QTEXT,,AUTO
        10 007416   000033 772000                    QRL     27
        10 007417   000000 620006                    EAX0    0,QL
        10 007420   040000 106540                    CMPC    fill='040'O
        10 007421   221661 200010                    ADSC9   QTEXT,,AUTO              cn=1,n=*X0
        10 007422   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 007423   007435 601000 10                 TNZ     s:14591
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:327  

     2032    14587    3           TARGET.LEN = 1;

  14587 10 007424   221660 470500                    LDP0    @TARGET,,AUTO
        10 007425   000100 101400                    MRL     fill='000'O
        10 007426   000003 000004 xsym               ADSC9   B_VECTNIL+3              cn=0,n=4
        10 007427   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     2033    14588    3           TARGET.TXT = ' ';

  14588 10 007430   040100 100400                    MLR     fill='040'O
        10 007431   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 007432   000000 200377                    ADSC9   0,,PR0                   cn=1,n=255

     2034    14589    3           RETURN;

  14589 10 007433   221656 221300                    LDX1  ! PARSEFLAG+2,,AUTO
        10 007434   000001 702211                    TSX2  ! 1,X1

     2035    14590    3           END;
     2036    14591    2       CHANGED = %NO#;

  14591 10 007435   221763 450100                    STZ     CHANGED,,AUTO

     2037    14592    2       I = 0;

  14592 10 007436   221761 450100                    STZ     I,,AUTO

     2038    14593    3       DO WHILE( SUBSTR( QTEXT.TXT, I, 1) = ' ');

  14593 10 007437   007443 710000 10                 TRA     s:14596

     2039    14594    3           I = I + 1;

  14594 10 007440   221761 054100                    AOS     I,,AUTO

     2040    14595    3           CHANGED = %YES#;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:328  

  14595 10 007441   400000 236003                    LDQ     -131072,DU
        10 007442   221763 756100                    STQ     CHANGED,,AUTO

     2041    14596    3           END;

  14596 10 007443   221761 235100                    LDA     I,,AUTO
        10 007444   040000 106505                    CMPC    fill='040'O
        10 007445   221661 200001                    ADSC9   QTEXT,A,AUTO             cn=1,n=1
        10 007446   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 007447   007440 600000 10                 TZE     s:14594

     2042    14597    2       J = QTEXT.LEN - 1;

  14597 10 007450   221661 236100                    LDQ     QTEXT,,AUTO
        10 007451   000033 772000                    QRL     27
        10 007452   000001 136007                    SBLQ    1,DL
        10 007453   221762 756100                    STQ     J,,AUTO

     2043    14598    3       DO WHILE( SUBSTR( QTEXT.TXT, J, 1) = ' ');

  14598 10 007454   007461 710000 10                 TRA     s:14601

     2044    14599    3           J = J - 1;

  14599 10 007455   000001 336007                    LCQ     1,DL
        10 007456   221762 056100                    ASQ     J,,AUTO

     2045    14600    3           CHANGED = %YES#;

  14600 10 007457   400000 236003                    LDQ     -131072,DU
        10 007460   221763 756100                    STQ     CHANGED,,AUTO

     2046    14601    3           END;

  14601 10 007461   221762 235100                    LDA     J,,AUTO
        10 007462   040000 106505                    CMPC    fill='040'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:329  
        10 007463   221661 200001                    ADSC9   QTEXT,A,AUTO             cn=1,n=1
        10 007464   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 007465   007455 600000 10                 TZE     s:14599

     2047    14602    3       IF CHANGED THEN DO;

  14602 10 007466   221763 234100                    SZN     CHANGED,,AUTO
        10 007467   007517 605000 10                 TPL     s:14607

     2048    14603    3           CALL INSERT( TARGET.TXT, 0, 1+J-I, SUBSTR( QTEXT.TXT, I, 1+J-I));

  14603 10 007470   221762 236100                    LDQ     J,,AUTO
        10 007471   221761 136100                    SBLQ    I,,AUTO
        10 007472   222250 756100                    STQ     TVAL+1,,AUTO
        10 007473   221762 236100                    LDQ     J,,AUTO
        10 007474   221761 136100                    SBLQ    I,,AUTO
        10 007475   000001 620006                    EAX0    1,QL
        10 007476   222250 721100                    LXL1    TVAL+1,,AUTO
        10 007477   000001 622011                    EAX2    1,X1
        10 007500   221761 236100                    LDQ     I,,AUTO
        10 007501   221660 470500                    LDP0    @TARGET,,AUTO
        10 007502   040140 100546                    MLR     fill='040'O
        10 007503   221661 200010                    ADSC9   QTEXT,Q,AUTO             cn=1,n=*X0
        10 007504   000000 200012                    ADSC9   0,,PR0                   cn=1,n=*X2

     2049    14604    3           TARGET.LEN = 1 + J - I;

  14604 10 007505   221762 236100                    LDQ     J,,AUTO
        10 007506   221761 136100                    SBLQ    I,,AUTO
        10 007507   000001 036007                    ADLQ    1,DL
        10 007510   222250 756100                    STQ     TVAL+1,,AUTO
        10 007511   000100 101500                    MRL     fill='000'O
        10 007512   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 007513   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     2050    14605    3           QTEXT = TARGET;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:330  
  14605 10 007514   000100 100500                    MLR     fill='000'O
        10 007515   000000 000400                    ADSC9   0,,PR0                   cn=0,n=256
        10 007516   221661 000400                    ADSC9   QTEXT,,AUTO              cn=0,n=256

     2051    14606    3           END;

     2052    14607    2       J = QTEXT.LEN - 1;

  14607 10 007517   221661 236100                    LDQ     QTEXT,,AUTO
        10 007520   000033 772000                    QRL     27
        10 007521   000001 136007                    SBLQ    1,DL
        10 007522   221762 756100                    STQ     J,,AUTO

     2053    14608    2       IF J > 1 AND SUBSTR( QTEXT.TXT, 0, 1) = '(' AND

  14608 10 007523   000001 116007                    CMPQ    1,DL
        10 007524   007556 604400 10                 TMOZ    s:14615
        10 007525   221661 236100                    LDQ     QTEXT,,AUTO
        10 007526   000777 376003                    ANQ     511,DU
        10 007527   000050 116003                    CMPQ    40,DU
        10 007530   007556 601000 10                 TNZ     s:14615
        10 007531   221762 235100                    LDA     J,,AUTO
        10 007532   040000 106505                    CMPC    fill='040'O
        10 007533   221661 200001                    ADSC9   QTEXT,A,AUTO             cn=1,n=1
        10 007534   000115 000001 11                 ADSC9   77                       cn=0,n=1
        10 007535   007556 601000 10                 TNZ     s:14615

     2054    14609    3               SUBSTR( QTEXT.TXT, J, 1) = ')' THEN DO;

     2055    14610    3           CALL INSERT( TARGET.TXT, 0, J-1, SUBSTR( QTEXT.TXT, 1, J-1));

  14610 10 007536   777777 620005                    EAX0    -1,AL
        10 007537   221660 470500                    LDP0    @TARGET,,AUTO
        10 007540   040140 100540                    MLR     fill='040'O
        10 007541   221661 400010                    ADSC9   QTEXT,,AUTO              cn=2,n=*X0
        10 007542   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:331  
     2056    14611    3           TARGET.LEN = J - 1;

  14611 10 007543   221762 236100                    LDQ     J,,AUTO
        10 007544   000001 136007                    SBLQ    1,DL
        10 007545   222250 756100                    STQ     TVAL+1,,AUTO
        10 007546   000100 101500                    MRL     fill='000'O
        10 007547   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 007550   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     2057    14612    3           QTEXT = TARGET;

  14612 10 007551   000100 100500                    MLR     fill='000'O
        10 007552   000000 000400                    ADSC9   0,,PR0                   cn=0,n=256
        10 007553   221661 000400                    ADSC9   QTEXT,,AUTO              cn=0,n=256

     2058    14613    3           CHANGED = %YES#;

  14613 10 007554   400000 236003                    LDQ     -131072,DU
        10 007555   221763 756100                    STQ     CHANGED,,AUTO

     2059    14614    3           END;

     2060    14615    2       J = QTEXT.LEN - 1;

  14615 10 007556   221661 236100                    LDQ     QTEXT,,AUTO
        10 007557   000033 772000                    QRL     27
        10 007560   000001 136007                    SBLQ    1,DL
        10 007561   221762 756100                    STQ     J,,AUTO

     2061    14616    2       IF J > 1 AND SUBSTR( QTEXT.TXT, 0, 1) = '<' AND

  14616 10 007562   000001 116007                    CMPQ    1,DL
        10 007563   007615 604400 10                 TMOZ    s:14623
        10 007564   221661 236100                    LDQ     QTEXT,,AUTO
        10 007565   000777 376003                    ANQ     511,DU
        10 007566   000074 116003                    CMPQ    60,DU
        10 007567   007615 601000 10                 TNZ     s:14623
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:332  
        10 007570   221762 235100                    LDA     J,,AUTO
        10 007571   040000 106505                    CMPC    fill='040'O
        10 007572   221661 200001                    ADSC9   QTEXT,A,AUTO             cn=1,n=1
        10 007573   000116 000001 11                 ADSC9   78                       cn=0,n=1
        10 007574   007615 601000 10                 TNZ     s:14623

     2062    14617    3               SUBSTR( QTEXT.TXT, J, 1) = '>' THEN DO;

     2063    14618    3           CALL INSERT( TARGET.TXT, 0, J-1, SUBSTR( QTEXT.TXT, 1, J-1));

  14618 10 007575   777777 620005                    EAX0    -1,AL
        10 007576   221660 470500                    LDP0    @TARGET,,AUTO
        10 007577   040140 100540                    MLR     fill='040'O
        10 007600   221661 400010                    ADSC9   QTEXT,,AUTO              cn=2,n=*X0
        10 007601   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0

     2064    14619    3           TARGET.LEN = J - 1;

  14619 10 007602   221762 236100                    LDQ     J,,AUTO
        10 007603   000001 136007                    SBLQ    1,DL
        10 007604   222250 756100                    STQ     TVAL+1,,AUTO
        10 007605   000100 101500                    MRL     fill='000'O
        10 007606   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 007607   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     2065    14620    3           QTEXT = TARGET;

  14620 10 007610   000100 100500                    MLR     fill='000'O
        10 007611   000000 000400                    ADSC9   0,,PR0                   cn=0,n=256
        10 007612   221661 000400                    ADSC9   QTEXT,,AUTO              cn=0,n=256

     2066    14621    3           CHANGED = %YES#;

  14621 10 007613   400000 236003                    LDQ     -131072,DU
        10 007614   221763 756100                    STQ     CHANGED,,AUTO

     2067    14622    3           END;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:333  

     2068    14623    2       J = QTEXT.LEN - 1;

  14623 10 007615   221661 236100                    LDQ     QTEXT,,AUTO
        10 007616   000033 772000                    QRL     27
        10 007617   000001 136007                    SBLQ    1,DL
        10 007620   221762 756100                    STQ     J,,AUTO

     2069    14624    2       IF J > 1 AND SUBSTR( QTEXT.TXT, 0, 1) = '"' AND

  14624 10 007621   000001 116007                    CMPQ    1,DL
        10 007622   007654 604400 10                 TMOZ    s:14631
        10 007623   221661 236100                    LDQ     QTEXT,,AUTO
        10 007624   000777 376003                    ANQ     511,DU
        10 007625   000042 116003                    CMPQ    34,DU
        10 007626   007654 601000 10                 TNZ     s:14631
        10 007627   221762 235100                    LDA     J,,AUTO
        10 007630   040000 106505                    CMPC    fill='040'O
        10 007631   221661 200001                    ADSC9   QTEXT,A,AUTO             cn=1,n=1
        10 007632   000005 000001 11                 ADSC9   5                        cn=0,n=1
        10 007633   007654 601000 10                 TNZ     s:14631

     2070    14625    3               SUBSTR( QTEXT.TXT, J, 1) = '"' THEN DO;

     2071    14626    3           CALL INSERT( TARGET.TXT, 0, J-1, SUBSTR( QTEXT.TXT, 1, J-1));

  14626 10 007634   777777 620005                    EAX0    -1,AL
        10 007635   221660 470500                    LDP0    @TARGET,,AUTO
        10 007636   040140 100540                    MLR     fill='040'O
        10 007637   221661 400010                    ADSC9   QTEXT,,AUTO              cn=2,n=*X0
        10 007640   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0

     2072    14627    3           TARGET.LEN = J - 1;

  14627 10 007641   221762 236100                    LDQ     J,,AUTO
        10 007642   000001 136007                    SBLQ    1,DL
        10 007643   222250 756100                    STQ     TVAL+1,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:334  
        10 007644   000100 101500                    MRL     fill='000'O
        10 007645   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 007646   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     2073    14628    3           QTEXT = TARGET;

  14628 10 007647   000100 100500                    MLR     fill='000'O
        10 007650   000000 000400                    ADSC9   0,,PR0                   cn=0,n=256
        10 007651   221661 000400                    ADSC9   QTEXT,,AUTO              cn=0,n=256

     2074    14629    3           CHANGED = %YES#;

  14629 10 007652   400000 236003                    LDQ     -131072,DU
        10 007653   221763 756100                    STQ     CHANGED,,AUTO

     2075    14630    3           END;

     2076    14631    2       IF CHANGED THEN

  14631 10 007654   221763 234100                    SZN     CHANGED,,AUTO
        10 007655   007415 604000 10                 TMI     TRIM_AGAIN

     2077    14632    2           GOTO TRIM_AGAIN;
     2078    14633    2       RETURN;  /* TARGET contains the trimmed text */

  14633 10 007656   221656 221300                    LDX1  ! PARSEFLAG+2,,AUTO
        10 007657   000001 702211                    TSX2  ! 1,X1

     2079    14634
     2080    14635    2       END TRIMTEXT;
     2081    14636        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:335  
     2082    14637    1   FIXLOCAL: PROC( TEXT) ALTRET;

  14637 10 007660   221674 741300       FIXLOCAL     STX1  ! TBUF+8,,AUTO

     2083    14638
     2084    14639            %BUFFER( NAME=TEXT, STCLASS=);
     2085    14644    2       DCL TEMP SBIN;
     2086    14645    2       DCL TMP2 SBIN;
     2087    14646    2       DCL DIFF SBIN;
     2088    14647    2       DCL I SBIN;
     2089    14648    2       DCL LEN SBIN;
     2090    14649    2       DCL TBUF CHAR(32);
     2091    14650
     2092    14651    2   BEGINNING:
     2093    14652    2       CALL INDEX1R( TEMP, '@', SUBSTR( TEXT.TXT, 0, TEXT.LEN))

  14652 10 007661   221675 470500       BEGINNING    LDP0    @TEXT,,AUTO
        10 007662   000100 101500                    MRL     fill='000'O
        10 007663   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 007664   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 007665   222250 220100                    LDX0    TVAL+1,,AUTO
        10 007666   000000 636010                    EAQ     0,X0
        10 007667   000022 772000                    QRL     18
        10 007670   000000 125540                    SCMR    mask='000'O
        10 007671   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        10 007672   000107 000001 11                 ADSC9   71                       cn=0,n=1
        10 007673   221676 000100                    ARG     TEMP,,AUTO
        10 007674   007700 606400 10                 TTN     s:14654
        10 007675   221676 054100                    AOS     TEMP,,AUTO
        10 007676   221676 156100                    SSQ     TEMP,,AUTO
        10 007677   007702 710000 10                 TRA     s:14656

     2094    14653    3       WHENALTRETURN DO;

     2095    14654    3           RETURN;

  14654 10 007700   221674 221300                    LDX1  ! TBUF+8,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:336  
        10 007701   000001 702211                    TSX2  ! 1,X1

     2096    14655    3           END;
     2097    14656    2       CALL INDEX1R( TMP2, '%', SUBSTR( TEXT.TXT, 0, TEMP))

  14656 10 007702   221676 236100                    LDQ     TEMP,,AUTO
        10 007703   221676 720100                    LXL0    TEMP,,AUTO
        10 007704   000000 125540                    SCMR    mask='000'O
        10 007705   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        10 007706   000114 000001 11                 ADSC9   76                       cn=0,n=1
        10 007707   221677 000100                    ARG     TMP2,,AUTO
        10 007710   007714 606400 10                 TTN     s:14658
        10 007711   221677 054100                    AOS     TMP2,,AUTO
        10 007712   221677 156100                    SSQ     TMP2,,AUTO
        10 007713   007716 710000 10                 TRA     s:14660

     2098    14657    3       WHENALTRETURN DO;

     2099    14658    3           TMP2 = -1;

  14658 10 007714   000001 335007                    LCA     1,DL
        10 007715   221677 755100                    STA     TMP2,,AUTO

     2100    14659    3           END;

     2101    14660    2       DIFF = TEXT.LEN - TEMP;

  14660 10 007716   221675 470500                    LDP0    @TEXT,,AUTO
        10 007717   000100 101500                    MRL     fill='000'O
        10 007720   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 007721   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 007722   222250 236100                    LDQ     TVAL+1,,AUTO
        10 007723   221676 136100                    SBLQ    TEMP,,AUTO
        10 007724   221700 756100                    STQ     DIFF,,AUTO

     2102    14661    3       IF REWRITES > 0 THEN DO;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:337  
  14661 10 007725   221416 235100                    LDA     REWRITES,,AUTO
        10 007726   007777 604400 10                 TMOZ    s:14677

     2103    14662    3           CALL XLATE( TBUF, TCM_XLATE_TO_UC, SUBSTR( TEXT.TXT, TEMP, DIFF));

  14662 10 007727   000000 620006                    EAX0    0,QL
        10 007730   221676 236100                    LDQ     TEMP,,AUTO
        10 007731   040100 160546                    MVT     fill='040'O
        10 007732   000000 200010                    ADSC9   0,Q,PR0                  cn=1,n=*X0
        10 007733   221703 000040                    ADSC9   TBUF,,AUTO               cn=0,n=32
        10 007734   000060 000000 2                  ARG     TCM_XLATE_TO_UC

     2104    14663    3   DELSITE_LOOP:
     2105    14664    4           DO I = 0 TO REWRITES - 1;

  14664 10 007735   221701 450100       DELSITE_LOOP STZ     I,,AUTO
        10 007736   007774 710000 10                 TRA     s:14675+1

     2106    14665    5               IF REWRITE.TYP( I) = %DELSITE_CMD THEN DO;

  14665 10 007737   221701 236100                    LDQ     I,,AUTO
        10 007740   000022 402007                    MPY     18,DL
        10 007741   000733 235006 1                  LDA     REWRITE,QL
        10 007742   000152 115007                    CMPA    106,DL
        10 007743   007773 601000 10                 TNZ     s:14675

     2107    14666    5                   LEN = REWRITE.OLD.LEN( I);

  14666 10 007744   000735 236006 1                  LDQ     REWRITE+2,QL
        10 007745   000033 772000                    QRL     27
        10 007746   221702 756100                    STQ     LEN,,AUTO

     2108    14667    5                   IF SUBSTR( REWRITE.OLD.TXT( I), 0, LEN) =

  14667 10 007747   221701 236100                    LDQ     I,,AUTO
        10 007750   000110 402007                    MPY     72,DL
        10 007751   221702 720100                    LXL0    LEN,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:338  
        10 007752   221700 721100                    LXL1    DIFF,,AUTO
        10 007753   040140 106446                    CMPC    fill='040'O
        10 007754   000735 200010 1                  ADSC9   REWRITE+2,Q              cn=1,n=*X0
        10 007755   221703 000011                    ADSC9   TBUF,,AUTO               cn=0,n=*X1
        10 007756   007773 601000 10                 TNZ     s:14675

     2109    14668    6                           SUBSTR( TBUF, 0, DIFF) THEN DO;

     2110    14669    6                       IF TMP2 ~= -1 THEN

  14669 10 007757   221677 235100                    LDA     TMP2,,AUTO
        10 007760   000027 115000 xsym               CMPA    B_VECTNIL+23
        10 007761   007766 600000 10                 TZE     s:14671

     2111    14670    6                           SUBSTR( TEXT.TXT, TMP2, 1) = '@';

  14670 10 007762   221675 470500                    LDP0    @TEXT,,AUTO
        10 007763   040105 100400                    MLR     fill='040'O
        10 007764   000107 000001 11                 ADSC9   71                       cn=0,n=1
        10 007765   000000 200001                    ADSC9   0,A,PR0                  cn=1,n=1

     2112    14671    6                       TEXT.LEN = TEMP;

  14671 10 007766   221675 470500                    LDP0    @TEXT,,AUTO
        10 007767   000100 101500                    MRL     fill='000'O
        10 007770   221676 000004                    ADSC9   TEMP,,AUTO               cn=0,n=4
        10 007771   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     2113    14672    6                       GOTO BEGINNING;

  14672 10 007772   007661 710000 10                 TRA     BEGINNING

     2114    14673    6                       END;
     2115    14674    5                   END;
     2116    14675    4               END;

  14675 10 007773   221701 054100                    AOS     I,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:339  
        10 007774   221701 236100                    LDQ     I,,AUTO
        10 007775   221416 116100                    CMPQ    REWRITES,,AUTO
        10 007776   007737 604000 10                 TMI     s:14665

     2117    14676    3           END;

     2118    14677    2       ALTRETURN;

  14677 10 007777   221674 221300                    LDX1  ! TBUF+8,,AUTO
        10 010000   000000 702211                    TSX2  ! 0,X1

     2119    14678
     2120    14679    2       END FIXLOCAL;
     2121    14680        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:340  
     2122    14681    1   LOOKUP_ALIAS: PROC( ADDRESS$) ALTRET;

  14681 10 010001   221674 741300       LOOKUP_ALIAS STX1  ! TBUF+8,,AUTO

     2123    14682
     2124    14683    2       DCL ADDRESS$ PTR;
     2125    14684    2       DCL DASH_INDEX UBIN WORD;
     2126    14685    2       DCL DOT_INDEX UBIN WORD;
     2127    14686    2       DCL MATCHLEN UBIN WORD;
     2128    14687    2       DCL MATCHSTRING CHAR( %USER_SIZE);
     2129    14688    2       DCL PCT_INDEX UBIN WORD;
     2130    14689    2       DCL SIZE UBIN;
     2131    14690    2       DCL TEMPBUF CHAR( %USER_SIZE);
     2132    14691    2       DCL TEMPCHAR( 0:%( USER_SIZE-1)) REDEF TEMPBUF UBIN BYTE CALIGNED;
     2133    14692    2       DCL TRIMMEDSIZE UBIN;
     2134    14693    2       DCL TSLEN UBIN WORD;
     2135    14694    2       DCL TSTRING CHAR( %USER_SIZE);
     2136    14695    2       DCL TVAL UBIN WORD;
     2137    14696    2       DCL USEFUL_LENGTH UBIN;
     2138    14697    2       DCL 1 USER,
     2139    14698    2            2 C UBIN BYTE CALIGNED,
     2140    14699    2            2 T CHAR( 511);
     2141    14700    2       DCL USER$ PTR;
     2142    14701
     2143    14702    2       USER$ = ADDR( USER);

  14702 10 010002   221767 630500                    EPPR0   USER,,AUTO
        10 010003   222167 450500                    STP0    USER$,,AUTO

     2144    14703    2       REPLY$ = R550$;

  14703 10 010004   000035 236000 2                  LDQ     R550$
        10 010005   000722 756000 1                  STQ     REPLY$

     2145    14704    3       IF TCM_DRIBBLE OR TCM_DRIBBLE_ME THEN DO;

  14704 10 010006   000216 235000 1                  LDA     TCM_DRIBBLE
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:341  
        10 010007   010012 601000 10                 TNZ     s:14705
        10 010010   000217 235000 1                  LDA     TCM_DRIBBLE_ME
        10 010011   010066 600000 10                 TZE     s:14712

     2146    14705    3           CALL CONCAT( OCMSG, '-->',

  14705 10 010012   221675 471500                    LDP1    @ADDRESS$,,AUTO
        10 010013   100000 473500                    LDP3    0,,PR1
        10 010014   000100 101500                    MRL     fill='000'O
        10 010015   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 010016   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010017   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010020   100000 474500                    LDP4    0,,PR1
        10 010021   000100 101500                    MRL     fill='000'O
        10 010022   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        10 010023   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 010024   222251 222100                    LDX2    TVAL+2,,AUTO
        10 010025   002310 236000 2                  LDQ     XSERRMSG+219
        10 010026   000075 376000 11                 ANQ     61
        10 010027   000040 276007                    ORQ     32,DL
        10 010030   003267 756000 1                  STQ     OCMSG
        10 010031   040000 100540                    MLR     fill='040'O
        10 010032   300000 200012                    ADSC9   0,,PR3                   cn=1,n=*X2
        10 010033   003267 600374 1                  ADSC9   OCMSG                    cn=3,n=252
        10 010034   000000 636012                    EAQ     0,X2
        10 010035   000022 772000                    QRL     18
        10 010036   000374 116007                    CMPQ    252,DL
        10 010037   010050 603000 10                 TRC     s:14708
        10 010040   222252 742100                    STX2    TVAL+3,,AUTO
        10 010041   777403 622012                    EAX2    -253,X2
        10 010042   777777 662003                    ERX2    -1,DU
        10 010043   222252 235100                    LDA     TVAL+3,,AUTO
        10 010044   000022 771000                    ARL     18
        10 010045   040045 100400                    MLR     fill='040'O
        10 010046   002311 000003 2                  ADSC9   XSERRMSG+220             cn=0,n=3
        10 010047   003267 600012 1                  ADSC9   OCMSG,A                  cn=3,n=*X2

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:342  
     2147    14706    3                   SUBSTR( ADDRESS$->TEXTC.T, 0, ADDRESS$->TEXTC.L),
     2148    14707    3                   '<--');
     2149    14708    3           WRITE_DRIBBLE.BUF_ = VECTOR(

  14708 10 010050   100000 473500                    LDP3    0,,PR1
        10 010051   000100 101500                    MRL     fill='000'O
        10 010052   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 010053   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010054   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010055   000006 622010                    EAX2    6,X0
        10 010056   000000 635012                    EAA     0,X2
        10 010057   000002 771000                    ARL     2
        10 010060   000140 135007                    SBLA    96,DL
        10 010061   000033 236000 11                 LDQ     27
        10 010062   003516 757000 1                  STAQ    WRITE_DRIBBLE+4

     2150    14709    3                   SUBSTR( OCMSG, 0, 6 + ADDRESS$->TEXTC.L));
     2151    14710    3           CALL M$WRITE( WRITE_DRIBBLE);

  14710 10 010063   003512 630400 1                  EPPR0   WRITE_DRIBBLE
        10 010064   040001 713400                    CLIMB   write
        10 010065   401400 401760                    pmme    nvectors=4

     2152    14711    3           END;

     2153    14712    2       CALL MOVE_STRING( ADDRESS$, USER$, 511) ALTRET( GOTO_ALTRET);

  14712 10 010066   000120 236000 11                 LDQ     80
        10 010067   222173 756100                    STQ     @TO$+1,,AUTO
        10 010070   222167 630500                    EPPR0   USER$,,AUTO
        10 010071   222172 450500                    STP0    @FROM$+1,,AUTO
        10 010072   221675 236100                    LDQ     @ADDRESS$,,AUTO
        10 010073   222171 756100                    STQ     USER$+2,,AUTO
        10 010074   011665 701000 10                 TSX1    MOVE_STRING
        10 010075   011014 702000 10                 TSX2    GOTO_ALTRET

     2154    14713            /* The mailbox ID may contains a sub-site specification <name%site@...,
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:343  
     2155    14714            or name%site.CP6@...>.  The specified "site" must be in the :NODES file.
     2156    14715            If it is, convert the address format to suit MAIL;  if not, complain. */
     2157    14716    2       CALL INDEX1R( PCT_INDEX, '%', ADDRESS$->TEXTC.T) ALTRET( THIS_SITE);

  14716 10 010076   221675 470500                    LDP0    @ADDRESS$,,AUTO
        10 010077   000000 471500                    LDP1    0,,PR0
        10 010100   000100 101500                    MRL     fill='000'O
        10 010101   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 010102   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010103   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010104   000000 636010                    EAQ     0,X0
        10 010105   000022 772000                    QRL     18
        10 010106   000000 125540                    SCMR    mask='000'O
        10 010107   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        10 010110   000114 000001 11                 ADSC9   76                       cn=0,n=1
        10 010111   221721 000100                    ARG     PCT_INDEX,,AUTO
        10 010112   010250 606400 10                 TTN     THIS_SITE
        10 010113   221721 054100                    AOS     PCT_INDEX,,AUTO
        10 010114   221721 156100                    SSQ     PCT_INDEX,,AUTO

     2158    14717    2       CALL INDEX( DOT_INDEX, '.', ADDRESS$->TEXTC.T, PCT_INDEX)

  14717 10 010115   000000 471500                    LDP1    0,,PR0
        10 010116   000100 101500                    MRL     fill='000'O
        10 010117   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 010120   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010121   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010122   000000 636010                    EAQ     0,X0
        10 010123   000022 772000                    QRL     18
        10 010124   221721 136100                    SBLQ    PCT_INDEX,,AUTO
        10 010125   222251 756100                    STQ     TVAL+2,,AUTO
        10 010126   221721 236100                    LDQ     PCT_INDEX,,AUTO
        10 010127   222251 721100                    LXL1    TVAL+2,,AUTO
        10 010130   221721 235100                    LDA     PCT_INDEX,,AUTO
        10 010131   000000 124545                    SCM     mask='000'O
        10 010132   100000 200011                    ADSC9   0,A,PR1                  cn=1,n=*X1
        10 010133   000034 000001 11                 ADSC9   28                       cn=0,n=1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:344  
        10 010134   221677 000100                    ARG     DOT_INDEX,,AUTO
        10 010135   221677 056100                    ASQ     DOT_INDEX,,AUTO
        10 010136   010203 606400 10                 TTN     s:14726

     2159    14718    3       WHENRETURN DO;

     2160    14719    3           IF SUBSTR( ADDRESS$->TEXTC.T, DOT_INDEX+1) ~= 'CP6' AND

  14719 10 010137   000000 471500                    LDP1    0,,PR0
        10 010140   000100 101500                    MRL     fill='000'O
        10 010141   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 010142   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010143   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010144   000000 636010                    EAQ     0,X0
        10 010145   000022 772000                    QRL     18
        10 010146   221677 136100                    SBLQ    DOT_INDEX,,AUTO
        10 010147   777777 621006                    EAX1    -1,QL
        10 010150   221677 236100                    LDQ     DOT_INDEX,,AUTO
        10 010151   040000 106546                    CMPC    fill='040'O
        10 010152   100000 400011                    ADSC9   0,Q,PR1                  cn=2,n=*X1
        10 010153   002312 000003 2                  ADSC9   XSERRMSG+221             cn=0,n=3
        10 010154   010177 600000 10                 TZE     s:14724
        10 010155   000000 471500                    LDP1    0,,PR0
        10 010156   000100 101500                    MRL     fill='000'O
        10 010157   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 010160   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 010161   222251 221100                    LDX1    TVAL+2,,AUTO
        10 010162   000000 636011                    EAQ     0,X1
        10 010163   000022 772000                    QRL     18
        10 010164   221677 136100                    SBLQ    DOT_INDEX,,AUTO
        10 010165   777777 622006                    EAX2    -1,QL
        10 010166   221677 236100                    LDQ     DOT_INDEX,,AUTO
        10 010167   040000 106546                    CMPC    fill='040'O
        10 010170   100000 400012                    ADSC9   0,Q,PR1                  cn=2,n=*X2
        10 010171   002313 000003 2                  ADSC9   XSERRMSG+222             cn=0,n=3
        10 010172   010177 600000 10                 TZE     s:14724

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:345  
     2161    14720    4                   SUBSTR( ADDRESS$->TEXTC.T, DOT_INDEX + 1) ~= 'cp6' THEN DO;

     2162    14721    4               REPLY$ = R550NODOMAIN$;

  14721 10 010173   000037 236000 2                  LDQ     R550NODOMAIN$
        10 010174   000722 756000 1                  STQ     REPLY$

     2163    14722    4               ALTRETURN;

  14722 10 010175   221674 221300                    LDX1  ! TBUF+8,,AUTO
        10 010176   000000 702211                    TSX2  ! 0,X1

     2164    14723    4               END;
     2165    14724    3           ADDRESS$->TEXTC.L = DOT_INDEX;

  14724 10 010177   000000 471500                    LDP1    0,,PR0
        10 010200   000100 101500                    MRL     fill='000'O
        10 010201   221677 000004                    ADSC9   DOT_INDEX,,AUTO          cn=0,n=4
        10 010202   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     2166    14725    3           END;

     2167    14726    3       IF NOT NODES_FILE_OPEN THEN DO;

  14726 10 010203   200013 234100                    SZN     NODES_FILE_OPEN,,AUTO
        10 010204   010211 604000 10                 TMI     s:14730

     2168    14727    3           REPLY$ = R550NONODE$;

  14727 10 010205   000036 236000 2                  LDQ     R550NONODE$
        10 010206   000722 756000 1                  STQ     REPLY$

     2169    14728    3           ALTRETURN;

  14728 10 010207   221674 221300                    LDX1  ! TBUF+8,,AUTO
        10 010210   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:346  
     2170    14729    3           END;
     2171    14730    2       CALL XLATE( NODES_KEY.SITE, TCM_XLATE_TO_UC,

  14730 10 010211   221675 470500                    LDP0    @ADDRESS$,,AUTO
        10 010212   000000 471500                    LDP1    0,,PR0
        10 010213   000100 101500                    MRL     fill='000'O
        10 010214   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 010215   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010216   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010217   221677 236100                    LDQ     DOT_INDEX,,AUTO
        10 010220   221721 136100                    SBLQ    PCT_INDEX,,AUTO
        10 010221   777777 621006                    EAX1    -1,QL
        10 010222   221721 235100                    LDA     PCT_INDEX,,AUTO
        10 010223   040000 160545                    MVT     fill='040'O
        10 010224   100000 400011                    ADSC9   0,A,PR1                  cn=2,n=*X1
        10 010225   003405 200010 1                  ADSC9   NODES_KEY                cn=1,n=8
        10 010226   000060 000000 2                  ARG     TCM_XLATE_TO_UC

     2172    14731    2               SUBSTR( ADDRESS$->TEXTC.T, PCT_INDEX + 1,
     2173    14732    2               DOT_INDEX - PCT_INDEX - 1));
     2174    14733    3       IF NODES_KEY.SITE ~= MY_SITE_NAME THEN DO;

  14733 10 010227   040000 106400                    CMPC    fill='040'O
        10 010230   003405 200010 1                  ADSC9   NODES_KEY                cn=1,n=8
        10 010231   003265 000010 1                  ADSC9   MY_SITE_NAME             cn=0,n=8
        10 010232   010244 600000 10                 TZE     s:14740

     2175    14734    3           CALL M$PRECORD( POSITION_NODES)

  14734 10 010233   000750 630400 2                  EPPR0   POSITION_NODES
        10 010234   440003 713400                    CLIMB   alt,+16387
        10 010235   401000 401760                    pmme    nvectors=3
        10 010236   010240 702000 10                 TSX2    s:14736
        10 010237   010244 710000 10                 TRA     s:14740

     2176    14735    4           WHENALTRETURN DO;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:347  
     2177    14736    4               REPLY$ = R550NOSITE$;

  14736 10 010240   000040 236000 2                  LDQ     R550NOSITE$
        10 010241   000722 756000 1                  STQ     REPLY$

     2178    14737    4               ALTRETURN;

  14737 10 010242   221674 221300                    LDX1  ! TBUF+8,,AUTO
        10 010243   000000 702211                    TSX2  ! 0,X1

     2179    14738    4               END;
     2180    14739    3           END;

     2181    14740    2       CALL SETUP_REPLY_250V;

  14740 10 010244   011016 701000 10                 TSX1    SETUP_REPLY_250V
        10 010245   000000 011000                    NOP     0

     2182    14741    2       RETURN;

  14741 10 010246   221674 221300                    LDX1  ! TBUF+8,,AUTO
        10 010247   000001 702211                    TSX2  ! 1,X1

     2183    14742    2   THIS_SITE:
     2184    14743    2       IF SUBSTR( USER$->TEXTC.T, 0, 1) = '.' THEN

  14743 10 010250   222167 470500       THIS_SITE    LDP0    USER$,,AUTO
        10 010251   000100 101500                    MRL     fill='000'O
        10 010252   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 010253   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010254   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010255   040000 106500                    CMPC    fill='040'O
        10 010256   000000 200001                    ADSC9   0,,PR0                   cn=1,n=1
        10 010257   000034 000001 11                 ADSC9   28                       cn=0,n=1
        10 010260   010263 601000 10                 TNZ     s:14746

     2185    14744    2           SUPPRESS_HEADERS = %NO#;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:348  

  14744 10 010261   200012 450100                    STZ     SUPPRESS_HEADERS,,AUTO
        10 010262   010271 710000 10                 TRA     s:14747

     2186    14745    2       ELSE
     2187    14746    2           CALL LOOKUP_REGISTRATION( USER$, USEFUL_LENGTH) ALTRET( TRY_UNLINEING);

  14746 10 010263   221766 631500                    EPPR1   USEFUL_LENGTH,,AUTO
        10 010264   222172 451500                    STP1    @FROM$+1,,AUTO
        10 010265   222167 633500                    EPPR3   USER$,,AUTO
        10 010266   222171 453500                    STP3    USER$+2,,AUTO
        10 010267   011154 701000 10                 TSX1    LOOKUP_REGISTRATION
        10 010270   010275 702000 10                 TSX2    TRY_UNLINEING

     2188    14747    2       CALL SETUP_REPLY_250V;

  14747 10 010271   011016 701000 10                 TSX1    SETUP_REPLY_250V
        10 010272   000000 011000                    NOP     0

     2189    14748    2       RETURN;

  14748 10 010273   221674 221300                    LDX1  ! TBUF+8,,AUTO
        10 010274   000001 702211                    TSX2  ! 1,X1

     2190    14749    2   TRY_UNLINEING:
     2191    14750            /* Turn underlines in mailbox ID into blanks; try again. */
     2192    14751    2       CALL INDEX( DASH_INDEX, '_', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));

  14751 10 010275   222167 470500       TRY_UNLINEI* LDP0    USER$,,AUTO
        10 010276   000100 101500                    MRL     fill='000'O
        10 010277   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 010300   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010301   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010302   221766 721100                    LXL1    USEFUL_LENGTH,,AUTO
        10 010303   000000 124540                    SCM     mask='000'O
        10 010304   000000 200011                    ADSC9   0,,PR0                   cn=1,n=*X1
        10 010305   000121 000001 11                 ADSC9   81                       cn=0,n=1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:349  
        10 010306   221676 000100                    ARG     DASH_INDEX,,AUTO

     2193    14752    3       DO WHILE( DASH_INDEX < USEFUL_LENGTH);

  14752 10 010307   221676 236100                    LDQ     DASH_INDEX,,AUTO
        10 010310   221766 116100                    CMPQ    USEFUL_LENGTH,,AUTO
        10 010311   010340 603000 10                 TRC     s:14756

     2194    14753    3           SUBSTR( USER$->TEXTC.T, DASH_INDEX, 1) = ' ';

  14753 10 010312   222167 470500                    LDP0    USER$,,AUTO
        10 010313   000100 101500                    MRL     fill='000'O
        10 010314   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 010315   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010316   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010317   221676 235100                    LDA     DASH_INDEX,,AUTO
        10 010320   040105 100400                    MLR     fill='040'O
        10 010321   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 010322   000000 200001                    ADSC9   0,A,PR0                  cn=1,n=1

     2195    14754    3           CALL INDEX( DASH_INDEX, '_', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));

  14754 10 010323   222167 470500                    LDP0    USER$,,AUTO
        10 010324   000100 101500                    MRL     fill='000'O
        10 010325   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 010326   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010327   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010330   221766 721100                    LXL1    USEFUL_LENGTH,,AUTO
        10 010331   000000 124540                    SCM     mask='000'O
        10 010332   000000 200011                    ADSC9   0,,PR0                   cn=1,n=*X1
        10 010333   000121 000001 11                 ADSC9   81                       cn=0,n=1
        10 010334   221676 000100                    ARG     DASH_INDEX,,AUTO

     2196    14755    3           END;

  14755 10 010335   221676 236100                    LDQ     DASH_INDEX,,AUTO
        10 010336   221766 116100                    CMPQ    USEFUL_LENGTH,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:350  
        10 010337   010312 602000 10                 TNC     s:14753

     2197    14756    2       CALL LOOKUP_REGISTRATION( USER$, USEFUL_LENGTH) ALTRET( TRY_UNDOTTING);

  14756 10 010340   221766 631500                    EPPR1   USEFUL_LENGTH,,AUTO
        10 010341   222172 451500                    STP1    @FROM$+1,,AUTO
        10 010342   222167 633500                    EPPR3   USER$,,AUTO
        10 010343   222171 453500                    STP3    USER$+2,,AUTO
        10 010344   011154 701000 10                 TSX1    LOOKUP_REGISTRATION
        10 010345   010370 702000 10                 TSX2    TRY_UNDOTTING

     2198    14757    2   FOUNDEM:
     2199    14758    2       CALL SETUP_REPLY_250V;

  14758 10 010346   011016 701000 10    FOUNDEM      TSX1    SETUP_REPLY_250V
        10 010347   000000 011000                    NOP     0

     2200    14759    2       ADDRESS$->TEXTC.T = USER$->TEXTC.T;

  14759 10 010350   221675 470500                    LDP0    @ADDRESS$,,AUTO
        10 010351   000000 471500                    LDP1    0,,PR0
        10 010352   000100 101500                    MRL     fill='000'O
        10 010353   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 010354   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010355   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010356   222167 473500                    LDP3    USER$,,AUTO
        10 010357   000100 101500                    MRL     fill='000'O
        10 010360   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 010361   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 010362   222251 221100                    LDX1    TVAL+2,,AUTO
        10 010363   040140 100540                    MLR     fill='040'O
        10 010364   300000 200011                    ADSC9   0,,PR3                   cn=1,n=*X1
        10 010365   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0

     2201    14760    2       RETURN;

  14760 10 010366   221674 221300                    LDX1  ! TBUF+8,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:351  
        10 010367   000001 702211                    TSX2  ! 1,X1

     2202    14761    2   TRY_UNDOTTING:
     2203    14762            /* Turn dots in mailbox ID into blanks; try again. */
     2204    14763    2       CALL INDEX( DASH_INDEX, '.', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));

  14763 10 010370   222167 470500       TRY_UNDOTTI* LDP0    USER$,,AUTO
        10 010371   000100 101500                    MRL     fill='000'O
        10 010372   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 010373   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010374   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010375   221766 721100                    LXL1    USEFUL_LENGTH,,AUTO
        10 010376   000000 124540                    SCM     mask='000'O
        10 010377   000000 200011                    ADSC9   0,,PR0                   cn=1,n=*X1
        10 010400   000034 000001 11                 ADSC9   28                       cn=0,n=1
        10 010401   221676 000100                    ARG     DASH_INDEX,,AUTO

     2205    14764    3       DO WHILE( DASH_INDEX < USEFUL_LENGTH);

  14764 10 010402   221676 236100                    LDQ     DASH_INDEX,,AUTO
        10 010403   221766 116100                    CMPQ    USEFUL_LENGTH,,AUTO
        10 010404   010433 603000 10                 TRC     s:14768

     2206    14765    3           SUBSTR( USER$->TEXTC.T, DASH_INDEX, 1) = ' ';

  14765 10 010405   222167 470500                    LDP0    USER$,,AUTO
        10 010406   000100 101500                    MRL     fill='000'O
        10 010407   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 010410   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010411   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010412   221676 235100                    LDA     DASH_INDEX,,AUTO
        10 010413   040105 100400                    MLR     fill='040'O
        10 010414   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 010415   000000 200001                    ADSC9   0,A,PR0                  cn=1,n=1

     2207    14766    3           CALL INDEX( DASH_INDEX, '.', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:352  
  14766 10 010416   222167 470500                    LDP0    USER$,,AUTO
        10 010417   000100 101500                    MRL     fill='000'O
        10 010420   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 010421   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010422   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010423   221766 721100                    LXL1    USEFUL_LENGTH,,AUTO
        10 010424   000000 124540                    SCM     mask='000'O
        10 010425   000000 200011                    ADSC9   0,,PR0                   cn=1,n=*X1
        10 010426   000034 000001 11                 ADSC9   28                       cn=0,n=1
        10 010427   221676 000100                    ARG     DASH_INDEX,,AUTO

     2208    14767    3           END;

  14767 10 010430   221676 236100                    LDQ     DASH_INDEX,,AUTO
        10 010431   221766 116100                    CMPQ    USEFUL_LENGTH,,AUTO
        10 010432   010405 602000 10                 TNC     s:14765

     2209    14768    2       CALL LOOKUP_REGISTRATION( USER$, USEFUL_LENGTH) ALTRET( TRY_UNDASHING);

  14768 10 010433   221766 631500                    EPPR1   USEFUL_LENGTH,,AUTO
        10 010434   222172 451500                    STP1    @FROM$+1,,AUTO
        10 010435   222167 633500                    EPPR3   USER$,,AUTO
        10 010436   222171 453500                    STP3    USER$+2,,AUTO
        10 010437   011154 701000 10                 TSX1    LOOKUP_REGISTRATION
        10 010440   010442 702000 10                 TSX2    TRY_UNDASHING

     2210    14769    2       GOTO FOUNDEM;

  14769 10 010441   010346 710000 10                 TRA     FOUNDEM

     2211    14770    2   TRY_UNDASHING:
     2212    14771            /* Turn dashes in mailbox ID into blanks; try again. */
     2213    14772    2       CALL INDEX( DASH_INDEX, '-', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));

  14772 10 010442   222167 470500       TRY_UNDASHI* LDP0    USER$,,AUTO
        10 010443   000100 101500                    MRL     fill='000'O
        10 010444   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:353  
        10 010445   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010446   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010447   221766 721100                    LXL1    USEFUL_LENGTH,,AUTO
        10 010450   000000 124540                    SCM     mask='000'O
        10 010451   000000 200011                    ADSC9   0,,PR0                   cn=1,n=*X1
        10 010452   000122 000001 11                 ADSC9   82                       cn=0,n=1
        10 010453   221676 000100                    ARG     DASH_INDEX,,AUTO

     2214    14773    3       DO WHILE( DASH_INDEX < USEFUL_LENGTH);

  14773 10 010454   221676 236100                    LDQ     DASH_INDEX,,AUTO
        10 010455   221766 116100                    CMPQ    USEFUL_LENGTH,,AUTO
        10 010456   010505 603000 10                 TRC     s:14777

     2215    14774    3           SUBSTR( USER$->TEXTC.T, DASH_INDEX, 1) = ' ';

  14774 10 010457   222167 470500                    LDP0    USER$,,AUTO
        10 010460   000100 101500                    MRL     fill='000'O
        10 010461   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 010462   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010463   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010464   221676 235100                    LDA     DASH_INDEX,,AUTO
        10 010465   040105 100400                    MLR     fill='040'O
        10 010466   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 010467   000000 200001                    ADSC9   0,A,PR0                  cn=1,n=1

     2216    14775    3           CALL INDEX( DASH_INDEX, '-', SUBSTR( USER$->TEXTC.T, 0, USEFUL_LENGTH));

  14775 10 010470   222167 470500                    LDP0    USER$,,AUTO
        10 010471   000100 101500                    MRL     fill='000'O
        10 010472   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 010473   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010474   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010475   221766 721100                    LXL1    USEFUL_LENGTH,,AUTO
        10 010476   000000 124540                    SCM     mask='000'O
        10 010477   000000 200011                    ADSC9   0,,PR0                   cn=1,n=*X1
        10 010500   000122 000001 11                 ADSC9   82                       cn=0,n=1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:354  
        10 010501   221676 000100                    ARG     DASH_INDEX,,AUTO

     2217    14776    3           END;

  14776 10 010502   221676 236100                    LDQ     DASH_INDEX,,AUTO
        10 010503   221766 116100                    CMPQ    USEFUL_LENGTH,,AUTO
        10 010504   010457 602000 10                 TNC     s:14774

     2218    14777    2       CALL LOOKUP_REGISTRATION( USER$, USEFUL_LENGTH) ALTRET( NOT_REGISTERED);

  14777 10 010505   221766 631500                    EPPR1   USEFUL_LENGTH,,AUTO
        10 010506   222172 451500                    STP1    @FROM$+1,,AUTO
        10 010507   222167 633500                    EPPR3   USER$,,AUTO
        10 010510   222171 453500                    STP3    USER$+2,,AUTO
        10 010511   011154 701000 10                 TSX1    LOOKUP_REGISTRATION
        10 010512   010514 702000 10                 TSX2    NOT_REGISTERED

     2219    14778    2       GOTO FOUNDEM;

  14778 10 010513   010346 710000 10                 TRA     FOUNDEM

     2220    14779    2   NOT_REGISTERED:
     2221    14780    2       IF REPLY$ ~= R550$ THEN

  14780 10 010514   000722 236000 1     NOT_REGISTE* LDQ     REPLY$
        10 010515   000035 116000 2                  CMPQ    R550$
        10 010516   010521 600000 10                 TZE     s:14787

     2222    14781    2           ALTRETURN;

  14781 10 010517   221674 221300                    LDX1  ! TBUF+8,,AUTO
        10 010520   000000 702211                    TSX2  ! 0,X1

     2223    14782            /* User is not registered under the specified name.  Convert the name to
     2224    14783            upper case, and scan through the alias file looking for any registered
     2225    14784            user or list of users whose name resembles( contains) the name given to
     2226    14785            us by SMTP. If only one match occurs, return the identity of that user;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:355  
     2227    14786            if no match, respond "Unknown";  if more than one, respond "Ambiguous". */
     2228    14787    2       CALL XLATE( TSTRING, TCM_XLATE_TO_UC, USER.T);

  14787 10 010521   040100 160500                    MVT     fill='040'O
        10 010522   221767 200777                    ADSC9   USER,,AUTO               cn=1,n=511
        10 010523   221745 000100                    ADSC9   TSTRING,,AUTO            cn=0,n=64
        10 010524   000060 000000 2                  ARG     TCM_XLATE_TO_UC

     2229    14788    2       USER.T = TSTRING;

  14788 10 010525   040100 100500                    MLR     fill='040'O
        10 010526   221745 000100                    ADSC9   TSTRING,,AUTO            cn=0,n=64
        10 010527   221767 200777                    ADSC9   USER,,AUTO               cn=1,n=511

     2230    14789    2       POSITION_ALIAS.V.KEYS# = %YES#;

  14789 10 010530   400000 236007                    LDQ     -131072,DL
        10 010531   003506 256000 1                  ORSQ    POSITION_ALIAS+6

     2231    14790    2       POSITION_ALIAS.V.KEYR# = %YES#;

  14790 10 010532   200000 236007                    LDQ     65536,DL
        10 010533   003506 256000 1                  ORSQ    POSITION_ALIAS+6

     2232    14791    2       POSITION_ALIAS.KEY_ = VECTOR( VM_SEARCHKEY);

  14791 10 010534   000124 237000 11                 LDAQ    84
        10 010535   003502 757000 1                  STAQ    POSITION_ALIAS+2

     2233    14792    2       VM_SEARCHKEY.COUNT = 1;

  14792 10 010536   001000 236003                    LDQ     512,DU
        10 010537   004306 552040 1                  STBQ    VM_SEARCHKEY,'40'O

     2234    14793    2       VM_SEARCHKEY.TYPE = %VM_TYPE_LIST;

  14793 10 010540   000074 236003                    LDQ     60,DU
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:356  
        10 010541   004306 552020 1                  STBQ    VM_SEARCHKEY,'20'O

     2235    14794    2       CALL M$PRECORD( POSITION_ALIAS)

  14794 10 010542   003500 630400 1                  EPPR0   POSITION_ALIAS
        10 010543   440003 713400                    CLIMB   alt,+16387
        10 010544   401000 401760                    pmme    nvectors=3
        10 010545   010547 702000 10                 TSX2    s:14797
        10 010546   010547 710000 10                 TRA     s:14797

     2236    14795    3       WHENALTRETURN DO;

     2237    14796    3           END;

     2238    14797    2       POSITION_ALIAS.V.N# = 1;

  14797 10 010547   000001 235007                    LDA     1,DL
        10 010550   003507 755000 1                  STA     POSITION_ALIAS+7

     2239    14798    2       POSITION_ALIAS.V.KEYS# = %NO#;

  14798 10 010551   000123 236000 11                 LDQ     83
        10 010552   003506 356000 1                  ANSQ    POSITION_ALIAS+6

     2240    14799    2       MATCHLEN = 0;

  14799 10 010553   221700 450100                    STZ     MATCHLEN,,AUTO

     2241    14800    3       DO WHILE( VM_SEARCHKEY.COUNT ~= 0);

  14800 10 010554   004306 236000 1                  LDQ     VM_SEARCHKEY
        10 010555   777000 316003                    CANQ    -512,DU
        10 010556   010624 600000 10                 TZE     s:14816

     2242    14801    3           TSLEN = VM_SEARCHKEY.COUNT - 1;

  14801 10 010557   004306 236000 1                  LDQ     VM_SEARCHKEY
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:357  
        10 010560   000033 772000                    QRL     27
        10 010561   000001 136007                    SBLQ    1,DL
        10 010562   221744 756100                    STQ     TSLEN,,AUTO

     2243    14802    3           TSTRING = SUBSTR( VM_SEARCHKEY.TEXT, 0, TSLEN);

  14802 10 010563   000000 620006                    EAX0    0,QL
        10 010564   040100 100440                    MLR     fill='040'O
        10 010565   004306 400010 1                  ADSC9   VM_SEARCHKEY             cn=2,n=*X0
        10 010566   221745 000100                    ADSC9   TSTRING,,AUTO            cn=0,n=64

     2244    14803    3           CALL INDEX( TVAL, SUBSTR( USER.T, 0, USEFUL_LENGTH), TSTRING)

  14803 10 010567   221765 631500                    EPPR1   TVAL,,AUTO
        10 010570   221767 633500                    EPPR3   USER,,AUTO
        10 010571   000001 220003                    LDX0    1,DU
        10 010572   300000 500510                    A9BD    0,X0,PR3
        10 010573   221766 723100                    LXL3    USEFUL_LENGTH,,AUTO
        10 010574   221745 630500                    EPPR0   TSTRING,,AUTO
        10 010575   000100 220003                    LDX0    64,DU
        10 010576   000000 236003                    LDQ     0,DU
        10 010577   000000 701000 xent               TSX1    X66_INDEX
        10 010600   010614 710000 10                 TRA     s:14812

     2245    14804    4           WHENRETURN DO;

     2246    14805    5               IF MATCHLEN > 0 THEN DO;

  14805 10 010601   221700 235100                    LDA     MATCHLEN,,AUTO
        10 010602   010607 600000 10                 TZE     s:14809

     2247    14806    5                   REPLY$ = R553$;

  14806 10 010603   000043 236000 2                  LDQ     R553$
        10 010604   000722 756000 1                  STQ     REPLY$

     2248    14807    5                   ALTRETURN;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:358  

  14807 10 010605   221674 221300                    LDX1  ! TBUF+8,,AUTO
        10 010606   000000 702211                    TSX2  ! 0,X1

     2249    14808    5                   END;
     2250    14809    4               MATCHLEN = TSLEN;

  14809 10 010607   221744 236100                    LDQ     TSLEN,,AUTO
        10 010610   221700 756100                    STQ     MATCHLEN,,AUTO

     2251    14810    4               MATCHSTRING = TSTRING;

  14810 10 010611   040100 100500                    MLR     fill='040'O
        10 010612   221745 000100                    ADSC9   TSTRING,,AUTO            cn=0,n=64
        10 010613   221701 000100                    ADSC9   MATCHSTRING,,AUTO        cn=0,n=64

     2252    14811    4               END;

     2253    14812    3           CALL M$PRECORD( POSITION_ALIAS)

  14812 10 010614   003500 630400 1                  EPPR0   POSITION_ALIAS
        10 010615   440003 713400                    CLIMB   alt,+16387
        10 010616   401000 401760                    pmme    nvectors=3
        10 010617   010621 702000 10                 TSX2    s:14815
        10 010620   010621 710000 10                 TRA     s:14815

     2254    14813    4           WHENALTRETURN DO;

     2255    14814    4               END;

     2256    14815    3           END;

  14815 10 010621   004306 236000 1                  LDQ     VM_SEARCHKEY
        10 010622   777000 316003                    CANQ    -512,DU
        10 010623   010557 601000 10                 TNZ     s:14801

     2257    14816    3       IF MATCHLEN > 0 THEN DO;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:359  

  14816 10 010624   221700 235100                    LDA     MATCHLEN,,AUTO
        10 010625   011014 600000 10                 TZE     GOTO_ALTRET

     2258    14817                /* Found a single user whose real name matches the info supplied by
     2259    14818                the sender.  Respond with the user's full name and mailbox ID, and
     2260    14819                clear the flag which would have suppressed SMTP headers.        */
     2261    14820    3           SUPPRESS_HEADERS = %NO#;

  14820 10 010626   200012 450100                    STZ     SUPPRESS_HEADERS,,AUTO

     2262    14821    3           CALL CONCAT( TSTRING, SUBSTR( MATCHSTRING, 0, MATCHLEN),

  14821 10 010627   221767 236100                    LDQ     USER,,AUTO
        10 010630   000033 772000                    QRL     27
        10 010631   221766 136100                    SBLQ    USEFUL_LENGTH,,AUTO
        10 010632   000000 620005                    EAX0    0,AL
        10 010633   040100 100540                    MLR     fill='040'O
        10 010634   221701 000010                    ADSC9   MATCHSTRING,,AUTO        cn=0,n=*X0
        10 010635   221745 000100                    ADSC9   TSTRING,,AUTO            cn=0,n=64
        10 010636   222250 756100                    STQ     TVAL+1,,AUTO
        10 010637   221700 236100                    LDQ     MATCHLEN,,AUTO
        10 010640   000100 116007                    CMPQ    64,DL
        10 010641   010651 603000 10                 TRC     s:14823
        10 010642   777677 620006                    EAX0    -65,QL
        10 010643   777777 660003                    ERX0    -1,DU
        10 010644   222250 721100                    LXL1    TVAL+1,,AUTO
        10 010645   221766 235100                    LDA     USEFUL_LENGTH,,AUTO
        10 010646   040146 100545                    MLR     fill='040'O
        10 010647   221767 200011                    ADSC9   USER,A,AUTO              cn=1,n=*X1
        10 010650   221745 000010                    ADSC9   TSTRING,Q,AUTO           cn=0,n=*X0

     2263    14822    3                   SUBSTR( USER.T, USEFUL_LENGTH, USER.C - USEFUL_LENGTH));
     2264    14823    3           TSLEN = MATCHLEN + USER.C - USEFUL_LENGTH;

  14823 10 010651   221767 236100                    LDQ     USER,,AUTO
        10 010652   000033 772000                    QRL     27
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:360  
        10 010653   221700 036100                    ADLQ    MATCHLEN,,AUTO
        10 010654   221766 136100                    SBLQ    USEFUL_LENGTH,,AUTO
        10 010655   221744 756100                    STQ     TSLEN,,AUTO

     2265    14824    3           ADDRESS$->TEXTC.L = TSLEN;

  14824 10 010656   221675 470500                    LDP0    @ADDRESS$,,AUTO
        10 010657   000000 471500                    LDP1    0,,PR0
        10 010660   000100 101500                    MRL     fill='000'O
        10 010661   221744 000004                    ADSC9   TSLEN,,AUTO              cn=0,n=4
        10 010662   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     2266    14825    3           ADDRESS$->TEXTC.T = TSTRING;

  14825 10 010663   000000 471500                    LDP1    0,,PR0
        10 010664   000100 101500                    MRL     fill='000'O
        10 010665   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 010666   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010667   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010670   040140 100500                    MLR     fill='040'O
        10 010671   221745 000100                    ADSC9   TSTRING,,AUTO            cn=0,n=64
        10 010672   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0

     2267    14826    3           CALL INSERT( REPLY250V.TEXT, 4, ,

  14826 10 010673   000000 471500                    LDP1    0,,PR0
        10 010674   000100 101500                    MRL     fill='000'O
        10 010675   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 010676   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 010677   222250 220100                    LDX0    TVAL+1,,AUTO
        10 010700   221700 721100                    LXL1    MATCHLEN,,AUTO
        10 010701   040000 100540                    MLR     fill='040'O
        10 010702   221701 000011                    ADSC9   MATCHSTRING,,AUTO        cn=0,n=*X1
        10 010703   000336 200373 1                  ADSC9   REPLY250V+1              cn=1,n=251
        10 010704   221700 236100                    LDQ     MATCHLEN,,AUTO
        10 010705   000373 116007                    CMPQ    251,DL
        10 010706   010771 603000 10                 TRC     s:14830
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:361  
        10 010707   777404 622006                    EAX2    -252,QL
        10 010710   777777 662003                    ERX2    -1,DU
        10 010711   040046 100400                    MLR     fill='040'O
        10 010712   002314 000002 2                  ADSC9   XSERRMSG+223             cn=0,n=2
        10 010713   000336 200012 1                  ADSC9   REPLY250V+1,Q            cn=1,n=*X2
        10 010714   000371 116007                    CMPQ    249,DL
        10 010715   010771 603000 10                 TRC     s:14830
        10 010716   777406 623006                    EAX3    -250,QL
        10 010717   777777 663003                    ERX3    -1,DU
        10 010720   040046 100540                    MLR     fill='040'O
        10 010721   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        10 010722   000336 600013 1                  ADSC9   REPLY250V+1,Q            cn=3,n=*X3
        10 010723   000000 636010                    EAQ     0,X0
        10 010724   000022 772000                    QRL     18
        10 010725   221700 036100                    ADLQ    MATCHLEN,,AUTO
        10 010726   000371 116007                    CMPQ    249,DL
        10 010727   010771 603000 10                 TRC     s:14830
        10 010730   222251 756100                    STQ     TVAL+2,,AUTO
        10 010731   000000 636010                    EAQ     0,X0
        10 010732   000022 772000                    QRL     18
        10 010733   221700 036100                    ADLQ    MATCHLEN,,AUTO
        10 010734   222251 724100                    LXL4    TVAL+2,,AUTO
        10 010735   777406 624014                    EAX4    -250,X4
        10 010736   777777 664003                    ERX4    -1,DU
        10 010737   040046 100400                    MLR     fill='040'O
        10 010740   000107 000001 11                 ADSC9   71                       cn=0,n=1
        10 010741   000336 600014 1                  ADSC9   REPLY250V+1,Q            cn=3,n=*X4
        10 010742   222252 756100                    STQ     TVAL+3,,AUTO
        10 010743   222251 236100                    LDQ     TVAL+2,,AUTO
        10 010744   000370 116007                    CMPQ    248,DL
        10 010745   010771 603000 10                 TRC     s:14830
        10 010746   777407 625006                    EAX5    -249,QL
        10 010747   777777 665003                    ERX5    -1,DU
        10 010750   221420 726100                    LXL6    MY_SITE_NAME_L,,AUTO
        10 010751   222252 235100                    LDA     TVAL+3,,AUTO
        10 010752   040045 100440                    MLR     fill='040'O
        10 010753   003265 000016 1                  ADSC9   MY_SITE_NAME             cn=0,n=*X6
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:362  
        10 010754   000337 000015 1                  ADSC9   REPLY250V+2,A            cn=0,n=*X5
        10 010755   221420 036100                    ADLQ    MY_SITE_NAME_L,,AUTO
        10 010756   000370 116007                    CMPQ    248,DL
        10 010757   010771 603000 10                 TRC     s:14830
        10 010760   222253 756100                    STQ     TVAL+4,,AUTO
        10 010761   222252 236100                    LDQ     TVAL+3,,AUTO
        10 010762   221420 036100                    ADLQ    MY_SITE_NAME_L,,AUTO
        10 010763   222253 727100                    LXL7    TVAL+4,,AUTO
        10 010764   777407 627017                    EAX7    -249,X7
        10 010765   777777 667003                    ERX7    -1,DU
        10 010766   040046 100400                    MLR     fill='040'O
        10 010767   000116 000001 11                 ADSC9   78                       cn=0,n=1
        10 010770   000337 000017 1                  ADSC9   REPLY250V+2,Q            cn=0,n=*X7

     2268    14827    3                   SUBSTR( MATCHSTRING, 0, MATCHLEN), ' <',
     2269    14828    3                   ADDRESS$->TEXTC.T, '@',
     2270    14829    3                   SUBSTR( MY_SITE_NAME, 0, MY_SITE_NAME_L), '>');
     2271    14830    3           CALL SEARCHR( TSLEN, TVAL, TCM_SKIP_BLANKS, REPLY250V.TEXT);

  14830 10 010771   000000 165400                    TCTR
        10 010772   000335 200377 1                  ADSC9   REPLY250V                cn=1,n=255
        10 010773   000260 000000 2                  ARG     TCM_SKIP_BLANKS
        10 010774   221744 000100                    ARG     TSLEN,,AUTO
        10 010775   221744 235100                    LDA     TSLEN,,AUTO
        10 010776   000033 771000                    ARL     27
        10 010777   221765 755100                    STA     TVAL,,AUTO
        10 011000   221744 551140                    STBA    TSLEN,'40'O,AUTO
        10 011001   011004 606400 10                 TTN     s:14831
        10 011002   000376 236007                    LDQ     254,DL
        10 011003   221744 156100                    SSQ     TSLEN,,AUTO

     2272    14831    3           REPLY250V.COUNT = TSLEN + 1;

  14831 10 011004   221744 236100                    LDQ     TSLEN,,AUTO
        10 011005   000001 036007                    ADLQ    1,DL
        10 011006   000033 736000                    QLS     27
        10 011007   000335 552040 1                  STBQ    REPLY250V,'40'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:363  

     2273    14832    3           REPLY$ = R250V$;

  14832 10 011010   000022 236000 2                  LDQ     R250V$
        10 011011   000722 756000 1                  STQ     REPLY$

     2274    14833    3           RETURN;

  14833 10 011012   221674 221300                    LDX1  ! TBUF+8,,AUTO
        10 011013   000001 702211                    TSX2  ! 1,X1

     2275    14834    3           END;
     2276    14835    2   GOTO_ALTRET:
     2277    14836    2       ALTRETURN;

  14836 10 011014   221674 221300       GOTO_ALTRET  LDX1  ! TBUF+8,,AUTO
        10 011015   000000 702211                    TSX2  ! 0,X1

     2278    14837
     2279    14838    2   SETUP_REPLY_250V: PROC;

  14838 10 011016   222170 741300       SETUP_REPLY* STX1  ! USER$+1,,AUTO

     2280    14839
     2281    14840    3       CALL CONCAT( REPLY250V.TEXT, '250 ', USER$->TEXTC.T,

  14840 10 011017   222167 470500                    LDP0    USER$,,AUTO
        10 011020   000100 101500                    MRL     fill='000'O
        10 011021   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        10 011022   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 011023   222250 220100                    LDX0    TVAL+1,,AUTO
        10 011024   221675 471500                    LDP1    @ADDRESS$,,AUTO
        10 011025   100000 473500                    LDP3    0,,PR1
        10 011026   000100 101500                    MRL     fill='000'O
        10 011027   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 011030   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 011031   222251 222100                    LDX2    TVAL+2,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:364  
        10 011032   040000 100400                    MLR     fill='040'O
        10 011033   002315 000004 2                  ADSC9   XSERRMSG+224             cn=0,n=4
        10 011034   000335 200004 1                  ADSC9   REPLY250V                cn=1,n=4
        10 011035   040000 100540                    MLR     fill='040'O
        10 011036   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        10 011037   000336 200373 1                  ADSC9   REPLY250V+1              cn=1,n=251
        10 011040   000000 636010                    EAQ     0,X0
        10 011041   000022 772000                    QRL     18
        10 011042   000373 116007                    CMPQ    251,DL
        10 011043   011065 603000 10                 TRC     s:14842
        10 011044   222252 740100                    STX0    TVAL+3,,AUTO
        10 011045   777404 620010                    EAX0    -252,X0
        10 011046   777777 660003                    ERX0    -1,DU
        10 011047   222252 235100                    LDA     TVAL+3,,AUTO
        10 011050   000022 771000                    ARL     18
        10 011051   040045 100400                    MLR     fill='040'O
        10 011052   002314 000002 2                  ADSC9   XSERRMSG+223             cn=0,n=2
        10 011053   000336 200010 1                  ADSC9   REPLY250V+1,A            cn=1,n=*X0
        10 011054   222252 236100                    LDQ     TVAL+3,,AUTO
        10 011055   000022 772000                    QRL     18
        10 011056   000371 116007                    CMPQ    249,DL
        10 011057   011065 603000 10                 TRC     s:14842
        10 011060   777406 620006                    EAX0    -250,QL
        10 011061   777777 660003                    ERX0    -1,DU
        10 011062   040046 100540                    MLR     fill='040'O
        10 011063   300000 200012                    ADSC9   0,,PR3                   cn=1,n=*X2
        10 011064   000336 600010 1                  ADSC9   REPLY250V+1,Q            cn=3,n=*X0

     2282    14841    3               ' <', ADDRESS$->TEXTC.T);
     2283    14842    3       CALL SEARCHR( TSLEN, TVAL, TCM_SKIP_BLANKS, REPLY250V.TEXT);

  14842 10 011065   000000 165400                    TCTR
        10 011066   000335 200377 1                  ADSC9   REPLY250V                cn=1,n=255
        10 011067   000260 000000 2                  ARG     TCM_SKIP_BLANKS
        10 011070   221744 000100                    ARG     TSLEN,,AUTO
        10 011071   221744 235100                    LDA     TSLEN,,AUTO
        10 011072   000033 771000                    ARL     27
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:365  
        10 011073   221765 755100                    STA     TVAL,,AUTO
        10 011074   221744 551140                    STBA    TSLEN,'40'O,AUTO
        10 011075   011100 606400 10                 TTN     s:14843
        10 011076   000376 236007                    LDQ     254,DL
        10 011077   221744 156100                    SSQ     TSLEN,,AUTO

     2284    14843    3       CALL INSERT( REPLY250V.TEXT, TSLEN+1, , '@');

  14843 10 011100   221744 720100                    LXL0    TSLEN,,AUTO
        10 011101   777401 620010                    EAX0    -255,X0
        10 011102   777777 660003                    ERX0    -1,DU
        10 011103   221744 236100                    LDQ     TSLEN,,AUTO
        10 011104   040046 100400                    MLR     fill='040'O
        10 011105   000107 000001 11                 ADSC9   71                       cn=0,n=1
        10 011106   000335 400010 1                  ADSC9   REPLY250V,Q              cn=2,n=*X0

     2285    14844    3       CALL INSERT( REPLY250V.TEXT, TSLEN+2, ,

  14844 10 011107   777402 622006                    EAX2    -254,QL
        10 011110   777777 662003                    ERX2    -1,DU
        10 011111   221420 723100                    LXL3    MY_SITE_NAME_L,,AUTO
        10 011112   040046 100440                    MLR     fill='040'O
        10 011113   003265 000013 1                  ADSC9   MY_SITE_NAME             cn=0,n=*X3
        10 011114   000335 600012 1                  ADSC9   REPLY250V,Q              cn=3,n=*X2
        10 011115   221420 036100                    ADLQ    MY_SITE_NAME_L,,AUTO
        10 011116   000375 116007                    CMPQ    253,DL
        10 011117   011131 603000 10                 TRC     s:14846
        10 011120   222250 756100                    STQ     TVAL+1,,AUTO
        10 011121   221744 236100                    LDQ     TSLEN,,AUTO
        10 011122   221420 036100                    ADLQ    MY_SITE_NAME_L,,AUTO
        10 011123   222250 724100                    LXL4    TVAL+1,,AUTO
        10 011124   777402 624014                    EAX4    -254,X4
        10 011125   777777 664003                    ERX4    -1,DU
        10 011126   040046 100400                    MLR     fill='040'O
        10 011127   000116 000001 11                 ADSC9   78                       cn=0,n=1
        10 011130   000335 600014 1                  ADSC9   REPLY250V,Q              cn=3,n=*X4

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:366  
     2286    14845    3               SUBSTR( MY_SITE_NAME, 0, MY_SITE_NAME_L), '>');
     2287    14846    3       CALL SEARCHR( TSLEN, TVAL, TCM_SKIP_BLANKS, REPLY250V.TEXT);

  14846 10 011131   000000 165400                    TCTR
        10 011132   000335 200377 1                  ADSC9   REPLY250V                cn=1,n=255
        10 011133   000260 000000 2                  ARG     TCM_SKIP_BLANKS
        10 011134   221744 000100                    ARG     TSLEN,,AUTO
        10 011135   221744 236100                    LDQ     TSLEN,,AUTO
        10 011136   000044 737000                    LLS     36
        10 011137   000033 771000                    ARL     27
        10 011140   221765 755100                    STA     TVAL,,AUTO
        10 011141   221744 551140                    STBA    TSLEN,'40'O,AUTO
        10 011142   011145 606400 10                 TTN     s:14847
        10 011143   000376 236007                    LDQ     254,DL
        10 011144   221744 156100                    SSQ     TSLEN,,AUTO

     2288    14847    3       REPLY250V.COUNT = TSLEN + 1;

  14847 10 011145   221744 236100                    LDQ     TSLEN,,AUTO
        10 011146   000001 036007                    ADLQ    1,DL
        10 011147   000033 736000                    QLS     27
        10 011150   000335 552040 1                  STBQ    REPLY250V,'40'O

     2289    14848    3       REPLY$ = R250V$;

  14848 10 011151   000022 236000 2                  LDQ     R250V$
        10 011152   000722 756000 1                  STQ     REPLY$

     2290    14849    3       RETURN;

  14849 10 011153   000001 702211                    TSX2  ! 1,X1

     2291    14850
     2292    14851    3       END SETUP_REPLY_250V;
     2293    14852
     2294    14853    2       END LOOKUP_ALIAS;
     2295    14854        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:367  
     2296    14855    1   LOOKUP_REGISTRATION: PROC( USER$, USEFUL_SIZE) ALTRET;

  14855 10 011154   222170 741300       LOOKUP_REGI* STX1  ! USER$+1,,AUTO

     2297    14856
     2298    14857    2       DCL SIZE UBIN;
     2299    14858    2       DCL TEMPBUF CHAR( %USER_SIZE);
     2300    14859    2       DCL TEMPCHAR( 0:%( USER_SIZE-1)) REDEF TEMPBUF UBIN BYTE CALIGNED;
     2301    14860    2       DCL TRIMMEDSIZE UBIN;
     2302    14861    2       DCL USEFUL_SIZE UBIN;
     2303    14862    2       DCL USER$ PTR;
     2304    14863
     2305    14864            /* Figure out how long the useful part of the name (minus any folder
     2306    14865            specification) actually is. */
     2307    14866    2       CALL INDEX( USEFUL_SIZE, '/', USER$->TEXTC.T)

  14866 10 011155   222171 470500                    LDP0    @USER$,,AUTO
        10 011156   000000 471500                    LDP1    0,,PR0
        10 011157   000100 101500                    MRL     fill='000'O
        10 011160   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 011161   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 011162   222250 220100                    LDX0    TVAL+1,,AUTO
        10 011163   222172 473500                    LDP3    @USEFUL_SIZE,,AUTO
        10 011164   000000 124540                    SCM     mask='000'O
        10 011165   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        10 011166   000126 000001 11                 ADSC9   86                       cn=0,n=1
        10 011167   300000 000100                    ARG     0,,PR3
        10 011170   011220 606400 10                 TTN     s:14878

     2308    14867    3       WHENRETURN DO;

     2309    14868    4           DO WHILE USEFUL_SIZE > 0;

  14868 10 011171   300000 235100                    LDA     0,,PR3
        10 011172   011213 600000 10                 TZE     s:14874

     2310    14869    4               IF SUBSTR( USER$->TEXTC.T, USEFUL_SIZE - 1, 1) = ' ' THEN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:368  

  14869 10 011173   222171 470500                    LDP0    @USER$,,AUTO
        10 011174   000000 471500                    LDP1    0,,PR0
        10 011175   000100 101500                    MRL     fill='000'O
        10 011176   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 011177   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 011200   222250 220100                    LDX0    TVAL+1,,AUTO
        10 011201   222172 473500                    LDP3    @USEFUL_SIZE,,AUTO
        10 011202   300000 235100                    LDA     0,,PR3
        10 011203   040000 106505                    CMPC    fill='040'O
        10 011204   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
        10 011205   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 011206   011213 601000 10                 TNZ     s:14874

     2311    14870    4                   USEFUL_SIZE = USEFUL_SIZE - 1;

  14870 10 011207   000001 135007                    SBLA    1,DL
        10 011210   300000 755100                    STA     0,,PR3
        10 011211   011212 710000 10                 TRA     s:14873

     2312    14871    4               ELSE
     2313    14872    4                   EXIT;
     2314    14873    4               END;

  14873 10 011212   011173 601000 10                 TNZ     s:14869

     2315    14874    3           IF USEFUL_SIZE = 0 THEN

  14874 10 011213   000000 115003                    CMPA    0,DU
        10 011214   011217 601000 10                 TNZ     s:14875+2

     2316    14875    3                 ALTRETURN; /* folder names must follow a person's name */

  14875 10 011215   222170 221300                    LDX1  ! USER$+1,,AUTO
        10 011216   000000 702211                    TSX2  ! 0,X1
        10 011217   011226 710000 10                 TRA     s:14882

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:369  
     2317    14876    3           END;
     2318    14877    3       WHENALTRETURN DO;

     2319    14878    3           USEFUL_SIZE = USER$->TEXTC.L;

  14878 10 011220   222171 470500                    LDP0    @USER$,,AUTO
        10 011221   000000 471500                    LDP1    0,,PR0
        10 011222   222172 473500                    LDP3    @USEFUL_SIZE,,AUTO
        10 011223   000100 101500                    MRL     fill='000'O
        10 011224   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 011225   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4

     2320    14879    3           END;

     2321    14880            /* Translate name to upper-case-only, compress multiple
     2322    14881            blanks for alias/list lookup */
     2323    14882    2       TRIMMEDSIZE = 0;

  14882 10 011226   222214 450100                    STZ     TRIMMEDSIZE,,AUTO

     2324    14883    3       DO SIZE = 0 TO USEFUL_SIZE - 1;

  14883 10 011227   222173 450100                    STZ     SIZE,,AUTO
        10 011230   011266 710000 10                 TRA     s:14892+3

     2325    14884    3           CALL XLATE( SUBSTR( TEMPBUF, TRIMMEDSIZE, 1), TCM_XLATE_TO_UC,

  14884 10 011231   222171 470500                    LDP0    @USER$,,AUTO
        10 011232   000000 471500                    LDP1    0,,PR0
        10 011233   000100 101500                    MRL     fill='000'O
        10 011234   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 011235   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 011236   222250 220100                    LDX0    TVAL+1,,AUTO
        10 011237   222173 235100                    LDA     SIZE,,AUTO
        10 011240   222214 236100                    LDQ     TRIMMEDSIZE,,AUTO
        10 011241   040106 160505                    MVT     fill='040'O
        10 011242   100000 200001                    ADSC9   0,A,PR1                  cn=1,n=1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:370  
        10 011243   222174 000001                    ADSC9   TEMPBUF,Q,AUTO           cn=0,n=1
        10 011244   000060 000000 2                  ARG     TCM_XLATE_TO_UC

     2326    14885    3                   SUBSTR( USER$->TEXTC.T, SIZE, 1));
     2327    14886    3           IF TRIMMEDSIZE = 0 THEN

  14886 10 011245   011251 601000 10                 TNZ     s:14889

     2328    14887    3               TRIMMEDSIZE = 1;

  14887 10 011246   000001 235007                    LDA     1,DL
        10 011247   222214 755100                    STA     TRIMMEDSIZE,,AUTO
        10 011250   011263 710000 10                 TRA     s:14892

     2329    14888    3           ELSE
     2330    14889    3               IF SUBSTR( TEMPBUF, TRIMMEDSIZE, 1) ~= ' ' OR

  14889 10 011251   040000 106506                    CMPC    fill='040'O
        10 011252   222174 000001                    ADSC9   TEMPBUF,Q,AUTO           cn=0,n=1
        10 011253   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 011254   011261 601000 10                 TNZ     s:14891
        10 011255   040000 106506                    CMPC    fill='040'O
        10 011256   222173 600001                    ADSC9   SIZE,Q,AUTO              cn=3,n=1
        10 011257   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 011260   011263 600000 10                 TZE     s:14892

     2331    14890    3                       SUBSTR( TEMPBUF, TRIMMEDSIZE - 1, 1) ~= ' ' THEN
     2332    14891    3                   TRIMMEDSIZE = TRIMMEDSIZE + 1;

  14891 10 011261   000001 036007                    ADLQ    1,DL
        10 011262   222214 756100                    STQ     TRIMMEDSIZE,,AUTO

     2333    14892    3           END;

  14892 10 011263   222173 235100                    LDA     SIZE,,AUTO
        10 011264   000001 035007                    ADLA    1,DL
        10 011265   222173 755100                    STA     SIZE,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:371  
        10 011266   222172 471500                    LDP1    @USEFUL_SIZE,,AUTO
        10 011267   222173 236100                    LDQ     SIZE,,AUTO
        10 011270   100000 116100                    CMPQ    0,,PR1
        10 011271   011231 602000 10                 TNC     s:14884

     2334    14893    2       POSITION_ALIAS.V.N# = 0;

  14893 10 011272   003507 450000 1                  STZ     POSITION_ALIAS+7

     2335    14894    2       POSITION_ALIAS.V.KEYS# = %YES#;

  14894 10 011273   400000 236007                    LDQ     -131072,DL
        10 011274   003506 256000 1                  ORSQ    POSITION_ALIAS+6

     2336    14895    2       POSITION_ALIAS.V.KEYR# = %NO#;

  14895 10 011275   000127 236000 11                 LDQ     87
        10 011276   003506 356000 1                  ANSQ    POSITION_ALIAS+6

     2337    14896    2       POSITION_ALIAS.KEY_ = VECTOR( VM_USERKEY);

  14896 10 011277   000130 237000 11                 LDAQ    88
        10 011300   003502 757000 1                  STAQ    POSITION_ALIAS+2

     2338    14897    2       VM_USERKEY.COUNT = TRIMMEDSIZE + LENGTHC( VM_USERKEY.TYPE);

  14897 10 011301   222214 236100                    LDQ     TRIMMEDSIZE,,AUTO
        10 011302   000001 036007                    ADLQ    1,DL
        10 011303   000033 736000                    QLS     27
        10 011304   004140 552040 1                  STBQ    VM_USERKEY,'40'O

     2339    14898    2       VM_USERKEY.TEXT = TEMPBUF;

  14898 10 011305   040000 100500                    MLR     fill='040'O
        10 011306   222174 000100                    ADSC9   TEMPBUF,,AUTO            cn=0,n=64
        10 011307   004140 400310 1                  ADSC9   VM_USERKEY               cn=2,n=200

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:372  
     2340    14899    2       CALL M$PRECORD( POSITION_ALIAS)

  14899 10 011310   003500 630400 1                  EPPR0   POSITION_ALIAS
        10 011311   440003 713400                    CLIMB   alt,+16387
        10 011312   401000 401760                    pmme    nvectors=3
        10 011313   011317 702000 10                 TSX2    s:14906

     2341    14900    3       WHENRETURN DO;

     2342    14901                /* Specified recipient is a user.  Reset the flag which
     2343    14902                   would cause us to suppress the SMTP headers. */
     2344    14903    3           SUPPRESS_HEADERS = %NO#;

  14903 10 011314   200012 450100                    STZ     SUPPRESS_HEADERS,,AUTO

     2345    14904    3           RETURN;

  14904 10 011315   222170 221300                    LDX1  ! USER$+1,,AUTO
        10 011316   000001 702211                    TSX2  ! 1,X1

     2346    14905    3           END;
     2347    14906    2       POSITION_ALIAS.KEY_ = VECTOR( VM_LISTKEY);

  14906 10 011317   000132 237000 11                 LDAQ    90
        10 011320   003502 757000 1                  STAQ    POSITION_ALIAS+2

     2348    14907    2       VM_LISTKEY.COUNT = TRIMMEDSIZE + LENGTHC( VM_LISTKEY.TYPE);

  14907 10 011321   222214 236100                    LDQ     TRIMMEDSIZE,,AUTO
        10 011322   000001 036007                    ADLQ    1,DL
        10 011323   000033 736000                    QLS     27
        10 011324   004223 552040 1                  STBQ    VM_LISTKEY,'40'O

     2349    14908    2       VM_LISTKEY.TEXT = TEMPBUF;

  14908 10 011325   040000 100500                    MLR     fill='040'O
        10 011326   222174 000100                    ADSC9   TEMPBUF,,AUTO            cn=0,n=64
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:373  
        10 011327   004223 400310 1                  ADSC9   VM_LISTKEY               cn=2,n=200

     2350    14909    2       CALL M$PRECORD( POSITION_ALIAS)

  14909 10 011330   003500 630400 1                  EPPR0   POSITION_ALIAS
        10 011331   440003 713400                    CLIMB   alt,+16387
        10 011332   401000 401760                    pmme    nvectors=3
        10 011333   011336 702000 10                 TSX2    s:14915

     2351    14910    3       WHENRETURN DO;

     2352    14911                /* Specified recipient is a list.  All is well. */
     2353    14912    3           RETURN;

  14912 10 011334   222170 221300                    LDX1  ! USER$+1,,AUTO
        10 011335   000001 702211                    TSX2  ! 1,X1

     2354    14913    3           END;
     2355    14914            /* Specified recipient is unknown. */
     2356    14915    2       ALTRETURN;

  14915 10 011336   222170 221300                    LDX1  ! USER$+1,,AUTO
        10 011337   000000 702211                    TSX2  ! 0,X1

     2357    14916
     2358    14917    2       END LOOKUP_REGISTRATION;
     2359    14918        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:374  
     2360    14919    1   SPILL_ALIASES: PROC;

  14919 10 011340   221536 741300       SPILL_ALIAS* STX1  ! HEX2+2,,AUTO

     2361    14920
     2362    14921    2       DCL CHR CHAR(1);
     2363    14922    2       DCL DONE BIT(1);
     2364    14923    2       DCL INTERESTING BIT(1);
     2365    14924    2       DCL WRITING BIT(1);
     2366    14925            %BUFFER( NAME=SCRATCH, STCLASS=AUTO);
     2367    14930
     2368    14931    2       DONE = %NO#;

  14931 10 011341   221540 450100                    STZ     DONE,,AUTO

     2369    14932    2       WRITING = %NO#;

  14932 10 011342   221542 450100                    STZ     WRITING,,AUTO

     2370    14933    2       CALL M$PFIL( REWIND_ALIAS);

  14933 10 011343   000572 630400 2                  EPPR0   REWIND_ALIAS
        10 011344   040004 713400                    CLIMB   16388
        10 011345   400000 401760                    pmme    nvectors=1

     2371    14934    2       POSITION_ALIAS.V.N# = 0;

  14934 10 011346   003507 450000 1                  STZ     POSITION_ALIAS+7

     2372    14935    2       POSITION_ALIAS.V.KEYS# = %NO#;

  14935 10 011347   000123 236000 11                 LDQ     83
        10 011350   003506 356000 1                  ANSQ    POSITION_ALIAS+6

     2373    14936    2       POSITION_ALIAS.V.KEYR# = %YES#;

  14936 10 011351   200000 236007                    LDQ     65536,DL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:375  
        10 011352   003506 256000 1                  ORSQ    POSITION_ALIAS+6

     2374    14937    2       POSITION_ALIAS.KEY_ = VECTOR( ZTEXT);

  14937 10 011353   000134 235000 11                 LDA     92
        10 011354   222250 452500                    STP2    TVAL+1,,AUTO
        10 011355   222250 236100                    LDQ     TVAL+1,,AUTO
        10 011356   001616 036003                    ADLQ    910,DU
        10 011357   003502 757000 1                  STAQ    POSITION_ALIAS+2

     2375    14938    2       CALL INSERT( SCRATCH.TXT, 0, 4, '250-');

  14938 10 011360   040100 100400                    MLR     fill='040'O
        10 011361   002316 000004 2                  ADSC9   XSERRMSG+225             cn=0,n=4
        10 011362   221543 200004                    ADSC9   SCRATCH,,AUTO            cn=1,n=4

     2376    14939    2       REPLY$ = ADDR( SCRATCH);

  14939 10 011363   221543 630500                    EPPR0   SCRATCH,,AUTO
        10 011364   000722 450400 1                  STP0    REPLY$

     2377    14940    3       DO WHILE( %YES#);

     2378    14941    3           CALL M$PRECORD( POSITION_ALIAS);

  14941 10 011365   003500 630400 1                  EPPR0   POSITION_ALIAS
        10 011366   040003 713400                    CLIMB   16387
        10 011367   401000 401760                    pmme    nvectors=3

     2379    14942    3           CHR = SUBSTR( ZTEXT.TXT, 0, 1);

  14942 10 011370   201616 236100                    LDQ     ZTEXT,,AUTO
        10 011371   000011 736000                    QLS     9
        10 011372   777000 376003                    ANQ     -512,DU
        10 011373   000031 276000 11                 ORQ     25
        10 011374   221537 756100                    STQ     CHR,,AUTO

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:376  
     2380    14943    3           INTERESTING = %NO#;

  14943 10 011375   221541 450100                    STZ     INTERESTING,,AUTO

     2381    14944    3           IF ASCBIN( CHR) = %VM_TYPE_LIST OR

  14944 10 011376   221537 236100                    LDQ     CHR,,AUTO
        10 011377   000033 772000                    QRL     27
        10 011400   000074 116007                    CMPQ    60,DL
        10 011401   011404 600000 10                 TZE     s:14946
        10 011402   000120 116007                    CMPQ    80,DL
        10 011403   011406 601000 10                 TNZ     s:14947

     2382    14945    3                   ASCBIN( CHR) = %VM_TYPE_USER THEN
     2383    14946    3               INTERESTING = %YES#;

  14946 10 011404   400000 236003                    LDQ     -131072,DU
        10 011405   221541 756100                    STQ     INTERESTING,,AUTO

     2384    14947    4           IF ZTEXT.LEN = 0 OR ( WRITING AND NOT INTERESTING) THEN DO;

  14947 10 011406   201616 236100                    LDQ     ZTEXT,,AUTO
        10 011407   777000 316003                    CANQ    -512,DU
        10 011410   011415 600000 10                 TZE     s:14948
        10 011411   221542 234100                    SZN     WRITING,,AUTO
        10 011412   011421 605000 10                 TPL     s:14951
        10 011413   221541 234100                    SZN     INTERESTING,,AUTO
        10 011414   011421 604000 10                 TMI     s:14951

     2385    14948    4               CALL INSERT( SCRATCH.TXT, 3, 1, ' ');

  14948 10 011415   040000 236003                    LDQ     16384,DU
        10 011416   221544 552140                    STBQ    @KEYVAL,'40'O,AUTO

     2386    14949    4               DONE = %YES#;

  14949 10 011417   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:377  
        10 011420   221540 756100                    STQ     DONE,,AUTO

     2387    14950    4               END;

     2388    14951    3           IF WRITING THEN

  14951 10 011421   221542 234100                    SZN     WRITING,,AUTO
        10 011422   011425 605000 10                 TPL     s:14953

     2389    14952    3               CALL WRITE_REPLY;

  14952 10 011423   002312 701000 10                 TSX1    WRITE_REPLY
        10 011424   000000 011000                    NOP     0

     2390    14953    3           IF DONE THEN

  14953 10 011425   221540 234100                    SZN     DONE,,AUTO
        10 011426   011452 604000 10                 TMI     s:14965

     2391    14954    3               EXIT;
     2392    14955    3           POSITION_ALIAS.V.N# = 1;

  14955 10 011427   000001 235007                    LDA     1,DL
        10 011430   003507 755000 1                  STA     POSITION_ALIAS+7

     2393    14956    4           IF INTERESTING THEN DO;

  14956 10 011431   221541 234100                    SZN     INTERESTING,,AUTO
        10 011432   011450 605000 10                 TPL     s:14963

     2394    14957    4               WRITING = %YES#;

  14957 10 011433   400000 236003                    LDQ     -131072,DU
        10 011434   221542 756100                    STQ     WRITING,,AUTO

     2395    14958    4               CALL INSERT( SCRATCH.TXT, 4, ZTEXT.LEN - 1,

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:378  
  14958 10 011435   201616 236100                    LDQ     ZTEXT,,AUTO
        10 011436   000033 772000                    QRL     27
        10 011437   777777 620006                    EAX0    -1,QL
        10 011440   777777 621006                    EAX1    -1,QL
        10 011441   040140 100540                    MLR     fill='040'O
        10 011442   201616 400010                    ADSC9   ZTEXT,,AUTO              cn=2,n=*X0
        10 011443   221544 200011                    ADSC9   @KEYVAL,,AUTO            cn=1,n=*X1

     2396    14959    4                       SUBSTR( ZTEXT.TXT, 1, ZTEXT.LEN - 1));
     2397    14960    4               SCRATCH.LEN = ZTEXT.LEN + 3;

  14960 10 011444   000003 036007                    ADLQ    3,DL
        10 011445   000033 736000                    QLS     27
        10 011446   221543 552140                    STBQ    SCRATCH,'40'O,AUTO

     2398    14961    4               END;

  14961 10 011447   011365 710000 10                 TRA     s:14941

     2399    14962    3           ELSE
     2400    14963    3               WRITING = %NO#;

  14963 10 011450   221542 450100                    STZ     WRITING,,AUTO

     2401    14964    3           END;

  14964 10 011451   011365 710000 10                 TRA     s:14941

     2402    14965    2       REPLY$ = ADDR( NIL);

  14965 10 011452   000001 236000 xsym               LDQ     B_VECTNIL+1
        10 011453   000722 756000 1                  STQ     REPLY$

     2403    14966    2       RETURN;

  14966 10 011454   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 011455   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:379  

     2404    14967
     2405    14968    2       END SPILL_ALIASES;
     2406    14969        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:380  
     2407    14970    1   READ_TRANSPARENT: PROC ALTRET;

  14970 10 011456   221716 741300       READ_TRANSP* STX1  ! CURR_CMDCODE+2,,AUTO

     2408    14971
     2409    14972    2       DCL I UBIN;
     2410    14973
     2411    14974    2       IF TCM_TCPFLAVOR THEN

  14974 10 011457   000000 234000 xsym               SZN     TCM_TCPFLAVOR
        10 011460   011475 605000 10                 TPL     s:14978

     2412    14975    2           CALL TCM$LTCP_READ( VECTOR( LINEBUF), 60, , , LINESIZE, , )

  14975 10 011461   221417 630500                    EPPR0   LINESIZE,,AUTO
        10 011462   222254 450500                    STP0    TVAL+5,,AUTO
        10 011463   000001 236000 xsym               LDQ     B_VECTNIL+1
        10 011464   000001 235000 xsym               LDA     B_VECTNIL+1
        10 011465   222252 757100                    STAQ    TVAL+3,,AUTO
        10 011466   000136 237000 11                 LDAQ    94
        10 011467   222250 757100                    STAQ    TVAL+1,,AUTO
        10 011470   222250 630500                    EPPR0   TVAL+1,,AUTO
        10 011471   000023 631400 xsym               EPPR1   B_VECTNIL+19
        10 011472   000000 701000 xent               TSX1    TCM$LTCP_READ
        10 011473   011642 702000 10                 TSX2    READ_ERROR
        10 011474   011507 710000 10                 TRA     s:14981

     2413    14976    2                   ALTRET( READ_ERROR);
     2414    14977    3       ELSE DO;

     2415    14978    3           CALL M$READ( READ_UC) ALTRET( READ_ERROR);

  14978 10 011475   003446 630400 1                  EPPR0   READ_UC
        10 011476   440000 713400                    CLIMB   alt,read
        10 011477   401400 401760                    pmme    nvectors=4
        10 011500   011642 702000 10                 TSX2    READ_ERROR

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:381  
     2416    14979    3           LINESIZE = DCBADDR( DCBNUM( M$UC))->F$DCB.ARS#;

  14979 10 011501   000000 236007 xsym               LDQ     M$UC,DL
        10 011502   000000 470400 11                 LDP0    0
        10 011503   000000 471500                    LDP1    0,,PR0
        10 011504   100000 473506                    LDP3    0,QL,PR1
        10 011505   300000 235100                    LDA     0,,PR3
        10 011506   221417 755100                    STA     LINESIZE,,AUTO

     2417    14980    3           END;

     2418    14981    3       IF TCM_DRIBBLE OR TCM_DRIBBLE_ME THEN DO;

  14981 10 011507   000216 235000 1                  LDA     TCM_DRIBBLE
        10 011510   011513 601000 10                 TNZ     s:14982
        10 011511   000217 236000 1                  LDQ     TCM_DRIBBLE_ME
        10 011512   011533 600000 10                 TZE     s:14990

     2419    14982    3           IF LINESIZE = 0 THEN

  14982 10 011513   221417 236100                    LDQ     LINESIZE,,AUTO
        10 011514   011520 601000 10                 TNZ     s:14985

     2420    14983    3               WRITE_DRIBBLE.BUF_ = VECTOR( NIL);

  14983 10 011515   000140 237000 11                 LDAQ    96
        10 011516   003516 757000 1                  STAQ    WRITE_DRIBBLE+4
        10 011517   011530 710000 10                 TRA     s:14988

     2421    14984    4           ELSE DO;

     2422    14985    4               WRITE_DRIBBLE.BUF_ = VECTOR( LINEBUF);

  14985 10 011520   000014 237000 11                 LDAQ    12
        10 011521   003516 757000 1                  STAQ    WRITE_DRIBBLE+4

     2423    14986    4               WRITE_DRIBBLE.BUF_.BOUND = LINESIZE - 1;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:382  

  14986 10 011522   221417 236100                    LDQ     LINESIZE,,AUTO
        10 011523   000001 136007                    SBLQ    1,DL
        10 011524   000020 736000                    QLS     16
        10 011525   003516 676000 1                  ERQ     WRITE_DRIBBLE+4
        10 011526   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 011527   003516 656000 1                  ERSQ    WRITE_DRIBBLE+4

     2424    14987    4               END;

     2425    14988    3           CALL M$WRITE( WRITE_DRIBBLE);

  14988 10 011530   003512 630400 1                  EPPR0   WRITE_DRIBBLE
        10 011531   040001 713400                    CLIMB   write
        10 011532   401400 401760                    pmme    nvectors=4

     2426    14989    3           END;

     2427    14990    2       IF LINESIZE = 0 THEN

  14990 10 011533   221417 235100                    LDA     LINESIZE,,AUTO
        10 011534   011537 601000 10                 TNZ     s:14992

     2428    14991    2           ALTRETURN;

  14991 10 011535   221716 221300                    LDX1  ! CURR_CMDCODE+2,,AUTO
        10 011536   000000 702211                    TSX2  ! 0,X1

     2429    14992    3       DO I = 0 TO LINESIZE - 1;

  14992 10 011537   221717 450100                    STZ     I,,AUTO
        10 011540   011576 710000 10                 TRA     s:14998+2

     2430    14993    3           LINECHAR( I) = LINECHAR( I) & '177'O;

  14993 10 011541   221717 235100                    LDA     I,,AUTO
        10 011542   000100 100405                    MLR     fill='000'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:383  
        10 011543   001525 000001 1                  ADSC9   LINEBUF,A                cn=0,n=1
        10 011544   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 011545   222250 236100                    LDQ     TVAL+1,,AUTO
        10 011546   177000 376003                    ANQ     65024,DU
        10 011547   222251 756100                    STQ     TVAL+2,,AUTO
        10 011550   000005 100500                    MLR     fill='000'O
        10 011551   222251 000004                    ADSC9   TVAL+2,,AUTO             cn=0,n=4
        10 011552   001525 000001 1                  ADSC9   LINEBUF,A                cn=0,n=1

     2431    14994    4           IF CMD_CODE = 0 AND LINECHAR( I) = ASCBIT( '\') THEN DO;

  14994 10 011553   000723 236000 1                  LDQ     CMD_CODE
        10 011554   011574 601000 10                 TNZ     s:14998
        10 011555   000000 106405                    CMPC    fill='000'O
        10 011556   001525 000001 1                  ADSC9   LINEBUF,A                cn=0,n=1
        10 011557   000142 000002 11                 ADSC9   98                       cn=0,n=2
        10 011560   011574 601000 10                 TNZ     s:14998

     2432    14995    4               I = I + 1;

  14995 10 011561   000001 035007                    ADLA    1,DL
        10 011562   221717 755100                    STA     I,,AUTO

     2433    14996    4               LINECHAR( I) = LINECHAR( I) | '600'O;

  14996 10 011563   000100 100405                    MLR     fill='000'O
        10 011564   001525 000001 1                  ADSC9   LINEBUF,A                cn=0,n=1
        10 011565   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 011566   222250 236100                    LDQ     TVAL+1,,AUTO
        10 011567   600000 276003                    ORQ     -65536,DU
        10 011570   222251 756100                    STQ     TVAL+2,,AUTO
        10 011571   000005 100500                    MLR     fill='000'O
        10 011572   222251 000004                    ADSC9   TVAL+2,,AUTO             cn=0,n=4
        10 011573   001525 000001 1                  ADSC9   LINEBUF,A                cn=0,n=1

     2434    14997    4               END;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:384  
     2435    14998    3           END;

  14998 10 011574   000001 035007                    ADLA    1,DL
        10 011575   221717 755100                    STA     I,,AUTO
        10 011576   221717 236100                    LDQ     I,,AUTO
        10 011577   221417 116100                    CMPQ    LINESIZE,,AUTO
        10 011600   011541 602000 10                 TNC     s:14993

     2436    14999    3       DO WHILE LINECHAR( LINESIZE - 1) = '012'O/*LF*/;

  14999 10 011601   221417 235100                    LDA     LINESIZE,,AUTO
        10 011602   000000 106405                    CMPC    fill='000'O
        10 011603   001524 600001 1                  ADSC9   REWRITE+377,A            cn=3,n=1
        10 011604   000143 000002 11                 ADSC9   99                       cn=0,n=2
        10 011605   011615 601000 10                 TNZ     s:15002

     2437    15000    3           LINESIZE = LINESIZE - 1;

  15000 10 011606   221417 235100                    LDA     LINESIZE,,AUTO
        10 011607   000001 135007                    SBLA    1,DL
        10 011610   221417 755100                    STA     LINESIZE,,AUTO

     2438    15001    3           END;

  15001 10 011611   000000 106405                    CMPC    fill='000'O
        10 011612   001524 600001 1                  ADSC9   REWRITE+377,A            cn=3,n=1
        10 011613   000143 000002 11                 ADSC9   99                       cn=0,n=2
        10 011614   011606 600000 10                 TZE     s:15000

     2439    15002    3       DO WHILE LINECHAR( LINESIZE - 1) = '015'O/*CR*/;

  15002 10 011615   000000 106405                    CMPC    fill='000'O
        10 011616   001524 600001 1                  ADSC9   REWRITE+377,A            cn=3,n=1
        10 011617   000144 000002 11                 ADSC9   100                      cn=0,n=2
        10 011620   011630 601000 10                 TNZ     s:15005

     2440    15003    3           LINESIZE = LINESIZE - 1;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:385  

  15003 10 011621   221417 235100                    LDA     LINESIZE,,AUTO
        10 011622   000001 135007                    SBLA    1,DL
        10 011623   221417 755100                    STA     LINESIZE,,AUTO

     2441    15004    3           END;

  15004 10 011624   000000 106405                    CMPC    fill='000'O
        10 011625   001524 600001 1                  ADSC9   REWRITE+377,A            cn=3,n=1
        10 011626   000144 000002 11                 ADSC9   100                      cn=0,n=2
        10 011627   011621 600000 10                 TZE     s:15003

     2442    15005    2       IF LINESIZE = 0 OR LINEBUF = ' ' THEN

  15005 10 011630   000000 115003                    CMPA    0,DU
        10 011631   011636 600000 10                 TZE     s:15006
        10 011632   040000 106400                    CMPC    fill='040'O
        10 011633   001525 000377 1                  ADSC9   LINEBUF                  cn=0,n=255
        10 011634   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 011635   011640 601000 10                 TNZ     s:15008

     2443    15006    2           ALTRETURN;

  15006 10 011636   221716 221300                    LDX1  ! CURR_CMDCODE+2,,AUTO
        10 011637   000000 702211                    TSX2  ! 0,X1

     2444    15007    2       ELSE
     2445    15008    2           RETURN;

  15008 10 011640   221716 221300                    LDX1  ! CURR_CMDCODE+2,,AUTO
        10 011641   000001 702211                    TSX2  ! 1,X1

     2446    15009    2   READ_ERROR:
     2447    15010    2       IF TCM_TCPFLAVOR THEN

  15010 10 011642   000000 234000 xsym  READ_ERROR   SZN     TCM_TCPFLAVOR
        10 011643   011647 605000 10                 TPL     s:15013
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:386  

     2448    15011    2           TIMED_OUT = %YES#;

  15011 10 011644   400000 236003                    LDQ     -131072,DU
        10 011645   200010 756100                    STQ     TIMED_OUT,,AUTO
        10 011646   011662 710000 10                 TRA     s:15017

     2449    15012    2       ELSE
     2450    15013    2           IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$TIMO THEN

  15013 10 011647   000000 470400 xsym               LDP0    B$TCB$
        10 011650   000000 471500                    LDP1    0,,PR0
        10 011651   100102 236100                    LDQ     66,,PR1
        10 011652   377770 376007                    ANQ     131064,DL
        10 011653   000160 116007                    CMPQ    112,DL
        10 011654   011660 601000 10                 TNZ     s:15016

     2451    15014    2               TIMED_OUT = %YES#;

  15014 10 011655   400000 236003                    LDQ     -131072,DU
        10 011656   200010 756100                    STQ     TIMED_OUT,,AUTO
        10 011657   011662 710000 10                 TRA     s:15017

     2452    15015    2           ELSE
     2453    15016    2               DATA_LOST = %YES#;

  15016 10 011660   400000 236003                    LDQ     -131072,DU
        10 011661   200011 756100                    STQ     DATA_LOST,,AUTO

     2454    15017    2       LINESIZE = 0;

  15017 10 011662   221417 450100                    STZ     LINESIZE,,AUTO

     2455    15018    2       ALTRETURN;

  15018 10 011663   221716 221300                    LDX1  ! CURR_CMDCODE+2,,AUTO
        10 011664   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:387  

     2456    15019
     2457    15020    2       END READ_TRANSPARENT;
     2458    15021        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:388  
     2459    15022        /********** PROCEDURE TO MOVE A TEXTC STRING,
     2460    15023        STRIPPING BACKSLASHES AND( COMMENTS) AND "QUOTES"
     2461    15024        */
     2462    15025    1   MOVE_STRING: PROC( FROM$, TO$, LEN) ALTRET;

  15025 10 011665   222170 741300       MOVE_STRING  STX1  ! USER$+1,,AUTO

     2463    15026
     2464    15027    2       DCL COUNT UBIN;
     2465    15028    2       DCL FROM$ PTR;
     2466    15029    2       DCL LEN UBIN;
     2467    15030    2       DCL LENGTH UBIN;
     2468    15031    2       DCL START UBIN;
     2469    15032    2       DCL TO$ PTR;
     2470    15033    2       DCL SCRUNCH BIT(1) UNAL;
     2471    15034
     2472    15035    3       IF FROM$->TEXTC.L > LEN THEN DO;

  15035 10 011666   222171 470500                    LDP0    @FROM$,,AUTO
        10 011667   000000 471500                    LDP1    0,,PR0
        10 011670   222173 473500                    LDP3    @LEN,,AUTO
        10 011671   000100 101500                    MRL     fill='000'O
        10 011672   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 011673   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 011674   222250 236100                    LDQ     TVAL+1,,AUTO
        10 011675   300000 116100                    CMPQ    0,,PR3
        10 011676   011703 602000 10                 TNC     s:15039
        10 011677   011703 600000 10                 TZE     s:15039

     2473    15036    3           REPLY$ = R552$;

  15036 10 011700   000042 236000 2                  LDQ     R552$
        10 011701   000722 756000 1                  STQ     REPLY$

     2474    15037    3           ALTRETURN;

  15037 10 011702   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:389  

     2475    15038    3           END;
     2476    15039    2       GOTO CONTINUE;

  15039 10 011703   011723 710000 10                 TRA     CONTINUE

     2477    15040
     2478    15041    2   MOVE_HDR: ENTRY( FROM$, TO$, LEN) ALTRET;

  15041 10 011704   222170 741300       MOVE_HDR     STX1  ! USER$+1,,AUTO

     2479    15042
     2480    15043    2       IF FROM$->TEXTC.L > LEN THEN

  15043 10 011705   222171 470500                    LDP0    @FROM$,,AUTO
        10 011706   000000 471500                    LDP1    0,,PR0
        10 011707   222173 473500                    LDP3    @LEN,,AUTO
        10 011710   000100 101500                    MRL     fill='000'O
        10 011711   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 011712   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 011713   222250 236100                    LDQ     TVAL+1,,AUTO
        10 011714   300000 116100                    CMPQ    0,,PR3
        10 011715   011723 602000 10                 TNC     CONTINUE
        10 011716   011723 600000 10                 TZE     CONTINUE

     2481    15044    2           FROM$->TEXTC.L = LEN;

  15044 10 011717   000000 471500                    LDP1    0,,PR0
        10 011720   000100 101500                    MRL     fill='000'O
        10 011721   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
        10 011722   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     2482    15045    2   CONTINUE:
     2483    15046    3       IF FROM$->TEXTC.L = 0 THEN DO;

  15046 10 011723   000000 471500       CONTINUE     LDP1    0,,PR0
        10 011724   000100 101500                    MRL     fill='000'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:390  
        10 011725   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 011726   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 011727   222250 236100                    LDQ     TVAL+1,,AUTO
        10 011730   000000 116003                    CMPQ    0,DU
        10 011731   011741 601000 10                 TNZ     s:15050

     2484    15047    3           TO$->TEXTC.L = 0;

  15047 10 011732   222172 471500                    LDP1    @TO$,,AUTO
        10 011733   100000 474500                    LDP4    0,,PR1
        10 011734   000100 101400                    MRL     fill='000'O
        10 011735   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
        10 011736   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1

     2485    15048    3           RETURN;

  15048 10 011737   222170 221300                    LDX1  ! USER$+1,,AUTO
        10 011740   000001 702211                    TSX2  ! 1,X1

     2486    15049    3           END;
     2487    15050    2       COUNT = 0;

  15050 10 011741   222174 450100                    STZ     COUNT,,AUTO

     2488    15051    2       START = 0;

  15051 10 011742   222176 450100                    STZ     START,,AUTO

     2489    15052    2       SCRUNCH = '0'B;

  15052 10 011743   222177 450100                    STZ     SCRUNCH,,AUTO

     2490    15053    2       IF SUBSTR( FROM$->TEXTC.T, 0, 1) = '"'

  15053 10 011744   000000 471500                    LDP1    0,,PR0
        10 011745   000100 101500                    MRL     fill='000'O
        10 011746   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:391  
        10 011747   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 011750   222250 220100                    LDX0    TVAL+1,,AUTO
        10 011751   040000 106500                    CMPC    fill='040'O
        10 011752   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
        10 011753   000005 000001 11                 ADSC9   5                        cn=0,n=1
        10 011754   012011 601000 10                 TNZ     s:15059
        10 011755   000000 471500                    LDP1    0,,PR0
        10 011756   000100 101500                    MRL     fill='000'O
        10 011757   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 011760   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 011761   222251 221100                    LDX1    TVAL+2,,AUTO
        10 011762   000000 474500                    LDP4    0,,PR0
        10 011763   000100 101500                    MRL     fill='000'O
        10 011764   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        10 011765   222252 000004                    ADSC9   TVAL+3,,AUTO             cn=0,n=4
        10 011766   222252 236100                    LDQ     TVAL+3,,AUTO
        10 011767   040000 106506                    CMPC    fill='040'O
        10 011770   100000 000001                    ADSC9   0,Q,PR1                  cn=0,n=1
        10 011771   000005 000001 11                 ADSC9   5                        cn=0,n=1
        10 011772   012011 601000 10                 TNZ     s:15059

     2491    15054    3               AND SUBSTR( FROM$->TEXTC.T, FROM$->TEXTC.L-1, 1) = '"' THEN DO;

     2492    15055    3           START = 1;

  15055 10 011773   000001 235007                    LDA     1,DL
        10 011774   222176 755100                    STA     START,,AUTO

     2493    15056    3           FROM$->TEXTC.L = FROM$->TEXTC.L - 2;

  15056 10 011775   000000 471500                    LDP1    0,,PR0
        10 011776   000100 101500                    MRL     fill='000'O
        10 011777   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012000   222251 000004                    ADSC9   TVAL+2,,AUTO             cn=0,n=4
        10 012001   222251 236100                    LDQ     TVAL+2,,AUTO
        10 012002   000002 136007                    SBLQ    2,DL
        10 012003   222250 756100                    STQ     TVAL+1,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:392  
        10 012004   000100 101500                    MRL     fill='000'O
        10 012005   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012006   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     2494    15057    3           SCRUNCH = '1'B;

  15057 10 012007   400000 236003                    LDQ     -131072,DU
        10 012010   222177 756100                    STQ     SCRUNCH,,AUTO

     2495    15058    3           END;

     2496    15059    2       CALL INDEX( LENGTH, '\', FROM$->TEXTC.T, START);

  15059 10 012011   000000 471500                    LDP1    0,,PR0
        10 012012   000100 101500                    MRL     fill='000'O
        10 012013   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012014   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012015   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012016   000000 636010                    EAQ     0,X0
        10 012017   000022 772000                    QRL     18
        10 012020   222176 136100                    SBLQ    START,,AUTO
        10 012021   222251 756100                    STQ     TVAL+2,,AUTO
        10 012022   222176 236100                    LDQ     START,,AUTO
        10 012023   222251 721100                    LXL1    TVAL+2,,AUTO
        10 012024   222176 235100                    LDA     START,,AUTO
        10 012025   000000 124545                    SCM     mask='000'O
        10 012026   100000 200011                    ADSC9   0,A,PR1                  cn=1,n=*X1
        10 012027   000145 000001 11                 ADSC9   101                      cn=0,n=1
        10 012030   222175 000100                    ARG     LENGTH,,AUTO
        10 012031   222175 056100                    ASQ     LENGTH,,AUTO

     2497    15060    3       DO WHILE( LENGTH < FROM$->TEXTC.L - 1);

  15060 10 012032   012131 710000 10                 TRA     s:15069

     2498    15061    3           LENGTH = LENGTH - START;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:393  
  15061 10 012033   222175 236100                    LDQ     LENGTH,,AUTO
        10 012034   222176 136100                    SBLQ    START,,AUTO
        10 012035   222175 756100                    STQ     LENGTH,,AUTO

     2499    15062    3           SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =

  15062 10 012036   222172 470500                    LDP0    @TO$,,AUTO
        10 012037   000000 471500                    LDP1    0,,PR0
        10 012040   000100 101500                    MRL     fill='000'O
        10 012041   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012042   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012043   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012044   222171 473500                    LDP3    @FROM$,,AUTO
        10 012045   300000 474500                    LDP4    0,,PR3
        10 012046   000100 101500                    MRL     fill='000'O
        10 012047   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        10 012050   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 012051   222251 221100                    LDX1    TVAL+2,,AUTO
        10 012052   000000 622006                    EAX2    0,QL
        10 012053   222176 235100                    LDA     START,,AUTO
        10 012054   222175 723100                    LXL3    LENGTH,,AUTO
        10 012055   222174 236100                    LDQ     COUNT,,AUTO
        10 012056   040146 100545                    MLR     fill='040'O
        10 012057   400000 200012                    ADSC9   0,A,PR4                  cn=1,n=*X2
        10 012060   100000 200013                    ADSC9   0,Q,PR1                  cn=1,n=*X3

     2500    15063    3                   SUBSTR( FROM$->TEXTC.T, START, LENGTH);
     2501    15064    3           COUNT = COUNT + LENGTH + 1;

  15064 10 012061   222175 036100                    ADLQ    LENGTH,,AUTO
        10 012062   000001 036007                    ADLQ    1,DL
        10 012063   222174 756100                    STQ     COUNT,,AUTO

     2502    15065    3           START = START + LENGTH + 2;

  15065 10 012064   222176 236100                    LDQ     START,,AUTO
        10 012065   222175 036100                    ADLQ    LENGTH,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:394  
        10 012066   000002 036007                    ADLQ    2,DL
        10 012067   222176 756100                    STQ     START,,AUTO

     2503    15066    3           TO$->TEXT_CHAR( COUNT) =

  15066 10 012070   000000 471500                    LDP1    0,,PR0
        10 012071   300000 474500                    LDP4    0,,PR3
        10 012072   000100 100506                    MLR     fill='000'O
        10 012073   400000 000001                    ADSC9   0,Q,PR4                  cn=0,n=1
        10 012074   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012075   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012076   000022 772000                    QRL     18
        10 012077   000000 620006                    EAX0    0,QL
        10 012100   177000 360003                    ANX0    65024,DU
        10 012101   000000 636010                    EAQ     0,X0
        10 012102   000031 276000 11                 ORQ     25
        10 012103   222251 756100                    STQ     TVAL+2,,AUTO
        10 012104   222174 235100                    LDA     COUNT,,AUTO
        10 012105   040105 100500                    MLR     fill='040'O
        10 012106   222251 000004                    ADSC9   TVAL+2,,AUTO             cn=0,n=4
        10 012107   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1

     2504    15067    3                   BITASC( ASCBIT( FROM$->TEXT_CHAR( START)) & '177'O);
     2505    15068    3           CALL INDEX( LENGTH, '\', FROM$->TEXTC.T, START);

  15068 10 012110   300000 471500                    LDP1    0,,PR3
        10 012111   000100 101500                    MRL     fill='000'O
        10 012112   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012113   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012114   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012115   000000 636010                    EAQ     0,X0
        10 012116   000022 772000                    QRL     18
        10 012117   222176 136100                    SBLQ    START,,AUTO
        10 012120   222251 756100                    STQ     TVAL+2,,AUTO
        10 012121   222176 236100                    LDQ     START,,AUTO
        10 012122   222251 721100                    LXL1    TVAL+2,,AUTO
        10 012123   222176 235100                    LDA     START,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:395  
        10 012124   000000 124545                    SCM     mask='000'O
        10 012125   100000 200011                    ADSC9   0,A,PR1                  cn=1,n=*X1
        10 012126   000145 000001 11                 ADSC9   101                      cn=0,n=1
        10 012127   222175 000100                    ARG     LENGTH,,AUTO
        10 012130   222175 056100                    ASQ     LENGTH,,AUTO

     2506    15069    3           END;

  15069 10 012131   222171 470500                    LDP0    @FROM$,,AUTO
        10 012132   000000 471500                    LDP1    0,,PR0
        10 012133   000100 101500                    MRL     fill='000'O
        10 012134   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012135   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012136   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012137   000001 136007                    SBLQ    1,DL
        10 012140   012144 604000 10                 TMI     s:15070
        10 012141   222175 116100                    CMPQ    LENGTH,,AUTO
        10 012142   012144 600000 10                 TZE     s:15070
        10 012143   012033 603000 10                 TRC     s:15061

     2507    15070    2       LENGTH = LENGTH - START;

  15070 10 012144   222175 236100                    LDQ     LENGTH,,AUTO
        10 012145   222176 136100                    SBLQ    START,,AUTO
        10 012146   222175 756100                    STQ     LENGTH,,AUTO

     2508    15071    2       SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =

  15071 10 012147   222172 471500                    LDP1    @TO$,,AUTO
        10 012150   100000 473500                    LDP3    0,,PR1
        10 012151   000100 101500                    MRL     fill='000'O
        10 012152   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 012153   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012154   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012155   000000 474500                    LDP4    0,,PR0
        10 012156   000100 101500                    MRL     fill='000'O
        10 012157   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:396  
        10 012160   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 012161   222251 221100                    LDX1    TVAL+2,,AUTO
        10 012162   000000 622006                    EAX2    0,QL
        10 012163   222175 723100                    LXL3    LENGTH,,AUTO
        10 012164   222174 236100                    LDQ     COUNT,,AUTO
        10 012165   040146 100545                    MLR     fill='040'O
        10 012166   400000 200012                    ADSC9   0,A,PR4                  cn=1,n=*X2
        10 012167   300000 200013                    ADSC9   0,Q,PR3                  cn=1,n=*X3

     2509    15072    2               SUBSTR( FROM$->TEXTC.T, START, LENGTH);
     2510    15073    2       TO$->TEXTC.L = COUNT + LENGTH;

  15073 10 012170   100000 473500                    LDP3    0,,PR1
        10 012171   222175 036100                    ADLQ    LENGTH,,AUTO
        10 012172   222250 756100                    STQ     TVAL+1,,AUTO
        10 012173   000100 101500                    MRL     fill='000'O
        10 012174   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012175   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

     2511    15074    2       CALL INDEX( LENGTH, '(', TO$->TEXTC.T) ALTRET( NO_COMMENT);

  15074 10 012176   100000 473500                    LDP3    0,,PR1
        10 012177   000100 101500                    MRL     fill='000'O
        10 012200   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 012201   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012202   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012203   000000 124540                    SCM     mask='000'O
        10 012204   300000 200010                    ADSC9   0,,PR3                   cn=1,n=*X0
        10 012205   000146 000001 11                 ADSC9   102                      cn=0,n=1
        10 012206   222175 000100                    ARG     LENGTH,,AUTO
        10 012207   012443 606400 10                 TTN     NO_COMMENT

     2512    15075    2       COUNT = 0;

  15075 10 012210   222174 450100                    STZ     COUNT,,AUTO

     2513    15076    2       START = 0;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:397  

  15076 10 012211   222176 450100                    STZ     START,,AUTO

     2514    15077    3       DO WHILE( LENGTH < TO$->TEXTC.L);

  15077 10 012212   100000 473500                    LDP3    0,,PR1
        10 012213   000100 101500                    MRL     fill='000'O
        10 012214   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 012215   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012216   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012217   222175 116100                    CMPQ    LENGTH,,AUTO
        10 012220   012410 602000 10                 TNC     s:15097
        10 012221   012410 600000 10                 TZE     s:15097

     2515    15078    3           LENGTH = LENGTH - START;

  15078 10 012222   222175 236100                    LDQ     LENGTH,,AUTO
        10 012223   222176 136100                    SBLQ    START,,AUTO
        10 012224   222175 756100                    STQ     LENGTH,,AUTO

     2516    15079    3           SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =

  15079 10 012225   222172 470500                    LDP0    @TO$,,AUTO
        10 012226   000000 471500                    LDP1    0,,PR0
        10 012227   000100 101500                    MRL     fill='000'O
        10 012230   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012231   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012232   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012233   000000 473500                    LDP3    0,,PR0
        10 012234   000100 101500                    MRL     fill='000'O
        10 012235   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 012236   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 012237   222251 221100                    LDX1    TVAL+2,,AUTO
        10 012240   000000 622006                    EAX2    0,QL
        10 012241   222176 235100                    LDA     START,,AUTO
        10 012242   222175 723100                    LXL3    LENGTH,,AUTO
        10 012243   222174 236100                    LDQ     COUNT,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:398  
        10 012244   040146 100545                    MLR     fill='040'O
        10 012245   300000 200012                    ADSC9   0,A,PR3                  cn=1,n=*X2
        10 012246   100000 200013                    ADSC9   0,Q,PR1                  cn=1,n=*X3

     2517    15080    3                   SUBSTR( TO$->TEXTC.T, START, LENGTH);
     2518    15081    3           COUNT = COUNT + LENGTH;

  15081 10 012247   222175 036100                    ADLQ    LENGTH,,AUTO
        10 012250   222174 756100                    STQ     COUNT,,AUTO

     2519    15082    4           DO WHILE TO$->TEXT_CHAR( COUNT) = ' ';

  15082 10 012251   000000 471500                    LDP1    0,,PR0
        10 012252   040000 106506                    CMPC    fill='040'O
        10 012253   100000 000001                    ADSC9   0,Q,PR1                  cn=0,n=1
        10 012254   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 012255   012267 601000 10                 TNZ     s:15085

     2520    15083    4               COUNT = COUNT - 1;

  15083 10 012256   222174 235100                    LDA     COUNT,,AUTO
        10 012257   000001 135007                    SBLA    1,DL
        10 012260   222174 755100                    STA     COUNT,,AUTO

     2521    15084    4               END;

  15084 10 012261   222172 470500                    LDP0    @TO$,,AUTO
        10 012262   000000 471500                    LDP1    0,,PR0
        10 012263   040000 106505                    CMPC    fill='040'O
        10 012264   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
        10 012265   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 012266   012256 600000 10                 TZE     s:15083

     2522    15085    3           COUNT = COUNT + 1;

  15085 10 012267   222174 235100                    LDA     COUNT,,AUTO
        10 012270   000001 035007                    ADLA    1,DL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:399  
        10 012271   222174 755100                    STA     COUNT,,AUTO

     2523    15086    3           TO$->TEXT_CHAR( COUNT) = ' ';

  15086 10 012272   040105 100400                    MLR     fill='040'O
        10 012273   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 012274   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1

     2524    15087    3           START = START + LENGTH + 1;

  15087 10 012275   222176 236100                    LDQ     START,,AUTO
        10 012276   222175 036100                    ADLQ    LENGTH,,AUTO
        10 012277   000001 036007                    ADLQ    1,DL
        10 012300   222176 756100                    STQ     START,,AUTO

     2525    15088    3           CALL INDEX( START, ')', TO$->TEXTC.T, START);

  15088 10 012301   000000 471500                    LDP1    0,,PR0
        10 012302   000100 101500                    MRL     fill='000'O
        10 012303   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012304   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012305   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012306   000000 636010                    EAQ     0,X0
        10 012307   000022 772000                    QRL     18
        10 012310   222176 136100                    SBLQ    START,,AUTO
        10 012311   222251 756100                    STQ     TVAL+2,,AUTO
        10 012312   222176 236100                    LDQ     START,,AUTO
        10 012313   222251 721100                    LXL1    TVAL+2,,AUTO
        10 012314   222176 235100                    LDA     START,,AUTO
        10 012315   000000 124545                    SCM     mask='000'O
        10 012316   100000 200011                    ADSC9   0,A,PR1                  cn=1,n=*X1
        10 012317   000115 000001 11                 ADSC9   77                       cn=0,n=1
        10 012320   222176 000100                    ARG     START,,AUTO
        10 012321   222176 056100                    ASQ     START,,AUTO

     2526    15089    4           IF START < TO$->TEXTC.L THEN DO;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:400  
  15089 10 012322   000000 471500                    LDP1    0,,PR0
        10 012323   000100 101500                    MRL     fill='000'O
        10 012324   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012325   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012326   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012327   222176 116100                    CMPQ    START,,AUTO
        10 012330   012357 602000 10                 TNC     s:15095
        10 012331   012357 600000 10                 TZE     s:15095

     2527    15090    4               START = START + 1;

  15090 10 012332   222176 235100                    LDA     START,,AUTO
        10 012333   000001 035007                    ADLA    1,DL
        10 012334   222176 755100                    STA     START,,AUTO

     2528    15091    5               DO WHILE START < TO$->TEXTC.L AND TO$->TEXT_CHAR( START+1) = ' ';

  15091 10 012335   012341 710000 10                 TRA     s:15093

     2529    15092    5                   START = START + 1;

  15092 10 012336   222176 235100                    LDA     START,,AUTO
        10 012337   000001 035007                    ADLA    1,DL
        10 012340   222176 755100                    STA     START,,AUTO

     2530    15093    5                   END;

  15093 10 012341   222172 470500                    LDP0    @TO$,,AUTO
        10 012342   000000 471500                    LDP1    0,,PR0
        10 012343   000100 101500                    MRL     fill='000'O
        10 012344   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012345   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012346   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012347   222176 116100                    CMPQ    START,,AUTO
        10 012350   012357 602000 10                 TNC     s:15095
        10 012351   012357 600000 10                 TZE     s:15095
        10 012352   000000 471500                    LDP1    0,,PR0
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:401  
        10 012353   040000 106505                    CMPC    fill='040'O
        10 012354   100000 200001                    ADSC9   0,A,PR1                  cn=1,n=1
        10 012355   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 012356   012336 600000 10                 TZE     s:15092

     2531    15094    4               END;

     2532    15095    3           CALL INDEX( LENGTH, '(', TO$->TEXTC.T, START);

  15095 10 012357   000000 471500                    LDP1    0,,PR0
        10 012360   000100 101500                    MRL     fill='000'O
        10 012361   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012362   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012363   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012364   000000 636010                    EAQ     0,X0
        10 012365   000022 772000                    QRL     18
        10 012366   222176 136100                    SBLQ    START,,AUTO
        10 012367   222251 756100                    STQ     TVAL+2,,AUTO
        10 012370   222176 236100                    LDQ     START,,AUTO
        10 012371   222251 721100                    LXL1    TVAL+2,,AUTO
        10 012372   222176 235100                    LDA     START,,AUTO
        10 012373   000000 124545                    SCM     mask='000'O
        10 012374   100000 200011                    ADSC9   0,A,PR1                  cn=1,n=*X1
        10 012375   000146 000001 11                 ADSC9   102                      cn=0,n=1
        10 012376   222175 000100                    ARG     LENGTH,,AUTO
        10 012377   222175 056100                    ASQ     LENGTH,,AUTO

     2533    15096    3           END;

  15096 10 012400   000000 471500                    LDP1    0,,PR0
        10 012401   000100 101500                    MRL     fill='000'O
        10 012402   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012403   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012404   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012405   222175 116100                    CMPQ    LENGTH,,AUTO
        10 012406   012410 600000 10                 TZE     s:15097
        10 012407   012222 603000 10                 TRC     s:15078
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:402  

     2534    15097    2       LENGTH = LENGTH - START;

  15097 10 012410   222175 236100                    LDQ     LENGTH,,AUTO
        10 012411   222176 136100                    SBLQ    START,,AUTO
        10 012412   222175 756100                    STQ     LENGTH,,AUTO

     2535    15098    2       SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =

  15098 10 012413   222172 470500                    LDP0    @TO$,,AUTO
        10 012414   000000 471500                    LDP1    0,,PR0
        10 012415   000100 101500                    MRL     fill='000'O
        10 012416   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012417   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012420   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012421   000000 473500                    LDP3    0,,PR0
        10 012422   000100 101500                    MRL     fill='000'O
        10 012423   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 012424   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 012425   222251 221100                    LDX1    TVAL+2,,AUTO
        10 012426   000000 622006                    EAX2    0,QL
        10 012427   222176 235100                    LDA     START,,AUTO
        10 012430   222175 723100                    LXL3    LENGTH,,AUTO
        10 012431   222174 236100                    LDQ     COUNT,,AUTO
        10 012432   040146 100545                    MLR     fill='040'O
        10 012433   300000 200012                    ADSC9   0,A,PR3                  cn=1,n=*X2
        10 012434   100000 200013                    ADSC9   0,Q,PR1                  cn=1,n=*X3

     2536    15099    2               SUBSTR( TO$->TEXTC.T, START, LENGTH);
     2537    15100    2       TO$->TEXTC.L = COUNT + LENGTH;

  15100 10 012435   000000 471500                    LDP1    0,,PR0
        10 012436   222175 036100                    ADLQ    LENGTH,,AUTO
        10 012437   222250 756100                    STQ     TVAL+1,,AUTO
        10 012440   000100 101500                    MRL     fill='000'O
        10 012441   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012442   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:403  

     2538    15101    2   NO_COMMENT:
     2539    15102    3       DO WHILE TO$->TEXT_CHAR( TO$->TEXTC.L) = ' ';

  15102 10 012443   222172 470500       NO_COMMENT   LDP0    @TO$,,AUTO
        10 012444   000000 471500                    LDP1    0,,PR0
        10 012445   000100 101500                    MRL     fill='000'O
        10 012446   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012447   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012450   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012451   040000 106506                    CMPC    fill='040'O
        10 012452   100000 000001                    ADSC9   0,Q,PR1                  cn=0,n=1
        10 012453   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 012454   012501 601000 10                 TNZ     s:15105

     2540    15103    3           TO$->TEXTC.L = TO$->TEXTC.L - 1;

  15103 10 012455   222172 470500                    LDP0    @TO$,,AUTO
        10 012456   000000 471500                    LDP1    0,,PR0
        10 012457   000100 101500                    MRL     fill='000'O
        10 012460   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012461   222251 000004                    ADSC9   TVAL+2,,AUTO             cn=0,n=4
        10 012462   222251 236100                    LDQ     TVAL+2,,AUTO
        10 012463   000001 136007                    SBLQ    1,DL
        10 012464   222250 756100                    STQ     TVAL+1,,AUTO
        10 012465   000100 101500                    MRL     fill='000'O
        10 012466   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012467   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     2541    15104    3           END;

  15104 10 012470   000000 471500                    LDP1    0,,PR0
        10 012471   000100 101500                    MRL     fill='000'O
        10 012472   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012473   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012474   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012475   040000 106506                    CMPC    fill='040'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:404  
        10 012476   100000 000001                    ADSC9   0,Q,PR1                  cn=0,n=1
        10 012477   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 012500   012455 600000 10                 TZE     s:15103

     2542    15105    2       IF SCRUNCH THEN

  15105 10 012501   222177 234100                    SZN     SCRUNCH,,AUTO
        10 012502   012533 605000 10                 TPL     s:15108

     2543    15106    2           SUBSTR( FROM$->TEXTC.T, 0, FROM$->TEXTC.L) =

  15106 10 012503   222171 471500                    LDP1    @FROM$,,AUTO
        10 012504   100000 473500                    LDP3    0,,PR1
        10 012505   000100 101500                    MRL     fill='000'O
        10 012506   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 012507   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012510   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012511   100000 474500                    LDP4    0,,PR1
        10 012512   000100 101500                    MRL     fill='000'O
        10 012513   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        10 012514   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 012515   222251 221100                    LDX1    TVAL+2,,AUTO
        10 012516   100000 474500                    LDP4    0,,PR1
        10 012517   000100 101500                    MRL     fill='000'O
        10 012520   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        10 012521   222252 000002                    ADSC9   TVAL+3,,AUTO             cn=0,n=2
        10 012522   222252 222100                    LDX2    TVAL+3,,AUTO
        10 012523   100000 475500                    LDP5    0,,PR1
        10 012524   000100 101500                    MRL     fill='000'O
        10 012525   500000 000001                    ADSC9   0,,PR5                   cn=0,n=1
        10 012526   222253 000002                    ADSC9   TVAL+4,,AUTO             cn=0,n=2
        10 012527   222253 223100                    LDX3    TVAL+4,,AUTO
        10 012530   040140 100540                    MLR     fill='040'O
        10 012531   400000 400013                    ADSC9   0,,PR4                   cn=2,n=*X3
        10 012532   300000 200011                    ADSC9   0,,PR3                   cn=1,n=*X1

     2544    15107    2                   SUBSTR( FROM$->TEXTC.T, 1, FROM$->TEXTC.L);
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:405  
     2545    15108    2       RETURN;

  15108 10 012533   222170 221300                    LDX1  ! USER$+1,,AUTO
        10 012534   000001 702211                    TSX2  ! 1,X1

     2546    15109
     2547    15110    2       END MOVE_STRING;
     2548    15111        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:406  
     2549    15112        /********** PROCEDURE TO MOVE RETURN PATH FROM MESSAGE HEADER,
     2550    15113        STRIPPING BLANKS
     2551    15114        */
     2552    15115    1   MOVE_PATH: PROC( FROM$, TO$, OFFSET) ALTRET;

  15115 10 012535   221536 741300       MOVE_PATH    STX1  ! HEX2+2,,AUTO

     2553    15116
     2554    15117    2       DCL COUNT UBIN;
     2555    15118    2       DCL FROM$ PTR;
     2556    15119    2       DCL LENGTH UBIN;
     2557    15120    2       DCL OFFSET UBIN;
     2558    15121    2       DCL START UBIN;
     2559    15122    2       DCL TO$ PTR;
     2560    15123
     2561    15124    3       IF FROM$->TEXTC.L - OFFSET > %PATH_SIZE THEN DO;

  15124 10 012536   221537 470500                    LDP0    @FROM$,,AUTO
        10 012537   000000 471500                    LDP1    0,,PR0
        10 012540   221541 473500                    LDP3    @OFFSET,,AUTO
        10 012541   000100 101500                    MRL     fill='000'O
        10 012542   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012543   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012544   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012545   300000 136100                    SBLQ    0,,PR3
        10 012546   000360 116007                    CMPQ    240,DL
        10 012547   012553 604400 10                 TMOZ    s:15128

     2562    15125    3           REPLY$ = R552$;

  15125 10 012550   000042 236000 2                  LDQ     R552$
        10 012551   000722 756000 1                  STQ     REPLY$

     2563    15126    3           ALTRETURN;

  15126 10 012552   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:407  
     2564    15127    3           END;
     2565    15128    2       COUNT = 0;

  15128 10 012553   221542 450100                    STZ     COUNT,,AUTO

     2566    15129    2       START = OFFSET;

  15129 10 012554   300000 235100                    LDA     0,,PR3
        10 012555   221544 755100                    STA     START,,AUTO

     2567    15130    2       CALL INDEX( LENGTH, ' ', FROM$->TEXTC.T, START);

  15130 10 012556   000000 471500                    LDP1    0,,PR0
        10 012557   000100 101500                    MRL     fill='000'O
        10 012560   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012561   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012562   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012563   000000 636010                    EAQ     0,X0
        10 012564   000022 772000                    QRL     18
        10 012565   221544 136100                    SBLQ    START,,AUTO
        10 012566   222251 756100                    STQ     TVAL+2,,AUTO
        10 012567   221544 236100                    LDQ     START,,AUTO
        10 012570   222251 722100                    LXL2    TVAL+2,,AUTO
        10 012571   000000 124545                    SCM     mask='000'O
        10 012572   100000 200012                    ADSC9   0,A,PR1                  cn=1,n=*X2
        10 012573   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 012574   221543 000100                    ARG     LENGTH,,AUTO
        10 012575   221543 056100                    ASQ     LENGTH,,AUTO

     2568    15131    3       DO WHILE( LENGTH < FROM$->TEXTC.L);

  15131 10 012576   000000 471500                    LDP1    0,,PR0
        10 012577   000100 101500                    MRL     fill='000'O
        10 012600   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012601   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012602   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012603   221543 116100                    CMPQ    LENGTH,,AUTO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:408  
        10 012604   012711 602000 10                 TNC     s:15142
        10 012605   012711 600000 10                 TZE     s:15142

     2569    15132    3           LENGTH = LENGTH - START;

  15132 10 012606   221543 236100                    LDQ     LENGTH,,AUTO
        10 012607   221544 136100                    SBLQ    START,,AUTO
        10 012610   221543 756100                    STQ     LENGTH,,AUTO

     2570    15133    3           SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =

  15133 10 012611   221540 470500                    LDP0    @TO$,,AUTO
        10 012612   000000 471500                    LDP1    0,,PR0
        10 012613   000100 101500                    MRL     fill='000'O
        10 012614   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012615   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012616   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012617   221537 473500                    LDP3    @FROM$,,AUTO
        10 012620   300000 474500                    LDP4    0,,PR3
        10 012621   000100 101500                    MRL     fill='000'O
        10 012622   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        10 012623   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 012624   222251 221100                    LDX1    TVAL+2,,AUTO
        10 012625   000000 622006                    EAX2    0,QL
        10 012626   221544 235100                    LDA     START,,AUTO
        10 012627   221543 723100                    LXL3    LENGTH,,AUTO
        10 012630   221542 236100                    LDQ     COUNT,,AUTO
        10 012631   040146 100545                    MLR     fill='040'O
        10 012632   400000 200012                    ADSC9   0,A,PR4                  cn=1,n=*X2
        10 012633   100000 200013                    ADSC9   0,Q,PR1                  cn=1,n=*X3

     2571    15134    3                   SUBSTR( FROM$->TEXTC.T, START, LENGTH);
     2572    15135    3           COUNT = COUNT + LENGTH;

  15135 10 012634   221543 036100                    ADLQ    LENGTH,,AUTO
        10 012635   221542 756100                    STQ     COUNT,,AUTO

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:409  
     2573    15136    3           START = START + LENGTH + 1;

  15136 10 012636   221544 236100                    LDQ     START,,AUTO
        10 012637   221543 036100                    ADLQ    LENGTH,,AUTO
        10 012640   000001 036007                    ADLQ    1,DL
        10 012641   221544 756100                    STQ     START,,AUTO

     2574    15137    4           DO WHILE( SUBSTR( FROM$->TEXTC.T, START, 1) = ' ');

  15137 10 012642   012646 710000 10                 TRA     s:15139

     2575    15138    4               START = START + 1;

  15138 10 012643   221544 235100                    LDA     START,,AUTO
        10 012644   000001 035007                    ADLA    1,DL
        10 012645   221544 755100                    STA     START,,AUTO

     2576    15139    4               END;

  15139 10 012646   221537 470500                    LDP0    @FROM$,,AUTO
        10 012647   000000 471500                    LDP1    0,,PR0
        10 012650   000100 101500                    MRL     fill='000'O
        10 012651   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012652   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
        10 012653   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012654   221544 235100                    LDA     START,,AUTO
        10 012655   040000 106505                    CMPC    fill='040'O
        10 012656   100000 200001                    ADSC9   0,A,PR1                  cn=1,n=1
        10 012657   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 012660   012643 600000 10                 TZE     s:15138

     2577    15140    3           CALL INDEX( LENGTH, ' ', FROM$->TEXTC.T, START);

  15140 10 012661   000000 471500                    LDP1    0,,PR0
        10 012662   000100 101500                    MRL     fill='000'O
        10 012663   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012664   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:410  
        10 012665   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012666   000000 636010                    EAQ     0,X0
        10 012667   000022 772000                    QRL     18
        10 012670   221544 136100                    SBLQ    START,,AUTO
        10 012671   222251 756100                    STQ     TVAL+2,,AUTO
        10 012672   221544 236100                    LDQ     START,,AUTO
        10 012673   222251 721100                    LXL1    TVAL+2,,AUTO
        10 012674   000000 124545                    SCM     mask='000'O
        10 012675   100000 200011                    ADSC9   0,A,PR1                  cn=1,n=*X1
        10 012676   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 012677   221543 000100                    ARG     LENGTH,,AUTO
        10 012700   221543 056100                    ASQ     LENGTH,,AUTO

     2578    15141    3           END;

  15141 10 012701   000000 471500                    LDP1    0,,PR0
        10 012702   000100 101500                    MRL     fill='000'O
        10 012703   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        10 012704   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012705   222250 236100                    LDQ     TVAL+1,,AUTO
        10 012706   221543 116100                    CMPQ    LENGTH,,AUTO
        10 012707   012711 600000 10                 TZE     s:15142
        10 012710   012606 603000 10                 TRC     s:15132

     2579    15142    2       LENGTH = LENGTH - START;

  15142 10 012711   221543 236100                    LDQ     LENGTH,,AUTO
        10 012712   221544 136100                    SBLQ    START,,AUTO
        10 012713   221543 756100                    STQ     LENGTH,,AUTO

     2580    15143    2       SUBSTR( TO$->TEXTC.T, COUNT, LENGTH) =

  15143 10 012714   221540 471500                    LDP1    @TO$,,AUTO
        10 012715   100000 473500                    LDP3    0,,PR1
        10 012716   000100 101500                    MRL     fill='000'O
        10 012717   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        10 012720   222250 000002                    ADSC9   TVAL+1,,AUTO             cn=0,n=2
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:411  
        10 012721   222250 220100                    LDX0    TVAL+1,,AUTO
        10 012722   000000 474500                    LDP4    0,,PR0
        10 012723   000100 101500                    MRL     fill='000'O
        10 012724   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        10 012725   222251 000002                    ADSC9   TVAL+2,,AUTO             cn=0,n=2
        10 012726   222251 221100                    LDX1    TVAL+2,,AUTO
        10 012727   000000 622006                    EAX2    0,QL
        10 012730   221543 723100                    LXL3    LENGTH,,AUTO
        10 012731   221542 236100                    LDQ     COUNT,,AUTO
        10 012732   040146 100545                    MLR     fill='040'O
        10 012733   400000 200012                    ADSC9   0,A,PR4                  cn=1,n=*X2
        10 012734   300000 200013                    ADSC9   0,Q,PR3                  cn=1,n=*X3

     2581    15144    2               SUBSTR( FROM$->TEXTC.T, START, LENGTH);
     2582    15145    2       TO$->TEXTC.L = COUNT + LENGTH;

  15145 10 012735   100000 473500                    LDP3    0,,PR1
        10 012736   221543 036100                    ADLQ    LENGTH,,AUTO
        10 012737   222250 756100                    STQ     TVAL+1,,AUTO
        10 012740   000100 101500                    MRL     fill='000'O
        10 012741   222250 000004                    ADSC9   TVAL+1,,AUTO             cn=0,n=4
        10 012742   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

     2583    15146    2       RETURN;

  15146 10 012743   221536 221300                    LDX1  ! HEX2+2,,AUTO
        10 012744   000001 702211                    TSX2  ! 1,X1

     2584    15147
     2585    15148    2       END MOVE_PATH;
     2586    15149        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:412  
     2587    15150    1   STATUS_LINE_UPDATE: PROC;

  15150 10 012745   221716 741300       STATUS_LINE* STX1  ! CURR_CMDCODE+2,,AUTO

     2588    15151
     2589    15152    2       DCL IDLESTATUS BIT(1);
     2590    15153
     2591    15154    2       IDLESTATUS = '0'B;

  15154 10 012746   221717 450100                    STZ     IDLESTATUS,,AUTO

     2592    15155    2   COMMON:
     2593    15156    3       IF B$JIT.PRIV.ACTIVE.JIT THEN DO;

  15156 10 012747   000000 470400 xsym  COMMON       LDP0    B$JIT$
        10 012750   000013 236100                    LDQ     11,,PR0
        10 012751   000040 316007                    CANQ    32,DL
        10 012752   012760 600000 10                 TZE     s:15160

     2594    15157    3           B$JIT.CCBUF = STATUS;

  15157 10 012753   040100 100400                    MLR     fill='040'O
        10 012754   003367 000065 1                  ADSC9   STATUS_LINE              cn=0,n=53
        10 012755   000033 000400                    ADSC9   27,,PR0                  cn=0,n=256

     2595    15158    3           B$JIT.CCARS = LENGTHC( STATUS);

  15158 10 012756   000065 220003                    LDX0    53,DU
        10 012757   000032 740100                    STX0    26,,PR0

     2596    15159    3           END;

     2597    15160    2       IF IDLESTATUS THEN

  15160 10 012760   221717 234100                    SZN     IDLESTATUS,,AUTO
        10 012761   012765 605000 10                 TPL     s:15162

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:413  
     2598    15161    2           CALL CONCAT( STATUS, TCM_PROGNAME);

  15161 10 012762   040000 100400                    MLR     fill='040'O
        10 012763   000220 000007 1                  ADSC9   TCM_PROGNAME             cn=0,n=7
        10 012764   003367 000065 1                  ADSC9   STATUS_LINE              cn=0,n=53

     2599    15162    2       RETURN;

  15162 10 012765   221716 221300                    LDX1  ! CURR_CMDCODE+2,,AUTO
        10 012766   000001 702211                    TSX2  ! 1,X1

     2600    15163
     2601    15164    2   STATUS_LINE_IDLE: ENTRY;

  15164 10 012767   221716 741300       STATUS_LINE* STX1  ! CURR_CMDCODE+2,,AUTO

     2602    15165
     2603    15166    2       IDLESTATUS = '1'B;

  15166 10 012770   400000 236003                    LDQ     -131072,DU
        10 012771   221717 756100                    STQ     IDLESTATUS,,AUTO

     2604    15167    2       CALL M$TIME( GET_TIMESTAMP);

  15167 10 012772   001532 630400 2                  EPPR0   GET_TIMESTAMP
        10 012773   020004 713400                    CLIMB   8196
        10 012774   402000 401760                    pmme    nvectors=5

     2605    15168    2       CALL CONCAT( STATUS, TCM_PROGNAME, ':Idle since ',

  15168 10 012775   040000 100400                    MLR     fill='040'O
        10 012776   000220 000007 1                  ADSC9   TCM_PROGNAME             cn=0,n=7
        10 012777   003367 000007 1                  ADSC9   STATUS_LINE              cn=0,n=7
        10 013000   040000 100400                    MLR     fill='040'O
        10 013001   002317 000014 2                  ADSC9   XSERRMSG+226             cn=0,n=12
        10 013002   003370 600014 1                  ADSC9   STATUS_LINE+1            cn=3,n=12
        10 013003   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:414  
        10 013004   003413 000005 1                  ADSC9   TIMEBUF                  cn=0,n=5
        10 013005   003373 600005 1                  ADSC9   STATUS_LINE+4            cn=3,n=5
        10 013006   040000 236003                    LDQ     16384,DU
        10 013007   003375 552040 1                  STBQ    STATUS_LINE+6,'40'O
        10 013010   040000 100400                    MLR     fill='040'O
        10 013011   003415 000003 1                  ADSC9   DAYBUF                   cn=0,n=3
        10 013012   003375 200034 1                  ADSC9   STATUS_LINE+6            cn=1,n=28

     2606    15169    2               SUBSTR( TIMESTRING, 0, 5), ' ', DAYBUF);
     2607    15170    2       GOTO COMMON;

  15170 10 013013   012747 710000 10                 TRA     COMMON

     2608    15171
     2609    15172    2       END STATUS_LINE_UPDATE;
     2610    15173        %EJECT;
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:415  
     2611    15174    1   WRITEDO: PROC;

  15174 10 013014   221546 741300       WRITEDO      STX1  ! RCVDBUF,,AUTO

     2612    15175
     2613    15176    2       DCL VLEN UBIN;
     2614    15177
     2615    15178    2       CALL GET_IOBUF_BOUND( CMDBUF, VLEN);

  15178 10 013015   221547 630500                    EPPR0   VLEN,,AUTO
        10 013016   222246 450500                    STP0    @BUF+1,,AUTO
        10 013017   221426 631500                    EPPR1   CMDBUF,,AUTO
        10 013020   222245 451500                    STP1    TEMP+2,,AUTO
        10 013021   013043 701000 10                 TSX1    GET_IOBUF_BOUND
        10 013022   000000 011000                    NOP     0

     2616    15179    2       IF VLEN = 0 THEN

  15179 10 013023   221547 235100                    LDA     VLEN,,AUTO
        10 013024   013030 601000 10                 TNZ     s:15182

     2617    15180    2           WRITE_DO.BUF_ = VECTOR( NIL);

  15180 10 013025   000140 237000 11                 LDAQ    96
        10 013026   003436 757000 1                  STAQ    WRITE_DO+4
        10 013027   013036 710000 10                 TRA     s:15183

     2618    15181    2       ELSE
     2619    15182    2           WRITE_DO.BUF_ = VECTOR( SUBSTR( CMDBUF, 0, VLEN));

  15182 10 013030   000020 735000                    ALS     16
        10 013031   000140 135007                    SBLA    96,DL
        10 013032   222250 452500                    STP2    TVAL+1,,AUTO
        10 013033   222250 236100                    LDQ     TVAL+1,,AUTO
        10 013034   021426 036003                    ADLQ    8982,DU
        10 013035   003436 757000 1                  STAQ    WRITE_DO+4

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:416  
     2620    15183    2       CALL M$WRITE( WRITE_DO);

  15183 10 013036   003432 630400 1                  EPPR0   WRITE_DO
        10 013037   040001 713400                    CLIMB   write
        10 013040   401400 401760                    pmme    nvectors=4

     2621    15184    2       RETURN;

  15184 10 013041   221546 221300                    LDX1  ! RCVDBUF,,AUTO
        10 013042   000001 702211                    TSX2  ! 1,X1

     2622    15185
     2623    15186    2       END WRITEDO;
     2624    15187
     2625    15188    1   GET_IOBUF_BOUND: PROC( BUF, VLEN);

  15188 10 013043   222244 741300       GET_IOBUF_B* STX1  ! TEMP+1,,AUTO

     2626    15189
     2627    15190    2       DCL BUF CHAR( %BUFSIZ);
     2628    15191    2       DCL VLEN UBIN;
     2629    15192    2       DCL TVAL SBIN;
     2630    15193
     2631    15194    2       CALL SEARCHR( VLEN, TVAL, TCM_SKIP_BLANKS, BUF) ALTRET( BLANK_LINE);

  15194 10 013044   222245 470500                    LDP0    @BUF,,AUTO
        10 013045   222246 471500                    LDP1    @VLEN,,AUTO
        10 013046   000000 165500                    TCTR
        10 013047   000000 000377                    ADSC9   0,,PR0                   cn=0,n=255
        10 013050   000260 000000 2                  ARG     TCM_SKIP_BLANKS
        10 013051   100000 000100                    ARG     0,,PR1
        10 013052   100000 235100                    LDA     0,,PR1
        10 013053   000033 771000                    ARL     27
        10 013054   222247 755100                    STA     TVAL,,AUTO
        10 013055   100000 551140                    STBA    0,'40'O,PR1
        10 013056   013066 606400 10                 TTN     BLANK_LINE
        10 013057   000376 236007                    LDQ     254,DL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:417  
        10 013060   100000 156100                    SSQ     0,,PR1

     2632    15195    2       VLEN = VLEN + 1;

  15195 10 013061   100000 235100                    LDA     0,,PR1
        10 013062   000001 035007                    ADLA    1,DL
        10 013063   100000 755100                    STA     0,,PR1

     2633    15196    2       RETURN;

  15196 10 013064   222244 221300                    LDX1  ! TEMP+1,,AUTO
        10 013065   000001 702211                    TSX2  ! 1,X1

     2634    15197    2   BLANK_LINE:
     2635    15198    2       VLEN = 0;

  15198 10 013066   222246 470500       BLANK_LINE   LDP0    @VLEN,,AUTO
        10 013067   000000 450100                    STZ     0,,PR0

     2636    15199    2       RETURN;

  15199 10 013070   222244 221300                    LDX1  ! TEMP+1,,AUTO
        10 013071   000001 702211                    TSX2  ! 1,X1

     2637    15200
     2638    15201    2       END GET_IOBUF_BOUND;
     2639    15202
     2640    15203    1       END TCM$NETMAIL;

  15203 10 013072   000000 702200 xent               TSX2  ! X66_MARET

TCM_PCB
 Sect OctLoc
   1     000   000000 006014   000000 006014   001625 006000   000000 006014    ................
   1     004   000000 000000   001440 500000   000000 000000   040040 040040    ............
   1     010   000000 040000   000000 000000   000000 000000   000000 006014    .. .............
   1     014   000000 006014   000000 000000                                    ........
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:418  

XUR_INIT
 Sect OctLoc
   1     016   020000 000001   000000 000000   000000 000000   000000 000000    ................
   1     022   000000 006000   000000 177640   000000 006014   000000 000000    ................
   1     026   000000 006014   000000 000000   000000 000000   ****** ******    ................
   1     032   000000 177640   000000 006014   000000 000000   000000 000000    ................
   1     036   000000 177640   000000 006014   000000 000000   00000* ******    ................
   1     042   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     062*  000000 000000   000000 000000   000000 000000                    ............

XUG_INIT
 Sect OctLoc
   1     066   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     076*  000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     102   000000 006014   000000 177640   000000 006014   000000 006014    ................
   1     106   000000 006014   000000 177640   000000 006014   000000 000454    ................
   1     112   000144 000144   000000 000000   070000 000000   000000 000000    .d.d....8.......
   1     116   000000 000000   000000 000000   000000 000000   000000 006014    ................
   1     122   000000 006014   000000 006014   000000 006014   000000 006014    ................
   1     126   00000* ******   000000 000000   000000 000000   000000 000000    ................

XUG_GETCMD
 Sect OctLoc
   1     132   000000 006000   000000 006014   000000 006014   000000 006014    ................
   1     136   000000 006014   000000 006014   240000 000000   04000* ***000    ............ ...
   1     142   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     146   000000 000000   000000 000000   000000 000000   000000 177640    ................
   1     152   000000 006014   000000 177640   000000 006014   000000 177640    ................
   1     156   000000 006014   000000 577640   000011 006000   000000 177640    ................
   1     162   000000 006014   000000 000000   000000 000000   000000 000000    ................
   1     166   000000 177640   000000 006014   000000 006014   000000 000000    ................
   1     172   000000 006014   000000 006014   000000 006014   000000 006014    ................
   1     176   000000 006014   000000 006014   000000 000000   000000 000000    ................
   1     202   000000 000000   000000 000000                                    ........

OLD_CMD_LCN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:419  
 Sect OctLoc
   1     210   777777 777777                                                    ....

CB
 Sect OctLoc
   1     211   ****** ******   ****** ******   ****** ******   ****** ******    ................

TCM_DRIBBLE
 Sect OctLoc
   1     216   000000 000000                                                    ....

TCM_DRIBBLE_ME
 Sect OctLoc
   1     217   000000 000000                                                    ....

TCM_PROGNAME
 Sect OctLoc
   1     220   116105 124115   101111 114***                                    NETMAIL.

TCM_STUCKEE
 Sect OctLoc
   1     222   040040 040040   040040 040040   040040 040040   040040 040040
   1     226   040040 040040   040040 040040   040040 040040   040040 040040

TCM_TZTEXT
 Sect OctLoc
   1     232   040120 123124   040040 ******                                     PST  ..

TCM_UTOFFSET
 Sect OctLoc
   1     234   777765 007000                                                    ....

FEPNAMES
 Sect OctLoc
   1     235   040040 040040   040040 040040   040040 040040   040040 040040
   1     255*  040040 040040   040040 040040

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:420  
REPLY220
 Sect OctLoc
   1     257   076062 062060   040040 040040   040040 040040   040040 040123    >220           S
   1     263   115124 120040   162145 141144   171040 141164   040110 110072    MTP ready at HH:
   1     267   115115 072123   123040 115115   115040 104104   040047 131131    MM:SS MMM DD 'YY
   1     273   040040 114151   156145 040146   146055 154154   154154 ******      Line ff-llll..

REPLY221
 Sect OctLoc
   1     277   051062 062061   040040 040040   040040 040040   040040 103154    )221          Cl
   1     303   157163 151156   147040 164162   141156 163155   151163 163151    osing transmissi
   1     307   157156 040143   150141 156156   145154 ******                    on channel..

REPLY250
 Sect OctLoc
   1     312   010062 065060   040117 153141   171*** ******                    .250 Okay...

REPLY250OOPS
 Sect OctLoc
   1     315   055062 065060   040115 141151   154145 162040   147154 151164    -250 Mailer glit
   1     321   143150 073040   161165 145165   145144 040146   157162 040155    ch; queued for m
   1     325   141156 165141   154040 144145   154151 166145   162171 ******    anual delivery..

REPLY250A
 Sect OctLoc
   1     331   015062 065060   040040 040040   040040 040040   040040 ******    .250          ..

REPLY250V
 Sect OctLoc
   1     335   003062 065060   040040 040040   040040 040040   040040 040040    .250
   1     341   040040 040040   040040 040040   040040 040040   040040 040040
   1     431*  040040 040040   040040 040040   040040 040040   040040 040040

REPLY354
 Sect OctLoc
   1     435   024063 065064   040123 164141   162164 040155   141151 154040    .354 Start mail
   1     441   151156 160165   164*** ******                                    input...
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:421  

REPLY421
 Sect OctLoc
   1     443   051064 062061   040040 040040   040040 040040   040040 103154    )421          Cl
   1     447   157163 151156   147040 164162   141156 163155   151163 163151    osing transmissi
   1     453   157156 040143   150141 156156   145154 ******                    on channel..

REPLY421TO
 Sect OctLoc
   1     456   070064 062061   040124 151155   145157 165164   040144 165162    8421 Timeout dur
   1     462   151156 147040   155145 163163   141147 145040   162145 143145    ing message rece
   1     466   160164 151157   156073 040160   154145 141163   145040 162145    ption; please re
   1     472   164162 141156   163155 151164   056*** ******                    transmit....

REPLY421ZAP
 Sect OctLoc
   1     475   071064 062061   040040 040040   040040 040040   040040 124162    9421          Tr
   1     501   141156 163155   151163 163151   157156 040143   150141 156156    ansmission chann
   1     505   145154 040164   151155 145144   040157 165164   040157 162040    el timed out or
   1     511   154157 163164   040144 141164   141056 ******                    lost data...

REPLY421DL
 Sect OctLoc
   1     514   061064 062061   040104 141164   141040 154157   163164 040151    1421 Data lost i
   1     520   156040 164162   141156 163155   151163 163151   157156 073040    n transmission;
   1     524   160154 145141   163145 040162   145164 162141   156163 155151    please retransmi
   1     530   164056 ******                                                    t...

REPLY451
 Sect OctLoc
   1     531   067064 065061   040122 145161   165145 163164   145144 040141    7451 Requested a
   1     535   143164 151157   156040 141142   157162 164145   144056 040105    ction aborted. E
   1     541   162162 157162   040151 156040   154157 143141   154040 160162    rror in local pr
   1     545   157143 145163   163151 156147                                    ocessing

REPLY500
 Sect OctLoc
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:422  
   1     547   033065 060060   040103 157155   155141 156144   040156 157164    .500 Command not
   1     553   040162 145143   157147 156151   172145 144056                     recognized.

REPLY501
 Sect OctLoc
   1     556   054065 060061   040123 171156   164141 170040   145162 162157    ,501 Syntax erro
   1     562   162040 151156   040160 141162   141155 145164   145162 163040    r in parameters
   1     566   157162 040141   162147 165155   145156 164163   056*** ******    or arguments....

REPLY502
 Sect OctLoc
   1     572   033065 060062   040103 157155   155141 156144   040156 157164    .502 Command not
   1     576   040151 155160   154145 155145   156164 145144                     implemented

REPLY503
 Sect OctLoc
   1     601   034065 060063   040111 156166   141154 151144   040143 157155    .503 Invalid com
   1     605   155141 156144   040163 145161   165145 156143   145*** ******    mand sequence...

REPLY550
 Sect OctLoc
   1     611   023065 065060   040115 141151   154142 157170   040165 156153    .550 Mailbox unk
   1     615   156157 167156                                                    nown

REPLY550NONODE
 Sect OctLoc
   1     616   060065 065060   040103 141156   156157 164040   141143 143145    0550 Cannot acce
   1     622   163163 040072   116117 104105   123040 146151   154145 040164    ss :NODES file t
   1     626   157040 146157   162167 141162   144040 155145   163163 141147    o forward messag
   1     632   145*** ******                                                    e...

REPLY550NODOMAIN
 Sect OctLoc
   1     633   041065 065060   040124 150141   164040 144157   155141 151156    !550 That domain
   1     637   040151 163040   165156 153156   157167 156040   164157 040155     is unknown to m
   1     643   145056 ******                                                    e...

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:423  
REPLY550NOSITE
 Sect OctLoc
   1     644   044065 065060   040124 150141   164040 103120   055066 040163    $550 That CP-6 s
   1     650   151164 145040   151163 040165   156153 156157   167156 040164    ite is unknown t
   1     654   157040 155145   056*** ******                                    o me....

REPLY551
 Sect OctLoc
   1     656   042065 065061   040125 163145   162040 156157   164040 154157    "551 User not lo
   1     662   143141 154073   040143 141156   156157 164040   146157 162167    cal; cannot forw
   1     666   141162 144***                                                    ard.

REPLY552
 Sect OctLoc
   1     667   030065 065062   040102 165146   146145 162040   163151 172145    .552 Buffer size
   1     673   040145 170143   145145 144145   144*** ******                     exceeded...

REPLY553
 Sect OctLoc
   1     676   044065 065063   040123 160145   143151 146151   145144 040165    $553 Specified u
   1     702   163145 162040   156141 155145   040151 163040   141155 142151    ser name is ambi
   1     706   147165 157165   163*** ******                                    guous...

REPLY998
 Sect OctLoc
   1     710   026052 052052   040116 105124   115101 111114   040150 145162    .*** NETMAIL her
   1     714   145040 052052   052022 030***                                    e ***...

REPLY999
 Sect OctLoc
   1     716   014044 123105   124040 115044   114114 040116   117*** ******    .$SET M$LL NO...

REPLY$
 Sect OctLoc
   1     722   000443 006000                                                    ....

CMD_CODE
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:424  
 Sect OctLoc
   1     723   000000 000000                                                    ....

USER_COUNT
 Sect OctLoc
   1     724   000000 000000                                                    ....

LOGGED_ON
 Sect OctLoc
   1     725   0***** ******                                                    ....

MSG_COUNT
 Sect OctLoc
   1     726   000000 000000                                                    ....

SYNC_PHASE
 Sect OctLoc
   1     727   000000 000000                                                    ....

TCM_SITENAME
 Sect OctLoc
   1     731   114101 104103   040040 040040                                    LADC

REWRITE
 Sect OctLoc
   1     733   ****** ******   ****** ******   ****** ******   ****** ******    ................

LINEBUF
 Sect OctLoc
   1    1525   ****** ******   ****** ******   ****** ******   ****** ******    ................

PARSEWORK
 Sect OctLoc
   1    1625   ****** ******   ****** ******   ****** ******   ****** ******    ................

MY_SITE_NAME
 Sect OctLoc
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:425  
   1    3265   040040 040040   040040 040040

OCMSG
 Sect OctLoc
   1    3267   ****** ******   ****** ******   ****** ******   ****** ******    ................

STATUS_LINE
 Sect OctLoc
   1    3367   040040 040040   040040 040040   040040 040040   040040 040040
   1    3403*  040040 040040   040*** ******                                         ...

NODES_KEY
 Sect OctLoc
   1    3405   010*** ******   ****** ******   ****** ******                    ............

DATEBUF
 Sect OctLoc
   1    3410   040040 040040   040040 040040   040040 ******                              ..

TIMEBUF
 Sect OctLoc
   1    3413   040040 040040   040040 040040

DAYBUF
 Sect OctLoc
   1    3415   040040 040***                                                       .

LCLBUF
 Sect OctLoc
   1    3422   ****** ******   ****** ******   054*** ******   ****** ******    ........,.......
   1    3426   ****** ******                                                    ....

DATA_KEY
 Sect OctLoc
   1    3430   003000 000000                                                    ....

WRITE_DO
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:426  
 Sect OctLoc
   1    3432   000003 777640   003442 006000   000000 177640   000000 006014    ................
   1    3436   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    3442   000000 400400   000000 000000   000000 000000   000000 000000    ................

READ_UC
 Sect OctLoc
   1    3446   000005 777640   003456 006000   000000 177640   000000 006014    ................
   1    3452   000077 577640   001525 006000   000000 177640   000000 006014    .?..............
   1    3456   000000 400000   000000 000000   000000 000000   000000 000000    ................
   1    3462   000000 000000   000000 000000                                    ........

WRITE_UC
 Sect OctLoc
   1    3464   000003 777640   003474 006000   000000 177640   000000 006014    ................
   1    3470   000077 577640   001525 006000   000000 177640   000000 006014    .?..............
   1    3474   000000 400400   000000 000000   000000 000000   000000 000000    ................

POSITION_ALIAS
 Sect OctLoc
   1    3500   000003 777640   003506 006000   000000 177640   000000 006014    ................
   1    3504   000000 177640   000000 006014   000000 600000   000000 000000    ................
   1    3510   000000 000000   0***** ******                                    ........

WRITE_DRIBBLE
 Sect OctLoc
   1    3512   000003 777640   003522 006000   000000 177640   000000 006014    ................
   1    3516   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    3522   000000 400400   000000 000000   000000 000000   000000 000000    ................

TCM_ACCOUNT
 Sect OctLoc
   1    3526   072123 115124   120040 040040                                    :SMTP

TCM_MESSACCT
 Sect OctLoc
   1    3530   072123 115124   120040 040040                                    :SMTP
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:427  

OPEN_DATA
 Sect OctLoc
   1    3532   000025 777640   003576 006000   000000 177640   000000 006014    ................
   1    3536   000000 177640   000000 006014   000004 177640   003624 006000    ................
   1    3542   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    3556*  000001 777640   003530 006000   000000 177640   000000 006014    ................
   1    3562   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    3576*  000000 000702   000000 003001   252525 002000   000040 252520    ............. ..
   1    3602   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1    3606   000000 000002   000000 000002   000000 000000   000000 000000    ................
   1    3612   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1    3616   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1    3622   000000 000000   ****** ******                                    ........

DATA_NAME
 Sect OctLoc
   1    3624   020044 115123   107170 170170   170170 170170   170170 170170    .$MSGxxxxxxxxxxx
   1    3630   170*** ******                                                    x...

REOPEN_DATA
 Sect OctLoc
   1    3632   000025 777640   003676 006000   000000 177640   000000 006014    ................
   1    3636   000000 177640   000000 006014   000004 177640   003624 006000    ................
   1    3642   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    3656*  000001 777640   003530 006000   000000 177640   000000 006014    ................
   1    3662   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    3676*  000000 000442   000000 001001   252525 000000   000040 252520    ............. ..
   1    3702   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1    3706   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1    3712   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1    3716   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1    3722   000000 000000   ****** ******                                    ........

DELETE_DATA
 Sect OctLoc
   1    3724   000025 777640   003770 006000   000000 177640   000000 006014    ................
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:428  
   1    3730   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    3770*  000000 040042   000000 001000   252525 000000   000040 252520    .. "......... ..
   1    3774   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1    4000   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1    4004   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1    4010   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1    4014   000000 000000   ****** ******                                    ........

WRITE_DATA
 Sect OctLoc
   1    4016   000003 777640   004026 006000   000000 777640   003430 006000    ................
   1    4022   000077 577640   001525 006000   000000 177640   000000 006014    .?..............
   1    4026   000000 400400   000000 000000   000000 000000   000000 000000    ................

WRITE_NOTIFY
 Sect OctLoc
   1    4032   000003 777640   004042 006000   000000 177640   000000 006014    ....."..........
   1    4036   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    4042   000000 400400   000000 000000   000000 000000   000000 000000    ................

SEND_MAIL
 Sect OctLoc
   1    4046   000000 177640   000000 006014   000001 777640   001524 006000    ................
   1    4052   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    4056   000014 177640   004066 006000   000000 177640   000000 006014    .....6..........
   1    4062   000001 777640   004064 006000   600000 000000   000000 000000    .....4..........

SEND_CMD
 Sect OctLoc
   1    4066   060123 105116   104040 044115   123107 170170   170170 170170    0SEND $MSGxxxxxx
   1    4072   170170 170170   170170 040050   107101 124105   127101 131054    xxxxxx (GATEWAY,
   1    4076   115101 111114   075123 115124   120040 115141   151154 145162    MAIL=SMTP Mailer
   1    4102   051*** ******                                                    )...

TCM_KEYIN
 Sect OctLoc
   1    4104   000005 777640   004114 006000   000000 17764*   000000 006014    .....L..........
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:429  
   1    4110   000000 17764*   000000 006014   000000 177640   000000 006014    ................
   1    4114   040040 040040   040040 040040   000000 000000   400000 000000            ........
   1    4120   000000 000000   000000 000000                                    ........

SET_EOM_LF
 Sect OctLoc
   1    4122   000003 777640   004130 006000   000000 177640   000000 006014    .....X..........
   1    4126   000007 777640   001700 006000   000000 000000   000000 000000    ................
   1    4132   001036 000000   000000 000000                                    ........

UC_TRMCTL
 Sect OctLoc
   1    4134   125125 125225   125125 377377   125157 377377   377377 125177    UUU.UU..Uo....U.

VM_USERKEY
 Sect OctLoc
   1    4140   311120 ******   ****** ******   ****** ******   ****** ******    .P..............
   1    4220*  ****** ******   ****** ******   ****** ******                    ............

VM_LISTKEY
 Sect OctLoc
   1    4223   311074 ******   ****** ******   ****** ******   ****** ******    .<..............
   1    4303*  ****** ******   ****** ******   ****** ******                    ............

VM_SEARCHKEY
 Sect OctLoc
   1    4306   311074 ******   ****** ******   ****** ******   ****** ******    .<..............
   1    4366*  ****** ******   ****** ******   ****** ******                    ............

TRMCTL
 Sect OctLoc
   1    4372   125125 125125   125125 377377   125157 377377   377377 125177    UUUUUU..Uo....U.

FPT_ERRMSG
 Sect OctLoc
   1    4376   000003 777640   004424 006000   000000 777640   004430 006000    ................
   1    4402   000077 577640   003267 006000   000002 377640   001752 006000    .?..............
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:430  
   1    4406   000001 777640   001524 006000   000000 177640   000000 006014    ................
   1    4412   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    4416   000000 177640   000000 006014   000003 777640   004432 006000    ................
   1    4422   000000 177640   000000 006014   000000 000000   000000 000000    ................
   1    4426   375000 030001   040000 000000                                    .... ...

ERRCODE
 Sect OctLoc
   1    4430   000000 000000                                                    ....

VLR_ERRMSG
 Sect OctLoc
   1    4432   00000* ***000   000000 000000   000000 000000   ****** ******    ................

FPT_XSERRMSG
 Sect OctLoc
   1    4436   000003 777640   004464 006000   000000 777640   004430 006000    ................
   1    4442   000077 577640   003267 006000   000002 377640   001755 006000    .?..............
   1    4446   000001 777640   001524 006000   000000 177640   000000 006014    ................
   1    4452   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    4456   000000 177640   000000 006014   000003 777640   004432 006000    ................
   1    4462   000000 177640   000000 006014   000000 000000   000000 000000    ................
   1    4466   375000 030001   040000 000000                                    .... ...

TCM_SOCKINIT
 Sect OctLoc
   2     000   000000 000002   777777 777777   000000 010000   000000 006014    ................
   2     004   000000 000000   000002 000000                                    ........

(unnamed)
 Sect OctLoc
   2     006   040*** ******                                                     ...

OFFCMD
 Sect OctLoc
   2     007   117106 106040                                                    OFF

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:431  
PROMPT
 Sect OctLoc
   2     010   100*** ******                                                    @...

PROMPTSTRING
 Sect OctLoc
   2     011   173175 040***                                                    {} .

LOCALHOSTNAME
 Sect OctLoc
   2     012   154157 143141   154150 157163   164000 ******                    localhost...

R220$
 Sect OctLoc
   2     015   000257 006000                                                    ....

R221$
 Sect OctLoc
   2     016   000277 006000                                                    ....

R250$
 Sect OctLoc
   2     017   000312 006000                                                    ....

R250OOPS$
 Sect OctLoc
   2     020   000315 006000                                                    ....

R250A$
 Sect OctLoc
   2     021   000331 006000                                                    ....

R250V$
 Sect OctLoc
   2     022   000335 006000                                                    ....

R354$
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:432  
 Sect OctLoc
   2     023   000435 006000                                                    ....

R421$
 Sect OctLoc
   2     024   000443 006000                                                    ....

R421TO$
 Sect OctLoc
   2     025   000456 006000                                                    ....

R421ZAP$
 Sect OctLoc
   2     026   000475 006000                                                    ....

R421DL$
 Sect OctLoc
   2     027   000514 006000                                                    ....

R451$
 Sect OctLoc
   2     030   000531 006000                                                    ....

R500$
 Sect OctLoc
   2     031   000547 006000                                                    ....

R501$
 Sect OctLoc
   2     032   000556 006000                                                    ....

R502$
 Sect OctLoc
   2     033   000572 006000                                                    ....

R503$
 Sect OctLoc
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:433  
   2     034   000601 006000                                                    ....

R550$
 Sect OctLoc
   2     035   000611 006000                                                    ....

R550NONODE$
 Sect OctLoc
   2     036   000616 006000                                                    ....

R550NODOMAIN$
 Sect OctLoc
   2     037   000633 006000                                                    ....

R550NOSITE$
 Sect OctLoc
   2     040   000644 006000                                                    ....

(unnamed)
 Sect OctLoc
   2     041   000656 006000                                                    ....

R552$
 Sect OctLoc
   2     042   000667 006000                                                    ....

R553$
 Sect OctLoc
   2     043   000676 006000                                                    ....

R998$
 Sect OctLoc
   2     044   000710 006000                                                    ....

R999$
 Sect OctLoc
   2     045   000716 006000                                                    ....
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:434  

CMN2UTS
 Sect OctLoc
   2     046   000000 000000   000000 000000   777777 777773   777777 777774    ................
   2     052   777777 777772   777777 777773   777777 777771   777777 777772    ................
   2     056   777777 777770   777777 777771                                    ........

TCM_XLATE_TO_UC
 Sect OctLoc
   2     060   000001 002003   004005 006007   010011 012013   014015 016017    ................
   2     064   020021 022023   024025 026027   030031 032033   034035 036037    ................
   2     070   040041 042043   044045 046047   050051 052053   054055 056057     !"#$%&'()*+,-./
   2     074   060061 062063   064065 066067   070071 072073   074075 076077    0123456789:;<=>?
   2     100   100101 102103   104105 106107   110111 112113   114115 116117    @ABCDEFGHIJKLMNO
   2     104   120121 122123   124125 126127   130131 132133   134135 136137    PQRSTUVWXYZ[\]^_
   2     110   140101 102103   104105 106107   110111 112113   114115 116117    `ABCDEFGHIJKLMNO
   2     114   120121 122123   124125 126127   130131 132173   174175 176177    PQRSTUVWXYZ{|}~.
   2     120   040040 040040   040040 040040   040040 040040   040040 040040
   2     254*  040040 040040   040040 040040   040040 040040   040040 040040

TCM_SKIP_BLANKS
 Sect OctLoc
   2     260   003003 003003   003003 003003   003003 003003   003003 003003    ................
   2     270*  000001 001001   001001 001001   001001 001001   001001 001001    ................
   2     274   002002 002002   002002 002002   002002 001001   001001 001001    ................
   2     300   001002 002002   002002 002002   002002 002002   002002 002002    ................
   2     304   002002 002002   002002 002002   002002 002001   001001 001001    ................
   2     310   001002 002002   002002 002002   002002 002002   002002 002002    ................
   2     314   002002 002002   002002 002002   002002 002001   001001 001003    ................

TCM_ILLEGAL_FROM
 Sect OctLoc
   2     320   001001 001001   001001 001001   001001 001001   001001 001001    ................
   2     330*  000001 001001   001001 001001   001001 001001   001001 001001    ................
   2     334   000000 000000   000000 000000   000000 001001   001001 001001    ................
   2     340   001000 000000   000000 000000   000000 000000   000000 000000    ................
   2     344   000000 000000   000000 000000   000000 000001   001001 001001    ................
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:435  
   2     350   001000 000000   000000 000000   000000 000000   000000 000000    ................
   2     354   000000 000000   000000 000000   000000 000001   001001 001001    ................

TCM_ILLEGAL_REPLYTO
 Sect OctLoc
   2     360   001001 001001   001001 001001   001001 001001   001001 001001    ................
   2     370*  000000 001001   001000 001001   001001 001001   001000 000000    ................
   2     374   000000 000000   000000 000000   000000 001001   001001 001001    ................
   2     400   000000 000000   000000 000000   000000 000000   000000 000000    ................
   2     404   000000 000000   000000 000000   000000 000001   001001 001001    ................
   2     410   001000 000000   000000 000000   000000 000000   000000 000000    ................
   2     414   000000 000000   000000 000000   000000 000001   001001 001001    ................

HEX
 Sect OctLoc
   2     420   060061 062063   064065 066067   070071 101102   103104 105106    0123456789ABCDEF

CLOSE_SI
 Sect OctLoc
   2     424   000003 777640   000456 006000   000000 177640   000000 006014    ................
   2     430   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     454*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   2     460   000220 000000   000000 000000                                    ........

PURGE_UC_INPUT
 Sect OctLoc
   2     462   000003 777640   000466 006000   000000 177640   000000 006014    ................
   2     466   000000 000000   000000 000000   002000 000000   000000 000000    ................

OPEN_ALIAS
 Sect OctLoc
   2     472   000025 777640   000536 006000   000000 177640   000000 006014    ................
   2     476   000000 177640   000000 006014   000003 377640   000564 006000    ................
   2     502   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     516*  000001 777640   000570 006000   000000 177640   000000 006014    ................
   2     522   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     536*  000000 000052   000000 002001   252525 000000   000040 252520    ...*......... ..
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:436  
   2     542   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   2     546   000000 000000   000000 000000   000000 000000   000000 000000    ................
   2     552   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   2     556   040040 040040   000000 000000   000000 000000   000000 000000        ............
   2     562   000000 000000   ****** ******                                    ........

ALIAS_NAME
 Sect OctLoc
   2     564   015072 115101   111114 137103   105116 124122   101114 ******    .:MAIL_CENTRAL..

ALIAS_ACCT
 Sect OctLoc
   2     570   072115 101111   114040 040040                                    :MAIL

REWIND_ALIAS
 Sect OctLoc
   2     572   000001 777640   000574 006000   000000 400000   000000 000000    ................

CLOSE_ALIAS
 Sect OctLoc
   2     576   000003 777640   000630 006000   000000 177640   000000 006014    ................
   2     602   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     626*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   2     632   000220 000000   000000 000000                                    ........

OPEN_NODES
 Sect OctLoc
   2     634   000025 777640   000700 006000   000000 177640   000000 006014    ................
   2     640   000000 177640   000000 006014   000001 577640   000726 006000    ................
   2     644   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     660*  000001 777640   000730 006000   000000 177640   000000 006014    ................
   2     664   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     700*  000000 000062   000000 002001   252525 000000   000040 252520    ...2......... ..
   2     704   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   2     710   000000 000000   000000 000000   000000 000000   000000 000000    ................
   2     714   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   2     720   040040 040040   000000 000000   000000 000000   000000 000000        ............
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:437  
   2     724   000000 000000   ****** ******                                    ........

NODES_NAME
 Sect OctLoc
   2     726   006072 116117   104105 123***                                    .:NODES.

NODES_ACCT
 Sect OctLoc
   2     730   072123 131123   040040 040040                                    :SYS

READ_NODES
 Sect OctLoc
   2     732   000005 777640   000742 006000   000002 177640   003405 006000    ................
   2     736   000001 777640   003265 006000   000000 177640   000000 006014    ................
   2     742   000000 600000   000000 000000   000000 000000   000000 000000    ................
   2     746   000000 000000   000000 000000                                    ........

POSITION_NODES
 Sect OctLoc
   2     750   000003 777640   000756 006000   000002 177640   003405 006000    ................
   2     754   000000 177640   000000 006014   000000 400000   000000 000000    ................
   2     760   000000 000000   0***** ******                                    ........

CLOSE_NODES
 Sect OctLoc
   2     762   000003 777640   001014 006000   000000 177640   000000 006014    ................
   2     766   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1012*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   2    1016   000220 000000   000000 000000                                    ........

OPEN_DRIBBLE_ME
 Sect OctLoc
   2    1020   000025 777640   001064 006000   000000 177640   000000 006014    .....4..........
   2    1024   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1064*  000000 000042   000000 000003   252525 000000   000040 252520    ..."......... ..
   2    1070   115105 040040   000000 000000   000000 777777   000000 000000    ME  ............
   2    1074   000000 000000   000000 000000   000000 000000   000000 000000    ................
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:438  
   2    1100   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   2    1104   040040 040040   000000 000000   000000 000000   000000 000000        ............
   2    1110   000000 000000   ****** ******                                    ........

OPEN_DRIBBLE
 Sect OctLoc
   2    1112   000025 777640   001156 006000   000000 177640   000000 006014    .....n..........
   2    1116   000000 177640   000000 006014   000002 377640   001242 006000    ................
   2    1122   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1136*  000001 777640   003530 006000   000000 177640   000000 006014    ................
   2    1142   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1156*  000000 000502   000000 003001   252525 001000   000040 252520    ............. ..
   2    1162   000040 040040   000000 000002   000000 777777   000000 000000    .   ............
   2    1166   000000 000000   000000 000000   000000 000000   000000 000000    ................
   2    1172   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   2    1176   040040 040040   000000 000000   000000 000000   000000 000000        ............
   2    1202   000000 000000   ****** ******                                    ........

CLOSE_DRIBBLE
 Sect OctLoc
   2    1204   000003 777640   001236 006000   000000 177640   000000 006014    ................
   2    1210   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1234*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   2    1240   000220 000000   000000 000000                                    ........

DRIBBLE_NAME
 Sect OctLoc
   2    1242   011072 104122   111102 122103   126104 ******                    .:DRIBRCVD..

REREAD_DATA
 Sect OctLoc
   2    1246   000005 777640   001256 006000   000000 777640   003430 006000    ................
   2    1252   000077 577640   001525 006000   000000 177640   000000 006014    .?..............
   2    1256   000000 600000   000000 000000   000000 000000   000000 000000    ................
   2    1262   000000 000000   000000 000000                                    ........

WRITE_BLANK_DATA
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:439  
 Sect OctLoc
   2    1264   000003 777640   001274 006000   000000 777640   003430 006000    ................
   2    1270   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1274   000000 400400   000000 000000   000000 000000   000000 000000    ................

CLOSE_DATA
 Sect OctLoc
   2    1300   000003 777640   001332 006000   000000 177640   000000 006014    ................
   2    1304   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1330*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   2    1334   000220 000000   000000 000000                                    ........

OPEN_NOTIFY
 Sect OctLoc
   2    1336   000025 777640   001402 006000   000000 177640   000000 006014    ................
   2    1342   000000 177640   000000 006014   000001 377640   001430 006000    ................
   2    1346   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1402*  000000 000702   000000 003001   252525 001000   000040 252520    ............. ..
   2    1406   000040 040040   000000 000002   000000 777777   000000 000000    .   ............
   2    1412   000000 000000   000000 000000   000000 000000   000000 000000    ................
   2    1416   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   2    1422   040040 040040   000000 000000   000000 000000   000000 000000        ............
   2    1426   000000 000000   ****** ******                                    ........

NOTIFY_NAME
 Sect OctLoc
   2    1430   005052 116117   124105 ******                                    .*NOTE..

CLOSE_NOTIFY
 Sect OctLoc
   2    1432   000003 777640   001464 006000   000000 177640   000000 006014    ................
   2    1436   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1462*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   2    1466   000220 000000   000000 000000                                    ........

SEND_NOTIFY
 Sect OctLoc
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:440  
   2    1470   000001 177640   001522 006000   000001 777640   001524 006000    ................
   2    1474   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1500   000011 377640   001510 006000   000000 177640   000000 006014    ................
   2    1504   000001 777640   001506 006000   600000 000000   000000 000000    ................

NOTIFY_CMD
 Sect OctLoc
   2    1510   045123 105116   104040 052116   117124 105040   050107 101124    %SEND *NOTE (GAT
   2    1514   105127 101131   054115 101111   114075 123115   124120 040115    EWAY,MAIL=SMTP M
   2    1520   141151 154145   162051 ******                                    ailer)..

SEND
 Sect OctLoc
   2    1522   004123 105116   104*** ******                                    .SEND...

COLON_SYS
 Sect OctLoc
   2    1524   072123 131123   040040 040040                                    :SYS

FPT_SETFMA
 Sect OctLoc
   2    1526   000001 777640   003530 006000   000000 177640   000000 006014    ................

GET_TIMESTAMP
 Sect OctLoc
   2    1532   000001 777640   001544 006000   000002 377640   003410 006000    ................
   2    1536   000001 777640   003413 006000   000000 577640   003415 006000    ................
   2    1542   000000 177640   000000 006014   000001 000000   ****** ******    ................

GET_UTS
 Sect OctLoc
   2    1546   000001 777640   001560 006000   000000 177640   000000 006014    ................
   2    1552   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2    1556   000000 777640   000730 006000   000004 000000   ****** ******    ................

ANS2UTSVAL
 Sect OctLoc
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:441  
   2    1562   000001 777640   001574 006000   000001 377640   003416 006000    ................
   2    1566   000001 777640   003417 406000   000000 177640   000000 006014    ................
   2    1572   000000 777640   003427 006000   002004 000000   ****** ******    ................

UTSVAL2LCL
 Sect OctLoc
   2    1576   000001 777640   001610 006000   000001 777640   003422 006000    ................
   2    1602   000002 577640   003424 206000   000000 177640   000000 006014    ................
   2    1606   000000 777640   003427 006000   004003 000000   ****** ******    ................

SCREECH1
 Sect OctLoc
   2    1612   000001 777640   001626 006000   000000 177640   000000 006014    ................
   2    1616   000000 177640   000000 006014                                    ........

(unnamed)
 Sect OctLoc
   2    1620   000001 777640   001630 006000   000000 177640   000000 006014    ................
   2    1624   000000 177640   000000 006014                                    ........

SUA1
 Sect OctLoc
   2    1626   240315 421275   001160 107760                                    .....pG.

SUA2
 Sect OctLoc
   2    1630   240315 442565   001160 107760                                    .....pG.

JIT_PRIV
 Sect OctLoc
   2    1632   000001 777640   001634 006000   000000 000040   000000 000000    ........... ....

SET_BREAK_CONTROL
 Sect OctLoc
   2    1636   000001 777640   001640 006000   000000 000000   000000 000000    ................

WAIT_A_SECOND
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:442  
 Sect OctLoc
   2    1642   000001 777640   001646 006000   000000 177640   000000 006014    ................
   2    1646   000000 000001   000000 000001                                    ........

WAIT_A_MIN
 Sect OctLoc
   2    1650   000001 777640   001654 006000   000000 177640   000000 006014    ................
   2    1654   000000 000074   000000 000001                                    ...<....

TCM_YC_OFF
 Sect OctLoc
   2    1656   000000 777640   000007 006000   000001 777640   001664 006000    ................
   2    1662   000000 177640   000000 006014   200000 000000   0***** ******    ................

CLEAR_PROMPT
 Sect OctLoc
   2    1666   000003 777640   001674 006000   000000 177640   000000 006014    ................
   2    1672   000000 177640   000010 006000   000000 000000   000000 000000    ................
   2    1676   100000 000000   000000 000000                                    @.......

UC_EOMTABLE
 Sect OctLoc
   2    1700   000044 000000   000000 000000   000000 000000   000000 000000    .$..............
   2    1704   000044 000000   000000 000000   000000 000000   000000 000000    .$..............

INHIBIT_OPERATOR_MESSAGES
 Sect OctLoc
   2    1710   000001 777640   001714 006000   000000 177640   000000 006014    ................
   2    1714   000000 000000   000000 000000                                    ........

SET_TRANS_EOM
 Sect OctLoc
   2    1716   000001 777640   001724 006000   000000 177640   000000 006014    ................
   2    1722   000003 777640   004134 006000   000000 000000   000000 000000    .....\..........

FPT_TRMCTL
 Sect OctLoc
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:443  
   2    1726   000001 777640   001734 006000   000000 177640   000000 006014    ................
   2    1732   000003 777640   004372 006000   000000 000000   000000 000000    ................

FPT_ALIB
 Sect OctLoc
   2    1736   000001 377640   001750 006000   000000 177640   000000 006014    ................
   2    1742   000000 177640   000000 006014   000001 777640   001746 006000    ................
   2    1746   000000 000000   000000 000000                                    ........

DELTA_NAME
 Sect OctLoc
   2    1750   005104 105114   124101 ******                                    .DELTA..

VMERRMSG
 Sect OctLoc
   2    1752   011072 126115   105122 122115   123107 ******                    .:VMERRMSG..

XSERRMSG
 Sect OctLoc
   2    1755   011072 130123   105122 122115   123107 ******                    .:XSERRMSG..

(unnamed)
 Sect OctLoc
   2    1760   050104 105102   125107 051040   050124 103120   051040 040040    (DEBUG) (TCP)
   2    1764   115125 114115   101111 114040   116157 040143   157156 146151    MULMAIL No confi
   2    1770   147040 146151   154145 040163   160145 143151   146151 145144    g file specified
   2    1774   040157 156040   151156 166157   143141 164151   157156 056040     on invocation.
   2    2000   040111 040161   165151 164056   072111 144154   145040 040040     I quit.:Idle
   2    2004   052111 101115   114151 156145   040142 171040   040167 151164    *IAMLine by  wit
   2    2010   150040 123115   124120 073040   072040 145164   143072 150157    h SMTP; : etc:ho
   2    2014   163164 163040   150141 163040   156157 040145   156164 162171    sts has no entry
   2    2020   040146 157162   040042 154157   143141 154150   157163 164042     for "localhost"
   2    2024   072125 156141   142154 145040   164157 040157   160145 156040    :Unable to open
   2    2030   164157 040163   157143 153145   164040 040040   072105 162162    to socket   :Err
   2    2034   157162 040157   156040 162145   141144 040040   072125 156145    or on read  :Une
   2    2040   170160 145143   164145 144040   162145 163160   157156 163145    xpected response
   2    2044   040164 157040   143157 156156   145143 164040   146146 040040     to connect ff
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:444  
   2    2050   110105 114117   115101 111114   060060 060060   163145 156164    HELOMAIL0000sent
   2    2054   122123 105124   040157 146146   123120 111114   101144 144107    RSET offSPILAddG
   2    2060   141164 145040   164141 142154   145040 157166   145162 146154    ate table overfl
   2    2064   157167 073040   040143 157155   155141 156144   040156 157164    ow;  command not
   2    2070   040163 164157   162145 144056   101144 144107   141164 145040     stored.AddGate
   2    2074   143157 155155   141156 144040   155141 154146   157162 155145    command malforme
   2    2100   144073 040040   143157 155155   141156 144040   156157 164040    d;  command not
   2    2104   163164 157162   145144 056040   104145 154123   151164 145040    stored. DelSite
   2    2110   164141 142154   145040 157166   145162 146154   157167 073040    table overflow;
   2    2114   040143 157155   155141 156144   040156 157164   040163 164157     command not sto
   2    2120   162145 144056   104145 154123   151164 145040   143157 155155    red.DelSite comm
   2    2124   141156 144040   155141 154146   157162 155145   144073 040040    and malformed;
   2    2130   143157 155155   141156 144040   156157 164040   163164 157162    command not stor
   2    2134   145144 056040   115114 113111   110107 106105   104103 102101    ed. MLKIHGFEDCBA
   2    2140   132116 117120   121122 123124   125126 127130   131040 040040    ZNOPQRSTUVWXY
   2    2144   040040 040040   126122 106131   124117 072040   124122 101103        VRFYTO: TRAC
   2    2150   105072 122145   164165 162156   055160 141164   150072 040040    E:Return-path:
   2    2154   124122 101103   105072 122145   143145 151166   145144 072040    TRACE:Received:
   2    2160   106162 157155   040040 040040   040133 040040   131131 115115    From     [  YYMM
   2    2164   104104 110110   115115 060060   060060 040040   050040 051040    DDHHMM0000  ( )
   2    2170   124157 072040   123165 142152   145143 164072   040115 141151    To: Subject: Mai
   2    2174   154040 144145   154151 166145   162171 040146   141151 154165    l delivery failu
   2    2200   162145 040040   115141 151154   147162 141155   040040 040040    re  Mailgram
   2    2204   040143 157165   154144 040156   157164 040142   145040 144145     could not be de
   2    2210   154151 166145   162145 144040   040146 157162   040164 150145    livered  for the
   2    2214   040146 157154   154157 167151   156147 040162   145141 163157     following reaso
   2    2220   156054 040163   165160 160154   151145 144040   142171 040123    n, supplied by S
   2    2224   105116 104072   123165 142152   145143 164072   040115 141151    END:Subject: Mai
   2    2230   154040 162145   143145 160164   151157 156040   146141 151154    l reception fail
   2    2234   165162 145040   101040 155141   151154 147162   141155 040143    ure A mailgram c
   2    2240   157165 154144   040156 157164   040142 145040   162145 143145    ould not be rece
   2    2244   151166 145144   146157 162040   040146 157162   040164 150145    ivedfor  for the
   2    2250   040146 157154   154157 167151   156147 040162   145141 163157     following reaso
   2    2254   156054 040163   165160 160154   151145 144040   142171 040123    n, supplied by S
   2    2260   157143 153145   164040 114151   142162 141162   171072 040040    ocket Library:
   2    2264   115145 163163   141147 145040   111104 072040   122145 146145    Message ID: Refe
   2    2270   162145 156143   145040 111104   072040 040040   124162 141156    rence ID:   Tran
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:445  
   2    2274   163141 143164   151157 156072   040040 040040   104141 164145    saction:    Date
   2    2300   072040 040040   122122 072131   145163 040040   106162 157155    :   RR:Yes  From
   2    2304   072040 040040   122145 160154   171040 124157   072040 040040    :   Reply To:
   2    2310   055055 076040   074055 055040   103120 066040   143160 066040    --> <-- CP6 cp6
   2    2314   040074 040040   062065 060040   062065 060055   072111 144154     <  250 250-:Idl
   2    2320   145040 163151   156143 145040                                    e since

(unnamed)
 Sect OctLoc
  11     000   000000 006003   000016 006000   000000 006000   000012 006000    ................
  11     004   000235 006000   042040 040040   000000 006000   000206 006000    ...."   ........
  11     010   000204 006000   000005 006000   000000 250600   000012 006000    ................
  11     014   000077 577640   001525 006000   000000 006000   000014 006000    .?..............
  11     020   000211 006000   777400 777777   774777 777777   777777 763777    ................
  11     024   000726 006000   000132 006000   000066 006000   000001 277100    .....Z...6.....@
  11     030   000020 365400   000040 040040   000000 006000   003267 006000    .....   ........
  11     034   056040 040040   072040 040040   000004 177640   003624 006000    .   :   ........
  11     040   000000 006000   135040 040040   073040 040040   000000 006000    ....]   ;   ....
  11     044   003427 006000   003427 006000   003427 006000   000234 006000    ................
  11     050   000000 004704   000050 006000   000000 005670   000052 006000    .....(.......*..
  11     054   000000 006200   000054 006000   000000 007246   000056 006000    .....,..........
  11     060   000000 007250   000060 006000   000000 007252   000062 006000    .....0.......2..
  11     064   000000 007474   000064 006000   000000 007506   000066 006000    .....4.......6..
  11     070   000001 177640   001522 006000   000014 177640   004066 006000    .............6..
  11     074   777774 777777   777777 777000   000077 577640   003267 006000    .........?......
  11     100   000321 777640   000001 200000   011040 040040   077040 040040    .........   ?
  11     104   000316 200000   000000 006000   000416 200000   100040 040040    ............@
  11     110   041040 040040   000004 200000   000000 006000   047040 040040    !   ........'
  11     114   045040 040040   051040 040040   076040 040040   000000 000777    %   )   >   ....
  11     120   000117 006000   137040 040040   055040 040040   777777 377777    .O.._   -   ....
  11     124   000062 377640   004306 006000   057040 040040   777777 577777    .2....../   ....
  11     130   000062 377640   004140 006000   000062 377640   004223 006000    .2...`...2......
  11     134   000077 777640   000000 000074   000014 006000   000135 006000    .?.....<.....]..
  11     140   000000 177640   000000 006014   134000 000000   012000 000000    ........\.......
  11     144   015000 000000   134040 040040   050040 040040                    ....\   (
     2641    15204        %EOD;

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:446  
--  Include file information  --

   XSL_PERR_C.:TCA2TOU  is referenced.
   XSL_SOCKET_M.:TCA2TOU  is referenced.
   XUD_UTS_M.:TOOLE05  is referenced.
   TCM_SEND_E.:TCA2TOU  is referenced.
   TCM_MAIL_E.:TCA2TOU  is referenced.
   TCM_COMMON_M.:TCA2TOU  cannot be made into a system file and is referenced.
   TCP_HEP_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   VM_MACRO_C.:LIBRARY  is referenced.
   XUG_ENTRY.:LIBRARY  cannot be made into a system file and is referenced.
   XU_SUBS_C.:LIBRARY  is referenced.
   XU_MACRO_C.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   B_ERRORS_C.:LIBRARY  is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$NETMAIL.
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:447  

 **** Variables and constants ****

  ****  Section 001  Data  TCM$NETMAIL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  3416-0-0/c STRC(126)   r     1 ANSBUF                  3416-0-0/c CHAR(14)    r     1 ANSSTAMP
   211-0-0/w STRC(180)   r     1 CB                       723-0-0/w UBIN        r     1 CMD_CODE
  3430-0-0/b STRC        r     1 DATA_KEY                3624-0-0/c STRC(153)   r     1 DATA_NAME
  3410-0-0/c STRC(90)    r     1 DATEBUF                 3410-0-0/c CHAR(10)    r     1 DATESTRING
  3415-0-0/c CHAR(3)     r     1 DAYBUF                  3724-0-0/d STRC(2088)  r     1 DELETE_DATA
  4430-0-0/w STRC        r     1 ERRCODE
   235-0-0/c CHAR(12)    r     1 FEPNAMES(0:5)
  4376-0-0/d STRC(936)   r     1 FPT_ERRMSG              4436-0-0/d STRC(936)   r     1 FPT_XSERRMSG
   204-0-0/w STRC(72)    r     1 FS                      3422-0-0/c STRC(180)   r     1 LCLBUF
  3422-0-0/c CHAR(20)    r     1 LCLSTAMP                1525-0-0/c CHAR(255)   r     1 LINEBUF
  1525-0-0/c BIT (9)     r     1 LINECHAR(0:254)          725-0-0/b BIT         r     1 LOGGED_ON
   206-0-0/w STRC(72)    r     1 LS                       726-0-0/w UBIN        r     1 MSG_COUNT
  3265-0-0/c CHAR(8)     r     1 MY_SITE_NAME            3405-0-0/c STRC(81)    r     1 NODES_KEY
  3267-0-0/c CHAR(255)   r     1 OCMSG                    210-0-0/w SBIN        r     1 OLD_CMD_LCN
  3532-0-0/d STRC(2088)  r     1 OPEN_DATA
  1625-0-0/w UBIN        r     1 PARSEWORK(0:799)
  3500-0-0/d STRC(360)   r     1 POSITION_ALIAS          3446-0-0/d STRC(504)   r     1 READ_UC
  3632-0-0/d STRC(2088)  r     1 REOPEN_DATA              722-0-0/w PTR         r     1 REPLY$
   257-0-0/c STRC(558)   r     1 REPLY220                 277-0-0/c STRC(378)   r     1 REPLY221
   312-0-0/c STRC(81)    r     1 REPLY250                 331-0-0/c STRC(126)   r     1 REPLY250A
   315-0-0/c STRC(414)   r     1 REPLY250OOPS             335-0-0/c STRC(2304)  r     1 REPLY250V
   435-0-0/c STRC(189)   r     1 REPLY354                 443-0-0/c STRC(378)   r     1 REPLY421
   514-0-0/c STRC(450)   r     1 REPLY421DL               456-0-0/c STRC(513)   r     1 REPLY421TO
   475-0-0/c STRC(522)   r     1 REPLY421ZAP              531-0-0/c STRC(504)   r     1 REPLY451
   547-0-0/c STRC(252)   r     1 REPLY500                 556-0-0/c STRC(405)   r     1 REPLY501
   572-0-0/c STRC(252)   r     1 REPLY502                 601-0-0/c STRC(261)   r     1 REPLY503
   611-0-0/c STRC(180)   r     1 REPLY550                 633-0-0/c STRC(306)   r     1 REPLY550NODOMAIN
   616-0-0/c STRC(441)   r     1 REPLY550NONODE           644-0-0/c STRC(333)   r     1 REPLY550NOSITE
   656-0-0/c STRC(315)   r     1 REPLY551                 667-0-0/c STRC(225)   r     1 REPLY552
   676-0-0/c STRC(333)   r     1 REPLY553                 710-0-0/c STRC(207)   r     1 REPLY998
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:448  
   716-0-0/c STRC(117)   r     1 REPLY999                 733-0-0/w STRC(648)   r     1 REWRITE(0:20)
  4066-0-0/c STRC(441)   r     1 SEND_CMD                4046-0-0/d STRC(576)   r     1 SEND_MAIL
  4122-0-0/d STRC(360)   r     1 SET_EOM_LF              3367-0-0/c CHAR(53)    r     1 STATUS
  3367-0-0/c STRC(477)   r     1 STATUS_LINE              727-0-0/w UBIN        r     1 SYNC_PHASE
  3526-0-0/c STRC(72)    r     1 TCM_ACCOUNT              216-0-0/b BIT         r     1 TCM_DRIBBLE
   217-0-0/b BIT         r     1 TCM_DRIBBLE_ME          4104-0-0/d STRC(504)   r     1 TCM_KEYIN
  3530-0-0/c STRC(72)    r     1 TCM_MESSACCT               0-0-0/w STRC(504)   r     1 TCM_PCB
   220-0-0/c CHAR(7)     r     1 TCM_PROGNAME             731-0-0/c CHAR(8)     r     1 TCM_SITENAME
   222-0-0/c CHAR(32)    r     1 TCM_STUCKEE              232-0-0/c CHAR(6)     r     1 TCM_TZTEXT
   234-0-0/w SBIN        r     1 TCM_UTOFFSET            3413-0-0/c STRC(72)    r     1 TIMEBUF
  3413-0-0/c CHAR(8)     r     1 TIMESTRING              4372-0-0/d STRC(144)   r     1 TRMCTL
  4134-0-0/d STRC(144)   r     1 UC_TRMCTL                724-0-0/w UBIN        r     1 USER_COUNT
   730-0-0/w UBIN        r     1 UTS                     3427-0-0/w UBIN        r     1 UTSVAL
  4432-0-0/d STRC(144)   r     1 VLR_ERRMSG              4223-0-0/c STRC(1818)  r     1 VM_LISTKEY
  4306-0-0/c STRC(1818)  r     1 VM_SEARCHKEY            4140-0-0/c STRC(1818)  r     1 VM_USERKEY
  4016-0-0/d STRC(432)   r     1 WRITE_DATA              3432-0-0/d STRC(432)   r     1 WRITE_DO
  3512-0-0/d STRC(432)   r     1 WRITE_DRIBBLE           4032-0-0/d STRC(432)   r     1 WRITE_NOTIFY
  3464-0-0/d STRC(432)   r     1 WRITE_UC                 132-0-0/d STRC(1512)  r     1 XUG_GETCMD
    66-0-0/d STRC(1296)  r     1 XUG_INIT                  16-0-0/d STRC(1404)  r     1 XUR_INIT

  ****  Section 002 RoData TCM$NETMAIL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   570-0-0/c STRC(72)    r     1 ALIAS_ACCT               564-0-0/c STRC(126)   r     1 ALIAS_NAME
  1562-0-0/d STRC(432)   r     1 ANS2UTSVAL              1666-0-0/d STRC(360)   r     1 CLEAR_PROMPT
   576-0-0/d STRC(1080)  r     1 CLOSE_ALIAS             1300-0-0/d STRC(1080)  r     1 CLOSE_DATA
  1204-0-0/d STRC(1080)  r     1 CLOSE_DRIBBLE            762-0-0/d STRC(1080)  r     1 CLOSE_NODES
  1432-0-0/d STRC(1080)  r     1 CLOSE_NOTIFY             424-0-0/d STRC(1080)  r     1 CLOSE_SI
    46-0-0/w SBIN        r     1 CMN2UTS(0:9)
  1524-0-0/c STRC(72)    r     1 COLON_SYS               1750-0-0/c STRC(54)    r     1 DELTA_NAME
  1242-0-0/c STRC(90)    r     1 DRIBBLE_NAME            1736-0-0/d STRC(360)   r     1 FPT_ALIB
  1526-0-0/d STRC(144)   r     1 FPT_SETFMA              1726-0-0/d STRC(288)   r     1 FPT_TRMCTL
  1532-0-0/d STRC(432)   r     1 GET_TIMESTAMP           1546-0-0/d STRC(432)   r     1 GET_UTS
   420-0-0/c CHAR(16)    r     1 HEX
  1710-0-0/d STRC(216)   r     1 INHIBIT_OPERATOR_MESSAGES
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:449  
  1632-0-0/d STRC(144)   r     1 JIT_PRIV                  12-0-0/c CHAR(10)    r     1 LOCALHOSTNAME
   730-0-0/c STRC(72)    r     1 NODES_ACCT               726-0-0/c STRC(63)    r     1 NODES_NAME
  1510-0-0/c STRC(342)   r     1 NOTIFY_CMD              1430-0-0/c STRC(54)    r     1 NOTIFY_NAME
     7-0-0/c CHAR(4)     r     1 OFFCMD                   472-0-0/d STRC(2088)  r     1 OPEN_ALIAS
  1112-0-0/d STRC(2088)  r     1 OPEN_DRIBBLE            1020-0-0/d STRC(2088)  r     1 OPEN_DRIBBLE_ME
   634-0-0/d STRC(2088)  r     1 OPEN_NODES              1336-0-0/d STRC(2088)  r     1 OPEN_NOTIFY
   750-0-0/d STRC(360)   r     1 POSITION_NODES            10-0-0/c CHAR        r     1 PROMPT
    11-0-0/c CHAR(3)     r     1 PROMPTSTRING             462-0-0/d STRC(288)   r     1 PURGE_UC_INPUT
    15-0-0/w PTR         r     1 R220$                     16-0-0/w PTR         r     1 R221$
    17-0-0/w PTR         r     1 R250$                     21-0-0/w PTR         r     1 R250A$
    20-0-0/w PTR         r     1 R250OOPS$                 22-0-0/w PTR         r     1 R250V$
    23-0-0/w PTR         r     1 R354$                     24-0-0/w PTR         r     1 R421$
    27-0-0/w PTR         r     1 R421DL$                   25-0-0/w PTR         r     1 R421TO$
    26-0-0/w PTR         r     1 R421ZAP$                  30-0-0/w PTR         r     1 R451$
    31-0-0/w PTR         r     1 R500$                     32-0-0/w PTR         r     1 R501$
    33-0-0/w PTR         r     1 R502$                     34-0-0/w PTR         r     1 R503$
    35-0-0/w PTR         r     1 R550$                     37-0-0/w PTR         r     1 R550NODOMAIN$
    36-0-0/w PTR         r     1 R550NONODE$               40-0-0/w PTR         r     1 R550NOSITE$
    42-0-0/w PTR         r     1 R552$                     43-0-0/w PTR         r     1 R553$
    44-0-0/w PTR         r     1 R998$                     45-0-0/w PTR         r     1 R999$
   732-0-0/d STRC(504)   r     1 READ_NODES              1246-0-0/d STRC(504)   r     1 REREAD_DATA
   572-0-0/d STRC(144)   r     1 REWIND_ALIAS            1612-0-0/d STRC(216)   r     1 SCREECH1
  1522-0-0/c STRC(45)    r     1 SEND                    1470-0-0/d STRC(576)   r     1 SEND_NOTIFY
  1636-0-0/d STRC(144)   r     1 SET_BREAK_CONTROL       1716-0-0/d STRC(288)   r     1 SET_TRANS_EOM
  1626-0-0/d STRC(72)    r     1 SUA1                    1630-0-0/d STRC(72)    r     1 SUA2
   320-0-0/c UBIN(9)     r     1 TCM_ILLEGAL_FROM(0:127)
   360-0-0/c UBIN(9)     r     1 TCM_ILLEGAL_REPLYTO(0:127)
   260-0-0/c UBIN(9)     r     1 TCM_SKIP_BLANKS(0:127)
     0-0-0/w STRC(216)   r     1 TCM_SOCKINIT
    60-0-0/c CHAR        r     1 TCM_XLATE_TO_UC(0:511)
  1656-0-0/d STRC(288)   r     1 TCM_YC_OFF              1700-0-0/d STRC(288)   r     1 UC_EOMTABLE
  1576-0-0/d STRC(432)   r     1 UTSVAL2LCL              1752-0-0/c STRC(90)    r     1 VMERRMSG
  1650-0-0/d STRC(216)   r     1 WAIT_A_MIN              1642-0-0/d STRC(216)   r     1 WAIT_A_SECOND
  1264-0-0/d STRC(432)   r     1 WRITE_BLANK_DATA        1755-0-0/c STRC(90)    r     1 XSERRMSG

  ****  Auto variables  ****

PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:450  
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

 21675-0-0/w PTR         r     1 @ADDRESS$              22245-0-0/w PTR         r     1 @BUF
 21717-0-0/w PTR         r     1 @BUFF                  22171-0-0/w PTR         r     1 @FROM$
 21537-0-0/w PTR         r     1 @FROM$                 21544-0-0/w PTR         r     1 @KEYVAL
 22173-0-0/w PTR         r     1 @LEN                   21541-0-0/w PTR         r     1 @OFFSET
 21647-0-0/w PTR         r     1 @QTEXT                 21657-0-0/w PTR         r     1 @QTEXT
 21657-0-0/w PTR         r     1 @QTEXT                 21657-0-0/w PTR         r     1 @SOURCE
 21660-0-0/w PTR         r     1 @TARGET                21675-0-0/w PTR         r     1 @TEXT
 22172-0-0/w PTR         r     1 @TO$                   21540-0-0/w PTR         r     1 @TO$
 21543-0-0/w PTR         r     1 @TXTC                  22172-0-0/w PTR         r     1 @USEFUL_SIZE
 22171-0-0/w PTR         r     1 @USER$                 22246-0-0/w PTR         r     1 @VLEN
    15-0-0/b BIT         r     1 ACKNOWLEDGE               *0-0-0/w PTR         r     1 ADDRESS$
 21651-0-0/w SBIN        r     1 BASE                   21652-0-0/w SBIN        r     1 BINGO
 21541-0-0/w UBIN        r     1 BLANK_INDEX            21542-0-0/b BIT         r     1 BLANK_LINE_READ
    *0-0-0/c CHAR(255)   r     1 BUF                       *0-0-0/c STRC(2304)  r     1 BUFF
 21763-0-0/b BIT         r     1 CHANGED                21712-0-0/c CHAR        r     1 CHR
 21537-0-0/c CHAR        r     1 CHR                        4-0-0/w PTR         r     1 CMD$
 21426-0-0/c CHAR(255)   r     1 CMDBUF                 21537-0-0/w UBIN        r     1 COUNT
 22174-0-0/w UBIN        r     1 COUNT                  21542-0-0/w UBIN        r     1 COUNT
 21714-0-0/w SBIN        r     1 CURR_CMDCODE           21676-0-0/w UBIN        r     1 DASH_INDEX
    11-0-0/b BIT         r     1 DATA_LOST              21720-0-0/w PTR         r     1 DATE$
 21526-0-0/c CHAR(10)    r     1 DATEWORK               21541-0-0/b BIT         r     1 DATE_SEEN
 21700-0-0/w SBIN        r     1 DIFF                   21540-0-0/b BIT         r     1 DONE
 21677-0-0/w UBIN        r     1 DOT_INDEX              21537-0-0/b BIT         r     1 END_OF_MESSAGE
 21653-0-0/b BIT         r     1 ENTRYFLAG              21645-0-0/w UBIN        r     1 ERR
 21543-0-0/c CHAR(120)   r     1 ERRMSGBUF(0:6)
 21717-0-0/c CHAR(120)   r     1 ERRMSGBUF(0:6)
 21537-0-0/b BIT         r     1 ERROR_FLAG             22065-0-0/w PTR         r     1 F$DATA$
  1016-0-0/c STRC(2304)  r     1 FORUM                    316-0-0/c STRC(2304)  r     1 FROM
    *0-0-0/w PTR         r     1 FROM$                     *0-0-0/w PTR         r     1 FROM$
  1416-0-0/c STRC(2304)  r     1 FTEXT                  21540-0-0/b BIT         r     1 HAVE_A_CMD
 21540-0-0/b BIT         r     1 HEADER_LINE               16-0-0/c STRC(2304)  r     1 HELO
 21533-0-0/w UBIN        r     1 HEX1                   21534-0-0/w UBIN        r     1 HEX2
 21541-0-0/w SBIN        r     1 I                      22066-0-0/w SBIN        r     1 I
 22241-0-0/w SBIN        r     1 I                      21650-0-0/w SBIN        r     1 I
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:451  
 21662-0-0/w SBIN        r     1 I                      21761-0-0/w SBIN        r     1 I
 21701-0-0/w SBIN        r     1 I                      21717-0-0/w UBIN        r     1 I
 21717-0-0/b BIT         r     1 IDLESTATUS             21540-0-0/w UBIN        r     1 IDX
 21650-0-0/w SBIN        r     1 INDX                   21541-0-0/b BIT         r     1 INTERESTING
 21542-0-0/w SBIN        r     1 J                      21762-0-0/w SBIN        r     1 J
    *0-0-0/w SBIN        r     1 KEYVAL                 21651-0-0/w SBIN        r     1 LAST
     7-0-0/w UBIN        r     1 LAST_CMD               21544-0-0/w SBIN        r     1 LEN
 21663-0-0/w SBIN        r     1 LEN                    21702-0-0/w SBIN        r     1 LEN
    *0-0-0/w UBIN        r     1 LEN                    22175-0-0/w UBIN        r     1 LENGTH
 21543-0-0/w UBIN        r     1 LENGTH                 21417-0-0/w UBIN        r     1 LINESIZE
  1216-0-0/c STRC(2304)  r     1 LTEXT                      3-0-0/w PTR         r     1 M$SI$
   116-0-0/c STRC(2304)  r     1 MAIL                   21700-0-0/w UBIN        r     1 MATCHLEN
 21701-0-0/c CHAR(64)    r     1 MATCHSTRING              716-0-0/c STRC(2304)  r     1 MID
 21421-0-0/c CHAR(20)    r     1 MY_SITE_NAME_2         21420-0-0/w UBIN        r     1 MY_SITE_NAME_L
    13-0-0/b BIT         r     1 NODES_FILE_OPEN           *0-0-0/w UBIN        r     1 OFFSET
 21543-0-0/w PTR         r     1 OPT$                       5-0-0/w PTR         r     1 OUT$
 21654-0-0/b BIT         r     1 PARSEFLAG              21721-0-0/w UBIN        r     1 PCT_INDEX
 21713-0-0/w SBIN        r     1 PREV_CMDCODE              *0-0-0/c STRC(2304)  r     1 QTEXT
    *0-0-0/c STRC(2304)  r     1 QTEXT                     *0-0-0/c STRC(2304)  r     1 QTEXT
 21661-0-0/c STRC(2304)  r     1 QTEXT                    216-0-0/c STRC(2304)  r     1 RCPT
 21546-0-0/c CHAR(400)   r     1 RCVDBUF                21545-0-0/w SBIN        r     1 RCVDLEN
   416-0-0/c STRC(2304)  r     1 REPL                   21416-0-0/w SBIN        r     1 REWRITES
   616-0-0/c STRC(2304)  r     1 RMID                    1516-0-0/c STRC(2304)  r     1 RTEXT
 21543-0-0/c STRC(2304)  r     1 SCRATCH                22177-0-0/b BIT         r     1 SCRUNCH
 22173-0-0/w UBIN        r     1 SIZE                      *0-0-0/c STRC(2304)  r     1 SOURCE
 22176-0-0/w UBIN        r     1 START                  21544-0-0/w UBIN        r     1 START
 21544-0-0/w PTR         r     1 SUB$                     516-0-0/c STRC(2304)  r     1 SUBJ
    12-0-0/b BIT         r     1 SUPPRESS_HEADERS           5-0-0/w PTR         r     1 SYM$
    *0-0-0/c STRC(2304)  r     1 TARGET                 21664-0-0/c CHAR(32)    r     1 TBUF
 21703-0-0/c CHAR(32)    r     1 TBUF                   21537-0-0/w SBIN        r     1 TEMP
 21543-0-0/w SBIN        r     1 TEMP                   22243-0-0/w SBIN        r     1 TEMP
 21647-0-0/w SBIN        r     1 TEMP                   21660-0-0/w SBIN        r     1 TEMP
 21676-0-0/w SBIN        r     1 TEMP                   22174-0-0/c CHAR(64)    r     1 TEMPBUF
    *0-0-0/c STRC(2304)  r     1 TEXT                   21721-0-0/w PTR         r     1 TIME$
    10-0-0/b BIT         r     1 TIMED_OUT              21531-0-0/c CHAR(8)     r     1 TIMEWORK
 21545-0-0/c STRC(2304)  r     1 TITLE                      6-0-0/w PTR         r     1 TMP$
 21661-0-0/w SBIN        r     1 TMP2                   21677-0-0/w SBIN        r     1 TMP2
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:452  
    *0-0-0/w PTR         r     1 TO$                       *0-0-0/w PTR         r     1 TO$
 22214-0-0/w UBIN        r     1 TRIMMEDSIZE            21541-0-0/b BIT         r     1 TROUBLE
 21744-0-0/w UBIN        r     1 TSLEN                  21745-0-0/c CHAR(64)    r     1 TSTRING
  1316-0-0/c STRC(2304)  r     1 TTEXT                  21765-0-0/w UBIN        r     1 TVAL
 22247-0-0/w SBIN        r     1 TVAL                      *0-0-0/c ASTR(9)     r     1 TXTC
 21717-0-0/w SBIN        r     1 TZOFFSET               21766-0-0/w UBIN        r     1 USEFUL_LENGTH
    *0-0-0/w UBIN        r     1 USEFUL_SIZE            21767-0-0/c STRC(4608)  r     1 USER
 22167-0-0/w PTR         r     1 USER$                     *0-0-0/w PTR         r     1 USER$
  1716-0-0/c STRC(2304)  r     1 USERS(0:124)           21547-0-0/w UBIN        r     1 VLEN
    *0-0-0/w UBIN        r     1 VLEN                    1116-0-0/c STRC(2304)  r     1 WHEN
 21542-0-0/b BIT         r     1 WRITING                   14-0-0/b BIT         r     1 X_29
 21722-0-0/w PTR         r     1 ZONE$                   1616-0-0/c STRC(2304)  r     1 ZTEXT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/w SBIN        r     1 TCM_ADDR_ROOT              0-0-0/w UBIN        r     1 TCM_CMD_LCN
     0-0-0/w UBIN        r     1 TCM_CONFIG_CMD             0-0-0/w SBIN        r     1 TCM_SMTP_ROOT
     0-0-0/b BIT         r     1 TCM_TCPFLAVOR              0-0-0/w SBIN        r     1 TCM_TEXT_ROOT
     0-0-0/w SBIN        r     1 TCM_TSTAMP_ROOT            0-0-0/w SBIN        r     1 TCM_USER_ROOT
     0-0-0/b STRC        r     1 TCP_MON_ERR                0-0-0/w SBIN        r     1 XSL_ERRNO

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w PTR         r     1 B$PTR                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/w UBIN        r     1 B$UBIN                     0-0-0/w CHAR(512)   r     1 CHARS
     0-0-0/w STRC(144)   r     1 CMD                        0-0-0/w ASTR        r     1 CV
     0-0-0N  NULL        r     1 F$ALIAS                    0-0-0N  NULL        r     1 F$DATA
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0N  NULL        r     1 F$DRIBBLE
     0-0-0N  NULL        r     1 F$NODES                    0-0-0N  NULL        r     1 F$NOTIFY
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:453  
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$SI
     0-0-0N  NULL        r     1 M$UC                       0-0-0/w STRC(144)   r     1 OUT
     0-0-0/w STRC(504)   r     1 P$PCB                      0-0-0/w ASTR(153)   r     1 SYM
     0-0-0/w STRC(432)   r     1 TCP$ADMIN                  0-0-0/c ASTR(9)     r     1 TEXTC
     0-0-0/c CHAR        r     1 TEXT_CHAR(0:1023)          0-0-0/w STRC(180)   r     1 XSL$HOSTENT


   Procedure TCM$NETMAIL requires 5691 words for executable code.
   Procedure TCM$NETMAIL requires 9394 words of local(AUTO) storage.
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:454  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:455  
          MINI XREF LISTING

ACKNOWLEDGE
     10032**DCL     13235<<ASSIGN  13769<<ASSIGN  14172>>IF
ADDGATE_LOOP IN PROCEDURE CHECKADDR
     14542**LABEL   14549--EXIT
ADDRESS$ IN PROCEDURE LOOKUP_ALIAS
     14683**DCL     14681--PROC    14705>>CALLBLT 14705>>CALLBLT 14705>>CALLBLT 14708>>ASSIGN  14712<>CALL
     14716>>CALLBLT 14716>>CALLBLT 14717>>CALLBLT 14717>>CALLBLT 14719>>IF      14719>>IF      14719>>IF
     14719>>IF      14724>>ASSIGN  14730>>CALLBLT 14730>>CALLBLT 14759>>ASSIGN  14759>>ASSIGN  14824>>ASSIGN
     14825>>ASSIGN  14825>>ASSIGN  14826>>CALLBLT 14826>>CALLBLT 14840>>CALLBLT 14840>>CALLBLT
ADD_GATEWAY IN PROCEDURE CHECKADDR
     14537**LABEL   14528--GOTO
AGAIN
     13090**LABEL   13106--GOTO    13116--GOTO    13133--GOTO
ALIAS_ACCT
     10578**DCL     10501--DCLINIT
ALIAS_NAME
     10565**DCL     10497--DCLINIT
ANS2UTSVAL
     12178**DCL     13919<>CALL
ANS2UTSVAL.V
     12182**DCL     12178--DCLINIT
ANSBUF
     10184**DCL     10187--REDEF
ANSBUF.DATE
     10185**DCL     12178--DCLINIT 12179--DCLINIT
ANSBUF.TIME
     10186**DCL     12180--DCLINIT 12181--DCLINIT
ANSSTAMP
     10187**DCL     13898<<ASSIGN  13903<<CALLBLT 13906<<CALLBLT 13908<<CALLBLT 13910<<CALLBLT 13912<<CALLBLT
     13916<<CALLBLT
APPEND_HEADER IN PROCEDURE GET_MESSAGE_DATA
     13870**PROC    13751--CALL    13753--CALL    13755--CALL    13757--CALL    13759--CALL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:456  
APPEND_NOTEFILE IN PROCEDURE NOTEFILE_STUFF
     14076**ENTRY   14038--CALL    14040--CALL    14046--CALL    14049--CALL    14054--CALL    14100--CALL
     14102--CALL    14104--CALL    14107--CALL    14119--CALL
B$ALT.CODE
       152**DCL       152--REDEF     153--REDEF     153--REDEF
B$ALT.ERR
       153**DCL     13983>>ASSIGN
B$ALT.ERR.CODE
       154**DCL     15013>>IF
B$ALT.ERR.ERR#
       154**DCL       154--REDEF
B$ALT.EVID
       153**DCL       153--REDEF     153--REDEF
B$JIT.ACCN
      1839**DCL     13028>>IF      13215>>IF      13358>>IF
B$JIT.CCARS
      1927**DCL     15158<<ASSIGN
B$JIT.CCBUF
      1927**DCL     13005>>CALLBLT 13011>>CALLBLT 15157<<ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      1933**DCL      1933--REDEF
B$JIT.ERR.MID
      1840**DCL      1840--REDEF
B$JIT.JRESPEAK
      2001**DCL      2002--REDEF
B$JIT.MAXTMPDP
      2008**DCL     13054<<ASSIGN
B$JIT.ORIGINATOR_PORT.FROM_CR
      2110**DCL      2110--REDEF    2111--REDEF
B$JIT.PNR
      2014**DCL      2014--REDEF
B$JIT.PRDPRM
      2008**DCL     13199<<ASSIGN
B$JIT.PRIV.ACTIVE.EXMM
      1844**DCL     13363<<ASSIGN
B$JIT.PRIV.ACTIVE.FMREAD
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:457  
      1841**DCL     13052<<ASSIGN
B$JIT.PRIV.ACTIVE.JIT
      1844**DCL     15156>>IF
B$JIT.PRIV.JOB.FMSEC
      1884**DCL     13053<<ASSIGN
B$JIT.TSLINE
      2108**DCL      2109--REDEF
B$JIT.TSLINE.FEX
      2108**DCL     13171>>CALLBLT
B$JIT.TSLINE.LEV
      2109**DCL     13021>>IF
B$JIT.TSLINE.PORT
      2108**DCL     13172>>ASSIGN
B$JIT$
      9511**DCL      1834--IMP-PTR 13005>>CALLBLT 13011>>CALLBLT 13021>>IF      13028>>IF      13052>>ASSIGN
     13053>>ASSIGN  13054>>ASSIGN  13171>>CALLBLT 13172>>ASSIGN  13199>>ASSIGN  13215>>IF      13358>>IF
     13363>>ASSIGN  15156>>IF      15157>>ASSIGN  15158>>ASSIGN
B$PTR
      9547**DCL     13108>>CALL
B$TCB.ALT$
       148**DCL     13983>>ASSIGN  15013>>IF
B$TCB$
      9512**DCL       148--IMP-PTR 13983>>ASSIGN  15013>>IF
B$UBIN
      9544**DCL     13108<>CALL
BAILOUT IN PROCEDURE NOTIFY_STUCKEE
     14058**LABEL   14036--CALLALT 14038--CALLALT 14040--CALLALT 14046--CALLALT 14049--CALLALT 14051--CALLALT
     14054--CALLALT 14056--CALLALT
BAILOUT IN PROCEDURE NOTIFY_STUCKEE_READERR
     14123**LABEL   14097--GOTO    14098--CALLALT 14100--CALLALT 14102--CALLALT 14104--CALLALT 14107--CALLALT
     14116--CALLALT 14119--CALLALT 14121--CALLALT
BASE IN PROCEDURE PARSE_FROM
     14251**DCL     14279<<ASSIGN  14287>>IF      14288<<ASSIGN  14289>>CALLBLT 14290>>ASSIGN  14296<<ASSIGN
     14299>>IF      14300<<ASSIGN  14301>>CALLBLT 14302>>ASSIGN  14418<<ASSIGN  14436>>CALLBLT 14437<<ASSIGN
     14437>>ASSIGN  14440>>CALLBLT 14441<<ASSIGN  14441>>ASSIGN  14444>>CALLBLT 14445<<ASSIGN  14445>>ASSIGN
     14451>>CALLBLT 14452<<ASSIGN  14452>>ASSIGN  14456>>CALLBLT 14457<<ASSIGN  14457>>ASSIGN  14460>>CALLBLT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:458  
     14461<<ASSIGN  14461>>ASSIGN  14465>>CALLBLT 14466<<ASSIGN  14466>>ASSIGN  14469>>ASSIGN
BEGINNING IN PROCEDURE FIXLOCAL
     14652**LABEL   14672--GOTO
BINGO IN PROCEDURE PARSE_FROM
     14252**DCL     14278<<ASSIGN  14294<<ASSIGN  14306>>IF      14324>>IF      14326>>ASSIGN  14429<<CALLBLT
     14433<<CALLBLT 14436>>CALLBLT 14436>>CALLBLT 14437>>ASSIGN  14438>>ASSIGN  14443>>ASSIGN
BLANK_INDEX IN PROCEDURE TELL_OPERATOR
     13547**DCL     13550<<CALLBLT 13551>>ASSIGN
BLANK_LINE IN PROCEDURE GET_IOBUF_BOUND
     15198**LABEL   15194--CALLALT
BLANK_LINE IN PROCEDURE GET_MESSAGE_DATA
     13847**LABEL   13711--CALLALT 13745--GOTO    13821--GOTO
BLANK_LINE_READ IN PROCEDURE GET_MESSAGE_DATA
     13683**DCL     13782<<ASSIGN  13795<<ASSIGN  13820>>IF
BUF IN PROCEDURE GET_IOBUF_BOUND
     15190**DCL     15188--PROC    15194>>CALLBLT
BUFF IN PROCEDURE APPEND_HEADER
     13872**DCL     13870--PROC
BUFF.LEN IN PROCEDURE APPEND_HEADER
     13873**DCL     13877>>ASSIGN  13879>>CALLBLT 13881<<ASSIGN  13881>>ASSIGN
BUFF.TXT IN PROCEDURE APPEND_HEADER
     13874**DCL     13879<<CALLBLT
BUILD_MAIL_HEADER
     13641**PROC    13267--CALL
BYPASS IN PROCEDURE READ_COMMAND
     13501**LABEL   13496--CALLALT
CASE_CODE IN PROCEDURE GET_MESSAGE_DATA
     13749**LABEL   13720--GOTO    13772--EXIT
CB
      8141**DCL     13125<>CALL
CB.ADMIN
      8141**DCL     13137>>IF
CHANGED IN PROCEDURE TRIMTEXT
     14581**DCL     14591<<ASSIGN  14595<<ASSIGN  14600<<ASSIGN  14602>>IF      14613<<ASSIGN  14621<<ASSIGN
     14629<<ASSIGN  14631>>IF
CHARS IN PROCEDURE INITIALIZE_CONFIGURATION
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:459  
     13376**DCL     13457>>CALLBLT
CHECKADDR
     14478**PROC    14384--CALL
CHR IN PROCEDURE GET_MESSAGE_DATA
     13688**DCL     13713<<ASSIGN  13714>>IF      13714>>IF      13724>>IF      13786<<ASSIGN  13787>>IF
     13787>>IF
CHR IN PROCEDURE SPILL_ALIASES
     14921**DCL     14942<<ASSIGN  14944>>IF      14944>>IF
CLEAR_PROMPT
     12492**DCL     13192<>CALL
CLEAR_PROMPT.V
     12500**DCL     12494--DCLINIT
CLOSE_ALIAS
     10639**DCL     13353<>CALL
CLOSE_ALIAS.SN_
     10639**DCL     10639--REDEF
CLOSE_ALIAS.UTL_
     10640**DCL     10640--REDEF
CLOSE_ALIAS.V
     10644**DCL     10639--DCLINIT
CLOSE_ALIAS.V.EXPIRE#
     10654**DCL     10654--REDEF
CLOSE_ALIAS.V.TYPE#
     10652**DCL     10652--REDEF
CLOSE_ALIAS.V.XTNSIZE#
     10649**DCL     10649--REDEF   10651--REDEF
CLOSE_DATA
     11745**DCL     13727<>CALL    13849<>CALL    13971<>CALL    13996<>CALL    14021<>CALL    14058<>CALL
CLOSE_DATA.SN_
     11745**DCL     11745--REDEF
CLOSE_DATA.UTL_
     11746**DCL     11746--REDEF
CLOSE_DATA.V
     11750**DCL     11745--DCLINIT
CLOSE_DATA.V.EXPIRE#
     11760**DCL     11760--REDEF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:460  
CLOSE_DATA.V.TYPE#
     11758**DCL     11758--REDEF
CLOSE_DATA.V.XTNSIZE#
     11755**DCL     11755--REDEF   11757--REDEF
CLOSE_DRIBBLE
     11158**DCL     13354<>CALL
CLOSE_DRIBBLE.SN_
     11158**DCL     11158--REDEF
CLOSE_DRIBBLE.UTL_
     11159**DCL     11159--REDEF
CLOSE_DRIBBLE.V
     11163**DCL     11158--DCLINIT
CLOSE_DRIBBLE.V.EXPIRE#
     11173**DCL     11173--REDEF
CLOSE_DRIBBLE.V.TYPE#
     11171**DCL     11171--REDEF
CLOSE_DRIBBLE.V.XTNSIZE#
     11168**DCL     11168--REDEF   11170--REDEF
CLOSE_NODES
     10894**DCL     13355<>CALL
CLOSE_NODES.SN_
     10894**DCL     10894--REDEF
CLOSE_NODES.UTL_
     10895**DCL     10895--REDEF
CLOSE_NODES.V
     10899**DCL     10894--DCLINIT
CLOSE_NODES.V.EXPIRE#
     10909**DCL     10909--REDEF
CLOSE_NODES.V.TYPE#
     10907**DCL     10907--REDEF
CLOSE_NODES.V.XTNSIZE#
     10904**DCL     10904--REDEF   10906--REDEF
CLOSE_NOTIFY
     11957**DCL     14085<>CALL
CLOSE_NOTIFY.SN_
     11957**DCL     11957--REDEF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:461  
CLOSE_NOTIFY.UTL_
     11958**DCL     11958--REDEF
CLOSE_NOTIFY.V
     11962**DCL     11957--DCLINIT
CLOSE_NOTIFY.V.EXPIRE#
     11972**DCL     11972--REDEF
CLOSE_NOTIFY.V.TYPE#
     11970**DCL     11970--REDEF
CLOSE_NOTIFY.V.XTNSIZE#
     11967**DCL     11967--REDEF   11969--REDEF
CLOSE_SI
     10280**DCL     13484<>CALL
CLOSE_SI.SN_
     10280**DCL     10280--REDEF
CLOSE_SI.UTL_
     10281**DCL     10281--REDEF
CLOSE_SI.V
     10285**DCL     10280--DCLINIT
CLOSE_SI.V.EXPIRE#
     10295**DCL     10295--REDEF
CLOSE_SI.V.TYPE#
     10293**DCL     10293--REDEF
CLOSE_SI.V.XTNSIZE#
     10290**DCL     10290--REDEF   10292--REDEF
CMD.CODE
      5527**DCL     13498>>ASSIGN  13746>>ASSIGN  14271>>IF
CMD.NSUBLKS
      5531**DCL     13744>>IF      13812>>IF      13895>>ASSIGN  14280>>DOINDEX
CMD.SUBLK$
      5552**DCL     13535>>ASSIGN  13562>>ASSIGN  13578>>ASSIGN  13621>>ASSIGN  13747>>ASSIGN  13896>>ASSIGN
     13897>>ASSIGN  14281>>ASSIGN  14326>>ASSIGN  14334>>ASSIGN
CMD IN PROCEDURE INITIALIZE_CONFIGURATION
     13403**LABEL   13412--EXIT
CMD$
      9529**DCL      5519--IMP-PTR 13497<>CALL    13498>>ASSIGN  13535>>ASSIGN  13562>>ASSIGN  13578>>ASSIGN
     13621>>ASSIGN  13742<>CALL    13744>>IF      13744>>IF      13746>>ASSIGN  13747>>ASSIGN  13761<<ASSIGN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:462  
     13808<>CALL    13811>>IF      13812>>IF      13895>>ASSIGN  13896>>ASSIGN  13897>>ASSIGN  14262<>CALL
     14269<>CALL    14271>>IF      14280>>DOINDEX 14281>>ASSIGN  14326>>ASSIGN  14330<>CALL    14334>>ASSIGN
CMDBUF
     10144**DCL     13036<<ASSIGN  13408<<ASSIGN  13415<<ASSIGN  13429<<ASSIGN  13433<<ASSIGN  15178<>CALL
     15182--ASSIGN
CMDERR
     13313**LABEL   13221--CALLALT 13225--CALLALT 13237--CALLALT 13252--CALLALT 13267--CALLALT 13272--CALLALT
     13273--CALLALT
CMD_CODE
     10021**DCL     13204>>ASSIGN  13223>>DOCASE  13233<<ASSIGN  13247<<ASSIGN  13260<<ASSIGN  13307<<ASSIGN
     13310<<ASSIGN  13495<<ASSIGN  13498<<ASSIGN  14994>>IF
CMN2UTS
     10194**DCL     13472>>ASSIGN  13937>>ASSIGN
COLON_SYS
     12109**DCL     11991--DCLINIT 12038--DCLINIT 12838--DCLINIT 12961--DCLINIT
COMMAND_ERROR IN PROCEDURE READ_COMMAND
     13507**LABEL   13497--CALLALT
COMMON IN PROCEDURE PARSE_FROM
     14271**LABEL   14263--GOTO
COMMON IN PROCEDURE STATUS_LINE_UPDATE
     15156**LABEL   15170--GOTO
COMMON IN PROCEDURE WRITE_HEADER
     14168**LABEL   14143--GOTO    14149--GOTO    14155--GOTO    14161--GOTO
CONTINUE IN PROCEDURE MOVE_STRING
     15046**LABEL   15039--GOTO
COUNT IN PROCEDURE MOVE_PATH
     15117**DCL     15128<<ASSIGN  15133>>ASSIGN  15135<<ASSIGN  15135>>ASSIGN  15143>>ASSIGN  15145>>ASSIGN
COUNT IN PROCEDURE MOVE_STRING
     15027**DCL     15050<<ASSIGN  15062>>ASSIGN  15064<<ASSIGN  15064>>ASSIGN  15066>>ASSIGN  15071>>ASSIGN
     15073>>ASSIGN  15075<<ASSIGN  15079>>ASSIGN  15081<<ASSIGN  15081>>ASSIGN  15082>>DOWHILE 15083<<ASSIGN
     15083>>ASSIGN  15085<<ASSIGN  15085>>ASSIGN  15086>>ASSIGN  15098>>ASSIGN  15100>>ASSIGN
COUNT IN PROCEDURE SEND_MAIL_MESSAGE
     13954**DCL     13976<<DOINDEX 13989>>IF      13993>>CALLBLT 13994>>ASSIGN  14015<>CALL    14016>>ASSIGN
CREATE_NOTEFILE IN PROCEDURE NOTEFILE_STUFF
     14071**ENTRY   14036--CALL    14098--CALL
CURR_CMDCODE IN PROCEDURE GET_MESSAGE_DATA
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:463  
     13690**DCL     13719<<ASSIGN  13746<<ASSIGN  13749>>DOCASE  13883>>ASSIGN
CV.L
      8187**DCL      8188--IMP-SIZ
DASH_INDEX IN PROCEDURE LOOKUP_ALIAS
     14684**DCL     14751<<CALLBLT 14752>>DOWHILE 14753>>ASSIGN  14754<<CALLBLT 14763<<CALLBLT 14764>>DOWHILE
     14765>>ASSIGN  14766<<CALLBLT 14772<<CALLBLT 14773>>DOWHILE 14774>>ASSIGN  14775<<CALLBLT
DATA_KEY
     10197**DCL     11637--DCLINIT 11638--DCLINIT 11676--DCLINIT 11708--DCLINIT
DATA_KEY.KEY
     10199**DCL     13652<<ASSIGN  13655<<ASSIGN  13661<<ASSIGN  13834<<ASSIGN  13834>>ASSIGN  13835>>ASSIGN
     13862<<ASSIGN  13862>>ASSIGN  13991<<ASSIGN  14207<<ASSIGN
DATA_LOST
     10027**DCL     13203<<ASSIGN  13501>>IF      13855>>IF      13859>>IF      15016<<ASSIGN
DATA_NAME
     11398**DCL     11330--DCLINIT 11467--DCLINIT 13646--ASSIGN  13647--ASSIGN  13648--ASSIGN
DATA_NAME.NAME#
     11398**DCL     13644<<CALLBLT
DATE$ IN PROCEDURE SET_DATESTAMP
     13891**DCL     13896<<ASSIGN  13900>>CALLBLT 13900>>CALLBLT 13905>>ASSIGN  13907>>CALLBLT 13907>>CALLBLT
DATEBUF
     10163**DCL     10169--REDEF   12138--DCLINIT 12139--DCLINIT
DATEBUF.DAY
     10166**DCL     13662>>CALLBLT
DATEBUF.MON
     10164**DCL     13662>>CALLBLT
DATEBUF.YEAR
     10168**DCL     13662>>CALLBLT
DATESTRING
     10169**DCL     13167>>ASSIGN
DATEWORK
     10181**DCL     13662<<CALLBLT 13664>>CALLBLT
DATE_SEEN IN PROCEDURE GET_MESSAGE_DATA
     13682**DCL     13703<<ASSIGN  13763<<ASSIGN  13771>>IF
DAYBUF
     10179**DCL     12141--DCLINIT 15168>>CALLBLT
DELETE_DATA
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:464  
     11575**DCL     13852<>CALL    14006<>CALL
DELETE_DATA.ACSVEH_
     11577**DCL     11578--REDEF
DELETE_DATA.ALTKEYS_
     11583**DCL     11584--REDEF   11584--REDEF
DELETE_DATA.HDR_
     11582**DCL     11583--REDEF
DELETE_DATA.NAME_
     11576**DCL     13648<<ASSIGN
DELETE_DATA.TAB_
     11581**DCL     11582--REDEF
DELETE_DATA.UHL_
     11575**DCL     11576--REDEF   11576--REDEF
DELETE_DATA.V
     11584**DCL     11575--DCLINIT
DELETE_DATA.V.FSN#
     11615**DCL     11615--REDEF   11615--REDEF
DELETE_DATA.WSN_
     11581**DCL     11581--REDEF
DELTA_NAME
     12821**DCL     12790--DCLINIT
DEL_TABS IN PROCEDURE WRITE_HEADER
     14215**PROC    14181--CALL    14199--CALL
DIFF IN PROCEDURE FIXLOCAL
     14646**DCL     14660<<ASSIGN  14662>>CALLBLT 14667>>IF
DOIT IN PROCEDURE LEGALIZE
     14451**LABEL   14431--GOTO
DONE IN PROCEDURE CHECKADDR
     14513**LABEL   14509--CALLALT
DONE IN PROCEDURE LEGALIZE
     14472**LABEL   14410--CALLALT 14414--CALLALT
DONE IN PROCEDURE NOTIFY_STUCKEE
     14060**LABEL   14035--CALLALT 14058--CALLALT
DONE IN PROCEDURE SPILL_ALIASES
     14922**DCL     14931<<ASSIGN  14949<<ASSIGN  14953>>IF
DOT_INDEX IN PROCEDURE LOOKUP_ALIAS
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:465  
     14685**DCL     14717<<CALLBLT 14719>>IF      14719>>IF      14724>>ASSIGN  14730>>CALLBLT
DRIBBLE_NAME
     11233**DCL     11092--DCLINIT
DYING
     13362**LABEL   13007--CALLALT 13030--CALLALT 13038--GOTO    13044--CALLALT 13047--CALLALT 13049--CALLALT
     13072--CALLALT 13148--CALLALT 13151--CALLALT 13170--CALLALT 13190--CALLALT 13192--CALLALT 13214--CALLALT
END_OF_MESSAGE IN PROCEDURE GET_MESSAGE_DATA
     13680**DCL     13705<<ASSIGN  13709>>DOUNTIL 13728<<ASSIGN
ENTRYFLAG IN PROCEDURE PARSE_FROM
     14253**DCL     14260<<ASSIGN  14267<<ASSIGN  14306>>IF      14306>>IF      14335>>IF      14408>>IF
ERR IN PROCEDURE WRITE_REPLY
     13517**DCL     13520<>CALL
ERRCODE
     12865**DCL     12837--DCLINIT 12960--DCLINIT 13983<<ASSIGN  14109<<ASSIGN  14112<<ASSIGN  14114<<ASSIGN
ERRMSGBUF IN PROCEDURE NOTIFY_STUCKEE
     14031**DCL     14050--ASSIGN  14053>>ASSIGN
ERRMSGBUF IN PROCEDURE NOTIFY_STUCKEE_READERR
     14093**DCL     14115--ASSIGN  14118>>ASSIGN
ERROR_FLAG IN PROCEDURE INITIALIZE_CONFIGURATION
     13370**DCL     13379<<ASSIGN  13393<<ASSIGN  13411<<ASSIGN  13487>>IF
F$DATA
      9520**DCL     14041--ASSIGN
F$DATA$ IN PROCEDURE NOTIFY_STUCKEE
     14032**DCL     14041<<ASSIGN  14042>>CALLBLT 14042>>CALLBLT 14042>>CALLBLT
F$DCB.ACCT#
       107**DCL     13041>>ASSIGN  14042>>CALLBLT
F$DCB.ACTPOS
       123**DCL       123--REDEF
F$DCB.ARS#
        97**DCL        97--REDEF   14979>>ASSIGN
F$DCB.ASN#
       112**DCL     13035>>IF
F$DCB.ATTR
       116**DCL       117--REDEF
F$DCB.BORROW
       131**DCL       131--REDEF     131--REDEF     131--REDEF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:466  
F$DCB.DCBNAME.L
       145**DCL       145--IMP-SIZ
F$DCB.EOMCHAR#
       101**DCL       101--REDEF
F$DCB.FLDID
       126**DCL       126--REDEF
F$DCB.FORM$
       120**DCL       120--REDEF
F$DCB.FSECT
       136**DCL       136--REDEF
F$DCB.FSN#
       113**DCL       113--REDEF     113--REDEF     114--REDEF
F$DCB.HEADER$
       119**DCL       119--REDEF
F$DCB.IXTNSIZE#
       117**DCL       117--REDEF
F$DCB.LASTSTA$
       106**DCL       106--REDEF
F$DCB.LVL
       132**DCL       132--REDEF
F$DCB.NAME#.C
       107**DCL       107--REDEF   14042>>CALLBLT
F$DCB.NAME#.L
       107**DCL     14042>>CALLBLT
F$DCB.NOEOF
       129**DCL       129--REDEF
F$DCB.NRECS#
       118**DCL       118--REDEF
F$DCB.NRECX
       137**DCL       137--REDEF
F$DCB.OHDR
       129**DCL       129--REDEF
F$DCB.ORG#
       112**DCL       112--REDEF
F$DCB.PRECNO
       135**DCL       135--REDEF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:467  
F$DCB.RCSZ
       141**DCL       141--REDEF
F$DCB.RES#
       108**DCL       108--REDEF
F$DCB.SETX
       120**DCL       120--REDEF
F$DCB.TAB$
       120**DCL       120--REDEF
F$DCB.TDA
       134**DCL       135--REDEF
F$DCB.WSN#
       108**DCL       108--REDEF
FEPNAMES
      9546**DCL     13093>>IF      13096<>CALL    13098>>IF      13102>>CALLBLT 13480<<CALLBLT
FIXLOCAL
     14637**PROC    13596--CALL    13631--CALL    14504--CALL
FORUM
     10085**DCL     13968<>CALL
FORUM.LEN
     10086**DCL     13697<<ASSIGN
FOUNDEM IN PROCEDURE LOOKUP_ALIAS
     14758**LABEL   14769--GOTO    14778--GOTO
FPT_ALIB
     12790**DCL     13007<>CALL
FPT_ALIB.V
     12791**DCL     12791--DCLINIT
FPT_ERRMSG
     12837**DCL     14014<>CALL    14051<>CALL
FPT_ERRMSG.BUF_
     12837**DCL     14013<<ASSIGN  14050<<ASSIGN
FPT_ERRMSG.V
     12841**DCL     12837--DCLINIT
FPT_SETFMA
     12123**DCL     13048<>CALL
FPT_TRMCTL
     12727**DCL     13977<>CALL    13979<>CALL    13980<>CALL    13987<>CALL    13988<>CALL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:468  
FPT_TRMCTL.V
     12735**DCL     12729--DCLINIT
FPT_XSERRMSG
     12960**DCL     14116<>CALL
FPT_XSERRMSG.BUF_
     12960**DCL     14115<<ASSIGN
FPT_XSERRMSG.V
     12964**DCL     12960--DCLINIT
FROM
     10060**DCL     13757<>CALL    14181<>CALL
FROM.LEN
     10061**DCL     13692<<ASSIGN  14177>>IF      14178<<ASSIGN  14190>>IF      14191>>ASSIGN  14261>>ASSIGN
FROM.TXT
     10062**DCL     14179<<ASSIGN  14192>>ASSIGN  14262<>CALL
FROM$ IN PROCEDURE MOVE_PATH
     15118**DCL     15115--PROC    15124>>IF      15130>>CALLBLT 15130>>CALLBLT 15131>>DOWHILE 15133>>ASSIGN
     15133>>ASSIGN  15137>>DOWHILE 15137>>DOWHILE 15140>>CALLBLT 15140>>CALLBLT 15143>>ASSIGN  15143>>ASSIGN
FROM$ IN PROCEDURE MOVE_STRING
     15028**DCL     15025--PROC    15035>>IF      15041--ENTRY   15043>>IF      15044>>ASSIGN  15046>>IF
     15053>>IF      15053>>IF      15053>>IF      15053>>IF      15053>>IF      15056>>ASSIGN  15056>>ASSIGN
     15059>>CALLBLT 15059>>CALLBLT 15060>>DOWHILE 15062>>ASSIGN  15062>>ASSIGN  15066>>ASSIGN  15068>>CALLBLT
     15068>>CALLBLT 15071>>ASSIGN  15071>>ASSIGN  15106>>ASSIGN  15106>>ASSIGN  15106>>ASSIGN  15106>>ASSIGN
     15106>>ASSIGN  15106>>ASSIGN
FS
      8124**DCL     13091<<ASSIGN  13110<>CALL
FTEXT
     10105**DCL     14310<>CALL    14312<>CALL    14317<>CALL    14319<>CALL    14347<>CALL
FTEXT.LEN
     10106**DCL     13701<<ASSIGN  14186>>CALLBLT 14187>>ASSIGN  14311>>IF      14318>>IF      14346<<ASSIGN
FTEXT.TXT
     10107**DCL     14186>>CALLBLT 14345<<CALLBLT
GET_IOBUF_BOUND
     15188**PROC    14015--CALL    14078--CALL    15178--CALL
GET_MESSAGE_DATA
     13678**PROC    13272--CALL
GET_TIMESTAMP
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:469  
     12138**DCL     13165<>CALL    13654<>CALL    15167<>CALL
GET_TIMESTAMP.V
     12142**DCL     12138--DCLINIT
GET_UTS
     12157**DCL     13643<>CALL
GET_UTS.V
     12161**DCL     12157--DCLINIT
GOTO_ALTRET IN PROCEDURE LOOKUP_ALIAS
     14836**LABEL   14712--CALLALT
HAVE_A_CMD IN PROCEDURE INITIALIZE_CONFIGURATION
     13371**DCL     13383<<ASSIGN  13384>>DOUNTIL 13387<<ASSIGN
HEADER_LINE IN PROCEDURE GET_MESSAGE_DATA
     13681**DCL     13704<<ASSIGN  13739>>IF      13828>>IF      13865<<ASSIGN
HELO
     10045**DCL     13227<>CALL    13352<>CALL    13999<>CALL
HELO.LEN
     10046**DCL     13229>>ASSIGN  13295>>CALLBLT 13536<<ASSIGN  13537>>CALLBLT 13538>>CALLBLT 13664>>CALLBLT
     14537>>CALLBLT 14538>>ASSIGN  14540>>CALLBLT 14545>>IF
HELO.TXT
     10047**DCL     13229>>ASSIGN  13295>>CALLBLT 13537<<CALLBLT 13538>>CALLBLT 13664>>CALLBLT 14537>>CALLBLT
     14540>>CALLBLT
HEX
     10252**DCL     13174>>ASSIGN
HEX1
     10253**DCL     13108<>CALL    13109>>ASSIGN  13172<<ASSIGN  13174>>ASSIGN  13176<<ASSIGN  13176>>ASSIGN
HEX2
     10254**DCL     13173<<DOINDEX 13174>>ASSIGN
I IN PROCEDURE CHECKADDR
     14487**DCL     14542<<DOINDEX 14543>>IF      14544>>ASSIGN  14545>>IF      14547>>ASSIGN  14548>>ASSIGN
I IN PROCEDURE FIXLOCAL
     14647**DCL     14664<<DOINDEX 14665>>IF      14666>>ASSIGN  14667>>IF
I IN PROCEDURE INITIALIZE_CONFIGURATION
     13372**DCL     13418<<ASSIGN  13419>>ASSIGN  13420>>CALLBLT 13422>>ASSIGN  13423>>CALLBLT 13425>>ASSIGN
     13436<<ASSIGN  13437>>ASSIGN  13438>>CALLBLT 13440>>ASSIGN  13455<<ASSIGN  13456>>ASSIGN  13457>>CALLBLT
     13461<<CALLBLT 13462>>ASSIGN  13462>>ASSIGN  13468<<CALLBLT 13470>>ASSIGN  13479<<DOINDEX 13480>>CALLBLT
     13480>>CALLBLT 13480>>CALLBLT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:470  
I IN PROCEDURE NOTIFY_STUCKEE
     14033**DCL     14052<<DOINDEX 14053>>ASSIGN
I IN PROCEDURE NOTIFY_STUCKEE_READERR
     14094**DCL     14117<<DOINDEX 14118>>ASSIGN
I IN PROCEDURE PARSE_FROM
     14250**DCL     14280<<DOINDEX 14281>>ASSIGN  14294>>ASSIGN  14403<<CALLBLT 14404>>DOWHILE 14405>>ASSIGN
     14406<<CALLBLT 14410<<CALLBLT 14414<<CALLBLT 14417<<ASSIGN  14422>>DOWHILE 14424>>CALLBLT 14424>>CALLBLT
     14429>>CALLBLT 14433>>CALLBLT 14436>>CALLBLT 14438<<ASSIGN  14438>>ASSIGN  14444>>CALLBLT 14451>>CALLBLT
     14456>>CALLBLT 14458<<ASSIGN  14458>>ASSIGN
I IN PROCEDURE READ_TRANSPARENT
     14972**DCL     14992<<DOINDEX 14993>>ASSIGN  14993>>ASSIGN  14994>>IF      14995<<ASSIGN  14995>>ASSIGN
     14996>>ASSIGN  14996>>ASSIGN
I IN PROCEDURE TRIMTEXT
     14579**DCL     14592<<ASSIGN  14593>>DOWHILE 14594<<ASSIGN  14594>>ASSIGN  14603>>CALLBLT 14603>>CALLBLT
     14603>>CALLBLT 14604>>ASSIGN
IDLESTATUS IN PROCEDURE STATUS_LINE_UPDATE
     15152**DCL     15154<<ASSIGN  15160>>IF      15166<<ASSIGN
IDX IN PROCEDURE SAVE_USER_NAME
     13572**DCL     13588<<CALLBLT 13594>>CALLBLT 13594>>CALLBLT 13594>>CALLBLT
INDX IN PROCEDURE DEL_TABS
     14222**DCL     14225<<CALLBLT 14226>>DOWHILE 14227>>ASSIGN  14228<<CALLBLT 14232<<CALLBLT 14233>>DOWHILE
     14235>>ASSIGN  14236>>ASSIGN  14237<<CALLBLT 14237>>CALLBLT
INHIBIT_OPERATOR_MESSAGES
     12568**DCL     13193<>CALL
INHIBIT_OPERATOR_MESSAGES.V
     12572**DCL     12570--DCLINIT
INITIALIZE_CONFIGURATION
     13368**PROC    13049--CALL
INTERESTING IN PROCEDURE SPILL_ALIASES
     14923**DCL     14943<<ASSIGN  14946<<ASSIGN  14947>>IF      14956>>IF
IOERR IN PROCEDURE BUILD_MAIL_HEADER
     13673**LABEL   13649--CALLALT 13653--CALLALT 13660--CALLALT 13670--CALLALT
IOERR IN PROCEDURE GET_MESSAGE_DATA
     13841**LABEL   13838--CALLALT 13863--CALLALT
J IN PROCEDURE INITIALIZE_CONFIGURATION
     13373**DCL     13456<<ASSIGN  13457>>CALLBLT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:471  
J IN PROCEDURE TRIMTEXT
     14580**DCL     14597<<ASSIGN  14598>>DOWHILE 14599<<ASSIGN  14599>>ASSIGN  14603>>CALLBLT 14603>>CALLBLT
     14604>>ASSIGN  14607<<ASSIGN  14608>>IF      14608>>IF      14610>>CALLBLT 14610>>CALLBLT 14611>>ASSIGN
     14615<<ASSIGN  14616>>IF      14616>>IF      14618>>CALLBLT 14618>>CALLBLT 14619>>ASSIGN  14623<<ASSIGN
     14624>>IF      14624>>IF      14626>>CALLBLT 14626>>CALLBLT 14627>>ASSIGN
JIT_PRIV
     12390**DCL     13050<>CALL    13362<>CALL
JIT_PRIV.V
     12390**DCL     12390--DCLINIT
JOIN_AFTER_READ IN PROCEDURE GET_MESSAGE_DATA
     13713**LABEL   13822--GOTO
KEYVAL IN PROCEDURE WRITE_HEADER
     14132**DCL     14127--PROC    14139>>DOSELCT 14207>>ASSIGN
LAST IN PROCEDURE DEL_TABS
     14223**DCL     14231<<ASSIGN  14234>>IF      14236<<ASSIGN  14239>>IF      14240>>ASSIGN
LAST_CMD
     10022**DCL     13204<<ASSIGN  13247>>ASSIGN  13251>>IF      13251>>IF      13260>>ASSIGN  13263>>IF
     13307>>ASSIGN  13310>>ASSIGN
LCLBUF
     10188**DCL     10192--REDEF
LCLBUF.DATE
     10189**DCL     12199--DCLINIT 12200--DCLINIT
LCLBUF.TIME
     10191**DCL     12201--DCLINIT 12202--DCLINIT
LCLSTAMP
     10192**DCL     13942>>ASSIGN
LEGALIZE IN PROCEDURE PARSE_FROM
     14394**PROC    14312--CALL    14319--CALL    14347--CALL    14385--CALL
LEN IN PROCEDURE CHECKADDR
     14488**DCL     14544<<ASSIGN  14545>>IF
LEN IN PROCEDURE FIXLOCAL
     14648**DCL     14666<<ASSIGN  14667>>IF
LEN IN PROCEDURE GET_MESSAGE_DATA
     13685**DCL     13877<<ASSIGN  13878>>IF      13879>>CALLBLT 13879>>CALLBLT 13881>>ASSIGN
LEN IN PROCEDURE MOVE_STRING
     15029**DCL     15025--PROC    15035>>IF      15041--ENTRY   15043>>IF      15044>>ASSIGN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:472  
LENGTH IN PROCEDURE MOVE_PATH
     15119**DCL     15130<<CALLBLT 15131>>DOWHILE 15132<<ASSIGN  15132>>ASSIGN  15133>>ASSIGN  15133>>ASSIGN
     15135>>ASSIGN  15136>>ASSIGN  15140<<CALLBLT 15142<<ASSIGN  15142>>ASSIGN  15143>>ASSIGN  15143>>ASSIGN
     15145>>ASSIGN
LENGTH IN PROCEDURE MOVE_STRING
     15030**DCL     15059<<CALLBLT 15060>>DOWHILE 15061<<ASSIGN  15061>>ASSIGN  15062>>ASSIGN  15062>>ASSIGN
     15064>>ASSIGN  15065>>ASSIGN  15068<<CALLBLT 15070<<ASSIGN  15070>>ASSIGN  15071>>ASSIGN  15071>>ASSIGN
     15073>>ASSIGN  15074<<CALLBLT 15077>>DOWHILE 15078<<ASSIGN  15078>>ASSIGN  15079>>ASSIGN  15079>>ASSIGN
     15081>>ASSIGN  15087>>ASSIGN  15095<<CALLBLT 15097<<ASSIGN  15097>>ASSIGN  15098>>ASSIGN  15098>>ASSIGN
     15100>>ASSIGN
LINEBUF
     10137**DCL     10138--REDEF   10349--DCLINIT 10350--DCLINIT 10387--DCLINIT 10388--DCLINIT 11639--DCLINIT
     11640--DCLINIT 11677--DCLINIT 11678--DCLINIT 13125--CALL    13144--ASSIGN  13497<>CALL    13537>>CALLBLT
     13564>>CALLBLT 13580>>CALLBLT 13650<<CALLBLT 13656<<CALLBLT 13658>>CALLBLT 13664<<CALLBLT 13668>>CALLBLT
     13713>>ASSIGN  13716<<ASSIGN  13717>>CALLBLT 13736<<ASSIGN  13736>>ASSIGN  13742<>CALL    13775>>CALLBLT
     13778>>CALLBLT 13786>>ASSIGN  13788>>CALLBLT 13829>>CALLBLT 13830<<ASSIGN  13879>>CALLBLT 13993<<CALLBLT
     14168<<CALLBLT 14169<<CALLBLT 14174<<CALLBLT 14185<<CALLBLT 14186<<CALLBLT 14203<<CALLBLT 14204<<CALLBLT
     14975--CALL    14985--ASSIGN  15005>>IF
LINECHAR
     10138**DCL     14993<<ASSIGN  14993>>ASSIGN  14994>>IF      14996<<ASSIGN  14996>>ASSIGN  14999>>DOWHILE
     15002>>DOWHILE
LINESIZE
     10136**DCL     13497<>CALL    13536>>ASSIGN  13563>>ASSIGN  13579>>ASSIGN  13658<<CALLBLT 13659>>ASSIGN
     13668<<CALLBLT 13669>>ASSIGN  13725>>IF      13735<<ASSIGN  13735>>ASSIGN  13736>>ASSIGN  13736>>ASSIGN
     13742<>CALL    13775>>CALLBLT 13777>>ASSIGN  13788>>CALLBLT 13788>>CALLBLT 13790>>ASSIGN  13831<<ASSIGN
     13831>>ASSIGN  13833>>ASSIGN  13877>>ASSIGN  14975<>CALL    14979<<ASSIGN  14982>>IF      14986>>ASSIGN
     14990>>IF      14992>>DOINDEX 14999>>DOWHILE 15000<<ASSIGN  15000>>ASSIGN  15002>>DOWHILE 15003<<ASSIGN
     15003>>ASSIGN  15005>>IF      15017<<ASSIGN
LOCALHOSTNAME
      9545**DCL     13094<>CALL
LOGGED_ON
     10024**DCL     13206>>IF      13226<<ASSIGN  13232>>IF      13313>>IF
LOOKUP_ALIAS
     14681**PROC    13609--CALL    13632--CALL    14509--CALL
LOOKUP_REGISTRATION
     14855**PROC    14746--CALL    14756--CALL    14768--CALL    14777--CALL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:473  
LOOP IN PROCEDURE LEGALIZE
     14422**LABEL   14453--EXIT
LS
      8132**DCL     13090<<ASSIGN  13110<>CALL
LS.ADDRESS
      8136**DCL     13109<<ASSIGN
LS.PORT
      8136**DCL     13092<<ASSIGN
LTEXT
     10095**DCL     14317<>CALL
LTEXT.LEN
     10096**DCL     13699<<ASSIGN  14273<<ASSIGN  14290<<ASSIGN  14316>>IF
LTEXT.TXT
     10097**DCL     14275<<ASSIGN  14289<<CALLBLT
M$ALIB
        31**DCL-ENT 13007--CALL
M$CLOSE
        18**DCL-ENT 13353--CALL    13354--CALL    13355--CALL    13484--CALL    13727--CALL    13849--CALL
     13971--CALL    13996--CALL    14021--CALL    14058--CALL    14085--CALL
M$EOM
        43**DCL-ENT 13214--CALL
M$ERRMSG
        81**DCL-ENT 14014--CALL    14051--CALL    14116--CALL
M$EXIT
        30**DCL-ENT 13365--CALL
M$GTRMCTL
        42**DCL-ENT 13977--CALL    13980--CALL    13988--CALL
M$INT
        73**DCL-ENT 13030--CALL
M$KEYIN
        23**DCL-ENT 13552--CALL
M$LINK
        30**DCL-ENT 13981--CALL    14086--CALL
M$OPEN
        18**DCL-ENT 13044--CALL    13047--CALL    13060--CALL    13148--CALL    13151--CALL    13152--CALL
     13190--CALL    13649--CALL    13852--CALL    13958--CALL    13990--CALL    14006--CALL    14035--CALL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:474  
     14073--CALL
M$PFIL
        20**DCL-ENT 14933--CALL
M$PRECORD
        22**DCL-ENT 14519--CALL    14734--CALL    14794--CALL    14812--CALL    14899--CALL    14909--CALL
     14941--CALL
M$PROMPT
        42**DCL-ENT 13192--CALL
M$READ
        19**DCL-ENT 13064--CALL    13156--CALL    13992--CALL    14978--CALL
M$SCREECH
        32**DCL-ENT 13364--CALL
M$SETFMA
        18**DCL-ENT 13048--CALL
M$SI
      9524**DCL     13034--ASSIGN  13035--IF
M$SI$
      9528**DCL     13034<<ASSIGN  13041>>ASSIGN
M$SPRIV
        77**DCL-ENT 13050--CALL    13362--CALL
M$STRMCTL
        42**DCL-ENT 13217--CALL    13979--CALL    13987--CALL
M$TIME
        85**DCL-ENT 13165--CALL    13643--CALL    13654--CALL    13919--CALL    13941--CALL    15167--CALL
M$TRMISC
        47**DCL-ENT 13193--CALL
M$TRMPRG
        43**DCL-ENT 13179--CALL    13336--CALL
M$UC
        42**DCL     14979--ASSIGN
M$WAIT
        76**DCL-ENT 13105--CALL    13115--CALL    13131--CALL    13178--CALL    13184--CALL    13187--CALL
     13269--CALL    13319--CALL    13323--CALL    13335--CALL
M$WRITE
        19**DCL-ENT 13523--CALL    13527--CALL    13653--CALL    13660--CALL    13670--CALL    13838--CALL
     13863--CALL    13995--CALL    14017--CALL    14080--CALL    14208--CALL    14710--CALL    14988--CALL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:475  
     15183--CALL
M$YC
        32**DCL-ENT 13359--CALL
MAIL.LEN
     10051**DCL     13243>>ASSIGN  13563<<ASSIGN  13564>>CALLBLT 13656>>CALLBLT 14178>>ASSIGN  14195>>ASSIGN
MAIL.TXT
     10052**DCL     13243>>ASSIGN  13564<<CALLBLT 13656>>CALLBLT 14179>>ASSIGN  14196>>ASSIGN
MATCHLEN IN PROCEDURE LOOKUP_ALIAS
     14686**DCL     14799<<ASSIGN  14805>>IF      14809<<ASSIGN  14816>>IF      14821>>CALLBLT 14823>>ASSIGN
     14826>>CALLBLT
MATCHSTRING IN PROCEDURE LOOKUP_ALIAS
     14687**DCL     14810<<ASSIGN  14821>>CALLBLT 14826>>CALLBLT
MID
     10080**DCL     13753<>CALL    13966<>CALL
MID.LEN
     10081**DCL     13696<<ASSIGN
MOVEIT IN PROCEDURE LEGALIZE
     14469**LABEL   14446--GOTO
MOVE_STRING
     15025**PROC    14712--CALL
MSG_COUNT
     10025**DCL     13124<<ASSIGN  13227<>CALL    13239>>CALLBLT 13352<>CALL    13729<<ASSIGN  13729>>ASSIGN
     13999<>CALL
MY_SITE_NAME
     10140**DCL     10829--DCLINIT 10830--DCLINIT 13076<<ASSIGN  13077>>CALLBLT 13078>>CALLBLT 13079>>CALLBLT
     13080>>CALLBLT 13081>>CALLBLT 13082>>CALLBLT 13083>>CALLBLT 14733>>IF      14826>>CALLBLT 14844>>CALLBLT
MY_SITE_NAME_2
     10142**DCL     13083<<CALLBLT 13664>>CALLBLT
MY_SITE_NAME_L
     10141**DCL     13077<<CALLBLT 13079>>CALLBLT 13080>>CALLBLT 13081>>CALLBLT 13082>>CALLBLT 13083>>CALLBLT
     13664>>CALLBLT 14826>>CALLBLT 14844>>CALLBLT
NEXT IN PROCEDURE PARSE_FROM
     14305**LABEL   14291--GOTO
NODES_ACCT
     10807**DCL     10730--DCLINIT
NODES_FILE_OPEN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:476  
     10030**DCL     13062<<ASSIGN  13069<<ASSIGN  13154<<ASSIGN  13161<<ASSIGN  14726>>IF
NODES_KEY
     10159**DCL     10827--DCLINIT 10828--DCLINIT 10861--DCLINIT 10862--DCLINIT
NODES_KEY.SITE
     10161**DCL     13063<<ASSIGN  13155<<ASSIGN  14517<<CALLBLT 14730<<CALLBLT 14733>>IF
NODES_NAME
     10794**DCL     10726--DCLINIT
NOTIFY_CMD
     12022**DCL     11992--DCLINIT
NOTIFY_NAME
     11901**DCL     11833--DCLINIT
NOTIFY_STUCKEE
     14029**PROC    14003--CALL
NOTIFY_STUCKEE_READERR
     14091**PROC    13848--CALL
NOTLOCAL IN PROCEDURE SAVE_USER_NAME
     13614**LABEL   13596--CALLALT
NOTLOCAL IN PROCEDURE VERIFY_ADDRESS
     13637**LABEL   13631--CALLALT
NOT_REGISTERED IN PROCEDURE LOOKUP_ALIAS
     14780**LABEL   14777--CALLALT
NO_COMMENT IN PROCEDURE MOVE_STRING
     15102**LABEL   15074--CALLALT
OCMSG
     10143**DCL     12838--DCLINIT 12961--DCLINIT 13295<<CALLBLT 13538<<CALLBLT 13550>>CALLBLT 13551--ASSIGN
     14012<<ASSIGN  14013--ASSIGN  14015<>CALL    14016--ASSIGN  14037<<CALLBLT 14039<<ASSIGN  14042<<CALLBLT
     14047<<CALLBLT 14053<<ASSIGN  14078<>CALL    14079--ASSIGN  14099<<CALLBLT 14101<<ASSIGN  14103<<CALLBLT
     14105<<CALLBLT 14118<<ASSIGN  14705<<CALLBLT 14708--ASSIGN
OFFCMD
      9538**DCL     12451--DCLINIT
OFFSET IN PROCEDURE MOVE_PATH
     15120**DCL     15115--PROC    15124>>IF      15129>>ASSIGN
OLD_CMD_LCN
      8139**DCL     13121<<ASSIGN  13123>>ASSIGN  13132>>IF
OOPS IN PROCEDURE NOTEFILE_STUFF
     14069**LABEL   14073--CALLALT 14080--CALLALT 14085--CALLALT 14086--CALLALT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:477  
OOPS IN PROCEDURE PARSE_FROM
     14392**LABEL   14262--CALLALT 14269--CALLALT 14325--GOTO    14330--CALLALT 14350--GOTO    14388--GOTO
OOPS IN PROCEDURE SEND_MAIL_MESSAGE
     14021**LABEL   13958--CALLALT 13963--CALLALT 13964--CALLALT 13965--CALLALT 13966--CALLALT 13967--CALLALT
     13968--CALLALT 13969--CALLALT 13970--CALLALT 13971--CALLALT 13990--CALLALT 13992--CALLALT 13995--CALLALT
     13996--CALLALT
OOPS IN PROCEDURE SET_DATESTAMP
     13946**LABEL   13919--CALLALT 13941--CALLALT
OOPS IN PROCEDURE WRITE_HEADER
     14211**LABEL   14182--CALLALT 14200--CALLALT
OPEN_ALIAS
     10496**DCL     13190<>CALL
OPEN_ALIAS.ACSVEH_
     10498**DCL     10499--REDEF
OPEN_ALIAS.ALTKEYS_
     10504**DCL     10505--REDEF   10505--REDEF
OPEN_ALIAS.HDR_
     10503**DCL     10504--REDEF
OPEN_ALIAS.TAB_
     10502**DCL     10503--REDEF
OPEN_ALIAS.UHL_
     10496**DCL     10497--REDEF   10497--REDEF
OPEN_ALIAS.V
     10505**DCL     10496--DCLINIT
OPEN_ALIAS.V.FSN#
     10536**DCL     10536--REDEF   10536--REDEF
OPEN_ALIAS.WSN_
     10502**DCL     10502--REDEF
OPEN_DATA
     11329**DCL     13649<>CALL
OPEN_DATA.ACSVEH_
     11331**DCL     11332--REDEF
OPEN_DATA.ALTKEYS_
     11337**DCL     11338--REDEF   11338--REDEF
OPEN_DATA.HDR_
     11336**DCL     11337--REDEF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:478  
OPEN_DATA.NAME_
     11330**DCL     13646<<ASSIGN
OPEN_DATA.TAB_
     11335**DCL     11336--REDEF
OPEN_DATA.UHL_
     11329**DCL     11330--REDEF   11330--REDEF
OPEN_DATA.V
     11338**DCL     11329--DCLINIT
OPEN_DATA.V.FSN#
     11369**DCL     11369--REDEF   11369--REDEF
OPEN_DATA.WSN_
     11335**DCL     11335--REDEF
OPEN_DRIBBLE
     11091**DCL     13044<>CALL    13148<>CALL
OPEN_DRIBBLE.ACSVEH_
     11093**DCL     11094--REDEF
OPEN_DRIBBLE.ALTKEYS_
     11099**DCL     11100--REDEF   11100--REDEF
OPEN_DRIBBLE.HDR_
     11098**DCL     11099--REDEF
OPEN_DRIBBLE.TAB_
     11097**DCL     11098--REDEF
OPEN_DRIBBLE.UHL_
     11091**DCL     11092--REDEF   11092--REDEF
OPEN_DRIBBLE.V
     11100**DCL     11091--DCLINIT
OPEN_DRIBBLE.V.FSN#
     11131**DCL     11131--REDEF   11131--REDEF
OPEN_DRIBBLE.WSN_
     11097**DCL     11097--REDEF
OPEN_DRIBBLE_ME
     10980**DCL     13047<>CALL    13151<>CALL
OPEN_DRIBBLE_ME.ACSVEH_
     10982**DCL     10983--REDEF
OPEN_DRIBBLE_ME.ALTKEYS_
     10988**DCL     10989--REDEF   10989--REDEF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:479  
OPEN_DRIBBLE_ME.HDR_
     10987**DCL     10988--REDEF
OPEN_DRIBBLE_ME.TAB_
     10986**DCL     10987--REDEF
OPEN_DRIBBLE_ME.UHL_
     10980**DCL     10981--REDEF   10981--REDEF
OPEN_DRIBBLE_ME.V
     10989**DCL     10980--DCLINIT
OPEN_DRIBBLE_ME.V.FSN#
     11020**DCL     11020--REDEF   11020--REDEF
OPEN_DRIBBLE_ME.WSN_
     10986**DCL     10986--REDEF
OPEN_NODES
     10725**DCL     13060<>CALL    13152<>CALL
OPEN_NODES.ACSVEH_
     10727**DCL     10728--REDEF
OPEN_NODES.ALTKEYS_
     10733**DCL     10734--REDEF   10734--REDEF
OPEN_NODES.HDR_
     10732**DCL     10733--REDEF
OPEN_NODES.TAB_
     10731**DCL     10732--REDEF
OPEN_NODES.UHL_
     10725**DCL     10726--REDEF   10726--REDEF
OPEN_NODES.V
     10734**DCL     10725--DCLINIT
OPEN_NODES.V.FSN#
     10765**DCL     10765--REDEF   10765--REDEF
OPEN_NODES.WSN_
     10731**DCL     10731--REDEF
OPEN_NOTIFY
     11832**DCL     14073<>CALL
OPEN_NOTIFY.ACSVEH_
     11834**DCL     11835--REDEF
OPEN_NOTIFY.ALTKEYS_
     11840**DCL     11841--REDEF   11841--REDEF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:480  
OPEN_NOTIFY.HDR_
     11839**DCL     11840--REDEF
OPEN_NOTIFY.TAB_
     11838**DCL     11839--REDEF
OPEN_NOTIFY.UHL_
     11832**DCL     11833--REDEF   11833--REDEF
OPEN_NOTIFY.V
     11841**DCL     11832--DCLINIT
OPEN_NOTIFY.V.FSN#
     11872**DCL     11872--REDEF   11872--REDEF
OPEN_NOTIFY.WSN_
     11838**DCL     11838--REDEF
OPT$ IN PROCEDURE INITIALIZE_CONFIGURATION
     13374**DCL     13443<<ASSIGN  13444>>ASSIGN  13445>>DOCASE
OUT.CODE
      5572**DCL     13403>>DOCASE  13445>>DOCASE  14338>>DOCASE  14354>>DOCASE  14361>>IF      14364>>DOWHILE
     14377>>DOWHILE
OUT.NSUBLKS
      5576**DCL     13414>>IF      13432>>IF      13479>>DOINDEX 13914>>IF      13921>>ASSIGN  14342>>ASSIGN
     14358>>ASSIGN  14378>>ASSIGN
OUT.SUBLK$
      5597**DCL     13419>>ASSIGN  13420>>CALLBLT 13420>>CALLBLT 13422>>ASSIGN  13423>>CALLBLT 13423>>CALLBLT
     13437>>ASSIGN  13438>>CALLBLT 13438>>CALLBLT 13443>>ASSIGN  13444>>ASSIGN  13461>>CALLBLT 13461>>CALLBLT
     13464>>IF      13465>>IF      13465>>IF      13472>>ASSIGN  13480>>CALLBLT 13480>>CALLBLT 13900>>CALLBLT
     13900>>CALLBLT 13905>>ASSIGN  13907>>CALLBLT 13907>>CALLBLT 13909>>CALLBLT 13909>>CALLBLT 13911>>CALLBLT
     13911>>CALLBLT 13915>>CALLBLT 13915>>CALLBLT 13921>>ASSIGN  13922>>ASSIGN  13925>>CALLBLT 13925>>CALLBLT
     13928>>IF      13929>>IF      13929>>IF      13932>>CALLBLT 13932>>CALLBLT 13937>>ASSIGN  14340>>ASSIGN
     14342>>ASSIGN  14356>>ASSIGN  14358>>ASSIGN  14365>>ASSIGN  14378>>ASSIGN
OUT$
      9530**DCL      5564--IMP-PTR  9531--REDEF   13401<<ASSIGN  13403>>DOCASE  13414>>IF      13419>>ASSIGN
     13420>>CALLBLT 13420>>CALLBLT 13422>>ASSIGN  13423>>CALLBLT 13423>>CALLBLT 13432>>IF      13437>>ASSIGN
     13438>>CALLBLT 13438>>CALLBLT 13443>>ASSIGN  13479>>DOINDEX 13480>>CALLBLT 13480>>CALLBLT 13747<<ASSIGN
     13761>>ASSIGN  14334<<ASSIGN  14338>>DOCASE  14340<<ASSIGN  14340>>ASSIGN  14342<<ASSIGN  14342>>ASSIGN
     14342>>ASSIGN  14354>>DOCASE  14356<<ASSIGN  14356>>ASSIGN  14358<<ASSIGN  14358>>ASSIGN  14358>>ASSIGN
     14361>>IF      14363>>ASSIGN  14364>>DOWHILE 14365<<ASSIGN  14365>>ASSIGN  14373<<ASSIGN  14377>>DOWHILE
     14378<<ASSIGN  14378>>ASSIGN  14378>>ASSIGN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:481  
P$PCB.HI_CHAR
      6661**DCL     13456>>ASSIGN
P$PCB.TEXT$
      6511**DCL     13457>>CALLBLT
PARSEFLAG IN PROCEDURE PARSE_FROM
     14256**DCL     14277<<ASSIGN  14282>>IF      14295<<ASSIGN
PARSEWORK
     10139**DCL      5341--DCLINIT  5362--DCLINIT
PARSE_FROM
     14247**PROC    14182--CALL
PARSE_REPLYTO IN PROCEDURE PARSE_FROM
     14265**ENTRY   14200--CALL
PCT_INDEX IN PROCEDURE LOOKUP_ALIAS
     14688**DCL     14716<<CALLBLT 14717>>CALLBLT 14730>>CALLBLT 14730>>CALLBLT
POSITION_ALIAS
     10591**DCL     14794<>CALL    14812<>CALL    14899<>CALL    14909<>CALL    14941<>CALL
POSITION_ALIAS.KEY_
     10591**DCL     14791<<ASSIGN  14896<<ASSIGN  14906<<ASSIGN  14937<<ASSIGN
POSITION_ALIAS.V
     10593**DCL     10591--DCLINIT
POSITION_ALIAS.V.KEYR#
     10594**DCL     14790<<ASSIGN  14895<<ASSIGN  14936<<ASSIGN
POSITION_ALIAS.V.KEYS#
     10594**DCL     14789<<ASSIGN  14798<<ASSIGN  14894<<ASSIGN  14935<<ASSIGN
POSITION_ALIAS.V.N#
     10597**DCL     14797<<ASSIGN  14893<<ASSIGN  14934<<ASSIGN  14955<<ASSIGN
POSITION_NODES
     10861**DCL     14519<>CALL    14734<>CALL
POSITION_NODES.V
     10863**DCL     10861--DCLINIT
PREV_CMDCODE IN PROCEDURE GET_MESSAGE_DATA
     13689**DCL     13706<<ASSIGN  13715>>IF      13719>>ASSIGN  13741<<ASSIGN  13883<<ASSIGN
PROMPT
      9539**DCL     12498--DCLINIT
PROMPTSTRING
      9540**DCL      6376--DCLINIT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:482  
PUNT_REPLYTO IN PROCEDURE PARSE_FROM
     14384**LABEL   14370--GOTO
PURGE_UC_INPUT
     10416**DCL     13179<>CALL    13336<>CALL
PURGE_UC_INPUT.V
     10423**DCL     10418--DCLINIT
PURGE_UC_INPUT.V.CTLFLG.RSTBRK#
     10424**DCL     10425--REDEF
QTEXT IN PROCEDURE CHECKADDR
     14481**DCL     14478--PROC    14503>>ASSIGN  14510<<ASSIGN
QTEXT.LEN IN PROCEDURE CHECKADDR
     14482**DCL     14491>>CALLBLT 14493>>CALLBLT 14498>>CALLBLT 14517>>CALLBLT 14522>>CALLBLT 14554>>CALLBLT
     14556<<ASSIGN  14556>>ASSIGN
QTEXT.TXT IN PROCEDURE CHECKADDR
     14483**DCL     14491>>CALLBLT 14493>>CALLBLT 14498>>CALLBLT 14517>>CALLBLT 14522>>CALLBLT 14524<<ASSIGN
     14554<<CALLBLT
QTEXT IN PROCEDURE DEL_TABS
     14218**DCL     14215--PROC
QTEXT.LEN IN PROCEDURE DEL_TABS
     14219**DCL     14226>>DOWHILE 14233>>DOWHILE
QTEXT.TXT IN PROCEDURE DEL_TABS
     14220**DCL     14225>>CALLBLT 14227<<ASSIGN  14228>>CALLBLT 14232>>CALLBLT 14235<<ASSIGN  14237>>CALLBLT
     14240<<ASSIGN
QTEXT IN PROCEDURE LEGALIZE
     14397**DCL     14394--PROC
QTEXT.LEN IN PROCEDURE LEGALIZE
     14398**DCL     14404>>DOWHILE 14410>>CALLBLT 14414>>CALLBLT 14422>>DOWHILE 14424>>CALLBLT 14469<<ASSIGN
     14470>>ASSIGN
QTEXT.TXT IN PROCEDURE LEGALIZE
     14399**DCL     14403>>CALLBLT 14405<<ASSIGN  14406>>CALLBLT 14410>>CALLBLT 14414>>CALLBLT 14424>>CALLBLT
     14429>>CALLBLT 14433>>CALLBLT 14436>>CALLBLT 14444>>CALLBLT 14451>>CALLBLT 14456>>CALLBLT 14470<<ASSIGN
QTEXT IN PROCEDURE TRIMTEXT
     14574**DCL     14583<<ASSIGN  14605<<ASSIGN  14612<<ASSIGN  14620<<ASSIGN  14628<<ASSIGN
QTEXT.LEN IN PROCEDURE TRIMTEXT
     14575**DCL     14586>>IF      14597>>ASSIGN  14607>>ASSIGN  14615>>ASSIGN  14623>>ASSIGN
QTEXT.TXT IN PROCEDURE TRIMTEXT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:483  
     14576**DCL     14586>>IF      14593>>DOWHILE 14598>>DOWHILE 14603>>CALLBLT 14608>>IF      14608>>IF
     14610>>CALLBLT 14616>>IF      14616>>IF      14618>>CALLBLT 14624>>IF      14624>>IF      14626>>CALLBLT
R220$
      9581**DCL     13196>>ASSIGN  13325>>ASSIGN
R221$
      9599**DCL     13201>>DOWHILE 13297>>ASSIGN  13329>>IF      13333>>IF
R250$
      9617**DCL     13222>>ASSIGN  13731>>ASSIGN
R250A$
      9653**DCL     13540>>ASSIGN
R250OOPS$
      9635**DCL     14001>>ASSIGN
R250V$
      9671**DCL     14832>>ASSIGN  14848>>ASSIGN
R354$
      9689**DCL     13270>>ASSIGN  13730>>IF      13827>>IF
R421$
      9707**DCL     13189>>ASSIGN  13201>>DOWHILE 13333>>IF
R421DL$
      9761**DCL     13860>>ASSIGN
R421TO$
      9725**DCL     13856>>ASSIGN
R421ZAP$
      9743**DCL     13201>>DOWHILE 13333>>IF      13502>>ASSIGN
R451$
      9779**DCL     13673>>ASSIGN  13841>>ASSIGN  14024>>ASSIGN
R500$
      9797**DCL     13309>>ASSIGN  13508>>ASSIGN
R501$
      9815**DCL     13510>>ASSIGN
R502$
      9833**DCL     13291>>ASSIGN  13299>>ASSIGN
R503$
      9851**DCL     13248>>ASSIGN  13259>>ASSIGN  13278>>ASSIGN
R550$
      9869**DCL     13288>>ASSIGN  13590>>ASSIGN  14703>>ASSIGN  14780>>IF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:484  
R550NODOMAIN$
      9905**DCL     14721>>ASSIGN
R550NONODE$
      9887**DCL     14727>>ASSIGN
R550NOSITE$
      9923**DCL     14736>>ASSIGN
R552$
      9959**DCL     13575>>ASSIGN  15036>>ASSIGN  15125>>ASSIGN
R553$
      9977**DCL     14806>>ASSIGN
R998$
      9995**DCL     13182>>ASSIGN  13316>>ASSIGN
R999$
     10013**DCL     13185>>ASSIGN  13320>>ASSIGN
RCPT
     10055**DCL     13581<>CALL    13593>>ASSIGN  13596<>CALL    13599>>ASSIGN  13609--CALL    13614>>ASSIGN
RCPT.LEN
     10056**DCL     13582>>IF      13583>>ASSIGN  13584<<ASSIGN  13584>>ASSIGN  14047>>CALLBLT 14105>>CALLBLT
RCPT.TXT
     10057**DCL     13582>>IF      13583<<ASSIGN  13586>>IF      13588>>CALLBLT 13594<<CALLBLT 13597>>IF
     13602<<CALLBLT 14047>>CALLBLT 14105>>CALLBLT
RCVDBUF IN PROCEDURE GET_MESSAGE_DATA
     13687**DCL     13773<<ASSIGN  13778<<CALLBLT 13788<<CALLBLT 13802>>CALLBLT 13804<<CALLBLT 13808<>CALL
RCVDLEN IN PROCEDURE GET_MESSAGE_DATA
     13686**DCL     13774<<ASSIGN  13777<<ASSIGN  13778>>CALLBLT 13788>>CALLBLT 13790<<ASSIGN  13790>>ASSIGN
     13802>>CALLBLT 13808<>CALL
RCVD_AGAIN IN PROCEDURE GET_MESSAGE_DATA
     13784**LABEL   13791--GOTO
READ_COMMAND
     13493**PROC    13221--CALL
READ_ERROR IN PROCEDURE READ_TRANSPARENT
     15010**LABEL   14975--CALLALT 14978--CALLALT
READ_NODES
     10827**DCL     13064<>CALL    13156<>CALL
READ_NODES.STATION_
     10830**DCL     10831--REDEF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:485  
READ_NODES.V
     10831**DCL     10827--DCLINIT
READ_NODES.V.DVBYTE.REREAD#
     10842**DCL     10842--REDEF
READ_NODES.V.INDX#
     10840**DCL     10840--REDEF
READ_TRANSPARENT
     14970**PROC    13496--CALL    13711--CALL    13784--CALL
READ_UC
     10347**DCL     14978<>CALL
READ_UC.STATION_
     10350**DCL     10351--REDEF
READ_UC.V
     10351**DCL     10347--DCLINIT
READ_UC.V.DVBYTE.REREAD#
     10362**DCL     10362--REDEF
READ_UC.V.DVBYTE.TRANS#
     10363**DCL     13031<<ASSIGN
READ_UC.V.INDX#
     10360**DCL     10360--REDEF
REOPEN_DATA
     11466**DCL     13958<>CALL    13990<>CALL    14035<>CALL
REOPEN_DATA.ACSVEH_
     11468**DCL     11469--REDEF
REOPEN_DATA.ALTKEYS_
     11474**DCL     11475--REDEF   11475--REDEF
REOPEN_DATA.HDR_
     11473**DCL     11474--REDEF
REOPEN_DATA.NAME_
     11467**DCL     13647<<ASSIGN
REOPEN_DATA.TAB_
     11472**DCL     11473--REDEF
REOPEN_DATA.UHL_
     11466**DCL     11467--REDEF   11467--REDEF
REOPEN_DATA.V
     11475**DCL     11466--DCLINIT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:486  
REOPEN_DATA.V.FSN#
     11506**DCL     11506--REDEF   11506--REDEF
REOPEN_DATA.WSN_
     11472**DCL     11472--REDEF
REPL
     10065**DCL     13759<>CALL    14199<>CALL
REPL.LEN
     10066**DCL     13693<<ASSIGN  14189>>IF      14191<<ASSIGN  14195<<ASSIGN  14268>>ASSIGN
REPL.TXT
     10067**DCL     14192<<ASSIGN  14196<<ASSIGN  14269<>CALL
REPLY$
     10020**DCL     13182<<ASSIGN  13185<<ASSIGN  13189<<ASSIGN  13196<<ASSIGN  13201>>DOWHILE 13201>>DOWHILE
     13201>>DOWHILE 13222<<ASSIGN  13248<<ASSIGN  13259<<ASSIGN  13270<<ASSIGN  13278<<ASSIGN  13288<<ASSIGN
     13291<<ASSIGN  13297<<ASSIGN  13299<<ASSIGN  13309<<ASSIGN  13316<<ASSIGN  13320<<ASSIGN  13325<<ASSIGN
     13329>>IF      13330<<ASSIGN  13333>>IF      13333>>IF      13333>>IF      13340>>IF      13502<<ASSIGN
     13508<<ASSIGN  13510<<ASSIGN  13520>>CALL    13520>>CALL    13522>>ASSIGN  13522>>ASSIGN  13526>>ASSIGN
     13526>>ASSIGN  13540<<ASSIGN  13575<<ASSIGN  13590<<ASSIGN  13673<<ASSIGN  13730>>IF      13731<<ASSIGN
     13827>>IF      13841<<ASSIGN  13856<<ASSIGN  13860<<ASSIGN  14001<<ASSIGN  14024<<ASSIGN  14703<<ASSIGN
     14721<<ASSIGN  14727<<ASSIGN  14736<<ASSIGN  14780>>IF      14806<<ASSIGN  14832<<ASSIGN  14848<<ASSIGN
     14939<<ASSIGN  14965<<ASSIGN  15036<<ASSIGN  15125<<ASSIGN
REPLY220
      9582**DCL      9581--DCLINIT
REPLY220.COUNT
      9583**DCL     13073<<ASSIGN
REPLY220.TEXT
      9584**DCL     13072>>CALLBLT 13078<<CALLBLT 13166<<ASSIGN  13167<<ASSIGN  13170>>CALLBLT 13171<<CALLBLT
     13174<<ASSIGN
REPLY221
      9600**DCL      9599--DCLINIT
REPLY221.TEXT
      9602**DCL     13079<<CALLBLT
REPLY250
      9618**DCL      9617--DCLINIT
REPLY250A
      9654**DCL      9653--DCLINIT
REPLY250A.TEXT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:487  
      9656**DCL     13080<<CALLBLT
REPLY250OOPS
      9636**DCL      9635--DCLINIT
REPLY250V
      9672**DCL      9671--DCLINIT
REPLY250V.COUNT
      9673**DCL     14831<<ASSIGN  14847<<ASSIGN
REPLY250V.TEXT
      9674**DCL     14826<<CALLBLT 14830>>CALLBLT 14840<<CALLBLT 14842>>CALLBLT 14843<<CALLBLT 14844<<CALLBLT
     14846>>CALLBLT
REPLY354
      9690**DCL      9689--DCLINIT
REPLY421
      9708**DCL      9707--DCLINIT 10020--DCLINIT
REPLY421.TEXT
      9710**DCL     13081<<CALLBLT
REPLY421DL
      9762**DCL      9761--DCLINIT
REPLY421TO
      9726**DCL      9725--DCLINIT
REPLY421ZAP
      9744**DCL      9743--DCLINIT
REPLY421ZAP.TEXT
      9746**DCL     13082<<CALLBLT
REPLY451
      9780**DCL      9779--DCLINIT
REPLY500
      9798**DCL      9797--DCLINIT
REPLY501
      9816**DCL      9815--DCLINIT
REPLY502
      9834**DCL      9833--DCLINIT
REPLY503
      9852**DCL      9851--DCLINIT
REPLY550
      9870**DCL      9869--DCLINIT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:488  
REPLY550NODOMAIN
      9906**DCL      9905--DCLINIT
REPLY550NONODE
      9888**DCL      9887--DCLINIT
REPLY550NOSITE
      9924**DCL      9923--DCLINIT
REPLY551
      9942**DCL      9941--DCLINIT
REPLY552
      9960**DCL      9959--DCLINIT
REPLY553
      9978**DCL      9977--DCLINIT
REPLY998
      9996**DCL      9995--DCLINIT
REPLY998.TEXT
      9998**DCL     13017<<CALLBLT
REPLY999
     10014**DCL     10013--DCLINIT
REREAD
     13123**LABEL   13134--GOTO    13141--GOTO    13357--GOTO
REREAD_DATA
     11637**DCL     13992<>CALL
REREAD_DATA.STATION_
     11640**DCL     11641--REDEF
REREAD_DATA.V
     11641**DCL     11637--DCLINIT
REREAD_DATA.V.DVBYTE.REREAD#
     11652**DCL     11652--REDEF
REREAD_DATA.V.INDX#
     11650**DCL     11650--REDEF
REWIND_ALIAS
     10612**DCL     14933<>CALL
REWIND_ALIAS.V
     10612**DCL     10612--DCLINIT
REWRITE.NEW.LEN
     10134**DCL     13419<<ASSIGN  14547>>ASSIGN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:489  
REWRITE.NEW.TXT
     10135**DCL     13420<<CALLBLT 14548>>ASSIGN
REWRITE.OLD.LEN
     10131**DCL     13422<<ASSIGN  13437<<ASSIGN  14544>>ASSIGN  14666>>ASSIGN
REWRITE.OLD.TXT
     10132**DCL     13423<<CALLBLT 13438<<CALLBLT 14545>>IF      14667>>IF
REWRITE.TYP
     10128**DCL     13425<<ASSIGN  13440<<ASSIGN  14543>>IF      14665>>IF
REWRITES
     10126**DCL     13378<<ASSIGN  13407>>IF      13418>>ASSIGN  13426<<ASSIGN  13426>>ASSIGN  13428>>IF
     13436>>ASSIGN  13441<<ASSIGN  13441>>ASSIGN  14539>>IF      14542>>DOINDEX 14661>>IF      14664>>DOINDEX
RMID
     10075**DCL     13755<>CALL    13967<>CALL
RMID.LEN
     10076**DCL     13695<<ASSIGN
RTEXT
     10110**DCL     14369<<ASSIGN  14384<>CALL    14385<>CALL
RTEXT.LEN
     10111**DCL     13702<<ASSIGN  14204>>CALLBLT 14205>>ASSIGN  14382<<ASSIGN
RTEXT.TXT
     10112**DCL     14204>>CALLBLT 14380<<CALLBLT
SAVE_HOST_NAME
     13533**PROC    13225--CALL
SAVE_REVERSE_PATH
     13560**PROC    13237--CALL
SAVE_USER_NAME
     13569**PROC    13252--CALL
SCAN IN PROCEDURE INITIALIZE_CONFIGURATION
     13382**LABEL   13392--EXIT    13398--EXIT
SCRATCH IN PROCEDURE SPILL_ALIASES
     14926**DCL     14939--ASSIGN
SCRATCH.LEN IN PROCEDURE SPILL_ALIASES
     14927**DCL     14960<<ASSIGN
SCRATCH.TXT IN PROCEDURE SPILL_ALIASES
     14928**DCL     14938<<CALLBLT 14948<<CALLBLT 14958<<CALLBLT
SCREECH1
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:490  
     12219**DCL     13364<>CALL
SCRUNCH IN PROCEDURE MOVE_STRING
     15033**DCL     15052<<ASSIGN  15057<<ASSIGN  15105>>IF
SEND
     12096**DCL     11991--DCLINIT 13973--ASSIGN
SEND_CMD
     12069**DCL     12039--DCLINIT 13974--ASSIGN
SEND_CMD.NAME#
     12069**DCL     13645<<CALLBLT
SEND_MAIL
     12038**DCL     13981<>CALL
SEND_MAIL.CMD_
     12039**DCL     13974<<ASSIGN
SEND_MAIL.NAME_
     12038**DCL     13973<<ASSIGN
SEND_MAIL.V
     12040**DCL     12040--DCLINIT
SEND_MAIL_MESSAGE
     13952**PROC    13273--CALL
SEND_NOTEFILE IN PROCEDURE NOTEFILE_STUFF
     14083**ENTRY   14056--CALL    14121--CALL
SEND_NOTIFY
     11991**DCL     14086<>CALL
SEND_NOTIFY.V
     11993**DCL     11993--DCLINIT
SETUP_REPLY_250V IN PROCEDURE LOOKUP_ALIAS
     14838**PROC    14740--CALL    14747--CALL    14758--CALL
SET_BREAK_CONTROL
     12406**DCL     13030<>CALL
SET_BREAK_CONTROL.V
     12406**DCL     12406--DCLINIT
SET_DATESTAMP IN PROCEDURE GET_MESSAGE_DATA
     13888**PROC    13762--CALL    13813--CALL
SET_EOM_LF
     12522**DCL     13214<>CALL
SET_EOM_LF.V
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:491  
     12530**DCL     12524--DCLINIT
SET_EOM_LF.V.TIMEOUT#
     12531**DCL     13207<<ASSIGN  13211<<ASSIGN
SET_EOM_LF.V.UTYPE#
     12531**DCL     13208<<ASSIGN  13212<<ASSIGN
SET_TRANS_EOM
     12591**DCL     13217<>CALL
SET_TRANS_EOM.V
     12599**DCL     12593--DCLINIT
SIZE IN PROCEDURE LOOKUP_REGISTRATION
     14857**DCL     14883<<DOINDEX 14884>>CALLBLT
SOURCE IN PROCEDURE TRIMTEXT
     14564**DCL     14561--PROC    14583>>ASSIGN  14584>>ASSIGN
SPILL_ALIASES
     14919**PROC    13306--CALL
START IN PROCEDURE MOVE_PATH
     15121**DCL     15129<<ASSIGN  15130>>CALLBLT 15132>>ASSIGN  15133>>ASSIGN  15136<<ASSIGN  15136>>ASSIGN
     15137>>DOWHILE 15138<<ASSIGN  15138>>ASSIGN  15140>>CALLBLT 15142>>ASSIGN  15143>>ASSIGN
START IN PROCEDURE MOVE_STRING
     15031**DCL     15051<<ASSIGN  15055<<ASSIGN  15059>>CALLBLT 15061>>ASSIGN  15062>>ASSIGN  15065<<ASSIGN
     15065>>ASSIGN  15066>>ASSIGN  15068>>CALLBLT 15070>>ASSIGN  15071>>ASSIGN  15076<<ASSIGN  15078>>ASSIGN
     15079>>ASSIGN  15087<<ASSIGN  15087>>ASSIGN  15088<<CALLBLT 15088>>CALLBLT 15089>>IF      15090<<ASSIGN
     15090>>ASSIGN  15091>>DOWHILE 15091>>DOWHILE 15092<<ASSIGN  15092>>ASSIGN  15095>>CALLBLT 15097>>ASSIGN
     15098>>ASSIGN
STATUS
     10157**DCL     13058<<CALLBLT 13099<<CALLBLT 13102<<CALLBLT 13112<<CALLBLT 13128<<CALLBLT 13138<<CALLBLT
     15157>>ASSIGN  15158--ASSIGN  15161<<CALLBLT 15168<<CALLBLT
STATUS_LINE
     10146**DCL     10157--REDEF
STATUS_LINE.CMD
     10152**DCL     13228<<ASSIGN  13238<<ASSIGN  13274<<ASSIGN  13280<<ASSIGN  13300<<ASSIGN  13624<<ASSIGN
STATUS_LINE.FROM_ADDR
     10156**DCL     13229<<ASSIGN  13243<<ASSIGN  13284<<ASSIGN  13304<<ASSIGN  13627<<ASSIGN
STATUS_LINE.LINES
     10150**DCL     13241<<ASSIGN  13265<<ASSIGN  13282<<ASSIGN  13302<<ASSIGN  13626<<ASSIGN  13836<<CALLBLT
STATUS_LINE.MSGS
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:492  
     10148**DCL     13239<<CALLBLT
STATUS_LINE.RCPT_ADDR
     10154**DCL     13242<<ASSIGN  13253<<ASSIGN  13283<<ASSIGN  13303<<ASSIGN  13628<<ASSIGN
STATUS_LINE.STATUS
     10149**DCL     13240<<ASSIGN  13264<<ASSIGN  13281<<ASSIGN  13301<<ASSIGN  13625<<ASSIGN
STATUS_LINE_IDLE IN PROCEDURE STATUS_LINE_UPDATE
     15164**ENTRY   13120--CALL    13146--CALL    13345--CALL
STATUS_LINE_UPDATE
     15150**PROC    13059--CALL    13104--CALL    13113--CALL    13129--CALL    13139--CALL    13230--CALL
     13244--CALL    13255--CALL    13266--CALL    13275--CALL    13285--CALL    13305--CALL    13629--CALL
     13837--CALL
STD_HEADER IN PROCEDURE GET_MESSAGE_DATA
     13825**LABEL   13723--GOTO    13742--CALLALT 13762--CALLALT
SUA1
     12260**DCL     12219--DCLINIT
SUA2
     12331**DCL     12233--DCLINIT
SUB$ IN PROCEDURE INITIALIZE_CONFIGURATION
     13375**DCL     13444<<ASSIGN  13447>>ASSIGN  13447>>ASSIGN  13449>>ASSIGN  13449>>ASSIGN  13451>>ASSIGN
     13451>>ASSIGN  13453>>ASSIGN  13453>>ASSIGN  13455>>ASSIGN  13459>>DOCASE  13461>>CALLBLT 13461>>CALLBLT
     13464>>IF      13465>>IF      13465>>IF      13468>>CALLBLT 13468>>CALLBLT 13472>>ASSIGN
SUBJ
     10070**DCL     13751<>CALL    13963<>CALL
SUBJ.LEN
     10071**DCL     13694<<ASSIGN  13765>>CALLBLT 13767<<ASSIGN  13767>>ASSIGN  13959>>IF      13961<<ASSIGN
SUBJ.TXT
     10072**DCL     13765<<CALLBLT 13960<<ASSIGN
SUPPRESS_HEADERS
     10028**DCL     13236<<ASSIGN  14744<<ASSIGN  14820<<ASSIGN  14903<<ASSIGN
SYM.CODE
      5616**DCL     13459>>DOCASE  13472>>ASSIGN  13905>>ASSIGN  13923>>DOCASE  13937>>ASSIGN
SYM.COUNT
      5633**DCL      5636--IMP-SIZ 13419>>ASSIGN  13420>>CALLBLT 13422>>ASSIGN  13423>>CALLBLT 13437>>ASSIGN
     13438>>CALLBLT 13447>>ASSIGN  13449>>ASSIGN  13451>>ASSIGN  13453>>ASSIGN  13461>>CALLBLT 13464>>IF
     13465>>IF      13468>>CALLBLT 13480>>CALLBLT 13622>>ASSIGN  13623>>CALLBLT 13623>>CALLBLT 13765>>CALLBLT
     13767>>ASSIGN  13900>>CALLBLT 13907>>CALLBLT 13909>>CALLBLT 13911>>CALLBLT 13915>>CALLBLT 13925>>CALLBLT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:493  
     13928>>IF      13929>>IF      13932>>CALLBLT 14283>>CALLBLT 14285>>CALLBLT 14289>>CALLBLT 14289>>CALLBLT
     14290>>ASSIGN  14301>>CALLBLT 14301>>CALLBLT 14302>>ASSIGN  14327>>ASSIGN  14328>>CALLBLT 14330>>CALL
     14345>>CALLBLT 14345>>CALLBLT 14346>>ASSIGN  14367>>IF      14380>>CALLBLT 14380>>CALLBLT 14382>>ASSIGN
SYM.CPOS
      5625**DCL     13455>>ASSIGN  13536>>ASSIGN  13537>>CALLBLT 13563>>ASSIGN  13564>>CALLBLT 13579>>ASSIGN
     13580>>CALLBLT 13717<<CALLBLT 13718<<ASSIGN  13718>>ASSIGN  13877>>ASSIGN  13879>>CALLBLT 14288>>ASSIGN
     14289>>CALLBLT 14290>>ASSIGN  14300>>ASSIGN  14301>>CALLBLT 14302>>ASSIGN  14372>>ASSIGN  14376>>ASSIGN
     14380>>CALLBLT 14380>>CALLBLT 14382>>ASSIGN
SYM.TEXT
      5636**DCL     13420>>CALLBLT 13423>>CALLBLT 13438>>CALLBLT 13447>>ASSIGN  13449>>ASSIGN  13451>>ASSIGN
     13453>>ASSIGN  13461>>CALLBLT 13465>>IF      13468>>CALLBLT 13480>>CALLBLT 13623>>CALLBLT 13765>>CALLBLT
     13900>>CALLBLT 13907>>CALLBLT 13909>>CALLBLT 13911>>CALLBLT 13915>>CALLBLT 13925>>CALLBLT 13929>>IF
     13932>>CALLBLT 14283>>CALLBLT 14285>>CALLBLT 14289>>CALLBLT 14301>>CALLBLT 14328>>CALLBLT 14330<>CALL
     14345>>CALLBLT
SYM$
      9531**DCL      5610--IMP-PTR 13535<<ASSIGN  13536>>ASSIGN  13537>>CALLBLT 13562<<ASSIGN  13563>>ASSIGN
     13564>>CALLBLT 13578<<ASSIGN  13579>>ASSIGN  13580>>CALLBLT 13621<<ASSIGN  13622>>ASSIGN  13623>>CALLBLT
     13623>>CALLBLT 13623>>CALLBLT 13717>>CALLBLT 13718>>ASSIGN  13718>>ASSIGN  13765>>CALLBLT 13765>>CALLBLT
     13767>>ASSIGN  13877>>ASSIGN  13879>>CALLBLT 14281<<ASSIGN  14283>>CALLBLT 14283>>CALLBLT 14285>>CALLBLT
     14285>>CALLBLT 14288>>ASSIGN  14289>>CALLBLT 14289>>CALLBLT 14289>>CALLBLT 14289>>CALLBLT 14290>>ASSIGN
     14290>>ASSIGN  14300>>ASSIGN  14301>>CALLBLT 14301>>CALLBLT 14301>>CALLBLT 14301>>CALLBLT 14302>>ASSIGN
     14302>>ASSIGN  14326<<ASSIGN  14327>>ASSIGN  14328>>CALLBLT 14328>>CALLBLT 14330>>CALL    14330>>CALL
     14345>>CALLBLT 14345>>CALLBLT 14345>>CALLBLT 14346>>ASSIGN  14367>>IF      14372>>ASSIGN  14376>>ASSIGN
     14380>>CALLBLT 14380>>CALLBLT 14380>>CALLBLT 14380>>CALLBLT 14382>>ASSIGN  14382>>ASSIGN
SYNC_PHASE
     10029**DCL     13198<<ASSIGN  13314>>IF      13315>>IF      13326<<ASSIGN  13326>>ASSIGN
TARGET IN PROCEDURE TRIMTEXT
     14569**DCL     14561--PROC    14584<<ASSIGN  14605>>ASSIGN  14612>>ASSIGN  14620>>ASSIGN  14628>>ASSIGN
TARGET.LEN IN PROCEDURE TRIMTEXT
     14570**DCL     14587<<ASSIGN  14604<<ASSIGN  14611<<ASSIGN  14619<<ASSIGN  14627<<ASSIGN
TARGET.TXT IN PROCEDURE TRIMTEXT
     14571**DCL     14588<<ASSIGN  14603<<CALLBLT 14610<<CALLBLT 14618<<CALLBLT 14626<<CALLBLT
TBUF IN PROCEDURE CHECKADDR
     14489**DCL     14540<<CALLBLT 14545>>IF
TBUF IN PROCEDURE FIXLOCAL
     14649**DCL     14662<<CALLBLT 14667>>IF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:494  
TCM$ABORT
      9486**DCL-ENT 12406--DCLINIT
TCM$LTCP_READ
      9494**DCL-ENT 14975--CALL
TCM$LTCP_WRITE
      9495**DCL-ENT 13520--CALL
TCM$WRITE_AUDIT_LOG
      9487**DCL-ENT 13195--CALL    13227--CALL    13352--CALL    13999--CALL
TCM$WRITE_AUDIT_ON
      9488**DCL-ENT 13019--CALL
TCM_ACCOUNT.ACCT#
     11246**DCL     13028>>IF      13215>>IF      13358>>IF      13449<<ASSIGN
TCM_ADDR_ROOT
      9517**DCL     14330<>CALL
TCM_CMD_LCN
      8138**DCL     13110<>CALL    13114<>CALL    13121>>ASSIGN  13123<<ASSIGN  13125<>CALL    13130<>CALL
     13132>>IF      13140<>CALL    13144<<ASSIGN  13346<>CALL    13347<>CALL
TCM_CONFIG_CMD
      9541**DCL      6168--DCLINIT
TCM_DRIBBLE
      9533**DCL     13043>>IF      13147>>IF      13525>>IF      14011>>IF      14704>>IF      14981>>IF
TCM_DRIBBLE_ME
      9534**DCL     13046>>IF      13150>>IF      13525>>IF      14011>>IF      14704>>IF      14981>>IF
TCM_ILLEGAL_FROM
     10245**DCL     14410>>CALLBLT
TCM_ILLEGAL_REPLYTO
     10248**DCL     14414>>CALLBLT
TCM_KEYIN
     12467**DCL     13552<>CALL
TCM_KEYIN.MESS_
     12467**DCL     13551<<ASSIGN
TCM_KEYIN.V
     12470**DCL     12467--DCLINIT
TCM_MESSACCT
     11259**DCL     11096--DCLINIT 11334--DCLINIT 11471--DCLINIT 12123--DCLINIT
TCM_MESSACCT.ACCT#
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:495  
     11259**DCL     13041<<ASSIGN  13451<<ASSIGN
TCM_PCB
      5332**DCL      5676--DCLINIT
TCM_PCB.HI_CHAR
      5483**DCL     13507>>IF
TCM_PROGNAME
      9536**DCL     13016<<ASSIGN  13017>>CALLBLT 13058>>CALLBLT 13099>>CALLBLT 13102>>CALLBLT 13112>>CALLBLT
     13128>>CALLBLT 13138>>CALLBLT 15161>>CALLBLT 15168>>CALLBLT
TCM_SITENAME
     10035**DCL     13076>>ASSIGN  13447<<ASSIGN
TCM_SKIP_BLANKS
     10242**DCL     13717>>CALLBLT 14830>>CALLBLT 14842>>CALLBLT 14846>>CALLBLT 15194>>CALLBLT
TCM_SMTP_ROOT
      9514**DCL     13497<>CALL
TCM_SOCKINIT
      9323**DCL     13086<>CALL
TCM_STUCKEE
      9537**DCL     13453<<ASSIGN  14002>>IF      14037>>CALLBLT 14099>>CALLBLT
TCM_TCPFLAVOR
     10034**DCL     13015<<ASSIGN  13020>>IF      13029>>IF      13042>>IF      13071>>IF      13087>>IF
     13168>>IF      13191>>IF      13205>>IF      13268>>IF      13318>>IF      13322>>IF      13332>>IF
     13344>>IF      13356>>IF      13519>>IF      13549>>IF      14096>>IF      14974>>IF      15010>>IF
TCM_TEXT_ROOT
      9516**DCL     14262<>CALL    14269<>CALL
TCM_TSTAMP_ROOT
      9518**DCL     13808<>CALL
TCM_TZTEXT
      9542**DCL     13457<<CALLBLT 13664>>CALLBLT
TCM_USER_ROOT
      9515**DCL     13742<>CALL
TCM_UTOFFSET
      9543**DCL     13462<<ASSIGN  13466<<ASSIGN  13466>>ASSIGN  13470<<ASSIGN  13472<<ASSIGN  13940<>CALL
TCM_XLATE_TO_UC
     10201**DCL     13420>>CALLBLT 13423>>CALLBLT 13438>>CALLBLT 14517>>CALLBLT 14540>>CALLBLT 14662>>CALLBLT
     14730>>CALLBLT 14787>>CALLBLT 14884>>CALLBLT
TCM_YC_OFF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:496  
     12451**DCL     13359<>CALL
TCM_YC_OFF.V
     12452**DCL     12451--DCLINIT
TCP$ADMIN.GHST_LCN
      8145**DCL      8145--REDEF
TCP$ADMIN.NEWLCN
      8145**DCL     13144>>ASSIGN
TCP$ADMIN.USER_LCN
      8144**DCL      8145--REDEF
TCP$CLOSE
      9500**DCL-ENT 13346--CALL
TCP$OPEN
      9496**DCL-ENT 13110--CALL
TCP$READ
      9498**DCL-ENT 13125--CALL
TCP$RELEASE
      9501**DCL-ENT 13114--CALL    13130--CALL    13140--CALL    13347--CALL
TCP$USER_TIMEOUT
      9503**DCL-ENT 13119--CALL
TCP_MON_ERR
      8026**DCL     14111>>IF      14112>>ASSIGN
TELLUSER IN PROCEDURE INITIALIZE_CONFIGURATION
     13410**LABEL   13416--GOTO    13430--GOTO    13434--GOTO
TELL_OPERATOR
     13545**PROC    13296--CALL    13539--CALL
TEMP IN PROCEDURE CHECKADDR
     14485**DCL     14491<<CALLBLT 14493<<CALLBLT 14495<<ASSIGN  14502>>IF      14507<<CALLBLT 14515>>IF
     14517>>CALLBLT 14517>>CALLBLT 14522<<CALLBLT 14524>>ASSIGN
TEMP IN PROCEDURE FIXLOCAL
     14644**DCL     14652<<CALLBLT 14656>>CALLBLT 14660>>ASSIGN  14662>>CALLBLT 14671>>ASSIGN
TEMP IN PROCEDURE GET_MESSAGE_DATA
     13684**DCL     13717<<CALLBLT 13775<<CALLBLT 13777>>ASSIGN  13778>>CALLBLT 13802<<CALLBLT 13804>>CALLBLT
     13835<<ASSIGN  13836>>CALLBLT 13895<<ASSIGN  13896>>ASSIGN  13897>>ASSIGN  13900<<CALLBLT 13901>>IF
     13902<<ASSIGN  13902>>ASSIGN  13903>>CALLBLT 13905<<ASSIGN  13906>>CALLBLT 13907<<CALLBLT 13908>>CALLBLT
     13909<<CALLBLT 13910>>CALLBLT 13911<<CALLBLT 13912>>CALLBLT 13915<<CALLBLT 13916>>CALLBLT 13925<<CALLBLT
     13926>>ASSIGN  13926>>ASSIGN  13932<<CALLBLT 13935>>ASSIGN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:497  
TEMP IN PROCEDURE NOTEFILE_STUFF
     14066**DCL     14078<>CALL    14079>>ASSIGN
TEMP IN PROCEDURE PARSE_FROM
     14249**DCL     14261<<ASSIGN  14262<>CALL    14268<<ASSIGN  14269<>CALL    14283<<CALLBLT 14285<<CALLBLT
     14327<<ASSIGN  14328>>CALLBLT 14329>>ASSIGN  14330<>CALL    14372<<ASSIGN  14376<<ASSIGN  14380>>CALLBLT
     14380>>CALLBLT 14380>>CALLBLT 14382>>ASSIGN  14410<<CALLBLT 14414<<CALLBLT 14424<<CALLBLT 14429>>CALLBLT
     14433>>CALLBLT 14443<<ASSIGN  14443>>ASSIGN  14444>>CALLBLT 14444>>CALLBLT 14445>>ASSIGN  14451>>CALLBLT
     14451>>CALLBLT 14452>>ASSIGN  14456>>CALLBLT 14456>>CALLBLT 14457>>ASSIGN  14458>>ASSIGN
TEMP IN PROCEDURE SAVE_USER_NAME
     13571**DCL     13600<<CALLBLT 13602>>CALLBLT 13602>>CALLBLT 13602>>CALLBLT
TEMPBUF IN PROCEDURE LOOKUP_ALIAS
     14690**DCL     14691--REDEF
TEMPBUF IN PROCEDURE LOOKUP_REGISTRATION
     14858**DCL     14859--REDEF   14884<<CALLBLT 14889>>IF      14889>>IF      14898>>ASSIGN  14908>>ASSIGN
TEXT IN PROCEDURE FIXLOCAL
     14640**DCL     14637--PROC
TEXT.LEN IN PROCEDURE FIXLOCAL
     14641**DCL     14652>>CALLBLT 14660>>ASSIGN  14671<<ASSIGN
TEXT.TXT IN PROCEDURE FIXLOCAL
     14642**DCL     14652>>CALLBLT 14656>>CALLBLT 14662>>CALLBLT 14670<<ASSIGN
TEXTC.L
      8191**DCL      8192--IMP-SIZ 13520>>CALL    13522>>ASSIGN  13526>>ASSIGN  13650>>CALLBLT 14705>>CALLBLT
     14705>>CALLBLT 14708>>ASSIGN  14716>>CALLBLT 14717>>CALLBLT 14719>>IF      14719>>IF      14724<<ASSIGN
     14730>>CALLBLT 14743>>IF      14751>>CALLBLT 14753>>ASSIGN  14754>>CALLBLT 14759>>ASSIGN  14759>>ASSIGN
     14763>>CALLBLT 14765>>ASSIGN  14766>>CALLBLT 14772>>CALLBLT 14774>>ASSIGN  14775>>CALLBLT 14824<<ASSIGN
     14825>>ASSIGN  14826>>CALLBLT 14840>>CALLBLT 14840>>CALLBLT 14866>>CALLBLT 14869>>IF      14878>>ASSIGN
     14884>>CALLBLT 15035>>IF      15043>>IF      15044<<ASSIGN  15046>>IF      15047<<ASSIGN  15053>>IF
     15053>>IF      15053>>IF      15056<<ASSIGN  15056>>ASSIGN  15059>>CALLBLT 15060>>DOWHILE 15062>>ASSIGN
     15062>>ASSIGN  15068>>CALLBLT 15071>>ASSIGN  15071>>ASSIGN  15073<<ASSIGN  15074>>CALLBLT 15077>>DOWHILE
     15079>>ASSIGN  15079>>ASSIGN  15088>>CALLBLT 15089>>IF      15091>>DOWHILE 15095>>CALLBLT 15098>>ASSIGN
     15098>>ASSIGN  15100<<ASSIGN  15102>>DOWHILE 15103<<ASSIGN  15103>>ASSIGN  15106>>ASSIGN  15106>>ASSIGN
     15106>>ASSIGN  15106>>ASSIGN  15124>>IF      15130>>CALLBLT 15131>>DOWHILE 15133>>ASSIGN  15133>>ASSIGN
     15137>>DOWHILE 15140>>CALLBLT 15143>>ASSIGN  15143>>ASSIGN  15145<<ASSIGN
TEXTC.T
      8192**DCL     13520--CALL    13522--ASSIGN  13526--ASSIGN  13650>>CALLBLT 14705>>CALLBLT 14716>>CALLBLT
     14717>>CALLBLT 14719>>IF      14719>>IF      14730>>CALLBLT 14743>>IF      14751>>CALLBLT 14753<<ASSIGN
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:498  
     14754>>CALLBLT 14759<<ASSIGN  14759>>ASSIGN  14763>>CALLBLT 14765<<ASSIGN  14766>>CALLBLT 14772>>CALLBLT
     14774<<ASSIGN  14775>>CALLBLT 14825<<ASSIGN  14826>>CALLBLT 14840>>CALLBLT 14840>>CALLBLT 14866>>CALLBLT
     14869>>IF      14884>>CALLBLT 15053>>IF      15053>>IF      15059>>CALLBLT 15062<<ASSIGN  15062>>ASSIGN
     15068>>CALLBLT 15071<<ASSIGN  15071>>ASSIGN  15074>>CALLBLT 15079<<ASSIGN  15079>>ASSIGN  15088>>CALLBLT
     15095>>CALLBLT 15098<<ASSIGN  15098>>ASSIGN  15106<<ASSIGN  15106>>ASSIGN  15130>>CALLBLT 15133<<ASSIGN
     15133>>ASSIGN  15137>>DOWHILE 15140>>CALLBLT 15143<<ASSIGN  15143>>ASSIGN
TEXT_CHAR
      8194**DCL     15066<<ASSIGN  15066>>ASSIGN  15082>>DOWHILE 15086<<ASSIGN  15091>>DOWHILE 15102>>DOWHILE
THIS_SITE IN PROCEDURE LOOKUP_ALIAS
     14743**LABEL   14716--CALLALT
TIME$ IN PROCEDURE SET_DATESTAMP
     13892**DCL     13897<<ASSIGN  13909>>CALLBLT 13909>>CALLBLT 13911>>CALLBLT 13911>>CALLBLT 13914>>IF
     13915>>CALLBLT 13915>>CALLBLT 13921>>ASSIGN  13921>>ASSIGN
TIMEBUF
     10171**DCL     10177--REDEF   12140--DCLINIT 12141--DCLINIT
TIMEBUF.HOUR
     10172**DCL     13663>>CALLBLT
TIMEBUF.MIN
     10174**DCL     13663>>CALLBLT
TIMEBUF.SEC
     10176**DCL     13663>>CALLBLT
TIMED_OUT
     10026**DCL     13202<<ASSIGN  13314>>IF      13329>>IF      13501>>IF      13847>>IF      15011<<ASSIGN
     15014<<ASSIGN
TIMESTRING
     10177**DCL     13166>>ASSIGN  15168>>CALLBLT
TIMEWORK
     10182**DCL     13663<<CALLBLT 13664>>CALLBLT
TITLE.LEN IN PROCEDURE WRITE_HEADER
     14135**DCL     14142<<ASSIGN  14148<<ASSIGN  14154<<ASSIGN  14160<<ASSIGN  14166<<ASSIGN  14168>>CALLBLT
     14169>>CALLBLT 14170>>ASSIGN  14184<<ASSIGN  14185>>CALLBLT 14186>>CALLBLT 14187>>ASSIGN  14202<<ASSIGN
     14203>>CALLBLT 14204>>CALLBLT 14205>>ASSIGN
TITLE.TXT IN PROCEDURE WRITE_HEADER
     14136**DCL     14141<<ASSIGN  14147<<ASSIGN  14153<<ASSIGN  14159<<ASSIGN  14165<<ASSIGN  14168>>CALLBLT
     14183<<ASSIGN  14185>>CALLBLT 14201<<ASSIGN  14203>>CALLBLT
TMP$
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:499  
      9532**DCL      9263--IMP-PTR 13094<>CALL    13096<>CALL    13097>>IF      13108>>CALL    14363<<ASSIGN
     14373>>ASSIGN
TMP2 IN PROCEDURE CHECKADDR
     14486**DCL     14498<<CALLBLT 14500<<ASSIGN  14502>>IF      14515>>IF
TMP2 IN PROCEDURE FIXLOCAL
     14645**DCL     14656<<CALLBLT 14658<<ASSIGN  14669>>IF      14670>>ASSIGN
TO$ IN PROCEDURE MOVE_PATH
     15122**DCL     15115--PROC    15133>>ASSIGN  15133>>ASSIGN  15143>>ASSIGN  15143>>ASSIGN  15145>>ASSIGN
TO$ IN PROCEDURE MOVE_STRING
     15032**DCL     15025--PROC    15041--ENTRY   15047>>ASSIGN  15062>>ASSIGN  15062>>ASSIGN  15066>>ASSIGN
     15071>>ASSIGN  15071>>ASSIGN  15073>>ASSIGN  15074>>CALLBLT 15074>>CALLBLT 15077>>DOWHILE 15079>>ASSIGN
     15079>>ASSIGN  15079>>ASSIGN  15079>>ASSIGN  15082>>DOWHILE 15086>>ASSIGN  15088>>CALLBLT 15088>>CALLBLT
     15089>>IF      15091>>DOWHILE 15091>>DOWHILE 15095>>CALLBLT 15095>>CALLBLT 15098>>ASSIGN  15098>>ASSIGN
     15098>>ASSIGN  15098>>ASSIGN  15100>>ASSIGN  15102>>DOWHILE 15102>>DOWHILE 15103>>ASSIGN  15103>>ASSIGN
TRAVERSE_FROM IN PROCEDURE PARSE_FROM
     14338**LABEL   14352--GOTO
TRAVERSE_REPLYTO IN PROCEDURE PARSE_FROM
     14354**LABEL   14336--GOTO    14390--GOTO
TRIMMEDSIZE IN PROCEDURE LOOKUP_REGISTRATION
     14860**DCL     14882<<ASSIGN  14884>>CALLBLT 14886>>IF      14887<<ASSIGN  14889>>IF      14889>>IF
     14891<<ASSIGN  14891>>ASSIGN  14897>>ASSIGN  14907>>ASSIGN
TRIMTEXT
     14561**PROC    13581--CALL    13630--CALL    14310--CALL    14317--CALL
TRIM_AGAIN IN PROCEDURE TRIMTEXT
     14586**LABEL   14632--GOTO
TRMCTL
     12755**DCL     12733--DCLINIT
TRMCTL.BREAKCOUNT
     12766**DCL     12767--REDEF
TRMCTL.OUTPUTDISCARD#
     12758**DCL     13978<<ASSIGN  13986<<ASSIGN
TROUBLE IN PROCEDURE SEND_MAIL_MESSAGE
     13956**DCL     13975<<ASSIGN  13984<<ASSIGN  14000>>IF      14010>>IF
TRY_UNDASHING IN PROCEDURE LOOKUP_ALIAS
     14772**LABEL   14768--CALLALT
TRY_UNDOTTING IN PROCEDURE LOOKUP_ALIAS
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:500  
     14763**LABEL   14756--CALLALT
TRY_UNLINEING IN PROCEDURE LOOKUP_ALIAS
     14751**LABEL   14746--CALLALT
TSLEN IN PROCEDURE LOOKUP_ALIAS
     14693**DCL     14801<<ASSIGN  14802>>ASSIGN  14809>>ASSIGN  14823<<ASSIGN  14824>>ASSIGN  14830<<CALLBLT
     14831>>ASSIGN  14842<<CALLBLT 14843>>CALLBLT 14844>>CALLBLT 14846<<CALLBLT 14847>>ASSIGN
TSTRING IN PROCEDURE LOOKUP_ALIAS
     14694**DCL     14787<<CALLBLT 14788>>ASSIGN  14802<<ASSIGN  14803>>CALLBLT 14810>>ASSIGN  14821<<CALLBLT
     14825>>ASSIGN
TTEXT
     10100**DCL     13630<>CALL    13631<>CALL    13632--CALL    14310<>CALL
TTEXT.LEN
     10101**DCL     13700<<ASSIGN  14274<<ASSIGN  14302<<ASSIGN  14309>>IF
TTEXT.TXT
     10102**DCL     14276<<ASSIGN  14301<<CALLBLT
TVAL IN PROCEDURE GET_IOBUF_BOUND
     15192**DCL     15194<<CALLBLT
TVAL IN PROCEDURE LOOKUP_ALIAS
     14695**DCL     14803<<CALLBLT 14830<<CALLBLT 14842<<CALLBLT 14846<<CALLBLT
TXTC IN PROCEDURE WRITE_HEADER
     14129**DCL     14127--PROC
TXTC.LEN IN PROCEDURE WRITE_HEADER
     14130**DCL     14131--IMP-SIZ 14145>>IF      14151>>IF      14157>>IF      14163>>IF      14169>>CALLBLT
     14170>>ASSIGN
TXTC.TXT IN PROCEDURE WRITE_HEADER
     14131**DCL     14169>>CALLBLT
TZOFFSET IN PROCEDURE SET_DATESTAMP
     13890**DCL     13920<<ASSIGN  13926<<ASSIGN  13930<<ASSIGN  13930>>ASSIGN  13935<<ASSIGN  13937<<ASSIGN
     13939<>CALL
UC_EOMTABLE
     12551**DCL     12528--DCLINIT
UC_TRMCTL
     12619**DCL     12597--DCLINIT
UC_TRMCTL.BREAKCOUNT
     12630**DCL     12631--REDEF
UC_TRMCTL.FULLDUXPAPERTAPE#
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:501  
     12623**DCL     13216<<ASSIGN
USEFUL_LENGTH IN PROCEDURE LOOKUP_ALIAS
     14696**DCL     14746<>CALL    14751>>CALLBLT 14752>>DOWHILE 14754>>CALLBLT 14756<>CALL    14763>>CALLBLT
     14764>>DOWHILE 14766>>CALLBLT 14768<>CALL    14772>>CALLBLT 14773>>DOWHILE 14775>>CALLBLT 14777<>CALL
     14803>>CALLBLT 14821>>CALLBLT 14821>>CALLBLT 14823>>ASSIGN
USEFUL_SIZE IN PROCEDURE LOOKUP_REGISTRATION
     14861**DCL     14855--PROC    14866<<CALLBLT 14868>>DOWHILE 14869>>IF      14870<<ASSIGN  14870>>ASSIGN
     14874>>IF      14878<<ASSIGN  14883>>DOINDEX
USER IN PROCEDURE LOOKUP_ALIAS
     14697**DCL     14702--ASSIGN
USER.C IN PROCEDURE LOOKUP_ALIAS
     14698**DCL     14821>>CALLBLT 14823>>ASSIGN
USER.T IN PROCEDURE LOOKUP_ALIAS
     14699**DCL     14787>>CALLBLT 14788<<ASSIGN  14803>>CALLBLT 14821>>CALLBLT
USER$ IN PROCEDURE LOOKUP_ALIAS
     14700**DCL     14702<<ASSIGN  14712<>CALL    14743>>IF      14743>>IF      14746<>CALL    14751>>CALLBLT
     14751>>CALLBLT 14753>>ASSIGN  14753>>ASSIGN  14754>>CALLBLT 14754>>CALLBLT 14756<>CALL    14759>>ASSIGN
     14759>>ASSIGN  14763>>CALLBLT 14763>>CALLBLT 14765>>ASSIGN  14765>>ASSIGN  14766>>CALLBLT 14766>>CALLBLT
     14768<>CALL    14772>>CALLBLT 14772>>CALLBLT 14774>>ASSIGN  14774>>ASSIGN  14775>>CALLBLT 14775>>CALLBLT
     14777<>CALL    14840>>CALLBLT 14840>>CALLBLT
USER$ IN PROCEDURE LOOKUP_REGISTRATION
     14862**DCL     14855--PROC    14866>>CALLBLT 14866>>CALLBLT 14869>>IF      14869>>IF      14878>>ASSIGN
     14884>>CALLBLT 14884>>CALLBLT
USERS
     10121**DCL     13614<<ASSIGN  13650--CALLBLT 13650--CALLBLT
USERS.LEN
     10122**DCL     13253>>ASSIGN  13651>>ASSIGN  13994>>ASSIGN
USERS.TXT
     10123**DCL     13253>>ASSIGN  13993>>CALLBLT
USER_COUNT
     10023**DCL     13234<<ASSIGN  13253>>ASSIGN  13253>>ASSIGN  13256<<ASSIGN  13256>>ASSIGN  13286<<ASSIGN
     13574>>IF      13614>>ASSIGN  13976>>DOINDEX 13989>>IF
UTS
     10033**DCL     12161--DCLINIT 13005<<CALLBLT 13011<<CALLBLT 13072<<CALLBLT 13073>>ASSIGN  13170<<CALLBLT
     13171>>CALLBLT 13174>>ASSIGN  13644>>CALLBLT 13645>>CALLBLT
UTSVAL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:502  
     10193**DCL     12182--DCLINIT 12203--DCLINIT 13939<>CALL    13939<>CALL    13940<>CALL    13940<>CALL
UTSVAL2LCL
     12199**DCL     13941<>CALL
UTSVAL2LCL.V
     12203**DCL     12199--DCLINIT
VERIFY_ADDRESS
     13619**PROC    13289--CALL
VLEN IN PROCEDURE GET_IOBUF_BOUND
     15191**DCL     15188--PROC    15194<<CALLBLT 15195<<ASSIGN  15195>>ASSIGN  15198<<ASSIGN
VLEN IN PROCEDURE WRITEDO
     15176**DCL     15178<>CALL    15179>>IF      15182>>ASSIGN
VLR_ERRMSG
     12936**DCL     12841--DCLINIT 12964--DCLINIT
VLR_ERRMSG.RECCNT
     12940**DCL     14052>>DOINDEX 14117>>DOINDEX
VMERRMSG
     12923**DCL     12838--DCLINIT
VM_LISTKEY
     12689**DCL     14906--ASSIGN
VM_LISTKEY.COUNT
     12690**DCL     14907<<ASSIGN
VM_LISTKEY.TEXT
     12693**DCL     14908<<ASSIGN
VM_LISTKEY.TYPE
     12691**DCL     14907--ASSIGN
VM_SEARCHKEY
     12705**DCL     14791--ASSIGN
VM_SEARCHKEY.COUNT
     12706**DCL     14792<<ASSIGN  14800>>DOWHILE 14801>>ASSIGN
VM_SEARCHKEY.TEXT
     12709**DCL     14802>>ASSIGN
VM_SEARCHKEY.TYPE
     12707**DCL     14793<<ASSIGN
VM_USERKEY
     12673**DCL     14896--ASSIGN
VM_USERKEY.COUNT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:503  
     12674**DCL     14897<<ASSIGN
VM_USERKEY.TEXT
     12677**DCL     14898<<ASSIGN
VM_USERKEY.TYPE
     12675**DCL     14897--ASSIGN
WAIT_A_MIN
     12434**DCL     13105<>CALL    13115<>CALL    13131<>CALL
WAIT_A_MIN.V
     12435**DCL     12434--DCLINIT
WAIT_A_SECOND
     12420**DCL     13178<>CALL    13184<>CALL    13187<>CALL    13269<>CALL    13319<>CALL    13323<>CALL
     13335<>CALL
WAIT_A_SECOND.V
     12421**DCL     12420--DCLINIT
WHEN
     10090**DCL     13969<>CALL
WHEN.LEN
     10091**DCL     13698<<ASSIGN  13943<<ASSIGN
WHEN.TXT
     10092**DCL     13942<<ASSIGN
WRITEDO
     15174**PROC    13037--CALL    13410--CALL
WRITE_BLANK_DATA
     11708**DCL     13863<>CALL
WRITE_BLANK_DATA.STATION_
     11710**DCL     11710--REDEF
WRITE_BLANK_DATA.V
     11711**DCL     11708--DCLINIT
WRITE_BLANK_DATA.V.DVBYTE.VFC#
     11717**DCL     11717--REDEF
WRITE_DATA
     11676**DCL     13653<>CALL    13660<>CALL    13670<>CALL    13838<>CALL    13995<>CALL    14208<>CALL
WRITE_DATA.BUF_.BOUND
     11676**DCL     13651<<ASSIGN  13659<<ASSIGN  13669<<ASSIGN  13833<<ASSIGN  13994<<ASSIGN  14170<<ASSIGN
     14175<<ASSIGN  14187<<ASSIGN  14205<<ASSIGN
WRITE_DATA.STATION_
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:504  
     11678**DCL     11678--REDEF
WRITE_DATA.V
     11679**DCL     11676--DCLINIT
WRITE_DATA.V.DVBYTE.VFC#
     11685**DCL     11685--REDEF
WRITE_DO
     10316**DCL     15183<>CALL
WRITE_DO.BUF_
     10316**DCL     15180<<ASSIGN  15182<<ASSIGN
WRITE_DO.STATION_
     10318**DCL     10318--REDEF
WRITE_DO.V
     10319**DCL     10316--DCLINIT
WRITE_DO.V.DVBYTE.VFC#
     10325**DCL     10325--REDEF
WRITE_DRIBBLE
     11194**DCL     13527<>CALL    14017<>CALL    14710<>CALL    14988<>CALL
WRITE_DRIBBLE.BUF_
     11194**DCL     13526<<ASSIGN  14016<<ASSIGN  14708<<ASSIGN  14983<<ASSIGN  14985<<ASSIGN
WRITE_DRIBBLE.BUF_.BOUND
     11194**DCL     14986<<ASSIGN
WRITE_DRIBBLE.STATION_
     11196**DCL     11196--REDEF
WRITE_DRIBBLE.V
     11197**DCL     11194--DCLINIT
WRITE_DRIBBLE.V.DVBYTE.VFC#
     11203**DCL     11203--REDEF
WRITE_HEADER
     14127**PROC    13963--CALL    13964--CALL    13965--CALL    13966--CALL    13967--CALL    13968--CALL
     13969--CALL    13970--CALL
WRITE_NOTIFY
     11920**DCL     14080<>CALL
WRITE_NOTIFY.BUF_
     11920**DCL     14079<<ASSIGN
WRITE_NOTIFY.STATION_
     11922**DCL     11922--REDEF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:505  
WRITE_NOTIFY.V
     11923**DCL     11920--DCLINIT
WRITE_NOTIFY.V.DVBYTE.VFC#
     11929**DCL     11929--REDEF
WRITE_REPLY
     13515**PROC    13183--CALL    13186--CALL    13197--CALL    13271--CALL    13317--CALL    13321--CALL
     13341--CALL    14952--CALL
WRITE_UC
     10386**DCL     13523<>CALL
WRITE_UC.BUF_
     10386**DCL     13522<<ASSIGN
WRITE_UC.STATION_
     10388**DCL     10388--REDEF
WRITE_UC.V
     10389**DCL     10386--DCLINIT
WRITE_UC.V.DVBYTE.VFC#
     10395**DCL     10395--REDEF
WRITING IN PROCEDURE SPILL_ALIASES
     14924**DCL     14932<<ASSIGN  14947>>IF      14951>>IF      14957<<ASSIGN  14963<<ASSIGN
XSERRMSG
     13001**DCL     12961--DCLINIT
XSL$GETHOSTBYNAME
      9507**DCL-ENT 13094--CALL    13096--CALL
XSL$HOSTENT.H_ADDR_LIST$
      9304**DCL     13108>>CALL
XSL$NTOHL
      9508**DCL-ENT 13108--CALL
XSL$SOCKINIT
      9509**DCL-ENT 13086--CALL
XSL_ERRNO
      9484**DCL     14108>>IF      14109>>ASSIGN
XTX$ADAPT
      5658**DCL-ENT  5737--DCLINIT  6073--DCLINIT
XUD$UTS_ADJUST
      8461**DCL-ENT 13939--CALL    13940--CALL
XUG$ECHOIF
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:506  
      6700**DCL-ENT 13395--CALL
XUG$ERRMSG
      6705**DCL-ENT 13396--CALL
XUG$GETCMD
      6698**DCL-ENT 13385--CALL
XUG$INIT
      6702**DCL-ENT 13380--CALL
XUG_GETCMD
      6167**DCL     13380<>CALL    13385<>CALL    13395<>CALL    13396<>CALL
XUG_GETCMD.ERR#
      6178**DCL     13394>>ASSIGN
XUG_GETCMD.ERR#.CODE#
      6181**DCL     13390>>IF
XUG_GETCMD.ERR#.MON#
      6180**DCL     13390>>IF      13397>>IF
XUG_GETCMD.ERR_CODE
      6315**DCL     13394<<ASSIGN
XUG_GETCMD.OUT$
      6172**DCL      6178--REDEF   13401>>ASSIGN
XUG_GETCMD.PCB$
      6192**DCL      6510--IMP-PTR 13456>>ASSIGN  13457>>CALLBLT
XUG_INIT
      5762**DCL     13380<>CALL
XUG_INIT.ECHO#
      5933**DCL     13024<<ASSIGN
XUR$GETCMD
      9491**DCL-ENT 13497--CALL    13742--CALL    13808--CALL    14262--CALL    14269--CALL    14330--CALL
XUR$INIT
      9492**DCL-ENT 13085--CALL
XUR_INIT
      5663**DCL     13085<>CALL
XUR_INIT.WORKR_
      5677**DCL      5678--REDEF
X_29
     10031**DCL     13023<<ASSIGN  13027<<ASSIGN  13215>>IF      13333>>IF
ZONE$ IN PROCEDURE SET_DATESTAMP
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:507  
     13893**DCL     13921<<ASSIGN  13922<<ASSIGN  13922>>ASSIGN  13923>>DOCASE  13925>>CALLBLT 13925>>CALLBLT
     13928>>IF      13929>>IF      13929>>IF      13932>>CALLBLT 13932>>CALLBLT 13937>>ASSIGN
ZTEXT
     10115**DCL     13581<>CALL    13593<<ASSIGN  13599<<ASSIGN  13630<>CALL    14369>>ASSIGN  14503<<ASSIGN
     14504<>CALL    14509--CALL    14510>>ASSIGN  14937--ASSIGN
ZTEXT.LEN
     10116**DCL     13579<<ASSIGN  13580>>CALLBLT 13594>>CALLBLT 13600>>CALLBLT 13602>>CALLBLT 13622<<ASSIGN
     13628>>ASSIGN  14329<<ASSIGN  14507>>CALLBLT 14538<<ASSIGN  14547<<ASSIGN  14554>>CALLBLT 14554>>CALLBLT
     14556>>ASSIGN  14947>>IF      14958>>CALLBLT 14958>>CALLBLT 14960>>ASSIGN
ZTEXT.TXT
     10117**DCL     13580<<CALLBLT 13594>>CALLBLT 13594>>CALLBLT 13600>>CALLBLT 13602>>CALLBLT 13602>>CALLBLT
     13623<<CALLBLT 13628>>ASSIGN  13829<<CALLBLT 13830>>ASSIGN  14328<<CALLBLT 14380>>CALLBLT 14420<<CALLBLT
     14436<<CALLBLT 14440<<CALLBLT 14444<<CALLBLT 14451<<CALLBLT 14456<<CALLBLT 14460<<CALLBLT 14465<<CALLBLT
     14470>>ASSIGN  14507>>CALLBLT 14537<<CALLBLT 14548<<ASSIGN  14554>>CALLBLT 14942>>ASSIGN  14958>>CALLBLT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:508  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:509  
              MINI UREF LISTING

BLANK    9535**DCL
DELSITE_LOOP IN PROCEDURE FIXLOCAL  14664**LABEL
F$ALIAS    9521**DCL
F$DRIBBLE    9522**DCL
F$NODES    9523**DCL
F$NOTIFY    9526**DCL
M$ACCT      35**DCL-ENT
M$ACTIVATE      38**DCL-ENT
M$ASUSER      33**DCL-ENT
M$ATTACH      40**DCL-ENT
M$BADPP      58**DCL-ENT
M$CGCTL      39**DCL-ENT
M$CGINFO      39**DCL-ENT
M$CHECK      20**DCL-ENT
M$CHGUNIT      78**DCL-ENT
M$CLRSTK      76**DCL-ENT
M$CMDVAR      87**DCL-ENT
M$CONFIG      48**DCL-ENT
M$CORRES      23**DCL-ENT
M$CPEXIT      32**DCL-ENT
M$CVM      56**DCL-ENT
M$CVOL      21**DCL-ENT
M$DCLFLD      48**DCL-ENT
M$DEACTIVATE      38**DCL-ENT
M$DELREC      20**DCL-ENT
M$DEQ      85**DCL-ENT
M$DETACH      40**DCL-ENT
M$DEVICE      22**DCL-ENT
M$DISPLAY      85**DCL-ENT
M$DISPRES      25**DCL-ENT
M$DLIB      31**DCL-ENT
M$DO    9525**DCL
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:510  
M$DRIBBLE      48**DCL-ENT
M$DRTN      76**DCL-ENT
M$DSUSER      33**DCL-ENT
M$ENQ      84**DCL-ENT
M$ERASE      49**DCL-ENT
M$ERR      30**DCL-ENT
M$EVENT      73**DCL-ENT
M$EXHUME      82**DCL-ENT
M$EXTEND      22**DCL-ENT
M$FDP      54**DCL-ENT
M$FDS      53**DCL-ENT
M$FEBOOT      46**DCL-ENT
M$FECTL      47**DCL-ENT
M$FEDUMP      46**DCL-ENT
M$FID      81**DCL-ENT
M$FINDPROC      35**DCL-ENT
M$FSUSER      33**DCL-ENT
M$FVP      55**DCL-ENT
M$FWCG      39**DCL-ENT
M$GBPL      59**DCL-ENT
M$GDDL      55**DCL-ENT
M$GDP      54**DCL-ENT
M$GDS      53**DCL-ENT
M$GETDCB      24**DCL-ENT
M$GETMOUSE      64**DCL-ENT
M$GETPM      65**DCL-ENT
M$GJOB      83**DCL-ENT
M$GLINEATTR      43**DCL-ENT
M$GOODPP      58**DCL-ENT
M$GPLATEN      51**DCL-ENT
M$GPROMPT      50**DCL-ENT
M$GTRMATTR      44**DCL-ENT
M$GTRMTAB      45**DCL-ENT
M$GVP      54**DCL-ENT
M$HELP      81**DCL-ENT
M$INTRTN      34**DCL-ENT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:511  
M$IOQ      69**DCL-ENT
M$JOBSTATS      83**DCL-ENT
M$LDEV      18**DCL-ENT
M$LDTRC      31**DCL-ENT
M$LIMIT      24**DCL-ENT
M$LINES      23**DCL-ENT
M$MADMUCK      26**DCL-ENT
M$MAKUSER      57**DCL-ENT
M$MBS      25**DCL-ENT
M$MDFFLD      49**DCL-ENT
M$MERC      74**DCL-ENT
M$MERCS      75**DCL-ENT
M$MIRROR      69**DCL-ENT
M$MONINFO      86**DCL-ENT
M$MPL      59**DCL-ENT
M$NODEINFO      50**DCL-ENT
M$NXTUSR      84**DCL-ENT
M$OCMSG      82**DCL-ENT
M$OLAY      30**DCL-ENT
M$PAS      59**DCL-ENT
M$PATHCON      82**DCL-ENT
M$PDS      53**DCL-ENT
M$PLATEN      44**DCL-ENT
M$PROCNAME      35**DCL-ENT
M$PROFILE      46**DCL-ENT
M$RACST      26**DCL-ENT
M$RDSYSLOG      67**DCL-ENT
M$RELDCB      24**DCL-ENT
M$RELRES      25**DCL-ENT
M$RELSTARF      27**DCL-ENT
M$REM      27**DCL-ENT
M$RENV      74**DCL-ENT
M$REQUIRE      26**DCL-ENT
M$RETRY      75**DCL-ENT
M$RETRYS      75**DCL-ENT
M$REW      21**DCL-ENT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:512  
M$RLSFLD      49**DCL-ENT
M$RPRIV      77**DCL-ENT
M$RSPP      56**DCL-ENT
M$RSWITCH      78**DCL-ENT
M$RUE      84**DCL-ENT
M$SAD      57**DCL-ENT
M$SAVE      33**DCL-ENT
M$SCON      34**DCL-ENT
M$SENV      74**DCL-ENT
M$SETFP      47**DCL-ENT
M$SINPUT      45**DCL-ENT
M$SLCFLD      50**DCL-ENT
M$SMOUSE      64**DCL-ENT
M$SMPRT      56**DCL-ENT
M$SSC      57**DCL-ENT
M$SSWITCH      77**DCL-ENT
M$STATE      86**DCL-ENT
M$STD      58**DCL-ENT
M$STIMER      72**DCL-ENT
M$STLPP      55**DCL-ENT
M$STRAP      72**DCL-ENT
M$STRMATTR      44**DCL-ENT
M$STRMTAB      45**DCL-ENT
M$SYMBIO      83**DCL-ENT
M$SYSCON      69**DCL-ENT
M$SYSID      87**DCL-ENT
M$TDCLOSE      68**DCL-ENT
M$TDIO      68**DCL-ENT
M$TDOPEN      67**DCL-ENT
M$TDREQCPU      68**DCL-ENT
M$TEMPWROC      62**DCL-ENT
M$TRAP      72**DCL-ENT
M$TRTN      76**DCL-ENT
M$TRUNC      19**DCL-ENT
M$TTIMER      72**DCL-ENT
M$UMPL      59**DCL-ENT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:513  
M$UNFID      81**DCL-ENT
M$UNLATCH      38**DCL-ENT
M$UNSHARE      35**DCL-ENT
M$USRFIELD      78**DCL-ENT
M$VIRTUAL      53**DCL-ENT
M$WEOF      21**DCL-ENT
M$WRSYSLOG      67**DCL-ENT
M$XCON      73**DCL-ENT
M$XCONRTN      34**DCL-ENT
M$XEQTIME      86**DCL-ENT
M$XFLUSH      27**DCL-ENT
M$XMOUSE      64**DCL-ENT
M$XXX      30**DCL-ENT
MOVE_HDR IN PROCEDURE MOVE_STRING  15041**ENTRY
MOVE_PATH   15115**PROC
NET$ADDR2IP    9506**DCL-ENT
NET$IP2ADDR    9504**DCL-ENT
NET$NAME2ADDR    9505**DCL-ENT
NOTEFILE_STUFF   14064**PROC
R551$    9941**DCL
SCREECH2   12233**DCL
SIZE IN PROCEDURE LOOKUP_ALIAS  14689**DCL
START IN PROCEDURE SEND_MAIL_MESSAGE  13955**DCL
TCM$NETMAIL       8**PROC
TCM$WRITE_AUDIT_OFF    9489**DCL-ENT
TCP$READ_NW    9497**DCL-ENT
TCP$WAIT    9499**DCL-ENT
TCP$WRITE    9502**DCL-ENT
TCP_ERR_CODE    8026**DCL
TEMPCHAR IN PROCEDURE LOOKUP_ALIAS  14691**DCL
TEMPCHAR IN PROCEDURE LOOKUP_REGISTRATION  14859**DCL
TRIMMEDSIZE IN PROCEDURE LOOKUP_ALIAS  14692**DCL
XUD$UTS_ADJ_25TH    8467**DCL-ENT
XUD$UTS_DIFF    8443**DCL-ENT
XUD$UTS_DIFF_25TH    8455**DCL-ENT
XUD$UTS_DIFF_SEC    8449**DCL-ENT
PL6.E3A0      #001=TCM$NETMAIL File=TCM$MAIL1.:TCA2TSI                           SUN 11/16/97 14:17 Page:514  
XUG$ALLMSG    6715**DCL-ENT
XUG$BLANK_PASSWORD    6718**DCL-ENT
XUG$BREAK    6708**DCL-ENT
XUG$CLOSE_DCBS    6707**DCL-ENT
XUG$CLRENABLE    6711**DCL-ENT
XUG$CORRES    6703**DCL-ENT
XUG$DISABLE    6709**DCL-ENT
XUG$ECHO    6701**DCL-ENT
XUG$ECHOLAST    6704**DCL-ENT
XUG$ENABLE    6710**DCL-ENT
XUG$ERRCNVRT    6720**DCL-ENT
XUG$ERRPTR    6699**DCL-ENT
XUG$ERRTOLCP6    6721**DCL-ENT
XUG$FINDDCB    6716**DCL-ENT
XUG$GETDCB    6717**DCL-ENT
XUG$HELP    6713**DCL-ENT
XUG$MOREMSG    6714**DCL-ENT
XUG$OPENOUT    6719**DCL-ENT
XUG$SETERRMSG    6706**DCL-ENT
XUG$SIMULATE_BREAK    6712**DCL-ENT

PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:515  
     2642        1        /*T***********************************************************/
     2643        2        /*T*                                                         */
     2644        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2645        4        /*T*                                                         */
     2646        5        /*T***********************************************************/
     2647        6        TCM$ABORT: PROC ASYNC;
     2648        7        %INCLUDE CP_6;
     2649       88            %B$EXCFR;
     2650      106            %B$TCB( STCLASS="BASED( B$TCB$)");
     2651      109            %B$XCON;
     2652      119            %F$DCB;
     2653      176            %SUB_EXC;
     2654      223            %FPT_CLOSE( FPTN=CLOSE_NODES, DCB=F$NODES, DISP=SAVE, STCLASS=CONSTANT);
     2655      265            %FPT_ERRMSG( SOURCE=TRAP, RESULTS=VLR_ERRMSG, BUF=OOPS, STCLASS=CONSTANT);
     2656      292            %FPT_KEYIN( FPTN=TCM_KEYIN, STCLASS=SYMREF);
     2657      311            %FPT_WRITE( FPTN=WRITE_UC, DCB=M$ME, BUF=REPLY421);
     2658      342            %FPT_YC( FPTN=TCM_YC_OFF, STCLASS=SYMREF);
     2659      359            %FPT_SCREECH (FPTN=SCREECH2, STCLASS=SYMREF);
     2660      373            %FPT_PRIV( FPTN=JIT_PRIV, STCLASS=SYMREF);
     2661      388            %VLR_ERRMSG;
     2662      410        %INCLUDE B$JIT;
     2663      700        %INCLUDE CP_6_SUBS;
     2664     1240
     2665     1241    1       DCL TCM$WRITE_AUDIT_OFF ENTRY(2);
     2666     1242
     2667     1243    1       DCL B$TCB$ PTR SYMREF READONLY;
     2668     1244    1       DCL B$JIT$ PTR SYMREF READONLY;
     2669     1245
     2670     1246    1       DCL F$NODES DCB;
     2671     1247    1       DCL M$ME DCB;
     2672     1248    1       DCL FIRST_TIME UBIN STATIC INIT( 0);
     2673     1249    1       DCL LASTNONBLANK UBIN;
     2674     1250    1       DCL OOPS CHAR( 120) STATIC;
     2675     1251    1       DCL REPLY421 CONSTANT CHAR( 0) INIT(
     2676     1252    1           '421          Closing transmission channel');
     2677     1253    1       DCL SCRAP UBIN;
     2678     1254    1       DCL TCM_SKIP_BLANKS( 0:127) UBIN BYTE CALIGNED SYMREF READONLY;
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:516  
     2679     1255    1       DCL TCM_TCPFLAVOR BIT(1) STATIC SYMDEF INIT( '1'B);
     2680     1256    1       DCL IC CHAR(6) STATIC INIT( '000000');
     2681     1257    1       DCL I SBIN;
     2682     1258    1       DCL TEMP SBIN;
     2683     1259    1       DCL TXT CHAR(120);
     2684     1260
     2685     1261    1       IF FIRST_TIME > 0 THEN
     2686     1262    1           GOTO BYPASS;
     2687     1263    1       FIRST_TIME = 1;
     2688     1264    1       IF B$TCB.STK$->B$EXCFR.ECC = %ECC_XCON# THEN
     2689     1265    2           IF B$TCB.STK$->B$XCON.RNST.OPERR THEN DO;
     2690     1266    2               IF DCBADDR( DCBNUM( F$NODES))->F$DCB.FCD# THEN
     2691     1267    2                   CALL M$CLOSE( CLOSE_NODES) ALTRET( NOCLOSE);
     2692     1268    2               FIRST_TIME = 0;
     2693     1269    2               RETURN;
     2694     1270    2   NOCLOSE:
     2695     1271    2               END;
     2696     1272    1       TEMP = B$TCB.STK$->B$EXCFR.IC;
     2697     1273    1       I = 5;
     2698     1274    2       DO WHILE( TEMP > 0);
     2699     1275    2           SUBSTR( IC, I, 1) = BINASC( ASCBIN( '0') + MOD( TEMP, 8));
     2700     1276    2           TEMP = TEMP / 8;  I = I - 1;
     2701     1277    2           END;
     2702     1278    1       CALL M$ERRMSG( FPT_ERRMSG) ALTRET( DISCONNECT_EM);
     2703     1279    1       CALL SEARCHR( LASTNONBLANK, SCRAP, TCM_SKIP_BLANKS, OOPS);
     2704     1280    1       TCM_KEYIN.MESS_ = VECTOR( SUBSTR( OOPS, 0, LASTNONBLANK+1));
     2705     1281    1       CALL M$KEYIN( TCM_KEYIN) ALTRET( DISCONNECT_EM);
     2706     1282    1   DISCONNECT_EM:
     2707     1283    1       IF TCM_TCPFLAVOR THEN
     2708     1284    1           WRITE_UC.V.DCB# = DCBNUM( M$ME);
     2709     1285    1       ELSE
     2710     1286    1           WRITE_UC.V.DCB# = DCBNUM( M$UC);
     2711     1287    1       CALL M$WRITE( WRITE_UC) ALTRET( IGNORED);
     2712     1288    1   IGNORED:
     2713     1289    1       CALL CONCAT( TXT, '.', IC, ' ', SUBSTR( OOPS, 1, 12));
     2714     1290    1       CALL TCM$WRITE_AUDIT_OFF( 20, TXT);
     2715     1291    1       IF NOT TCM_TCPFLAVOR THEN
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:517  
     2716     1292    1           CALL M$YC( TCM_YC_OFF) ALTRET( BYPASS);
     2717     1293    1   BYPASS:
     2718     1294    1       CALL M$SPRIV( JIT_PRIV);
     2719     1295    1       B$JIT.PRIV.ACTIVE.EXMM = %YES#;  /* so we can SNAP */
     2720     1296    1       CALL M$SCREECH( SCREECH2);  /* ..a SNAP, really */
     2721     1297    1       CALL M$EXIT;
     2722     1298
     2723     1299    1       END TCM$ABORT;

PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:518  
--  Include file information  --

   CP_6_SUBS.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$ABORT.

   Procedure TCM$ABORT requires 127 words for executable code.
   Procedure TCM$ABORT requires 40 words of local(AUTO) storage.

    No errors detected in file TCM$MAIL1.:TCA2TSI    .

PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:519  

 Object Unit name= TCM$ABORT                                  File name= TCM$MAIL1.:TCA2TOU
 UTS= NOV 16 '97 14:27:12.52 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     67    103  TCM$ABORT
    2   Data  even  none    50     62  TCM$ABORT
    3   DCB   even  none     0      0  F$NODES
    4   DCB   even  none     0      0  M$ME
    5   Proc  even  none   127    177  TCM$ABORT
    6  RoData even  none     5      5  TCM$ABORT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     5      0   yes            yes     Async       0  TCM$ABORT

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    2     57  TCM_TCPFLAVOR

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 TCM$WRITE_AUDIT_OFF
                       nStd      0 X66_AAUTO
                       nStd      0 X66_AARET
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:520  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  TCM_KEYIN                             TCM_YC_OFF
     SCREECH2                              JIT_PRIV                         r    B$TCB$
r    B$JIT$                                F$NODES                               M$ME
r    TCM_SKIP_BLANKS                       B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:521  


     2642        1        /*T***********************************************************/
     2643        2        /*T*                                                         */
     2644        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2645        4        /*T*                                                         */
     2646        5        /*T***********************************************************/
     2647        6        TCM$ABORT: PROC ASYNC;

      6  5 000000   000000 700200 xent  TCM$ABORT    TSX0  ! X66_AAUTO
         5 000001   000050 000000                    ZERO    40,0

     2648        7        %INCLUDE CP_6;
     2649       88            %B$EXCFR;
     2650      106            %B$TCB( STCLASS="BASED( B$TCB$)");
     2651      109            %B$XCON;
     2652      119            %F$DCB;
     2653      176            %SUB_EXC;
     2654      223            %FPT_CLOSE( FPTN=CLOSE_NODES, DCB=F$NODES, DISP=SAVE, STCLASS=CONSTANT);
     2655      265            %FPT_ERRMSG( SOURCE=TRAP, RESULTS=VLR_ERRMSG, BUF=OOPS, STCLASS=CONSTANT);
     2656      292            %FPT_KEYIN( FPTN=TCM_KEYIN, STCLASS=SYMREF);
     2657      311            %FPT_WRITE( FPTN=WRITE_UC, DCB=M$ME, BUF=REPLY421);
     2658      342            %FPT_YC( FPTN=TCM_YC_OFF, STCLASS=SYMREF);
     2659      359            %FPT_SCREECH (FPTN=SCREECH2, STCLASS=SYMREF);
     2660      373            %FPT_PRIV( FPTN=JIT_PRIV, STCLASS=SYMREF);
     2661      388            %VLR_ERRMSG;
     2662      410        %INCLUDE B$JIT;
     2663      700        %INCLUDE CP_6_SUBS;
     2664     1240
     2665     1241    1       DCL TCM$WRITE_AUDIT_OFF ENTRY(2);
     2666     1242
     2667     1243    1       DCL B$TCB$ PTR SYMREF READONLY;
     2668     1244    1       DCL B$JIT$ PTR SYMREF READONLY;
     2669     1245
     2670     1246    1       DCL F$NODES DCB;
     2671     1247    1       DCL M$ME DCB;
     2672     1248    1       DCL FIRST_TIME UBIN STATIC INIT( 0);
     2673     1249    1       DCL LASTNONBLANK UBIN;
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:522  
     2674     1250    1       DCL OOPS CHAR( 120) STATIC;
     2675     1251    1       DCL REPLY421 CONSTANT CHAR( 0) INIT(
     2676     1252    1           '421          Closing transmission channel');
     2677     1253    1       DCL SCRAP UBIN;
     2678     1254    1       DCL TCM_SKIP_BLANKS( 0:127) UBIN BYTE CALIGNED SYMREF READONLY;
     2679     1255    1       DCL TCM_TCPFLAVOR BIT(1) STATIC SYMDEF INIT( '1'B);
     2680     1256    1       DCL IC CHAR(6) STATIC INIT( '000000');
     2681     1257    1       DCL I SBIN;
     2682     1258    1       DCL TEMP SBIN;
     2683     1259    1       DCL TXT CHAR(120);
     2684     1260
     2685     1261    1       IF FIRST_TIME > 0 THEN

   1261  5 000002   000020 235000 2                  LDA     FIRST_TIME
         5 000003   000163 601000 5                  TNZ     BYPASS

     2686     1262    1           GOTO BYPASS;
     2687     1263    1       FIRST_TIME = 1;

   1263  5 000004   000001 236007                    LDQ     1,DL
         5 000005   000020 756000 2                  STQ     FIRST_TIME

     2688     1264    1       IF B$TCB.STK$->B$EXCFR.ECC = %ECC_XCON# THEN

   1264  5 000006   000000 470400 xsym               LDP0    B$TCB$
         5 000007   000001 471500                    LDP1    1,,PR0
         5 000010   100000 720100                    LXL0    0,,PR1
         5 000011   000003 100003                    CMPX0   3,DU
         5 000012   000033 601000 5                  TNZ     s:1272

     2689     1265    2           IF B$TCB.STK$->B$XCON.RNST.OPERR THEN DO;

   1265  5 000013   100101 236100                    LDQ     65,,PR1
         5 000014   020000 316003                    CANQ    8192,DU
         5 000015   000033 600000 5                  TZE     s:1272

     2690     1266    2               IF DCBADDR( DCBNUM( F$NODES))->F$DCB.FCD# THEN
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:523  

   1266  5 000016   000000 236007 xsym               LDQ     F$NODES,DL
         5 000017   000000 473400 6                  LDP3    0
         5 000020   300000 474500                    LDP4    0,,PR3
         5 000021   400000 475506                    LDP5    0,QL,PR4
         5 000022   500031 236100                    LDQ     25,,PR5
         5 000023   020000 316007                    CANQ    8192,DL
         5 000024   000031 600000 5                  TZE     s:1268

     2691     1267    2                   CALL M$CLOSE( CLOSE_NODES) ALTRET( NOCLOSE);

   1267  5 000025   000000 630400 1                  EPPR0   CLOSE_NODES
         5 000026   450001 713400                    CLIMB   alt,close
         5 000027   406000 401760                    pmme    nvectors=13
         5 000030   000033 702000 5                  TSX2    s:1272

     2692     1268    2               FIRST_TIME = 0;

   1268  5 000031   000020 450000 2                  STZ     FIRST_TIME

     2693     1269    2               RETURN;

   1269  5 000032   000000 702200 xent               TSX2  ! X66_AARET

     2694     1270    2   NOCLOSE:
     2695     1271    2               END;
     2696     1272    1       TEMP = B$TCB.STK$->B$EXCFR.IC;

   1272  5 000033   000000 470400 xsym               LDP0    B$TCB$
         5 000034   000001 471500                    LDP1    1,,PR0
         5 000035   100004 236100                    LDQ     4,,PR1
         5 000036   000022 772000                    QRL     18
         5 000037   200006 756100                    STQ     TEMP,,AUTO

     2697     1273    1       I = 5;

   1273  5 000040   000005 235007                    LDA     5,DL
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:524  
         5 000041   200005 755100                    STA     I,,AUTO

     2698     1274    2       DO WHILE( TEMP > 0);

   1274  5 000042   000000 116003                    CMPQ    0,DU
         5 000043   000066 604400 5                  TMOZ    s:1278

     2699     1275    2           SUBSTR( IC, I, 1) = BINASC( ASCBIN( '0') + MOD( TEMP, 8));

   1275  5 000044   200006 236100                    LDQ     TEMP,,AUTO
         5 000045   000010 506007                    DIV     8,DL
         5 000046   000044 733000                    LRS     36
         5 000047   000060 036007                    ADLQ    48,DL
         5 000050   000033 736000                    QLS     27
         5 000051   000001 276000 6                  ORQ     1
         5 000052   200046 756100                    STQ     TXT+31,,AUTO
         5 000053   200005 235100                    LDA     I,,AUTO
         5 000054   040005 100500                    MLR     fill='040'O
         5 000055   200046 000004                    ADSC9   TXT+31,,AUTO             cn=0,n=4
         5 000056   000060 000001 2                  ADSC9   IC,A                     cn=0,n=1

     2700     1276    2           TEMP = TEMP / 8;  I = I - 1;

   1276  5 000057   200006 236100                    LDQ     TEMP,,AUTO
         5 000060   000010 506007                    DIV     8,DL
         5 000061   200006 756100                    STQ     TEMP,,AUTO

   1276  5 000062   000001 336007                    LCQ     1,DL
         5 000063   200005 056100                    ASQ     I,,AUTO

     2701     1277    2           END;

   1277  5 000064   200006 235100                    LDA     TEMP,,AUTO
         5 000065   000044 605400 5                  TPNZ    s:1275

     2702     1278    1       CALL M$ERRMSG( FPT_ERRMSG) ALTRET( DISCONNECT_EM);

PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:525  
   1278  5 000066   000036 630400 1                  EPPR0   FPT_ERRMSG
         5 000067   420000 713400                    CLIMB   alt,+8192
         5 000070   405000 401760                    pmme    nvectors=11
         5 000071   000116 702000 5                  TSX2    DISCONNECT_EM

     2703     1279    1       CALL SEARCHR( LASTNONBLANK, SCRAP, TCM_SKIP_BLANKS, OOPS);

   1279  5 000072   000000 165400                    TCTR
         5 000073   000021 000170 2                  ADSC9   OOPS                     cn=0,n=120
         5 000074   000000 000000 xsym               ARG     TCM_SKIP_BLANKS
         5 000075   200003 000100                    ARG     LASTNONBLANK,,AUTO
         5 000076   200003 235100                    LDA     LASTNONBLANK,,AUTO
         5 000077   000033 771000                    ARL     27
         5 000100   200004 755100                    STA     SCRAP,,AUTO
         5 000101   200003 551140                    STBA    LASTNONBLANK,'40'O,AUTO
         5 000102   000105 606400 5                  TTN     s:1280
         5 000103   000167 236007                    LDQ     119,DL
         5 000104   200003 156100                    SSQ     LASTNONBLANK,,AUTO

     2704     1280    1       TCM_KEYIN.MESS_ = VECTOR( SUBSTR( OOPS, 0, LASTNONBLANK+1));

   1280  5 000105   200003 236100                    LDQ     LASTNONBLANK,,AUTO
         5 000106   000064 737000                    LLS     52
         5 000107   177640 035007                    ADLA    65440,DL
         5 000110   000002 236000 6                  LDQ     2
         5 000111   000002 757000 xsym               STAQ    TCM_KEYIN+2

     2705     1281    1       CALL M$KEYIN( TCM_KEYIN) ALTRET( DISCONNECT_EM);

   1281  5 000112   000000 630400 xsym               EPPR0   TCM_KEYIN
         5 000113   520000 713400                    CLIMB   alt,+40960
         5 000114   401400 401760                    pmme    nvectors=4
         5 000115   000116 702000 5                  TSX2    DISCONNECT_EM

     2706     1282    1   DISCONNECT_EM:
     2707     1283    1       IF TCM_TCPFLAVOR THEN

PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:526  
   1283  5 000116   000057 234000 2     DISCONNECT_* SZN     TCM_TCPFLAVOR
         5 000117   000124 605000 5                  TPL     s:1286

     2708     1284    1           WRITE_UC.V.DCB# = DCBNUM( M$ME);

   1284  5 000120   000000 236007 xsym               LDQ     M$ME,DL
         5 000121   000000 620006                    EAX0    0,QL
         5 000122   000010 740000 2                  STX0    WRITE_UC+8
         5 000123   000127 710000 5                  TRA     s:1287

     2709     1285    1       ELSE
     2710     1286    1           WRITE_UC.V.DCB# = DCBNUM( M$UC);

   1286  5 000124   000000 236007 xsym               LDQ     M$UC,DL
         5 000125   000000 620006                    EAX0    0,QL
         5 000126   000010 740000 2                  STX0    WRITE_UC+8

     2711     1287    1       CALL M$WRITE( WRITE_UC) ALTRET( IGNORED);

   1287  5 000127   000000 630400 2                  EPPR0   WRITE_UC
         5 000130   440001 713400                    CLIMB   alt,write
         5 000131   401400 401760                    pmme    nvectors=4
         5 000132   000133 702000 5                  TSX2    IGNORED

     2712     1288    1   IGNORED:
     2713     1289    1       CALL CONCAT( TXT, '.', IC, ' ', SUBSTR( OOPS, 1, 12));

   1289  5 000133   056000 236003       IGNORED      LDQ     23552,DU
         5 000134   200007 756100                    STQ     TXT,,AUTO
         5 000135   040100 100400                    MLR     fill='040'O
         5 000136   000060 000006 2                  ADSC9   IC                       cn=0,n=6
         5 000137   200007 200006                    ADSC9   TXT,,AUTO                cn=1,n=6
         5 000140   000040 236007                    LDQ     32,DL
         5 000141   200010 552104                    STBQ    TXT+1,'04'O,AUTO
         5 000142   040100 100400                    MLR     fill='040'O
         5 000143   000021 200014 2                  ADSC9   OOPS                     cn=1,n=12
         5 000144   200011 000160                    ADSC9   TXT+2,,AUTO              cn=0,n=112
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:527  

     2714     1290    1       CALL TCM$WRITE_AUDIT_OFF( 20, TXT);

   1290  5 000145   200007 630500                    EPPR0   TXT,,AUTO
         5 000146   200047 450500                    STP0    TXT+32,,AUTO
         5 000147   000004 236000 6                  LDQ     4
         5 000150   200046 756100                    STQ     TXT+31,,AUTO
         5 000151   200046 630500                    EPPR0   TXT+31,,AUTO
         5 000152   000020 631400 xsym               EPPR1   B_VECTNIL+16
         5 000153   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_OFF
         5 000154   000000 011000                    NOP     0

     2715     1291    1       IF NOT TCM_TCPFLAVOR THEN

   1291  5 000155   000057 234000 2                  SZN     TCM_TCPFLAVOR
         5 000156   000163 604000 5                  TMI     BYPASS

     2716     1292    1           CALL M$YC( TCM_YC_OFF) ALTRET( BYPASS);

   1292  5 000157   000000 630400 xsym               EPPR0   TCM_YC_OFF
         5 000160   400011 713400                    CLIMB   alt,+9
         5 000161   401000 401760                    pmme    nvectors=3
         5 000162   000163 702000 5                  TSX2    BYPASS

     2717     1293    1   BYPASS:
     2718     1294    1       CALL M$SPRIV( JIT_PRIV);

   1294  5 000163   000000 630400 xsym  BYPASS       EPPR0   JIT_PRIV
         5 000164   020012 713400                    CLIMB   8202
         5 000165   400000 401760                    pmme    nvectors=1

     2719     1295    1       B$JIT.PRIV.ACTIVE.EXMM = %YES#;  /* so we can SNAP */

   1295  5 000166   000000 470400 xsym               LDP0    B$JIT$
         5 000167   000002 236007                    LDQ     2,DL
         5 000170   000013 256100                    ORSQ    11,,PR0

PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:528  
     2720     1296    1       CALL M$SCREECH( SCREECH2);  /* ..a SNAP, really */

   1296  5 000171   000000 630400 xsym               EPPR0   SCREECH2
         5 000172   000013 713400                    CLIMB   11
         5 000173   401000 401760                    pmme    nvectors=3

     2721     1297    1       CALL M$EXIT;

   1297  5 000174   000001 713400                    CLIMB   exit
         5 000175   000000 401760                    pmme    nvectors=0

     2722     1298
     2723     1299    1       END TCM$ABORT;

   1299  5 000176   000000 702200 xent               TSX2  ! X66_AARET

CLOSE_NODES
 Sect OctLoc
   1     000   000003 777640   000032 006000   000000 177640   000000 006014    ................
   1     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     030*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   1     034   000220 000000   000000 000000                                    ........

FPT_ERRMSG
 Sect OctLoc
   1     036   000003 777640   000064 006000   000000 177640   000000 006014    .....4..........
   1     042   000035 777640   000021 006000   000000 177640   000000 006014    ................
   1     046   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     056*  000000 177640   000000 006014   000003 777640   000014 006000    ................
   1     062   000000 177640   000000 006014   000000 000000   000000 000000    ................
   1     066   375000 070001   040000 000000                                    ..8. ...

REPLY421
 Sect OctLoc
   1     070   064062 061040   040040 040040   040040 040040   040103 154157    421          Clo
   1     074   163151 156147   040164 162141   156163 155151   163163 151157    sing transmissio
   1     100   156040 143150   141156 156145   154*** ******                    n channel...
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:529  

WRITE_UC
 Sect OctLoc
   2     000   000003 777640   000010 006000   000000 177640   000000 006014    ................
   2     004   000012 177640   000070 006000   000000 177640   000000 006014    .....8..........
   2     010   000000 400400   000000 000000   000000 000000   000000 000000    ................

VLR_ERRMSG
 Sect OctLoc
   2     014   00000* ***000   000000 000000   000000 000000   ****** ******    ................

FIRST_TIME
 Sect OctLoc
   2     020   000000 000000                                                    ....

OOPS
 Sect OctLoc
   2     021   ****** ******   ****** ******   ****** ******   ****** ******    ................

TCM_TCPFLAVOR
 Sect OctLoc
   2     057   4***** ******                                                    ....

IC
 Sect OctLoc
   2     060   060060 060060   060060 ******                                    000000..

(unnamed)
 Sect OctLoc
   6     000   000000 006003   000040 040040   000021 006000   000000 000024    .....   ........
   6     004   000003 006000                                                    ....

PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:530  
--  Include file information  --

   CP_6_SUBS.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$ABORT.
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:531  

 **** Variables and constants ****

  ****  Section 001 RoData TCM$ABORT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1080)  r     1 CLOSE_NODES               36-0-0/d STRC(936)   r     1 FPT_ERRMSG
    70-0-0/c CHAR(41)    r     1 REPLY421

  ****  Section 002  Data  TCM$ABORT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    20-0-0/w UBIN        r     1 FIRST_TIME                60-0-0/c CHAR(6)     r     1 IC
    21-0-0/c CHAR(120)   r     1 OOPS                      57-0-0/b BIT         r     1 TCM_TCPFLAVOR
    14-0-0/d STRC(144)   r     1 VLR_ERRMSG                 0-0-0/d STRC(432)   r     1 WRITE_UC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w SBIN        r     1 I                          3-0-0/w UBIN        r     1 LASTNONBLANK
     4-0-0/w UBIN        r     1 SCRAP                      6-0-0/w SBIN        r     1 TEMP
     7-0-0/c CHAR(120)   r     1 TXT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/d STRC(144)   r     1 JIT_PRIV                   0-0-0/d STRC(216)   r     1 SCREECH2
     0-0-0/d STRC(504)   r     1 TCM_KEYIN
     0-0-0/c UBIN(9)     r     1 TCM_SKIP_BLANKS(0:127)
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:532  
     0-0-0/d STRC(288)   r     1 TCM_YC_OFF

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$EXCFR                    0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/w STRC(2448)  r     1 B$XCON
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0N  NULL        r     1 F$NODES
     0-0-0N  NULL        r     1 M$ME                       0-0-0N  NULL        r     1 M$UC


   Procedure TCM$ABORT requires 127 words for executable code.
   Procedure TCM$ABORT requires 40 words of local(AUTO) storage.

    No errors detected in file TCM$MAIL1.:TCA2TSI    .
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:533  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:534  
          MINI XREF LISTING

B$EXCFR.ASL
        89**DCL        89--REDEF
B$EXCFR.ECC
        89**DCL      1264>>IF
B$EXCFR.ERR.ERR#
       103**DCL       103--REDEF
B$EXCFR.EVID
       102**DCL       102--REDEF     103--REDEF
B$EXCFR.IC
        90**DCL      1272>>ASSIGN
B$EXCFR.IR
        90**DCL        90--REDEF
B$EXCFR.PREVSZ
        89**DCL        89--REDEF
B$EXCFR.SUBC
       101**DCL       101--REDEF     102--REDEF     102--REDEF
B$JIT.CPFLAGS1.SLEAZE
       518**DCL       518--REDEF
B$JIT.ERR.MID
       425**DCL       425--REDEF
B$JIT.JRESPEAK
       586**DCL       587--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       695**DCL       695--REDEF     696--REDEF
B$JIT.PNR
       599**DCL       599--REDEF
B$JIT.PRIV.ACTIVE.EXMM
       429**DCL      1295<<ASSIGN
B$JIT.TSLINE
       693**DCL       694--REDEF
B$JIT$
      1244**DCL       419--IMP-PTR  1295>>ASSIGN
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:535  
B$TCB.STK$
       107**DCL      1264>>IF       1265>>IF       1272>>ASSIGN
B$TCB$
      1243**DCL       107--IMP-PTR  1264>>IF       1265>>IF       1272>>ASSIGN
B$XCON.ERR.ERR#
       116**DCL       116--REDEF
B$XCON.LIMIT.MEM
       114**DCL       114--REDEF
B$XCON.RNST.OPERR
       112**DCL      1265>>IF
BYPASS
      1294**LABEL    1262--GOTO     1292--CALLALT
CLOSE_NODES
       246**DCL      1267<>CALL
CLOSE_NODES.SN_
       246**DCL       246--REDEF
CLOSE_NODES.UTL_
       247**DCL       247--REDEF
CLOSE_NODES.V
       251**DCL       246--DCLINIT
CLOSE_NODES.V.EXPIRE#
       261**DCL       261--REDEF
CLOSE_NODES.V.TYPE#
       259**DCL       259--REDEF
CLOSE_NODES.V.XTNSIZE#
       256**DCL       256--REDEF     258--REDEF
DISCONNECT_EM
      1283**LABEL    1278--CALLALT  1281--CALLALT
F$DCB.ACTPOS
       152**DCL       152--REDEF
F$DCB.ARS#
       126**DCL       126--REDEF
F$DCB.ATTR
       145**DCL       146--REDEF
F$DCB.BORROW
       160**DCL       160--REDEF     160--REDEF     160--REDEF
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:536  
F$DCB.DCBNAME.L
       174**DCL       174--IMP-SIZ
F$DCB.EOMCHAR#
       130**DCL       130--REDEF
F$DCB.FCD#
       139**DCL      1266>>IF
F$DCB.FLDID
       155**DCL       155--REDEF
F$DCB.FORM$
       149**DCL       149--REDEF
F$DCB.FSECT
       165**DCL       165--REDEF
F$DCB.FSN#
       142**DCL       142--REDEF     142--REDEF     143--REDEF
F$DCB.HEADER$
       148**DCL       148--REDEF
F$DCB.IXTNSIZE#
       146**DCL       146--REDEF
F$DCB.LASTSTA$
       135**DCL       135--REDEF
F$DCB.LVL
       161**DCL       161--REDEF
F$DCB.NAME#.C
       136**DCL       136--REDEF
F$DCB.NOEOF
       158**DCL       158--REDEF
F$DCB.NRECS#
       147**DCL       147--REDEF
F$DCB.NRECX
       166**DCL       166--REDEF
F$DCB.OHDR
       158**DCL       158--REDEF
F$DCB.ORG#
       141**DCL       141--REDEF
F$DCB.PRECNO
       164**DCL       164--REDEF
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:537  
F$DCB.RCSZ
       170**DCL       170--REDEF
F$DCB.RES#
       137**DCL       137--REDEF
F$DCB.SETX
       149**DCL       149--REDEF
F$DCB.TAB$
       149**DCL       149--REDEF
F$DCB.TDA
       163**DCL       164--REDEF
F$DCB.WSN#
       137**DCL       137--REDEF
F$NODES
      1246**DCL      1266--IF
FIRST_TIME
      1248**DCL      1261>>IF       1263<<ASSIGN   1268<<ASSIGN
FPT_ERRMSG
       276**DCL      1278<>CALL
FPT_ERRMSG.V
       280**DCL       276--DCLINIT
I
      1257**DCL      1273<<ASSIGN   1275>>ASSIGN   1276<<ASSIGN   1276>>ASSIGN
IC
      1256**DCL      1275<<ASSIGN   1289>>CALLBLT
IGNORED
      1289**LABEL    1287--CALLALT
JIT_PRIV
       384**DCL      1294<>CALL
LASTNONBLANK
      1249**DCL      1279<<CALLBLT  1280>>ASSIGN
M$CLOSE
        16**DCL-ENT  1267--CALL
M$ERRMSG
        79**DCL-ENT  1278--CALL
M$EXIT
        28**DCL-ENT  1297--CALL
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:538  
M$KEYIN
        21**DCL-ENT  1281--CALL
M$ME
      1247**DCL      1284>>ASSIGN
M$SCREECH
        30**DCL-ENT  1296--CALL
M$SPRIV
        75**DCL-ENT  1294--CALL
M$UC
        40**DCL      1286>>ASSIGN
M$WRITE
        17**DCL-ENT  1287--CALL
M$YC
        30**DCL-ENT  1292--CALL
NOCLOSE
      1271**LABEL    1267--CALLALT
OOPS
      1250**DCL       277--DCLINIT  1279>>CALLBLT  1280--ASSIGN   1289>>CALLBLT
REPLY421
      1251**DCL       329--DCLINIT   330--DCLINIT
SCRAP
      1253**DCL      1279<<CALLBLT
SCREECH2
       370**DCL      1296<>CALL
TCM$WRITE_AUDIT_OFF
      1241**DCL-ENT  1290--CALL
TCM_KEYIN
       303**DCL      1281<>CALL
TCM_KEYIN.MESS_
       303**DCL      1280<<ASSIGN
TCM_SKIP_BLANKS
      1254**DCL      1279>>CALLBLT
TCM_TCPFLAVOR
      1255**DCL      1283>>IF       1291>>IF
TCM_YC_OFF
       355**DCL      1292<>CALL
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:539  
TEMP
      1258**DCL      1272<<ASSIGN   1274>>DOWHILE  1275>>ASSIGN   1276<<ASSIGN   1276>>ASSIGN
TXT
      1259**DCL      1289<<CALLBLT  1290<>CALL
VLR_ERRMSG
       399**DCL       280--DCLINIT
WRITE_UC
       328**DCL      1287<>CALL
WRITE_UC.STATION_
       330**DCL       330--REDEF
WRITE_UC.V
       331**DCL       328--DCLINIT
WRITE_UC.V.DCB#
       331**DCL      1284<<ASSIGN   1286<<ASSIGN
WRITE_UC.V.DVBYTE.VFC#
       337**DCL       337--REDEF
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:540  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:541  
              MINI UREF LISTING

M$ACCT      33**DCL-ENT
M$ACTIVATE      36**DCL-ENT
M$ALIB      29**DCL-ENT
M$ASUSER      31**DCL-ENT
M$ATTACH      38**DCL-ENT
M$BADPP      56**DCL-ENT
M$CGCTL      37**DCL-ENT
M$CGINFO      37**DCL-ENT
M$CHECK      18**DCL-ENT
M$CHGUNIT      76**DCL-ENT
M$CLRSTK      74**DCL-ENT
M$CMDVAR      85**DCL-ENT
M$CONFIG      46**DCL-ENT
M$CORRES      21**DCL-ENT
M$CPEXIT      30**DCL-ENT
M$CVM      54**DCL-ENT
M$CVOL      19**DCL-ENT
M$DCLFLD      46**DCL-ENT
M$DEACTIVATE      36**DCL-ENT
M$DELREC      18**DCL-ENT
M$DEQ      83**DCL-ENT
M$DETACH      38**DCL-ENT
M$DEVICE      20**DCL-ENT
M$DISPLAY      83**DCL-ENT
M$DISPRES      23**DCL-ENT
M$DLIB      29**DCL-ENT
M$DRIBBLE      46**DCL-ENT
M$DRTN      74**DCL-ENT
M$DSUSER      31**DCL-ENT
M$ENQ      82**DCL-ENT
M$EOM      41**DCL-ENT
M$ERASE      47**DCL-ENT
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:542  
M$ERR      28**DCL-ENT
M$EVENT      71**DCL-ENT
M$EXHUME      80**DCL-ENT
M$EXTEND      20**DCL-ENT
M$FDP      52**DCL-ENT
M$FDS      51**DCL-ENT
M$FEBOOT      44**DCL-ENT
M$FECTL      45**DCL-ENT
M$FEDUMP      44**DCL-ENT
M$FID      79**DCL-ENT
M$FINDPROC      33**DCL-ENT
M$FSUSER      31**DCL-ENT
M$FVP      53**DCL-ENT
M$FWCG      37**DCL-ENT
M$GBPL      57**DCL-ENT
M$GDDL      53**DCL-ENT
M$GDP      52**DCL-ENT
M$GDS      51**DCL-ENT
M$GETDCB      22**DCL-ENT
M$GETMOUSE      62**DCL-ENT
M$GETPM      63**DCL-ENT
M$GJOB      81**DCL-ENT
M$GLINEATTR      41**DCL-ENT
M$GOODPP      56**DCL-ENT
M$GPLATEN      49**DCL-ENT
M$GPROMPT      48**DCL-ENT
M$GTRMATTR      42**DCL-ENT
M$GTRMCTL      40**DCL-ENT
M$GTRMTAB      43**DCL-ENT
M$GVP      52**DCL-ENT
M$HELP      79**DCL-ENT
M$INT      71**DCL-ENT
M$INTRTN      32**DCL-ENT
M$IOQ      67**DCL-ENT
M$JOBSTATS      81**DCL-ENT
M$LDEV      16**DCL-ENT
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:543  
M$LDTRC      29**DCL-ENT
M$LIMIT      22**DCL-ENT
M$LINES      21**DCL-ENT
M$LINK      28**DCL-ENT
M$MADMUCK      24**DCL-ENT
M$MAKUSER      55**DCL-ENT
M$MBS      23**DCL-ENT
M$MDFFLD      47**DCL-ENT
M$MERC      72**DCL-ENT
M$MERCS      73**DCL-ENT
M$MIRROR      67**DCL-ENT
M$MONINFO      84**DCL-ENT
M$MPL      57**DCL-ENT
M$NODEINFO      48**DCL-ENT
M$NXTUSR      82**DCL-ENT
M$OCMSG      80**DCL-ENT
M$OLAY      28**DCL-ENT
M$OPEN      16**DCL-ENT
M$PAS      57**DCL-ENT
M$PATHCON      80**DCL-ENT
M$PDS      51**DCL-ENT
M$PFIL      18**DCL-ENT
M$PLATEN      42**DCL-ENT
M$PRECORD      20**DCL-ENT
M$PROCNAME      33**DCL-ENT
M$PROFILE      44**DCL-ENT
M$PROMPT      40**DCL-ENT
M$RACST      24**DCL-ENT
M$RDSYSLOG      65**DCL-ENT
M$READ      17**DCL-ENT
M$RELDCB      22**DCL-ENT
M$RELRES      23**DCL-ENT
M$RELSTARF      25**DCL-ENT
M$REM      25**DCL-ENT
M$RENV      72**DCL-ENT
M$REQUIRE      24**DCL-ENT
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:544  
M$RETRY      73**DCL-ENT
M$RETRYS      73**DCL-ENT
M$REW      19**DCL-ENT
M$RLSFLD      47**DCL-ENT
M$RPRIV      75**DCL-ENT
M$RSPP      54**DCL-ENT
M$RSWITCH      76**DCL-ENT
M$RUE      82**DCL-ENT
M$SAD      55**DCL-ENT
M$SAVE      31**DCL-ENT
M$SCON      32**DCL-ENT
M$SENV      72**DCL-ENT
M$SETFMA      16**DCL-ENT
M$SETFP      45**DCL-ENT
M$SINPUT      43**DCL-ENT
M$SLCFLD      48**DCL-ENT
M$SMOUSE      62**DCL-ENT
M$SMPRT      54**DCL-ENT
M$SSC      55**DCL-ENT
M$SSWITCH      75**DCL-ENT
M$STATE      84**DCL-ENT
M$STD      56**DCL-ENT
M$STIMER      70**DCL-ENT
M$STLPP      53**DCL-ENT
M$STRAP      70**DCL-ENT
M$STRMATTR      42**DCL-ENT
M$STRMCTL      40**DCL-ENT
M$STRMTAB      43**DCL-ENT
M$SYMBIO      81**DCL-ENT
M$SYSCON      67**DCL-ENT
M$SYSID      85**DCL-ENT
M$TDCLOSE      66**DCL-ENT
M$TDIO      66**DCL-ENT
M$TDOPEN      65**DCL-ENT
M$TDREQCPU      66**DCL-ENT
M$TEMPWROC      60**DCL-ENT
PL6.E3A0      #002=TCM$ABORT File=TCM$MAIL1.:TCA2TSI                             SUN 11/16/97 14:27 Page:545  
M$TIME      83**DCL-ENT
M$TRAP      70**DCL-ENT
M$TRMISC      45**DCL-ENT
M$TRMPRG      41**DCL-ENT
M$TRTN      74**DCL-ENT
M$TRUNC      17**DCL-ENT
M$TTIMER      70**DCL-ENT
M$UMPL      57**DCL-ENT
M$UNFID      79**DCL-ENT
M$UNLATCH      36**DCL-ENT
M$UNSHARE      33**DCL-ENT
M$USRFIELD      76**DCL-ENT
M$VIRTUAL      51**DCL-ENT
M$WAIT      74**DCL-ENT
M$WEOF      19**DCL-ENT
M$WRSYSLOG      65**DCL-ENT
M$XCON      71**DCL-ENT
M$XCONRTN      32**DCL-ENT
M$XEQTIME      84**DCL-ENT
M$XFLUSH      25**DCL-ENT
M$XMOUSE      62**DCL-ENT
M$XXX      28**DCL-ENT
TCM$ABORT       6**PROC
