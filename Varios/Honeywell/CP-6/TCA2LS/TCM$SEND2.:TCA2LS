VERSION A02

PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:1    
        1        1        /*M*    TCM$SEND2   SMTP Mail Sender, part 2                        */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        TCM$START_SMTP: PROC( LOGON, ADDRESS, TYPE, FLOW_CONTROL_ENABLED);
        9        9        %INCLUDE CP_6;
       10       90            %FPT_WAIT( FPTN=WAIT_1_SEC, UNITS=1, STCLASS=CONSTANT);
       11      104            %FPT_WRITE( FPTN=WRITE_ME, DCB=M$ME);
       12      135            %VLP_EOMTABLE( FPTN=ALEX_EOMSET, VALUES="0,36,0*5,32,0*8", STCLASS=CONSTANT);
       13      154                                        /* EOM CHARS ARE <CR>, <LF>, AND ":"  */
       14      155            %VLP_EOMTABLE( FPTN=ALEX_EOMSET2, VALUES="0,36,0*14", STCLASS=CONSTANT);
       15      174                                        /* EOM CHARS ARE <CR> and <LF> */
       16      175 S      %INCLUDE B$JIT_C;
       17      176            %B$JIT0;
       18      265            %U$JIT1;
       19      339            %A$JIT6X;
       20      342        %INCLUDE TCM_COMMON_M;
       21      373        %INCLUDE TCM_SEND_E;
       22      479
       23      480    1       DCL TCM$ALEX_CONNECT ENTRY(4) ALTRET;
       24      481    1       DCL TCM$ALEX_DISCONNECT ENTRY ALTRET;
       25      482    1       DCL TCM$ALEX_READ ENTRY(7) ALTRET;
       26      483    1       DCL TCM$ALEX_WRITE ENTRY(2) ALTRET;
       27      484    1       DCL TCM$ALEX_PAD_CONNECT ENTRY(4) ALTRET;
       28      485    1       DCL TCM$TCP_CONNECT ENTRY(1) ALTRET;
       29      486    1       DCL TCM$TCP_DISCONNECT ENTRY ALTRET;
       30      487    1       DCL TCM$CL_CONNECT ENTRY(1) ALTRET;
       31      488    1       DCL TCM$CL_DISCONNECT ENTRY ALTRET;
       32      489    1       DCL TCM$CL_WRITE ENTRY(2) ALTRET;
       33      490
       34      491    1       DCL B$JIT$ PTR SYMREF;
       35      492    1       DCL TCM_SMTP_BAILOUT REMEMBER SYMREF;
       36      493    1       DCL TCM_SMTP_PROGRESS UBIN WORD SYMREF;
       37      494    1       DCL TCP_MON_ERR BIT(36) SYMREF;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:2    
       38      495
       39      496    1       DCL ADDRESS CHAR(32);
       40      497    1       DCL ALEX_ARS UBIN;
       41      498    1       DCL ALEX_BUF CHAR(128) STATIC INIT( ' ');
       42      499    1       DCL ALEX_BBUF(0:127) REDEF ALEX_BUF BIT(9);
       43      500    1       DCL ALEX_BUF_ VECTOR STATIC INIT( VECTOR( ALEX_BUF));
       44      501    1       DCL ALEX_EOM CHAR(1);
       45      502    1       DCL ALEX_ERR UBIN;
       46      503    1       DCL ALEX_MERR UBIN;
       47      504    1       DCL COLONS BIT(1);
       48      505    1       DCL 1 CMDBUF_,
       49      506    1            2 BOUND UBIN(20) UNAL,
       50      507    1            2 * BIT(16) UNAL,
       51      508    1            2 BASE$ PTR;
       52      509    1       DCL TCM_LOGON CHAR(32) STATIC SYMDEF INIT(
       53      510    1           %( CONCAT( ':SMTP,,RFC822', BITASC( '015'O))));
       54      511    1       DCL DIALSMTP CHAR(0) CONSTANT INIT( 'dial smtp');
       55      512    1       DCL DIAL_FAIL CHAR(0) CONSTANT INIT ( 'host ');
       56      513    1       DCL DIAL_PRMT CHAR(0) CONSTANT INIT( ' users');
       57      514    1       DCL EIGHT CHAR(1) CONSTANT INIT( '8');
       58      515    1       DCL 1 FAIL_,
       59      516    1            2 BOUND UBIN(20) UNAL,
       60      517    1            2 * BIT(16) UNAL,
       61      518    1            2 BASE$ PTR;
       62      519    1       DCL FLOW_CONTROL_ENABLED BIT(1) ALIGNED;
       63      520    1       DCL I UBIN;
       64      521    1       DCL IBUF CHAR(I) BASED( I$);
       65      522    1       DCL I$ PTR;
       66      523    1       DCL J UBIN;
       67      524    1       DCL JBUF CHAR(J) BASED( J$);
       68      525    1       DCL J$ PTR;
       69      526    1       DCL LOC UBIN;
       70      527    1       DCL LOCE UBIN;
       71      528    1       DCL LOGIN CHAR(35);
       72      529    1       DCL LOGIN_PRMT CHAR(0) CONSTANT INIT( 'please log ');
       73      530    1       DCL LOGON CHAR(32);
       74      531    1       DCL LPAREN CHAR(1) CONSTANT INIT( '(');
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:3    
       75      532    1       DCL M$ME DCB;
       76      533    1       DCL 1 PROMPT_,
       77      534    1            2 BOUND UBIN(20) UNAL,
       78      535    1            2 * BIT(16) UNAL,
       79      536    1            2 BASE$ PTR;
       80      537    1       DCL SETPARAMS BIT(27) CONSTANT INIT(
       81      538    1           '022030010'O);  /* DC2 CAN BS - hdx, flow control */
       82      539    1       DCL SETPARAM REDEF SETPARAMS CHAR(3);
       83      540    1       DCL SKIP_BLANKS(0:127) CONSTANT UBIN(9) CALIGNED INIT(
       84      541                        /** blank=0  alphanumeric=1  special=2  control=3 **/
       85      542    1           3*32,0,1*15,2*10,1*7,2*26,1*6,2*26,1*4,3);
       86      543    1       DCL TCM_SMTP_TYPE UBIN WORD STATIC SYMDEF;
       87      544    1       DCL 1 STATUS,
       88      545    1            2 HOST_SHUT BIT(1);
       89      546    1       DCL TERMID CHAR(0) CONSTANT INIT( 'A');
       90      547    1       DCL TERMID_PRMT CHAR(0) CONSTANT INIT( 'please type your');
       91      548    1       DCL TCM_TESTMODE BIT(1) SYMREF;
       92      549    1       DCL TIMED_OUT BIT(1);
       93      550    1       DCL TIME_OUT UBIN CONSTANT INIT( 2);
       94      551    1       DCL TVAL UBIN;
       95      552    1       DCL TYMNET CHAR(8) CONSTANT INIT( 'MULTICS');
       96      553    1       DCL TYPE UBIN;
       97      554    1       DCL T_O UBIN;
       98      555
       99      556
      100      557        %EJECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:4    
      101      558
      102      559
      103      560
      104      561
      105      562    1       COLONS = '1'B;
      106      563    1       TCM_SMTP_PROGRESS = %SMTP_BUSY;
      107      564    1       TCM_SMTP_TYPE = TYPE;
      108      565    1       FLOW_CONTROL_ENABLED = '0'B;
      109      566    1       FAIL_ = VECTOR( NIL);
      110      567    2       IF %SMTPTYPE_RES = %RES_SOCK THEN DO;
      111      568    2           CALL TCM$TCP_CONNECT( ADDRESS)
      112      569    3           WHENALTRETURN DO;
      113      570    3               IF ( TCP_MON_ERR & '777777'O) = '302314'O THEN
      114      571    3                   TCM_SMTP_PROGRESS = %SMTP_NOHOST;
      115      572    3               GOTO LOGON_ERR;
      116      573    3               END;
      117      574    2           FLOW_CONTROL_ENABLED = '1'B;  /* yah sure, for TCP/IP */
      118      575    2           GOTO CONNECTION_ESTABLISHED;
      119      576    2           END;
      120      577    2       IF %SMTPTYPE_RES = %RES_CL THEN DO;
      121      578    2           CALL TCM$CL_CONNECT( ADDRESS) ALTRET( LOGON_ERR);
      122      579    2           GOTO CONNECTION_ESTABLISHED;
      123      580    2           END;
      124      581    2       IF ADDRESS ~= ' ' THEN DO;
      125      582    2           CALL TCM$ALEX_PAD_CONNECT( ADDRESS, 0, STATUS, TCM_SMTP_BAILOUT)
      126      583    3           WHENRETURN DO;
      127      584    3               FLOW_CONTROL_ENABLED = '1'B;
      128      585    3               GOTO CONNECTION_ESTABLISHED;
      129      586    3               END;
      130      587    2           END;
      131      588    2       IF STATUS.HOST_SHUT THEN DO;
      132      589    2           TCM_SMTP_PROGRESS = %SMTP_NOHOST;
      133      590    2           UNWIND TO TCM_SMTP_BAILOUT;
      134      591    2           END;
      135      592    1       CALL TCM$ALEX_CONNECT( TYMNET, 2, STATUS, TCM_SMTP_BAILOUT) ALTRET( LOGON_ERR);
      136      593    1       CALL TCM$ALEX_READ( VECTOR( ALEX_BUF), 10, , , ALEX_ARS, ALEX_MERR) ALTRET(
               593                LOGON_ERR);
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:5    
      137      594    1       CALL STRIP_PARITY;
      138      595    1       CALL INDEX( LOC, TERMID_PRMT, ALEX_BUF) ALTRET( LOGON_ERR);
      139      596    1       CALL TCM$ALEX_WRITE( VECTOR( TERMID), ALEX_MERR) ALTRET( LOGON_ERR);
      140      597    1       WRITE_ME.BUF_ = ALEX_BUF_;
      141      598    1       CALL M$WRITE( WRITE_ME);
      142      599    1       WRITE_ME.BUF_ = VECTOR( TERMID);
      143      600    1       CALL M$WRITE( WRITE_ME);
      144      601    1       CALL CONCAT( LOGIN, SETPARAM, LOGON);
      145      602    1       CMDBUF_ = VECTOR( LOGIN);
      146      603    1       CALL INDEX( TVAL, ' ', LOGIN)
      147      604    2       WHENRETURN DO;
      148      605    2           CMDBUF_ = VECTOR( SUBSTR( LOGIN, 0, TVAL));
      149      606    2           END;
      150      607    1       PROMPT_ = VECTOR( LOGIN_PRMT);
      151      608    1       CALL WRITE_LOGON ALTRET( LOGON_ERR);
      152      609    1       TCM_SMTP_PROGRESS = %SMTP_NOHOST;
      153      610    1   CONNECTION_ESTABLISHED:
      154      611    1       COLONS = '0'B;
      155      612    2       DO CASE( %SMTPTYPE_RCVR);
      156      613    2           CASE( %RCVR_NONE);
      157      614    2               ;  /* don't have to do anything */
      158      615    2           CASE( %RCVR_DIAL);
      159      616    2               CMDBUF_ = VECTOR( DIALSMTP);
      160      617    2               PROMPT_ = VECTOR( DIAL_PRMT);
      161      618    2               FAIL_ = VECTOR( DIAL_FAIL);
      162      619    2               CALL WRITE_LOGON ALTRET( LOGON_ERR);
      163      620    2           CASE( %RCVR_CP6);
      164      621    3               IF %SMTPTYPE_RES = %RES_ALEX THEN DO;
      165      622    3                   CALL M$WAIT( WAIT_1_SEC);
      166      623    3                   CALL M$WAIT( WAIT_1_SEC);
      167      624    4                   DO TVAL = 0 TO 8;
      168      625    4                       CALL M$WAIT( WAIT_1_SEC);
      169      626    4                       CALL TCM$ALEX_WRITE( VECTOR( EIGHT), ALEX_MERR)
      170      627    4                               ALTRET( LOGON_ERR);
      171      628    4                       CALL M$WAIT( WAIT_1_SEC);
      172      629    4                       END;
      173      630    3                   CALL M$WAIT( WAIT_1_SEC);
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:6    
      174      631    3                   CALL TCM$ALEX_WRITE( VECTOR( LPAREN), ALEX_MERR)
      175      632    3                           ALTRET( LOGON_ERR);
      176      633    3                   CALL M$WAIT( WAIT_1_SEC);
      177      634    3                   CALL TCM$ALEX_WRITE( VECTOR( TCM_LOGON), ALEX_MERR)
      178      635    3                           ALTRET( LOGON_ERR);
      179      636    3                   END;
      180      637    2               IF %SMTPTYPE_RES = %RES_CL THEN
      181      638    2                   CALL TCM$CL_WRITE( VECTOR( TCM_LOGON), ALEX_MERR)
      182      639    2                           ALTRET( LOGON_ERR);
      183      640    2           CASE( %RCVR_GCOS6);
      184      641    2               CALL GCOS6 ALTRET( LOGON_ERR);
      185      642    2           CASE( %RCVR_GCOS8);
      186      643    2               GOTO LOGON_ERR;  /* GCOS8 NOT SUPPORTED */
      187      644    2           END;
      188      645    1   LOG_DONE:
      189      646    1       TCM_TESTMODE = %FALSE;
      190      647    1   GO_RETURN:
      191      648    1       RETURN;
      192      649    1   LOGON_ERR:
      193      650    1       UNWIND TO TCM_SMTP_BAILOUT;
      194      651        %EJECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:7    
      195      652    1   GCOS6: PROC ALTRET;
      196      653    2       DCL FC_PRMPT CHAR(0) CONSTANT INIT( 'Ready');
      197      654    2       DCL FIRST_CMD CHAR(0) CONSTANT INIT( 'EC >NETMAIL>DIAL>START_UP.EC');
      198      655    2       DCL LOG CHAR(0) CONSTANT INIT( 'L NETMAIL');
      199      656    2       DCL LOG_PRMPT CHAR(0) CONSTANT INIT( 'LOGIN');
      200      657    2       DCL PASSW CHAR(0) CONSTANT INIT( 'NETMAIL');
      201      658    2       DCL PASSW_PRMPT CHAR(0) CONSTANT INIT( 'PLEASE ENTER YOUR PASSWORD');
      202      659
      203      660    2       CMDBUF_ = VECTOR( LOG);
      204      661    2       PROMPT_ = VECTOR( LOG_PRMPT);
      205      662    2       CALL WRITE_LOGON ALTRET( GCOS_ERR);
      206      663    2       CMDBUF_ = VECTOR( PASSW);
      207      664    2       PROMPT_ = VECTOR( PASSW_PRMPT);
      208      665    2       CALL WRITE_LOGON ALTRET( GCOS_ERR);
      209      666    2       CMDBUF_ = VECTOR( FIRST_CMD);
      210      667    2       PROMPT_ = VECTOR( FC_PRMPT);
      211      668    2       CALL WRITE_LOGON ALTRET( GCOS_ERR);
      212      669    2       RETURN;
      213      670    2   GCOS_ERR:
      214      671    2       ALTRETURN;
      215      672    2   END GCOS6;
      216      673        %EJECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:8    
      217      674    1   WRITE_LOGON: PROC ALTRET;
      218      675
      219      676    2       DCL FOUNDIT BIT(1);
      220      677    2       DCL ONECHAR CHAR(1) BASED;
      221      678    2       DCL TEMP UBIN;
      222      679
      223      680    2       I = PROMPT_.BOUND + 1;
      224      681    2       I$ = PROMPT_.BASE$;
      225      682    2       IF FAIL_ = VECTOR( NIL) THEN
      226      683    2           J = 0;
      227      684    3       ELSE DO;
      228      685    3           J = FAIL_.BOUND + 1;
      229      686    3           J$ = FAIL_.BASE$;
      230      687    3           FAIL_ = VECTOR( NIL);
      231      688    3           END;
      232      689    2       FOUNDIT = '0'B;
      233      690    3       DO UNTIL FOUNDIT;
      234      691    3   REREAD:
      235      692    4           DO T_O = 1 TO TIME_OUT;
      236      693    4               IF COLONS THEN
      237      694    4                   CALL TCM$ALEX_READ( VECTOR( ALEX_BUF), 30,
      238      695    4                           ALEX_EOMSET, ALEX_EOM, ALEX_ARS, ALEX_MERR, TIMED_OUT)
      239      696    4                           ALTRET( GO_ALTRET);
      240      697    4               ELSE
      241      698    4                   CALL TCM$ALEX_READ( VECTOR( ALEX_BUF), 30,
      242      699    4                           ALEX_EOMSET2, ALEX_EOM, ALEX_ARS, ALEX_MERR, TIMED_OUT)
      243      700    4                           ALTRET( GO_ALTRET);
      244      701    4               IF TIMED_OUT AND
      245      702    4                       ( TCM_SMTP_TYPE ~= %SMTP_GCOS6 AND TCM_SMTP_TYPE ~= %SMTP_GCOS8)
               702                                THEN
      246      703    4                   GOTO GO_ALTRET;
      247      704    4               IF NOT TIMED_OUT THEN
      248      705    4                   GOTO RESUME;
      249      706    4               END;
      250      707    3           GOTO IGNORE;
      251      708    3   RESUME:
      252      709    3           IF ALEX_ARS = 0 THEN
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:9    
      253      710    3               GOTO REREAD;
      254      711    3           WRITE_ME.BUF_ = VECTOR( ALEX_BUF);
      255      712    3           WRITE_ME.BUF_.BOUND = ALEX_ARS - 1;
      256      713    3           CALL STRIP_PARITY;
      257      714    4           DO WHILE WRITE_ME.BUF_.BOUND > 0 AND
      258      715    4                   WRITE_ME.BUF_.BUF$->ONECHAR < ' ';
      259      716    4               WRITE_ME.BUF_.BUF$ = PINCRC( WRITE_ME.BUF_.BUF$, 1);
      260      717    4               WRITE_ME.BUF_.BOUND = WRITE_ME.BUF_.BOUND - 1;
      261      718    4               END;
      262      719    3           CALL M$WRITE( WRITE_ME);
      263      720    3           CALL INDEX( TEMP, IBUF, SUBSTR( ALEX_BUF, 0, ALEX_ARS))
      264      721    4           WHENRETURN DO;
      265      722    4               FOUNDIT = '1'B;
      266      723    4               END;
      267      724    4           IF J > 0 THEN DO;
      268      725    4               CALL INDEX( TEMP, JBUF, SUBSTR( ALEX_BUF, 0, ALEX_ARS))
      269      726    5               WHENRETURN DO;
      270      727    5                   ALTRETURN;
      271      728    5                   END;
      272      729    4               END;
      273      730    3           END;
      274      731    2   IGNORE:
      275      732    2       I = CMDBUF_.BOUND + 1;
      276      733    2       I$ = CMDBUF_.BASE$;
      277      734    2       ALEX_BUF = IBUF;
      278      735    2       SUBSTR( ALEX_BUF, I, 1) = BINASC( 13/*CR*/);
      279      736    2       VBOUND( ALEX_BUF_) = I;
      280      737    2       CALL TCM$ALEX_WRITE( ALEX_BUF_, ALEX_ERR) ALTRET( GO_ALTRET);
      281      738    2       WRITE_ME.BUF_ = CMDBUF_;
      282      739    2       CALL M$WRITE( WRITE_ME);
      283      740    2       RETURN;
      284      741    2   GO_ALTRET:
      285      742    2       ALTRETURN;
      286      743
      287      744    2       END WRITE_LOGON;
      288      745        %EJECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:10   
      289      746    1   STRIP_PARITY: PROC;
      290      747
      291      748    2       DCL I SBIN;
      292      749
      293      750    3       DO I = 0 TO ALEX_ARS - 1;
      294      751    3           ALEX_BBUF( I) = ALEX_BBUF( I) & '177'O;
      295      752    3           END;
      296      753    2       RETURN;
      297      754
      298      755    2       END STRIP_PARITY;
      299      756        %EJECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:11   
      300      757    1   TCM$STOP_SMTP: ENTRY;
      301      758
      302      759    2       DO SELECT( %SMTPTYPE_RES);
      303      760    2           SELECT( %RES_ALEX);
      304      761    2               CALL TCM$ALEX_DISCONNECT;
      305      762    2           SELECT( %RES_SOCK);
      306      763    2               CALL TCM$TCP_DISCONNECT;
      307      764    2           SELECT( %RES_CL);
      308      765    2               CALL TCM$CL_DISCONNECT;
      309      766    2           END;
      310      767    1       RETURN;
      311      768
      312      769    1       END TCM$START_SMTP;
      313      770        %EOD;

PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:12   
--  Include file information  --

   TCM_SEND_E.:TCA2TOU  is referenced.
   TCM_COMMON_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$START_SMTP.

   Procedure TCM$START_SMTP requires 497 words for executable code.
   Procedure TCM$START_SMTP requires 54 words of local(AUTO) storage.

PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:13   

 Object Unit name= TCM$START_SMTP                             File name= TCM$SEND2.:TCA2TOU
 UTS= NOV 16 '97 14:18:52.32 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     98    142  TCM$START_SMTP
    2   Data  even  none    55     67  TCM$START_SMTP
    3   DCB   even  none     0      0  M$ME
    4   Proc  even  none   497    761  TCM$START_SMTP
    5  RoData even  none    53     65  TCM$START_SMTP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes            yes      Std        4  TCM$START_SMTP
     4    723                  yes      Std        0  TCM$STOP_SMTP

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    2     56  TCM_LOGON                          2     66  TCM_SMTP_TYPE
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:14   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 TCM$TCP_CONNECT
 yes     yes           Std       1 TCM$CL_CONNECT
 yes     yes           Std       4 TCM$ALEX_PAD_CONNECT
 yes     yes           Std       4 TCM$ALEX_CONNECT
 yes     yes           Std       7 TCM$ALEX_READ
 yes     yes           Std       2 TCM$CL_WRITE
 yes     yes           Std       0 TCM$CL_DISCONNECT
 yes     yes           Std       2 TCM$ALEX_WRITE
 yes     yes           Std       0 TCM$ALEX_DISCONNECT
 yes     yes           Std       0 TCM$TCP_DISCONNECT
                       nStd      0 X66_AUTO_4
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUNWIND
                       nStd      0 X66_INDEX
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B$JIT$                                TCM_SMTP_BAILOUT
     TCM_SMTP_PROGRESS                     TCP_MON_ERR                           M$ME
     TCM_TESTMODE                          B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:15   


        1        1        /*M*    TCM$SEND2   SMTP Mail Sender, part 2                        */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        TCM$START_SMTP: PROC( LOGON, ADDRESS, TYPE, FLOW_CONTROL_ENABLED);

      8  4 000000   000000 700200 xent  TCM$START_S* TSX0  ! X66_AUTO_4
         4 000001   000066 000004                    ZERO    54,4

        9        9        %INCLUDE CP_6;
       10       90            %FPT_WAIT( FPTN=WAIT_1_SEC, UNITS=1, STCLASS=CONSTANT);
       11      104            %FPT_WRITE( FPTN=WRITE_ME, DCB=M$ME);
       12      135            %VLP_EOMTABLE( FPTN=ALEX_EOMSET, VALUES="0,36,0*5,32,0*8", STCLASS=CONSTANT);
       13      154                                        /* EOM CHARS ARE <CR>, <LF>, AND ":"  */
       14      155            %VLP_EOMTABLE( FPTN=ALEX_EOMSET2, VALUES="0,36,0*14", STCLASS=CONSTANT);
       15      174                                        /* EOM CHARS ARE <CR> and <LF> */
       16      175 S      %INCLUDE B$JIT_C;
       17      176            %B$JIT0;
       18      265            %U$JIT1;
       19      339            %A$JIT6X;
       20      342        %INCLUDE TCM_COMMON_M;
       21      373        %INCLUDE TCM_SEND_E;
       22      479
       23      480    1       DCL TCM$ALEX_CONNECT ENTRY(4) ALTRET;
       24      481    1       DCL TCM$ALEX_DISCONNECT ENTRY ALTRET;
       25      482    1       DCL TCM$ALEX_READ ENTRY(7) ALTRET;
       26      483    1       DCL TCM$ALEX_WRITE ENTRY(2) ALTRET;
       27      484    1       DCL TCM$ALEX_PAD_CONNECT ENTRY(4) ALTRET;
       28      485    1       DCL TCM$TCP_CONNECT ENTRY(1) ALTRET;
       29      486    1       DCL TCM$TCP_DISCONNECT ENTRY ALTRET;
       30      487    1       DCL TCM$CL_CONNECT ENTRY(1) ALTRET;
       31      488    1       DCL TCM$CL_DISCONNECT ENTRY ALTRET;
       32      489    1       DCL TCM$CL_WRITE ENTRY(2) ALTRET;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:16   
       33      490
       34      491    1       DCL B$JIT$ PTR SYMREF;
       35      492    1       DCL TCM_SMTP_BAILOUT REMEMBER SYMREF;
       36      493    1       DCL TCM_SMTP_PROGRESS UBIN WORD SYMREF;
       37      494    1       DCL TCP_MON_ERR BIT(36) SYMREF;
       38      495
       39      496    1       DCL ADDRESS CHAR(32);
       40      497    1       DCL ALEX_ARS UBIN;
       41      498    1       DCL ALEX_BUF CHAR(128) STATIC INIT( ' ');
       42      499    1       DCL ALEX_BBUF(0:127) REDEF ALEX_BUF BIT(9);
       43      500    1       DCL ALEX_BUF_ VECTOR STATIC INIT( VECTOR( ALEX_BUF));
       44      501    1       DCL ALEX_EOM CHAR(1);
       45      502    1       DCL ALEX_ERR UBIN;
       46      503    1       DCL ALEX_MERR UBIN;
       47      504    1       DCL COLONS BIT(1);
       48      505    1       DCL 1 CMDBUF_,
       49      506    1            2 BOUND UBIN(20) UNAL,
       50      507    1            2 * BIT(16) UNAL,
       51      508    1            2 BASE$ PTR;
       52      509    1       DCL TCM_LOGON CHAR(32) STATIC SYMDEF INIT(
       53      510    1           %( CONCAT( ':SMTP,,RFC822', BITASC( '015'O))));
       54      511    1       DCL DIALSMTP CHAR(0) CONSTANT INIT( 'dial smtp');
       55      512    1       DCL DIAL_FAIL CHAR(0) CONSTANT INIT ( 'host ');
       56      513    1       DCL DIAL_PRMT CHAR(0) CONSTANT INIT( ' users');
       57      514    1       DCL EIGHT CHAR(1) CONSTANT INIT( '8');
       58      515    1       DCL 1 FAIL_,
       59      516    1            2 BOUND UBIN(20) UNAL,
       60      517    1            2 * BIT(16) UNAL,
       61      518    1            2 BASE$ PTR;
       62      519    1       DCL FLOW_CONTROL_ENABLED BIT(1) ALIGNED;
       63      520    1       DCL I UBIN;
       64      521    1       DCL IBUF CHAR(I) BASED( I$);
       65      522    1       DCL I$ PTR;
       66      523    1       DCL J UBIN;
       67      524    1       DCL JBUF CHAR(J) BASED( J$);
       68      525    1       DCL J$ PTR;
       69      526    1       DCL LOC UBIN;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:17   
       70      527    1       DCL LOCE UBIN;
       71      528    1       DCL LOGIN CHAR(35);
       72      529    1       DCL LOGIN_PRMT CHAR(0) CONSTANT INIT( 'please log ');
       73      530    1       DCL LOGON CHAR(32);
       74      531    1       DCL LPAREN CHAR(1) CONSTANT INIT( '(');
       75      532    1       DCL M$ME DCB;
       76      533    1       DCL 1 PROMPT_,
       77      534    1            2 BOUND UBIN(20) UNAL,
       78      535    1            2 * BIT(16) UNAL,
       79      536    1            2 BASE$ PTR;
       80      537    1       DCL SETPARAMS BIT(27) CONSTANT INIT(
       81      538    1           '022030010'O);  /* DC2 CAN BS - hdx, flow control */
       82      539    1       DCL SETPARAM REDEF SETPARAMS CHAR(3);
       83      540    1       DCL SKIP_BLANKS(0:127) CONSTANT UBIN(9) CALIGNED INIT(
       84      541                        /** blank=0  alphanumeric=1  special=2  control=3 **/
       85      542    1           3*32,0,1*15,2*10,1*7,2*26,1*6,2*26,1*4,3);
       86      543    1       DCL TCM_SMTP_TYPE UBIN WORD STATIC SYMDEF;
       87      544    1       DCL 1 STATUS,
       88      545    1            2 HOST_SHUT BIT(1);
       89      546    1       DCL TERMID CHAR(0) CONSTANT INIT( 'A');
       90      547    1       DCL TERMID_PRMT CHAR(0) CONSTANT INIT( 'please type your');
       91      548    1       DCL TCM_TESTMODE BIT(1) SYMREF;
       92      549    1       DCL TIMED_OUT BIT(1);
       93      550    1       DCL TIME_OUT UBIN CONSTANT INIT( 2);
       94      551    1       DCL TVAL UBIN;
       95      552    1       DCL TYMNET CHAR(8) CONSTANT INIT( 'MULTICS');
       96      553    1       DCL TYPE UBIN;
       97      554    1       DCL T_O UBIN;
       98      555
       99      556
      100      557        %EJECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:18   
      101      558
      102      559
      103      560
      104      561
      105      562    1       COLONS = '1'B;

    562  4 000002   400000 236003                    LDQ     -131072,DU
         4 000003   200013 756100                    STQ     COLONS,,AUTO

      106      563    1       TCM_SMTP_PROGRESS = %SMTP_BUSY;

    563  4 000004   000001 235007                    LDA     1,DL
         4 000005   000000 755000 xsym               STA     TCM_SMTP_PROGRESS

      107      564    1       TCM_SMTP_TYPE = TYPE;

    564  4 000006   200005 470500                    LDP0    @TYPE,,AUTO
         4 000007   000000 235100                    LDA     0,,PR0
         4 000010   000066 755000 2                  STA     TCM_SMTP_TYPE

      108      565    1       FLOW_CONTROL_ENABLED = '0'B;

    565  4 000011   200006 471500                    LDP1    @FLOW_CONTROL_ENABLED,,AUTO
         4 000012   100000 450100                    STZ     0,,PR1

      109      566    1       FAIL_ = VECTOR( NIL);

    566  4 000013   000000 237000 5                  LDAQ    0
         4 000014   200016 757100                    STAQ    FAIL_,,AUTO

      110      567    2       IF %SMTPTYPE_RES = %RES_SOCK THEN DO;

    567  4 000015   000066 236000 2                  LDQ     TCM_SMTP_TYPE
         4 000016   000011 772000                    QRL     9
         4 000017   000007 376007                    ANQ     7,DL
         4 000020   000002 116007                    CMPQ    2,DL
         4 000021   000042 601000 4                  TNZ     s:577
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:19   

      111      568    2           CALL TCM$TCP_CONNECT( ADDRESS)

    568  4 000022   200004 630500                    EPPR0   @ADDRESS,,AUTO
         4 000023   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000024   000000 701000 xent               TSX1    TCM$TCP_CONNECT
         4 000025   000027 702000 4                  TSX2    s:570
         4 000026   000036 710000 4                  TRA     s:574

      112      569    3           WHENALTRETURN DO;

      113      570    3               IF ( TCP_MON_ERR & '777777'O) = '302314'O THEN

    570  4 000027   000000 236000 xsym               LDQ     TCP_MON_ERR
         4 000030   777777 376003                    ANQ     -1,DU
         4 000031   302314 116003                    CMPQ    99532,DU
         4 000032   000035 601000 4                  TNZ     s:572

      114      571    3                   TCM_SMTP_PROGRESS = %SMTP_NOHOST;

    571  4 000033   000002 235007                    LDA     2,DL
         4 000034   000000 755000 xsym               STA     TCM_SMTP_PROGRESS

      115      572    3               GOTO LOGON_ERR;

    572  4 000035   000370 710000 4                  TRA     LOGON_ERR

      116      573    3               END;
      117      574    2           FLOW_CONTROL_ENABLED = '1'B;  /* yah sure, for TCP/IP */

    574  4 000036   400000 236003                    LDQ     -131072,DU
         4 000037   200006 470500                    LDP0    @FLOW_CONTROL_ENABLED,,AUTO
         4 000040   000000 756100                    STQ     0,,PR0

      118      575    2           GOTO CONNECTION_ESTABLISHED;

    575  4 000041   000232 710000 4                  TRA     CONNECTION_ESTABLISHED
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:20   

      119      576    2           END;
      120      577    2       IF %SMTPTYPE_RES = %RES_CL THEN DO;

    577  4 000042   000066 236000 2                  LDQ     TCM_SMTP_TYPE
         4 000043   000011 772000                    QRL     9
         4 000044   000007 376007                    ANQ     7,DL
         4 000045   000003 116007                    CMPQ    3,DL
         4 000046   000054 601000 4                  TNZ     s:581

      121      578    2           CALL TCM$CL_CONNECT( ADDRESS) ALTRET( LOGON_ERR);

    578  4 000047   200004 630500                    EPPR0   @ADDRESS,,AUTO
         4 000050   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000051   000000 701000 xent               TSX1    TCM$CL_CONNECT
         4 000052   000370 702000 4                  TSX2    LOGON_ERR

      122      579    2           GOTO CONNECTION_ESTABLISHED;

    579  4 000053   000232 710000 4                  TRA     CONNECTION_ESTABLISHED

      123      580    2           END;
      124      581    2       IF ADDRESS ~= ' ' THEN DO;

    581  4 000054   200004 473500                    LDP3    @ADDRESS,,AUTO
         4 000055   040000 106500                    CMPC    fill='040'O
         4 000056   300000 000040                    ADSC9   0,,PR3                   cn=0,n=32
         4 000057   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 000060   000100 600000 4                  TZE     s:588

      125      582    2           CALL TCM$ALEX_PAD_CONNECT( ADDRESS, 0, STATUS, TCM_SMTP_BAILOUT)

    582  4 000061   000002 236000 5                  LDQ     2
         4 000062   200061 756100                    STQ     I+4,,AUTO
         4 000063   200041 634500                    EPPR4   STATUS,,AUTO
         4 000064   200060 454500                    STP4    I+3,,AUTO
         4 000065   000003 236000 5                  LDQ     3
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:21   
         4 000066   200004 235100                    LDA     @ADDRESS,,AUTO
         4 000067   200056 757100                    STAQ    I+1,,AUTO
         4 000070   200056 630500                    EPPR0   I+1,,AUTO
         4 000071   000022 631400 xsym               EPPR1   B_VECTNIL+18
         4 000072   000000 701000 xent               TSX1    TCM$ALEX_PAD_CONNECT
         4 000073   000100 702000 4                  TSX2    s:588

      126      583    3           WHENRETURN DO;

      127      584    3               FLOW_CONTROL_ENABLED = '1'B;

    584  4 000074   400000 236003                    LDQ     -131072,DU
         4 000075   200006 470500                    LDP0    @FLOW_CONTROL_ENABLED,,AUTO
         4 000076   000000 756100                    STQ     0,,PR0

      128      585    3               GOTO CONNECTION_ESTABLISHED;

    585  4 000077   000232 710000 4                  TRA     CONNECTION_ESTABLISHED

      129      586    3               END;
      130      587    2           END;

      131      588    2       IF STATUS.HOST_SHUT THEN DO;

    588  4 000100   200041 234100                    SZN     STATUS,,AUTO
         4 000101   000107 605000 4                  TPL     s:592

      132      589    2           TCM_SMTP_PROGRESS = %SMTP_NOHOST;

    589  4 000102   000002 235007                    LDA     2,DL
         4 000103   000000 755000 xsym               STA     TCM_SMTP_PROGRESS

      133      590    2           UNWIND TO TCM_SMTP_BAILOUT;

    590  4 000104   000000 237200 xsym               LDAQ  ! TCM_SMTP_BAILOUT
         4 000105   000000 700200 xent               TSX0  ! X66_AUNWIND
         4 000106   000000 000200                    ZERO    0,128
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:22   

      134      591    2           END;
      135      592    1       CALL TCM$ALEX_CONNECT( TYMNET, 2, STATUS, TCM_SMTP_BAILOUT) ALTRET( LOGON_ERR);

    592  4 000107   000002 236000 5                  LDQ     2
         4 000110   200061 756100                    STQ     I+4,,AUTO
         4 000111   200041 630500                    EPPR0   STATUS,,AUTO
         4 000112   200060 450500                    STP0    I+3,,AUTO
         4 000113   000004 237000 5                  LDAQ    4
         4 000114   200056 757100                    STAQ    I+1,,AUTO
         4 000115   200056 630500                    EPPR0   I+1,,AUTO
         4 000116   000022 631400 xsym               EPPR1   B_VECTNIL+18
         4 000117   000000 701000 xent               TSX1    TCM$ALEX_CONNECT
         4 000120   000370 702000 4                  TSX2    LOGON_ERR

      136      593    1       CALL TCM$ALEX_READ( VECTOR( ALEX_BUF), 10, , , ALEX_ARS, ALEX_MERR) ALTRET(
               593                LOGON_ERR);

    593  4 000121   200012 630500                    EPPR0   ALEX_MERR,,AUTO
         4 000122   200063 450500                    STP0    I+6,,AUTO
         4 000123   200007 631500                    EPPR1   ALEX_ARS,,AUTO
         4 000124   200062 451500                    STP1    I+5,,AUTO
         4 000125   000001 236000 xsym               LDQ     B_VECTNIL+1
         4 000126   000001 235000 xsym               LDA     B_VECTNIL+1
         4 000127   200060 757100                    STAQ    I+3,,AUTO
         4 000130   000010 237000 5                  LDAQ    8
         4 000131   200056 757100                    STAQ    I+1,,AUTO
         4 000132   200056 630500                    EPPR0   I+1,,AUTO
         4 000133   000024 631400 xsym               EPPR1   B_VECTNIL+20
         4 000134   000000 701000 xent               TSX1    TCM$ALEX_READ
         4 000135   000370 702000 4                  TSX2    LOGON_ERR

      137      594    1       CALL STRIP_PARITY;

    594  4 000136   000677 701000 4                  TSX1    STRIP_PARITY
         4 000137   000000 011000                    NOP     0

PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:23   
      138      595    1       CALL INDEX( LOC, TERMID_PRMT, ALEX_BUF) ALTRET( LOGON_ERR);

    595  4 000140   200024 631500                    EPPR1   LOC,,AUTO
         4 000141   000104 633400 1                  EPPR3   TERMID_PRMT
         4 000142   000020 223003                    LDX3    16,DU
         4 000143   000014 630400 2                  EPPR0   ALEX_BUF
         4 000144   000200 220003                    LDX0    128,DU
         4 000145   000000 236003                    LDQ     0,DU
         4 000146   000000 701000 xent               TSX1    X66_INDEX
         4 000147   000370 710000 4                  TRA     LOGON_ERR

      139      596    1       CALL TCM$ALEX_WRITE( VECTOR( TERMID), ALEX_MERR) ALTRET( LOGON_ERR);

    596  4 000150   200012 630500                    EPPR0   ALEX_MERR,,AUTO
         4 000151   200057 450500                    STP0    I+2,,AUTO
         4 000152   000014 236000 5                  LDQ     12
         4 000153   200056 756100                    STQ     I+1,,AUTO
         4 000154   200056 630500                    EPPR0   I+1,,AUTO
         4 000155   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000156   000000 701000 xent               TSX1    TCM$ALEX_WRITE
         4 000157   000370 702000 4                  TSX2    LOGON_ERR

      140      597    1       WRITE_ME.BUF_ = ALEX_BUF_;

    597  4 000160   000054 237000 2                  LDAQ    ALEX_BUF_
         4 000161   000004 757000 2                  STAQ    WRITE_ME+4

      141      598    1       CALL M$WRITE( WRITE_ME);

    598  4 000162   000000 630400 2                  EPPR0   WRITE_ME
         4 000163   040001 713400                    CLIMB   write
         4 000164   401400 401760                    pmme    nvectors=4

      142      599    1       WRITE_ME.BUF_ = VECTOR( TERMID);

    599  4 000165   000012 237000 5                  LDAQ    10
         4 000166   000004 757000 2                  STAQ    WRITE_ME+4
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:24   

      143      600    1       CALL M$WRITE( WRITE_ME);

    600  4 000167   000000 630400 2                  EPPR0   WRITE_ME
         4 000170   040001 713400                    CLIMB   write
         4 000171   401400 401760                    pmme    nvectors=4

      144      601    1       CALL CONCAT( LOGIN, SETPARAM, LOGON);

    601  4 000172   000042 236000 1                  LDQ     SETPARAMS
         4 000173   000015 376000 5                  ANQ     13
         4 000174   000040 276007                    ORQ     32,DL
         4 000175   200026 756100                    STQ     LOGIN,,AUTO
         4 000176   200003 470500                    LDP0    @LOGON,,AUTO
         4 000177   040100 100500                    MLR     fill='040'O
         4 000200   000000 000040                    ADSC9   0,,PR0                   cn=0,n=32
         4 000201   200026 600040                    ADSC9   LOGIN,,AUTO              cn=3,n=32

      145      602    1       CMDBUF_ = VECTOR( LOGIN);

    602  4 000202   000016 235000 5                  LDA     14
         4 000203   200056 452500                    STP2    I+1,,AUTO
         4 000204   200056 236100                    LDQ     I+1,,AUTO
         4 000205   000026 036003                    ADLQ    22,DU
         4 000206   200014 757100                    STAQ    CMDBUF_,,AUTO

      146      603    1       CALL INDEX( TVAL, ' ', LOGIN)

    603  4 000207   000000 124500                    SCM     mask='000'O
         4 000210   200026 000043                    ADSC9   LOGIN,,AUTO              cn=0,n=35
         4 000211   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 000212   200043 000100                    ARG     TVAL,,AUTO
         4 000213   000223 606400 4                  TTN     s:607

      147      604    2       WHENRETURN DO;

      148      605    2           CMDBUF_ = VECTOR( SUBSTR( LOGIN, 0, TVAL));
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:25   

    605  4 000214   200043 235100                    LDA     TVAL,,AUTO
         4 000215   000020 735000                    ALS     16
         4 000216   000140 135007                    SBLA    96,DL
         4 000217   200056 452500                    STP2    I+1,,AUTO
         4 000220   200056 236100                    LDQ     I+1,,AUTO
         4 000221   000026 036003                    ADLQ    22,DU
         4 000222   200014 757100                    STAQ    CMDBUF_,,AUTO

      149      606    2           END;

      150      607    1       PROMPT_ = VECTOR( LOGIN_PRMT);

    607  4 000223   000020 237000 5                  LDAQ    16
         4 000224   200037 755100                    STA     PROMPT_,,AUTO
         4 000225   200040 756100                    STQ     PROMPT_+1,,AUTO

      151      608    1       CALL WRITE_LOGON ALTRET( LOGON_ERR);

    608  4 000226   000425 701000 4                  TSX1    WRITE_LOGON
         4 000227   000370 702000 4                  TSX2    LOGON_ERR

      152      609    1       TCM_SMTP_PROGRESS = %SMTP_NOHOST;

    609  4 000230   000002 235007                    LDA     2,DL
         4 000231   000000 755000 xsym               STA     TCM_SMTP_PROGRESS

      153      610    1   CONNECTION_ESTABLISHED:
      154      611    1       COLONS = '0'B;

    611  4 000232   200013 450100       CONNECTION_* STZ     COLONS,,AUTO

      155      612    2       DO CASE( %SMTPTYPE_RCVR);

    612  4 000233   000066 236000 2                  LDQ     TCM_SMTP_TYPE
         4 000234   000007 376007                    ANQ     7,DL
         4 000235   000005 116007                    CMPQ    5,DL
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:26   
         4 000236   000240 602006 4                  TNC     s:612+5,QL
         4 000237   000366 710000 4                  TRA     LOG_DONE
         4 000240   000366 710000 4                  TRA     LOG_DONE
         4 000241   000245 710000 4                  TRA     s:616
         4 000242   000257 710000 4                  TRA     s:621
         4 000243   000362 710000 4                  TRA     s:641
         4 000244   000365 710000 4                  TRA     s:643

      156      613    2           CASE( %RCVR_NONE);

      157      614    2               ;  /* don't have to do anything */
      158      615    2           CASE( %RCVR_DIAL);

      159      616    2               CMDBUF_ = VECTOR( DIALSMTP);

    616  4 000245   000022 237000 5                  LDAQ    18
         4 000246   200014 757100                    STAQ    CMDBUF_,,AUTO

      160      617    2               PROMPT_ = VECTOR( DIAL_PRMT);

    617  4 000247   000024 237000 5                  LDAQ    20
         4 000250   200037 755100                    STA     PROMPT_,,AUTO
         4 000251   200040 756100                    STQ     PROMPT_+1,,AUTO

      161      618    2               FAIL_ = VECTOR( DIAL_FAIL);

    618  4 000252   000026 237000 5                  LDAQ    22
         4 000253   200016 757100                    STAQ    FAIL_,,AUTO

      162      619    2               CALL WRITE_LOGON ALTRET( LOGON_ERR);

    619  4 000254   000425 701000 4                  TSX1    WRITE_LOGON
         4 000255   000370 702000 4                  TSX2    LOGON_ERR
         4 000256   000366 710000 4                  TRA     LOG_DONE

      163      620    2           CASE( %RCVR_CP6);

PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:27   
      164      621    3               IF %SMTPTYPE_RES = %RES_ALEX THEN DO;

    621  4 000257   000066 236000 2                  LDQ     TCM_SMTP_TYPE
         4 000260   000011 772000                    QRL     9
         4 000261   000007 376007                    ANQ     7,DL
         4 000262   000001 116007                    CMPQ    1,DL
         4 000263   000344 601000 4                  TNZ     s:637

      165      622    3                   CALL M$WAIT( WAIT_1_SEC);

    622  4 000264   000000 630400 1                  EPPR0   WAIT_1_SEC
         4 000265   020006 713400                    CLIMB   8198
         4 000266   400400 401760                    pmme    nvectors=2

      166      623    3                   CALL M$WAIT( WAIT_1_SEC);

    623  4 000267   000000 630400 1                  EPPR0   WAIT_1_SEC
         4 000270   020006 713400                    CLIMB   8198
         4 000271   400400 401760                    pmme    nvectors=2

      167      624    4                   DO TVAL = 0 TO 8;

    624  4 000272   200043 450100                    STZ     TVAL,,AUTO

      168      625    4                       CALL M$WAIT( WAIT_1_SEC);

    625  4 000273   000000 630400 1                  EPPR0   WAIT_1_SEC
         4 000274   020006 713400                    CLIMB   8198
         4 000275   400400 401760                    pmme    nvectors=2

      169      626    4                       CALL TCM$ALEX_WRITE( VECTOR( EIGHT), ALEX_MERR)

    626  4 000276   200012 630500                    EPPR0   ALEX_MERR,,AUTO
         4 000277   200057 450500                    STP0    I+2,,AUTO
         4 000300   000017 236000 5                  LDQ     15
         4 000301   200056 756100                    STQ     I+1,,AUTO
         4 000302   200056 630500                    EPPR0   I+1,,AUTO
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:28   
         4 000303   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000304   000000 701000 xent               TSX1    TCM$ALEX_WRITE
         4 000305   000370 702000 4                  TSX2    LOGON_ERR

      170      627    4                               ALTRET( LOGON_ERR);
      171      628    4                       CALL M$WAIT( WAIT_1_SEC);

    628  4 000306   000000 630400 1                  EPPR0   WAIT_1_SEC
         4 000307   020006 713400                    CLIMB   8198
         4 000310   400400 401760                    pmme    nvectors=2

      172      629    4                       END;

    629  4 000311   200043 235100                    LDA     TVAL,,AUTO
         4 000312   000001 035007                    ADLA    1,DL
         4 000313   200043 755100                    STA     TVAL,,AUTO
         4 000314   000011 115007                    CMPA    9,DL
         4 000315   000273 602000 4                  TNC     s:625

      173      630    3                   CALL M$WAIT( WAIT_1_SEC);

    630  4 000316   000000 630400 1                  EPPR0   WAIT_1_SEC
         4 000317   020006 713400                    CLIMB   8198
         4 000320   400400 401760                    pmme    nvectors=2

      174      631    3                   CALL TCM$ALEX_WRITE( VECTOR( LPAREN), ALEX_MERR)

    631  4 000321   200012 630500                    EPPR0   ALEX_MERR,,AUTO
         4 000322   200057 450500                    STP0    I+2,,AUTO
         4 000323   000034 236000 5                  LDQ     28
         4 000324   200056 756100                    STQ     I+1,,AUTO
         4 000325   200056 630500                    EPPR0   I+1,,AUTO
         4 000326   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000327   000000 701000 xent               TSX1    TCM$ALEX_WRITE
         4 000330   000370 702000 4                  TSX2    LOGON_ERR

      175      632    3                           ALTRET( LOGON_ERR);
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:29   
      176      633    3                   CALL M$WAIT( WAIT_1_SEC);

    633  4 000331   000000 630400 1                  EPPR0   WAIT_1_SEC
         4 000332   020006 713400                    CLIMB   8198
         4 000333   400400 401760                    pmme    nvectors=2

      177      634    3                   CALL TCM$ALEX_WRITE( VECTOR( TCM_LOGON), ALEX_MERR)

    634  4 000334   200012 630500                    EPPR0   ALEX_MERR,,AUTO
         4 000335   200057 450500                    STP0    I+2,,AUTO
         4 000336   000040 236000 5                  LDQ     32
         4 000337   200056 756100                    STQ     I+1,,AUTO
         4 000340   200056 630500                    EPPR0   I+1,,AUTO
         4 000341   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000342   000000 701000 xent               TSX1    TCM$ALEX_WRITE
         4 000343   000370 702000 4                  TSX2    LOGON_ERR

      178      635    3                           ALTRET( LOGON_ERR);
      179      636    3                   END;

      180      637    2               IF %SMTPTYPE_RES = %RES_CL THEN

    637  4 000344   000066 236000 2                  LDQ     TCM_SMTP_TYPE
         4 000345   000011 772000                    QRL     9
         4 000346   000007 376007                    ANQ     7,DL
         4 000347   000003 116007                    CMPQ    3,DL
         4 000350   000366 601000 4                  TNZ     LOG_DONE

      181      638    2                   CALL TCM$CL_WRITE( VECTOR( TCM_LOGON), ALEX_MERR)

    638  4 000351   200012 630500                    EPPR0   ALEX_MERR,,AUTO
         4 000352   200057 450500                    STP0    I+2,,AUTO
         4 000353   000040 236000 5                  LDQ     32
         4 000354   200056 756100                    STQ     I+1,,AUTO
         4 000355   200056 630500                    EPPR0   I+1,,AUTO
         4 000356   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000357   000000 701000 xent               TSX1    TCM$CL_WRITE
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:30   
         4 000360   000370 702000 4                  TSX2    LOGON_ERR
         4 000361   000366 710000 4                  TRA     LOG_DONE

      182      639    2                           ALTRET( LOGON_ERR);
      183      640    2           CASE( %RCVR_GCOS6);

      184      641    2               CALL GCOS6 ALTRET( LOGON_ERR);

    641  4 000362   000373 701000 4                  TSX1    GCOS6
         4 000363   000370 702000 4                  TSX2    LOGON_ERR
         4 000364   000366 710000 4                  TRA     LOG_DONE

      185      642    2           CASE( %RCVR_GCOS8);

      186      643    2               GOTO LOGON_ERR;  /* GCOS8 NOT SUPPORTED */

    643  4 000365   000370 710000 4                  TRA     LOGON_ERR

      187      644    2           END;

      188      645    1   LOG_DONE:
      189      646    1       TCM_TESTMODE = %FALSE;

    646  4 000366   000000 450000 xsym  LOG_DONE     STZ     TCM_TESTMODE

      190      647    1   GO_RETURN:
      191      648    1       RETURN;

    648  4 000367   000000 702200 xent  GO_RETURN    TSX2  ! X66_ARET

      192      649    1   LOGON_ERR:
      193      650    1       UNWIND TO TCM_SMTP_BAILOUT;

    650  4 000370   000000 237200 xsym  LOGON_ERR    LDAQ  ! TCM_SMTP_BAILOUT
         4 000371   000000 700200 xent               TSX0  ! X66_AUNWIND
         4 000372   000000 000200                    ZERO    0,128

PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:31   
      194      651        %EJECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:32   
      195      652    1   GCOS6: PROC ALTRET;

    652  4 000373   200046 741300       GCOS6        STX1  ! T_O+2,,AUTO

      196      653    2       DCL FC_PRMPT CHAR(0) CONSTANT INIT( 'Ready');
      197      654    2       DCL FIRST_CMD CHAR(0) CONSTANT INIT( 'EC >NETMAIL>DIAL>START_UP.EC');
      198      655    2       DCL LOG CHAR(0) CONSTANT INIT( 'L NETMAIL');
      199      656    2       DCL LOG_PRMPT CHAR(0) CONSTANT INIT( 'LOGIN');
      200      657    2       DCL PASSW CHAR(0) CONSTANT INIT( 'NETMAIL');
      201      658    2       DCL PASSW_PRMPT CHAR(0) CONSTANT INIT( 'PLEASE ENTER YOUR PASSWORD');
      202      659
      203      660    2       CMDBUF_ = VECTOR( LOG);

    660  4 000374   000042 237000 5                  LDAQ    34
         4 000375   200014 757100                    STAQ    CMDBUF_,,AUTO

      204      661    2       PROMPT_ = VECTOR( LOG_PRMPT);

    661  4 000376   000044 237000 5                  LDAQ    36
         4 000377   200037 755100                    STA     PROMPT_,,AUTO
         4 000400   200040 756100                    STQ     PROMPT_+1,,AUTO

      205      662    2       CALL WRITE_LOGON ALTRET( GCOS_ERR);

    662  4 000401   000425 701000 4                  TSX1    WRITE_LOGON
         4 000402   000423 702000 4                  TSX2    GCOS_ERR

      206      663    2       CMDBUF_ = VECTOR( PASSW);

    663  4 000403   000046 237000 5                  LDAQ    38
         4 000404   200014 757100                    STAQ    CMDBUF_,,AUTO

      207      664    2       PROMPT_ = VECTOR( PASSW_PRMPT);

    664  4 000405   000050 237000 5                  LDAQ    40
         4 000406   200037 755100                    STA     PROMPT_,,AUTO
         4 000407   200040 756100                    STQ     PROMPT_+1,,AUTO
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:33   

      208      665    2       CALL WRITE_LOGON ALTRET( GCOS_ERR);

    665  4 000410   000425 701000 4                  TSX1    WRITE_LOGON
         4 000411   000423 702000 4                  TSX2    GCOS_ERR

      209      666    2       CMDBUF_ = VECTOR( FIRST_CMD);

    666  4 000412   000052 237000 5                  LDAQ    42
         4 000413   200014 757100                    STAQ    CMDBUF_,,AUTO

      210      667    2       PROMPT_ = VECTOR( FC_PRMPT);

    667  4 000414   000054 237000 5                  LDAQ    44
         4 000415   200037 755100                    STA     PROMPT_,,AUTO
         4 000416   200040 756100                    STQ     PROMPT_+1,,AUTO

      211      668    2       CALL WRITE_LOGON ALTRET( GCOS_ERR);

    668  4 000417   000425 701000 4                  TSX1    WRITE_LOGON
         4 000420   000423 702000 4                  TSX2    GCOS_ERR

      212      669    2       RETURN;

    669  4 000421   200046 221300                    LDX1  ! T_O+2,,AUTO
         4 000422   000001 702211                    TSX2  ! 1,X1

      213      670    2   GCOS_ERR:
      214      671    2       ALTRETURN;

    671  4 000423   200046 221300       GCOS_ERR     LDX1  ! T_O+2,,AUTO
         4 000424   000000 702211                    TSX2  ! 0,X1

      215      672    2   END GCOS6;
      216      673        %EJECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:34   
      217      674    1   WRITE_LOGON: PROC ALTRET;

    674  4 000425   200050 741300       WRITE_LOGON  STX1  ! T_O+4,,AUTO

      218      675
      219      676    2       DCL FOUNDIT BIT(1);
      220      677    2       DCL ONECHAR CHAR(1) BASED;
      221      678    2       DCL TEMP UBIN;
      222      679
      223      680    2       I = PROMPT_.BOUND + 1;

    680  4 000426   200037 236100                    LDQ     PROMPT_,,AUTO
         4 000427   000020 772000                    QRL     16
         4 000430   000001 036007                    ADLQ    1,DL
         4 000431   200020 756100                    STQ     I,,AUTO

      224      681    2       I$ = PROMPT_.BASE$;

    681  4 000432   200040 236100                    LDQ     PROMPT_+1,,AUTO
         4 000433   200021 756100                    STQ     I$,,AUTO

      225      682    2       IF FAIL_ = VECTOR( NIL) THEN

    682  4 000434   200016 237100                    LDAQ    FAIL_,,AUTO
         4 000435   000000 117000 5                  CMPAQ   0
         4 000436   000441 601000 4                  TNZ     s:685

      226      683    2           J = 0;

    683  4 000437   200022 450100                    STZ     J,,AUTO
         4 000440   000451 710000 4                  TRA     s:689

      227      684    3       ELSE DO;

      228      685    3           J = FAIL_.BOUND + 1;

    685  4 000441   200016 236100                    LDQ     FAIL_,,AUTO
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:35   
         4 000442   000020 772000                    QRL     16
         4 000443   000001 036007                    ADLQ    1,DL
         4 000444   200022 756100                    STQ     J,,AUTO

      229      686    3           J$ = FAIL_.BASE$;

    686  4 000445   200017 236100                    LDQ     FAIL_+1,,AUTO
         4 000446   200023 756100                    STQ     J$,,AUTO

      230      687    3           FAIL_ = VECTOR( NIL);

    687  4 000447   000000 237000 5                  LDAQ    0
         4 000450   200016 757100                    STAQ    FAIL_,,AUTO

      231      688    3           END;

      232      689    2       FOUNDIT = '0'B;

    689  4 000451   200051 450100                    STZ     FOUNDIT,,AUTO

      233      690    3       DO UNTIL FOUNDIT;

      234      691    3   REREAD:
      235      692    4           DO T_O = 1 TO TIME_OUT;

    692  4 000452   000001 235007       REREAD       LDA     1,DL
         4 000453   200044 755100                    STA     T_O,,AUTO
         4 000454   000534 710000 4                  TRA     s:706+3

      236      693    4               IF COLONS THEN

    693  4 000455   200013 234100                    SZN     COLONS,,AUTO
         4 000456   000500 605000 4                  TPL     s:698

      237      694    4                   CALL TCM$ALEX_READ( VECTOR( ALEX_BUF), 30,

    694  4 000457   200042 630500                    EPPR0   TIMED_OUT,,AUTO
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:36   
         4 000460   200064 450500                    STP0    I+7,,AUTO
         4 000461   200012 631500                    EPPR1   ALEX_MERR,,AUTO
         4 000462   200063 451500                    STP1    I+6,,AUTO
         4 000463   200007 633500                    EPPR3   ALEX_ARS,,AUTO
         4 000464   200062 453500                    STP3    I+5,,AUTO
         4 000465   200010 634500                    EPPR4   ALEX_EOM,,AUTO
         4 000466   200061 454500                    STP4    I+4,,AUTO
         4 000467   000057 236000 5                  LDQ     47
         4 000470   200060 756100                    STQ     I+3,,AUTO
         4 000471   000060 237000 5                  LDAQ    48
         4 000472   200056 757100                    STAQ    I+1,,AUTO
         4 000473   200056 630500                    EPPR0   I+1,,AUTO
         4 000474   000025 631400 xsym               EPPR1   B_VECTNIL+21
         4 000475   000000 701000 xent               TSX1    TCM$ALEX_READ
         4 000476   000675 702000 4                  TSX2    GO_ALTRET
         4 000477   000520 710000 4                  TRA     s:701

      238      695    4                           ALEX_EOMSET, ALEX_EOM, ALEX_ARS, ALEX_MERR, TIMED_OUT)
      239      696    4                           ALTRET( GO_ALTRET);
      240      697    4               ELSE
      241      698    4                   CALL TCM$ALEX_READ( VECTOR( ALEX_BUF), 30,

    698  4 000500   200042 630500                    EPPR0   TIMED_OUT,,AUTO
         4 000501   200064 450500                    STP0    I+7,,AUTO
         4 000502   200012 631500                    EPPR1   ALEX_MERR,,AUTO
         4 000503   200063 451500                    STP1    I+6,,AUTO
         4 000504   200007 633500                    EPPR3   ALEX_ARS,,AUTO
         4 000505   200062 453500                    STP3    I+5,,AUTO
         4 000506   200010 634500                    EPPR4   ALEX_EOM,,AUTO
         4 000507   200061 454500                    STP4    I+4,,AUTO
         4 000510   000062 236000 5                  LDQ     50
         4 000511   200060 756100                    STQ     I+3,,AUTO
         4 000512   000060 237000 5                  LDAQ    48
         4 000513   200056 757100                    STAQ    I+1,,AUTO
         4 000514   200056 630500                    EPPR0   I+1,,AUTO
         4 000515   000025 631400 xsym               EPPR1   B_VECTNIL+21
         4 000516   000000 701000 xent               TSX1    TCM$ALEX_READ
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:37   
         4 000517   000675 702000 4                  TSX2    GO_ALTRET

      242      699    4                           ALEX_EOMSET2, ALEX_EOM, ALEX_ARS, ALEX_MERR, TIMED_OUT)
      243      700    4                           ALTRET( GO_ALTRET);
      244      701    4               IF TIMED_OUT AND

    701  4 000520   200042 234100                    SZN     TIMED_OUT,,AUTO
         4 000521   000527 605000 4                  TPL     s:704
         4 000522   000066 235000 2                  LDA     TCM_SMTP_TYPE
         4 000523   001113 115007                    CMPA    587,DL
         4 000524   000527 600000 4                  TZE     s:704
         4 000525   001114 115007                    CMPA    588,DL
         4 000526   000675 601000 4                  TNZ     GO_ALTRET

      245      702    4                      ( TCM_SMTP_TYPE ~= %SMTP_GCOS6 AND TCM_SMTP_TYPE ~= %SMTP_GCOS8)
               702                                THEN
      246      703    4                   GOTO GO_ALTRET;
      247      704    4               IF NOT TIMED_OUT THEN

    704  4 000527   200042 234100                    SZN     TIMED_OUT,,AUTO
         4 000530   000540 605000 4                  TPL     RESUME

      248      705    4                   GOTO RESUME;
      249      706    4               END;

    706  4 000531   200044 235100                    LDA     T_O,,AUTO
         4 000532   000001 035007                    ADLA    1,DL
         4 000533   200044 755100                    STA     T_O,,AUTO
         4 000534   000110 236000 1                  LDQ     TIME_OUT
         4 000535   200044 116100                    CMPQ    T_O,,AUTO
         4 000536   000455 603000 4                  TRC     s:693

      250      707    3           GOTO IGNORE;

    707  4 000537   000632 710000 4                  TRA     IGNORE

      251      708    3   RESUME:
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:38   
      252      709    3           IF ALEX_ARS = 0 THEN

    709  4 000540   200007 235100       RESUME       LDA     ALEX_ARS,,AUTO
         4 000541   000452 600000 4                  TZE     REREAD

      253      710    3               GOTO REREAD;
      254      711    3           WRITE_ME.BUF_ = VECTOR( ALEX_BUF);

    711  4 000542   000006 237000 5                  LDAQ    6
         4 000543   000004 757000 2                  STAQ    WRITE_ME+4

      255      712    3           WRITE_ME.BUF_.BOUND = ALEX_ARS - 1;

    712  4 000544   200007 236100                    LDQ     ALEX_ARS,,AUTO
         4 000545   000001 136007                    SBLQ    1,DL
         4 000546   000020 736000                    QLS     16
         4 000547   000004 676000 2                  ERQ     WRITE_ME+4
         4 000550   000034 376000 xsym               ANQ     B_VECTNIL+28
         4 000551   000004 656000 2                  ERSQ    WRITE_ME+4

      256      713    3           CALL STRIP_PARITY;

    713  4 000552   000677 701000 4                  TSX1    STRIP_PARITY
         4 000553   000000 011000                    NOP     0

      257      714    4           DO WHILE WRITE_ME.BUF_.BOUND > 0 AND

    714  4 000554   000567 710000 4                  TRA     s:718

      258      715    4                   WRITE_ME.BUF_.BUF$->ONECHAR < ' ';
      259      716    4               WRITE_ME.BUF_.BUF$ = PINCRC( WRITE_ME.BUF_.BUF$, 1);

    716  4 000555   000005 236000 2                  LDQ     WRITE_ME+5
         4 000556   200000 036007                    ADLQ    65536,DL
         4 000557   000005 756000 2                  STQ     WRITE_ME+5

      260      717    4               WRITE_ME.BUF_.BOUND = WRITE_ME.BUF_.BOUND - 1;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:39   

    717  4 000560   000004 236000 2                  LDQ     WRITE_ME+4
         4 000561   000020 772000                    QRL     16
         4 000562   000001 136007                    SBLQ    1,DL
         4 000563   000020 736000                    QLS     16
         4 000564   000004 676000 2                  ERQ     WRITE_ME+4
         4 000565   000034 376000 xsym               ANQ     B_VECTNIL+28
         4 000566   000004 656000 2                  ERSQ    WRITE_ME+4

      261      718    4               END;

    718  4 000567   000004 236000 2                  LDQ     WRITE_ME+4
         4 000570   000034 316000 xsym               CANQ    B_VECTNIL+28
         4 000571   000577 600000 4                  TZE     s:719
         4 000572   000005 470400 2                  LDP0    WRITE_ME+5
         4 000573   040000 106500                    CMPC    fill='040'O
         4 000574   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         4 000575   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 000576   000555 602000 4                  TNC     s:716

      262      719    3           CALL M$WRITE( WRITE_ME);

    719  4 000577   000000 630400 2                  EPPR0   WRITE_ME
         4 000600   040001 713400                    CLIMB   write
         4 000601   401400 401760                    pmme    nvectors=4

      263      720    3           CALL INDEX( TEMP, IBUF, SUBSTR( ALEX_BUF, 0, ALEX_ARS))

    720  4 000602   200052 631500                    EPPR1   TEMP,,AUTO
         4 000603   200021 473500                    LDP3    I$,,AUTO
         4 000604   200020 723100                    LXL3    I,,AUTO
         4 000605   000014 630400 2                  EPPR0   ALEX_BUF
         4 000606   200007 720100                    LXL0    ALEX_ARS,,AUTO
         4 000607   000000 236003                    LDQ     0,DU
         4 000610   000000 701000 xent               TSX1    X66_INDEX
         4 000611   000614 710000 4                  TRA     s:724

PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:40   
      264      721    4           WHENRETURN DO;

      265      722    4               FOUNDIT = '1'B;

    722  4 000612   400000 236003                    LDQ     -131072,DU
         4 000613   200051 756100                    STQ     FOUNDIT,,AUTO

      266      723    4               END;

      267      724    4           IF J > 0 THEN DO;

    724  4 000614   200022 235100                    LDA     J,,AUTO
         4 000615   000630 600000 4                  TZE     s:730

      268      725    4               CALL INDEX( TEMP, JBUF, SUBSTR( ALEX_BUF, 0, ALEX_ARS))

    725  4 000616   200052 631500                    EPPR1   TEMP,,AUTO
         4 000617   200023 473500                    LDP3    J$,,AUTO
         4 000620   000000 623005                    EAX3    0,AL
         4 000621   000014 630400 2                  EPPR0   ALEX_BUF
         4 000622   200007 720100                    LXL0    ALEX_ARS,,AUTO
         4 000623   000000 236003                    LDQ     0,DU
         4 000624   000000 701000 xent               TSX1    X66_INDEX
         4 000625   000630 710000 4                  TRA     s:730

      269      726    5               WHENRETURN DO;

      270      727    5                   ALTRETURN;

    727  4 000626   200050 221300                    LDX1  ! T_O+4,,AUTO
         4 000627   000000 702211                    TSX2  ! 0,X1

      271      728    5                   END;
      272      729    4               END;

      273      730    3           END;

PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:41   
    730  4 000630   200051 234100                    SZN     FOUNDIT,,AUTO
         4 000631   000452 605000 4                  TPL     REREAD

      274      731    2   IGNORE:
      275      732    2       I = CMDBUF_.BOUND + 1;

    732  4 000632   200014 236100       IGNORE       LDQ     CMDBUF_,,AUTO
         4 000633   000020 772000                    QRL     16
         4 000634   000001 036007                    ADLQ    1,DL
         4 000635   200020 756100                    STQ     I,,AUTO

      276      733    2       I$ = CMDBUF_.BASE$;

    733  4 000636   200015 236100                    LDQ     CMDBUF_+1,,AUTO
         4 000637   200021 756100                    STQ     I$,,AUTO

      277      734    2       ALEX_BUF = IBUF;

    734  4 000640   200021 470500                    LDP0    I$,,AUTO
         4 000641   200020 720100                    LXL0    I,,AUTO
         4 000642   040000 100540                    MLR     fill='040'O
         4 000643   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         4 000644   000014 000200 2                  ADSC9   ALEX_BUF                 cn=0,n=128

      278      735    2       SUBSTR( ALEX_BUF, I, 1) = BINASC( 13/*CR*/);

    735  4 000645   200020 235100                    LDA     I,,AUTO
         4 000646   040005 100400                    MLR     fill='040'O
         4 000647   000063 000001 5                  ADSC9   51                       cn=0,n=1
         4 000650   000014 000001 2                  ADSC9   ALEX_BUF,A               cn=0,n=1

      279      736    2       VBOUND( ALEX_BUF_) = I;

    736  4 000651   200020 236100                    LDQ     I,,AUTO
         4 000652   000020 736000                    QLS     16
         4 000653   000054 676000 2                  ERQ     ALEX_BUF_
         4 000654   000034 376000 xsym               ANQ     B_VECTNIL+28
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:42   
         4 000655   000054 656000 2                  ERSQ    ALEX_BUF_

      280      737    2       CALL TCM$ALEX_WRITE( ALEX_BUF_, ALEX_ERR) ALTRET( GO_ALTRET);

    737  4 000656   200011 631500                    EPPR1   ALEX_ERR,,AUTO
         4 000657   200057 451500                    STP1    I+2,,AUTO
         4 000660   000064 236000 5                  LDQ     52
         4 000661   200056 756100                    STQ     I+1,,AUTO
         4 000662   200056 630500                    EPPR0   I+1,,AUTO
         4 000663   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000664   000000 701000 xent               TSX1    TCM$ALEX_WRITE
         4 000665   000675 702000 4                  TSX2    GO_ALTRET

      281      738    2       WRITE_ME.BUF_ = CMDBUF_;

    738  4 000666   200014 237100                    LDAQ    CMDBUF_,,AUTO
         4 000667   000004 757000 2                  STAQ    WRITE_ME+4

      282      739    2       CALL M$WRITE( WRITE_ME);

    739  4 000670   000000 630400 2                  EPPR0   WRITE_ME
         4 000671   040001 713400                    CLIMB   write
         4 000672   401400 401760                    pmme    nvectors=4

      283      740    2       RETURN;

    740  4 000673   200050 221300                    LDX1  ! T_O+4,,AUTO
         4 000674   000001 702211                    TSX2  ! 1,X1

      284      741    2   GO_ALTRET:
      285      742    2       ALTRETURN;

    742  4 000675   200050 221300       GO_ALTRET    LDX1  ! T_O+4,,AUTO
         4 000676   000000 702211                    TSX2  ! 0,X1

      286      743
      287      744    2       END WRITE_LOGON;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:43   
      288      745        %EJECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:44   
      289      746    1   STRIP_PARITY: PROC;

    746  4 000677   200054 741300       STRIP_PARITY STX1  ! TEMP+2,,AUTO

      290      747
      291      748    2       DCL I SBIN;
      292      749
      293      750    3       DO I = 0 TO ALEX_ARS - 1;

    750  4 000700   200055 450100                    STZ     I,,AUTO
         4 000701   000715 710000 4                  TRA     s:752+1

      294      751    3           ALEX_BBUF( I) = ALEX_BBUF( I) & '177'O;

    751  4 000702   200055 235100                    LDA     I,,AUTO
         4 000703   000100 100405                    MLR     fill='000'O
         4 000704   000014 000001 2                  ADSC9   ALEX_BUF,A               cn=0,n=1
         4 000705   200056 000004                    ADSC9   I+1,,AUTO                cn=0,n=4
         4 000706   200056 236100                    LDQ     I+1,,AUTO
         4 000707   177000 376003                    ANQ     65024,DU
         4 000710   200057 756100                    STQ     I+2,,AUTO
         4 000711   000005 100500                    MLR     fill='000'O
         4 000712   200057 000004                    ADSC9   I+2,,AUTO                cn=0,n=4
         4 000713   000014 000001 2                  ADSC9   ALEX_BUF,A               cn=0,n=1

      295      752    3           END;

    752  4 000714   200055 054100                    AOS     I,,AUTO
         4 000715   200055 236100                    LDQ     I,,AUTO
         4 000716   000702 604000 4                  TMI     s:751
         4 000717   200007 116100                    CMPQ    ALEX_ARS,,AUTO
         4 000720   000702 602000 4                  TNC     s:751

      296      753    2       RETURN;

    753  4 000721   200054 221300                    LDX1  ! TEMP+2,,AUTO
         4 000722   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:45   

      297      754
      298      755    2       END STRIP_PARITY;
      299      756        %EJECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:46   
      300      757    1   TCM$STOP_SMTP: ENTRY;

    757  4 000723   000000 700200 xent  TCM$STOP_SM* TSX0  ! X66_AUTO_4
         4 000724   000066 000004                    ZERO    54,4

      301      758
      302      759    2       DO SELECT( %SMTPTYPE_RES);

    759  4 000725   000066 236000 2                  LDQ     TCM_SMTP_TYPE
         4 000726   000011 772000                    QRL     9
         4 000727   000007 376007                    ANQ     7,DL
         4 000730   200056 756100                    STQ     I+1,,AUTO
         4 000731   000011 736000                    QLS     9
         4 000732   002000 116007                    CMPQ    1024,DL
         4 000733   000741 602000 4                  TNC     s:759+12
         4 000734   000751 600000 4                  TZE     s:763
         4 000735   200056 236100                    LDQ     I+1,,AUTO
         4 000736   000003 116007                    CMPQ    3,DL
         4 000737   000760 601000 4                  TNZ     s:767
         4 000740   000755 710000 4                  TRA     s:765
         4 000741   200056 236100                    LDQ     I+1,,AUTO
         4 000742   000001 116007                    CMPQ    1,DL
         4 000743   000760 601000 4                  TNZ     s:767
         4 000744   000745 710000 4                  TRA     s:761

      303      760    2           SELECT( %RES_ALEX);

      304      761    2               CALL TCM$ALEX_DISCONNECT;

    761  4 000745   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 000746   000000 701000 xent               TSX1    TCM$ALEX_DISCONNECT
         4 000747   000000 011000                    NOP     0
         4 000750   000760 710000 4                  TRA     s:767

      305      762    2           SELECT( %RES_SOCK);

      306      763    2               CALL TCM$TCP_DISCONNECT;
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:47   

    763  4 000751   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 000752   000000 701000 xent               TSX1    TCM$TCP_DISCONNECT
         4 000753   000000 011000                    NOP     0
         4 000754   000760 710000 4                  TRA     s:767

      307      764    2           SELECT( %RES_CL);

      308      765    2               CALL TCM$CL_DISCONNECT;

    765  4 000755   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 000756   000000 701000 xent               TSX1    TCM$CL_DISCONNECT
         4 000757   000000 011000                    NOP     0

      309      766    2           END;

      310      767    1       RETURN;

    767  4 000760   000000 702200 xent               TSX2  ! X66_ARET

WAIT_1_SEC
 Sect OctLoc
   1     000   000001 777640   000004 006000   000000 177640   000000 006014    ................
   1     004   000000 000001   000000 000001                                    ........

ALEX_EOMSET
 Sect OctLoc
   1     006   000044 000000   000000 000040   000000 000000   000000 000000    .$..... ........
   1     012   000044 000000   000000 000040   000000 000000   000000 000000    .$..... ........

ALEX_EOMSET2
 Sect OctLoc
   1     016   000044 000000   000000 000000   000000 000000   000000 000000    .$..............
   1     022   000044 000000   000000 000000   000000 000000   000000 000000    .$..............

DIALSMTP
 Sect OctLoc
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:48   
   1     026   144151 141154   040163 155164   160*** ******                    dial smtp...

DIAL_FAIL
 Sect OctLoc
   1     031   150157 163164   040*** ******                                    host ...

DIAL_PRMT
 Sect OctLoc
   1     033   040165 163145   162163 ******                                     users..

EIGHT
 Sect OctLoc
   1     035   070*** ******                                                    8...

LOGIN_PRMT
 Sect OctLoc
   1     036   160154 145141   163145 040154   157147 040***                    please log .

LPAREN
 Sect OctLoc
   1     041   050*** ******                                                    (...

SETPARAMS
 Sect OctLoc
   1     042   022030 010***                                                    ....

(unnamed)
 Sect OctLoc
   1     043   003003 003003   003003 003003   003003 003003   003003 003003    ................
   1     053*  000001 001001   001001 001001   001001 001001   001001 001001    ................
   1     057   002002 002002   002002 002002   002002 001001   001001 001001    ................
   1     063   001002 002002   002002 002002   002002 002002   002002 002002    ................
   1     067   002002 002002   002002 002002   002002 002001   001001 001001    ................
   1     073   001002 002002   002002 002002   002002 002002   002002 002002    ................
   1     077   002002 002002   002002 002002   002002 002001   001001 001003    ................

TERMID
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:49   
 Sect OctLoc
   1     103   101*** ******                                                    A...

TERMID_PRMT
 Sect OctLoc
   1     104   160154 145141   163145 040164   171160 145040   171157 165162    please type your

TIME_OUT
 Sect OctLoc
   1     110   000000 000002                                                    ....

TYMNET
 Sect OctLoc
   1     111   115125 114124   111103 123040                                    MULTICS

FC_PRMPT
 Sect OctLoc
   1     113   122145 141144   171*** ******                                    Ready...

FIRST_CMD
 Sect OctLoc
   1     115   105103 040076   116105 124115   101111 114076   104111 101114    EC >NETMAIL>DIAL
   1     121   076123 124101   122124 137125   120056 105103                    >START_UP.EC

LOG
 Sect OctLoc
   1     124   114040 116105   124115 101111   114*** ******                    L NETMAIL...

LOG_PRMPT
 Sect OctLoc
   1     127   114117 107111   116*** ******                                    LOGIN...

PASSW
 Sect OctLoc
   1     131   116105 124115   101111 114***                                    NETMAIL.

PASSW_PRMPT
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:50   
 Sect OctLoc
   1     133   120114 105101   123105 040105   116124 105122   040131 117125    PLEASE ENTER YOU
   1     137   122040 120101   123123 127117   122104 ******                    R PASSWORD..

WRITE_ME
 Sect OctLoc
   2     000   000003 777640   000010 006000   000000 177640   000000 006014    ................
   2     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     010   000000 400400   000000 000000   000000 000000   000000 000000    ................

ALEX_BUF
 Sect OctLoc
   2     014   040040 040040   040040 040040   040040 040040   040040 040040
   2     050*  040040 040040   040040 040040   040040 040040   040040 040040

(unnamed)
 Sect OctLoc
   2     054   000037 777640   000014 006000                                    ........

TCM_LOGON
 Sect OctLoc
   2     056   072123 115124   120054 054122   106103 070062   062015 040040    :SMTP,,RFC822.
   2     062   040040 040040   040040 040040   040040 040040   040040 040040

(unnamed)
 Sect OctLoc
   5     000   000000 177640   000000 006014   000000 006000   000002 006000    ................
   5     004   000111 006000   000004 006000   000037 777640   000014 006000    .I..............
   5     010   000006 006000   000014 006000   000000 177640   000103 006000    .............C..
   5     014   000012 006000   777777 777000   000010 577640   000030 006000    ................
   5     020   000002 577640   000036 006000   000002 177640   000026 006000    ................
   5     024   000001 377640   000033 006000   000001 177640   000031 006000    ................
   5     030   000000 177640   000035 006000   000000 177640   000041 006000    .............!..
   5     034   000032 006000   000000 000000   000007 777640   000056 006000    ................
   5     040   000036 006000   000000 000000   000002 177640   000124 006000    .............T..
   5     044   000001 177640   000127 006000   000001 577640   000131 006000    .....W.......Y..
   5     050   000006 377640   000133 006000   000006 777640   000115 006000    .....[.......M..
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:51   
   5     054   000001 177640   000113 006000   000000 000036   000006 006000    .....K..........
   5     060   000006 006000   000056 006000   000016 006000   015040 040040    .............
   5     064   000054 006000                                                    .,..
      311      768
      312      769    1       END TCM$START_SMTP;
      313      770        %EOD;

PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:52   
--  Include file information  --

   TCM_SEND_E.:TCA2TOU  is referenced.
   TCM_COMMON_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$START_SMTP.
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:53   

 **** Variables and constants ****

  ****  Section 001 RoData TCM$START_SMTP

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/d STRC(288)   r     1 ALEX_EOMSET               16-0-0/d STRC(288)   r     1 ALEX_EOMSET2
    26-0-0/c CHAR(9)     r     1 DIALSMTP                  31-0-0/c CHAR(5)     r     1 DIAL_FAIL
    33-0-0/c CHAR(6)     r     1 DIAL_PRMT                 35-0-0/c CHAR        r     1 EIGHT
   113-0-0/c CHAR(5)     r     1 FC_PRMPT                 115-0-0/c CHAR(28)    r     1 FIRST_CMD
   124-0-0/c CHAR(9)     r     1 LOG                       36-0-0/c CHAR(11)    r     1 LOGIN_PRMT
   127-0-0/c CHAR(5)     r     1 LOG_PRMPT                 41-0-0/c CHAR        r     1 LPAREN
   131-0-0/c CHAR(7)     r     1 PASSW                    133-0-0/c CHAR(26)    r     1 PASSW_PRMPT
    42-0-0/c CHAR(3)     r     1 SETPARAM                  42-0-0/b BIT (27)    r     1 SETPARAMS
   103-0-0/c CHAR        r     1 TERMID                   104-0-0/c CHAR(16)    r     1 TERMID_PRMT
   110-0-0/w UBIN        r     1 TIME_OUT                 111-0-0/c CHAR(8)     r     1 TYMNET
     0-0-0/d STRC(216)   r     1 WAIT_1_SEC

  ****  Section 002  Data  TCM$START_SMTP

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    14-0-0/c BIT (9)     r     1 ALEX_BBUF(0:127)
    14-0-0/c CHAR(128)   r     1 ALEX_BUF                  54-0-0/d VECT        r     1 ALEX_BUF_
    56-0-0/c CHAR(32)    r     1 TCM_LOGON                 66-0-0/w UBIN        r     1 TCM_SMTP_TYPE
     0-0-0/d STRC(432)   r     1 WRITE_ME

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @ADDRESS
     6-0-0/w PTR         r     1 @FLOW_CONTROL_ENABLED
     3-0-0/w PTR         r     1 @LOGON                     5-0-0/w PTR         r     1 @TYPE
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:54   
    *0-0-0/c CHAR(32)    r     1 ADDRESS                    7-0-0/w UBIN        r     1 ALEX_ARS
    10-0-0/c CHAR        r     1 ALEX_EOM                  11-0-0/w UBIN        r     1 ALEX_ERR
    12-0-0/w UBIN        r     1 ALEX_MERR                 14-0-0/w STRC(72)    r     1 CMDBUF_
    13-0-0/b BIT         r     1 COLONS                    16-0-0/w STRC(72)    r     1 FAIL_
    *0-0-0/w BIT         r     1 FLOW_CONTROL_ENABLED      51-0-0/b BIT         r     1 FOUNDIT
    20-0-0/w UBIN        r     1 I                         55-0-0/w SBIN        r     1 I
    21-0-0/w PTR         r     1 I$                        22-0-0/w UBIN        r     1 J
    23-0-0/w PTR         r     1 J$                        24-0-0/w UBIN        r     1 LOC
    26-0-0/c CHAR(35)    r     1 LOGIN                     *0-0-0/c CHAR(32)    r     1 LOGON
    37-0-0/w STRC(72)    r     1 PROMPT_                   41-0-0/b STRC        r     1 STATUS
    52-0-0/w UBIN        r     1 TEMP                      42-0-0/b BIT         r     1 TIMED_OUT
    43-0-0/w UBIN        r     1 TVAL                      *0-0-0/w UBIN        r     1 TYPE
    44-0-0/w UBIN        r     1 T_O

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/d REMB        r     1 TCM_SMTP_BAILOUT
     0-0-0/w UBIN        r     1 TCM_SMTP_PROGRESS          0-0-0/b BIT         r     1 TCM_TESTMODE
     0-0-0/b BIT         r     1 TCP_MON_ERR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w ASTR        r     1 CV                         0-0-0/c ACHR        r     1 IBUF
     0-0-0/c ACHR        r     1 JBUF                       0-0-0N  NULL        r     1 M$ME
     0-0-0/c CHAR        r     1 ONECHAR                    0-0-0/c ASTR(9)     r     1 TEXTC


   Procedure TCM$START_SMTP requires 497 words for executable code.
   Procedure TCM$START_SMTP requires 54 words of local(AUTO) storage.
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:55   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:56   
          MINI XREF LISTING

ADDRESS
       496**DCL         8--PROC      568<>CALL      578<>CALL      581>>IF        582<>CALL
ALEX_ARS
       497**DCL       593<>CALL      694<>CALL      698<>CALL      709>>IF        712>>ASSIGN    720>>CALLBLT
       725>>CALLBLT   750>>DOINDEX
ALEX_BBUF
       499**DCL       751<<ASSIGN    751>>ASSIGN
ALEX_BUF
       498**DCL       499--REDEF     500--DCLINIT   593--CALL      595>>CALLBLT   694--CALL      698--CALL
       711--ASSIGN    720>>CALLBLT   725>>CALLBLT   734<<ASSIGN    735<<ASSIGN
ALEX_BUF_
       500**DCL       597>>ASSIGN    736<<ASSIGN    737<>CALL
ALEX_EOM
       501**DCL       694<>CALL      698<>CALL
ALEX_EOMSET
       152**DCL       694<>CALL
ALEX_EOMSET2
       172**DCL       698<>CALL
ALEX_ERR
       502**DCL       737<>CALL
ALEX_MERR
       503**DCL       593<>CALL      596<>CALL      626<>CALL      631<>CALL      634<>CALL      638<>CALL
       694<>CALL      698<>CALL
B$JIT.CPFLAGS1.SLEAZE
       276**DCL       276--REDEF
B$JIT.ERR.MID
       183**DCL       183--REDEF
B$JIT$
       491**DCL       177--IMP-PTR
CMDBUF_
       505**DCL       602<<ASSIGN    605<<ASSIGN    616<<ASSIGN    660<<ASSIGN    663<<ASSIGN    666<<ASSIGN
       738>>ASSIGN
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:57   
CMDBUF_.BASE$
       508**DCL       733>>ASSIGN
CMDBUF_.BOUND
       506**DCL       732>>ASSIGN
COLONS
       504**DCL       562<<ASSIGN    611<<ASSIGN    693>>IF
CONNECTION_ESTABLISHED
       611**LABEL     575--GOTO      579--GOTO      585--GOTO
CV.L
       365**DCL       366--IMP-SIZ
DIALSMTP
       511**DCL       616--ASSIGN
DIAL_FAIL
       512**DCL       618--ASSIGN
DIAL_PRMT
       513**DCL       617--ASSIGN
EIGHT
       514**DCL       626--CALL
FAIL_
       515**DCL       566<<ASSIGN    618<<ASSIGN    682>>IF        687<<ASSIGN
FAIL_.BASE$
       518**DCL       686>>ASSIGN
FAIL_.BOUND
       516**DCL       685>>ASSIGN
FC_PRMPT IN PROCEDURE GCOS6
       653**DCL       667--ASSIGN
FIRST_CMD IN PROCEDURE GCOS6
       654**DCL       666--ASSIGN
FLOW_CONTROL_ENABLED
       519**DCL         8--PROC      565<<ASSIGN    574<<ASSIGN    584<<ASSIGN
FOUNDIT IN PROCEDURE WRITE_LOGON
       676**DCL       689<<ASSIGN    690>>DOUNTIL   722<<ASSIGN
GCOS6
       652**PROC      641--CALL
GCOS_ERR IN PROCEDURE GCOS6
       671**LABEL     662--CALLALT   665--CALLALT   668--CALLALT
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:58   
GO_ALTRET IN PROCEDURE WRITE_LOGON
       742**LABEL     694--CALLALT   698--CALLALT   703--GOTO      737--CALLALT
I
       520**DCL       521--IMP-SIZ   680<<ASSIGN    720>>CALLBLT   732<<ASSIGN    734>>ASSIGN    735>>ASSIGN
       736>>ASSIGN
I IN PROCEDURE STRIP_PARITY
       748**DCL       750<<DOINDEX   751>>ASSIGN    751>>ASSIGN
I$
       522**DCL       521--IMP-PTR   681<<ASSIGN    720>>CALLBLT   733<<ASSIGN    734>>ASSIGN
IBUF
       521**DCL       720>>CALLBLT   734>>ASSIGN
IGNORE IN PROCEDURE WRITE_LOGON
       732**LABEL     707--GOTO
J
       523**DCL       524--IMP-SIZ   683<<ASSIGN    685<<ASSIGN    724>>IF        725>>CALLBLT
J$
       525**DCL       524--IMP-PTR   686<<ASSIGN    725>>CALLBLT
JBUF
       524**DCL       725>>CALLBLT
LOC
       526**DCL       595<<CALLBLT
LOG IN PROCEDURE GCOS6
       655**DCL       660--ASSIGN
LOGIN
       528**DCL       601<<CALLBLT   602--ASSIGN    603>>CALLBLT   605--ASSIGN
LOGIN_PRMT
       529**DCL       607--ASSIGN
LOGON
       530**DCL         8--PROC      601>>CALLBLT
LOGON_ERR
       650**LABEL     572--GOTO      578--CALLALT   592--CALLALT   593--CALLALT   595--CALLALT   596--CALLALT
       608--CALLALT   619--CALLALT   626--CALLALT   631--CALLALT   634--CALLALT   638--CALLALT   641--CALLALT
       643--GOTO
LOG_PRMPT IN PROCEDURE GCOS6
       656**DCL       661--ASSIGN
LPAREN
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:59   
       531**DCL       631--CALL
M$WAIT
        76**DCL-ENT   622--CALL      623--CALL      625--CALL      628--CALL      630--CALL      633--CALL
M$WRITE
        19**DCL-ENT   598--CALL      600--CALL      719--CALL      739--CALL
ONECHAR IN PROCEDURE WRITE_LOGON
       677**DCL       714>>DOWHILE
PASSW IN PROCEDURE GCOS6
       657**DCL       663--ASSIGN
PASSW_PRMPT IN PROCEDURE GCOS6
       658**DCL       664--ASSIGN
PROMPT_
       533**DCL       607<<ASSIGN    617<<ASSIGN    661<<ASSIGN    664<<ASSIGN    667<<ASSIGN
PROMPT_.BASE$
       536**DCL       681>>ASSIGN
PROMPT_.BOUND
       534**DCL       680>>ASSIGN
REREAD IN PROCEDURE WRITE_LOGON
       692**LABEL     710--GOTO
RESUME IN PROCEDURE WRITE_LOGON
       709**LABEL     705--GOTO
SETPARAM
       539**DCL       601>>CALLBLT
SETPARAMS
       537**DCL       539--REDEF
STATUS
       544**DCL       582<>CALL      592<>CALL
STATUS.HOST_SHUT
       545**DCL       588>>IF
STRIP_PARITY
       746**PROC      594--CALL      713--CALL
TCM$ALEX_CONNECT
       480**DCL-ENT   592--CALL
TCM$ALEX_DISCONNECT
       481**DCL-ENT   761--CALL
TCM$ALEX_PAD_CONNECT
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:60   
       484**DCL-ENT   582--CALL
TCM$ALEX_READ
       482**DCL-ENT   593--CALL      694--CALL      698--CALL
TCM$ALEX_WRITE
       483**DCL-ENT   596--CALL      626--CALL      631--CALL      634--CALL      737--CALL
TCM$CL_CONNECT
       487**DCL-ENT   578--CALL
TCM$CL_DISCONNECT
       488**DCL-ENT   765--CALL
TCM$CL_WRITE
       489**DCL-ENT   638--CALL
TCM$TCP_CONNECT
       485**DCL-ENT   568--CALL
TCM$TCP_DISCONNECT
       486**DCL-ENT   763--CALL
TCM_LOGON
       509**DCL       634--CALL      638--CALL
TCM_SMTP_BAILOUT
       492**DCL       582<>CALL      590>>UNWIND    592<>CALL      650>>UNWIND
TCM_SMTP_PROGRESS
       493**DCL       563<<ASSIGN    571<<ASSIGN    589<<ASSIGN    609<<ASSIGN
TCM_SMTP_TYPE
       543**DCL       564<<ASSIGN    567>>IF        577>>IF        612>>DOCASE    621>>IF        637>>IF
       701>>IF        701>>IF        759>>DOSELCT
TCM_TESTMODE
       548**DCL       646<<ASSIGN
TCP_MON_ERR
       494**DCL       570>>IF
TEMP IN PROCEDURE WRITE_LOGON
       678**DCL       720<<CALLBLT   725<<CALLBLT
TERMID
       546**DCL       596--CALL      599--ASSIGN
TERMID_PRMT
       547**DCL       595>>CALLBLT
TEXTC.L
       369**DCL       370--IMP-SIZ
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:61   
TIMED_OUT
       549**DCL       694<>CALL      698<>CALL      701>>IF        704>>IF
TIME_OUT
       550**DCL       692>>DOINDEX
TVAL
       551**DCL       603<<CALLBLT   605>>ASSIGN    624<<DOINDEX
TYMNET
       552**DCL       592<>CALL
TYPE
       553**DCL         8--PROC      564>>ASSIGN
T_O
       554**DCL       692<<DOINDEX
WAIT_1_SEC
       101**DCL       622<>CALL      623<>CALL      625<>CALL      628<>CALL      630<>CALL      633<>CALL
WAIT_1_SEC.V
       102**DCL       101--DCLINIT
WRITE_LOGON
       674**PROC      608--CALL      619--CALL      662--CALL      665--CALL      668--CALL
WRITE_ME
       121**DCL       598<>CALL      600<>CALL      719<>CALL      739<>CALL
WRITE_ME.BUF_
       121**DCL       597<<ASSIGN    599<<ASSIGN    711<<ASSIGN    738<<ASSIGN
WRITE_ME.BUF_.BOUND
       121**DCL       712<<ASSIGN    714>>DOWHILE   717<<ASSIGN    717>>ASSIGN
WRITE_ME.BUF_.BUF$
       123**DCL       714>>DOWHILE   716<<ASSIGN    716>>ASSIGN
WRITE_ME.STATION_
       123**DCL       123--REDEF
WRITE_ME.V
       124**DCL       121--DCLINIT
WRITE_ME.V.DVBYTE.VFC#
       130**DCL       130--REDEF
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:62   
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:63   
              MINI UREF LISTING

GO_RETURN     648**LABEL
LOCE     527**DCL
LOG_DONE     646**LABEL
M$ACCT      35**DCL-ENT
M$ACTIVATE      38**DCL-ENT
M$ALIB      31**DCL-ENT
M$ASUSER      33**DCL-ENT
M$ATTACH      40**DCL-ENT
M$BADPP      58**DCL-ENT
M$CGCTL      39**DCL-ENT
M$CGINFO      39**DCL-ENT
M$CHECK      20**DCL-ENT
M$CHGUNIT      78**DCL-ENT
M$CLOSE      18**DCL-ENT
M$CLRSTK      76**DCL-ENT
M$CMDVAR      87**DCL-ENT
M$CONFIG      48**DCL-ENT
M$CORRES      23**DCL-ENT
M$CPEXIT      32**DCL-ENT
M$CVM      56**DCL-ENT
M$CVOL      21**DCL-ENT
M$DCLFLD      48**DCL-ENT
M$DEACTIVATE      38**DCL-ENT
M$DELREC      20**DCL-ENT
M$DEQ      85**DCL-ENT
M$DETACH      40**DCL-ENT
M$DEVICE      22**DCL-ENT
M$DISPLAY      85**DCL-ENT
M$DISPRES      25**DCL-ENT
M$DLIB      31**DCL-ENT
M$DRIBBLE      48**DCL-ENT
M$DRTN      76**DCL-ENT
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:64   
M$DSUSER      33**DCL-ENT
M$ENQ      84**DCL-ENT
M$EOM      43**DCL-ENT
M$ERASE      49**DCL-ENT
M$ERR      30**DCL-ENT
M$ERRMSG      81**DCL-ENT
M$EVENT      73**DCL-ENT
M$EXHUME      82**DCL-ENT
M$EXIT      30**DCL-ENT
M$EXTEND      22**DCL-ENT
M$FDP      54**DCL-ENT
M$FDS      53**DCL-ENT
M$FEBOOT      46**DCL-ENT
M$FECTL      47**DCL-ENT
M$FEDUMP      46**DCL-ENT
M$FID      81**DCL-ENT
M$FINDPROC      35**DCL-ENT
M$FSUSER      33**DCL-ENT
M$FVP      55**DCL-ENT
M$FWCG      39**DCL-ENT
M$GBPL      59**DCL-ENT
M$GDDL      55**DCL-ENT
M$GDP      54**DCL-ENT
M$GDS      53**DCL-ENT
M$GETDCB      24**DCL-ENT
M$GETMOUSE      64**DCL-ENT
M$GETPM      65**DCL-ENT
M$GJOB      83**DCL-ENT
M$GLINEATTR      43**DCL-ENT
M$GOODPP      58**DCL-ENT
M$GPLATEN      51**DCL-ENT
M$GPROMPT      50**DCL-ENT
M$GTRMATTR      44**DCL-ENT
M$GTRMCTL      42**DCL-ENT
M$GTRMTAB      45**DCL-ENT
M$GVP      54**DCL-ENT
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:65   
M$HELP      81**DCL-ENT
M$INT      73**DCL-ENT
M$INTRTN      34**DCL-ENT
M$IOQ      69**DCL-ENT
M$JOBSTATS      83**DCL-ENT
M$KEYIN      23**DCL-ENT
M$LDEV      18**DCL-ENT
M$LDTRC      31**DCL-ENT
M$LIMIT      24**DCL-ENT
M$LINES      23**DCL-ENT
M$LINK      30**DCL-ENT
M$MADMUCK      26**DCL-ENT
M$MAKUSER      57**DCL-ENT
M$MBS      25**DCL-ENT
M$MDFFLD      49**DCL-ENT
M$ME     532**DCL
M$MERC      74**DCL-ENT
M$MERCS      75**DCL-ENT
M$MIRROR      69**DCL-ENT
M$MONINFO      86**DCL-ENT
M$MPL      59**DCL-ENT
M$NODEINFO      50**DCL-ENT
M$NXTUSR      84**DCL-ENT
M$OCMSG      82**DCL-ENT
M$OLAY      30**DCL-ENT
M$OPEN      18**DCL-ENT
M$PAS      59**DCL-ENT
M$PATHCON      82**DCL-ENT
M$PDS      53**DCL-ENT
M$PFIL      20**DCL-ENT
M$PLATEN      44**DCL-ENT
M$PRECORD      22**DCL-ENT
M$PROCNAME      35**DCL-ENT
M$PROFILE      46**DCL-ENT
M$PROMPT      42**DCL-ENT
M$RACST      26**DCL-ENT
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:66   
M$RDSYSLOG      67**DCL-ENT
M$READ      19**DCL-ENT
M$RELDCB      24**DCL-ENT
M$RELRES      25**DCL-ENT
M$RELSTARF      27**DCL-ENT
M$REM      27**DCL-ENT
M$RENV      74**DCL-ENT
M$REQUIRE      26**DCL-ENT
M$RETRY      75**DCL-ENT
M$RETRYS      75**DCL-ENT
M$REW      21**DCL-ENT
M$RLSFLD      49**DCL-ENT
M$RPRIV      77**DCL-ENT
M$RSPP      56**DCL-ENT
M$RSWITCH      78**DCL-ENT
M$RUE      84**DCL-ENT
M$SAD      57**DCL-ENT
M$SAVE      33**DCL-ENT
M$SCON      34**DCL-ENT
M$SCREECH      32**DCL-ENT
M$SENV      74**DCL-ENT
M$SETFMA      18**DCL-ENT
M$SETFP      47**DCL-ENT
M$SINPUT      45**DCL-ENT
M$SLCFLD      50**DCL-ENT
M$SMOUSE      64**DCL-ENT
M$SMPRT      56**DCL-ENT
M$SPRIV      77**DCL-ENT
M$SSC      57**DCL-ENT
M$SSWITCH      77**DCL-ENT
M$STATE      86**DCL-ENT
M$STD      58**DCL-ENT
M$STIMER      72**DCL-ENT
M$STLPP      55**DCL-ENT
M$STRAP      72**DCL-ENT
M$STRMATTR      44**DCL-ENT
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:67   
M$STRMCTL      42**DCL-ENT
M$STRMTAB      45**DCL-ENT
M$SYMBIO      83**DCL-ENT
M$SYSCON      69**DCL-ENT
M$SYSID      87**DCL-ENT
M$TDCLOSE      68**DCL-ENT
M$TDIO      68**DCL-ENT
M$TDOPEN      67**DCL-ENT
M$TDREQCPU      68**DCL-ENT
M$TEMPWROC      62**DCL-ENT
M$TIME      85**DCL-ENT
M$TRAP      72**DCL-ENT
M$TRMISC      47**DCL-ENT
M$TRMPRG      43**DCL-ENT
M$TRTN      76**DCL-ENT
M$TRUNC      19**DCL-ENT
M$TTIMER      72**DCL-ENT
M$UC      42**DCL
M$UMPL      59**DCL-ENT
M$UNFID      81**DCL-ENT
M$UNLATCH      38**DCL-ENT
M$UNSHARE      35**DCL-ENT
M$USRFIELD      78**DCL-ENT
M$VIRTUAL      53**DCL-ENT
M$WEOF      21**DCL-ENT
M$WRSYSLOG      67**DCL-ENT
M$XCON      73**DCL-ENT
M$XCONRTN      34**DCL-ENT
M$XEQTIME      86**DCL-ENT
M$XFLUSH      27**DCL-ENT
M$XMOUSE      64**DCL-ENT
M$XXX      30**DCL-ENT
M$YC      32**DCL-ENT
SKIP_BLANKS     540**DCL
TCM$START_SMTP       8**PROC
TCM$STOP_SMTP     757**ENTRY
PL6.E3A0      #001=TCM$START_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:18 Page:68   
TEXT_CHAR     372**DCL

PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:69   
      314        1        /*T***********************************************************/
      315        2        /*T*                                                         */
      316        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      317        4        /*T*                                                         */
      318        5        /*T***********************************************************/
      319        6        TCM$READ_SMTP: PROC( BUFIN_, VLEN, TIMEOUT) ALTRET;
      320        7        %INCLUDE CP_6;
      321       88        %INCLUDE CP_6_SUBS;
      322      628        %INCLUDE TCM_COMMON_M;
      323      659        %INCLUDE TCM_SEND_E;
      324      765            %VLP_EOMTABLE( FPTN=ALEX_EOMSET, VALUES=STD, STCLASS=CONSTANT);
      325      784
      326      785    1       DCL TCM$ALEX_READ ENTRY(7) ALTRET;
      327      786    1       DCL TCM$ALEX_WRITE ENTRY(2) ALTRET;
      328      787    1       DCL TCM$LTCP_READ ENTRY(7) ALTRET;
      329      788    1       DCL TCM$LTCP_WRITE ENTRY(2) ALTRET;
      330      789    1       DCL TCM$CL_READ ENTRY(7) ALTRET;
      331      790    1       DCL TCM$CL_WRITE ENTRY(2) ALTRET;
      332      791
      333      792    1       DCL TCM_SMTP_BAILOUT REMEMBER SYMREF;
      334      793
      335      794    1       DCL ALEX_EOM CHAR(1);
      336      795    1       DCL ALEX_ERR UBIN;
      337      796    1       DCL ALEX_LEN UBIN;
      338      797    1       DCL BUFC(0:255) BASED BIT(9) CALIGNED;
      339      798    1       DCL BUFIN_ BIT(72) DALIGNED;
      340      799    1       DCL 1 BUF_ DALIGNED,
      341      800    1            2 BOUND UBIN(20) UNAL,
      342      801    1            2 * BIT(16) UNAL,
      343      802    1            2 BASE$ PTR;
      344      803    1       DCL CHARB BIT(9);
      345      804    1       DCL I SBIN;
      346      805    1       DCL IBUF CHAR( I) BASED( I$);
      347      806    1       DCL IGNORE_NULL_READS BIT(1);
      348      807    1       DCL I$ PTR;
      349      808    1       DCL J SBIN;
      350      809    1       DCL TIMED_OUT BIT(1);
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:70   
      351      810    1       DCL TIMEOUT SBIN;
      352      811    1       DCL TIMEOUT_VALUE SBIN;
      353      812    1       DCL VLEN SBIN;
      354      813
      355      814    1       DCL TCM_SMTP_TYPE UBIN WORD SYMREF;
      356      815
      357      816        %EJECT;
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:71   
      358      817    1       IGNORE_NULL_READS = %YES#;
      359      818    1       GOTO SETUP;
      360      819
      361      820    1   TCM$READ_SMTP_NULLOK: ENTRY( BUFIN_, VLEN, TIMEOUT);
      362      821
      363      822    1       IGNORE_NULL_READS = %NO#;
      364      823    1   SETUP:
      365      824    1       BUF_ = BUFIN_;
      366      825    1       IF ADDR( TIMEOUT) = ADDR( NIL) THEN
      367      826    1           TIMEOUT_VALUE = 900;
      368      827    1       ELSE
      369      828    1           TIMEOUT_VALUE = TIMEOUT;
      370      829    1   REDO_READ:
      371      830    2       DO SELECT( %SMTPTYPE_RES);
      372      831    2           SELECT( %RES_ALEX);
      373      832    2               CALL TCM$ALEX_READ( BUF_, TIMEOUT_VALUE,
      374      833    2                       ALEX_EOMSET, ALEX_EOM, ALEX_LEN, ALEX_ERR, TIMED_OUT)
      375      834    2                       ALTRET( READ_ERR);
      376      835    2           SELECT( %RES_SOCK);
      377      836    2               CALL TCM$LTCP_READ( BUF_, TIMEOUT_VALUE,
      378      837    2                       ALEX_EOMSET, ALEX_EOM, ALEX_LEN, ALEX_ERR, TIMED_OUT)
      379      838    2                       ALTRET( READ_ERR);
      380      839    2           SELECT( %RES_CL);
      381      840    2               CALL TCM$CL_READ( BUF_, TIMEOUT_VALUE,
      382      841    2                       ALEX_EOMSET, ALEX_EOM, ALEX_LEN, ALEX_ERR, TIMED_OUT)
      383      842    2                       ALTRET( READ_ERR);
      384      843    2           END;
      385      844    1       IF TIMED_OUT THEN
      386      845    1           GOTO REPORT_TIMEOUT;
      387      846    1       IF ALEX_LEN = 0 THEN
      388      847    1           IF IGNORE_NULL_READS THEN
      389      848    1               GOTO REDO_READ;
      390      849    1           ELSE
      391      850    1               ALTRETURN;
      392      851    1       VLEN = ALEX_LEN - 1;
      393      852    1       J = 0;
      394      853    2       DO I = 0 TO VLEN;
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:72   
      395      854    2           CHARB = BUF_.BASE$->BUFC( I) & '177'O;
      396      855    2           BUF_.BASE$->BUFC( J) = CHARB;
      397      856    2           IF CHARB >= '040'O THEN
      398      857    2               J = J + 1;
      399      858    2           END;
      400      859    1       IF J = 0 THEN
      401      860    1           IF IGNORE_NULL_READS THEN
      402      861    1               GOTO REDO_READ;
      403      862    1           ELSE
      404      863    1               ALTRETURN;
      405      864    1       VLEN = J - 1;
      406      865    1       I = J;
      407      866    1       I$ = BUF_.BASE$;
      408      867    1       IF I >= LENGTHC( 'NO CARRIER') THEN
      409      868    1           IF SUBSTR( IBUF, 0, LENGTHC( 'NO CARRIER')) = 'NO CARRIER' THEN
      410      869    1               ALTRETURN;
      411      870    1       IF I >= LENGTHC( 'clr ') THEN
      412      871    1           IF SUBSTR( IBUF, 0, LENGTHC( 'clr ')) = 'clr ' THEN
      413      872    1               ALTRETURN;
      414      873    1       RETURN;
      415      874    1   REPORT_TIMEOUT:
      416      875    1       I = LENGTHC( '<<line timeout>>');
      417      876    1       I$ = BUF_.BASE$;
      418      877    1       IBUF = '<<line timeout>>';
      419      878    1       VLEN = I - 1;
      420      879    1       ALTRETURN;
      421      880    1   READ_ERR:
      422      881    1       UNWIND TO TCM_SMTP_BAILOUT;
      423      882        %EJECT;
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:73   
      424      883    1   TCM$WRITE_SMTP: ENTRY( BUFIN_, VLEN) ALTRET;
      425      884
      426      885    1       BUF_ = BUFIN_;
      427      886    1       IF %SMTPTYPE_RES = %RES_SOCK THEN
      428      887    1           I = MAXIMUM( 0, VLEN);
      429      888    1       ELSE
      430      889    1           I = VLEN + 1;
      431      890    1       BUF_.BOUND = I;
      432      891    1       I$ = BUF_.BASE$;
      433      892    2       DO SELECT( %SMTPTYPE_RES);
      434      893    2           SELECT( %RES_ALEX);
      435      894    2               SUBSTR( IBUF, I, 1) = BINASC( 13/*CR*/);
      436      895    2               CALL TCM$ALEX_WRITE( BUF_, ALEX_ERR) ALTRET( WRITE_ERR);
      437      896    2           SELECT( %RES_SOCK);
      438      897    2               CALL TCM$LTCP_WRITE( BUF_, ALEX_ERR) ALTRET( WRITE_ERR);
      439      898    2           SELECT( %RES_CL);
      440      899    2               CALL TCM$CL_WRITE( BUF_, ALEX_ERR) ALTRET( WRITE_ERR);
      441      900    2           END;
      442      901    1       RETURN;
      443      902    1   WRITE_ERR:
      444      903    1       UNWIND TO TCM_SMTP_BAILOUT;
      445      904
      446      905    1       END TCM$READ_SMTP;
      447      906        %EOD;

PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:74   
--  Include file information  --

   TCM_SEND_E.:TCA2TOU  is referenced.
   TCM_COMMON_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$READ_SMTP.

   Procedure TCM$READ_SMTP requires 251 words for executable code.
   Procedure TCM$READ_SMTP requires 28 words of local(AUTO) storage.

PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:75   

 Object Unit name= TCM$READ_SMTP                              File name= TCM$SEND2.:TCA2TOU
 UTS= NOV 16 '97 14:19:53.80 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     16     20  TCM$READ_SMTP
    2   Proc  even  none   251    373  TCM$READ_SMTP
    3  RoData even  none     2      2  TCM$READ_SMTP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        3  TCM$READ_SMTP
     2      5          yes     yes      Std        3  TCM$READ_SMTP_NULLOK
     2    254          yes     yes      Std        2  TCM$WRITE_SMTP
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:76   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       7 TCM$ALEX_READ
 yes     yes           Std       7 TCM$LTCP_READ
 yes     yes           Std       2 TCM$CL_WRITE
 yes     yes           Std       7 TCM$CL_READ
 yes     yes           Std       2 TCM$LTCP_WRITE
 yes     yes           Std       2 TCM$ALEX_WRITE
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
                       nStd      0 X66_AUNWIND

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  TCM_SMTP_BAILOUT                      TCM_SMTP_TYPE
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:77   


      314        1        /*T***********************************************************/
      315        2        /*T*                                                         */
      316        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      317        4        /*T*                                                         */
      318        5        /*T***********************************************************/
      319        6        TCM$READ_SMTP: PROC( BUFIN_, VLEN, TIMEOUT) ALTRET;

      6  2 000000   000000 700200 xent  TCM$READ_SM* TSX0  ! X66_AUTO_3
         2 000001   000034 000003                    ZERO    28,3

      320        7        %INCLUDE CP_6;
      321       88        %INCLUDE CP_6_SUBS;
      322      628        %INCLUDE TCM_COMMON_M;
      323      659        %INCLUDE TCM_SEND_E;
      324      765            %VLP_EOMTABLE( FPTN=ALEX_EOMSET, VALUES=STD, STCLASS=CONSTANT);
      325      784
      326      785    1       DCL TCM$ALEX_READ ENTRY(7) ALTRET;
      327      786    1       DCL TCM$ALEX_WRITE ENTRY(2) ALTRET;
      328      787    1       DCL TCM$LTCP_READ ENTRY(7) ALTRET;
      329      788    1       DCL TCM$LTCP_WRITE ENTRY(2) ALTRET;
      330      789    1       DCL TCM$CL_READ ENTRY(7) ALTRET;
      331      790    1       DCL TCM$CL_WRITE ENTRY(2) ALTRET;
      332      791
      333      792    1       DCL TCM_SMTP_BAILOUT REMEMBER SYMREF;
      334      793
      335      794    1       DCL ALEX_EOM CHAR(1);
      336      795    1       DCL ALEX_ERR UBIN;
      337      796    1       DCL ALEX_LEN UBIN;
      338      797    1       DCL BUFC(0:255) BASED BIT(9) CALIGNED;
      339      798    1       DCL BUFIN_ BIT(72) DALIGNED;
      340      799    1       DCL 1 BUF_ DALIGNED,
      341      800    1            2 BOUND UBIN(20) UNAL,
      342      801    1            2 * BIT(16) UNAL,
      343      802    1            2 BASE$ PTR;
      344      803    1       DCL CHARB BIT(9);
      345      804    1       DCL I SBIN;
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:78   
      346      805    1       DCL IBUF CHAR( I) BASED( I$);
      347      806    1       DCL IGNORE_NULL_READS BIT(1);
      348      807    1       DCL I$ PTR;
      349      808    1       DCL J SBIN;
      350      809    1       DCL TIMED_OUT BIT(1);
      351      810    1       DCL TIMEOUT SBIN;
      352      811    1       DCL TIMEOUT_VALUE SBIN;
      353      812    1       DCL VLEN SBIN;
      354      813
      355      814    1       DCL TCM_SMTP_TYPE UBIN WORD SYMREF;
      356      815
      357      816        %EJECT;
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:79   
      358      817    1       IGNORE_NULL_READS = %YES#;

    817  2 000002   400000 236003                    LDQ     -131072,DU
         2 000003   200016 756100                    STQ     IGNORE_NULL_READS,,AUTO

      359      818    1       GOTO SETUP;

    818  2 000004   000010 710000 2                  TRA     SETUP

      360      819
      361      820    1   TCM$READ_SMTP_NULLOK: ENTRY( BUFIN_, VLEN, TIMEOUT);

    820  2 000005   000000 700200 xent  TCM$READ_SM* TSX0  ! X66_AUTO_3
         2 000006   000034 000003                    ZERO    28,3

      362      821
      363      822    1       IGNORE_NULL_READS = %NO#;

    822  2 000007   200016 450100                    STZ     IGNORE_NULL_READS,,AUTO

      364      823    1   SETUP:
      365      824    1       BUF_ = BUFIN_;

    824  2 000010   200003 470500       SETUP        LDP0    @BUFIN_,,AUTO
         2 000011   000000 237100                    LDAQ    0,,PR0
         2 000012   200012 757100                    STAQ    BUF_,,AUTO

      366      825    1       IF ADDR( TIMEOUT) = ADDR( NIL) THEN

    825  2 000013   200005 236100                    LDQ     @TIMEOUT,,AUTO
         2 000014   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000015   000021 601000 2                  TNZ     s:828

      367      826    1           TIMEOUT_VALUE = 900;

    826  2 000016   001604 235007                    LDA     900,DL
         2 000017   200022 755100                    STA     TIMEOUT_VALUE,,AUTO
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:80   
         2 000020   000024 710000 2                  TRA     REDO_READ

      368      827    1       ELSE
      369      828    1           TIMEOUT_VALUE = TIMEOUT;

    828  2 000021   200005 471500                    LDP1    @TIMEOUT,,AUTO
         2 000022   100000 235100                    LDA     0,,PR1
         2 000023   200022 755100                    STA     TIMEOUT_VALUE,,AUTO

      370      829    1   REDO_READ:
      371      830    2       DO SELECT( %SMTPTYPE_RES);

    830  2 000024   000000 236000 xsym  REDO_READ    LDQ     TCM_SMTP_TYPE
         2 000025   000011 772000                    QRL     9
         2 000026   000007 376007                    ANQ     7,DL
         2 000027   200024 756100                    STQ     TIMEOUT_VALUE+2,,AUTO
         2 000030   000011 736000                    QLS     9
         2 000031   002000 116007                    CMPQ    1024,DL
         2 000032   000040 602000 2                  TNC     REDO_READ+12
         2 000033   000067 600000 2                  TZE     s:836
         2 000034   200024 236100                    LDQ     TIMEOUT_VALUE+2,,AUTO
         2 000035   000003 116007                    CMPQ    3,DL
         2 000036   000134 601000 2                  TNZ     s:844
         2 000037   000112 710000 2                  TRA     s:840
         2 000040   200024 236100                    LDQ     TIMEOUT_VALUE+2,,AUTO
         2 000041   000001 116007                    CMPQ    1,DL
         2 000042   000134 601000 2                  TNZ     s:844
         2 000043   000044 710000 2                  TRA     s:832

      372      831    2           SELECT( %RES_ALEX);

      373      832    2               CALL TCM$ALEX_READ( BUF_, TIMEOUT_VALUE,

    832  2 000044   200021 630500                    EPPR0   TIMED_OUT,,AUTO
         2 000045   200032 450500                    STP0    TIMEOUT_VALUE+8,,AUTO
         2 000046   200007 631500                    EPPR1   ALEX_ERR,,AUTO
         2 000047   200031 451500                    STP1    TIMEOUT_VALUE+7,,AUTO
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:81   
         2 000050   200010 633500                    EPPR3   ALEX_LEN,,AUTO
         2 000051   200030 453500                    STP3    TIMEOUT_VALUE+6,,AUTO
         2 000052   200006 634500                    EPPR4   ALEX_EOM,,AUTO
         2 000053   200027 454500                    STP4    TIMEOUT_VALUE+5,,AUTO
         2 000054   000000 236000 3                  LDQ     0
         2 000055   200026 756100                    STQ     TIMEOUT_VALUE+4,,AUTO
         2 000056   200022 635500                    EPPR5   TIMEOUT_VALUE,,AUTO
         2 000057   200025 455500                    STP5    TIMEOUT_VALUE+3,,AUTO
         2 000060   200012 636500                    EPPR6   BUF_,,AUTO
         2 000061   200024 456500                    STP6    TIMEOUT_VALUE+2,,AUTO
         2 000062   200024 630500                    EPPR0   TIMEOUT_VALUE+2,,AUTO
         2 000063   000025 631400 xsym               EPPR1   B_VECTNIL+21
         2 000064   000000 701000 xent               TSX1    TCM$ALEX_READ
         2 000065   000251 702000 2                  TSX2    READ_ERR
         2 000066   000134 710000 2                  TRA     s:844

      374      833    2                       ALEX_EOMSET, ALEX_EOM, ALEX_LEN, ALEX_ERR, TIMED_OUT)
      375      834    2                       ALTRET( READ_ERR);
      376      835    2           SELECT( %RES_SOCK);

      377      836    2               CALL TCM$LTCP_READ( BUF_, TIMEOUT_VALUE,

    836  2 000067   200021 630500                    EPPR0   TIMED_OUT,,AUTO
         2 000070   200032 450500                    STP0    TIMEOUT_VALUE+8,,AUTO
         2 000071   200007 631500                    EPPR1   ALEX_ERR,,AUTO
         2 000072   200031 451500                    STP1    TIMEOUT_VALUE+7,,AUTO
         2 000073   200010 633500                    EPPR3   ALEX_LEN,,AUTO
         2 000074   200030 453500                    STP3    TIMEOUT_VALUE+6,,AUTO
         2 000075   200006 634500                    EPPR4   ALEX_EOM,,AUTO
         2 000076   200027 454500                    STP4    TIMEOUT_VALUE+5,,AUTO
         2 000077   000000 236000 3                  LDQ     0
         2 000100   200026 756100                    STQ     TIMEOUT_VALUE+4,,AUTO
         2 000101   200022 635500                    EPPR5   TIMEOUT_VALUE,,AUTO
         2 000102   200025 455500                    STP5    TIMEOUT_VALUE+3,,AUTO
         2 000103   200012 636500                    EPPR6   BUF_,,AUTO
         2 000104   200024 456500                    STP6    TIMEOUT_VALUE+2,,AUTO
         2 000105   200024 630500                    EPPR0   TIMEOUT_VALUE+2,,AUTO
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:82   
         2 000106   000025 631400 xsym               EPPR1   B_VECTNIL+21
         2 000107   000000 701000 xent               TSX1    TCM$LTCP_READ
         2 000110   000251 702000 2                  TSX2    READ_ERR
         2 000111   000134 710000 2                  TRA     s:844

      378      837    2                       ALEX_EOMSET, ALEX_EOM, ALEX_LEN, ALEX_ERR, TIMED_OUT)
      379      838    2                       ALTRET( READ_ERR);
      380      839    2           SELECT( %RES_CL);

      381      840    2               CALL TCM$CL_READ( BUF_, TIMEOUT_VALUE,

    840  2 000112   200021 630500                    EPPR0   TIMED_OUT,,AUTO
         2 000113   200032 450500                    STP0    TIMEOUT_VALUE+8,,AUTO
         2 000114   200007 631500                    EPPR1   ALEX_ERR,,AUTO
         2 000115   200031 451500                    STP1    TIMEOUT_VALUE+7,,AUTO
         2 000116   200010 633500                    EPPR3   ALEX_LEN,,AUTO
         2 000117   200030 453500                    STP3    TIMEOUT_VALUE+6,,AUTO
         2 000120   200006 634500                    EPPR4   ALEX_EOM,,AUTO
         2 000121   200027 454500                    STP4    TIMEOUT_VALUE+5,,AUTO
         2 000122   000000 236000 3                  LDQ     0
         2 000123   200026 756100                    STQ     TIMEOUT_VALUE+4,,AUTO
         2 000124   200022 635500                    EPPR5   TIMEOUT_VALUE,,AUTO
         2 000125   200025 455500                    STP5    TIMEOUT_VALUE+3,,AUTO
         2 000126   200012 636500                    EPPR6   BUF_,,AUTO
         2 000127   200024 456500                    STP6    TIMEOUT_VALUE+2,,AUTO
         2 000130   200024 630500                    EPPR0   TIMEOUT_VALUE+2,,AUTO
         2 000131   000025 631400 xsym               EPPR1   B_VECTNIL+21
         2 000132   000000 701000 xent               TSX1    TCM$CL_READ
         2 000133   000251 702000 2                  TSX2    READ_ERR

      382      841    2                       ALEX_EOMSET, ALEX_EOM, ALEX_LEN, ALEX_ERR, TIMED_OUT)
      383      842    2                       ALTRET( READ_ERR);
      384      843    2           END;

      385      844    1       IF TIMED_OUT THEN

    844  2 000134   200021 234100                    SZN     TIMED_OUT,,AUTO
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:83   
         2 000135   000233 604000 2                  TMI     REPORT_TIMEOUT

      386      845    1           GOTO REPORT_TIMEOUT;
      387      846    1       IF ALEX_LEN = 0 THEN

    846  2 000136   200010 235100                    LDA     ALEX_LEN,,AUTO
         2 000137   000143 601000 2                  TNZ     s:851

      388      847    1           IF IGNORE_NULL_READS THEN

    847  2 000140   200016 234100                    SZN     IGNORE_NULL_READS,,AUTO
         2 000141   000024 604000 2                  TMI     REDO_READ

      389      848    1               GOTO REDO_READ;
      390      849    1           ELSE
      391      850    1               ALTRETURN;

    850  2 000142   000000 702200 xent               TSX2  ! X66_AALT

      392      851    1       VLEN = ALEX_LEN - 1;

    851  2 000143   000001 135007                    SBLA    1,DL
         2 000144   200004 470500                    LDP0    @VLEN,,AUTO
         2 000145   000000 755100                    STA     0,,PR0

      393      852    1       J = 0;

    852  2 000146   200020 450100                    STZ     J,,AUTO

      394      853    2       DO I = 0 TO VLEN;

    853  2 000147   200015 450100                    STZ     I,,AUTO
         2 000150   000173 710000 2                  TRA     s:858+1

      395      854    2           CHARB = BUF_.BASE$->BUFC( I) & '177'O;

    854  2 000151   200013 470500                    LDP0    BUF_+1,,AUTO
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:84   
         2 000152   200015 235100                    LDA     I,,AUTO
         2 000153   000100 100505                    MLR     fill='000'O
         2 000154   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         2 000155   200024 000004                    ADSC9   TIMEOUT_VALUE+2,,AUTO    cn=0,n=4
         2 000156   200024 236100                    LDQ     TIMEOUT_VALUE+2,,AUTO
         2 000157   177000 376003                    ANQ     65024,DU
         2 000160   200014 756100                    STQ     CHARB,,AUTO

      396      855    2           BUF_.BASE$->BUFC( J) = CHARB;

    855  2 000161   200020 235100                    LDA     J,,AUTO
         2 000162   000105 100500                    MLR     fill='000'O
         2 000163   200014 000001                    ADSC9   CHARB,,AUTO              cn=0,n=1
         2 000164   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1

      397      856    2           IF CHARB >= '040'O THEN

    856  2 000165   200014 236100                    LDQ     CHARB,,AUTO
         2 000166   777000 376003                    ANQ     -512,DU
         2 000167   040000 116003                    CMPQ    16384,DU
         2 000170   000172 602000 2                  TNC     s:858

      398      857    2               J = J + 1;

    857  2 000171   200020 054100                    AOS     J,,AUTO

      399      858    2           END;

    858  2 000172   200015 054100                    AOS     I,,AUTO
         2 000173   200004 470500                    LDP0    @VLEN,,AUTO
         2 000174   200015 236100                    LDQ     I,,AUTO
         2 000175   000000 116100                    CMPQ    0,,PR0
         2 000176   000151 604400 2                  TMOZ    s:854

      400      859    1       IF J = 0 THEN

    859  2 000177   200020 235100                    LDA     J,,AUTO
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:85   
         2 000200   000204 601000 2                  TNZ     s:864

      401      860    1           IF IGNORE_NULL_READS THEN

    860  2 000201   200016 234100                    SZN     IGNORE_NULL_READS,,AUTO
         2 000202   000024 604000 2                  TMI     REDO_READ

      402      861    1               GOTO REDO_READ;
      403      862    1           ELSE
      404      863    1               ALTRETURN;

    863  2 000203   000000 702200 xent               TSX2  ! X66_AALT

      405      864    1       VLEN = J - 1;

    864  2 000204   000001 135007                    SBLA    1,DL
         2 000205   000000 755100                    STA     0,,PR0

      406      865    1       I = J;

    865  2 000206   200020 235100                    LDA     J,,AUTO
         2 000207   200015 755100                    STA     I,,AUTO

      407      866    1       I$ = BUF_.BASE$;

    866  2 000210   200013 236100                    LDQ     BUF_+1,,AUTO
         2 000211   200017 756100                    STQ     I$,,AUTO

      408      867    1       IF I >= LENGTHC( 'NO CARRIER') THEN

    867  2 000212   000012 115007                    CMPA    10,DL
         2 000213   000222 604000 2                  TMI     s:870

      409      868    1           IF SUBSTR( IBUF, 0, LENGTHC( 'NO CARRIER')) = 'NO CARRIER' THEN

    868  2 000214   200017 471500                    LDP1    I$,,AUTO
         2 000215   040000 106500                    CMPC    fill='040'O
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:86   
         2 000216   100000 000012                    ADSC9   0,,PR1                   cn=0,n=10
         2 000217   000010 000012 1                  ADSC9   ALEX_EOMSET+8            cn=0,n=10
         2 000220   000222 601000 2                  TNZ     s:870

      410      869    1               ALTRETURN;

    869  2 000221   000000 702200 xent               TSX2  ! X66_AALT

      411      870    1       IF I >= LENGTHC( 'clr ') THEN

    870  2 000222   000004 115007                    CMPA    4,DL
         2 000223   000232 604000 2                  TMI     s:873

      412      871    1           IF SUBSTR( IBUF, 0, LENGTHC( 'clr ')) = 'clr ' THEN

    871  2 000224   200017 471500                    LDP1    I$,,AUTO
         2 000225   040000 106500                    CMPC    fill='040'O
         2 000226   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 000227   000013 000004 1                  ADSC9   ALEX_EOMSET+11           cn=0,n=4
         2 000230   000232 601000 2                  TNZ     s:873

      413      872    1               ALTRETURN;

    872  2 000231   000000 702200 xent               TSX2  ! X66_AALT

      414      873    1       RETURN;

    873  2 000232   000000 702200 xent               TSX2  ! X66_ARET

      415      874    1   REPORT_TIMEOUT:
      416      875    1       I = LENGTHC( '<<line timeout>>');

    875  2 000233   000020 235007       REPORT_TIME* LDA     16,DL
         2 000234   200015 755100                    STA     I,,AUTO

      417      876    1       I$ = BUF_.BASE$;

PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:87   
    876  2 000235   200013 236100                    LDQ     BUF_+1,,AUTO
         2 000236   200017 756100                    STQ     I$,,AUTO

      418      877    1       IBUF = '<<line timeout>>';

    877  2 000237   200017 470500                    LDP0    I$,,AUTO
         2 000240   000000 620005                    EAX0    0,AL
         2 000241   040140 100400                    MLR     fill='040'O
         2 000242   000014 000020 1                  ADSC9   ALEX_EOMSET+12           cn=0,n=16
         2 000243   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0

      419      878    1       VLEN = I - 1;

    878  2 000244   200004 471500                    LDP1    @VLEN,,AUTO
         2 000245   200015 235100                    LDA     I,,AUTO
         2 000246   000001 135007                    SBLA    1,DL
         2 000247   100000 755100                    STA     0,,PR1

      420      879    1       ALTRETURN;

    879  2 000250   000000 702200 xent               TSX2  ! X66_AALT

      421      880    1   READ_ERR:
      422      881    1       UNWIND TO TCM_SMTP_BAILOUT;

    881  2 000251   000000 237200 xsym  READ_ERR     LDAQ  ! TCM_SMTP_BAILOUT
         2 000252   000000 700200 xent               TSX0  ! X66_AUNWIND
         2 000253   000000 000200                    ZERO    0,128

      423      882        %EJECT;
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:88   
      424      883    1   TCM$WRITE_SMTP: ENTRY( BUFIN_, VLEN) ALTRET;

    883  2 000254   000000 700200 xent  TCM$WRITE_S* TSX0  ! X66_AUTO_3
         2 000255   000034 000003                    ZERO    28,3

      425      884
      426      885    1       BUF_ = BUFIN_;

    885  2 000256   200003 470500                    LDP0    @BUFIN_,,AUTO
         2 000257   000000 237100                    LDAQ    0,,PR0
         2 000260   200012 757100                    STAQ    BUF_,,AUTO

      427      886    1       IF %SMTPTYPE_RES = %RES_SOCK THEN

    886  2 000261   000000 236000 xsym               LDQ     TCM_SMTP_TYPE
         2 000262   000011 772000                    QRL     9
         2 000263   000007 376007                    ANQ     7,DL
         2 000264   000002 116007                    CMPQ    2,DL
         2 000265   000275 601000 2                  TNZ     s:889

      428      887    1           I = MAXIMUM( 0, VLEN);

    887  2 000266   200004 471500                    LDP1    @VLEN,,AUTO
         2 000267   100000 236100                    LDQ     0,,PR1
         2 000270   000000 116003                    CMPQ    0,DU
         2 000271   000273 605000 2                  TPL     s:887+5
         2 000272   000000 236003                    LDQ     0,DU
         2 000273   200015 756100                    STQ     I,,AUTO
         2 000274   000301 710000 2                  TRA     s:890

      429      888    1       ELSE
      430      889    1           I = VLEN + 1;

    889  2 000275   200004 471500                    LDP1    @VLEN,,AUTO
         2 000276   100000 235100                    LDA     0,,PR1
         2 000277   000001 035007                    ADLA    1,DL
         2 000300   200015 755100                    STA     I,,AUTO
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:89   

      431      890    1       BUF_.BOUND = I;

    890  2 000301   200015 236100                    LDQ     I,,AUTO
         2 000302   000020 736000                    QLS     16
         2 000303   200012 676100                    ERQ     BUF_,,AUTO
         2 000304   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 000305   200012 656100                    ERSQ    BUF_,,AUTO

      432      891    1       I$ = BUF_.BASE$;

    891  2 000306   200013 236100                    LDQ     BUF_+1,,AUTO
         2 000307   200017 756100                    STQ     I$,,AUTO

      433      892    2       DO SELECT( %SMTPTYPE_RES);

    892  2 000310   000000 236000 xsym               LDQ     TCM_SMTP_TYPE
         2 000311   000011 772000                    QRL     9
         2 000312   000007 376007                    ANQ     7,DL
         2 000313   200024 756100                    STQ     TIMEOUT_VALUE+2,,AUTO
         2 000314   000011 736000                    QLS     9
         2 000315   002000 116007                    CMPQ    1024,DL
         2 000316   000324 602000 2                  TNC     s:892+12
         2 000317   000346 600000 2                  TZE     s:897
         2 000320   200024 236100                    LDQ     TIMEOUT_VALUE+2,,AUTO
         2 000321   000003 116007                    CMPQ    3,DL
         2 000322   000367 601000 2                  TNZ     s:901
         2 000323   000357 710000 2                  TRA     s:899
         2 000324   200024 236100                    LDQ     TIMEOUT_VALUE+2,,AUTO
         2 000325   000001 116007                    CMPQ    1,DL
         2 000326   000367 601000 2                  TNZ     s:901
         2 000327   000330 710000 2                  TRA     s:894

      434      893    2           SELECT( %RES_ALEX);

      435      894    2               SUBSTR( IBUF, I, 1) = BINASC( 13/*CR*/);

PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:90   
    894  2 000330   200017 473500                    LDP3    I$,,AUTO
         2 000331   200015 235100                    LDA     I,,AUTO
         2 000332   040105 100400                    MLR     fill='040'O
         2 000333   000001 000001 3                  ADSC9   1                        cn=0,n=1
         2 000334   300000 000001                    ADSC9   0,A,PR3                  cn=0,n=1

      436      895    2               CALL TCM$ALEX_WRITE( BUF_, ALEX_ERR) ALTRET( WRITE_ERR);

    895  2 000335   200007 634500                    EPPR4   ALEX_ERR,,AUTO
         2 000336   200025 454500                    STP4    TIMEOUT_VALUE+3,,AUTO
         2 000337   200012 635500                    EPPR5   BUF_,,AUTO
         2 000340   200024 455500                    STP5    TIMEOUT_VALUE+2,,AUTO
         2 000341   200024 630500                    EPPR0   TIMEOUT_VALUE+2,,AUTO
         2 000342   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000343   000000 701000 xent               TSX1    TCM$ALEX_WRITE
         2 000344   000370 702000 2                  TSX2    WRITE_ERR
         2 000345   000367 710000 2                  TRA     s:901

      437      896    2           SELECT( %RES_SOCK);

      438      897    2               CALL TCM$LTCP_WRITE( BUF_, ALEX_ERR) ALTRET( WRITE_ERR);

    897  2 000346   200007 633500                    EPPR3   ALEX_ERR,,AUTO
         2 000347   200025 453500                    STP3    TIMEOUT_VALUE+3,,AUTO
         2 000350   200012 634500                    EPPR4   BUF_,,AUTO
         2 000351   200024 454500                    STP4    TIMEOUT_VALUE+2,,AUTO
         2 000352   200024 630500                    EPPR0   TIMEOUT_VALUE+2,,AUTO
         2 000353   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000354   000000 701000 xent               TSX1    TCM$LTCP_WRITE
         2 000355   000370 702000 2                  TSX2    WRITE_ERR
         2 000356   000367 710000 2                  TRA     s:901

      439      898    2           SELECT( %RES_CL);

      440      899    2               CALL TCM$CL_WRITE( BUF_, ALEX_ERR) ALTRET( WRITE_ERR);

    899  2 000357   200007 633500                    EPPR3   ALEX_ERR,,AUTO
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:91   
         2 000360   200025 453500                    STP3    TIMEOUT_VALUE+3,,AUTO
         2 000361   200012 634500                    EPPR4   BUF_,,AUTO
         2 000362   200024 454500                    STP4    TIMEOUT_VALUE+2,,AUTO
         2 000363   200024 630500                    EPPR0   TIMEOUT_VALUE+2,,AUTO
         2 000364   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000365   000000 701000 xent               TSX1    TCM$CL_WRITE
         2 000366   000370 702000 2                  TSX2    WRITE_ERR

      441      900    2           END;

      442      901    1       RETURN;

    901  2 000367   000000 702200 xent               TSX2  ! X66_ARET

      443      902    1   WRITE_ERR:
      444      903    1       UNWIND TO TCM_SMTP_BAILOUT;

    903  2 000370   000000 237200 xsym  WRITE_ERR    LDAQ  ! TCM_SMTP_BAILOUT
         2 000371   000000 700200 xent               TSX0  ! X66_AUNWIND
         2 000372   000000 000200                    ZERO    0,128

ALEX_EOMSET
 Sect OctLoc
   1     000   010054 000057   000000 000000   000000 000000   000000 000000    .,./............
   1     004   010054 000057   000000 000000   000000 000000   000000 000000    .,./............

(unnamed)
 Sect OctLoc
   1     010   116117 040103   101122 122111   105122 040040   143154 162040    NO CARRIER  clr
   1     014   074074 154151   156145 040164   151155 145157   165164 076076    <<line timeout>>

(unnamed)
 Sect OctLoc
   3     000   000000 006000   015040 040040                                    .....
      445      904
      446      905    1       END TCM$READ_SMTP;
      447      906        %EOD;
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:92   

PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:93   
--  Include file information  --

   TCM_SEND_E.:TCA2TOU  is referenced.
   TCM_COMMON_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$READ_SMTP.
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:94   

 **** Variables and constants ****

  ****  Section 001 RoData TCM$READ_SMTP

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(288)   r     1 ALEX_EOMSET

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @BUFIN_                    5-0-0/w PTR         r     1 @TIMEOUT
     4-0-0/w PTR         r     1 @VLEN                      6-0-0/c CHAR        r     1 ALEX_EOM
     7-0-0/w UBIN        r     1 ALEX_ERR                  10-0-0/w UBIN        r     1 ALEX_LEN
    *0-0-0/d BIT (72)    r     1 BUFIN_                    12-0-0/d STRC(72)    r     1 BUF_
    14-0-0/b BIT (9)     r     1 CHARB                     15-0-0/w SBIN        r     1 I
    17-0-0/w PTR         r     1 I$                        16-0-0/b BIT         r     1 IGNORE_NULL_READS
    20-0-0/w SBIN        r     1 J                         21-0-0/b BIT         r     1 TIMED_OUT
    *0-0-0/w SBIN        r     1 TIMEOUT                   22-0-0/w SBIN        r     1 TIMEOUT_VALUE
    *0-0-0/w SBIN        r     1 VLEN

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d REMB        r     1 TCM_SMTP_BAILOUT           0-0-0/w UBIN        r     1 TCM_SMTP_TYPE

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c BIT (9)     r     1 BUFC(0:255)                0-0-0/w ASTR        r     1 CV
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:95   
     0-0-0/c ACHR        r     1 IBUF                       0-0-0/c ASTR(9)     r     1 TEXTC


   Procedure TCM$READ_SMTP requires 251 words for executable code.
   Procedure TCM$READ_SMTP requires 28 words of local(AUTO) storage.
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:96   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:97   
          MINI XREF LISTING

ALEX_EOM
       794**DCL       832<>CALL      836<>CALL      840<>CALL
ALEX_EOMSET
       782**DCL       832<>CALL      836<>CALL      840<>CALL
ALEX_ERR
       795**DCL       832<>CALL      836<>CALL      840<>CALL      895<>CALL      897<>CALL      899<>CALL
ALEX_LEN
       796**DCL       832<>CALL      836<>CALL      840<>CALL      846>>IF        851>>ASSIGN
BUFC
       797**DCL       854>>ASSIGN    855<<ASSIGN
BUFIN_
       798**DCL         6--PROC      820--ENTRY     824>>ASSIGN    883--ENTRY     885>>ASSIGN
BUF_
       799**DCL       824<<ASSIGN    832<>CALL      836<>CALL      840<>CALL      885<<ASSIGN    895<>CALL
       897<>CALL      899<>CALL
BUF_.BASE$
       802**DCL       854>>ASSIGN    855>>ASSIGN    866>>ASSIGN    876>>ASSIGN    891>>ASSIGN
BUF_.BOUND
       800**DCL       890<<ASSIGN
CHARB
       803**DCL       854<<ASSIGN    855>>ASSIGN    856>>IF
CV.L
       651**DCL       652--IMP-SIZ
I
       804**DCL       805--IMP-SIZ   853<<DOINDEX   854>>ASSIGN    865<<ASSIGN    867>>IF        868>>IF
       870>>IF        871>>IF        875<<ASSIGN    877>>ASSIGN    878>>ASSIGN    887<<ASSIGN    889<<ASSIGN
       890>>ASSIGN    894>>ASSIGN    894>>ASSIGN
I$
       807**DCL       805--IMP-PTR   866<<ASSIGN    868>>IF        871>>IF        876<<ASSIGN    877>>ASSIGN
       891<<ASSIGN    894>>ASSIGN
IBUF
       805**DCL       868>>IF        871>>IF        877<<ASSIGN    894<<ASSIGN
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:98   
IGNORE_NULL_READS
       806**DCL       817<<ASSIGN    822<<ASSIGN    847>>IF        860>>IF
J
       808**DCL       852<<ASSIGN    855>>ASSIGN    857<<ASSIGN    857>>ASSIGN    859>>IF        864>>ASSIGN
       865>>ASSIGN
READ_ERR
       881**LABEL     832--CALLALT   836--CALLALT   840--CALLALT
REDO_READ
       830**LABEL     848--GOTO      861--GOTO
REPORT_TIMEOUT
       875**LABEL     845--GOTO
SETUP
       824**LABEL     818--GOTO
TCM$ALEX_READ
       785**DCL-ENT   832--CALL
TCM$ALEX_WRITE
       786**DCL-ENT   895--CALL
TCM$CL_READ
       789**DCL-ENT   840--CALL
TCM$CL_WRITE
       790**DCL-ENT   899--CALL
TCM$LTCP_READ
       787**DCL-ENT   836--CALL
TCM$LTCP_WRITE
       788**DCL-ENT   897--CALL
TCM_SMTP_BAILOUT
       792**DCL       881>>UNWIND    903>>UNWIND
TCM_SMTP_TYPE
       814**DCL       830>>DOSELCT   886>>IF        892>>DOSELCT
TEXTC.L
       655**DCL       656--IMP-SIZ
TIMED_OUT
       809**DCL       832<>CALL      836<>CALL      840<>CALL      844>>IF
TIMEOUT
       810**DCL         6--PROC      820--ENTRY     825--IF        828>>ASSIGN
TIMEOUT_VALUE
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:99   
       811**DCL       826<<ASSIGN    828<<ASSIGN    832<>CALL      836<>CALL      840<>CALL
VLEN
       812**DCL         6--PROC      820--ENTRY     851<<ASSIGN    853>>DOINDEX   864<<ASSIGN    878<<ASSIGN
       883--ENTRY     887>>ASSIGN    889>>ASSIGN
WRITE_ERR
       903**LABEL     895--CALLALT   897--CALLALT   899--CALLALT
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:100  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:101  
              MINI UREF LISTING

M$ACCT      33**DCL-ENT
M$ACTIVATE      36**DCL-ENT
M$ALIB      29**DCL-ENT
M$ASUSER      31**DCL-ENT
M$ATTACH      38**DCL-ENT
M$BADPP      56**DCL-ENT
M$CGCTL      37**DCL-ENT
M$CGINFO      37**DCL-ENT
M$CHECK      18**DCL-ENT
M$CHGUNIT      76**DCL-ENT
M$CLOSE      16**DCL-ENT
M$CLRSTK      74**DCL-ENT
M$CMDVAR      85**DCL-ENT
M$CONFIG      46**DCL-ENT
M$CORRES      21**DCL-ENT
M$CPEXIT      30**DCL-ENT
M$CVM      54**DCL-ENT
M$CVOL      19**DCL-ENT
M$DCLFLD      46**DCL-ENT
M$DEACTIVATE      36**DCL-ENT
M$DELREC      18**DCL-ENT
M$DEQ      83**DCL-ENT
M$DETACH      38**DCL-ENT
M$DEVICE      20**DCL-ENT
M$DISPLAY      83**DCL-ENT
M$DISPRES      23**DCL-ENT
M$DLIB      29**DCL-ENT
M$DRIBBLE      46**DCL-ENT
M$DRTN      74**DCL-ENT
M$DSUSER      31**DCL-ENT
M$ENQ      82**DCL-ENT
M$EOM      41**DCL-ENT
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:102  
M$ERASE      47**DCL-ENT
M$ERR      28**DCL-ENT
M$ERRMSG      79**DCL-ENT
M$EVENT      71**DCL-ENT
M$EXHUME      80**DCL-ENT
M$EXIT      28**DCL-ENT
M$EXTEND      20**DCL-ENT
M$FDP      52**DCL-ENT
M$FDS      51**DCL-ENT
M$FEBOOT      44**DCL-ENT
M$FECTL      45**DCL-ENT
M$FEDUMP      44**DCL-ENT
M$FID      79**DCL-ENT
M$FINDPROC      33**DCL-ENT
M$FSUSER      31**DCL-ENT
M$FVP      53**DCL-ENT
M$FWCG      37**DCL-ENT
M$GBPL      57**DCL-ENT
M$GDDL      53**DCL-ENT
M$GDP      52**DCL-ENT
M$GDS      51**DCL-ENT
M$GETDCB      22**DCL-ENT
M$GETMOUSE      62**DCL-ENT
M$GETPM      63**DCL-ENT
M$GJOB      81**DCL-ENT
M$GLINEATTR      41**DCL-ENT
M$GOODPP      56**DCL-ENT
M$GPLATEN      49**DCL-ENT
M$GPROMPT      48**DCL-ENT
M$GTRMATTR      42**DCL-ENT
M$GTRMCTL      40**DCL-ENT
M$GTRMTAB      43**DCL-ENT
M$GVP      52**DCL-ENT
M$HELP      79**DCL-ENT
M$INT      71**DCL-ENT
M$INTRTN      32**DCL-ENT
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:103  
M$IOQ      67**DCL-ENT
M$JOBSTATS      81**DCL-ENT
M$KEYIN      21**DCL-ENT
M$LDEV      16**DCL-ENT
M$LDTRC      29**DCL-ENT
M$LIMIT      22**DCL-ENT
M$LINES      21**DCL-ENT
M$LINK      28**DCL-ENT
M$MADMUCK      24**DCL-ENT
M$MAKUSER      55**DCL-ENT
M$MBS      23**DCL-ENT
M$MDFFLD      47**DCL-ENT
M$MERC      72**DCL-ENT
M$MERCS      73**DCL-ENT
M$MIRROR      67**DCL-ENT
M$MONINFO      84**DCL-ENT
M$MPL      57**DCL-ENT
M$NODEINFO      48**DCL-ENT
M$NXTUSR      82**DCL-ENT
M$OCMSG      80**DCL-ENT
M$OLAY      28**DCL-ENT
M$OPEN      16**DCL-ENT
M$PAS      57**DCL-ENT
M$PATHCON      80**DCL-ENT
M$PDS      51**DCL-ENT
M$PFIL      18**DCL-ENT
M$PLATEN      42**DCL-ENT
M$PRECORD      20**DCL-ENT
M$PROCNAME      33**DCL-ENT
M$PROFILE      44**DCL-ENT
M$PROMPT      40**DCL-ENT
M$RACST      24**DCL-ENT
M$RDSYSLOG      65**DCL-ENT
M$READ      17**DCL-ENT
M$RELDCB      22**DCL-ENT
M$RELRES      23**DCL-ENT
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:104  
M$RELSTARF      25**DCL-ENT
M$REM      25**DCL-ENT
M$RENV      72**DCL-ENT
M$REQUIRE      24**DCL-ENT
M$RETRY      73**DCL-ENT
M$RETRYS      73**DCL-ENT
M$REW      19**DCL-ENT
M$RLSFLD      47**DCL-ENT
M$RPRIV      75**DCL-ENT
M$RSPP      54**DCL-ENT
M$RSWITCH      76**DCL-ENT
M$RUE      82**DCL-ENT
M$SAD      55**DCL-ENT
M$SAVE      31**DCL-ENT
M$SCON      32**DCL-ENT
M$SCREECH      30**DCL-ENT
M$SENV      72**DCL-ENT
M$SETFMA      16**DCL-ENT
M$SETFP      45**DCL-ENT
M$SINPUT      43**DCL-ENT
M$SLCFLD      48**DCL-ENT
M$SMOUSE      62**DCL-ENT
M$SMPRT      54**DCL-ENT
M$SPRIV      75**DCL-ENT
M$SSC      55**DCL-ENT
M$SSWITCH      75**DCL-ENT
M$STATE      84**DCL-ENT
M$STD      56**DCL-ENT
M$STIMER      70**DCL-ENT
M$STLPP      53**DCL-ENT
M$STRAP      70**DCL-ENT
M$STRMATTR      42**DCL-ENT
M$STRMCTL      40**DCL-ENT
M$STRMTAB      43**DCL-ENT
M$SYMBIO      81**DCL-ENT
M$SYSCON      67**DCL-ENT
PL6.E3A0      #002=TCM$READ_SMTP File=TCM$SEND2.:TCA2TSI                         SUN 11/16/97 14:19 Page:105  
M$SYSID      85**DCL-ENT
M$TDCLOSE      66**DCL-ENT
M$TDIO      66**DCL-ENT
M$TDOPEN      65**DCL-ENT
M$TDREQCPU      66**DCL-ENT
M$TEMPWROC      60**DCL-ENT
M$TIME      83**DCL-ENT
M$TRAP      70**DCL-ENT
M$TRMISC      45**DCL-ENT
M$TRMPRG      41**DCL-ENT
M$TRTN      74**DCL-ENT
M$TRUNC      17**DCL-ENT
M$TTIMER      70**DCL-ENT
M$UC      40**DCL
M$UMPL      57**DCL-ENT
M$UNFID      79**DCL-ENT
M$UNLATCH      36**DCL-ENT
M$UNSHARE      33**DCL-ENT
M$USRFIELD      76**DCL-ENT
M$VIRTUAL      51**DCL-ENT
M$WAIT      74**DCL-ENT
M$WEOF      19**DCL-ENT
M$WRITE      17**DCL-ENT
M$WRSYSLOG      65**DCL-ENT
M$XCON      71**DCL-ENT
M$XCONRTN      32**DCL-ENT
M$XEQTIME      84**DCL-ENT
M$XFLUSH      25**DCL-ENT
M$XMOUSE      62**DCL-ENT
M$XXX      28**DCL-ENT
M$YC      30**DCL-ENT
TCM$READ_SMTP       6**PROC
TCM$READ_SMTP_NULLOK     820**ENTRY
TCM$WRITE_SMTP     883**ENTRY
TEXT_CHAR     658**DCL

PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:106  
      448        1        /*T***********************************************************/
      449        2        /*T*                                                         */
      450        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      451        4        /*T*                                                         */
      452        5        /*T***********************************************************/
      453        6        TCM$DRAIN_SMTP: PROC( COUNT);
      454        7        %INCLUDE TCM_SEND_E;
      455      113
      456      114    1       DCL TCM$ALEX_DRAIN ENTRY(1);
      457      115
      458      116    1       DCL COUNT UBIN;
      459      117    1       DCL TCM_SMTP_TYPE UBIN SYMREF;
      460      118
      461      119    1       IF %SMTPTYPE_RES = %RES_ALEX THEN
      462      120    1           CALL TCM$ALEX_DRAIN( COUNT);
      463      121    1       ELSE
      464      122    1           COUNT = 0;
      465      123    1       RETURN;
      466      124
      467      125    1       END TCM$DRAIN_SMTP;
      468      126        %EOD;

PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:107  
--  Include file information  --

   TCM_SEND_E.:TCA2TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure TCM$DRAIN_SMTP.

   Procedure TCM$DRAIN_SMTP requires 15 words for executable code.
   Procedure TCM$DRAIN_SMTP requires 4 words of local(AUTO) storage.

PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:108  

 Object Unit name= TCM$DRAIN_SMTP                             File name= TCM$SEND2.:TCA2TOU
 UTS= NOV 16 '97 14:20:27.12 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    15     17  TCM$DRAIN_SMTP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  TCM$DRAIN_SMTP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 TCM$ALEX_DRAIN
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     TCM_SMTP_TYPE                         B_VECTNIL
PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:109  


      448        1        /*T***********************************************************/
      449        2        /*T*                                                         */
      450        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      451        4        /*T*                                                         */
      452        5        /*T***********************************************************/
      453        6        TCM$DRAIN_SMTP: PROC( COUNT);

      6  0 000000   000000 700200 xent  TCM$DRAIN_S* TSX0  ! X66_AUTO_1
         0 000001   000004 000001                    ZERO    4,1

      454        7        %INCLUDE TCM_SEND_E;
      455      113
      456      114    1       DCL TCM$ALEX_DRAIN ENTRY(1);
      457      115
      458      116    1       DCL COUNT UBIN;
      459      117    1       DCL TCM_SMTP_TYPE UBIN SYMREF;
      460      118
      461      119    1       IF %SMTPTYPE_RES = %RES_ALEX THEN

    119  0 000002   000000 236000 xsym               LDQ     TCM_SMTP_TYPE
         0 000003   000011 772000                    QRL     9
         0 000004   000007 376007                    ANQ     7,DL
         0 000005   000001 116007                    CMPQ    1,DL
         0 000006   000014 601000 0                  TNZ     s:122

      462      120    1           CALL TCM$ALEX_DRAIN( COUNT);

    120  0 000007   200003 630500                    EPPR0   @COUNT,,AUTO
         0 000010   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000011   000000 701000 xent               TSX1    TCM$ALEX_DRAIN
         0 000012   000000 011000                    NOP     0
         0 000013   000016 710000 0                  TRA     s:123

      463      121    1       ELSE
      464      122    1           COUNT = 0;

PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:110  
    122  0 000014   200003 470500                    LDP0    @COUNT,,AUTO
         0 000015   000000 450100                    STZ     0,,PR0

      465      123    1       RETURN;

    123  0 000016   000000 702200 xent               TSX2  ! X66_ARET
      466      124
      467      125    1       END TCM$DRAIN_SMTP;
      468      126        %EOD;

PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:111  
--  Include file information  --

   TCM_SEND_E.:TCA2TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure TCM$DRAIN_SMTP.
PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:112  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @COUNT                    *0-0-0/w UBIN        r     1 COUNT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 TCM_SMTP_TYPE


   Procedure TCM$DRAIN_SMTP requires 15 words for executable code.
   Procedure TCM$DRAIN_SMTP requires 4 words of local(AUTO) storage.
PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:113  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:114  
          MINI XREF LISTING

COUNT
       116**DCL         6--PROC      120<>CALL      122<<ASSIGN
TCM$ALEX_DRAIN
       114**DCL-ENT   120--CALL
TCM_SMTP_TYPE
       117**DCL       119>>IF
PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:115  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #003=TCM$DRAIN_SMTP File=TCM$SEND2.:TCA2TSI                        SUN 11/16/97 14:20 Page:116  
              MINI UREF LISTING

TCM$DRAIN_SMTP       6**PROC

PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:117  
      469        1        /*T***********************************************************/
      470        2        /*T*                                                         */
      471        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      472        4        /*T*                                                         */
      473        5        /*T***********************************************************/
      474        6        TCM$CL: PROC( PARM1, PARM2, EOMTABLE, EOMCHAR, ARS, MERR, TIMEFLAG) ALTRET;
      475        7        %INCLUDE CP_6_SUBS;
      476      547        %INCLUDE CP_6;
      477      628            %F$DCB;
      478      685            %FPT_OPEN( DCB=M$CL, ASN=DEVICE, FUN=UPDATE, RES='CL', SN=VLP_SN);
      479      794            %VLP_SN;
      480      807            %FPT_READ( DCB=M$CL, BUF=CLBUF, WAIT=YES, STCLASS=CONSTANT);
      481      846            %FPT_WRITE( DCB=M$CL);
      482      877            %FPT_CLOSE( DCB=M$CL, STCLASS=CONSTANT);
      483      919
      484      920    1       DCL M$CL DCB;
      485      921
      486      922    1       DCL PARM1 CHAR(8);
      487      923    1       DCL BUF_ REDEF PARM1 VECTOR;
      488      924    1       DCL ADDRESS REDEF PARM1 CHAR(8);
      489      925    1       DCL PARM2 UBIN;
      490      926    1       DCL TIME REDEF PARM2 SBIN;
      491      927    1       DCL ERR REDEF PARM2 UBIN;
      492      928    1       DCL EOMTABLE(0:287) BIT(1) UNAL;
      493      929    1       DCL EOMCHAR CHAR(1);
      494      930    1       DCL ARS UBIN;
      495      931    1       DCL MERR UBIN;
      496      932    1       DCL TIMEFLAG BIT(1) UNAL;
      497      933
      498      934    1       DCL B$CHARS CHAR( ARS) BASED;
      499      935    1       DCL CLBUF CHAR(256) STATIC;
      500      936    1       DCL NEEDREAD BIT(1) STATIC INIT( '1'B);
      501      937
      502      938    1   TCM$CL_READ: ENTRY( PARM1/*BUF_*/, PARM2/*TIME*/, EOMTABLE, EOMCHAR, ARS, MERR,
               938            TIMEFLAG) ALTRET;
      503      939
      504      940    2       IF NEEDREAD THEN DO INHIBIT;
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:118  
      505      941    2           NEEDREAD = '0'B;
      506      942    2           CALL M$READ( FPT_READ);
      507      943    2           END;
      508      944    1       ARS = DCBADDR( DCBNUM( M$CL))->F$DCB.ARS#;
      509      945    1       IF ARS > 0 THEN
      510      946    1           VBASE( BUF_)->B$CHARS = SUBSTR( CLBUF, 0, ARS);
      511      947    1       IF ADDR( TIMEFLAG) ~= ADDR( NIL) THEN
      512      948    1           TIMEFLAG = '0'B;
      513      949    1       NEEDREAD = '1'B;
      514      950    1       RETURN;
      515      951
      516      952    1   TCM$CL_WRITE: ENTRY( PARM1/*BUF_*/, PARM2/*ERR*/) ALTRET;
      517      953
      518      954    1       FPT_WRITE.BUF_ = BUF_;
      519      955    1       CALL M$WRITE( FPT_WRITE);
      520      956    1       RETURN;
      521      957
      522      958    1   TCM$CL_CONNECT: ENTRY( PARM1/*ADDRESS*/) ALTRET;
      523      959
      524      960    1       VLP_SN.SN#(0) = ADDRESS;
      525      961    1       FPT_OPEN.V.ATTR# = %ATTR_CL_B2400# | %ATTR_CL_RFU13#;
      526      962    1       CALL M$OPEN( FPT_OPEN);
      527      963    1       RETURN;
      528      964
      529      965    1   TCM$CL_DISCONNECT: ENTRY ALTRET;
      530      966
      531      967    1       IF DCBADDR( DCBNUM( M$CL))->F$DCB.FCD# THEN
      532      968    1           CALL M$CLOSE( FPT_CLOSE);
      533      969    1       RETURN;
      534      970
      535      971    1       END TCM$CL;

PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:119  
--  Include file information  --

   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$CL.

   Procedure TCM$CL requires 71 words for executable code.
   Procedure TCM$CL requires 12 words of local(AUTO) storage.

    No errors detected in file TCM$SEND2.:TCA2TSI    .

PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:120  

 Object Unit name= TCM$CL                                     File name= TCM$SEND2.:TCA2TOU
 UTS= NOV 16 '97 14:20:33.76 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none   139    213  TCM$CL
    2  RoData even  UTS     44     54  TCM$CL
    3   DCB   even  none     0      0  M$CL
    4   Proc  even  none    71    107  TCM$CL
    5  RoData even  none     1      1  TCM$CL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes    yes     yes      Std        7  TCM$CL
     4      3          yes     yes      Std        7  TCM$CL_READ
     4     45          yes     yes      Std        2  TCM$CL_WRITE
     4     56          yes     yes      Std        1  TCM$CL_CONNECT
     4     72          yes     yes      Std        0  TCM$CL_DISCONNECT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_N
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:121  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  M$CL                                  B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:122  


      469        1        /*T***********************************************************/
      470        2        /*T*                                                         */
      471        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      472        4        /*T*                                                         */
      473        5        /*T***********************************************************/
      474        6        TCM$CL: PROC( PARM1, PARM2, EOMTABLE, EOMCHAR, ARS, MERR, TIMEFLAG) ALTRET;

      6  4 000000   000000 700200 xent  TCM$CL       TSX0  ! X66_AUTO_N
         4 000001   000014 000007                    ZERO    12,7
         4 000002   000005 710000 4                  TRA     s:940

      475        7        %INCLUDE CP_6_SUBS;
      476      547        %INCLUDE CP_6;
      477      628            %F$DCB;
      478      685            %FPT_OPEN( DCB=M$CL, ASN=DEVICE, FUN=UPDATE, RES='CL', SN=VLP_SN);
      479      794            %VLP_SN;
      480      807            %FPT_READ( DCB=M$CL, BUF=CLBUF, WAIT=YES, STCLASS=CONSTANT);
      481      846            %FPT_WRITE( DCB=M$CL);
      482      877            %FPT_CLOSE( DCB=M$CL, STCLASS=CONSTANT);
      483      919
      484      920    1       DCL M$CL DCB;
      485      921
      486      922    1       DCL PARM1 CHAR(8);
      487      923    1       DCL BUF_ REDEF PARM1 VECTOR;
      488      924    1       DCL ADDRESS REDEF PARM1 CHAR(8);
      489      925    1       DCL PARM2 UBIN;
      490      926    1       DCL TIME REDEF PARM2 SBIN;
      491      927    1       DCL ERR REDEF PARM2 UBIN;
      492      928    1       DCL EOMTABLE(0:287) BIT(1) UNAL;
      493      929    1       DCL EOMCHAR CHAR(1);
      494      930    1       DCL ARS UBIN;
      495      931    1       DCL MERR UBIN;
      496      932    1       DCL TIMEFLAG BIT(1) UNAL;
      497      933
      498      934    1       DCL B$CHARS CHAR( ARS) BASED;
      499      935    1       DCL CLBUF CHAR(256) STATIC;
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:123  
      500      936    1       DCL NEEDREAD BIT(1) STATIC INIT( '1'B);
      501      937
      502      938    1   TCM$CL_READ: ENTRY( PARM1/*BUF_*/, PARM2/*TIME*/, EOMTABLE, EOMCHAR, ARS, MERR,
               938            TIMEFLAG) ALTRET;

    938  4 000003   000000 700200 xent  TCM$CL_READ  TSX0  ! X66_AUTO_N
         4 000004   000014 000007                    ZERO    12,7

      503      939
      504      940    2       IF NEEDREAD THEN DO INHIBIT;

    940  4 000005   000212 234000 1                  SZN     NEEDREAD
         4 000006   000013 605000 4                  TPL     s:944

      505      941    2           NEEDREAD = '0'B;

    941  4 000007   000212 450200 1                  STZ   ! NEEDREAD

      506      942    2           CALL M$READ( FPT_READ);

    942  4 000010   000000 630600 2                  EPPR0 ! FPT_READ
         4 000011   040000 713600                    CLIMB ! read
         4 000012   401400 401760                    pmme    nvectors=4

      507      943    2           END;

      508      944    1       ARS = DCBADDR( DCBNUM( M$CL))->F$DCB.ARS#;

    944  4 000013   000000 236007 xsym               LDQ     M$CL,DL
         4 000014   000000 470400 5                  LDP0    0
         4 000015   000000 471500                    LDP1    0,,PR0
         4 000016   100000 473506                    LDP3    0,QL,PR1
         4 000017   300000 235100                    LDA     0,,PR3
         4 000020   200007 473500                    LDP3    @ARS,,AUTO
         4 000021   300000 755100                    STA     0,,PR3

      509      945    1       IF ARS > 0 THEN
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:124  

    945  4 000022   000033 600000 4                  TZE     s:947

      510      946    1           VBASE( BUF_)->B$CHARS = SUBSTR( CLBUF, 0, ARS);

    946  4 000023   200003 474500                    LDP4    @PARM1,,AUTO
         4 000024   400001 475500                    LDP5    1,,PR4
         4 000025   300000 720100                    LXL0    0,,PR3
         4 000026   200012 740100                    STX0    @TIMEFLAG+1,,AUTO
         4 000027   200012 221100                    LDX1    @TIMEFLAG+1,,AUTO
         4 000030   040140 100440                    MLR     fill='040'O
         4 000031   000112 000010 1                  ADSC9   CLBUF                    cn=0,n=*X0
         4 000032   500000 000011                    ADSC9   0,,PR5                   cn=0,n=*X1

      511      947    1       IF ADDR( TIMEFLAG) ~= ADDR( NIL) THEN

    947  4 000033   200011 236100                    LDQ     @TIMEFLAG,,AUTO
         4 000034   000001 116000 xsym               CMPQ    B_VECTNIL+1
         4 000035   000042 600000 4                  TZE     s:949

      512      948    1           TIMEFLAG = '0'B;

    948  4 000036   200011 474500                    LDP4    @TIMEFLAG,,AUTO
         4 000037   003100 060400                    CSL     bolr='003'O
         4 000040   000002 000001 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=1
         4 000041   400000 000001                    BDSC    0,,PR4                   by=0,bit=0,n=1

      513      949    1       NEEDREAD = '1'B;

    949  4 000042   400000 236003                    LDQ     -131072,DU
         4 000043   000212 756000 1                  STQ     NEEDREAD

      514      950    1       RETURN;

    950  4 000044   000000 702200 xent               TSX2  ! X66_ARET

      515      951
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:125  
      516      952    1   TCM$CL_WRITE: ENTRY( PARM1/*BUF_*/, PARM2/*ERR*/) ALTRET;

    952  4 000045   000000 700200 xent  TCM$CL_WRITE TSX0  ! X66_AUTO_N
         4 000046   000014 000007                    ZERO    12,7

      517      953
      518      954    1       FPT_WRITE.BUF_ = BUF_;

    954  4 000047   200003 470500                    LDP0    @PARM1,,AUTO
         4 000050   000000 237100                    LDAQ    0,,PR0
         4 000051   000102 757000 1                  STAQ    FPT_WRITE+4

      519      955    1       CALL M$WRITE( FPT_WRITE);

    955  4 000052   000076 630400 1                  EPPR0   FPT_WRITE
         4 000053   040001 713400                    CLIMB   write
         4 000054   401400 401760                    pmme    nvectors=4

      520      956    1       RETURN;

    956  4 000055   000000 702200 xent               TSX2  ! X66_ARET

      521      957
      522      958    1   TCM$CL_CONNECT: ENTRY( PARM1/*ADDRESS*/) ALTRET;

    958  4 000056   000000 700200 xent  TCM$CL_CONN* TSX0  ! X66_AUTO_N
         4 000057   000014 000007                    ZERO    12,7

      523      959
      524      960    1       VLP_SN.SN#(0) = ADDRESS;

    960  4 000060   200003 470500                    LDP0    @PARM1,,AUTO
         4 000061   040000 100500                    MLR     fill='040'O
         4 000062   000000 000006                    ADSC9   0,,PR0                   cn=0,n=6
         4 000063   000073 000006 1                  ADSC9   VLP_SN+1                 cn=0,n=6

      525      961    1       FPT_OPEN.V.ATTR# = %ATTR_CL_B2400# | %ATTR_CL_RFU13#;
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:126  

    961  4 000064   110000 220003                    LDX0    36864,DU
         4 000065   000062 740000 1                  STX0    FPT_OPEN+50

      526      962    1       CALL M$OPEN( FPT_OPEN);

    962  4 000066   000000 630400 1                  EPPR0   FPT_OPEN
         4 000067   050000 713400                    CLIMB   open
         4 000070   410400 401760                    pmme    nvectors=18

      527      963    1       RETURN;

    963  4 000071   000000 702200 xent               TSX2  ! X66_ARET

      528      964
      529      965    1   TCM$CL_DISCONNECT: ENTRY ALTRET;

    965  4 000072   000000 700200 xent  TCM$CL_DISC* TSX0  ! X66_AUTO_N
         4 000073   000014 000007                    ZERO    12,7

      530      966
      531      967    1       IF DCBADDR( DCBNUM( M$CL))->F$DCB.FCD# THEN

    967  4 000074   000000 236007 xsym               LDQ     M$CL,DL
         4 000075   000000 470400 5                  LDP0    0
         4 000076   000000 471500                    LDP1    0,,PR0
         4 000077   100000 473506                    LDP3    0,QL,PR1
         4 000100   300031 236100                    LDQ     25,,PR3
         4 000101   020000 316007                    CANQ    8192,DL
         4 000102   000106 600000 4                  TZE     s:969

      532      968    1           CALL M$CLOSE( FPT_CLOSE);

    968  4 000103   000016 630400 2                  EPPR0   FPT_CLOSE
         4 000104   050001 713400                    CLIMB   close
         4 000105   406000 401760                    pmme    nvectors=13

PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:127  
      533      969    1       RETURN;

    969  4 000106   000000 702200 xent               TSX2  ! X66_ARET

FPT_OPEN
 Sect OctLoc
   1     000   000025 777640   000044 006000   000003 777640   000072 006000    .....$.......:..
   1     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     044*  000000 000042   000000 001003   252525 000000   000040 252520    ..."......... ..
   1     050   103114 040040   000000 000000   000000 777777   000000 000000    CL  ............
   1     054   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     060   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     064   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     070   000000 000000   ****** ******                                    ........

VLP_SN
 Sect OctLoc
   1     072   000000 000001   040040 040040   040040 ******                    ....      ..

FPT_WRITE
 Sect OctLoc
   1     076   000003 777640   000106 006000   000000 177640   000000 006014    .....F..........
   1     102   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     106   000000 400400   000000 000000   000000 000000   000000 000000    ................

CLBUF
 Sect OctLoc
   1     112   ****** ******   ****** ******   ****** ******   ****** ******    ................

NEEDREAD
 Sect OctLoc
   1     212   4***** ******                                                    ....

FPT_READ
 Sect OctLoc
   2     000   000005 777640   000010 006000   000000 177640   000000 006014    ................
   2     004   000077 777640   000112 006000   000000 177640   000000 006014    .?...J..........
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:128  
   2     010   000000 400000   000000 000000   000000 000000   000000 000000    ................
   2     014   000000 000000   000000 000000                                    ........

FPT_CLOSE
 Sect OctLoc
   2     016   000003 777640   000050 006000   000000 177640   000000 006014    .....(..........
   2     022   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     046*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   2     052   000220 000000   000000 000000                                    ........

(unnamed)
 Sect OctLoc
   5     000   000000 006003                                                    ....
      534      970
      535      971    1       END TCM$CL;

PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:129  
--  Include file information  --

   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$CL.
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:130  

 **** Variables and constants ****

  ****  Section 001  Data  TCM$CL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   112-0-0/c CHAR(256)   r     1 CLBUF                      0-0-0/d STRC(2088)  r     1 FPT_OPEN
    76-0-0/d STRC(432)   r     1 FPT_WRITE                212-0-0/b BIT         r     1 NEEDREAD
    72-0-0/d STRC(90)    r     1 VLP_SN

  ****  Section 002 RoData TCM$CL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    16-0-0/d STRC(1080)  r     1 FPT_CLOSE                  0-0-0/d STRC(504)   r     1 FPT_READ

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/w PTR         r     1 @ARS                       6-0-0/w PTR         r     1 @EOMCHAR
     5-0-0/w PTR         r     1 @EOMTABLE                 10-0-0/w PTR         r     1 @MERR
     3-0-0/w PTR         r     1 @PARM1                     4-0-0/w PTR         r     1 @PARM2
    11-0-0/w PTR         r     1 @TIMEFLAG                 *0-0-0/c CHAR(8)     r     1 ADDRESS
    *0-0-0/w UBIN        r     1 ARS                       *0-0-0/d VECT        r     1 BUF_
    *0-0-0/c CHAR        r     1 EOMCHAR                   *0-0-0/b BIT         r     1 EOMTABLE(0:287)
    *0-0-0/w UBIN        r     1 MERR                      *0-0-0/c CHAR(8)     r     1 PARM1
    *0-0-0/w UBIN        r     1 PARM2                     *0-0-0/b BIT         r     1 TIMEFLAG

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:131  
     0-0-0/c ACHR        r     1 B$CHARS                    0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0N  NULL        r     1 M$CL


   Procedure TCM$CL requires 71 words for executable code.
   Procedure TCM$CL requires 12 words of local(AUTO) storage.

    No errors detected in file TCM$SEND2.:TCA2TSI    .
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:132  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:133  
          MINI XREF LISTING

ADDRESS
       924**DCL       960>>ASSIGN
ARS
       930**DCL         6--PROC      934--IMP-SIZ   938--ENTRY     944<<ASSIGN    945>>IF        946>>ASSIGN
       946>>ASSIGN
B$CHARS
       934**DCL       946<<ASSIGN
BUF_
       923**DCL       946>>ASSIGN    954>>ASSIGN
CLBUF
       935**DCL       826--DCLINIT   827--DCLINIT   946>>ASSIGN
EOMCHAR
       929**DCL         6--PROC      938--ENTRY
EOMTABLE
       928**DCL         6--PROC      938--ENTRY
F$DCB.ACTPOS
       661**DCL       661--REDEF
F$DCB.ARS#
       635**DCL       635--REDEF     944>>ASSIGN
F$DCB.ATTR
       654**DCL       655--REDEF
F$DCB.BORROW
       669**DCL       669--REDEF     669--REDEF     669--REDEF
F$DCB.DCBNAME.L
       683**DCL       683--IMP-SIZ
F$DCB.EOMCHAR#
       639**DCL       639--REDEF
F$DCB.FCD#
       648**DCL       967>>IF
F$DCB.FLDID
       664**DCL       664--REDEF
F$DCB.FORM$
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:134  
       658**DCL       658--REDEF
F$DCB.FSECT
       674**DCL       674--REDEF
F$DCB.FSN#
       651**DCL       651--REDEF     651--REDEF     652--REDEF
F$DCB.HEADER$
       657**DCL       657--REDEF
F$DCB.IXTNSIZE#
       655**DCL       655--REDEF
F$DCB.LASTSTA$
       644**DCL       644--REDEF
F$DCB.LVL
       670**DCL       670--REDEF
F$DCB.NAME#.C
       645**DCL       645--REDEF
F$DCB.NOEOF
       667**DCL       667--REDEF
F$DCB.NRECS#
       656**DCL       656--REDEF
F$DCB.NRECX
       675**DCL       675--REDEF
F$DCB.OHDR
       667**DCL       667--REDEF
F$DCB.ORG#
       650**DCL       650--REDEF
F$DCB.PRECNO
       673**DCL       673--REDEF
F$DCB.RCSZ
       679**DCL       679--REDEF
F$DCB.RES#
       646**DCL       646--REDEF
F$DCB.SETX
       658**DCL       658--REDEF
F$DCB.TAB$
       658**DCL       658--REDEF
F$DCB.TDA
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:135  
       672**DCL       673--REDEF
F$DCB.WSN#
       646**DCL       646--REDEF
FPT_CLOSE
       900**DCL       968<>CALL
FPT_CLOSE.SN_
       900**DCL       900--REDEF
FPT_CLOSE.UTL_
       901**DCL       901--REDEF
FPT_CLOSE.V
       905**DCL       900--DCLINIT
FPT_CLOSE.V.EXPIRE#
       915**DCL       915--REDEF
FPT_CLOSE.V.TYPE#
       913**DCL       913--REDEF
FPT_CLOSE.V.XTNSIZE#
       910**DCL       910--REDEF     912--REDEF
FPT_OPEN
       750**DCL       962<>CALL
FPT_OPEN.ACSVEH_
       752**DCL       753--REDEF
FPT_OPEN.ALTKEYS_
       758**DCL       759--REDEF     759--REDEF
FPT_OPEN.HDR_
       757**DCL       758--REDEF
FPT_OPEN.TAB_
       756**DCL       757--REDEF
FPT_OPEN.UHL_
       750**DCL       751--REDEF     751--REDEF
FPT_OPEN.V
       759**DCL       750--DCLINIT
FPT_OPEN.V.ATTR#
       786**DCL       961<<ASSIGN
FPT_OPEN.V.FSN#
       790**DCL       790--REDEF     790--REDEF
FPT_OPEN.WSN_
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:136  
       756**DCL       756--REDEF
FPT_READ
       824**DCL       942<>CALL
FPT_READ.STATION_
       827**DCL       828--REDEF
FPT_READ.V
       828**DCL       824--DCLINIT
FPT_READ.V.DVBYTE.REREAD#
       839**DCL       839--REDEF
FPT_READ.V.INDX#
       837**DCL       837--REDEF
FPT_WRITE
       863**DCL       955<>CALL
FPT_WRITE.BUF_
       863**DCL       954<<ASSIGN
FPT_WRITE.STATION_
       865**DCL       865--REDEF
FPT_WRITE.V
       866**DCL       863--DCLINIT
FPT_WRITE.V.DVBYTE.VFC#
       872**DCL       872--REDEF
M$CL
       920**DCL       944--ASSIGN    967--IF
M$CLOSE
       556**DCL-ENT   968--CALL
M$OPEN
       556**DCL-ENT   962--CALL
M$READ
       557**DCL-ENT   942--CALL
M$WRITE
       557**DCL-ENT   955--CALL
MERR
       931**DCL         6--PROC      938--ENTRY
NEEDREAD
       936**DCL       940>>IF        941<<ASSIGN    949<<ASSIGN
PARM1
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:137  
       922**DCL         6--PROC      923--REDEF     924--REDEF     938--ENTRY     952--ENTRY     958--ENTRY
PARM2
       925**DCL         6--PROC      926--REDEF     927--REDEF     938--ENTRY     952--ENTRY
TIMEFLAG
       932**DCL         6--PROC      938--ENTRY     947--IF        948<<ASSIGN
VLP_SN
       805**DCL       750--DCLINIT
VLP_SN.SN#
       805**DCL       960<<ASSIGN
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:138  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:139  
              MINI UREF LISTING

ERR     927**DCL
M$ACCT     573**DCL-ENT
M$ACTIVATE     576**DCL-ENT
M$ALIB     569**DCL-ENT
M$ASUSER     571**DCL-ENT
M$ATTACH     578**DCL-ENT
M$BADPP     596**DCL-ENT
M$CGCTL     577**DCL-ENT
M$CGINFO     577**DCL-ENT
M$CHECK     558**DCL-ENT
M$CHGUNIT     616**DCL-ENT
M$CLRSTK     614**DCL-ENT
M$CMDVAR     625**DCL-ENT
M$CONFIG     586**DCL-ENT
M$CORRES     561**DCL-ENT
M$CPEXIT     570**DCL-ENT
M$CVM     594**DCL-ENT
M$CVOL     559**DCL-ENT
M$DCLFLD     586**DCL-ENT
M$DEACTIVATE     576**DCL-ENT
M$DELREC     558**DCL-ENT
M$DEQ     623**DCL-ENT
M$DETACH     578**DCL-ENT
M$DEVICE     560**DCL-ENT
M$DISPLAY     623**DCL-ENT
M$DISPRES     563**DCL-ENT
M$DLIB     569**DCL-ENT
M$DRIBBLE     586**DCL-ENT
M$DRTN     614**DCL-ENT
M$DSUSER     571**DCL-ENT
M$ENQ     622**DCL-ENT
M$EOM     581**DCL-ENT
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:140  
M$ERASE     587**DCL-ENT
M$ERR     568**DCL-ENT
M$ERRMSG     619**DCL-ENT
M$EVENT     611**DCL-ENT
M$EXHUME     620**DCL-ENT
M$EXIT     568**DCL-ENT
M$EXTEND     560**DCL-ENT
M$FDP     592**DCL-ENT
M$FDS     591**DCL-ENT
M$FEBOOT     584**DCL-ENT
M$FECTL     585**DCL-ENT
M$FEDUMP     584**DCL-ENT
M$FID     619**DCL-ENT
M$FINDPROC     573**DCL-ENT
M$FSUSER     571**DCL-ENT
M$FVP     593**DCL-ENT
M$FWCG     577**DCL-ENT
M$GBPL     597**DCL-ENT
M$GDDL     593**DCL-ENT
M$GDP     592**DCL-ENT
M$GDS     591**DCL-ENT
M$GETDCB     562**DCL-ENT
M$GETMOUSE     602**DCL-ENT
M$GETPM     603**DCL-ENT
M$GJOB     621**DCL-ENT
M$GLINEATTR     581**DCL-ENT
M$GOODPP     596**DCL-ENT
M$GPLATEN     589**DCL-ENT
M$GPROMPT     588**DCL-ENT
M$GTRMATTR     582**DCL-ENT
M$GTRMCTL     580**DCL-ENT
M$GTRMTAB     583**DCL-ENT
M$GVP     592**DCL-ENT
M$HELP     619**DCL-ENT
M$INT     611**DCL-ENT
M$INTRTN     572**DCL-ENT
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:141  
M$IOQ     607**DCL-ENT
M$JOBSTATS     621**DCL-ENT
M$KEYIN     561**DCL-ENT
M$LDEV     556**DCL-ENT
M$LDTRC     569**DCL-ENT
M$LIMIT     562**DCL-ENT
M$LINES     561**DCL-ENT
M$LINK     568**DCL-ENT
M$MADMUCK     564**DCL-ENT
M$MAKUSER     595**DCL-ENT
M$MBS     563**DCL-ENT
M$MDFFLD     587**DCL-ENT
M$MERC     612**DCL-ENT
M$MERCS     613**DCL-ENT
M$MIRROR     607**DCL-ENT
M$MONINFO     624**DCL-ENT
M$MPL     597**DCL-ENT
M$NODEINFO     588**DCL-ENT
M$NXTUSR     622**DCL-ENT
M$OCMSG     620**DCL-ENT
M$OLAY     568**DCL-ENT
M$PAS     597**DCL-ENT
M$PATHCON     620**DCL-ENT
M$PDS     591**DCL-ENT
M$PFIL     558**DCL-ENT
M$PLATEN     582**DCL-ENT
M$PRECORD     560**DCL-ENT
M$PROCNAME     573**DCL-ENT
M$PROFILE     584**DCL-ENT
M$PROMPT     580**DCL-ENT
M$RACST     564**DCL-ENT
M$RDSYSLOG     605**DCL-ENT
M$RELDCB     562**DCL-ENT
M$RELRES     563**DCL-ENT
M$RELSTARF     565**DCL-ENT
M$REM     565**DCL-ENT
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:142  
M$RENV     612**DCL-ENT
M$REQUIRE     564**DCL-ENT
M$RETRY     613**DCL-ENT
M$RETRYS     613**DCL-ENT
M$REW     559**DCL-ENT
M$RLSFLD     587**DCL-ENT
M$RPRIV     615**DCL-ENT
M$RSPP     594**DCL-ENT
M$RSWITCH     616**DCL-ENT
M$RUE     622**DCL-ENT
M$SAD     595**DCL-ENT
M$SAVE     571**DCL-ENT
M$SCON     572**DCL-ENT
M$SCREECH     570**DCL-ENT
M$SENV     612**DCL-ENT
M$SETFMA     556**DCL-ENT
M$SETFP     585**DCL-ENT
M$SINPUT     583**DCL-ENT
M$SLCFLD     588**DCL-ENT
M$SMOUSE     602**DCL-ENT
M$SMPRT     594**DCL-ENT
M$SPRIV     615**DCL-ENT
M$SSC     595**DCL-ENT
M$SSWITCH     615**DCL-ENT
M$STATE     624**DCL-ENT
M$STD     596**DCL-ENT
M$STIMER     610**DCL-ENT
M$STLPP     593**DCL-ENT
M$STRAP     610**DCL-ENT
M$STRMATTR     582**DCL-ENT
M$STRMCTL     580**DCL-ENT
M$STRMTAB     583**DCL-ENT
M$SYMBIO     621**DCL-ENT
M$SYSCON     607**DCL-ENT
M$SYSID     625**DCL-ENT
M$TDCLOSE     606**DCL-ENT
PL6.E3A0      #004=TCM$CL File=TCM$SEND2.:TCA2TSI                                SUN 11/16/97 14:20 Page:143  
M$TDIO     606**DCL-ENT
M$TDOPEN     605**DCL-ENT
M$TDREQCPU     606**DCL-ENT
M$TEMPWROC     600**DCL-ENT
M$TIME     623**DCL-ENT
M$TRAP     610**DCL-ENT
M$TRMISC     585**DCL-ENT
M$TRMPRG     581**DCL-ENT
M$TRTN     614**DCL-ENT
M$TRUNC     557**DCL-ENT
M$TTIMER     610**DCL-ENT
M$UC     580**DCL
M$UMPL     597**DCL-ENT
M$UNFID     619**DCL-ENT
M$UNLATCH     576**DCL-ENT
M$UNSHARE     573**DCL-ENT
M$USRFIELD     616**DCL-ENT
M$VIRTUAL     591**DCL-ENT
M$WAIT     614**DCL-ENT
M$WEOF     559**DCL-ENT
M$WRSYSLOG     605**DCL-ENT
M$XCON     611**DCL-ENT
M$XCONRTN     572**DCL-ENT
M$XEQTIME     624**DCL-ENT
M$XFLUSH     565**DCL-ENT
M$XMOUSE     602**DCL-ENT
M$XXX     568**DCL-ENT
M$YC     570**DCL-ENT
TCM$CL       6**PROC
TCM$CL_CONNECT     958**ENTRY
TCM$CL_DISCONNECT     965**ENTRY
TCM$CL_READ     938**ENTRY
TCM$CL_WRITE     952**ENTRY
TIME     926**DCL
