VERSION E05

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:1    
        1        1        /*M* FLX$ARCOM - archive compactor */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* THI=1,PLM=3 */
        8        8
        9        9        FLX$ARCOM: PROC MAIN;
       10       10
       11       11         /***
       12       12          *** INCLUDE
       13       13          ***/
       14       14
       15       15        %INCLUDE CP_6;
       16     5574        %INCLUDE B$JIT;
       17     6177        %INCLUDE B_ERRORS_C;
       18     7304        %INCLUDE FM$FIT;
       19     7525        %INCLUDE FM$GRAN;
       20     7594        %INCLUDE CP_6_SUBS;
       21     8134        %INCLUDE FLE_DATA_R;
       22    14085        %INCLUDE FLI_DATA_R;
       23    15499        %INCLUDE FLN_DATA_R;
       24    16236        %INCLUDE FLS_DATA_R;
       25    18036        %INCLUDE FLW_DATA_R;
       26    18050        %INCLUDE XU_MACRO_C;
       27    21156        %INCLUDE XUR_ENTRY;
       28    21188
       29    21189         /***
       30    21190          *** ENTRY
       31    21191          ***/
       32    21192
       33    21193    1   DCL FLH$RPT_ERR ENTRY(3);
       34    21194    1   DCL FLI$NODE_TAPE_OD ENTRY(1) ALTRET;
       35    21195    1   DCL FLH$HELP ENTRY(2);
       36    21196    1   DCL FLI$INIT ENTRY(1);
       37    21197    1   DCL FLI$ALLOC ENTRY(2);
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:2    
       38    21198    1   DCL FLI$ALLOC_BUF ENTRY(2);
       39    21199    1   DCL XSF$LOCCODP ENTRY(2) ALTRET;
       40    21200    1   DCL FLI$RPT_ERR ENTRY(5);
       41    21201    1   DCL FLI$TAPE_IO_INIT ENTRY;
       42    21202    1   DCL FLI$TAPE_OPEN ENTRY(9) ALTRET;
       43    21203    1   DCL FLI$TAPE_CLOSE ENTRY(1) ALTRET;
       44    21204    1   DCL FLI$TAPE_WRITE ENTRY(6) ALTRET;
       45    21205    1   DCL FLX$ARCOM_BRK ENTRY ASYNC;
       46    21206    1   DCL FLP$WR_FILE_INFO ENTRY(9) ALTRET;
       47    21207    1   DCL FLI$CNVRT_ARCHIVE ENTRY(2);
       48    21208
       49    21209         /***
       50    21210          *** DCB
       51    21211          ***/
       52    21212
       53    21213    1   DCL M$SI DCB;
       54    21214    1   DCL M$LO DCB;
       55    21215    1   DCL M$DO DCB;
       56    21216    1   DCL M$TAPE_SOURCE DCB;
       57    21217    1   DCL M$TAPE00 DCB;
       58    21218    1   DCL M$ARC_FILE DCB;
       59    21219    1   DCL M$ARC_LIST DCB;
       60    21220    1   DCL M$ARC_LIST2 DCB;     /* Used to read *ARC_LIST file for updating fits     */
       61    21221    1   DCL M$FSN_LIST DCB; /* Used for maintaining list of files within each FSN     */
       62    21222    1   DCL M$EFT_ERRORS DCB;         /* Used to create *LIST_ERRORS which is unused  */
       63    21223
       64    21224         /***
       65    21225          *** SYMREF
       66    21226          ***/
       67    21227
       68    21228    1   DCL ARCOM_CMD UBIN WORD SYMREF;
       69    21229    1   DCL B_VERSION CHAR(1) SYMREF;
       70    21230    1   DCL 1 B$VERSION BASED,
       71    21231    1         2 L# UBIN BYTE CALIGNED,
       72    21232    1         2 NAME# CHAR(B$VERSION.L#) CALIGNED;
       73    21233
       74    21234         /***
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:3    
       75    21235          *** SYMDEF
       76    21236          ***/
       77    21237
       78    21238    1   DCL BREAK_COUNT SBIN STATIC SYMDEF;
       79    21239    1   DCL BREAK_DCB$ PTR STATIC SYMDEF;
       80    21240    1   DCL BREAK_TASK CHAR(18) STATIC SYMDEF;
       81    21241    1   DCL BREAK_DCB# SBIN STATIC SYMDEF;
       82    21242    1   DCL BREAK_CONTINUED BIT(1) STATIC SYMDEF;
       83    21243
       84    21244         /***
       85    21245          *** STATIC
       86    21246          ***/
       87    21247
       88    21248    1   DCL ARC_SET$ PTR STATIC;
       89    21249    1   DCL ARC_REC_SIZE SBIN STATIC;
       90    21250    1   DCL ARC_REC$ PTR STATIC;
       91    21251    1   DCL CODE SBIN STATIC;
       92    21252    1   DCL NODE$ PTR STATIC;
       93    21253        %VLP_ERRCODE( FPTN=ERR,
       94    21254                      STCLASS="REDEF NODE$" );
       95    21299    1   DCL SUBNODE$ PTR STATIC;
       96    21300    1   DCL SUBNODEX SBIN STATIC;
       97    21301    1   DCL SELECTED BIT(1) STATIC;
       98    21302    1   DCL TEMP SBIN STATIC;
       99    21303    1   DCL TEMP$ PTR STATIC;
      100    21304    1   DCL TAPE_SET$ PTR STATIC;
      101    21305    1   DCL OUT_BLK_SIZE SBIN STATIC;
      102    21306    1   DCL NBR_DPS SBIN STATIC;
      103    21307    1   DCL NBRFAS_FOUND_UPDATED SBIN STATIC;
      104    21308    1   DCL NBRFAS_FOUND_UNUPDATED SBIN STATIC;
      105    21309    1   DCL NBRFAS SBIN STATIC;                 /* Total number of archived files     */
      106    21310    1   DCL I SBIN STATIC;
      107    21311    1   DCL 1 GREETINGS STATIC,
      108    21312    1         2 * CHAR(0) INIT('ARCOM '),
      109    21313    1         2 VERSION CHAR(6),
      110    21314    1         2 * CHAR(0) INIT(' '),
      111    21315    1         2 HERE CHAR(4) INIT('here');
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:4    
      112    21316    1   DCL 1 INBUF_ STATIC DALIGNED,
      113    21317    1         2 * BIT(36),
      114    21318    1         2 PTR$ PTR;
      115    21319    1   DCL 1 FPARAM_ STATIC DALIGNED,
      116    21320    1         2 * BIT(36),
      117    21321    1         2 PTR$ PTR;
      118    21322    1   DCL CODE06$ PTR STATIC;
      119    21323    1   DCL ERROR_FLAG BIT(1) STATIC;
      120    21324        %MACRO ARC_LIST_KEY;
      121    21325              2 L UBIN BYTE CALIGNED,
      122    21326              2 C,
      123    21327                3 PSN CHAR(6),
      124    21328                3 ACCT CHAR(8),
      125    21329                3 FNAMEC CHAR(31),
      126    21330                3 FNAMEL UBIN BYTE CALIGNED;
      127    21331        %MEND;
      128    21332    1   DCL 1 ARC_LIST_KEY ALIGNED STATIC,
      129    21333              %ARC_LIST_KEY;
      130    21341    1   DCL 1 THIS_BLK_ARC_LIST_KEY(0:61) ALIGNED STATIC,
      131    21342              %ARC_LIST_KEY;
      132    21350    1   DCL 1 PREV_BLK_ARC_LIST_KEY(0:61) ALIGNED STATIC,
      133    21351              %ARC_LIST_KEY;
      134    21359        %MACRO ARC_LIST_REC;
      135    21360              2 REEL CHAR(6),
      136    21361              2 FSN UBIN HALF CALIGNED,
      137    21362              2 NEW,
      138    21363                3 REEL CHAR(6),
      139    21364                3 FSN UBIN HALF CALIGNED,
      140    21365              2 NBR_ON_TAPE SBIN,
      141    21366              2 ACTIVE CHAR(1);
      142    21367        %MEND;
      143    21368    1   DCL 1 ARC_LIST_REC ALIGNED STATIC,
      144    21369              %ARC_LIST_REC;
      145    21378    1   DCL 1 THIS_BLK_ARC_LIST_REC(0:61) ALIGNED STATIC,
      146    21379              %ARC_LIST_REC;
      147    21388    1   DCL 1 PREV_BLK_ARC_LIST_REC(0:61) ALIGNED STATIC,
      148    21389              %ARC_LIST_REC;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:5    
      149    21398    1   DCL M$ARC_FILE$ PTR STATIC;
      150    21399    1   DCL M$TAPE_SOURCE$ PTR STATIC;
      151    21400    1   DCL M$ARC_LIST$ PTR STATIC;
      152    21401    1   DCL M$ARC_LIST2$ PTR STATIC;
      153    21402    1   DCL M$FSN_LIST$ PTR STATIC;
      154    21403    1   DCL M$EFT_ERRORS$ PTR STATIC;
      155    21404
      156    21405    1   DCL IN_BLK_TAG$ PTR STATIC;
      157    21406    1   DCL OUT_BLK_TAG$ PTR STATIC;
      158    21407    1   DCL IN_BLK_TAG0$ PTR STATIC;
      159    21408    1   DCL OUT_BLK_TAG0$ PTR STATIC;
      160    21409    1   DCL IN_BLK_TAG_IX SBIN STATIC;
      161    21410    1   DCL OUT_BLK_TAG_IX SBIN STATIC;
      162    21411    1   DCL OUT_GRANX SBIN STATIC;
      163    21412    1   DCL IN_BLK_TAG_IX_MAX SBIN STATIC;
      164    21413    1   DCL IN_GRAN$ PTR STATIC;
      165    21414    1   DCL OUT_GRAN$ PTR STATIC;
      166    21415    1   DCL IN_GRAN_MAX$ PTR STATIC;
      167    21416    1   DCL IN_GRAN_MAX_CHK$ PTR STATIC;
      168    21417    1   DCL OUT_GRAN_MAX$ PTR STATIC;
      169    21418    1   DCL IN_GRAN_BASE$ PTR STATIC;
      170    21419    1   DCL OUT_GRAN_BASE$ PTR STATIC;
      171    21420    1   DCL PREV_REEL CHAR(6) STATIC;
      172    21421    1   DCL STEPCC UBIN STATIC INIT(0);
      173    21422    1   DCL OMIT_SN_LIST$ PTR STATIC;
      174    21423    1   DCL FROM_SN_LIST$ PTR STATIC;
      175    21424    1   DCL OPTION_CHECK BIT(1) AUTO;
      176    21425    1   DCL OPTION_IOERRORC BIT(1) AUTO;
      177    21426    1   DCL OD_SOURCE BIT(1) AUTO;              /* Optical disk source                */
      178    21427    1   DCL OD_DEST BIT(1) AUTO;                /* Optical disk destination           */
      179    21428    1   DCL CONTROLLED_SOURCE BIT(1) AUTO; /* Controlled source specified (CT or CD)  */
      180    21429
      181    21430        /***
      182    21431         *** CONSTANT
      183    21432         ***/
      184    21433
      185    21434    1   DCL 1 FLERRMSGSYS CONSTANT,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:6    
      186    21435    1         2 * UBIN BYTE CALIGNED INIT(LENGTHC(':FLERRMSG.:SYS   ')),
      187    21436    1         2 * CHAR(0) CALIGNED INIT(':FLERRMSG.:SYS   ');
      188    21437
      189    21438         /***
      190    21439          *** BASED
      191    21440          ***/
      192    21441
      193    21442        %PARSE$OUT( STCLASS=BASED );
      194    21487        %PARSE$SYM( STCLASS=BASED );
      195    21525        %VLP_SN( STCLASS=BASED );
      196    21538        %SNLISTINFO( STCLASS="BASED(LAST_SNLISTINFO$)" );
      197    21541        %F$DCB;
      198    21598        %B$TCB( STCLASS="BASED(B$TCB$)" );
      199    21601        %B$ALT;
      200    21609        %FM$GRAN;
      201    21613        %CODE06( BASED="BASED(CODE06$)" );
      202    21617
      203    21618    1   DCL 1 IN_BLK_TAG BASED(IN_BLK_TAG$),
      204    21619              %BLOCK_TAG;
      205    21624    1   DCL 1 OUT_BLK_TAG BASED(OUT_BLK_TAG$),
      206    21625              %BLOCK_TAG;
      207    21630    1   DCL 1 IN_BLK_TAG0 BASED(IN_BLK_TAG0$),
      208    21631              %BLOCK_TAG;
      209    21636    1   DCL 1 OUT_BLK_TAG0 BASED(OUT_BLK_TAG0$),
      210    21637              %BLOCK_TAG;
      211    21642    1   DCL IN_GRAN CHAR(4096) BASED(IN_GRAN$) ALIGNED;
      212    21643    1   DCL OUT_GRAN CHAR(4096) BASED(OUT_GRAN$) ALIGNED;
      213    21644
      214    21645         /***
      215    21646          *** FPT
      216    21647          ***/
      217    21648
      218    21649        %FPT_INT( FPTN=FPT_INT,
      219    21650                  UENTRY=FLX$ARCOM_BRK,
      220    21651                  STCLASS=CONSTANT );
      221    21665
      222    21666        %FPT_OPEN( FPTN=OPEN_TAPE_SOURCE,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:7    
      223    21667                   BLKL=253952,            /* 62K * 4096; EFT's maximum buffer size   */
      224    21668                   DCB=M$TAPE_SOURCE,
      225    21669                   ASN=TAPE,
      226    21670                   FUN=IN,
      227    21671                   ACS=BLOCK,
      228    21672                   STCLASS=STATIC );
      229    21781
      230    21782        %FPT_READ( FPTN=READ_TAPE_SOURCE,
      231    21783                   DCB=M$TAPE_SOURCE,
      232    21784                   WAIT=YES,
      233    21785                   STCLASS=STATIC );
      234    21824
      235    21825        %FPT_CLOSE( FPTN=CLOSE_TAPE_SOURCE,
      236    21826                    DCB=M$TAPE_SOURCE,
      237    21827                    DISP=SAVE );
      238    21869
      239    21870        %P_PCB( NAME=ARCOM_CMD_PCB,
      240    21871                STCLASS=STATIC );
      241    22070
      242    22071        %XUR_INIT( NAME=XUR_INIT,
      243    22072                   SYNTAX=YES,
      244    22073                   PCB=ARCOM_CMD_PCB );
      245    22172
      246    22173        %VLP_NAME( FPTN=ARC_LIST_NAME,
      247    22174                   NAME='*ARC_LIST',
      248    22175                   STCLASS=CONSTANT );
      249    22202
      250    22203        %FPT_CLOSE( FPTN=CLOSE_ARC_LIST,
      251    22204                    DCB=M$ARC_LIST,
      252    22205                    DISP=SAVE,
      253    22206                    STCLASS=CONSTANT );
      254    22248
      255    22249        %FPT_OPEN( FPTN=OPEN_ARC_LIST,
      256    22250                   DCB=M$ARC_LIST,
      257    22251                   FUN=UPDATE,
      258    22252                   SHARE=IN,
      259    22253                   NAME=ARC_LIST_NAME,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:8    
      260    22254                   ASN=FILE,
      261    22255                   ACS=DIRECT,
      262    22256                   STCLASS=CONSTANT );
      263    22365
      264    22366        %FPT_READ( FPTN=READ_ARC_LIST_BY_KEY,
      265    22367                   DCB=M$ARC_LIST,
      266    22368                   KEY=ARC_LIST_KEY,
      267    22369                   KEYS=YES,
      268    22370                   BUF=ARC_LIST_REC,
      269    22371                   WAIT=YES,
      270    22372                   STCLASS=CONSTANT );
      271    22411
      272    22412        %FPT_WRITE( FPTN=WRITE_ARC_LIST_BY_KEY,
      273    22413                    DCB=M$ARC_LIST,
      274    22414                    ONEWKEY=NO,
      275    22415                    NEWKEY=NO,
      276    22416                    WAIT=YES,
      277    22417                    STCLASS=STATIC );
      278    22448
      279    22449        %FPT_WRITE( FPTN=WRITE_ARC_LIST_BY_KEY_NEW,
      280    22450                    DCB=M$ARC_LIST,
      281    22451                    KEY=ARC_LIST_KEY,
      282    22452                    BUF=ARC_LIST_REC,
      283    22453                    WAIT=YES,
      284    22454                    STCLASS=CONSTANT );
      285    22485
      286    22486        %FPT_READ( FPTN=READ_ARC_LIST,
      287    22487                   DCB=M$ARC_LIST,
      288    22488                   KEY=ARC_LIST_KEY,
      289    22489                   KEYR=YES,
      290    22490                   BUF=ARC_LIST_REC,
      291    22491                   WAIT=YES,
      292    22492                   STCLASS=CONSTANT );
      293    22531
      294    22532        %FPT_OPEN( FPTN=OPEN_ARC_FILE,
      295    22533                   DCB=M$ARC_FILE,
      296    22534                   FUN=IN,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:9    
      297    22535                   NAME=ARC_FILE_NAME,
      298    22536                   ACCT=ARC_FILE_ACCT,
      299    22537                   SN=ARC_FILE_SN,
      300    22538                   ASN=FILE,
      301    22539                   ACS=BLOCK,
      302    22540                   STCLASS=STATIC );
      303    22649
      304    22650        %VLP_NAME( FPTN=ARC_FILE_NAME,
      305    22651                   LEN=31,
      306    22652                   STCLASS=STATIC );
      307    22679
      308    22680        %VLP_ACCT( FPTN=ARC_FILE_ACCT,
      309    22681                   STCLASS=STATIC );
      310    22694
      311    22695        %VLP_SN( FPTN=ARC_FILE_SN,
      312    22696                 N=1,
      313    22697                 STCLASS=STATIC );
      314    22710
      315    22711        %FPT_CLOSE( FPTN=CLOSE_ARC_FILE,
      316    22712                    DCB=M$ARC_FILE,
      317    22713                    DISP=SAVE,
      318    22714                    /*N* Probably FITMOD */
      319    22715                    STCLASS=STATIC );
      320    22757
      321    22758        %FPT_DEVICE( FPTN=PAGE_LO,
      322    22759                     DCB=M$LO,
      323    22760                     PAGE=YES,
      324    22761                     HDR=PAGE_LO_HEADER );
      325    22779
      326    22780        %VLP_HDR( FPTN=PAGE_LO_HEADER,
      327    22781                  RESETPAGE=NO,
      328    22782                  COUNT=76,
      329    22783                  HEADERHEIGHT=1,
      330    22784                  TITLE=' ' );
      331    22800
      332    22801        %FPT_OPEN( FPTN=OPEN_LO_DO,
      333    22802                   DCB=M$LO,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:10   
      334    22803                   ORG=UR,
      335    22804                   CTG=YES,
      336    22805                   FUN=CREATE );
      337    22914
      338    22915        %VLP_SN( FPTN=OMIT_SN_LIST,
      339    22916                 STCLASS="BASED(OMIT_SN_LIST$)" );
      340    22929
      341    22930        %VLP_SN( FPTN=FROM_SN_LIST,
      342    22931                 STCLASS="BASED(FROM_SN_LIST$)" );
      343    22944
      344    22945        %VLP_SN( FPTN=ZERO_SN_LIST,
      345    22946                 N=1,
      346    22947                 STCLASS=STATIC );
      347    22960
      348    22961        %FPT_MADMUCK( FPTN=GET_PSN,
      349    22962                      ACCT=OUR_ACCT,
      350    22963                      SN=ZERO_SN_LIST,
      351    22964                      READ=YES );
      352    22980
      353    22981        %VLP_ACCT( FPTN=OUR_ACCT,
      354    22982                   STCLASS=STATIC );
      355    22995
      356    22996        %FPT_REM( FPTN=REM_LT,
      357    22997                  DISP=REM );
      358    23011
      359    23012        %FPT_OPEN( FPTN=OPEN_ARCHIVE_EFT,
      360    23013                   DCB=M$ARC_FILE,
      361    23014                   ASN=FILE,
      362    23015                   FUN=IN,
      363    23016                   SN=DPSN,
      364    23017                   NAME=ARCHIVE_$$EFT_NAME,
      365    23018                   ACCT=EFT_ACCT,
      366    23019                   ACS=SEQUEN,
      367    23020                   ORG=CONSEC,
      368    23021                   STCLASS=STATIC );
      369    23130
      370    23131        %FPT_READ( FPTN=READ_ARCHIVE_EFT,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:11   
      371    23132                   DCB=M$ARC_FILE,
      372    23133                   STCLASS=STATIC );
      373    23172
      374    23173        %FPT_WRITE( FPTN=WRITE_ARCHIVE_EFT,
      375    23174                    DCB=M$ARC_FILE,
      376    23175                    STCLASS=STATIC );
      377    23206
      378    23207        %FPT_CLOSE( FPTN=CLOSE_ARCHIVE_EFT,
      379    23208                    DCB=M$ARC_FILE,
      380    23209                    DISP=SAVE,
      381    23210                    STCLASS=CONSTANT );
      382    23252
      383    23253        %VLP_NAME( FPTN=ARCHIVE_$$EFT_NAME,
      384    23254                   NAME=':ARCHIVE',
      385    23255                   STCLASS=CONSTANT );
      386    23282
      387    23283        %VLP_ACCT( FPTN=EFT_ACCT,
      388    23284                   ACCT='$$EFT',
      389    23285                   STCLASS=CONSTANT );
      390    23298
      391    23299        %VLP_SN( FPTN=DPSN,
      392    23300                 N=1,
      393    23301                 STCLASS=STATIC );
      394    23314
      395    23315        %FPT_OPEN( FPTN=OPEN_FSN_LIST,
      396    23316                   DCB=M$FSN_LIST,
      397    23317                   ASN=FILE,
      398    23318                   FUN=CREATE,
      399    23319                   EXIST=NEWFILE,
      400    23320                   CTG=YES,
      401    23321                   NAME=FSN_LIST_NAME,
      402    23322                   ACS=SEQUEN,
      403    23323                   ORG=CONSEC,
      404    23324                   STCLASS=STATIC );
      405    23433
      406    23434        %FPT_READ( FPTN=READ_FSN_LIST,
      407    23435                   DCB=M$FSN_LIST,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:12   
      408    23436                   STCLASS=STATIC );
      409    23475
      410    23476        %FPT_WRITE( FPTN=WRITE_FSN_LIST,
      411    23477                    DCB=M$FSN_LIST,
      412    23478                    STCLASS=STATIC );
      413    23509
      414    23510        %FPT_CLOSE( FPTN=CLOSE_FSN_LIST,
      415    23511                    DCB=M$FSN_LIST,
      416    23512                    DISP=SAVE,
      417    23513                    STCLASS=STATIC );
      418    23555
      419    23556        %FPT_PFIL( FPTN = PFIL_FSN_LIST,
      420    23557                   DCB=M$FSN_LIST,
      421    23558                   BOF = YES,
      422    23559                   STCLASS=STATIC );
      423    23574
      424    23575        %FPT_DELREC( FPTN=DELREC_FSN_LIST,
      425    23576                     DCB=M$FSN_LIST,
      426    23577                     STCLASS=STATIC );
      427    23596
      428    23597        %FPT_PRECORD( FPTN=PRECORD_FSN_LIST,
      429    23598                    DCB=M$FSN_LIST,
      430    23599                    N=-1,
      431    23600                    STCLASS=STATIC);
      432    23621
      433    23622        %VLP_NAME( FPTN=FSN_LIST_NAME,
      434    23623                   NAME='*FSN_LIST',
      435    23624                   STCLASS=CONSTANT );
      436    23651
      437    23652        %FPT_PRIV( FPTN=SWITCH_FMSEC,
      438    23653                   PRIV=%PR_FMSEC# );
      439    23668
      440    23669        %FPT_WRITE( FPTN=GREET_USER,
      441    23670                    DCB=M$LO,
      442    23671                    BUF=GREETINGS );
      443    23702
      444    23703        %FPT_CLOSE( FPTN=CLOSE_EFT_ERRORS,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:13   
      445    23704                    DCB=M$EFT_ERRORS,
      446    23705                    DISP=RELEASE,
      447    23706                    STCLASS=STATIC);
      448    23748
      449    23749
      450    23750        /****************************************/
      451    23751
      452    23752
      453    23753    1      BREAK_DCB$ = ADDR(NIL);
      454    23754    1      M$EFT_ERRORS$ = DCBADDR(DCBNUM(M$EFT_ERRORS));
      455    23755    1      BREAK_COUNT = 0;
      456    23756    1      BREAK_CONTINUED = '1'B;
      457    23757    1      BREAK_TASK = 'Initialization';
      458    23758    1      CALL XUR$INIT( XUR_INIT );
      459    23759    1      CALL XUR$SETERRMSG( FLERRMSGSYS )
      460    23760    2       WHENALTRETURN DO;
      461    23761    2         CALL M$XXX;
      462    23762    2         END;
      463    23763    1      CALL M$INT( FPT_INT );
      464    23764
      465    23765        /***
      466    23766         *** Verify that user has proper privilege to run ARCOM. Either FMSEC or
      467    23767         *** EFT processor privilege is required.
      468    23768         ***/
      469    23769    1      IF B$JIT.PRIV.JOB & %PR_FMSEC#
      470    23770    1       THEN FMSEC = '1'B;
      471    23771    2       ELSE DO;
      472    23772    2         FMSEC = '0'B;
      473    23773    2         CALL M$RPRIV( SWITCH_FMSEC ) ALTRET(ERROR_OUT);
      474    23774    2         END;
      475    23775    1      IF NOT FMSEC AND NOT (B$JIT.PPRIV & %PPR_EFT#)
      476    23776    2       THEN DO;
      477    23777    2         CALL FLI$RPT_ERR(E_CANT_RUN_ARCOM);
      478    23778
      479    23779    2         IF M$EFT_ERRORS$->F$DCB.FCD#      /* Delete *EFT_ERRORS file            */
      480    23780    3          THEN DO;
      481    23781    3            CALL M$CLOSE( CLOSE_EFT_ERRORS )
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:14   
      482    23782    4             WHENALTRETURN DO;
      483    23783    4               END;
      484    23784    3            END;
      485    23785    2         CALL M$XXX;
      486    23786    2         END;
      487    23787
      488    23788    1      CALL M$OPEN( OPEN_LO_DO ) ALTRET( ERROR_OUT );
      489    23789    1      CALL M$DEVICE( PAGE_LO ) ALTRET( ERROR_OUT );
      490    23790    1      IF NOT DCBADDR(DCBNUM(M$DO))->F$DCB.FCD#
      491    23791    2       THEN DO;             /* When debugging, DELTA might already have it open  */
      492    23792    2         OPEN_LO_DO.V.DCB# = DCBNUM(M$DO);
      493    23793    2         CALL M$OPEN( OPEN_LO_DO ) ALTRET( ERROR_OUT );
      494    23794    2         END;
      495    23795
      496    23796    1      GREETINGS.VERSION = ADDR(B_VERSION)->B$VERSION.NAME#;
      497    23797    1      CALL M$WRITE( GREET_USER );
      498    23798
      499    23799
      500    23800    1      M$ARC_FILE$ = DCBADDR(DCBNUM(M$ARC_FILE));
      501    23801    1      M$TAPE_SOURCE$ = DCBADDR(DCBNUM(M$TAPE_SOURCE));
      502    23802    1      M$ARC_LIST$ = DCBADDR(DCBNUM(M$ARC_LIST));
      503    23803    1      M$ARC_LIST2$ = DCBADDR(DCBNUM(M$ARC_LIST2));
      504    23804    1      M$FSN_LIST$ = DCBADDR(DCBNUM(M$FSN_LIST));
      505    23805    1      M$TAPE00$ = DCBADDR(DCBNUM(M$TAPE00));
      506    23806
      507    23807    1      CATALOG_ON = '0'B;
      508    23808    1      CATALOG_ONTO = '0'B;
      509    23809
      510    23810         /***
      511    23811          *** Main command parsing loop.
      512    23812          ***/
      513    23813
      514    23814    2      DO WHILE('1'B);
      515    23815
      516    23816        /***
      517    23817         *** If a user does not have FMSEC privilege, then restrict the setting of FMSEC
      518    23818         *** to a set of EFT commands, when the user only has EFT processor priv.
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:15   
      519    23819         ***/
      520    23820    2         IF NOT FMSEC
      521    23821    2          THEN CALL M$RPRIV( SWITCH_FMSEC )
      522    23822    3             WHENALTRETURN DO;
      523    23823    3               END;
      524    23824
      525    23825    2         BREAK_COUNT = 0;
      526    23826    2         BREAK_DCB$ = ADDR(NIL);
      527    23827    2         BREAK_TASK = 'Getting command';
      528    23828
      529    23829    2         CALL FLI$INIT;
      530    23830    2         CALL XUR$GETCMD( ARCOM_CMD, NODE$ ) ALTRET( TELL_ERROR );
      531    23831    2         CALL XUR$ECHOIF( DCBNUM(M$LO) );
      532    23832
      533    23833    2         ARCOM_OPTIONS = '0'B;
      534    23834
      535    23835    3         DO CASE( NODE$->OUT$BLK.CODE );
      536    23836
      537    23837    3          CASE( %END );
      538    23838    3            CALL M$EXIT;
      539    23839
      540    23840    3          CASE( %COMPACT );
      541    23841    3            IF B$JIT.PPRIV & %PPR_EFT#
      542    23842    3             THEN CALL M$SPRIV( SWITCH_FMSEC );
      543    23843    3            BREAK_TASK = 'Compacting';
      544    23844    3            CALL FLX_COMPACT;
      545    23845
      546    23846    3          END;
      547    23847    3         DO WHILE('0'B);
      548    23848    3   TELL_ERROR: ;
      549    23849    3            CALL XUR$ECHOIF( DCBNUM(M$LO) );
      550    23850    3            IF NOT ERR.MON
      551    23851    4             THEN DO;
      552    23852    4               IF ARCOM_CMD_PCB.HI_CHAR > 0
      553    23853    4                THEN CALL XUR$ERRPTR( ,DCBNUM(M$DO) );
      554    23854    4               END;
      555    23855    3            CALL XUR$ERRMSG( ERR );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:16   
      556    23856    3            END;
      557    23857    2         END;
      558    23858
      559    23859    1   ERROR_OUT: ;
      560    23860    1      CALL FLI$RPT_ERR;
      561    23861    1      CALL FLI$RPT_ERR( E_TRY_AGAIN );
      562    23862    1      CALL M$XXX;
      563    23863
      564    23864        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:17   
      565    23865    1   FLX_COMPACT: PROC ALTRET;
      566    23866        /*F*  NAME: FLX_COMPACT
      567    23867              PURPOSE: Perform compaction.
      568    23868        */
      569    23869
      570    23870        /****************************************/
      571    23871
      572    23872    2      BREAK_TASK = 'Interpreting';
      573    23873    2      CALL FLX_INTERPRET_NODES ALTRET( JUSTALT );
      574    23874
      575    23875         /***
      576    23876          *** Allocate buffer space now to make sure that it's available
      577    23877          *** when we need it, and that work we do now won't be wasted.
      578    23878          ***/
      579    23879
      580    23880    2      CALL FLI$ALLOC_BUF( FPARAM_, 1 );
      581    23881    2      CALL FLI$ALLOC_BUF( INBUF_, 62 /* Maximum EFT tape block */ );
      582    23882    2      CALL FLI$ALLOC_BUF( OUTBUF_, 62 );
      583    23883
      584    23884    2      BREAK_TASK = 'Searching';
      585    23885    2      BREAK_DCB$ = DCBADDR(DCBNUM(M$ARC_FILE));
      586    23886    2      CALL FLX_FIND_ARC_FILES ALTRET( JUSTALT );
      587    23887
      588    23888    2      BREAK_TASK = 'Compacting';
      589    23889    2      BREAK_DCB$ = DCBADDR(DCBNUM(M$TAPE_SOURCE));
      590    23890    2      CALL FLX_MAKE_NEW_ARCHIVE_TAPES ALTRET( JUSTALT );
      591    23891
      592    23892    2      BREAK_TASK = 'Summarizing';
      593    23893    2      BREAK_DCB$ = DCBADDR(DCBNUM(M$ARC_FILE));
      594    23894    2      CALL FLX_OUTPUT_SUMMARY ALTRET( JUSTALT );
      595    23895
      596    23896    2      IF M$EFT_ERRORS$->F$DCB.FCD#         /* Delete *EFT_ERRORS file            */
      597    23897    3       THEN DO;
      598    23898    3         CALL M$CLOSE( CLOSE_EFT_ERRORS )
      599    23899    4          WHENALTRETURN DO;
      600    23900    4            END;
      601    23901    3         END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:18   
      602    23902
      603    23903    2      RETURN;
      604    23904
      605    23905    2   JUSTALT: ;
      606    23906    2      IF M$EFT_ERRORS$->F$DCB.FCD#         /* Delete *EFT_ERRORS file            */
      607    23907    3       THEN DO;
      608    23908    3         CALL M$CLOSE( CLOSE_EFT_ERRORS )
      609    23909    4          WHENALTRETURN DO;
      610    23910    4            END;
      611    23911    3         END;
      612    23912
      613    23913    2      ALTRETURN;
      614    23914
      615    23915    2   END FLX_COMPACT;
      616    23916        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:19   
      617    23917    1   FLX_INTERPRET_NODES: PROC ALTRET;
      618    23918        /*F*  NAME: FLX_INTERPRET_NODES
      619    23919              PURPOSE: Interpret nodes.
      620    23920        */
      621    23921
      622    23922        /****************************************/
      623    23923
      624    23924
      625    23925         /***
      626    23926          *** Set up defaults.
      627    23927          ***/
      628    23928
      629    23929    2      SELECTED = '0'B;
      630    23930    2      OD_SOURCE = '0'B;
      631    23931    2      OD_DEST = '0'B;
      632    23932    2      NBR_DPS = 0;
      633    23933    2      CONTROLLED_SOURCE = '0'B;
      634    23934    2      OMIT_SN_LIST$ = ADDR(ZERO_SN_LIST);
      635    23935    2      FROM_SN_LIST$ = ADDR(ZERO_SN_LIST);
      636    23936    2      DPLIST$ = ADDR(ZERO_SN_LIST);
      637    23937
      638    23938
      639    23939         /***
      640    23940          *** Interpret nodes.
      641    23941          ***/
      642    23942
      643    23943    3      DO SUBNODEX = 0 TO NODE$->OUT$BLK.NSUBLKS - 1;
      644    23944    3         SUBNODE$ = NODE$->OUT$BLK.SUBLK$(SUBNODEX);
      645    23945
      646    23946    4         DO CASE( SUBNODE$->OUT$BLK.CODE );
      647    23947
      648    23948    4          CASE( %SELECTED );
      649    23949    4            SELECTED = '1'B;
      650    23950
      651    23951    4          CASE( %DPLIST );
      652    23952    4            NBR_DPS = SUBNODE$->OUT$BLK.NSUBLKS;
      653    23953    4            TEMP = LENGTHC(DPLIST.NUM#) + NBR_DPS * LENGTHC(DPLIST.SN#(0));
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:20   
      654    23954    4            TEMP = (TEMP + 3) / 4;         /* Number of words in DP list         */
      655    23955    4            CALL FLI$ALLOC( TEMP, DPLIST$ );
      656    23956    4            DPLIST.NUM# = NBR_DPS;
      657    23957    5            DO I=0 TO NBR_DPS-1;
      658    23958    5               DPLIST.SN#(I) = SUBNODE$->OUT$BLK.SUBLK$(I)->OUT$SYM.TEXT;
      659    23959    5               END;
      660    23960
      661    23961    4          CASE( %FROM_TAPE_SOURCE, %OMIT_TAPE_SOURCE, %FROM_OD_SOURCE,
      662    23962    4                 %OMIT_OD_SOURCE );
      663    23963    4            CALL FLI$NODE_TAPE_OD( SUBNODE$->OUT$BLK.SUBLK$(0) ) ALTRET( JUSTALT );
      664    23964                 /***
      665    23965                  *** The following code "undoes" the initial serial number
      666    23966                  *** list from the tape destination list.  Otherwise the
      667    23967                  *** source tape would be considered a destination tape.
      668    23968                  ***/
      669    23969    4            IF SUBNODE$->OUT$BLK.CODE = %FROM_TAPE_SOURCE OR SUBNODE$->OUT$BLK
      670    23970    4              .CODE = %FROM_OD_SOURCE
      671    23971    5             THEN DO;
      672    23972    5               FROM_SN_LIST$ = SNLISTINFO.SNLIST$;
      673    23973    5               OPEN_TAPE_SOURCE = TAPE_OPEN; /* Save tape open FPT               */
      674    23974    5               OPEN_TAPE_SOURCE.V_ = VECTOR(OPEN_TAPE_SOURCE.V);
      675    23975    5               OPEN_TAPE_SOURCE.V.DCB# = DCBNUM(M$TAPE_SOURCE);
      676    23976    5               TVECTOR = VECTOR(SNLISTINFO.SNLIST$->VLP_SN);
      677    23977    5               TVECTOR.W1.VSIZE# = LENGTHC(VLP_SN.NUM#)
      678    23978    5                 + SNLISTINFO.SNLIST$->VLP_SN.NUM# * LENGTHC(VLP_SN.SN#(0)) - 1;
      679    23979    5               OPEN_TAPE_SOURCE.SN_ = TVECTOR;
      680    23980
      681    23981    5               TEMP$ = SUBNODE$->OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->
      682    23982    5                 OUT$BLK.SUBLK$(0);
      683    23983    5               IF TEMP$->OUT$BLK.CODE = %CT_VOL_SET
      684    23984    5                 OR TEMP$->OUT$BLK.CODE = %CD_VOL_SET
      685    23985    5                THEN CONTROLLED_SOURCE = '1'B;
      686    23986    5               IF SUBNODE$->OUT$BLK.CODE = %FROM_OD_SOURCE
      687    23987    5                THEN OD_SOURCE = '1'B;
      688    23988    5               END;
      689    23989    4             ELSE OMIT_SN_LIST$ = SNLISTINFO.SNLIST$;
      690    23990    4            LAST_SNLISTINFO$ = ADDR(NIL);  /* Delete source tape                 */
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:21   
      691    23991    4            NBR_SNLISTS = 0;
      692    23992
      693    23993    4          CASE( %TAPE_DEST, %OD_DEST );
      694    23994    4            CALL FLI$NODE_TAPE_OD( SUBNODE$ ) ALTRET( JUSTALT );
      695    23995    4            OUT_BLK_SIZE = TAPE_OPEN.V.BLKL# / 4096;
      696    23996    4            TAPE_SET$ = ADDR(SNLISTINFO.SNLIST$->VLP_SN);
      697    23997    4            IF SUBNODE$->OUT$BLK.CODE = %OD_DEST
      698    23998    4             THEN OD_DEST = '1'B;
      699    23999
      700    24000    4          END;
      701    24001    3         END;
      702    24002
      703    24003    2      RETURN;
      704    24004
      705    24005    2   JUSTALT:
      706    24006    2      ALTRETURN;
      707    24007    2   END FLX_INTERPRET_NODES;
      708    24008        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:22   
      709    24009    1   FLX_FIND_ARC_FILES: PROC ALTRET;
      710    24010        /*F*  NAME: FLX_FIND_ARC_FILES
      711    24011              PURPOSE: Build the old archive list.
      712    24012        */
      713    24013
      714    24014         /***
      715    24015          *** STATIC
      716    24016          ***/
      717    24017
      718    24018    2   DCL 1 PSN_TITLE STATIC,
      719    24019    2         2 * CHAR(0) INIT('DP#'),
      720    24020    2         2 PSN CHAR(6),
      721    24021    2         2 * CHAR(0) INIT('!');
      722    24022    2   DCL 1 PSN_LINE STATIC,
      723    24023    2         2 * CHAR(0) INIT('   DP#'),
      724    24024    2         2 PSN CHAR(6);
      725    24025    2   DCL 1 TSN_LINE STATIC,
      726    24026    2         2 * CHAR(0) INIT('   LT#'),
      727    24027    2         2 TSN CHAR(6);
      728    24028    2   DCL 1 ODSN_LINE STATIC,
      729    24029    2         2 * CHAR(0) INIT('   OD#'),
      730    24030    2         2 TSN CHAR(6);
      731    24031    2   DCL 1 GETTING_SET STATIC,
      732    24032    2         2 * CHAR(0) INIT('...Getting archive set list from DP#'),
      733    24033    2         2 PSN CHAR(6),
      734    24034    2         2 * CHAR(0) INIT('/:ARCHIVE.$$EFT');
      735    24035    2   DCL ERROR_SET$ PTR STATIC;
      736    24036
      737    24037         /***
      738    24038          *** CONSTANT
      739    24039          ***/
      740    24040
      741    24041    2   DCL NOT_INCLUDE_NOTE CHAR(0) CONSTANT
      742    24042    2       INIT( 'Note: the following packsets will not be included on the new tapes' );
      743    24043    2   DCL NOT_INCLUDE_ERR CHAR(0) CONSTANT
      744    24044    2       INIT( '*** The following packsets would not be included on the new tapes' );
      745    24045    2   DCL PSN_TO_BE_PROCESSED CHAR(0) CONSTANT
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:23   
      746    24046    2       INIT('The following packsets will be processed:');
      747    24047    2   DCL NO_SOURCE_TAPES CHAR(0) CONSTANT
      748    24048    2      INIT('*** Either no source tapes have been specified or all have been omitted');
      749    24049    2   DCL COULDNT_OMIT CHAR(0) CONSTANT
      750    24050    2      INIT('The following reels aren''t used and can''t be omitted:');
      751    24051    2   DCL NOT_INCLUDE_NOTE_OD CHAR(0) CONSTANT
      752    24052    2       INIT(
             24052                'Note: the following packsets will not be included on the new optical disks'
             24052                );
      753    24053    2   DCL NOT_INCLUDE_ERR_OD CHAR(0) CONSTANT
      754    24054    2       INIT(
             24054                '*** The following packsets would not be included on the new optical disks'
             24054                );
      755    24055    2   DCL NO_SOURCE_ODS CHAR(0) CONSTANT
      756    24056    2      INIT(
             24056           '*** Either no source optical disks have been specified or all have been omitted'
             24056               );
      757    24057    2   DCL COULDNT_OMIT_OD CHAR(0) CONSTANT
      758    24058    2      INIT('The following optical disks aren''t used and can''t be omitted:');
      759    24059
      760    24060         /***
      761    24061          *** AUTO
      762    24062          ***/
      763    24063
      764    24064    2   DCL PACKSET_END BIT(1) AUTO;
      765    24065    2   DCL DPX SBIN AUTO;
      766    24066    2   DCL NBRFAS_PACKSET SBIN AUTO;
      767    24067    2   DCL NBRFAS_PACKSET_ACTIVE SBIN AUTO;
      768    24068    2   DCL NBRFAS_PACKSET_INACTIVE SBIN AUTO;
      769    24069    2   DCL OSX SBIN AUTO;
      770    24070    2   DCL NSX SBIN AUTO;
      771    24071    2   DCL SN CHAR(6) AUTO;
      772    24072    2   DCL FOUND BIT(1) AUTO;
      773    24073    2   DCL MAX_NBR_SNS SBIN AUTO;
      774    24074    2   DCL COLLECT_SNS BIT(1) AUTO;
      775    24075    2   DCL NO_ARCHIVE_FILE BIT(1) AUTO;
      776    24076    2   DCL TPTR$ PTR;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:24   
      777    24077    2   DCL CTN SBIN AUTO;
      778    24078
      779    24079         /***
      780    24080          *** FPT
      781    24081          ***/
      782    24082
      783    24083        %FPT_OPEN( FPTN=OPEN_NEXT_ARC_FILE,
      784    24084                   DCB=M$ARC_FILE,
      785    24085                   ASN=FILE,
      786    24086                   NXTF=YES,
      787    24087                   FUN=IN,
      788    24088                   SN=DPSN,
      789    24089                   TEST=YES,
      790    24090                   ARCHIVE=YES,
      791    24091                   STCLASS=STATIC );
      792    24200
      793    24201        %FPT_OPEN( FPTN=OPEN_ARC_LIST,
      794    24202                   DCB=M$ARC_LIST,
      795    24203                   ASN=FILE,
      796    24204                   FUN=CREATE,
      797    24205                   ORG=KEYED,
      798    24206                   NAME=ARC_LIST_NAME,
      799    24207                   ACS=DIRECT,
      800    24208                   STCLASS=STATIC );
      801    24317
      802    24318        %VLP_NAME( FPTN=INITIAL_NAME,
      803    24319                   LEN=31,
      804    24320                   STCLASS=STATIC );
      805    24347
      806    24348        %VLP_ACCT( FPTN=INITIAL_ACCT,
      807    24349                   STCLASS=STATIC );
      808    24362
      809    24363        %FPT_WRITE( FPTN=WRITE_ARC_LIST,
      810    24364                    BUF=ARC_LIST_REC,
      811    24365                    KEY=ARC_LIST_KEY,
      812    24366                    DCB=M$ARC_LIST,
      813    24367                    WAIT=YES,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:25   
      814    24368                    STCLASS=CONSTANT );
      815    24399
      816    24400        %FPT_WRITE( FPTN=WRITE_LO,
      817    24401                    DCB=M$LO,
      818    24402                    STCLASS=STATIC );
      819    24433
      820    24434         /***
      821    24435          *** BASED
      822    24436          ***/
      823    24437
      824    24438        %F$DCB( BASED="BASED(M$ARC_FILE$)" );
      825    24495        %VLP_SN( FPTN=ARC_SET,
      826    24496                 STCLASS="BASED(ARC_SET$)" );
      827    24509        %VLP_SN( FPTN=ERROR_SET,
      828    24510                 STCLASS="BASED(ERROR_SET$)" );
      829    24523    2   DCL 1 CT5 BASED( TPTR$ ) CALIGNED,
      830    24524    2         2 * CHAR(4),
      831    24525    2         2 C1 CHAR(1),
      832    24526    2         2 C2 CHAR(1);
      833    24527    2   DCL 1 CT6 BASED( TPTR$ ) CALIGNED,
      834    24528    2         2 * CHAR(4),
      835    24529    2         2 C1 CHAR(2);
      836    24530
      837    24531        /****************************************/
      838    24532
      839    24533    2      READ_ARCHIVE_EFT.BUF_ = VECTOR(ARC_REC_SIZE);
      840    24534    2      ARC_REC$ = ADDR(NIL);
      841    24535
      842    24536         /***
      843    24537          *** If no archive set (DP list) has been specified, get from the
      844    24538          *** current File Management account's packset's archive master file.
      845    24539          ***/
      846    24540
      847    24541    2      NO_ARCHIVE_FILE = '0'B;
      848    24542    2      IF DPLIST$ = ADDR(ZERO_SN_LIST)
      849    24543    3       THEN DO;
      850    24544    3         OUR_ACCT.ACCT# = B$JIT.FACCN;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:26   
      851    24545    3         CALL M$MADMUCK( GET_PSN )
      852    24546    4          WHENALTRETURN DO;
      853    24547    4            CALL FLI$RPT_ERR;
      854    24548    4            ALTRETURN;
      855    24549    4            END;
      856    24550    3         DPSN.SN#(0) = ZERO_SN_LIST.SN#(0);
      857    24551    3         GETTING_SET.PSN = DPSN.SN#(0);
      858    24552    3         WRITE_LO.BUF_ = VECTOR(GETTING_SET);
      859    24553    3         CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );
      860    24554    3         CALL M$OPEN( OPEN_ARCHIVE_EFT )
      861    24555    4          WHENRETURN DO;
      862    24556    4            CALL M$READ( READ_ARCHIVE_EFT )
      863    24557    5             WHENRETURN DO;
      864    24558    5               CALL FLI$ALLOC( ARC_REC_SIZE, ARC_REC$ );
      865    24559    5               READ_ARCHIVE_EFT.BUF_.BOUND = ARC_REC_SIZE * 4 - 1;
      866    24560    5               READ_ARCHIVE_EFT.BUF_.BUF$ = ARC_REC$;
      867    24561    5               CALL M$READ( READ_ARCHIVE_EFT )
      868    24562    6                WHENRETURN DO;
      869    24563        /***
      870    24564         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      871    24565         ***/
      872    24566    6                  IF ARC_REC$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)
      873    24567    6                   THEN
      874    24568    7                  DO;
      875    24569    7                     CALL FLI$CNVRT_ARCHIVE(ARC_REC$,TPTR$);
      876    24570    7                     ARC_REC$ = TPTR$;
      877    24571    7                     END;
      878    24572    6                  ARC_SET$ = PINCRW( ARC_REC$, ARC_REC$->ARCHIVE_LIST.OFFSET.DPLIST );
      879    24573    6                  NBR_DPS = ARC_SET.NUM#;
      880    24574    6                  TEMP = LENGTHC(DPLIST.NUM#) + NBR_DPS * LENGTHC(DPLIST.SN#(0));
      881    24575    6                  TEMP = (TEMP + 3) / 4;   /* Number of words in DP list         */
      882    24576    6                  CALL FLI$ALLOC( TEMP, DPLIST$ );
      883    24577    6                  DPLIST.NUM# = NBR_DPS;
      884    24578    7                  DO I=0 TO NBR_DPS-1;
      885    24579    7                     DPLIST.SN#(I) = ARC_SET.SN#(I);
      886    24580    7                     END;
      887    24581    6                  CALL M$CLOSE( CLOSE_ARCHIVE_EFT ) ALTRET( RPT_ERR_CLOSE );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:27   
      888    24582    6                  WRITE_LO.BUF_ = VECTOR(PSN_TO_BE_PROCESSED);
      889    24583    6                  CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );
      890    24584    6                  WRITE_LO.BUF_ = VECTOR(PSN_LINE);
      891    24585    7                  DO NSX=0 TO DPLIST.NUM#-1;
      892    24586    7                     PSN_LINE.PSN = DPLIST.SN#(NSX);
      893    24587    7                     CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );
      894    24588    7                     END;
      895    24589    6                  END;
      896    24590    6                WHENALTRETURN DO;
      897    24591    6                  IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF
      898    24592    6                   THEN CALL FLI$RPT_ERR;
      899    24593    6                  NO_ARCHIVE_FILE = '1'B;
      900    24594    6                  END;
      901    24595    5               END;
      902    24596    5             WHENALTRETURN DO;
      903    24597    5               CALL FLI$RPT_ERR;
      904    24598    5               NO_ARCHIVE_FILE = '1'B;
      905    24599    5               END;
      906    24600    4            END;
      907    24601    4          WHENALTRETURN DO;
      908    24602    4            CALL FLI$RPT_ERR;
      909    24603    4            NO_ARCHIVE_FILE = '1'B;
      910    24604    4            END;
      911    24605    3         END;
      912    24606
      913    24607         /***
      914    24608          *** Initialization for finding files.
      915    24609          ***/
      916    24610
      917    24611    2      INITIAL_ACCT.ACCT# = BINASC(0);
      918    24612    2      INITIAL_NAME.NAME# = BINASC(0);
      919    24613
      920    24614    2      ARC_LIST_KEY.L = LENGTHC(ARC_LIST_KEY.C);
      921    24615    2      ARC_LIST_REC.NEW.REEL = ' ';
      922    24616    2      ARC_LIST_REC.NEW.FSN = 0;
      923    24617    2      ARC_LIST_REC.NBR_ON_TAPE = 0;
      924    24618
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:28   
      925    24619    2      NBRFAS = 0;
      926    24620    2      NBRFAS_PACKSET = 0;
      927    24621    2      NBRFAS_PACKSET_ACTIVE = 0;
      928    24622    2      NBRFAS_PACKSET_INACTIVE = 0;
      929    24623
      930    24624    2      OPEN_NEXT_ARC_FILE.FPARAM_ = FPARAM_;
      931    24625
      932    24626         /***
      933    24627          *** Make sure that all required sets are up and ready.
      934    24628          ***/
      935    24629
      936    24630    2      ERROR_FLAG = '0'B;
      937    24631
      938    24632    2      OPEN_NEXT_ARC_FILE.NAME_ = VECTOR(INITIAL_NAME);
      939    24633    2      OPEN_NEXT_ARC_FILE.ACCT_ = VECTOR(INITIAL_ACCT);
      940    24634    2      OPEN_NEXT_ARC_FILE.V.OPER.NXTA# = %YES#;
      941    24635
      942    24636    2      TEMP = LENGTHC(ERROR_SET.NUM#) + 10 * LENGTHC(ERROR_SET.SN#(0));
      943    24637    2      TEMP = (TEMP + 3) / 4;
      944    24638    2      CALL FLI$ALLOC( TEMP, ERROR_SET$ );
      945    24639    2      MAX_NBR_SNS = 10;
      946    24640    2      ERROR_SET.NUM# = 0;
      947    24641    3      DO DPX = 0 TO DPLIST.NUM# - 1;
      948    24642    3         DPSN.SN#(0) = DPLIST.SN#(DPX);
      949    24643    3         CALL M$OPEN( OPEN_NEXT_ARC_FILE )
      950    24644    4          WHENALTRETURN DO;
      951    24645    4            CODE = B$TCB.ALT$->B$ALT.ERR.CODE;
      952    24646    4            IF CODE = %E$FDEOF OR CODE = %E$NOKEY OR CODE = %E$ADEOF
      953    24647    4             THEN ;
      954    24648    4             ELSE GOTO PACKSET_ERR;        /* Can't handle this error            */
      955    24649    4            END;
      956    24650    3         CALL M$OPEN( OPEN_ARCHIVE_EFT )
      957    24651    4          WHENRETURN DO;
      958    24652    4            IF ARC_REC$ = ADDR(NIL)
      959    24653    5             THEN DO;       /* Don't have buffer space yet for archive records   */
      960    24654    5               READ_ARCHIVE_EFT.BUF_ = VECTOR(ARC_REC_SIZE);
      961    24655    5               CALL M$READ( READ_ARCHIVE_EFT ) ALTRET( PACKSET_ERR );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:29   
      962    24656    5               READ_ARCHIVE_EFT.BUF_.BOUND = ARC_REC_SIZE * 4 - 1;
      963    24657    5               CALL FLI$ALLOC( ARC_REC_SIZE, ARC_REC$ );
      964    24658    5               READ_ARCHIVE_EFT.BUF_.BUF$ = ARC_REC$;
      965    24659    5               END;
      966    24660    5             ELSE DO;
      967    24661    5               CALL M$READ( READ_ARCHIVE_EFT ) ALTRET( PACKSET_ERR );
      968    24662    5               END;
      969    24663    4            CALL M$READ( READ_ARCHIVE_EFT )
      970    24664    5             WHENRETURN DO;
      971    24665        /***
      972    24666         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      973    24667         ***/
      974    24668    5               IF ARC_REC$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)
      975    24669    5                THEN
      976    24670    6               DO;
      977    24671    6                  CALL FLI$CNVRT_ARCHIVE(ARC_REC$,TPTR$);
      978    24672    6                  ARC_REC$ = TPTR$;
      979    24673    6                  END;
      980    24674    5               OPTION_CHECK = ARC_REC$->ARCHIVE_LIST.OPTION.CHECK;
      981    24675    5               OPTION_IOERRORC = ARC_REC$->ARCHIVE_LIST.OPTION.IOERRORC;
      982    24676    5               ARC_SET$ = PINCRW( ARC_REC$, ARC_REC$->ARCHIVE_LIST.OFFSET.DPLIST );
      983    24677                            /*** "Erase" all DP serial numbers in specified list ***/
      984    24678    6               DO NSX=0 TO DPLIST.NUM#-1;
      985    24679    7                  DO OSX=0 TO ARC_SET.NUM#-1;
      986    24680    7                     IF DPLIST.SN#(NSX) = ARC_SET.SN#(OSX)
      987    24681    7                      THEN ARC_SET.SN#(OSX) = ' '; /* Found in new DP list       */
      988    24682    7                     END;
      989    24683    6                  END;
      990    24684                            /*** Add all unfound serial numbers to error DP list ***/
      991    24685    6               DO OSX=0 TO ARC_SET.NUM#-1;
      992    24686    6                  IF ARC_SET.SN#(OSX) ~= ' '
      993    24687    7                   THEN DO;
      994    24688    7                     NSX = 0;
      995    24689    7                     FOUND = '0'B;
      996    24690    8                     DO WHILE( NSX < ERROR_SET.NUM# AND NOT FOUND );
      997    24691    8                        IF ARC_SET.SN#(OSX) = ERROR_SET.SN#(NSX)
      998    24692    8                         THEN FOUND = '1'B;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:30   
      999    24693    8                        NSX = NSX + 1;
     1000    24694    8                        END;
     1001    24695    7                     IF NOT FOUND
     1002    24696    8                      THEN DO;             /* Add DP serial number to error list */
     1003    24697    8                        ERROR_SET.NUM# = NSX + 1;
     1004    24698    8                        IF ERROR_SET.NUM# > MAX_NBR_SNS
     1005    24699    9                         THEN DO;
     1006    24700    9                           TEMP = 10 * LENGTHC(ERROR_SET.SN#(0));
     1007    24701    9                           TEMP = (TEMP + 3) / 4;
     1008    24702    9                           CALL FLI$ALLOC( TEMP, TEMP );
     1009    24703    9                           MAX_NBR_SNS = MAX_NBR_SNS + 10;
     1010    24704    9                           END;
     1011    24705    8                        ERROR_SET.SN#(NSX) = ARC_SET.SN#(OSX);
     1012    24706    8                        END;
     1013    24707    7                     END;
     1014    24708    6                  END;
     1015    24709    5               END;
     1016    24710    5             WHENALTRETURN DO;
     1017    24711    5               IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF
     1018    24712    5                THEN CALL FLI$RPT_ERR;
     1019    24713    5               END;
     1020    24714    4            CALL M$CLOSE( CLOSE_ARCHIVE_EFT ) ALTRET( PACKSET_ERR );
     1021    24715    5            DO WHILE('0'B);
     1022    24716    5   PACKSET_ERR: ;
     1023    24717    5               CALL FLI$RPT_ERR;
     1024    24718    5               ERROR_FLAG = %YES#;
     1025    24719    5               IF M$ARC_FILE$->F$DCB.FCD#
     1026    24720    6                THEN DO;
     1027    24721    6                  CALL M$CLOSE( CLOSE_ARCHIVE_EFT )
     1028    24722    7                   WHENALTRETURN DO;
     1029    24723    7                     CALL FLI$RPT_ERR;
     1030    24724    7                     END;
     1031    24725    6                  END;
     1032    24726    5               END;
     1033    24727    4            END;
     1034    24728    4          WHENALTRETURN DO;
     1035    24729    4            CALL FLI$RPT_ERR;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:31   
     1036    24730    4            END;
     1037    24731    3         END;
     1038    24732
     1039    24733         /***
     1040    24734          *** Error if packsets are not included on new tapes/optical disks and
     1041    24735          *** SELECTED has not been specified.
     1042    24736          ***/
     1043    24737
     1044    24738    2      IF ERROR_SET.NUM# > 0
     1045    24739    3       THEN DO;
     1046    24740    3         IF SELECTED
     1047    24741    4          THEN DO;
     1048    24742    4            IF OD_DEST
     1049    24743    4             THEN WRITE_LO.BUF_ = VECTOR(NOT_INCLUDE_NOTE_OD);
     1050    24744    4             ELSE WRITE_LO.BUF_ = VECTOR(NOT_INCLUDE_NOTE);
     1051    24745    4            CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );
     1052    24746    4            END;
     1053    24747    4          ELSE DO;
     1054    24748    4            ERROR_FLAG = '1'B;
     1055    24749    4            IF OD_DEST
     1056    24750    4             THEN WRITE_LO.BUF_ = VECTOR(NOT_INCLUDE_ERR_OD);
     1057    24751    4             ELSE WRITE_LO.BUF_ = VECTOR(NOT_INCLUDE_ERR);
     1058    24752    4            CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );
     1059    24753    4            END;
     1060    24754    3         WRITE_LO.BUF_ = VECTOR(PSN_LINE);
     1061    24755    4         DO NSX=0 TO ERROR_SET.NUM#-1;
     1062    24756    4            PSN_LINE.PSN = ERROR_SET.SN#(NSX);
     1063    24757    4            CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );
     1064    24758    4            END;
     1065    24759    3         END;
     1066    24760
     1067    24761    2      IF NOT SELECTED AND ERROR_FLAG THEN ALTRETURN;
     1068    24762
     1069    24763         /***
     1070    24764          *** Open old archive list.
     1071    24765          ***/
     1072    24766
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:32   
     1073    24767    2      CALL M$OPEN( OPEN_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );
     1074    24768
     1075    24769         /***
     1076    24770          *** If no tape/optical disk source list has yet been constructed, we'll
     1077    24771          *** have to build the list as we determine on what tapes/optical disks
     1078    24772          *** the archived files reside.  Make room for the serial
     1079    24773          *** numbers.
     1080    24774          ***/
     1081    24775
     1082    24776    2      IF FROM_SN_LIST$ = ADDR(ZERO_SN_LIST)
     1083    24777    3       THEN DO;
     1084    24778    3         COLLECT_SNS = '1'B;
     1085    24779    3         TEMP = LENGTHC(FROM_SN_LIST.NUM#) + 10 * LENGTHC(FROM_SN_LIST.SN#(0));
             24779                  /* Max 10 sns */
     1086    24780    3         CALL FLI$ALLOC( TEMP, FROM_SN_LIST$ );
     1087    24781    3         FROM_SN_LIST.NUM# = 0;
     1088    24782    3         MAX_NBR_SNS = 10;
     1089    24783    3         END;
     1090    24784    2       ELSE COLLECT_SNS = '0'B;
     1091    24785
     1092    24786         /***
     1093    24787          *** Find archived files on each packset.
     1094    24788          ***/
     1095    24789
     1096    24790
     1097    24791    2      CALL FLX_ACC_LINE( 'Archived files found on disk!' ) ALTRET( RPT_ERR_CLOSE );
     1098    24792    3      DO DPX = 0 TO DPLIST.NUM# - 1;
     1099    24793
     1100    24794    3         DPSN.SN#(0) = DPLIST.SN#(DPX);    /* Next PSN                           */
     1101    24795
     1102    24796    3         OPEN_NEXT_ARC_FILE.V.OPER.NXTA# = %YES#;
     1103    24797    3         OPEN_NEXT_ARC_FILE.NAME_ = VECTOR(INITIAL_NAME);
     1104    24798    3         OPEN_NEXT_ARC_FILE.ACCT_ = VECTOR(INITIAL_ACCT);
     1105    24799    3         NBRFAS_PACKSET = 0;
     1106    24800    3         NBRFAS_PACKSET_ACTIVE = 0;
     1107    24801    3         NBRFAS_PACKSET_INACTIVE = 0;
     1108    24802
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:33   
     1109    24803    3         PACKSET_END = %NO#;
     1110    24804
     1111    24805    4         DO WHILE( NOT PACKSET_END );
     1112    24806
     1113    24807    4            CALL M$OPEN( OPEN_NEXT_ARC_FILE )
     1114    24808    5             WHENRETURN DO;
     1115    24809    5               NBRFAS = NBRFAS + 1;
     1116    24810    5               NBRFAS_PACKSET = NBRFAS_PACKSET + 1;
     1117    24811    5               IF M$ARC_FILE$->F$DCB.DESC.DELF#
     1118    24812    6                THEN DO;
     1119    24813    6                  ARC_LIST_REC.ACTIVE = 'I';
     1120    24814    6                  NBRFAS_PACKSET_INACTIVE = NBRFAS_PACKSET_INACTIVE + 1;
     1121    24815    6                  END;
     1122    24816    6                ELSE DO;
     1123    24817    6                  ARC_LIST_REC.ACTIVE = 'A';
     1124    24818    6                  NBRFAS_PACKSET_ACTIVE = NBRFAS_PACKSET_ACTIVE + 1;
     1125    24819    6                  END;
     1126    24820
     1127    24821    5               OPEN_NEXT_ARC_FILE.NAME_ = VECTOR(NIL); /* Reset for NXTF         */
     1128    24822    5               OPEN_NEXT_ARC_FILE.ACCT_ = VECTOR(NIL);
     1129    24823    5               OPEN_NEXT_ARC_FILE.V.OPER.NXTA# = %NO#; /* Through FD, not AD     */
     1130    24824
     1131    24825    5               ARC_LIST_KEY.C.PSN = DPSN.SN#(0);
     1132    24826    5               ARC_LIST_KEY.C.ACCT = F$DCB.ACCT#;
     1133    24827    5               ARC_LIST_KEY.C.FNAMEC = F$DCB.NAME#.C;
     1134    24828    5               ARC_LIST_KEY.C.FNAMEL = F$DCB.NAME#.L;
     1135    24829
     1136    24830    5               CODE06$ = FPARAM_.PTR$;
     1137    24831    5               CALL XSF$LOCCODP( CODE06$, 06 )
     1138    24832    6                WHENRETURN DO;
     1139    24833    6                  ARC_LIST_REC.REEL = CODE06.STOW.REEL;
     1140    24834    6                  IF M$ARC_FILE$->F$DCB.DESC.ODSTOW#
     1141    24835    6                   THEN ARC_LIST_REC.FSN = CODE06.STOW.ODFSN;
     1142    24836    6                   ELSE ARC_LIST_REC.FSN = CODE06.STOW.EFT.FSN;
     1143    24837    6                  IF COLLECT_SNS
     1144    24838    7                   THEN DO;                /* Add new SN to list                 */
     1145    24839    7                     IF F$DCB.DESC.ODSTOW# /* Assume same source type - all files */
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:34   
     1146    24840    7                      THEN OD_SOURCE = '1'B;
     1147    24841
     1148    24842    7                     NSX = 0;
     1149    24843    7                     FOUND = '0'B;
     1150    24844    8                     DO WHILE( NSX < FROM_SN_LIST.NUM# AND NOT FOUND );
     1151    24845    8                        IF ARC_LIST_REC.REEL = FROM_SN_LIST.SN#(NSX)
     1152    24846    8                         THEN FOUND = '1'B;
     1153    24847    8                        NSX = NSX + 1;
     1154    24848    8                        END;
     1155    24849    7                     IF NOT FOUND
     1156    24850    8                      THEN DO;             /* Add serial number to list          */
     1157    24851    8                        FROM_SN_LIST.NUM# = NSX + 1;
     1158    24852    8                        IF FROM_SN_LIST.NUM# > MAX_NBR_SNS
     1159    24853    9                         THEN DO;          /* Make room for more                 */
     1160    24854    9                           TEMP = 10 * LENGTHC(FROM_SN_LIST.SN#(0));
     1161    24855    9                           TEMP = (TEMP + 3) / 4;
     1162    24856    9                           CALL FLI$ALLOC( TEMP, TEMP );
     1163    24857    9                           MAX_NBR_SNS = MAX_NBR_SNS + 10;
     1164    24858    9                           END;
     1165    24859    8                        FROM_SN_LIST.SN#(NSX) = ARC_LIST_REC.REEL;
     1166    24860    8                        END;
     1167    24861    7                     END;
     1168    24862    6                  END;
     1169    24863    6                WHENALTRETURN DO;
     1170    24864    6                  ARC_LIST_REC.REEL = ' ';
     1171    24865    6                  ARC_LIST_REC.FSN = 0;
     1172    24866    6                  END;
     1173    24867
     1174    24868    5               CALL M$WRITE( WRITE_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );
     1175    24869    5               END;
     1176    24870
     1177    24871    5             WHENALTRETURN DO;
     1178    24872    5               OPEN_NEXT_ARC_FILE.ACCT_ = VECTOR(NIL);
     1179    24873    5               CODE = B$TCB.ALT$->B$ALT.ERR.CODE;
     1180    24874    5               IF CODE = %E$ADEOF
     1181    24875    6                THEN DO;
     1182    24876    6                  PACKSET_END = '1'B;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:35   
     1183    24877    6                  PSN_TITLE.PSN = DPSN.SN#(0);
     1184    24878    6                  CALL FLX_ACC_LINE( PSN_TITLE, 0 ) ALTRET( RPT_ERR_CLOSE );
     1185    24879    6                  CALL FLX_ACC_LINE( 'Inactive!', NBRFAS_PACKSET_INACTIVE, 1 ) ALTRET(
             24879                           RPT_ERR_CLOSE );
     1186    24880    6                  CALL FLX_ACC_LINE( 'Active!', NBRFAS_PACKSET_ACTIVE, 1 ) ALTRET(
             24880                           RPT_ERR_CLOSE );
     1187    24881    6                  CALL FLX_ACC_LINE( 'Total!', NBRFAS_PACKSET, 2 ) ALTRET(
             24881                           RPT_ERR_CLOSE );
     1188    24882    6                  END;
     1189    24883    5                ELSE IF CODE = %E$FDEOF OR CODE = %E$NOKEY
     1190    24884    6                   THEN DO;                /* Reinitialize for next account      */
     1191    24885    6                     OPEN_NEXT_ARC_FILE.V.OPER.NXTA# = %YES#;
     1192    24886    6                     OPEN_NEXT_ARC_FILE.NAME_ = VECTOR(INITIAL_NAME);
     1193    24887    6                     END;
     1194    24888    5                   ELSE GOTO RPT_ERR_CLOSE; /* Can't handle this                 */
     1195    24889    5               END;
     1196    24890    4            END;
     1197    24891    3         END;
     1198    24892
     1199    24893        /***
     1200    24894         *** When collecting serial numbers, if last file crosses tape boundry, then
     1201    24895         *** add next serial number so that all of last file is processed.
     1202    24896         ***/
     1203    24897    2      IF NBRFAS_PACKSET > 0                /* Any files found?                   */
     1204    24898    3       THEN DO;
     1205    24899    3         EFTWORD = CODE06.STOW.EFT;
     1206    24900    3         IF (EFTWORD.CROSS AND COLLECT_SNS)
     1207    24901    4          THEN DO;
     1208    24902    4            NSX = FROM_SN_LIST.NUM#;
     1209    24903    4            FROM_SN_LIST.NUM# = NSX + 1;
     1210    24904    4            IF FROM_SN_LIST.NUM# > MAX_NBR_SNS
     1211    24905    5             THEN DO;                      /* Make room for more                 */
     1212    24906    5               TEMP = 10 * LENGTHC(FROM_SN_LIST.SN#(0));
     1213    24907    5               TEMP = (TEMP + 3) / 4;
     1214    24908    5               CALL FLI$ALLOC( TEMP, TEMP );
     1215    24909    5               MAX_NBR_SNS = MAX_NBR_SNS + 10;
     1216    24910    5               END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:36   
     1217    24911    4            FROM_SN_LIST.SN#(NSX) = ARC_LIST_REC.REEL;
     1218    24912    4            TPTR$ = ADDR(FROM_SN_LIST.SN#(NSX));
     1219    24913    4            IF CT5.C2 = ' '
     1220    24914    5             THEN DO;
     1221    24915    5               CALL CHARBIN( CTN, CT5.C1 );
     1222    24916    5               CTN = CTN + 1;
     1223    24917    5               CALL BINCHAR( CT5.C1, CTN );
     1224    24918    5               END;
     1225    24919    5             ELSE DO;
     1226    24920    5               CALL CHARBIN( CTN, CT6.C1 );
     1227    24921    5               CTN = CTN + 1;
     1228    24922    5               CALL BINCHAR( CT6.C1, CTN);
     1229    24923    5               END;
     1230    24924    4            END;
     1231    24925    3         END;
     1232    24926
     1233    24927    2      CALL FLX_ACC_LINE( 'Total in archive system!', NBRFAS, 3, '1'B ) ALTRET(
             24927               RPT_ERR_CLOSE );
     1234    24928    2      CALL M$CLOSE( CLOSE_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );
     1235    24929
     1236    24930         /***
     1237    24931          *** Now process source tape/optical disk list deleting any which should
     1238    24932          *** be ommitted.
     1239    24933          ***/
     1240    24934
     1241    24935    2      IF OMIT_SN_LIST$ ~= ADDR(ZERO_SN_LIST)
     1242    24936    3       THEN DO;                            /* Some should be ommitted            */
     1243    24937    3         MAX_NBR_SNS = OMIT_SN_LIST.NUM#;
     1244    24938    4         DO OSX = 0 TO OMIT_SN_LIST.NUM#-1;
     1245    24939    4            FOUND = '0'B;
     1246    24940    5            DO NSX = 0 TO FROM_SN_LIST.NUM#-1;
     1247    24941    5               IF FROM_SN_LIST.SN#(NSX) = OMIT_SN_LIST.SN#(OSX)
     1248    24942    6                THEN DO;
     1249    24943    6                  FROM_SN_LIST.SN#(NSX) = ' ';
     1250    24944    6                  FOUND = '1'B;
     1251    24945    6                  END;
     1252    24946    5               END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:37   
     1253    24947    4            IF FOUND
     1254    24948    5             THEN DO;
     1255    24949    5               OMIT_SN_LIST.SN#(OSX) = ' ';
     1256    24950    5               MAX_NBR_SNS = MAX_NBR_SNS - 1;
     1257    24951    5               END;
     1258    24952    4            END;
     1259    24953    3         IF MAX_NBR_SNS > 0
     1260    24954    4          THEN DO;                         /* Couldn't find some sns to omit     */
     1261    24955    4            IF OD_SOURCE
     1262    24956    4             THEN WRITE_LO.BUF_ = VECTOR(COULDNT_OMIT_OD);
     1263    24957    4             ELSE WRITE_LO.BUF_ = VECTOR(COULDNT_OMIT);
     1264    24958    4            CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );
     1265    24959    4            IF OD_SOURCE
     1266    24960    4             THEN WRITE_LO.BUF_ = VECTOR(ODSN_LINE);
     1267    24961    4             ELSE WRITE_LO.BUF_ = VECTOR(TSN_LINE);
     1268    24962    5            DO I=0 TO OMIT_SN_LIST.NUM#-1;
     1269    24963    5               IF OMIT_SN_LIST.SN#(I) ~= ' '
     1270    24964    6                THEN DO;
     1271    24965    6                  IF OD_SOURCE
     1272    24966    6                   THEN ODSN_LINE.TSN = OMIT_SN_LIST.SN#(I);
     1273    24967    6                   ELSE TSN_LINE.TSN = OMIT_SN_LIST.SN#(I);
     1274    24968    6                  CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );
     1275    24969    6                  END;
     1276    24970    5               END;
     1277    24971    4            END;
     1278    24972    3         END;
     1279    24973
     1280    24974
     1281    24975         /***
     1282    24976          *** Now clean up source tape/optical disk list deleting all blank entries.
     1283    24977          ***/
     1284    24978
     1285    24979    2      NSX = 0;
     1286    24980    3      DO I=0 TO FROM_SN_LIST.NUM#-1;
     1287    24981    3         IF FROM_SN_LIST.SN#(I) ~= ' '
     1288    24982    4          THEN DO;
     1289    24983    4            FROM_SN_LIST.SN#(NSX) = FROM_SN_LIST.SN#(I);
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:38   
     1290    24984    4            NSX = NSX + 1;
     1291    24985    4            END;
     1292    24986    3         END;
     1293    24987    2      FROM_SN_LIST.NUM# = NSX;
     1294    24988
     1295    24989    2      IF NSX <= 0
     1296    24990    3       THEN DO;
     1297    24991    3         IF OD_SOURCE
     1298    24992    3          THEN WRITE_LO.BUF_ = VECTOR(NO_SOURCE_ODS);
     1299    24993    3          ELSE WRITE_LO.BUF_ = VECTOR(NO_SOURCE_TAPES);
     1300    24994    3         CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );
     1301    24995    3         ALTRETURN;
     1302    24996    3         END;
     1303    24997
     1304    24998    2      IF COLLECT_SNS
     1305    24999    3       THEN DO;                  /* Tape/optical disk source FPT must be set up  */
     1306    25000    3         IF NSX > 1
     1307    25001    4          THEN DO;                         /* Sort serial number list            */
     1308    25002    5            DO NSX=0 TO FROM_SN_LIST.NUM#-2;
     1309    25003    6               DO OSX=NSX TO FROM_SN_LIST.NUM#-1;
     1310    25004    6                  IF FROM_SN_LIST.SN#(NSX) > FROM_SN_LIST.SN#(OSX)
     1311    25005    7                   THEN DO;                /* Swap                               */
     1312    25006    7                     SN = FROM_SN_LIST.SN#(NSX);
     1313    25007    7                     FROM_SN_LIST.SN#(NSX) = FROM_SN_LIST.SN#(OSX);
     1314    25008    7                     FROM_SN_LIST.SN#(OSX) = SN;
     1315    25009    7                     END;
     1316    25010    6                  END;
     1317    25011    5               END;
     1318    25012    4            END;
     1319    25013    3         TVECTOR = VECTOR(FROM_SN_LIST);
     1320    25014    3         TVECTOR.W1.VSIZE# = LENGTHC(FROM_SN_LIST.NUM#)
     1321    25015    3           + FROM_SN_LIST.NUM# * LENGTHC(FROM_SN_LIST.SN#(0)) - 1;
     1322    25016    3         OPEN_TAPE_SOURCE.SN_ = TVECTOR;
     1323    25017    3         END;
     1324    25018
     1325    25019    2      RETURN;
     1326    25020
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:39   
     1327    25021    2   RPT_ERR_CLOSE: ;
     1328    25022    2      CALL FLI$RPT_ERR;
     1329    25023    2      IF M$ARC_LIST$->F$DCB.FCD#
     1330    25024    3       THEN DO;
     1331    25025    3         CALL M$CLOSE( CLOSE_ARC_LIST )
     1332    25026    4          WHENALTRETURN DO;
     1333    25027    4            CALL FLI$RPT_ERR;
     1334    25028    4            END;
     1335    25029    3         END;
     1336    25030
     1337    25031    2      ALTRETURN;
     1338    25032
     1339    25033    2   END FLX_FIND_ARC_FILES;
     1340    25034        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:40   
     1341    25035    1   FLX_MAKE_NEW_ARCHIVE_TAPES: PROC ALTRET;
     1342    25036        /*F*  NAME: FLX_MAKE_NEW_ARCHIVE_TAPES
     1343    25037              PURPOSE: Converts old archive tape/optical disk to new archive tapes/
     1344    25038                       optical disks.
     1345    25039        */
     1346    25040
     1347    25041         /***
     1348    25042          *** STATIC
     1349    25043          ***/
     1350    25044
     1351    25045        %VLP_NAME( FPTN=VLP_NAME,
     1352    25046                   LEN=31,
     1353    25047                   STCLASS=STATIC );
     1354    25074
     1355    25075         /***
     1356    25076          *** CONSTANT
     1357    25077          ***/
     1358    25078
     1359    25079    2   DCL NAME_ VECTOR DALIGNED CONSTANT INIT(VECTOR(VLP_NAME));
     1360    25080
     1361    25081         /***
     1362    25082          *** AUTO
     1363    25083          ***/
     1364    25084
     1365    25085    2   DCL SN CHAR(6) AUTO;
     1366    25086    2   DCL FSN SBIN AUTO;
     1367    25087    2   DCL CROSS CHAR(1) AUTO;
     1368    25088        %VLP_ERRCODE( FPTN=ERR,
     1369    25089                      STCLASS=AUTO );
     1370    25134        %VLP_ERRCODE( FPTN=ERR_SAVE,
     1371    25135                      STCLASS=AUTO );
     1372    25180    2   DCL DCB# UBIN WORD AUTO;
     1373    25181    2   DCL READING_TAPE_SOURCE BIT(1) AUTO;
     1374    25182    2   DCL FOUND_PACKED_FILE BIT(1) AUTO;
     1375    25183    2   DCL OUTPUT_TAPE_OPEN BIT(1) AUTO;
     1376    25184    2   DCL SKIP_FILE BIT(1) AUTO;
     1377    25185    2   DCL NEW_FILE BIT(1) AUTO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:41   
     1378    25186    2   DCL NEW_BLOCK BIT(1) AUTO;
     1379    25187    2   DCL NBR_ARCH_FILES_TO_PROCESS SBIN AUTO; /* Number of arch. files left to proc. */
     1380    25188    2   DCL NBR_SUB_FILES SBIN AUTO;
     1381    25189    2   DCL FORCE_NEW_OUT_BLK BIT(1) AUTO;
     1382    25190    2   DCL NBR_IN_OUT_BLK SBIN AUTO;
     1383    25191    2   DCL NBR_IN_PREV_OUT_BLK SBIN AUTO; /* Nbr. in prev. output blk. - already on tape */
     1384    25192    2   DCL RPT_ERR BIT(1) AUTO;
     1385    25193    2   DCL NIX SBIN AUTO;
     1386    25194    2   DCL OPEN_BY_FSN BIT(1) AUTO;
     1387    25195    2   DCL FIRST_SOURCE_FILE BIT(1) AUTO; /* Set if processing first source file     */
     1388    25196    2   DCL TEMP_FLG BIT(1) AUTO;
     1389    25197    2   DCL IOERRORC BIT(1) AUTO;          /* Continue processing after I/O error     */
     1390    25198    2   DCL GET_NXT_VOL BIT(1) AUTO;       /* Indicates whether to get next volume    */
     1391    25199    2   DCL INPUT_FSN SBIN AUTO;      /* Initial FSN. Specified by user or default    */
     1392    25200
     1393    25201        %FPT_DELREC( FPTN=DEL_ARC_LIST_BY_KEY,
     1394    25202                    DCB=M$ARC_LIST,
     1395    25203                    STCLASS=STATIC );
     1396    25222
     1397    25223
     1398    25224        /****************************************/
     1399    25225
     1400    25226         /***
     1401    25227          *** Manually initialize tape/optical disk source open FPT.
     1402    25228          *** Initizalation done here as source input may not be spec'd.
     1403    25229          ***/
     1404    25230
     1405    25231    2      OPEN_TAPE_SOURCE.V.ACS# = %BLOCK#;
     1406    25232    2      OPEN_TAPE_SOURCE.V.INITZ.SCRUB# = %YES#;
     1407    25233    2      OPEN_TAPE_SOURCE.V.FUN# = %IN#;
     1408    25234    2      OPEN_TAPE_SOURCE.V.OPER.NXTF# = %YES#;
     1409    25235    2      OPEN_TAPE_SOURCE.V.OPER.THISF# = %NO#;
     1410    25236    2      OPEN_TAPE_SOURCE.V.FINDPOS# = %NO#;
     1411    25237    2      OPEN_TAPE_SOURCE.FPARAM_ = FPARAM_;
     1412    25238        /***
     1413    25239         *** Tape - Cont. proc. after I/O error if cont. spec'd on input or output
     1414    25240         *** OD - Cont. prov. after I/O error if cont. spec'd on input
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:42   
     1415    25241         ***/
     1416    25242    2      IF OD_SOURCE
     1417    25243    3       THEN DO;
     1418    25244    3         OPEN_TAPE_SOURCE.V.ASN# = %FILE#;
     1419    25245    3         OPEN_TAPE_SOURCE.V.CVOL# = %NO#;
     1420    25246    3         OPEN_TAPE_SOURCE.V.RES# = 'OD';
     1421    25247    3         IOERRORC = ARCOM_OPTIONS.IOERRORCI;
     1422    25248    3         OPEN_TAPE_SOURCE.V.IOERROK# = IOERRORC;
     1423    25249    3         READ_TAPE_SOURCE.V.IOERROK# = IOERRORC;
     1424    25250    3         END;
     1425    25251    3       ELSE DO;
     1426    25252    3         OPEN_TAPE_SOURCE.V.ASN# = %TAPE#;
     1427    25253    3         OPEN_TAPE_SOURCE.V.CVOL# = %YES#;
     1428    25254    3         OPEN_TAPE_SOURCE.V.RES# = 'LT';
     1429    25255    3         IOERRORC = ARCOM_OPTIONS.IOERRORCI | ARCOM_OPTIONS.IOERRORCO;
     1430    25256    3         OPEN_TAPE_SOURCE.V.IOERROK# = IOERRORC;
     1431    25257    3         READ_TAPE_SOURCE.V.IOERROK# = IOERRORC;
     1432    25258    3         END;
     1433    25259
     1434    25260         /***
     1435    25261          *** Initialization.
     1436    25262          ***/
     1437    25263
     1438    25264    2      READ_TAPE_SOURCE.BUF_ = INBUF_;
     1439    25265    2      OUTPUT_TAPE_OPEN = '0'B;
     1440    25266    2      NBR_SUB_FILES = 0;
     1441    25267
     1442    25268    2      PREV_REEL = ' ';
     1443    25269    2      NBR_IN_OUT_BLK = 0;
     1444    25270    2      NBR_IN_PREV_OUT_BLK = 0;
     1445    25271    2      NEW_FILE = '1'B;
     1446    25272    2      NEW_BLOCK = '1'B;
     1447    25273    2      FIRST_SOURCE_FILE = '1'B;
     1448    25274    2      SKIP_FILE = '0'B;
     1449    25275    2      LAST_TSN_USED = ' ';
     1450    25276    2      NBRFAS_FOUND_UPDATED = 0;
     1451    25277    2      NBRFAS_FOUND_UNUPDATED = 0;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:43   
     1452    25278    2      INPUT_FSN = OPEN_TAPE_SOURCE.V.FSN#; /* Save starting input FSN            */
     1453    25279    2      NBR_ARCH_FILES_TO_PROCESS = NBRFAS;
     1454    25280
     1455    25281    2      IN_GRAN_BASE$ = INBUF_.PTR$;
     1456    25282    2      OUT_GRAN_BASE$ = PINCRW( OUTBUF_.PTR$, 1024 );
     1457    25283    2      OUT_BLK_TAG0$ = PINCRW( OUT_GRAN_BASE$, -SIZEW(OUT_BLK_TAG0) );
     1458    25284    2      OUT_BLK_TAG0.WHERE.PSN = ' ';
     1459    25285    2      OUT_GRAN_MAX$ = PINCRW( OUT_GRAN_BASE$, 1024 * (OUT_BLK_SIZE-1) );
     1460    25286    2      OUT_GRAN$ = PINCRW( OUT_GRAN_BASE$, -1 ); /* Need 1 gran. for block tags   */
     1461    25287
     1462    25288    2      RPT_ERR = '1'B;                      /* Assume that error must be reported */
     1463    25289
     1464    25290    2      CALL FLI$TAPE_IO_INIT;
     1465    25291        /***
     1466    25292         *** Tape - Continue proc. after I/O error  if cont. spec'd on input or ouput
     1467    25293         *** OD - Continue proc. after I/O error if cont. spec'd on output
     1468    25294         ***/
     1469    25295    2      IF OD_DEST
     1470    25296    3       THEN DO;
     1471    25297    3         TAPE_OPEN.V.IOERROK# = ARCOM_OPTIONS.IOERRORCO;
     1472    25298    3         TAPE_WRITE.V.IOERROK# = ARCOM_OPTIONS.IOERRORCO;
     1473    25299    3         END;
     1474    25300    3       ELSE DO;
     1475    25301    3         TAPE_OPEN.V.IOERROK# = ARCOM_OPTIONS.IOERRORCO | ARCOM_OPTIONS.IOERRORCI;
     1476    25302    3         TAPE_WRITE.V.IOERROK# = ARCOM_OPTIONS.IOERRORCO | ARCOM_OPTIONS.IOERRORCI;
     1477    25303    3         END;
     1478    25304    2      CALL FLP$WR_FILE_INFO ALTRET(RPT_ERR_CLOSE);
     1479    25305
     1480    25306
     1481    25307         /***
     1482    25308          *** Open the archive list for comparison with archive tape/optical disk files.
     1483    25309          ***/
     1484    25310
     1485    25311    2      CALL M$OPEN( OPEN_ARC_LIST )
     1486    25312    3       WHENALTRETURN DO;
     1487    25313    3         CALL FLI$RPT_ERR;
     1488    25314    3         ALTRETURN;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:44   
     1489    25315    3         END;
     1490    25316
     1491    25317    2      IF ARCOM_OPTIONS.IMMUPDATE           /* Create *FSN_LIST file              */
     1492    25318    3       THEN DO;
     1493    25319    3         CALL M$OPEN( OPEN_FSN_LIST )
     1494    25320    4          WHENALTRETURN DO;
     1495    25321    4            CALL FLI$RPT_ERR;
     1496    25322    4            ALTRETURN;
     1497    25323    4            END;
     1498    25324    3         END;
     1499    25325
     1500    25326         /***
     1501    25327          *** Primary loop: find next file and process contents.
     1502    25328          ***/
     1503    25329
     1504    25330    2      NBR_FILE_BLOCKS = 0;
     1505    25331    2      OPEN_BY_FSN = '1'B;
     1506    25332    2   MAIN_LOOP:
     1507    25333    3      DO WHILE('1'B);
     1508    25334
     1509    25335    3         FOUND_PACKED_FILE = '0'B;
     1510    25336
     1511    25337    4         DO WHILE( NOT FOUND_PACKED_FILE );
     1512    25338    4            IF OPEN_BY_FSN
     1513    25339    5             THEN DO;
     1514    25340    5               OPEN_TAPE_SOURCE.V.OPER.MNTONLY# = %YES#;
     1515    25341    5               CALL M$OPEN( OPEN_TAPE_SOURCE ) ALTRET( OPEN_TAPE_ALT );
     1516    25342    5               IF M$TAPE_SOURCE$->F$DCB.TYC.IOERR# /* Tape I/O err during mount? */
     1517    25343    6                THEN DO;
     1518    25344    6                  GOTO OPEN_TAPE_ALT;      /* Read next tape                     */
     1519    25345    6                  END;
     1520    25346
     1521    25347    5               IF M$TAPE_SOURCE$->F$DCB.FSECT > 1
     1522    25348    5                THEN OPEN_TAPE_SOURCE.V.FSN# = M$TAPE_SOURCE$->F$DCB.FSN# + 1;
     1523    25349    6                ELSE DO;
     1524    25350    6                  IF FIRST_SOURCE_FILE     /* Use FSN spec'd by user if set      */
     1525    25351    6                    AND OPEN_TAPE_SOURCE.V.FSN# ~= 0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:45   
     1526    25352    6                   THEN;
     1527    25353    6                   ELSE OPEN_TAPE_SOURCE.V.FSN# = M$TAPE_SOURCE$->F$DCB.FSN#;
     1528    25354    6                  END;
     1529    25355    5               OPEN_BY_FSN = '0'B;
     1530    25356    5               OPEN_TAPE_SOURCE.V.OPER.THISF# = %YES#;
     1531    25357    5               OPEN_TAPE_SOURCE.V.OPER.MNTONLY# = %NO#;
     1532    25358    5               OPEN_TAPE_SOURCE.V.INITZ.SCRUB# = %YES#;
     1533    25359    5               END;
     1534    25360    4            CALL M$OPEN( OPEN_TAPE_SOURCE )
     1535    25361    5             WHENRETURN DO;
     1536    25362    5               IF M$TAPE_SOURCE$->F$DCB.TYC.IOERR# /* Tape I/O error?            */
     1537    25363    6                THEN DO;
     1538    25364        /***
     1539    25365         *** Skip out to next EFT_RESTRICT_FILE on input after writing accumulated
     1540    25366         *** blocks. Possibility of running off end of reel if last file on tape and bad.
     1541    25367         ***/
     1542    25368    6                  TEMP_FLG = IN_BLK_TAG.FIN; /* Move on to next output file      */
     1543    25369    6                  CALL FLX_CHECK_CURRENT_GRAN( '1'B, TEMP_FLG )
     1544    25370    6                    ALTRET( RPT_ERR_CLOSE );
     1545    25371
     1546    25372    6                  IF OUTPUT_TAPE_OPEN
     1547    25373    7                   THEN DO;
     1548    25374    7                     CALL FLI$TAPE_CLOSE( VECTOR(CVOL_UTL) ) ALTRET( ERR_CLOSE );
     1549    25375    7                     CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), SN, FSN, '0'B, '1'B
             25375                              , , A_FIT_, ERR, DCB# ) ALTRET(RPT_ERR_CLOSE);
     1550    25376
     1551    25377    7                     IF ARCOM_OPTIONS.IMMUPDATE /* Update fits immediately?      */
     1552    25378    7                      THEN CALL FLX_UPDATE_ARC_FILES ALTRET( ERR_CLOSE );
     1553    25379    7                     END;
     1554    25380
     1555    25381    6                  DCB# = OPEN_TAPE_SOURCE.V.DCB#;
     1556    25382    6                  CALL FLI$RPT_ERR( E_IO_ERR, DCB# );
     1557    25383    6                  IF NOT TEMP_FLG
     1558    25384    6                   THEN CALL FLX_REPORT_PARTIAL_FILE;
     1559    25385
     1560    25386    6                  OPEN_TAPE_SOURCE.V.OPER.THISF# = %NO#;
     1561    25387    6                  OPEN_TAPE_SOURCE.V.FINDPOS# = %YES#;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:46   
     1562    25388    6                  CALL M$OPEN( OPEN_TAPE_SOURCE ) /* Open next good tape file    */
     1563    25389    7                   WHENRETURN DO;
     1564    25390    7                     OPEN_TAPE_SOURCE.V.FINDPOS# = %NO#;
     1565    25391    7                     END;
     1566    25392    7                   WHENALTRETURN DO;
     1567    25393    7                     OPEN_TAPE_SOURCE.V.OPER.THISF# = %NO#; /* End of tape set?  */
     1568    25394    7                     OPEN_TAPE_SOURCE.V.FINDPOS# = %NO#;
     1569    25395    7                     GOTO OPEN_TAPE_ALT;
     1570    25396    7                     END;
     1571    25397    6                  END;
     1572    25398    5               OPEN_TAPE_SOURCE.V.OPER.THISF# = %NO#;
     1573    25399    5               OPEN_TAPE_SOURCE.V.FSN# = 0; /* NXTF from now on                  */
     1574    25400    5               OPEN_TAPE_SOURCE.V.VOL# = 0;
     1575    25401    5               OPEN_TAPE_SOURCE.V.INITZ.SCRUB# = %NO#;
     1576    25402    5               IF M$TAPE_SOURCE$->F$DCB.NAME#.C = EFT_RESTRICT_FILE.NAME#
     1577    25403    5                 AND M$TAPE_SOURCE$->F$DCB.ORG# = %RESTRICT#
     1578    25404    5                THEN FOUND_PACKED_FILE = '1'B;
     1579    25405    6                ELSE DO;
     1580    25406    6                  CALL M$CLOSE( CLOSE_TAPE_SOURCE )
     1581    25407    7                   WHENALTRETURN DO;
     1582    25408        /***
     1583    25409         *** E$VOLORDER may be returned when LT#sn#sn1 ... is spec'd on input
     1584    25410         *** and the last file continues on another tape which was not spec'd.
     1585    25411         *** E$BLNKTP,E$IOERR may occur when reading the EFT_CVOL_FILE.
     1586    25412         *** Perform normal completion which updates the :ARCHIVE record and
     1587    25413         *** output misc. file statistics.
     1588    25414         ***/
     1589    25415    7                     IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$VOLORDER
     1590    25416    7                       OR ( B$TCB.ALT$->B$ALT.ERR.CODE = %E$BLNKTP AND IOERRORC )
     1591    25417    7                      THEN GOTO OPEN_TAPE_ALT;
     1592    25418    7                      ELSE GOTO RPT_ERR_CLOSE;
     1593    25419    7                     END;
     1594    25420    6                  END;
     1595    25421    5               END;
     1596    25422    5             WHENALTRETURN DO;
     1597    25423    5   OPEN_TAPE_ALT: ;
     1598    25424    5               IF ( M$TAPE_SOURCE$->F$DCB.TYC.IOERR# AND IOERRORC )
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:47   
     1599    25425    6                THEN DO;
     1600    25426    6                  ERR = E_IO_ERR;
     1601    25427    6                  CODE = E_IO_ERR.ERR#;
     1602    25428    6                  END;
     1603    25429    6                ELSE DO;
     1604    25430    6                  ERR = B$TCB.ALT$->B$ALT.ERR;
     1605    25431    6                  CODE = B$TCB.ALT$->B$ALT.ERR.CODE;
     1606    25432    6                  END;
     1607    25433    5               IF CODE ~= %E$EOSET AND CODE ~= %E$CANT AND CODE ~= %E$VOLOUT
     1608    25434    5                 AND CODE ~= %E$VOLORDER
     1609    25435    5                 AND NOT ( CODE = %E$NOTANS AND IOERRORC )
     1610    25436    5                 AND NOT ( CODE = %E$BLNKTP AND IOERRORC )
     1611    25437    5                 AND NOT ( CODE = %E$IOERR AND IOERRORC )
     1612    25438    6                THEN DO;
     1613    25439    6                  CALL FLI$RPT_ERR;
     1614    25440    6                  GOTO ERR_CLOSE;
     1615    25441    6                  END;
     1616    25442
     1617    25443        /***
     1618    25444         *** If an input file is continued on the next tape and that tape isn't
     1619    25445         *** specified or on an I/O error, only a partial output file may exist. Pass
     1620    25446         *** the FIN flag so that this condition is detected and its fit is not updated.
     1621    25447         ***/
     1622    25448    5   OPEN_TAPE_ALT10:
     1623    25449    5               IF NOT FIRST_SOURCE_FILE /* Bad source tape if no files proc. yet */
     1624    25450    6                THEN DO;
     1625    25451    6                  TEMP_FLG = IN_BLK_TAG.FIN; /* Move on to next tape/od output file */
     1626    25452    6                  CALL FLX_CHECK_CURRENT_GRAN( '1'B, TEMP_FLG )
     1627    25453    6                    ALTRET( RPT_ERR_CLOSE );
     1628    25454    6                  END;
     1629    25455
     1630    25456    5               IF OUTPUT_TAPE_OPEN
     1631    25457    6                THEN DO;
     1632    25458    6                  CALL FLI$TAPE_CLOSE( VECTOR(CVOL_UTL) ) ALTRET( ERR_CLOSE );
     1633    25459    6                  CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), SN, FSN, '0'B, '1'B, ,
             25459                           A_FIT_, ERR_SAVE, DCB# ) ALTRET(RPT_ERR_CLOSE);
     1634    25460
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:48   
     1635    25461    6                  IF ARCOM_OPTIONS.IMMUPDATE /* Update fits immediately?         */
     1636    25462    7                   THEN DO;
     1637    25463    7                     CALL FLX_UPDATE_ARC_FILES ALTRET(ERR_CLOSE);
     1638    25464    7                     END;
     1639    25465    6                  END;
     1640    25466
     1641    25467    5               IF ( CODE = %E$NOTANS AND IOERRORC AND NOT FIRST_SOURCE_FILE )
     1642    25468    5                 OR ( CODE = %E$BLNKTP AND IOERRORC AND NOT FIRST_SOURCE_FILE )
     1643    25469    5                 OR ( CODE = %E$IOERR AND IOERRORC AND NOT FIRST_SOURCE_FILE )
     1644    25470    5                 OR ( CODE = %E$VOLORDER  AND NOT FIRST_SOURCE_FILE )
     1645    25471    6                THEN DO;
     1646    25472    6                  DCB# = OPEN_TAPE_SOURCE.V.DCB#;
     1647    25473    6                  CALL FLI$RPT_ERR( ERR, DCB# );
     1648    25474    6                  IF NOT TEMP_FLG
     1649    25475    6                   THEN CALL FLX_REPORT_PARTIAL_FILE;
     1650    25476    6                  END;
     1651    25477    6                ELSE DO;
     1652    25478    6                  CALL FLI$RPT_ERR( ERR );
     1653    25479    6                  IF (CODE = %E$BLNKTP AND IOERRORC AND FIRST_SOURCE_FILE)
     1654    25480    6                   THEN OPEN_TAPE_SOURCE.V.FSN# = INPUT_FSN; /* Reinit. FSN      */
     1655    25481    6                  END;
     1656    25482
     1657    25483    5               IF (M$TAPE_SOURCE$->F$DCB.VOL# < FROM_SN_LIST.NUM#
     1658    25484    5                 AND NOT CONTROLLED_SOURCE AND CODE ~= %E$COMPACT_FIN)
     1659    25485    5                 OR (CONTROLLED_SOURCE AND CODE = %E$NOTANS AND IOERRORC )
     1660    25486    5                 OR (CONTROLLED_SOURCE AND CODE = %E$BLNKTP AND IOERRORC )
     1661    25487    5                 OR (CONTROLLED_SOURCE AND CODE = %E$IOERR AND IOERRORC )
     1662    25488    5                 OR CODE = %E$VOLORDER
     1663    25489    6                THEN DO;                   /* More to process                    */
     1664    25490    6                  IF CODE = %E$VOLORDER
     1665    25491    7                   THEN DO; /* Process files on currently mounted vol. - continue */
     1666    25492    7                     OPEN_TAPE_SOURCE.V.VOL# = M$TAPE_SOURCE$->F$DCB.VOL#;
     1667    25493    7                     OPEN_BY_FSN = '1'B;
     1668    25494    7                     END;
     1669    25495    7                   ELSE DO;
     1670    25496    7                     CALL FLX_REMOVE_VOL; /* Remove the current volume - continue */
     1671    25497    7                     OPEN_TAPE_SOURCE.V.VOL# = 1;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:49   
     1672    25498    7                     OPEN_BY_FSN = '1'B;
     1673    25499    7                     END;
     1674    25500    6                  END;
     1675    25501    6                ELSE DO;         /* No more reels or all archived files copied   */
     1676    25502    6                  CALL M$CLOSE( CLOSE_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );
     1677    25503
     1678    25504    6                  IF M$FSN_LIST$->F$DCB.FCD#
     1679    25505    7                   THEN DO;
     1680    25506    7                     CLOSE_FSN_LIST.V.DISP# = %RELEASE#;
     1681    25507    7                     CALL M$CLOSE( CLOSE_FSN_LIST ) ALTRET( RPT_ERR_CLOSE );
     1682    25508    7                     CLOSE_FSN_LIST.V.DISP# = %SAVE#;
     1683    25509    7                     END;
     1684    25510    6                  RETURN;
     1685    25511    6                  END;
     1686    25512    5               END;
     1687    25513    4            END;
     1688    25514
     1689    25515    3         VLP_NAME.NAME# = M$TAPE_SOURCE$->F$DCB.NAME#.C;
     1690    25516    3         VLP_NAME.L# = M$TAPE_SOURCE$->F$DCB.NAME#.L;
     1691    25517
     1692    25518    3         CALL FLX_PROCESS_TAPE_SOURCE_FILE( GET_NXT_VOL )
     1693    25519    4          WHENALTRETURN DO;
     1694    25520    4            IF ( IOERRORC AND GET_NXT_VOL ) /* Continue if source I/O error      */
     1695    25521    5             THEN DO;
     1696    25522    5               IF M$TAPE_SOURCE$->F$DCB.FCD#
     1697    25523    5                THEN CALL M$CLOSE( CLOSE_TAPE_SOURCE )
     1698    25524    6                   WHENALTRETURN DO;
     1699    25525    6                     IF NOT ( B$TCB.ALT$->B$ALT.ERR.CODE = %E$BLKCNT )
     1700    25526    6                      THEN GOTO ERR_CLOSE; /* Continue if block count error      */
     1701    25527    6                     END;
     1702    25528    5               CALL FLX_REMOVE_VOL;        /* Yep, remove the current volume     */
     1703    25529    5               OPEN_TAPE_SOURCE.V.VOL# = 1;
     1704    25530    5               OPEN_BY_FSN = '1'B;
     1705    25531    5               END;
     1706    25532    4             ELSE GOTO RPT_ERR_CLOSE;
     1707    25533    4            END;
     1708    25534
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:50   
     1709    25535    3         IF M$TAPE_SOURCE$->F$DCB.FCD#
     1710    25536    4          THEN DO;
     1711    25537    4            CALL M$CLOSE( CLOSE_TAPE_SOURCE )
     1712    25538    5             WHENALTRETURN DO;             /* Continue if block count error      */
     1713    25539    5               IF NOT (B$TCB.ALT$->B$ALT.ERR.CODE = %E$BLKCNT AND IOERRORC)
     1714    25540    5                THEN GOTO RPT_ERR_CLOSE;
     1715    25541    5               END;
     1716    25542    4            END;
     1717    25543        /***
     1718    25544         *** If all archived files copied, terminate. No need to continue reading
     1719    25545         *** source for additional files.
     1720    25546         ***/
     1721    25547    3         IF NBR_ARCH_FILES_TO_PROCESS <= 0
     1722    25548    4          THEN DO;
     1723    25549    4            ERR = E_COMPACT_FIN;
     1724    25550    4            CODE = E_COMPACT_FIN.ERR#;
     1725    25551    4            GOTO OPEN_TAPE_ALT10;
     1726    25552    4            END;
     1727    25553
     1728    25554    3         END;
     1729    25555
     1730    25556    2   RPT_ERR_CLOSE: ;
     1731    25557    2      IF RPT_ERR
     1732    25558    2       THEN CALL FLI$RPT_ERR;
     1733    25559
     1734    25560    2   ERR_CLOSE: ;
     1735    25561    2      IF OUTPUT_TAPE_OPEN
     1736    25562    3       THEN DO;
     1737    25563    3         CALL FLI$TAPE_CLOSE( VECTOR(CVOL_UTL) );
     1738    25564    3         END;
     1739    25565
     1740    25566    2      IF M$TAPE_SOURCE$->F$DCB.FCD#
     1741    25567    3       THEN DO;
     1742    25568    3         CALL M$CLOSE( CLOSE_TAPE_SOURCE )
     1743    25569    4          WHENALTRETURN DO;
     1744    25570    4            CALL FLI$RPT_ERR;
     1745    25571    4            END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:51   
     1746    25572    3         END;
     1747    25573
     1748    25574    2      IF M$ARC_LIST$->F$DCB.FCD#
     1749    25575    3       THEN DO;
     1750    25576    3         CALL M$CLOSE( CLOSE_ARC_LIST )
     1751    25577    4          WHENALTRETURN DO;
     1752    25578    4            CALL FLI$RPT_ERR;
     1753    25579    4            END;
     1754    25580    3         END;
     1755    25581
     1756    25582    2      IF M$FSN_LIST$->F$DCB.FCD#
     1757    25583    3       THEN DO;
     1758    25584    3         CLOSE_FSN_LIST.V.DISP# = %RELEASE#;
     1759    25585    3         CALL M$CLOSE( CLOSE_FSN_LIST )
     1760    25586    4          WHENALTRETURN DO;
     1761    25587    4            CALL FLI$RPT_ERR;
     1762    25588    4            END;
     1763    25589    3         CLOSE_FSN_LIST.V.DISP# = %SAVE#;
     1764    25590    3         END;
     1765    25591
     1766    25592    2      ALTRETURN;
     1767    25593
     1768    25594        /******************************/
     1769    25595    2   FLX_PROCESS_TAPE_SOURCE_FILE: PROC(GET_NXT_VOL) ALTRET;
     1770    25596        /*F*  NAME: FLX_PROCESS_TAPE_SOURCE
     1771    25597              PURPOSE: Process current source tape/optical disk file.
     1772    25598        */
     1773    25599
     1774    25600        /********************/
     1775    25601
     1776    25602    3   DCL GET_NXT_VOL BIT(1) ALIGNED;    /* Flag returned - volume change needed    */
     1777    25603
     1778    25604
     1779    25605    3      IN_BLK_TAG_IX_MAX = 0;
     1780    25606    3      IN_BLK_TAG_IX = 1;                   /* Assume no more input block tags    */
     1781    25607    3      READING_TAPE_SOURCE = '1'B;
     1782    25608    3      GET_NXT_VOL = '0'B;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:52   
     1783    25609
     1784    25610    4      DO WHILE( READING_TAPE_SOURCE );
     1785    25611
     1786    25612    5         DO WHILE( IN_BLK_TAG_IX < IN_BLK_TAG_IX_MAX );
     1787    25613               /***
     1788    25614                *** Another unprocessed tape/optical disk block remains in current
     1789    25615                *** input block.
     1790    25616                ***/
     1791    25617                                                /*** Position to next IN_BLK_TAG ***/
     1792    25618    5            IN_BLK_TAG_IX = IN_BLK_TAG_IX + 1;
     1793    25619    5            IN_BLK_TAG$ = PINCRW( IN_BLK_TAG$, -SIZEW(IN_BLK_TAG) );
     1794    25620                                 /*** Check if this block should start a new file ***/
     1795    25621    5            IF NEW_FILE
     1796    25622    6             THEN DO;
     1797    25623    6               IF NOT IN_BLK_TAG.BEG
     1798    25624    7                THEN DO;                   /* File doesn't start with FIT?       */
     1799    25625                       /*N* Print appropriate message */
     1800    25626    7                  IF FIRST_SOURCE_FILE /* Compacting did not begin on 1st volume */
     1801    25627    7                    OR ( CODE = %E$IOERR AND IOERRORC ) /* Read error            */
     1802    25628    7                    OR ( CODE = %E$BLNKTP AND IOERRORC ) /* Skip file error      */
     1803    25629    7                    OR ( CODE = %E$NOTANS AND IOERRORC ) /* Skip file error      */
     1804    25630    7                   THEN;
     1805    25631        /***
     1806    25632         *** Shouldn't happen but may if skipping input such as LT#EFT1#EFT3. Used to abort.
     1807    25633         ***/
     1808    25634    8                   ELSE DO;
     1809    25635    8                     DCB# = OPEN_TAPE_SOURCE.V.DCB#;
     1810    25636    8                     CALL FLI$RPT_ERR( E_INCOMPLETE_FILE_SKIP, DCB# );
     1811    25637    8                     END;
     1812    25638    7                  SKIP_FILE = '1'B;        /* Just skip the file                 */
     1813    25639    7                  FIRST_SOURCE_FILE = '0'B;
     1814    25640    7                  END;
     1815    25641    7                ELSE DO;
     1816    25642    7                  FIRST_SOURCE_FILE = '0'B;
     1817    25643    7                  CALL FLX_CHECK_ARC_LIST ALTRET( JUSTALT );
     1818    25644    7                  END;
     1819    25645    6               IF NOT SKIP_FILE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:53   
     1820    25646    7                THEN DO;                   /* Include this file on output tape   */
     1821    25647    7                  IF IN_BLK_TAG0.WHERE.PSN ~= OUT_BLK_TAG0.WHERE.PSN
     1822    25648    7                    OR IN_BLK_TAG0.WHERE.ACCT ~= OUT_BLK_TAG0.WHERE.ACCT
     1823    25649    7                   THEN FORCE_NEW_OUT_BLK = '1'B; /* Need to start new output block */
     1824    25650    7                   ELSE FORCE_NEW_OUT_BLK = '0'B;
     1825    25651    7                  CALL FLX_CHECK_CURRENT_GRAN( FORCE_NEW_OUT_BLK ) ALTRET( JUSTALT );
     1826    25652                            /*** Remember that file will be in current output block ***/
     1827    25653    7                  THIS_BLK_ARC_LIST_KEY(NBR_IN_OUT_BLK) = ARC_LIST_KEY;
     1828    25654    7                  THIS_BLK_ARC_LIST_REC(NBR_IN_OUT_BLK) = ARC_LIST_REC;
     1829    25655    7                  NBR_IN_OUT_BLK = NBR_IN_OUT_BLK + 1;
     1830    25656    7                  END;
     1831    25657    6               END;
     1832    25658    5            IF NOT SKIP_FILE
     1833    25659    6             THEN DO;            /* Include granules on output tape/optical disk */
     1834    25660    6               IN_GRAN$ = PINCRC( IN_GRAN_BASE$, IN_BLK_TAG.BEGX );
     1835    25661    6               IF IN_BLK_TAG.BEG
     1836    25662    7                THEN DO; /* Update tape/optical disk with destination REEL and FSN */
     1837    25663    7                  CODE06$ = PINCRW( IN_GRAN$, SIZEW(FM$GRAN) );
     1838    25664    7                  CALL XSF$LOCCODP( CODE06$, 06 )
     1839    25665    8                   WHENRETURN DO;
     1840    25666    8                     CODE06.STOW.REEL = PREV_REEL;
     1841    25667    8                     IF OD_DEST
     1842    25668    8                      THEN CODE06.STOW.ODFSN = FSN;
     1843    25669    8                      ELSE CODE06.STOW.EFT.FSN = FSN;
     1844    25670    8                     END;
     1845    25671    7                  END;
     1846    25672    6               IN_GRAN_MAX$ = PINCRC( IN_GRAN$, IN_BLK_TAG.SIZE - 4096 );
     1847    25673        /***
     1848    25674         *** After I/O err with continuation set, beginning of block may not get read on the
     1849    25675         *** next read (TFM returns as much as possible). ARS returned may be < block size.
     1850    25676         ***/
     1851    25677    6               IF IN_GRAN_MAX$ > IN_GRAN_MAX_CHK$
     1852    25678    6                 AND NOT IOERRORC
     1853    25679    7                THEN DO;                   /* Pointing past buffer end?          */
     1854    25680    7                  CALL M$XXX;
     1855    25681    7                  END;
     1856    25682    6               IF IN_GRAN$ > IN_GRAN_MAX$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:54   
     1857    25683    7                THEN DO;                   /* Non-positive number of granules?   */
     1858    25684                                                /*           CALL M$XXX;              */
     1859    25685    7                  END;
     1860    25686    6               IF NEW_FILE
     1861    25687    7                THEN DO;                   /* File beginning                     */
     1862    25688    7                  OUT_BLK_TAG.BEGX = OUT_GRANX;
     1863    25689    7                  OUT_BLK_TAG.BEG = '1'B;
     1864    25690    7                  NEW_FILE = '0'B;         /* Not a new file anymore             */
     1865    25691    7                  END;
     1866    25692    7               DO WHILE( IN_GRAN$ <= IN_GRAN_MAX$ );
     1867    25693    7                  CALL FLX_ADD_ANOTHER_GRAN ALTRET( JUSTALT );
     1868    25694    7                  END;
     1869    25695        /***
     1870    25696         *** Another file copied to destination - decrement number of archive files to proc.
     1871    25697         ***/
     1872    25698    6               IF IN_BLK_TAG.FIN
     1873    25699    6                THEN NBR_ARCH_FILES_TO_PROCESS = NBR_ARCH_FILES_TO_PROCESS - 1;
     1874    25700
     1875    25701    6               OUT_BLK_TAG.FIN = IN_BLK_TAG.FIN;
     1876    25702    6               END;
     1877    25703    5            NEW_FILE = IN_BLK_TAG.FIN;     /* Next is new file if current ends   */
     1878    25704    5            END;
     1879    25705
     1880    25706    4         CALL M$READ( READ_TAPE_SOURCE )
     1881    25707    5          WHENRETURN DO;
     1882    25708    5            IF M$TAPE_SOURCE$->F$DCB.TYC.IOERR# /* Tape I/O error?               */
     1883    25709    6             THEN DO;
     1884    25710
     1885    25711    6               CODE = %E$IOERR;
     1886    25712    6               CALL FLX_CHECK_CURRENT_GRAN( '1'B, NEW_FILE )
     1887    25713    6                 ALTRET( JUSTALT );
     1888    25714
     1889    25715    6               IF OUTPUT_TAPE_OPEN
     1890    25716    7                THEN DO;
     1891    25717    7                  CALL FLI$TAPE_CLOSE( VECTOR(CVOL_UTL) ) ALTRET( NO_RPT_ERR );
     1892    25718    7                  OUTPUT_TAPE_OPEN = %NO#;
     1893    25719
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:55   
     1894    25720    7                  IF ARCOM_OPTIONS.IMMUPDATE /* Update fits immediately?         */
     1895    25721    8                   THEN DO;
     1896    25722    8                     CALL FLX_UPDATE_ARC_FILES ALTRET( NO_RPT_ERR );
     1897    25723    8                     END;
     1898    25724    7                  END;
     1899    25725        /***
     1900    25726         *** Report error and partial file name if all of previous file not read.
     1901    25727         *** Note that the name and account may not be output for the error msge. if
     1902    25728         *** the block tags are not valid (garbage) as a result of the I/O error.
     1903    25729         ***/
     1904    25730    6               DCB# = OPEN_TAPE_SOURCE.V.DCB#;
     1905    25731    6               CALL FLI$RPT_ERR( E_IO_ERR, DCB# );
     1906    25732    6               IF NOT NEW_FILE
     1907    25733    6                THEN CALL FLX_REPORT_PARTIAL_FILE;
     1908    25734
     1909    25735        /***
     1910    25736         *** Attempt to read next block. If not possible to read past bad spot, return
     1911    25737         *** and read next EFT file. A number of files may be skipped in the process.
     1912    25738         *** Note that when attempting to read the next block, TFM reads as much as
     1913    25739         *** possible (ARS reflects how much it was able to read).
     1914    25740         ***/
     1915    25741    6               CALL M$READ( READ_TAPE_SOURCE )
     1916    25742    7                WHENRETURN DO;
     1917    25743    7                  NEW_FILE = '1'B;         /* Search blocks for new file         */
     1918    25744    7                  END;
     1919    25745    7                WHENALTRETURN DO;
     1920    25746    7                  CODE = B$TCB.ALT$->B$ALT.ERR.CODE;
     1921    25747
     1922    25748    8                  DO CASE( CODE );
     1923    25749    8                   CASE( %E$BLNKTP );
     1924    25750    8                     GET_NXT_VOL = '1'B;   /* No more data on this tape          */
     1925    25751    8                     GOTO JUSTALT; /* Return to mount next vol, read rest of file */
     1926    25752    8                   CASE( ELSE );
     1927    25753    8                     NEW_FILE = '1'B;      /* Unable to read next block          */
     1928    25754    8                     IN_BLK_TAG0$ = PINCRW( INBUF_.PTR$, IN_BLK_TAG_IX_MAX * SIZEW(
             25754                              IN_BLK_TAG) );
     1929    25755    8                     IN_GRAN_BASE$ = PINCRW( IN_BLK_TAG0$, SIZEW(IN_BLK_TAG0) );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:56   
     1930    25756    8                     IN_GRAN_MAX_CHK$ = PINCRC( INBUF_.PTR$, M$TAPE_SOURCE$->F$DCB.ARS#
             25756                              - 4096 );
     1931    25757    8                     IN_BLK_TAG$ = IN_BLK_TAG0$;
     1932    25758    8                     IN_BLK_TAG_IX = 0;
     1933    25759    8                     GOTO JUSTRET;         /* Return to open next EFT file       */
     1934    25760    8                   END;
     1935    25761    7                  END;
     1936    25762    6               END;
     1937    25763    5            IN_BLK_TAG_IX_MAX = INBUF_.PTR$->IN_BLK_TAG.NBR;
     1938    25764    5            IN_BLK_TAG0$ = PINCRW( INBUF_.PTR$, IN_BLK_TAG_IX_MAX * SIZEW(IN_BLK_TAG) )
             25764                     ;
     1939    25765    5            IN_GRAN_BASE$ = PINCRW( IN_BLK_TAG0$, SIZEW(IN_BLK_TAG0) );
     1940    25766    5            IN_GRAN_MAX_CHK$ = PINCRC( INBUF_.PTR$, M$TAPE_SOURCE$->F$DCB.ARS# - 4096 )
             25766                     ;
     1941    25767    5            IN_BLK_TAG$ = IN_BLK_TAG0$;
     1942    25768    5            IN_BLK_TAG_IX = 0;
     1943    25769    5            END;
     1944    25770    5          WHENALTRETURN DO;
     1945    25771    5            CODE = B$TCB.ALT$->B$ALT.ERR.CODE;
     1946    25772    5            IF CODE = %E$EOF
     1947    25773    5             THEN READING_TAPE_SOURCE = '0'B;
     1948    25774    6             ELSE DO;
     1949    25775    6               IF ( IOERRORC AND CODE = %E$BLNKTP )
     1950    25776    6                 OR ( IOERRORC AND CODE = %E$POSERR ) /* Illegal ANS tape label  */
     1951    25777    7                THEN DO;    /* Return to calling routine to mount next volume    */
     1952    25778    7                  GET_NXT_VOL = '1'B;
     1953    25779    7                  GOTO JUSTALT;
     1954    25780    7                  END;
     1955    25781    7                ELSE DO;
     1956    25782    7                  GOTO JUSTALT;
     1957    25783    7                  END;
     1958    25784    6               END;
     1959    25785    5            END;
     1960    25786    4         END;
     1961    25787
     1962    25788    3   JUSTRET:
     1963    25789    3      RETURN;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:57   
     1964    25790
     1965    25791    3   NO_RPT_ERR: ;
     1966    25792    3      RPT_ERR = '0'B;
     1967    25793
     1968    25794    3   JUSTALT: ;
     1969    25795    3      ALTRETURN;
     1970    25796
     1971    25797    3   END FLX_PROCESS_TAPE_SOURCE_FILE;
     1972    25798        /******************************/
     1973    25799    2   FLX_CHECK_ARC_LIST: PROC ALTRET;
     1974    25800        /*F*  NAME: FLX_CHECK_ARC_LIST
     1975    25801              PURPOSE: Check current tape/optical disk source file against archive list.
     1976    25802        */
     1977    25803
     1978    25804        /********************/
     1979    25805
     1980    25806    3      SKIP_FILE = '1'B;                    /* Assume file should be skipped      */
     1981    25807
     1982    25808         /***
     1983    25809          *** Build archive list key with current tape/optical disk source file info.
     1984    25810          ***/
     1985    25811
     1986    25812    3      ARC_LIST_KEY.C.PSN = IN_BLK_TAG0.WHERE.PSN;
     1987    25813    3      ARC_LIST_KEY.C.ACCT = IN_BLK_TAG0.WHERE.ACCT;
     1988    25814    3      ARC_LIST_KEY.C.FNAMEC = IN_BLK_TAG.NAME.C;
     1989    25815    3      ARC_LIST_KEY.C.FNAMEL = IN_BLK_TAG.NAME.L;
     1990    25816
     1991    25817         /***
     1992    25818          *** Get archive list record for current tape/optical disk source file.
     1993    25819          *** If current tape/optical disk source file corresponds to disk file,
     1994    25820          *** get ready to include the tape source/optical disk file on the output tape.
     1995    25821          *** Otherwise, remember tape/optical disk source file.
     1996    25822          ***/
     1997    25823
     1998    25824    3      CALL M$READ( READ_ARC_LIST_BY_KEY )
     1999    25825    4       WHENRETURN DO;
     2000    25826    4         ARC_LIST_REC.NBR_ON_TAPE = ARC_LIST_REC.NBR_ON_TAPE + 1;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:58   
             25826                  /* Count occurrances */
     2001    25827
     2002    25828    4         IF (M$TAPE_SOURCE$->F$DCB.PSN# = ARC_LIST_REC.REEL /* Reel spec'd in fit? */
     2003    25829    4           AND M$TAPE_SOURCE$->F$DCB.FSN# = ARC_LIST_REC.FSN)
     2004    25830    4           OR (ARCOM_OPTIONS.DUPLICATE_TAPESET /* Duplicate reel spec'd ?        */
     2005    25831    4           AND M$TAPE_SOURCE$->F$DCB.FSN# = ARC_LIST_REC.FSN)
     2006    25832    5          THEN DO;                         /* Found a correspondence             */
     2007    25833    5            SKIP_FILE = '0'B;
     2008    25834
     2009    25835    5            IF NBR_FILE_BLOCKS >= %MAX_NBR_FILE_BLOCKS
     2010    25836    6             THEN DO;       /* Must move on to new tape/optical disk output file */
     2011    25837    6               CALL FLX_CHECK_CURRENT_GRAN( '1'B ) ALTRET( JUSTALT );
     2012    25838    6               CALL FLI$TAPE_CLOSE( VECTOR(CVOL_UTL) )
     2013    25839    7                WHENALTRETURN DO;
     2014    25840    7                  RPT_ERR = '0'B;
     2015    25841    7                  ALTRETURN;
     2016    25842    7                  END;
     2017    25843    6               OUTPUT_TAPE_OPEN = '0'B;
     2018    25844
     2019    25845    6               IF ARCOM_OPTIONS.IMMUPDATE  /* Update fits immediately ?          */
     2020    25846    7                THEN DO;
     2021    25847    7                  CALL FLX_UPDATE_ARC_FILES
     2022    25848    8                   WHENALTRETURN DO;
     2023    25849    8                     RPT_ERR = '0'B;
     2024    25850    8                     ALTRETURN;
     2025    25851    8                     END;
     2026    25852    7                  END;
     2027    25853    6               END;
     2028    25854
     2029    25855    5            IF NOT OUTPUT_TAPE_OPEN
     2030    25856    6             THEN DO;                      /* Open output tape/optical disk      */
     2031    25857    6               CALL FLI$TAPE_OPEN( NAME_, SN, FSN, '0'B, '0'B, , FPARAM_, ERR, DCB# )
     2032    25858    7                WHENALTRETURN DO;
     2033    25859    7                  CALL FLI$RPT_ERR( ERR, DCB# );
     2034    25860    7                  RPT_ERR = '0'B;
     2035    25861    7                  ALTRETURN;
     2036    25862    7                  END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:59   
     2037    25863    6               PREV_REEL = SN;
     2038    25864    6               NBR_SUB_FILES = 0;
             25864                        /* Zero count of files in output tape/optical disk file */
     2039    25865    6               NBR_FILE_BLOCKS = 0;
     2040    25866    6               OUTPUT_TAPE_OPEN = '1'B;
     2041    25867    6               END;
     2042    25868    5            NBR_SUB_FILES = NBR_SUB_FILES + 1;
     2043    25869    5            END;
     2044    25870    5          ELSE DO;                         /* This file should be skipped        */
     2045    25871    5            WRITE_ARC_LIST_BY_KEY.KEY_ = VECTOR(ARC_LIST_KEY);
     2046    25872    5            WRITE_ARC_LIST_BY_KEY.BUF_ = VECTOR(ARC_LIST_REC);
     2047    25873    5            CALL M$WRITE( WRITE_ARC_LIST_BY_KEY ) ALTRET( JUSTALT );
     2048    25874    5            END;
     2049    25875    4         END;
     2050    25876    4       WHENALTRETURN DO;
     2051    25877    4         IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$NOKEY
     2052    25878    5          THEN DO;               /* Never seen this file before, remember it     */
     2053    25879    5            ARC_LIST_REC.REEL = ' ';
     2054    25880    5            ARC_LIST_REC.FSN = 0;
     2055    25881    5            ARC_LIST_REC.NEW.REEL = ' ';
     2056    25882    5            ARC_LIST_REC.NEW.FSN = 0;
     2057    25883    5            ARC_LIST_REC.NBR_ON_TAPE = 1;
     2058    25884    5            ARC_LIST_REC.ACTIVE = ' ';
     2059    25885    5            CALL M$WRITE( WRITE_ARC_LIST_BY_KEY_NEW ) ALTRET( JUSTALT );
     2060    25886    5            END;
     2061    25887    4          ELSE ALTRETURN;
     2062    25888    4         END;
     2063    25889
     2064    25890    3      RETURN;
     2065    25891
     2066    25892    3   JUSTALT: ;
     2067    25893    3      ALTRETURN;
     2068    25894
     2069    25895    3   END FLX_CHECK_ARC_LIST;
     2070    25896        /******************************/
     2071    25897    2   FLX_CHECK_CURRENT_GRAN: PROC( FORCE, FILE_FIN ) ALTRET;
     2072    25898        /*F*  NAME: FLX_CHECK_CURRENT_GRAN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:60   
     2073    25899              PURPOSE: Writes current tape/optical disk output granule if it is full or
     2074    25900                 forced.
     2075    25901        */
     2076    25902
     2077    25903    3   DCL FORCE BIT(1) ALIGNED;          /* Indicates write whether full or not     */
     2078    25904    3   DCL FILE_FIN BIT(1) ALIGNED; /* Indicates whether last input file is complete */
     2079    25905
     2080    25906         /***
     2081    25907          *** AUTO
     2082    25908          ***/
     2083    25909
     2084    25910    3   DCL BUF_ BIT(72) DALIGNED AUTO;
     2085    25911    3   DCL I SBIN AUTO;
     2086    25912    3   DCL EOVOL BIT(1) AUTO;
     2087    25913    3   DCL ARS SBIN AUTO;
     2088    25914    3   DCL NEW_TSN CHAR(6) CALIGNED; /* New current tape SN rtrnd on IOERRCONT, I-O err */
     2089    25915    3   DCL NEW_FSN UBIN WORD ALIGNED;
             25915            /* New current tape FSN rtrnd on IOERRCONT, I-O err */
     2090    25916
     2091    25917        /***
     2092    25918         *** STATIC
     2093    25919         ***/
     2094    25920
     2095    25921    3   DCL 1 LAST_BLK_ARC_LIST_KEY ALIGNED STATIC,
     2096    25922              %ARC_LIST_KEY;
     2097    25930    3   DCL 1 LAST_BLK_ARC_LIST_REC ALIGNED STATIC,
     2098    25931              %ARC_LIST_REC;
     2099    25940
     2100    25941
     2101    25942        /********************/
     2102    25943
     2103    25944    3      IF PINCRW( OUT_GRAN$, 1024 ) >= OUT_GRAN_MAX$
     2104    25945    3        OR (FORCE AND OUT_GRAN$ >= OUT_GRAN_BASE$)
     2105    25946    4       THEN DO;                       /* Full, or forced and something to write  */
     2106    25947
     2107    25948    4         TVECTOR = OUTBUF_;                /* Set up buffer vector               */
     2108    25949    4         ARS = POFFC( OUT_GRAN$, OUT_BLK_TAG$ ) + 4096; /* Tag bytes + block bytes */
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:61   
     2109    25950    4         TVECTOR.W1.VSIZE# = ARS;
     2110    25951    4         TVECTOR.PTR$ = OUT_BLK_TAG$;
     2111    25952    4         BUF_ = TVECTOR;
     2112    25953
     2113    25954    5         DO I = 0 TO NBR_IN_OUT_BLK - 1;
     2114    25955    5            THIS_BLK_ARC_LIST_REC.NEW.REEL(I) = PREV_REEL;
     2115    25956    5            THIS_BLK_ARC_LIST_REC.NEW.FSN(I) = FSN;
     2116    25957    5            WRITE_ARC_LIST_BY_KEY.KEY_ = VECTOR(THIS_BLK_ARC_LIST_KEY(I));
     2117    25958    5            WRITE_ARC_LIST_BY_KEY.BUF_ = VECTOR(THIS_BLK_ARC_LIST_REC(I));
     2118    25959    5            CALL M$WRITE( WRITE_ARC_LIST_BY_KEY ) ALTRET( JUSTALT );
     2119    25960    5            LAST_BLK_ARC_LIST_REC = THIS_BLK_ARC_LIST_REC(I); /* Save - may need */
     2120    25961    5            LAST_BLK_ARC_LIST_KEY = THIS_BLK_ARC_LIST_KEY(I);
     2121    25962    5            END;
     2122    25963
     2123    25964        /***
     2124    25965         *** If last input file is not complete, prevent its' fit from being updated.
     2125    25966         *** This may occur when file continues on next volume but the next volume was
     2126    25967         *** not specified by the user as source input on an I/O error.
     2127    25968         ***/
     2128    25969    4         IF ADDR(FILE_FIN) ~= ADDR(NIL) AND NOT FILE_FIN
     2129    25970    5          THEN DO;
     2130    25971    5            LAST_BLK_ARC_LIST_REC.NEW.REEL = ' ';
     2131    25972    5            LAST_BLK_ARC_LIST_REC.NEW.FSN = 0;
     2132    25973    5            WRITE_ARC_LIST_BY_KEY.KEY_ = VECTOR(LAST_BLK_ARC_LIST_KEY);
     2133    25974    5            WRITE_ARC_LIST_BY_KEY.BUF_ = VECTOR(LAST_BLK_ARC_LIST_REC);
     2134    25975    5            CALL M$WRITE( WRITE_ARC_LIST_BY_KEY ) ALTRET( JUSTALT );
     2135    25976    5            END;
     2136    25977
     2137    25978    4         IF OD_DEST    /* Save last OD serial number to detect ser. num. change  */
     2138    25979    4          THEN LAST_TSN_USED = TAPE_DCBLIST.DCB$(0)->F$DCB.PSN#;
     2139    25980
     2140    25981    4         NEW_TSN = ' ';
     2141    25982    4         NEW_FSN = 0;
     2142    25983    4         CALL FLI$TAPE_WRITE( BUF_, ARS, EOVOL, %COMPACT, NEW_TSN, NEW_FSN ) ALTRET(
             25983                  NO_RPT_ERR );
     2143    25984        /***
     2144    25985         *** If IOERR CONT set and I-O error encountered, the previous block may have
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:62   
     2145    25986         *** been moved to the next tape by FLI$TAPE_WRITE in order to continue.
     2146    25987         *** Modify previous and current block in *ARC_LIST to reflect the new SN and FSN.
     2147    25988         ***/
     2148    25989    4         IF NEW_TSN ~= ' '
     2149    25990    5          THEN DO;
     2150    25991    6            DO I = 0 TO NBR_IN_PREV_OUT_BLK - 1; /* Previous block               */
     2151    25992    6               PREV_BLK_ARC_LIST_REC.NEW.REEL(I) = NEW_TSN;
     2152    25993    6               PREV_BLK_ARC_LIST_REC.NEW.FSN(I) = NEW_FSN;
     2153    25994    6               WRITE_ARC_LIST_BY_KEY.KEY_ = VECTOR(PREV_BLK_ARC_LIST_KEY(I));
     2154    25995    6               WRITE_ARC_LIST_BY_KEY.BUF_ = VECTOR(PREV_BLK_ARC_LIST_REC(I));
     2155    25996    6               CALL M$WRITE( WRITE_ARC_LIST_BY_KEY ) ALTRET( JUSTALT );
     2156    25997    6               END;
     2157    25998
     2158    25999    6            DO I = 0 TO NBR_IN_OUT_BLK - 1; /* Current block                     */
     2159    26000    6               IF (I = NBR_IN_OUT_BLK - 1  /* Last file incomplete?              */
     2160    26001    6                 AND  ADDR(FILE_FIN) ~= ADDR(NIL)
     2161    26002    6                 AND NOT FILE_FIN)
     2162    26003    7                THEN DO;
     2163    26004    7                  THIS_BLK_ARC_LIST_REC.NEW.REEL(I) = ' ';
     2164    26005    7                  THIS_BLK_ARC_LIST_REC.NEW.FSN(I) = 0;
     2165    26006    7                  END;
     2166    26007    7                ELSE DO;
     2167    26008    7                  THIS_BLK_ARC_LIST_REC.NEW.REEL(I) = NEW_TSN;
     2168    26009    7                  THIS_BLK_ARC_LIST_REC.NEW.FSN(I) = NEW_FSN;
     2169    26010    7                  END;
     2170    26011    6               WRITE_ARC_LIST_BY_KEY.KEY_ = VECTOR(THIS_BLK_ARC_LIST_KEY(I));
     2171    26012    6               WRITE_ARC_LIST_BY_KEY.BUF_ = VECTOR(THIS_BLK_ARC_LIST_REC(I));
     2172    26013    6               CALL M$WRITE( WRITE_ARC_LIST_BY_KEY ) ALTRET( JUSTALT );
     2173    26014    6               END;
     2174    26015    5            END;
     2175    26016
     2176    26017        /***
     2177    26018         *** Add key names to *FSN_LIST (list of files for current FSN whose fits are to
     2178    26019         *** be updated.
     2179    26020         ***/
     2180    26021    4         IF ARCOM_OPTIONS.IMMUPDATE
     2181    26022    5          THEN DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:63   
     2182    26023    6            DO I = 0 TO NBR_IN_OUT_BLK - 1;
     2183    26024    6               WRITE_FSN_LIST.BUF_ = VECTOR(THIS_BLK_ARC_LIST_KEY(I));
     2184    26025    6               CALL M$WRITE( WRITE_FSN_LIST ) ALTRET( JUSTALT );
     2185    26026    6               END;
     2186    26027    5            END;
     2187    26028
     2188    26029    4         NBR_FILE_BLOCKS = NBR_FILE_BLOCKS + 1;
     2189    26030
     2190    26031    4         IF EOVOL
     2191    26032    5          THEN DO;
     2192    26033    5            CROSSED = '*';
     2193    26034    5            CALL FLI$TAPE_CLOSE( '1'B /* CVOL */ ) ALTRET( JUSTALT );
     2194    26035    5            CALL FLI$TAPE_OPEN( VECTOR(EFT_CVOL_FILE), SN, FSN, '0'B, '1'B, , A_FIT_,
             26035                     ERR, DCB# )
     2195    26036    6             WHENALTRETURN DO;
     2196    26037    6   REPALT:     ;
     2197    26038    6               CALL FLI$RPT_ERR( ERR, DCB# );
     2198    26039    6               RPT_ERR = '0'B;
     2199    26040    6               ALTRETURN;
     2200    26041    6               END;
     2201    26042    5            CALL FLI$TAPE_WRITE( BUF_, ARS, EOVOL, %COMPACT, NEW_TSN, NEW_FSN ) ALTRET(
             26042                     NO_RPT_ERR );
     2202    26043                                                /* Second write forces volume change  */
     2203    26044    5            CALL FLI$TAPE_WRITE( BUF_, ARS, EOVOL, %COMPACT, NEW_TSN, NEW_FSN ) ALTRET(
             26044                     NO_RPT_ERR );
     2204    26045        /***
     2205    26046         *** If specified, list the files and update their fits immediately for this FSN.
     2206    26047         *** If last file was completely moved to output buffer(at least one to update)
     2207    26048         *** or there are other files that were already moved for this FSN, update
     2208    26049         *** the fits.
     2209    26050         ***/
     2210    26051
     2211    26052    5            IF ARCOM_OPTIONS.IMMUPDATE
     2212    26053    6             THEN DO;
     2213    26054    6               IF OUT_BLK_TAG.FIN          /* Entire file in output buffer       */
     2214    26055    7                THEN DO;
     2215    26056    7                  CALL FLX_UPDATE_ARC_FILES ALTRET( JUSTALT );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:64   
     2216    26057    7                  END;
     2217    26058    7                ELSE DO;
     2218    26059        /***
     2219    26060         *** Partial file in output buffer so delete last key name from *FSN_LIST
     2220    26061         *** temporarily so file's fit does not get updated until file has been completely
     2221    26062         *** copied to its' destination.
     2222    26063         ***/
     2223    26064    7                  CALL M$PRECORD( PRECORD_FSN_LIST ) ALTRET( JUSTALT );
     2224    26065    7                  CALL M$DELREC( DELREC_FSN_LIST ) ALTRET( JUSTALT );
     2225    26066    7                  CALL FLX_UPDATE_ARC_FILES  ALTRET(JUSTALT);
     2226    26067    7                  WRITE_FSN_LIST.BUF_ = VECTOR( LAST_BLK_ARC_LIST_KEY );
     2227    26068    7                  CALL M$WRITE( WRITE_FSN_LIST ) ALTRET( JUSTALT ); /* Add key name */
     2228    26069    7                  END;
     2229    26070    6               END;
     2230    26071
     2231    26072    5            CALL FLI$TAPE_CLOSE ALTRET( JUSTALT );
     2232    26073    5            CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), SN, FSN, '0'B, '1'B, ,
             26073                     A_FIT_, ERR, DCB# ) ALTRET( REPALT );
     2233    26074    5            PREV_REEL = SN;
     2234    26075    5            NBR_FILE_BLOCKS = 0;
     2235    26076    5            END;
     2236    26077
     2237    26078    4         IF OD_DEST AND LAST_TSN_USED ~= ' ' /* Check if file crossed OD boundries */
     2238    26079    5          THEN DO;
     2239    26080    5            IF LAST_TSN_USED ~= TAPE_DCBLIST.DCB$(0)->F$DCB.PSN#
     2240    26081    5             THEN CROSSED = '*';
     2241    26082    5            END;
     2242    26083        /***
     2243    26084         *** Must save previous block data in case files in that block were recopied
     2244    26085         *** to the next volume on an I-O error when IOERR CONT spec'd by user.
     2245    26086         ***/
     2246    26087    4         NBR_IN_PREV_OUT_BLK = NBR_IN_OUT_BLK;
     2247    26088    5         DO I = 0 TO NBR_IN_OUT_BLK - 1;
     2248    26089    5            PREV_BLK_ARC_LIST_KEY(I) = THIS_BLK_ARC_LIST_KEY(I);
     2249    26090    5            PREV_BLK_ARC_LIST_REC(I) = THIS_BLK_ARC_LIST_REC(I);
     2250    26091    5            END;
     2251    26092
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:65   
     2252    26093    4         NBR_IN_OUT_BLK = 0;
     2253    26094    4         NEW_BLOCK = '1'B;
     2254    26095
     2255    26096    4         END;
     2256    26097
     2257    26098         /***
     2258    26099          *** Set up initial output block tag if new block or new file.
     2259    26100          ***/
     2260    26101
     2261    26102    3      IF NEW_BLOCK
     2262    26103    4       THEN DO;
     2263    26104    4         OUT_GRAN$ = PINCRW( OUT_GRAN_BASE$, -1024 );
     2264    26105    4         OUT_GRANX = 0;
     2265    26106    4         OUT_BLK_TAG0 = IN_BLK_TAG0;
     2266    26107    4         OUT_BLK_TAG$ = PINCRW( OUT_BLK_TAG0$, -SIZEW(OUT_BLK_TAG) );
     2267    26108    4         OUT_BLK_TAG_IX = 1;
     2268    26109    4         END;
     2269    26110    4       ELSE DO;
     2270    26111    4         OUT_BLK_TAG$ = PINCRW( OUT_BLK_TAG$, -SIZEW(OUT_BLK_TAG) );
     2271    26112    4         OUT_BLK_TAG_IX = OUT_BLK_TAG_IX + 1;
     2272    26113    4         END;
     2273    26114
     2274    26115    3      IF NEW_FILE OR NEW_BLOCK
     2275    26116    4       THEN DO;
     2276    26117    4         OUT_BLK_TAG = IN_BLK_TAG;
     2277    26118    4         OUT_BLK_TAG.BEG = '0'B;
     2278    26119    4         OUT_BLK_TAG.FIN = '0'B;
     2279    26120    4         OUT_BLK_TAG.SIZE = 0;
     2280    26121    4         OUT_BLK_TAG.BEGX = 0;
     2281    26122    4         OUT_BLK_TAG.NBR = OUT_BLK_TAG_IX;
     2282    26123    4         END;
     2283    26124
     2284    26125    3      RETURN;
     2285    26126
     2286    26127    3   NO_RPT_ERR: ;
     2287    26128    3      RPT_ERR = '0'B;
     2288    26129
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:66   
     2289    26130    3   JUSTALT: ;
     2290    26131    3      ALTRETURN;
     2291    26132
     2292    26133    3   END FLX_CHECK_CURRENT_GRAN;
     2293    26134        /******************************/
     2294    26135    2   FLX_ADD_ANOTHER_GRAN: PROC ALTRET;
     2295    26136        /*F*  NAME: FLX_ADD_ANOTHER_GRAN
     2296    26137              PURPOSE: Add current input block granule to output block.
     2297    26138        */
     2298    26139
     2299    26140        /********************/
     2300    26141
     2301    26142        /***
     2302    26143         *** Note that OUT_GRAN$ points to the beginning of a granule which has already
     2303    26144         *** been filled with data. For the first granule of a block, it is reserved
     2304    26145         *** for block tags.
     2305    26146         ***/
     2306    26147    3      IF PINCRW( OUT_GRAN$, 1024 ) >= OUT_GRAN_MAX$
     2307    26148    3       THEN CALL FLX_CHECK_CURRENT_GRAN( '1'B ) ALTRET( JUSTALT );
     2308    26149
     2309    26150    3      OUT_GRANX = OUT_GRANX + 4096;
     2310    26151    3      OUT_GRAN$ = PINCRW( OUT_GRAN$, 1024 );
     2311    26152
     2312    26153    3      OUT_GRAN = IN_GRAN;
     2313    26154
     2314    26155    3      IN_GRAN$ = PINCRW( IN_GRAN$, 1024 );
     2315    26156
     2316    26157    3      OUT_BLK_TAG.SIZE = OUT_BLK_TAG.SIZE + 4096;
     2317    26158
     2318    26159    3      NEW_BLOCK = '0'B;                    /* Not a new block anymore            */
     2319    26160
     2320    26161    3      RETURN;
     2321    26162
     2322    26163    3   JUSTALT: ;
     2323    26164    3      ALTRETURN;
     2324    26165
     2325    26166    3   END FLX_ADD_ANOTHER_GRAN;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:67   
     2326    26167        /******************************/
     2327    26168    2   FLX_REPORT_PARTIAL_FILE: PROC;
     2328    26169        /*F*  NAME: FLX_REPORT_PARTIAL_FILE
     2329    26170              PURPOSE: Reports an I/O error and the name of the partial file which
     2330    26171                 could not be read completely.
     2331    26172        */
     2332    26173        /******************************/
     2333    26174
     2334    26175        /***
     2335    26176         *** AUTO
     2336    26177         ***/
     2337    26178
     2338    26179
     2339    26180        %VLP_NAME( FPTN=ACCT_NAME,
     2340    26181                   LEN=8,
     2341    26182                   STCLASS=AUTO);
     2342    26209
     2343    26210
     2344    26211    3      ACCT_NAME.L# = LENGTHC(ACCT_NAME.NAME#);
     2345    26212    3      ACCT_NAME.NAME# = IN_BLK_TAG0.WHERE.ACCT;
     2346    26213    3      CALL XUR$ERRMSG( E_INCOMPLETE_FILE_ARCH, , ,VECTOR(IN_BLK_TAG.NAME),
     2347    26214    3        VECTOR(ACCT_NAME), , );
     2348    26215
     2349    26216    3      RETURN;
     2350    26217
     2351    26218    3   END FLX_REPORT_PARTIAL_FILE;
     2352    26219        /******************************/
     2353    26220    2   FLX_REMOVE_VOL: PROC;
     2354    26221        /*F*  NAME: FLX_REMOVE_VOL
     2355    26222              PURPOSE: Removes the current volume from the drive and removes the
     2356    26223                 serial number from the serial number list.
     2357    26224        */
     2358    26225        /******************************/
     2359    26226
     2360    26227        /***
     2361    26228         *** AUTO
     2362    26229         ***/
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:68   
     2363    26230
     2364    26231
     2365    26232    3   DCL NIX SBIN AUTO;
     2366    26233
     2367    26234
     2368    26235    3      REM_LT.V.PSN# = M$TAPE_SOURCE$->F$DCB.PSN#;
     2369    26236    3      CALL M$REM( REM_LT )
     2370    26237    4       WHENALTRETURN DO;
     2371    26238    4         END;
     2372    26239    3      NIX = 0;
     2373    26240    4      DO I=M$TAPE_SOURCE$->F$DCB.VOL# TO FROM_SN_LIST.NUM#-1;
     2374    26241    4         FROM_SN_LIST.SN#(NIX) = FROM_SN_LIST.SN#(I);
     2375    26242    4         NIX = NIX + 1;
     2376    26243    4         END;
     2377    26244    3      FROM_SN_LIST.NUM# = NIX;
     2378    26245
     2379    26246    3      RETURN;
     2380    26247
     2381    26248    3   END FLX_REMOVE_VOL;
     2382    26249
     2383    26250    2   END FLX_MAKE_NEW_ARCHIVE_TAPES;
     2384    26251        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:69   
     2385    26252    1   FLX_UPDATE_ARC_FILES: PROC ALTRET;
     2386    26253        /*F*  NAME: FLX_UPDATE_ARC_FILES
     2387    26254              PURPOSE: Update archived files with new information from the archive
     2388    26255                 list for the current FSN (files named in *FSN_LIST ) if immediate
     2389    26256                 archiving is specified. Otherwise all files in *ARC_LIST are
     2390    26257                 processed.
     2391    26258        */
     2392    26259
     2393    26260         /***
     2394    26261          *** STATIC
     2395    26262          ***/
     2396    26263
     2397    26264    2   DCL 1 ARC_LIST_REC ALIGNED STATIC,
     2398    26265              %ARC_LIST_REC;
     2399    26274
     2400    26275    2   DCL 1 ARC_LIST_KEY ALIGNED STATIC,
     2401    26276              %ARC_LIST_KEY;
     2402    26284
     2403    26285        /***
     2404    26286         *** FPTS
     2405    26287         ***/
     2406    26288
     2407    26289        %FPT_OPEN( FPTN=OPEN_ARC_LIST_FSN,
     2408    26290                   DCB=M$ARC_LIST2,
     2409    26291                   FUN=IN,
     2410    26292                   SHARE=ALL,
     2411    26293                   NAME=ARC_LIST_NAME,
     2412    26294                   ASN=FILE,
     2413    26295                   ACS=DIRECT,
     2414    26296                   STCLASS=CONSTANT );
     2415    26405
     2416    26406        %FPT_CLOSE( FPTN=CLOSE_ARC_LIST_FSN,
     2417    26407                    DCB=M$ARC_LIST2,
     2418    26408                    DISP=SAVE,
     2419    26409                    STCLASS=CONSTANT );
     2420    26451
     2421    26452        %FPT_READ( FPTN=READ_ARC_LIST_FSN,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:70   
     2422    26453                   DCB=M$ARC_LIST2,
     2423    26454                   KEY=ARC_LIST_KEY,
     2424    26455                   KEYR=YES,
     2425    26456                   BUF=ARC_LIST_REC,
     2426    26457                   WAIT=YES,
     2427    26458                   STCLASS=STATIC );
     2428    26497
     2429    26498        %VLP_SN( FPTN=NEW_TAPE_SN,
     2430    26499                 N=1,
     2431    26500                 STCLASS=STATIC );
     2432    26513
     2433    26514        /***
     2434    26515         *** AUTO
     2435    26516         ***/
     2436    26517
     2437    26518
     2438    26519
     2439    26520    2      OPEN_ARC_FILE.FPARAM_ = FPARAM_;
     2440    26521
     2441    26522    2      CALL M$OPEN( OPEN_ARC_LIST_FSN ) ALTRET( RPT_ERR_CLOSE );
     2442    26523
     2443    26524    2      IF NOT ARCOM_OPTIONS.IMMUPDATE
     2444    26525    3       THEN DO;                            /* Process all files                  */
     2445    26526    3         READ_ARC_LIST_FSN.V.KEYS# = '0'B;
     2446    26527    3         READ_ARC_LIST_FSN.V.KEYR# = '1'B;
     2447    26528    3         END;
     2448    26529    3       ELSE DO;
     2449    26530    3         READ_ARC_LIST_FSN.V.KEYS# = '1'B;
     2450    26531    3         READ_ARC_LIST_FSN.V.KEYR# = '0'B;
     2451    26532    3         CALL M$PFIL( PFIL_FSN_LIST ) ALTRET(RPT_ERR_CLOSE );
     2452    26533    3         READ_FSN_LIST.BUF_ = VECTOR(ARC_LIST_KEY);
     2453    26534    3         END;
     2454    26535
     2455    26536    3      DO WHILE('1'B);
     2456    26537
     2457    26538    3         IF ARCOM_OPTIONS.IMMUPDATE
     2458    26539    4          THEN DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:71   
     2459    26540    4            CALL M$READ( READ_FSN_LIST )   /* Get next key from *FSN_LIST        */
     2460    26541    5             WHENALTRETURN DO;
     2461    26542    5               IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF
     2462    26543    5                THEN GOTO RPT_ERR_CLOSE;
     2463    26544    5               CALL M$CLOSE( CLOSE_ARC_LIST_FSN )
     2464    26545    6                WHENALTRETURN DO;
     2465    26546    6                  CALL FLI$RPT_ERR;
     2466    26547    6                  END;
     2467    26548    5               CALL M$PFIL( PFIL_FSN_LIST ) ALTRET( RPT_ERR_CLOSE );
     2468    26549    5               RETURN;                     /* All done with this FSN             */
     2469    26550    5               END;
     2470    26551    4            END;
     2471    26552
     2472    26553    3         CALL M$READ( READ_ARC_LIST_FSN )
     2473    26554    4          WHENRETURN DO;
     2474    26555    4            ARC_FILE_NAME.NAME# = ARC_LIST_KEY.C.FNAMEC;
     2475    26556    4            ARC_FILE_NAME.L# = ARC_LIST_KEY.C.FNAMEL;
     2476    26557    4            ARC_FILE_ACCT.ACCT# = ARC_LIST_KEY.C.ACCT;
     2477    26558    4            ARC_FILE_SN.SN#(0) = ARC_LIST_KEY.C.PSN;
     2478    26559
     2479    26560    4            IF ARC_LIST_REC.NEW.REEL ~= ' '
     2480    26561    5             THEN DO;
     2481    26562    5               CALL M$OPEN( OPEN_ARC_FILE ) /* Update the fits and list files    */
     2482    26563    6                WHENRETURN DO;
     2483    26564    6                  IF M$ARC_FILE$->F$DCB.DESC.DELF#
     2484    26565    6                   THEN CODE06$ = FPARAM_.PTR$;
     2485    26566    6                   ELSE CODE06$ = PINCRW( FPARAM_.PTR$, SIZEW(FM$GRAN) );
     2486    26567    6                  CALL XSF$LOCCODP( CODE06$, 06 )
     2487    26568    7                   WHENRETURN DO;
     2488    26569    7                     NEW_TAPE_SN.SN#(0) = ARC_LIST_REC.NEW.REEL;
     2489    26570    7                     EFTWORD = '0'B;
     2490    26571    7                     IF OD_DEST
     2491    26572    8                      THEN DO;
     2492    26573    8                        CLOSE_ARC_FILE.V.DESC.ODSTOW# = '1'B; /* Archvd. to op dsk */
     2493    26574    8                        EFTWORDEXPIRE = ARC_LIST_REC.NEW.FSN;
     2494    26575    8                        END;
     2495    26576    8                      ELSE DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:72   
     2496    26577    8                        CLOSE_ARC_FILE.V.DESC.ODSTOW# = '0'B; /* Archvd. to tape */
     2497    26578    8                        EFTWORD.FSN = ARC_LIST_REC.NEW.FSN;
     2498    26579    8                        END;
     2499    26580    7                     CLOSE_ARC_FILE.V.EXPIRE# = EFTWORDEXPIRE;
     2500    26581    7                     CLOSE_ARC_FILE.V.EFTOPER = '0'B;
     2501    26582    7                     IF M$ARC_FILE$->F$DCB.DESC.DELF#
     2502    26583    8                      THEN DO;             /* Inactively archived                */
     2503    26584    8                        CLOSE_ARC_FILE.V.EFTOPER.DELFDE# = %YES#;
     2504    26585    8                        CALL M$CLOSE( CLOSE_ARC_FILE )
     2505    26586    9                         WHENALTRETURN DO;
     2506    26587    9                           CALL FLI$RPT_ERR;
     2507    26588    9                           END;
     2508    26589    8                        OPEN_ARC_FILE.V.FUN# = %CREATE#;
     2509    26590    8                        OPEN_ARC_FILE.V.ACS# = %SEQUEN#;
     2510    26591    8                        CALL M$OPEN( OPEN_ARC_FILE )
     2511    26592    9                         WHENRETURN DO;
     2512    26593    9                           CLOSE_ARC_FILE.SN_ = VECTOR(NEW_TAPE_SN);
     2513    26594    9                           CLOSE_ARC_FILE.V.EFTOPER = '0'B;
     2514    26595    9                           CLOSE_ARC_FILE.V.EFTOPER.ASTOW# = %YES#;
     2515    26596    9                           CLOSE_ARC_FILE.V.DESC = CLOSE_ARC_FILE.V.DESC |
     2516    26597    9                             M$ARC_FILE$->F$DCB.DESC;
     2517    26598    9                           CLOSE_ARC_FILE.V.EFTOPER.UPDDESC# = %YES#;
     2518    26599    9                           CALL M$CLOSE( CLOSE_ARC_FILE )
     2519    26600   10                            WHENALTRETURN DO;
     2520    26601   10                              CALL FLI$RPT_ERR;
     2521    26602   10                              END;
     2522    26603    9                           END;
     2523    26604    9                         WHENALTRETURN DO;
     2524    26605    9                           CALL FLI$RPT_ERR;
     2525    26606    9                           END;
     2526    26607    8                        OPEN_ARC_FILE.V.FUN# = %IN#;
     2527    26608    8                        OPEN_ARC_FILE.V.ACS# = %BLOCK#;
     2528    26609    8                        CALL M$OPEN( OPEN_ARC_FILE )
     2529    26610    9                         WHENALTRETURN DO;
     2530    26611    9                           CALL FLI$RPT_ERR;
     2531    26612    9                           END;
     2532    26613    8                        CLOSE_ARC_FILE.SN_ = VECTOR(NIL);
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:73   
     2533    26614    8                        CLOSE_ARC_FILE.V.EFTOPER = '0'B;
     2534    26615    8                        CLOSE_ARC_FILE.V.EFTOPER.ISTOW# = %YES#;
     2535    26616    8                        END;
     2536    26617    8                      ELSE DO;
     2537    26618    8                        CLOSE_ARC_FILE.V.EFTOPER.ASTOW# = %YES#;
     2538    26619    8                        CLOSE_ARC_FILE.SN_ = VECTOR(NEW_TAPE_SN);
     2539    26620    8                        CLOSE_ARC_FILE.V.DESC = CLOSE_ARC_FILE.V.DESC |
     2540    26621    8                          M$ARC_FILE$->F$DCB.DESC;
     2541    26622    8                        CLOSE_ARC_FILE.V.EFTOPER.UPDDESC# = %YES#;
     2542    26623    8                        END;
     2543    26624    7                     END;
     2544    26625    6                  CALL M$CLOSE( CLOSE_ARC_FILE )
     2545    26626    7                   WHENRETURN DO;
     2546    26627    7                     OPEN_ARC_FILE.V.OPER.TEST# = '1'B;
     2547    26628    7                     CALL M$OPEN( OPEN_ARC_FILE )
     2548    26629    8                      WHENALTRETURN DO;
     2549    26630    8                        CALL FLI$RPT_ERR;
     2550    26631    8                        END;
     2551    26632    7                     OPEN_ARC_FILE.V.OPER.TEST# = '0'B;
     2552    26633    7                     NBRFAS_FOUND_UPDATED = NBRFAS_FOUND_UPDATED + 1;
     2553    26634    7                     TEMP = ARC_LIST_REC.NEW.FSN;
     2554    26635    7                     CALL FLP$WR_FILE_INFO( M$ARC_FILE$, FPARAM_.PTR$,
     2555    26636    7                       ARC_LIST_REC.NEW.REEL, TEMP, ' ', , 0, '1'B, '0'B  )
     2556    26637    7                       ALTRET( ERR_CLOSE );
     2557    26638    7                     END;
     2558    26639    7                   WHENALTRETURN DO;
     2559    26640    7                     NBRFAS_FOUND_UNUPDATED = NBRFAS_FOUND_UNUPDATED + 1;
     2560    26641    7                     CALL FLI$RPT_ERR;
     2561    26642    7                     END;
     2562    26643    6                  CLOSE_ARC_FILE.V.EFTOPER = '0'B;
     2563    26644    6                  END;
     2564    26645    6                WHENALTRETURN DO;
     2565    26646    6                  CALL FLI$RPT_ERR;
     2566    26647    6                  END;
     2567    26648    5               END;
     2568    26649    5             ELSE DO;                      /* Not on new reel                    */
     2569    26650    5               END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:74   
     2570    26651    4            END;
     2571    26652    4          WHENALTRETURN DO;
     2572    26653    4            IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF
     2573    26654    4             THEN GOTO RPT_ERR_CLOSE;
     2574    26655    4            CALL M$CLOSE( CLOSE_ARC_LIST_FSN )
     2575    26656    5             WHENALTRETURN DO;
     2576    26657    5               CALL FLI$RPT_ERR;
     2577    26658    5               END;
     2578    26659
     2579    26660    4            IF M$FSN_LIST$->F$DCB.FCD#
     2580    26661    5             THEN DO;
     2581    26662    5               CALL M$CLOSE( CLOSE_FSN_LIST )
     2582    26663    6                WHENALTRETURN DO;
     2583    26664    6                  CALL FLI$RPT_ERR;
     2584    26665    6                  END;
     2585    26666    5               END;
     2586    26667
     2587    26668    4            RETURN;
     2588    26669    4            END;
     2589    26670    3         END;                              /* DO WHILE loop                      */
     2590    26671
     2591    26672    2   RPT_ERR_CLOSE:
     2592    26673    2      CALL FLI$RPT_ERR;
     2593    26674
     2594    26675    2   ERR_CLOSE: ;
     2595    26676    2      IF M$ARC_LIST2$->F$DCB.FCD#
     2596    26677    3       THEN DO;
     2597    26678    3         CALL M$CLOSE( CLOSE_ARC_LIST_FSN )
     2598    26679    4          WHENALTRETURN DO;
     2599    26680    4            CALL FLI$RPT_ERR;
     2600    26681    4            END;
     2601    26682    3         END;
     2602    26683
     2603    26684    2      IF M$FSN_LIST$->F$DCB.FCD#
     2604    26685    3       THEN DO;
     2605    26686    3         CALL M$CLOSE( CLOSE_FSN_LIST )
     2606    26687    4          WHENALTRETURN DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:75   
     2607    26688    4            CALL FLI$RPT_ERR;
     2608    26689    4            END;
     2609    26690    3         END;
     2610    26691
     2611    26692    2      ALTRETURN;
     2612    26693    2   END FLX_UPDATE_ARC_FILES;
     2613    26694        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:76   
     2614    26695    1   FLX_OUTPUT_SUMMARY: PROC ALTRET;
     2615    26696        /*F*  NAME: FLX_OUTPUT_SUMMARY
     2616    26697              PURPOSE: Output summary of archived files and update the :ARCHIVE.$$EFT
     2617    26698                 record for the packset(s).
     2618    26699        */
     2619    26700
     2620    26701         /***
     2621    26702          *** AUTO
     2622    26703          ***/
     2623    26704
     2624    26705    2   DCL NBRFAS SBIN AUTO;
     2625    26706    2   DCL NBRFAS_FOUND SBIN AUTO;
     2626    26707    2   DCL NBRFAS_UNFOUND SBIN AUTO;
     2627    26708
     2628    26709    2   DCL NBRFOT SBIN AUTO;
     2629    26710    2   DCL NBRFOT_UNUNIQUE SBIN AUTO;
     2630    26711    2   DCL NBRFOT_UNIQUE SBIN AUTO;
     2631    26712    2   DCL NBRFOT_UNIQUE_FOUND SBIN AUTO;
     2632    26713    2   DCL NBRFOT_UNIQUE_UNFOUND SBIN AUTO;
     2633    26714    2   DCL DPSIZE SBIN AUTO;
     2634    26715    2   DCL SNSIZE SBIN AUTO;
     2635    26716    2   DCL VOL# SBIN AUTO;
     2636    26717    2   DCL SIZE SBIN AUTO;
     2637    26718    2   DCL FIRST$ PTR AUTO;                    /* First tape/optical disk spec'd     */
     2638    26719    2   DCL SECND$ PTR AUTO;                    /* Second tape/optical disk spec'd    */
     2639    26720
     2640    26721        /***
     2641    26722         *** FPTs/VLPs
     2642    26723         ***/
     2643    26724
     2644    26725        %VLP_SN( FPTN=BASED_SN,
     2645    26726                 STCLASS=BASED );
     2646    26739
     2647    26740        /****************************************/
     2648    26741
     2649    26742
     2650    26743         /***
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:77   
     2651    26744          *** Initialize for updating.
     2652    26745          ***/
     2653    26746
     2654    26747    2      NBRFAS = 0;
     2655    26748    2      NBRFAS_FOUND = 0;
     2656    26749    2      NBRFAS_UNFOUND = 0;
     2657    26750
     2658    26751    2      NBRFOT = 0;
     2659    26752    2      NBRFOT_UNUNIQUE = 0;
     2660    26753    2      NBRFOT_UNIQUE = 0;
     2661    26754    2      NBRFOT_UNIQUE_FOUND = 0;
     2662    26755    2      NBRFOT_UNIQUE_UNFOUND = 0;
     2663    26756
     2664    26757
     2665    26758    2      CALL M$OPEN( OPEN_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );
     2666    26759    2      CALL FLP$WR_FILE_INFO ALTRET( ERR_CLOSE );
     2667    26760
     2668    26761    3      DO WHILE('1'B);
     2669    26762
     2670    26763    3         CALL M$READ( READ_ARC_LIST )
     2671    26764    4          WHENRETURN DO;
     2672    26765    4            ARC_FILE_NAME.NAME# = ARC_LIST_KEY.C.FNAMEC;
     2673    26766    4            ARC_FILE_NAME.L# = ARC_LIST_KEY.C.FNAMEL;
     2674    26767    4            ARC_FILE_ACCT.ACCT# = ARC_LIST_KEY.C.ACCT;
     2675    26768    4            ARC_FILE_SN.SN#(0) = ARC_LIST_KEY.C.PSN;
     2676    26769
     2677    26770    4            IF ARC_LIST_REC.REEL ~= ' ' OR ARC_LIST_REC.FSN ~= 0
     2678    26771    4             THEN NBRFAS = NBRFAS + 1;
     2679    26772    4            NBRFOT = NBRFOT + ARC_LIST_REC.NBR_ON_TAPE;
     2680    26773    4            IF ARC_LIST_REC.NBR_ON_TAPE = 0
     2681    26774    4             THEN NBRFAS_UNFOUND = NBRFAS_UNFOUND + 1;
     2682    26775    5             ELSE DO;
     2683    26776    5               NBRFOT_UNIQUE = NBRFOT_UNIQUE + 1;
     2684    26777    5               IF ARC_LIST_REC.NEW.REEL ~= ' '
     2685    26778    5                THEN NBRFOT_UNIQUE_FOUND = NBRFOT_UNIQUE_FOUND + 1;
     2686    26779    5                ELSE NBRFOT_UNIQUE_UNFOUND = NBRFOT_UNIQUE_UNFOUND + 1;
     2687    26780    5               NBRFOT_UNUNIQUE = NBRFOT_UNUNIQUE + ARC_LIST_REC.NBR_ON_TAPE - 1;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:78   
     2688    26781    5               END;
     2689    26782
     2690    26783    4            IF ARC_LIST_REC.NEW.REEL ~= ' '
     2691    26784    5             THEN DO;
     2692    26785    5               NBRFAS_FOUND = NBRFAS_FOUND + 1;
     2693    26786    5               END;
     2694    26787    5             ELSE DO;                      /* Not on new reel                    */
     2695    26788    5               END;
     2696    26789    4            END;
     2697    26790    4          WHENALTRETURN DO;
     2698    26791    4            IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF
     2699    26792    4             THEN CALL FLI$RPT_ERR;
     2700    26793    4            CALL M$CLOSE( CLOSE_ARC_LIST )
     2701    26794    5             WHENALTRETURN DO;
     2702    26795    5               CALL FLI$RPT_ERR;
     2703    26796    5               END;
     2704    26797
     2705    26798    4            IF NOT ARCOM_OPTIONS.IMMUPDATE /* Update fits if not done already    */
     2706    26799    4             THEN CALL FLX_UPDATE_ARC_FILES ALTRET(ERR_CLOSE);
     2707    26800
     2708    26801    4            CALL M$DEVICE( PAGE_LO ) ALTRET( RPT_ERR_CLOSE );
     2709    26802    4            CALL FLX_ACC_LINE( 'Breakdown of archived files found on disk!' ) ALTRET(
             26802                     RPT_ERR_CLOSE );
     2710    26803    4            IF OD_DEST
     2711    26804    4             THEN
     2712    26805    4               CALL FLX_ACC_LINE( 'Re-archived on new optical disks!',
             26805                        NBRFAS_FOUND_UPDATED, 1 ) ALTRET( RPT_ERR_CLOSE );
     2713    26806    4             ELSE
     2714    26807    4               CALL FLX_ACC_LINE( 'Re-archived on new tapes!', NBRFAS_FOUND_UPDATED, 1
             26807                        ) ALTRET( RPT_ERR_CLOSE );
     2715    26808    4            IF NBRFAS_FOUND_UNUPDATED > 0
     2716    26809    5             THEN DO;
     2717    26810    5               IF OD_SOURCE
     2718    26811    5                THEN
     2719    26812    5                  CALL FLX_ACC_LINE( 'Still archived on old optical disks ***!',
             26812                           NBRFAS_FOUND_UNUPDATED, 1 ) ALTRET( RPT_ERR_CLOSE );
     2720    26813    5                ELSE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:79   
     2721    26814    5                  CALL FLX_ACC_LINE( 'Still archived on old tapes ***!',
             26814                           NBRFAS_FOUND_UNUPDATED, 1 ) ALTRET( RPT_ERR_CLOSE );
     2722    26815    5               STEPCC = 4;
     2723    26816    5               END;
     2724    26817    4            IF OD_SOURCE
     2725    26818    4             THEN
     2726    26819    4               CALL FLX_ACC_LINE( 'Found on old optical disks!', NBRFAS_FOUND, 2 )
             26819                        ALTRET( RPT_ERR_CLOSE );
     2727    26820    4             ELSE
     2728    26821    4               CALL FLX_ACC_LINE( 'Found on old tapes!', NBRFAS_FOUND, 2 ) ALTRET(
             26821                        RPT_ERR_CLOSE );
     2729    26822    4            IF NBRFAS_UNFOUND > 0
     2730    26823    5             THEN DO;
     2731    26824    5               IF OD_SOURCE
     2732    26825    5                THEN
     2733    26826    5                  CALL FLX_ACC_LINE( 'Not found on old optical disks ***!',
             26826                           NBRFAS_UNFOUND, 2 ) ALTRET( RPT_ERR_CLOSE );
     2734    26827    5                ELSE
     2735    26828    5                  CALL FLX_ACC_LINE( 'Not found on old tapes ***!', NBRFAS_UNFOUND, 2 )
             26828                           ALTRET( RPT_ERR_CLOSE );
     2736    26829    5               STEPCC = 4;
     2737    26830    5               END;
     2738    26831    4            CALL FLX_ACC_LINE( 'Archived files on disk!', NBRFAS, 3, '1'B ) ALTRET(
             26831                     RPT_ERR_CLOSE );
     2739    26832    4            IF OD_SOURCE
     2740    26833    4             THEN
     2741    26834    4               CALL FLX_ACC_LINE(
             26834                        'Breakdown of files found on old archive optical disks!' ) ALTRET(
             26834                        RPT_ERR_CLOSE );
     2742    26835    4             ELSE
     2743    26836    4               CALL FLX_ACC_LINE( 'Breakdown of files found on old archive tapes!' )
             26836                        ALTRET( RPT_ERR_CLOSE );
     2744    26837    4            IF OD_DEST
     2745    26838    4             THEN
     2746    26839    4               CALL FLX_ACC_LINE( 'Moved to new optical disks!', NBRFOT_UNIQUE_FOUND, 1
             26839                        ) ALTRET( RPT_ERR_CLOSE );
     2747    26840    4             ELSE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:80   
     2748    26841    4               CALL FLX_ACC_LINE( 'Moved to new tapes!', NBRFOT_UNIQUE_FOUND, 1 )
             26841                        ALTRET( RPT_ERR_CLOSE );
     2749    26842    4            IF OD_SOURCE
     2750    26843    4             THEN
     2751    26844    4               CALL FLX_ACC_LINE( 'Unarchived since old optical disks written!',
             26844                        NBRFOT_UNIQUE_UNFOUND, 1 ) ALTRET( RPT_ERR_CLOSE );
     2752    26845    4             ELSE
     2753    26846    4               CALL FLX_ACC_LINE( 'Unarchived since old tapes written!',
             26846                        NBRFOT_UNIQUE_UNFOUND, 1 ) ALTRET( RPT_ERR_CLOSE );
     2754    26847    4            IF OD_SOURCE
     2755    26848    4             THEN
     2756    26849    4               CALL FLX_ACC_LINE( 'Unique files on old optical disks!', NBRFOT_UNIQUE,
             26849                        2 ) ALTRET( RPT_ERR_CLOSE );
     2757    26850    4             ELSE
     2758    26851    4               CALL FLX_ACC_LINE( 'Unique files on old tapes!', NBRFOT_UNIQUE, 2 )
             26851                        ALTRET( RPT_ERR_CLOSE );
     2759    26852    4            IF OD_SOURCE
     2760    26853    4             THEN
     2761    26854    4               CALL FLX_ACC_LINE( 'Extraneous files on old optical disks!',
             26854                        NBRFOT_UNUNIQUE, 2 ) ALTRET( RPT_ERR_CLOSE );
     2762    26855    4             ELSE
     2763    26856    4               CALL FLX_ACC_LINE( 'Extraneous files on old tapes!', NBRFOT_UNUNIQUE, 2
             26856                        ) ALTRET( RPT_ERR_CLOSE );
     2764    26857    4            IF OD_SOURCE
     2765    26858    4             THEN
     2766    26859    4               CALL FLX_ACC_LINE( 'Files on old optical disks!', NBRFOT, 3, '1'B )
             26859                        ALTRET( RPT_ERR_CLOSE );
     2767    26860    4             ELSE
     2768    26861    4               CALL FLX_ACC_LINE( 'Files on old tapes!', NBRFOT, 3, '1'B ) ALTRET(
             26861                        RPT_ERR_CLOSE );
     2769    26862    4            IF NBRFAS_UNFOUND > 0
     2770    26863    4             THEN CALL FLX_ARC_LIST_ERROR_REPORT;
     2771    26864
     2772    26865    4            DPSIZE = (LENGTHC(DPLIST.NUM#) + DPLIST.NUM# * LENGTHC(DPLIST.SN#(0)) + 3)
             26865                     / 4;
     2773    26866    4            SNSIZE = (LENGTHC(BASED_SN.NUM#) + TAPE_SET$->BASED_SN.NUM# * LENGTHC(
             26866                     BASED_SN.SN#(0)) + 3) / 4;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:81   
     2774    26867    4            IF NBR_SNLISTS > 2
     2775    26868    4             THEN
     2776    26869    4               SIZE = DPSIZE + (2 * SNSIZE) + SIZEW(ARCHIVE_LIST);
     2777    26870    4             ELSE
     2778    26871    4               SIZE = DPSIZE + (NBR_SNLISTS * SNSIZE) + SIZEW(ARCHIVE_LIST);
     2779    26872    4            CALL FLI$ALLOC( SIZE, ARC_REC$ );
     2780    26873    4            ARC_REC$->ARCHIVE_LIST = '0'B;
     2781    26874    4            ARC_REC$->ARCHIVE_LIST.OPTION.DEN = M$TAPE00$->F$DCB.DENSITY#;
     2782    26875    4            ARC_REC$->ARCHIVE_LIST.OPTION.VOLA = M$TAPE00$->F$DCB.VOLACCESS#;
     2783    26876    4            ARC_REC$->ARCHIVE_LIST.OPTION.EXP = M$TAPE00$->F$DCB.EXPIRE#;
     2784    26877    4            ARC_REC$->ARCHIVE_LIST.OPTION.BLOCK = M$TAPE00$->F$DCB.BLKL#;
     2785    26878    4            ARC_REC$->ARCHIVE_LIST.OPTION.CHECK = OPTION_CHECK;
     2786    26879    4            ARC_REC$->ARCHIVE_LIST.OPTION.IOERRORC = OPTION_IOERRORC;
     2787    26880    4            ARC_REC$->ARCHIVE_LIST.VERSION.FLAG = BITBIN('777'O); /* Post-D00    */
     2788    26881    4            ARC_REC$->ARCHIVE_LIST.VERSION.SIZE = ADDR(B_VERSION)->B$VERSION.L#;
     2789    26882    4            ARC_REC$->ARCHIVE_LIST.VERSION.TEXT = SUBSTR(ADDR(B_VERSION)->B$VERSION.
             26882                     NAME#,0,ADDR(B_VERSION)->B$VERSION.L#);
     2790    26883    4            ARC_REC$->ARCHIVE_LIST.VOLUME = 0; /* Unused                         */
     2791    26884    4            ARC_REC$->ARCHIVE_LIST.XTEND = %YES#;
     2792    26885    4            ARC_REC$->ARCHIVE_LIST.OFFSET.DPLIST = SIZEW(ARCHIVE_LIST);
     2793    26886    4            IF OD_DEST
     2794    26887    4             THEN ARC_REC$->ARCHIVE_LIST.OD = '1'B;
     2795    26888    4             ELSE ARC_REC$->ARCHIVE_LIST.OD = '0'B;
     2796    26889    4            TEMP$ = PINCRW( ARC_REC$, ARC_REC$->ARCHIVE_LIST.OFFSET.DPLIST );
     2797    26890    4            TEMP$->DPLIST.NUM# = DPLIST.NUM#;
     2798    26891    5            DO I=0 TO DPLIST.NUM# - 1;
     2799    26892    5               TEMP$->DPLIST.SN#(I) = DPLIST.SN#(I);
     2800    26893    5               END;
     2801    26894    4            TEMP$ = PINCRW( TEMP$, DPSIZE);
     2802    26895    4            ARC_REC$->ARCHIVE_LIST.OFFSET.SNLIST = POFFW( TEMP$, ARC_REC$ );
     2803    26896    4            IF M$TAPE00$->F$DCB.VOL# = 0
     2804    26897    4             THEN
     2805    26898    4               VOL# = 0;
     2806    26899    4             ELSE
     2807    26900    4               VOL# = M$TAPE00$->F$DCB.VOL# - 1;
     2808    26901    4            TEMP$->BASED_SN.NUM# = TAPE_SET$->BASED_SN.NUM# - VOL#;
     2809    26902
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:82   
     2810    26903    4            FIRST$ = LAST_SNLISTINFO$;
     2811    26904    4            IF NBR_SNLISTS > 1 /* Get 1st and 2nd tapesets/optical disksets spec'd */
     2812    26905    4             THEN
     2813    26906    5            DO WHILE (FIRST$->SNLISTINFO.PREVINFO$ ~= ADDR(NIL));
     2814    26907    5               SECND$ = FIRST$;
     2815    26908    5               FIRST$ = FIRST$->SNLISTINFO.PREVINFO$;
     2816    26909    5               END;
     2817    26910
     2818    26911    4            TEMP = 0;
     2819    26912    5            DO I = VOL# TO FIRST$->SNLISTINFO.SNLIST$->BASED_SN.NUM# - 1;
     2820    26913    5               TEMP$->BASED_SN.SN#(TEMP) = FIRST$->SNLISTINFO.SNLIST$->BASED_SN.SN#(I);
     2821    26914    5               TEMP = TEMP + 1;
     2822    26915    5               END;
     2823    26916
     2824    26917    4            IF NBR_SNLISTS > 1        /* Move duplicate tape/optical disk set    */
     2825    26918    5             THEN DO;
     2826    26919    5               TEMP$ = PINCRW( TEMP$, SNSIZE);
     2827    26920    5               ARC_REC$->ARCHIVE_LIST.OFFSET.SNLIST2 = POFFW( TEMP$, ARC_REC$ );
     2828    26921    5               TEMP$->BASED_SN.NUM# = SECND$->SNLISTINFO.SNLIST$->BASED_SN.NUM# - VOL#;
     2829    26922    6               DO I = VOL# TO SECND$->SNLISTINFO.SNLIST$->BASED_SN.NUM# - 1;
     2830    26923    6                  TEMP$->BASED_SN.SN#(I) = SECND$->SNLISTINFO.SNLIST$->BASED_SN.SN#(I);
     2831    26924    6                  END;
     2832    26925    5               END;
     2833    26926
     2834    26927    4            ARC_REC_SIZE = SIZE;
     2835    26928    4            ARC_REC$->ARCHIVE_LIST.SIZE = SIZE;
     2836    26929    4            OPEN_ARCHIVE_EFT.V.FUN# = %CREATE#;
     2837    26930    4            OPEN_ARCHIVE_EFT.V.EXIST# = %NEWFILE#;
     2838    26931    5            DO I=0 TO DPLIST.NUM# - 1;
     2839    26932    5               DPSN.SN#(0) = DPLIST.SN#(I);
     2840    26933    5               CALL M$OPEN( OPEN_ARCHIVE_EFT )
     2841    26934    6                WHENRETURN DO;
     2842    26935    6                  WRITE_ARCHIVE_EFT.BUF_ = VECTOR(ARC_REC_SIZE);
     2843    26936    6                  CALL M$WRITE( WRITE_ARCHIVE_EFT ) ALTRET( CLSERR );
     2844    26937    6                  WRITE_ARCHIVE_EFT.BUF_.BOUND = ARC_REC_SIZE * 4 - 1;
     2845    26938    6                  WRITE_ARCHIVE_EFT.BUF_.BUF$ = ARC_REC$;
     2846    26939    6                  CALL M$WRITE( WRITE_ARCHIVE_EFT ) ALTRET( CLSERR );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:83   
     2847    26940    7                  DO WHILE('0'B);
     2848    26941    7   CLSERR:           ;
     2849    26942    7                     CALL FLI$RPT_ERR;
     2850    26943    7                     END;
     2851    26944    6                  CALL M$CLOSE( CLOSE_ARCHIVE_EFT )
     2852    26945    7                   WHENALTRETURN DO;
     2853    26946    7                     END;
     2854    26947    6                  END;
     2855    26948    6                WHENALTRETURN DO;
     2856    26949    6                  CALL FLI$RPT_ERR;
     2857    26950    6                  END;
     2858    26951    5               END;
     2859    26952    4            RETURN;
     2860    26953    4            END;
     2861    26954    3         END;
     2862    26955
     2863    26956    2   RPT_ERR_CLOSE: ;
     2864    26957    2      CALL FLI$RPT_ERR;
     2865    26958
     2866    26959    2   ERR_CLOSE: ;
     2867    26960    2      IF M$ARC_LIST$->F$DCB.FCD#
     2868    26961    3       THEN DO;
     2869    26962    3         CALL M$CLOSE( CLOSE_ARC_LIST )
     2870    26963    4          WHENALTRETURN DO;
     2871    26964    4            CALL FLI$RPT_ERR;
     2872    26965    4            END;
     2873    26966    3         END;
     2874    26967
     2875    26968    2      IF M$ARC_FILE$->F$DCB.FCD#
     2876    26969    3       THEN DO;
     2877    26970    3         CALL M$CLOSE( CLOSE_ARC_FILE )
     2878    26971    4          WHENALTRETURN DO;
     2879    26972    4            CALL FLI$RPT_ERR;
     2880    26973    4            END;
     2881    26974    3         END;
     2882    26975
     2883    26976    2      ALTRETURN;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:84   
     2884    26977
     2885    26978    2   END FLX_OUTPUT_SUMMARY;
     2886    26979        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:85   
     2887    26980    1   FLX_ARC_LIST_ERROR_REPORT: PROC;
     2888    26981        /*F*  NAME: FLX_ARC_LIST_ERROR_REPORT
     2889    26982              PURPOSE: Print names of archived disk files not on new tapes/optical disks.
     2890    26983        */
     2891    26984
     2892    26985         /***
     2893    26986          *** CONSTANT
     2894    26987          ***/
     2895    26988
     2896    26989    2   DCL TITLE_LINE CHAR(0) CONSTANT INIT('Archived disk files not found on old tapes:');
     2897    26990    2   DCL TITLE_LINE_OD CHAR(0) CONSTANT INIT(
             26990            'Archived disk files not found on old optical disks:');
     2898    26991
     2899    26992         /***
     2900    26993          *** FPT
     2901    26994          ***/
     2902    26995
     2903    26996        %FPT_WRITE( FPTN=WRITE_LINE,
     2904    26997                    DCB=M$LO,
     2905    26998                    STCLASS=STATIC );
     2906    27029
     2907    27030        /****************************************/
     2908    27031
     2909    27032    2      CALL M$OPEN( OPEN_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );
     2910    27033
     2911    27034    2      IF OD_SOURCE
     2912    27035    2       THEN WRITE_LINE.BUF_ = VECTOR(TITLE_LINE_OD);
     2913    27036    2       ELSE WRITE_LINE.BUF_ = VECTOR(TITLE_LINE);
     2914    27037    2      CALL FLP$WR_FILE_INFO ALTRET( ERR_CLOSE );
     2915    27038    2      CLOSE_ARC_FILE.V.EFTOPER = '0'B;
     2916    27039    2      CALL M$WRITE( WRITE_LINE) ALTRET( RPT_ERR_CLOSE );
     2917    27040
     2918    27041    3      DO WHILE('1'B);
     2919    27042
     2920    27043    3         CALL M$READ( READ_ARC_LIST )
     2921    27044    4          WHENRETURN DO;
     2922    27045    4            IF ARC_LIST_REC.NBR_ON_TAPE = 0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:86   
     2923    27046    5             THEN DO;
     2924    27047    5               ARC_FILE_NAME.NAME# = ARC_LIST_KEY.C.FNAMEC;
     2925    27048    5               ARC_FILE_NAME.L# = ARC_LIST_KEY.C.FNAMEL;
     2926    27049    5               ARC_FILE_ACCT.ACCT# = ARC_LIST_KEY.C.ACCT;
     2927    27050    5               ARC_FILE_SN.SN#(0) = ARC_LIST_KEY.C.PSN;
     2928    27051    5               CALL M$OPEN( OPEN_ARC_FILE ) /* Should use TEST open              */
     2929    27052    6                WHENRETURN DO;
     2930    27053    6                  CALL FLP$WR_FILE_INFO( M$ARC_FILE$, FPARAM_.PTR$, '      ', 0,
     2931    27054    6                    ' ', , 0, '1'B, '0'B ) ALTRET( ERR_CLOSE );
     2932    27055    6                  CALL M$CLOSE( CLOSE_ARC_FILE ) ALTRET( RPT_ERR_CLOSE );
     2933    27056    6                  END;
     2934    27057    6                WHENALTRETURN DO;
     2935    27058    6                  CALL FLI$RPT_ERR;
     2936    27059    6                  END;
     2937    27060    5               END;
     2938    27061    4            END;
     2939    27062    4          WHENALTRETURN DO;
     2940    27063    4            IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF
     2941    27064    4             THEN CALL FLI$RPT_ERR;
     2942    27065    4            CALL M$CLOSE ( CLOSE_ARC_LIST )
     2943    27066    5             WHENALTRETURN DO;
     2944    27067    5               CALL FLI$RPT_ERR;
     2945    27068    5               END;
     2946    27069    4            RETURN;
     2947    27070    4            END;
     2948    27071    3         END;
     2949    27072
     2950    27073    2   RPT_ERR_CLOSE: ;
     2951    27074    2      CALL FLI$RPT_ERR;
     2952    27075
     2953    27076    2   ERR_CLOSE: ;
     2954    27077    2      IF M$ARC_LIST$->F$DCB.FCD#
     2955    27078    3       THEN DO;
     2956    27079    3         CALL M$CLOSE( CLOSE_ARC_LIST )
     2957    27080    4          WHENALTRETURN DO;
     2958    27081    4            CALL FLI$RPT_ERR;
     2959    27082    4            END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:87   
     2960    27083    3         END;
     2961    27084
     2962    27085    2      RETURN;
     2963    27086
     2964    27087    2   END FLX_ARC_LIST_ERROR_REPORT;
     2965    27088        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:88   
     2966    27089    1   FLX_ACC_LINE: PROC( TITLE, NUMBER, COLUMN, DONE ) ALTRET;
     2967    27090        /*F*  NAME: FLX_ACC_LINE
     2968    27091              PURPOSE: Account for files found, not found, etc.
     2969    27092        */
     2970    27093
     2971    27094    2   DCL TITLE CHAR(70);                     /* Title of line                      */
     2972    27095    2   DCL NUMBER SBIN;                        /* Number to put on line              */
     2973    27096    2   DCL COLUMN SBIN;                        /* Number of column to use            */
     2974    27097    2   DCL DONE BIT(1) ALIGNED;                /* Indicates end of accounting        */
     2975    27098
     2976    27099
     2977    27100         /***
     2978    27101          *** STATIC
     2979    27102          ***/
     2980    27103
     2981    27104    2   DCL LAST_COLUMN SBIN STATIC;
     2982    27105    2   DCL 1 ACC_LINE STATIC,
     2983    27106    2         2 VFC CHAR(1),
     2984    27107    2         2 TITLE CHAR(35) INIT(' '),
     2985    27108    2         2 COLUMN(0:4),
     2986    27109    2           3 * CHAR(2) INIT('  '*5),
     2987    27110    2           3 NUMBER CHAR(5) INIT(' '*5);
     2988    27111    2   DCL 1 TITLE_LINE REDEF ACC_LINE,
     2989    27112    2         2 VFC CHAR(1),
     2990    27113    2         2 TITLE CHAR(70);
     2991    27114    2   DCL TEXT_NUMBER CHAR(5) STATIC;
     2992    27115    2   DCL N SBIN STATIC;
     2993    27116    2   DCL TRUOVRPRT BIT(1) STATIC;
     2994    27117
     2995    27118         /***
     2996    27119          *** FPT
     2997    27120          ***/
     2998    27121
     2999    27122        %FPT_WRITE( FPTN=WRITE_ACC_LINE,
     3000    27123                    DCB=M$LO,
     3001    27124                    BUF=ACC_LINE,
     3002    27125                    VFC=YES,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:89   
     3003    27126                    STCLASS=CONSTANT );
     3004    27157
     3005    27158         /***
     3006    27159          *** CONSTANT
     3007    27160          ***/
     3008    27161
     3009    27162    2   DCL NO_4_LEADING_ZEROS(0:2) BIT(9) CONSTANT CALIGNED
     3010    27163    2     INIT( %MVZB4, %SES10, %MVC1 );
     3011    27164    2   DCL DASHES CHAR(70) CONSTANT
     3012    27165    2     INIT('----------------------------------------------------------------------');
     3013    27166
     3014    27167         /***
     3015    27168          *** BASED
     3016    27169          ***/
     3017    27170
     3018    27171    2   DCL NCHARS CHAR(N) BASED CALIGNED;
     3019    27172
     3020    27173        /****************************************/
     3021    27174
     3022    27175    2      IF ADDR(NUMBER) = ADDR(NIL)
     3023    27176    3       THEN DO;                            /* Initialization call                */
     3024    27177    3         CALL INDEX( N, '!', TITLE );
     3025    27178    3         TITLE_LINE.TITLE = ADDR(TITLE)->NCHARS;
     3026    27179    3         TITLE_LINE.VFC = 'b';
     3027    27180    3         CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );
     3028    27181    3         TRUOVRPRT = DCBADDR(DCBNUM(M$LO))->F$DCB.ATTR.TRUOVRPRT#;
     3029    27182    3         IF TRUOVRPRT
     3030    27183    4          THEN DO;
     3031    27184    4            TITLE_LINE.VFC = '`';
     3032    27185    4            CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );
     3033    27186    4            TITLE_LINE.VFC = 'B';
     3034    27187    4            END;
     3035    27188    4          ELSE DO;
     3036    27189    4            TITLE_LINE.VFC = 'a';
     3037    27190    4            TITLE_LINE.TITLE = ADDR(DASHES)->NCHARS;
     3038    27191    4            END;
     3039    27192    3         CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:90   
     3040    27193    3         TITLE_LINE.TITLE = ' ';
     3041    27194    3         ACC_LINE.VFC = 'a';
     3042    27195    3         LAST_COLUMN = 0;
     3043    27196    3         RETURN;
     3044    27197    3         END;
     3045    27198
     3046    27199    2      IF ADDR(COLUMN) ~= ADDR(NIL)
     3047    27200    3       THEN DO;
     3048    27201    3         IF LAST_COLUMN ~= 0
     3049    27202    4          THEN DO;
     3050    27203    4            IF LAST_COLUMN < COLUMN
     3051    27204    5             THEN DO;                      /* Summarization previous column      */
     3052    27205    5               ACC_LINE.TITLE = ' ';
     3053    27206    5               IF TRUOVRPRT
     3054    27207    6                THEN DO;
     3055    27208    6                  ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = '______';
     3056    27209    6                  ACC_LINE.VFC = '`';
     3057    27210    6                  END;
     3058    27211    5                ELSE ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = '------';
     3059    27212    5               CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );
     3060    27213    5               END;
     3061    27214    4            ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = ' '; /* Leave column clean   */
     3062    27215    4            ACC_LINE.VFC = 'a';
     3063    27216    4            END;
     3064    27217    3         LAST_COLUMN = COLUMN;
     3065    27218    3         CALL BINCHAR( TEXT_NUMBER, NUMBER );
     3066    27219    3         CALL EDITCHAR( ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1), , , NO_4_LEADING_ZEROS,
             27219                  TEXT_NUMBER );
     3067    27220    3         END;
     3068    27221    3       ELSE DO;
     3069    27222    3         ACC_LINE.VFC = 'b';
     3070    27223    3         IF LAST_COLUMN > 0
     3071    27224    3          THEN ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = ' ';
     3072    27225    3         END;
     3073    27226    2      CALL INDEX( N, '!', TITLE );
     3074    27227    2      ACC_LINE.TITLE = ADDR(TITLE)->NCHARS;
     3075    27228    2      CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:91   
     3076    27229
     3077    27230    2      IF ADDR(DONE) ~= ADDR(NIL)
     3078    27231    3       THEN DO;                            /* Done with summary                  */
     3079    27232    3         ACC_LINE.TITLE = ' ';
     3080    27233    3         IF TRUOVRPRT
     3081    27234    4          THEN DO;
     3082    27235    4            ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = '______';
     3083    27236    4            ACC_LINE.VFC = '`';            /* Space no lines, print              */
     3084    27237    4            END;
     3085    27238    3          ELSE ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = '------';
     3086    27239    3         CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );
     3087    27240    3         ACC_LINE.VFC = 'a';
     3088    27241    3         ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = '------';
     3089    27242    3         CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );
     3090    27243    3         ACC_LINE.VFC = 'A';               /* Put in "normal" print/space mode   */
     3091    27244    3         ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = ' ';
     3092    27245    3         CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );
     3093    27246    3         END;
     3094    27247
     3095    27248    2      RETURN;
     3096    27249
     3097    27250    2   JUSTALT: ;
     3098    27251    2      ALTRETURN;
     3099    27252
     3100    27253    2   END FLX_ACC_LINE;
     3101    27254
     3102    27255    1   END FLX$ARCOM;
     3103    27256        %EOD;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:92   
--  Include file information  --

   XUR_ENTRY.:E05TOU  cannot be made into a system file and is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   FLW_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FLS_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FLN_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FL_PERR_C.:E05TOU  is referenced.
   FLE_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   FM$FIT.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FLX$ARCOM.

   Procedure FLX$ARCOM requires 4376 words for executable code.
   Procedure FLX$ARCOM requires 72 words of local(AUTO) storage.

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:93   

 Object Unit name= FLX$ARCOM                                  File name= FLX$ARCOM.:E05TOU
 UTS= JUL 29 '97 16:33:06.36 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$PRE_RET
    2   Data  even  none  3325   6375  FLX$ARCOM
    3   DCB   even  none     0      0  M$DISK_IN
    4   DCB   even  none     0      0  M$DISK00
    5   DCB   even  none     0      0  M$DISK01
    6   DCB   even  none     0      0  M$DISK02
    7   DCB   even  none     0      0  M$DISK03
    8   DCB   even  none     0      0  M$TSN_USED
    9   DCB   even  none     0      0  M$STATUS
   10   DCB   even  none     0      0  M$REBUILD
   11   DCB   even  none     0      0  M$ARCHIVE
   12   DCB   even  none     0      0  M$NODATA_LIST
   13   DCB   even  none     0      0  M$SI
   14   DCB   even  none     0      0  M$LO
   15   DCB   even  none     0      0  M$DO
   16   DCB   even  none     0      0  M$TAPE_SOURCE
   17   DCB   even  none     0      0  M$TAPE00
   18   DCB   even  none     0      0  M$ARC_FILE
   19   DCB   even  none     0      0  M$ARC_LIST
   20   DCB   even  none     0      0  M$ARC_LIST2
   21   DCB   even  none     0      0  M$FSN_LIST
   22   DCB   even  none     0      0  M$EFT_ERRORS
   23  RoData even  UTS    722   1322  FLX$ARCOM
   24   Proc  even  none  4376  10430  FLX$ARCOM
   25  RoData even  none   165    245  FLX$ARCOM
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:94   

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    24      0   yes            yes      Main       0  FLX$ARCOM

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    2    154  BREAK_COUNT                        2    155  BREAK_DCB$
    2    156  BREAK_TASK                         2    163  BREAK_DCB#
    2    164  BREAK_CONTINUED

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          Async      0 FLX$ARCOM_BRK
 yes     yes           Std       2 XTX$ADAPT
 yes     yes           Std       6 XUR$GETCMD
         yes           Std       5 FLI$RPT_ERR
 yes     yes           Std       1 XUR$ECHOIF
 yes     yes           Std       3 XUR$INIT
 yes     yes           Std       1 XUR$SETERRMSG
         yes           Std       1 FLI$INIT
 yes     yes           Std       2 XUR$ERRPTR
 yes     yes           Std       7 XUR$ERRMSG
         yes           Std       2 FLI$ALLOC_BUF
         yes           Std       2 FLI$ALLOC
 yes     yes           Std       1 FLI$NODE_TAPE_OD
         yes           Std       2 FLI$CNVRT_ARCHIVE
 yes     yes           Std       2 XSF$LOCCODP
         yes           Std       0 FLI$TAPE_IO_INIT
 yes     yes           Std       9 FLP$WR_FILE_INFO
 yes     yes           Std       9 FLI$TAPE_OPEN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:95   
 yes     yes           Std       1 FLI$TAPE_CLOSE
 yes     yes           Std       6 FLI$TAPE_WRITE
                       nStd      0 X66_MAUTO
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_MARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    E_TRY_AGAIN                      r    E_CANT_RUN_ARCOM
r    E_INCOMPLETE_FILE_ARCH           r    E_IO_ERR                         r    E_INCOMPLETE_FILE_SKIP
r    E_COMPACT_FIN                         LAST_SNLISTINFO$                      NBR_SNLISTS
     TAPE_DCBLIST$                         TAPE_OPEN                             TAPE_WRITE
     SNVECLIST$                            TVECTOR                               B$JIT$
     B$TCB$                                FMSEC                                 DPLIST$
     DPRESLIST$                            DISK_FILE_SPEC$                       SPECCHARS
     EFTWORD                               M$PRE_RET                             RET_CMDS_NAME
     M$DISK_IN                             M$DISK00                              M$DISK01
     M$DISK02                              M$DISK03                              FROM_DISK_NAME
     FROM_DISK_ACCT                        FROM_DISK_SN                          M$TSN_USED
     M$STATUS                              M$REBUILD                             M$ARCHIVE
     M$NODATA_LIST                         M$TAPE00$                             BLK_TAG$
     BLK_TAG0$                             NBR_BYTES_TO_MOVE                     DISK_GRAN$
     BLOCK_GRAN$                           OUTBUF_                          r    A_FIT_
     NBR_FILE_BLOCKS                       CROSSED                          r    EFT_CVOL_FILE
r    EFT_RESTRICT_FILE                     CVOL_UTL                              LAST_TSN_USED
     TSN_USED_NAME                         BACKUP_NAME                      r    ARCHIVE_NAME
r    PRIME_FILE                       r    DUAL_FILE                             REBUILD_NAME
     REBUILD_DIR_KEY                       REBUILD_KEY                           NODATA_FILE_NAME
     NODATA_KEY                            ARCOM_OPTIONS                         CAT_KEY
     CATALOG_ON                            CATALOG_ONTO                          M$SI
     M$LO                                  M$DO                                  M$TAPE_SOURCE
     M$TAPE00                              M$ARC_FILE                            M$ARC_LIST
     M$ARC_LIST2                           M$FSN_LIST                            M$EFT_ERRORS
     ARCOM_CMD                             B_VERSION                             B_VECTNIL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:96   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:97   


        1        1        /*M* FLX$ARCOM - archive compactor */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* THI=1,PLM=3 */
        8        8
        9        9        FLX$ARCOM: PROC MAIN;

      9 24 000000   000000 700200 xent  FLX$ARCOM    TSX0  ! X66_MAUTO
        24 000001   000110 000000                    ZERO    72,0

       10       10
       11       11         /***
       12       12          *** INCLUDE
       13       13          ***/
       14       14
       15       15        %INCLUDE CP_6;
       16     5574        %INCLUDE B$JIT;
       17     6177        %INCLUDE B_ERRORS_C;
       18     7304        %INCLUDE FM$FIT;
       19     7525        %INCLUDE FM$GRAN;
       20     7594        %INCLUDE CP_6_SUBS;
       21     8134        %INCLUDE FLE_DATA_R;
       22    14085        %INCLUDE FLI_DATA_R;
       23    15499        %INCLUDE FLN_DATA_R;
       24    16236        %INCLUDE FLS_DATA_R;
       25    18036        %INCLUDE FLW_DATA_R;
       26    18050        %INCLUDE XU_MACRO_C;
       27    21156        %INCLUDE XUR_ENTRY;
       28    21188
       29    21189         /***
       30    21190          *** ENTRY
       31    21191          ***/
       32    21192
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:98   
       33    21193    1   DCL FLH$RPT_ERR ENTRY(3);
       34    21194    1   DCL FLI$NODE_TAPE_OD ENTRY(1) ALTRET;
       35    21195    1   DCL FLH$HELP ENTRY(2);
       36    21196    1   DCL FLI$INIT ENTRY(1);
       37    21197    1   DCL FLI$ALLOC ENTRY(2);
       38    21198    1   DCL FLI$ALLOC_BUF ENTRY(2);
       39    21199    1   DCL XSF$LOCCODP ENTRY(2) ALTRET;
       40    21200    1   DCL FLI$RPT_ERR ENTRY(5);
       41    21201    1   DCL FLI$TAPE_IO_INIT ENTRY;
       42    21202    1   DCL FLI$TAPE_OPEN ENTRY(9) ALTRET;
       43    21203    1   DCL FLI$TAPE_CLOSE ENTRY(1) ALTRET;
       44    21204    1   DCL FLI$TAPE_WRITE ENTRY(6) ALTRET;
       45    21205    1   DCL FLX$ARCOM_BRK ENTRY ASYNC;
       46    21206    1   DCL FLP$WR_FILE_INFO ENTRY(9) ALTRET;
       47    21207    1   DCL FLI$CNVRT_ARCHIVE ENTRY(2);
       48    21208
       49    21209         /***
       50    21210          *** DCB
       51    21211          ***/
       52    21212
       53    21213    1   DCL M$SI DCB;
       54    21214    1   DCL M$LO DCB;
       55    21215    1   DCL M$DO DCB;
       56    21216    1   DCL M$TAPE_SOURCE DCB;
       57    21217    1   DCL M$TAPE00 DCB;
       58    21218    1   DCL M$ARC_FILE DCB;
       59    21219    1   DCL M$ARC_LIST DCB;
       60    21220    1   DCL M$ARC_LIST2 DCB;     /* Used to read *ARC_LIST file for updating fits     */
       61    21221    1   DCL M$FSN_LIST DCB; /* Used for maintaining list of files within each FSN     */
       62    21222    1   DCL M$EFT_ERRORS DCB;         /* Used to create *LIST_ERRORS which is unused  */
       63    21223
       64    21224         /***
       65    21225          *** SYMREF
       66    21226          ***/
       67    21227
       68    21228    1   DCL ARCOM_CMD UBIN WORD SYMREF;
       69    21229    1   DCL B_VERSION CHAR(1) SYMREF;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:99   
       70    21230    1   DCL 1 B$VERSION BASED,
       71    21231    1         2 L# UBIN BYTE CALIGNED,
       72    21232    1         2 NAME# CHAR(B$VERSION.L#) CALIGNED;
       73    21233
       74    21234         /***
       75    21235          *** SYMDEF
       76    21236          ***/
       77    21237
       78    21238    1   DCL BREAK_COUNT SBIN STATIC SYMDEF;
       79    21239    1   DCL BREAK_DCB$ PTR STATIC SYMDEF;
       80    21240    1   DCL BREAK_TASK CHAR(18) STATIC SYMDEF;
       81    21241    1   DCL BREAK_DCB# SBIN STATIC SYMDEF;
       82    21242    1   DCL BREAK_CONTINUED BIT(1) STATIC SYMDEF;
       83    21243
       84    21244         /***
       85    21245          *** STATIC
       86    21246          ***/
       87    21247
       88    21248    1   DCL ARC_SET$ PTR STATIC;
       89    21249    1   DCL ARC_REC_SIZE SBIN STATIC;
       90    21250    1   DCL ARC_REC$ PTR STATIC;
       91    21251    1   DCL CODE SBIN STATIC;
       92    21252    1   DCL NODE$ PTR STATIC;
       93    21253        %VLP_ERRCODE( FPTN=ERR,
       94    21254                      STCLASS="REDEF NODE$" );
       95    21299    1   DCL SUBNODE$ PTR STATIC;
       96    21300    1   DCL SUBNODEX SBIN STATIC;
       97    21301    1   DCL SELECTED BIT(1) STATIC;
       98    21302    1   DCL TEMP SBIN STATIC;
       99    21303    1   DCL TEMP$ PTR STATIC;
      100    21304    1   DCL TAPE_SET$ PTR STATIC;
      101    21305    1   DCL OUT_BLK_SIZE SBIN STATIC;
      102    21306    1   DCL NBR_DPS SBIN STATIC;
      103    21307    1   DCL NBRFAS_FOUND_UPDATED SBIN STATIC;
      104    21308    1   DCL NBRFAS_FOUND_UNUPDATED SBIN STATIC;
      105    21309    1   DCL NBRFAS SBIN STATIC;                 /* Total number of archived files     */
      106    21310    1   DCL I SBIN STATIC;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:100  
      107    21311    1   DCL 1 GREETINGS STATIC,
      108    21312    1         2 * CHAR(0) INIT('ARCOM '),
      109    21313    1         2 VERSION CHAR(6),
      110    21314    1         2 * CHAR(0) INIT(' '),
      111    21315    1         2 HERE CHAR(4) INIT('here');
      112    21316    1   DCL 1 INBUF_ STATIC DALIGNED,
      113    21317    1         2 * BIT(36),
      114    21318    1         2 PTR$ PTR;
      115    21319    1   DCL 1 FPARAM_ STATIC DALIGNED,
      116    21320    1         2 * BIT(36),
      117    21321    1         2 PTR$ PTR;
      118    21322    1   DCL CODE06$ PTR STATIC;
      119    21323    1   DCL ERROR_FLAG BIT(1) STATIC;
      120    21324        %MACRO ARC_LIST_KEY;
      121    21325              2 L UBIN BYTE CALIGNED,
      122    21326              2 C,
      123    21327                3 PSN CHAR(6),
      124    21328                3 ACCT CHAR(8),
      125    21329                3 FNAMEC CHAR(31),
      126    21330                3 FNAMEL UBIN BYTE CALIGNED;
      127    21331        %MEND;
      128    21332    1   DCL 1 ARC_LIST_KEY ALIGNED STATIC,
      129    21333              %ARC_LIST_KEY;
      130    21341    1   DCL 1 THIS_BLK_ARC_LIST_KEY(0:61) ALIGNED STATIC,
      131    21342              %ARC_LIST_KEY;
      132    21350    1   DCL 1 PREV_BLK_ARC_LIST_KEY(0:61) ALIGNED STATIC,
      133    21351              %ARC_LIST_KEY;
      134    21359        %MACRO ARC_LIST_REC;
      135    21360              2 REEL CHAR(6),
      136    21361              2 FSN UBIN HALF CALIGNED,
      137    21362              2 NEW,
      138    21363                3 REEL CHAR(6),
      139    21364                3 FSN UBIN HALF CALIGNED,
      140    21365              2 NBR_ON_TAPE SBIN,
      141    21366              2 ACTIVE CHAR(1);
      142    21367        %MEND;
      143    21368    1   DCL 1 ARC_LIST_REC ALIGNED STATIC,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:101  
      144    21369              %ARC_LIST_REC;
      145    21378    1   DCL 1 THIS_BLK_ARC_LIST_REC(0:61) ALIGNED STATIC,
      146    21379              %ARC_LIST_REC;
      147    21388    1   DCL 1 PREV_BLK_ARC_LIST_REC(0:61) ALIGNED STATIC,
      148    21389              %ARC_LIST_REC;
      149    21398    1   DCL M$ARC_FILE$ PTR STATIC;
      150    21399    1   DCL M$TAPE_SOURCE$ PTR STATIC;
      151    21400    1   DCL M$ARC_LIST$ PTR STATIC;
      152    21401    1   DCL M$ARC_LIST2$ PTR STATIC;
      153    21402    1   DCL M$FSN_LIST$ PTR STATIC;
      154    21403    1   DCL M$EFT_ERRORS$ PTR STATIC;
      155    21404
      156    21405    1   DCL IN_BLK_TAG$ PTR STATIC;
      157    21406    1   DCL OUT_BLK_TAG$ PTR STATIC;
      158    21407    1   DCL IN_BLK_TAG0$ PTR STATIC;
      159    21408    1   DCL OUT_BLK_TAG0$ PTR STATIC;
      160    21409    1   DCL IN_BLK_TAG_IX SBIN STATIC;
      161    21410    1   DCL OUT_BLK_TAG_IX SBIN STATIC;
      162    21411    1   DCL OUT_GRANX SBIN STATIC;
      163    21412    1   DCL IN_BLK_TAG_IX_MAX SBIN STATIC;
      164    21413    1   DCL IN_GRAN$ PTR STATIC;
      165    21414    1   DCL OUT_GRAN$ PTR STATIC;
      166    21415    1   DCL IN_GRAN_MAX$ PTR STATIC;
      167    21416    1   DCL IN_GRAN_MAX_CHK$ PTR STATIC;
      168    21417    1   DCL OUT_GRAN_MAX$ PTR STATIC;
      169    21418    1   DCL IN_GRAN_BASE$ PTR STATIC;
      170    21419    1   DCL OUT_GRAN_BASE$ PTR STATIC;
      171    21420    1   DCL PREV_REEL CHAR(6) STATIC;
      172    21421    1   DCL STEPCC UBIN STATIC INIT(0);
      173    21422    1   DCL OMIT_SN_LIST$ PTR STATIC;
      174    21423    1   DCL FROM_SN_LIST$ PTR STATIC;
      175    21424    1   DCL OPTION_CHECK BIT(1) AUTO;
      176    21425    1   DCL OPTION_IOERRORC BIT(1) AUTO;
      177    21426    1   DCL OD_SOURCE BIT(1) AUTO;              /* Optical disk source                */
      178    21427    1   DCL OD_DEST BIT(1) AUTO;                /* Optical disk destination           */
      179    21428    1   DCL CONTROLLED_SOURCE BIT(1) AUTO; /* Controlled source specified (CT or CD)  */
      180    21429
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:102  
      181    21430        /***
      182    21431         *** CONSTANT
      183    21432         ***/
      184    21433
      185    21434    1   DCL 1 FLERRMSGSYS CONSTANT,
      186    21435    1         2 * UBIN BYTE CALIGNED INIT(LENGTHC(':FLERRMSG.:SYS   ')),
      187    21436    1         2 * CHAR(0) CALIGNED INIT(':FLERRMSG.:SYS   ');
      188    21437
      189    21438         /***
      190    21439          *** BASED
      191    21440          ***/
      192    21441
      193    21442        %PARSE$OUT( STCLASS=BASED );
      194    21487        %PARSE$SYM( STCLASS=BASED );
      195    21525        %VLP_SN( STCLASS=BASED );
      196    21538        %SNLISTINFO( STCLASS="BASED(LAST_SNLISTINFO$)" );
      197    21541        %F$DCB;
      198    21598        %B$TCB( STCLASS="BASED(B$TCB$)" );
      199    21601        %B$ALT;
      200    21609        %FM$GRAN;
      201    21613        %CODE06( BASED="BASED(CODE06$)" );
      202    21617
      203    21618    1   DCL 1 IN_BLK_TAG BASED(IN_BLK_TAG$),
      204    21619              %BLOCK_TAG;
      205    21624    1   DCL 1 OUT_BLK_TAG BASED(OUT_BLK_TAG$),
      206    21625              %BLOCK_TAG;
      207    21630    1   DCL 1 IN_BLK_TAG0 BASED(IN_BLK_TAG0$),
      208    21631              %BLOCK_TAG;
      209    21636    1   DCL 1 OUT_BLK_TAG0 BASED(OUT_BLK_TAG0$),
      210    21637              %BLOCK_TAG;
      211    21642    1   DCL IN_GRAN CHAR(4096) BASED(IN_GRAN$) ALIGNED;
      212    21643    1   DCL OUT_GRAN CHAR(4096) BASED(OUT_GRAN$) ALIGNED;
      213    21644
      214    21645         /***
      215    21646          *** FPT
      216    21647          ***/
      217    21648
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:103  
      218    21649        %FPT_INT( FPTN=FPT_INT,
      219    21650                  UENTRY=FLX$ARCOM_BRK,
      220    21651                  STCLASS=CONSTANT );
      221    21665
      222    21666        %FPT_OPEN( FPTN=OPEN_TAPE_SOURCE,
      223    21667                   BLKL=253952,            /* 62K * 4096; EFT's maximum buffer size   */
      224    21668                   DCB=M$TAPE_SOURCE,
      225    21669                   ASN=TAPE,
      226    21670                   FUN=IN,
      227    21671                   ACS=BLOCK,
      228    21672                   STCLASS=STATIC );
      229    21781
      230    21782        %FPT_READ( FPTN=READ_TAPE_SOURCE,
      231    21783                   DCB=M$TAPE_SOURCE,
      232    21784                   WAIT=YES,
      233    21785                   STCLASS=STATIC );
      234    21824
      235    21825        %FPT_CLOSE( FPTN=CLOSE_TAPE_SOURCE,
      236    21826                    DCB=M$TAPE_SOURCE,
      237    21827                    DISP=SAVE );
      238    21869
      239    21870        %P_PCB( NAME=ARCOM_CMD_PCB,
      240    21871                STCLASS=STATIC );
      241    22070
      242    22071        %XUR_INIT( NAME=XUR_INIT,
      243    22072                   SYNTAX=YES,
      244    22073                   PCB=ARCOM_CMD_PCB );
      245    22172
      246    22173        %VLP_NAME( FPTN=ARC_LIST_NAME,
      247    22174                   NAME='*ARC_LIST',
      248    22175                   STCLASS=CONSTANT );
      249    22202
      250    22203        %FPT_CLOSE( FPTN=CLOSE_ARC_LIST,
      251    22204                    DCB=M$ARC_LIST,
      252    22205                    DISP=SAVE,
      253    22206                    STCLASS=CONSTANT );
      254    22248
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:104  
      255    22249        %FPT_OPEN( FPTN=OPEN_ARC_LIST,
      256    22250                   DCB=M$ARC_LIST,
      257    22251                   FUN=UPDATE,
      258    22252                   SHARE=IN,
      259    22253                   NAME=ARC_LIST_NAME,
      260    22254                   ASN=FILE,
      261    22255                   ACS=DIRECT,
      262    22256                   STCLASS=CONSTANT );
      263    22365
      264    22366        %FPT_READ( FPTN=READ_ARC_LIST_BY_KEY,
      265    22367                   DCB=M$ARC_LIST,
      266    22368                   KEY=ARC_LIST_KEY,
      267    22369                   KEYS=YES,
      268    22370                   BUF=ARC_LIST_REC,
      269    22371                   WAIT=YES,
      270    22372                   STCLASS=CONSTANT );
      271    22411
      272    22412        %FPT_WRITE( FPTN=WRITE_ARC_LIST_BY_KEY,
      273    22413                    DCB=M$ARC_LIST,
      274    22414                    ONEWKEY=NO,
      275    22415                    NEWKEY=NO,
      276    22416                    WAIT=YES,
      277    22417                    STCLASS=STATIC );
      278    22448
      279    22449        %FPT_WRITE( FPTN=WRITE_ARC_LIST_BY_KEY_NEW,
      280    22450                    DCB=M$ARC_LIST,
      281    22451                    KEY=ARC_LIST_KEY,
      282    22452                    BUF=ARC_LIST_REC,
      283    22453                    WAIT=YES,
      284    22454                    STCLASS=CONSTANT );
      285    22485
      286    22486        %FPT_READ( FPTN=READ_ARC_LIST,
      287    22487                   DCB=M$ARC_LIST,
      288    22488                   KEY=ARC_LIST_KEY,
      289    22489                   KEYR=YES,
      290    22490                   BUF=ARC_LIST_REC,
      291    22491                   WAIT=YES,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:105  
      292    22492                   STCLASS=CONSTANT );
      293    22531
      294    22532        %FPT_OPEN( FPTN=OPEN_ARC_FILE,
      295    22533                   DCB=M$ARC_FILE,
      296    22534                   FUN=IN,
      297    22535                   NAME=ARC_FILE_NAME,
      298    22536                   ACCT=ARC_FILE_ACCT,
      299    22537                   SN=ARC_FILE_SN,
      300    22538                   ASN=FILE,
      301    22539                   ACS=BLOCK,
      302    22540                   STCLASS=STATIC );
      303    22649
      304    22650        %VLP_NAME( FPTN=ARC_FILE_NAME,
      305    22651                   LEN=31,
      306    22652                   STCLASS=STATIC );
      307    22679
      308    22680        %VLP_ACCT( FPTN=ARC_FILE_ACCT,
      309    22681                   STCLASS=STATIC );
      310    22694
      311    22695        %VLP_SN( FPTN=ARC_FILE_SN,
      312    22696                 N=1,
      313    22697                 STCLASS=STATIC );
      314    22710
      315    22711        %FPT_CLOSE( FPTN=CLOSE_ARC_FILE,
      316    22712                    DCB=M$ARC_FILE,
      317    22713                    DISP=SAVE,
      318    22714                    /*N* Probably FITMOD */
      319    22715                    STCLASS=STATIC );
      320    22757
      321    22758        %FPT_DEVICE( FPTN=PAGE_LO,
      322    22759                     DCB=M$LO,
      323    22760                     PAGE=YES,
      324    22761                     HDR=PAGE_LO_HEADER );
      325    22779
      326    22780        %VLP_HDR( FPTN=PAGE_LO_HEADER,
      327    22781                  RESETPAGE=NO,
      328    22782                  COUNT=76,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:106  
      329    22783                  HEADERHEIGHT=1,
      330    22784                  TITLE=' ' );
      331    22800
      332    22801        %FPT_OPEN( FPTN=OPEN_LO_DO,
      333    22802                   DCB=M$LO,
      334    22803                   ORG=UR,
      335    22804                   CTG=YES,
      336    22805                   FUN=CREATE );
      337    22914
      338    22915        %VLP_SN( FPTN=OMIT_SN_LIST,
      339    22916                 STCLASS="BASED(OMIT_SN_LIST$)" );
      340    22929
      341    22930        %VLP_SN( FPTN=FROM_SN_LIST,
      342    22931                 STCLASS="BASED(FROM_SN_LIST$)" );
      343    22944
      344    22945        %VLP_SN( FPTN=ZERO_SN_LIST,
      345    22946                 N=1,
      346    22947                 STCLASS=STATIC );
      347    22960
      348    22961        %FPT_MADMUCK( FPTN=GET_PSN,
      349    22962                      ACCT=OUR_ACCT,
      350    22963                      SN=ZERO_SN_LIST,
      351    22964                      READ=YES );
      352    22980
      353    22981        %VLP_ACCT( FPTN=OUR_ACCT,
      354    22982                   STCLASS=STATIC );
      355    22995
      356    22996        %FPT_REM( FPTN=REM_LT,
      357    22997                  DISP=REM );
      358    23011
      359    23012        %FPT_OPEN( FPTN=OPEN_ARCHIVE_EFT,
      360    23013                   DCB=M$ARC_FILE,
      361    23014                   ASN=FILE,
      362    23015                   FUN=IN,
      363    23016                   SN=DPSN,
      364    23017                   NAME=ARCHIVE_$$EFT_NAME,
      365    23018                   ACCT=EFT_ACCT,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:107  
      366    23019                   ACS=SEQUEN,
      367    23020                   ORG=CONSEC,
      368    23021                   STCLASS=STATIC );
      369    23130
      370    23131        %FPT_READ( FPTN=READ_ARCHIVE_EFT,
      371    23132                   DCB=M$ARC_FILE,
      372    23133                   STCLASS=STATIC );
      373    23172
      374    23173        %FPT_WRITE( FPTN=WRITE_ARCHIVE_EFT,
      375    23174                    DCB=M$ARC_FILE,
      376    23175                    STCLASS=STATIC );
      377    23206
      378    23207        %FPT_CLOSE( FPTN=CLOSE_ARCHIVE_EFT,
      379    23208                    DCB=M$ARC_FILE,
      380    23209                    DISP=SAVE,
      381    23210                    STCLASS=CONSTANT );
      382    23252
      383    23253        %VLP_NAME( FPTN=ARCHIVE_$$EFT_NAME,
      384    23254                   NAME=':ARCHIVE',
      385    23255                   STCLASS=CONSTANT );
      386    23282
      387    23283        %VLP_ACCT( FPTN=EFT_ACCT,
      388    23284                   ACCT='$$EFT',
      389    23285                   STCLASS=CONSTANT );
      390    23298
      391    23299        %VLP_SN( FPTN=DPSN,
      392    23300                 N=1,
      393    23301                 STCLASS=STATIC );
      394    23314
      395    23315        %FPT_OPEN( FPTN=OPEN_FSN_LIST,
      396    23316                   DCB=M$FSN_LIST,
      397    23317                   ASN=FILE,
      398    23318                   FUN=CREATE,
      399    23319                   EXIST=NEWFILE,
      400    23320                   CTG=YES,
      401    23321                   NAME=FSN_LIST_NAME,
      402    23322                   ACS=SEQUEN,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:108  
      403    23323                   ORG=CONSEC,
      404    23324                   STCLASS=STATIC );
      405    23433
      406    23434        %FPT_READ( FPTN=READ_FSN_LIST,
      407    23435                   DCB=M$FSN_LIST,
      408    23436                   STCLASS=STATIC );
      409    23475
      410    23476        %FPT_WRITE( FPTN=WRITE_FSN_LIST,
      411    23477                    DCB=M$FSN_LIST,
      412    23478                    STCLASS=STATIC );
      413    23509
      414    23510        %FPT_CLOSE( FPTN=CLOSE_FSN_LIST,
      415    23511                    DCB=M$FSN_LIST,
      416    23512                    DISP=SAVE,
      417    23513                    STCLASS=STATIC );
      418    23555
      419    23556        %FPT_PFIL( FPTN = PFIL_FSN_LIST,
      420    23557                   DCB=M$FSN_LIST,
      421    23558                   BOF = YES,
      422    23559                   STCLASS=STATIC );
      423    23574
      424    23575        %FPT_DELREC( FPTN=DELREC_FSN_LIST,
      425    23576                     DCB=M$FSN_LIST,
      426    23577                     STCLASS=STATIC );
      427    23596
      428    23597        %FPT_PRECORD( FPTN=PRECORD_FSN_LIST,
      429    23598                    DCB=M$FSN_LIST,
      430    23599                    N=-1,
      431    23600                    STCLASS=STATIC);
      432    23621
      433    23622        %VLP_NAME( FPTN=FSN_LIST_NAME,
      434    23623                   NAME='*FSN_LIST',
      435    23624                   STCLASS=CONSTANT );
      436    23651
      437    23652        %FPT_PRIV( FPTN=SWITCH_FMSEC,
      438    23653                   PRIV=%PR_FMSEC# );
      439    23668
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:109  
      440    23669        %FPT_WRITE( FPTN=GREET_USER,
      441    23670                    DCB=M$LO,
      442    23671                    BUF=GREETINGS );
      443    23702
      444    23703        %FPT_CLOSE( FPTN=CLOSE_EFT_ERRORS,
      445    23704                    DCB=M$EFT_ERRORS,
      446    23705                    DISP=RELEASE,
      447    23706                    STCLASS=STATIC);
      448    23748
      449    23749
      450    23750        /****************************************/
      451    23751
      452    23752
      453    23753    1      BREAK_DCB$ = ADDR(NIL);

  23753 24 000002   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 000003   000155 756000 2                  STQ     BREAK_DCB$

      454    23754    1      M$EFT_ERRORS$ = DCBADDR(DCBNUM(M$EFT_ERRORS));

  23754 24 000004   000000 236007 xsym               LDQ     M$EFT_ERRORS,DL
        24 000005   000000 470400 25                 LDP0    0
        24 000006   000000 471500                    LDP1    0,,PR0
        24 000007   100000 236106                    LDQ     0,QL,PR1
        24 000010   004541 756000 2                  STQ     M$EFT_ERRORS$

      455    23755    1      BREAK_COUNT = 0;

  23755 24 000011   000154 450000 2                  STZ     BREAK_COUNT

      456    23756    1      BREAK_CONTINUED = '1'B;

  23756 24 000012   400000 236003                    LDQ     -131072,DU
        24 000013   000164 756000 2                  STQ     BREAK_CONTINUED

      457    23757    1      BREAK_TASK = 'Initialization';

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:110  
  23757 24 000014   040000 100400                    MLR     fill='040'O
        24 000015   000751 000016 23                 ADSC9   DASHES+18                cn=0,n=14
        24 000016   000156 000022 2                  ADSC9   BREAK_TASK               cn=0,n=18

      458    23758    1      CALL XUR$INIT( XUR_INIT );

  23758 24 000017   000001 630400 25                 EPPR0   1
        24 000020   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 000021   000000 701000 xent               TSX1    XUR$INIT
        24 000022   000000 011000                    NOP     0

      459    23759    1      CALL XUR$SETERRMSG( FLERRMSGSYS )

  23759 24 000023   000002 630400 25                 EPPR0   2
        24 000024   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 000025   000000 701000 xent               TSX1    XUR$SETERRMSG
        24 000026   000030 702000 24                 TSX2    s:23761
        24 000027   000032 710000 24                 TRA     s:23763

      460    23760    2       WHENALTRETURN DO;

      461    23761    2         CALL M$XXX;

  23761 24 000030   000003 713400                    CLIMB   3
        24 000031   000000 401760                    pmme    nvectors=0

      462    23762    2         END;

      463    23763    1      CALL M$INT( FPT_INT );

  23763 24 000032   000006 630400 23                 EPPR0   FPT_INT
        24 000033   010002 713400                    CLIMB   4098
        24 000034   400000 401760                    pmme    nvectors=1

      464    23764
      465    23765        /***
      466    23766         *** Verify that user has proper privilege to run ARCOM. Either FMSEC or
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:111  
      467    23767         *** EFT processor privilege is required.
      468    23768         ***/
      469    23769    1      IF B$JIT.PRIV.JOB & %PR_FMSEC#

  23769 24 000035   000000 470400 xsym               LDP0    B$JIT$
        24 000036   000015 236100                    LDQ     13,,PR0
        24 000037   000755 376000 23                 ANQ     DASHES+22
        24 000040   000044 600000 24                 TZE     s:23772

      470    23770    1       THEN FMSEC = '1'B;

  23770 24 000041   400000 236003                    LDQ     -131072,DU
        24 000042   000000 756000 xsym               STQ     FMSEC
        24 000043   000051 710000 24                 TRA     s:23775

      471    23771    2       ELSE DO;

      472    23772    2         FMSEC = '0'B;

  23772 24 000044   000000 450000 xsym               STZ     FMSEC

      473    23773    2         CALL M$RPRIV( SWITCH_FMSEC ) ALTRET(ERROR_OUT);

  23773 24 000045   005676 630400 2                  EPPR0   SWITCH_FMSEC
        24 000046   420013 713400                    CLIMB   alt,+8203
        24 000047   400000 401760                    pmme    nvectors=1
        24 000050   000311 702000 24                 TSX2    ERROR_OUT

      474    23774    2         END;

      475    23775    1      IF NOT FMSEC AND NOT (B$JIT.PPRIV & %PPR_EFT#)

  23775 24 000051   000000 234000 xsym               SZN     FMSEC
        24 000052   000076 604000 24                 TMI     s:23788
        24 000053   000000 470400 xsym               LDP0    B$JIT$
        24 000054   000020 236100                    LDQ     16,,PR0
        24 000055   000755 376000 23                 ANQ     DASHES+22
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:112  
        24 000056   000076 601000 24                 TNZ     s:23788

      476    23776    2       THEN DO;

      477    23777    2         CALL FLI$RPT_ERR(E_CANT_RUN_ARCOM);

  23777 24 000057   000003 630400 25                 EPPR0   3
        24 000060   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 000061   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 000062   000000 011000                    NOP     0

      478    23778
      479    23779    2         IF M$EFT_ERRORS$->F$DCB.FCD#      /* Delete *EFT_ERRORS file            */

  23779 24 000063   004541 470400 2                  LDP0    M$EFT_ERRORS$
        24 000064   000031 236100                    LDQ     25,,PR0
        24 000065   020000 316007                    CANQ    8192,DL
        24 000066   000074 600000 24                 TZE     s:23785

      480    23780    3          THEN DO;

      481    23781    3            CALL M$CLOSE( CLOSE_EFT_ERRORS )

  23781 24 000067   005716 630400 2                  EPPR0   CLOSE_EFT_ERRORS
        24 000070   450001 713400                    CLIMB   alt,close
        24 000071   406000 401760                    pmme    nvectors=13
        24 000072   000074 702000 24                 TSX2    s:23785
        24 000073   000074 710000 24                 TRA     s:23785

      482    23782    4             WHENALTRETURN DO;

      483    23783    4               END;

      484    23784    3            END;

      485    23785    2         CALL M$XXX;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:113  
  23785 24 000074   000003 713400                    CLIMB   3
        24 000075   000000 401760                    pmme    nvectors=0

      486    23786    2         END;

      487    23787
      488    23788    1      CALL M$OPEN( OPEN_LO_DO ) ALTRET( ERROR_OUT );

  23788 24 000076   005220 630400 2                  EPPR0   OPEN_LO_DO
        24 000077   450000 713400                    CLIMB   alt,open
        24 000100   410400 401760                    pmme    nvectors=18
        24 000101   000311 702000 24                 TSX2    ERROR_OUT

      489    23789    1      CALL M$DEVICE( PAGE_LO ) ALTRET( ERROR_OUT );

  23789 24 000102   005204 630400 2                  EPPR0   PAGE_LO
        24 000103   450006 713400                    CLIMB   alt,+20486
        24 000104   401000 401760                    pmme    nvectors=3
        24 000105   000311 702000 24                 TSX2    ERROR_OUT

      490    23790    1      IF NOT DCBADDR(DCBNUM(M$DO))->F$DCB.FCD#

  23790 24 000106   000000 236007 xsym               LDQ     M$DO,DL
        24 000107   000000 470400 25                 LDP0    0
        24 000110   000000 471500                    LDP1    0,,PR0
        24 000111   100000 473506                    LDP3    0,QL,PR1
        24 000112   300031 236100                    LDQ     25,,PR3
        24 000113   020000 316007                    CANQ    8192,DL
        24 000114   000124 601000 24                 TNZ     s:23796

      491    23791    2       THEN DO;             /* When debugging, DELTA might already have it open  */

      492    23792    2         OPEN_LO_DO.V.DCB# = DCBNUM(M$DO);

  23792 24 000115   000000 236007 xsym               LDQ     M$DO,DL
        24 000116   000000 620006                    EAX0    0,QL
        24 000117   005264 740000 2                  STX0    OPEN_LO_DO+36
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:114  

      493    23793    2         CALL M$OPEN( OPEN_LO_DO ) ALTRET( ERROR_OUT );

  23793 24 000120   005220 630400 2                  EPPR0   OPEN_LO_DO
        24 000121   450000 713400                    CLIMB   alt,open
        24 000122   410400 401760                    pmme    nvectors=18
        24 000123   000311 702000 24                 TSX2    ERROR_OUT

      494    23794    2         END;

      495    23795
      496    23796    1      GREETINGS.VERSION = ADDR(B_VERSION)->B$VERSION.NAME#;

  23796 24 000124   000000 236000 xsym               LDQ     B_VERSION
        24 000125   000033 772000                    QRL     27
        24 000126   000000 620006                    EAX0    0,QL
        24 000127   040000 100440                    MLR     fill='040'O
        24 000130   000000 200010 xsym               ADSC9   B_VERSION                cn=1,n=*X0
        24 000131   000207 400006 2                  ADSC9   GREETINGS+1              cn=2,n=6

      497    23797    1      CALL M$WRITE( GREET_USER );

  23797 24 000132   005702 630400 2                  EPPR0   GREET_USER
        24 000133   040001 713400                    CLIMB   write
        24 000134   401400 401760                    pmme    nvectors=4

      498    23798
      499    23799
      500    23800    1      M$ARC_FILE$ = DCBADDR(DCBNUM(M$ARC_FILE));

  23800 24 000135   000000 236007 xsym               LDQ     M$ARC_FILE,DL
        24 000136   000000 470400 25                 LDP0    0
        24 000137   000000 471500                    LDP1    0,,PR0
        24 000140   100000 236106                    LDQ     0,QL,PR1
        24 000141   004534 756000 2                  STQ     M$ARC_FILE$

      501    23801    1      M$TAPE_SOURCE$ = DCBADDR(DCBNUM(M$TAPE_SOURCE));
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:115  

  23801 24 000142   000000 236007 xsym               LDQ     M$TAPE_SOURCE,DL
        24 000143   100000 236106                    LDQ     0,QL,PR1
        24 000144   004535 756000 2                  STQ     M$TAPE_SOURCE$

      502    23802    1      M$ARC_LIST$ = DCBADDR(DCBNUM(M$ARC_LIST));

  23802 24 000145   000000 236007 xsym               LDQ     M$ARC_LIST,DL
        24 000146   100000 236106                    LDQ     0,QL,PR1
        24 000147   004536 756000 2                  STQ     M$ARC_LIST$

      503    23803    1      M$ARC_LIST2$ = DCBADDR(DCBNUM(M$ARC_LIST2));

  23803 24 000150   000000 236007 xsym               LDQ     M$ARC_LIST2,DL
        24 000151   100000 236106                    LDQ     0,QL,PR1
        24 000152   004537 756000 2                  STQ     M$ARC_LIST2$

      504    23804    1      M$FSN_LIST$ = DCBADDR(DCBNUM(M$FSN_LIST));

  23804 24 000153   000000 236007 xsym               LDQ     M$FSN_LIST,DL
        24 000154   100000 236106                    LDQ     0,QL,PR1
        24 000155   004540 756000 2                  STQ     M$FSN_LIST$

      505    23805    1      M$TAPE00$ = DCBADDR(DCBNUM(M$TAPE00));

  23805 24 000156   000000 236007 xsym               LDQ     M$TAPE00,DL
        24 000157   100000 236106                    LDQ     0,QL,PR1
        24 000160   000000 756000 xsym               STQ     M$TAPE00$

      506    23806
      507    23807    1      CATALOG_ON = '0'B;

  23807 24 000161   000000 450000 xsym               STZ     CATALOG_ON

      508    23808    1      CATALOG_ONTO = '0'B;

  23808 24 000162   000000 450000 xsym               STZ     CATALOG_ONTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:116  

      509    23809
      510    23810         /***
      511    23811          *** Main command parsing loop.
      512    23812          ***/
      513    23813
      514    23814    2      DO WHILE('1'B);

      515    23815
      516    23816        /***
      517    23817         *** If a user does not have FMSEC privilege, then restrict the setting of FMSEC
      518    23818         *** to a set of EFT commands, when the user only has EFT processor priv.
      519    23819         ***/
      520    23820    2         IF NOT FMSEC

  23820 24 000163   000000 234000 xsym               SZN     FMSEC
        24 000164   000172 604000 24                 TMI     s:23825

      521    23821    2          THEN CALL M$RPRIV( SWITCH_FMSEC )

  23821 24 000165   005676 630400 2                  EPPR0   SWITCH_FMSEC
        24 000166   420013 713400                    CLIMB   alt,+8203
        24 000167   400000 401760                    pmme    nvectors=1
        24 000170   000172 702000 24                 TSX2    s:23825
        24 000171   000172 710000 24                 TRA     s:23825

      522    23822    3             WHENALTRETURN DO;

      523    23823    3               END;

      524    23824
      525    23825    2         BREAK_COUNT = 0;

  23825 24 000172   000154 450000 2                  STZ     BREAK_COUNT

      526    23826    2         BREAK_DCB$ = ADDR(NIL);

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:117  
  23826 24 000173   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 000174   000155 756000 2                  STQ     BREAK_DCB$

      527    23827    2         BREAK_TASK = 'Getting command';

  23827 24 000175   040000 100400                    MLR     fill='040'O
        24 000176   000756 000017 23                 ADSC9   DASHES+23                cn=0,n=15
        24 000177   000156 000022 2                  ADSC9   BREAK_TASK               cn=0,n=18

      528    23828
      529    23829    2         CALL FLI$INIT;

  23829 24 000200   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 000201   000000 701000 xent               TSX1    FLI$INIT
        24 000202   000000 011000                    NOP     0

      530    23830    2         CALL XUR$GETCMD( ARCOM_CMD, NODE$ ) ALTRET( TELL_ERROR );

  23830 24 000203   000004 630400 25                 EPPR0   4
        24 000204   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 000205   000000 701000 xent               TSX1    XUR$GETCMD
        24 000206   000255 702000 24                 TSX2    TELL_ERROR

      531    23831    2         CALL XUR$ECHOIF( DCBNUM(M$LO) );

  23831 24 000207   000000 236007 xsym               LDQ     M$LO,DL
        24 000210   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 000211   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 000212   200071 450500                    STP0    NEW_FSN+4,,AUTO
        24 000213   200071 630500                    EPPR0   NEW_FSN+4,,AUTO
        24 000214   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 000215   000000 701000 xent               TSX1    XUR$ECHOIF
        24 000216   000000 011000                    NOP     0

      532    23832
      533    23833    2         ARCOM_OPTIONS = '0'B;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:118  
  23833 24 000217   000000 450000 xsym               STZ     ARCOM_OPTIONS

      534    23834
      535    23835    3         DO CASE( NODE$->OUT$BLK.CODE );

  23835 24 000220   000171 470400 2                  LDP0    NODE$
        24 000221   000000 720100                    LXL0    0,,PR0
        24 000222   000010 100003                    CMPX0   8,DU
        24 000223   000225 602010 24                 TNC     s:23835+5,X0
        24 000224   000254 710000 24                 TRA     s:23847
        24 000225   000254 710000 24                 TRA     s:23847
        24 000226   000254 710000 24                 TRA     s:23847
        24 000227   000254 710000 24                 TRA     s:23847
        24 000230   000240 710000 24                 TRA     s:23841
        24 000231   000254 710000 24                 TRA     s:23847
        24 000232   000254 710000 24                 TRA     s:23847
        24 000233   000254 710000 24                 TRA     s:23847
        24 000234   000235 710000 24                 TRA     s:23838

      536    23836
      537    23837    3          CASE( %END );

      538    23838    3            CALL M$EXIT;

  23838 24 000235   000001 713400                    CLIMB   exit
        24 000236   000000 401760                    pmme    nvectors=0
        24 000237   000254 710000 24                 TRA     s:23847

      539    23839
      540    23840    3          CASE( %COMPACT );

      541    23841    3            IF B$JIT.PPRIV & %PPR_EFT#

  23841 24 000240   000000 471400 xsym               LDP1    B$JIT$
        24 000241   100020 236100                    LDQ     16,,PR1
        24 000242   000755 376000 23                 ANQ     DASHES+22
        24 000243   000247 600000 24                 TZE     s:23843
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:119  

      542    23842    3             THEN CALL M$SPRIV( SWITCH_FMSEC );

  23842 24 000244   005676 630400 2                  EPPR0   SWITCH_FMSEC
        24 000245   020012 713400                    CLIMB   8202
        24 000246   400000 401760                    pmme    nvectors=1

      543    23843    3            BREAK_TASK = 'Compacting';

  23843 24 000247   040000 100400                    MLR     fill='040'O
        24 000250   000762 000012 23                 ADSC9   DASHES+27                cn=0,n=10
        24 000251   000156 000022 2                  ADSC9   BREAK_TASK               cn=0,n=18

      544    23844    3            CALL FLX_COMPACT;

  23844 24 000252   000323 701000 24                 TSX1    FLX_COMPACT
        24 000253   000000 011000                    NOP     0

      545    23845
      546    23846    3          END;

      547    23847    3         DO WHILE('0'B);

  23847 24 000254   000163 710000 24                 TRA     s:23820

  23835 24 000255                       TELL_ERROR   null
      548    23848    3   TELL_ERROR: ;
      549    23849    3            CALL XUR$ECHOIF( DCBNUM(M$LO) );

  23849 24 000255   000000 236007 xsym               LDQ     M$LO,DL
        24 000256   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 000257   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 000260   200071 450500                    STP0    NEW_FSN+4,,AUTO
        24 000261   200071 630500                    EPPR0   NEW_FSN+4,,AUTO
        24 000262   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 000263   000000 701000 xent               TSX1    XUR$ECHOIF
        24 000264   000000 011000                    NOP     0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:120  

      550    23850    3            IF NOT ERR.MON

  23850 24 000265   000171 236000 2                  LDQ     NODE$
        24 000266   400000 316007                    CANQ    -131072,DL
        24 000267   000304 601000 24                 TNZ     s:23855

      551    23851    4             THEN DO;

      552    23852    4               IF ARCOM_CMD_PCB.HI_CHAR > 0

  23852 24 000270   004746 235000 2                  LDA     ARCOM_CMD_PCB+10
        24 000271   000304 600000 24                 TZE     s:23855

      553    23853    4                THEN CALL XUR$ERRPTR( ,DCBNUM(M$DO) );

  23853 24 000272   000000 236007 xsym               LDQ     M$DO,DL
        24 000273   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 000274   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 000275   200073 450500                    STP0    NEW_FSN+6,,AUTO
        24 000276   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 000277   200072 756100                    STQ     NEW_FSN+5,,AUTO
        24 000300   200072 630500                    EPPR0   NEW_FSN+5,,AUTO
        24 000301   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 000302   000000 701000 xent               TSX1    XUR$ERRPTR
        24 000303   000000 011000                    NOP     0

      554    23854    4               END;

      555    23855    3            CALL XUR$ERRMSG( ERR );

  23855 24 000304   000005 630400 25                 EPPR0   5
        24 000305   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 000306   000000 701000 xent               TSX1    XUR$ERRMSG
        24 000307   000000 011000                    NOP     0

      556    23856    3            END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:121  

      557    23857    2         END;

  23857 24 000310   000163 710000 24                 TRA     s:23820

  23855 24 000311                       ERROR_OUT    null
      558    23858
      559    23859    1   ERROR_OUT: ;
      560    23860    1      CALL FLI$RPT_ERR;

  23860 24 000311   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 000312   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 000313   000000 011000                    NOP     0

      561    23861    1      CALL FLI$RPT_ERR( E_TRY_AGAIN );

  23861 24 000314   000006 630400 25                 EPPR0   6
        24 000315   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 000316   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 000317   000000 011000                    NOP     0

      562    23862    1      CALL M$XXX;

  23862 24 000320   000003 713400                    CLIMB   3
        24 000321   000000 401760                    pmme    nvectors=0
        24 000322   010427 710000 24                 TRA     s:27255

      563    23863
      564    23864        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:122  
      565    23865    1   FLX_COMPACT: PROC ALTRET;

  23865 24 000323   200010 741300       FLX_COMPACT  STX1  ! CONTROLLED_SOURCE+1,,AUTO

      566    23866        /*F*  NAME: FLX_COMPACT
      567    23867              PURPOSE: Perform compaction.
      568    23868        */
      569    23869
      570    23870        /****************************************/
      571    23871
      572    23872    2      BREAK_TASK = 'Interpreting';

  23872 24 000324   040000 100400                    MLR     fill='040'O
        24 000325   000765 000014 23                 ADSC9   DASHES+30                cn=0,n=12
        24 000326   000156 000022 2                  ADSC9   BREAK_TASK               cn=0,n=18

      573    23873    2      CALL FLX_INTERPRET_NODES ALTRET( JUSTALT );

  23873 24 000327   000431 701000 24                 TSX1    FLX_INTERPRET_NODES
        24 000330   000416 702000 24                 TSX2    JUSTALT

      574    23874
      575    23875         /***
      576    23876          *** Allocate buffer space now to make sure that it's available
      577    23877          *** when we need it, and that work we do now won't be wasted.
      578    23878          ***/
      579    23879
      580    23880    2      CALL FLI$ALLOC_BUF( FPARAM_, 1 );

  23880 24 000331   000007 630400 25                 EPPR0   7
        24 000332   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 000333   000000 701000 xent               TSX1    FLI$ALLOC_BUF
        24 000334   000000 011000                    NOP     0

      581    23881    2      CALL FLI$ALLOC_BUF( INBUF_, 62 /* Maximum EFT tape block */ );

  23881 24 000335   000012 630400 25                 EPPR0   10
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:123  
        24 000336   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 000337   000000 701000 xent               TSX1    FLI$ALLOC_BUF
        24 000340   000000 011000                    NOP     0

      582    23882    2      CALL FLI$ALLOC_BUF( OUTBUF_, 62 );

  23882 24 000341   000014 630400 25                 EPPR0   12
        24 000342   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 000343   000000 701000 xent               TSX1    FLI$ALLOC_BUF
        24 000344   000000 011000                    NOP     0

      583    23883
      584    23884    2      BREAK_TASK = 'Searching';

  23884 24 000345   040000 100400                    MLR     fill='040'O
        24 000346   000770 000011 23                 ADSC9   DASHES+33                cn=0,n=9
        24 000347   000156 000022 2                  ADSC9   BREAK_TASK               cn=0,n=18

      585    23885    2      BREAK_DCB$ = DCBADDR(DCBNUM(M$ARC_FILE));

  23885 24 000350   000000 236007 xsym               LDQ     M$ARC_FILE,DL
        24 000351   000000 470400 25                 LDP0    0
        24 000352   000000 471500                    LDP1    0,,PR0
        24 000353   100000 236106                    LDQ     0,QL,PR1
        24 000354   000155 756000 2                  STQ     BREAK_DCB$

      586    23886    2      CALL FLX_FIND_ARC_FILES ALTRET( JUSTALT );

  23886 24 000355   000676 701000 24                 TSX1    FLX_FIND_ARC_FILES
        24 000356   000416 702000 24                 TSX2    JUSTALT

      587    23887
      588    23888    2      BREAK_TASK = 'Compacting';

  23888 24 000357   040000 100400                    MLR     fill='040'O
        24 000360   000762 000012 23                 ADSC9   DASHES+27                cn=0,n=10
        24 000361   000156 000022 2                  ADSC9   BREAK_TASK               cn=0,n=18
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:124  

      589    23889    2      BREAK_DCB$ = DCBADDR(DCBNUM(M$TAPE_SOURCE));

  23889 24 000362   000000 236007 xsym               LDQ     M$TAPE_SOURCE,DL
        24 000363   000000 470400 25                 LDP0    0
        24 000364   000000 471500                    LDP1    0,,PR0
        24 000365   100000 236106                    LDQ     0,QL,PR1
        24 000366   000155 756000 2                  STQ     BREAK_DCB$

      590    23890    2      CALL FLX_MAKE_NEW_ARCHIVE_TAPES ALTRET( JUSTALT );

  23890 24 000367   002662 701000 24                 TSX1    FLX_MAKE_NEW_ARCHIVE_TAPES
        24 000370   000416 702000 24                 TSX2    JUSTALT

      591    23891
      592    23892    2      BREAK_TASK = 'Summarizing';

  23892 24 000371   040000 100400                    MLR     fill='040'O
        24 000372   000773 000013 23                 ADSC9   DASHES+36                cn=0,n=11
        24 000373   000156 000022 2                  ADSC9   BREAK_TASK               cn=0,n=18

      593    23893    2      BREAK_DCB$ = DCBADDR(DCBNUM(M$ARC_FILE));

  23893 24 000374   000000 236007 xsym               LDQ     M$ARC_FILE,DL
        24 000375   000000 470400 25                 LDP0    0
        24 000376   000000 471500                    LDP1    0,,PR0
        24 000377   100000 236106                    LDQ     0,QL,PR1
        24 000400   000155 756000 2                  STQ     BREAK_DCB$

      594    23894    2      CALL FLX_OUTPUT_SUMMARY ALTRET( JUSTALT );

  23894 24 000401   006562 701000 24                 TSX1    FLX_OUTPUT_SUMMARY
        24 000402   000416 702000 24                 TSX2    JUSTALT

      595    23895
      596    23896    2      IF M$EFT_ERRORS$->F$DCB.FCD#         /* Delete *EFT_ERRORS file            */

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:125  
  23896 24 000403   004541 470400 2                  LDP0    M$EFT_ERRORS$
        24 000404   000031 236100                    LDQ     25,,PR0
        24 000405   020000 316007                    CANQ    8192,DL
        24 000406   000414 600000 24                 TZE     s:23903

      597    23897    3       THEN DO;

      598    23898    3         CALL M$CLOSE( CLOSE_EFT_ERRORS )

  23898 24 000407   005716 630400 2                  EPPR0   CLOSE_EFT_ERRORS
        24 000410   450001 713400                    CLIMB   alt,close
        24 000411   406000 401760                    pmme    nvectors=13
        24 000412   000414 702000 24                 TSX2    s:23903
        24 000413   000414 710000 24                 TRA     s:23903

      599    23899    4          WHENALTRETURN DO;

      600    23900    4            END;

      601    23901    3         END;

      602    23902
      603    23903    2      RETURN;

  23903 24 000414   200010 221300                    LDX1  ! CONTROLLED_SOURCE+1,,AUTO
        24 000415   000001 702211                    TSX2  ! 1,X1

  23896 24 000416                       JUSTALT      null
      604    23904
      605    23905    2   JUSTALT: ;
      606    23906    2      IF M$EFT_ERRORS$->F$DCB.FCD#         /* Delete *EFT_ERRORS file            */

  23906 24 000416   004541 470400 2                  LDP0    M$EFT_ERRORS$
        24 000417   000031 236100                    LDQ     25,,PR0
        24 000420   020000 316007                    CANQ    8192,DL
        24 000421   000427 600000 24                 TZE     s:23913

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:126  
      607    23907    3       THEN DO;

      608    23908    3         CALL M$CLOSE( CLOSE_EFT_ERRORS )

  23908 24 000422   005716 630400 2                  EPPR0   CLOSE_EFT_ERRORS
        24 000423   450001 713400                    CLIMB   alt,close
        24 000424   406000 401760                    pmme    nvectors=13
        24 000425   000427 702000 24                 TSX2    s:23913
        24 000426   000427 710000 24                 TRA     s:23913

      609    23909    4          WHENALTRETURN DO;

      610    23910    4            END;

      611    23911    3         END;

      612    23912
      613    23913    2      ALTRETURN;

  23913 24 000427   200010 221300                    LDX1  ! CONTROLLED_SOURCE+1,,AUTO
        24 000430   000000 702211                    TSX2  ! 0,X1

      614    23914
      615    23915    2   END FLX_COMPACT;
      616    23916        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:127  
      617    23917    1   FLX_INTERPRET_NODES: PROC ALTRET;

  23917 24 000431   200012 741300       FLX_INTERPR* STX1  ! CONTROLLED_SOURCE+3,,AUTO

      618    23918        /*F*  NAME: FLX_INTERPRET_NODES
      619    23919              PURPOSE: Interpret nodes.
      620    23920        */
      621    23921
      622    23922        /****************************************/
      623    23923
      624    23924
      625    23925         /***
      626    23926          *** Set up defaults.
      627    23927          ***/
      628    23928
      629    23929    2      SELECTED = '0'B;

  23929 24 000432   000174 450000 2                  STZ     SELECTED

      630    23930    2      OD_SOURCE = '0'B;

  23930 24 000433   200005 450100                    STZ     OD_SOURCE,,AUTO

      631    23931    2      OD_DEST = '0'B;

  23931 24 000434   200006 450100                    STZ     OD_DEST,,AUTO

      632    23932    2      NBR_DPS = 0;

  23932 24 000435   000201 450000 2                  STZ     NBR_DPS

      633    23933    2      CONTROLLED_SOURCE = '0'B;

  23933 24 000436   200007 450100                    STZ     CONTROLLED_SOURCE,,AUTO

      634    23934    2      OMIT_SN_LIST$ = ADDR(ZERO_SN_LIST);

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:128  
  23934 24 000437   000016 236000 25                 LDQ     14
        24 000440   004564 756000 2                  STQ     OMIT_SN_LIST$

      635    23935    2      FROM_SN_LIST$ = ADDR(ZERO_SN_LIST);

  23935 24 000441   004565 756000 2                  STQ     FROM_SN_LIST$

      636    23936    2      DPLIST$ = ADDR(ZERO_SN_LIST);

  23936 24 000442   000000 756000 xsym               STQ     DPLIST$

      637    23937
      638    23938
      639    23939         /***
      640    23940          *** Interpret nodes.
      641    23941          ***/
      642    23942
      643    23943    3      DO SUBNODEX = 0 TO NODE$->OUT$BLK.NSUBLKS - 1;

  23943 24 000443   000173 450000 2                  STZ     SUBNODEX
        24 000444   000665 710000 24                 TRA     s:24001+1

      644    23944    3         SUBNODE$ = NODE$->OUT$BLK.SUBLK$(SUBNODEX);

  23944 24 000445   000171 470400 2                  LDP0    NODE$
        24 000446   000173 720000 2                  LXL0    SUBNODEX
        24 000447   000003 236110                    LDQ     3,X0,PR0
        24 000450   000172 756000 2                  STQ     SUBNODE$

      645    23945
      646    23946    4         DO CASE( SUBNODE$->OUT$BLK.CODE );

  23946 24 000451   000172 471400 2                  LDP1    SUBNODE$
        24 000452   100000 721100                    LXL1    0,,PR1
        24 000453   000021 101003                    CMPX1   17,DU
        24 000454   000456 602011 24                 TNC     s:23946+5,X1
        24 000455   000664 710000 24                 TRA     s:24001
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:129  
        24 000456   000502 710000 24                 TRA     s:23952
        24 000457   000477 710000 24                 TRA     s:23949
        24 000460   000545 710000 24                 TRA     s:23963
        24 000461   000643 710000 24                 TRA     s:23994
        24 000462   000664 710000 24                 TRA     s:24001
        24 000463   000545 710000 24                 TRA     s:23963
        24 000464   000545 710000 24                 TRA     s:23963
        24 000465   000545 710000 24                 TRA     s:23963
        24 000466   000664 710000 24                 TRA     s:24001
        24 000467   000664 710000 24                 TRA     s:24001
        24 000470   000664 710000 24                 TRA     s:24001
        24 000471   000664 710000 24                 TRA     s:24001
        24 000472   000664 710000 24                 TRA     s:24001
        24 000473   000664 710000 24                 TRA     s:24001
        24 000474   000664 710000 24                 TRA     s:24001
        24 000475   000664 710000 24                 TRA     s:24001
        24 000476   000643 710000 24                 TRA     s:23994

      647    23947
      648    23948    4          CASE( %SELECTED );

      649    23949    4            SELECTED = '1'B;

  23949 24 000477   400000 236003                    LDQ     -131072,DU
        24 000500   000174 756000 2                  STQ     SELECTED
        24 000501   000664 710000 24                 TRA     s:24001

      650    23950
      651    23951    4          CASE( %DPLIST );

      652    23952    4            NBR_DPS = SUBNODE$->OUT$BLK.NSUBLKS;

  23952 24 000502   100001 236100                    LDQ     1,,PR1
        24 000503   000022 772000                    QRL     18
        24 000504   000201 756000 2                  STQ     NBR_DPS

      653    23953    4            TEMP = LENGTHC(DPLIST.NUM#) + NBR_DPS * LENGTHC(DPLIST.SN#(0));
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:130  

  23953 24 000505   000006 402007                    MPY     6,DL
        24 000506   000004 036007                    ADLQ    4,DL
        24 000507   000175 756000 2                  STQ     TEMP

      654    23954    4            TEMP = (TEMP + 3) / 4;         /* Number of words in DP list         */

  23954 24 000510   000003 036007                    ADLQ    3,DL
        24 000511   000004 506007                    DIV     4,DL
        24 000512   000175 756000 2                  STQ     TEMP

      655    23955    4            CALL FLI$ALLOC( TEMP, DPLIST$ );

  23955 24 000513   000017 630400 25                 EPPR0   15
        24 000514   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 000515   000000 701000 xent               TSX1    FLI$ALLOC
        24 000516   000000 011000                    NOP     0

      656    23956    4            DPLIST.NUM# = NBR_DPS;

  23956 24 000517   000000 470400 xsym               LDP0    DPLIST$
        24 000520   000201 235000 2                  LDA     NBR_DPS
        24 000521   000000 755100                    STA     0,,PR0

      657    23957    5            DO I=0 TO NBR_DPS-1;

  23957 24 000522   000205 450000 2                  STZ     I
        24 000523   000541 710000 24                 TRA     s:23959+1

      658    23958    5               DPLIST.SN#(I) = SUBNODE$->OUT$BLK.SUBLK$(I)->OUT$SYM.TEXT;

  23958 24 000524   000172 470400 2                  LDP0    SUBNODE$
        24 000525   000205 720000 2                  LXL0    I
        24 000526   000003 471510                    LDP1    3,X0,PR0
        24 000527   100004 236100                    LDQ     4,,PR1
        24 000530   000033 772000                    QRL     27
        24 000531   000000 621006                    EAX1    0,QL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:131  
        24 000532   000205 236000 2                  LDQ     I
        24 000533   000006 402007                    MPY     6,DL
        24 000534   000000 473400 xsym               LDP3    DPLIST$
        24 000535   040106 100540                    MLR     fill='040'O
        24 000536   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        24 000537   300001 000006                    ADSC9   1,Q,PR3                  cn=0,n=6

      659    23959    5               END;

  23959 24 000540   000205 054000 2                  AOS     I
        24 000541   000205 236000 2                  LDQ     I
        24 000542   000201 116000 2                  CMPQ    NBR_DPS
        24 000543   000524 604000 24                 TMI     s:23958
        24 000544   000664 710000 24                 TRA     s:24001

      660    23960
      661    23961    4          CASE( %FROM_TAPE_SOURCE, %OMIT_TAPE_SOURCE, %FROM_OD_SOURCE,

      662    23962    4                 %OMIT_OD_SOURCE );
      663    23963    4            CALL FLI$NODE_TAPE_OD( SUBNODE$->OUT$BLK.SUBLK$(0) ) ALTRET( JUSTALT );

  23963 24 000545   000003 036003                    ADLQ    3,DU
        24 000546   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 000547   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 000550   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 000551   000000 701000 xent               TSX1    FLI$NODE_TAPE_OD
        24 000552   000674 702000 24                 TSX2    JUSTALT

      664    23964                 /***
      665    23965                  *** The following code "undoes" the initial serial number
      666    23966                  *** list from the tape destination list.  Otherwise the
      667    23967                  *** source tape would be considered a destination tape.
      668    23968                  ***/
      669    23969    4            IF SUBNODE$->OUT$BLK.CODE = %FROM_TAPE_SOURCE OR SUBNODE$->OUT$BLK

  23969 24 000553   000172 470400 2                  LDP0    SUBNODE$
        24 000554   000000 720100                    LXL0    0,,PR0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:132  
        24 000555   000002 100003                    CMPX0   2,DU
        24 000556   000561 600000 24                 TZE     s:23972
        24 000557   000006 100003                    CMPX0   6,DU
        24 000560   000634 601000 24                 TNZ     s:23989

      670    23970    4              .CODE = %FROM_OD_SOURCE
      671    23971    5             THEN DO;

      672    23972    5               FROM_SN_LIST$ = SNLISTINFO.SNLIST$;

  23972 24 000561   000000 471400 xsym               LDP1    LAST_SNLISTINFO$
        24 000562   100000 236100                    LDQ     0,,PR1
        24 000563   004565 756000 2                  STQ     FROM_SN_LIST$

      673    23973    5               OPEN_TAPE_SOURCE = TAPE_OPEN; /* Save tape open FPT               */

  23973 24 000564   000000 100400                    MLR     fill='000'O
        24 000565   000000 000350 xsym               ADSC9   TAPE_OPEN                cn=0,n=232
        24 000566   004566 000350 2                  ADSC9   OPEN_TAPE_SOURCE         cn=0,n=232

      674    23974    5               OPEN_TAPE_SOURCE.V_ = VECTOR(OPEN_TAPE_SOURCE.V);

  23974 24 000567   000022 237000 25                 LDAQ    18
        24 000570   004566 757000 2                  STAQ    OPEN_TAPE_SOURCE

      675    23975    5               OPEN_TAPE_SOURCE.V.DCB# = DCBNUM(M$TAPE_SOURCE);

  23975 24 000571   000000 236007 xsym               LDQ     M$TAPE_SOURCE,DL
        24 000572   000000 620006                    EAX0    0,QL
        24 000573   004632 740000 2                  STX0    OPEN_TAPE_SOURCE+36

      676    23976    5               TVECTOR = VECTOR(SNLISTINFO.SNLIST$->VLP_SN);

  23976 24 000574   100000 473500                    LDP3    0,,PR1
        24 000575   000024 235000 25                 LDA     20
        24 000576   200070 453500                    STP3    NEW_FSN+3,,AUTO
        24 000577   200070 236100                    LDQ     NEW_FSN+3,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:133  
        24 000600   000000 757000 xsym               STAQ    TVECTOR

      677    23977    5               TVECTOR.W1.VSIZE# = LENGTHC(VLP_SN.NUM#)

  23977 24 000601   100000 473500                    LDP3    0,,PR1
        24 000602   300000 236100                    LDQ     0,,PR3
        24 000603   000006 402007                    MPY     6,DL
        24 000604   000003 036007                    ADLQ    3,DL
        24 000605   000020 736000                    QLS     16
        24 000606   000000 676000 xsym               ERQ     TVECTOR
        24 000607   000034 376000 xsym               ANQ     B_VECTNIL+28
        24 000610   000000 656000 xsym               ERSQ    TVECTOR

      678    23978    5                 + SNLISTINFO.SNLIST$->VLP_SN.NUM# * LENGTHC(VLP_SN.SN#(0)) - 1;
      679    23979    5               OPEN_TAPE_SOURCE.SN_ = TVECTOR;

  23979 24 000611   000000 237000 xsym               LDAQ    TVECTOR
        24 000612   004570 757000 2                  STAQ    OPEN_TAPE_SOURCE+2

      680    23980
      681    23981    5               TEMP$ = SUBNODE$->OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->

  23981 24 000613   000003 473500                    LDP3    3,,PR0
        24 000614   300003 474500                    LDP4    3,,PR3
        24 000615   400003 236100                    LDQ     3,,PR4
        24 000616   000176 756000 2                  STQ     TEMP$

      682    23982    5                 OUT$BLK.SUBLK$(0);
      683    23983    5               IF TEMP$->OUT$BLK.CODE = %CT_VOL_SET

  23983 24 000617   000176 475400 2                  LDP5    TEMP$
        24 000620   500000 721100                    LXL1    0,,PR5
        24 000621   000624 600000 24                 TZE     s:23985
        24 000622   000022 101003                    CMPX1   18,DU
        24 000623   000626 601000 24                 TNZ     s:23986

      684    23984    5                 OR TEMP$->OUT$BLK.CODE = %CD_VOL_SET
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:134  
      685    23985    5                THEN CONTROLLED_SOURCE = '1'B;

  23985 24 000624   400000 236003                    LDQ     -131072,DU
        24 000625   200007 756100                    STQ     CONTROLLED_SOURCE,,AUTO

      686    23986    5               IF SUBNODE$->OUT$BLK.CODE = %FROM_OD_SOURCE

  23986 24 000626   000000 722100                    LXL2    0,,PR0
        24 000627   000006 102003                    CMPX2   6,DU
        24 000630   000637 601000 24                 TNZ     s:23990

      687    23987    5                THEN OD_SOURCE = '1'B;

  23987 24 000631   400000 236003                    LDQ     -131072,DU
        24 000632   200005 756100                    STQ     OD_SOURCE,,AUTO

      688    23988    5               END;

  23988 24 000633   000637 710000 24                 TRA     s:23990

      689    23989    4             ELSE OMIT_SN_LIST$ = SNLISTINFO.SNLIST$;

  23989 24 000634   000000 471400 xsym               LDP1    LAST_SNLISTINFO$
        24 000635   100000 236100                    LDQ     0,,PR1
        24 000636   004564 756000 2                  STQ     OMIT_SN_LIST$

      690    23990    4            LAST_SNLISTINFO$ = ADDR(NIL);  /* Delete source tape                 */

  23990 24 000637   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 000640   000000 756000 xsym               STQ     LAST_SNLISTINFO$

      691    23991    4            NBR_SNLISTS = 0;

  23991 24 000641   000000 450000 xsym               STZ     NBR_SNLISTS
        24 000642   000664 710000 24                 TRA     s:24001

      692    23992
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:135  
      693    23993    4          CASE( %TAPE_DEST, %OD_DEST );

      694    23994    4            CALL FLI$NODE_TAPE_OD( SUBNODE$ ) ALTRET( JUSTALT );

  23994 24 000643   000025 630400 25                 EPPR0   21
        24 000644   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 000645   000000 701000 xent               TSX1    FLI$NODE_TAPE_OD
        24 000646   000674 702000 24                 TSX2    JUSTALT

      695    23995    4            OUT_BLK_SIZE = TAPE_OPEN.V.BLKL# / 4096;

  23995 24 000647   000052 236000 xsym               LDQ     TAPE_OPEN+42
        24 000650   000022 772000                    QRL     18
        24 000651   000014 772000                    QRL     12
        24 000652   000200 756000 2                  STQ     OUT_BLK_SIZE

      696    23996    4            TAPE_SET$ = ADDR(SNLISTINFO.SNLIST$->VLP_SN);

  23996 24 000653   000000 470400 xsym               LDP0    LAST_SNLISTINFO$
        24 000654   000000 471500                    LDP1    0,,PR0
        24 000655   000177 451400 2                  STP1    TAPE_SET$

      697    23997    4            IF SUBNODE$->OUT$BLK.CODE = %OD_DEST

  23997 24 000656   000172 473400 2                  LDP3    SUBNODE$
        24 000657   300000 720100                    LXL0    0,,PR3
        24 000660   000020 100003                    CMPX0   16,DU
        24 000661   000664 601000 24                 TNZ     s:24001

      698    23998    4             THEN OD_DEST = '1'B;

  23998 24 000662   400000 236003                    LDQ     -131072,DU
        24 000663   200006 756100                    STQ     OD_DEST,,AUTO

      699    23999
      700    24000    4          END;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:136  
      701    24001    3         END;

  24001 24 000664   000173 054000 2                  AOS     SUBNODEX
        24 000665   000171 470400 2                  LDP0    NODE$
        24 000666   000001 236100                    LDQ     1,,PR0
        24 000667   000022 772000                    QRL     18
        24 000670   000173 116000 2                  CMPQ    SUBNODEX
        24 000671   000445 605400 24                 TPNZ    s:23944

      702    24002
      703    24003    2      RETURN;

  24003 24 000672   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 000673   000001 702211                    TSX2  ! 1,X1

      704    24004
      705    24005    2   JUSTALT:
      706    24006    2      ALTRETURN;

  24006 24 000674   200012 221300       JUSTALT      LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 000675   000000 702211                    TSX2  ! 0,X1

      707    24007    2   END FLX_INTERPRET_NODES;
      708    24008        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:137  
      709    24009    1   FLX_FIND_ARC_FILES: PROC ALTRET;

  24009 24 000676   200012 741300       FLX_FIND_AR* STX1  ! CONTROLLED_SOURCE+3,,AUTO

      710    24010        /*F*  NAME: FLX_FIND_ARC_FILES
      711    24011              PURPOSE: Build the old archive list.
      712    24012        */
      713    24013
      714    24014         /***
      715    24015          *** STATIC
      716    24016          ***/
      717    24017
      718    24018    2   DCL 1 PSN_TITLE STATIC,
      719    24019    2         2 * CHAR(0) INIT('DP#'),
      720    24020    2         2 PSN CHAR(6),
      721    24021    2         2 * CHAR(0) INIT('!');
      722    24022    2   DCL 1 PSN_LINE STATIC,
      723    24023    2         2 * CHAR(0) INIT('   DP#'),
      724    24024    2         2 PSN CHAR(6);
      725    24025    2   DCL 1 TSN_LINE STATIC,
      726    24026    2         2 * CHAR(0) INIT('   LT#'),
      727    24027    2         2 TSN CHAR(6);
      728    24028    2   DCL 1 ODSN_LINE STATIC,
      729    24029    2         2 * CHAR(0) INIT('   OD#'),
      730    24030    2         2 TSN CHAR(6);
      731    24031    2   DCL 1 GETTING_SET STATIC,
      732    24032    2         2 * CHAR(0) INIT('...Getting archive set list from DP#'),
      733    24033    2         2 PSN CHAR(6),
      734    24034    2         2 * CHAR(0) INIT('/:ARCHIVE.$$EFT');
      735    24035    2   DCL ERROR_SET$ PTR STATIC;
      736    24036
      737    24037         /***
      738    24038          *** CONSTANT
      739    24039          ***/
      740    24040
      741    24041    2   DCL NOT_INCLUDE_NOTE CHAR(0) CONSTANT
      742    24042    2       INIT( 'Note: the following packsets will not be included on the new tapes' );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:138  
      743    24043    2   DCL NOT_INCLUDE_ERR CHAR(0) CONSTANT
      744    24044    2       INIT( '*** The following packsets would not be included on the new tapes' );
      745    24045    2   DCL PSN_TO_BE_PROCESSED CHAR(0) CONSTANT
      746    24046    2       INIT('The following packsets will be processed:');
      747    24047    2   DCL NO_SOURCE_TAPES CHAR(0) CONSTANT
      748    24048    2      INIT('*** Either no source tapes have been specified or all have been omitted');
      749    24049    2   DCL COULDNT_OMIT CHAR(0) CONSTANT
      750    24050    2      INIT('The following reels aren''t used and can''t be omitted:');
      751    24051    2   DCL NOT_INCLUDE_NOTE_OD CHAR(0) CONSTANT
      752    24052    2       INIT(
             24052               'Note: the following packsets will not be included on the new optical disks'
             24052                );
      753    24053    2   DCL NOT_INCLUDE_ERR_OD CHAR(0) CONSTANT
      754    24054    2       INIT(
             24054                '*** The following packsets would not be included on the new optical disks'
             24054                );
      755    24055    2   DCL NO_SOURCE_ODS CHAR(0) CONSTANT
      756    24056    2      INIT(
             24056          '*** Either no source optical disks have been specified or all have been omitted'
             24056               );
      757    24057    2   DCL COULDNT_OMIT_OD CHAR(0) CONSTANT
      758    24058    2      INIT('The following optical disks aren''t used and can''t be omitted:');
      759    24059
      760    24060         /***
      761    24061          *** AUTO
      762    24062          ***/
      763    24063
      764    24064    2   DCL PACKSET_END BIT(1) AUTO;
      765    24065    2   DCL DPX SBIN AUTO;
      766    24066    2   DCL NBRFAS_PACKSET SBIN AUTO;
      767    24067    2   DCL NBRFAS_PACKSET_ACTIVE SBIN AUTO;
      768    24068    2   DCL NBRFAS_PACKSET_INACTIVE SBIN AUTO;
      769    24069    2   DCL OSX SBIN AUTO;
      770    24070    2   DCL NSX SBIN AUTO;
      771    24071    2   DCL SN CHAR(6) AUTO;
      772    24072    2   DCL FOUND BIT(1) AUTO;
      773    24073    2   DCL MAX_NBR_SNS SBIN AUTO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:139  
      774    24074    2   DCL COLLECT_SNS BIT(1) AUTO;
      775    24075    2   DCL NO_ARCHIVE_FILE BIT(1) AUTO;
      776    24076    2   DCL TPTR$ PTR;
      777    24077    2   DCL CTN SBIN AUTO;
      778    24078
      779    24079         /***
      780    24080          *** FPT
      781    24081          ***/
      782    24082
      783    24083        %FPT_OPEN( FPTN=OPEN_NEXT_ARC_FILE,
      784    24084                   DCB=M$ARC_FILE,
      785    24085                   ASN=FILE,
      786    24086                   NXTF=YES,
      787    24087                   FUN=IN,
      788    24088                   SN=DPSN,
      789    24089                   TEST=YES,
      790    24090                   ARCHIVE=YES,
      791    24091                   STCLASS=STATIC );
      792    24200
      793    24201        %FPT_OPEN( FPTN=OPEN_ARC_LIST,
      794    24202                   DCB=M$ARC_LIST,
      795    24203                   ASN=FILE,
      796    24204                   FUN=CREATE,
      797    24205                   ORG=KEYED,
      798    24206                   NAME=ARC_LIST_NAME,
      799    24207                   ACS=DIRECT,
      800    24208                   STCLASS=STATIC );
      801    24317
      802    24318        %VLP_NAME( FPTN=INITIAL_NAME,
      803    24319                   LEN=31,
      804    24320                   STCLASS=STATIC );
      805    24347
      806    24348        %VLP_ACCT( FPTN=INITIAL_ACCT,
      807    24349                   STCLASS=STATIC );
      808    24362
      809    24363        %FPT_WRITE( FPTN=WRITE_ARC_LIST,
      810    24364                    BUF=ARC_LIST_REC,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:140  
      811    24365                    KEY=ARC_LIST_KEY,
      812    24366                    DCB=M$ARC_LIST,
      813    24367                    WAIT=YES,
      814    24368                    STCLASS=CONSTANT );
      815    24399
      816    24400        %FPT_WRITE( FPTN=WRITE_LO,
      817    24401                    DCB=M$LO,
      818    24402                    STCLASS=STATIC );
      819    24433
      820    24434         /***
      821    24435          *** BASED
      822    24436          ***/
      823    24437
      824    24438        %F$DCB( BASED="BASED(M$ARC_FILE$)" );
      825    24495        %VLP_SN( FPTN=ARC_SET,
      826    24496                 STCLASS="BASED(ARC_SET$)" );
      827    24509        %VLP_SN( FPTN=ERROR_SET,
      828    24510                 STCLASS="BASED(ERROR_SET$)" );
      829    24523    2   DCL 1 CT5 BASED( TPTR$ ) CALIGNED,
      830    24524    2         2 * CHAR(4),
      831    24525    2         2 C1 CHAR(1),
      832    24526    2         2 C2 CHAR(1);
      833    24527    2   DCL 1 CT6 BASED( TPTR$ ) CALIGNED,
      834    24528    2         2 * CHAR(4),
      835    24529    2         2 C1 CHAR(2);
      836    24530
      837    24531        /****************************************/
      838    24532
      839    24533    2      READ_ARCHIVE_EFT.BUF_ = VECTOR(ARC_REC_SIZE);

  24533 24 000677   000026 237000 25                 LDAQ    22
        24 000700   005432 757000 2                  STAQ    READ_ARCHIVE_EFT+4

      840    24534    2      ARC_REC$ = ADDR(NIL);

  24534 24 000701   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 000702   000167 756000 2                  STQ     ARC_REC$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:141  

      841    24535
      842    24536         /***
      843    24537          *** If no archive set (DP list) has been specified, get from the
      844    24538          *** current File Management account's packset's archive master file.
      845    24539          ***/
      846    24540
      847    24541    2      NO_ARCHIVE_FILE = '0'B;

  24541 24 000703   200027 450100                    STZ     NO_ARCHIVE_FILE,,AUTO

      848    24542    2      IF DPLIST$ = ADDR(ZERO_SN_LIST)

  24542 24 000704   000016 236000 25                 LDQ     14
        24 000705   000000 116000 xsym               CMPQ    DPLIST$
        24 000706   001140 601000 24                 TNZ     s:24611

      849    24543    3       THEN DO;

      850    24544    3         OUR_ACCT.ACCT# = B$JIT.FACCN;

  24544 24 000707   000000 470400 xsym               LDP0    B$JIT$
        24 000710   000006 237100                    LDAQ    6,,PR0
        24 000711   005326 757000 2                  STAQ    OUR_ACCT

      851    24545    3         CALL M$MADMUCK( GET_PSN )

  24545 24 000712   005316 630400 2                  EPPR0   GET_PSN
        24 000713   460005 713400                    CLIMB   alt,+24581
        24 000714   401000 401760                    pmme    nvectors=3
        24 000715   000717 702000 24                 TSX2    s:24547
        24 000716   000724 710000 24                 TRA     s:24550

      852    24546    4          WHENALTRETURN DO;

      853    24547    4            CALL FLI$RPT_ERR;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:142  
  24547 24 000717   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 000720   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 000721   000000 011000                    NOP     0

      854    24548    4            ALTRETURN;

  24548 24 000722   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 000723   000000 702211                    TSX2  ! 0,X1

      855    24549    4            END;
      856    24550    3         DPSN.SN#(0) = ZERO_SN_LIST.SN#(0);

  24550 24 000724   040000 100400                    MLR     fill='040'O
        24 000725   005313 000006 2                  ADSC9   ZERO_SN_LIST+1           cn=0,n=6
        24 000726   005461 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      857    24551    3         GETTING_SET.PSN = DPSN.SN#(0);

  24551 24 000727   040000 100400                    MLR     fill='040'O
        24 000730   005461 000006 2                  ADSC9   DPSN+1                   cn=0,n=6
        24 000731   006001 000006 2                  ADSC9   GETTING_SET+9            cn=0,n=6

      858    24552    3         WRITE_LO.BUF_ = VECTOR(GETTING_SET);

  24552 24 000732   000030 237000 25                 LDAQ    24
        24 000733   006212 757000 2                  STAQ    WRITE_LO+4

      859    24553    3         CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );

  24553 24 000734   006206 630400 2                  EPPR0   WRITE_LO
        24 000735   440001 713400                    CLIMB   alt,write
        24 000736   401400 401760                    pmme    nvectors=4
        24 000737   002641 702000 24                 TSX2    RPT_ERR_CLOSE

      860    24554    3         CALL M$OPEN( OPEN_ARCHIVE_EFT )

  24554 24 000740   005334 630400 2                  EPPR0   OPEN_ARCHIVE_EFT
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:143  
        24 000741   450000 713400                    CLIMB   alt,open
        24 000742   410400 401760                    pmme    nvectors=18
        24 000743   001133 702000 24                 TSX2    s:24602

      861    24555    4          WHENRETURN DO;

      862    24556    4            CALL M$READ( READ_ARCHIVE_EFT )

  24556 24 000744   005426 630400 2                  EPPR0   READ_ARCHIVE_EFT
        24 000745   440000 713400                    CLIMB   alt,read
        24 000746   401400 401760                    pmme    nvectors=4
        24 000747   001125 702000 24                 TSX2    s:24597

      863    24557    5             WHENRETURN DO;

      864    24558    5               CALL FLI$ALLOC( ARC_REC_SIZE, ARC_REC$ );

  24558 24 000750   000032 630400 25                 EPPR0   26
        24 000751   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 000752   000000 701000 xent               TSX1    FLI$ALLOC
        24 000753   000000 011000                    NOP     0

      865    24559    5               READ_ARCHIVE_EFT.BUF_.BOUND = ARC_REC_SIZE * 4 - 1;

  24559 24 000754   000166 236000 2                  LDQ     ARC_REC_SIZE
        24 000755   000002 736000                    QLS     2
        24 000756   000001 136007                    SBLQ    1,DL
        24 000757   000020 736000                    QLS     16
        24 000760   005432 676000 2                  ERQ     READ_ARCHIVE_EFT+4
        24 000761   000034 376000 xsym               ANQ     B_VECTNIL+28
        24 000762   005432 656000 2                  ERSQ    READ_ARCHIVE_EFT+4

      866    24560    5               READ_ARCHIVE_EFT.BUF_.BUF$ = ARC_REC$;

  24560 24 000763   000167 236000 2                  LDQ     ARC_REC$
        24 000764   005433 756000 2                  STQ     READ_ARCHIVE_EFT+5

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:144  
      867    24561    5               CALL M$READ( READ_ARCHIVE_EFT )

  24561 24 000765   005426 630400 2                  EPPR0   READ_ARCHIVE_EFT
        24 000766   440000 713400                    CLIMB   alt,read
        24 000767   401400 401760                    pmme    nvectors=4
        24 000770   001111 702000 24                 TSX2    s:24591

      868    24562    6                WHENRETURN DO;

      869    24563        /***
      870    24564         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      871    24565         ***/
      872    24566    6                  IF ARC_REC$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)

  24566 24 000771   000167 470400 2                  LDP0    ARC_REC$
        24 000772   000000 236100                    LDQ     0,,PR0
        24 000773   777000 376003                    ANQ     -512,DU
        24 000774   777000 116003                    CMPQ    -512,DU
        24 000775   001010 600000 24                 TZE     s:24572

      873    24567    6                   THEN
      874    24568    7                  DO;

      875    24569    7                     CALL FLI$CNVRT_ARCHIVE(ARC_REC$,TPTR$);

  24569 24 000776   200030 631500                    EPPR1   TPTR$,,AUTO
        24 000777   200071 451500                    STP1    NEW_FSN+4,,AUTO
        24 001000   000033 236000 25                 LDQ     27
        24 001001   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 001002   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 001003   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 001004   000000 701000 xent               TSX1    FLI$CNVRT_ARCHIVE
        24 001005   000000 011000                    NOP     0

      876    24570    7                     ARC_REC$ = TPTR$;

  24570 24 001006   200030 236100                    LDQ     TPTR$,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:145  
        24 001007   000167 756000 2                  STQ     ARC_REC$

      877    24571    7                     END;

      878    24572    6                  ARC_SET$ = PINCRW( ARC_REC$, ARC_REC$->ARCHIVE_LIST.OFFSET.DPLIST );

  24572 24 001010   000167 470400 2                  LDP0    ARC_REC$
        24 001011   000003 720100                    LXL0    3,,PR0
        24 001012   000000 636010                    EAQ     0,X0
        24 001013   000167 036000 2                  ADLQ    ARC_REC$
        24 001014   000165 756000 2                  STQ     ARC_SET$

      879    24573    6                  NBR_DPS = ARC_SET.NUM#;

  24573 24 001015   000165 471400 2                  LDP1    ARC_SET$
        24 001016   100000 235100                    LDA     0,,PR1
        24 001017   000201 755000 2                  STA     NBR_DPS

      880    24574    6                  TEMP = LENGTHC(DPLIST.NUM#) + NBR_DPS * LENGTHC(DPLIST.SN#(0));

  24574 24 001020   000201 236000 2                  LDQ     NBR_DPS
        24 001021   000006 402007                    MPY     6,DL
        24 001022   000004 036007                    ADLQ    4,DL
        24 001023   000175 756000 2                  STQ     TEMP

      881    24575    6                  TEMP = (TEMP + 3) / 4;   /* Number of words in DP list         */

  24575 24 001024   000003 036007                    ADLQ    3,DL
        24 001025   000004 506007                    DIV     4,DL
        24 001026   000175 756000 2                  STQ     TEMP

      882    24576    6                  CALL FLI$ALLOC( TEMP, DPLIST$ );

  24576 24 001027   000017 630400 25                 EPPR0   15
        24 001030   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 001031   000000 701000 xent               TSX1    FLI$ALLOC
        24 001032   000000 011000                    NOP     0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:146  

      883    24577    6                  DPLIST.NUM# = NBR_DPS;

  24577 24 001033   000000 470400 xsym               LDP0    DPLIST$
        24 001034   000201 235000 2                  LDA     NBR_DPS
        24 001035   000000 755100                    STA     0,,PR0

      884    24578    7                  DO I=0 TO NBR_DPS-1;

  24578 24 001036   000205 450000 2                  STZ     I
        24 001037   001050 710000 24                 TRA     s:24580+1

      885    24579    7                     DPLIST.SN#(I) = ARC_SET.SN#(I);

  24579 24 001040   000205 236000 2                  LDQ     I
        24 001041   000006 402007                    MPY     6,DL
        24 001042   000165 470400 2                  LDP0    ARC_SET$
        24 001043   000000 471400 xsym               LDP1    DPLIST$
        24 001044   040106 100506                    MLR     fill='040'O
        24 001045   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 001046   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

      886    24580    7                     END;

  24580 24 001047   000205 054000 2                  AOS     I
        24 001050   000205 236000 2                  LDQ     I
        24 001051   000201 116000 2                  CMPQ    NBR_DPS
        24 001052   001040 604000 24                 TMI     s:24579

      887    24581    6                  CALL M$CLOSE( CLOSE_ARCHIVE_EFT ) ALTRET( RPT_ERR_CLOSE );

  24581 24 001053   000216 630400 23                 EPPR0   CLOSE_ARCHIVE_EFT
        24 001054   450001 713400                    CLIMB   alt,close
        24 001055   406000 401760                    pmme    nvectors=13
        24 001056   002641 702000 24                 TSX2    RPT_ERR_CLOSE

      888    24582    6                  WRITE_LO.BUF_ = VECTOR(PSN_TO_BE_PROCESSED);
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:147  

  24582 24 001057   000034 237000 25                 LDAQ    28
        24 001060   006212 757000 2                  STAQ    WRITE_LO+4

      889    24583    6                  CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );

  24583 24 001061   006206 630400 2                  EPPR0   WRITE_LO
        24 001062   440001 713400                    CLIMB   alt,write
        24 001063   401400 401760                    pmme    nvectors=4
        24 001064   002641 702000 24                 TSX2    RPT_ERR_CLOSE

      890    24584    6                  WRITE_LO.BUF_ = VECTOR(PSN_LINE);

  24584 24 001065   000036 237000 25                 LDAQ    30
        24 001066   006212 757000 2                  STAQ    WRITE_LO+4

      891    24585    7                  DO NSX=0 TO DPLIST.NUM#-1;

  24585 24 001067   200021 450100                    STZ     NSX,,AUTO
        24 001070   001104 710000 24                 TRA     s:24588+1

      892    24586    7                     PSN_LINE.PSN = DPLIST.SN#(NSX);

  24586 24 001071   200021 236100                    LDQ     NSX,,AUTO
        24 001072   000006 402007                    MPY     6,DL
        24 001073   000000 470400 xsym               LDP0    DPLIST$
        24 001074   040000 100506                    MLR     fill='040'O
        24 001075   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 001076   005760 400006 2                  ADSC9   PSN_LINE+1               cn=2,n=6

      893    24587    7                     CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );

  24587 24 001077   006206 630400 2                  EPPR0   WRITE_LO
        24 001100   440001 713400                    CLIMB   alt,write
        24 001101   401400 401760                    pmme    nvectors=4
        24 001102   002641 702000 24                 TSX2    RPT_ERR_CLOSE

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:148  
      894    24588    7                     END;

  24588 24 001103   200021 054100                    AOS     NSX,,AUTO
        24 001104   000000 470400 xsym               LDP0    DPLIST$
        24 001105   200021 236100                    LDQ     NSX,,AUTO
        24 001106   000000 116100                    CMPQ    0,,PR0
        24 001107   001071 604000 24                 TMI     s:24586

      895    24589    6                  END;

  24589 24 001110   001124 710000 24                 TRA     s:24595

      896    24590    6                WHENALTRETURN DO;

      897    24591    6                  IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF

  24591 24 001111   000000 470400 xsym               LDP0    B$TCB$
        24 001112   000000 471500                    LDP1    0,,PR0
        24 001113   100102 236100                    LDQ     66,,PR1
        24 001114   377770 376007                    ANQ     131064,DL
        24 001115   000060 116007                    CMPQ    48,DL
        24 001116   001122 600000 24                 TZE     s:24593

      898    24592    6                   THEN CALL FLI$RPT_ERR;

  24592 24 001117   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 001120   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 001121   000000 011000                    NOP     0

      899    24593    6                  NO_ARCHIVE_FILE = '1'B;

  24593 24 001122   400000 236003                    LDQ     -131072,DU
        24 001123   200027 756100                    STQ     NO_ARCHIVE_FILE,,AUTO

      900    24594    6                  END;

      901    24595    5               END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:149  

  24595 24 001124   001132 710000 24                 TRA     s:24600

      902    24596    5             WHENALTRETURN DO;

      903    24597    5               CALL FLI$RPT_ERR;

  24597 24 001125   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 001126   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 001127   000000 011000                    NOP     0

      904    24598    5               NO_ARCHIVE_FILE = '1'B;

  24598 24 001130   400000 236003                    LDQ     -131072,DU
        24 001131   200027 756100                    STQ     NO_ARCHIVE_FILE,,AUTO

      905    24599    5               END;

      906    24600    4            END;

  24600 24 001132   001140 710000 24                 TRA     s:24611

      907    24601    4          WHENALTRETURN DO;

      908    24602    4            CALL FLI$RPT_ERR;

  24602 24 001133   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 001134   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 001135   000000 011000                    NOP     0

      909    24603    4            NO_ARCHIVE_FILE = '1'B;

  24603 24 001136   400000 236003                    LDQ     -131072,DU
        24 001137   200027 756100                    STQ     NO_ARCHIVE_FILE,,AUTO

      910    24604    4            END;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:150  
      911    24605    3         END;

      912    24606
      913    24607         /***
      914    24608          *** Initialization for finding files.
      915    24609          ***/
      916    24610
      917    24611    2      INITIAL_ACCT.ACCT# = BINASC(0);

  24611 24 001140   000040 235000 25                 LDA     32
        24 001141   000035 236000 xsym               LDQ     B_VECTNIL+29
        24 001142   006204 757000 2                  STAQ    INITIAL_ACCT

      918    24612    2      INITIAL_NAME.NAME# = BINASC(0);

  24612 24 001143   040000 100400                    MLR     fill='040'O
        24 001144   000040 000001 25                 ADSC9   32                       cn=0,n=1
        24 001145   006174 200037 2                  ADSC9   INITIAL_NAME             cn=1,n=31

      919    24613
      920    24614    2      ARC_LIST_KEY.L = LENGTHC(ARC_LIST_KEY.C);

  24614 24 001146   056000 236003                    LDQ     23552,DU
        24 001147   000222 552040 2                  STBQ    ARC_LIST_KEY,'40'O

      921    24615    2      ARC_LIST_REC.NEW.REEL = ' ';

  24615 24 001150   040000 100400                    MLR     fill='040'O
        24 001151   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 001152   003160 000006 2                  ADSC9   ARC_LIST_REC+2           cn=0,n=6

      922    24616    2      ARC_LIST_REC.NEW.FSN = 0;

  24616 24 001153   000000 220003                    LDX0    0,DU
        24 001154   003161 440000 2                  SXL0    ARC_LIST_REC+3

      923    24617    2      ARC_LIST_REC.NBR_ON_TAPE = 0;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:151  

  24617 24 001155   003162 450000 2                  STZ     ARC_LIST_REC+4

      924    24618
      925    24619    2      NBRFAS = 0;

  24619 24 001156   000204 450000 2                  STZ     NBRFAS

      926    24620    2      NBRFAS_PACKSET = 0;

  24620 24 001157   200015 450100                    STZ     NBRFAS_PACKSET,,AUTO

      927    24621    2      NBRFAS_PACKSET_ACTIVE = 0;

  24621 24 001160   200016 450100                    STZ     NBRFAS_PACKSET_ACTIVE,,AUTO

      928    24622    2      NBRFAS_PACKSET_INACTIVE = 0;

  24622 24 001161   200017 450100                    STZ     NBRFAS_PACKSET_INACTIVE,,AUTO

      929    24623
      930    24624    2      OPEN_NEXT_ARC_FILE.FPARAM_ = FPARAM_;

  24624 24 001162   000216 237000 2                  LDAQ    FPARAM_
        24 001163   006040 757000 2                  STAQ    OPEN_NEXT_ARC_FILE+24

      931    24625
      932    24626         /***
      933    24627          *** Make sure that all required sets are up and ready.
      934    24628          ***/
      935    24629
      936    24630    2      ERROR_FLAG = '0'B;

  24630 24 001164   000221 450000 2                  STZ     ERROR_FLAG

      937    24631
      938    24632    2      OPEN_NEXT_ARC_FILE.NAME_ = VECTOR(INITIAL_NAME);
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:152  

  24632 24 001165   000042 237000 25                 LDAQ    34
        24 001166   006016 757000 2                  STAQ    OPEN_NEXT_ARC_FILE+6

      939    24633    2      OPEN_NEXT_ARC_FILE.ACCT_ = VECTOR(INITIAL_ACCT);

  24633 24 001167   000044 237000 25                 LDAQ    36
        24 001170   006034 757000 2                  STAQ    OPEN_NEXT_ARC_FILE+20

      940    24634    2      OPEN_NEXT_ARC_FILE.V.OPER.NXTA# = %YES#;

  24634 24 001171   010000 236007                    LDQ     4096,DL
        24 001172   006054 256000 2                  ORSQ    OPEN_NEXT_ARC_FILE+36

      941    24635
      942    24636    2      TEMP = LENGTHC(ERROR_SET.NUM#) + 10 * LENGTHC(ERROR_SET.SN#(0));

  24636 24 001173   000100 235007                    LDA     64,DL
        24 001174   000175 755000 2                  STA     TEMP

      943    24637    2      TEMP = (TEMP + 3) / 4;

  24637 24 001175   000175 236000 2                  LDQ     TEMP
        24 001176   000003 036007                    ADLQ    3,DL
        24 001177   000004 506007                    DIV     4,DL
        24 001200   000175 756000 2                  STQ     TEMP

      944    24638    2      CALL FLI$ALLOC( TEMP, ERROR_SET$ );

  24638 24 001201   000046 630400 25                 EPPR0   38
        24 001202   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 001203   000000 701000 xent               TSX1    FLI$ALLOC
        24 001204   000000 011000                    NOP     0

      945    24639    2      MAX_NBR_SNS = 10;

  24639 24 001205   000012 235007                    LDA     10,DL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:153  
        24 001206   200025 755100                    STA     MAX_NBR_SNS,,AUTO

      946    24640    2      ERROR_SET.NUM# = 0;

  24640 24 001207   006007 470400 2                  LDP0    ERROR_SET$
        24 001210   000000 450100                    STZ     0,,PR0

      947    24641    3      DO DPX = 0 TO DPLIST.NUM# - 1;

  24641 24 001211   200014 450100                    STZ     DPX,,AUTO
        24 001212   001551 710000 24                 TRA     s:24731+1

      948    24642    3         DPSN.SN#(0) = DPLIST.SN#(DPX);

  24642 24 001213   200014 236100                    LDQ     DPX,,AUTO
        24 001214   000006 402007                    MPY     6,DL
        24 001215   000000 470400 xsym               LDP0    DPLIST$
        24 001216   040000 100506                    MLR     fill='040'O
        24 001217   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 001220   005461 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      949    24643    3         CALL M$OPEN( OPEN_NEXT_ARC_FILE )

  24643 24 001221   006010 630400 2                  EPPR0   OPEN_NEXT_ARC_FILE
        24 001222   450000 713400                    CLIMB   alt,open
        24 001223   410400 401760                    pmme    nvectors=18
        24 001224   001226 702000 24                 TSX2    s:24645
        24 001225   001243 710000 24                 TRA     s:24650

      950    24644    4          WHENALTRETURN DO;

      951    24645    4            CODE = B$TCB.ALT$->B$ALT.ERR.CODE;

  24645 24 001226   000000 470400 xsym               LDP0    B$TCB$
        24 001227   000000 471500                    LDP1    0,,PR0
        24 001230   100102 236100                    LDQ     66,,PR1
        24 001231   000003 772000                    QRL     3
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:154  
        24 001232   037777 376007                    ANQ     16383,DL
        24 001233   000170 756000 2                  STQ     CODE

      952    24646    4            IF CODE = %E$FDEOF OR CODE = %E$NOKEY OR CODE = %E$ADEOF

  24646 24 001234   000154 116007                    CMPQ    108,DL
        24 001235   001242 600000 24                 TZE     s:24646+6
        24 001236   000102 116007                    CMPQ    66,DL
        24 001237   001242 600000 24                 TZE     s:24646+6
        24 001240   000175 116007                    CMPQ    125,DL
        24 001241   001523 601000 24                 TNZ     PACKSET_ERR

  24646 24 001242   001243 710000 24                 TRA     s:24650

      953    24647    4             THEN ;
      954    24648    4             ELSE GOTO PACKSET_ERR;        /* Can't handle this error            */
      955    24649    4            END;
      956    24650    3         CALL M$OPEN( OPEN_ARCHIVE_EFT )

  24650 24 001243   005334 630400 2                  EPPR0   OPEN_ARCHIVE_EFT
        24 001244   450000 713400                    CLIMB   alt,open
        24 001245   410400 401760                    pmme    nvectors=18
        24 001246   001545 702000 24                 TSX2    s:24729

      957    24651    4          WHENRETURN DO;

      958    24652    4            IF ARC_REC$ = ADDR(NIL)

  24652 24 001247   000167 236000 2                  LDQ     ARC_REC$
        24 001250   000001 116000 xsym               CMPQ    B_VECTNIL+1
        24 001251   001276 601000 24                 TNZ     s:24661

      959    24653    5             THEN DO;       /* Don't have buffer space yet for archive records   */

      960    24654    5               READ_ARCHIVE_EFT.BUF_ = VECTOR(ARC_REC_SIZE);

  24654 24 001252   000026 237000 25                 LDAQ    22
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:155  
        24 001253   005432 757000 2                  STAQ    READ_ARCHIVE_EFT+4

      961    24655    5               CALL M$READ( READ_ARCHIVE_EFT ) ALTRET( PACKSET_ERR );

  24655 24 001254   005426 630400 2                  EPPR0   READ_ARCHIVE_EFT
        24 001255   440000 713400                    CLIMB   alt,read
        24 001256   401400 401760                    pmme    nvectors=4
        24 001257   001523 702000 24                 TSX2    PACKSET_ERR

      962    24656    5               READ_ARCHIVE_EFT.BUF_.BOUND = ARC_REC_SIZE * 4 - 1;

  24656 24 001260   000166 236000 2                  LDQ     ARC_REC_SIZE
        24 001261   000002 736000                    QLS     2
        24 001262   000001 136007                    SBLQ    1,DL
        24 001263   000020 736000                    QLS     16
        24 001264   005432 676000 2                  ERQ     READ_ARCHIVE_EFT+4
        24 001265   000034 376000 xsym               ANQ     B_VECTNIL+28
        24 001266   005432 656000 2                  ERSQ    READ_ARCHIVE_EFT+4

      963    24657    5               CALL FLI$ALLOC( ARC_REC_SIZE, ARC_REC$ );

  24657 24 001267   000032 630400 25                 EPPR0   26
        24 001270   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 001271   000000 701000 xent               TSX1    FLI$ALLOC
        24 001272   000000 011000                    NOP     0

      964    24658    5               READ_ARCHIVE_EFT.BUF_.BUF$ = ARC_REC$;

  24658 24 001273   000167 236000 2                  LDQ     ARC_REC$
        24 001274   005433 756000 2                  STQ     READ_ARCHIVE_EFT+5

      965    24659    5               END;

  24659 24 001275   001302 710000 24                 TRA     s:24663

      966    24660    5             ELSE DO;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:156  
      967    24661    5               CALL M$READ( READ_ARCHIVE_EFT ) ALTRET( PACKSET_ERR );

  24661 24 001276   005426 630400 2                  EPPR0   READ_ARCHIVE_EFT
        24 001277   440000 713400                    CLIMB   alt,read
        24 001300   401400 401760                    pmme    nvectors=4
        24 001301   001523 702000 24                 TSX2    PACKSET_ERR

      968    24662    5               END;

      969    24663    4            CALL M$READ( READ_ARCHIVE_EFT )

  24663 24 001302   005426 630400 2                  EPPR0   READ_ARCHIVE_EFT
        24 001303   440000 713400                    CLIMB   alt,read
        24 001304   401400 401760                    pmme    nvectors=4
        24 001305   001505 702000 24                 TSX2    s:24711

      970    24664    5             WHENRETURN DO;

      971    24665        /***
      972    24666         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      973    24667         ***/
      974    24668    5               IF ARC_REC$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)

  24668 24 001306   000167 470400 2                  LDP0    ARC_REC$
        24 001307   000000 236100                    LDQ     0,,PR0
        24 001310   777000 376003                    ANQ     -512,DU
        24 001311   777000 116003                    CMPQ    -512,DU
        24 001312   001325 600000 24                 TZE     s:24674

      975    24669    5                THEN
      976    24670    6               DO;

      977    24671    6                  CALL FLI$CNVRT_ARCHIVE(ARC_REC$,TPTR$);

  24671 24 001313   200030 631500                    EPPR1   TPTR$,,AUTO
        24 001314   200071 451500                    STP1    NEW_FSN+4,,AUTO
        24 001315   000033 236000 25                 LDQ     27
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:157  
        24 001316   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 001317   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 001320   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 001321   000000 701000 xent               TSX1    FLI$CNVRT_ARCHIVE
        24 001322   000000 011000                    NOP     0

      978    24672    6                  ARC_REC$ = TPTR$;

  24672 24 001323   200030 236100                    LDQ     TPTR$,,AUTO
        24 001324   000167 756000 2                  STQ     ARC_REC$

      979    24673    6                  END;

      980    24674    5               OPTION_CHECK = ARC_REC$->ARCHIVE_LIST.OPTION.CHECK;

  24674 24 001325   000167 470400 2                  LDP0    ARC_REC$
        24 001326   000007 236100                    LDQ     7,,PR0
        24 001327   000011 736000                    QLS     9
        24 001330   400000 376003                    ANQ     -131072,DU
        24 001331   200003 756100                    STQ     OPTION_CHECK,,AUTO

      981    24675    5               OPTION_IOERRORC = ARC_REC$->ARCHIVE_LIST.OPTION.IOERRORC;

  24675 24 001332   000007 236100                    LDQ     7,,PR0
        24 001333   000012 736000                    QLS     10
        24 001334   400000 376003                    ANQ     -131072,DU
        24 001335   200004 756100                    STQ     OPTION_IOERRORC,,AUTO

      982    24676    5               ARC_SET$ = PINCRW( ARC_REC$, ARC_REC$->ARCHIVE_LIST.OFFSET.DPLIST );

  24676 24 001336   000003 720100                    LXL0    3,,PR0
        24 001337   000000 636010                    EAQ     0,X0
        24 001340   000167 036000 2                  ADLQ    ARC_REC$
        24 001341   000165 756000 2                  STQ     ARC_SET$

      983    24677                            /*** "Erase" all DP serial numbers in specified list ***/
      984    24678    6               DO NSX=0 TO DPLIST.NUM#-1;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:158  

  24678 24 001342   200021 450100                    STZ     NSX,,AUTO
        24 001343   001373 710000 24                 TRA     s:24683+1

      985    24679    7                  DO OSX=0 TO ARC_SET.NUM#-1;

  24679 24 001344   200020 450100                    STZ     OSX,,AUTO
        24 001345   001366 710000 24                 TRA     s:24682+1

      986    24680    7                     IF DPLIST.SN#(NSX) = ARC_SET.SN#(OSX)

  24680 24 001346   200021 236100                    LDQ     NSX,,AUTO
        24 001347   000006 402007                    MPY     6,DL
        24 001350   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 001351   200020 236100                    LDQ     OSX,,AUTO
        24 001352   000006 402007                    MPY     6,DL
        24 001353   000000 470400 xsym               LDP0    DPLIST$
        24 001354   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 001355   000165 471400 2                  LDP1    ARC_SET$
        24 001356   040106 106505                    CMPC    fill='040'O
        24 001357   000001 000006                    ADSC9   1,A,PR0                  cn=0,n=6
        24 001360   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6
        24 001361   001365 601000 24                 TNZ     s:24682

      987    24681    7                      THEN ARC_SET.SN#(OSX) = ' '; /* Found in new DP list       */

  24681 24 001362   040106 100400                    MLR     fill='040'O
        24 001363   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 001364   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

      988    24682    7                     END;

  24682 24 001365   200020 054100                    AOS     OSX,,AUTO
        24 001366   000165 470400 2                  LDP0    ARC_SET$
        24 001367   200020 236100                    LDQ     OSX,,AUTO
        24 001370   000000 116100                    CMPQ    0,,PR0
        24 001371   001346 604000 24                 TMI     s:24680
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:159  

      989    24683    6                  END;

  24683 24 001372   200021 054100                    AOS     NSX,,AUTO
        24 001373   000000 470400 xsym               LDP0    DPLIST$
        24 001374   200021 236100                    LDQ     NSX,,AUTO
        24 001375   000000 116100                    CMPQ    0,,PR0
        24 001376   001344 604000 24                 TMI     s:24679

      990    24684                            /*** Add all unfound serial numbers to error DP list ***/
      991    24685    6               DO OSX=0 TO ARC_SET.NUM#-1;

  24685 24 001377   200020 450100                    STZ     OSX,,AUTO
        24 001400   001500 710000 24                 TRA     s:24708+1

      992    24686    6                  IF ARC_SET.SN#(OSX) ~= ' '

  24686 24 001401   200020 236100                    LDQ     OSX,,AUTO
        24 001402   000006 402007                    MPY     6,DL
        24 001403   000165 470400 2                  LDP0    ARC_SET$
        24 001404   040000 106506                    CMPC    fill='040'O
        24 001405   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 001406   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 001407   001477 600000 24                 TZE     s:24708

      993    24687    7                   THEN DO;

      994    24688    7                     NSX = 0;

  24688 24 001410   200021 450100                    STZ     NSX,,AUTO

      995    24689    7                     FOUND = '0'B;

  24689 24 001411   200024 450100                    STZ     FOUND,,AUTO

      996    24690    8                     DO WHILE( NSX < ERROR_SET.NUM# AND NOT FOUND );

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:160  
  24690 24 001412   001432 710000 24                 TRA     s:24694

      997    24691    8                        IF ARC_SET.SN#(OSX) = ERROR_SET.SN#(NSX)

  24691 24 001413   200020 236100                    LDQ     OSX,,AUTO
        24 001414   000006 402007                    MPY     6,DL
        24 001415   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 001416   200021 236100                    LDQ     NSX,,AUTO
        24 001417   000006 402007                    MPY     6,DL
        24 001420   000165 470400 2                  LDP0    ARC_SET$
        24 001421   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 001422   006007 471400 2                  LDP1    ERROR_SET$
        24 001423   040106 106505                    CMPC    fill='040'O
        24 001424   000001 000006                    ADSC9   1,A,PR0                  cn=0,n=6
        24 001425   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6
        24 001426   001431 601000 24                 TNZ     s:24693

      998    24692    8                         THEN FOUND = '1'B;

  24692 24 001427   400000 236003                    LDQ     -131072,DU
        24 001430   200024 756100                    STQ     FOUND,,AUTO

      999    24693    8                        NSX = NSX + 1;

  24693 24 001431   200021 054100                    AOS     NSX,,AUTO

     1000    24694    8                        END;

  24694 24 001432   006007 471400 2                  LDP1    ERROR_SET$
        24 001433   200021 236100                    LDQ     NSX,,AUTO
        24 001434   100000 116100                    CMPQ    0,,PR1
        24 001435   001440 605000 24                 TPL     s:24695
        24 001436   200024 234100                    SZN     FOUND,,AUTO
        24 001437   001413 605000 24                 TPL     s:24691

     1001    24695    7                     IF NOT FOUND

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:161  
  24695 24 001440   200024 234100                    SZN     FOUND,,AUTO
        24 001441   001477 604000 24                 TMI     s:24708

     1002    24696    8                      THEN DO;             /* Add DP serial number to error list */

     1003    24697    8                        ERROR_SET.NUM# = NSX + 1;

  24697 24 001442   000001 036007                    ADLQ    1,DL
        24 001443   100000 756100                    STQ     0,,PR1

     1004    24698    8                        IF ERROR_SET.NUM# > MAX_NBR_SNS

  24698 24 001444   006007 471400 2                  LDP1    ERROR_SET$
        24 001445   100000 236100                    LDQ     0,,PR1
        24 001446   200025 116100                    CMPQ    MAX_NBR_SNS,,AUTO
        24 001447   001464 604400 24                 TMOZ    s:24705

     1005    24699    9                         THEN DO;

     1006    24700    9                           TEMP = 10 * LENGTHC(ERROR_SET.SN#(0));

  24700 24 001450   000074 235007                    LDA     60,DL
        24 001451   000175 755000 2                  STA     TEMP

     1007    24701    9                           TEMP = (TEMP + 3) / 4;

  24701 24 001452   000175 236000 2                  LDQ     TEMP
        24 001453   000003 036007                    ADLQ    3,DL
        24 001454   000004 506007                    DIV     4,DL
        24 001455   000175 756000 2                  STQ     TEMP

     1008    24702    9                           CALL FLI$ALLOC( TEMP, TEMP );

  24702 24 001456   000050 630400 25                 EPPR0   40
        24 001457   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 001460   000000 701000 xent               TSX1    FLI$ALLOC
        24 001461   000000 011000                    NOP     0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:162  

     1009    24703    9                           MAX_NBR_SNS = MAX_NBR_SNS + 10;

  24703 24 001462   000012 236007                    LDQ     10,DL
        24 001463   200025 056100                    ASQ     MAX_NBR_SNS,,AUTO

     1010    24704    9                           END;

     1011    24705    8                        ERROR_SET.SN#(NSX) = ARC_SET.SN#(OSX);

  24705 24 001464   200020 236100                    LDQ     OSX,,AUTO
        24 001465   000006 402007                    MPY     6,DL
        24 001466   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 001467   200021 236100                    LDQ     NSX,,AUTO
        24 001470   000006 402007                    MPY     6,DL
        24 001471   000165 470400 2                  LDP0    ARC_SET$
        24 001472   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 001473   006007 471400 2                  LDP1    ERROR_SET$
        24 001474   040106 100505                    MLR     fill='040'O
        24 001475   000001 000006                    ADSC9   1,A,PR0                  cn=0,n=6
        24 001476   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

     1012    24706    8                        END;

     1013    24707    7                     END;

     1014    24708    6                  END;

  24708 24 001477   200020 054100                    AOS     OSX,,AUTO
        24 001500   000165 470400 2                  LDP0    ARC_SET$
        24 001501   200020 236100                    LDQ     OSX,,AUTO
        24 001502   000000 116100                    CMPQ    0,,PR0
        24 001503   001401 604000 24                 TMI     s:24686

     1015    24709    5               END;

  24709 24 001504   001516 710000 24                 TRA     s:24714
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:163  

     1016    24710    5             WHENALTRETURN DO;

     1017    24711    5               IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF

  24711 24 001505   000000 470400 xsym               LDP0    B$TCB$
        24 001506   000000 471500                    LDP1    0,,PR0
        24 001507   100102 236100                    LDQ     66,,PR1
        24 001510   377770 376007                    ANQ     131064,DL
        24 001511   000060 116007                    CMPQ    48,DL
        24 001512   001516 600000 24                 TZE     s:24714

     1018    24712    5                THEN CALL FLI$RPT_ERR;

  24712 24 001513   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 001514   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 001515   000000 011000                    NOP     0

     1019    24713    5               END;

     1020    24714    4            CALL M$CLOSE( CLOSE_ARCHIVE_EFT ) ALTRET( PACKSET_ERR );

  24714 24 001516   000216 630400 23                 EPPR0   CLOSE_ARCHIVE_EFT
        24 001517   450001 713400                    CLIMB   alt,close
        24 001520   406000 401760                    pmme    nvectors=13
        24 001521   001523 702000 24                 TSX2    PACKSET_ERR

     1021    24715    5            DO WHILE('0'B);

  24715 24 001522   001544 710000 24                 TRA     s:24727

  24714 24 001523                       PACKSET_ERR  null
     1022    24716    5   PACKSET_ERR: ;
     1023    24717    5               CALL FLI$RPT_ERR;

  24717 24 001523   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 001524   000000 701000 xent               TSX1    FLI$RPT_ERR
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:164  
        24 001525   000000 011000                    NOP     0

     1024    24718    5               ERROR_FLAG = %YES#;

  24718 24 001526   400000 236003                    LDQ     -131072,DU
        24 001527   000221 756000 2                  STQ     ERROR_FLAG

     1025    24719    5               IF M$ARC_FILE$->F$DCB.FCD#

  24719 24 001530   004534 470400 2                  LDP0    M$ARC_FILE$
        24 001531   000031 236100                    LDQ     25,,PR0
        24 001532   020000 316007                    CANQ    8192,DL
        24 001533   001544 600000 24                 TZE     s:24727

     1026    24720    6                THEN DO;

     1027    24721    6                  CALL M$CLOSE( CLOSE_ARCHIVE_EFT )

  24721 24 001534   000216 630400 23                 EPPR0   CLOSE_ARCHIVE_EFT
        24 001535   450001 713400                    CLIMB   alt,close
        24 001536   406000 401760                    pmme    nvectors=13
        24 001537   001541 702000 24                 TSX2    s:24723
        24 001540   001544 710000 24                 TRA     s:24727

     1028    24722    7                   WHENALTRETURN DO;

     1029    24723    7                     CALL FLI$RPT_ERR;

  24723 24 001541   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 001542   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 001543   000000 011000                    NOP     0

     1030    24724    7                     END;

     1031    24725    6                  END;

     1032    24726    5               END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:165  

     1033    24727    4            END;

  24727 24 001544   001550 710000 24                 TRA     s:24731

     1034    24728    4          WHENALTRETURN DO;

     1035    24729    4            CALL FLI$RPT_ERR;

  24729 24 001545   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 001546   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 001547   000000 011000                    NOP     0

     1036    24730    4            END;

     1037    24731    3         END;

  24731 24 001550   200014 054100                    AOS     DPX,,AUTO
        24 001551   000000 470400 xsym               LDP0    DPLIST$
        24 001552   200014 236100                    LDQ     DPX,,AUTO
        24 001553   000000 116100                    CMPQ    0,,PR0
        24 001554   001213 604000 24                 TMI     s:24642

     1038    24732
     1039    24733         /***
     1040    24734          *** Error if packsets are not included on new tapes/optical disks and
     1041    24735          *** SELECTED has not been specified.
     1042    24736          ***/
     1043    24737
     1044    24738    2      IF ERROR_SET.NUM# > 0

  24738 24 001555   006007 471400 2                  LDP1    ERROR_SET$
        24 001556   100000 235100                    LDA     0,,PR1
        24 001557   001636 604400 24                 TMOZ    s:24761

     1045    24739    3       THEN DO;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:166  
     1046    24740    3         IF SELECTED

  24740 24 001560   000174 234000 2                  SZN     SELECTED
        24 001561   001576 605000 24                 TPL     s:24748

     1047    24741    4          THEN DO;

     1048    24742    4            IF OD_DEST

  24742 24 001562   200006 234100                    SZN     OD_DEST,,AUTO
        24 001563   001567 605000 24                 TPL     s:24744

     1049    24743    4             THEN WRITE_LO.BUF_ = VECTOR(NOT_INCLUDE_NOTE_OD);

  24743 24 001564   000052 237000 25                 LDAQ    42
        24 001565   006212 757000 2                  STAQ    WRITE_LO+4
        24 001566   001571 710000 24                 TRA     s:24745

     1050    24744    4             ELSE WRITE_LO.BUF_ = VECTOR(NOT_INCLUDE_NOTE);

  24744 24 001567   000054 237000 25                 LDAQ    44
        24 001570   006212 757000 2                  STAQ    WRITE_LO+4

     1051    24745    4            CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );

  24745 24 001571   006206 630400 2                  EPPR0   WRITE_LO
        24 001572   440001 713400                    CLIMB   alt,write
        24 001573   401400 401760                    pmme    nvectors=4
        24 001574   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1052    24746    4            END;

  24746 24 001575   001613 710000 24                 TRA     s:24754

     1053    24747    4          ELSE DO;

     1054    24748    4            ERROR_FLAG = '1'B;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:167  

  24748 24 001576   400000 236003                    LDQ     -131072,DU
        24 001577   000221 756000 2                  STQ     ERROR_FLAG

     1055    24749    4            IF OD_DEST

  24749 24 001600   200006 234100                    SZN     OD_DEST,,AUTO
        24 001601   001605 605000 24                 TPL     s:24751

     1056    24750    4             THEN WRITE_LO.BUF_ = VECTOR(NOT_INCLUDE_ERR_OD);

  24750 24 001602   000056 237000 25                 LDAQ    46
        24 001603   006212 757000 2                  STAQ    WRITE_LO+4
        24 001604   001607 710000 24                 TRA     s:24752

     1057    24751    4             ELSE WRITE_LO.BUF_ = VECTOR(NOT_INCLUDE_ERR);

  24751 24 001605   000060 237000 25                 LDAQ    48
        24 001606   006212 757000 2                  STAQ    WRITE_LO+4

     1058    24752    4            CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );

  24752 24 001607   006206 630400 2                  EPPR0   WRITE_LO
        24 001610   440001 713400                    CLIMB   alt,write
        24 001611   401400 401760                    pmme    nvectors=4
        24 001612   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1059    24753    4            END;

     1060    24754    3         WRITE_LO.BUF_ = VECTOR(PSN_LINE);

  24754 24 001613   000036 237000 25                 LDAQ    30
        24 001614   006212 757000 2                  STAQ    WRITE_LO+4

     1061    24755    4         DO NSX=0 TO ERROR_SET.NUM#-1;

  24755 24 001615   200021 450100                    STZ     NSX,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:168  
        24 001616   001632 710000 24                 TRA     s:24758+1

     1062    24756    4            PSN_LINE.PSN = ERROR_SET.SN#(NSX);

  24756 24 001617   200021 236100                    LDQ     NSX,,AUTO
        24 001620   000006 402007                    MPY     6,DL
        24 001621   006007 470400 2                  LDP0    ERROR_SET$
        24 001622   040000 100506                    MLR     fill='040'O
        24 001623   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 001624   005760 400006 2                  ADSC9   PSN_LINE+1               cn=2,n=6

     1063    24757    4            CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );

  24757 24 001625   006206 630400 2                  EPPR0   WRITE_LO
        24 001626   440001 713400                    CLIMB   alt,write
        24 001627   401400 401760                    pmme    nvectors=4
        24 001630   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1064    24758    4            END;

  24758 24 001631   200021 054100                    AOS     NSX,,AUTO
        24 001632   006007 470400 2                  LDP0    ERROR_SET$
        24 001633   200021 236100                    LDQ     NSX,,AUTO
        24 001634   000000 116100                    CMPQ    0,,PR0
        24 001635   001617 604000 24                 TMI     s:24756

     1065    24759    3         END;

     1066    24760
     1067    24761    2      IF NOT SELECTED AND ERROR_FLAG THEN ALTRETURN;

  24761 24 001636   000174 234000 2                  SZN     SELECTED
        24 001637   001644 604000 24                 TMI     s:24767
        24 001640   000221 234000 2                  SZN     ERROR_FLAG
        24 001641   001644 605000 24                 TPL     s:24767

  24761 24 001642   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:169  
        24 001643   000000 702211                    TSX2  ! 0,X1

     1068    24762
     1069    24763         /***
     1070    24764          *** Open old archive list.
     1071    24765          ***/
     1072    24766
     1073    24767    2      CALL M$OPEN( OPEN_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );

  24767 24 001644   006102 630400 2                  EPPR0   OPEN_ARC_LIST
        24 001645   450000 713400                    CLIMB   alt,open
        24 001646   410400 401760                    pmme    nvectors=18
        24 001647   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1074    24768
     1075    24769         /***
     1076    24770          *** If no tape/optical disk source list has yet been constructed, we'll
     1077    24771          *** have to build the list as we determine on what tapes/optical disks
     1078    24772          *** the archived files reside.  Make room for the serial
     1079    24773          *** numbers.
     1080    24774          ***/
     1081    24775
     1082    24776    2      IF FROM_SN_LIST$ = ADDR(ZERO_SN_LIST)

  24776 24 001650   000016 236000 25                 LDQ     14
        24 001651   004565 116000 2                  CMPQ    FROM_SN_LIST$
        24 001652   001670 601000 24                 TNZ     s:24784

     1083    24777    3       THEN DO;

     1084    24778    3         COLLECT_SNS = '1'B;

  24778 24 001653   400000 236003                    LDQ     -131072,DU
        24 001654   200026 756100                    STQ     COLLECT_SNS,,AUTO

     1085    24779    3         TEMP = LENGTHC(FROM_SN_LIST.NUM#) + 10 * LENGTHC(FROM_SN_LIST.SN#(0));
             24779                  /* Max 10 sns */
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:170  

  24779 24 001655   000100 235007                    LDA     64,DL
        24 001656   000175 755000 2                  STA     TEMP

     1086    24780    3         CALL FLI$ALLOC( TEMP, FROM_SN_LIST$ );

  24780 24 001657   000062 630400 25                 EPPR0   50
        24 001660   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 001661   000000 701000 xent               TSX1    FLI$ALLOC
        24 001662   000000 011000                    NOP     0

     1087    24781    3         FROM_SN_LIST.NUM# = 0;

  24781 24 001663   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 001664   000000 450100                    STZ     0,,PR0

     1088    24782    3         MAX_NBR_SNS = 10;

  24782 24 001665   000012 235007                    LDA     10,DL
        24 001666   200025 755100                    STA     MAX_NBR_SNS,,AUTO

     1089    24783    3         END;

  24783 24 001667   001671 710000 24                 TRA     s:24791

     1090    24784    2       ELSE COLLECT_SNS = '0'B;

  24784 24 001670   200026 450100                    STZ     COLLECT_SNS,,AUTO

     1091    24785
     1092    24786         /***
     1093    24787          *** Find archived files on each packset.
     1094    24788          ***/
     1095    24789
     1096    24790
     1097    24791    2      CALL FLX_ACC_LINE( 'Archived files found on disk!' ) ALTRET( RPT_ERR_CLOSE );

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:171  
  24791 24 001671   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 001672   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 001673   000001 235000 xsym               LDA     B_VECTNIL+1
        24 001674   200034 757100                    STAQ    @TITLE+1,,AUTO
        24 001675   000041 236000 25                 LDQ     33
        24 001676   200033 756100                    STQ     FORCE_NEW_OUT_BLK+1,,AUTO
        24 001677   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 001700   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1098    24792    3      DO DPX = 0 TO DPLIST.NUM# - 1;

  24792 24 001701   200014 450100                    STZ     DPX,,AUTO
        24 001702   002214 710000 24                 TRA     s:24891+1

     1099    24793
     1100    24794    3         DPSN.SN#(0) = DPLIST.SN#(DPX);    /* Next PSN                           */

  24794 24 001703   200014 236100                    LDQ     DPX,,AUTO
        24 001704   000006 402007                    MPY     6,DL
        24 001705   000000 470400 xsym               LDP0    DPLIST$
        24 001706   040000 100506                    MLR     fill='040'O
        24 001707   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 001710   005461 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

     1101    24795
     1102    24796    3         OPEN_NEXT_ARC_FILE.V.OPER.NXTA# = %YES#;

  24796 24 001711   010000 236007                    LDQ     4096,DL
        24 001712   006054 256000 2                  ORSQ    OPEN_NEXT_ARC_FILE+36

     1103    24797    3         OPEN_NEXT_ARC_FILE.NAME_ = VECTOR(INITIAL_NAME);

  24797 24 001713   000042 237000 25                 LDAQ    34
        24 001714   006016 757000 2                  STAQ    OPEN_NEXT_ARC_FILE+6

     1104    24798    3         OPEN_NEXT_ARC_FILE.ACCT_ = VECTOR(INITIAL_ACCT);

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:172  
  24798 24 001715   000044 237000 25                 LDAQ    36
        24 001716   006034 757000 2                  STAQ    OPEN_NEXT_ARC_FILE+20

     1105    24799    3         NBRFAS_PACKSET = 0;

  24799 24 001717   200015 450100                    STZ     NBRFAS_PACKSET,,AUTO

     1106    24800    3         NBRFAS_PACKSET_ACTIVE = 0;

  24800 24 001720   200016 450100                    STZ     NBRFAS_PACKSET_ACTIVE,,AUTO

     1107    24801    3         NBRFAS_PACKSET_INACTIVE = 0;

  24801 24 001721   200017 450100                    STZ     NBRFAS_PACKSET_INACTIVE,,AUTO

     1108    24802
     1109    24803    3         PACKSET_END = %NO#;

  24803 24 001722   200013 450100                    STZ     PACKSET_END,,AUTO

     1110    24804
     1111    24805    4         DO WHILE( NOT PACKSET_END );

  24805 24 001723   002211 710000 24                 TRA     s:24890

     1112    24806
     1113    24807    4            CALL M$OPEN( OPEN_NEXT_ARC_FILE )

  24807 24 001724   006010 630400 2                  EPPR0   OPEN_NEXT_ARC_FILE
        24 001725   450000 713400                    CLIMB   alt,open
        24 001726   410400 401760                    pmme    nvectors=18
        24 001727   002112 702000 24                 TSX2    s:24872

     1114    24808    5             WHENRETURN DO;

     1115    24809    5               NBRFAS = NBRFAS + 1;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:173  
  24809 24 001730   000204 054000 2                  AOS     NBRFAS

     1116    24810    5               NBRFAS_PACKSET = NBRFAS_PACKSET + 1;

  24810 24 001731   200015 054100                    AOS     NBRFAS_PACKSET,,AUTO

     1117    24811    5               IF M$ARC_FILE$->F$DCB.DESC.DELF#

  24811 24 001732   004534 470400 2                  LDP0    M$ARC_FILE$
        24 001733   000005 236100                    LDQ     5,,PR0
        24 001734   400000 316007                    CANQ    -131072,DL
        24 001735   001742 600000 24                 TZE     s:24817

     1118    24812    6                THEN DO;

     1119    24813    6                  ARC_LIST_REC.ACTIVE = 'I';

  24813 24 001736   111000 236003                    LDQ     37376,DU
        24 001737   003163 756000 2                  STQ     ARC_LIST_REC+5

     1120    24814    6                  NBRFAS_PACKSET_INACTIVE = NBRFAS_PACKSET_INACTIVE + 1;

  24814 24 001740   200017 054100                    AOS     NBRFAS_PACKSET_INACTIVE,,AUTO

     1121    24815    6                  END;

  24815 24 001741   001745 710000 24                 TRA     s:24821

     1122    24816    6                ELSE DO;

     1123    24817    6                  ARC_LIST_REC.ACTIVE = 'A';

  24817 24 001742   101000 236003                    LDQ     33280,DU
        24 001743   003163 756000 2                  STQ     ARC_LIST_REC+5

     1124    24818    6                  NBRFAS_PACKSET_ACTIVE = NBRFAS_PACKSET_ACTIVE + 1;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:174  
  24818 24 001744   200016 054100                    AOS     NBRFAS_PACKSET_ACTIVE,,AUTO

     1125    24819    6                  END;

     1126    24820
     1127    24821    5               OPEN_NEXT_ARC_FILE.NAME_ = VECTOR(NIL); /* Reset for NXTF         */

  24821 24 001745   000064 237000 25                 LDAQ    52
        24 001746   006016 757000 2                  STAQ    OPEN_NEXT_ARC_FILE+6

     1128    24822    5               OPEN_NEXT_ARC_FILE.ACCT_ = VECTOR(NIL);

  24822 24 001747   000064 237000 25                 LDAQ    52
        24 001750   006034 757000 2                  STAQ    OPEN_NEXT_ARC_FILE+20

     1129    24823    5               OPEN_NEXT_ARC_FILE.V.OPER.NXTA# = %NO#; /* Through FD, not AD     */

  24823 24 001751   000066 236000 25                 LDQ     54
        24 001752   006054 356000 2                  ANSQ    OPEN_NEXT_ARC_FILE+36

     1130    24824
     1131    24825    5               ARC_LIST_KEY.C.PSN = DPSN.SN#(0);

  24825 24 001753   040000 100400                    MLR     fill='040'O
        24 001754   005461 000006 2                  ADSC9   DPSN+1                   cn=0,n=6
        24 001755   000222 200006 2                  ADSC9   ARC_LIST_KEY             cn=1,n=6

     1132    24826    5               ARC_LIST_KEY.C.ACCT = F$DCB.ACCT#;

  24826 24 001756   040000 100500                    MLR     fill='040'O
        24 001757   000020 000010                    ADSC9   16,,PR0                  cn=0,n=8
        24 001760   000223 600010 2                  ADSC9   ARC_LIST_KEY+1           cn=3,n=8

     1133    24827    5               ARC_LIST_KEY.C.FNAMEC = F$DCB.NAME#.C;

  24827 24 001761   040000 100500                    MLR     fill='040'O
        24 001762   000010 200037                    ADSC9   8,,PR0                   cn=1,n=31
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:175  
        24 001763   000225 600037 2                  ADSC9   ARC_LIST_KEY+3           cn=3,n=31

     1134    24828    5               ARC_LIST_KEY.C.FNAMEL = F$DCB.NAME#.L;

  24828 24 001764   000010 236100                    LDQ     8,,PR0
        24 001765   000022 772000                    QRL     18
        24 001766   000235 552010 2                  STBQ    ARC_LIST_KEY+11,'10'O

     1135    24829
     1136    24830    5               CODE06$ = FPARAM_.PTR$;

  24830 24 001767   000217 236000 2                  LDQ     FPARAM_+1
        24 001770   000220 756000 2                  STQ     CODE06$

     1137    24831    5               CALL XSF$LOCCODP( CODE06$, 06 )

  24831 24 001771   000067 630400 25                 EPPR0   55
        24 001772   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 001773   000000 701000 xent               TSX1    XSF$LOCCODP
        24 001774   002100 702000 24                 TSX2    s:24864

     1138    24832    6                WHENRETURN DO;

     1139    24833    6                  ARC_LIST_REC.REEL = CODE06.STOW.REEL;

  24833 24 001775   000220 470400 2                  LDP0    CODE06$
        24 001776   040000 100500                    MLR     fill='040'O
        24 001777   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6
        24 002000   003156 000006 2                  ADSC9   ARC_LIST_REC             cn=0,n=6

     1140    24834    6                  IF M$ARC_FILE$->F$DCB.DESC.ODSTOW#

  24834 24 002001   004534 471400 2                  LDP1    M$ARC_FILE$
        24 002002   100005 236100                    LDQ     5,,PR1
        24 002003   040000 316007                    CANQ    16384,DL
        24 002004   002010 600000 24                 TZE     s:24836

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:176  
     1141    24835    6                   THEN ARC_LIST_REC.FSN = CODE06.STOW.ODFSN;

  24835 24 002005   000002 720100                    LXL0    2,,PR0
        24 002006   003157 440000 2                  SXL0    ARC_LIST_REC+1
        24 002007   002013 710000 24                 TRA     s:24837

     1142    24836    6                   ELSE ARC_LIST_REC.FSN = CODE06.STOW.EFT.FSN;

  24836 24 002010   000002 720100                    LXL0    2,,PR0
        24 002011   037777 360003                    ANX0    16383,DU
        24 002012   003157 440000 2                  SXL0    ARC_LIST_REC+1

     1143    24837    6                  IF COLLECT_SNS

  24837 24 002013   200026 234100                    SZN     COLLECT_SNS,,AUTO
        24 002014   002077 605000 24                 TPL     s:24862

     1144    24838    7                   THEN DO;                /* Add new SN to list                 */

     1145    24839    7                     IF F$DCB.DESC.ODSTOW# /* Assume same source type - all files */

  24839 24 002015   100005 236100                    LDQ     5,,PR1
        24 002016   040000 316007                    CANQ    16384,DL
        24 002017   002022 600000 24                 TZE     s:24842

     1146    24840    7                      THEN OD_SOURCE = '1'B;

  24840 24 002020   400000 236003                    LDQ     -131072,DU
        24 002021   200005 756100                    STQ     OD_SOURCE,,AUTO

     1147    24841
     1148    24842    7                     NSX = 0;

  24842 24 002022   200021 450100                    STZ     NSX,,AUTO

     1149    24843    7                     FOUND = '0'B;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:177  
  24843 24 002023   200024 450100                    STZ     FOUND,,AUTO

     1150    24844    8                     DO WHILE( NSX < FROM_SN_LIST.NUM# AND NOT FOUND );

  24844 24 002024   002037 710000 24                 TRA     s:24848

     1151    24845    8                        IF ARC_LIST_REC.REEL = FROM_SN_LIST.SN#(NSX)

  24845 24 002025   200021 236100                    LDQ     NSX,,AUTO
        24 002026   000006 402007                    MPY     6,DL
        24 002027   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002030   040106 106400                    CMPC    fill='040'O
        24 002031   003156 000006 2                  ADSC9   ARC_LIST_REC             cn=0,n=6
        24 002032   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 002033   002036 601000 24                 TNZ     s:24847

     1152    24846    8                         THEN FOUND = '1'B;

  24846 24 002034   400000 236003                    LDQ     -131072,DU
        24 002035   200024 756100                    STQ     FOUND,,AUTO

     1153    24847    8                        NSX = NSX + 1;

  24847 24 002036   200021 054100                    AOS     NSX,,AUTO

     1154    24848    8                        END;

  24848 24 002037   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002040   200021 236100                    LDQ     NSX,,AUTO
        24 002041   000000 116100                    CMPQ    0,,PR0
        24 002042   002045 605000 24                 TPL     s:24849
        24 002043   200024 234100                    SZN     FOUND,,AUTO
        24 002044   002025 605000 24                 TPL     s:24845

     1155    24849    7                     IF NOT FOUND

  24849 24 002045   200024 234100                    SZN     FOUND,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:178  
        24 002046   002077 604000 24                 TMI     s:24862

     1156    24850    8                      THEN DO;             /* Add serial number to list          */

     1157    24851    8                        FROM_SN_LIST.NUM# = NSX + 1;

  24851 24 002047   000001 036007                    ADLQ    1,DL
        24 002050   000000 756100                    STQ     0,,PR0

     1158    24852    8                        IF FROM_SN_LIST.NUM# > MAX_NBR_SNS

  24852 24 002051   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002052   000000 236100                    LDQ     0,,PR0
        24 002053   200025 116100                    CMPQ    MAX_NBR_SNS,,AUTO
        24 002054   002071 604400 24                 TMOZ    s:24859

     1159    24853    9                         THEN DO;          /* Make room for more                 */

     1160    24854    9                           TEMP = 10 * LENGTHC(FROM_SN_LIST.SN#(0));

  24854 24 002055   000074 235007                    LDA     60,DL
        24 002056   000175 755000 2                  STA     TEMP

     1161    24855    9                           TEMP = (TEMP + 3) / 4;

  24855 24 002057   000175 236000 2                  LDQ     TEMP
        24 002060   000003 036007                    ADLQ    3,DL
        24 002061   000004 506007                    DIV     4,DL
        24 002062   000175 756000 2                  STQ     TEMP

     1162    24856    9                           CALL FLI$ALLOC( TEMP, TEMP );

  24856 24 002063   000050 630400 25                 EPPR0   40
        24 002064   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 002065   000000 701000 xent               TSX1    FLI$ALLOC
        24 002066   000000 011000                    NOP     0

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:179  
     1163    24857    9                           MAX_NBR_SNS = MAX_NBR_SNS + 10;

  24857 24 002067   000012 236007                    LDQ     10,DL
        24 002070   200025 056100                    ASQ     MAX_NBR_SNS,,AUTO

     1164    24858    9                           END;

     1165    24859    8                        FROM_SN_LIST.SN#(NSX) = ARC_LIST_REC.REEL;

  24859 24 002071   200021 236100                    LDQ     NSX,,AUTO
        24 002072   000006 402007                    MPY     6,DL
        24 002073   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002074   040106 100400                    MLR     fill='040'O
        24 002075   003156 000006 2                  ADSC9   ARC_LIST_REC             cn=0,n=6
        24 002076   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6

     1166    24860    8                        END;

     1167    24861    7                     END;

     1168    24862    6                  END;

  24862 24 002077   002105 710000 24                 TRA     s:24868

     1169    24863    6                WHENALTRETURN DO;

     1170    24864    6                  ARC_LIST_REC.REEL = ' ';

  24864 24 002100   040000 100400                    MLR     fill='040'O
        24 002101   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 002102   003156 000006 2                  ADSC9   ARC_LIST_REC             cn=0,n=6

     1171    24865    6                  ARC_LIST_REC.FSN = 0;

  24865 24 002103   000000 220003                    LDX0    0,DU
        24 002104   003157 440000 2                  SXL0    ARC_LIST_REC+1

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:180  
     1172    24866    6                  END;

     1173    24867
     1174    24868    5               CALL M$WRITE( WRITE_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );

  24868 24 002105   000514 630400 23                 EPPR0   WRITE_ARC_LIST
        24 002106   440001 713400                    CLIMB   alt,write
        24 002107   401400 401760                    pmme    nvectors=4
        24 002110   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1175    24869    5               END;

  24869 24 002111   002211 710000 24                 TRA     s:24890

     1176    24870
     1177    24871    5             WHENALTRETURN DO;

     1178    24872    5               OPEN_NEXT_ARC_FILE.ACCT_ = VECTOR(NIL);

  24872 24 002112   000064 237000 25                 LDAQ    52
        24 002113   006034 757000 2                  STAQ    OPEN_NEXT_ARC_FILE+20

     1179    24873    5               CODE = B$TCB.ALT$->B$ALT.ERR.CODE;

  24873 24 002114   000000 470400 xsym               LDP0    B$TCB$
        24 002115   000000 471500                    LDP1    0,,PR0
        24 002116   100102 236100                    LDQ     66,,PR1
        24 002117   000003 772000                    QRL     3
        24 002120   037777 376007                    ANQ     16383,DL
        24 002121   000170 756000 2                  STQ     CODE

     1180    24874    5               IF CODE = %E$ADEOF

  24874 24 002122   000175 116007                    CMPQ    125,DL
        24 002123   002200 601000 24                 TNZ     s:24883

     1181    24875    6                THEN DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:181  

     1182    24876    6                  PACKSET_END = '1'B;

  24876 24 002124   400000 236003                    LDQ     -131072,DU
        24 002125   200013 756100                    STQ     PACKSET_END,,AUTO

     1183    24877    6                  PSN_TITLE.PSN = DPSN.SN#(0);

  24877 24 002126   040000 100400                    MLR     fill='040'O
        24 002127   005461 000006 2                  ADSC9   DPSN+1                   cn=0,n=6
        24 002130   005754 600006 2                  ADSC9   PSN_TITLE                cn=3,n=6

     1184    24878    6                  CALL FLX_ACC_LINE( PSN_TITLE, 0 ) ALTRET( RPT_ERR_CLOSE );

  24878 24 002131   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 002132   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 002133   000071 235000 25                 LDA     57
        24 002134   200034 757100                    STAQ    @TITLE+1,,AUTO
        24 002135   000072 236000 25                 LDQ     58
        24 002136   200033 756100                    STQ     FORCE_NEW_OUT_BLK+1,,AUTO
        24 002137   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 002140   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1185    24879    6                  CALL FLX_ACC_LINE( 'Inactive!', NBRFAS_PACKSET_INACTIVE, 1 ) ALTRET(
             24879                           RPT_ERR_CLOSE );

  24879 24 002141   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 002142   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 002143   000010 236000 25                 LDQ     8
        24 002144   200035 756100                    STQ     @NUMBER+1,,AUTO
        24 002145   200017 630500                    EPPR0   NBRFAS_PACKSET_INACTIVE,,AUTO
        24 002146   200034 450500                    STP0    @TITLE+1,,AUTO
        24 002147   000073 236000 25                 LDQ     59
        24 002150   200033 756100                    STQ     FORCE_NEW_OUT_BLK+1,,AUTO
        24 002151   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 002152   002641 702000 24                 TSX2    RPT_ERR_CLOSE

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:182  
     1186    24880    6                  CALL FLX_ACC_LINE( 'Active!', NBRFAS_PACKSET_ACTIVE, 1 ) ALTRET(
             24880                           RPT_ERR_CLOSE );

  24880 24 002153   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 002154   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 002155   000010 236000 25                 LDQ     8
        24 002156   200035 756100                    STQ     @NUMBER+1,,AUTO
        24 002157   200016 630500                    EPPR0   NBRFAS_PACKSET_ACTIVE,,AUTO
        24 002160   200034 450500                    STP0    @TITLE+1,,AUTO
        24 002161   000074 236000 25                 LDQ     60
        24 002162   200033 756100                    STQ     FORCE_NEW_OUT_BLK+1,,AUTO
        24 002163   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 002164   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1187    24881    6                  CALL FLX_ACC_LINE( 'Total!', NBRFAS_PACKSET, 2 ) ALTRET(
             24881                           RPT_ERR_CLOSE );

  24881 24 002165   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 002166   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 002167   000075 236000 25                 LDQ     61
        24 002170   200035 756100                    STQ     @NUMBER+1,,AUTO
        24 002171   200015 630500                    EPPR0   NBRFAS_PACKSET,,AUTO
        24 002172   200034 450500                    STP0    @TITLE+1,,AUTO
        24 002173   000076 236000 25                 LDQ     62
        24 002174   200033 756100                    STQ     FORCE_NEW_OUT_BLK+1,,AUTO
        24 002175   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 002176   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1188    24882    6                  END;

  24882 24 002177   002211 710000 24                 TRA     s:24890

     1189    24883    5                ELSE IF CODE = %E$FDEOF OR CODE = %E$NOKEY

  24883 24 002200   000154 116007                    CMPQ    108,DL
        24 002201   002204 600000 24                 TZE     s:24885
        24 002202   000102 116007                    CMPQ    66,DL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:183  
        24 002203   002641 601000 24                 TNZ     RPT_ERR_CLOSE

     1190    24884    6                   THEN DO;                /* Reinitialize for next account      */

     1191    24885    6                     OPEN_NEXT_ARC_FILE.V.OPER.NXTA# = %YES#;

  24885 24 002204   010000 236007                    LDQ     4096,DL
        24 002205   006054 256000 2                  ORSQ    OPEN_NEXT_ARC_FILE+36

     1192    24886    6                     OPEN_NEXT_ARC_FILE.NAME_ = VECTOR(INITIAL_NAME);

  24886 24 002206   000042 237000 25                 LDAQ    34
        24 002207   006016 757000 2                  STAQ    OPEN_NEXT_ARC_FILE+6

     1193    24887    6                     END;

  24887 24 002210   002211 710000 24                 TRA     s:24890

     1194    24888    5                   ELSE GOTO RPT_ERR_CLOSE; /* Can't handle this                 */
     1195    24889    5               END;
     1196    24890    4            END;

  24890 24 002211   200013 234100                    SZN     PACKSET_END,,AUTO
        24 002212   001724 605000 24                 TPL     s:24807

     1197    24891    3         END;

  24891 24 002213   200014 054100                    AOS     DPX,,AUTO
        24 002214   000000 470400 xsym               LDP0    DPLIST$
        24 002215   200014 236100                    LDQ     DPX,,AUTO
        24 002216   000000 116100                    CMPQ    0,,PR0
        24 002217   001703 604000 24                 TMI     s:24794

     1198    24892
     1199    24893        /***
     1200    24894         *** When collecting serial numbers, if last file crosses tape boundry, then
     1201    24895         *** add next serial number so that all of last file is processed.
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:184  
     1202    24896         ***/
     1203    24897    2      IF NBRFAS_PACKSET > 0                /* Any files found?                   */

  24897 24 002220   200015 235100                    LDA     NBRFAS_PACKSET,,AUTO
        24 002221   002315 604400 24                 TMOZ    s:24927

     1204    24898    3       THEN DO;

     1205    24899    3         EFTWORD = CODE06.STOW.EFT;

  24899 24 002222   000220 471400 2                  LDP1    CODE06$
        24 002223   100002 720100                    LXL0    2,,PR1
        24 002224   000000 740000 xsym               STX0    EFTWORD

     1206    24900    3         IF (EFTWORD.CROSS AND COLLECT_SNS)

  24900 24 002225   000000 234000 xsym               SZN     EFTWORD
        24 002226   002315 605000 24                 TPL     s:24927
        24 002227   200026 234100                    SZN     COLLECT_SNS,,AUTO
        24 002230   002315 605000 24                 TPL     s:24927

     1207    24901    4          THEN DO;

     1208    24902    4            NSX = FROM_SN_LIST.NUM#;

  24902 24 002231   004565 473400 2                  LDP3    FROM_SN_LIST$
        24 002232   300000 235100                    LDA     0,,PR3
        24 002233   200021 755100                    STA     NSX,,AUTO

     1209    24903    4            FROM_SN_LIST.NUM# = NSX + 1;

  24903 24 002234   000001 035007                    ADLA    1,DL
        24 002235   300000 755100                    STA     0,,PR3

     1210    24904    4            IF FROM_SN_LIST.NUM# > MAX_NBR_SNS

  24904 24 002236   004565 470400 2                  LDP0    FROM_SN_LIST$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:185  
        24 002237   000000 236100                    LDQ     0,,PR0
        24 002240   200025 116100                    CMPQ    MAX_NBR_SNS,,AUTO
        24 002241   002256 604400 24                 TMOZ    s:24911

     1211    24905    5             THEN DO;                      /* Make room for more                 */

     1212    24906    5               TEMP = 10 * LENGTHC(FROM_SN_LIST.SN#(0));

  24906 24 002242   000074 235007                    LDA     60,DL
        24 002243   000175 755000 2                  STA     TEMP

     1213    24907    5               TEMP = (TEMP + 3) / 4;

  24907 24 002244   000175 236000 2                  LDQ     TEMP
        24 002245   000003 036007                    ADLQ    3,DL
        24 002246   000004 506007                    DIV     4,DL
        24 002247   000175 756000 2                  STQ     TEMP

     1214    24908    5               CALL FLI$ALLOC( TEMP, TEMP );

  24908 24 002250   000050 630400 25                 EPPR0   40
        24 002251   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 002252   000000 701000 xent               TSX1    FLI$ALLOC
        24 002253   000000 011000                    NOP     0

     1215    24909    5               MAX_NBR_SNS = MAX_NBR_SNS + 10;

  24909 24 002254   000012 236007                    LDQ     10,DL
        24 002255   200025 056100                    ASQ     MAX_NBR_SNS,,AUTO

     1216    24910    5               END;

     1217    24911    4            FROM_SN_LIST.SN#(NSX) = ARC_LIST_REC.REEL;

  24911 24 002256   200021 236100                    LDQ     NSX,,AUTO
        24 002257   000006 402007                    MPY     6,DL
        24 002260   004565 470400 2                  LDP0    FROM_SN_LIST$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:186  
        24 002261   040106 100400                    MLR     fill='040'O
        24 002262   003156 000006 2                  ADSC9   ARC_LIST_REC             cn=0,n=6
        24 002263   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6

     1218    24912    4            TPTR$ = ADDR(FROM_SN_LIST.SN#(NSX));

  24912 24 002264   200021 236100                    LDQ     NSX,,AUTO
        24 002265   000077 402000 25                 MPY     63
        24 002266   000001 036003                    ADLQ    1,DU
        24 002267   004565 036000 2                  ADLQ    FROM_SN_LIST$
        24 002270   200030 756100                    STQ     TPTR$,,AUTO

     1219    24913    4            IF CT5.C2 = ' '

  24913 24 002271   200030 470500                    LDP0    TPTR$,,AUTO
        24 002272   040000 106500                    CMPC    fill='040'O
        24 002273   000001 200001                    ADSC9   1,,PR0                   cn=1,n=1
        24 002274   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 002275   002306 601000 24                 TNZ     s:24920

     1220    24914    5             THEN DO;

     1221    24915    5               CALL CHARBIN( CTN, CT5.C1 );

  24915 24 002276   000100 305500                    DTB
        24 002277   000001 030001                    NDSC9   1,,PR0                   cn=0,s=nosgn,sf=0,n=1
        24 002300   200031 000004                    NDSC9   CTN,,AUTO                cn=0,s=lsgnf,sf=0,n=4

     1222    24916    5               CTN = CTN + 1;

  24916 24 002301   200031 054100                    AOS     CTN,,AUTO

     1223    24917    5               CALL BINCHAR( CT5.C1, CTN );

  24917 24 002302   000100 301500                    BTD
        24 002303   200031 000004                    NDSC9   CTN,,AUTO                cn=0,s=lsgnf,sf=0,n=4
        24 002304   000001 030001                    NDSC9   1,,PR0                   cn=0,s=nosgn,sf=0,n=1
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:187  

     1224    24918    5               END;

  24918 24 002305   002315 710000 24                 TRA     s:24927

     1225    24919    5             ELSE DO;

     1226    24920    5               CALL CHARBIN( CTN, CT6.C1 );

  24920 24 002306   000100 305500                    DTB
        24 002307   000001 030002                    NDSC9   1,,PR0                   cn=0,s=nosgn,sf=0,n=2
        24 002310   200031 000004                    NDSC9   CTN,,AUTO                cn=0,s=lsgnf,sf=0,n=4

     1227    24921    5               CTN = CTN + 1;

  24921 24 002311   200031 054100                    AOS     CTN,,AUTO

     1228    24922    5               CALL BINCHAR( CT6.C1, CTN);

  24922 24 002312   000100 301500                    BTD
        24 002313   200031 000004                    NDSC9   CTN,,AUTO                cn=0,s=lsgnf,sf=0,n=4
        24 002314   000001 030002                    NDSC9   1,,PR0                   cn=0,s=nosgn,sf=0,n=2

     1229    24923    5               END;

     1230    24924    4            END;

     1231    24925    3         END;

     1232    24926
     1233    24927    2      CALL FLX_ACC_LINE( 'Total in archive system!', NBRFAS, 3, '1'B ) ALTRET(
             24927               RPT_ERR_CLOSE );

  24927 24 002315   000100 236000 25                 LDQ     64
        24 002316   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 002317   000102 237000 25                 LDAQ    66
        24 002320   200034 757100                    STAQ    @TITLE+1,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:188  
        24 002321   000104 236000 25                 LDQ     68
        24 002322   200033 756100                    STQ     FORCE_NEW_OUT_BLK+1,,AUTO
        24 002323   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 002324   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1234    24928    2      CALL M$CLOSE( CLOSE_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );

  24928 24 002325   000016 630400 23                 EPPR0   CLOSE_ARC_LIST
        24 002326   450001 713400                    CLIMB   alt,close
        24 002327   406000 401760                    pmme    nvectors=13
        24 002330   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1235    24929
     1236    24930         /***
     1237    24931          *** Now process source tape/optical disk list deleting any which should
     1238    24932          *** be ommitted.
     1239    24933          ***/
     1240    24934
     1241    24935    2      IF OMIT_SN_LIST$ ~= ADDR(ZERO_SN_LIST)

  24935 24 002331   000016 236000 25                 LDQ     14
        24 002332   004564 116000 2                  CMPQ    OMIT_SN_LIST$
        24 002333   002472 600000 24                 TZE     s:24979

     1242    24936    3       THEN DO;                            /* Some should be ommitted            */

     1243    24937    3         MAX_NBR_SNS = OMIT_SN_LIST.NUM#;

  24937 24 002334   004564 470400 2                  LDP0    OMIT_SN_LIST$
        24 002335   000000 235100                    LDA     0,,PR0
        24 002336   200025 755100                    STA     MAX_NBR_SNS,,AUTO

     1244    24938    4         DO OSX = 0 TO OMIT_SN_LIST.NUM#-1;

  24938 24 002337   200020 450100                    STZ     OSX,,AUTO
        24 002340   002407 710000 24                 TRA     s:24952+1

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:189  
     1245    24939    4            FOUND = '0'B;

  24939 24 002341   200024 450100                    STZ     FOUND,,AUTO

     1246    24940    5            DO NSX = 0 TO FROM_SN_LIST.NUM#-1;

  24940 24 002342   200021 450100                    STZ     NSX,,AUTO
        24 002343   002370 710000 24                 TRA     s:24946+1

     1247    24941    5               IF FROM_SN_LIST.SN#(NSX) = OMIT_SN_LIST.SN#(OSX)

  24941 24 002344   200021 236100                    LDQ     NSX,,AUTO
        24 002345   000006 402007                    MPY     6,DL
        24 002346   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 002347   200020 236100                    LDQ     OSX,,AUTO
        24 002350   000006 402007                    MPY     6,DL
        24 002351   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002352   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 002353   004564 471400 2                  LDP1    OMIT_SN_LIST$
        24 002354   040106 106505                    CMPC    fill='040'O
        24 002355   000001 000006                    ADSC9   1,A,PR0                  cn=0,n=6
        24 002356   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6
        24 002357   002367 601000 24                 TNZ     s:24946

     1248    24942    6                THEN DO;

     1249    24943    6                  FROM_SN_LIST.SN#(NSX) = ' ';

  24943 24 002360   200021 236100                    LDQ     NSX,,AUTO
        24 002361   000006 402007                    MPY     6,DL
        24 002362   040106 100400                    MLR     fill='040'O
        24 002363   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 002364   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6

     1250    24944    6                  FOUND = '1'B;

  24944 24 002365   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:190  
        24 002366   200024 756100                    STQ     FOUND,,AUTO

     1251    24945    6                  END;

     1252    24946    5               END;

  24946 24 002367   200021 054100                    AOS     NSX,,AUTO
        24 002370   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002371   200021 236100                    LDQ     NSX,,AUTO
        24 002372   000000 116100                    CMPQ    0,,PR0
        24 002373   002344 604000 24                 TMI     s:24941

     1253    24947    4            IF FOUND

  24947 24 002374   200024 234100                    SZN     FOUND,,AUTO
        24 002375   002406 605000 24                 TPL     s:24952

     1254    24948    5             THEN DO;

     1255    24949    5               OMIT_SN_LIST.SN#(OSX) = ' ';

  24949 24 002376   200020 236100                    LDQ     OSX,,AUTO
        24 002377   000006 402007                    MPY     6,DL
        24 002400   004564 471400 2                  LDP1    OMIT_SN_LIST$
        24 002401   040106 100400                    MLR     fill='040'O
        24 002402   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 002403   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

     1256    24950    5               MAX_NBR_SNS = MAX_NBR_SNS - 1;

  24950 24 002404   000001 336007                    LCQ     1,DL
        24 002405   200025 056100                    ASQ     MAX_NBR_SNS,,AUTO

     1257    24951    5               END;

     1258    24952    4            END;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:191  
  24952 24 002406   200020 054100                    AOS     OSX,,AUTO
        24 002407   004564 470400 2                  LDP0    OMIT_SN_LIST$
        24 002410   200020 236100                    LDQ     OSX,,AUTO
        24 002411   000000 116100                    CMPQ    0,,PR0
        24 002412   002341 604000 24                 TMI     s:24939

     1259    24953    3         IF MAX_NBR_SNS > 0

  24953 24 002413   200025 235100                    LDA     MAX_NBR_SNS,,AUTO
        24 002414   002472 604400 24                 TMOZ    s:24979

     1260    24954    4          THEN DO;                         /* Couldn't find some sns to omit     */

     1261    24955    4            IF OD_SOURCE

  24955 24 002415   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 002416   002422 605000 24                 TPL     s:24957

     1262    24956    4             THEN WRITE_LO.BUF_ = VECTOR(COULDNT_OMIT_OD);

  24956 24 002417   000106 237000 25                 LDAQ    70
        24 002420   006212 757000 2                  STAQ    WRITE_LO+4
        24 002421   002424 710000 24                 TRA     s:24958

     1263    24957    4             ELSE WRITE_LO.BUF_ = VECTOR(COULDNT_OMIT);

  24957 24 002422   000110 237000 25                 LDAQ    72
        24 002423   006212 757000 2                  STAQ    WRITE_LO+4

     1264    24958    4            CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );

  24958 24 002424   006206 630400 2                  EPPR0   WRITE_LO
        24 002425   440001 713400                    CLIMB   alt,write
        24 002426   401400 401760                    pmme    nvectors=4
        24 002427   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1265    24959    4            IF OD_SOURCE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:192  

  24959 24 002430   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 002431   002435 605000 24                 TPL     s:24961

     1266    24960    4             THEN WRITE_LO.BUF_ = VECTOR(ODSN_LINE);

  24960 24 002432   000112 237000 25                 LDAQ    74
        24 002433   006212 757000 2                  STAQ    WRITE_LO+4
        24 002434   002437 710000 24                 TRA     s:24962

     1267    24961    4             ELSE WRITE_LO.BUF_ = VECTOR(TSN_LINE);

  24961 24 002435   000114 237000 25                 LDAQ    76
        24 002436   006212 757000 2                  STAQ    WRITE_LO+4

     1268    24962    5            DO I=0 TO OMIT_SN_LIST.NUM#-1;

  24962 24 002437   000205 450000 2                  STZ     I
        24 002440   002466 710000 24                 TRA     s:24970+1

     1269    24963    5               IF OMIT_SN_LIST.SN#(I) ~= ' '

  24963 24 002441   000205 236000 2                  LDQ     I
        24 002442   000006 402007                    MPY     6,DL
        24 002443   004564 470400 2                  LDP0    OMIT_SN_LIST$
        24 002444   040000 106506                    CMPC    fill='040'O
        24 002445   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 002446   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 002447   002465 600000 24                 TZE     s:24970

     1270    24964    6                THEN DO;

     1271    24965    6                  IF OD_SOURCE

  24965 24 002450   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 002451   002456 605000 24                 TPL     s:24967

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:193  
     1272    24966    6                   THEN ODSN_LINE.TSN = OMIT_SN_LIST.SN#(I);

  24966 24 002452   040000 100506                    MLR     fill='040'O
        24 002453   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 002454   005766 400006 2                  ADSC9   ODSN_LINE+1              cn=2,n=6
        24 002455   002461 710000 24                 TRA     s:24968

     1273    24967    6                   ELSE TSN_LINE.TSN = OMIT_SN_LIST.SN#(I);

  24967 24 002456   040000 100506                    MLR     fill='040'O
        24 002457   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 002460   005763 400006 2                  ADSC9   TSN_LINE+1               cn=2,n=6

     1274    24968    6                  CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );

  24968 24 002461   006206 630400 2                  EPPR0   WRITE_LO
        24 002462   440001 713400                    CLIMB   alt,write
        24 002463   401400 401760                    pmme    nvectors=4
        24 002464   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1275    24969    6                  END;

     1276    24970    5               END;

  24970 24 002465   000205 054000 2                  AOS     I
        24 002466   004564 470400 2                  LDP0    OMIT_SN_LIST$
        24 002467   000205 236000 2                  LDQ     I
        24 002470   000000 116100                    CMPQ    0,,PR0
        24 002471   002441 604000 24                 TMI     s:24963

     1277    24971    4            END;

     1278    24972    3         END;

     1279    24973
     1280    24974
     1281    24975         /***
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:194  
     1282    24976          *** Now clean up source tape/optical disk list deleting all blank entries.
     1283    24977          ***/
     1284    24978
     1285    24979    2      NSX = 0;

  24979 24 002472   200021 450100                    STZ     NSX,,AUTO

     1286    24980    3      DO I=0 TO FROM_SN_LIST.NUM#-1;

  24980 24 002473   000205 450000 2                  STZ     I
        24 002474   002515 710000 24                 TRA     s:24986+1

     1287    24981    3         IF FROM_SN_LIST.SN#(I) ~= ' '

  24981 24 002475   000205 236000 2                  LDQ     I
        24 002476   000006 402007                    MPY     6,DL
        24 002477   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002500   040000 106506                    CMPC    fill='040'O
        24 002501   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 002502   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 002503   002514 600000 24                 TZE     s:24986

     1288    24982    4          THEN DO;

     1289    24983    4            FROM_SN_LIST.SN#(NSX) = FROM_SN_LIST.SN#(I);

  24983 24 002504   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 002505   200021 236100                    LDQ     NSX,,AUTO
        24 002506   000006 402007                    MPY     6,DL
        24 002507   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 002510   040106 100505                    MLR     fill='040'O
        24 002511   000001 000006                    ADSC9   1,A,PR0                  cn=0,n=6
        24 002512   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6

     1290    24984    4            NSX = NSX + 1;

  24984 24 002513   200021 054100                    AOS     NSX,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:195  

     1291    24985    4            END;

     1292    24986    3         END;

  24986 24 002514   000205 054000 2                  AOS     I
        24 002515   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002516   000205 236000 2                  LDQ     I
        24 002517   000000 116100                    CMPQ    0,,PR0
        24 002520   002475 604000 24                 TMI     s:24981

     1293    24987    2      FROM_SN_LIST.NUM# = NSX;

  24987 24 002521   200021 235100                    LDA     NSX,,AUTO
        24 002522   000000 755100                    STA     0,,PR0

     1294    24988
     1295    24989    2      IF NSX <= 0

  24989 24 002523   002541 605400 24                 TPNZ    s:24998

     1296    24990    3       THEN DO;

     1297    24991    3         IF OD_SOURCE

  24991 24 002524   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 002525   002531 605000 24                 TPL     s:24993

     1298    24992    3          THEN WRITE_LO.BUF_ = VECTOR(NO_SOURCE_ODS);

  24992 24 002526   000116 237000 25                 LDAQ    78
        24 002527   006212 757000 2                  STAQ    WRITE_LO+4
        24 002530   002533 710000 24                 TRA     s:24994

     1299    24993    3          ELSE WRITE_LO.BUF_ = VECTOR(NO_SOURCE_TAPES);

  24993 24 002531   000120 237000 25                 LDAQ    80
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:196  
        24 002532   006212 757000 2                  STAQ    WRITE_LO+4

     1300    24994    3         CALL M$WRITE( WRITE_LO ) ALTRET( RPT_ERR_CLOSE );

  24994 24 002533   006206 630400 2                  EPPR0   WRITE_LO
        24 002534   440001 713400                    CLIMB   alt,write
        24 002535   401400 401760                    pmme    nvectors=4
        24 002536   002641 702000 24                 TSX2    RPT_ERR_CLOSE

     1301    24995    3         ALTRETURN;

  24995 24 002537   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 002540   000000 702211                    TSX2  ! 0,X1

     1302    24996    3         END;
     1303    24997
     1304    24998    2      IF COLLECT_SNS

  24998 24 002541   200026 234100                    SZN     COLLECT_SNS,,AUTO
        24 002542   002637 605000 24                 TPL     s:25019

     1305    24999    3       THEN DO;                  /* Tape/optical disk source FPT must be set up  */

     1306    25000    3         IF NSX > 1

  25000 24 002543   000001 115007                    CMPA    1,DL
        24 002544   002622 604400 24                 TMOZ    s:25013

     1307    25001    4          THEN DO;                         /* Sort serial number list            */

     1308    25002    5            DO NSX=0 TO FROM_SN_LIST.NUM#-2;

  25002 24 002545   200021 450100                    STZ     NSX,,AUTO
        24 002546   002615 710000 24                 TRA     s:25011+1

     1309    25003    6               DO OSX=NSX TO FROM_SN_LIST.NUM#-1;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:197  
  25003 24 002547   200021 235100                    LDA     NSX,,AUTO
        24 002550   200020 755100                    STA     OSX,,AUTO
        24 002551   002610 710000 24                 TRA     s:25010+1

     1310    25004    6                  IF FROM_SN_LIST.SN#(NSX) > FROM_SN_LIST.SN#(OSX)

  25004 24 002552   200020 236100                    LDQ     OSX,,AUTO
        24 002553   000006 402007                    MPY     6,DL
        24 002554   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 002555   200021 236100                    LDQ     NSX,,AUTO
        24 002556   000006 402007                    MPY     6,DL
        24 002557   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002560   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 002561   040106 106505                    CMPC    fill='040'O
        24 002562   000001 000006                    ADSC9   1,A,PR0                  cn=0,n=6
        24 002563   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 002564   002607 603000 24                 TRC     s:25010

     1311    25005    7                   THEN DO;                /* Swap                               */

     1312    25006    7                     SN = FROM_SN_LIST.SN#(NSX);

  25006 24 002565   040100 100506                    MLR     fill='040'O
        24 002566   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 002567   200022 000006                    ADSC9   SN,,AUTO                 cn=0,n=6

     1313    25007    7                     FROM_SN_LIST.SN#(NSX) = FROM_SN_LIST.SN#(OSX);

  25007 24 002570   200020 236100                    LDQ     OSX,,AUTO
        24 002571   000006 402007                    MPY     6,DL
        24 002572   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 002573   200021 236100                    LDQ     NSX,,AUTO
        24 002574   000006 402007                    MPY     6,DL
        24 002575   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 002576   040106 100505                    MLR     fill='040'O
        24 002577   000001 000006                    ADSC9   1,A,PR0                  cn=0,n=6
        24 002600   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:198  

     1314    25008    7                     FROM_SN_LIST.SN#(OSX) = SN;

  25008 24 002601   200020 236100                    LDQ     OSX,,AUTO
        24 002602   000006 402007                    MPY     6,DL
        24 002603   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002604   040106 100500                    MLR     fill='040'O
        24 002605   200022 000006                    ADSC9   SN,,AUTO                 cn=0,n=6
        24 002606   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6

     1315    25009    7                     END;

     1316    25010    6                  END;

  25010 24 002607   200020 054100                    AOS     OSX,,AUTO
        24 002610   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002611   200020 236100                    LDQ     OSX,,AUTO
        24 002612   000000 116100                    CMPQ    0,,PR0
        24 002613   002552 604000 24                 TMI     s:25004

     1317    25011    5               END;

  25011 24 002614   200021 054100                    AOS     NSX,,AUTO
        24 002615   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002616   000000 236100                    LDQ     0,,PR0
        24 002617   000002 136007                    SBLQ    2,DL
        24 002620   200021 116100                    CMPQ    NSX,,AUTO
        24 002621   002547 605000 24                 TPL     s:25003

     1318    25012    4            END;

     1319    25013    3         TVECTOR = VECTOR(FROM_SN_LIST);

  25013 24 002622   000024 235000 25                 LDA     20
        24 002623   004565 236000 2                  LDQ     FROM_SN_LIST$
        24 002624   000000 757000 xsym               STAQ    TVECTOR

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:199  
     1320    25014    3         TVECTOR.W1.VSIZE# = LENGTHC(FROM_SN_LIST.NUM#)

  25014 24 002625   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 002626   000000 236100                    LDQ     0,,PR0
        24 002627   000006 402007                    MPY     6,DL
        24 002630   000003 036007                    ADLQ    3,DL
        24 002631   000020 736000                    QLS     16
        24 002632   000000 676000 xsym               ERQ     TVECTOR
        24 002633   000034 376000 xsym               ANQ     B_VECTNIL+28
        24 002634   000000 656000 xsym               ERSQ    TVECTOR

     1321    25015    3           + FROM_SN_LIST.NUM# * LENGTHC(FROM_SN_LIST.SN#(0)) - 1;
     1322    25016    3         OPEN_TAPE_SOURCE.SN_ = TVECTOR;

  25016 24 002635   000000 237000 xsym               LDAQ    TVECTOR
        24 002636   004570 757000 2                  STAQ    OPEN_TAPE_SOURCE+2

     1323    25017    3         END;

     1324    25018
     1325    25019    2      RETURN;

  25019 24 002637   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 002640   000001 702211                    TSX2  ! 1,X1

  25014 24 002641                       RPT_ERR_CLO* null
     1326    25020
     1327    25021    2   RPT_ERR_CLOSE: ;
     1328    25022    2      CALL FLI$RPT_ERR;

  25022 24 002641   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 002642   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 002643   000000 011000                    NOP     0

     1329    25023    2      IF M$ARC_LIST$->F$DCB.FCD#

  25023 24 002644   004536 470400 2                  LDP0    M$ARC_LIST$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:200  
        24 002645   000031 236100                    LDQ     25,,PR0
        24 002646   020000 316007                    CANQ    8192,DL
        24 002647   002660 600000 24                 TZE     s:25031

     1330    25024    3       THEN DO;

     1331    25025    3         CALL M$CLOSE( CLOSE_ARC_LIST )

  25025 24 002650   000016 630400 23                 EPPR0   CLOSE_ARC_LIST
        24 002651   450001 713400                    CLIMB   alt,close
        24 002652   406000 401760                    pmme    nvectors=13
        24 002653   002655 702000 24                 TSX2    s:25027
        24 002654   002660 710000 24                 TRA     s:25031

     1332    25026    4          WHENALTRETURN DO;

     1333    25027    4            CALL FLI$RPT_ERR;

  25027 24 002655   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 002656   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 002657   000000 011000                    NOP     0

     1334    25028    4            END;

     1335    25029    3         END;

     1336    25030
     1337    25031    2      ALTRETURN;

  25031 24 002660   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 002661   000000 702211                    TSX2  ! 0,X1

     1338    25032
     1339    25033    2   END FLX_FIND_ARC_FILES;
     1340    25034        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:201  
     1341    25035    1   FLX_MAKE_NEW_ARCHIVE_TAPES: PROC ALTRET;

  25035 24 002662   200012 741300       FLX_MAKE_NE* STX1  ! CONTROLLED_SOURCE+3,,AUTO

     1342    25036        /*F*  NAME: FLX_MAKE_NEW_ARCHIVE_TAPES
     1343    25037              PURPOSE: Converts old archive tape/optical disk to new archive tapes/
     1344    25038                       optical disks.
     1345    25039        */
     1346    25040
     1347    25041         /***
     1348    25042          *** STATIC
     1349    25043          ***/
     1350    25044
     1351    25045        %VLP_NAME( FPTN=VLP_NAME,
     1352    25046                   LEN=31,
     1353    25047                   STCLASS=STATIC );
     1354    25074
     1355    25075         /***
     1356    25076          *** CONSTANT
     1357    25077          ***/
     1358    25078
     1359    25079    2   DCL NAME_ VECTOR DALIGNED CONSTANT INIT(VECTOR(VLP_NAME));
     1360    25080
     1361    25081         /***
     1362    25082          *** AUTO
     1363    25083          ***/
     1364    25084
     1365    25085    2   DCL SN CHAR(6) AUTO;
     1366    25086    2   DCL FSN SBIN AUTO;
     1367    25087    2   DCL CROSS CHAR(1) AUTO;
     1368    25088        %VLP_ERRCODE( FPTN=ERR,
     1369    25089                      STCLASS=AUTO );
     1370    25134        %VLP_ERRCODE( FPTN=ERR_SAVE,
     1371    25135                      STCLASS=AUTO );
     1372    25180    2   DCL DCB# UBIN WORD AUTO;
     1373    25181    2   DCL READING_TAPE_SOURCE BIT(1) AUTO;
     1374    25182    2   DCL FOUND_PACKED_FILE BIT(1) AUTO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:202  
     1375    25183    2   DCL OUTPUT_TAPE_OPEN BIT(1) AUTO;
     1376    25184    2   DCL SKIP_FILE BIT(1) AUTO;
     1377    25185    2   DCL NEW_FILE BIT(1) AUTO;
     1378    25186    2   DCL NEW_BLOCK BIT(1) AUTO;
     1379    25187    2   DCL NBR_ARCH_FILES_TO_PROCESS SBIN AUTO; /* Number of arch. files left to proc. */
     1380    25188    2   DCL NBR_SUB_FILES SBIN AUTO;
     1381    25189    2   DCL FORCE_NEW_OUT_BLK BIT(1) AUTO;
     1382    25190    2   DCL NBR_IN_OUT_BLK SBIN AUTO;
     1383    25191    2  DCL NBR_IN_PREV_OUT_BLK SBIN AUTO; /* Nbr. in prev. output blk. - already on tape */
     1384    25192    2   DCL RPT_ERR BIT(1) AUTO;
     1385    25193    2   DCL NIX SBIN AUTO;
     1386    25194    2   DCL OPEN_BY_FSN BIT(1) AUTO;
     1387    25195    2   DCL FIRST_SOURCE_FILE BIT(1) AUTO; /* Set if processing first source file     */
     1388    25196    2   DCL TEMP_FLG BIT(1) AUTO;
     1389    25197    2   DCL IOERRORC BIT(1) AUTO;          /* Continue processing after I/O error     */
     1390    25198    2   DCL GET_NXT_VOL BIT(1) AUTO;       /* Indicates whether to get next volume    */
     1391    25199    2   DCL INPUT_FSN SBIN AUTO;      /* Initial FSN. Specified by user or default    */
     1392    25200
     1393    25201        %FPT_DELREC( FPTN=DEL_ARC_LIST_BY_KEY,
     1394    25202                    DCB=M$ARC_LIST,
     1395    25203                    STCLASS=STATIC );
     1396    25222
     1397    25223
     1398    25224        /****************************************/
     1399    25225
     1400    25226         /***
     1401    25227          *** Manually initialize tape/optical disk source open FPT.
     1402    25228          *** Initizalation done here as source input may not be spec'd.
     1403    25229          ***/
     1404    25230
     1405    25231    2      OPEN_TAPE_SOURCE.V.ACS# = %BLOCK#;

  25231 24 002663   000003 236007                    LDQ     3,DL
        24 002664   004634 552004 2                  STBQ    OPEN_TAPE_SOURCE+38,'04'O

     1406    25232    2      OPEN_TAPE_SOURCE.V.INITZ.SCRUB# = %YES#;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:203  
  25232 24 002665   400000 236007                    LDQ     -131072,DL
        24 002666   004632 256000 2                  ORSQ    OPEN_TAPE_SOURCE+36

     1407    25233    2      OPEN_TAPE_SOURCE.V.FUN# = %IN#;

  25233 24 002667   002000 236007                    LDQ     1024,DL
        24 002670   004633 552010 2                  STBQ    OPEN_TAPE_SOURCE+37,'10'O

     1408    25234    2      OPEN_TAPE_SOURCE.V.OPER.NXTF# = %YES#;

  25234 24 002671   004000 236007                    LDQ     2048,DL
        24 002672   004632 256000 2                  ORSQ    OPEN_TAPE_SOURCE+36

     1409    25235    2      OPEN_TAPE_SOURCE.V.OPER.THISF# = %NO#;

  25235 24 002673   000122 236000 25                 LDQ     82
        24 002674   004632 356000 2                  ANSQ    OPEN_TAPE_SOURCE+36

     1410    25236    2      OPEN_TAPE_SOURCE.V.FINDPOS# = %NO#;

  25236 24 002675   000123 236000 25                 LDQ     83
        24 002676   004632 356000 2                  ANSQ    OPEN_TAPE_SOURCE+36

     1411    25237    2      OPEN_TAPE_SOURCE.FPARAM_ = FPARAM_;

  25237 24 002677   000216 237000 2                  LDAQ    FPARAM_
        24 002700   004616 757000 2                  STAQ    OPEN_TAPE_SOURCE+24

     1412    25238        /***
     1413    25239         *** Tape - Cont. proc. after I/O error if cont. spec'd on input or output
     1414    25240         *** OD - Cont. prov. after I/O error if cont. spec'd on input
     1415    25241         ***/
     1416    25242    2      IF OD_SOURCE

  25242 24 002701   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 002702   002733 605000 24                 TPL     s:25252

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:204  
     1417    25243    3       THEN DO;

     1418    25244    3         OPEN_TAPE_SOURCE.V.ASN# = %FILE#;

  25244 24 002703   000001 236007                    LDQ     1,DL
        24 002704   004633 552004 2                  STBQ    OPEN_TAPE_SOURCE+37,'04'O

     1419    25245    3         OPEN_TAPE_SOURCE.V.CVOL# = %NO#;

  25245 24 002705   000124 236000 25                 LDQ     84
        24 002706   004632 356000 2                  ANSQ    OPEN_TAPE_SOURCE+36

     1420    25246    3         OPEN_TAPE_SOURCE.V.RES# = 'OD';

  25246 24 002707   001023 236000 23                 LDQ     DASHES+60
        24 002710   777777 376003                    ANQ     -1,DU
        24 002711   040040 276007                    ORQ     16416,DL
        24 002712   004636 756000 2                  STQ     OPEN_TAPE_SOURCE+40

     1421    25247    3         IOERRORC = ARCOM_OPTIONS.IOERRORCI;

  25247 24 002713   000000 236000 xsym               LDQ     ARCOM_OPTIONS
        24 002714   000001 736000                    QLS     1
        24 002715   400000 376003                    ANQ     -131072,DU
        24 002716   200042 756100                    STQ     IOERRORC,,AUTO

     1422    25248    3         OPEN_TAPE_SOURCE.V.IOERROK# = IOERRORC;

  25248 24 002717   200042 236100                    LDQ     IOERRORC,,AUTO
        24 002720   400000 376003                    ANQ     -131072,DU
        24 002721   000007 772000                    QRL     7
        24 002722   004646 676000 2                  ERQ     OPEN_TAPE_SOURCE+48
        24 002723   003000 376003                    ANQ     1536,DU
        24 002724   004646 656000 2                  ERSQ    OPEN_TAPE_SOURCE+48

     1423    25249    3         READ_TAPE_SOURCE.V.IOERROK# = IOERRORC;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:205  
  25249 24 002725   200042 236100                    LDQ     IOERRORC,,AUTO
        24 002726   000031 772000                    QRL     25
        24 002727   004670 676000 2                  ERQ     READ_TAPE_SOURCE+8
        24 002730   002000 376007                    ANQ     1024,DL
        24 002731   004670 656000 2                  ERSQ    READ_TAPE_SOURCE+8

     1424    25250    3         END;

  25250 24 002732   002771 710000 24                 TRA     s:25264

     1425    25251    3       ELSE DO;

     1426    25252    3         OPEN_TAPE_SOURCE.V.ASN# = %TAPE#;

  25252 24 002733   000002 236007                    LDQ     2,DL
        24 002734   004633 552004 2                  STBQ    OPEN_TAPE_SOURCE+37,'04'O

     1427    25253    3         OPEN_TAPE_SOURCE.V.CVOL# = %YES#;

  25253 24 002735   004632 236000 2                  LDQ     OPEN_TAPE_SOURCE+36
        24 002736   000124 376000 25                 ANQ     84
        24 002737   000004 276007                    ORQ     4,DL
        24 002740   004632 756000 2                  STQ     OPEN_TAPE_SOURCE+36

     1428    25254    3         OPEN_TAPE_SOURCE.V.RES# = 'LT';

  25254 24 002741   001024 236000 23                 LDQ     DASHES+61
        24 002742   777777 376003                    ANQ     -1,DU
        24 002743   040040 276007                    ORQ     16416,DL
        24 002744   004636 756000 2                  STQ     OPEN_TAPE_SOURCE+40

     1429    25255    3         IOERRORC = ARCOM_OPTIONS.IOERRORCI | ARCOM_OPTIONS.IOERRORCO;

  25255 24 002745   000000 236000 xsym               LDQ     ARCOM_OPTIONS
        24 002746   000002 736000                    QLS     2
        24 002747   400000 376003                    ANQ     -131072,DU
        24 002750   200070 756100                    STQ     NEW_FSN+3,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:206  
        24 002751   000000 236000 xsym               LDQ     ARCOM_OPTIONS
        24 002752   000001 736000                    QLS     1
        24 002753   400000 376003                    ANQ     -131072,DU
        24 002754   200070 276100                    ORQ     NEW_FSN+3,,AUTO
        24 002755   200042 756100                    STQ     IOERRORC,,AUTO

     1430    25256    3         OPEN_TAPE_SOURCE.V.IOERROK# = IOERRORC;

  25256 24 002756   200042 236100                    LDQ     IOERRORC,,AUTO
        24 002757   400000 376003                    ANQ     -131072,DU
        24 002760   000007 772000                    QRL     7
        24 002761   004646 676000 2                  ERQ     OPEN_TAPE_SOURCE+48
        24 002762   003000 376003                    ANQ     1536,DU
        24 002763   004646 656000 2                  ERSQ    OPEN_TAPE_SOURCE+48

     1431    25257    3         READ_TAPE_SOURCE.V.IOERROK# = IOERRORC;

  25257 24 002764   200042 236100                    LDQ     IOERRORC,,AUTO
        24 002765   000031 772000                    QRL     25
        24 002766   004670 676000 2                  ERQ     READ_TAPE_SOURCE+8
        24 002767   002000 376007                    ANQ     1024,DL
        24 002770   004670 656000 2                  ERSQ    READ_TAPE_SOURCE+8

     1432    25258    3         END;

     1433    25259
     1434    25260         /***
     1435    25261          *** Initialization.
     1436    25262          ***/
     1437    25263
     1438    25264    2      READ_TAPE_SOURCE.BUF_ = INBUF_;

  25264 24 002771   000214 237000 2                  LDAQ    INBUF_
        24 002772   004664 757000 2                  STAQ    READ_TAPE_SOURCE+4

     1439    25265    2      OUTPUT_TAPE_OPEN = '0'B;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:207  
  25265 24 002773   200024 450100                    STZ     OUTPUT_TAPE_OPEN,,AUTO

     1440    25266    2      NBR_SUB_FILES = 0;

  25266 24 002774   200031 450100                    STZ     NBR_SUB_FILES,,AUTO

     1441    25267
     1442    25268    2      PREV_REEL = ' ';

  25268 24 002775   040000 100400                    MLR     fill='040'O
        24 002776   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 002777   004561 000006 2                  ADSC9   PREV_REEL                cn=0,n=6

     1443    25269    2      NBR_IN_OUT_BLK = 0;

  25269 24 003000   200033 450100                    STZ     NBR_IN_OUT_BLK,,AUTO

     1444    25270    2      NBR_IN_PREV_OUT_BLK = 0;

  25270 24 003001   200034 450100                    STZ     NBR_IN_PREV_OUT_BLK,,AUTO

     1445    25271    2      NEW_FILE = '1'B;

  25271 24 003002   400000 236003                    LDQ     -131072,DU
        24 003003   200026 756100                    STQ     NEW_FILE,,AUTO

     1446    25272    2      NEW_BLOCK = '1'B;

  25272 24 003004   200027 756100                    STQ     NEW_BLOCK,,AUTO

     1447    25273    2      FIRST_SOURCE_FILE = '1'B;

  25273 24 003005   200040 756100                    STQ     FIRST_SOURCE_FILE,,AUTO

     1448    25274    2      SKIP_FILE = '0'B;

  25274 24 003006   200025 450100                    STZ     SKIP_FILE,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:208  

     1449    25275    2      LAST_TSN_USED = ' ';

  25275 24 003007   040000 100400                    MLR     fill='040'O
        24 003010   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 003011   000000 000006 xsym               ADSC9   LAST_TSN_USED            cn=0,n=6

     1450    25276    2      NBRFAS_FOUND_UPDATED = 0;

  25276 24 003012   000202 450000 2                  STZ     NBRFAS_FOUND_UPDATED

     1451    25277    2      NBRFAS_FOUND_UNUPDATED = 0;

  25277 24 003013   000203 450000 2                  STZ     NBRFAS_FOUND_UNUPDATED

     1452    25278    2      INPUT_FSN = OPEN_TAPE_SOURCE.V.FSN#; /* Save starting input FSN            */

  25278 24 003014   004654 235000 2                  LDA     OPEN_TAPE_SOURCE+54
        24 003015   000022 771000                    ARL     18
        24 003016   200044 755100                    STA     INPUT_FSN,,AUTO

     1453    25279    2      NBR_ARCH_FILES_TO_PROCESS = NBRFAS;

  25279 24 003017   000204 235000 2                  LDA     NBRFAS
        24 003020   200030 755100                    STA     NBR_ARCH_FILES_TO_PROCESS,,AUTO

     1454    25280
     1455    25281    2      IN_GRAN_BASE$ = INBUF_.PTR$;

  25281 24 003021   000215 236000 2                  LDQ     INBUF_+1
        24 003022   004557 756000 2                  STQ     IN_GRAN_BASE$

     1456    25282    2      OUT_GRAN_BASE$ = PINCRW( OUTBUF_.PTR$, 1024 );

  25282 24 003023   000001 236000 xsym               LDQ     OUTBUF_+1
        24 003024   002000 036003                    ADLQ    1024,DU
        24 003025   004560 756000 2                  STQ     OUT_GRAN_BASE$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:209  

     1457    25283    2      OUT_BLK_TAG0$ = PINCRW( OUT_GRAN_BASE$, -SIZEW(OUT_BLK_TAG0) );

  25283 24 003026   777765 036003                    ADLQ    -11,DU
        24 003027   004545 756000 2                  STQ     OUT_BLK_TAG0$

     1458    25284    2      OUT_BLK_TAG0.WHERE.PSN = ' ';

  25284 24 003030   004545 470400 2                  LDP0    OUT_BLK_TAG0$
        24 003031   040100 100400                    MLR     fill='040'O
        24 003032   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 003033   000003 000006                    ADSC9   3,,PR0                   cn=0,n=6

     1459    25285    2      OUT_GRAN_MAX$ = PINCRW( OUT_GRAN_BASE$, 1024 * (OUT_BLK_SIZE-1) );

  25285 24 003034   000200 236000 2                  LDQ     OUT_BLK_SIZE
        24 003035   000034 736000                    QLS     28
        24 003036   002000 136003                    SBLQ    1024,DU
        24 003037   004560 036000 2                  ADLQ    OUT_GRAN_BASE$
        24 003040   004556 756000 2                  STQ     OUT_GRAN_MAX$

     1460    25286    2      OUT_GRAN$ = PINCRW( OUT_GRAN_BASE$, -1 ); /* Need 1 gran. for block tags   */

  25286 24 003041   004560 236000 2                  LDQ     OUT_GRAN_BASE$
        24 003042   777777 036003                    ADLQ    -1,DU
        24 003043   004553 756000 2                  STQ     OUT_GRAN$

     1461    25287
     1462    25288    2      RPT_ERR = '1'B;                      /* Assume that error must be reported */

  25288 24 003044   400000 236003                    LDQ     -131072,DU
        24 003045   200035 756100                    STQ     RPT_ERR,,AUTO

     1463    25289
     1464    25290    2      CALL FLI$TAPE_IO_INIT;

  25290 24 003046   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:210  
        24 003047   000000 701000 xent               TSX1    FLI$TAPE_IO_INIT
        24 003050   000000 011000                    NOP     0

     1465    25291        /***
     1466    25292         *** Tape - Continue proc. after I/O error  if cont. spec'd on input or ouput
     1467    25293         *** OD - Continue proc. after I/O error if cont. spec'd on output
     1468    25294         ***/
     1469    25295    2      IF OD_DEST

  25295 24 003051   200006 234100                    SZN     OD_DEST,,AUTO
        24 003052   003067 605000 24                 TPL     s:25301

     1470    25296    3       THEN DO;

     1471    25297    3         TAPE_OPEN.V.IOERROK# = ARCOM_OPTIONS.IOERRORCO;

  25297 24 003053   000000 236000 xsym               LDQ     ARCOM_OPTIONS
        24 003054   100000 376003                    ANQ     32768,DU
        24 003055   000005 772000                    QRL     5
        24 003056   000060 676000 xsym               ERQ     TAPE_OPEN+48
        24 003057   003000 376003                    ANQ     1536,DU
        24 003060   000060 656000 xsym               ERSQ    TAPE_OPEN+48

     1472    25298    3         TAPE_WRITE.V.IOERROK# = ARCOM_OPTIONS.IOERRORCO;

  25298 24 003061   000000 236000 xsym               LDQ     ARCOM_OPTIONS
        24 003062   000035 772000                    QRL     29
        24 003063   000010 676000 xsym               ERQ     TAPE_WRITE+8
        24 003064   000020 376007                    ANQ     16,DL
        24 003065   000010 656000 xsym               ERSQ    TAPE_WRITE+8

     1473    25299    3         END;

  25299 24 003066   003117 710000 24                 TRA     s:25304

     1474    25300    3       ELSE DO;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:211  
     1475    25301    3         TAPE_OPEN.V.IOERROK# = ARCOM_OPTIONS.IOERRORCO | ARCOM_OPTIONS.IOERRORCI;

  25301 24 003067   000000 236000 xsym               LDQ     ARCOM_OPTIONS
        24 003070   000001 736000                    QLS     1
        24 003071   400000 376003                    ANQ     -131072,DU
        24 003072   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 003073   000000 236000 xsym               LDQ     ARCOM_OPTIONS
        24 003074   000002 736000                    QLS     2
        24 003075   400000 376003                    ANQ     -131072,DU
        24 003076   200070 276100                    ORQ     NEW_FSN+3,,AUTO
        24 003077   000007 772000                    QRL     7
        24 003100   000060 676000 xsym               ERQ     TAPE_OPEN+48
        24 003101   003000 376003                    ANQ     1536,DU
        24 003102   000060 656000 xsym               ERSQ    TAPE_OPEN+48

     1476    25302    3         TAPE_WRITE.V.IOERROK# = ARCOM_OPTIONS.IOERRORCO | ARCOM_OPTIONS.IOERRORCI;

  25302 24 003103   000000 236000 xsym               LDQ     ARCOM_OPTIONS
        24 003104   000001 736000                    QLS     1
        24 003105   400000 376003                    ANQ     -131072,DU
        24 003106   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 003107   000000 236000 xsym               LDQ     ARCOM_OPTIONS
        24 003110   000002 736000                    QLS     2
        24 003111   400000 376003                    ANQ     -131072,DU
        24 003112   200070 276100                    ORQ     NEW_FSN+3,,AUTO
        24 003113   000037 772000                    QRL     31
        24 003114   000010 676000 xsym               ERQ     TAPE_WRITE+8
        24 003115   000020 376007                    ANQ     16,DL
        24 003116   000010 656000 xsym               ERSQ    TAPE_WRITE+8

     1477    25303    3         END;

     1478    25304    2      CALL FLP$WR_FILE_INFO ALTRET(RPT_ERR_CLOSE);

  25304 24 003117   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 003120   000000 701000 xent               TSX1    FLP$WR_FILE_INFO
        24 003121   004050 702000 24                 TSX2    RPT_ERR_CLOSE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:212  

     1479    25305
     1480    25306
     1481    25307         /***
     1482    25308          *** Open the archive list for comparison with archive tape/optical disk files.
     1483    25309          ***/
     1484    25310
     1485    25311    2      CALL M$OPEN( OPEN_ARC_LIST )

  25311 24 003122   000054 630400 23                 EPPR0   OPEN_ARC_LIST
        24 003123   450000 713400                    CLIMB   alt,open
        24 003124   410400 401760                    pmme    nvectors=18
        24 003125   003127 702000 24                 TSX2    s:25313
        24 003126   003134 710000 24                 TRA     s:25317

     1486    25312    3       WHENALTRETURN DO;

     1487    25313    3         CALL FLI$RPT_ERR;

  25313 24 003127   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 003130   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 003131   000000 011000                    NOP     0

     1488    25314    3         ALTRETURN;

  25314 24 003132   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 003133   000000 702211                    TSX2  ! 0,X1

     1489    25315    3         END;
     1490    25316
     1491    25317    2      IF ARCOM_OPTIONS.IMMUPDATE           /* Create *FSN_LIST file              */

  25317 24 003134   000000 234000 xsym               SZN     ARCOM_OPTIONS
        24 003135   003150 605000 24                 TPL     s:25330

     1492    25318    3       THEN DO;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:213  
     1493    25319    3         CALL M$OPEN( OPEN_FSN_LIST )

  25319 24 003136   005464 630400 2                  EPPR0   OPEN_FSN_LIST
        24 003137   450000 713400                    CLIMB   alt,open
        24 003140   410400 401760                    pmme    nvectors=18
        24 003141   003143 702000 24                 TSX2    s:25321
        24 003142   003150 710000 24                 TRA     s:25330

     1494    25320    4          WHENALTRETURN DO;

     1495    25321    4            CALL FLI$RPT_ERR;

  25321 24 003143   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 003144   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 003145   000000 011000                    NOP     0

     1496    25322    4            ALTRETURN;

  25322 24 003146   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 003147   000000 702211                    TSX2  ! 0,X1

     1497    25323    4            END;
     1498    25324    3         END;

     1499    25325
     1500    25326         /***
     1501    25327          *** Primary loop: find next file and process contents.
     1502    25328          ***/
     1503    25329
     1504    25330    2      NBR_FILE_BLOCKS = 0;

  25330 24 003150   000000 450000 xsym               STZ     NBR_FILE_BLOCKS

     1505    25331    2      OPEN_BY_FSN = '1'B;

  25331 24 003151   400000 236003                    LDQ     -131072,DU
        24 003152   200037 756100                    STQ     OPEN_BY_FSN,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:214  

     1506    25332    2   MAIN_LOOP:
     1507    25333    3      DO WHILE('1'B);

  25333 24 003153                       MAIN_LOOP    null
     1508    25334
     1509    25335    3         FOUND_PACKED_FILE = '0'B;

  25335 24 003153   200023 450100                    STZ     FOUND_PACKED_FILE,,AUTO

     1510    25336
     1511    25337    4         DO WHILE( NOT FOUND_PACKED_FILE );

  25337 24 003154   003747 710000 24                 TRA     s:25513

     1512    25338    4            IF OPEN_BY_FSN

  25338 24 003155   200037 234100                    SZN     OPEN_BY_FSN,,AUTO
        24 003156   003215 605000 24                 TPL     s:25360

     1513    25339    5             THEN DO;

     1514    25340    5               OPEN_TAPE_SOURCE.V.OPER.MNTONLY# = %YES#;

  25340 24 003157   001000 236007                    LDQ     512,DL
        24 003160   004632 256000 2                  ORSQ    OPEN_TAPE_SOURCE+36

     1515    25341    5               CALL M$OPEN( OPEN_TAPE_SOURCE ) ALTRET( OPEN_TAPE_ALT );

  25341 24 003161   004566 630400 2                  EPPR0   OPEN_TAPE_SOURCE
        24 003162   450000 713400                    CLIMB   alt,open
        24 003163   410400 401760                    pmme    nvectors=18
        24 003164   003415 702000 24                 TSX2    OPEN_TAPE_ALT

     1516    25342    5               IF M$TAPE_SOURCE$->F$DCB.TYC.IOERR# /* Tape I/O err during mount? */

  25342 24 003165   004535 470400 2                  LDP0    M$TAPE_SOURCE$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:215  
        24 003166   000002 430100                    FSZN    2,,PR0
        24 003167   003171 605000 24                 TPL     s:25347

     1517    25343    6                THEN DO;

     1518    25344    6                  GOTO OPEN_TAPE_ALT;      /* Read next tape                     */

  25344 24 003170   003415 710000 24                 TRA     OPEN_TAPE_ALT

     1519    25345    6                  END;
     1520    25346
     1521    25347    5               IF M$TAPE_SOURCE$->F$DCB.FSECT > 1

  25347 24 003171   000077 220100                    LDX0    63,,PR0
        24 003172   000002 100003                    CMPX0   2,DU
        24 003173   003200 602000 24                 TNC     s:25350

     1522    25348    5                THEN OPEN_TAPE_SOURCE.V.FSN# = M$TAPE_SOURCE$->F$DCB.FSN# + 1;

  25348 24 003174   000034 221100                    LDX1    28,,PR0
        24 003175   000001 622011                    EAX2    1,X1
        24 003176   004654 742000 2                  STX2    OPEN_TAPE_SOURCE+54
        24 003177   003206 710000 24                 TRA     s:25355

     1523    25349    6                ELSE DO;

     1524    25350    6                  IF FIRST_SOURCE_FILE     /* Use FSN spec'd by user if set      */

  25350 24 003200   200040 234100                    SZN     FIRST_SOURCE_FILE,,AUTO
        24 003201   003204 605000 24                 TPL     s:25353
        24 003202   004654 221000 2                  LDX1    OPEN_TAPE_SOURCE+54
        24 003203   003206 601000 24                 TNZ     s:25355

     1525    25351    6                    AND OPEN_TAPE_SOURCE.V.FSN# ~= 0
     1526    25352    6                   THEN;
     1527    25353    6                   ELSE OPEN_TAPE_SOURCE.V.FSN# = M$TAPE_SOURCE$->F$DCB.FSN#;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:216  
  25353 24 003204   000034 221100                    LDX1    28,,PR0
        24 003205   004654 741000 2                  STX1    OPEN_TAPE_SOURCE+54

     1528    25354    6                  END;

     1529    25355    5               OPEN_BY_FSN = '0'B;

  25355 24 003206   200037 450100                    STZ     OPEN_BY_FSN,,AUTO

     1530    25356    5               OPEN_TAPE_SOURCE.V.OPER.THISF# = %YES#;

  25356 24 003207   002000 236007                    LDQ     1024,DL
        24 003210   004632 256000 2                  ORSQ    OPEN_TAPE_SOURCE+36

     1531    25357    5               OPEN_TAPE_SOURCE.V.OPER.MNTONLY# = %NO#;

  25357 24 003211   000125 236000 25                 LDQ     85
        24 003212   004632 356000 2                  ANSQ    OPEN_TAPE_SOURCE+36

     1532    25358    5               OPEN_TAPE_SOURCE.V.INITZ.SCRUB# = %YES#;

  25358 24 003213   400000 236007                    LDQ     -131072,DL
        24 003214   004632 256000 2                  ORSQ    OPEN_TAPE_SOURCE+36

     1533    25359    5               END;

     1534    25360    4            CALL M$OPEN( OPEN_TAPE_SOURCE )

  25360 24 003215   004566 630400 2                  EPPR0   OPEN_TAPE_SOURCE
        24 003216   450000 713400                    CLIMB   alt,open
        24 003217   410400 401760                    pmme    nvectors=18
        24 003220   003415 702000 24                 TSX2    OPEN_TAPE_ALT

     1535    25361    5             WHENRETURN DO;

     1536    25362    5               IF M$TAPE_SOURCE$->F$DCB.TYC.IOERR# /* Tape I/O error?            */

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:217  
  25362 24 003221   004535 470400 2                  LDP0    M$TAPE_SOURCE$
        24 003222   000002 430100                    FSZN    2,,PR0
        24 003223   003345 605000 24                 TPL     s:25398

     1537    25363    6                THEN DO;

     1538    25364        /***
     1539    25365         *** Skip out to next EFT_RESTRICT_FILE on input after writing accumulated
     1540    25366         *** blocks. Possibility of running off end of reel if last file on tape and bad.
     1541    25367         ***/
     1542    25368    6                  TEMP_FLG = IN_BLK_TAG.FIN; /* Move on to next output file      */

  25368 24 003224   004542 471400 2                  LDP1    IN_BLK_TAG$
        24 003225   100000 236100                    LDQ     0,,PR1
        24 003226   000034 736000                    QLS     28
        24 003227   400000 376003                    ANQ     -131072,DU
        24 003230   200041 756100                    STQ     TEMP_FLG,,AUTO

     1543    25369    6                  CALL FLX_CHECK_CURRENT_GRAN( '1'B, TEMP_FLG )

  25369 24 003231   200041 633500                    EPPR3   TEMP_FLG,,AUTO
        24 003232   200054 453500                    STP3    @FORCE+1,,AUTO
        24 003233   000100 236000 25                 LDQ     64
        24 003234   200053 756100                    STQ     ACCT_NAME+2,,AUTO
        24 003235   005040 701000 24                 TSX1    FLX_CHECK_CURRENT_GRAN
        24 003236   004050 702000 24                 TSX2    RPT_ERR_CLOSE

     1544    25370    6                    ALTRET( RPT_ERR_CLOSE );
     1545    25371
     1546    25372    6                  IF OUTPUT_TAPE_OPEN

  25372 24 003237   200024 234100                    SZN     OUTPUT_TAPE_OPEN,,AUTO
        24 003240   003306 605000 24                 TPL     s:25381

     1547    25373    7                   THEN DO;

     1548    25374    7                     CALL FLI$TAPE_CLOSE( VECTOR(CVOL_UTL) ) ALTRET( ERR_CLOSE );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:218  

  25374 24 003241   000130 630400 25                 EPPR0   88
        24 003242   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 003243   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        24 003244   004055 702000 24                 TSX2    ERR_CLOSE

     1549    25375    7                    CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), SN, FSN, '0'B, '1'B
             25375                              , , A_FIT_, ERR, DCB# ) ALTRET(RPT_ERR_CLOSE);

  25375 24 003245   000000 236000 xsym               LDQ     EFT_RESTRICT_FILE
        24 003246   000033 772000                    QRL     27
        24 003247   000001 620006                    EAX0    1,QL
        24 003250   000000 635010                    EAA     0,X0
        24 003251   000002 771000                    ARL     2
        24 003252   000140 135007                    SBLA    96,DL
        24 003253   000131 236000 25                 LDQ     89
        24 003254   200070 757100                    STAQ    NEW_FSN+3,,AUTO
        24 003255   200021 630500                    EPPR0   DCB#,,AUTO
        24 003256   200102 450500                    STP0    NEW_FSN+13,,AUTO
        24 003257   200017 631500                    EPPR1   ERR,,AUTO
        24 003260   200101 451500                    STP1    NEW_FSN+12,,AUTO
        24 003261   000133 236000 25                 LDQ     91
        24 003262   200100 756100                    STQ     NEW_FSN+11,,AUTO
        24 003263   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 003264   000100 235000 25                 LDA     64
        24 003265   200076 757100                    STAQ    NEW_FSN+9,,AUTO
        24 003266   000071 236000 25                 LDQ     57
        24 003267   200075 756100                    STQ     NEW_FSN+8,,AUTO
        24 003270   200015 633500                    EPPR3   FSN,,AUTO
        24 003271   200074 453500                    STP3    NEW_FSN+7,,AUTO
        24 003272   200013 634500                    EPPR4   SN,,AUTO
        24 003273   200073 454500                    STP4    NEW_FSN+6,,AUTO
        24 003274   200070 635500                    EPPR5   NEW_FSN+3,,AUTO
        24 003275   200072 455500                    STP5    NEW_FSN+5,,AUTO
        24 003276   200072 630500                    EPPR0   NEW_FSN+5,,AUTO
        24 003277   000132 631400 25                 EPPR1   90
        24 003300   000000 701000 xent               TSX1    FLI$TAPE_OPEN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:219  
        24 003301   004050 702000 24                 TSX2    RPT_ERR_CLOSE

     1550    25376
     1551    25377    7                     IF ARCOM_OPTIONS.IMMUPDATE /* Update fits immediately?      */

  25377 24 003302   000000 234000 xsym               SZN     ARCOM_OPTIONS
        24 003303   003306 605000 24                 TPL     s:25381

     1552    25378    7                      THEN CALL FLX_UPDATE_ARC_FILES ALTRET( ERR_CLOSE );

  25378 24 003304   006116 701000 24                 TSX1    FLX_UPDATE_ARC_FILES
        24 003305   004055 702000 24                 TSX2    ERR_CLOSE

     1553    25379    7                     END;

     1554    25380
     1555    25381    6                  DCB# = OPEN_TAPE_SOURCE.V.DCB#;

  25381 24 003306   004632 235000 2                  LDA     OPEN_TAPE_SOURCE+36
        24 003307   000022 771000                    ARL     18
        24 003310   200021 755100                    STA     DCB#,,AUTO

     1556    25382    6                  CALL FLI$RPT_ERR( E_IO_ERR, DCB# );

  25382 24 003311   200021 630500                    EPPR0   DCB#,,AUTO
        24 003312   200071 450500                    STP0    NEW_FSN+4,,AUTO
        24 003313   000134 236000 25                 LDQ     92
        24 003314   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 003315   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 003316   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 003317   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 003320   000000 011000                    NOP     0

     1557    25383    6                  IF NOT TEMP_FLG

  25383 24 003321   200041 234100                    SZN     TEMP_FLG,,AUTO
        24 003322   003325 604000 24                 TMI     s:25386
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:220  

     1558    25384    6                   THEN CALL FLX_REPORT_PARTIAL_FILE;

  25384 24 003323   006010 701000 24                 TSX1    FLX_REPORT_PARTIAL_FILE
        24 003324   000000 011000                    NOP     0

     1559    25385
     1560    25386    6                  OPEN_TAPE_SOURCE.V.OPER.THISF# = %NO#;

  25386 24 003325   000122 236000 25                 LDQ     82
        24 003326   004632 356000 2                  ANSQ    OPEN_TAPE_SOURCE+36

     1561    25387    6                  OPEN_TAPE_SOURCE.V.FINDPOS# = %YES#;

  25387 24 003327   000001 236007                    LDQ     1,DL
        24 003330   004632 256000 2                  ORSQ    OPEN_TAPE_SOURCE+36

     1562    25388    6                  CALL M$OPEN( OPEN_TAPE_SOURCE ) /* Open next good tape file    */

  25388 24 003331   004566 630400 2                  EPPR0   OPEN_TAPE_SOURCE
        24 003332   450000 713400                    CLIMB   alt,open
        24 003333   410400 401760                    pmme    nvectors=18
        24 003334   003340 702000 24                 TSX2    s:25393

     1563    25389    7                   WHENRETURN DO;

     1564    25390    7                     OPEN_TAPE_SOURCE.V.FINDPOS# = %NO#;

  25390 24 003335   000123 236000 25                 LDQ     83
        24 003336   004632 356000 2                  ANSQ    OPEN_TAPE_SOURCE+36

     1565    25391    7                     END;

  25391 24 003337   003345 710000 24                 TRA     s:25398

     1566    25392    7                   WHENALTRETURN DO;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:221  
     1567    25393    7                     OPEN_TAPE_SOURCE.V.OPER.THISF# = %NO#; /* End of tape set?  */

  25393 24 003340   000122 236000 25                 LDQ     82
        24 003341   004632 356000 2                  ANSQ    OPEN_TAPE_SOURCE+36

     1568    25394    7                     OPEN_TAPE_SOURCE.V.FINDPOS# = %NO#;

  25394 24 003342   000123 236000 25                 LDQ     83
        24 003343   004632 356000 2                  ANSQ    OPEN_TAPE_SOURCE+36

     1569    25395    7                     GOTO OPEN_TAPE_ALT;

  25395 24 003344   003415 710000 24                 TRA     OPEN_TAPE_ALT

     1570    25396    7                     END;
     1571    25397    6                  END;

     1572    25398    5               OPEN_TAPE_SOURCE.V.OPER.THISF# = %NO#;

  25398 24 003345   000122 236000 25                 LDQ     82
        24 003346   004632 356000 2                  ANSQ    OPEN_TAPE_SOURCE+36

     1573    25399    5               OPEN_TAPE_SOURCE.V.FSN# = 0; /* NXTF from now on                  */

  25399 24 003347   000000 220003                    LDX0    0,DU
        24 003350   004654 740000 2                  STX0    OPEN_TAPE_SOURCE+54

     1574    25400    5               OPEN_TAPE_SOURCE.V.VOL# = 0;

  25400 24 003351   000000 236003                    LDQ     0,DU
        24 003352   004647 552040 2                  STBQ    OPEN_TAPE_SOURCE+49,'40'O

     1575    25401    5               OPEN_TAPE_SOURCE.V.INITZ.SCRUB# = %NO#;

  25401 24 003353   000135 236000 25                 LDQ     93
        24 003354   004632 356000 2                  ANSQ    OPEN_TAPE_SOURCE+36

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:222  
     1576    25402    5               IF M$TAPE_SOURCE$->F$DCB.NAME#.C = EFT_RESTRICT_FILE.NAME#

  25402 24 003355   000000 236000 xsym               LDQ     EFT_RESTRICT_FILE
        24 003356   000033 772000                    QRL     27
        24 003357   004535 470400 2                  LDP0    M$TAPE_SOURCE$
        24 003360   000000 621006                    EAX1    0,QL
        24 003361   040040 106500                    CMPC    fill='040'O
        24 003362   000010 200037                    ADSC9   8,,PR0                   cn=1,n=31
        24 003363   000000 200011 xsym               ADSC9   EFT_RESTRICT_FILE        cn=1,n=*X1
        24 003364   003374 601000 24                 TNZ     s:25406
        24 003365   000032 236100                    LDQ     26,,PR0
        24 003366   777000 376003                    ANQ     -512,DU
        24 003367   022000 116003                    CMPQ    9216,DU
        24 003370   003374 601000 24                 TNZ     s:25406

     1577    25403    5                 AND M$TAPE_SOURCE$->F$DCB.ORG# = %RESTRICT#
     1578    25404    5                THEN FOUND_PACKED_FILE = '1'B;

  25404 24 003371   400000 236003                    LDQ     -131072,DU
        24 003372   200023 756100                    STQ     FOUND_PACKED_FILE,,AUTO
        24 003373   003414 710000 24                 TRA     s:25421

     1579    25405    6                ELSE DO;

     1580    25406    6                  CALL M$CLOSE( CLOSE_TAPE_SOURCE )

  25406 24 003374   004676 630400 2                  EPPR0   CLOSE_TAPE_SOURCE
        24 003375   450001 713400                    CLIMB   alt,close
        24 003376   406000 401760                    pmme    nvectors=13
        24 003377   003401 702000 24                 TSX2    s:25415
        24 003400   003414 710000 24                 TRA     s:25421

     1581    25407    7                   WHENALTRETURN DO;

     1582    25408        /***
     1583    25409         *** E$VOLORDER may be returned when LT#sn#sn1 ... is spec'd on input
     1584    25410         *** and the last file continues on another tape which was not spec'd.
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:223  
     1585    25411         *** E$BLNKTP,E$IOERR may occur when reading the EFT_CVOL_FILE.
     1586    25412         *** Perform normal completion which updates the :ARCHIVE record and
     1587    25413         *** output misc. file statistics.
     1588    25414         ***/
     1589    25415    7                     IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$VOLORDER

  25415 24 003401   000000 470400 xsym               LDP0    B$TCB$
        24 003402   000000 471500                    LDP1    0,,PR0
        24 003403   100102 236100                    LDQ     66,,PR1
        24 003404   377770 376007                    ANQ     131064,DL
        24 003405   013300 116007                    CMPQ    5824,DL
        24 003406   003415 600000 24                 TZE     OPEN_TAPE_ALT
        24 003407   000050 116007                    CMPQ    40,DL
        24 003410   003413 601000 24                 TNZ     s:25418
        24 003411   200042 234100                    SZN     IOERRORC,,AUTO
        24 003412   003415 604000 24                 TMI     OPEN_TAPE_ALT

     1590    25416    7                       OR ( B$TCB.ALT$->B$ALT.ERR.CODE = %E$BLNKTP AND IOERRORC )
     1591    25417    7                      THEN GOTO OPEN_TAPE_ALT;
     1592    25418    7                      ELSE GOTO RPT_ERR_CLOSE;

  25418 24 003413   004050 710000 24                 TRA     RPT_ERR_CLOSE

     1593    25419    7                     END;
     1594    25420    6                  END;

     1595    25421    5               END;

  25421 24 003414   003747 710000 24                 TRA     s:25513

     1596    25422    5             WHENALTRETURN DO;

  25416 24 003415                       OPEN_TAPE_A* null
     1597    25423    5   OPEN_TAPE_ALT: ;
     1598    25424    5               IF ( M$TAPE_SOURCE$->F$DCB.TYC.IOERR# AND IOERRORC )

  25424 24 003415   004535 470400 2                  LDP0    M$TAPE_SOURCE$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:224  
        24 003416   000002 430100                    FSZN    2,,PR0
        24 003417   003431 605000 24                 TPL     s:25430
        24 003420   200042 234100                    SZN     IOERRORC,,AUTO
        24 003421   003431 605000 24                 TPL     s:25430

     1599    25425    6                THEN DO;

     1600    25426    6                  ERR = E_IO_ERR;

  25426 24 003422   000000 236000 xsym               LDQ     E_IO_ERR
        24 003423   200017 756100                    STQ     ERR,,AUTO

     1601    25427    6                  CODE = E_IO_ERR.ERR#;

  25427 24 003424   000000 236000 xsym               LDQ     E_IO_ERR
        24 003425   000003 772000                    QRL     3
        24 003426   037777 376007                    ANQ     16383,DL
        24 003427   000170 756000 2                  STQ     CODE

     1602    25428    6                  END;

  25428 24 003430   003442 710000 24                 TRA     s:25433

     1603    25429    6                ELSE DO;

     1604    25430    6                  ERR = B$TCB.ALT$->B$ALT.ERR;

  25430 24 003431   000000 471400 xsym               LDP1    B$TCB$
        24 003432   100000 473500                    LDP3    0,,PR1
        24 003433   300102 236100                    LDQ     66,,PR3
        24 003434   200017 756100                    STQ     ERR,,AUTO

     1605    25431    6                  CODE = B$TCB.ALT$->B$ALT.ERR.CODE;

  25431 24 003435   100000 473500                    LDP3    0,,PR1
        24 003436   300102 236100                    LDQ     66,,PR3
        24 003437   000003 772000                    QRL     3
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:225  
        24 003440   037777 376007                    ANQ     16383,DL
        24 003441   000170 756000 2                  STQ     CODE

     1606    25432    6                  END;

     1607    25433    5               IF CODE ~= %E$EOSET AND CODE ~= %E$CANT AND CODE ~= %E$VOLOUT

  25433 24 003442   001314 116007                    CMPQ    716,DL
        24 003443   003472 600000 24                 TZE     OPEN_TAPE_ALT10
        24 003444   001223 116007                    CMPQ    659,DL
        24 003445   003472 600000 24                 TZE     OPEN_TAPE_ALT10
        24 003446   001327 116007                    CMPQ    727,DL
        24 003447   003472 600000 24                 TZE     OPEN_TAPE_ALT10
        24 003450   001330 116007                    CMPQ    728,DL
        24 003451   003472 600000 24                 TZE     OPEN_TAPE_ALT10
        24 003452   001343 116007                    CMPQ    739,DL
        24 003453   003456 601000 24                 TNZ     s:25433+12
        24 003454   200042 234100                    SZN     IOERRORC,,AUTO
        24 003455   003472 604000 24                 TMI     OPEN_TAPE_ALT10
        24 003456   000005 116007                    CMPQ    5,DL
        24 003457   003462 601000 24                 TNZ     s:25433+16
        24 003460   200042 234100                    SZN     IOERRORC,,AUTO
        24 003461   003472 604000 24                 TMI     OPEN_TAPE_ALT10
        24 003462   000010 116007                    CMPQ    8,DL
        24 003463   003466 601000 24                 TNZ     s:25439
        24 003464   200042 234100                    SZN     IOERRORC,,AUTO
        24 003465   003472 604000 24                 TMI     OPEN_TAPE_ALT10

     1608    25434    5                 AND CODE ~= %E$VOLORDER
     1609    25435    5                 AND NOT ( CODE = %E$NOTANS AND IOERRORC )
     1610    25436    5                 AND NOT ( CODE = %E$BLNKTP AND IOERRORC )
     1611    25437    5                 AND NOT ( CODE = %E$IOERR AND IOERRORC )
     1612    25438    6                THEN DO;

     1613    25439    6                  CALL FLI$RPT_ERR;

  25439 24 003466   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:226  
        24 003467   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 003470   000000 011000                    NOP     0

     1614    25440    6                  GOTO ERR_CLOSE;

  25440 24 003471   004055 710000 24                 TRA     ERR_CLOSE

     1615    25441    6                  END;
     1616    25442
     1617    25443        /***
     1618    25444         *** If an input file is continued on the next tape and that tape isn't
     1619    25445         *** specified or on an I/O error, only a partial output file may exist. Pass
     1620    25446         *** the FIN flag so that this condition is detected and its fit is not updated.
     1621    25447         ***/
     1622    25448    5   OPEN_TAPE_ALT10:
     1623    25449    5               IF NOT FIRST_SOURCE_FILE /* Bad source tape if no files proc. yet */

  25449 24 003472   200040 234100       OPEN_TAPE_A* SZN     FIRST_SOURCE_FILE,,AUTO
        24 003473   003507 604000 24                 TMI     s:25456

     1624    25450    6                THEN DO;

     1625    25451    6                  TEMP_FLG = IN_BLK_TAG.FIN; /* Move on to next tape/od output file */

  25451 24 003474   004542 470400 2                  LDP0    IN_BLK_TAG$
        24 003475   000000 236100                    LDQ     0,,PR0
        24 003476   000034 736000                    QLS     28
        24 003477   400000 376003                    ANQ     -131072,DU
        24 003500   200041 756100                    STQ     TEMP_FLG,,AUTO

     1626    25452    6                  CALL FLX_CHECK_CURRENT_GRAN( '1'B, TEMP_FLG )

  25452 24 003501   200041 631500                    EPPR1   TEMP_FLG,,AUTO
        24 003502   200054 451500                    STP1    @FORCE+1,,AUTO
        24 003503   000100 236000 25                 LDQ     64
        24 003504   200053 756100                    STQ     ACCT_NAME+2,,AUTO
        24 003505   005040 701000 24                 TSX1    FLX_CHECK_CURRENT_GRAN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:227  
        24 003506   004050 702000 24                 TSX2    RPT_ERR_CLOSE

     1627    25453    6                    ALTRET( RPT_ERR_CLOSE );
     1628    25454    6                  END;

     1629    25455
     1630    25456    5               IF OUTPUT_TAPE_OPEN

  25456 24 003507   200024 234100                    SZN     OUTPUT_TAPE_OPEN,,AUTO
        24 003510   003556 605000 24                 TPL     s:25467

     1631    25457    6                THEN DO;

     1632    25458    6                  CALL FLI$TAPE_CLOSE( VECTOR(CVOL_UTL) ) ALTRET( ERR_CLOSE );

  25458 24 003511   000130 630400 25                 EPPR0   88
        24 003512   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 003513   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        24 003514   004055 702000 24                 TSX2    ERR_CLOSE

     1633    25459    6                 CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), SN, FSN, '0'B, '1'B, ,
             25459                           A_FIT_, ERR_SAVE, DCB# ) ALTRET(RPT_ERR_CLOSE);

  25459 24 003515   000000 236000 xsym               LDQ     EFT_RESTRICT_FILE
        24 003516   000033 772000                    QRL     27
        24 003517   000001 620006                    EAX0    1,QL
        24 003520   000000 635010                    EAA     0,X0
        24 003521   000002 771000                    ARL     2
        24 003522   000140 135007                    SBLA    96,DL
        24 003523   000131 236000 25                 LDQ     89
        24 003524   200070 757100                    STAQ    NEW_FSN+3,,AUTO
        24 003525   200021 630500                    EPPR0   DCB#,,AUTO
        24 003526   200102 450500                    STP0    NEW_FSN+13,,AUTO
        24 003527   200020 631500                    EPPR1   ERR_SAVE,,AUTO
        24 003530   200101 451500                    STP1    NEW_FSN+12,,AUTO
        24 003531   000133 236000 25                 LDQ     91
        24 003532   200100 756100                    STQ     NEW_FSN+11,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:228  
        24 003533   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 003534   000100 235000 25                 LDA     64
        24 003535   200076 757100                    STAQ    NEW_FSN+9,,AUTO
        24 003536   000071 236000 25                 LDQ     57
        24 003537   200075 756100                    STQ     NEW_FSN+8,,AUTO
        24 003540   200015 633500                    EPPR3   FSN,,AUTO
        24 003541   200074 453500                    STP3    NEW_FSN+7,,AUTO
        24 003542   200013 634500                    EPPR4   SN,,AUTO
        24 003543   200073 454500                    STP4    NEW_FSN+6,,AUTO
        24 003544   200070 635500                    EPPR5   NEW_FSN+3,,AUTO
        24 003545   200072 455500                    STP5    NEW_FSN+5,,AUTO
        24 003546   200072 630500                    EPPR0   NEW_FSN+5,,AUTO
        24 003547   000132 631400 25                 EPPR1   90
        24 003550   000000 701000 xent               TSX1    FLI$TAPE_OPEN
        24 003551   004050 702000 24                 TSX2    RPT_ERR_CLOSE

     1634    25460
     1635    25461    6                  IF ARCOM_OPTIONS.IMMUPDATE /* Update fits immediately?         */

  25461 24 003552   000000 234000 xsym               SZN     ARCOM_OPTIONS
        24 003553   003556 605000 24                 TPL     s:25467

     1636    25462    7                   THEN DO;

     1637    25463    7                     CALL FLX_UPDATE_ARC_FILES ALTRET(ERR_CLOSE);

  25463 24 003554   006116 701000 24                 TSX1    FLX_UPDATE_ARC_FILES
        24 003555   004055 702000 24                 TSX2    ERR_CLOSE

     1638    25464    7                     END;

     1639    25465    6                  END;

     1640    25466
     1641    25467    5               IF ( CODE = %E$NOTANS AND IOERRORC AND NOT FIRST_SOURCE_FILE )

  25467 24 003556   000170 235000 2                  LDA     CODE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:229  
        24 003557   001343 115007                    CMPA    739,DL
        24 003560   003565 601000 24                 TNZ     s:25467+7
        24 003561   200042 234100                    SZN     IOERRORC,,AUTO
        24 003562   003565 605000 24                 TPL     s:25467+7
        24 003563   200040 234100                    SZN     FIRST_SOURCE_FILE,,AUTO
        24 003564   003605 605000 24                 TPL     s:25472
        24 003565   000005 115007                    CMPA    5,DL
        24 003566   003573 601000 24                 TNZ     s:25467+13
        24 003567   200042 234100                    SZN     IOERRORC,,AUTO
        24 003570   003573 605000 24                 TPL     s:25467+13
        24 003571   200040 234100                    SZN     FIRST_SOURCE_FILE,,AUTO
        24 003572   003605 605000 24                 TPL     s:25472
        24 003573   000010 115007                    CMPA    8,DL
        24 003574   003601 601000 24                 TNZ     s:25467+19
        24 003575   200042 234100                    SZN     IOERRORC,,AUTO
        24 003576   003601 605000 24                 TPL     s:25467+19
        24 003577   200040 234100                    SZN     FIRST_SOURCE_FILE,,AUTO
        24 003600   003605 605000 24                 TPL     s:25472
        24 003601   001330 115007                    CMPA    728,DL
        24 003602   003625 601000 24                 TNZ     s:25478
        24 003603   200040 234100                    SZN     FIRST_SOURCE_FILE,,AUTO
        24 003604   003625 604000 24                 TMI     s:25478

     1642    25468    5                 OR ( CODE = %E$BLNKTP AND IOERRORC AND NOT FIRST_SOURCE_FILE )
     1643    25469    5                 OR ( CODE = %E$IOERR AND IOERRORC AND NOT FIRST_SOURCE_FILE )
     1644    25470    5                 OR ( CODE = %E$VOLORDER  AND NOT FIRST_SOURCE_FILE )
     1645    25471    6                THEN DO;

     1646    25472    6                  DCB# = OPEN_TAPE_SOURCE.V.DCB#;

  25472 24 003605   004632 236000 2                  LDQ     OPEN_TAPE_SOURCE+36
        24 003606   000022 772000                    QRL     18
        24 003607   200021 756100                    STQ     DCB#,,AUTO

     1647    25473    6                  CALL FLI$RPT_ERR( ERR, DCB# );

  25473 24 003610   200021 630500                    EPPR0   DCB#,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:230  
        24 003611   200071 450500                    STP0    NEW_FSN+4,,AUTO
        24 003612   200017 631500                    EPPR1   ERR,,AUTO
        24 003613   200070 451500                    STP1    NEW_FSN+3,,AUTO
        24 003614   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 003615   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 003616   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 003617   000000 011000                    NOP     0

     1648    25474    6                  IF NOT TEMP_FLG

  25474 24 003620   200041 234100                    SZN     TEMP_FLG,,AUTO
        24 003621   003644 604000 24                 TMI     s:25483

     1649    25475    6                   THEN CALL FLX_REPORT_PARTIAL_FILE;

  25475 24 003622   006010 701000 24                 TSX1    FLX_REPORT_PARTIAL_FILE
        24 003623   000000 011000                    NOP     0

     1650    25476    6                  END;

  25476 24 003624   003644 710000 24                 TRA     s:25483

     1651    25477    6                ELSE DO;

     1652    25478    6                  CALL FLI$RPT_ERR( ERR );

  25478 24 003625   200017 630500                    EPPR0   ERR,,AUTO
        24 003626   200070 450500                    STP0    NEW_FSN+3,,AUTO
        24 003627   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 003630   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 003631   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 003632   000000 011000                    NOP     0

     1653    25479    6                  IF (CODE = %E$BLNKTP AND IOERRORC AND FIRST_SOURCE_FILE)

  25479 24 003633   000170 235000 2                  LDA     CODE
        24 003634   000005 115007                    CMPA    5,DL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:231  
        24 003635   003644 601000 24                 TNZ     s:25483
        24 003636   200042 234100                    SZN     IOERRORC,,AUTO
        24 003637   003644 605000 24                 TPL     s:25483
        24 003640   200040 234100                    SZN     FIRST_SOURCE_FILE,,AUTO
        24 003641   003644 605000 24                 TPL     s:25483

     1654    25480    6                   THEN OPEN_TAPE_SOURCE.V.FSN# = INPUT_FSN; /* Reinit. FSN      */

  25480 24 003642   200044 720100                    LXL0    INPUT_FSN,,AUTO
        24 003643   004654 740000 2                  STX0    OPEN_TAPE_SOURCE+54

     1655    25481    6                  END;

     1656    25482
     1657    25483    5               IF (M$TAPE_SOURCE$->F$DCB.VOL# < FROM_SN_LIST.NUM#

  25483 24 003644   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 003645   004535 471400 2                  LDP1    M$TAPE_SOURCE$
        24 003646   100043 236100                    LDQ     35,,PR1
        24 003647   000033 772000                    QRL     27
        24 003650   000000 116100                    CMPQ    0,,PR0
        24 003651   003657 605000 24                 TPL     s:25483+11
        24 003652   200007 234100                    SZN     CONTROLLED_SOURCE,,AUTO
        24 003653   003657 604000 24                 TMI     s:25483+11
        24 003654   000170 235000 2                  LDA     CODE
        24 003655   000215 115007                    CMPA    141,DL
        24 003656   003707 601000 24                 TNZ     s:25490
        24 003657   200007 234100                    SZN     CONTROLLED_SOURCE,,AUTO
        24 003660   003666 605000 24                 TPL     s:25483+18
        24 003661   000170 235000 2                  LDA     CODE
        24 003662   001343 115007                    CMPA    739,DL
        24 003663   003666 601000 24                 TNZ     s:25483+18
        24 003664   200042 234100                    SZN     IOERRORC,,AUTO
        24 003665   003707 604000 24                 TMI     s:25490
        24 003666   200007 234100                    SZN     CONTROLLED_SOURCE,,AUTO
        24 003667   003675 605000 24                 TPL     s:25483+25
        24 003670   000170 235000 2                  LDA     CODE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:232  
        24 003671   000005 115007                    CMPA    5,DL
        24 003672   003675 601000 24                 TNZ     s:25483+25
        24 003673   200042 234100                    SZN     IOERRORC,,AUTO
        24 003674   003707 604000 24                 TMI     s:25490
        24 003675   200007 234100                    SZN     CONTROLLED_SOURCE,,AUTO
        24 003676   003704 605000 24                 TPL     s:25483+32
        24 003677   000170 235000 2                  LDA     CODE
        24 003700   000010 115007                    CMPA    8,DL
        24 003701   003704 601000 24                 TNZ     s:25483+32
        24 003702   200042 234100                    SZN     IOERRORC,,AUTO
        24 003703   003707 604000 24                 TMI     s:25490
        24 003704   000170 235000 2                  LDA     CODE
        24 003705   001330 115007                    CMPA    728,DL
        24 003706   003725 601000 24                 TNZ     s:25502

     1658    25484    5                 AND NOT CONTROLLED_SOURCE AND CODE ~= %E$COMPACT_FIN)
     1659    25485    5                 OR (CONTROLLED_SOURCE AND CODE = %E$NOTANS AND IOERRORC )
     1660    25486    5                 OR (CONTROLLED_SOURCE AND CODE = %E$BLNKTP AND IOERRORC )
     1661    25487    5                 OR (CONTROLLED_SOURCE AND CODE = %E$IOERR AND IOERRORC )
     1662    25488    5                 OR CODE = %E$VOLORDER
     1663    25489    6                THEN DO;                   /* More to process                    */

     1664    25490    6                  IF CODE = %E$VOLORDER

  25490 24 003707   001330 115007                    CMPA    728,DL
        24 003710   003716 601000 24                 TNZ     s:25496

     1665    25491    7                   THEN DO; /* Process files on currently mounted vol. - continue */

     1666    25492    7                     OPEN_TAPE_SOURCE.V.VOL# = M$TAPE_SOURCE$->F$DCB.VOL#;

  25492 24 003711   100043 236100                    LDQ     35,,PR1
        24 003712   004647 552040 2                  STBQ    OPEN_TAPE_SOURCE+49,'40'O

     1667    25493    7                     OPEN_BY_FSN = '1'B;

  25493 24 003713   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:233  
        24 003714   200037 756100                    STQ     OPEN_BY_FSN,,AUTO

     1668    25494    7                     END;

  25494 24 003715   003747 710000 24                 TRA     s:25513

     1669    25495    7                   ELSE DO;

     1670    25496    7                     CALL FLX_REMOVE_VOL; /* Remove the current volume - continue */

  25496 24 003716   006052 701000 24                 TSX1    FLX_REMOVE_VOL
        24 003717   000000 011000                    NOP     0

     1671    25497    7                     OPEN_TAPE_SOURCE.V.VOL# = 1;

  25497 24 003720   001000 236003                    LDQ     512,DU
        24 003721   004647 552040 2                  STBQ    OPEN_TAPE_SOURCE+49,'40'O

     1672    25498    7                     OPEN_BY_FSN = '1'B;

  25498 24 003722   400000 236003                    LDQ     -131072,DU
        24 003723   200037 756100                    STQ     OPEN_BY_FSN,,AUTO

     1673    25499    7                     END;

     1674    25500    6                  END;

  25500 24 003724   003747 710000 24                 TRA     s:25513

     1675    25501    6                ELSE DO;         /* No more reels or all archived files copied   */

     1676    25502    6                  CALL M$CLOSE( CLOSE_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );

  25502 24 003725   000016 630400 23                 EPPR0   CLOSE_ARC_LIST
        24 003726   450001 713400                    CLIMB   alt,close
        24 003727   406000 401760                    pmme    nvectors=13
        24 003730   004050 702000 24                 TSX2    RPT_ERR_CLOSE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:234  

     1677    25503
     1678    25504    6                  IF M$FSN_LIST$->F$DCB.FCD#

  25504 24 003731   004540 470400 2                  LDP0    M$FSN_LIST$
        24 003732   000031 236100                    LDQ     25,,PR0
        24 003733   020000 316007                    CANQ    8192,DL
        24 003734   003745 600000 24                 TZE     s:25510

     1679    25505    7                   THEN DO;

     1680    25506    7                     CLOSE_FSN_LIST.V.DISP# = %RELEASE#;

  25506 24 003735   000001 236007                    LDQ     1,DL
        24 003736   005642 552004 2                  STBQ    CLOSE_FSN_LIST+26,'04'O

     1681    25507    7                     CALL M$CLOSE( CLOSE_FSN_LIST ) ALTRET( RPT_ERR_CLOSE );

  25507 24 003737   005610 630400 2                  EPPR0   CLOSE_FSN_LIST
        24 003740   450001 713400                    CLIMB   alt,close
        24 003741   406000 401760                    pmme    nvectors=13
        24 003742   004050 702000 24                 TSX2    RPT_ERR_CLOSE

     1682    25508    7                     CLOSE_FSN_LIST.V.DISP# = %SAVE#;

  25508 24 003743   000002 236007                    LDQ     2,DL
        24 003744   005642 552004 2                  STBQ    CLOSE_FSN_LIST+26,'04'O

     1683    25509    7                     END;

     1684    25510    6                  RETURN;

  25510 24 003745   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 003746   000001 702211                    TSX2  ! 1,X1

     1685    25511    6                  END;
     1686    25512    5               END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:235  
     1687    25513    4            END;

  25513 24 003747   200023 234100                    SZN     FOUND_PACKED_FILE,,AUTO
        24 003750   003155 605000 24                 TPL     s:25338

     1688    25514
     1689    25515    3         VLP_NAME.NAME# = M$TAPE_SOURCE$->F$DCB.NAME#.C;

  25515 24 003751   004535 470400 2                  LDP0    M$TAPE_SOURCE$
        24 003752   040000 100500                    MLR     fill='040'O
        24 003753   000010 200037                    ADSC9   8,,PR0                   cn=1,n=31
        24 003754   006222 200037 2                  ADSC9   VLP_NAME                 cn=1,n=31

     1690    25516    3         VLP_NAME.L# = M$TAPE_SOURCE$->F$DCB.NAME#.L;

  25516 24 003755   000010 236100                    LDQ     8,,PR0
        24 003756   006222 552040 2                  STBQ    VLP_NAME,'40'O

     1691    25517
     1692    25518    3         CALL FLX_PROCESS_TAPE_SOURCE_FILE( GET_NXT_VOL )

  25518 24 003757   200043 631500                    EPPR1   GET_NXT_VOL,,AUTO
        24 003760   200047 451500                    STP1    INPUT_FSN+3,,AUTO
        24 003761   004135 701000 24                 TSX1    FLX_PROCESS_TAPE_SOURCE_FILE
        24 003762   003764 702000 24                 TSX2    s:25520
        24 003763   004016 710000 24                 TRA     s:25535

     1693    25519    4          WHENALTRETURN DO;

     1694    25520    4            IF ( IOERRORC AND GET_NXT_VOL ) /* Continue if source I/O error      */

  25520 24 003764   200042 234100                    SZN     IOERRORC,,AUTO
        24 003765   004050 605000 24                 TPL     RPT_ERR_CLOSE
        24 003766   200043 234100                    SZN     GET_NXT_VOL,,AUTO
        24 003767   004050 605000 24                 TPL     RPT_ERR_CLOSE

     1695    25521    5             THEN DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:236  

     1696    25522    5               IF M$TAPE_SOURCE$->F$DCB.FCD#

  25522 24 003770   004535 470400 2                  LDP0    M$TAPE_SOURCE$
        24 003771   000031 236100                    LDQ     25,,PR0
        24 003772   020000 316007                    CANQ    8192,DL
        24 003773   004007 600000 24                 TZE     s:25528

     1697    25523    5                THEN CALL M$CLOSE( CLOSE_TAPE_SOURCE )

  25523 24 003774   004676 630400 2                  EPPR0   CLOSE_TAPE_SOURCE
        24 003775   450001 713400                    CLIMB   alt,close
        24 003776   406000 401760                    pmme    nvectors=13
        24 003777   004001 702000 24                 TSX2    s:25525
        24 004000   004007 710000 24                 TRA     s:25528

     1698    25524    6                   WHENALTRETURN DO;

     1699    25525    6                     IF NOT ( B$TCB.ALT$->B$ALT.ERR.CODE = %E$BLKCNT )

  25525 24 004001   000000 470400 xsym               LDP0    B$TCB$
        24 004002   000000 471500                    LDP1    0,,PR0
        24 004003   100102 236100                    LDQ     66,,PR1
        24 004004   377770 376007                    ANQ     131064,DL
        24 004005   013250 116007                    CMPQ    5800,DL
        24 004006   004055 601000 24                 TNZ     ERR_CLOSE

     1700    25526    6                      THEN GOTO ERR_CLOSE; /* Continue if block count error      */
     1701    25527    6                     END;

     1702    25528    5               CALL FLX_REMOVE_VOL;        /* Yep, remove the current volume     */

  25528 24 004007   006052 701000 24                 TSX1    FLX_REMOVE_VOL
        24 004010   000000 011000                    NOP     0

     1703    25529    5               OPEN_TAPE_SOURCE.V.VOL# = 1;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:237  
  25529 24 004011   001000 236003                    LDQ     512,DU
        24 004012   004647 552040 2                  STBQ    OPEN_TAPE_SOURCE+49,'40'O

     1704    25530    5               OPEN_BY_FSN = '1'B;

  25530 24 004013   400000 236003                    LDQ     -131072,DU
        24 004014   200037 756100                    STQ     OPEN_BY_FSN,,AUTO

     1705    25531    5               END;

  25531 24 004015   004016 710000 24                 TRA     s:25535

     1706    25532    4             ELSE GOTO RPT_ERR_CLOSE;
     1707    25533    4            END;
     1708    25534
     1709    25535    3         IF M$TAPE_SOURCE$->F$DCB.FCD#

  25535 24 004016   004535 470400 2                  LDP0    M$TAPE_SOURCE$
        24 004017   000031 236100                    LDQ     25,,PR0
        24 004020   020000 316007                    CANQ    8192,DL
        24 004021   004037 600000 24                 TZE     s:25547

     1710    25536    4          THEN DO;

     1711    25537    4            CALL M$CLOSE( CLOSE_TAPE_SOURCE )

  25537 24 004022   004676 630400 2                  EPPR0   CLOSE_TAPE_SOURCE
        24 004023   450001 713400                    CLIMB   alt,close
        24 004024   406000 401760                    pmme    nvectors=13
        24 004025   004027 702000 24                 TSX2    s:25539
        24 004026   004037 710000 24                 TRA     s:25547

     1712    25538    5             WHENALTRETURN DO;             /* Continue if block count error      */

     1713    25539    5               IF NOT (B$TCB.ALT$->B$ALT.ERR.CODE = %E$BLKCNT AND IOERRORC)

  25539 24 004027   000000 470400 xsym               LDP0    B$TCB$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:238  
        24 004030   000000 471500                    LDP1    0,,PR0
        24 004031   100102 236100                    LDQ     66,,PR1
        24 004032   377770 376007                    ANQ     131064,DL
        24 004033   013250 116007                    CMPQ    5800,DL
        24 004034   004050 601000 24                 TNZ     RPT_ERR_CLOSE
        24 004035   200042 234100                    SZN     IOERRORC,,AUTO
        24 004036   004050 605000 24                 TPL     RPT_ERR_CLOSE

     1714    25540    5                THEN GOTO RPT_ERR_CLOSE;
     1715    25541    5               END;

     1716    25542    4            END;

     1717    25543        /***
     1718    25544         *** If all archived files copied, terminate. No need to continue reading
     1719    25545         *** source for additional files.
     1720    25546         ***/
     1721    25547    3         IF NBR_ARCH_FILES_TO_PROCESS <= 0

  25547 24 004037   200030 235100                    LDA     NBR_ARCH_FILES_TO_PROCESS,,AUTO
        24 004040   003153 605400 24                 TPNZ    MAIN_LOOP

     1722    25548    4          THEN DO;

     1723    25549    4            ERR = E_COMPACT_FIN;

  25549 24 004041   000000 236000 xsym               LDQ     E_COMPACT_FIN
        24 004042   200017 756100                    STQ     ERR,,AUTO

     1724    25550    4            CODE = E_COMPACT_FIN.ERR#;

  25550 24 004043   000000 236000 xsym               LDQ     E_COMPACT_FIN
        24 004044   000003 772000                    QRL     3
        24 004045   037777 376007                    ANQ     16383,DL
        24 004046   000170 756000 2                  STQ     CODE

     1725    25551    4            GOTO OPEN_TAPE_ALT10;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:239  

  25551 24 004047   003472 710000 24                 TRA     OPEN_TAPE_ALT10

     1726    25552    4            END;
     1727    25553
     1728    25554    3         END;

  25550 24 004050                       RPT_ERR_CLO* null
     1729    25555
     1730    25556    2   RPT_ERR_CLOSE: ;
     1731    25557    2      IF RPT_ERR

  25557 24 004050   200035 234100                    SZN     RPT_ERR,,AUTO
        24 004051   004055 605000 24                 TPL     ERR_CLOSE

     1732    25558    2       THEN CALL FLI$RPT_ERR;

  25558 24 004052   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 004053   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 004054   000000 011000                    NOP     0

  25557 24 004055                       ERR_CLOSE    null
     1733    25559
     1734    25560    2   ERR_CLOSE: ;
     1735    25561    2      IF OUTPUT_TAPE_OPEN

  25561 24 004055   200024 234100                    SZN     OUTPUT_TAPE_OPEN,,AUTO
        24 004056   004063 605000 24                 TPL     s:25566

     1736    25562    3       THEN DO;

     1737    25563    3         CALL FLI$TAPE_CLOSE( VECTOR(CVOL_UTL) );

  25563 24 004057   000130 630400 25                 EPPR0   88
        24 004060   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 004061   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        24 004062   000000 011000                    NOP     0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:240  

     1738    25564    3         END;

     1739    25565
     1740    25566    2      IF M$TAPE_SOURCE$->F$DCB.FCD#

  25566 24 004063   004535 470400 2                  LDP0    M$TAPE_SOURCE$
        24 004064   000031 236100                    LDQ     25,,PR0
        24 004065   020000 316007                    CANQ    8192,DL
        24 004066   004077 600000 24                 TZE     s:25574

     1741    25567    3       THEN DO;

     1742    25568    3         CALL M$CLOSE( CLOSE_TAPE_SOURCE )

  25568 24 004067   004676 630400 2                  EPPR0   CLOSE_TAPE_SOURCE
        24 004070   450001 713400                    CLIMB   alt,close
        24 004071   406000 401760                    pmme    nvectors=13
        24 004072   004074 702000 24                 TSX2    s:25570
        24 004073   004077 710000 24                 TRA     s:25574

     1743    25569    4          WHENALTRETURN DO;

     1744    25570    4            CALL FLI$RPT_ERR;

  25570 24 004074   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 004075   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 004076   000000 011000                    NOP     0

     1745    25571    4            END;

     1746    25572    3         END;

     1747    25573
     1748    25574    2      IF M$ARC_LIST$->F$DCB.FCD#

  25574 24 004077   004536 470400 2                  LDP0    M$ARC_LIST$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:241  
        24 004100   000031 236100                    LDQ     25,,PR0
        24 004101   020000 316007                    CANQ    8192,DL
        24 004102   004113 600000 24                 TZE     s:25582

     1749    25575    3       THEN DO;

     1750    25576    3         CALL M$CLOSE( CLOSE_ARC_LIST )

  25576 24 004103   000016 630400 23                 EPPR0   CLOSE_ARC_LIST
        24 004104   450001 713400                    CLIMB   alt,close
        24 004105   406000 401760                    pmme    nvectors=13
        24 004106   004110 702000 24                 TSX2    s:25578
        24 004107   004113 710000 24                 TRA     s:25582

     1751    25577    4          WHENALTRETURN DO;

     1752    25578    4            CALL FLI$RPT_ERR;

  25578 24 004110   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 004111   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 004112   000000 011000                    NOP     0

     1753    25579    4            END;

     1754    25580    3         END;

     1755    25581
     1756    25582    2      IF M$FSN_LIST$->F$DCB.FCD#

  25582 24 004113   004540 470400 2                  LDP0    M$FSN_LIST$
        24 004114   000031 236100                    LDQ     25,,PR0
        24 004115   020000 316007                    CANQ    8192,DL
        24 004116   004133 600000 24                 TZE     s:25592

     1757    25583    3       THEN DO;

     1758    25584    3         CLOSE_FSN_LIST.V.DISP# = %RELEASE#;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:242  

  25584 24 004117   000001 236007                    LDQ     1,DL
        24 004120   005642 552004 2                  STBQ    CLOSE_FSN_LIST+26,'04'O

     1759    25585    3         CALL M$CLOSE( CLOSE_FSN_LIST )

  25585 24 004121   005610 630400 2                  EPPR0   CLOSE_FSN_LIST
        24 004122   450001 713400                    CLIMB   alt,close
        24 004123   406000 401760                    pmme    nvectors=13
        24 004124   004126 702000 24                 TSX2    s:25587
        24 004125   004131 710000 24                 TRA     s:25589

     1760    25586    4          WHENALTRETURN DO;

     1761    25587    4            CALL FLI$RPT_ERR;

  25587 24 004126   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 004127   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 004130   000000 011000                    NOP     0

     1762    25588    4            END;

     1763    25589    3         CLOSE_FSN_LIST.V.DISP# = %SAVE#;

  25589 24 004131   000002 236007                    LDQ     2,DL
        24 004132   005642 552004 2                  STBQ    CLOSE_FSN_LIST+26,'04'O

     1764    25590    3         END;

     1765    25591
     1766    25592    2      ALTRETURN;

  25592 24 004133   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 004134   000000 702211                    TSX2  ! 0,X1

     1767    25593
     1768    25594        /******************************/
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:243  
     1769    25595    2   FLX_PROCESS_TAPE_SOURCE_FILE: PROC(GET_NXT_VOL) ALTRET;

  25595 24 004135   200046 741300       FLX_PROCESS* STX1  ! INPUT_FSN+2,,AUTO

     1770    25596        /*F*  NAME: FLX_PROCESS_TAPE_SOURCE
     1771    25597              PURPOSE: Process current source tape/optical disk file.
     1772    25598        */
     1773    25599
     1774    25600        /********************/
     1775    25601
     1776    25602    3   DCL GET_NXT_VOL BIT(1) ALIGNED;    /* Flag returned - volume change needed    */
     1777    25603
     1778    25604
     1779    25605    3      IN_BLK_TAG_IX_MAX = 0;

  25605 24 004136   004551 450000 2                  STZ     IN_BLK_TAG_IX_MAX

     1780    25606    3      IN_BLK_TAG_IX = 1;                   /* Assume no more input block tags    */

  25606 24 004137   000001 235007                    LDA     1,DL
        24 004140   004546 755000 2                  STA     IN_BLK_TAG_IX

     1781    25607    3      READING_TAPE_SOURCE = '1'B;

  25607 24 004141   400000 236003                    LDQ     -131072,DU
        24 004142   200022 756100                    STQ     READING_TAPE_SOURCE,,AUTO

     1782    25608    3      GET_NXT_VOL = '0'B;

  25608 24 004143   200047 470500                    LDP0    @GET_NXT_VOL,,AUTO
        24 004144   000000 450100                    STZ     0,,PR0

     1783    25609
     1784    25610    4      DO WHILE( READING_TAPE_SOURCE );

  25610 24 004145   200022 234100                    SZN     READING_TAPE_SOURCE,,AUTO
        24 004146   004611 605000 24                 TPL     JUSTRET
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:244  

     1785    25611
     1786    25612    5         DO WHILE( IN_BLK_TAG_IX < IN_BLK_TAG_IX_MAX );

  25612 24 004147   004546 236000 2                  LDQ     IN_BLK_TAG_IX
        24 004150   004551 116000 2                  CMPQ    IN_BLK_TAG_IX_MAX
        24 004151   004413 605000 24                 TPL     s:25706

     1787    25613               /***
     1788    25614                *** Another unprocessed tape/optical disk block remains in current
     1789    25615                *** input block.
     1790    25616                ***/
     1791    25617                                                /*** Position to next IN_BLK_TAG ***/
     1792    25618    5            IN_BLK_TAG_IX = IN_BLK_TAG_IX + 1;

  25618 24 004152   004546 054000 2                  AOS     IN_BLK_TAG_IX

     1793    25619    5            IN_BLK_TAG$ = PINCRW( IN_BLK_TAG$, -SIZEW(IN_BLK_TAG) );

  25619 24 004153   004542 236000 2                  LDQ     IN_BLK_TAG$
        24 004154   777765 036003                    ADLQ    -11,DU
        24 004155   004542 756000 2                  STQ     IN_BLK_TAG$

     1794    25620                                 /*** Check if this block should start a new file ***/
     1795    25621    5            IF NEW_FILE

  25621 24 004156   200026 234100                    SZN     NEW_FILE,,AUTO
        24 004157   004266 605000 24                 TPL     s:25658

     1796    25622    6             THEN DO;

     1797    25623    6               IF NOT IN_BLK_TAG.BEG

  25623 24 004160   004542 470400 2                  LDP0    IN_BLK_TAG$
        24 004161   000000 236100                    LDQ     0,,PR0
        24 004162   000400 316007                    CANQ    256,DL
        24 004163   004222 601000 24                 TNZ     s:25642
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:245  

     1798    25624    7                THEN DO;                   /* File doesn't start with FIT?       */

     1799    25625                       /*N* Print appropriate message */
     1800    25626    7                  IF FIRST_SOURCE_FILE /* Compacting did not begin on 1st volume */

  25626 24 004164   200040 234100                    SZN     FIRST_SOURCE_FILE,,AUTO
        24 004165   004216 604000 24                 TMI     s:25638
        24 004166   000170 235000 2                  LDA     CODE
        24 004167   000010 115007                    CMPA    8,DL
        24 004170   004173 601000 24                 TNZ     s:25626+7
        24 004171   200042 234100                    SZN     IOERRORC,,AUTO
        24 004172   004216 604000 24                 TMI     s:25638
        24 004173   000005 115007                    CMPA    5,DL
        24 004174   004177 601000 24                 TNZ     s:25626+11
        24 004175   200042 234100                    SZN     IOERRORC,,AUTO
        24 004176   004216 604000 24                 TMI     s:25638
        24 004177   001343 115007                    CMPA    739,DL
        24 004200   004203 601000 24                 TNZ     s:25635
        24 004201   200042 234100                    SZN     IOERRORC,,AUTO
        24 004202   004216 604000 24                 TMI     s:25638

     1801    25627    7                    OR ( CODE = %E$IOERR AND IOERRORC ) /* Read error            */
     1802    25628    7                    OR ( CODE = %E$BLNKTP AND IOERRORC ) /* Skip file error      */
     1803    25629    7                    OR ( CODE = %E$NOTANS AND IOERRORC ) /* Skip file error      */
     1804    25630    7                   THEN;
     1805    25631        /***
     1806    25632        *** Shouldn't happen but may if skipping input such as LT#EFT1#EFT3. Used to abort.
     1807    25633         ***/
     1808    25634    8                   ELSE DO;

     1809    25635    8                     DCB# = OPEN_TAPE_SOURCE.V.DCB#;

  25635 24 004203   004632 235000 2                  LDA     OPEN_TAPE_SOURCE+36
        24 004204   000022 771000                    ARL     18
        24 004205   200021 755100                    STA     DCB#,,AUTO

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:246  
     1810    25636    8                     CALL FLI$RPT_ERR( E_INCOMPLETE_FILE_SKIP, DCB# );

  25636 24 004206   200021 631500                    EPPR1   DCB#,,AUTO
        24 004207   200071 451500                    STP1    NEW_FSN+4,,AUTO
        24 004210   000136 236000 25                 LDQ     94
        24 004211   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 004212   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 004213   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 004214   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 004215   000000 011000                    NOP     0

     1811    25637    8                     END;

     1812    25638    7                  SKIP_FILE = '1'B;        /* Just skip the file                 */

  25638 24 004216   400000 236003                    LDQ     -131072,DU
        24 004217   200025 756100                    STQ     SKIP_FILE,,AUTO

     1813    25639    7                  FIRST_SOURCE_FILE = '0'B;

  25639 24 004220   200040 450100                    STZ     FIRST_SOURCE_FILE,,AUTO

     1814    25640    7                  END;

  25640 24 004221   004225 710000 24                 TRA     s:25645

     1815    25641    7                ELSE DO;

     1816    25642    7                  FIRST_SOURCE_FILE = '0'B;

  25642 24 004222   200040 450100                    STZ     FIRST_SOURCE_FILE,,AUTO

     1817    25643    7                  CALL FLX_CHECK_ARC_LIST ALTRET( JUSTALT );

  25643 24 004223   004616 701000 24                 TSX1    FLX_CHECK_ARC_LIST
        24 004224   004614 702000 24                 TSX2    JUSTALT

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:247  
     1818    25644    7                  END;

     1819    25645    6               IF NOT SKIP_FILE

  25645 24 004225   200025 234100                    SZN     SKIP_FILE,,AUTO
        24 004226   004266 604000 24                 TMI     s:25658

     1820    25646    7                THEN DO;                   /* Include this file on output tape   */

     1821    25647    7                  IF IN_BLK_TAG0.WHERE.PSN ~= OUT_BLK_TAG0.WHERE.PSN

  25647 24 004227   004544 470400 2                  LDP0    IN_BLK_TAG0$
        24 004230   004545 471400 2                  LDP1    OUT_BLK_TAG0$
        24 004231   040100 106500                    CMPC    fill='040'O
        24 004232   000003 000006                    ADSC9   3,,PR0                   cn=0,n=6
        24 004233   100003 000006                    ADSC9   3,,PR1                   cn=0,n=6
        24 004234   004241 601000 24                 TNZ     s:25649
        24 004235   040100 106500                    CMPC    fill='040'O
        24 004236   000004 400010                    ADSC9   4,,PR0                   cn=2,n=8
        24 004237   100004 400010                    ADSC9   4,,PR1                   cn=2,n=8
        24 004240   004244 600000 24                 TZE     s:25650

     1822    25648    7                    OR IN_BLK_TAG0.WHERE.ACCT ~= OUT_BLK_TAG0.WHERE.ACCT
     1823    25649    7                   THEN FORCE_NEW_OUT_BLK = '1'B; /* Need to start new output block */

  25649 24 004241   400000 236003                    LDQ     -131072,DU
        24 004242   200032 756100                    STQ     FORCE_NEW_OUT_BLK,,AUTO
        24 004243   004245 710000 24                 TRA     s:25651

     1824    25650    7                   ELSE FORCE_NEW_OUT_BLK = '0'B;

  25650 24 004244   200032 450100                    STZ     FORCE_NEW_OUT_BLK,,AUTO

     1825    25651    7                  CALL FLX_CHECK_CURRENT_GRAN( FORCE_NEW_OUT_BLK ) ALTRET( JUSTALT );

  25651 24 004245   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 004246   200054 756100                    STQ     @FORCE+1,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:248  
        24 004247   200032 633500                    EPPR3   FORCE_NEW_OUT_BLK,,AUTO
        24 004250   200053 453500                    STP3    ACCT_NAME+2,,AUTO
        24 004251   005040 701000 24                 TSX1    FLX_CHECK_CURRENT_GRAN
        24 004252   004614 702000 24                 TSX2    JUSTALT

     1826    25652                            /*** Remember that file will be in current output block ***/
     1827    25653    7                  THIS_BLK_ARC_LIST_KEY(NBR_IN_OUT_BLK) = ARC_LIST_KEY;

  25653 24 004253   200033 236100                    LDQ     NBR_IN_OUT_BLK,,AUTO
        24 004254   000060 402007                    MPY     48,DL
        24 004255   000006 100400                    MLR     fill='000'O
        24 004256   000222 000057 2                  ADSC9   ARC_LIST_KEY             cn=0,n=47
        24 004257   000236 000057 2                  ADSC9   THIS_BLK_ARC_LIST_KEY,Q  cn=0,n=47

     1828    25654    7                  THIS_BLK_ARC_LIST_REC(NBR_IN_OUT_BLK) = ARC_LIST_REC;

  25654 24 004260   200033 236100                    LDQ     NBR_IN_OUT_BLK,,AUTO
        24 004261   000030 402007                    MPY     24,DL
        24 004262   000006 100400                    MLR     fill='000'O
        24 004263   003156 000025 2                  ADSC9   ARC_LIST_REC             cn=0,n=21
        24 004264   003164 000025 2                  ADSC9   THIS_BLK_ARC_LIST_REC,Q  cn=0,n=21

     1829    25655    7                  NBR_IN_OUT_BLK = NBR_IN_OUT_BLK + 1;

  25655 24 004265   200033 054100                    AOS     NBR_IN_OUT_BLK,,AUTO

     1830    25656    7                  END;

     1831    25657    6               END;

     1832    25658    5            IF NOT SKIP_FILE

  25658 24 004266   200025 234100                    SZN     SKIP_FILE,,AUTO
        24 004267   004403 604000 24                 TMI     s:25703

     1833    25659    6             THEN DO;            /* Include granules on output tape/optical disk */

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:249  
     1834    25660    6               IN_GRAN$ = PINCRC( IN_GRAN_BASE$, IN_BLK_TAG.BEGX );

  25660 24 004270   004542 470400 2                  LDP0    IN_BLK_TAG$
        24 004271   000000 236100                    LDQ     0,,PR0
        24 004272   000022 772000                    QRL     18
        24 004273   000020 736000                    QLS     16
        24 004274   004557 036000 2                  ADLQ    IN_GRAN_BASE$
        24 004275   004552 756000 2                  STQ     IN_GRAN$

     1835    25661    6               IF IN_BLK_TAG.BEG

  25661 24 004276   000000 236100                    LDQ     0,,PR0
        24 004277   000400 316007                    CANQ    256,DL
        24 004300   004327 600000 24                 TZE     s:25672

     1836    25662    7                THEN DO; /* Update tape/optical disk with destination REEL and FSN */

     1837    25663    7                  CODE06$ = PINCRW( IN_GRAN$, SIZEW(FM$GRAN) );

  25663 24 004301   004552 236000 2                  LDQ     IN_GRAN$
        24 004302   000005 036003                    ADLQ    5,DU
        24 004303   000220 756000 2                  STQ     CODE06$

     1838    25664    7                  CALL XSF$LOCCODP( CODE06$, 06 )

  25664 24 004304   000067 630400 25                 EPPR0   55
        24 004305   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 004306   000000 701000 xent               TSX1    XSF$LOCCODP
        24 004307   004327 702000 24                 TSX2    s:25672

     1839    25665    8                   WHENRETURN DO;

     1840    25666    8                     CODE06.STOW.REEL = PREV_REEL;

  25666 24 004310   000220 470400 2                  LDP0    CODE06$
        24 004311   040100 100400                    MLR     fill='040'O
        24 004312   004561 000006 2                  ADSC9   PREV_REEL                cn=0,n=6
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:250  
        24 004313   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6

     1841    25667    8                     IF OD_DEST

  25667 24 004314   200006 234100                    SZN     OD_DEST,,AUTO
        24 004315   004322 605000 24                 TPL     s:25669

     1842    25668    8                      THEN CODE06.STOW.ODFSN = FSN;

  25668 24 004316   200015 720100                    LXL0    FSN,,AUTO
        24 004317   000220 470400 2                  LDP0    CODE06$
        24 004320   000002 440100                    SXL0    2,,PR0
        24 004321   004327 710000 24                 TRA     s:25672

     1843    25669    8                      ELSE CODE06.STOW.EFT.FSN = FSN;

  25669 24 004322   000220 470400 2                  LDP0    CODE06$
        24 004323   200015 236100                    LDQ     FSN,,AUTO
        24 004324   000002 676100                    ERQ     2,,PR0
        24 004325   037777 376007                    ANQ     16383,DL
        24 004326   000002 656100                    ERSQ    2,,PR0

     1844    25670    8                     END;

     1845    25671    7                  END;

     1846    25672    6               IN_GRAN_MAX$ = PINCRC( IN_GRAN$, IN_BLK_TAG.SIZE - 4096 );

  25672 24 004327   004542 470400 2                  LDP0    IN_BLK_TAG$
        24 004330   000001 236100                    LDQ     1,,PR0
        24 004331   000022 772000                    QRL     18
        24 004332   000020 736000                    QLS     16
        24 004333   002000 136003                    SBLQ    1024,DU
        24 004334   004552 036000 2                  ADLQ    IN_GRAN$
        24 004335   004554 756000 2                  STQ     IN_GRAN_MAX$

     1847    25673        /***
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:251  
     1848    25674        *** After I/O err with continuation set, beginning of block may not get read on the
     1849    25675         *** next read (TFM returns as much as possible). ARS returned may be < block size.
     1850    25676         ***/
     1851    25677    6               IF IN_GRAN_MAX$ > IN_GRAN_MAX_CHK$

  25677 24 004336   004555 116000 2                  CMPQ    IN_GRAN_MAX_CHK$
        24 004337   004345 602000 24                 TNC     s:25682
        24 004340   004345 600000 24                 TZE     s:25682
        24 004341   200042 234100                    SZN     IOERRORC,,AUTO
        24 004342   004345 604000 24                 TMI     s:25682

     1852    25678    6                 AND NOT IOERRORC
     1853    25679    7                THEN DO;                   /* Pointing past buffer end?          */

     1854    25680    7                  CALL M$XXX;

  25680 24 004343   000003 713400                    CLIMB   3
        24 004344   000000 401760                    pmme    nvectors=0

     1855    25681    7                  END;

     1856    25682    6               IF IN_GRAN$ > IN_GRAN_MAX$

  25682 24 004345   004554 236000 2                  LDQ     IN_GRAN_MAX$
        24 004346   004552 116000 2                  CMPQ    IN_GRAN$
        24 004347   004350 603000 24                 TRC     s:25686

     1857    25683    7                THEN DO;                   /* Non-positive number of granules?   */

     1858    25684                                                /*           CALL M$XXX;              */
     1859    25685    7                  END;

     1860    25686    6               IF NEW_FILE

  25686 24 004350   200026 234100                    SZN     NEW_FILE,,AUTO
        24 004351   004360 605000 24                 TPL     s:25692

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:252  
     1861    25687    7                THEN DO;                   /* File beginning                     */

     1862    25688    7                  OUT_BLK_TAG.BEGX = OUT_GRANX;

  25688 24 004352   004550 720000 2                  LXL0    OUT_GRANX
        24 004353   004543 470400 2                  LDP0    OUT_BLK_TAG$
        24 004354   000000 740100                    STX0    0,,PR0

     1863    25689    7                  OUT_BLK_TAG.BEG = '1'B;

  25689 24 004355   000400 236007                    LDQ     256,DL
        24 004356   000000 256100                    ORSQ    0,,PR0

     1864    25690    7                  NEW_FILE = '0'B;         /* Not a new file anymore             */

  25690 24 004357   200026 450100                    STZ     NEW_FILE,,AUTO

     1865    25691    7                  END;

     1866    25692    7               DO WHILE( IN_GRAN$ <= IN_GRAN_MAX$ );

  25692 24 004360   004554 236000 2                  LDQ     IN_GRAN_MAX$
        24 004361   004552 116000 2                  CMPQ    IN_GRAN$
        24 004362   004370 602000 24                 TNC     s:25698

     1867    25693    7                  CALL FLX_ADD_ANOTHER_GRAN ALTRET( JUSTALT );

  25693 24 004363   005746 701000 24                 TSX1    FLX_ADD_ANOTHER_GRAN
        24 004364   004614 702000 24                 TSX2    JUSTALT

     1868    25694    7                  END;

  25694 24 004365   004554 236000 2                  LDQ     IN_GRAN_MAX$
        24 004366   004552 116000 2                  CMPQ    IN_GRAN$
        24 004367   004363 603000 24                 TRC     s:25693

     1869    25695        /***
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:253  
     1870    25696        *** Another file copied to destination - decrement number of archive files to proc.
     1871    25697         ***/
     1872    25698    6               IF IN_BLK_TAG.FIN

  25698 24 004370   004542 470400 2                  LDP0    IN_BLK_TAG$
        24 004371   000000 236100                    LDQ     0,,PR0
        24 004372   000200 316007                    CANQ    128,DL
        24 004373   004376 600000 24                 TZE     s:25701

     1873    25699    6                THEN NBR_ARCH_FILES_TO_PROCESS = NBR_ARCH_FILES_TO_PROCESS - 1;

  25699 24 004374   000001 336007                    LCQ     1,DL
        24 004375   200030 056100                    ASQ     NBR_ARCH_FILES_TO_PROCESS,,AUTO

     1874    25700
     1875    25701    6               OUT_BLK_TAG.FIN = IN_BLK_TAG.FIN;

  25701 24 004376   004543 471400 2                  LDP1    OUT_BLK_TAG$
        24 004377   000000 236100                    LDQ     0,,PR0
        24 004400   100000 676100                    ERQ     0,,PR1
        24 004401   000200 376007                    ANQ     128,DL
        24 004402   100000 656100                    ERSQ    0,,PR1

     1876    25702    6               END;

     1877    25703    5            NEW_FILE = IN_BLK_TAG.FIN;     /* Next is new file if current ends   */

  25703 24 004403   004542 470400 2                  LDP0    IN_BLK_TAG$
        24 004404   000000 236100                    LDQ     0,,PR0
        24 004405   000034 736000                    QLS     28
        24 004406   400000 376003                    ANQ     -131072,DU
        24 004407   200026 756100                    STQ     NEW_FILE,,AUTO

     1878    25704    5            END;

  25704 24 004410   004546 236000 2                  LDQ     IN_BLK_TAG_IX
        24 004411   004551 116000 2                  CMPQ    IN_BLK_TAG_IX_MAX
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:254  
        24 004412   004152 604000 24                 TMI     s:25618

     1879    25705
     1880    25706    4         CALL M$READ( READ_TAPE_SOURCE )

  25706 24 004413   004660 630400 2                  EPPR0   READ_TAPE_SOURCE
        24 004414   440000 713400                    CLIMB   alt,read
        24 004415   401400 401760                    pmme    nvectors=4
        24 004416   004560 702000 24                 TSX2    s:25771

     1881    25707    5          WHENRETURN DO;

     1882    25708    5            IF M$TAPE_SOURCE$->F$DCB.TYC.IOERR# /* Tape I/O error?               */

  25708 24 004417   004535 470400 2                  LDP0    M$TAPE_SOURCE$
        24 004420   000002 430100                    FSZN    2,,PR0
        24 004421   004534 605000 24                 TPL     s:25763

     1883    25709    6             THEN DO;

     1884    25710
     1885    25711    6               CODE = %E$IOERR;

  25711 24 004422   000010 235007                    LDA     8,DL
        24 004423   000170 755000 2                  STA     CODE

     1886    25712    6               CALL FLX_CHECK_CURRENT_GRAN( '1'B, NEW_FILE )

  25712 24 004424   200026 631500                    EPPR1   NEW_FILE,,AUTO
        24 004425   200054 451500                    STP1    @FORCE+1,,AUTO
        24 004426   000100 236000 25                 LDQ     64
        24 004427   200053 756100                    STQ     ACCT_NAME+2,,AUTO
        24 004430   005040 701000 24                 TSX1    FLX_CHECK_CURRENT_GRAN
        24 004431   004614 702000 24                 TSX2    JUSTALT

     1887    25713    6                 ALTRET( JUSTALT );
     1888    25714
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:255  
     1889    25715    6               IF OUTPUT_TAPE_OPEN

  25715 24 004432   200024 234100                    SZN     OUTPUT_TAPE_OPEN,,AUTO
        24 004433   004445 605000 24                 TPL     s:25730

     1890    25716    7                THEN DO;

     1891    25717    7                  CALL FLI$TAPE_CLOSE( VECTOR(CVOL_UTL) ) ALTRET( NO_RPT_ERR );

  25717 24 004434   000130 630400 25                 EPPR0   88
        24 004435   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 004436   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        24 004437   004613 702000 24                 TSX2    NO_RPT_ERR

     1892    25718    7                  OUTPUT_TAPE_OPEN = %NO#;

  25718 24 004440   200024 450100                    STZ     OUTPUT_TAPE_OPEN,,AUTO

     1893    25719
     1894    25720    7                  IF ARCOM_OPTIONS.IMMUPDATE /* Update fits immediately?         */

  25720 24 004441   000000 234000 xsym               SZN     ARCOM_OPTIONS
        24 004442   004445 605000 24                 TPL     s:25730

     1895    25721    8                   THEN DO;

     1896    25722    8                     CALL FLX_UPDATE_ARC_FILES ALTRET( NO_RPT_ERR );

  25722 24 004443   006116 701000 24                 TSX1    FLX_UPDATE_ARC_FILES
        24 004444   004613 702000 24                 TSX2    NO_RPT_ERR

     1897    25723    8                     END;

     1898    25724    7                  END;

     1899    25725        /***
     1900    25726         *** Report error and partial file name if all of previous file not read.
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:256  
     1901    25727         *** Note that the name and account may not be output for the error msge. if
     1902    25728         *** the block tags are not valid (garbage) as a result of the I/O error.
     1903    25729         ***/
     1904    25730    6               DCB# = OPEN_TAPE_SOURCE.V.DCB#;

  25730 24 004445   004632 235000 2                  LDA     OPEN_TAPE_SOURCE+36
        24 004446   000022 771000                    ARL     18
        24 004447   200021 755100                    STA     DCB#,,AUTO

     1905    25731    6               CALL FLI$RPT_ERR( E_IO_ERR, DCB# );

  25731 24 004450   200021 630500                    EPPR0   DCB#,,AUTO
        24 004451   200071 450500                    STP0    NEW_FSN+4,,AUTO
        24 004452   000134 236000 25                 LDQ     92
        24 004453   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 004454   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 004455   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 004456   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 004457   000000 011000                    NOP     0

     1906    25732    6               IF NOT NEW_FILE

  25732 24 004460   200026 234100                    SZN     NEW_FILE,,AUTO
        24 004461   004464 604000 24                 TMI     s:25741

     1907    25733    6                THEN CALL FLX_REPORT_PARTIAL_FILE;

  25733 24 004462   006010 701000 24                 TSX1    FLX_REPORT_PARTIAL_FILE
        24 004463   000000 011000                    NOP     0

     1908    25734
     1909    25735        /***
     1910    25736         *** Attempt to read next block. If not possible to read past bad spot, return
     1911    25737         *** and read next EFT file. A number of files may be skipped in the process.
     1912    25738         *** Note that when attempting to read the next block, TFM reads as much as
     1913    25739         *** possible (ARS reflects how much it was able to read).
     1914    25740         ***/
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:257  
     1915    25741    6               CALL M$READ( READ_TAPE_SOURCE )

  25741 24 004464   004660 630400 2                  EPPR0   READ_TAPE_SOURCE
        24 004465   440000 713400                    CLIMB   alt,read
        24 004466   401400 401760                    pmme    nvectors=4
        24 004467   004473 702000 24                 TSX2    s:25746

     1916    25742    7                WHENRETURN DO;

     1917    25743    7                  NEW_FILE = '1'B;         /* Search blocks for new file         */

  25743 24 004470   400000 236003                    LDQ     -131072,DU
        24 004471   200026 756100                    STQ     NEW_FILE,,AUTO

     1918    25744    7                  END;

  25744 24 004472   004534 710000 24                 TRA     s:25763

     1919    25745    7                WHENALTRETURN DO;

     1920    25746    7                  CODE = B$TCB.ALT$->B$ALT.ERR.CODE;

  25746 24 004473   000000 470400 xsym               LDP0    B$TCB$
        24 004474   000000 471500                    LDP1    0,,PR0
        24 004475   100102 236100                    LDQ     66,,PR1
        24 004476   000003 772000                    QRL     3
        24 004477   037777 376007                    ANQ     16383,DL
        24 004500   000170 756000 2                  STQ     CODE

     1921    25747
     1922    25748    8                  DO CASE( CODE );

  25748 24 004501   000005 136007                    SBLQ    5,DL
        24 004502   000001 116007                    CMPQ    1,DL
        24 004503   004505 602006 24                 TNC     s:25748+4,QL
        24 004504   004512 710000 24                 TRA     s:25753
        24 004505   004506 710000 24                 TRA     s:25750
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:258  

     1923    25749    8                   CASE( %E$BLNKTP );

     1924    25750    8                     GET_NXT_VOL = '1'B;   /* No more data on this tape          */

  25750 24 004506   400000 236003                    LDQ     -131072,DU
        24 004507   200047 473500                    LDP3    @GET_NXT_VOL,,AUTO
        24 004510   300000 756100                    STQ     0,,PR3

     1925    25751    8                     GOTO JUSTALT; /* Return to mount next vol, read rest of file */

  25751 24 004511   004614 710000 24                 TRA     JUSTALT

     1926    25752    8                   CASE( ELSE );

     1927    25753    8                     NEW_FILE = '1'B;      /* Unable to read next block          */

  25753 24 004512   400000 236003                    LDQ     -131072,DU
        24 004513   200026 756100                    STQ     NEW_FILE,,AUTO

     1928    25754    8                     IN_BLK_TAG0$ = PINCRW( INBUF_.PTR$, IN_BLK_TAG_IX_MAX * SIZEW(
             25754                              IN_BLK_TAG) );

  25754 24 004514   004551 236000 2                  LDQ     IN_BLK_TAG_IX_MAX
        24 004515   000013 402003                    MPY     11,DU
        24 004516   000215 036000 2                  ADLQ    INBUF_+1
        24 004517   004544 756000 2                  STQ     IN_BLK_TAG0$

     1929    25755    8                     IN_GRAN_BASE$ = PINCRW( IN_BLK_TAG0$, SIZEW(IN_BLK_TAG0) );

  25755 24 004520   000013 036003                    ADLQ    11,DU
        24 004521   004557 756000 2                  STQ     IN_GRAN_BASE$

     1930    25756    8                    IN_GRAN_MAX_CHK$ = PINCRC( INBUF_.PTR$, M$TAPE_SOURCE$->F$DCB.ARS#
             25756                              - 4096 );

  25756 24 004522   004535 471400 2                  LDP1    M$TAPE_SOURCE$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:259  
        24 004523   100000 236100                    LDQ     0,,PR1
        24 004524   000020 736000                    QLS     16
        24 004525   002000 136003                    SBLQ    1024,DU
        24 004526   000215 036000 2                  ADLQ    INBUF_+1
        24 004527   004555 756000 2                  STQ     IN_GRAN_MAX_CHK$

     1931    25757    8                     IN_BLK_TAG$ = IN_BLK_TAG0$;

  25757 24 004530   004544 236000 2                  LDQ     IN_BLK_TAG0$
        24 004531   004542 756000 2                  STQ     IN_BLK_TAG$

     1932    25758    8                     IN_BLK_TAG_IX = 0;

  25758 24 004532   004546 450000 2                  STZ     IN_BLK_TAG_IX

     1933    25759    8                     GOTO JUSTRET;         /* Return to open next EFT file       */

  25759 24 004533   004611 710000 24                 TRA     JUSTRET

     1934    25760    8                   END;

     1935    25761    7                  END;
     1936    25762    6               END;

     1937    25763    5            IN_BLK_TAG_IX_MAX = INBUF_.PTR$->IN_BLK_TAG.NBR;

  25763 24 004534   000215 470400 2                  LDP0    INBUF_+1
        24 004535   000000 236100                    LDQ     0,,PR0
        24 004536   000011 772000                    QRL     9
        24 004537   000777 376007                    ANQ     511,DL
        24 004540   004551 756000 2                  STQ     IN_BLK_TAG_IX_MAX

     1938    25764    5           IN_BLK_TAG0$ = PINCRW( INBUF_.PTR$, IN_BLK_TAG_IX_MAX * SIZEW(IN_BLK_TAG) )
             25764                     ;

  25764 24 004541   000013 402003                    MPY     11,DU
        24 004542   000215 036000 2                  ADLQ    INBUF_+1
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:260  
        24 004543   004544 756000 2                  STQ     IN_BLK_TAG0$

     1939    25765    5            IN_GRAN_BASE$ = PINCRW( IN_BLK_TAG0$, SIZEW(IN_BLK_TAG0) );

  25765 24 004544   000013 036003                    ADLQ    11,DU
        24 004545   004557 756000 2                  STQ     IN_GRAN_BASE$

     1940    25766    5           IN_GRAN_MAX_CHK$ = PINCRC( INBUF_.PTR$, M$TAPE_SOURCE$->F$DCB.ARS# - 4096 )
             25766                     ;

  25766 24 004546   004535 471400 2                  LDP1    M$TAPE_SOURCE$
        24 004547   100000 236100                    LDQ     0,,PR1
        24 004550   000020 736000                    QLS     16
        24 004551   002000 136003                    SBLQ    1024,DU
        24 004552   000215 036000 2                  ADLQ    INBUF_+1
        24 004553   004555 756000 2                  STQ     IN_GRAN_MAX_CHK$

     1941    25767    5            IN_BLK_TAG$ = IN_BLK_TAG0$;

  25767 24 004554   004544 236000 2                  LDQ     IN_BLK_TAG0$
        24 004555   004542 756000 2                  STQ     IN_BLK_TAG$

     1942    25768    5            IN_BLK_TAG_IX = 0;

  25768 24 004556   004546 450000 2                  STZ     IN_BLK_TAG_IX

     1943    25769    5            END;

  25769 24 004557   004607 710000 24                 TRA     s:25786

     1944    25770    5          WHENALTRETURN DO;

     1945    25771    5            CODE = B$TCB.ALT$->B$ALT.ERR.CODE;

  25771 24 004560   000000 470400 xsym               LDP0    B$TCB$
        24 004561   000000 471500                    LDP1    0,,PR0
        24 004562   100102 236100                    LDQ     66,,PR1
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:261  
        24 004563   000003 772000                    QRL     3
        24 004564   037777 376007                    ANQ     16383,DL
        24 004565   000170 756000 2                  STQ     CODE

     1946    25772    5            IF CODE = %E$EOF

  25772 24 004566   000006 116007                    CMPQ    6,DL
        24 004567   004572 601000 24                 TNZ     s:25775

     1947    25773    5             THEN READING_TAPE_SOURCE = '0'B;

  25773 24 004570   200022 450100                    STZ     READING_TAPE_SOURCE,,AUTO
        24 004571   004607 710000 24                 TRA     s:25786

     1948    25774    6             ELSE DO;

     1949    25775    6               IF ( IOERRORC AND CODE = %E$BLNKTP )

  25775 24 004572   200042 234100                    SZN     IOERRORC,,AUTO
        24 004573   004576 605000 24                 TPL     s:25775+4
        24 004574   000005 116007                    CMPQ    5,DL
        24 004575   004602 600000 24                 TZE     s:25778
        24 004576   200042 234100                    SZN     IOERRORC,,AUTO
        24 004577   004606 605000 24                 TPL     s:25782
        24 004600   001275 116007                    CMPQ    701,DL
        24 004601   004606 601000 24                 TNZ     s:25782

     1950    25776    6                 OR ( IOERRORC AND CODE = %E$POSERR ) /* Illegal ANS tape label  */
     1951    25777    7                THEN DO;    /* Return to calling routine to mount next volume    */

     1952    25778    7                  GET_NXT_VOL = '1'B;

  25778 24 004602   400000 236003                    LDQ     -131072,DU
        24 004603   200047 473500                    LDP3    @GET_NXT_VOL,,AUTO
        24 004604   300000 756100                    STQ     0,,PR3

     1953    25779    7                  GOTO JUSTALT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:262  

  25779 24 004605   004614 710000 24                 TRA     JUSTALT

     1954    25780    7                  END;
     1955    25781    7                ELSE DO;

     1956    25782    7                  GOTO JUSTALT;

  25782 24 004606   004614 710000 24                 TRA     JUSTALT

     1957    25783    7                  END;
     1958    25784    6               END;
     1959    25785    5            END;
     1960    25786    4         END;

  25786 24 004607   200022 234100                    SZN     READING_TAPE_SOURCE,,AUTO
        24 004610   004147 604000 24                 TMI     s:25612

     1961    25787
     1962    25788    3   JUSTRET:
     1963    25789    3      RETURN;

  25789 24 004611   200046 221300       JUSTRET      LDX1  ! INPUT_FSN+2,,AUTO
        24 004612   000001 702211                    TSX2  ! 1,X1

  25782 24 004613                       NO_RPT_ERR   null
     1964    25790
     1965    25791    3   NO_RPT_ERR: ;
     1966    25792    3      RPT_ERR = '0'B;

  25792 24 004613   200035 450100                    STZ     RPT_ERR,,AUTO

  25792 24 004614                       JUSTALT      null
     1967    25793
     1968    25794    3   JUSTALT: ;
     1969    25795    3      ALTRETURN;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:263  
  25795 24 004614   200046 221300                    LDX1  ! INPUT_FSN+2,,AUTO
        24 004615   000000 702211                    TSX2  ! 0,X1

     1970    25796
     1971    25797    3   END FLX_PROCESS_TAPE_SOURCE_FILE;
     1972    25798        /******************************/
     1973    25799    2   FLX_CHECK_ARC_LIST: PROC ALTRET;

  25799 24 004616   200050 741300       FLX_CHECK_A* STX1  ! NIX+1,,AUTO

     1974    25800        /*F*  NAME: FLX_CHECK_ARC_LIST
     1975    25801              PURPOSE: Check current tape/optical disk source file against archive list.
     1976    25802        */
     1977    25803
     1978    25804        /********************/
     1979    25805
     1980    25806    3      SKIP_FILE = '1'B;                    /* Assume file should be skipped      */

  25806 24 004617   400000 236003                    LDQ     -131072,DU
        24 004620   200025 756100                    STQ     SKIP_FILE,,AUTO

     1981    25807
     1982    25808         /***
     1983    25809          *** Build archive list key with current tape/optical disk source file info.
     1984    25810          ***/
     1985    25811
     1986    25812    3      ARC_LIST_KEY.C.PSN = IN_BLK_TAG0.WHERE.PSN;

  25812 24 004621   004544 470400 2                  LDP0    IN_BLK_TAG0$
        24 004622   040000 100500                    MLR     fill='040'O
        24 004623   000003 000006                    ADSC9   3,,PR0                   cn=0,n=6
        24 004624   000222 200006 2                  ADSC9   ARC_LIST_KEY             cn=1,n=6

     1987    25813    3      ARC_LIST_KEY.C.ACCT = IN_BLK_TAG0.WHERE.ACCT;

  25813 24 004625   040000 100500                    MLR     fill='040'O
        24 004626   000004 400010                    ADSC9   4,,PR0                   cn=2,n=8
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:264  
        24 004627   000223 600010 2                  ADSC9   ARC_LIST_KEY+1           cn=3,n=8

     1988    25814    3      ARC_LIST_KEY.C.FNAMEC = IN_BLK_TAG.NAME.C;

  25814 24 004630   004542 471400 2                  LDP1    IN_BLK_TAG$
        24 004631   040000 100500                    MLR     fill='040'O
        24 004632   100003 200037                    ADSC9   3,,PR1                   cn=1,n=31
        24 004633   000225 600037 2                  ADSC9   ARC_LIST_KEY+3           cn=3,n=31

     1989    25815    3      ARC_LIST_KEY.C.FNAMEL = IN_BLK_TAG.NAME.L;

  25815 24 004634   100003 236100                    LDQ     3,,PR1
        24 004635   000022 772000                    QRL     18
        24 004636   000235 552010 2                  STBQ    ARC_LIST_KEY+11,'10'O

     1990    25816
     1991    25817         /***
     1992    25818          *** Get archive list record for current tape/optical disk source file.
     1993    25819          *** If current tape/optical disk source file corresponds to disk file,
     1994    25820          *** get ready to include the tape source/optical disk file on the output tape.
     1995    25821          *** Otherwise, remember tape/optical disk source file.
     1996    25822          ***/
     1997    25823
     1998    25824    3      CALL M$READ( READ_ARC_LIST_BY_KEY )

  25824 24 004637   000146 630400 23                 EPPR0   READ_ARC_LIST_BY_KEY
        24 004640   440000 713400                    CLIMB   alt,read
        24 004641   401400 401760                    pmme    nvectors=4
        24 004642   005002 702000 24                 TSX2    s:25877

     1999    25825    4       WHENRETURN DO;

     2000    25826    4         ARC_LIST_REC.NBR_ON_TAPE = ARC_LIST_REC.NBR_ON_TAPE + 1;
             25826                  /* Count occurrances */

  25826 24 004643   003162 054000 2                  AOS     ARC_LIST_REC+4

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:265  
     2001    25827
     2002    25828    4         IF (M$TAPE_SOURCE$->F$DCB.PSN# = ARC_LIST_REC.REEL /* Reel spec'd in fit? */

  25828 24 004644   004535 470400 2                  LDP0    M$TAPE_SOURCE$
        24 004645   040000 106500                    CMPC    fill='040'O
        24 004646   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
        24 004647   003156 000006 2                  ADSC9   ARC_LIST_REC             cn=0,n=6
        24 004650   004654 601000 24                 TNZ     s:25828+8
        24 004651   003157 720000 2                  LXL0    ARC_LIST_REC+1
        24 004652   000034 100100                    CMPX0   28,,PR0
        24 004653   004662 600000 24                 TZE     s:25833
        24 004654   000000 236000 xsym               LDQ     ARCOM_OPTIONS
        24 004655   040000 316003                    CANQ    16384,DU
        24 004656   004771 600000 24                 TZE     s:25871
        24 004657   003157 720000 2                  LXL0    ARC_LIST_REC+1
        24 004660   000034 100100                    CMPX0   28,,PR0
        24 004661   004771 601000 24                 TNZ     s:25871

     2003    25829    4           AND M$TAPE_SOURCE$->F$DCB.FSN# = ARC_LIST_REC.FSN)
     2004    25830    4           OR (ARCOM_OPTIONS.DUPLICATE_TAPESET /* Duplicate reel spec'd ?        */
     2005    25831    4           AND M$TAPE_SOURCE$->F$DCB.FSN# = ARC_LIST_REC.FSN)
     2006    25832    5          THEN DO;                         /* Found a correspondence             */

     2007    25833    5            SKIP_FILE = '0'B;

  25833 24 004662   200025 450100                    STZ     SKIP_FILE,,AUTO

     2008    25834
     2009    25835    5            IF NBR_FILE_BLOCKS >= %MAX_NBR_FILE_BLOCKS

  25835 24 004663   000000 235000 xsym               LDA     NBR_FILE_BLOCKS
        24 004664   000062 115007                    CMPA    50,DL
        24 004665   004715 604000 24                 TMI     s:25855

     2010    25836    6             THEN DO;       /* Must move on to new tape/optical disk output file */

     2011    25837    6               CALL FLX_CHECK_CURRENT_GRAN( '1'B ) ALTRET( JUSTALT );
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:266  

  25837 24 004666   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 004667   200054 756100                    STQ     @FORCE+1,,AUTO
        24 004670   000100 236000 25                 LDQ     64
        24 004671   200053 756100                    STQ     ACCT_NAME+2,,AUTO
        24 004672   005040 701000 24                 TSX1    FLX_CHECK_CURRENT_GRAN
        24 004673   005036 702000 24                 TSX2    JUSTALT

     2012    25838    6               CALL FLI$TAPE_CLOSE( VECTOR(CVOL_UTL) )

  25838 24 004674   000130 630400 25                 EPPR0   88
        24 004675   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 004676   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        24 004677   004701 702000 24                 TSX2    s:25840
        24 004700   004704 710000 24                 TRA     s:25843

     2013    25839    7                WHENALTRETURN DO;

     2014    25840    7                  RPT_ERR = '0'B;

  25840 24 004701   200035 450100                    STZ     RPT_ERR,,AUTO

     2015    25841    7                  ALTRETURN;

  25841 24 004702   200050 221300                    LDX1  ! NIX+1,,AUTO
        24 004703   000000 702211                    TSX2  ! 0,X1

     2016    25842    7                  END;
     2017    25843    6               OUTPUT_TAPE_OPEN = '0'B;

  25843 24 004704   200024 450100                    STZ     OUTPUT_TAPE_OPEN,,AUTO

     2018    25844
     2019    25845    6               IF ARCOM_OPTIONS.IMMUPDATE  /* Update fits immediately ?          */

  25845 24 004705   000000 234000 xsym               SZN     ARCOM_OPTIONS
        24 004706   004715 605000 24                 TPL     s:25855
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:267  

     2020    25846    7                THEN DO;

     2021    25847    7                  CALL FLX_UPDATE_ARC_FILES

  25847 24 004707   006116 701000 24                 TSX1    FLX_UPDATE_ARC_FILES
        24 004710   004712 702000 24                 TSX2    s:25849
        24 004711   004715 710000 24                 TRA     s:25855

     2022    25848    8                   WHENALTRETURN DO;

     2023    25849    8                     RPT_ERR = '0'B;

  25849 24 004712   200035 450100                    STZ     RPT_ERR,,AUTO

     2024    25850    8                     ALTRETURN;

  25850 24 004713   200050 221300                    LDX1  ! NIX+1,,AUTO
        24 004714   000000 702211                    TSX2  ! 0,X1

     2025    25851    8                     END;
     2026    25852    7                  END;

     2027    25853    6               END;

     2028    25854
     2029    25855    5            IF NOT OUTPUT_TAPE_OPEN

  25855 24 004715   200024 234100                    SZN     OUTPUT_TAPE_OPEN,,AUTO
        24 004716   004767 604000 24                 TMI     s:25868

     2030    25856    6             THEN DO;                      /* Open output tape/optical disk      */

     2031    25857    6               CALL FLI$TAPE_OPEN( NAME_, SN, FSN, '0'B, '0'B, , FPARAM_, ERR, DCB# )

  25857 24 004717   200021 630500                    EPPR0   DCB#,,AUTO
        24 004720   200100 450500                    STP0    NEW_FSN+11,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:268  
        24 004721   200017 631500                    EPPR1   ERR,,AUTO
        24 004722   200077 451500                    STP1    NEW_FSN+10,,AUTO
        24 004723   000007 236000 25                 LDQ     7
        24 004724   200076 756100                    STQ     NEW_FSN+9,,AUTO
        24 004725   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 004726   000071 235000 25                 LDA     57
        24 004727   200074 757100                    STAQ    NEW_FSN+7,,AUTO
        24 004730   000071 236000 25                 LDQ     57
        24 004731   200073 756100                    STQ     NEW_FSN+6,,AUTO
        24 004732   200015 633500                    EPPR3   FSN,,AUTO
        24 004733   200072 453500                    STP3    NEW_FSN+5,,AUTO
        24 004734   200013 634500                    EPPR4   SN,,AUTO
        24 004735   200071 454500                    STP4    NEW_FSN+4,,AUTO
        24 004736   000137 236000 25                 LDQ     95
        24 004737   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 004740   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 004741   000132 631400 25                 EPPR1   90
        24 004742   000000 701000 xent               TSX1    FLI$TAPE_OPEN
        24 004743   004745 702000 24                 TSX2    s:25859
        24 004744   004760 710000 24                 TRA     s:25863

     2032    25858    7                WHENALTRETURN DO;

     2033    25859    7                  CALL FLI$RPT_ERR( ERR, DCB# );

  25859 24 004745   200021 630500                    EPPR0   DCB#,,AUTO
        24 004746   200071 450500                    STP0    NEW_FSN+4,,AUTO
        24 004747   200017 631500                    EPPR1   ERR,,AUTO
        24 004750   200070 451500                    STP1    NEW_FSN+3,,AUTO
        24 004751   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 004752   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 004753   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 004754   000000 011000                    NOP     0

     2034    25860    7                  RPT_ERR = '0'B;

  25860 24 004755   200035 450100                    STZ     RPT_ERR,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:269  

     2035    25861    7                  ALTRETURN;

  25861 24 004756   200050 221300                    LDX1  ! NIX+1,,AUTO
        24 004757   000000 702211                    TSX2  ! 0,X1

     2036    25862    7                  END;
     2037    25863    6               PREV_REEL = SN;

  25863 24 004760   040000 100500                    MLR     fill='040'O
        24 004761   200013 000006                    ADSC9   SN,,AUTO                 cn=0,n=6
        24 004762   004561 000006 2                  ADSC9   PREV_REEL                cn=0,n=6

     2038    25864    6               NBR_SUB_FILES = 0;
             25864                        /* Zero count of files in output tape/optical disk file */

  25864 24 004763   200031 450100                    STZ     NBR_SUB_FILES,,AUTO

     2039    25865    6               NBR_FILE_BLOCKS = 0;

  25865 24 004764   000000 450000 xsym               STZ     NBR_FILE_BLOCKS

     2040    25866    6               OUTPUT_TAPE_OPEN = '1'B;

  25866 24 004765   400000 236003                    LDQ     -131072,DU
        24 004766   200024 756100                    STQ     OUTPUT_TAPE_OPEN,,AUTO

     2041    25867    6               END;

     2042    25868    5            NBR_SUB_FILES = NBR_SUB_FILES + 1;

  25868 24 004767   200031 054100                    AOS     NBR_SUB_FILES,,AUTO

     2043    25869    5            END;

  25869 24 004770   005001 710000 24                 TRA     s:25875

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:270  
     2044    25870    5          ELSE DO;                         /* This file should be skipped        */

     2045    25871    5            WRITE_ARC_LIST_BY_KEY.KEY_ = VECTOR(ARC_LIST_KEY);

  25871 24 004771   000140 237000 25                 LDAQ    96
        24 004772   005024 757000 2                  STAQ    WRITE_ARC_LIST_BY_KEY+2

     2046    25872    5            WRITE_ARC_LIST_BY_KEY.BUF_ = VECTOR(ARC_LIST_REC);

  25872 24 004773   000142 237000 25                 LDAQ    98
        24 004774   005026 757000 2                  STAQ    WRITE_ARC_LIST_BY_KEY+4

     2047    25873    5            CALL M$WRITE( WRITE_ARC_LIST_BY_KEY ) ALTRET( JUSTALT );

  25873 24 004775   005022 630400 2                  EPPR0   WRITE_ARC_LIST_BY_KEY
        24 004776   440001 713400                    CLIMB   alt,write
        24 004777   401400 401760                    pmme    nvectors=4
        24 005000   005036 702000 24                 TSX2    JUSTALT

     2048    25874    5            END;

     2049    25875    4         END;

  25875 24 005001   005034 710000 24                 TRA     s:25890

     2050    25876    4       WHENALTRETURN DO;

     2051    25877    4         IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$NOKEY

  25877 24 005002   000000 470400 xsym               LDP0    B$TCB$
        24 005003   000000 471500                    LDP1    0,,PR0
        24 005004   100102 236100                    LDQ     66,,PR1
        24 005005   377770 376007                    ANQ     131064,DL
        24 005006   001020 116007                    CMPQ    528,DL
        24 005007   005032 601000 24                 TNZ     s:25887

     2052    25878    5          THEN DO;               /* Never seen this file before, remember it     */
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:271  

     2053    25879    5            ARC_LIST_REC.REEL = ' ';

  25879 24 005010   040000 100400                    MLR     fill='040'O
        24 005011   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 005012   003156 000006 2                  ADSC9   ARC_LIST_REC             cn=0,n=6

     2054    25880    5            ARC_LIST_REC.FSN = 0;

  25880 24 005013   000000 220003                    LDX0    0,DU
        24 005014   003157 440000 2                  SXL0    ARC_LIST_REC+1

     2055    25881    5            ARC_LIST_REC.NEW.REEL = ' ';

  25881 24 005015   040000 100400                    MLR     fill='040'O
        24 005016   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 005017   003160 000006 2                  ADSC9   ARC_LIST_REC+2           cn=0,n=6

     2056    25882    5            ARC_LIST_REC.NEW.FSN = 0;

  25882 24 005020   003161 440000 2                  SXL0    ARC_LIST_REC+3

     2057    25883    5            ARC_LIST_REC.NBR_ON_TAPE = 1;

  25883 24 005021   000001 235007                    LDA     1,DL
        24 005022   003162 755000 2                  STA     ARC_LIST_REC+4

     2058    25884    5            ARC_LIST_REC.ACTIVE = ' ';

  25884 24 005023   040000 236003                    LDQ     16384,DU
        24 005024   003163 756000 2                  STQ     ARC_LIST_REC+5

     2059    25885    5            CALL M$WRITE( WRITE_ARC_LIST_BY_KEY_NEW ) ALTRET( JUSTALT );

  25885 24 005025   000164 630400 23                 EPPR0   WRITE_ARC_LIST_BY_KEY_NEW
        24 005026   440001 713400                    CLIMB   alt,write
        24 005027   401400 401760                    pmme    nvectors=4
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:272  
        24 005030   005036 702000 24                 TSX2    JUSTALT

     2060    25886    5            END;

  25886 24 005031   005034 710000 24                 TRA     s:25890

     2061    25887    4          ELSE ALTRETURN;

  25887 24 005032   200050 221300                    LDX1  ! NIX+1,,AUTO
        24 005033   000000 702211                    TSX2  ! 0,X1

     2062    25888    4         END;
     2063    25889
     2064    25890    3      RETURN;

  25890 24 005034   200050 221300                    LDX1  ! NIX+1,,AUTO
        24 005035   000001 702211                    TSX2  ! 1,X1

  25885 24 005036                       JUSTALT      null
     2065    25891
     2066    25892    3   JUSTALT: ;
     2067    25893    3      ALTRETURN;

  25893 24 005036   200050 221300                    LDX1  ! NIX+1,,AUTO
        24 005037   000000 702211                    TSX2  ! 0,X1

     2068    25894
     2069    25895    3   END FLX_CHECK_ARC_LIST;
     2070    25896        /******************************/
     2071    25897    2   FLX_CHECK_CURRENT_GRAN: PROC( FORCE, FILE_FIN ) ALTRET;

  25897 24 005040   200052 741300       FLX_CHECK_C* STX1  ! ACCT_NAME+1,,AUTO

     2072    25898        /*F*  NAME: FLX_CHECK_CURRENT_GRAN
     2073    25899              PURPOSE: Writes current tape/optical disk output granule if it is full or
     2074    25900                 forced.
     2075    25901        */
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:273  
     2076    25902
     2077    25903    3   DCL FORCE BIT(1) ALIGNED;          /* Indicates write whether full or not     */
     2078    25904    3   DCL FILE_FIN BIT(1) ALIGNED; /* Indicates whether last input file is complete */
     2079    25905
     2080    25906         /***
     2081    25907          *** AUTO
     2082    25908          ***/
     2083    25909
     2084    25910    3   DCL BUF_ BIT(72) DALIGNED AUTO;
     2085    25911    3   DCL I SBIN AUTO;
     2086    25912    3   DCL EOVOL BIT(1) AUTO;
     2087    25913    3   DCL ARS SBIN AUTO;
     2088    25914    3   DCL NEW_TSN CHAR(6) CALIGNED; /* New current tape SN rtrnd on IOERRCONT, I-O err */
     2089    25915    3   DCL NEW_FSN UBIN WORD ALIGNED;
             25915            /* New current tape FSN rtrnd on IOERRCONT, I-O err */
     2090    25916
     2091    25917        /***
     2092    25918         *** STATIC
     2093    25919         ***/
     2094    25920
     2095    25921    3   DCL 1 LAST_BLK_ARC_LIST_KEY ALIGNED STATIC,
     2096    25922              %ARC_LIST_KEY;
     2097    25930    3   DCL 1 LAST_BLK_ARC_LIST_REC ALIGNED STATIC,
     2098    25931              %ARC_LIST_REC;
     2099    25940
     2100    25941
     2101    25942        /********************/
     2102    25943
     2103    25944    3      IF PINCRW( OUT_GRAN$, 1024 ) >= OUT_GRAN_MAX$

  25944 24 005041   004553 236000 2                  LDQ     OUT_GRAN$
        24 005042   002000 036003                    ADLQ    1024,DU
        24 005043   004556 116000 2                  CMPQ    OUT_GRAN_MAX$
        24 005044   005053 603000 24                 TRC     s:25948
        24 005045   200053 470500                    LDP0    @FORCE,,AUTO
        24 005046   000000 234100                    SZN     0,,PR0
        24 005047   005671 605000 24                 TPL     s:26102
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:274  
        24 005050   004553 236000 2                  LDQ     OUT_GRAN$
        24 005051   004560 116000 2                  CMPQ    OUT_GRAN_BASE$
        24 005052   005671 602000 24                 TNC     s:26102

     2104    25945    3        OR (FORCE AND OUT_GRAN$ >= OUT_GRAN_BASE$)
     2105    25946    4       THEN DO;                       /* Full, or forced and something to write  */

     2106    25947
     2107    25948    4         TVECTOR = OUTBUF_;                /* Set up buffer vector               */

  25948 24 005053   000000 237000 xsym               LDAQ    OUTBUF_
        24 005054   000000 757000 xsym               STAQ    TVECTOR

     2108    25949    4         ARS = POFFC( OUT_GRAN$, OUT_BLK_TAG$ ) + 4096; /* Tag bytes + block bytes */

  25949 24 005055   004543 236000 2                  LDQ     OUT_BLK_TAG$
        24 005056   000020 772000                    QRL     16
        24 005057   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 005060   004553 236000 2                  LDQ     OUT_GRAN$
        24 005061   000020 772000                    QRL     16
        24 005062   200070 136100                    SBLQ    NEW_FSN+3,,AUTO
        24 005063   010000 036007                    ADLQ    4096,DL
        24 005064   200062 756100                    STQ     ARS,,AUTO

     2109    25950    4         TVECTOR.W1.VSIZE# = ARS;

  25950 24 005065   000020 736000                    QLS     16
        24 005066   000000 676000 xsym               ERQ     TVECTOR
        24 005067   000034 376000 xsym               ANQ     B_VECTNIL+28
        24 005070   000000 656000 xsym               ERSQ    TVECTOR

     2110    25951    4         TVECTOR.PTR$ = OUT_BLK_TAG$;

  25951 24 005071   004543 236000 2                  LDQ     OUT_BLK_TAG$
        24 005072   000001 756000 xsym               STQ     TVECTOR+1

     2111    25952    4         BUF_ = TVECTOR;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:275  

  25952 24 005073   000000 237000 xsym               LDAQ    TVECTOR
        24 005074   200056 757100                    STAQ    BUF_,,AUTO

     2112    25953
     2113    25954    5         DO I = 0 TO NBR_IN_OUT_BLK - 1;

  25954 24 005075   200060 450100                    STZ     I,,AUTO
        24 005076   005146 710000 24                 TRA     s:25962+1

     2114    25955    5            THIS_BLK_ARC_LIST_REC.NEW.REEL(I) = PREV_REEL;

  25955 24 005077   200060 236100                    LDQ     I,,AUTO
        24 005100   000006 402007                    MPY     6,DL
        24 005101   000002 736000                    QLS     2
        24 005102   040006 100400                    MLR     fill='040'O
        24 005103   004561 000006 2                  ADSC9   PREV_REEL                cn=0,n=6
        24 005104   003166 000006 2                  ADSC9   THIS_BLK_ARC_LIST_REC+2,Q cn=0,n=6

     2115    25956    5            THIS_BLK_ARC_LIST_REC.NEW.FSN(I) = FSN;

  25956 24 005105   200060 236100                    LDQ     I,,AUTO
        24 005106   000006 402007                    MPY     6,DL
        24 005107   200015 720100                    LXL0    FSN,,AUTO
        24 005110   003167 440006 2                  SXL0    THIS_BLK_ARC_LIST_REC+3,QL

     2116    25957    5            WRITE_ARC_LIST_BY_KEY.KEY_ = VECTOR(THIS_BLK_ARC_LIST_KEY(I));

  25957 24 005111   000140 235000 25                 LDA     96
        24 005112   200060 236100                    LDQ     I,,AUTO
        24 005113   200070 755100                    STA     NEW_FSN+3,,AUTO
        24 005114   000014 402003                    MPY     12,DU
        24 005115   000144 036000 25                 ADLQ    100
        24 005116   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 005117   005024 757000 2                  STAQ    WRITE_ARC_LIST_BY_KEY+2

     2117    25958    5            WRITE_ARC_LIST_BY_KEY.BUF_ = VECTOR(THIS_BLK_ARC_LIST_REC(I));
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:276  

  25958 24 005120   000142 235000 25                 LDA     98
        24 005121   200060 236100                    LDQ     I,,AUTO
        24 005122   200070 755100                    STA     NEW_FSN+3,,AUTO
        24 005123   000006 402003                    MPY     6,DU
        24 005124   000145 036000 25                 ADLQ    101
        24 005125   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 005126   005026 757000 2                  STAQ    WRITE_ARC_LIST_BY_KEY+4

     2118    25959    5            CALL M$WRITE( WRITE_ARC_LIST_BY_KEY ) ALTRET( JUSTALT );

  25959 24 005127   005022 630400 2                  EPPR0   WRITE_ARC_LIST_BY_KEY
        24 005130   440001 713400                    CLIMB   alt,write
        24 005131   401400 401760                    pmme    nvectors=4
        24 005132   005744 702000 24                 TSX2    JUSTALT

     2119    25960    5            LAST_BLK_ARC_LIST_REC = THIS_BLK_ARC_LIST_REC(I); /* Save - may need */

  25960 24 005133   200060 236100                    LDQ     I,,AUTO
        24 005134   000030 402007                    MPY     24,DL
        24 005135   000000 100406                    MLR     fill='000'O
        24 005136   003164 000025 2                  ADSC9   THIS_BLK_ARC_LIST_REC,Q  cn=0,n=21
        24 005137   006260 000025 2                  ADSC9   LAST_BLK_ARC_LIST_REC    cn=0,n=21

     2120    25961    5            LAST_BLK_ARC_LIST_KEY = THIS_BLK_ARC_LIST_KEY(I);

  25961 24 005140   200060 236100                    LDQ     I,,AUTO
        24 005141   000060 402007                    MPY     48,DL
        24 005142   000000 100406                    MLR     fill='000'O
        24 005143   000236 000057 2                  ADSC9   THIS_BLK_ARC_LIST_KEY,Q  cn=0,n=47
        24 005144   006244 000057 2                  ADSC9   LAST_BLK_ARC_LIST_KEY    cn=0,n=47

     2121    25962    5            END;

  25962 24 005145   200060 054100                    AOS     I,,AUTO
        24 005146   200060 236100                    LDQ     I,,AUTO
        24 005147   200033 116100                    CMPQ    NBR_IN_OUT_BLK,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:277  
        24 005150   005077 604000 24                 TMI     s:25955

     2122    25963
     2123    25964        /***
     2124    25965         *** If last input file is not complete, prevent its' fit from being updated.
     2125    25966         *** This may occur when file continues on next volume but the next volume was
     2126    25967         *** not specified by the user as source input on an I/O error.
     2127    25968         ***/
     2128    25969    4         IF ADDR(FILE_FIN) ~= ADDR(NIL) AND NOT FILE_FIN

  25969 24 005151   200054 236100                    LDQ     @FILE_FIN,,AUTO
        24 005152   000001 116000 xsym               CMPQ    B_VECTNIL+1
        24 005153   005174 600000 24                 TZE     s:25978
        24 005154   200054 470500                    LDP0    @FILE_FIN,,AUTO
        24 005155   000000 234100                    SZN     0,,PR0
        24 005156   005174 604000 24                 TMI     s:25978

     2129    25970    5          THEN DO;

     2130    25971    5            LAST_BLK_ARC_LIST_REC.NEW.REEL = ' ';

  25971 24 005157   040000 100400                    MLR     fill='040'O
        24 005160   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 005161   006262 000006 2                  ADSC9   LAST_BLK_ARC_LIST_REC+2  cn=0,n=6

     2131    25972    5            LAST_BLK_ARC_LIST_REC.NEW.FSN = 0;

  25972 24 005162   000000 220003                    LDX0    0,DU
        24 005163   006263 440000 2                  SXL0    LAST_BLK_ARC_LIST_REC+3

     2132    25973    5            WRITE_ARC_LIST_BY_KEY.KEY_ = VECTOR(LAST_BLK_ARC_LIST_KEY);

  25973 24 005164   000146 237000 25                 LDAQ    102
        24 005165   005024 757000 2                  STAQ    WRITE_ARC_LIST_BY_KEY+2

     2133    25974    5            WRITE_ARC_LIST_BY_KEY.BUF_ = VECTOR(LAST_BLK_ARC_LIST_REC);

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:278  
  25974 24 005166   000150 237000 25                 LDAQ    104
        24 005167   005026 757000 2                  STAQ    WRITE_ARC_LIST_BY_KEY+4

     2134    25975    5            CALL M$WRITE( WRITE_ARC_LIST_BY_KEY ) ALTRET( JUSTALT );

  25975 24 005170   005022 630400 2                  EPPR0   WRITE_ARC_LIST_BY_KEY
        24 005171   440001 713400                    CLIMB   alt,write
        24 005172   401400 401760                    pmme    nvectors=4
        24 005173   005744 702000 24                 TSX2    JUSTALT

     2135    25976    5            END;

     2136    25977
     2137    25978    4         IF OD_DEST    /* Save last OD serial number to detect ser. num. change  */

  25978 24 005174   200006 234100                    SZN     OD_DEST,,AUTO
        24 005175   005203 605000 24                 TPL     s:25981

     2138    25979    4          THEN LAST_TSN_USED = TAPE_DCBLIST.DCB$(0)->F$DCB.PSN#;

  25979 24 005176   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        24 005177   000001 471500                    LDP1    1,,PR0
        24 005200   040000 100500                    MLR     fill='040'O
        24 005201   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
        24 005202   000000 000006 xsym               ADSC9   LAST_TSN_USED            cn=0,n=6

     2139    25980
     2140    25981    4         NEW_TSN = ' ';

  25981 24 005203   040100 100400                    MLR     fill='040'O
        24 005204   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 005205   200063 000006                    ADSC9   NEW_TSN,,AUTO            cn=0,n=6

     2141    25982    4         NEW_FSN = 0;

  25982 24 005206   200065 450100                    STZ     NEW_FSN,,AUTO

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:279  
     2142    25983    4         CALL FLI$TAPE_WRITE( BUF_, ARS, EOVOL, %COMPACT, NEW_TSN, NEW_FSN ) ALTRET(
             25983                  NO_RPT_ERR );

  25983 24 005207   200065 630500                    EPPR0   NEW_FSN,,AUTO
        24 005210   200075 450500                    STP0    NEW_FSN+8,,AUTO
        24 005211   200063 631500                    EPPR1   NEW_TSN,,AUTO
        24 005212   200074 451500                    STP1    NEW_FSN+7,,AUTO
        24 005213   000103 236000 25                 LDQ     67
        24 005214   200073 756100                    STQ     NEW_FSN+6,,AUTO
        24 005215   200061 633500                    EPPR3   EOVOL,,AUTO
        24 005216   200072 453500                    STP3    NEW_FSN+5,,AUTO
        24 005217   200062 634500                    EPPR4   ARS,,AUTO
        24 005220   200071 454500                    STP4    NEW_FSN+4,,AUTO
        24 005221   200056 635500                    EPPR5   BUF_,,AUTO
        24 005222   200070 455500                    STP5    NEW_FSN+3,,AUTO
        24 005223   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 005224   000024 631400 xsym               EPPR1   B_VECTNIL+20
        24 005225   000000 701000 xent               TSX1    FLI$TAPE_WRITE
        24 005226   005743 702000 24                 TSX2    NO_RPT_ERR

     2143    25984        /***
     2144    25985         *** If IOERR CONT set and I-O error encountered, the previous block may have
     2145    25986         *** been moved to the next tape by FLI$TAPE_WRITE in order to continue.
     2146    25987         *** Modify previous and current block in *ARC_LIST to reflect the new SN and FSN.
     2147    25988         ***/
     2148    25989    4         IF NEW_TSN ~= ' '

  25989 24 005227   040000 106500                    CMPC    fill='040'O
        24 005230   200063 000006                    ADSC9   NEW_TSN,,AUTO            cn=0,n=6
        24 005231   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 005232   005364 600000 24                 TZE     s:26021

     2149    25990    5          THEN DO;

     2150    25991    6            DO I = 0 TO NBR_IN_PREV_OUT_BLK - 1; /* Previous block               */

  25991 24 005233   200060 450100                    STZ     I,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:280  
        24 005234   005272 710000 24                 TRA     s:25997+1

     2151    25992    6               PREV_BLK_ARC_LIST_REC.NEW.REEL(I) = NEW_TSN;

  25992 24 005235   200060 236100                    LDQ     I,,AUTO
        24 005236   000006 402007                    MPY     6,DL
        24 005237   000002 736000                    QLS     2
        24 005240   040006 100500                    MLR     fill='040'O
        24 005241   200063 000006                    ADSC9   NEW_TSN,,AUTO            cn=0,n=6
        24 005242   003752 000006 2                  ADSC9   PREV_BLK_ARC_LIST_REC+2,Q cn=0,n=6

     2152    25993    6               PREV_BLK_ARC_LIST_REC.NEW.FSN(I) = NEW_FSN;

  25993 24 005243   200060 236100                    LDQ     I,,AUTO
        24 005244   000006 402007                    MPY     6,DL
        24 005245   200065 720100                    LXL0    NEW_FSN,,AUTO
        24 005246   003753 440006 2                  SXL0    PREV_BLK_ARC_LIST_REC+3,QL

     2153    25994    6               WRITE_ARC_LIST_BY_KEY.KEY_ = VECTOR(PREV_BLK_ARC_LIST_KEY(I));

  25994 24 005247   000140 235000 25                 LDA     96
        24 005250   200060 236100                    LDQ     I,,AUTO
        24 005251   200070 755100                    STA     NEW_FSN+3,,AUTO
        24 005252   000014 402003                    MPY     12,DU
        24 005253   000152 036000 25                 ADLQ    106
        24 005254   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 005255   005024 757000 2                  STAQ    WRITE_ARC_LIST_BY_KEY+2

     2154    25995    6               WRITE_ARC_LIST_BY_KEY.BUF_ = VECTOR(PREV_BLK_ARC_LIST_REC(I));

  25995 24 005256   000142 235000 25                 LDA     98
        24 005257   200060 236100                    LDQ     I,,AUTO
        24 005260   200070 755100                    STA     NEW_FSN+3,,AUTO
        24 005261   000006 402003                    MPY     6,DU
        24 005262   000153 036000 25                 ADLQ    107
        24 005263   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 005264   005026 757000 2                  STAQ    WRITE_ARC_LIST_BY_KEY+4
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:281  

     2155    25996    6               CALL M$WRITE( WRITE_ARC_LIST_BY_KEY ) ALTRET( JUSTALT );

  25996 24 005265   005022 630400 2                  EPPR0   WRITE_ARC_LIST_BY_KEY
        24 005266   440001 713400                    CLIMB   alt,write
        24 005267   401400 401760                    pmme    nvectors=4
        24 005270   005744 702000 24                 TSX2    JUSTALT

     2156    25997    6               END;

  25997 24 005271   200060 054100                    AOS     I,,AUTO
        24 005272   200060 236100                    LDQ     I,,AUTO
        24 005273   200034 116100                    CMPQ    NBR_IN_PREV_OUT_BLK,,AUTO
        24 005274   005235 604000 24                 TMI     s:25992

     2157    25998
     2158    25999    6            DO I = 0 TO NBR_IN_OUT_BLK - 1; /* Current block                     */

  25999 24 005275   200060 450100                    STZ     I,,AUTO
        24 005276   005361 710000 24                 TRA     s:26014+1

     2159    26000    6               IF (I = NBR_IN_OUT_BLK - 1  /* Last file incomplete?              */

  26000 24 005277   200033 236100                    LDQ     NBR_IN_OUT_BLK,,AUTO
        24 005300   000001 136007                    SBLQ    1,DL
        24 005301   200060 116100                    CMPQ    I,,AUTO
        24 005302   005324 601000 24                 TNZ     s:26008
        24 005303   200054 236100                    LDQ     @FILE_FIN,,AUTO
        24 005304   000001 116000 xsym               CMPQ    B_VECTNIL+1
        24 005305   005324 600000 24                 TZE     s:26008
        24 005306   200054 470500                    LDP0    @FILE_FIN,,AUTO
        24 005307   000000 234100                    SZN     0,,PR0
        24 005310   005324 604000 24                 TMI     s:26008

     2160    26001    6                 AND  ADDR(FILE_FIN) ~= ADDR(NIL)
     2161    26002    6                 AND NOT FILE_FIN)
     2162    26003    7                THEN DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:282  

     2163    26004    7                  THIS_BLK_ARC_LIST_REC.NEW.REEL(I) = ' ';

  26004 24 005311   200060 236100                    LDQ     I,,AUTO
        24 005312   000006 402007                    MPY     6,DL
        24 005313   000002 736000                    QLS     2
        24 005314   040006 100400                    MLR     fill='040'O
        24 005315   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 005316   003166 000006 2                  ADSC9   THIS_BLK_ARC_LIST_REC+2,Q cn=0,n=6

     2164    26005    7                  THIS_BLK_ARC_LIST_REC.NEW.FSN(I) = 0;

  26005 24 005317   200060 236100                    LDQ     I,,AUTO
        24 005320   000006 402007                    MPY     6,DL
        24 005321   000000 220003                    LDX0    0,DU
        24 005322   003167 440006 2                  SXL0    THIS_BLK_ARC_LIST_REC+3,QL

     2165    26006    7                  END;

  26006 24 005323   005336 710000 24                 TRA     s:26011

     2166    26007    7                ELSE DO;

     2167    26008    7                  THIS_BLK_ARC_LIST_REC.NEW.REEL(I) = NEW_TSN;

  26008 24 005324   200060 236100                    LDQ     I,,AUTO
        24 005325   000006 402007                    MPY     6,DL
        24 005326   000002 736000                    QLS     2
        24 005327   040006 100500                    MLR     fill='040'O
        24 005330   200063 000006                    ADSC9   NEW_TSN,,AUTO            cn=0,n=6
        24 005331   003166 000006 2                  ADSC9   THIS_BLK_ARC_LIST_REC+2,Q cn=0,n=6

     2168    26009    7                  THIS_BLK_ARC_LIST_REC.NEW.FSN(I) = NEW_FSN;

  26009 24 005332   200060 236100                    LDQ     I,,AUTO
        24 005333   000006 402007                    MPY     6,DL
        24 005334   200065 720100                    LXL0    NEW_FSN,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:283  
        24 005335   003167 440006 2                  SXL0    THIS_BLK_ARC_LIST_REC+3,QL

     2169    26010    7                  END;

     2170    26011    6               WRITE_ARC_LIST_BY_KEY.KEY_ = VECTOR(THIS_BLK_ARC_LIST_KEY(I));

  26011 24 005336   000140 235000 25                 LDA     96
        24 005337   200060 236100                    LDQ     I,,AUTO
        24 005340   200070 755100                    STA     NEW_FSN+3,,AUTO
        24 005341   000014 402003                    MPY     12,DU
        24 005342   000144 036000 25                 ADLQ    100
        24 005343   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 005344   005024 757000 2                  STAQ    WRITE_ARC_LIST_BY_KEY+2

     2171    26012    6               WRITE_ARC_LIST_BY_KEY.BUF_ = VECTOR(THIS_BLK_ARC_LIST_REC(I));

  26012 24 005345   000142 235000 25                 LDA     98
        24 005346   200060 236100                    LDQ     I,,AUTO
        24 005347   200070 755100                    STA     NEW_FSN+3,,AUTO
        24 005350   000006 402003                    MPY     6,DU
        24 005351   000145 036000 25                 ADLQ    101
        24 005352   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 005353   005026 757000 2                  STAQ    WRITE_ARC_LIST_BY_KEY+4

     2172    26013    6               CALL M$WRITE( WRITE_ARC_LIST_BY_KEY ) ALTRET( JUSTALT );

  26013 24 005354   005022 630400 2                  EPPR0   WRITE_ARC_LIST_BY_KEY
        24 005355   440001 713400                    CLIMB   alt,write
        24 005356   401400 401760                    pmme    nvectors=4
        24 005357   005744 702000 24                 TSX2    JUSTALT

     2173    26014    6               END;

  26014 24 005360   200060 054100                    AOS     I,,AUTO
        24 005361   200060 236100                    LDQ     I,,AUTO
        24 005362   200033 116100                    CMPQ    NBR_IN_OUT_BLK,,AUTO
        24 005363   005277 604000 24                 TMI     s:26000
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:284  

     2174    26015    5            END;

     2175    26016
     2176    26017        /***
     2177    26018         *** Add key names to *FSN_LIST (list of files for current FSN whose fits are to
     2178    26019         *** be updated.
     2179    26020         ***/
     2180    26021    4         IF ARCOM_OPTIONS.IMMUPDATE

  26021 24 005364   000000 234000 xsym               SZN     ARCOM_OPTIONS
        24 005365   005407 605000 24                 TPL     s:26029

     2181    26022    5          THEN DO;

     2182    26023    6            DO I = 0 TO NBR_IN_OUT_BLK - 1;

  26023 24 005366   200060 450100                    STZ     I,,AUTO
        24 005367   005404 710000 24                 TRA     s:26026+1

     2183    26024    6               WRITE_FSN_LIST.BUF_ = VECTOR(THIS_BLK_ARC_LIST_KEY(I));

  26024 24 005370   000140 235000 25                 LDA     96
        24 005371   200060 236100                    LDQ     I,,AUTO
        24 005372   200070 755100                    STA     NEW_FSN+3,,AUTO
        24 005373   000014 402003                    MPY     12,DU
        24 005374   000144 036000 25                 ADLQ    100
        24 005375   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 005376   005600 757000 2                  STAQ    WRITE_FSN_LIST+4

     2184    26025    6               CALL M$WRITE( WRITE_FSN_LIST ) ALTRET( JUSTALT );

  26025 24 005377   005574 630400 2                  EPPR0   WRITE_FSN_LIST
        24 005400   440001 713400                    CLIMB   alt,write
        24 005401   401400 401760                    pmme    nvectors=4
        24 005402   005744 702000 24                 TSX2    JUSTALT

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:285  
     2185    26026    6               END;

  26026 24 005403   200060 054100                    AOS     I,,AUTO
        24 005404   200060 236100                    LDQ     I,,AUTO
        24 005405   200033 116100                    CMPQ    NBR_IN_OUT_BLK,,AUTO
        24 005406   005370 604000 24                 TMI     s:26024

     2186    26027    5            END;

     2187    26028
     2188    26029    4         NBR_FILE_BLOCKS = NBR_FILE_BLOCKS + 1;

  26029 24 005407   000000 054000 xsym               AOS     NBR_FILE_BLOCKS

     2189    26030
     2190    26031    4         IF EOVOL

  26031 24 005410   200061 234100                    SZN     EOVOL,,AUTO
        24 005411   005626 605000 24                 TPL     s:26078

     2191    26032    5          THEN DO;

     2192    26033    5            CROSSED = '*';

  26033 24 005412   052000 236003                    LDQ     21504,DU
        24 005413   000000 756000 xsym               STQ     CROSSED

     2193    26034    5            CALL FLI$TAPE_CLOSE( '1'B /* CVOL */ ) ALTRET( JUSTALT );

  26034 24 005414   000100 630400 25                 EPPR0   64
        24 005415   000017 631400 xsym               EPPR1   B_VECTNIL+15
        24 005416   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        24 005417   005744 702000 24                 TSX2    JUSTALT

     2194    26035    5            CALL FLI$TAPE_OPEN( VECTOR(EFT_CVOL_FILE), SN, FSN, '0'B, '1'B, , A_FIT_,
             26035                     ERR, DCB# )

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:286  
  26035 24 005420   000000 236000 xsym               LDQ     EFT_CVOL_FILE
        24 005421   000033 772000                    QRL     27
        24 005422   000001 620006                    EAX0    1,QL
        24 005423   000000 635010                    EAA     0,X0
        24 005424   000002 771000                    ARL     2
        24 005425   000140 135007                    SBLA    96,DL
        24 005426   000154 236000 25                 LDQ     108
        24 005427   200070 757100                    STAQ    NEW_FSN+3,,AUTO
        24 005430   200021 630500                    EPPR0   DCB#,,AUTO
        24 005431   200102 450500                    STP0    NEW_FSN+13,,AUTO
        24 005432   200017 631500                    EPPR1   ERR,,AUTO
        24 005433   200101 451500                    STP1    NEW_FSN+12,,AUTO
        24 005434   000133 236000 25                 LDQ     91
        24 005435   200100 756100                    STQ     NEW_FSN+11,,AUTO
        24 005436   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 005437   000100 235000 25                 LDA     64
        24 005440   200076 757100                    STAQ    NEW_FSN+9,,AUTO
        24 005441   000071 236000 25                 LDQ     57
        24 005442   200075 756100                    STQ     NEW_FSN+8,,AUTO
        24 005443   200015 633500                    EPPR3   FSN,,AUTO
        24 005444   200074 453500                    STP3    NEW_FSN+7,,AUTO
        24 005445   200013 634500                    EPPR4   SN,,AUTO
        24 005446   200073 454500                    STP4    NEW_FSN+6,,AUTO
        24 005447   200070 635500                    EPPR5   NEW_FSN+3,,AUTO
        24 005450   200072 455500                    STP5    NEW_FSN+5,,AUTO
        24 005451   200072 630500                    EPPR0   NEW_FSN+5,,AUTO
        24 005452   000132 631400 25                 EPPR1   90
        24 005453   000000 701000 xent               TSX1    FLI$TAPE_OPEN
        24 005454   005456 702000 24                 TSX2    REPALT
        24 005455   005471 710000 24                 TRA     s:26042

     2195    26036    6             WHENALTRETURN DO;

  26029 24 005456                       REPALT       null
     2196    26037    6   REPALT:     ;
     2197    26038    6               CALL FLI$RPT_ERR( ERR, DCB# );

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:287  
  26038 24 005456   200021 630500                    EPPR0   DCB#,,AUTO
        24 005457   200071 450500                    STP0    NEW_FSN+4,,AUTO
        24 005460   200017 631500                    EPPR1   ERR,,AUTO
        24 005461   200070 451500                    STP1    NEW_FSN+3,,AUTO
        24 005462   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 005463   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 005464   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 005465   000000 011000                    NOP     0

     2198    26039    6               RPT_ERR = '0'B;

  26039 24 005466   200035 450100                    STZ     RPT_ERR,,AUTO

     2199    26040    6               ALTRETURN;

  26040 24 005467   200052 221300                    LDX1  ! ACCT_NAME+1,,AUTO
        24 005470   000000 702211                    TSX2  ! 0,X1

     2200    26041    6               END;
     2201    26042    5           CALL FLI$TAPE_WRITE( BUF_, ARS, EOVOL, %COMPACT, NEW_TSN, NEW_FSN ) ALTRET(
             26042                     NO_RPT_ERR );

  26042 24 005471   200065 630500                    EPPR0   NEW_FSN,,AUTO
        24 005472   200075 450500                    STP0    NEW_FSN+8,,AUTO
        24 005473   200063 631500                    EPPR1   NEW_TSN,,AUTO
        24 005474   200074 451500                    STP1    NEW_FSN+7,,AUTO
        24 005475   000103 236000 25                 LDQ     67
        24 005476   200073 756100                    STQ     NEW_FSN+6,,AUTO
        24 005477   200061 633500                    EPPR3   EOVOL,,AUTO
        24 005500   200072 453500                    STP3    NEW_FSN+5,,AUTO
        24 005501   200062 634500                    EPPR4   ARS,,AUTO
        24 005502   200071 454500                    STP4    NEW_FSN+4,,AUTO
        24 005503   200056 635500                    EPPR5   BUF_,,AUTO
        24 005504   200070 455500                    STP5    NEW_FSN+3,,AUTO
        24 005505   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 005506   000024 631400 xsym               EPPR1   B_VECTNIL+20
        24 005507   000000 701000 xent               TSX1    FLI$TAPE_WRITE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:288  
        24 005510   005743 702000 24                 TSX2    NO_RPT_ERR

     2202    26043                                                /* Second write forces volume change  */
     2203    26044    5           CALL FLI$TAPE_WRITE( BUF_, ARS, EOVOL, %COMPACT, NEW_TSN, NEW_FSN ) ALTRET(
             26044                     NO_RPT_ERR );

  26044 24 005511   200065 630500                    EPPR0   NEW_FSN,,AUTO
        24 005512   200075 450500                    STP0    NEW_FSN+8,,AUTO
        24 005513   200063 631500                    EPPR1   NEW_TSN,,AUTO
        24 005514   200074 451500                    STP1    NEW_FSN+7,,AUTO
        24 005515   000103 236000 25                 LDQ     67
        24 005516   200073 756100                    STQ     NEW_FSN+6,,AUTO
        24 005517   200061 633500                    EPPR3   EOVOL,,AUTO
        24 005520   200072 453500                    STP3    NEW_FSN+5,,AUTO
        24 005521   200062 634500                    EPPR4   ARS,,AUTO
        24 005522   200071 454500                    STP4    NEW_FSN+4,,AUTO
        24 005523   200056 635500                    EPPR5   BUF_,,AUTO
        24 005524   200070 455500                    STP5    NEW_FSN+3,,AUTO
        24 005525   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 005526   000024 631400 xsym               EPPR1   B_VECTNIL+20
        24 005527   000000 701000 xent               TSX1    FLI$TAPE_WRITE
        24 005530   005743 702000 24                 TSX2    NO_RPT_ERR

     2204    26045        /***
     2205    26046         *** If specified, list the files and update their fits immediately for this FSN.
     2206    26047         *** If last file was completely moved to output buffer(at least one to update)
     2207    26048         *** or there are other files that were already moved for this FSN, update
     2208    26049         *** the fits.
     2209    26050         ***/
     2210    26051
     2211    26052    5            IF ARCOM_OPTIONS.IMMUPDATE

  26052 24 005531   000000 234000 xsym               SZN     ARCOM_OPTIONS
        24 005532   005562 605000 24                 TPL     s:26072

     2212    26053    6             THEN DO;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:289  
     2213    26054    6               IF OUT_BLK_TAG.FIN          /* Entire file in output buffer       */

  26054 24 005533   004543 470400 2                  LDP0    OUT_BLK_TAG$
        24 005534   000000 236100                    LDQ     0,,PR0
        24 005535   000200 316007                    CANQ    128,DL
        24 005536   005542 600000 24                 TZE     s:26064

     2214    26055    7                THEN DO;

     2215    26056    7                  CALL FLX_UPDATE_ARC_FILES ALTRET( JUSTALT );

  26056 24 005537   006116 701000 24                 TSX1    FLX_UPDATE_ARC_FILES
        24 005540   005744 702000 24                 TSX2    JUSTALT

     2216    26057    7                  END;

  26057 24 005541   005562 710000 24                 TRA     s:26072

     2217    26058    7                ELSE DO;

     2218    26059        /***
     2219    26060         *** Partial file in output buffer so delete last key name from *FSN_LIST
     2220    26061         *** temporarily so file's fit does not get updated until file has been completely
     2221    26062         *** copied to its' destination.
     2222    26063         ***/
     2223    26064    7                  CALL M$PRECORD( PRECORD_FSN_LIST ) ALTRET( JUSTALT );

  26064 24 005542   005664 630400 2                  EPPR0   PRECORD_FSN_LIST
        24 005543   440003 713400                    CLIMB   alt,+16387
        24 005544   401000 401760                    pmme    nvectors=3
        24 005545   005744 702000 24                 TSX2    JUSTALT

     2224    26065    7                  CALL M$DELREC( DELREC_FSN_LIST ) ALTRET( JUSTALT );

  26065 24 005546   005652 630400 2                  EPPR0   DELREC_FSN_LIST
        24 005547   440002 713400                    CLIMB   alt,+16386
        24 005550   401400 401760                    pmme    nvectors=4
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:290  
        24 005551   005744 702000 24                 TSX2    JUSTALT

     2225    26066    7                  CALL FLX_UPDATE_ARC_FILES  ALTRET(JUSTALT);

  26066 24 005552   006116 701000 24                 TSX1    FLX_UPDATE_ARC_FILES
        24 005553   005744 702000 24                 TSX2    JUSTALT

     2226    26067    7                  WRITE_FSN_LIST.BUF_ = VECTOR( LAST_BLK_ARC_LIST_KEY );

  26067 24 005554   000146 237000 25                 LDAQ    102
        24 005555   005600 757000 2                  STAQ    WRITE_FSN_LIST+4

     2227    26068    7                  CALL M$WRITE( WRITE_FSN_LIST ) ALTRET( JUSTALT ); /* Add key name */

  26068 24 005556   005574 630400 2                  EPPR0   WRITE_FSN_LIST
        24 005557   440001 713400                    CLIMB   alt,write
        24 005560   401400 401760                    pmme    nvectors=4
        24 005561   005744 702000 24                 TSX2    JUSTALT

     2228    26069    7                  END;

     2229    26070    6               END;

     2230    26071
     2231    26072    5            CALL FLI$TAPE_CLOSE ALTRET( JUSTALT );

  26072 24 005562   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 005563   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        24 005564   005744 702000 24                 TSX2    JUSTALT

     2232    26073    5            CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), SN, FSN, '0'B, '1'B, ,
             26073                     A_FIT_, ERR, DCB# ) ALTRET( REPALT );

  26073 24 005565   000000 236000 xsym               LDQ     EFT_RESTRICT_FILE
        24 005566   000033 772000                    QRL     27
        24 005567   000001 620006                    EAX0    1,QL
        24 005570   000000 635010                    EAA     0,X0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:291  
        24 005571   000002 771000                    ARL     2
        24 005572   000140 135007                    SBLA    96,DL
        24 005573   000131 236000 25                 LDQ     89
        24 005574   200070 757100                    STAQ    NEW_FSN+3,,AUTO
        24 005575   200021 630500                    EPPR0   DCB#,,AUTO
        24 005576   200102 450500                    STP0    NEW_FSN+13,,AUTO
        24 005577   200017 631500                    EPPR1   ERR,,AUTO
        24 005600   200101 451500                    STP1    NEW_FSN+12,,AUTO
        24 005601   000133 236000 25                 LDQ     91
        24 005602   200100 756100                    STQ     NEW_FSN+11,,AUTO
        24 005603   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 005604   000100 235000 25                 LDA     64
        24 005605   200076 757100                    STAQ    NEW_FSN+9,,AUTO
        24 005606   000071 236000 25                 LDQ     57
        24 005607   200075 756100                    STQ     NEW_FSN+8,,AUTO
        24 005610   200015 633500                    EPPR3   FSN,,AUTO
        24 005611   200074 453500                    STP3    NEW_FSN+7,,AUTO
        24 005612   200013 634500                    EPPR4   SN,,AUTO
        24 005613   200073 454500                    STP4    NEW_FSN+6,,AUTO
        24 005614   200070 635500                    EPPR5   NEW_FSN+3,,AUTO
        24 005615   200072 455500                    STP5    NEW_FSN+5,,AUTO
        24 005616   200072 630500                    EPPR0   NEW_FSN+5,,AUTO
        24 005617   000132 631400 25                 EPPR1   90
        24 005620   000000 701000 xent               TSX1    FLI$TAPE_OPEN
        24 005621   005456 702000 24                 TSX2    REPALT

     2233    26074    5            PREV_REEL = SN;

  26074 24 005622   040000 100500                    MLR     fill='040'O
        24 005623   200013 000006                    ADSC9   SN,,AUTO                 cn=0,n=6
        24 005624   004561 000006 2                  ADSC9   PREV_REEL                cn=0,n=6

     2234    26075    5            NBR_FILE_BLOCKS = 0;

  26075 24 005625   000000 450000 xsym               STZ     NBR_FILE_BLOCKS

     2235    26076    5            END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:292  

     2236    26077
     2237    26078    4         IF OD_DEST AND LAST_TSN_USED ~= ' ' /* Check if file crossed OD boundries */

  26078 24 005626   200006 234100                    SZN     OD_DEST,,AUTO
        24 005627   005644 605000 24                 TPL     s:26087
        24 005630   040000 106400                    CMPC    fill='040'O
        24 005631   000000 000006 xsym               ADSC9   LAST_TSN_USED            cn=0,n=6
        24 005632   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 005633   005644 600000 24                 TZE     s:26087

     2238    26079    5          THEN DO;

     2239    26080    5            IF LAST_TSN_USED ~= TAPE_DCBLIST.DCB$(0)->F$DCB.PSN#

  26080 24 005634   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        24 005635   000001 471500                    LDP1    1,,PR0
        24 005636   040100 106400                    CMPC    fill='040'O
        24 005637   000000 000006 xsym               ADSC9   LAST_TSN_USED            cn=0,n=6
        24 005640   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
        24 005641   005644 600000 24                 TZE     s:26087

     2240    26081    5             THEN CROSSED = '*';

  26081 24 005642   052000 236003                    LDQ     21504,DU
        24 005643   000000 756000 xsym               STQ     CROSSED

     2241    26082    5            END;

     2242    26083        /***
     2243    26084         *** Must save previous block data in case files in that block were recopied
     2244    26085         *** to the next volume on an I-O error when IOERR CONT spec'd by user.
     2245    26086         ***/
     2246    26087    4         NBR_IN_PREV_OUT_BLK = NBR_IN_OUT_BLK;

  26087 24 005644   200033 235100                    LDA     NBR_IN_OUT_BLK,,AUTO
        24 005645   200034 755100                    STA     NBR_IN_PREV_OUT_BLK,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:293  

     2247    26088    5         DO I = 0 TO NBR_IN_OUT_BLK - 1;

  26088 24 005646   200060 450100                    STZ     I,,AUTO
        24 005647   005663 710000 24                 TRA     s:26091+1

     2248    26089    5            PREV_BLK_ARC_LIST_KEY(I) = THIS_BLK_ARC_LIST_KEY(I);

  26089 24 005650   200060 236100                    LDQ     I,,AUTO
        24 005651   000060 402007                    MPY     48,DL
        24 005652   000006 100406                    MLR     fill='000'O
        24 005653   000236 000057 2                  ADSC9   THIS_BLK_ARC_LIST_KEY,Q  cn=0,n=47
        24 005654   001606 000057 2                  ADSC9   PREV_BLK_ARC_LIST_KEY,Q  cn=0,n=47

     2249    26090    5            PREV_BLK_ARC_LIST_REC(I) = THIS_BLK_ARC_LIST_REC(I);

  26090 24 005655   200060 236100                    LDQ     I,,AUTO
        24 005656   000030 402007                    MPY     24,DL
        24 005657   000006 100406                    MLR     fill='000'O
        24 005660   003164 000025 2                  ADSC9   THIS_BLK_ARC_LIST_REC,Q  cn=0,n=21
        24 005661   003750 000025 2                  ADSC9   PREV_BLK_ARC_LIST_REC,Q  cn=0,n=21

     2250    26091    5            END;

  26091 24 005662   200060 054100                    AOS     I,,AUTO
        24 005663   200060 236100                    LDQ     I,,AUTO
        24 005664   200033 116100                    CMPQ    NBR_IN_OUT_BLK,,AUTO
        24 005665   005650 604000 24                 TMI     s:26089

     2251    26092
     2252    26093    4         NBR_IN_OUT_BLK = 0;

  26093 24 005666   200033 450100                    STZ     NBR_IN_OUT_BLK,,AUTO

     2253    26094    4         NEW_BLOCK = '1'B;

  26094 24 005667   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:294  
        24 005670   200027 756100                    STQ     NEW_BLOCK,,AUTO

     2254    26095
     2255    26096    4         END;

     2256    26097
     2257    26098         /***
     2258    26099          *** Set up initial output block tag if new block or new file.
     2259    26100          ***/
     2260    26101
     2261    26102    3      IF NEW_BLOCK

  26102 24 005671   200027 234100                    SZN     NEW_BLOCK,,AUTO
        24 005672   005712 605000 24                 TPL     s:26111

     2262    26103    4       THEN DO;

     2263    26104    4         OUT_GRAN$ = PINCRW( OUT_GRAN_BASE$, -1024 );

  26104 24 005673   004560 236000 2                  LDQ     OUT_GRAN_BASE$
        24 005674   776000 036003                    ADLQ    -1024,DU
        24 005675   004553 756000 2                  STQ     OUT_GRAN$

     2264    26105    4         OUT_GRANX = 0;

  26105 24 005676   004550 450000 2                  STZ     OUT_GRANX

     2265    26106    4         OUT_BLK_TAG0 = IN_BLK_TAG0;

  26106 24 005677   004544 470400 2                  LDP0    IN_BLK_TAG0$
        24 005700   004545 471400 2                  LDP1    OUT_BLK_TAG0$
        24 005701   000100 100500                    MLR     fill='000'O
        24 005702   000000 000054                    ADSC9   0,,PR0                   cn=0,n=44
        24 005703   100000 000054                    ADSC9   0,,PR1                   cn=0,n=44

     2266    26107    4         OUT_BLK_TAG$ = PINCRW( OUT_BLK_TAG0$, -SIZEW(OUT_BLK_TAG) );

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:295  
  26107 24 005704   004545 236000 2                  LDQ     OUT_BLK_TAG0$
        24 005705   777765 036003                    ADLQ    -11,DU
        24 005706   004543 756000 2                  STQ     OUT_BLK_TAG$

     2267    26108    4         OUT_BLK_TAG_IX = 1;

  26108 24 005707   000001 235007                    LDA     1,DL
        24 005710   004547 755000 2                  STA     OUT_BLK_TAG_IX

     2268    26109    4         END;

  26109 24 005711   005716 710000 24                 TRA     s:26115

     2269    26110    4       ELSE DO;

     2270    26111    4         OUT_BLK_TAG$ = PINCRW( OUT_BLK_TAG$, -SIZEW(OUT_BLK_TAG) );

  26111 24 005712   004543 236000 2                  LDQ     OUT_BLK_TAG$
        24 005713   777765 036003                    ADLQ    -11,DU
        24 005714   004543 756000 2                  STQ     OUT_BLK_TAG$

     2271    26112    4         OUT_BLK_TAG_IX = OUT_BLK_TAG_IX + 1;

  26112 24 005715   004547 054000 2                  AOS     OUT_BLK_TAG_IX

     2272    26113    4         END;

     2273    26114
     2274    26115    3      IF NEW_FILE OR NEW_BLOCK

  26115 24 005716   200026 234100                    SZN     NEW_FILE,,AUTO
        24 005717   005722 604000 24                 TMI     s:26117
        24 005720   200027 234100                    SZN     NEW_BLOCK,,AUTO
        24 005721   005741 605000 24                 TPL     s:26125

     2275    26116    4       THEN DO;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:296  
     2276    26117    4         OUT_BLK_TAG = IN_BLK_TAG;

  26117 24 005722   004542 470400 2                  LDP0    IN_BLK_TAG$
        24 005723   004543 471400 2                  LDP1    OUT_BLK_TAG$
        24 005724   000100 100500                    MLR     fill='000'O
        24 005725   000000 000054                    ADSC9   0,,PR0                   cn=0,n=44
        24 005726   100000 000054                    ADSC9   0,,PR1                   cn=0,n=44

     2277    26118    4         OUT_BLK_TAG.BEG = '0'B;

  26118 24 005727   000155 236000 25                 LDQ     109
        24 005730   100000 356100                    ANSQ    0,,PR1

     2278    26119    4         OUT_BLK_TAG.FIN = '0'B;

  26119 24 005731   000156 236000 25                 LDQ     110
        24 005732   100000 356100                    ANSQ    0,,PR1

     2279    26120    4         OUT_BLK_TAG.SIZE = 0;

  26120 24 005733   000000 220003                    LDX0    0,DU
        24 005734   100001 740100                    STX0    1,,PR1

     2280    26121    4         OUT_BLK_TAG.BEGX = 0;

  26121 24 005735   100000 740100                    STX0    0,,PR1

     2281    26122    4         OUT_BLK_TAG.NBR = OUT_BLK_TAG_IX;

  26122 24 005736   004547 236000 2                  LDQ     OUT_BLK_TAG_IX
        24 005737   000011 736000                    QLS     9
        24 005740   100000 552110                    STBQ    0,'10'O,PR1

     2282    26123    4         END;

     2283    26124
     2284    26125    3      RETURN;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:297  

  26125 24 005741   200052 221300                    LDX1  ! ACCT_NAME+1,,AUTO
        24 005742   000001 702211                    TSX2  ! 1,X1

  26115 24 005743                       NO_RPT_ERR   null
     2285    26126
     2286    26127    3   NO_RPT_ERR: ;
     2287    26128    3      RPT_ERR = '0'B;

  26128 24 005743   200035 450100                    STZ     RPT_ERR,,AUTO

  26128 24 005744                       JUSTALT      null
     2288    26129
     2289    26130    3   JUSTALT: ;
     2290    26131    3      ALTRETURN;

  26131 24 005744   200052 221300                    LDX1  ! ACCT_NAME+1,,AUTO
        24 005745   000000 702211                    TSX2  ! 0,X1

     2291    26132
     2292    26133    3   END FLX_CHECK_CURRENT_GRAN;
     2293    26134        /******************************/
     2294    26135    2   FLX_ADD_ANOTHER_GRAN: PROC ALTRET;

  26135 24 005746   200050 741300       FLX_ADD_ANO* STX1  ! NIX+1,,AUTO

     2295    26136        /*F*  NAME: FLX_ADD_ANOTHER_GRAN
     2296    26137              PURPOSE: Add current input block granule to output block.
     2297    26138        */
     2298    26139
     2299    26140        /********************/
     2300    26141
     2301    26142        /***
     2302    26143         *** Note that OUT_GRAN$ points to the beginning of a granule which has already
     2303    26144         *** been filled with data. For the first granule of a block, it is reserved
     2304    26145         *** for block tags.
     2305    26146         ***/
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:298  
     2306    26147    3      IF PINCRW( OUT_GRAN$, 1024 ) >= OUT_GRAN_MAX$

  26147 24 005747   004553 236000 2                  LDQ     OUT_GRAN$
        24 005750   002000 036003                    ADLQ    1024,DU
        24 005751   004556 116000 2                  CMPQ    OUT_GRAN_MAX$
        24 005752   005761 602000 24                 TNC     s:26150

     2307    26148    3       THEN CALL FLX_CHECK_CURRENT_GRAN( '1'B ) ALTRET( JUSTALT );

  26148 24 005753   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 005754   200054 756100                    STQ     @FILE_FIN,,AUTO
        24 005755   000100 236000 25                 LDQ     64
        24 005756   200053 756100                    STQ     @FORCE,,AUTO
        24 005757   005040 701000 24                 TSX1    FLX_CHECK_CURRENT_GRAN
        24 005760   006006 702000 24                 TSX2    JUSTALT

     2308    26149
     2309    26150    3      OUT_GRANX = OUT_GRANX + 4096;

  26150 24 005761   010000 236007                    LDQ     4096,DL
        24 005762   004550 056000 2                  ASQ     OUT_GRANX

     2310    26151    3      OUT_GRAN$ = PINCRW( OUT_GRAN$, 1024 );

  26151 24 005763   004553 236000 2                  LDQ     OUT_GRAN$
        24 005764   002000 036003                    ADLQ    1024,DU
        24 005765   004553 756000 2                  STQ     OUT_GRAN$

     2311    26152
     2312    26153    3      OUT_GRAN = IN_GRAN;

  26153 24 005766   004552 470400 2                  LDP0    IN_GRAN$
        24 005767   010000 220003                    LDX0    4096,DU
        24 005770   004553 471400 2                  LDP1    OUT_GRAN$
        24 005771   040140 100540                    MLR     fill='040'O
        24 005772   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
        24 005773   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:299  

     2313    26154
     2314    26155    3      IN_GRAN$ = PINCRW( IN_GRAN$, 1024 );

  26155 24 005774   004552 236000 2                  LDQ     IN_GRAN$
        24 005775   002000 036003                    ADLQ    1024,DU
        24 005776   004552 756000 2                  STQ     IN_GRAN$

     2315    26156
     2316    26157    3      OUT_BLK_TAG.SIZE = OUT_BLK_TAG.SIZE + 4096;

  26157 24 005777   004543 470400 2                  LDP0    OUT_BLK_TAG$
        24 006000   000001 221100                    LDX1    1,,PR0
        24 006001   010000 622011                    EAX2    4096,X1
        24 006002   000001 742100                    STX2    1,,PR0

     2317    26158
     2318    26159    3      NEW_BLOCK = '0'B;                    /* Not a new block anymore            */

  26159 24 006003   200027 450100                    STZ     NEW_BLOCK,,AUTO

     2319    26160
     2320    26161    3      RETURN;

  26161 24 006004   200050 221300                    LDX1  ! NIX+1,,AUTO
        24 006005   000001 702211                    TSX2  ! 1,X1

  26159 24 006006                       JUSTALT      null
     2321    26162
     2322    26163    3   JUSTALT: ;
     2323    26164    3      ALTRETURN;

  26164 24 006006   200050 221300                    LDX1  ! NIX+1,,AUTO
        24 006007   000000 702211                    TSX2  ! 0,X1

     2324    26165
     2325    26166    3   END FLX_ADD_ANOTHER_GRAN;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:300  
     2326    26167        /******************************/
     2327    26168    2   FLX_REPORT_PARTIAL_FILE: PROC;

  26168 24 006010   200050 741300       FLX_REPORT_* STX1  ! NIX+1,,AUTO

     2328    26169        /*F*  NAME: FLX_REPORT_PARTIAL_FILE
     2329    26170              PURPOSE: Reports an I/O error and the name of the partial file which
     2330    26171                 could not be read completely.
     2331    26172        */
     2332    26173        /******************************/
     2333    26174
     2334    26175        /***
     2335    26176         *** AUTO
     2336    26177         ***/
     2337    26178
     2338    26179
     2339    26180        %VLP_NAME( FPTN=ACCT_NAME,
     2340    26181                   LEN=8,
     2341    26182                   STCLASS=AUTO);
     2342    26209
     2343    26210
     2344    26211    3      ACCT_NAME.L# = LENGTHC(ACCT_NAME.NAME#);

  26211 24 006011   010000 236003                    LDQ     4096,DU
        24 006012   200051 552140                    STBQ    ACCT_NAME,'40'O,AUTO

     2345    26212    3      ACCT_NAME.NAME# = IN_BLK_TAG0.WHERE.ACCT;

  26212 24 006013   004544 470400 2                  LDP0    IN_BLK_TAG0$
        24 006014   040100 100500                    MLR     fill='040'O
        24 006015   000004 400010                    ADSC9   4,,PR0                   cn=2,n=8
        24 006016   200051 200010                    ADSC9   ACCT_NAME,,AUTO          cn=1,n=8

     2346    26213    3      CALL XUR$ERRMSG( E_INCOMPLETE_FILE_ARCH, , ,VECTOR(IN_BLK_TAG.NAME),

  26213 24 006017   000042 235000 25                 LDA     34
        24 006020   004542 236000 2                  LDQ     IN_BLK_TAG$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:301  
        24 006021   000003 036003                    ADLQ    3,DU
        24 006022   200070 757100                    STAQ    NEW_FSN+3,,AUTO
        24 006023   000157 235000 25                 LDA     111
        24 006024   200072 452500                    STP2    NEW_FSN+5,,AUTO
        24 006025   200072 236100                    LDQ     NEW_FSN+5,,AUTO
        24 006026   000051 036003                    ADLQ    41,DU
        24 006027   200076 757100                    STAQ    NEW_FSN+9,,AUTO
        24 006030   200070 237100                    LDAQ    NEW_FSN+3,,AUTO
        24 006031   200074 757100                    STAQ    NEW_FSN+7,,AUTO
        24 006032   200076 237100                    LDAQ    NEW_FSN+9,,AUTO
        24 006033   200100 757100                    STAQ    NEW_FSN+11,,AUTO
        24 006034   200100 631500                    EPPR1   NEW_FSN+11,,AUTO
        24 006035   200106 451500                    STP1    NEW_FSN+17,,AUTO
        24 006036   200074 633500                    EPPR3   NEW_FSN+7,,AUTO
        24 006037   200105 453500                    STP3    NEW_FSN+16,,AUTO
        24 006040   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 006041   200104 756100                    STQ     NEW_FSN+15,,AUTO
        24 006042   000160 235000 25                 LDA     112
        24 006043   200102 757100                    STAQ    NEW_FSN+13,,AUTO
        24 006044   200102 630500                    EPPR0   NEW_FSN+13,,AUTO
        24 006045   000023 631400 xsym               EPPR1   B_VECTNIL+19
        24 006046   000000 701000 xent               TSX1    XUR$ERRMSG
        24 006047   000000 011000                    NOP     0

     2347    26214    3        VECTOR(ACCT_NAME), , );
     2348    26215
     2349    26216    3      RETURN;

  26216 24 006050   200050 221300                    LDX1  ! NIX+1,,AUTO
        24 006051   000001 702211                    TSX2  ! 1,X1

     2350    26217
     2351    26218    3   END FLX_REPORT_PARTIAL_FILE;
     2352    26219        /******************************/
     2353    26220    2   FLX_REMOVE_VOL: PROC;

  26220 24 006052   200046 741300       FLX_REMOVE_* STX1  ! INPUT_FSN+2,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:302  

     2354    26221        /*F*  NAME: FLX_REMOVE_VOL
     2355    26222              PURPOSE: Removes the current volume from the drive and removes the
     2356    26223                 serial number from the serial number list.
     2357    26224        */
     2358    26225        /******************************/
     2359    26226
     2360    26227        /***
     2361    26228         *** AUTO
     2362    26229         ***/
     2363    26230
     2364    26231
     2365    26232    3   DCL NIX SBIN AUTO;
     2366    26233
     2367    26234
     2368    26235    3      REM_LT.V.PSN# = M$TAPE_SOURCE$->F$DCB.PSN#;

  26235 24 006053   004535 470400 2                  LDP0    M$TAPE_SOURCE$
        24 006054   040000 100500                    MLR     fill='040'O
        24 006055   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
        24 006056   005332 400006 2                  ADSC9   REM_LT+2                 cn=2,n=6

     2369    26236    3      CALL M$REM( REM_LT )

  26236 24 006057   005330 630400 2                  EPPR0   REM_LT
        24 006060   460006 713400                    CLIMB   alt,+24582
        24 006061   400000 401760                    pmme    nvectors=1
        24 006062   006064 702000 24                 TSX2    s:26239
        24 006063   006064 710000 24                 TRA     s:26239

     2370    26237    4       WHENALTRETURN DO;

     2371    26238    4         END;

     2372    26239    3      NIX = 0;

  26239 24 006064   200047 450100                    STZ     NIX,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:303  

     2373    26240    4      DO I=M$TAPE_SOURCE$->F$DCB.VOL# TO FROM_SN_LIST.NUM#-1;

  26240 24 006065   004535 470400 2                  LDP0    M$TAPE_SOURCE$
        24 006066   000043 236100                    LDQ     35,,PR0
        24 006067   000033 772000                    QRL     27
        24 006070   000205 756000 2                  STQ     I
        24 006071   006106 710000 24                 TRA     s:26243+1

     2374    26241    4         FROM_SN_LIST.SN#(NIX) = FROM_SN_LIST.SN#(I);

  26241 24 006072   000205 236000 2                  LDQ     I
        24 006073   000006 402007                    MPY     6,DL
        24 006074   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 006075   200047 236100                    LDQ     NIX,,AUTO
        24 006076   000006 402007                    MPY     6,DL
        24 006077   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 006100   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 006101   040106 100505                    MLR     fill='040'O
        24 006102   000001 000006                    ADSC9   1,A,PR0                  cn=0,n=6
        24 006103   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6

     2375    26242    4         NIX = NIX + 1;

  26242 24 006104   200047 054100                    AOS     NIX,,AUTO

     2376    26243    4         END;

  26243 24 006105   000205 054000 2                  AOS     I
        24 006106   004565 470400 2                  LDP0    FROM_SN_LIST$
        24 006107   000205 236000 2                  LDQ     I
        24 006110   000000 116100                    CMPQ    0,,PR0
        24 006111   006072 604000 24                 TMI     s:26241

     2377    26244    3      FROM_SN_LIST.NUM# = NIX;

  26244 24 006112   200047 235100                    LDA     NIX,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:304  
        24 006113   000000 755100                    STA     0,,PR0

     2378    26245
     2379    26246    3      RETURN;

  26246 24 006114   200046 221300                    LDX1  ! INPUT_FSN+2,,AUTO
        24 006115   000001 702211                    TSX2  ! 1,X1

     2380    26247
     2381    26248    3   END FLX_REMOVE_VOL;
     2382    26249
     2383    26250    2   END FLX_MAKE_NEW_ARCHIVE_TAPES;
     2384    26251        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:305  
     2385    26252    1   FLX_UPDATE_ARC_FILES: PROC ALTRET;

  26252 24 006116   200066 741300       FLX_UPDATE_* STX1  ! NEW_FSN+1,,AUTO

     2386    26253        /*F*  NAME: FLX_UPDATE_ARC_FILES
     2387    26254              PURPOSE: Update archived files with new information from the archive
     2388    26255                 list for the current FSN (files named in *FSN_LIST ) if immediate
     2389    26256                 archiving is specified. Otherwise all files in *ARC_LIST are
     2390    26257                 processed.
     2391    26258        */
     2392    26259
     2393    26260         /***
     2394    26261          *** STATIC
     2395    26262          ***/
     2396    26263
     2397    26264    2   DCL 1 ARC_LIST_REC ALIGNED STATIC,
     2398    26265              %ARC_LIST_REC;
     2399    26274
     2400    26275    2   DCL 1 ARC_LIST_KEY ALIGNED STATIC,
     2401    26276              %ARC_LIST_KEY;
     2402    26284
     2403    26285        /***
     2404    26286         *** FPTS
     2405    26287         ***/
     2406    26288
     2407    26289        %FPT_OPEN( FPTN=OPEN_ARC_LIST_FSN,
     2408    26290                   DCB=M$ARC_LIST2,
     2409    26291                   FUN=IN,
     2410    26292                   SHARE=ALL,
     2411    26293                   NAME=ARC_LIST_NAME,
     2412    26294                   ASN=FILE,
     2413    26295                   ACS=DIRECT,
     2414    26296                   STCLASS=CONSTANT );
     2415    26405
     2416    26406        %FPT_CLOSE( FPTN=CLOSE_ARC_LIST_FSN,
     2417    26407                    DCB=M$ARC_LIST2,
     2418    26408                    DISP=SAVE,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:306  
     2419    26409                    STCLASS=CONSTANT );
     2420    26451
     2421    26452        %FPT_READ( FPTN=READ_ARC_LIST_FSN,
     2422    26453                   DCB=M$ARC_LIST2,
     2423    26454                   KEY=ARC_LIST_KEY,
     2424    26455                   KEYR=YES,
     2425    26456                   BUF=ARC_LIST_REC,
     2426    26457                   WAIT=YES,
     2427    26458                   STCLASS=STATIC );
     2428    26497
     2429    26498        %VLP_SN( FPTN=NEW_TAPE_SN,
     2430    26499                 N=1,
     2431    26500                 STCLASS=STATIC );
     2432    26513
     2433    26514        /***
     2434    26515         *** AUTO
     2435    26516         ***/
     2436    26517
     2437    26518
     2438    26519
     2439    26520    2      OPEN_ARC_FILE.FPARAM_ = FPARAM_;

  26520 24 006117   000216 237000 2                  LDAQ    FPARAM_
        24 006120   005066 757000 2                  STAQ    OPEN_ARC_FILE+24

     2440    26521
     2441    26522    2      CALL M$OPEN( OPEN_ARC_LIST_FSN ) ALTRET( RPT_ERR_CLOSE );

  26522 24 006121   000532 630400 23                 EPPR0   OPEN_ARC_LIST_FSN
        24 006122   450000 713400                    CLIMB   alt,open
        24 006123   410400 401760                    pmme    nvectors=18
        24 006124   006525 702000 24                 TSX2    RPT_ERR_CLOSE

     2442    26523
     2443    26524    2      IF NOT ARCOM_OPTIONS.IMMUPDATE

  26524 24 006125   000000 234000 xsym               SZN     ARCOM_OPTIONS
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:307  
        24 006126   006134 604000 24                 TMI     s:26530

     2444    26525    3       THEN DO;                            /* Process all files                  */

     2445    26526    3         READ_ARC_LIST_FSN.V.KEYS# = '0'B;

  26526 24 006127   000161 236000 25                 LDQ     113
        24 006130   006320 356000 2                  ANSQ    READ_ARC_LIST_FSN+8

     2446    26527    3         READ_ARC_LIST_FSN.V.KEYR# = '1'B;

  26527 24 006131   100000 236007                    LDQ     32768,DL
        24 006132   006320 256000 2                  ORSQ    READ_ARC_LIST_FSN+8

     2447    26528    3         END;

  26528 24 006133   006146 710000 24                 TRA     s:26538

     2448    26529    3       ELSE DO;

     2449    26530    3         READ_ARC_LIST_FSN.V.KEYS# = '1'B;

  26530 24 006134   200000 236007                    LDQ     65536,DL
        24 006135   006320 256000 2                  ORSQ    READ_ARC_LIST_FSN+8

     2450    26531    3         READ_ARC_LIST_FSN.V.KEYR# = '0'B;

  26531 24 006136   000162 236000 25                 LDQ     114
        24 006137   006320 356000 2                  ANSQ    READ_ARC_LIST_FSN+8

     2451    26532    3         CALL M$PFIL( PFIL_FSN_LIST ) ALTRET(RPT_ERR_CLOSE );

  26532 24 006140   005646 630400 2                  EPPR0   PFIL_FSN_LIST
        24 006141   440004 713400                    CLIMB   alt,+16388
        24 006142   400000 401760                    pmme    nvectors=1
        24 006143   006525 702000 24                 TSX2    RPT_ERR_CLOSE

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:308  
     2452    26533    3         READ_FSN_LIST.BUF_ = VECTOR(ARC_LIST_KEY);

  26533 24 006144   000164 237000 25                 LDAQ    116
        24 006145   005562 757000 2                  STAQ    READ_FSN_LIST+4

     2453    26534    3         END;

     2454    26535
     2455    26536    3      DO WHILE('1'B);

     2456    26537
     2457    26538    3         IF ARCOM_OPTIONS.IMMUPDATE

  26538 24 006146   000000 234000 xsym               SZN     ARCOM_OPTIONS
        24 006147   006201 605000 24                 TPL     s:26553

     2458    26539    4          THEN DO;

     2459    26540    4            CALL M$READ( READ_FSN_LIST )   /* Get next key from *FSN_LIST        */

  26540 24 006150   005556 630400 2                  EPPR0   READ_FSN_LIST
        24 006151   440000 713400                    CLIMB   alt,read
        24 006152   401400 401760                    pmme    nvectors=4
        24 006153   006155 702000 24                 TSX2    s:26542
        24 006154   006201 710000 24                 TRA     s:26553

     2460    26541    5             WHENALTRETURN DO;

     2461    26542    5               IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF

  26542 24 006155   000000 470400 xsym               LDP0    B$TCB$
        24 006156   000000 471500                    LDP1    0,,PR0
        24 006157   100102 236100                    LDQ     66,,PR1
        24 006160   377770 376007                    ANQ     131064,DL
        24 006161   000060 116007                    CMPQ    48,DL
        24 006162   006525 601000 24                 TNZ     RPT_ERR_CLOSE

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:309  
     2462    26543    5                THEN GOTO RPT_ERR_CLOSE;
     2463    26544    5               CALL M$CLOSE( CLOSE_ARC_LIST_FSN )

  26544 24 006163   000624 630400 23                 EPPR0   CLOSE_ARC_LIST_FSN
        24 006164   450001 713400                    CLIMB   alt,close
        24 006165   406000 401760                    pmme    nvectors=13
        24 006166   006170 702000 24                 TSX2    s:26546
        24 006167   006173 710000 24                 TRA     s:26548

     2464    26545    6                WHENALTRETURN DO;

     2465    26546    6                  CALL FLI$RPT_ERR;

  26546 24 006170   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006171   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006172   000000 011000                    NOP     0

     2466    26547    6                  END;

     2467    26548    5               CALL M$PFIL( PFIL_FSN_LIST ) ALTRET( RPT_ERR_CLOSE );

  26548 24 006173   005646 630400 2                  EPPR0   PFIL_FSN_LIST
        24 006174   440004 713400                    CLIMB   alt,+16388
        24 006175   400000 401760                    pmme    nvectors=1
        24 006176   006525 702000 24                 TSX2    RPT_ERR_CLOSE

     2468    26549    5               RETURN;                     /* All done with this FSN             */

  26549 24 006177   200066 221300                    LDX1  ! NEW_FSN+1,,AUTO
        24 006200   000001 702211                    TSX2  ! 1,X1

     2469    26550    5               END;
     2470    26551    4            END;

     2471    26552
     2472    26553    3         CALL M$READ( READ_ARC_LIST_FSN )

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:310  
  26553 24 006201   006310 630400 2                  EPPR0   READ_ARC_LIST_FSN
        24 006202   440000 713400                    CLIMB   alt,read
        24 006203   401400 401760                    pmme    nvectors=4
        24 006204   006470 702000 24                 TSX2    s:26653

     2473    26554    4          WHENRETURN DO;

     2474    26555    4            ARC_FILE_NAME.NAME# = ARC_LIST_KEY.C.FNAMEC;

  26555 24 006205   040000 100400                    MLR     fill='040'O
        24 006206   006277 600037 2                  ADSC9   ARC_LIST_KEY+3           cn=3,n=31
        24 006207   005130 200037 2                  ADSC9   ARC_FILE_NAME            cn=1,n=31

     2475    26556    4            ARC_FILE_NAME.L# = ARC_LIST_KEY.C.FNAMEL;

  26556 24 006210   006307 236000 2                  LDQ     ARC_LIST_KEY+11
        24 006211   000022 736000                    QLS     18
        24 006212   005130 552040 2                  STBQ    ARC_FILE_NAME,'40'O

     2476    26557    4            ARC_FILE_ACCT.ACCT# = ARC_LIST_KEY.C.ACCT;

  26557 24 006213   040000 100400                    MLR     fill='040'O
        24 006214   006275 600010 2                  ADSC9   ARC_LIST_KEY+1           cn=3,n=8
        24 006215   005140 000010 2                  ADSC9   ARC_FILE_ACCT            cn=0,n=8

     2477    26558    4            ARC_FILE_SN.SN#(0) = ARC_LIST_KEY.C.PSN;

  26558 24 006216   040000 100400                    MLR     fill='040'O
        24 006217   006274 200006 2                  ADSC9   ARC_LIST_KEY             cn=1,n=6
        24 006220   005143 000006 2                  ADSC9   ARC_FILE_SN+1            cn=0,n=6

     2478    26559
     2479    26560    4            IF ARC_LIST_REC.NEW.REEL ~= ' '

  26560 24 006221   040000 106400                    CMPC    fill='040'O
        24 006222   006270 000006 2                  ADSC9   ARC_LIST_REC+2           cn=0,n=6
        24 006223   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:311  
        24 006224   006467 600000 24                 TZE     s:26651

     2480    26561    5             THEN DO;

     2481    26562    5               CALL M$OPEN( OPEN_ARC_FILE ) /* Update the fits and list files    */

  26562 24 006225   005036 630400 2                  EPPR0   OPEN_ARC_FILE
        24 006226   450000 713400                    CLIMB   alt,open
        24 006227   410400 401760                    pmme    nvectors=18
        24 006230   006463 702000 24                 TSX2    s:26646

     2482    26563    6                WHENRETURN DO;

     2483    26564    6                  IF M$ARC_FILE$->F$DCB.DESC.DELF#

  26564 24 006231   004534 470400 2                  LDP0    M$ARC_FILE$
        24 006232   000005 236100                    LDQ     5,,PR0
        24 006233   400000 316007                    CANQ    -131072,DL
        24 006234   006240 600000 24                 TZE     s:26566

     2484    26565    6                   THEN CODE06$ = FPARAM_.PTR$;

  26565 24 006235   000217 236000 2                  LDQ     FPARAM_+1
        24 006236   000220 756000 2                  STQ     CODE06$
        24 006237   006243 710000 24                 TRA     s:26567

     2485    26566    6                   ELSE CODE06$ = PINCRW( FPARAM_.PTR$, SIZEW(FM$GRAN) );

  26566 24 006240   000217 236000 2                  LDQ     FPARAM_+1
        24 006241   000005 036003                    ADLQ    5,DU
        24 006242   000220 756000 2                  STQ     CODE06$

     2486    26567    6                  CALL XSF$LOCCODP( CODE06$, 06 )

  26567 24 006243   000067 630400 25                 EPPR0   55
        24 006244   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 006245   000000 701000 xent               TSX1    XSF$LOCCODP
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:312  
        24 006246   006410 702000 24                 TSX2    s:26625

     2487    26568    7                   WHENRETURN DO;

     2488    26569    7                     NEW_TAPE_SN.SN#(0) = ARC_LIST_REC.NEW.REEL;

  26569 24 006247   040000 100400                    MLR     fill='040'O
        24 006250   006270 000006 2                  ADSC9   ARC_LIST_REC+2           cn=0,n=6
        24 006251   006327 000006 2                  ADSC9   NEW_TAPE_SN+1            cn=0,n=6

     2489    26570    7                     EFTWORD = '0'B;

  26570 24 006252   000000 220003                    LDX0    0,DU
        24 006253   000000 740000 xsym               STX0    EFTWORD

     2490    26571    7                     IF OD_DEST

  26571 24 006254   200006 234100                    SZN     OD_DEST,,AUTO
        24 006255   006263 605000 24                 TPL     s:26577

     2491    26572    8                      THEN DO;

     2492    26573    8                        CLOSE_ARC_FILE.V.DESC.ODSTOW# = '1'B; /* Archvd. to op dsk */

  26573 24 006256   040000 236003                    LDQ     16384,DU
        24 006257   005201 256000 2                  ORSQ    CLOSE_ARC_FILE+27

     2493    26574    8                        EFTWORDEXPIRE = ARC_LIST_REC.NEW.FSN;

  26574 24 006260   006271 721000 2                  LXL1    ARC_LIST_REC+3
        24 006261   000000 741000 xsym               STX1    EFTWORD

     2494    26575    8                        END;

  26575 24 006262   006272 710000 24                 TRA     s:26580

     2495    26576    8                      ELSE DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:313  

     2496    26577    8                        CLOSE_ARC_FILE.V.DESC.ODSTOW# = '0'B; /* Archvd. to tape */

  26577 24 006263   000163 236000 25                 LDQ     115
        24 006264   005201 356000 2                  ANSQ    CLOSE_ARC_FILE+27

     2497    26578    8                        EFTWORD.FSN = ARC_LIST_REC.NEW.FSN;

  26578 24 006265   006271 236000 2                  LDQ     ARC_LIST_REC+3
        24 006266   000022 736000                    QLS     18
        24 006267   000000 676000 xsym               ERQ     EFTWORD
        24 006270   037777 376003                    ANQ     16383,DU
        24 006271   000000 656000 xsym               ERSQ    EFTWORD

     2498    26579    8                        END;

     2499    26580    7                     CLOSE_ARC_FILE.V.EXPIRE# = EFTWORDEXPIRE;

  26580 24 006272   000000 221000 xsym               LDX1    EFTWORD
        24 006273   005202 441000 2                  SXL1    CLOSE_ARC_FILE+28

     2500    26581    7                     CLOSE_ARC_FILE.V.EFTOPER = '0'B;

  26581 24 006274   000166 236000 25                 LDQ     118
        24 006275   005200 356000 2                  ANSQ    CLOSE_ARC_FILE+26

     2501    26582    7                     IF M$ARC_FILE$->F$DCB.DESC.DELF#

  26582 24 006276   004534 470400 2                  LDP0    M$ARC_FILE$
        24 006277   000005 236100                    LDQ     5,,PR0
        24 006300   400000 316007                    CANQ    -131072,DL
        24 006301   006377 600000 24                 TZE     s:26618

     2502    26583    8                      THEN DO;             /* Inactively archived                */

     2503    26584    8                        CLOSE_ARC_FILE.V.EFTOPER.DELFDE# = %YES#;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:314  
  26584 24 006302   002000 236007                    LDQ     1024,DL
        24 006303   005200 256000 2                  ORSQ    CLOSE_ARC_FILE+26

     2504    26585    8                        CALL M$CLOSE( CLOSE_ARC_FILE )

  26585 24 006304   005146 630400 2                  EPPR0   CLOSE_ARC_FILE
        24 006305   450001 713400                    CLIMB   alt,close
        24 006306   406000 401760                    pmme    nvectors=13
        24 006307   006311 702000 24                 TSX2    s:26587
        24 006310   006314 710000 24                 TRA     s:26589

     2505    26586    9                         WHENALTRETURN DO;

     2506    26587    9                           CALL FLI$RPT_ERR;

  26587 24 006311   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006312   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006313   000000 011000                    NOP     0

     2507    26588    9                           END;

     2508    26589    8                        OPEN_ARC_FILE.V.FUN# = %CREATE#;

  26589 24 006314   003000 236007                    LDQ     1536,DL
        24 006315   005103 552010 2                  STBQ    OPEN_ARC_FILE+37,'10'O

     2509    26590    8                        OPEN_ARC_FILE.V.ACS# = %SEQUEN#;

  26590 24 006316   000001 236007                    LDQ     1,DL
        24 006317   005104 552004 2                  STBQ    OPEN_ARC_FILE+38,'04'O

     2510    26591    8                        CALL M$OPEN( OPEN_ARC_FILE )

  26591 24 006320   005036 630400 2                  EPPR0   OPEN_ARC_FILE
        24 006321   450000 713400                    CLIMB   alt,open
        24 006322   410400 401760                    pmme    nvectors=18
        24 006323   006351 702000 24                 TSX2    s:26605
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:315  

     2511    26592    9                         WHENRETURN DO;

     2512    26593    9                           CLOSE_ARC_FILE.SN_ = VECTOR(NEW_TAPE_SN);

  26593 24 006324   000170 237000 25                 LDAQ    120
        24 006325   005150 757000 2                  STAQ    CLOSE_ARC_FILE+2

     2513    26594    9                           CLOSE_ARC_FILE.V.EFTOPER = '0'B;

  26594 24 006326   000166 236000 25                 LDQ     118
        24 006327   005200 356000 2                  ANSQ    CLOSE_ARC_FILE+26

     2514    26595    9                           CLOSE_ARC_FILE.V.EFTOPER.ASTOW# = %YES#;

  26595 24 006330   020000 236007                    LDQ     8192,DL
        24 006331   005200 256000 2                  ORSQ    CLOSE_ARC_FILE+26

     2515    26596    9                           CLOSE_ARC_FILE.V.DESC = CLOSE_ARC_FILE.V.DESC |

  26596 24 006332   004534 470400 2                  LDP0    M$ARC_FILE$
        24 006333   000005 720100                    LXL0    5,,PR0
        24 006334   005201 260000 2                  ORX0    CLOSE_ARC_FILE+27
        24 006335   005201 740000 2                  STX0    CLOSE_ARC_FILE+27

     2516    26597    9                             M$ARC_FILE$->F$DCB.DESC;
     2517    26598    9                           CLOSE_ARC_FILE.V.EFTOPER.UPDDESC# = %YES#;

  26598 24 006336   004000 236007                    LDQ     2048,DL
        24 006337   005200 256000 2                  ORSQ    CLOSE_ARC_FILE+26

     2518    26599    9                           CALL M$CLOSE( CLOSE_ARC_FILE )

  26599 24 006340   005146 630400 2                  EPPR0   CLOSE_ARC_FILE
        24 006341   450001 713400                    CLIMB   alt,close
        24 006342   406000 401760                    pmme    nvectors=13
        24 006343   006345 702000 24                 TSX2    s:26601
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:316  
        24 006344   006350 710000 24                 TRA     s:26603

     2519    26600   10                            WHENALTRETURN DO;

     2520    26601   10                              CALL FLI$RPT_ERR;

  26601 24 006345   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006346   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006347   000000 011000                    NOP     0

     2521    26602   10                              END;

     2522    26603    9                           END;

  26603 24 006350   006354 710000 24                 TRA     s:26607

     2523    26604    9                         WHENALTRETURN DO;

     2524    26605    9                           CALL FLI$RPT_ERR;

  26605 24 006351   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006352   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006353   000000 011000                    NOP     0

     2525    26606    9                           END;

     2526    26607    8                        OPEN_ARC_FILE.V.FUN# = %IN#;

  26607 24 006354   002000 236007                    LDQ     1024,DL
        24 006355   005103 552010 2                  STBQ    OPEN_ARC_FILE+37,'10'O

     2527    26608    8                        OPEN_ARC_FILE.V.ACS# = %BLOCK#;

  26608 24 006356   000003 236007                    LDQ     3,DL
        24 006357   005104 552004 2                  STBQ    OPEN_ARC_FILE+38,'04'O

     2528    26609    8                        CALL M$OPEN( OPEN_ARC_FILE )
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:317  

  26609 24 006360   005036 630400 2                  EPPR0   OPEN_ARC_FILE
        24 006361   450000 713400                    CLIMB   alt,open
        24 006362   410400 401760                    pmme    nvectors=18
        24 006363   006365 702000 24                 TSX2    s:26611
        24 006364   006370 710000 24                 TRA     s:26613

     2529    26610    9                         WHENALTRETURN DO;

     2530    26611    9                           CALL FLI$RPT_ERR;

  26611 24 006365   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006366   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006367   000000 011000                    NOP     0

     2531    26612    9                           END;

     2532    26613    8                        CLOSE_ARC_FILE.SN_ = VECTOR(NIL);

  26613 24 006370   000064 237000 25                 LDAQ    52
        24 006371   005150 757000 2                  STAQ    CLOSE_ARC_FILE+2

     2533    26614    8                        CLOSE_ARC_FILE.V.EFTOPER = '0'B;

  26614 24 006372   000166 236000 25                 LDQ     118
        24 006373   005200 356000 2                  ANSQ    CLOSE_ARC_FILE+26

     2534    26615    8                        CLOSE_ARC_FILE.V.EFTOPER.ISTOW# = %YES#;

  26615 24 006374   010000 236007                    LDQ     4096,DL
        24 006375   005200 256000 2                  ORSQ    CLOSE_ARC_FILE+26

     2535    26616    8                        END;

  26616 24 006376   006410 710000 24                 TRA     s:26625

     2536    26617    8                      ELSE DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:318  

     2537    26618    8                        CLOSE_ARC_FILE.V.EFTOPER.ASTOW# = %YES#;

  26618 24 006377   020000 236007                    LDQ     8192,DL
        24 006400   005200 256000 2                  ORSQ    CLOSE_ARC_FILE+26

     2538    26619    8                        CLOSE_ARC_FILE.SN_ = VECTOR(NEW_TAPE_SN);

  26619 24 006401   000170 237000 25                 LDAQ    120
        24 006402   005150 757000 2                  STAQ    CLOSE_ARC_FILE+2

     2539    26620    8                        CLOSE_ARC_FILE.V.DESC = CLOSE_ARC_FILE.V.DESC |

  26620 24 006403   000005 722100                    LXL2    5,,PR0
        24 006404   005201 262000 2                  ORX2    CLOSE_ARC_FILE+27
        24 006405   005201 742000 2                  STX2    CLOSE_ARC_FILE+27

     2540    26621    8                          M$ARC_FILE$->F$DCB.DESC;
     2541    26622    8                        CLOSE_ARC_FILE.V.EFTOPER.UPDDESC# = %YES#;

  26622 24 006406   004000 236007                    LDQ     2048,DL
        24 006407   005200 256000 2                  ORSQ    CLOSE_ARC_FILE+26

     2542    26623    8                        END;

     2543    26624    7                     END;

     2544    26625    6                  CALL M$CLOSE( CLOSE_ARC_FILE )

  26625 24 006410   005146 630400 2                  EPPR0   CLOSE_ARC_FILE
        24 006411   450001 713400                    CLIMB   alt,close
        24 006412   406000 401760                    pmme    nvectors=13
        24 006413   006454 702000 24                 TSX2    s:26640

     2545    26626    7                   WHENRETURN DO;

     2546    26627    7                     OPEN_ARC_FILE.V.OPER.TEST# = '1'B;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:319  

  26627 24 006414   020000 236007                    LDQ     8192,DL
        24 006415   005102 256000 2                  ORSQ    OPEN_ARC_FILE+36

     2547    26628    7                     CALL M$OPEN( OPEN_ARC_FILE )

  26628 24 006416   005036 630400 2                  EPPR0   OPEN_ARC_FILE
        24 006417   450000 713400                    CLIMB   alt,open
        24 006420   410400 401760                    pmme    nvectors=18
        24 006421   006423 702000 24                 TSX2    s:26630
        24 006422   006426 710000 24                 TRA     s:26632

     2548    26629    8                      WHENALTRETURN DO;

     2549    26630    8                        CALL FLI$RPT_ERR;

  26630 24 006423   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006424   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006425   000000 011000                    NOP     0

     2550    26631    8                        END;

     2551    26632    7                     OPEN_ARC_FILE.V.OPER.TEST# = '0'B;

  26632 24 006426   000167 236000 25                 LDQ     119
        24 006427   005102 356000 2                  ANSQ    OPEN_ARC_FILE+36

     2552    26633    7                     NBRFAS_FOUND_UPDATED = NBRFAS_FOUND_UPDATED + 1;

  26633 24 006430   000202 054000 2                  AOS     NBRFAS_FOUND_UPDATED

     2553    26634    7                     TEMP = ARC_LIST_REC.NEW.FSN;

  26634 24 006431   006271 236000 2                  LDQ     ARC_LIST_REC+3
        24 006432   777777 376007                    ANQ     -1,DL
        24 006433   000175 756000 2                  STQ     TEMP

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:320  
     2554    26635    7                     CALL FLP$WR_FILE_INFO( M$ARC_FILE$, FPARAM_.PTR$,

  26635 24 006434   000071 236000 25                 LDQ     57
        24 006435   200100 756100                    STQ     NEW_FSN+11,,AUTO
        24 006436   000172 237000 25                 LDAQ    122
        24 006437   200076 757100                    STAQ    NEW_FSN+9,,AUTO
        24 006440   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 006441   000174 235000 25                 LDA     124
        24 006442   200074 757100                    STAQ    NEW_FSN+7,,AUTO
        24 006443   000176 237000 25                 LDAQ    126
        24 006444   200072 757100                    STAQ    NEW_FSN+5,,AUTO
        24 006445   000200 237000 25                 LDAQ    128
        24 006446   200070 757100                    STAQ    NEW_FSN+3,,AUTO
        24 006447   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 006450   000132 631400 25                 EPPR1   90
        24 006451   000000 701000 xent               TSX1    FLP$WR_FILE_INFO
        24 006452   006530 702000 24                 TSX2    ERR_CLOSE

     2555    26636    7                       ARC_LIST_REC.NEW.REEL, TEMP, ' ', , 0, '1'B, '0'B  )
     2556    26637    7                       ALTRET( ERR_CLOSE );
     2557    26638    7                     END;

  26638 24 006453   006460 710000 24                 TRA     s:26643

     2558    26639    7                   WHENALTRETURN DO;

     2559    26640    7                     NBRFAS_FOUND_UNUPDATED = NBRFAS_FOUND_UNUPDATED + 1;

  26640 24 006454   000203 054000 2                  AOS     NBRFAS_FOUND_UNUPDATED

     2560    26641    7                     CALL FLI$RPT_ERR;

  26641 24 006455   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006456   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006457   000000 011000                    NOP     0

     2561    26642    7                     END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:321  

     2562    26643    6                  CLOSE_ARC_FILE.V.EFTOPER = '0'B;

  26643 24 006460   000166 236000 25                 LDQ     118
        24 006461   005200 356000 2                  ANSQ    CLOSE_ARC_FILE+26

     2563    26644    6                  END;

  26644 24 006462   006466 710000 24                 TRA     s:26648

     2564    26645    6                WHENALTRETURN DO;

     2565    26646    6                  CALL FLI$RPT_ERR;

  26646 24 006463   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006464   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006465   000000 011000                    NOP     0

     2566    26647    6                  END;

     2567    26648    5               END;

  26648 24 006466   006467 710000 24                 TRA     s:26651

     2568    26649    5             ELSE DO;                      /* Not on new reel                    */

     2569    26650    5               END;

     2570    26651    4            END;

  26651 24 006467   006524 710000 24                 TRA     s:26670

     2571    26652    4          WHENALTRETURN DO;

     2572    26653    4            IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF

  26653 24 006470   000000 470400 xsym               LDP0    B$TCB$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:322  
        24 006471   000000 471500                    LDP1    0,,PR0
        24 006472   100102 236100                    LDQ     66,,PR1
        24 006473   377770 376007                    ANQ     131064,DL
        24 006474   000060 116007                    CMPQ    48,DL
        24 006475   006525 601000 24                 TNZ     RPT_ERR_CLOSE

     2573    26654    4             THEN GOTO RPT_ERR_CLOSE;
     2574    26655    4            CALL M$CLOSE( CLOSE_ARC_LIST_FSN )

  26655 24 006476   000624 630400 23                 EPPR0   CLOSE_ARC_LIST_FSN
        24 006477   450001 713400                    CLIMB   alt,close
        24 006500   406000 401760                    pmme    nvectors=13
        24 006501   006503 702000 24                 TSX2    s:26657
        24 006502   006506 710000 24                 TRA     s:26660

     2575    26656    5             WHENALTRETURN DO;

     2576    26657    5               CALL FLI$RPT_ERR;

  26657 24 006503   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006504   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006505   000000 011000                    NOP     0

     2577    26658    5               END;

     2578    26659
     2579    26660    4            IF M$FSN_LIST$->F$DCB.FCD#

  26660 24 006506   004540 470400 2                  LDP0    M$FSN_LIST$
        24 006507   000031 236100                    LDQ     25,,PR0
        24 006510   020000 316007                    CANQ    8192,DL
        24 006511   006522 600000 24                 TZE     s:26668

     2580    26661    5             THEN DO;

     2581    26662    5               CALL M$CLOSE( CLOSE_FSN_LIST )

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:323  
  26662 24 006512   005610 630400 2                  EPPR0   CLOSE_FSN_LIST
        24 006513   450001 713400                    CLIMB   alt,close
        24 006514   406000 401760                    pmme    nvectors=13
        24 006515   006517 702000 24                 TSX2    s:26664
        24 006516   006522 710000 24                 TRA     s:26668

     2582    26663    6                WHENALTRETURN DO;

     2583    26664    6                  CALL FLI$RPT_ERR;

  26664 24 006517   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006520   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006521   000000 011000                    NOP     0

     2584    26665    6                  END;

     2585    26666    5               END;

     2586    26667
     2587    26668    4            RETURN;

  26668 24 006522   200066 221300                    LDX1  ! NEW_FSN+1,,AUTO
        24 006523   000001 702211                    TSX2  ! 1,X1

     2588    26669    4            END;
     2589    26670    3         END;                              /* DO WHILE loop                      */

  26670 24 006524   006146 710000 24                 TRA     s:26538

     2590    26671
     2591    26672    2   RPT_ERR_CLOSE:
     2592    26673    2      CALL FLI$RPT_ERR;

  26673 24 006525   000002 631400 xsym  RPT_ERR_CLO* EPPR1   B_VECTNIL+2
        24 006526   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006527   000000 011000                    NOP     0

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:324  
  26658 24 006530                       ERR_CLOSE    null
     2593    26674
     2594    26675    2   ERR_CLOSE: ;
     2595    26676    2      IF M$ARC_LIST2$->F$DCB.FCD#

  26676 24 006530   004537 470400 2                  LDP0    M$ARC_LIST2$
        24 006531   000031 236100                    LDQ     25,,PR0
        24 006532   020000 316007                    CANQ    8192,DL
        24 006533   006544 600000 24                 TZE     s:26684

     2596    26677    3       THEN DO;

     2597    26678    3         CALL M$CLOSE( CLOSE_ARC_LIST_FSN )

  26678 24 006534   000624 630400 23                 EPPR0   CLOSE_ARC_LIST_FSN
        24 006535   450001 713400                    CLIMB   alt,close
        24 006536   406000 401760                    pmme    nvectors=13
        24 006537   006541 702000 24                 TSX2    s:26680
        24 006540   006544 710000 24                 TRA     s:26684

     2598    26679    4          WHENALTRETURN DO;

     2599    26680    4            CALL FLI$RPT_ERR;

  26680 24 006541   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006542   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006543   000000 011000                    NOP     0

     2600    26681    4            END;

     2601    26682    3         END;

     2602    26683
     2603    26684    2      IF M$FSN_LIST$->F$DCB.FCD#

  26684 24 006544   004540 470400 2                  LDP0    M$FSN_LIST$
        24 006545   000031 236100                    LDQ     25,,PR0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:325  
        24 006546   020000 316007                    CANQ    8192,DL
        24 006547   006560 600000 24                 TZE     s:26692

     2604    26685    3       THEN DO;

     2605    26686    3         CALL M$CLOSE( CLOSE_FSN_LIST )

  26686 24 006550   005610 630400 2                  EPPR0   CLOSE_FSN_LIST
        24 006551   450001 713400                    CLIMB   alt,close
        24 006552   406000 401760                    pmme    nvectors=13
        24 006553   006555 702000 24                 TSX2    s:26688
        24 006554   006560 710000 24                 TRA     s:26692

     2606    26687    4          WHENALTRETURN DO;

     2607    26688    4            CALL FLI$RPT_ERR;

  26688 24 006555   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006556   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006557   000000 011000                    NOP     0

     2608    26689    4            END;

     2609    26690    3         END;

     2610    26691
     2611    26692    2      ALTRETURN;

  26692 24 006560   200066 221300                    LDX1  ! NEW_FSN+1,,AUTO
        24 006561   000000 702211                    TSX2  ! 0,X1

     2612    26693    2   END FLX_UPDATE_ARC_FILES;
     2613    26694        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:326  
     2614    26695    1   FLX_OUTPUT_SUMMARY: PROC ALTRET;

  26695 24 006562   200012 741300       FLX_OUTPUT_* STX1  ! CONTROLLED_SOURCE+3,,AUTO

     2615    26696        /*F*  NAME: FLX_OUTPUT_SUMMARY
     2616    26697              PURPOSE: Output summary of archived files and update the :ARCHIVE.$$EFT
     2617    26698                 record for the packset(s).
     2618    26699        */
     2619    26700
     2620    26701         /***
     2621    26702          *** AUTO
     2622    26703          ***/
     2623    26704
     2624    26705    2   DCL NBRFAS SBIN AUTO;
     2625    26706    2   DCL NBRFAS_FOUND SBIN AUTO;
     2626    26707    2   DCL NBRFAS_UNFOUND SBIN AUTO;
     2627    26708
     2628    26709    2   DCL NBRFOT SBIN AUTO;
     2629    26710    2   DCL NBRFOT_UNUNIQUE SBIN AUTO;
     2630    26711    2   DCL NBRFOT_UNIQUE SBIN AUTO;
     2631    26712    2   DCL NBRFOT_UNIQUE_FOUND SBIN AUTO;
     2632    26713    2   DCL NBRFOT_UNIQUE_UNFOUND SBIN AUTO;
     2633    26714    2   DCL DPSIZE SBIN AUTO;
     2634    26715    2   DCL SNSIZE SBIN AUTO;
     2635    26716    2   DCL VOL# SBIN AUTO;
     2636    26717    2   DCL SIZE SBIN AUTO;
     2637    26718    2   DCL FIRST$ PTR AUTO;                    /* First tape/optical disk spec'd     */
     2638    26719    2   DCL SECND$ PTR AUTO;                    /* Second tape/optical disk spec'd    */
     2639    26720
     2640    26721        /***
     2641    26722         *** FPTs/VLPs
     2642    26723         ***/
     2643    26724
     2644    26725        %VLP_SN( FPTN=BASED_SN,
     2645    26726                 STCLASS=BASED );
     2646    26739
     2647    26740        /****************************************/
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:327  
     2648    26741
     2649    26742
     2650    26743         /***
     2651    26744          *** Initialize for updating.
     2652    26745          ***/
     2653    26746
     2654    26747    2      NBRFAS = 0;

  26747 24 006563   200013 450100                    STZ     NBRFAS,,AUTO

     2655    26748    2      NBRFAS_FOUND = 0;

  26748 24 006564   200014 450100                    STZ     NBRFAS_FOUND,,AUTO

     2656    26749    2      NBRFAS_UNFOUND = 0;

  26749 24 006565   200015 450100                    STZ     NBRFAS_UNFOUND,,AUTO

     2657    26750
     2658    26751    2      NBRFOT = 0;

  26751 24 006566   200016 450100                    STZ     NBRFOT,,AUTO

     2659    26752    2      NBRFOT_UNUNIQUE = 0;

  26752 24 006567   200017 450100                    STZ     NBRFOT_UNUNIQUE,,AUTO

     2660    26753    2      NBRFOT_UNIQUE = 0;

  26753 24 006570   200020 450100                    STZ     NBRFOT_UNIQUE,,AUTO

     2661    26754    2      NBRFOT_UNIQUE_FOUND = 0;

  26754 24 006571   200021 450100                    STZ     NBRFOT_UNIQUE_FOUND,,AUTO

     2662    26755    2      NBRFOT_UNIQUE_UNFOUND = 0;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:328  
  26755 24 006572   200022 450100                    STZ     NBRFOT_UNIQUE_UNFOUND,,AUTO

     2663    26756
     2664    26757
     2665    26758    2      CALL M$OPEN( OPEN_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );

  26758 24 006573   000054 630400 23                 EPPR0   OPEN_ARC_LIST
        24 006574   450000 713400                    CLIMB   alt,open
        24 006575   410400 401760                    pmme    nvectors=18
        24 006576   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2666    26759    2      CALL FLP$WR_FILE_INFO ALTRET( ERR_CLOSE );

  26759 24 006577   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006600   000000 701000 xent               TSX1    FLP$WR_FILE_INFO
        24 006601   007742 702000 24                 TSX2    ERR_CLOSE

     2667    26760
     2668    26761    3      DO WHILE('1'B);

     2669    26762
     2670    26763    3         CALL M$READ( READ_ARC_LIST )

  26763 24 006602   000200 630400 23                 EPPR0   READ_ARC_LIST
        24 006603   440000 713400                    CLIMB   alt,read
        24 006604   401400 401760                    pmme    nvectors=4
        24 006605   006663 702000 24                 TSX2    s:26791

     2671    26764    4          WHENRETURN DO;

     2672    26765    4            ARC_FILE_NAME.NAME# = ARC_LIST_KEY.C.FNAMEC;

  26765 24 006606   040000 100400                    MLR     fill='040'O
        24 006607   000225 600037 2                  ADSC9   ARC_LIST_KEY+3           cn=3,n=31
        24 006610   005130 200037 2                  ADSC9   ARC_FILE_NAME            cn=1,n=31

     2673    26766    4            ARC_FILE_NAME.L# = ARC_LIST_KEY.C.FNAMEL;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:329  

  26766 24 006611   000235 236000 2                  LDQ     ARC_LIST_KEY+11
        24 006612   000022 736000                    QLS     18
        24 006613   005130 552040 2                  STBQ    ARC_FILE_NAME,'40'O

     2674    26767    4            ARC_FILE_ACCT.ACCT# = ARC_LIST_KEY.C.ACCT;

  26767 24 006614   040000 100400                    MLR     fill='040'O
        24 006615   000223 600010 2                  ADSC9   ARC_LIST_KEY+1           cn=3,n=8
        24 006616   005140 000010 2                  ADSC9   ARC_FILE_ACCT            cn=0,n=8

     2675    26768    4            ARC_FILE_SN.SN#(0) = ARC_LIST_KEY.C.PSN;

  26768 24 006617   040000 100400                    MLR     fill='040'O
        24 006620   000222 200006 2                  ADSC9   ARC_LIST_KEY             cn=1,n=6
        24 006621   005143 000006 2                  ADSC9   ARC_FILE_SN+1            cn=0,n=6

     2676    26769
     2677    26770    4            IF ARC_LIST_REC.REEL ~= ' ' OR ARC_LIST_REC.FSN ~= 0

  26770 24 006622   040000 106400                    CMPC    fill='040'O
        24 006623   003156 000006 2                  ADSC9   ARC_LIST_REC             cn=0,n=6
        24 006624   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 006625   006630 601000 24                 TNZ     s:26771
        24 006626   003157 720000 2                  LXL0    ARC_LIST_REC+1
        24 006627   006631 600000 24                 TZE     s:26772

     2678    26771    4             THEN NBRFAS = NBRFAS + 1;

  26771 24 006630   200013 054100                    AOS     NBRFAS,,AUTO

     2679    26772    4            NBRFOT = NBRFOT + ARC_LIST_REC.NBR_ON_TAPE;

  26772 24 006631   200016 236100                    LDQ     NBRFOT,,AUTO
        24 006632   003162 036000 2                  ADLQ    ARC_LIST_REC+4
        24 006633   200016 756100                    STQ     NBRFOT,,AUTO

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:330  
     2680    26773    4            IF ARC_LIST_REC.NBR_ON_TAPE = 0

  26773 24 006634   003162 235000 2                  LDA     ARC_LIST_REC+4
        24 006635   006640 601000 24                 TNZ     s:26776

     2681    26774    4             THEN NBRFAS_UNFOUND = NBRFAS_UNFOUND + 1;

  26774 24 006636   200015 054100                    AOS     NBRFAS_UNFOUND,,AUTO
        24 006637   006654 710000 24                 TRA     s:26783

     2682    26775    5             ELSE DO;

     2683    26776    5               NBRFOT_UNIQUE = NBRFOT_UNIQUE + 1;

  26776 24 006640   200020 054100                    AOS     NBRFOT_UNIQUE,,AUTO

     2684    26777    5               IF ARC_LIST_REC.NEW.REEL ~= ' '

  26777 24 006641   040000 106400                    CMPC    fill='040'O
        24 006642   003160 000006 2                  ADSC9   ARC_LIST_REC+2           cn=0,n=6
        24 006643   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 006644   006647 600000 24                 TZE     s:26779

     2685    26778    5                THEN NBRFOT_UNIQUE_FOUND = NBRFOT_UNIQUE_FOUND + 1;

  26778 24 006645   200021 054100                    AOS     NBRFOT_UNIQUE_FOUND,,AUTO
        24 006646   006650 710000 24                 TRA     s:26780

     2686    26779    5                ELSE NBRFOT_UNIQUE_UNFOUND = NBRFOT_UNIQUE_UNFOUND + 1;

  26779 24 006647   200022 054100                    AOS     NBRFOT_UNIQUE_UNFOUND,,AUTO

     2687    26780    5               NBRFOT_UNUNIQUE = NBRFOT_UNUNIQUE + ARC_LIST_REC.NBR_ON_TAPE - 1;

  26780 24 006650   200017 236100                    LDQ     NBRFOT_UNUNIQUE,,AUTO
        24 006651   003162 036000 2                  ADLQ    ARC_LIST_REC+4
        24 006652   000001 136007                    SBLQ    1,DL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:331  
        24 006653   200017 756100                    STQ     NBRFOT_UNUNIQUE,,AUTO

     2688    26781    5               END;

     2689    26782
     2690    26783    4            IF ARC_LIST_REC.NEW.REEL ~= ' '

  26783 24 006654   040000 106400                    CMPC    fill='040'O
        24 006655   003160 000006 2                  ADSC9   ARC_LIST_REC+2           cn=0,n=6
        24 006656   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 006657   006662 600000 24                 TZE     s:26789

     2691    26784    5             THEN DO;

     2692    26785    5               NBRFAS_FOUND = NBRFAS_FOUND + 1;

  26785 24 006660   200014 054100                    AOS     NBRFAS_FOUND,,AUTO

     2693    26786    5               END;

  26786 24 006661   006662 710000 24                 TRA     s:26789

     2694    26787    5             ELSE DO;                      /* Not on new reel                    */

     2695    26788    5               END;

     2696    26789    4            END;

  26789 24 006662   007736 710000 24                 TRA     s:26954

     2697    26790    4          WHENALTRETURN DO;

     2698    26791    4            IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF

  26791 24 006663   000000 470400 xsym               LDP0    B$TCB$
        24 006664   000000 471500                    LDP1    0,,PR0
        24 006665   100102 236100                    LDQ     66,,PR1
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:332  
        24 006666   377770 376007                    ANQ     131064,DL
        24 006667   000060 116007                    CMPQ    48,DL
        24 006670   006674 600000 24                 TZE     s:26793

     2699    26792    4             THEN CALL FLI$RPT_ERR;

  26792 24 006671   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006672   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006673   000000 011000                    NOP     0

     2700    26793    4            CALL M$CLOSE( CLOSE_ARC_LIST )

  26793 24 006674   000016 630400 23                 EPPR0   CLOSE_ARC_LIST
        24 006675   450001 713400                    CLIMB   alt,close
        24 006676   406000 401760                    pmme    nvectors=13
        24 006677   006701 702000 24                 TSX2    s:26795
        24 006700   006704 710000 24                 TRA     s:26798

     2701    26794    5             WHENALTRETURN DO;

     2702    26795    5               CALL FLI$RPT_ERR;

  26795 24 006701   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 006702   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 006703   000000 011000                    NOP     0

     2703    26796    5               END;

     2704    26797
     2705    26798    4            IF NOT ARCOM_OPTIONS.IMMUPDATE /* Update fits if not done already    */

  26798 24 006704   000000 234000 xsym               SZN     ARCOM_OPTIONS
        24 006705   006710 604000 24                 TMI     s:26801

     2706    26799    4             THEN CALL FLX_UPDATE_ARC_FILES ALTRET(ERR_CLOSE);

  26799 24 006706   006116 701000 24                 TSX1    FLX_UPDATE_ARC_FILES
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:333  
        24 006707   007742 702000 24                 TSX2    ERR_CLOSE

     2707    26800
     2708    26801    4            CALL M$DEVICE( PAGE_LO ) ALTRET( RPT_ERR_CLOSE );

  26801 24 006710   005204 630400 2                  EPPR0   PAGE_LO
        24 006711   450006 713400                    CLIMB   alt,+20486
        24 006712   401000 401760                    pmme    nvectors=3
        24 006713   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2709    26802    4            CALL FLX_ACC_LINE( 'Breakdown of archived files found on disk!' ) ALTRET(
             26802                     RPT_ERR_CLOSE );

  26802 24 006714   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 006715   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 006716   000001 235000 xsym               LDA     B_VECTNIL+1
        24 006717   200034 757100                    STAQ    NBR_IN_PREV_OUT_BLK,,AUTO
        24 006720   000202 236000 25                 LDQ     130
        24 006721   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 006722   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 006723   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2710    26803    4            IF OD_DEST

  26803 24 006724   200006 234100                    SZN     OD_DEST,,AUTO
        24 006725   006737 605000 24                 TPL     s:26807

     2711    26804    4             THEN
     2712    26805    4               CALL FLX_ACC_LINE( 'Re-archived on new optical disks!',
             26805                        NBRFAS_FOUND_UPDATED, 1 ) ALTRET( RPT_ERR_CLOSE );

  26805 24 006726   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 006727   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 006730   000204 237000 25                 LDAQ    132
        24 006731   200034 757100                    STAQ    NBR_IN_PREV_OUT_BLK,,AUTO
        24 006732   000206 236000 25                 LDQ     134
        24 006733   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:334  
        24 006734   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 006735   007737 702000 24                 TSX2    RPT_ERR_CLOSE
        24 006736   006747 710000 24                 TRA     s:26808

     2713    26806    4             ELSE
     2714    26807    4               CALL FLX_ACC_LINE( 'Re-archived on new tapes!', NBRFAS_FOUND_UPDATED, 1
             26807                        ) ALTRET( RPT_ERR_CLOSE );

  26807 24 006737   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 006740   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 006741   000204 237000 25                 LDAQ    132
        24 006742   200034 757100                    STAQ    NBR_IN_PREV_OUT_BLK,,AUTO
        24 006743   000207 236000 25                 LDQ     135
        24 006744   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 006745   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 006746   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2715    26808    4            IF NBRFAS_FOUND_UNUPDATED > 0

  26808 24 006747   000203 235000 2                  LDA     NBRFAS_FOUND_UNUPDATED
        24 006750   006776 604400 24                 TMOZ    s:26817

     2716    26809    5             THEN DO;

     2717    26810    5               IF OD_SOURCE

  26810 24 006751   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 006752   006764 605000 24                 TPL     s:26814

     2718    26811    5                THEN
     2719    26812    5                  CALL FLX_ACC_LINE( 'Still archived on old optical disks ***!',
             26812                           NBRFAS_FOUND_UNUPDATED, 1 ) ALTRET( RPT_ERR_CLOSE );

  26812 24 006753   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 006754   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 006755   000210 237000 25                 LDAQ    136
        24 006756   200034 757100                    STAQ    NBR_IN_PREV_OUT_BLK,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:335  
        24 006757   000212 236000 25                 LDQ     138
        24 006760   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 006761   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 006762   007737 702000 24                 TSX2    RPT_ERR_CLOSE
        24 006763   006774 710000 24                 TRA     s:26815

     2720    26813    5                ELSE
     2721    26814    5                  CALL FLX_ACC_LINE( 'Still archived on old tapes ***!',
             26814                           NBRFAS_FOUND_UNUPDATED, 1 ) ALTRET( RPT_ERR_CLOSE );

  26814 24 006764   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 006765   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 006766   000210 237000 25                 LDAQ    136
        24 006767   200034 757100                    STAQ    NBR_IN_PREV_OUT_BLK,,AUTO
        24 006770   000213 236000 25                 LDQ     139
        24 006771   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 006772   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 006773   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2722    26815    5               STEPCC = 4;

  26815 24 006774   000004 235007                    LDA     4,DL
        24 006775   004563 755000 2                  STA     STEPCC

     2723    26816    5               END;

     2724    26817    4            IF OD_SOURCE

  26817 24 006776   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 006777   007013 605000 24                 TPL     s:26821

     2725    26818    4             THEN
     2726    26819    4               CALL FLX_ACC_LINE( 'Found on old optical disks!', NBRFAS_FOUND, 2 )
             26819                        ALTRET( RPT_ERR_CLOSE );

  26819 24 007000   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007001   200036 756100                    STQ     @COLUMN+1,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:336  
        24 007002   000075 236000 25                 LDQ     61
        24 007003   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007004   200014 630500                    EPPR0   NBRFAS_FOUND,,AUTO
        24 007005   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007006   000214 236000 25                 LDQ     140
        24 007007   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007010   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007011   007737 702000 24                 TSX2    RPT_ERR_CLOSE
        24 007012   007025 710000 24                 TRA     s:26822

     2727    26820    4             ELSE
     2728    26821    4               CALL FLX_ACC_LINE( 'Found on old tapes!', NBRFAS_FOUND, 2 ) ALTRET(
             26821                        RPT_ERR_CLOSE );

  26821 24 007013   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007014   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007015   000075 236000 25                 LDQ     61
        24 007016   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007017   200014 630500                    EPPR0   NBRFAS_FOUND,,AUTO
        24 007020   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007021   000215 236000 25                 LDQ     141
        24 007022   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007023   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007024   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2729    26822    4            IF NBRFAS_UNFOUND > 0

  26822 24 007025   200015 235100                    LDA     NBRFAS_UNFOUND,,AUTO
        24 007026   007060 604400 24                 TMOZ    s:26831

     2730    26823    5             THEN DO;

     2731    26824    5               IF OD_SOURCE

  26824 24 007027   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 007030   007044 605000 24                 TPL     s:26828

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:337  
     2732    26825    5                THEN
     2733    26826    5                  CALL FLX_ACC_LINE( 'Not found on old optical disks ***!',
             26826                           NBRFAS_UNFOUND, 2 ) ALTRET( RPT_ERR_CLOSE );

  26826 24 007031   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007032   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007033   000075 236000 25                 LDQ     61
        24 007034   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007035   200015 630500                    EPPR0   NBRFAS_UNFOUND,,AUTO
        24 007036   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007037   000216 236000 25                 LDQ     142
        24 007040   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007041   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007042   007737 702000 24                 TSX2    RPT_ERR_CLOSE
        24 007043   007056 710000 24                 TRA     s:26829

     2734    26827    5                ELSE
     2735    26828    5                 CALL FLX_ACC_LINE( 'Not found on old tapes ***!', NBRFAS_UNFOUND, 2 )
             26828                           ALTRET( RPT_ERR_CLOSE );

  26828 24 007044   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007045   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007046   000075 236000 25                 LDQ     61
        24 007047   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007050   200015 630500                    EPPR0   NBRFAS_UNFOUND,,AUTO
        24 007051   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007052   000217 236000 25                 LDQ     143
        24 007053   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007054   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007055   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2736    26829    5               STEPCC = 4;

  26829 24 007056   000004 235007                    LDA     4,DL
        24 007057   004563 755000 2                  STA     STEPCC

     2737    26830    5               END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:338  

     2738    26831    4            CALL FLX_ACC_LINE( 'Archived files on disk!', NBRFAS, 3, '1'B ) ALTRET(
             26831                     RPT_ERR_CLOSE );

  26831 24 007060   000100 236000 25                 LDQ     64
        24 007061   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007062   000103 236000 25                 LDQ     67
        24 007063   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007064   200013 630500                    EPPR0   NBRFAS,,AUTO
        24 007065   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007066   000220 236000 25                 LDQ     144
        24 007067   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007070   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007071   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2739    26832    4            IF OD_SOURCE

  26832 24 007072   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 007073   007105 605000 24                 TPL     s:26836

     2740    26833    4             THEN
     2741    26834    4               CALL FLX_ACC_LINE(
             26834                        'Breakdown of files found on old archive optical disks!' ) ALTRET(
             26834                        RPT_ERR_CLOSE );

  26834 24 007074   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007075   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007076   000001 235000 xsym               LDA     B_VECTNIL+1
        24 007077   200034 757100                    STAQ    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007100   000221 236000 25                 LDQ     145
        24 007101   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007102   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007103   007737 702000 24                 TSX2    RPT_ERR_CLOSE
        24 007104   007115 710000 24                 TRA     s:26837

     2742    26835    4             ELSE
     2743    26836    4               CALL FLX_ACC_LINE( 'Breakdown of files found on old archive tapes!' )
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:339  
             26836                        ALTRET( RPT_ERR_CLOSE );

  26836 24 007105   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007106   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007107   000001 235000 xsym               LDA     B_VECTNIL+1
        24 007110   200034 757100                    STAQ    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007111   000222 236000 25                 LDQ     146
        24 007112   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007113   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007114   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2744    26837    4            IF OD_DEST

  26837 24 007115   200006 234100                    SZN     OD_DEST,,AUTO
        24 007116   007132 605000 24                 TPL     s:26841

     2745    26838    4             THEN
     2746    26839    4              CALL FLX_ACC_LINE( 'Moved to new optical disks!', NBRFOT_UNIQUE_FOUND, 1
             26839                        ) ALTRET( RPT_ERR_CLOSE );

  26839 24 007117   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007120   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007121   000010 236000 25                 LDQ     8
        24 007122   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007123   200021 630500                    EPPR0   NBRFOT_UNIQUE_FOUND,,AUTO
        24 007124   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007125   000223 236000 25                 LDQ     147
        24 007126   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007127   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007130   007737 702000 24                 TSX2    RPT_ERR_CLOSE
        24 007131   007144 710000 24                 TRA     s:26842

     2747    26840    4             ELSE
     2748    26841    4               CALL FLX_ACC_LINE( 'Moved to new tapes!', NBRFOT_UNIQUE_FOUND, 1 )
             26841                        ALTRET( RPT_ERR_CLOSE );

  26841 24 007132   000001 236000 xsym               LDQ     B_VECTNIL+1
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:340  
        24 007133   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007134   000010 236000 25                 LDQ     8
        24 007135   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007136   200021 630500                    EPPR0   NBRFOT_UNIQUE_FOUND,,AUTO
        24 007137   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007140   000224 236000 25                 LDQ     148
        24 007141   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007142   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007143   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2749    26842    4            IF OD_SOURCE

  26842 24 007144   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 007145   007161 605000 24                 TPL     s:26846

     2750    26843    4             THEN
     2751    26844    4               CALL FLX_ACC_LINE( 'Unarchived since old optical disks written!',
             26844                        NBRFOT_UNIQUE_UNFOUND, 1 ) ALTRET( RPT_ERR_CLOSE );

  26844 24 007146   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007147   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007150   000010 236000 25                 LDQ     8
        24 007151   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007152   200022 630500                    EPPR0   NBRFOT_UNIQUE_UNFOUND,,AUTO
        24 007153   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007154   000225 236000 25                 LDQ     149
        24 007155   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007156   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007157   007737 702000 24                 TSX2    RPT_ERR_CLOSE
        24 007160   007173 710000 24                 TRA     s:26847

     2752    26845    4             ELSE
     2753    26846    4               CALL FLX_ACC_LINE( 'Unarchived since old tapes written!',
             26846                        NBRFOT_UNIQUE_UNFOUND, 1 ) ALTRET( RPT_ERR_CLOSE );

  26846 24 007161   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007162   200036 756100                    STQ     @COLUMN+1,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:341  
        24 007163   000010 236000 25                 LDQ     8
        24 007164   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007165   200022 630500                    EPPR0   NBRFOT_UNIQUE_UNFOUND,,AUTO
        24 007166   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007167   000226 236000 25                 LDQ     150
        24 007170   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007171   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007172   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2754    26847    4            IF OD_SOURCE

  26847 24 007173   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 007174   007210 605000 24                 TPL     s:26851

     2755    26848    4             THEN
     2756    26849    4               CALL FLX_ACC_LINE( 'Unique files on old optical disks!', NBRFOT_UNIQUE,
             26849                        2 ) ALTRET( RPT_ERR_CLOSE );

  26849 24 007175   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007176   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007177   000075 236000 25                 LDQ     61
        24 007200   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007201   200020 630500                    EPPR0   NBRFOT_UNIQUE,,AUTO
        24 007202   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007203   000227 236000 25                 LDQ     151
        24 007204   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007205   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007206   007737 702000 24                 TSX2    RPT_ERR_CLOSE
        24 007207   007222 710000 24                 TRA     s:26852

     2757    26850    4             ELSE
     2758    26851    4               CALL FLX_ACC_LINE( 'Unique files on old tapes!', NBRFOT_UNIQUE, 2 )
             26851                        ALTRET( RPT_ERR_CLOSE );

  26851 24 007210   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007211   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007212   000075 236000 25                 LDQ     61
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:342  
        24 007213   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007214   200020 630500                    EPPR0   NBRFOT_UNIQUE,,AUTO
        24 007215   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007216   000230 236000 25                 LDQ     152
        24 007217   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007220   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007221   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2759    26852    4            IF OD_SOURCE

  26852 24 007222   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 007223   007237 605000 24                 TPL     s:26856

     2760    26853    4             THEN
     2761    26854    4               CALL FLX_ACC_LINE( 'Extraneous files on old optical disks!',
             26854                        NBRFOT_UNUNIQUE, 2 ) ALTRET( RPT_ERR_CLOSE );

  26854 24 007224   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007225   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007226   000075 236000 25                 LDQ     61
        24 007227   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007230   200017 630500                    EPPR0   NBRFOT_UNUNIQUE,,AUTO
        24 007231   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007232   000231 236000 25                 LDQ     153
        24 007233   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007234   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007235   007737 702000 24                 TSX2    RPT_ERR_CLOSE
        24 007236   007251 710000 24                 TRA     s:26857

     2762    26855    4             ELSE
     2763    26856    4               CALL FLX_ACC_LINE( 'Extraneous files on old tapes!', NBRFOT_UNUNIQUE, 2
             26856                        ) ALTRET( RPT_ERR_CLOSE );

  26856 24 007237   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 007240   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007241   000075 236000 25                 LDQ     61
        24 007242   200035 756100                    STQ     RPT_ERR,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:343  
        24 007243   200017 630500                    EPPR0   NBRFOT_UNUNIQUE,,AUTO
        24 007244   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007245   000232 236000 25                 LDQ     154
        24 007246   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007247   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007250   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2764    26857    4            IF OD_SOURCE

  26857 24 007251   200005 234100                    SZN     OD_SOURCE,,AUTO
        24 007252   007266 605000 24                 TPL     s:26861

     2765    26858    4             THEN
     2766    26859    4               CALL FLX_ACC_LINE( 'Files on old optical disks!', NBRFOT, 3, '1'B )
             26859                        ALTRET( RPT_ERR_CLOSE );

  26859 24 007253   000100 236000 25                 LDQ     64
        24 007254   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007255   000103 236000 25                 LDQ     67
        24 007256   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007257   200016 630500                    EPPR0   NBRFOT,,AUTO
        24 007260   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007261   000233 236000 25                 LDQ     155
        24 007262   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007263   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007264   007737 702000 24                 TSX2    RPT_ERR_CLOSE
        24 007265   007300 710000 24                 TRA     s:26862

     2767    26860    4             ELSE
     2768    26861    4               CALL FLX_ACC_LINE( 'Files on old tapes!', NBRFOT, 3, '1'B ) ALTRET(
             26861                        RPT_ERR_CLOSE );

  26861 24 007266   000100 236000 25                 LDQ     64
        24 007267   200036 756100                    STQ     @COLUMN+1,,AUTO
        24 007270   000103 236000 25                 LDQ     67
        24 007271   200035 756100                    STQ     RPT_ERR,,AUTO
        24 007272   200016 630500                    EPPR0   NBRFOT,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:344  
        24 007273   200034 450500                    STP0    NBR_IN_PREV_OUT_BLK,,AUTO
        24 007274   000234 236000 25                 LDQ     156
        24 007275   200033 756100                    STQ     NBR_IN_OUT_BLK,,AUTO
        24 007276   010144 701000 24                 TSX1    FLX_ACC_LINE
        24 007277   007737 702000 24                 TSX2    RPT_ERR_CLOSE

     2769    26862    4            IF NBRFAS_UNFOUND > 0

  26862 24 007300   200015 235100                    LDA     NBRFAS_UNFOUND,,AUTO
        24 007301   007304 604400 24                 TMOZ    s:26865

     2770    26863    4             THEN CALL FLX_ARC_LIST_ERROR_REPORT;

  26863 24 007302   007774 701000 24                 TSX1    FLX_ARC_LIST_ERROR_REPORT
        24 007303   000000 011000                    NOP     0

     2771    26864
     2772    26865    4            DPSIZE = (LENGTHC(DPLIST.NUM#) + DPLIST.NUM# * LENGTHC(DPLIST.SN#(0)) + 3)
             26865                     / 4;

  26865 24 007304   000000 470400 xsym               LDP0    DPLIST$
        24 007305   000000 236100                    LDQ     0,,PR0
        24 007306   000006 402007                    MPY     6,DL
        24 007307   000007 036007                    ADLQ    7,DL
        24 007310   000004 506007                    DIV     4,DL
        24 007311   200023 756100                    STQ     DPSIZE,,AUTO

     2773    26866    4            SNSIZE = (LENGTHC(BASED_SN.NUM#) + TAPE_SET$->BASED_SN.NUM# * LENGTHC(
             26866                     BASED_SN.SN#(0)) + 3) / 4;

  26866 24 007312   000177 471400 2                  LDP1    TAPE_SET$
        24 007313   100000 236100                    LDQ     0,,PR1
        24 007314   000006 402007                    MPY     6,DL
        24 007315   000007 036007                    ADLQ    7,DL
        24 007316   000004 506007                    DIV     4,DL
        24 007317   200024 756100                    STQ     SNSIZE,,AUTO

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:345  
     2774    26867    4            IF NBR_SNLISTS > 2

  26867 24 007320   000000 235000 xsym               LDA     NBR_SNLISTS
        24 007321   000002 115007                    CMPA    2,DL
        24 007322   007330 604400 24                 TMOZ    s:26871

     2775    26868    4             THEN
     2776    26869    4               SIZE = DPSIZE + (2 * SNSIZE) + SIZEW(ARCHIVE_LIST);

  26869 24 007323   000001 736000                    QLS     1
        24 007324   200023 036100                    ADLQ    DPSIZE,,AUTO
        24 007325   000011 036007                    ADLQ    9,DL
        24 007326   200026 756100                    STQ     SIZE,,AUTO
        24 007327   007334 710000 24                 TRA     s:26872

     2777    26870    4             ELSE
     2778    26871    4               SIZE = DPSIZE + (NBR_SNLISTS * SNSIZE) + SIZEW(ARCHIVE_LIST);

  26871 24 007330   000000 402000 xsym               MPY     NBR_SNLISTS
        24 007331   200023 036100                    ADLQ    DPSIZE,,AUTO
        24 007332   000011 036007                    ADLQ    9,DL
        24 007333   200026 756100                    STQ     SIZE,,AUTO

     2779    26872    4            CALL FLI$ALLOC( SIZE, ARC_REC$ );

  26872 24 007334   000033 236000 25                 LDQ     27
        24 007335   200071 756100                    STQ     NEW_FSN+4,,AUTO
        24 007336   200026 633500                    EPPR3   SIZE,,AUTO
        24 007337   200070 453500                    STP3    NEW_FSN+3,,AUTO
        24 007340   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 007341   000020 631400 xsym               EPPR1   B_VECTNIL+16
        24 007342   000000 701000 xent               TSX1    FLI$ALLOC
        24 007343   000000 011000                    NOP     0

     2780    26873    4            ARC_REC$->ARCHIVE_LIST = '0'B;

  26873 24 007344   000167 470400 2                  LDP0    ARC_REC$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:346  
        24 007345   000100 100400                    MLR     fill='000'O
        24 007346   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
        24 007347   000000 000044                    ADSC9   0,,PR0                   cn=0,n=36

     2781    26874    4            ARC_REC$->ARCHIVE_LIST.OPTION.DEN = M$TAPE00$->F$DCB.DENSITY#;

  26874 24 007350   000000 470400 xsym               LDP0    M$TAPE00$
        24 007351   000167 471400 2                  LDP1    ARC_REC$
        24 007352   000043 236100                    LDQ     35,,PR0
        24 007353   000036 736000                    QLS     30
        24 007354   100007 752140                    STCQ    7,'40'O,PR1

     2782    26875    4            ARC_REC$->ARCHIVE_LIST.OPTION.VOLA = M$TAPE00$->F$DCB.VOLACCESS#;

  26875 24 007355   000167 471400 2                  LDP1    ARC_REC$
        24 007356   000031 236100                    LDQ     25,,PR0
        24 007357   003000 376003                    ANQ     1536,DU
        24 007360   100007 676100                    ERQ     7,,PR1
        24 007361   007000 376003                    ANQ     3584,DU
        24 007362   100007 656100                    ERSQ    7,,PR1

     2783    26876    4            ARC_REC$->ARCHIVE_LIST.OPTION.EXP = M$TAPE00$->F$DCB.EXPIRE#;

  26876 24 007363   000167 471400 2                  LDP1    ARC_REC$
        24 007364   000035 235100                    LDA     29,,PR0
        24 007365   100010 755100                    STA     8,,PR1

     2784    26877    4            ARC_REC$->ARCHIVE_LIST.OPTION.BLOCK = M$TAPE00$->F$DCB.BLKL#;

  26877 24 007366   000033 220100                    LDX0    27,,PR0
        24 007367   000167 471400 2                  LDP1    ARC_REC$
        24 007370   100007 440100                    SXL0    7,,PR1

     2785    26878    4            ARC_REC$->ARCHIVE_LIST.OPTION.CHECK = OPTION_CHECK;

  26878 24 007371   000167 471400 2                  LDP1    ARC_REC$
        24 007372   200003 236100                    LDQ     OPTION_CHECK,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:347  
        24 007373   000011 772000                    QRL     9
        24 007374   100007 676100                    ERQ     7,,PR1
        24 007375   000400 376003                    ANQ     256,DU
        24 007376   100007 656100                    ERSQ    7,,PR1

     2786    26879    4            ARC_REC$->ARCHIVE_LIST.OPTION.IOERRORC = OPTION_IOERRORC;

  26879 24 007377   000167 471400 2                  LDP1    ARC_REC$
        24 007400   200004 236100                    LDQ     OPTION_IOERRORC,,AUTO
        24 007401   000012 772000                    QRL     10
        24 007402   100007 676100                    ERQ     7,,PR1
        24 007403   000200 376003                    ANQ     128,DU
        24 007404   100007 656100                    ERSQ    7,,PR1

     2787    26880    4            ARC_REC$->ARCHIVE_LIST.VERSION.FLAG = BITBIN('777'O); /* Post-D00    */

  26880 24 007405   000167 471400 2                  LDP1    ARC_REC$
        24 007406   777000 236003                    LDQ     -512,DU
        24 007407   100000 552140                    STBQ    0,'40'O,PR1

     2788    26881    4            ARC_REC$->ARCHIVE_LIST.VERSION.SIZE = ADDR(B_VERSION)->B$VERSION.L#;

  26881 24 007410   000167 470400 2                  LDP0    ARC_REC$
        24 007411   000000 236000 xsym               LDQ     B_VERSION
        24 007412   000011 772000                    QRL     9
        24 007413   000000 552120                    STBQ    0,'20'O,PR0

     2789    26882    4            ARC_REC$->ARCHIVE_LIST.VERSION.TEXT = SUBSTR(ADDR(B_VERSION)->B$VERSION.
             26882                     NAME#,0,ADDR(B_VERSION)->B$VERSION.L#);

  26882 24 007414   000000 236000 xsym               LDQ     B_VERSION
        24 007415   000033 772000                    QRL     27
        24 007416   000000 620006                    EAX0    0,QL
        24 007417   000167 470400 2                  LDP0    ARC_REC$
        24 007420   040100 100440                    MLR     fill='040'O
        24 007421   000000 200010 xsym               ADSC9   B_VERSION                cn=1,n=*X0
        24 007422   000000 400006                    ADSC9   0,,PR0                   cn=2,n=6
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:348  

     2790    26883    4            ARC_REC$->ARCHIVE_LIST.VOLUME = 0; /* Unused                         */

  26883 24 007423   000167 470400 2                  LDP0    ARC_REC$
        24 007424   000000 236003                    LDQ     0,DU
        24 007425   000006 552140                    STBQ    6,'40'O,PR0

     2791    26884    4            ARC_REC$->ARCHIVE_LIST.XTEND = %YES#;

  26884 24 007426   000167 470400 2                  LDP0    ARC_REC$
        24 007427   000400 236003                    LDQ     256,DU
        24 007430   000006 256100                    ORSQ    6,,PR0

     2792    26885    4            ARC_REC$->ARCHIVE_LIST.OFFSET.DPLIST = SIZEW(ARCHIVE_LIST);

  26885 24 007431   000011 235007                    LDA     9,DL
        24 007432   000167 470400 2                  LDP0    ARC_REC$
        24 007433   000003 755100                    STA     3,,PR0

     2793    26886    4            IF OD_DEST

  26886 24 007434   200006 234100                    SZN     OD_DEST,,AUTO
        24 007435   007442 605000 24                 TPL     s:26888

     2794    26887    4             THEN ARC_REC$->ARCHIVE_LIST.OD = '1'B;

  26887 24 007436   000167 470400 2                  LDP0    ARC_REC$
        24 007437   000200 236003                    LDQ     128,DU
        24 007440   000006 256100                    ORSQ    6,,PR0
        24 007441   007445 710000 24                 TRA     s:26889

     2795    26888    4             ELSE ARC_REC$->ARCHIVE_LIST.OD = '0'B;

  26888 24 007442   000167 470400 2                  LDP0    ARC_REC$
        24 007443   000235 236000 25                 LDQ     157
        24 007444   000006 356100                    ANSQ    6,,PR0

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:349  
     2796    26889    4            TEMP$ = PINCRW( ARC_REC$, ARC_REC$->ARCHIVE_LIST.OFFSET.DPLIST );

  26889 24 007445   000167 470400 2                  LDP0    ARC_REC$
        24 007446   000003 720100                    LXL0    3,,PR0
        24 007447   000000 636010                    EAQ     0,X0
        24 007450   000167 036000 2                  ADLQ    ARC_REC$
        24 007451   000176 756000 2                  STQ     TEMP$

     2797    26890    4            TEMP$->DPLIST.NUM# = DPLIST.NUM#;

  26890 24 007452   000000 471400 xsym               LDP1    DPLIST$
        24 007453   000176 473400 2                  LDP3    TEMP$
        24 007454   100000 235100                    LDA     0,,PR1
        24 007455   300000 755100                    STA     0,,PR3

     2798    26891    5            DO I=0 TO DPLIST.NUM# - 1;

  26891 24 007456   000205 450000 2                  STZ     I
        24 007457   007470 710000 24                 TRA     s:26893+1

     2799    26892    5               TEMP$->DPLIST.SN#(I) = DPLIST.SN#(I);

  26892 24 007460   000205 236000 2                  LDQ     I
        24 007461   000006 402007                    MPY     6,DL
        24 007462   000000 470400 xsym               LDP0    DPLIST$
        24 007463   000176 471400 2                  LDP1    TEMP$
        24 007464   040106 100506                    MLR     fill='040'O
        24 007465   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 007466   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

     2800    26893    5               END;

  26893 24 007467   000205 054000 2                  AOS     I
        24 007470   000000 470400 xsym               LDP0    DPLIST$
        24 007471   000205 236000 2                  LDQ     I
        24 007472   000000 116100                    CMPQ    0,,PR0
        24 007473   007460 604000 24                 TMI     s:26892
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:350  

     2801    26894    4            TEMP$ = PINCRW( TEMP$, DPSIZE);

  26894 24 007474   200023 236100                    LDQ     DPSIZE,,AUTO
        24 007475   000022 736000                    QLS     18
        24 007476   000176 036000 2                  ADLQ    TEMP$
        24 007477   000176 756000 2                  STQ     TEMP$

     2802    26895    4            ARC_REC$->ARCHIVE_LIST.OFFSET.SNLIST = POFFW( TEMP$, ARC_REC$ );

  26895 24 007500   000167 235000 2                  LDA     ARC_REC$
        24 007501   000022 771000                    ARL     18
        24 007502   200070 755100                    STA     NEW_FSN+3,,AUTO
        24 007503   000176 236000 2                  LDQ     TEMP$
        24 007504   000022 772000                    QRL     18
        24 007505   200070 136100                    SBLQ    NEW_FSN+3,,AUTO
        24 007506   000167 471400 2                  LDP1    ARC_REC$
        24 007507   100004 756100                    STQ     4,,PR1

     2803    26896    4            IF M$TAPE00$->F$DCB.VOL# = 0

  26896 24 007510   000000 471400 xsym               LDP1    M$TAPE00$
        24 007511   100043 236100                    LDQ     35,,PR1
        24 007512   777000 316003                    CANQ    -512,DU
        24 007513   007516 601000 24                 TNZ     s:26900

     2804    26897    4             THEN
     2805    26898    4               VOL# = 0;

  26898 24 007514   200025 450100                    STZ     VOL#,,AUTO
        24 007515   007522 710000 24                 TRA     s:26901

     2806    26899    4             ELSE
     2807    26900    4               VOL# = M$TAPE00$->F$DCB.VOL# - 1;

  26900 24 007516   100043 236100                    LDQ     35,,PR1
        24 007517   000033 772000                    QRL     27
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:351  
        24 007520   000001 136007                    SBLQ    1,DL
        24 007521   200025 756100                    STQ     VOL#,,AUTO

     2808    26901    4            TEMP$->BASED_SN.NUM# = TAPE_SET$->BASED_SN.NUM# - VOL#;

  26901 24 007522   000177 473400 2                  LDP3    TAPE_SET$
        24 007523   300000 236100                    LDQ     0,,PR3
        24 007524   200025 136100                    SBLQ    VOL#,,AUTO
        24 007525   000176 474400 2                  LDP4    TEMP$
        24 007526   400000 756100                    STQ     0,,PR4

     2809    26902
     2810    26903    4            FIRST$ = LAST_SNLISTINFO$;

  26903 24 007527   000000 236000 xsym               LDQ     LAST_SNLISTINFO$
        24 007530   200027 756100                    STQ     FIRST$,,AUTO

     2811    26904    4            IF NBR_SNLISTS > 1 /* Get 1st and 2nd tapesets/optical disksets spec'd */

  26904 24 007531   000000 235000 xsym               LDA     NBR_SNLISTS
        24 007532   000001 115007                    CMPA    1,DL
        24 007533   007546 604400 24                 TMOZ    s:26911

     2812    26905    4             THEN
     2813    26906    5            DO WHILE (FIRST$->SNLISTINFO.PREVINFO$ ~= ADDR(NIL));

  26906 24 007534   007542 710000 24                 TRA     s:26909

     2814    26907    5               SECND$ = FIRST$;

  26907 24 007535   200027 236100                    LDQ     FIRST$,,AUTO
        24 007536   200030 756100                    STQ     SECND$,,AUTO

     2815    26908    5               FIRST$ = FIRST$->SNLISTINFO.PREVINFO$;

  26908 24 007537   200027 470500                    LDP0    FIRST$,,AUTO
        24 007540   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:352  
        24 007541   200027 756100                    STQ     FIRST$,,AUTO

     2816    26909    5               END;

  26909 24 007542   200027 470500                    LDP0    FIRST$,,AUTO
        24 007543   000001 236100                    LDQ     1,,PR0
        24 007544   000001 116000 xsym               CMPQ    B_VECTNIL+1
        24 007545   007535 601000 24                 TNZ     s:26907

     2817    26910
     2818    26911    4            TEMP = 0;

  26911 24 007546   000175 450000 2                  STZ     TEMP

     2819    26912    5            DO I = VOL# TO FIRST$->SNLISTINFO.SNLIST$->BASED_SN.NUM# - 1;

  26912 24 007547   200025 235100                    LDA     VOL#,,AUTO
        24 007550   000205 755000 2                  STA     I
        24 007551   007570 710000 24                 TRA     s:26915+1

     2820    26913    5              TEMP$->BASED_SN.SN#(TEMP) = FIRST$->SNLISTINFO.SNLIST$->BASED_SN.SN#(I);

  26913 24 007552   200027 470500                    LDP0    FIRST$,,AUTO
        24 007553   000000 471500                    LDP1    0,,PR0
        24 007554   000205 236000 2                  LDQ     I
        24 007555   000006 402007                    MPY     6,DL
        24 007556   200070 756100                    STQ     NEW_FSN+3,,AUTO
        24 007557   000175 236000 2                  LDQ     TEMP
        24 007560   000006 402007                    MPY     6,DL
        24 007561   200070 235100                    LDA     NEW_FSN+3,,AUTO
        24 007562   000176 473400 2                  LDP3    TEMP$
        24 007563   040106 100505                    MLR     fill='040'O
        24 007564   100001 000006                    ADSC9   1,A,PR1                  cn=0,n=6
        24 007565   300001 000006                    ADSC9   1,Q,PR3                  cn=0,n=6

     2821    26914    5               TEMP = TEMP + 1;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:353  
  26914 24 007566   000175 054000 2                  AOS     TEMP

     2822    26915    5               END;

  26915 24 007567   000205 054000 2                  AOS     I
        24 007570   200027 470500                    LDP0    FIRST$,,AUTO
        24 007571   000000 471500                    LDP1    0,,PR0
        24 007572   000205 236000 2                  LDQ     I
        24 007573   100000 116100                    CMPQ    0,,PR1
        24 007574   007552 604000 24                 TMI     s:26913

     2823    26916
     2824    26917    4            IF NBR_SNLISTS > 1        /* Move duplicate tape/optical disk set    */

  26917 24 007575   000000 235000 xsym               LDA     NBR_SNLISTS
        24 007576   000001 115007                    CMPA    1,DL
        24 007577   007643 604400 24                 TMOZ    s:26927

     2825    26918    5             THEN DO;

     2826    26919    5               TEMP$ = PINCRW( TEMP$, SNSIZE);

  26919 24 007600   200024 236100                    LDQ     SNSIZE,,AUTO
        24 007601   000022 736000                    QLS     18
        24 007602   000176 036000 2                  ADLQ    TEMP$
        24 007603   000176 756000 2                  STQ     TEMP$

     2827    26920    5               ARC_REC$->ARCHIVE_LIST.OFFSET.SNLIST2 = POFFW( TEMP$, ARC_REC$ );

  26920 24 007604   000167 235000 2                  LDA     ARC_REC$
        24 007605   000022 771000                    ARL     18
        24 007606   200070 755100                    STA     NEW_FSN+3,,AUTO
        24 007607   000176 236000 2                  LDQ     TEMP$
        24 007610   000022 772000                    QRL     18
        24 007611   200070 136100                    SBLQ    NEW_FSN+3,,AUTO
        24 007612   000167 471400 2                  LDP1    ARC_REC$
        24 007613   100005 756100                    STQ     5,,PR1
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:354  

     2828    26921    5              TEMP$->BASED_SN.NUM# = SECND$->SNLISTINFO.SNLIST$->BASED_SN.NUM# - VOL#;

  26921 24 007614   200030 471500                    LDP1    SECND$,,AUTO
        24 007615   100000 473500                    LDP3    0,,PR1
        24 007616   300000 236100                    LDQ     0,,PR3
        24 007617   200025 136100                    SBLQ    VOL#,,AUTO
        24 007620   000176 474400 2                  LDP4    TEMP$
        24 007621   400000 756100                    STQ     0,,PR4

     2829    26922    6               DO I = VOL# TO SECND$->SNLISTINFO.SNLIST$->BASED_SN.NUM# - 1;

  26922 24 007622   200025 235100                    LDA     VOL#,,AUTO
        24 007623   000205 755000 2                  STA     I
        24 007624   007636 710000 24                 TRA     s:26924+1

     2830    26923    6                 TEMP$->BASED_SN.SN#(I) = SECND$->SNLISTINFO.SNLIST$->BASED_SN.SN#(I);

  26923 24 007625   200030 470500                    LDP0    SECND$,,AUTO
        24 007626   000000 471500                    LDP1    0,,PR0
        24 007627   000205 236000 2                  LDQ     I
        24 007630   000006 402007                    MPY     6,DL
        24 007631   000176 473400 2                  LDP3    TEMP$
        24 007632   040106 100506                    MLR     fill='040'O
        24 007633   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6
        24 007634   300001 000006                    ADSC9   1,Q,PR3                  cn=0,n=6

     2831    26924    6                  END;

  26924 24 007635   000205 054000 2                  AOS     I
        24 007636   200030 470500                    LDP0    SECND$,,AUTO
        24 007637   000000 471500                    LDP1    0,,PR0
        24 007640   000205 236000 2                  LDQ     I
        24 007641   100000 116100                    CMPQ    0,,PR1
        24 007642   007625 604000 24                 TMI     s:26923

     2832    26925    5               END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:355  

     2833    26926
     2834    26927    4            ARC_REC_SIZE = SIZE;

  26927 24 007643   200026 235100                    LDA     SIZE,,AUTO
        24 007644   000166 755000 2                  STA     ARC_REC_SIZE

     2835    26928    4            ARC_REC$->ARCHIVE_LIST.SIZE = SIZE;

  26928 24 007645   000167 470400 2                  LDP0    ARC_REC$
        24 007646   000002 755100                    STA     2,,PR0

     2836    26929    4            OPEN_ARCHIVE_EFT.V.FUN# = %CREATE#;

  26929 24 007647   003000 236007                    LDQ     1536,DL
        24 007650   005401 552010 2                  STBQ    OPEN_ARCHIVE_EFT+37,'10'O

     2837    26930    4            OPEN_ARCHIVE_EFT.V.EXIST# = %NEWFILE#;

  26930 24 007651   000600 236007                    LDQ     384,DL
        24 007652   005400 256000 2                  ORSQ    OPEN_ARCHIVE_EFT+36

     2838    26931    5            DO I=0 TO DPLIST.NUM# - 1;

  26931 24 007653   000205 450000 2                  STZ     I
        24 007654   007730 710000 24                 TRA     s:26951+1

     2839    26932    5               DPSN.SN#(0) = DPLIST.SN#(I);

  26932 24 007655   000205 236000 2                  LDQ     I
        24 007656   000006 402007                    MPY     6,DL
        24 007657   000000 470400 xsym               LDP0    DPLIST$
        24 007660   040000 100506                    MLR     fill='040'O
        24 007661   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        24 007662   005461 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

     2840    26933    5               CALL M$OPEN( OPEN_ARCHIVE_EFT )
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:356  

  26933 24 007663   005334 630400 2                  EPPR0   OPEN_ARCHIVE_EFT
        24 007664   450000 713400                    CLIMB   alt,open
        24 007665   410400 401760                    pmme    nvectors=18
        24 007666   007724 702000 24                 TSX2    s:26949

     2841    26934    6                WHENRETURN DO;

     2842    26935    6                  WRITE_ARCHIVE_EFT.BUF_ = VECTOR(ARC_REC_SIZE);

  26935 24 007667   000026 237000 25                 LDAQ    22
        24 007670   005450 757000 2                  STAQ    WRITE_ARCHIVE_EFT+4

     2843    26936    6                  CALL M$WRITE( WRITE_ARCHIVE_EFT ) ALTRET( CLSERR );

  26936 24 007671   005444 630400 2                  EPPR0   WRITE_ARCHIVE_EFT
        24 007672   440001 713400                    CLIMB   alt,write
        24 007673   401400 401760                    pmme    nvectors=4
        24 007674   007713 702000 24                 TSX2    CLSERR

     2844    26937    6                  WRITE_ARCHIVE_EFT.BUF_.BOUND = ARC_REC_SIZE * 4 - 1;

  26937 24 007675   000166 236000 2                  LDQ     ARC_REC_SIZE
        24 007676   000002 736000                    QLS     2
        24 007677   000001 136007                    SBLQ    1,DL
        24 007700   000020 736000                    QLS     16
        24 007701   005450 676000 2                  ERQ     WRITE_ARCHIVE_EFT+4
        24 007702   000034 376000 xsym               ANQ     B_VECTNIL+28
        24 007703   005450 656000 2                  ERSQ    WRITE_ARCHIVE_EFT+4

     2845    26938    6                  WRITE_ARCHIVE_EFT.BUF_.BUF$ = ARC_REC$;

  26938 24 007704   000167 236000 2                  LDQ     ARC_REC$
        24 007705   005451 756000 2                  STQ     WRITE_ARCHIVE_EFT+5

     2846    26939    6                  CALL M$WRITE( WRITE_ARCHIVE_EFT ) ALTRET( CLSERR );

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:357  
  26939 24 007706   005444 630400 2                  EPPR0   WRITE_ARCHIVE_EFT
        24 007707   440001 713400                    CLIMB   alt,write
        24 007710   401400 401760                    pmme    nvectors=4
        24 007711   007713 702000 24                 TSX2    CLSERR

     2847    26940    7                  DO WHILE('0'B);

  26940 24 007712   007716 710000 24                 TRA     s:26944

  26939 24 007713                       CLSERR       null
     2848    26941    7   CLSERR:           ;
     2849    26942    7                     CALL FLI$RPT_ERR;

  26942 24 007713   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 007714   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 007715   000000 011000                    NOP     0

     2850    26943    7                     END;

     2851    26944    6                  CALL M$CLOSE( CLOSE_ARCHIVE_EFT )

  26944 24 007716   000216 630400 23                 EPPR0   CLOSE_ARCHIVE_EFT
        24 007717   450001 713400                    CLIMB   alt,close
        24 007720   406000 401760                    pmme    nvectors=13
        24 007721   007723 702000 24                 TSX2    s:26947
        24 007722   007723 710000 24                 TRA     s:26947

     2852    26945    7                   WHENALTRETURN DO;

     2853    26946    7                     END;

     2854    26947    6                  END;

  26947 24 007723   007727 710000 24                 TRA     s:26951

     2855    26948    6                WHENALTRETURN DO;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:358  
     2856    26949    6                  CALL FLI$RPT_ERR;

  26949 24 007724   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 007725   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 007726   000000 011000                    NOP     0

     2857    26950    6                  END;

     2858    26951    5               END;

  26951 24 007727   000205 054000 2                  AOS     I
        24 007730   000000 470400 xsym               LDP0    DPLIST$
        24 007731   000205 236000 2                  LDQ     I
        24 007732   000000 116100                    CMPQ    0,,PR0
        24 007733   007655 604000 24                 TMI     s:26932

     2859    26952    4            RETURN;

  26952 24 007734   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 007735   000001 702211                    TSX2  ! 1,X1

     2860    26953    4            END;
     2861    26954    3         END;

  26954 24 007736   006602 710000 24                 TRA     s:26763

  26950 24 007737                       RPT_ERR_CLO* null
     2862    26955
     2863    26956    2   RPT_ERR_CLOSE: ;
     2864    26957    2      CALL FLI$RPT_ERR;

  26957 24 007737   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 007740   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 007741   000000 011000                    NOP     0

  26950 24 007742                       ERR_CLOSE    null
     2865    26958
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:359  
     2866    26959    2   ERR_CLOSE: ;
     2867    26960    2      IF M$ARC_LIST$->F$DCB.FCD#

  26960 24 007742   004536 470400 2                  LDP0    M$ARC_LIST$
        24 007743   000031 236100                    LDQ     25,,PR0
        24 007744   020000 316007                    CANQ    8192,DL
        24 007745   007756 600000 24                 TZE     s:26968

     2868    26961    3       THEN DO;

     2869    26962    3         CALL M$CLOSE( CLOSE_ARC_LIST )

  26962 24 007746   000016 630400 23                 EPPR0   CLOSE_ARC_LIST
        24 007747   450001 713400                    CLIMB   alt,close
        24 007750   406000 401760                    pmme    nvectors=13
        24 007751   007753 702000 24                 TSX2    s:26964
        24 007752   007756 710000 24                 TRA     s:26968

     2870    26963    4          WHENALTRETURN DO;

     2871    26964    4            CALL FLI$RPT_ERR;

  26964 24 007753   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 007754   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 007755   000000 011000                    NOP     0

     2872    26965    4            END;

     2873    26966    3         END;

     2874    26967
     2875    26968    2      IF M$ARC_FILE$->F$DCB.FCD#

  26968 24 007756   004534 470400 2                  LDP0    M$ARC_FILE$
        24 007757   000031 236100                    LDQ     25,,PR0
        24 007760   020000 316007                    CANQ    8192,DL
        24 007761   007772 600000 24                 TZE     s:26976
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:360  

     2876    26969    3       THEN DO;

     2877    26970    3         CALL M$CLOSE( CLOSE_ARC_FILE )

  26970 24 007762   005146 630400 2                  EPPR0   CLOSE_ARC_FILE
        24 007763   450001 713400                    CLIMB   alt,close
        24 007764   406000 401760                    pmme    nvectors=13
        24 007765   007767 702000 24                 TSX2    s:26972
        24 007766   007772 710000 24                 TRA     s:26976

     2878    26971    4          WHENALTRETURN DO;

     2879    26972    4            CALL FLI$RPT_ERR;

  26972 24 007767   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 007770   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 007771   000000 011000                    NOP     0

     2880    26973    4            END;

     2881    26974    3         END;

     2882    26975
     2883    26976    2      ALTRETURN;

  26976 24 007772   200012 221300                    LDX1  ! CONTROLLED_SOURCE+3,,AUTO
        24 007773   000000 702211                    TSX2  ! 0,X1

     2884    26977
     2885    26978    2   END FLX_OUTPUT_SUMMARY;
     2886    26979        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:361  
     2887    26980    1   FLX_ARC_LIST_ERROR_REPORT: PROC;

  26980 24 007774   200032 741300       FLX_ARC_LIS* STX1  ! FORCE_NEW_OUT_BLK,,AUTO

     2888    26981        /*F*  NAME: FLX_ARC_LIST_ERROR_REPORT
     2889    26982              PURPOSE: Print names of archived disk files not on new tapes/optical disks.
     2890    26983        */
     2891    26984
     2892    26985         /***
     2893    26986          *** CONSTANT
     2894    26987          ***/
     2895    26988
     2896    26989    2  DCL TITLE_LINE CHAR(0) CONSTANT INIT('Archived disk files not found on old tapes:');
     2897    26990    2   DCL TITLE_LINE_OD CHAR(0) CONSTANT INIT(
             26990            'Archived disk files not found on old optical disks:');
     2898    26991
     2899    26992         /***
     2900    26993          *** FPT
     2901    26994          ***/
     2902    26995
     2903    26996        %FPT_WRITE( FPTN=WRITE_LINE,
     2904    26997                    DCB=M$LO,
     2905    26998                    STCLASS=STATIC );
     2906    27029
     2907    27030        /****************************************/
     2908    27031
     2909    27032    2      CALL M$OPEN( OPEN_ARC_LIST ) ALTRET( RPT_ERR_CLOSE );

  27032 24 007775   000054 630400 23                 EPPR0   OPEN_ARC_LIST
        24 007776   450000 713400                    CLIMB   alt,open
        24 007777   410400 401760                    pmme    nvectors=18
        24 010000   010123 702000 24                 TSX2    RPT_ERR_CLOSE

     2910    27033
     2911    27034    2      IF OD_SOURCE

  27034 24 010001   200005 234100                    SZN     OD_SOURCE,,AUTO
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:362  
        24 010002   010006 605000 24                 TPL     s:27036

     2912    27035    2       THEN WRITE_LINE.BUF_ = VECTOR(TITLE_LINE_OD);

  27035 24 010003   000236 237000 25                 LDAQ    158
        24 010004   006336 757000 2                  STAQ    WRITE_LINE+4
        24 010005   010010 710000 24                 TRA     s:27037

     2913    27036    2       ELSE WRITE_LINE.BUF_ = VECTOR(TITLE_LINE);

  27036 24 010006   000240 237000 25                 LDAQ    160
        24 010007   006336 757000 2                  STAQ    WRITE_LINE+4

     2914    27037    2      CALL FLP$WR_FILE_INFO ALTRET( ERR_CLOSE );

  27037 24 010010   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 010011   000000 701000 xent               TSX1    FLP$WR_FILE_INFO
        24 010012   010126 702000 24                 TSX2    ERR_CLOSE

     2915    27038    2      CLOSE_ARC_FILE.V.EFTOPER = '0'B;

  27038 24 010013   000166 236000 25                 LDQ     118
        24 010014   005200 356000 2                  ANSQ    CLOSE_ARC_FILE+26

     2916    27039    2      CALL M$WRITE( WRITE_LINE) ALTRET( RPT_ERR_CLOSE );

  27039 24 010015   006332 630400 2                  EPPR0   WRITE_LINE
        24 010016   440001 713400                    CLIMB   alt,write
        24 010017   401400 401760                    pmme    nvectors=4
        24 010020   010123 702000 24                 TSX2    RPT_ERR_CLOSE

     2917    27040
     2918    27041    3      DO WHILE('1'B);

     2919    27042
     2920    27043    3         CALL M$READ( READ_ARC_LIST )

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:363  
  27043 24 010021   000200 630400 23                 EPPR0   READ_ARC_LIST
        24 010022   440000 713400                    CLIMB   alt,read
        24 010023   401400 401760                    pmme    nvectors=4
        24 010024   010077 702000 24                 TSX2    s:27063

     2921    27044    4          WHENRETURN DO;

     2922    27045    4            IF ARC_LIST_REC.NBR_ON_TAPE = 0

  27045 24 010025   003162 235000 2                  LDA     ARC_LIST_REC+4
        24 010026   010076 601000 24                 TNZ     s:27061

     2923    27046    5             THEN DO;

     2924    27047    5               ARC_FILE_NAME.NAME# = ARC_LIST_KEY.C.FNAMEC;

  27047 24 010027   040000 100400                    MLR     fill='040'O
        24 010030   000225 600037 2                  ADSC9   ARC_LIST_KEY+3           cn=3,n=31
        24 010031   005130 200037 2                  ADSC9   ARC_FILE_NAME            cn=1,n=31

     2925    27048    5               ARC_FILE_NAME.L# = ARC_LIST_KEY.C.FNAMEL;

  27048 24 010032   000235 236000 2                  LDQ     ARC_LIST_KEY+11
        24 010033   000022 736000                    QLS     18
        24 010034   005130 552040 2                  STBQ    ARC_FILE_NAME,'40'O

     2926    27049    5               ARC_FILE_ACCT.ACCT# = ARC_LIST_KEY.C.ACCT;

  27049 24 010035   040000 100400                    MLR     fill='040'O
        24 010036   000223 600010 2                  ADSC9   ARC_LIST_KEY+1           cn=3,n=8
        24 010037   005140 000010 2                  ADSC9   ARC_FILE_ACCT            cn=0,n=8

     2927    27050    5               ARC_FILE_SN.SN#(0) = ARC_LIST_KEY.C.PSN;

  27050 24 010040   040000 100400                    MLR     fill='040'O
        24 010041   000222 200006 2                  ADSC9   ARC_LIST_KEY             cn=1,n=6
        24 010042   005143 000006 2                  ADSC9   ARC_FILE_SN+1            cn=0,n=6
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:364  

     2928    27051    5               CALL M$OPEN( OPEN_ARC_FILE ) /* Should use TEST open              */

  27051 24 010043   005036 630400 2                  EPPR0   OPEN_ARC_FILE
        24 010044   450000 713400                    CLIMB   alt,open
        24 010045   410400 401760                    pmme    nvectors=18
        24 010046   010073 702000 24                 TSX2    s:27058

     2929    27052    6                WHENRETURN DO;

     2930    27053    6                  CALL FLP$WR_FILE_INFO( M$ARC_FILE$, FPARAM_.PTR$, '      ', 0,

  27053 24 010047   000071 236000 25                 LDQ     57
        24 010050   200100 756100                    STQ     NEW_FSN+11,,AUTO
        24 010051   000172 237000 25                 LDAQ    122
        24 010052   200076 757100                    STAQ    NEW_FSN+9,,AUTO
        24 010053   000001 236000 xsym               LDQ     B_VECTNIL+1
        24 010054   000174 235000 25                 LDA     124
        24 010055   200074 757100                    STAQ    NEW_FSN+7,,AUTO
        24 010056   000242 237000 25                 LDAQ    162
        24 010057   200072 757100                    STAQ    NEW_FSN+5,,AUTO
        24 010060   000200 237000 25                 LDAQ    128
        24 010061   200070 757100                    STAQ    NEW_FSN+3,,AUTO
        24 010062   200070 630500                    EPPR0   NEW_FSN+3,,AUTO
        24 010063   000132 631400 25                 EPPR1   90
        24 010064   000000 701000 xent               TSX1    FLP$WR_FILE_INFO
        24 010065   010126 702000 24                 TSX2    ERR_CLOSE

     2931    27054    6                    ' ', , 0, '1'B, '0'B ) ALTRET( ERR_CLOSE );
     2932    27055    6                  CALL M$CLOSE( CLOSE_ARC_FILE ) ALTRET( RPT_ERR_CLOSE );

  27055 24 010066   005146 630400 2                  EPPR0   CLOSE_ARC_FILE
        24 010067   450001 713400                    CLIMB   alt,close
        24 010070   406000 401760                    pmme    nvectors=13
        24 010071   010123 702000 24                 TSX2    RPT_ERR_CLOSE

     2933    27056    6                  END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:365  

  27056 24 010072   010076 710000 24                 TRA     s:27061

     2934    27057    6                WHENALTRETURN DO;

     2935    27058    6                  CALL FLI$RPT_ERR;

  27058 24 010073   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 010074   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 010075   000000 011000                    NOP     0

     2936    27059    6                  END;

     2937    27060    5               END;

     2938    27061    4            END;

  27061 24 010076   010122 710000 24                 TRA     s:27071

     2939    27062    4          WHENALTRETURN DO;

     2940    27063    4            IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOF

  27063 24 010077   000000 470400 xsym               LDP0    B$TCB$
        24 010100   000000 471500                    LDP1    0,,PR0
        24 010101   100102 236100                    LDQ     66,,PR1
        24 010102   377770 376007                    ANQ     131064,DL
        24 010103   000060 116007                    CMPQ    48,DL
        24 010104   010110 600000 24                 TZE     s:27065

     2941    27064    4             THEN CALL FLI$RPT_ERR;

  27064 24 010105   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 010106   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 010107   000000 011000                    NOP     0

     2942    27065    4            CALL M$CLOSE ( CLOSE_ARC_LIST )
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:366  

  27065 24 010110   000016 630400 23                 EPPR0   CLOSE_ARC_LIST
        24 010111   450001 713400                    CLIMB   alt,close
        24 010112   406000 401760                    pmme    nvectors=13
        24 010113   010115 702000 24                 TSX2    s:27067
        24 010114   010120 710000 24                 TRA     s:27069

     2943    27066    5             WHENALTRETURN DO;

     2944    27067    5               CALL FLI$RPT_ERR;

  27067 24 010115   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 010116   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 010117   000000 011000                    NOP     0

     2945    27068    5               END;

     2946    27069    4            RETURN;

  27069 24 010120   200032 221300                    LDX1  ! FORCE_NEW_OUT_BLK,,AUTO
        24 010121   000001 702211                    TSX2  ! 1,X1

     2947    27070    4            END;
     2948    27071    3         END;

  27071 24 010122   010021 710000 24                 TRA     s:27043

  27070 24 010123                       RPT_ERR_CLO* null
     2949    27072
     2950    27073    2   RPT_ERR_CLOSE: ;
     2951    27074    2      CALL FLI$RPT_ERR;

  27074 24 010123   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 010124   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 010125   000000 011000                    NOP     0

  27070 24 010126                       ERR_CLOSE    null
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:367  
     2952    27075
     2953    27076    2   ERR_CLOSE: ;
     2954    27077    2      IF M$ARC_LIST$->F$DCB.FCD#

  27077 24 010126   004536 470400 2                  LDP0    M$ARC_LIST$
        24 010127   000031 236100                    LDQ     25,,PR0
        24 010130   020000 316007                    CANQ    8192,DL
        24 010131   010142 600000 24                 TZE     s:27085

     2955    27078    3       THEN DO;

     2956    27079    3         CALL M$CLOSE( CLOSE_ARC_LIST )

  27079 24 010132   000016 630400 23                 EPPR0   CLOSE_ARC_LIST
        24 010133   450001 713400                    CLIMB   alt,close
        24 010134   406000 401760                    pmme    nvectors=13
        24 010135   010137 702000 24                 TSX2    s:27081
        24 010136   010142 710000 24                 TRA     s:27085

     2957    27080    4          WHENALTRETURN DO;

     2958    27081    4            CALL FLI$RPT_ERR;

  27081 24 010137   000002 631400 xsym               EPPR1   B_VECTNIL+2
        24 010140   000000 701000 xent               TSX1    FLI$RPT_ERR
        24 010141   000000 011000                    NOP     0

     2959    27082    4            END;

     2960    27083    3         END;

     2961    27084
     2962    27085    2      RETURN;

  27085 24 010142   200032 221300                    LDX1  ! FORCE_NEW_OUT_BLK,,AUTO
        24 010143   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:368  
     2963    27086
     2964    27087    2   END FLX_ARC_LIST_ERROR_REPORT;
     2965    27088        %EJECT;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:369  
     2966    27089    1   FLX_ACC_LINE: PROC( TITLE, NUMBER, COLUMN, DONE ) ALTRET;

  27089 24 010144   200032 741300       FLX_ACC_LINE STX1  ! FORCE_NEW_OUT_BLK,,AUTO

     2967    27090        /*F*  NAME: FLX_ACC_LINE
     2968    27091              PURPOSE: Account for files found, not found, etc.
     2969    27092        */
     2970    27093
     2971    27094    2   DCL TITLE CHAR(70);                     /* Title of line                      */
     2972    27095    2   DCL NUMBER SBIN;                        /* Number to put on line              */
     2973    27096    2   DCL COLUMN SBIN;                        /* Number of column to use            */
     2974    27097    2   DCL DONE BIT(1) ALIGNED;                /* Indicates end of accounting        */
     2975    27098
     2976    27099
     2977    27100         /***
     2978    27101          *** STATIC
     2979    27102          ***/
     2980    27103
     2981    27104    2   DCL LAST_COLUMN SBIN STATIC;
     2982    27105    2   DCL 1 ACC_LINE STATIC,
     2983    27106    2         2 VFC CHAR(1),
     2984    27107    2         2 TITLE CHAR(35) INIT(' '),
     2985    27108    2         2 COLUMN(0:4),
     2986    27109    2           3 * CHAR(2) INIT('  '*5),
     2987    27110    2           3 NUMBER CHAR(5) INIT(' '*5);
     2988    27111    2   DCL 1 TITLE_LINE REDEF ACC_LINE,
     2989    27112    2         2 VFC CHAR(1),
     2990    27113    2         2 TITLE CHAR(70);
     2991    27114    2   DCL TEXT_NUMBER CHAR(5) STATIC;
     2992    27115    2   DCL N SBIN STATIC;
     2993    27116    2   DCL TRUOVRPRT BIT(1) STATIC;
     2994    27117
     2995    27118         /***
     2996    27119          *** FPT
     2997    27120          ***/
     2998    27121
     2999    27122        %FPT_WRITE( FPTN=WRITE_ACC_LINE,
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:370  
     3000    27123                    DCB=M$LO,
     3001    27124                    BUF=ACC_LINE,
     3002    27125                    VFC=YES,
     3003    27126                    STCLASS=CONSTANT );
     3004    27157
     3005    27158         /***
     3006    27159          *** CONSTANT
     3007    27160          ***/
     3008    27161
     3009    27162    2   DCL NO_4_LEADING_ZEROS(0:2) BIT(9) CONSTANT CALIGNED
     3010    27163    2     INIT( %MVZB4, %SES10, %MVC1 );
     3011    27164    2   DCL DASHES CHAR(70) CONSTANT
     3012    27165    2     INIT('----------------------------------------------------------------------');
     3013    27166
     3014    27167         /***
     3015    27168          *** BASED
     3016    27169          ***/
     3017    27170
     3018    27171    2   DCL NCHARS CHAR(N) BASED CALIGNED;
     3019    27172
     3020    27173        /****************************************/
     3021    27174
     3022    27175    2      IF ADDR(NUMBER) = ADDR(NIL)

  27175 24 010145   200034 236100                    LDQ     @NUMBER,,AUTO
        24 010146   000001 116000 xsym               CMPQ    B_VECTNIL+1
        24 010147   010234 601000 24                 TNZ     s:27199

     3023    27176    3       THEN DO;                            /* Initialization call                */

     3024    27177    3         CALL INDEX( N, '!', TITLE );

  27177 24 010150   200033 470500                    LDP0    @TITLE,,AUTO
        24 010151   000000 124500                    SCM     mask='000'O
        24 010152   000000 000106                    ADSC9   0,,PR0                   cn=0,n=70
        24 010153   000244 000001 25                 ADSC9   164                      cn=0,n=1
        24 010154   006373 000000 2                  ARG     N
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:371  

     3025    27178    3         TITLE_LINE.TITLE = ADDR(TITLE)->NCHARS;

  27178 24 010155   006373 720000 2                  LXL0    N
        24 010156   040000 100540                    MLR     fill='040'O
        24 010157   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
        24 010160   006347 200106 2                  ADSC9   ACC_LINE                 cn=1,n=70

     3026    27179    3         TITLE_LINE.VFC = 'b';

  27179 24 010161   142000 236003                    LDQ     50176,DU
        24 010162   006347 552040 2                  STBQ    ACC_LINE,'40'O

     3027    27180    3         CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );

  27180 24 010163   000712 630400 23                 EPPR0   WRITE_ACC_LINE
        24 010164   440001 713400                    CLIMB   alt,write
        24 010165   401400 401760                    pmme    nvectors=4
        24 010166   010425 702000 24                 TSX2    JUSTALT

     3028    27181    3         TRUOVRPRT = DCBADDR(DCBNUM(M$LO))->F$DCB.ATTR.TRUOVRPRT#;

  27181 24 010167   000000 236007 xsym               LDQ     M$LO,DL
        24 010170   000000 470400 25                 LDP0    0
        24 010171   000000 471500                    LDP1    0,,PR0
        24 010172   100000 473506                    LDP3    0,QL,PR1
        24 010173   300040 236100                    LDQ     32,,PR3
        24 010174   000040 736000                    QLS     32
        24 010175   400000 376003                    ANQ     -131072,DU
        24 010176   006374 756000 2                  STQ     TRUOVRPRT

     3029    27182    3         IF TRUOVRPRT

  27182 24 010177   006374 234000 2                  SZN     TRUOVRPRT
        24 010200   010212 605000 24                 TPL     s:27189

     3030    27183    4          THEN DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:372  

     3031    27184    4            TITLE_LINE.VFC = '`';

  27184 24 010201   140000 236003                    LDQ     49152,DU
        24 010202   006347 552040 2                  STBQ    ACC_LINE,'40'O

     3032    27185    4            CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );

  27185 24 010203   000712 630400 23                 EPPR0   WRITE_ACC_LINE
        24 010204   440001 713400                    CLIMB   alt,write
        24 010205   401400 401760                    pmme    nvectors=4
        24 010206   010425 702000 24                 TSX2    JUSTALT

     3033    27186    4            TITLE_LINE.VFC = 'B';

  27186 24 010207   102000 236003                    LDQ     33792,DU
        24 010210   006347 552040 2                  STBQ    ACC_LINE,'40'O

     3034    27187    4            END;

  27187 24 010211   010220 710000 24                 TRA     s:27192

     3035    27188    4          ELSE DO;

     3036    27189    4            TITLE_LINE.VFC = 'a';

  27189 24 010212   141000 236003                    LDQ     49664,DU
        24 010213   006347 552040 2                  STBQ    ACC_LINE,'40'O

     3037    27190    4            TITLE_LINE.TITLE = ADDR(DASHES)->NCHARS;

  27190 24 010214   006373 720000 2                  LXL0    N
        24 010215   040000 100440                    MLR     fill='040'O
        24 010216   000727 000010 23                 ADSC9   DASHES                   cn=0,n=*X0
        24 010217   006347 200106 2                  ADSC9   ACC_LINE                 cn=1,n=70

     3038    27191    4            END;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:373  

     3039    27192    3         CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );

  27192 24 010220   000712 630400 23                 EPPR0   WRITE_ACC_LINE
        24 010221   440001 713400                    CLIMB   alt,write
        24 010222   401400 401760                    pmme    nvectors=4
        24 010223   010425 702000 24                 TSX2    JUSTALT

     3040    27193    3         TITLE_LINE.TITLE = ' ';

  27193 24 010224   040000 100400                    MLR     fill='040'O
        24 010225   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 010226   006347 200106 2                  ADSC9   ACC_LINE                 cn=1,n=70

     3041    27194    3         ACC_LINE.VFC = 'a';

  27194 24 010227   141000 236003                    LDQ     49664,DU
        24 010230   006347 552040 2                  STBQ    ACC_LINE,'40'O

     3042    27195    3         LAST_COLUMN = 0;

  27195 24 010231   006346 450000 2                  STZ     LAST_COLUMN

     3043    27196    3         RETURN;

  27196 24 010232   200032 221300                    LDX1  ! FORCE_NEW_OUT_BLK,,AUTO
        24 010233   000001 702211                    TSX2  ! 1,X1

     3044    27197    3         END;
     3045    27198
     3046    27199    2      IF ADDR(COLUMN) ~= ADDR(NIL)

  27199 24 010234   200035 236100                    LDQ     @COLUMN,,AUTO
        24 010235   000001 116000 xsym               CMPQ    B_VECTNIL+1
        24 010236   010316 600000 24                 TZE     s:27222

     3047    27200    3       THEN DO;
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:374  

     3048    27201    3         IF LAST_COLUMN ~= 0

  27201 24 010237   006346 235000 2                  LDA     LAST_COLUMN
        24 010240   010300 600000 24                 TZE     s:27217

     3049    27202    4          THEN DO;

     3050    27203    4            IF LAST_COLUMN < COLUMN

  27203 24 010241   200035 470500                    LDP0    @COLUMN,,AUTO
        24 010242   006346 236000 2                  LDQ     LAST_COLUMN
        24 010243   000000 116100                    CMPQ    0,,PR0
        24 010244   010271 605000 24                 TPL     s:27214

     3051    27204    5             THEN DO;                      /* Summarization previous column      */

     3052    27205    5               ACC_LINE.TITLE = ' ';

  27205 24 010245   040000 100400                    MLR     fill='040'O
        24 010246   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 010247   006347 200043 2                  ADSC9   ACC_LINE                 cn=1,n=35

     3053    27206    5               IF TRUOVRPRT

  27206 24 010250   006374 234000 2                  SZN     TRUOVRPRT
        24 010251   010261 605000 24                 TPL     s:27211

     3054    27207    6                THEN DO;

     3055    27208    6                  ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = '______';

  27208 24 010252   000007 402007                    MPY     7,DL
        24 010253   040006 100400                    MLR     fill='040'O
        24 010254   001316 000005 23                 ADSC9   DASHES+247               cn=0,n=5
        24 010255   006356 600005 2                  ADSC9   ACC_LINE+7,Q             cn=3,n=5

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:375  
     3056    27209    6                  ACC_LINE.VFC = '`';

  27209 24 010256   140000 236003                    LDQ     49152,DU
        24 010257   006347 552040 2                  STBQ    ACC_LINE,'40'O

     3057    27210    6                  END;

  27210 24 010260   010265 710000 24                 TRA     s:27212

     3058    27211    5                ELSE ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = '------';

  27211 24 010261   000007 402007                    MPY     7,DL
        24 010262   040006 100400                    MLR     fill='040'O
        24 010263   001320 000005 23                 ADSC9   DASHES+249               cn=0,n=5
        24 010264   006356 600005 2                  ADSC9   ACC_LINE+7,Q             cn=3,n=5

     3059    27212    5               CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );

  27212 24 010265   000712 630400 23                 EPPR0   WRITE_ACC_LINE
        24 010266   440001 713400                    CLIMB   alt,write
        24 010267   401400 401760                    pmme    nvectors=4
        24 010270   010425 702000 24                 TSX2    JUSTALT

     3060    27213    5               END;

     3061    27214    4            ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = ' '; /* Leave column clean   */

  27214 24 010271   006346 236000 2                  LDQ     LAST_COLUMN
        24 010272   000007 402007                    MPY     7,DL
        24 010273   040006 100400                    MLR     fill='040'O
        24 010274   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 010275   006356 600005 2                  ADSC9   ACC_LINE+7,Q             cn=3,n=5

     3062    27215    4            ACC_LINE.VFC = 'a';

  27215 24 010276   141000 236003                    LDQ     49664,DU
        24 010277   006347 552040 2                  STBQ    ACC_LINE,'40'O
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:376  

     3063    27216    4            END;

     3064    27217    3         LAST_COLUMN = COLUMN;

  27217 24 010300   200035 470500                    LDP0    @COLUMN,,AUTO
        24 010301   000000 235100                    LDA     0,,PR0
        24 010302   006346 755000 2                  STA     LAST_COLUMN

     3065    27218    3         CALL BINCHAR( TEXT_NUMBER, NUMBER );

  27218 24 010303   200034 471500                    LDP1    @NUMBER,,AUTO
        24 010304   000000 301500                    BTD
        24 010305   100000 000004                    NDSC9   0,,PR1                   cn=0,s=lsgnf,sf=0,n=4
        24 010306   006371 030005 2                  NDSC9   TEXT_NUMBER              cn=0,s=nosgn,sf=0,n=5

     3066    27219    3         CALL EDITCHAR( ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1), , , NO_4_LEADING_ZEROS,
             27219                  TEXT_NUMBER );

  27219 24 010307   006346 236000 2                  LDQ     LAST_COLUMN
        24 010310   000007 402007                    MPY     7,DL
        24 010311   006000 024400                    MVNE
        24 010312   006371 030005 2                  NDSC9   TEXT_NUMBER              cn=0,s=nosgn,sf=0,n=5
        24 010313   000726 000003 23                 ADSC9   NO_4_LEADING_ZEROS       cn=0,n=3
        24 010314   006356 600005 2                  ADSC9   ACC_LINE+7,Q             cn=3,n=5

     3067    27220    3         END;

  27220 24 010315   010327 710000 24                 TRA     s:27226

     3068    27221    3       ELSE DO;

     3069    27222    3         ACC_LINE.VFC = 'b';

  27222 24 010316   142000 236003                    LDQ     50176,DU
        24 010317   006347 552040 2                  STBQ    ACC_LINE,'40'O

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:377  
     3070    27223    3         IF LAST_COLUMN > 0

  27223 24 010320   006346 235000 2                  LDA     LAST_COLUMN
        24 010321   010327 604400 24                 TMOZ    s:27226

     3071    27224    3          THEN ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = ' ';

  27224 24 010322   006346 236000 2                  LDQ     LAST_COLUMN
        24 010323   000007 402007                    MPY     7,DL
        24 010324   040006 100400                    MLR     fill='040'O
        24 010325   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 010326   006356 600005 2                  ADSC9   ACC_LINE+7,Q             cn=3,n=5

     3072    27225    3         END;

     3073    27226    2      CALL INDEX( N, '!', TITLE );

  27226 24 010327   200033 470500                    LDP0    @TITLE,,AUTO
        24 010330   000000 124500                    SCM     mask='000'O
        24 010331   000000 000106                    ADSC9   0,,PR0                   cn=0,n=70
        24 010332   000244 000001 25                 ADSC9   164                      cn=0,n=1
        24 010333   006373 000000 2                  ARG     N

     3074    27227    2      ACC_LINE.TITLE = ADDR(TITLE)->NCHARS;

  27227 24 010334   006373 720000 2                  LXL0    N
        24 010335   040000 100540                    MLR     fill='040'O
        24 010336   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
        24 010337   006347 200043 2                  ADSC9   ACC_LINE                 cn=1,n=35

     3075    27228    2      CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );

  27228 24 010340   000712 630400 23                 EPPR0   WRITE_ACC_LINE
        24 010341   440001 713400                    CLIMB   alt,write
        24 010342   401400 401760                    pmme    nvectors=4
        24 010343   010425 702000 24                 TSX2    JUSTALT

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:378  
     3076    27229
     3077    27230    2      IF ADDR(DONE) ~= ADDR(NIL)

  27230 24 010344   200036 236100                    LDQ     @DONE,,AUTO
        24 010345   000001 116000 xsym               CMPQ    B_VECTNIL+1
        24 010346   010423 600000 24                 TZE     s:27248

     3078    27231    3       THEN DO;                            /* Done with summary                  */

     3079    27232    3         ACC_LINE.TITLE = ' ';

  27232 24 010347   040000 100400                    MLR     fill='040'O
        24 010350   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 010351   006347 200043 2                  ADSC9   ACC_LINE                 cn=1,n=35

     3080    27233    3         IF TRUOVRPRT

  27233 24 010352   006374 234000 2                  SZN     TRUOVRPRT
        24 010353   010364 605000 24                 TPL     s:27238

     3081    27234    4          THEN DO;

     3082    27235    4            ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = '______';

  27235 24 010354   006346 236000 2                  LDQ     LAST_COLUMN
        24 010355   000007 402007                    MPY     7,DL
        24 010356   040006 100400                    MLR     fill='040'O
        24 010357   001316 000005 23                 ADSC9   DASHES+247               cn=0,n=5
        24 010360   006356 600005 2                  ADSC9   ACC_LINE+7,Q             cn=3,n=5

     3083    27236    4            ACC_LINE.VFC = '`';            /* Space no lines, print              */

  27236 24 010361   140000 236003                    LDQ     49152,DU
        24 010362   006347 552040 2                  STBQ    ACC_LINE,'40'O

     3084    27237    4            END;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:379  
  27237 24 010363   010371 710000 24                 TRA     s:27239

     3085    27238    3          ELSE ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = '------';

  27238 24 010364   006346 236000 2                  LDQ     LAST_COLUMN
        24 010365   000007 402007                    MPY     7,DL
        24 010366   040006 100400                    MLR     fill='040'O
        24 010367   001320 000005 23                 ADSC9   DASHES+249               cn=0,n=5
        24 010370   006356 600005 2                  ADSC9   ACC_LINE+7,Q             cn=3,n=5

     3086    27239    3         CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );

  27239 24 010371   000712 630400 23                 EPPR0   WRITE_ACC_LINE
        24 010372   440001 713400                    CLIMB   alt,write
        24 010373   401400 401760                    pmme    nvectors=4
        24 010374   010425 702000 24                 TSX2    JUSTALT

     3087    27240    3         ACC_LINE.VFC = 'a';

  27240 24 010375   141000 236003                    LDQ     49664,DU
        24 010376   006347 552040 2                  STBQ    ACC_LINE,'40'O

     3088    27241    3         ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = '------';

  27241 24 010377   006346 236000 2                  LDQ     LAST_COLUMN
        24 010400   000007 402007                    MPY     7,DL
        24 010401   040006 100400                    MLR     fill='040'O
        24 010402   001320 000005 23                 ADSC9   DASHES+249               cn=0,n=5
        24 010403   006356 600005 2                  ADSC9   ACC_LINE+7,Q             cn=3,n=5

     3089    27242    3         CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );

  27242 24 010404   000712 630400 23                 EPPR0   WRITE_ACC_LINE
        24 010405   440001 713400                    CLIMB   alt,write
        24 010406   401400 401760                    pmme    nvectors=4
        24 010407   010425 702000 24                 TSX2    JUSTALT

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:380  
     3090    27243    3         ACC_LINE.VFC = 'A';               /* Put in "normal" print/space mode   */

  27243 24 010410   101000 236003                    LDQ     33280,DU
        24 010411   006347 552040 2                  STBQ    ACC_LINE,'40'O

     3091    27244    3         ACC_LINE.COLUMN.NUMBER(LAST_COLUMN-1) = ' ';

  27244 24 010412   006346 236000 2                  LDQ     LAST_COLUMN
        24 010413   000007 402007                    MPY     7,DL
        24 010414   040006 100400                    MLR     fill='040'O
        24 010415   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        24 010416   006356 600005 2                  ADSC9   ACC_LINE+7,Q             cn=3,n=5

     3092    27245    3         CALL M$WRITE( WRITE_ACC_LINE ) ALTRET( JUSTALT );

  27245 24 010417   000712 630400 23                 EPPR0   WRITE_ACC_LINE
        24 010420   440001 713400                    CLIMB   alt,write
        24 010421   401400 401760                    pmme    nvectors=4
        24 010422   010425 702000 24                 TSX2    JUSTALT

     3093    27246    3         END;

     3094    27247
     3095    27248    2      RETURN;

  27248 24 010423   200032 221300                    LDX1  ! FORCE_NEW_OUT_BLK,,AUTO
        24 010424   000001 702211                    TSX2  ! 1,X1

  27243 24 010425                       JUSTALT      null
     3096    27249
     3097    27250    2   JUSTALT: ;
     3098    27251    2      ALTRETURN;

  27251 24 010425   200032 221300                    LDX1  ! FORCE_NEW_OUT_BLK,,AUTO
        24 010426   000000 702211                    TSX2  ! 0,X1

     3099    27252
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:381  
     3100    27253    2   END FLX_ACC_LINE;
     3101    27254
     3102    27255    1   END FLX$ARCOM;

  27255 24 010427   000000 702200 xent               TSX2  ! X66_MARET
     3103    27256        %EOD;

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:382  
--  Include file information  --

   XUR_ENTRY.:E05TOU  cannot be made into a system file and is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   FLW_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FLS_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FLN_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FL_PERR_C.:E05TOU  is referenced.
   FLE_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   FM$FIT.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FLX$ARCOM.
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:383  

 **** Variables and constants ****

  ****  Section 002  Data  FLX$ARCOM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  6347-0-0/c STRC(639)   r     1 ACC_LINE                4734-0-0/w STRC(504)   r     1 ARCOM_CMD_PCB
  5140-0-0/c STRC(72)    r     1 ARC_FILE_ACCT           5130-0-0/c STRC(288)   r     1 ARC_FILE_NAME
  5142-0-0/d STRC(90)    r     1 ARC_FILE_SN              222-0-0/w STRC(423)   r     1 ARC_LIST_KEY
  6274-0-0/w STRC(423)   r     1 ARC_LIST_KEY            3156-0-0/w STRC(189)   r     1 ARC_LIST_REC
  6266-0-0/w STRC(189)   r     1 ARC_LIST_REC             167-0-0/w PTR         r     1 ARC_REC$
   166-0-0/w SBIN        r     1 ARC_REC_SIZE             165-0-0/w PTR         r     1 ARC_SET$
   164-0-0/b BIT         r     1 BREAK_CONTINUED          154-0-0/w SBIN        r     1 BREAK_COUNT
   155-0-0/w PTR         r     1 BREAK_DCB$               156-0-0/c CHAR(18)    r     1 BREAK_TASK
  5146-0-0/d STRC(1080)  r     1 CLOSE_ARC_FILE           100-0-0/d STRC(1080)  r     1 CLOSE_BLOCK_FILE
  5716-0-0/d STRC(1080)  r     1 CLOSE_EFT_ERRORS        5610-0-0/d STRC(1080)  r     1 CLOSE_FSN_LIST
  4676-0-0/d STRC(1080)  r     1 CLOSE_TAPE_SOURCE        170-0-0/w SBIN        r     1 CODE
   220-0-0/w PTR         r     1 CODE06$                 5652-0-0/d STRC(360)   r     1 DELREC_FSN_LIST
  6232-0-0/d STRC(360)   r     1 DEL_ARC_LIST_BY_KEY      142-0-0/d STRC(360)   r     1 DEL_NODATA_REC
  5460-0-0/d STRC(90)    r     1 DPSN                     171-0-0/w STRC        r     1 ERR
   221-0-0/b BIT         r     1 ERROR_FLAG              6007-0-0/w PTR         r     1 ERROR_SET$
   216-0-0/d STRC(72)    r     1 FPARAM_                 4565-0-0/w PTR         r     1 FROM_SN_LIST$
  5770-0-0/c STRC(513)   r     1 GETTING_SET             5316-0-0/d STRC(288)   r     1 GET_PSN
   206-0-0/c STRC(153)   r     1 GREETINGS               5702-0-0/d STRC(432)   r     1 GREET_USER
   205-0-0/w SBIN        r     1 I                        214-0-0/d STRC(72)    r     1 INBUF_
  6204-0-0/c STRC(72)    r     1 INITIAL_ACCT            6174-0-0/c STRC(288)   r     1 INITIAL_NAME
  4542-0-0/w PTR         r     1 IN_BLK_TAG$             4544-0-0/w PTR         r     1 IN_BLK_TAG0$
  4546-0-0/w SBIN        r     1 IN_BLK_TAG_IX           4551-0-0/w SBIN        r     1 IN_BLK_TAG_IX_MAX
  4552-0-0/w PTR         r     1 IN_GRAN$                4557-0-0/w PTR         r     1 IN_GRAN_BASE$
  4554-0-0/w PTR         r     1 IN_GRAN_MAX$            4555-0-0/w PTR         r     1 IN_GRAN_MAX_CHK$
  6244-0-0/w STRC(423)   r     1 LAST_BLK_ARC_LIST_KEY
  6260-0-0/w STRC(189)   r     1 LAST_BLK_ARC_LIST_REC
  6346-0-0/w SBIN        r     1 LAST_COLUMN             4534-0-0/w PTR         r     1 M$ARC_FILE$
  4536-0-0/w PTR         r     1 M$ARC_LIST$             4537-0-0/w PTR         r     1 M$ARC_LIST2$
  4541-0-0/w PTR         r     1 M$EFT_ERRORS$           4540-0-0/w PTR         r     1 M$FSN_LIST$
  4535-0-0/w PTR         r     1 M$TAPE_SOURCE$          6373-0-0/w SBIN        r     1 N
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:384  
   204-0-0/w SBIN        r     1 NBRFAS
   203-0-0/w SBIN        r     1 NBRFAS_FOUND_UNUPDATED
   202-0-0/w SBIN        r     1 NBRFAS_FOUND_UPDATED     201-0-0/w SBIN        r     1 NBR_DPS
  6326-0-0/d STRC(90)    r     1 NEW_TAPE_SN              171-0-0/w PTR         r     1 NODE$
  5765-0-0/c STRC(108)   r     1 ODSN_LINE               4564-0-0/w PTR         r     1 OMIT_SN_LIST$
  5334-0-0/d STRC(2088)  r     1 OPEN_ARCHIVE_EFT        5036-0-0/d STRC(2088)  r     1 OPEN_ARC_FILE
  6102-0-0/d STRC(2088)  r     1 OPEN_ARC_LIST              6-0-0/d STRC(2088)  r     1 OPEN_BLOCK_FILE
  5464-0-0/d STRC(2088)  r     1 OPEN_FSN_LIST           5220-0-0/d STRC(2088)  r     1 OPEN_LO_DO
  6010-0-0/d STRC(2088)  r     1 OPEN_NEXT_ARC_FILE      4566-0-0/d STRC(2088)  r     1 OPEN_TAPE_SOURCE
  5326-0-0/c STRC(72)    r     1 OUR_ACCT                 200-0-0/w SBIN        r     1 OUT_BLK_SIZE
  4543-0-0/w PTR         r     1 OUT_BLK_TAG$            4545-0-0/w PTR         r     1 OUT_BLK_TAG0$
  4547-0-0/w SBIN        r     1 OUT_BLK_TAG_IX          4553-0-0/w PTR         r     1 OUT_GRAN$
  4550-0-0/w SBIN        r     1 OUT_GRANX               4560-0-0/w PTR         r     1 OUT_GRAN_BASE$
  4556-0-0/w PTR         r     1 OUT_GRAN_MAX$           5204-0-0/d STRC(360)   r     1 PAGE_LO
  5216-0-0/w STRC(54)    r     1 PAGE_LO_HEADER          5646-0-0/d STRC(144)   r     1 PFIL_FSN_LIST
  5664-0-0/d STRC(360)   r     1 PRECORD_FSN_LIST
  1606-0-0/w STRC(423)   r     1 PREV_BLK_ARC_LIST_KEY(0:61)
  3750-0-0/w STRC(189)   r     1 PREV_BLK_ARC_LIST_REC(0:61)
  4561-0-0/c CHAR(6)     r     1 PREV_REEL               5757-0-0/c STRC(108)   r     1 PSN_LINE
  5754-0-0/c STRC(90)    r     1 PSN_TITLE               5426-0-0/d STRC(504)   r     1 READ_ARCHIVE_EFT
  6310-0-0/d STRC(504)   r     1 READ_ARC_LIST_FSN       5556-0-0/d STRC(504)   r     1 READ_FSN_LIST
  4660-0-0/d STRC(504)   r     1 READ_TAPE_SOURCE        5330-0-0/d STRC(144)   r     1 REM_LT
   174-0-0/b BIT         r     1 SELECTED                4563-0-0/w UBIN        r     1 STEPCC
   172-0-0/w PTR         r     1 SUBNODE$                 173-0-0/w SBIN        r     1 SUBNODEX
  5676-0-0/d STRC(144)   r     1 SWITCH_FMSEC             177-0-0/w PTR         r     1 TAPE_SET$
   175-0-0/w SBIN        r     1 TEMP                     176-0-0/w PTR         r     1 TEMP$
  6371-0-0/c CHAR(5)     r     1 TEXT_NUMBER
   236-0-0/w STRC(423)   r     1 THIS_BLK_ARC_LIST_KEY(0:61)
  3164-0-0/w STRC(189)   r     1 THIS_BLK_ARC_LIST_REC(0:61)
  6347-0-0/c STRC(639)   r     1 TITLE_LINE              6374-0-0/b BIT         r     1 TRUOVRPRT
  5762-0-0/c STRC(108)   r     1 TSN_LINE                6222-0-0/c STRC(288)   r     1 VLP_NAME
  5444-0-0/d STRC(432)   r     1 WRITE_ARCHIVE_EFT
  5022-0-0/d STRC(432)   r     1 WRITE_ARC_LIST_BY_KEY
  5574-0-0/d STRC(432)   r     1 WRITE_FSN_LIST          6332-0-0/d STRC(432)   r     1 WRITE_LINE
  6206-0-0/d STRC(432)   r     1 WRITE_LO                4752-0-0/d STRC(1404)  r     1 XUR_INIT
  5312-0-0/d STRC(90)    r     1 ZERO_SN_LIST

PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:385  
  ****  Section 023 RoData FLX$ARCOM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   254-0-0/c STRC(81)    r     1 ARCHIVE_$$EFT_NAME        12-0-0/c STRC(90)    r     1 ARC_LIST_NAME
   216-0-0/d STRC(1080)  r     1 CLOSE_ARCHIVE_EFT         16-0-0/d STRC(1080)  r     1 CLOSE_ARC_LIST
   624-0-0/d STRC(1080)  r     1 CLOSE_ARC_LIST_FSN       363-0-0/c CHAR(53)    r     1 COULDNT_OMIT
   473-0-0/c CHAR(61)    r     1 COULDNT_OMIT_OD          727-0-0/c CHAR(70)    r     1 DASHES
   257-0-0/c STRC(72)    r     1 EFT_ACCT                   0-0-0/c STRC(162)   r     1 FLERRMSGSYS
     6-0-0/d STRC(144)   r     1 FPT_INT                  261-0-0/c STRC(90)    r     1 FSN_LIST_NAME
   530-0-0/d VECT        r     1 NAME_                    305-0-0/c CHAR(65)    r     1 NOT_INCLUDE_ERR
   424-0-0/c CHAR(73)    r     1 NOT_INCLUDE_ERR_OD       264-0-0/c CHAR(66)    r     1 NOT_INCLUDE_NOTE
   401-0-0/c CHAR(74)    r     1 NOT_INCLUDE_NOTE_OD
   726-0-0/c BIT (9)     r     1 NO_4_LEADING_ZEROS(0:2)
   447-0-0/c CHAR(79)    r     1 NO_SOURCE_ODS            341-0-0/c CHAR(71)    r     1 NO_SOURCE_TAPES
    54-0-0/d STRC(2088)  r     1 OPEN_ARC_LIST            532-0-0/d STRC(2088)  r     1 OPEN_ARC_LIST_FSN
   326-0-0/c CHAR(41)    r     1 PSN_TO_BE_PROCESSED      200-0-0/d STRC(504)   r     1 READ_ARC_LIST
   146-0-0/d STRC(504)   r     1 READ_ARC_LIST_BY_KEY     662-0-0/c CHAR(43)    r     1 TITLE_LINE
   675-0-0/c CHAR(51)    r     1 TITLE_LINE_OD            712-0-0/d STRC(432)   r     1 WRITE_ACC_LINE
   514-0-0/d STRC(432)   r     1 WRITE_ARC_LIST
   164-0-0/d STRC(432)   r     1 WRITE_ARC_LIST_BY_KEY_NEW

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    35-0-0/w PTR         r     1 @COLUMN                   36-0-0/w PTR         r     1 @DONE
    54-0-0/w PTR         r     1 @FILE_FIN                 53-0-0/w PTR         r     1 @FORCE
    47-0-0/w PTR         r     1 @GET_NXT_VOL              34-0-0/w PTR         r     1 @NUMBER
    33-0-0/w PTR         r     1 @TITLE                    51-0-0/c STRC(81)    r     1 ACCT_NAME
    62-0-0/w SBIN        r     1 ARS                       56-0-0/d BIT (72)    r     1 BUF_
    26-0-0/b BIT         r     1 COLLECT_SNS               *0-0-0/w SBIN        r     1 COLUMN
     7-0-0/b BIT         r     1 CONTROLLED_SOURCE         31-0-0/w SBIN        r     1 CTN
    21-0-0/w UBIN        r     1 DCB#                      *0-0-0/w BIT         r     1 DONE
    23-0-0/w SBIN        r     1 DPSIZE                    14-0-0/w SBIN        r     1 DPX
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:386  
    61-0-0/b BIT         r     1 EOVOL                     17-0-0/w STRC        r     1 ERR
    20-0-0/w STRC        r     1 ERR_SAVE                  *0-0-0/w BIT         r     1 FILE_FIN
    27-0-0/w PTR         r     1 FIRST$                    40-0-0/b BIT         r     1 FIRST_SOURCE_FILE
    *0-0-0/w BIT         r     1 FORCE                     32-0-0/b BIT         r     1 FORCE_NEW_OUT_BLK
    24-0-0/b BIT         r     1 FOUND                     23-0-0/b BIT         r     1 FOUND_PACKED_FILE
    15-0-0/w SBIN        r     1 FSN                       43-0-0/b BIT         r     1 GET_NXT_VOL
    *0-0-0/w BIT         r     1 GET_NXT_VOL               60-0-0/w SBIN        r     1 I
    44-0-0/w SBIN        r     1 INPUT_FSN                 42-0-0/b BIT         r     1 IOERRORC
    25-0-0/w SBIN        r     1 MAX_NBR_SNS               13-0-0/w SBIN        r     1 NBRFAS
    14-0-0/w SBIN        r     1 NBRFAS_FOUND              15-0-0/w SBIN        r     1 NBRFAS_PACKSET
    16-0-0/w SBIN        r     1 NBRFAS_PACKSET_ACTIVE
    17-0-0/w SBIN        r     1 NBRFAS_PACKSET_INACTIVE
    15-0-0/w SBIN        r     1 NBRFAS_UNFOUND            16-0-0/w SBIN        r     1 NBRFOT
    20-0-0/w SBIN        r     1 NBRFOT_UNIQUE             21-0-0/w SBIN        r     1 NBRFOT_UNIQUE_FOUND
    22-0-0/w SBIN        r     1 NBRFOT_UNIQUE_UNFOUND
    17-0-0/w SBIN        r     1 NBRFOT_UNUNIQUE
    30-0-0/w SBIN        r     1 NBR_ARCH_FILES_TO_PROCESS
    33-0-0/w SBIN        r     1 NBR_IN_OUT_BLK            34-0-0/w SBIN        r     1 NBR_IN_PREV_OUT_BLK
    31-0-0/w SBIN        r     1 NBR_SUB_FILES             27-0-0/b BIT         r     1 NEW_BLOCK
    26-0-0/b BIT         r     1 NEW_FILE                  65-0-0/w UBIN        r     1 NEW_FSN
    63-0-0/c CHAR(6)     r     1 NEW_TSN                   47-0-0/w SBIN        r     1 NIX
    27-0-0/b BIT         r     1 NO_ARCHIVE_FILE           21-0-0/w SBIN        r     1 NSX
    *0-0-0/w SBIN        r     1 NUMBER                     6-0-0/b BIT         r     1 OD_DEST
     5-0-0/b BIT         r     1 OD_SOURCE                 37-0-0/b BIT         r     1 OPEN_BY_FSN
     3-0-0/b BIT         r     1 OPTION_CHECK               4-0-0/b BIT         r     1 OPTION_IOERRORC
    20-0-0/w SBIN        r     1 OSX                       24-0-0/b BIT         r     1 OUTPUT_TAPE_OPEN
    13-0-0/b BIT         r     1 PACKSET_END               22-0-0/b BIT         r     1 READING_TAPE_SOURCE
    35-0-0/b BIT         r     1 RPT_ERR                   30-0-0/w PTR         r     1 SECND$
    26-0-0/w SBIN        r     1 SIZE                      25-0-0/b BIT         r     1 SKIP_FILE
    22-0-0/c CHAR(6)     r     1 SN                        13-0-0/c CHAR(6)     r     1 SN
    24-0-0/w SBIN        r     1 SNSIZE                    41-0-0/b BIT         r     1 TEMP_FLG
    *0-0-0/c CHAR(70)    r     1 TITLE                     30-0-0/w PTR         r     1 TPTR$
    25-0-0/w SBIN        r     1 VOL#

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:387  
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ASTR(9)     r     1 ARCHIVE_NAME               0-0-0/w UBIN        r     1 ARCOM_CMD
     0-0-0/b STRC        r     1 ARCOM_OPTIONS              0-0-0/d VECT        r     1 A_FIT_
     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c ASTR(9)     r     1 BACKUP_NAME                0-0-0/w PTR         r     1 BLK_TAG$
     0-0-0/w PTR         r     1 BLK_TAG0$                  0-0-0/w PTR         r     1 BLOCK_GRAN$
     0-0-0/c CHAR        r     1 B_VERSION                  0-0-0/b BIT         r     1 CATALOG_ON
     0-0-0/b BIT         r     1 CATALOG_ONTO               0-0-0/c CHAR        r     1 CROSSED
     0-0-0/d STRC(756)   r     1 CVOL_UTL                   0-0-0/w PTR         r     1 DISK_FILE_SPEC$
     0-0-0/w PTR         r     1 DISK_GRAN$                 0-0-0/w PTR         r     1 DPLIST$
     0-0-0/w PTR         r     1 DPRESLIST$                 0-0-0/c ASTR(9)     r     1 DUAL_FILE
     0-0-0/b STRC(18)    r     1 EFTWORD                    0-0-0/b SBIN(18)    r     1 EFTWORDEXPIRE
     0-0-0/c ASTR(9)     r     1 EFT_CVOL_FILE              0-0-0/c ASTR(9)     r     1 EFT_RESTRICT_FILE
     0-0-0/w STRC        r     1 E_CANT_RUN_ARCOM           0-0-0/w STRC        r     1 E_COMPACT_FIN
     0-0-0/w STRC        r     1 E_INCOMPLETE_FILE_ARCH
     0-0-0/w STRC        r     1 E_INCOMPLETE_FILE_SKIP
     0-0-0/w STRC        r     1 E_IO_ERR                   0-0-0/w STRC        r     1 E_TRY_AGAIN
     0-0-0/b BIT         r     1 FMSEC                      0-0-0/c STRC(72)    r     1 FROM_DISK_ACCT
     0-0-0/c STRC(288)   r     1 FROM_DISK_NAME             0-0-0/d STRC(90)    r     1 FROM_DISK_SN
     0-0-0/w PTR         r     1 LAST_SNLISTINFO$           0-0-0/c CHAR(6)     r     1 LAST_TSN_USED
     0-0-0/w PTR         r     1 M$TAPE00$                  0-0-0/w SBIN        r     1 NBR_BYTES_TO_MOVE
     0-0-0/w SBIN        r     1 NBR_FILE_BLOCKS            0-0-0/w SBIN        r     1 NBR_SNLISTS
     0-0-0/c ASTR(9)     r     1 NODATA_FILE_NAME           0-0-0/c STRC(369)   r     1 NODATA_KEY
     0-0-0/d STRC(72)    r     1 OUTBUF_                    0-0-0/c ASTR(9)     r     1 PRIME_FILE
     0-0-0/c ASTR(9)     r     1 REBUILD_DIR_KEY            0-0-0/c ASTR(9)     r     1 REBUILD_KEY
     0-0-0/c ASTR(9)     r     1 REBUILD_NAME               0-0-0/c ASTR(9)     r     1 RET_CMDS_NAME
     0-0-0/w PTR         r     1 SNVECLIST$                 0-0-0/w PTR         r     1 TAPE_DCBLIST$
     0-0-0/d STRC(2088)  r     1 TAPE_OPEN                  0-0-0/d STRC(432)   r     1 TAPE_WRITE
     0-0-0/c ASTR(9)     r     1 TSN_USED_NAME              0-0-0/d STRC(72)    r     1 TVECTOR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(324)   r     1 ARCHIVE_LIST               0-0-0/d STRC(90)    r     1 ARC_SET
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:388  
     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/c ASTR(9)     r     1 B$VERSION
     0-0-0/d STRC(90)    r     1 BASED_SN                   0-0-0/w STRC(108)   r     1 CODE06
     0-0-0/c STRC(54)    r     1 CT5                        0-0-0/c STRC(54)    r     1 CT6
     0-0-0/d STRC(90)    r     1 DPLIST                     0-0-0/d STRC(90)    r     1 ERROR_SET
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/d STRC(90)    r     1 FROM_SN_LIST
     0-0-0/w STRC(396)   r     1 IN_BLK_TAG                 0-0-0/w STRC(396)   r     1 IN_BLK_TAG0
     0-0-0/w CHAR(4096)  r     1 IN_GRAN                    0-0-0N  NULL        r     1 M$ARC_FILE
     0-0-0N  NULL        r     1 M$ARC_LIST                 0-0-0N  NULL        r     1 M$ARC_LIST2
     0-0-0N  NULL        r     1 M$DISK_IN                  0-0-0N  NULL        r     1 M$DO
     0-0-0N  NULL        r     1 M$EFT_ERRORS               0-0-0N  NULL        r     1 M$FSN_LIST
     0-0-0N  NULL        r     1 M$LO                       0-0-0N  NULL        r     1 M$NODATA_LIST
     0-0-0N  NULL        r     1 M$TAPE00                   0-0-0N  NULL        r     1 M$TAPE_SOURCE
     0-0-0/c ACHR        r     1 NCHARS                     0-0-0/d STRC(90)    r     1 OMIT_SN_LIST
     0-0-0/w STRC(144)   r     1 OUT$BLK                    0-0-0/w ASTR(153)   r     1 OUT$SYM
     0-0-0/w STRC(396)   r     1 OUT_BLK_TAG                0-0-0/w STRC(396)   r     1 OUT_BLK_TAG0
     0-0-0/w CHAR(4096)  r     1 OUT_GRAN                   0-0-0/w STRC(72)    r     1 SNLISTINFO
     0-0-0/w STRC(72)    r     1 TAPE_DCBLIST(0:0)
     0-0-0/d STRC(90)    r     1 VLP_SN


   Procedure FLX$ARCOM requires 4376 words for executable code.
   Procedure FLX$ARCOM requires 72 words of local(AUTO) storage.
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:389  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:390  
          MINI XREF LISTING

ACCT_NAME IN PROCEDURE FLX_REPORT_PARTIAL_FILE
     26207**DCL     26213--CALL
ACCT_NAME.L# IN PROCEDURE FLX_REPORT_PARTIAL_FILE
     26207**DCL     26211<<ASSIGN
ACCT_NAME.NAME# IN PROCEDURE FLX_REPORT_PARTIAL_FILE
     26207**DCL     26211--ASSIGN  26212<<ASSIGN
ACC_LINE IN PROCEDURE FLX_ACC_LINE
     27105**DCL     27111--REDEF   27144--DCLINIT 27145--DCLINIT
ACC_LINE.COLUMN.NUMBER IN PROCEDURE FLX_ACC_LINE
     27110**DCL     27208<<ASSIGN  27211<<ASSIGN  27214<<ASSIGN  27219<<CALLBLT 27224<<ASSIGN  27235<<ASSIGN
     27238<<ASSIGN  27241<<ASSIGN  27244<<ASSIGN
ACC_LINE.TITLE IN PROCEDURE FLX_ACC_LINE
     27107**DCL     27205<<ASSIGN  27227<<ASSIGN  27232<<ASSIGN
ACC_LINE.VFC IN PROCEDURE FLX_ACC_LINE
     27106**DCL     27194<<ASSIGN  27209<<ASSIGN  27215<<ASSIGN  27222<<ASSIGN  27236<<ASSIGN  27240<<ASSIGN
     27243<<ASSIGN
ARCHIVE_$$EFT_NAME
     23280**DCL     23087--DCLINIT
ARCHIVE_LIST
     17143**DCL     26869--ASSIGN  26871--ASSIGN  26873<<ASSIGN  26885--ASSIGN
ARCHIVE_LIST.OD
     17144**DCL     26887<<ASSIGN  26888<<ASSIGN
ARCHIVE_LIST.OFFSET.DPLIST
     17144**DCL     24572>>ASSIGN  24676>>ASSIGN  26885<<ASSIGN  26889>>ASSIGN
ARCHIVE_LIST.OFFSET.SNLIST
     17144**DCL     26895<<ASSIGN
ARCHIVE_LIST.OFFSET.SNLIST2
     17144**DCL     26920<<ASSIGN
ARCHIVE_LIST.OPTION.BLOCK
     17145**DCL     26877<<ASSIGN
ARCHIVE_LIST.OPTION.CHECK
     17145**DCL     24674>>ASSIGN  26878<<ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:391  
ARCHIVE_LIST.OPTION.DEN
     17144**DCL     26874<<ASSIGN
ARCHIVE_LIST.OPTION.EXP
     17145**DCL     26876<<ASSIGN
ARCHIVE_LIST.OPTION.IOERRORC
     17145**DCL     24675>>ASSIGN  26879<<ASSIGN
ARCHIVE_LIST.OPTION.VOLA
     17145**DCL     26875<<ASSIGN
ARCHIVE_LIST.SIZE
     17143**DCL     26928<<ASSIGN
ARCHIVE_LIST.VERSION.FLAG
     17143**DCL     24566>>IF      24668>>IF      26880<<ASSIGN
ARCHIVE_LIST.VERSION.SIZE
     17143**DCL     26881<<ASSIGN
ARCHIVE_LIST.VERSION.TEXT
     17143**DCL     26882<<ASSIGN
ARCHIVE_LIST.VOLUME
     17144**DCL     26883<<ASSIGN
ARCHIVE_LIST.XTEND
     17144**DCL     26884<<ASSIGN
ARCHIVE_NAME.L#
     17128**DCL     17128--IMP-SIZ
ARCOM_CMD
     21228**DCL     23830<>CALL
ARCOM_CMD_PCB
     21889**DCL     22108--DCLINIT
ARCOM_CMD_PCB.HI_CHAR
     22040**DCL     23852>>IF
ARCOM_OPTIONS
     18034**DCL     23833<<ASSIGN
ARCOM_OPTIONS.DUPLICATE_TAPESET
     18035**DCL     25828>>IF
ARCOM_OPTIONS.IMMUPDATE
     18035**DCL     25317>>IF      25377>>IF      25461>>IF      25720>>IF      25845>>IF      26021>>IF
     26052>>IF      26524>>IF      26538>>IF      26798>>IF
ARCOM_OPTIONS.IOERRORCI
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:392  
     18035**DCL     25247>>ASSIGN  25255>>ASSIGN  25301>>ASSIGN  25302>>ASSIGN
ARCOM_OPTIONS.IOERRORCO
     18035**DCL     25255>>ASSIGN  25297>>ASSIGN  25298>>ASSIGN  25301>>ASSIGN  25302>>ASSIGN
ARC_FILE_ACCT
     22692**DCL     22610--DCLINIT
ARC_FILE_ACCT.ACCT#
     22692**DCL     26557<<ASSIGN  26767<<ASSIGN  27049<<ASSIGN
ARC_FILE_NAME
     22677**DCL     22606--DCLINIT
ARC_FILE_NAME.L#
     22677**DCL     26556<<ASSIGN  26766<<ASSIGN  27048<<ASSIGN
ARC_FILE_NAME.NAME#
     22677**DCL     26555<<ASSIGN  26765<<ASSIGN  27047<<ASSIGN
ARC_FILE_SN
     22708**DCL     22605--DCLINIT
ARC_FILE_SN.SN#
     22708**DCL     26558<<ASSIGN  26768<<ASSIGN  27050<<ASSIGN
ARC_LIST_KEY
     21332**DCL     22389--DCLINIT 22390--DCLINIT 22471--DCLINIT 22509--DCLINIT 22510--DCLINIT 24385--DCLINIT
     25653>>ASSIGN  25871--ASSIGN
ARC_LIST_KEY.C
     21335**DCL     24614--ASSIGN
ARC_LIST_KEY.C.ACCT
     21337**DCL     24826<<ASSIGN  25813<<ASSIGN  26767>>ASSIGN  27049>>ASSIGN
ARC_LIST_KEY.C.FNAMEC
     21338**DCL     24827<<ASSIGN  25814<<ASSIGN  26765>>ASSIGN  27047>>ASSIGN
ARC_LIST_KEY.C.FNAMEL
     21339**DCL     24828<<ASSIGN  25815<<ASSIGN  26766>>ASSIGN  27048>>ASSIGN
ARC_LIST_KEY.C.PSN
     21336**DCL     24825<<ASSIGN  25812<<ASSIGN  26768>>ASSIGN  27050>>ASSIGN
ARC_LIST_KEY.L
     21334**DCL     24614<<ASSIGN
ARC_LIST_KEY IN PROCEDURE FLX_UPDATE_ARC_FILES
     26275**DCL     26475--DCLINIT 26476--DCLINIT 26533--ASSIGN
ARC_LIST_KEY.C.ACCT IN PROCEDURE FLX_UPDATE_ARC_FILES
     26280**DCL     26557>>ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:393  
ARC_LIST_KEY.C.FNAMEC IN PROCEDURE FLX_UPDATE_ARC_FILES
     26281**DCL     26555>>ASSIGN
ARC_LIST_KEY.C.FNAMEL IN PROCEDURE FLX_UPDATE_ARC_FILES
     26282**DCL     26556>>ASSIGN
ARC_LIST_KEY.C.PSN IN PROCEDURE FLX_UPDATE_ARC_FILES
     26279**DCL     26558>>ASSIGN
ARC_LIST_NAME
     22200**DCL     22322--DCLINIT 24274--DCLINIT 26362--DCLINIT
ARC_LIST_REC
     21368**DCL     22391--DCLINIT 22392--DCLINIT 22472--DCLINIT 22473--DCLINIT 22511--DCLINIT 22512--DCLINIT
     24386--DCLINIT 24387--DCLINIT 25654>>ASSIGN  25872--ASSIGN
ARC_LIST_REC.ACTIVE
     21376**DCL     24813<<ASSIGN  24817<<ASSIGN  25884<<ASSIGN
ARC_LIST_REC.FSN
     21371**DCL     24835<<ASSIGN  24836<<ASSIGN  24865<<ASSIGN  25828>>IF      25828>>IF      25880<<ASSIGN
     26770>>IF
ARC_LIST_REC.NBR_ON_TAPE
     21375**DCL     24617<<ASSIGN  25826<<ASSIGN  25826>>ASSIGN  25883<<ASSIGN  26772>>ASSIGN  26773>>IF
     26780>>ASSIGN  27045>>IF
ARC_LIST_REC.NEW.FSN
     21374**DCL     24616<<ASSIGN  25882<<ASSIGN
ARC_LIST_REC.NEW.REEL
     21373**DCL     24615<<ASSIGN  25881<<ASSIGN  26777>>IF      26783>>IF
ARC_LIST_REC.REEL
     21370**DCL     24833<<ASSIGN  24845>>IF      24859>>ASSIGN  24864<<ASSIGN  24911>>ASSIGN  25828>>IF
     25879<<ASSIGN  26770>>IF
ARC_LIST_REC IN PROCEDURE FLX_UPDATE_ARC_FILES
     26264**DCL     26477--DCLINIT 26478--DCLINIT
ARC_LIST_REC.NEW.FSN IN PROCEDURE FLX_UPDATE_ARC_FILES
     26270**DCL     26574>>ASSIGN  26578>>ASSIGN  26634>>ASSIGN
ARC_LIST_REC.NEW.REEL IN PROCEDURE FLX_UPDATE_ARC_FILES
     26269**DCL     26560>>IF      26569>>ASSIGN  26635<>CALL
ARC_REC$
     21250**DCL     24534<<ASSIGN  24558<>CALL    24560>>ASSIGN  24566>>IF      24569<>CALL    24570<<ASSIGN
     24572>>ASSIGN  24572>>ASSIGN  24652>>IF      24657<>CALL    24658>>ASSIGN  24668>>IF      24671<>CALL
     24672<<ASSIGN  24674>>ASSIGN  24675>>ASSIGN  24676>>ASSIGN  24676>>ASSIGN  26872<>CALL    26873>>ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:394  
     26874>>ASSIGN  26875>>ASSIGN  26876>>ASSIGN  26877>>ASSIGN  26878>>ASSIGN  26879>>ASSIGN  26880>>ASSIGN
     26881>>ASSIGN  26882>>ASSIGN  26883>>ASSIGN  26884>>ASSIGN  26885>>ASSIGN  26887>>ASSIGN  26888>>ASSIGN
     26889>>ASSIGN  26889>>ASSIGN  26895>>ASSIGN  26895>>ASSIGN  26920>>ASSIGN  26920>>ASSIGN  26928>>ASSIGN
     26938>>ASSIGN
ARC_REC_SIZE
     21249**DCL     24533--ASSIGN  24558<>CALL    24559>>ASSIGN  24654--ASSIGN  24656>>ASSIGN  24657<>CALL
     26927<<ASSIGN  26935--ASSIGN  26937>>ASSIGN
ARC_SET.NUM# IN PROCEDURE FLX_FIND_ARC_FILES
     24507**DCL     24573>>ASSIGN  24679>>DOINDEX 24685>>DOINDEX
ARC_SET.SN# IN PROCEDURE FLX_FIND_ARC_FILES
     24507**DCL     24579>>ASSIGN  24680>>IF      24681<<ASSIGN  24686>>IF      24691>>IF      24705>>ASSIGN
ARC_SET$
     21248**DCL     24507--IMP-PTR 24572<<ASSIGN  24573>>ASSIGN  24579>>ASSIGN  24676<<ASSIGN  24679>>DOINDEX
     24680>>IF      24681>>ASSIGN  24685>>DOINDEX 24686>>IF      24691>>IF      24705>>ASSIGN
ARS IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25913**DCL     25949<<ASSIGN  25950>>ASSIGN  25983<>CALL    26042<>CALL    26044<>CALL
A_FIT_
     16293**DCL     25375<>CALL    25459<>CALL    26035<>CALL    26073<>CALL
B$ALT.CODE
     21603**DCL     21603--REDEF   21604--REDEF   21604--REDEF
B$ALT.ERR
     21604**DCL     25430>>ASSIGN
B$ALT.ERR.CODE
     21605**DCL     24591>>IF      24645>>ASSIGN  24711>>IF      24873>>ASSIGN  25415>>IF      25415>>IF
     25431>>ASSIGN  25525>>IF      25539>>IF      25746>>ASSIGN  25771>>ASSIGN  25877>>IF      26542>>IF
     26653>>IF      26791>>IF      27063>>IF
B$ALT.ERR.ERR#
     21605**DCL     21605--REDEF
B$ALT.EVID
     21604**DCL     21604--REDEF   21604--REDEF
B$JIT.CPFLAGS1.SLEAZE
      5995**DCL      5995--REDEF
B$JIT.ERR.MID
      5902**DCL      5902--REDEF
B$JIT.FACCN
      5901**DCL     24544>>ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:395  
B$JIT.JRESPEAK
      6063**DCL      6064--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
      6172**DCL      6172--REDEF    6173--REDEF
B$JIT.PNR
      6076**DCL      6076--REDEF
B$JIT.PPRIV
      5957**DCL     23775>>IF      23841>>IF
B$JIT.PRIV.JOB
      5945**DCL     23769>>IF
B$JIT.TSLINE
      6170**DCL      6171--REDEF
B$JIT$
     15016**DCL      5896--IMP-PTR 23769>>IF      23775>>IF      23841>>IF      24544>>ASSIGN
B$TCB.ALT$
     21599**DCL     24591>>IF      24645>>ASSIGN  24711>>IF      24873>>ASSIGN  25415>>IF      25415>>IF
     25430>>ASSIGN  25431>>ASSIGN  25525>>IF      25539>>IF      25746>>ASSIGN  25771>>ASSIGN  25877>>IF
     26542>>IF      26653>>IF      26791>>IF      27063>>IF
B$TCB$
     15016**DCL     21599--IMP-PTR 24591>>IF      24645>>ASSIGN  24711>>IF      24873>>ASSIGN  25415>>IF
     25415>>IF      25430>>ASSIGN  25431>>ASSIGN  25525>>IF      25539>>IF      25746>>ASSIGN  25771>>ASSIGN
     25877>>IF      26542>>IF      26653>>IF      26791>>IF      27063>>IF
B$VERSION.L#
     21231**DCL     21232--IMP-SIZ 23796>>ASSIGN  26881>>ASSIGN  26882>>ASSIGN  26882>>ASSIGN
B$VERSION.NAME#
     21232**DCL     23796>>ASSIGN  26882>>ASSIGN
BACKUP_NAME.L#
     16772**DCL     16772--IMP-SIZ
BASED_SN.NUM# IN PROCEDURE FLX_OUTPUT_SUMMARY
     26737**DCL     26866>>ASSIGN  26866--ASSIGN  26901<<ASSIGN  26901>>ASSIGN  26912>>DOINDEX 26921<<ASSIGN
     26921>>ASSIGN  26922>>DOINDEX
BASED_SN.SN# IN PROCEDURE FLX_OUTPUT_SUMMARY
     26737**DCL     26866--ASSIGN  26913<<ASSIGN  26913>>ASSIGN  26923<<ASSIGN  26923>>ASSIGN
BLK_TAG.NAME
     16264**DCL     16264--REDEF
BLK_TAG$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:396  
     16261**DCL     16261--IMP-PTR
BLK_TAG0.NAME
     16270**DCL     16270--REDEF
BLK_TAG0$
     16267**DCL     16267--IMP-PTR
BLOCK_GRAN$
     16274**DCL     16275--IMP-PTR
BREAK_CONTINUED
     21242**DCL     23756<<ASSIGN
BREAK_COUNT
     21238**DCL     23755<<ASSIGN  23825<<ASSIGN
BREAK_DCB$
     21239**DCL     23753<<ASSIGN  23826<<ASSIGN  23885<<ASSIGN  23889<<ASSIGN  23893<<ASSIGN
BREAK_TASK
     21240**DCL     23757<<ASSIGN  23827<<ASSIGN  23843<<ASSIGN  23872<<ASSIGN  23884<<ASSIGN  23888<<ASSIGN
     23892<<ASSIGN
BUF_ IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25910**DCL     25952<<ASSIGN  25983<>CALL    26042<>CALL    26044<>CALL
B_VERSION
     21229**DCL     23796--ASSIGN  23796--ASSIGN  26881--ASSIGN  26882--ASSIGN  26882--ASSIGN  26882--ASSIGN
CATALOG_ON
     18049**DCL     23807<<ASSIGN
CATALOG_ONTO
     18049**DCL     23808<<ASSIGN
CAT_KEY
     18043**DCL     18044--REDEF   18045--REDEF
CAT_REC.LT
     18046**DCL     18046--REDEF
CLOSE_ARCHIVE_EFT
     23233**DCL     24581<>CALL    24714<>CALL    24721<>CALL    26944<>CALL
CLOSE_ARCHIVE_EFT.SN_
     23233**DCL     23233--REDEF
CLOSE_ARCHIVE_EFT.UTL_
     23234**DCL     23234--REDEF
CLOSE_ARCHIVE_EFT.V
     23238**DCL     23233--DCLINIT
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:397  
CLOSE_ARCHIVE_EFT.V.EXPIRE#
     23248**DCL     23248--REDEF
CLOSE_ARCHIVE_EFT.V.TYPE#
     23246**DCL     23246--REDEF
CLOSE_ARCHIVE_EFT.V.XTNSIZE#
     23243**DCL     23243--REDEF   23245--REDEF
CLOSE_ARC_FILE
     22738**DCL     26585<>CALL    26599<>CALL    26625<>CALL    26970<>CALL    27055<>CALL
CLOSE_ARC_FILE.SN_
     22738**DCL     22738--REDEF   26593<<ASSIGN  26613<<ASSIGN  26619<<ASSIGN
CLOSE_ARC_FILE.UTL_
     22739**DCL     22739--REDEF
CLOSE_ARC_FILE.V
     22743**DCL     22738--DCLINIT
CLOSE_ARC_FILE.V.DESC
     22748**DCL     26596<<ASSIGN  26596>>ASSIGN  26620<<ASSIGN  26620>>ASSIGN
CLOSE_ARC_FILE.V.DESC.ODSTOW#
     22749**DCL     26573<<ASSIGN  26577<<ASSIGN
CLOSE_ARC_FILE.V.EFTOPER
     22745**DCL     26581<<ASSIGN  26594<<ASSIGN  26614<<ASSIGN  26643<<ASSIGN  27038<<ASSIGN
CLOSE_ARC_FILE.V.EFTOPER.ASTOW#
     22746**DCL     26595<<ASSIGN  26618<<ASSIGN
CLOSE_ARC_FILE.V.EFTOPER.DELFDE#
     22747**DCL     26584<<ASSIGN
CLOSE_ARC_FILE.V.EFTOPER.ISTOW#
     22746**DCL     26615<<ASSIGN
CLOSE_ARC_FILE.V.EFTOPER.UPDDESC#
     22746**DCL     26598<<ASSIGN  26622<<ASSIGN
CLOSE_ARC_FILE.V.EXPIRE#
     22753**DCL     22753--REDEF   26580<<ASSIGN
CLOSE_ARC_FILE.V.TYPE#
     22751**DCL     22751--REDEF
CLOSE_ARC_FILE.V.XTNSIZE#
     22748**DCL     22748--REDEF   22750--REDEF
CLOSE_ARC_LIST
     22229**DCL     24928<>CALL    25025<>CALL    25502<>CALL    25576<>CALL    26793<>CALL    26962<>CALL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:398  
     27065<>CALL    27079<>CALL
CLOSE_ARC_LIST.SN_
     22229**DCL     22229--REDEF
CLOSE_ARC_LIST.UTL_
     22230**DCL     22230--REDEF
CLOSE_ARC_LIST.V
     22234**DCL     22229--DCLINIT
CLOSE_ARC_LIST.V.EXPIRE#
     22244**DCL     22244--REDEF
CLOSE_ARC_LIST.V.TYPE#
     22242**DCL     22242--REDEF
CLOSE_ARC_LIST.V.XTNSIZE#
     22239**DCL     22239--REDEF   22241--REDEF
CLOSE_ARC_LIST_FSN IN PROCEDURE FLX_UPDATE_ARC_FILES
     26432**DCL     26544<>CALL    26655<>CALL    26678<>CALL
CLOSE_ARC_LIST_FSN.SN_ IN PROCEDURE FLX_UPDATE_ARC_FILES
     26432**DCL     26432--REDEF
CLOSE_ARC_LIST_FSN.UTL_ IN PROCEDURE FLX_UPDATE_ARC_FILES
     26433**DCL     26433--REDEF
CLOSE_ARC_LIST_FSN.V IN PROCEDURE FLX_UPDATE_ARC_FILES
     26437**DCL     26432--DCLINIT
CLOSE_ARC_LIST_FSN.V.EXPIRE# IN PROCEDURE FLX_UPDATE_ARC_FILES
     26447**DCL     26447--REDEF
CLOSE_ARC_LIST_FSN.V.TYPE# IN PROCEDURE FLX_UPDATE_ARC_FILES
     26445**DCL     26445--REDEF
CLOSE_ARC_LIST_FSN.V.XTNSIZE# IN PROCEDURE FLX_UPDATE_ARC_FILES
     26442**DCL     26442--REDEF   26444--REDEF
CLOSE_BLOCK_FILE.SN_
     16178**DCL     16178--REDEF
CLOSE_BLOCK_FILE.UTL_
     16179**DCL     16179--REDEF
CLOSE_BLOCK_FILE.V
     16183**DCL     16178--DCLINIT
CLOSE_BLOCK_FILE.V.EXPIRE#
     16193**DCL     16193--REDEF
CLOSE_BLOCK_FILE.V.TYPE#
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:399  
     16191**DCL     16191--REDEF
CLOSE_BLOCK_FILE.V.XTNSIZE#
     16188**DCL     16188--REDEF   16190--REDEF
CLOSE_EFT_ERRORS
     23729**DCL     23781<>CALL    23898<>CALL    23908<>CALL
CLOSE_EFT_ERRORS.SN_
     23729**DCL     23729--REDEF
CLOSE_EFT_ERRORS.UTL_
     23730**DCL     23730--REDEF
CLOSE_EFT_ERRORS.V
     23734**DCL     23729--DCLINIT
CLOSE_EFT_ERRORS.V.EXPIRE#
     23744**DCL     23744--REDEF
CLOSE_EFT_ERRORS.V.TYPE#
     23742**DCL     23742--REDEF
CLOSE_EFT_ERRORS.V.XTNSIZE#
     23739**DCL     23739--REDEF   23741--REDEF
CLOSE_FSN_LIST
     23536**DCL     25507<>CALL    25585<>CALL    26662<>CALL    26686<>CALL
CLOSE_FSN_LIST.SN_
     23536**DCL     23536--REDEF
CLOSE_FSN_LIST.UTL_
     23537**DCL     23537--REDEF
CLOSE_FSN_LIST.V
     23541**DCL     23536--DCLINIT
CLOSE_FSN_LIST.V.DISP#
     23545**DCL     25506<<ASSIGN  25508<<ASSIGN  25584<<ASSIGN  25589<<ASSIGN
CLOSE_FSN_LIST.V.EXPIRE#
     23551**DCL     23551--REDEF
CLOSE_FSN_LIST.V.TYPE#
     23549**DCL     23549--REDEF
CLOSE_FSN_LIST.V.XTNSIZE#
     23546**DCL     23546--REDEF   23548--REDEF
CLOSE_NODATA_LIST.SN_
     17926**DCL     17926--REDEF
CLOSE_NODATA_LIST.UTL_
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:400  
     17927**DCL     17927--REDEF
CLOSE_NODATA_LIST.V.EXPIRE#
     17941**DCL     17941--REDEF
CLOSE_NODATA_LIST.V.TYPE#
     17939**DCL     17939--REDEF
CLOSE_NODATA_LIST.V.XTNSIZE#
     17936**DCL     17936--REDEF   17938--REDEF
CLOSE_PRIME_DUAL.SN_
     17403**DCL     17403--REDEF
CLOSE_PRIME_DUAL.UTL_
     17404**DCL     17404--REDEF
CLOSE_PRIME_DUAL.V.EXPIRE#
     17418**DCL     17418--REDEF
CLOSE_PRIME_DUAL.V.TYPE#
     17416**DCL     17416--REDEF
CLOSE_PRIME_DUAL.V.XTNSIZE#
     17413**DCL     17413--REDEF   17415--REDEF
CLOSE_REBUILD.SN_
     17678**DCL     17678--REDEF
CLOSE_REBUILD.UTL_
     17679**DCL     17679--REDEF
CLOSE_REBUILD.V.EXPIRE#
     17693**DCL     17693--REDEF
CLOSE_REBUILD.V.TYPE#
     17691**DCL     17691--REDEF
CLOSE_REBUILD.V.XTNSIZE#
     17688**DCL     17688--REDEF   17690--REDEF
CLOSE_STATUS.SN_
     16893**DCL     16893--REDEF
CLOSE_STATUS.UTL_
     16894**DCL     16894--REDEF
CLOSE_STATUS.V.EXPIRE#
     16908**DCL     16908--REDEF
CLOSE_STATUS.V.TYPE#
     16906**DCL     16906--REDEF
CLOSE_STATUS.V.XTNSIZE#
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:401  
     16903**DCL     16903--REDEF   16905--REDEF
CLOSE_TAPE_SOURCE
     21850**DCL     25406<>CALL    25523<>CALL    25537<>CALL    25568<>CALL
CLOSE_TAPE_SOURCE.SN_
     21850**DCL     21850--REDEF
CLOSE_TAPE_SOURCE.UTL_
     21851**DCL     21851--REDEF
CLOSE_TAPE_SOURCE.V
     21855**DCL     21850--DCLINIT
CLOSE_TAPE_SOURCE.V.EXPIRE#
     21865**DCL     21865--REDEF
CLOSE_TAPE_SOURCE.V.TYPE#
     21863**DCL     21863--REDEF
CLOSE_TAPE_SOURCE.V.XTNSIZE#
     21860**DCL     21860--REDEF   21862--REDEF
CLOSE_TSN_USED.SN_
     16603**DCL     16603--REDEF
CLOSE_TSN_USED.UTL_
     16604**DCL     16604--REDEF
CLOSE_TSN_USED.V.EXPIRE#
     16618**DCL     16618--REDEF
CLOSE_TSN_USED.V.TYPE#
     16616**DCL     16616--REDEF
CLOSE_TSN_USED.V.XTNSIZE#
     16613**DCL     16613--REDEF   16615--REDEF
CLSERR IN PROCEDURE FLX_OUTPUT_SUMMARY
     26939**LABEL   26936--CALLALT 26939--CALLALT
CODE
     21251**DCL     24645<<ASSIGN  24646>>IF      24646>>IF      24646>>IF      24873<<ASSIGN  24874>>IF
     24883>>IF      24883>>IF      25427<<ASSIGN  25431<<ASSIGN  25433>>IF      25433>>IF      25433>>IF
     25433>>IF      25433>>IF      25433>>IF      25433>>IF      25467>>IF      25467>>IF      25467>>IF
     25467>>IF      25479>>IF      25483>>IF      25483>>IF      25483>>IF      25483>>IF      25483>>IF
     25490>>IF      25550<<ASSIGN  25626>>IF      25626>>IF      25626>>IF      25711<<ASSIGN  25746<<ASSIGN
     25748>>DOCASE  25771<<ASSIGN  25772>>IF      25775>>IF      25775>>IF
CODE06.STOW.EFT
     21614**DCL     21615--REDEF   24899>>ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:402  
CODE06.STOW.EFT.FSN
     21614**DCL     24836>>ASSIGN  25669<<ASSIGN
CODE06.STOW.ODFSN
     21615**DCL     24835>>ASSIGN  25668<<ASSIGN
CODE06.STOW.REEL
     21614**DCL     24833>>ASSIGN  25666<<ASSIGN
CODE06$
     21322**DCL     21614--IMP-PTR 24830<<ASSIGN  24831<>CALL    24833>>ASSIGN  24835>>ASSIGN  24836>>ASSIGN
     24899>>ASSIGN  25663<<ASSIGN  25664<>CALL    25666>>ASSIGN  25668>>ASSIGN  25669>>ASSIGN  26565<<ASSIGN
     26566<<ASSIGN  26567<>CALL
COLLECT_SNS IN PROCEDURE FLX_FIND_ARC_FILES
     24074**DCL     24778<<ASSIGN  24784<<ASSIGN  24837>>IF      24900>>IF      24998>>IF
COLUMN IN PROCEDURE FLX_ACC_LINE
     27096**DCL     27089--PROC    27199--IF      27203>>IF      27217>>ASSIGN
CONTROLLED_SOURCE
     21428**DCL     23933<<ASSIGN  23985<<ASSIGN  25483>>IF      25483>>IF      25483>>IF      25483>>IF
CON_CLOSE_ARCHIVE.SN_
     16935**DCL     16935--REDEF
CON_CLOSE_ARCHIVE.UTL_
     16936**DCL     16936--REDEF
CON_CLOSE_ARCHIVE.V.EXPIRE#
     16950**DCL     16950--REDEF
CON_CLOSE_ARCHIVE.V.TYPE#
     16948**DCL     16948--REDEF
CON_CLOSE_ARCHIVE.V.XTNSIZE#
     16945**DCL     16945--REDEF   16947--REDEF
CON_OPEN_ARCHIVE_FILE.ACSVEH_
     17022**DCL     17023--REDEF
CON_OPEN_ARCHIVE_FILE.ALTKEYS_
     17028**DCL     17029--REDEF   17029--REDEF
CON_OPEN_ARCHIVE_FILE.HDR_
     17027**DCL     17028--REDEF
CON_OPEN_ARCHIVE_FILE.TAB_
     17026**DCL     17027--REDEF
CON_OPEN_ARCHIVE_FILE.UHL_
     17020**DCL     17021--REDEF   17021--REDEF
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:403  
CON_OPEN_ARCHIVE_FILE.V.FSN#
     17060**DCL     17060--REDEF   17060--REDEF
CON_OPEN_ARCHIVE_FILE.WSN_
     17026**DCL     17026--REDEF
CON_READ_ARCHIVE_FILE.STATION_
     17084**DCL     17085--REDEF
CON_READ_ARCHIVE_FILE.V.DVBYTE.REREAD#
     17096**DCL     17096--REDEF
CON_READ_ARCHIVE_FILE.V.INDX#
     17094**DCL     17094--REDEF
COULDNT_OMIT IN PROCEDURE FLX_FIND_ARC_FILES
     24049**DCL     24957--ASSIGN
COULDNT_OMIT_OD IN PROCEDURE FLX_FIND_ARC_FILES
     24057**DCL     24956--ASSIGN
CROSSED
     16296**DCL     26033<<ASSIGN  26081<<ASSIGN
CT5.C1 IN PROCEDURE FLX_FIND_ARC_FILES
     24525**DCL     24915>>CALLBLT 24917<<CALLBLT
CT5.C2 IN PROCEDURE FLX_FIND_ARC_FILES
     24526**DCL     24913>>IF
CT6.C1 IN PROCEDURE FLX_FIND_ARC_FILES
     24529**DCL     24920>>CALLBLT 24922<<CALLBLT
CTN IN PROCEDURE FLX_FIND_ARC_FILES
     24077**DCL     24915<<CALLBLT 24916<<ASSIGN  24916>>ASSIGN  24917>>CALLBLT 24920<<CALLBLT 24921<<ASSIGN
     24921>>ASSIGN  24922>>CALLBLT
CVOL_UTL
     16363**DCL     25374--CALL    25458--CALL    25563--CALL    25717--CALL    25838--CALL
CVOL_UTL.ULBL#
     16363**DCL     16363--REDEF
DASHES IN PROCEDURE FLX_ACC_LINE
     27164**DCL     27190--ASSIGN
DCB# IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25180**DCL     25375<>CALL    25381<<ASSIGN  25382<>CALL    25459<>CALL    25472<<ASSIGN  25473<>CALL
     25635<<ASSIGN  25636<>CALL    25730<<ASSIGN  25731<>CALL    25857<>CALL    25859<>CALL    26035<>CALL
     26038<>CALL    26073<>CALL
DELREC_FSN_LIST
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:404  
     23588**DCL     26065<>CALL
DELREC_FSN_LIST.V
     23591**DCL     23588--DCLINIT
DEL_ARC_LIST_BY_KEY.V IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25217**DCL     25214--DCLINIT
DEL_NODATA_REC.V
     18029**DCL     18026--DCLINIT
DISK_CLOSE.SN_
     14696**DCL     14696--REDEF
DISK_CLOSE.UTL_
     14697**DCL     14697--REDEF
DISK_CLOSE.V.EXPIRE#
     14711**DCL     14711--REDEF
DISK_CLOSE.V.TYPE#
     14709**DCL     14709--REDEF
DISK_CLOSE.V.XTNSIZE#
     14706**DCL     14706--REDEF   14708--REDEF
DISK_CLOSE_NEXT.SN_
     15875**DCL     15875--REDEF
DISK_CLOSE_NEXT.UTL_
     15876**DCL     15876--REDEF
DISK_CLOSE_NEXT.V.EXPIRE#
     15890**DCL     15890--REDEF
DISK_CLOSE_NEXT.V.TYPE#
     15888**DCL     15888--REDEF
DISK_CLOSE_NEXT.V.XTNSIZE#
     15885**DCL     15885--REDEF   15887--REDEF
DISK_CLOSE_ORDINARY.SN_
     15917**DCL     15917--REDEF
DISK_CLOSE_ORDINARY.UTL_
     15918**DCL     15918--REDEF
DISK_CLOSE_ORDINARY.V.EXPIRE#
     15932**DCL     15932--REDEF
DISK_CLOSE_ORDINARY.V.TYPE#
     15930**DCL     15930--REDEF
DISK_CLOSE_ORDINARY.V.XTNSIZE#
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:405  
     15927**DCL     15927--REDEF   15929--REDEF
DISK_FILE_SPEC.SPEC
     15061**DCL     15063--REDEF
DISK_FILE_SPEC.SPEC.START
     15062**DCL     15062--REDEF
DISK_FILE_SPEC.SPEC.STOP
     15063**DCL     15063--REDEF
DISK_FILE_SPEC$
     15060**DCL     15061--IMP-PTR
DISK_GRAN$
     16274**DCL     16274--IMP-PTR
DISK_OPEN.ACSVEH_
     14561**DCL     14562--REDEF
DISK_OPEN.ALTKEYS_
     14567**DCL     14568--REDEF   14568--REDEF
DISK_OPEN.HDR_
     14566**DCL     14567--REDEF
DISK_OPEN.TAB_
     14565**DCL     14566--REDEF
DISK_OPEN.UHL_
     14559**DCL     14560--REDEF   14560--REDEF
DISK_OPEN.V.FSN#
     14599**DCL     14599--REDEF   14599--REDEF
DISK_OPEN.WSN_
     14565**DCL     14565--REDEF
DISK_OPEN_NEXT.ACSVEH_
     15701**DCL     15702--REDEF
DISK_OPEN_NEXT.ALTKEYS_
     15707**DCL     15708--REDEF   15708--REDEF
DISK_OPEN_NEXT.HDR_
     15706**DCL     15707--REDEF
DISK_OPEN_NEXT.TAB_
     15705**DCL     15706--REDEF
DISK_OPEN_NEXT.UHL_
     15699**DCL     15700--REDEF   15700--REDEF
DISK_OPEN_NEXT.V.FSN#
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:406  
     15739**DCL     15739--REDEF   15739--REDEF
DISK_OPEN_NEXT.WSN_
     15705**DCL     15705--REDEF
DISK_OPEN_ORDINARY.ACSVEH_
     15810**DCL     15811--REDEF
DISK_OPEN_ORDINARY.ALTKEYS_
     15816**DCL     15817--REDEF   15817--REDEF
DISK_OPEN_ORDINARY.HDR_
     15815**DCL     15816--REDEF
DISK_OPEN_ORDINARY.TAB_
     15814**DCL     15815--REDEF
DISK_OPEN_ORDINARY.UHL_
     15808**DCL     15809--REDEF   15809--REDEF
DISK_OPEN_ORDINARY.V.FSN#
     15848**DCL     15848--REDEF   15848--REDEF
DISK_OPEN_ORDINARY.WSN_
     15814**DCL     15814--REDEF
DISK_READ.STATION_
     14623**DCL     14624--REDEF
DISK_READ.V.DVBYTE.REREAD#
     14635**DCL     14635--REDEF
DISK_READ.V.INDX#
     14633**DCL     14633--REDEF
DISK_WRITE.STATION_
     14661**DCL     14661--REDEF
DISK_WRITE.V.DVBYTE.VFC#
     14668**DCL     14668--REDEF
DONE IN PROCEDURE FLX_ACC_LINE
     27097**DCL     27089--PROC    27230--IF
DPLIST.NUM#
     15058**DCL     23953--ASSIGN  23956<<ASSIGN  24574--ASSIGN  24577<<ASSIGN  24585>>DOINDEX 24641>>DOINDEX
     24678>>DOINDEX 24792>>DOINDEX 26865>>ASSIGN  26865--ASSIGN  26890<<ASSIGN  26890>>ASSIGN  26891>>DOINDEX
     26931>>DOINDEX
DPLIST.SN#
     15058**DCL     23953--ASSIGN  23958<<ASSIGN  24574--ASSIGN  24579<<ASSIGN  24586>>ASSIGN  24642>>ASSIGN
     24680>>IF      24794>>ASSIGN  26865--ASSIGN  26892<<ASSIGN  26892>>ASSIGN  26932>>ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:407  
DPLIST$
     15046**DCL     15058--IMP-PTR 23936<<ASSIGN  23955<>CALL    23956>>ASSIGN  23958>>ASSIGN  24542>>IF
     24576<>CALL    24577>>ASSIGN  24579>>ASSIGN  24585>>DOINDEX 24586>>ASSIGN  24641>>DOINDEX 24642>>ASSIGN
     24678>>DOINDEX 24680>>IF      24792>>DOINDEX 24794>>ASSIGN  26865>>ASSIGN  26890>>ASSIGN  26891>>DOINDEX
     26892>>ASSIGN  26931>>DOINDEX 26932>>ASSIGN
DPRESLIST$
     15060**DCL     15060--IMP-PTR
DPSIZE IN PROCEDURE FLX_OUTPUT_SUMMARY
     26714**DCL     26865<<ASSIGN  26869>>ASSIGN  26871>>ASSIGN  26894>>ASSIGN
DPSN
     23312**DCL     23086--DCLINIT 24156--DCLINIT
DPSN.SN#
     23312**DCL     24550<<ASSIGN  24551>>ASSIGN  24642<<ASSIGN  24794<<ASSIGN  24825>>ASSIGN  24877>>ASSIGN
     26932<<ASSIGN
DPX IN PROCEDURE FLX_FIND_ARC_FILES
     24065**DCL     24641<<DOINDEX 24642>>ASSIGN  24792<<DOINDEX 24794>>ASSIGN
DUAL_FILE.L#
     17199**DCL     17199--IMP-SIZ
EFTWORD
     15181**DCL     15181--REDEF   24899<<ASSIGN  26570<<ASSIGN
EFTWORD.CROSS
     15181**DCL     24900>>IF
EFTWORD.FSN
     15181**DCL     26578<<ASSIGN
EFTWORDEXPIRE
     15181**DCL     26574<<ASSIGN  26580>>ASSIGN
EFT_ACCT
     23296**DCL     23091--DCLINIT
EFT_CVOL_FILE
     16323**DCL     26035--CALL
EFT_CVOL_FILE.L#
     16323**DCL     16323--IMP-SIZ 26035>>CALL
EFT_RESTRICT_FILE
     16350**DCL     25375--CALL    25459--CALL    26073--CALL
EFT_RESTRICT_FILE.L#
     16350**DCL     16350--IMP-SIZ 25375>>CALL    25402>>IF      25459>>CALL    26073>>CALL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:408  
EFT_RESTRICT_FILE.NAME#
     16350**DCL     25402>>IF
EOVOL IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25912**DCL     25983<>CALL    26031>>IF      26042<>CALL    26044<>CALL
ERR
     21266**DCL     23855<>CALL
ERR.MON
     21295**DCL     23850>>IF
ERR IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25101**DCL     25375<>CALL    25426<<ASSIGN  25430<<ASSIGN  25473<>CALL    25478<>CALL    25549<<ASSIGN
     25857<>CALL    25859<>CALL    26035<>CALL    26038<>CALL    26073<>CALL
ERROR_FLAG
     21323**DCL     24630<<ASSIGN  24718<<ASSIGN  24748<<ASSIGN  24761>>IF
ERROR_OUT
     23855**LABEL   23773--CALLALT 23788--CALLALT 23789--CALLALT 23793--CALLALT
ERROR_SET.NUM# IN PROCEDURE FLX_FIND_ARC_FILES
     24521**DCL     24636--ASSIGN  24640<<ASSIGN  24690>>DOWHILE 24697<<ASSIGN  24698>>IF      24738>>IF
     24755>>DOINDEX
ERROR_SET.SN# IN PROCEDURE FLX_FIND_ARC_FILES
     24521**DCL     24636--ASSIGN  24691>>IF      24700--ASSIGN  24705<<ASSIGN  24756>>ASSIGN
ERROR_SET$ IN PROCEDURE FLX_FIND_ARC_FILES
     24035**DCL     24521--IMP-PTR 24638<>CALL    24640>>ASSIGN  24690>>DOWHILE 24691>>IF      24697>>ASSIGN
     24698>>IF      24705>>ASSIGN  24738>>IF      24755>>DOINDEX 24756>>ASSIGN
ERR_CLOSE IN PROCEDURE FLX_ARC_LIST_ERROR_REPORT
     27070**LABEL   27037--CALLALT 27053--CALLALT
ERR_CLOSE IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25557**LABEL   25374--CALLALT 25378--CALLALT 25440--GOTO    25458--CALLALT 25463--CALLALT 25526--GOTO
ERR_CLOSE IN PROCEDURE FLX_OUTPUT_SUMMARY
     26950**LABEL   26759--CALLALT 26799--CALLALT
ERR_CLOSE IN PROCEDURE FLX_UPDATE_ARC_FILES
     26658**LABEL   26635--CALLALT
ERR_SAVE IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25147**DCL     25459<>CALL
E_CANT_RUN_ARCOM
     13107**DCL     23777<>CALL
E_COMPACT_FIN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:409  
     14052**DCL     25549>>ASSIGN
E_COMPACT_FIN.ERR#
     14082**DCL     25550>>ASSIGN
E_INCOMPLETE_FILE_ARCH
     13557**DCL     26213<>CALL
E_INCOMPLETE_FILE_SKIP
     13962**DCL     25636<>CALL
E_IO_ERR
     13602**DCL     25382<>CALL    25426>>ASSIGN  25731<>CALL
E_IO_ERR.ERR#
     13632**DCL     25427>>ASSIGN
E_TRY_AGAIN
     11036**DCL     23861<>CALL
F$DCB.ACTPOS
     21574**DCL     21574--REDEF
F$DCB.ARS#
     21548**DCL     21548--REDEF   25756>>ASSIGN  25766>>ASSIGN
F$DCB.ATTR
     21567**DCL     21568--REDEF
F$DCB.ATTR.TRUOVRPRT#
     21567**DCL     27181>>ASSIGN
F$DCB.BLKL#
     21564**DCL     26877>>ASSIGN
F$DCB.BORROW
     21582**DCL     21582--REDEF   21582--REDEF   21582--REDEF
F$DCB.DCBNAME.L
     21596**DCL     21596--IMP-SIZ
F$DCB.DENSITY#
     21569**DCL     26874>>ASSIGN
F$DCB.DESC
     21555**DCL     26596>>ASSIGN  26620>>ASSIGN
F$DCB.DESC.DELF#
     21555**DCL     26564>>IF      26582>>IF
F$DCB.EOMCHAR#
     21552**DCL     21552--REDEF
F$DCB.EXPIRE#
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:410  
     21565**DCL     26876>>ASSIGN
F$DCB.FCD#
     21561**DCL     23779>>IF      23790>>IF      23896>>IF      23906>>IF      25504>>IF      25522>>IF
     25535>>IF      25566>>IF      25574>>IF      25582>>IF      26660>>IF      26676>>IF      26684>>IF
     26960>>IF      26968>>IF      27077>>IF
F$DCB.FLDID
     21577**DCL     21577--REDEF
F$DCB.FORM$
     21571**DCL     21571--REDEF
F$DCB.FSECT
     21587**DCL     21587--REDEF   25347>>IF
F$DCB.FSN#
     21564**DCL     21564--REDEF   21564--REDEF   21565--REDEF   25348>>ASSIGN  25353>>ASSIGN  25828>>IF
     25828>>IF
F$DCB.HEADER$
     21570**DCL     21570--REDEF
F$DCB.IXTNSIZE#
     21568**DCL     21568--REDEF
F$DCB.LASTSTA$
     21557**DCL     21557--REDEF
F$DCB.LVL
     21583**DCL     21583--REDEF
F$DCB.NAME#.C
     21558**DCL     21558--REDEF   25402>>IF      25515>>ASSIGN
F$DCB.NAME#.L
     21558**DCL     25516>>ASSIGN
F$DCB.NOEOF
     21580**DCL     21580--REDEF
F$DCB.NRECS#
     21569**DCL     21569--REDEF
F$DCB.NRECX
     21588**DCL     21588--REDEF
F$DCB.OHDR
     21580**DCL     21580--REDEF
F$DCB.ORG#
     21563**DCL     21563--REDEF   25402>>IF
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:411  
F$DCB.PRECNO
     21586**DCL     21586--REDEF
F$DCB.PSN#
     21558**DCL     25828>>IF      25979>>ASSIGN  26080>>IF      26235>>ASSIGN
F$DCB.RCSZ
     21592**DCL     21592--REDEF
F$DCB.RES#
     21559**DCL     21559--REDEF
F$DCB.SETX
     21571**DCL     21571--REDEF
F$DCB.TAB$
     21571**DCL     21571--REDEF
F$DCB.TDA
     21585**DCL     21586--REDEF
F$DCB.TYC.IOERR#
     21549**DCL     25342>>IF      25362>>IF      25424>>IF      25708>>IF
F$DCB.VOL#
     21569**DCL     25483>>IF      25492>>ASSIGN  26240>>DOINDEX 26896>>IF      26900>>ASSIGN
F$DCB.VOLACCESS#
     21561**DCL     26875>>ASSIGN
F$DCB.WSN#
     21559**DCL     21559--REDEF
F$DCB.ACCT# IN PROCEDURE FLX_FIND_ARC_FILES
     24455**DCL     24826>>ASSIGN
F$DCB.ACTPOS IN PROCEDURE FLX_FIND_ARC_FILES
     24471**DCL     24471--REDEF
F$DCB.ARS# IN PROCEDURE FLX_FIND_ARC_FILES
     24445**DCL     24445--REDEF
F$DCB.ATTR IN PROCEDURE FLX_FIND_ARC_FILES
     24464**DCL     24465--REDEF
F$DCB.BORROW IN PROCEDURE FLX_FIND_ARC_FILES
     24479**DCL     24479--REDEF   24479--REDEF   24479--REDEF
F$DCB.DCBNAME.L IN PROCEDURE FLX_FIND_ARC_FILES
     24493**DCL     24493--IMP-SIZ
F$DCB.DESC.DELF# IN PROCEDURE FLX_FIND_ARC_FILES
     24452**DCL     24811>>IF
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:412  
F$DCB.DESC.ODSTOW# IN PROCEDURE FLX_FIND_ARC_FILES
     24453**DCL     24834>>IF      24839>>IF
F$DCB.EOMCHAR# IN PROCEDURE FLX_FIND_ARC_FILES
     24449**DCL     24449--REDEF
F$DCB.FCD# IN PROCEDURE FLX_FIND_ARC_FILES
     24458**DCL     24719>>IF      25023>>IF
F$DCB.FLDID IN PROCEDURE FLX_FIND_ARC_FILES
     24474**DCL     24474--REDEF
F$DCB.FORM$ IN PROCEDURE FLX_FIND_ARC_FILES
     24468**DCL     24468--REDEF
F$DCB.FSECT IN PROCEDURE FLX_FIND_ARC_FILES
     24484**DCL     24484--REDEF
F$DCB.FSN# IN PROCEDURE FLX_FIND_ARC_FILES
     24461**DCL     24461--REDEF   24461--REDEF   24462--REDEF
F$DCB.HEADER$ IN PROCEDURE FLX_FIND_ARC_FILES
     24467**DCL     24467--REDEF
F$DCB.IXTNSIZE# IN PROCEDURE FLX_FIND_ARC_FILES
     24465**DCL     24465--REDEF
F$DCB.LASTSTA$ IN PROCEDURE FLX_FIND_ARC_FILES
     24454**DCL     24454--REDEF
F$DCB.LVL IN PROCEDURE FLX_FIND_ARC_FILES
     24480**DCL     24480--REDEF
F$DCB.NAME#.C IN PROCEDURE FLX_FIND_ARC_FILES
     24455**DCL     24455--REDEF   24827>>ASSIGN
F$DCB.NAME#.L IN PROCEDURE FLX_FIND_ARC_FILES
     24455**DCL     24828>>ASSIGN
F$DCB.NOEOF IN PROCEDURE FLX_FIND_ARC_FILES
     24477**DCL     24477--REDEF
F$DCB.NRECS# IN PROCEDURE FLX_FIND_ARC_FILES
     24466**DCL     24466--REDEF
F$DCB.NRECX IN PROCEDURE FLX_FIND_ARC_FILES
     24485**DCL     24485--REDEF
F$DCB.OHDR IN PROCEDURE FLX_FIND_ARC_FILES
     24477**DCL     24477--REDEF
F$DCB.ORG# IN PROCEDURE FLX_FIND_ARC_FILES
     24460**DCL     24460--REDEF
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:413  
F$DCB.PRECNO IN PROCEDURE FLX_FIND_ARC_FILES
     24483**DCL     24483--REDEF
F$DCB.RCSZ IN PROCEDURE FLX_FIND_ARC_FILES
     24489**DCL     24489--REDEF
F$DCB.RES# IN PROCEDURE FLX_FIND_ARC_FILES
     24456**DCL     24456--REDEF
F$DCB.SETX IN PROCEDURE FLX_FIND_ARC_FILES
     24468**DCL     24468--REDEF
F$DCB.TAB$ IN PROCEDURE FLX_FIND_ARC_FILES
     24468**DCL     24468--REDEF
F$DCB.TDA IN PROCEDURE FLX_FIND_ARC_FILES
     24482**DCL     24483--REDEF
F$DCB.WSN# IN PROCEDURE FLX_FIND_ARC_FILES
     24456**DCL     24456--REDEF
FILE_FIN IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25904**DCL     25897--PROC    25969--IF      25969>>IF      26000--IF      26000>>IF
FIRST$ IN PROCEDURE FLX_OUTPUT_SUMMARY
     26718**DCL     26903<<ASSIGN  26906>>DOWHILE 26907>>ASSIGN  26908<<ASSIGN  26908>>ASSIGN  26912>>DOINDEX
     26913>>ASSIGN
FIRST_SOURCE_FILE IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25195**DCL     25273<<ASSIGN  25350>>IF      25449>>IF      25467>>IF      25467>>IF      25467>>IF
     25467>>IF      25479>>IF      25626>>IF      25639<<ASSIGN  25642<<ASSIGN
FIT_AREA.W2
     16634**DCL     16635--REDEF
FLERRMSGSYS
     21434**DCL     23759<>CALL
FLI$ALLOC
     21197**DCL-ENT 23955--CALL    24558--CALL    24576--CALL    24638--CALL    24657--CALL    24702--CALL
     24780--CALL    24856--CALL    24908--CALL    26872--CALL
FLI$ALLOC_BUF
     21198**DCL-ENT 23880--CALL    23881--CALL    23882--CALL
FLI$CNVRT_ARCHIVE
     21207**DCL-ENT 24569--CALL    24671--CALL
FLI$INIT
     21196**DCL-ENT 23829--CALL
FLI$NODE_TAPE_OD
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:414  
     21194**DCL-ENT 23963--CALL    23994--CALL
FLI$RPT_ERR
     21200**DCL-ENT 23777--CALL    23860--CALL    23861--CALL    24547--CALL    24592--CALL    24597--CALL
     24602--CALL    24712--CALL    24717--CALL    24723--CALL    24729--CALL    25022--CALL    25027--CALL
     25313--CALL    25321--CALL    25382--CALL    25439--CALL    25473--CALL    25478--CALL    25558--CALL
     25570--CALL    25578--CALL    25587--CALL    25636--CALL    25731--CALL    25859--CALL    26038--CALL
     26546--CALL    26587--CALL    26601--CALL    26605--CALL    26611--CALL    26630--CALL    26641--CALL
     26646--CALL    26657--CALL    26664--CALL    26673--CALL    26680--CALL    26688--CALL    26792--CALL
     26795--CALL    26942--CALL    26949--CALL    26957--CALL    26964--CALL    26972--CALL    27058--CALL
     27064--CALL    27067--CALL    27074--CALL    27081--CALL
FLI$TAPE_CLOSE
     21203**DCL-ENT 25374--CALL    25458--CALL    25563--CALL    25717--CALL    25838--CALL    26034--CALL
     26072--CALL
FLI$TAPE_IO_INIT
     21201**DCL-ENT 25290--CALL
FLI$TAPE_OPEN
     21202**DCL-ENT 25375--CALL    25459--CALL    25857--CALL    26035--CALL    26073--CALL
FLI$TAPE_WRITE
     21204**DCL-ENT 25983--CALL    26042--CALL    26044--CALL
FLP$WR_FILE_INFO
     21206**DCL-ENT 25304--CALL    26635--CALL    26759--CALL    27037--CALL    27053--CALL
FLX$ARCOM_BRK
     21205**DCL-ENT 21662--DCLINIT
FLX_ACC_LINE
     27089**PROC    24791--CALL    24878--CALL    24879--CALL    24880--CALL    24881--CALL    24927--CALL
     26802--CALL    26805--CALL    26807--CALL    26812--CALL    26814--CALL    26819--CALL    26821--CALL
     26826--CALL    26828--CALL    26831--CALL    26834--CALL    26836--CALL    26839--CALL    26841--CALL
     26844--CALL    26846--CALL    26849--CALL    26851--CALL    26854--CALL    26856--CALL    26859--CALL
     26861--CALL
FLX_ADD_ANOTHER_GRAN IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     26135**PROC    25693--CALL
FLX_ARC_LIST_ERROR_REPORT
     26980**PROC    26863--CALL
FLX_CHECK_ARC_LIST IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25799**PROC    25643--CALL
FLX_CHECK_CURRENT_GRAN IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:415  
     25897**PROC    25369--CALL    25452--CALL    25651--CALL    25712--CALL    25837--CALL    26148--CALL
FLX_COMPACT
     23865**PROC    23844--CALL
FLX_FIND_ARC_FILES
     24009**PROC    23886--CALL
FLX_INTERPRET_NODES
     23917**PROC    23873--CALL
FLX_MAKE_NEW_ARCHIVE_TAPES
     25035**PROC    23890--CALL
FLX_OUTPUT_SUMMARY
     26695**PROC    23894--CALL
FLX_PROCESS_TAPE_SOURCE_FILE IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25595**PROC    25518--CALL
FLX_REMOVE_VOL IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     26220**PROC    25496--CALL    25528--CALL
FLX_REPORT_PARTIAL_FILE IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     26168**PROC    25384--CALL    25475--CALL    25733--CALL
FLX_UPDATE_ARC_FILES
     26252**PROC    25378--CALL    25463--CALL    25722--CALL    25847--CALL    26056--CALL    26066--CALL
     26799--CALL
FM$GRAN
     21610**DCL     25663--ASSIGN  26566--ASSIGN
FMSEC
     15016**DCL     23770<<ASSIGN  23772<<ASSIGN  23775>>IF      23820>>IF
FORCE IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25903**DCL     25897--PROC    25944>>IF
FORCE_NEW_OUT_BLK IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25189**DCL     25649<<ASSIGN  25650<<ASSIGN  25651<>CALL
FOUND IN PROCEDURE FLX_FIND_ARC_FILES
     24072**DCL     24689<<ASSIGN  24690>>DOWHILE 24692<<ASSIGN  24695>>IF      24843<<ASSIGN  24844>>DOWHILE
     24846<<ASSIGN  24849>>IF      24939<<ASSIGN  24944<<ASSIGN  24947>>IF
FOUND_PACKED_FILE IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25182**DCL     25335<<ASSIGN  25337>>DOWHILE 25404<<ASSIGN
FPARAM_
     21319**DCL     23880<>CALL    24624>>ASSIGN  25237>>ASSIGN  25857<>CALL    26520>>ASSIGN
FPARAM_.PTR$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:416  
     21321**DCL     24830>>ASSIGN  26565>>ASSIGN  26566>>ASSIGN  26635<>CALL    27053<>CALL
FPT_EXIT.V.STEPCC#
     14486**DCL     14486--REDEF
FPT_INT
     21662**DCL     23763<>CALL
FPT_INT.V
     21662**DCL     21662--DCLINIT
FROM_DISK_ACCT
     15592**DCL     16116--DCLINIT
FROM_DISK_NAME
     15566**DCL     16112--DCLINIT
FROM_DISK_SN
     15618**DCL     16111--DCLINIT
FROM_SN_LIST
     22942**DCL     25013--ASSIGN
FROM_SN_LIST.NUM#
     22942**DCL     24779--ASSIGN  24781<<ASSIGN  24844>>DOWHILE 24851<<ASSIGN  24852>>IF      24902>>ASSIGN
     24903<<ASSIGN  24904>>IF      24940>>DOINDEX 24980>>DOINDEX 24987<<ASSIGN  25002>>DOINDEX 25003>>DOINDEX
     25014>>ASSIGN  25014--ASSIGN  25483>>IF      26240>>DOINDEX 26244<<ASSIGN
FROM_SN_LIST.SN#
     22942**DCL     24779--ASSIGN  24845>>IF      24854--ASSIGN  24859<<ASSIGN  24906--ASSIGN  24911<<ASSIGN
     24912--ASSIGN  24941>>IF      24943<<ASSIGN  24981>>IF      24983<<ASSIGN  24983>>ASSIGN  25004>>IF
     25004>>IF      25006>>ASSIGN  25007<<ASSIGN  25007>>ASSIGN  25008<<ASSIGN  25014--ASSIGN  26241<<ASSIGN
     26241>>ASSIGN
FROM_SN_LIST$
     21423**DCL     22942--IMP-PTR 23935<<ASSIGN  23972<<ASSIGN  24776>>IF      24780<>CALL    24781>>ASSIGN
     24844>>DOWHILE 24845>>IF      24851>>ASSIGN  24852>>IF      24859>>ASSIGN  24902>>ASSIGN  24903>>ASSIGN
     24904>>IF      24911>>ASSIGN  24912>>ASSIGN  24940>>DOINDEX 24941>>IF      24943>>ASSIGN  24980>>DOINDEX
     24981>>IF      24983>>ASSIGN  24983>>ASSIGN  24987>>ASSIGN  25002>>DOINDEX 25003>>DOINDEX 25004>>IF
     25004>>IF      25006>>ASSIGN  25007>>ASSIGN  25007>>ASSIGN  25008>>ASSIGN  25013>>ASSIGN  25014>>ASSIGN
     25483>>IF      26240>>DOINDEX 26241>>ASSIGN  26241>>ASSIGN  26244>>ASSIGN
FSN IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25086**DCL     25375<>CALL    25459<>CALL    25668>>ASSIGN  25669>>ASSIGN  25857<>CALL    25956>>ASSIGN
     26035<>CALL    26073<>CALL
FSN_LIST_NAME
     23649**DCL     23390--DCLINIT
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:417  
GETTING_SET IN PROCEDURE FLX_FIND_ARC_FILES
     24031**DCL     24552--ASSIGN
GETTING_SET.PSN IN PROCEDURE FLX_FIND_ARC_FILES
     24033**DCL     24551<<ASSIGN
GET_NXT_VOL IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25198**DCL     25518<>CALL    25520>>IF
GET_NXT_VOL IN PROCEDURE FLX_PROCESS_TAPE_SOURCE_FILE
     25602**DCL     25595--PROC    25608<<ASSIGN  25750<<ASSIGN  25778<<ASSIGN
GET_PSN
     22975**DCL     24545<>CALL
GET_PSN.V
     22976**DCL     22975--DCLINIT
GREETINGS
     21311**DCL     23689--DCLINIT 23690--DCLINIT
GREETINGS.VERSION
     21313**DCL     23796<<ASSIGN
GREET_USER
     23688**DCL     23797<>CALL
GREET_USER.STATION_
     23690**DCL     23690--REDEF
GREET_USER.V
     23691**DCL     23688--DCLINIT
GREET_USER.V.DVBYTE.VFC#
     23697**DCL     23697--REDEF
I
     21310**DCL     23957<<DOINDEX 23958>>ASSIGN  23958>>ASSIGN  23958>>ASSIGN  24578<<DOINDEX 24579>>ASSIGN
     24579>>ASSIGN  24962<<DOINDEX 24963>>IF      24966>>ASSIGN  24967>>ASSIGN  24980<<DOINDEX 24981>>IF
     24983>>ASSIGN  26240<<DOINDEX 26241>>ASSIGN  26891<<DOINDEX 26892>>ASSIGN  26892>>ASSIGN  26912<<DOINDEX
     26913>>ASSIGN  26922<<DOINDEX 26923>>ASSIGN  26923>>ASSIGN  26931<<DOINDEX 26932>>ASSIGN
I IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25911**DCL     25954<<DOINDEX 25955>>ASSIGN  25956>>ASSIGN  25957>>ASSIGN  25958>>ASSIGN  25960>>ASSIGN
     25961>>ASSIGN  25991<<DOINDEX 25992>>ASSIGN  25993>>ASSIGN  25994>>ASSIGN  25995>>ASSIGN  25999<<DOINDEX
     26000>>IF      26004>>ASSIGN  26005>>ASSIGN  26008>>ASSIGN  26009>>ASSIGN  26011>>ASSIGN  26012>>ASSIGN
     26023<<DOINDEX 26024>>ASSIGN  26088<<DOINDEX 26089>>ASSIGN  26089>>ASSIGN  26090>>ASSIGN  26090>>ASSIGN
INBUF_
     21316**DCL     23881<>CALL    25264>>ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:418  
INBUF_.PTR$
     21318**DCL     25281>>ASSIGN  25754>>ASSIGN  25756>>ASSIGN  25763>>ASSIGN  25764>>ASSIGN  25766>>ASSIGN
INITIAL_ACCT IN PROCEDURE FLX_FIND_ARC_FILES
     24360**DCL     24633--ASSIGN  24798--ASSIGN
INITIAL_ACCT.ACCT# IN PROCEDURE FLX_FIND_ARC_FILES
     24360**DCL     24611<<ASSIGN
INITIAL_NAME IN PROCEDURE FLX_FIND_ARC_FILES
     24345**DCL     24632--ASSIGN  24797--ASSIGN  24886--ASSIGN
INITIAL_NAME.NAME# IN PROCEDURE FLX_FIND_ARC_FILES
     24345**DCL     24612<<ASSIGN
INPUT_FSN IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25199**DCL     25278<<ASSIGN  25480>>ASSIGN
IN_BLK_TAG
     21618**DCL     25619--ASSIGN  25754--ASSIGN  25764--ASSIGN  26117>>ASSIGN
IN_BLK_TAG.BEG
     21620**DCL     25623>>IF      25661>>IF
IN_BLK_TAG.BEGX
     21620**DCL     25660>>ASSIGN
IN_BLK_TAG.FIN
     21620**DCL     25368>>ASSIGN  25451>>ASSIGN  25698>>IF      25701>>ASSIGN  25703>>ASSIGN
IN_BLK_TAG.NAME
     21621**DCL     21621--REDEF   26213--CALL
IN_BLK_TAG.NAME.C
     21621**DCL     25814>>ASSIGN
IN_BLK_TAG.NAME.L
     21621**DCL     25815>>ASSIGN
IN_BLK_TAG.NBR
     21620**DCL     25763>>ASSIGN
IN_BLK_TAG.SIZE
     21620**DCL     25672>>ASSIGN
IN_BLK_TAG$
     21405**DCL     21618--IMP-PTR 25368>>ASSIGN  25451>>ASSIGN  25619<<ASSIGN  25619>>ASSIGN  25623>>IF
     25660>>ASSIGN  25661>>IF      25672>>ASSIGN  25698>>IF      25701>>ASSIGN  25703>>ASSIGN  25757<<ASSIGN
     25767<<ASSIGN  25814>>ASSIGN  25815>>ASSIGN  26117>>ASSIGN  26213>>CALL
IN_BLK_TAG0
     21630**DCL     25755--ASSIGN  25765--ASSIGN  26106>>ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:419  
IN_BLK_TAG0.NAME
     21633**DCL     21633--REDEF
IN_BLK_TAG0.WHERE.ACCT
     21633**DCL     25647>>IF      25813>>ASSIGN  26212>>ASSIGN
IN_BLK_TAG0.WHERE.PSN
     21633**DCL     25647>>IF      25812>>ASSIGN
IN_BLK_TAG0$
     21407**DCL     21630--IMP-PTR 25647>>IF      25647>>IF      25754<<ASSIGN  25755>>ASSIGN  25757>>ASSIGN
     25764<<ASSIGN  25765>>ASSIGN  25767>>ASSIGN  25812>>ASSIGN  25813>>ASSIGN  26106>>ASSIGN  26212>>ASSIGN
IN_BLK_TAG_IX
     21409**DCL     25606<<ASSIGN  25612>>DOWHILE 25618<<ASSIGN  25618>>ASSIGN  25758<<ASSIGN  25768<<ASSIGN
IN_BLK_TAG_IX_MAX
     21412**DCL     25605<<ASSIGN  25612>>DOWHILE 25754>>ASSIGN  25763<<ASSIGN  25764>>ASSIGN
IN_GRAN
     21642**DCL     26153>>ASSIGN
IN_GRAN$
     21413**DCL     21642--IMP-PTR 25660<<ASSIGN  25663>>ASSIGN  25672>>ASSIGN  25682>>IF      25692>>DOWHILE
     26153>>ASSIGN  26155<<ASSIGN  26155>>ASSIGN
IN_GRAN_BASE$
     21418**DCL     25281<<ASSIGN  25660>>ASSIGN  25755<<ASSIGN  25765<<ASSIGN
IN_GRAN_MAX$
     21415**DCL     25672<<ASSIGN  25677>>IF      25682>>IF      25692>>DOWHILE
IN_GRAN_MAX_CHK$
     21416**DCL     25677>>IF      25756<<ASSIGN  25766<<ASSIGN
IOERRORC IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25197**DCL     25247<<ASSIGN  25248>>ASSIGN  25249>>ASSIGN  25255<<ASSIGN  25256>>ASSIGN  25257>>ASSIGN
     25415>>IF      25424>>IF      25433>>IF      25433>>IF      25433>>IF      25467>>IF      25467>>IF
     25467>>IF      25479>>IF      25483>>IF      25483>>IF      25483>>IF      25520>>IF      25539>>IF
     25626>>IF      25626>>IF      25626>>IF      25677>>IF      25775>>IF      25775>>IF
JUSTALT IN PROCEDURE FLX_ACC_LINE
     27243**LABEL   27180--CALLALT 27185--CALLALT 27192--CALLALT 27212--CALLALT 27228--CALLALT 27239--CALLALT
     27242--CALLALT 27245--CALLALT
JUSTALT IN PROCEDURE FLX_ADD_ANOTHER_GRAN
     26159**LABEL   26148--CALLALT
JUSTALT IN PROCEDURE FLX_CHECK_ARC_LIST
     25885**LABEL   25837--CALLALT 25873--CALLALT 25885--CALLALT
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:420  
JUSTALT IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     26128**LABEL   25959--CALLALT 25975--CALLALT 25996--CALLALT 26013--CALLALT 26025--CALLALT 26034--CALLALT
     26056--CALLALT 26064--CALLALT 26065--CALLALT 26066--CALLALT 26068--CALLALT 26072--CALLALT
JUSTALT IN PROCEDURE FLX_COMPACT
     23896**LABEL   23873--CALLALT 23886--CALLALT 23890--CALLALT 23894--CALLALT
JUSTALT IN PROCEDURE FLX_INTERPRET_NODES
     24006**LABEL   23963--CALLALT 23994--CALLALT
JUSTALT IN PROCEDURE FLX_PROCESS_TAPE_SOURCE_FILE
     25792**LABEL   25643--CALLALT 25651--CALLALT 25693--CALLALT 25712--CALLALT 25751--GOTO    25779--GOTO
     25782--GOTO
JUSTRET IN PROCEDURE FLX_PROCESS_TAPE_SOURCE_FILE
     25789**LABEL   25759--GOTO
LAST_BLK_ARC_LIST_KEY IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25921**DCL     25961<<ASSIGN  25973--ASSIGN  26067--ASSIGN
LAST_BLK_ARC_LIST_REC IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25930**DCL     25960<<ASSIGN  25974--ASSIGN
LAST_BLK_ARC_LIST_REC.NEW.FSN IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25936**DCL     25972<<ASSIGN
LAST_BLK_ARC_LIST_REC.NEW.REEL IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25935**DCL     25971<<ASSIGN
LAST_COLUMN IN PROCEDURE FLX_ACC_LINE
     27104**DCL     27195<<ASSIGN  27201>>IF      27203>>IF      27208>>ASSIGN  27211>>ASSIGN  27214>>ASSIGN
     27217<<ASSIGN  27219>>CALLBLT 27223>>IF      27224>>ASSIGN  27235>>ASSIGN  27238>>ASSIGN  27241>>ASSIGN
     27244>>ASSIGN
LAST_SNLISTINFO$
     14469**DCL     21539--IMP-PTR 23972>>ASSIGN  23976>>ASSIGN  23977>>ASSIGN  23989>>ASSIGN  23990<<ASSIGN
     23996>>ASSIGN  26903>>ASSIGN
LAST_TSN_USED
     16366**DCL     25275<<ASSIGN  25979<<ASSIGN  26078>>IF      26080>>IF
M$ARC_FILE
     21218**DCL     23800--ASSIGN  23885--ASSIGN  23893--ASSIGN
M$ARC_FILE$
     21398**DCL     23800<<ASSIGN  24439--IMP-PTR 24719>>IF      24811>>IF      24826>>ASSIGN  24827>>ASSIGN
     24828>>ASSIGN  24834>>IF      24839>>IF      26564>>IF      26582>>IF      26596>>ASSIGN  26620>>ASSIGN
     26635<>CALL    26968>>IF      27053<>CALL
M$ARC_LIST
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:421  
     21219**DCL     23802--ASSIGN
M$ARC_LIST$
     21400**DCL     23802<<ASSIGN  25023>>IF      25574>>IF      26960>>IF      27077>>IF
M$ARC_LIST2
     21220**DCL     23803--ASSIGN
M$ARC_LIST2$
     21401**DCL     23803<<ASSIGN  26676>>IF
M$CLOSE
      5502**DCL-ENT 23781--CALL    23898--CALL    23908--CALL    24581--CALL    24714--CALL    24721--CALL
     24928--CALL    25025--CALL    25406--CALL    25502--CALL    25507--CALL    25523--CALL    25537--CALL
     25568--CALL    25576--CALL    25585--CALL    26544--CALL    26585--CALL    26599--CALL    26625--CALL
     26655--CALL    26662--CALL    26678--CALL    26686--CALL    26793--CALL    26944--CALL    26962--CALL
     26970--CALL    27055--CALL    27065--CALL    27079--CALL
M$DELREC
      5504**DCL-ENT 26065--CALL
M$DEVICE
      5506**DCL-ENT 23789--CALL    26801--CALL
M$DO
     21215**DCL     23790--IF      23792>>ASSIGN  23853<>CALL
M$EFT_ERRORS
     21222**DCL     23754--ASSIGN
M$EFT_ERRORS$
     21403**DCL     23754<<ASSIGN  23779>>IF      23896>>IF      23906>>IF
M$EXIT
      5514**DCL-ENT 23838--CALL
M$FSN_LIST
     21221**DCL     23804--ASSIGN
M$FSN_LIST$
     21402**DCL     23804<<ASSIGN  25504>>IF      25582>>IF      26660>>IF      26684>>IF
M$INT
      5557**DCL-ENT 23763--CALL
M$LO
     21214**DCL     23831<>CALL    23849<>CALL    27181--ASSIGN
M$MADMUCK
      5510**DCL-ENT 24545--CALL
M$OPEN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:422  
      5502**DCL-ENT 23788--CALL    23793--CALL    24554--CALL    24643--CALL    24650--CALL    24767--CALL
     24807--CALL    25311--CALL    25319--CALL    25341--CALL    25360--CALL    25388--CALL    26522--CALL
     26562--CALL    26591--CALL    26609--CALL    26628--CALL    26758--CALL    26933--CALL    27032--CALL
     27051--CALL
M$PFIL
      5504**DCL-ENT 26532--CALL    26548--CALL
M$PRECORD
      5506**DCL-ENT 26064--CALL
M$READ
      5503**DCL-ENT 24556--CALL    24561--CALL    24655--CALL    24661--CALL    24663--CALL    25706--CALL
     25741--CALL    25824--CALL    26540--CALL    26553--CALL    26763--CALL    27043--CALL
M$REM
      5511**DCL-ENT 26236--CALL
M$RPRIV
      5561**DCL-ENT 23773--CALL    23821--CALL
M$SPRIV
      5561**DCL-ENT 23842--CALL
M$TAPE00
     21217**DCL     23805--ASSIGN
M$TAPE00$
     16260**DCL     23805<<ASSIGN  26874>>ASSIGN  26875>>ASSIGN  26876>>ASSIGN  26877>>ASSIGN  26896>>IF
     26900>>ASSIGN
M$TAPE_SOURCE
     21216**DCL     23801--ASSIGN  23889--ASSIGN  23975>>ASSIGN
M$TAPE_SOURCE$
     21399**DCL     23801<<ASSIGN  25342>>IF      25347>>IF      25348>>ASSIGN  25353>>ASSIGN  25362>>IF
     25402>>IF      25402>>IF      25424>>IF      25483>>IF      25492>>ASSIGN  25515>>ASSIGN  25516>>ASSIGN
     25522>>IF      25535>>IF      25566>>IF      25708>>IF      25756>>ASSIGN  25766>>ASSIGN  25828>>IF
     25828>>IF      25828>>IF      26235>>ASSIGN  26240>>DOINDEX
M$WRITE
      5503**DCL-ENT 23797--CALL    24553--CALL    24583--CALL    24587--CALL    24745--CALL    24752--CALL
     24757--CALL    24868--CALL    24958--CALL    24968--CALL    24994--CALL    25873--CALL    25885--CALL
     25959--CALL    25975--CALL    25996--CALL    26013--CALL    26025--CALL    26068--CALL    26936--CALL
     26939--CALL    27039--CALL    27180--CALL    27185--CALL    27192--CALL    27212--CALL    27228--CALL
     27239--CALL    27242--CALL    27245--CALL
M$XXX
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:423  
      5514**DCL-ENT 23761--CALL    23785--CALL    23862--CALL    25680--CALL
MAX_NBR_SNS IN PROCEDURE FLX_FIND_ARC_FILES
     24073**DCL     24639<<ASSIGN  24698>>IF      24703<<ASSIGN  24703>>ASSIGN  24782<<ASSIGN  24852>>IF
     24857<<ASSIGN  24857>>ASSIGN  24904>>IF      24909<<ASSIGN  24909>>ASSIGN  24937<<ASSIGN  24950<<ASSIGN
     24950>>ASSIGN  24953>>IF
N IN PROCEDURE FLX_ACC_LINE
     27115**DCL     27171--IMP-SIZ 27177<<CALLBLT 27178>>ASSIGN  27190>>ASSIGN  27226<<CALLBLT 27227>>ASSIGN
NAME_ IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25079**DCL     25857<>CALL
NBRFAS
     21309**DCL     24619<<ASSIGN  24809<<ASSIGN  24809>>ASSIGN  24927<>CALL    25279>>ASSIGN
NBRFAS IN PROCEDURE FLX_OUTPUT_SUMMARY
     26705**DCL     26747<<ASSIGN  26771<<ASSIGN  26771>>ASSIGN  26831<>CALL
NBRFAS_FOUND IN PROCEDURE FLX_OUTPUT_SUMMARY
     26706**DCL     26748<<ASSIGN  26785<<ASSIGN  26785>>ASSIGN  26819<>CALL    26821<>CALL
NBRFAS_FOUND_UNUPDATED
     21308**DCL     25277<<ASSIGN  26640<<ASSIGN  26640>>ASSIGN  26808>>IF      26812<>CALL    26814<>CALL
NBRFAS_FOUND_UPDATED
     21307**DCL     25276<<ASSIGN  26633<<ASSIGN  26633>>ASSIGN  26805<>CALL    26807<>CALL
NBRFAS_PACKSET IN PROCEDURE FLX_FIND_ARC_FILES
     24066**DCL     24620<<ASSIGN  24799<<ASSIGN  24810<<ASSIGN  24810>>ASSIGN  24881<>CALL    24897>>IF
NBRFAS_PACKSET_ACTIVE IN PROCEDURE FLX_FIND_ARC_FILES
     24067**DCL     24621<<ASSIGN  24800<<ASSIGN  24818<<ASSIGN  24818>>ASSIGN  24880<>CALL
NBRFAS_PACKSET_INACTIVE IN PROCEDURE FLX_FIND_ARC_FILES
     24068**DCL     24622<<ASSIGN  24801<<ASSIGN  24814<<ASSIGN  24814>>ASSIGN  24879<>CALL
NBRFAS_UNFOUND IN PROCEDURE FLX_OUTPUT_SUMMARY
     26707**DCL     26749<<ASSIGN  26774<<ASSIGN  26774>>ASSIGN  26822>>IF      26826<>CALL    26828<>CALL
     26862>>IF
NBRFOT IN PROCEDURE FLX_OUTPUT_SUMMARY
     26709**DCL     26751<<ASSIGN  26772<<ASSIGN  26772>>ASSIGN  26859<>CALL    26861<>CALL
NBRFOT_UNIQUE IN PROCEDURE FLX_OUTPUT_SUMMARY
     26711**DCL     26753<<ASSIGN  26776<<ASSIGN  26776>>ASSIGN  26849<>CALL    26851<>CALL
NBRFOT_UNIQUE_FOUND IN PROCEDURE FLX_OUTPUT_SUMMARY
     26712**DCL     26754<<ASSIGN  26778<<ASSIGN  26778>>ASSIGN  26839<>CALL    26841<>CALL
NBRFOT_UNIQUE_UNFOUND IN PROCEDURE FLX_OUTPUT_SUMMARY
     26713**DCL     26755<<ASSIGN  26779<<ASSIGN  26779>>ASSIGN  26844<>CALL    26846<>CALL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:424  
NBRFOT_UNUNIQUE IN PROCEDURE FLX_OUTPUT_SUMMARY
     26710**DCL     26752<<ASSIGN  26780<<ASSIGN  26780>>ASSIGN  26854<>CALL    26856<>CALL
NBR_ARCH_FILES_TO_PROCESS IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25187**DCL     25279<<ASSIGN  25547>>IF      25699<<ASSIGN  25699>>ASSIGN
NBR_BYTES_TO_MOVE
     16273**DCL     16274--IMP-SIZ 16275--IMP-SIZ
NBR_DPS
     21306**DCL     23932<<ASSIGN  23952<<ASSIGN  23953>>ASSIGN  23956>>ASSIGN  23957>>DOINDEX 24573<<ASSIGN
     24574>>ASSIGN  24577>>ASSIGN  24578>>DOINDEX
NBR_FILE_BLOCKS
     16296**DCL     25330<<ASSIGN  25835>>IF      25865<<ASSIGN  26029<<ASSIGN  26029>>ASSIGN  26075<<ASSIGN
NBR_IN_OUT_BLK IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25190**DCL     25269<<ASSIGN  25653>>ASSIGN  25654>>ASSIGN  25655<<ASSIGN  25655>>ASSIGN  25954>>DOINDEX
     25999>>DOINDEX 26000>>IF      26023>>DOINDEX 26087>>ASSIGN  26088>>DOINDEX 26093<<ASSIGN
NBR_IN_PREV_OUT_BLK IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25191**DCL     25270<<ASSIGN  25991>>DOINDEX 26087<<ASSIGN
NBR_SNLISTS
     14473**DCL     23991<<ASSIGN  26867>>IF      26871>>ASSIGN  26904>>IF      26917>>IF
NBR_SUB_FILES IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25188**DCL     25266<<ASSIGN  25864<<ASSIGN  25868<<ASSIGN  25868>>ASSIGN
NCHARS IN PROCEDURE FLX_ACC_LINE
     27171**DCL     27178>>ASSIGN  27190>>ASSIGN  27227>>ASSIGN
NEW_BLOCK IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25186**DCL     25272<<ASSIGN  26094<<ASSIGN  26102>>IF      26115>>IF      26159<<ASSIGN
NEW_FILE IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25185**DCL     25271<<ASSIGN  25621>>IF      25686>>IF      25690<<ASSIGN  25703<<ASSIGN  25712<>CALL
     25732>>IF      25743<<ASSIGN  25753<<ASSIGN  26115>>IF
NEW_FSN IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25915**DCL     25982<<ASSIGN  25983<>CALL    25993>>ASSIGN  26009>>ASSIGN  26042<>CALL    26044<>CALL
NEW_TAPE_SN IN PROCEDURE FLX_UPDATE_ARC_FILES
     26511**DCL     26593--ASSIGN  26619--ASSIGN
NEW_TAPE_SN.SN# IN PROCEDURE FLX_UPDATE_ARC_FILES
     26511**DCL     26569<<ASSIGN
NEW_TSN IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     25914**DCL     25981<<ASSIGN  25983<>CALL    25989>>IF      25992>>ASSIGN  26008>>ASSIGN  26042<>CALL
     26044<>CALL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:425  
NIX IN PROCEDURE FLX_REMOVE_VOL
     26232**DCL     26239<<ASSIGN  26241>>ASSIGN  26242<<ASSIGN  26242>>ASSIGN  26244>>ASSIGN
NODATA_FILE_NAME.L#
     17888**DCL     17888--IMP-SIZ
NODATA_KEY
     18034**DCL     18026--DCLINIT 18027--DCLINIT
NODE$
     21252**DCL     21266--REDEF   23830<>CALL    23835>>DOCASE  23943>>DOINDEX 23944>>ASSIGN
NOT_INCLUDE_ERR IN PROCEDURE FLX_FIND_ARC_FILES
     24043**DCL     24751--ASSIGN
NOT_INCLUDE_ERR_OD IN PROCEDURE FLX_FIND_ARC_FILES
     24053**DCL     24750--ASSIGN
NOT_INCLUDE_NOTE IN PROCEDURE FLX_FIND_ARC_FILES
     24041**DCL     24744--ASSIGN
NOT_INCLUDE_NOTE_OD IN PROCEDURE FLX_FIND_ARC_FILES
     24051**DCL     24743--ASSIGN
NO_4_LEADING_ZEROS IN PROCEDURE FLX_ACC_LINE
     27162**DCL     27219>>CALLBLT
NO_ARCHIVE_FILE IN PROCEDURE FLX_FIND_ARC_FILES
     24075**DCL     24541<<ASSIGN  24593<<ASSIGN  24598<<ASSIGN  24603<<ASSIGN
NO_RPT_ERR IN PROCEDURE FLX_CHECK_CURRENT_GRAN
     26115**LABEL   25983--CALLALT 26042--CALLALT 26044--CALLALT
NO_RPT_ERR IN PROCEDURE FLX_PROCESS_TAPE_SOURCE_FILE
     25782**LABEL   25717--CALLALT 25722--CALLALT
NO_SOURCE_ODS IN PROCEDURE FLX_FIND_ARC_FILES
     24055**DCL     24992--ASSIGN
NO_SOURCE_TAPES IN PROCEDURE FLX_FIND_ARC_FILES
     24047**DCL     24993--ASSIGN
NSX IN PROCEDURE FLX_FIND_ARC_FILES
     24070**DCL     24585<<DOINDEX 24586>>ASSIGN  24678<<DOINDEX 24680>>IF      24688<<ASSIGN  24690>>DOWHILE
     24691>>IF      24693<<ASSIGN  24693>>ASSIGN  24697>>ASSIGN  24705>>ASSIGN  24755<<DOINDEX 24756>>ASSIGN
     24842<<ASSIGN  24844>>DOWHILE 24845>>IF      24847<<ASSIGN  24847>>ASSIGN  24851>>ASSIGN  24859>>ASSIGN
     24902<<ASSIGN  24903>>ASSIGN  24911>>ASSIGN  24912>>ASSIGN  24940<<DOINDEX 24941>>IF      24943>>ASSIGN
     24979<<ASSIGN  24983>>ASSIGN  24984<<ASSIGN  24984>>ASSIGN  24987>>ASSIGN  24989>>IF      25000>>IF
     25002<<DOINDEX 25003>>DOINDEX 25004>>IF      25006>>ASSIGN  25007>>ASSIGN
NUMBER IN PROCEDURE FLX_ACC_LINE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:426  
     27095**DCL     27089--PROC    27175--IF      27218>>CALLBLT
ODSN_LINE IN PROCEDURE FLX_FIND_ARC_FILES
     24028**DCL     24960--ASSIGN
ODSN_LINE.TSN IN PROCEDURE FLX_FIND_ARC_FILES
     24030**DCL     24966<<ASSIGN
OD_DEST
     21427**DCL     23931<<ASSIGN  23998<<ASSIGN  24742>>IF      24749>>IF      25295>>IF      25667>>IF
     25978>>IF      26078>>IF      26571>>IF      26803>>IF      26837>>IF      26886>>IF
OD_SOURCE
     21426**DCL     23930<<ASSIGN  23987<<ASSIGN  24840<<ASSIGN  24955>>IF      24959>>IF      24965>>IF
     24991>>IF      25242>>IF      26810>>IF      26817>>IF      26824>>IF      26832>>IF      26842>>IF
     26847>>IF      26852>>IF      26857>>IF      27034>>IF
OMIT_SN_LIST.NUM#
     22927**DCL     24937>>ASSIGN  24938>>DOINDEX 24962>>DOINDEX
OMIT_SN_LIST.SN#
     22927**DCL     24941>>IF      24949<<ASSIGN  24963>>IF      24966>>ASSIGN  24967>>ASSIGN
OMIT_SN_LIST$
     21422**DCL     22927--IMP-PTR 23934<<ASSIGN  23989<<ASSIGN  24935>>IF      24937>>ASSIGN  24938>>DOINDEX
     24941>>IF      24949>>ASSIGN  24962>>DOINDEX 24963>>IF      24966>>ASSIGN  24967>>ASSIGN
OPEN_ARCHIVE_EFT
     23086**DCL     24554<>CALL    24650<>CALL    26933<>CALL
OPEN_ARCHIVE_EFT.ACSVEH_
     23088**DCL     23089--REDEF
OPEN_ARCHIVE_EFT.ALTKEYS_
     23094**DCL     23095--REDEF   23095--REDEF
OPEN_ARCHIVE_EFT.HDR_
     23093**DCL     23094--REDEF
OPEN_ARCHIVE_EFT.TAB_
     23092**DCL     23093--REDEF
OPEN_ARCHIVE_EFT.UHL_
     23086**DCL     23087--REDEF   23087--REDEF
OPEN_ARCHIVE_EFT.V
     23095**DCL     23086--DCLINIT
OPEN_ARCHIVE_EFT.V.EXIST#
     23099**DCL     26930<<ASSIGN
OPEN_ARCHIVE_EFT.V.FSN#
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:427  
     23126**DCL     23126--REDEF   23126--REDEF
OPEN_ARCHIVE_EFT.V.FUN#
     23105**DCL     26929<<ASSIGN
OPEN_ARCHIVE_EFT.WSN_
     23092**DCL     23092--REDEF
OPEN_ARC_FILE
     22605**DCL     26562<>CALL    26591<>CALL    26609<>CALL    26628<>CALL    27051<>CALL
OPEN_ARC_FILE.ACSVEH_
     22607**DCL     22608--REDEF
OPEN_ARC_FILE.ALTKEYS_
     22613**DCL     22614--REDEF   22614--REDEF
OPEN_ARC_FILE.FPARAM_
     22610**DCL     26520<<ASSIGN
OPEN_ARC_FILE.HDR_
     22612**DCL     22613--REDEF
OPEN_ARC_FILE.TAB_
     22611**DCL     22612--REDEF
OPEN_ARC_FILE.UHL_
     22605**DCL     22606--REDEF   22606--REDEF
OPEN_ARC_FILE.V
     22614**DCL     22605--DCLINIT
OPEN_ARC_FILE.V.ACS#
     22625**DCL     26590<<ASSIGN  26608<<ASSIGN
OPEN_ARC_FILE.V.FSN#
     22645**DCL     22645--REDEF   22645--REDEF
OPEN_ARC_FILE.V.FUN#
     22624**DCL     26589<<ASSIGN  26607<<ASSIGN
OPEN_ARC_FILE.V.OPER.TEST#
     22616**DCL     26627<<ASSIGN  26632<<ASSIGN
OPEN_ARC_FILE.WSN_
     22611**DCL     22611--REDEF
OPEN_ARC_LIST
     22321**DCL     25311<>CALL    26758<>CALL    27032<>CALL
OPEN_ARC_LIST.ACSVEH_
     22323**DCL     22324--REDEF
OPEN_ARC_LIST.ALTKEYS_
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:428  
     22329**DCL     22330--REDEF   22330--REDEF
OPEN_ARC_LIST.HDR_
     22328**DCL     22329--REDEF
OPEN_ARC_LIST.TAB_
     22327**DCL     22328--REDEF
OPEN_ARC_LIST.UHL_
     22321**DCL     22322--REDEF   22322--REDEF
OPEN_ARC_LIST.V
     22330**DCL     22321--DCLINIT
OPEN_ARC_LIST.V.FSN#
     22361**DCL     22361--REDEF   22361--REDEF
OPEN_ARC_LIST.WSN_
     22327**DCL     22327--REDEF
OPEN_ARC_LIST IN PROCEDURE FLX_FIND_ARC_FILES
     24273**DCL     24767<>CALL
OPEN_ARC_LIST.ACSVEH_ IN PROCEDURE FLX_FIND_ARC_FILES
     24275**DCL     24276--REDEF
OPEN_ARC_LIST.ALTKEYS_ IN PROCEDURE FLX_FIND_ARC_FILES
     24281**DCL     24282--REDEF   24282--REDEF
OPEN_ARC_LIST.HDR_ IN PROCEDURE FLX_FIND_ARC_FILES
     24280**DCL     24281--REDEF
OPEN_ARC_LIST.TAB_ IN PROCEDURE FLX_FIND_ARC_FILES
     24279**DCL     24280--REDEF
OPEN_ARC_LIST.UHL_ IN PROCEDURE FLX_FIND_ARC_FILES
     24273**DCL     24274--REDEF   24274--REDEF
OPEN_ARC_LIST.V IN PROCEDURE FLX_FIND_ARC_FILES
     24282**DCL     24273--DCLINIT
OPEN_ARC_LIST.V.FSN# IN PROCEDURE FLX_FIND_ARC_FILES
     24313**DCL     24313--REDEF   24313--REDEF
OPEN_ARC_LIST.WSN_ IN PROCEDURE FLX_FIND_ARC_FILES
     24279**DCL     24279--REDEF
OPEN_ARC_LIST_FSN IN PROCEDURE FLX_UPDATE_ARC_FILES
     26361**DCL     26522<>CALL
OPEN_ARC_LIST_FSN.ACSVEH_ IN PROCEDURE FLX_UPDATE_ARC_FILES
     26363**DCL     26364--REDEF
OPEN_ARC_LIST_FSN.ALTKEYS_ IN PROCEDURE FLX_UPDATE_ARC_FILES
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:429  
     26369**DCL     26370--REDEF   26370--REDEF
OPEN_ARC_LIST_FSN.HDR_ IN PROCEDURE FLX_UPDATE_ARC_FILES
     26368**DCL     26369--REDEF
OPEN_ARC_LIST_FSN.TAB_ IN PROCEDURE FLX_UPDATE_ARC_FILES
     26367**DCL     26368--REDEF
OPEN_ARC_LIST_FSN.UHL_ IN PROCEDURE FLX_UPDATE_ARC_FILES
     26361**DCL     26362--REDEF   26362--REDEF
OPEN_ARC_LIST_FSN.V IN PROCEDURE FLX_UPDATE_ARC_FILES
     26370**DCL     26361--DCLINIT
OPEN_ARC_LIST_FSN.V.FSN# IN PROCEDURE FLX_UPDATE_ARC_FILES
     26401**DCL     26401--REDEF   26401--REDEF
OPEN_ARC_LIST_FSN.WSN_ IN PROCEDURE FLX_UPDATE_ARC_FILES
     26367**DCL     26367--REDEF
OPEN_BLOCK_FILE.ACSVEH_
     16113**DCL     16114--REDEF
OPEN_BLOCK_FILE.ALTKEYS_
     16119**DCL     16120--REDEF   16120--REDEF
OPEN_BLOCK_FILE.HDR_
     16118**DCL     16119--REDEF
OPEN_BLOCK_FILE.TAB_
     16117**DCL     16118--REDEF
OPEN_BLOCK_FILE.UHL_
     16111**DCL     16112--REDEF   16112--REDEF
OPEN_BLOCK_FILE.V
     16120**DCL     16111--DCLINIT
OPEN_BLOCK_FILE.V.FSN#
     16151**DCL     16151--REDEF   16151--REDEF
OPEN_BLOCK_FILE.WSN_
     16117**DCL     16117--REDEF
OPEN_BY_FSN IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25194**DCL     25331<<ASSIGN  25338>>IF      25355<<ASSIGN  25493<<ASSIGN  25498<<ASSIGN  25530<<ASSIGN
OPEN_FSN_LIST
     23389**DCL     25319<>CALL
OPEN_FSN_LIST.ACSVEH_
     23391**DCL     23392--REDEF
OPEN_FSN_LIST.ALTKEYS_
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:430  
     23397**DCL     23398--REDEF   23398--REDEF
OPEN_FSN_LIST.HDR_
     23396**DCL     23397--REDEF
OPEN_FSN_LIST.TAB_
     23395**DCL     23396--REDEF
OPEN_FSN_LIST.UHL_
     23389**DCL     23390--REDEF   23390--REDEF
OPEN_FSN_LIST.V
     23398**DCL     23389--DCLINIT
OPEN_FSN_LIST.V.FSN#
     23429**DCL     23429--REDEF   23429--REDEF
OPEN_FSN_LIST.WSN_
     23395**DCL     23395--REDEF
OPEN_LO_DO
     22870**DCL     23788<>CALL    23793<>CALL
OPEN_LO_DO.ACSVEH_
     22872**DCL     22873--REDEF
OPEN_LO_DO.ALTKEYS_
     22878**DCL     22879--REDEF   22879--REDEF
OPEN_LO_DO.HDR_
     22877**DCL     22878--REDEF
OPEN_LO_DO.TAB_
     22876**DCL     22877--REDEF
OPEN_LO_DO.UHL_
     22870**DCL     22871--REDEF   22871--REDEF
OPEN_LO_DO.V
     22879**DCL     22870--DCLINIT
OPEN_LO_DO.V.DCB#
     22879**DCL     23792<<ASSIGN
OPEN_LO_DO.V.FSN#
     22910**DCL     22910--REDEF   22910--REDEF
OPEN_LO_DO.WSN_
     22876**DCL     22876--REDEF
OPEN_NEXT_ARC_FILE IN PROCEDURE FLX_FIND_ARC_FILES
     24156**DCL     24643<>CALL    24807<>CALL
OPEN_NEXT_ARC_FILE.ACCT_ IN PROCEDURE FLX_FIND_ARC_FILES
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:431  
     24160**DCL     24633<<ASSIGN  24798<<ASSIGN  24822<<ASSIGN  24872<<ASSIGN
OPEN_NEXT_ARC_FILE.ACSVEH_ IN PROCEDURE FLX_FIND_ARC_FILES
     24158**DCL     24159--REDEF
OPEN_NEXT_ARC_FILE.ALTKEYS_ IN PROCEDURE FLX_FIND_ARC_FILES
     24164**DCL     24165--REDEF   24165--REDEF
OPEN_NEXT_ARC_FILE.FPARAM_ IN PROCEDURE FLX_FIND_ARC_FILES
     24161**DCL     24624<<ASSIGN
OPEN_NEXT_ARC_FILE.HDR_ IN PROCEDURE FLX_FIND_ARC_FILES
     24163**DCL     24164--REDEF
OPEN_NEXT_ARC_FILE.NAME_ IN PROCEDURE FLX_FIND_ARC_FILES
     24157**DCL     24632<<ASSIGN  24797<<ASSIGN  24821<<ASSIGN  24886<<ASSIGN
OPEN_NEXT_ARC_FILE.TAB_ IN PROCEDURE FLX_FIND_ARC_FILES
     24162**DCL     24163--REDEF
OPEN_NEXT_ARC_FILE.UHL_ IN PROCEDURE FLX_FIND_ARC_FILES
     24156**DCL     24157--REDEF   24157--REDEF
OPEN_NEXT_ARC_FILE.V IN PROCEDURE FLX_FIND_ARC_FILES
     24165**DCL     24156--DCLINIT
OPEN_NEXT_ARC_FILE.V.FSN# IN PROCEDURE FLX_FIND_ARC_FILES
     24196**DCL     24196--REDEF   24196--REDEF
OPEN_NEXT_ARC_FILE.V.OPER.NXTA# IN PROCEDURE FLX_FIND_ARC_FILES
     24168**DCL     24634<<ASSIGN  24796<<ASSIGN  24823<<ASSIGN  24885<<ASSIGN
OPEN_NEXT_ARC_FILE.WSN_ IN PROCEDURE FLX_FIND_ARC_FILES
     24162**DCL     24162--REDEF
OPEN_NODATA_LIST.ACSVEH_
     17821**DCL     17822--REDEF
OPEN_NODATA_LIST.ALTKEYS_
     17827**DCL     17828--REDEF   17828--REDEF
OPEN_NODATA_LIST.HDR_
     17826**DCL     17827--REDEF
OPEN_NODATA_LIST.TAB_
     17825**DCL     17826--REDEF
OPEN_NODATA_LIST.UHL_
     17819**DCL     17820--REDEF   17820--REDEF
OPEN_NODATA_LIST.V.FSN#
     17859**DCL     17859--REDEF   17859--REDEF
OPEN_NODATA_LIST.WSN_
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:432  
     17825**DCL     17825--REDEF
OPEN_PRIME_DUAL.ACSVEH_
     17268**DCL     17269--REDEF
OPEN_PRIME_DUAL.ALTKEYS_
     17274**DCL     17275--REDEF   17275--REDEF
OPEN_PRIME_DUAL.HDR_
     17273**DCL     17274--REDEF
OPEN_PRIME_DUAL.TAB_
     17272**DCL     17273--REDEF
OPEN_PRIME_DUAL.UHL_
     17266**DCL     17267--REDEF   17267--REDEF
OPEN_PRIME_DUAL.V.FSN#
     17306**DCL     17306--REDEF   17306--REDEF
OPEN_PRIME_DUAL.WSN_
     17272**DCL     17272--REDEF
OPEN_REBUILD.ACSVEH_
     17503**DCL     17504--REDEF
OPEN_REBUILD.ALTKEYS_
     17509**DCL     17510--REDEF   17510--REDEF
OPEN_REBUILD.HDR_
     17508**DCL     17509--REDEF
OPEN_REBUILD.TAB_
     17507**DCL     17508--REDEF
OPEN_REBUILD.UHL_
     17501**DCL     17502--REDEF   17502--REDEF
OPEN_REBUILD.V.FSN#
     17541**DCL     17541--REDEF   17541--REDEF
OPEN_REBUILD.WSN_
     17507**DCL     17507--REDEF
OPEN_STATUS.ACSVEH_
     16705**DCL     16706--REDEF
OPEN_STATUS.ALTKEYS_
     16711**DCL     16712--REDEF   16712--REDEF
OPEN_STATUS.HDR_
     16710**DCL     16711--REDEF
OPEN_STATUS.TAB_
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:433  
     16709**DCL     16710--REDEF
OPEN_STATUS.UHL_
     16703**DCL     16704--REDEF   16704--REDEF
OPEN_STATUS.V.FSN#
     16743**DCL     16743--REDEF   16743--REDEF
OPEN_STATUS.WSN_
     16709**DCL     16709--REDEF
OPEN_TAPE_ALT IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25416**LABEL   25341--CALLALT 25344--GOTO    25395--GOTO    25417--GOTO
OPEN_TAPE_ALT10 IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25449**LABEL   25551--GOTO
OPEN_TAPE_SOURCE
     21737**DCL     23973<<ASSIGN  25341<>CALL    25360<>CALL    25388<>CALL
OPEN_TAPE_SOURCE.ACSVEH_
     21739**DCL     21740--REDEF
OPEN_TAPE_SOURCE.ALTKEYS_
     21745**DCL     21746--REDEF   21746--REDEF
OPEN_TAPE_SOURCE.FPARAM_
     21742**DCL     25237<<ASSIGN
OPEN_TAPE_SOURCE.HDR_
     21744**DCL     21745--REDEF
OPEN_TAPE_SOURCE.SN_
     21737**DCL     23979<<ASSIGN  25016<<ASSIGN
OPEN_TAPE_SOURCE.TAB_
     21743**DCL     21744--REDEF
OPEN_TAPE_SOURCE.UHL_
     21737**DCL     21738--REDEF   21738--REDEF
OPEN_TAPE_SOURCE.V
     21746**DCL     21737--DCLINIT 23974--ASSIGN
OPEN_TAPE_SOURCE.V.ACS#
     21757**DCL     25231<<ASSIGN
OPEN_TAPE_SOURCE.V.ASN#
     21756**DCL     25244<<ASSIGN  25252<<ASSIGN
OPEN_TAPE_SOURCE.V.CVOL#
     21751**DCL     25245<<ASSIGN  25253<<ASSIGN
OPEN_TAPE_SOURCE.V.DCB#
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:434  
     21746**DCL     23975<<ASSIGN  25381>>ASSIGN  25472>>ASSIGN  25635>>ASSIGN  25730>>ASSIGN
OPEN_TAPE_SOURCE.V.FINDPOS#
     21752**DCL     25236<<ASSIGN  25387<<ASSIGN  25390<<ASSIGN  25394<<ASSIGN
OPEN_TAPE_SOURCE.V.FSN#
     21777**DCL     21777--REDEF   21777--REDEF   25278>>ASSIGN  25348<<ASSIGN  25350>>IF      25353<<ASSIGN
     25399<<ASSIGN  25480<<ASSIGN
OPEN_TAPE_SOURCE.V.FUN#
     21756**DCL     25233<<ASSIGN
OPEN_TAPE_SOURCE.V.INITZ.SCRUB#
     21747**DCL     25232<<ASSIGN  25358<<ASSIGN  25401<<ASSIGN
OPEN_TAPE_SOURCE.V.IOERROK#
     21768**DCL     25248<<ASSIGN  25256<<ASSIGN
OPEN_TAPE_SOURCE.V.OPER.MNTONLY#
     21750**DCL     25340<<ASSIGN  25357<<ASSIGN
OPEN_TAPE_SOURCE.V.OPER.NXTF#
     21749**DCL     25234<<ASSIGN
OPEN_TAPE_SOURCE.V.OPER.THISF#
     21749**DCL     25235<<ASSIGN  25356<<ASSIGN  25386<<ASSIGN  25393<<ASSIGN  25398<<ASSIGN
OPEN_TAPE_SOURCE.V.RES#
     21761**DCL     25246<<ASSIGN  25254<<ASSIGN
OPEN_TAPE_SOURCE.V.VOL#
     21771**DCL     25400<<ASSIGN  25492<<ASSIGN  25497<<ASSIGN  25529<<ASSIGN
OPEN_TAPE_SOURCE.V_
     21737**DCL     23974<<ASSIGN
OPEN_TAPE_SOURCE.WSN_
     21743**DCL     21743--REDEF
OPEN_TSN_USED.ACSVEH_
     16441**DCL     16442--REDEF
OPEN_TSN_USED.ALTKEYS_
     16447**DCL     16448--REDEF   16448--REDEF
OPEN_TSN_USED.HDR_
     16446**DCL     16447--REDEF
OPEN_TSN_USED.TAB_
     16445**DCL     16446--REDEF
OPEN_TSN_USED.UHL_
     16439**DCL     16440--REDEF   16440--REDEF
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:435  
OPEN_TSN_USED.V.FSN#
     16479**DCL     16479--REDEF   16479--REDEF
OPEN_TSN_USED.WSN_
     16445**DCL     16445--REDEF
OPTION_CHECK
     21424**DCL     24674<<ASSIGN  26878>>ASSIGN
OPTION_IOERRORC
     21425**DCL     24675<<ASSIGN  26879>>ASSIGN
OSX IN PROCEDURE FLX_FIND_ARC_FILES
     24069**DCL     24679<<DOINDEX 24680>>IF      24681>>ASSIGN  24685<<DOINDEX 24686>>IF      24691>>IF
     24705>>ASSIGN  24938<<DOINDEX 24941>>IF      24949>>ASSIGN  25003<<DOINDEX 25004>>IF      25007>>ASSIGN
     25008>>ASSIGN
OUR_ACCT
     22993**DCL     22975--DCLINIT
OUR_ACCT.ACCT#
     22993**DCL     24544<<ASSIGN
OUT$BLK.CODE
     21456**DCL     23835>>DOCASE  23946>>DOCASE  23969>>IF      23969>>IF      23983>>IF      23983>>IF
     23986>>IF      23997>>IF
OUT$BLK.NSUBLKS
     21460**DCL     23943>>DOINDEX 23952>>ASSIGN
OUT$BLK.SUBLK$
     21481**DCL     23944>>ASSIGN  23958>>ASSIGN  23958>>ASSIGN  23963<>CALL    23981>>ASSIGN  23981>>ASSIGN
     23981>>ASSIGN
OUT$SYM.COUNT
     21517**DCL     21520--IMP-SIZ 23958>>ASSIGN
OUT$SYM.TEXT
     21520**DCL     23958>>ASSIGN
OUTBUF_
     16275**DCL     23882<>CALL    25948>>ASSIGN
OUTBUF_.PTR$
     16275**DCL     25282>>ASSIGN
OUTPUT_TAPE_OPEN IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25183**DCL     25265<<ASSIGN  25372>>IF      25456>>IF      25561>>IF      25715>>IF      25718<<ASSIGN
     25843<<ASSIGN  25855>>IF      25866<<ASSIGN
OUT_BLK_SIZE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:436  
     21305**DCL     23995<<ASSIGN  25285>>ASSIGN
OUT_BLK_TAG
     21624**DCL     26107--ASSIGN  26111--ASSIGN  26117<<ASSIGN
OUT_BLK_TAG.BEG
     21626**DCL     25689<<ASSIGN  26118<<ASSIGN
OUT_BLK_TAG.BEGX
     21626**DCL     25688<<ASSIGN  26121<<ASSIGN
OUT_BLK_TAG.FIN
     21626**DCL     25701<<ASSIGN  26054>>IF      26119<<ASSIGN
OUT_BLK_TAG.NAME
     21627**DCL     21627--REDEF
OUT_BLK_TAG.NBR
     21626**DCL     26122<<ASSIGN
OUT_BLK_TAG.SIZE
     21626**DCL     26120<<ASSIGN  26157<<ASSIGN  26157>>ASSIGN
OUT_BLK_TAG$
     21406**DCL     21624--IMP-PTR 25688>>ASSIGN  25689>>ASSIGN  25701>>ASSIGN  25949>>ASSIGN  25951>>ASSIGN
     26054>>IF      26107<<ASSIGN  26111<<ASSIGN  26111>>ASSIGN  26117>>ASSIGN  26118>>ASSIGN  26119>>ASSIGN
     26120>>ASSIGN  26121>>ASSIGN  26122>>ASSIGN  26157>>ASSIGN  26157>>ASSIGN
OUT_BLK_TAG0
     21636**DCL     25283--ASSIGN  26106<<ASSIGN
OUT_BLK_TAG0.NAME
     21639**DCL     21639--REDEF
OUT_BLK_TAG0.WHERE.ACCT
     21639**DCL     25647>>IF
OUT_BLK_TAG0.WHERE.PSN
     21639**DCL     25284<<ASSIGN  25647>>IF
OUT_BLK_TAG0$
     21408**DCL     21636--IMP-PTR 25283<<ASSIGN  25284>>ASSIGN  25647>>IF      25647>>IF      26106>>ASSIGN
     26107>>ASSIGN
OUT_BLK_TAG_IX
     21410**DCL     26108<<ASSIGN  26112<<ASSIGN  26112>>ASSIGN  26122>>ASSIGN
OUT_GRAN
     21643**DCL     26153<<ASSIGN
OUT_GRAN$
     21414**DCL     21643--IMP-PTR 25286<<ASSIGN  25944>>IF      25944>>IF      25949>>ASSIGN  26104<<ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:437  
     26147>>IF      26151<<ASSIGN  26151>>ASSIGN  26153>>ASSIGN
OUT_GRANX
     21411**DCL     25688>>ASSIGN  26105<<ASSIGN  26150<<ASSIGN  26150>>ASSIGN
OUT_GRAN_BASE$
     21419**DCL     25282<<ASSIGN  25283>>ASSIGN  25285>>ASSIGN  25286>>ASSIGN  25944>>IF      26104>>ASSIGN
OUT_GRAN_MAX$
     21417**DCL     25285<<ASSIGN  25944>>IF      26147>>IF
PACKSET_END IN PROCEDURE FLX_FIND_ARC_FILES
     24064**DCL     24803<<ASSIGN  24805>>DOWHILE 24876<<ASSIGN
PACKSET_ERR IN PROCEDURE FLX_FIND_ARC_FILES
     24714**LABEL   24648--GOTO    24655--CALLALT 24661--CALLALT 24714--CALLALT
PAGE_LO
     22772**DCL     23789<>CALL    26801<>CALL
PAGE_LO.V
     22773**DCL     22772--DCLINIT
PAGE_LO_HEADER
     22795**DCL     22773--DCLINIT
PFIL_FSN_LIST
     23570**DCL     26532<>CALL    26548<>CALL
PFIL_FSN_LIST.V
     23570**DCL     23570--DCLINIT
PRECORD_FSN_LIST
     23611**DCL     26064<>CALL
PRECORD_FSN_LIST.V
     23613**DCL     23611--DCLINIT
PREV_BLK_ARC_LIST_KEY
     21350**DCL     25994--ASSIGN  26089<<ASSIGN
PREV_BLK_ARC_LIST_REC
     21388**DCL     25995--ASSIGN  26090<<ASSIGN
PREV_BLK_ARC_LIST_REC.NEW.FSN
     21394**DCL     25993<<ASSIGN
PREV_BLK_ARC_LIST_REC.NEW.REEL
     21393**DCL     25992<<ASSIGN
PREV_REEL
     21420**DCL     25268<<ASSIGN  25666>>ASSIGN  25863<<ASSIGN  25955>>ASSIGN  26074<<ASSIGN
PRE_RET_CLOSE.SN_
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:438  
     15424**DCL     15424--REDEF
PRE_RET_CLOSE.UTL_
     15425**DCL     15425--REDEF
PRE_RET_CLOSE.V.EXPIRE#
     15439**DCL     15439--REDEF
PRE_RET_CLOSE.V.TYPE#
     15437**DCL     15437--REDEF
PRE_RET_CLOSE.V.XTNSIZE#
     15434**DCL     15434--REDEF   15436--REDEF
PRE_RET_OPEN.ACSVEH_
     15359**DCL     15360--REDEF
PRE_RET_OPEN.ALTKEYS_
     15365**DCL     15366--REDEF   15366--REDEF
PRE_RET_OPEN.HDR_
     15364**DCL     15365--REDEF
PRE_RET_OPEN.TAB_
     15363**DCL     15364--REDEF
PRE_RET_OPEN.UHL_
     15357**DCL     15358--REDEF   15358--REDEF
PRE_RET_OPEN.V.FSN#
     15397**DCL     15397--REDEF   15397--REDEF
PRE_RET_OPEN.WSN_
     15363**DCL     15363--REDEF
PRE_RET_READ.STATION_
     15214**DCL     15215--REDEF
PRE_RET_READ.V.DVBYTE.REREAD#
     15226**DCL     15226--REDEF
PRE_RET_READ.V.INDX#
     15224**DCL     15224--REDEF
PRE_RET_WRITE.STATION_
     15252**DCL     15252--REDEF
PRE_RET_WRITE.V.DVBYTE.VFC#
     15259**DCL     15259--REDEF
PRIME_FILE.L#
     17172**DCL     17172--IMP-SIZ
PSN_LINE IN PROCEDURE FLX_FIND_ARC_FILES
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:439  
     24022**DCL     24584--ASSIGN  24754--ASSIGN
PSN_LINE.PSN IN PROCEDURE FLX_FIND_ARC_FILES
     24024**DCL     24586<<ASSIGN  24756<<ASSIGN
PSN_TITLE IN PROCEDURE FLX_FIND_ARC_FILES
     24018**DCL     24878<>CALL
PSN_TITLE.PSN IN PROCEDURE FLX_FIND_ARC_FILES
     24020**DCL     24877<<ASSIGN
PSN_TO_BE_PROCESSED IN PROCEDURE FLX_FIND_ARC_FILES
     24045**DCL     24582--ASSIGN
READING_TAPE_SOURCE IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25181**DCL     25607<<ASSIGN  25610>>DOWHILE 25773<<ASSIGN
READ_AD_OR_FD.ACSVEH_
     16003**DCL     16004--REDEF
READ_AD_OR_FD.ALTKEYS_
     16009**DCL     16010--REDEF   16010--REDEF
READ_AD_OR_FD.HDR_
     16008**DCL     16009--REDEF
READ_AD_OR_FD.TAB_
     16007**DCL     16008--REDEF
READ_AD_OR_FD.UHL_
     16001**DCL     16002--REDEF   16002--REDEF
READ_AD_OR_FD.V.FSN#
     16041**DCL     16041--REDEF   16041--REDEF
READ_AD_OR_FD.WSN_
     16007**DCL     16007--REDEF
READ_ARCHIVE_EFT
     23150**DCL     24556<>CALL    24561<>CALL    24655<>CALL    24661<>CALL    24663<>CALL
READ_ARCHIVE_EFT.BUF_
     23152**DCL     24533<<ASSIGN  24654<<ASSIGN
READ_ARCHIVE_EFT.BUF_.BOUND
     23152**DCL     24559<<ASSIGN  24656<<ASSIGN
READ_ARCHIVE_EFT.BUF_.BUF$
     23153**DCL     24560<<ASSIGN  24658<<ASSIGN
READ_ARCHIVE_EFT.STATION_
     23153**DCL     23154--REDEF
READ_ARCHIVE_EFT.V
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:440  
     23154**DCL     23150--DCLINIT
READ_ARCHIVE_EFT.V.DVBYTE.REREAD#
     23165**DCL     23165--REDEF
READ_ARCHIVE_EFT.V.INDX#
     23163**DCL     23163--REDEF
READ_ARC_LIST
     22509**DCL     26763<>CALL    27043<>CALL
READ_ARC_LIST.STATION_
     22512**DCL     22513--REDEF
READ_ARC_LIST.V
     22513**DCL     22509--DCLINIT
READ_ARC_LIST.V.DVBYTE.REREAD#
     22524**DCL     22524--REDEF
READ_ARC_LIST.V.INDX#
     22522**DCL     22522--REDEF
READ_ARC_LIST_BY_KEY
     22389**DCL     25824<>CALL
READ_ARC_LIST_BY_KEY.STATION_
     22392**DCL     22393--REDEF
READ_ARC_LIST_BY_KEY.V
     22393**DCL     22389--DCLINIT
READ_ARC_LIST_BY_KEY.V.DVBYTE.REREAD#
     22404**DCL     22404--REDEF
READ_ARC_LIST_BY_KEY.V.INDX#
     22402**DCL     22402--REDEF
READ_ARC_LIST_FSN IN PROCEDURE FLX_UPDATE_ARC_FILES
     26475**DCL     26553<>CALL
READ_ARC_LIST_FSN.STATION_ IN PROCEDURE FLX_UPDATE_ARC_FILES
     26478**DCL     26479--REDEF
READ_ARC_LIST_FSN.V IN PROCEDURE FLX_UPDATE_ARC_FILES
     26479**DCL     26475--DCLINIT
READ_ARC_LIST_FSN.V.DVBYTE.REREAD# IN PROCEDURE FLX_UPDATE_ARC_FILES
     26490**DCL     26490--REDEF
READ_ARC_LIST_FSN.V.INDX# IN PROCEDURE FLX_UPDATE_ARC_FILES
     26488**DCL     26488--REDEF
READ_ARC_LIST_FSN.V.KEYR# IN PROCEDURE FLX_UPDATE_ARC_FILES
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:441  
     26480**DCL     26527<<ASSIGN  26531<<ASSIGN
READ_ARC_LIST_FSN.V.KEYS# IN PROCEDURE FLX_UPDATE_ARC_FILES
     26480**DCL     26526<<ASSIGN  26530<<ASSIGN
READ_FSN_LIST
     23453**DCL     26540<>CALL
READ_FSN_LIST.BUF_
     23455**DCL     26533<<ASSIGN
READ_FSN_LIST.STATION_
     23456**DCL     23457--REDEF
READ_FSN_LIST.V
     23457**DCL     23453--DCLINIT
READ_FSN_LIST.V.DVBYTE.REREAD#
     23468**DCL     23468--REDEF
READ_FSN_LIST.V.INDX#
     23466**DCL     23466--REDEF
READ_NODATA_LIST.STATION_
     17965**DCL     17966--REDEF
READ_NODATA_LIST.V.DVBYTE.REREAD#
     17977**DCL     17977--REDEF
READ_NODATA_LIST.V.INDX#
     17975**DCL     17975--REDEF
READ_PRIME_DUAL.STATION_
     17330**DCL     17331--REDEF
READ_PRIME_DUAL.V.DVBYTE.REREAD#
     17342**DCL     17342--REDEF
READ_PRIME_DUAL.V.INDX#
     17340**DCL     17340--REDEF
READ_REBUILD.STATION_
     17636**DCL     17637--REDEF
READ_REBUILD.V.DVBYTE.REREAD#
     17648**DCL     17648--REDEF
READ_REBUILD.V.INDX#
     17646**DCL     17646--REDEF
READ_STATUS.STATION_
     16851**DCL     16852--REDEF
READ_STATUS.V.DVBYTE.REREAD#
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:442  
     16863**DCL     16863--REDEF
READ_STATUS.V.INDX#
     16861**DCL     16861--REDEF
READ_TAPE_SOURCE
     21802**DCL     25706<>CALL    25741<>CALL
READ_TAPE_SOURCE.BUF_
     21804**DCL     25264<<ASSIGN
READ_TAPE_SOURCE.STATION_
     21805**DCL     21806--REDEF
READ_TAPE_SOURCE.V
     21806**DCL     21802--DCLINIT
READ_TAPE_SOURCE.V.DVBYTE.REREAD#
     21817**DCL     21817--REDEF
READ_TAPE_SOURCE.V.INDX#
     21815**DCL     21815--REDEF
READ_TAPE_SOURCE.V.IOERROK#
     21809**DCL     25249<<ASSIGN  25257<<ASSIGN
READ_TSN_USED.STATION_
     16561**DCL     16562--REDEF
READ_TSN_USED.V.DVBYTE.REREAD#
     16573**DCL     16573--REDEF
READ_TSN_USED.V.INDX#
     16571**DCL     16571--REDEF
REBUILD_DIR_KEY.L#
     17722**DCL     17722--IMP-SIZ
REBUILD_KEY.L#
     17749**DCL     17749--IMP-SIZ
REBUILD_NAME.L#
     17570**DCL     17570--IMP-SIZ
REM_LT
     23008**DCL     26236<>CALL
REM_LT.V
     23008**DCL     23008--DCLINIT
REM_LT.V.PSN#
     23009**DCL     26235<<ASSIGN
REPALT IN PROCEDURE FLX_CHECK_CURRENT_GRAN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:443  
     26029**LABEL   26073--CALLALT
RET_CMDS_NAME.L#
     15468**DCL     15468--IMP-SIZ
RPT_ERR IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25192**DCL     25288<<ASSIGN  25557>>IF      25792<<ASSIGN  25840<<ASSIGN  25849<<ASSIGN  25860<<ASSIGN
     26039<<ASSIGN  26128<<ASSIGN
RPT_ERR_CLOSE IN PROCEDURE FLX_ARC_LIST_ERROR_REPORT
     27070**LABEL   27032--CALLALT 27039--CALLALT 27055--CALLALT
RPT_ERR_CLOSE IN PROCEDURE FLX_FIND_ARC_FILES
     25014**LABEL   24553--CALLALT 24581--CALLALT 24583--CALLALT 24587--CALLALT 24745--CALLALT 24752--CALLALT
     24757--CALLALT 24767--CALLALT 24791--CALLALT 24868--CALLALT 24878--CALLALT 24879--CALLALT 24880--CALLALT
     24881--CALLALT 24888--GOTO    24927--CALLALT 24928--CALLALT 24958--CALLALT 24968--CALLALT 24994--CALLALT
RPT_ERR_CLOSE IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25550**LABEL   25304--CALLALT 25369--CALLALT 25375--CALLALT 25418--GOTO    25452--CALLALT 25459--CALLALT
     25502--CALLALT 25507--CALLALT 25532--GOTO    25540--GOTO
RPT_ERR_CLOSE IN PROCEDURE FLX_OUTPUT_SUMMARY
     26950**LABEL   26758--CALLALT 26801--CALLALT 26802--CALLALT 26805--CALLALT 26807--CALLALT 26812--CALLALT
     26814--CALLALT 26819--CALLALT 26821--CALLALT 26826--CALLALT 26828--CALLALT 26831--CALLALT 26834--CALLALT
     26836--CALLALT 26839--CALLALT 26841--CALLALT 26844--CALLALT 26846--CALLALT 26849--CALLALT 26851--CALLALT
     26854--CALLALT 26856--CALLALT 26859--CALLALT 26861--CALLALT
RPT_ERR_CLOSE IN PROCEDURE FLX_UPDATE_ARC_FILES
     26673**LABEL   26522--CALLALT 26532--CALLALT 26543--GOTO    26548--CALLALT 26654--GOTO
SECND$ IN PROCEDURE FLX_OUTPUT_SUMMARY
     26719**DCL     26907<<ASSIGN  26921>>ASSIGN  26922>>DOINDEX 26923>>ASSIGN
SELECTED
     21301**DCL     23929<<ASSIGN  23949<<ASSIGN  24740>>IF      24761>>IF
SIZE IN PROCEDURE FLX_OUTPUT_SUMMARY
     26717**DCL     26869<<ASSIGN  26871<<ASSIGN  26872<>CALL    26927>>ASSIGN  26928>>ASSIGN
SKIP_FILE IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25184**DCL     25274<<ASSIGN  25638<<ASSIGN  25645>>IF      25658>>IF      25806<<ASSIGN  25833<<ASSIGN
SN IN PROCEDURE FLX_FIND_ARC_FILES
     24071**DCL     25006<<ASSIGN  25008>>ASSIGN
SN IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25085**DCL     25375<>CALL    25459<>CALL    25857<>CALL    25863>>ASSIGN  26035<>CALL    26073<>CALL
     26074>>ASSIGN
SNLISTINFO.PREVINFO$
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:444  
     21539**DCL     26906>>DOWHILE 26908>>ASSIGN
SNLISTINFO.SNLIST$
     21539**DCL     23972>>ASSIGN  23976>>ASSIGN  23977>>ASSIGN  23989>>ASSIGN  23996>>ASSIGN  26912>>DOINDEX
     26913>>ASSIGN  26921>>ASSIGN  26922>>DOINDEX 26923>>ASSIGN
SNSIZE IN PROCEDURE FLX_OUTPUT_SUMMARY
     26715**DCL     26866<<ASSIGN  26869>>ASSIGN  26871>>ASSIGN  26919>>ASSIGN
SNVECLIST$
     15000**DCL     15000--IMP-PTR
SPEC.START
     15064**DCL     15065--REDEF
SPEC.STOP
     15065**DCL     15066--REDEF
SPECCHARS
     15064**DCL     15064--REDEF
STEPCC
     21421**DCL     26815<<ASSIGN  26829<<ASSIGN
SUBNODE$
     21299**DCL     23944<<ASSIGN  23946>>DOCASE  23952>>ASSIGN  23958>>ASSIGN  23958>>ASSIGN  23963>>CALL
     23969>>IF      23969>>IF      23981>>ASSIGN  23986>>IF      23994<>CALL    23997>>IF
SUBNODEX
     21300**DCL     23943<<DOINDEX 23944>>ASSIGN
SWITCH_FMSEC
     23664**DCL     23773<>CALL    23821<>CALL    23842<>CALL
SWITCH_FMSEC.V
     23664**DCL     23664--DCLINIT
TAPE_BLOCK_.W2
     16289**DCL     16290--REDEF
TAPE_CLOSE.SN_
     14917**DCL     14917--REDEF
TAPE_CLOSE.UTL_
     14918**DCL     14918--REDEF
TAPE_CLOSE.V.EXPIRE#
     14932**DCL     14932--REDEF
TAPE_CLOSE.V.TYPE#
     14930**DCL     14930--REDEF
TAPE_CLOSE.V.XTNSIZE#
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:445  
     14927**DCL     14927--REDEF   14929--REDEF
TAPE_DCBLIST.DCB$
     14473**DCL     25979>>ASSIGN  26080>>IF
TAPE_DCBLIST$
     14473**DCL     14473--IMP-PTR 25979>>ASSIGN  26080>>IF
TAPE_OPEN
     14780**DCL     23973>>ASSIGN
TAPE_OPEN.ACSVEH_
     14782**DCL     14783--REDEF
TAPE_OPEN.ALTKEYS_
     14788**DCL     14789--REDEF   14789--REDEF
TAPE_OPEN.HDR_
     14787**DCL     14788--REDEF
TAPE_OPEN.TAB_
     14786**DCL     14787--REDEF
TAPE_OPEN.UHL_
     14780**DCL     14781--REDEF   14781--REDEF
TAPE_OPEN.V.BLKL#
     14806**DCL     23995>>ASSIGN
TAPE_OPEN.V.FSN#
     14820**DCL     14820--REDEF   14820--REDEF
TAPE_OPEN.V.IOERROK#
     14811**DCL     25297<<ASSIGN  25301<<ASSIGN
TAPE_OPEN.WSN_
     14786**DCL     14786--REDEF
TAPE_READ.STATION_
     14844**DCL     14845--REDEF
TAPE_READ.V.DVBYTE.REREAD#
     14856**DCL     14856--REDEF
TAPE_READ.V.INDX#
     14854**DCL     14854--REDEF
TAPE_SET$
     21304**DCL     23996<<ASSIGN  26866>>ASSIGN  26901>>ASSIGN
TAPE_WRITE.STATION_
     14882**DCL     14882--REDEF
TAPE_WRITE.V.DVBYTE.VFC#
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:446  
     14889**DCL     14889--REDEF
TAPE_WRITE.V.IOERROK#
     14887**DCL     25298<<ASSIGN  25302<<ASSIGN
TELL_ERROR
     23835**LABEL   23830--CALLALT
TEMP
     21302**DCL     23953<<ASSIGN  23954<<ASSIGN  23954>>ASSIGN  23955<>CALL    24574<<ASSIGN  24575<<ASSIGN
     24575>>ASSIGN  24576<>CALL    24636<<ASSIGN  24637<<ASSIGN  24637>>ASSIGN  24638<>CALL    24700<<ASSIGN
     24701<<ASSIGN  24701>>ASSIGN  24702<>CALL    24702<>CALL    24779<<ASSIGN  24780<>CALL    24854<<ASSIGN
     24855<<ASSIGN  24855>>ASSIGN  24856<>CALL    24856<>CALL    24906<<ASSIGN  24907<<ASSIGN  24907>>ASSIGN
     24908<>CALL    24908<>CALL    26634<<ASSIGN  26635<>CALL    26911<<ASSIGN  26913>>ASSIGN  26914<<ASSIGN
     26914>>ASSIGN
TEMP$
     21303**DCL     23981<<ASSIGN  23983>>IF      23983>>IF      26889<<ASSIGN  26890>>ASSIGN  26892>>ASSIGN
     26894<<ASSIGN  26894>>ASSIGN  26895>>ASSIGN  26901>>ASSIGN  26913>>ASSIGN  26919<<ASSIGN  26919>>ASSIGN
     26920>>ASSIGN  26921>>ASSIGN  26923>>ASSIGN
TEMP_FLG IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25196**DCL     25368<<ASSIGN  25369<>CALL    25383>>IF      25451<<ASSIGN  25452<>CALL    25474>>IF
TEXT_NUMBER IN PROCEDURE FLX_ACC_LINE
     27114**DCL     27218<<CALLBLT 27219>>CALLBLT
THIS_BLK_ARC_LIST_KEY
     21341**DCL     25653<<ASSIGN  25957--ASSIGN  25961>>ASSIGN  26011--ASSIGN  26024--ASSIGN  26089>>ASSIGN
THIS_BLK_ARC_LIST_REC
     21378**DCL     25654<<ASSIGN  25958--ASSIGN  25960>>ASSIGN  26012--ASSIGN  26090>>ASSIGN
THIS_BLK_ARC_LIST_REC.NEW.FSN
     21384**DCL     25956<<ASSIGN  26005<<ASSIGN  26009<<ASSIGN
THIS_BLK_ARC_LIST_REC.NEW.REEL
     21383**DCL     25955<<ASSIGN  26004<<ASSIGN  26008<<ASSIGN
TITLE IN PROCEDURE FLX_ACC_LINE
     27094**DCL     27089--PROC    27177>>CALLBLT 27178--ASSIGN  27226>>CALLBLT 27227--ASSIGN
TITLE_LINE.TITLE IN PROCEDURE FLX_ACC_LINE
     27113**DCL     27178<<ASSIGN  27190<<ASSIGN  27193<<ASSIGN
TITLE_LINE.VFC IN PROCEDURE FLX_ACC_LINE
     27112**DCL     27179<<ASSIGN  27184<<ASSIGN  27186<<ASSIGN  27189<<ASSIGN
TITLE_LINE IN PROCEDURE FLX_ARC_LIST_ERROR_REPORT
     26989**DCL     27036--ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:447  
TITLE_LINE_OD IN PROCEDURE FLX_ARC_LIST_ERROR_REPORT
     26990**DCL     27035--ASSIGN
TPTR$ IN PROCEDURE FLX_FIND_ARC_FILES
     24076**DCL     24523--IMP-PTR 24527--IMP-PTR 24569<>CALL    24570>>ASSIGN  24671<>CALL    24672>>ASSIGN
     24912<<ASSIGN  24913>>IF      24915>>CALLBLT 24917>>CALLBLT 24920>>CALLBLT 24922>>CALLBLT
TRUOVRPRT IN PROCEDURE FLX_ACC_LINE
     27116**DCL     27181<<ASSIGN  27182>>IF      27206>>IF      27233>>IF
TSN_LINE IN PROCEDURE FLX_FIND_ARC_FILES
     24025**DCL     24961--ASSIGN
TSN_LINE.TSN IN PROCEDURE FLX_FIND_ARC_FILES
     24027**DCL     24967<<ASSIGN
TSN_USED_NAME.L#
     16508**DCL     16508--IMP-SIZ
TVECTOR
     15012**DCL     23976<<ASSIGN  23979>>ASSIGN  25013<<ASSIGN  25016>>ASSIGN  25948<<ASSIGN  25952>>ASSIGN
TVECTOR.PTR$
     15014**DCL     25951<<ASSIGN
TVECTOR.W1.VSIZE#
     15012**DCL     23977<<ASSIGN  25014<<ASSIGN  25950<<ASSIGN
TVECTOR.W2
     15013**DCL     15014--REDEF
VLP_NAME IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25072**DCL     25079--DCLINIT
VLP_NAME.L# IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25072**DCL     25516<<ASSIGN
VLP_NAME.NAME# IN PROCEDURE FLX_MAKE_NEW_ARCHIVE_TAPES
     25072**DCL     25515<<ASSIGN
VLP_SN
     21536**DCL     23976--ASSIGN  23996--ASSIGN
VLP_SN.NUM#
     21536**DCL     23977>>ASSIGN  23977--ASSIGN
VLP_SN.SN#
     21536**DCL     23977--ASSIGN
VOL# IN PROCEDURE FLX_OUTPUT_SUMMARY
     26716**DCL     26898<<ASSIGN  26900<<ASSIGN  26901>>ASSIGN  26912>>DOINDEX 26921>>ASSIGN  26922>>DOINDEX
WRITE_ACC_LINE IN PROCEDURE FLX_ACC_LINE
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:448  
     27143**DCL     27180<>CALL    27185<>CALL    27192<>CALL    27212<>CALL    27228<>CALL    27239<>CALL
     27242<>CALL    27245<>CALL
WRITE_ACC_LINE.STATION_ IN PROCEDURE FLX_ACC_LINE
     27145**DCL     27145--REDEF
WRITE_ACC_LINE.V IN PROCEDURE FLX_ACC_LINE
     27146**DCL     27143--DCLINIT
WRITE_ACC_LINE.V.DVBYTE.VFC# IN PROCEDURE FLX_ACC_LINE
     27152**DCL     27152--REDEF
WRITE_ARCHIVE_EFT
     23192**DCL     26936<>CALL    26939<>CALL
WRITE_ARCHIVE_EFT.BUF_
     23192**DCL     26935<<ASSIGN
WRITE_ARCHIVE_EFT.BUF_.BOUND
     23192**DCL     26937<<ASSIGN
WRITE_ARCHIVE_EFT.BUF_.BUF$
     23194**DCL     26938<<ASSIGN
WRITE_ARCHIVE_EFT.STATION_
     23194**DCL     23194--REDEF
WRITE_ARCHIVE_EFT.V
     23195**DCL     23192--DCLINIT
WRITE_ARCHIVE_EFT.V.DVBYTE.VFC#
     23201**DCL     23201--REDEF
WRITE_ARC_LIST IN PROCEDURE FLX_FIND_ARC_FILES
     24385**DCL     24868<>CALL
WRITE_ARC_LIST.STATION_ IN PROCEDURE FLX_FIND_ARC_FILES
     24387**DCL     24387--REDEF
WRITE_ARC_LIST.V IN PROCEDURE FLX_FIND_ARC_FILES
     24388**DCL     24385--DCLINIT
WRITE_ARC_LIST.V.DVBYTE.VFC# IN PROCEDURE FLX_FIND_ARC_FILES
     24394**DCL     24394--REDEF
WRITE_ARC_LIST_BY_KEY
     22434**DCL     25873<>CALL    25959<>CALL    25975<>CALL    25996<>CALL    26013<>CALL
WRITE_ARC_LIST_BY_KEY.BUF_
     22434**DCL     25872<<ASSIGN  25958<<ASSIGN  25974<<ASSIGN  25995<<ASSIGN  26012<<ASSIGN
WRITE_ARC_LIST_BY_KEY.KEY_
     22434**DCL     25871<<ASSIGN  25957<<ASSIGN  25973<<ASSIGN  25994<<ASSIGN  26011<<ASSIGN
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:449  
WRITE_ARC_LIST_BY_KEY.STATION_
     22436**DCL     22436--REDEF
WRITE_ARC_LIST_BY_KEY.V
     22437**DCL     22434--DCLINIT
WRITE_ARC_LIST_BY_KEY.V.DVBYTE.VFC#
     22443**DCL     22443--REDEF
WRITE_ARC_LIST_BY_KEY_NEW
     22471**DCL     25885<>CALL
WRITE_ARC_LIST_BY_KEY_NEW.STATION_
     22473**DCL     22473--REDEF
WRITE_ARC_LIST_BY_KEY_NEW.V
     22474**DCL     22471--DCLINIT
WRITE_ARC_LIST_BY_KEY_NEW.V.DVBYTE.VFC#
     22480**DCL     22480--REDEF
WRITE_FSN_LIST
     23495**DCL     26025<>CALL    26068<>CALL
WRITE_FSN_LIST.BUF_
     23495**DCL     26024<<ASSIGN  26067<<ASSIGN
WRITE_FSN_LIST.STATION_
     23497**DCL     23497--REDEF
WRITE_FSN_LIST.V
     23498**DCL     23495--DCLINIT
WRITE_FSN_LIST.V.DVBYTE.VFC#
     23504**DCL     23504--REDEF
WRITE_LINE IN PROCEDURE FLX_ARC_LIST_ERROR_REPORT
     27015**DCL     27039<>CALL
WRITE_LINE.BUF_ IN PROCEDURE FLX_ARC_LIST_ERROR_REPORT
     27015**DCL     27035<<ASSIGN  27036<<ASSIGN
WRITE_LINE.STATION_ IN PROCEDURE FLX_ARC_LIST_ERROR_REPORT
     27017**DCL     27017--REDEF
WRITE_LINE.V IN PROCEDURE FLX_ARC_LIST_ERROR_REPORT
     27018**DCL     27015--DCLINIT
WRITE_LINE.V.DVBYTE.VFC# IN PROCEDURE FLX_ARC_LIST_ERROR_REPORT
     27024**DCL     27024--REDEF
WRITE_LO IN PROCEDURE FLX_FIND_ARC_FILES
     24419**DCL     24553<>CALL    24583<>CALL    24587<>CALL    24745<>CALL    24752<>CALL    24757<>CALL
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:450  
     24958<>CALL    24968<>CALL    24994<>CALL
WRITE_LO.BUF_ IN PROCEDURE FLX_FIND_ARC_FILES
     24419**DCL     24552<<ASSIGN  24582<<ASSIGN  24584<<ASSIGN  24743<<ASSIGN  24744<<ASSIGN  24750<<ASSIGN
     24751<<ASSIGN  24754<<ASSIGN  24956<<ASSIGN  24957<<ASSIGN  24960<<ASSIGN  24961<<ASSIGN  24992<<ASSIGN
     24993<<ASSIGN
WRITE_LO.STATION_ IN PROCEDURE FLX_FIND_ARC_FILES
     24421**DCL     24421--REDEF
WRITE_LO.V IN PROCEDURE FLX_FIND_ARC_FILES
     24422**DCL     24419--DCLINIT
WRITE_LO.V.DVBYTE.VFC# IN PROCEDURE FLX_FIND_ARC_FILES
     24428**DCL     24428--REDEF
WRITE_NODATA_LIST.STATION_
     18003**DCL     18003--REDEF
WRITE_NODATA_LIST.V.DVBYTE.VFC#
     18010**DCL     18010--REDEF
WRITE_PRIME_DUAL.STATION_
     17368**DCL     17368--REDEF
WRITE_PRIME_DUAL.V.DVBYTE.VFC#
     17375**DCL     17375--REDEF
WRITE_REBUILD.STATION_
     17604**DCL     17604--REDEF
WRITE_REBUILD.V.DVBYTE.VFC#
     17611**DCL     17611--REDEF
WRITE_STATUS.STATION_
     16819**DCL     16819--REDEF
WRITE_STATUS.V.DVBYTE.VFC#
     16826**DCL     16826--REDEF
WRITE_TSN_USED.STATION_
     16529**DCL     16529--REDEF
WRITE_TSN_USED.V.DVBYTE.VFC#
     16536**DCL     16536--REDEF
XSF$LOCCODP
     21199**DCL-ENT 24831--CALL    25664--CALL    26567--CALL
XTX$ADAPT
     22090**DCL-ENT 22169--DCLINIT
XUR$ECHOIF
PL6.E3A0      #001=FLX$ARCOM File=FLX$ARCOM.:E05TSI                              TUE 07/29/97 16:33 Page:451  
     21165**DCL-ENT 23831--CALL    23849--CALL
XUR$ERRMSG
     21171**DCL-ENT 23855--CALL    26213--CALL
XUR$ERRPTR
     21164**DCL-ENT 23853--CALL
XUR$GETCMD
     21163**DCL-ENT 23830--CALL
XUR$INIT
     21168**DCL-ENT 23758--CALL
XUR$SETERRMSG
     21173**DCL-ENT 23759--CALL
XUR_INIT
     22095**DCL     23758<>CALL
XUR_INIT.WORKR_
     22109**DCL     22110--REDEF
ZERO_SN_LIST
     22958**DCL     22976--DCLINIT 23934--ASSIGN  23935--ASSIGN  23936--ASSIGN  24542--IF      24776--IF
     24935--IF
ZERO_SN_LIST.SN#
     22958**DCL     24550>>ASSIGN

PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:452  
     3104        1        /*T***********************************************************/
     3105        2        /*T*                                                         */
     3106        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     3107        4        /*T*                                                         */
     3108        5        /*T***********************************************************/
     3109        6        FLX$ARCOM_BRK: PROC ASYNC;
     3110        7        /*F*  NAME: FLX$ARCOM_BRK
     3111        8              PURPOSE: Break handling routine.
     3112        9        */
     3113       10
     3114       11         /***
     3115       12          *** INCLUDE
     3116       13          ***/
     3117       14
     3118       15        %INCLUDE CP_6;
     3119     5574
     3120     5575         /***
     3121     5576          *** DCB
     3122     5577          ***/
     3123     5578
     3124     5579    1   DCL M$LO DCB;
     3125     5580
     3126     5581         /***
     3127     5582          *** SYMREF
     3128     5583          ***/
     3129     5584
     3130     5585    1   DCL BREAK_COUNT SBIN SYMREF;
     3131     5586    1   DCL BREAK_DCB$ PTR SYMREF;
     3132     5587    1   DCL BREAK_TASK CHAR(18) SYMREF;
     3133     5588
     3134     5589         /***
     3135     5590          *** STATIC
     3136     5591          ***/
     3137     5592
     3138     5593    1   DCL 1 BRK_MSG STATIC,
     3139     5594    1         2 * CHAR(0) INIT('...'),
     3140     5595    1         2 TASK CHAR(18),
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:453  
     3141     5596    1         2 * CHAR(0) INIT(' '),
     3142     5597    1         2 INFOCHARS CHAR(18),
     3143     5598    1         2 INFO REDEF INFOCHARS,
     3144     5599    1           3 DP# CHAR(3),
     3145     5600    1           3 PSN CHAR(6),
     3146     5601    1           3 DOT CHAR(1),
     3147     5602    1           3 ACCT CHAR(8);
     3148     5603
     3149     5604         /***
     3150     5605          *** FPT
     3151     5606          ***/
     3152     5607
     3153     5608        %FPT_TRMPRG(FPTN = FPT_TRMPRG,
     3154     5609                    RSTBRK = YES,
     3155     5610                    STCLASS=CONSTANT );
     3156     5639
     3157     5640        %FPT_WRITE(FPTN = FPT_WRITE,
     3158     5641                   DCB = M$LO,
     3159     5642                   BUF = BRK_MSG,
     3160     5643                          STCLASS=CONSTANT );
     3161     5674
     3162     5675         /***
     3163     5676          *** BASED
     3164     5677          ***/
     3165     5678
     3166     5679        %F$DCB( BASED="BASED(BREAK_DCB$)" );
     3167     5736
     3168     5737        /****************************************/
     3169     5738
     3170     5739    1      BREAK_COUNT = BREAK_COUNT + 1;
     3171     5740    1      IF BREAK_DCB$ ~= ADDR(NIL)
     3172     5741    2       THEN DO;
     3173     5742    2         BRK_MSG.INFO.PSN = F$DCB.PSN#;
     3174     5743    2         BRK_MSG.INFO.ACCT = F$DCB.ACCT#;
     3175     5744    2         BRK_MSG.INFO.DP# = 'DP#';
     3176     5745    2         BRK_MSG.INFO.DOT = '.';
     3177     5746    2         END;
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:454  
     3178     5747    2       ELSE DO;
     3179     5748    2         BRK_MSG.INFOCHARS = ' ';
     3180     5749    2         END;
     3181     5750    1      BRK_MSG.TASK = BREAK_TASK;
     3182     5751    1      CALL M$WRITE(FPT_WRITE);
     3183     5752    1      CALL M$TRMPRG(FPT_TRMPRG);
     3184     5753    1      RETURN;
     3185     5754
     3186     5755    1   END FLX$ARCOM_BRK;

PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:455  
--  Include file information  --

   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FLX$ARCOM_BRK.

   Procedure FLX$ARCOM_BRK requires 31 words for executable code.
   Procedure FLX$ARCOM_BRK requires 4 words of local(AUTO) storage.

    No errors detected in file FLX$ARCOM.:E05TSI    .

PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:456  

 Object Unit name= FLX$ARCOM_BRK                              File name= FLX$ARCOM.:E05TOU
 UTS= JUL 29 '97 16:38:37.80 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$LO
    2   Data  even  none    10     12  FLX$ARCOM_BRK
    3  RoData even  UTS     21     25  FLX$ARCOM_BRK
    4   Proc  even  none    31     37  FLX$ARCOM_BRK

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes            yes     Async       0  FLX$ARCOM_BRK

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AAUTO
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  M$LO                                  BREAK_COUNT
     BREAK_DCB$                            BREAK_TASK                            B_VECTNIL
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:457  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:458  


     3104        1        /*T***********************************************************/
     3105        2        /*T*                                                         */
     3106        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     3107        4        /*T*                                                         */
     3108        5        /*T***********************************************************/
     3109        6        FLX$ARCOM_BRK: PROC ASYNC;

      6  4 000000   000000 700200 xent  FLX$ARCOM_B* TSX0  ! X66_AAUTO
         4 000001   000004 000000                    ZERO    4,0

     3110        7        /*F*  NAME: FLX$ARCOM_BRK
     3111        8              PURPOSE: Break handling routine.
     3112        9        */
     3113       10
     3114       11         /***
     3115       12          *** INCLUDE
     3116       13          ***/
     3117       14
     3118       15        %INCLUDE CP_6;
     3119     5574
     3120     5575         /***
     3121     5576          *** DCB
     3122     5577          ***/
     3123     5578
     3124     5579    1   DCL M$LO DCB;
     3125     5580
     3126     5581         /***
     3127     5582          *** SYMREF
     3128     5583          ***/
     3129     5584
     3130     5585    1   DCL BREAK_COUNT SBIN SYMREF;
     3131     5586    1   DCL BREAK_DCB$ PTR SYMREF;
     3132     5587    1   DCL BREAK_TASK CHAR(18) SYMREF;
     3133     5588
     3134     5589         /***
     3135     5590          *** STATIC
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:459  
     3136     5591          ***/
     3137     5592
     3138     5593    1   DCL 1 BRK_MSG STATIC,
     3139     5594    1         2 * CHAR(0) INIT('...'),
     3140     5595    1         2 TASK CHAR(18),
     3141     5596    1         2 * CHAR(0) INIT(' '),
     3142     5597    1         2 INFOCHARS CHAR(18),
     3143     5598    1         2 INFO REDEF INFOCHARS,
     3144     5599    1           3 DP# CHAR(3),
     3145     5600    1           3 PSN CHAR(6),
     3146     5601    1           3 DOT CHAR(1),
     3147     5602    1           3 ACCT CHAR(8);
     3148     5603
     3149     5604         /***
     3150     5605          *** FPT
     3151     5606          ***/
     3152     5607
     3153     5608        %FPT_TRMPRG(FPTN = FPT_TRMPRG,
     3154     5609                    RSTBRK = YES,
     3155     5610                    STCLASS=CONSTANT );
     3156     5639
     3157     5640        %FPT_WRITE(FPTN = FPT_WRITE,
     3158     5641                   DCB = M$LO,
     3159     5642                   BUF = BRK_MSG,
     3160     5643                          STCLASS=CONSTANT );
     3161     5674
     3162     5675         /***
     3163     5676          *** BASED
     3164     5677          ***/
     3165     5678
     3166     5679        %F$DCB( BASED="BASED(BREAK_DCB$)" );
     3167     5736
     3168     5737        /****************************************/
     3169     5738
     3170     5739    1      BREAK_COUNT = BREAK_COUNT + 1;

   5739  4 000002   000000 054000 xsym               AOS     BREAK_COUNT
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:460  

     3171     5740    1      IF BREAK_DCB$ ~= ADDR(NIL)

   5740  4 000003   000000 236000 xsym               LDQ     BREAK_DCB$
         4 000004   000001 116000 xsym               CMPQ    B_VECTNIL+1
         4 000005   000022 600000 4                  TZE     s:5748

     3172     5741    2       THEN DO;

     3173     5742    2         BRK_MSG.INFO.PSN = F$DCB.PSN#;

   5742  4 000006   000000 470400 xsym               LDP0    BREAK_DCB$
         4 000007   040000 100500                    MLR     fill='040'O
         4 000010   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         4 000011   000006 200006 2                  ADSC9   BRK_MSG+6                cn=1,n=6

     3174     5743    2         BRK_MSG.INFO.ACCT = F$DCB.ACCT#;

   5743  4 000012   000020 237100                    LDAQ    16,,PR0
         4 000013   000010 757000 2                  STAQ    BRK_MSG+8

     3175     5744    2         BRK_MSG.INFO.DP# = 'DP#';

   5744  4 000014   040000 100400                    MLR     fill='040'O
         4 000015   000024 000003 3                  ADSC9   FPT_WRITE+12             cn=0,n=3
         4 000016   000005 400003 2                  ADSC9   BRK_MSG+5                cn=2,n=3

     3176     5745    2         BRK_MSG.INFO.DOT = '.';

   5745  4 000017   000056 236007                    LDQ     46,DL
         4 000020   000007 552004 2                  STBQ    BRK_MSG+7,'04'O

     3177     5746    2         END;

   5746  4 000021   000025 710000 4                  TRA     s:5750

     3178     5747    2       ELSE DO;
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:461  

     3179     5748    2         BRK_MSG.INFOCHARS = ' ';

   5748  4 000022   040000 100400                    MLR     fill='040'O
         4 000023   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 000024   000005 400022 2                  ADSC9   BRK_MSG+5                cn=2,n=18

     3180     5749    2         END;

     3181     5750    1      BRK_MSG.TASK = BREAK_TASK;

   5750  4 000025   040000 100400                    MLR     fill='040'O
         4 000026   000000 000022 xsym               ADSC9   BREAK_TASK               cn=0,n=18
         4 000027   000000 600022 2                  ADSC9   BRK_MSG                  cn=3,n=18

     3182     5751    1      CALL M$WRITE(FPT_WRITE);

   5751  4 000030   000010 630400 3                  EPPR0   FPT_WRITE
         4 000031   040001 713400                    CLIMB   write
         4 000032   401400 401760                    pmme    nvectors=4

     3183     5752    1      CALL M$TRMPRG(FPT_TRMPRG);

   5752  4 000033   000000 630400 3                  EPPR0   FPT_TRMPRG
         4 000034   160004 713400                    CLIMB   57348
         4 000035   400400 401760                    pmme    nvectors=2

     3184     5753    1      RETURN;

   5753  4 000036   000000 702200 xent               TSX2  ! X66_AARET
     3185     5754
     3186     5755    1   END FLX$ARCOM_BRK;

PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:462  
--  Include file information  --

   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FLX$ARCOM_BRK.
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:463  

 **** Variables and constants ****

  ****  Section 002  Data  FLX$ARCOM_BRK

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(360)   r     1 BRK_MSG

  ****  Section 003 RoData FLX$ARCOM_BRK

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(288)   r     1 FPT_TRMPRG                10-0-0/d STRC(432)   r     1 FPT_WRITE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 BREAK_COUNT                0-0-0/w PTR         r     1 BREAK_DCB$
     0-0-0/c CHAR(18)    r     1 BREAK_TASK

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$UC


   Procedure FLX$ARCOM_BRK requires 31 words for executable code.
   Procedure FLX$ARCOM_BRK requires 4 words of local(AUTO) storage.
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:464  

    No errors detected in file FLX$ARCOM.:E05TSI    .
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:465  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:466  
          MINI XREF LISTING

BREAK_COUNT
      5585**DCL      5739<<ASSIGN   5739>>ASSIGN
BREAK_DCB$
      5586**DCL      5680--IMP-PTR  5740>>IF       5742>>ASSIGN   5743>>ASSIGN
BREAK_TASK
      5587**DCL      5750>>ASSIGN
BRK_MSG
      5593**DCL      5661--DCLINIT  5662--DCLINIT
BRK_MSG.INFO.ACCT
      5602**DCL      5743<<ASSIGN
BRK_MSG.INFO.DOT
      5601**DCL      5745<<ASSIGN
BRK_MSG.INFO.DP#
      5599**DCL      5744<<ASSIGN
BRK_MSG.INFO.PSN
      5600**DCL      5742<<ASSIGN
BRK_MSG.INFOCHARS
      5597**DCL      5598--REDEF    5748<<ASSIGN
BRK_MSG.TASK
      5595**DCL      5750<<ASSIGN
F$DCB.ACCT#
      5696**DCL      5743>>ASSIGN
F$DCB.ACTPOS
      5712**DCL      5712--REDEF
F$DCB.ARS#
      5686**DCL      5686--REDEF
F$DCB.ATTR
      5705**DCL      5706--REDEF
F$DCB.BORROW
      5720**DCL      5720--REDEF    5720--REDEF    5720--REDEF
F$DCB.DCBNAME.L
      5734**DCL      5734--IMP-SIZ
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:467  
F$DCB.EOMCHAR#
      5690**DCL      5690--REDEF
F$DCB.FLDID
      5715**DCL      5715--REDEF
F$DCB.FORM$
      5709**DCL      5709--REDEF
F$DCB.FSECT
      5725**DCL      5725--REDEF
F$DCB.FSN#
      5702**DCL      5702--REDEF    5702--REDEF    5703--REDEF
F$DCB.HEADER$
      5708**DCL      5708--REDEF
F$DCB.IXTNSIZE#
      5706**DCL      5706--REDEF
F$DCB.LASTSTA$
      5695**DCL      5695--REDEF
F$DCB.LVL
      5721**DCL      5721--REDEF
F$DCB.NAME#.C
      5696**DCL      5696--REDEF
F$DCB.NOEOF
      5718**DCL      5718--REDEF
F$DCB.NRECS#
      5707**DCL      5707--REDEF
F$DCB.NRECX
      5726**DCL      5726--REDEF
F$DCB.OHDR
      5718**DCL      5718--REDEF
F$DCB.ORG#
      5701**DCL      5701--REDEF
F$DCB.PRECNO
      5724**DCL      5724--REDEF
F$DCB.PSN#
      5696**DCL      5742>>ASSIGN
F$DCB.RCSZ
      5730**DCL      5730--REDEF
PL6.E3A0      #002=FLX$ARCOM_BRK File=FLX$ARCOM.:E05TSI                          TUE 07/29/97 16:38 Page:468  
F$DCB.RES#
      5697**DCL      5697--REDEF
F$DCB.SETX
      5709**DCL      5709--REDEF
F$DCB.TAB$
      5709**DCL      5709--REDEF
F$DCB.TDA
      5723**DCL      5724--REDEF
F$DCB.WSN#
      5697**DCL      5697--REDEF
FPT_TRMPRG
      5626**DCL      5752<>CALL
FPT_TRMPRG.V
      5633**DCL      5628--DCLINIT
FPT_TRMPRG.V.CTLFLG.RSTBRK#
      5634**DCL      5635--REDEF
FPT_WRITE
      5660**DCL      5751<>CALL
FPT_WRITE.STATION_
      5662**DCL      5662--REDEF
FPT_WRITE.V
      5663**DCL      5660--DCLINIT
FPT_WRITE.V.DVBYTE.VFC#
      5669**DCL      5669--REDEF
M$TRMPRG
      5527**DCL-ENT  5752--CALL
M$WRITE
      5503**DCL-ENT  5751--CALL
