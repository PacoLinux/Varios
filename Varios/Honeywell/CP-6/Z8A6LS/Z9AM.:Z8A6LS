VERSION A06

PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:1    
        1        1        /*M* Z9AM -- Executive utility routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8
        9        9        /*P*
       10       10               NAME: Z9AM
       11       11
       12       12             AUTHOR: Yawackum Schwartz
       13       13
       14       14            PURPOSE: Provide system dependent exec functions.
       15       15
       16       16        */
       17       17
       18       18        /*D*    NAME: Z9AM
       19       19
       20       20           INTERFACE: M$TIME -- Get Date, Time, and UTS (Univ. Time Stamp).
       21       21                      M$EXIT -- Exit and set the STEPCC (4 = Fatal errors).
       22       22
       23       23         DESCRIPTION: (1) Sets the date, time, and UTS for compile.
       24       24                      (2) Sets the STEPCC = 4 via M$EXIT.
       25       25        */
       26       26
       27       27        %EJECT;
PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:2    
       28       28        Z9AM$SAVE_DATE: PROC ;
       29       29
       30       30        %SET PHASE = 1 ;
       31       31        %INCLUDE Z8A_DEFC ;
       32       99        %INCLUDE Z8A_COMCOM ;
       33      749        %INCLUDE Z8A_SYS_FILE;
       34     7024
       35     7025
       36     7026
       37     7027    1   DCL LONG_TIME CHAR(11) STATIC;
       38     7028
       39     7029        %FPT_EXIT (STEPCC=4) ;
       40     7044        %FPT_TIME (FPTN=UTSTIME, SOURCE=CLOCK, DEST=UTS, TSTAMP=COMCOM.COMPILE.UTS);
       41     7063        %FPT_TIME (FPTN=CDATE,   SOURCE = UTS, DEST=LOCAL, DATE=COMCOM.COMPILE.DATE,
       42     7064                   TIME=LONG_TIME, TSTAMP=COMCOM.COMPILE.UTS);
       43     7083
       44     7084
       45     7085        %EJECT;
PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:3    
       46     7086
       47     7087             /* Save Date/time/UTS of compilation */
       48     7088
       49     7089    1        CALL M$TIME (UTSTIME);
       50     7090    1        CALL M$TIME (CDATE);
       51     7091    1        CALL INSERT (COMCOM.COMPILE.TIME, 0, 5, LONG_TIME);
       52     7092
       53     7093    1        RETURN ;
       54     7094        %EJECT;
PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:4    
       55     7095    1   Z9AM$ERR_EXIT: ENTRY ;
       56     7096
       57     7097    1        CALL M$EXIT (FPT_EXIT) ;
       58     7098
       59     7099    1   END Z9AM$SAVE_DATE ;
       60     7100        %EOD;

PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:5    
--  Include file information  --

   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   Z8A_SYS_FILE.:Z8A6TOU  is referenced.
   Z8A_COMCOM.:Z8A6TOU  cannot be made into a system file and is referenced.
   Z8A_DEFC.:Z8A6TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure Z9AM$SAVE_DATE.

   Procedure Z9AM$SAVE_DATE requires 18 words for executable code.
   Procedure Z9AM$SAVE_DATE requires 4 words of local(AUTO) storage.

PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:6    

 Object Unit name= Z9AM$SAVE_DATE                             File name= Z9AM.:Z8A6TOU
 UTS= AUG 09 '97 13:39:47.04 SAT                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  LblCom even  none     1      1  ITERATION
    1   DCB   even  none     0      0  M$UC
    2   Data  even  none    34     42  Z9AM$SAVE_DATE
    3   Proc  even  none    18     22  Z9AM$SAVE_DATE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes            yes      Std        0  Z9AM$SAVE_DATE
     3     14                  yes      Std        0  Z9AM$ERR_EXIT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     COMCOM                                M$UC
PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:7    

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:8    


        1        1        /*M* Z9AM -- Executive utility routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8
        9        9        /*P*
       10       10               NAME: Z9AM
       11       11
       12       12             AUTHOR: Yawackum Schwartz
       13       13
       14       14            PURPOSE: Provide system dependent exec functions.
       15       15
       16       16        */
       17       17
       18       18        /*D*    NAME: Z9AM
       19       19
       20       20           INTERFACE: M$TIME -- Get Date, Time, and UTS (Univ. Time Stamp).
       21       21                      M$EXIT -- Exit and set the STEPCC (4 = Fatal errors).
       22       22
       23       23         DESCRIPTION: (1) Sets the date, time, and UTS for compile.
       24       24                      (2) Sets the STEPCC = 4 via M$EXIT.
       25       25        */
       26       26
       27       27        %EJECT;
PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:9    
       28       28        Z9AM$SAVE_DATE: PROC ;

     28  3 000000   000000 700200 xent  Z9AM$SAVE_D* TSX0  ! X66_AUTO_0
         3 000001   000004 000000                    ZERO    4,0

       29       29
       30       30        %SET PHASE = 1 ;
       31       31        %INCLUDE Z8A_DEFC ;
       32       99        %INCLUDE Z8A_COMCOM ;
       33      749        %INCLUDE Z8A_SYS_FILE;
       34     7024
       35     7025
       36     7026
       37     7027    1   DCL LONG_TIME CHAR(11) STATIC;
       38     7028
       39     7029        %FPT_EXIT (STEPCC=4) ;
       40     7044        %FPT_TIME (FPTN=UTSTIME, SOURCE=CLOCK, DEST=UTS, TSTAMP=COMCOM.COMPILE.UTS);
       41     7063        %FPT_TIME (FPTN=CDATE,   SOURCE = UTS, DEST=LOCAL, DATE=COMCOM.COMPILE.DATE,
       42     7064                   TIME=LONG_TIME, TSTAMP=COMCOM.COMPILE.UTS);
       43     7083
       44     7084
       45     7085        %EJECT;
PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:10   
       46     7086
       47     7087             /* Save Date/time/UTS of compilation */
       48     7088
       49     7089    1        CALL M$TIME (UTSTIME);

   7089  3 000002   000012 630400 2                  EPPR0   UTSTIME
         3 000003   020004 713400                    CLIMB   8196
         3 000004   402000 401760                    pmme    nvectors=5

       50     7090    1        CALL M$TIME (CDATE);

   7090  3 000005   000026 630400 2                  EPPR0   CDATE
         3 000006   020004 713400                    CLIMB   8196
         3 000007   402000 401760                    pmme    nvectors=5

       51     7091    1        CALL INSERT (COMCOM.COMPILE.TIME, 0, 5, LONG_TIME);

   7091  3 000010   040000 100400                    MLR     fill='040'O
         3 000011   000000 000005 2                  ADSC9   LONG_TIME                cn=0,n=5
         3 000012   000142 000005 xsym               ADSC9   COMCOM+98                cn=0,n=5

       52     7092
       53     7093    1        RETURN ;

   7093  3 000013   000000 702200 xent               TSX2  ! X66_ARET

       54     7094        %EJECT;
PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:11   
       55     7095    1   Z9AM$ERR_EXIT: ENTRY ;

   7095  3 000014   000000 700200 xent  Z9AM$ERR_EX* TSX0  ! X66_AUTO_0
         3 000015   000004 000000                    ZERO    4,0

       56     7096
       57     7097    1        CALL M$EXIT (FPT_EXIT) ;

   7097  3 000016   000004 630400 2                  EPPR0   FPT_EXIT
         3 000017   000001 713400                    CLIMB   exit
         3 000020   400400 401760                    pmme    nvectors=2

       58     7098
       59     7099    1   END Z9AM$SAVE_DATE ;

   7099  3 000021   000000 702200 xent               TSX2  ! X66_ARET
       60     7100        %EOD;

PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:12   
--  Include file information  --

   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   Z8A_SYS_FILE.:Z8A6TOU  is referenced.
   Z8A_COMCOM.:Z8A6TOU  cannot be made into a system file and is referenced.
   Z8A_DEFC.:Z8A6TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure Z9AM$SAVE_DATE.
PL6.E3A0      #001=Z9AM$SAVE_DATE File=Z9AM.:Z8A6TSI                             SAT 08/09/97 13:39 Page:13   

 **** Variables and constants ****

  ****  Section 000 LblCom ITERATION

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN              1 ITERATION

  ****  Section 002  Data  Z9AM$SAVE_DATE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    26-0-0/d STRC(432)   r     1 CDATE                      4-0-0/d STRC(216)   r     1 FPT_EXIT
     0-0-0/c CHAR(11)    r     1 LONG_TIME                 12-0-0/d STRC(432)   r     1 UTSTIME

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(13248) r     1 COMCOM

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w CHAR(4096)        1 CHARS                      0-0-0/w STRC(72)          1 CONT
     0-0-0N  NULL        r     1 M$UC                       0-0-0/w STRC(36864)       1 PAGE


   Procedure Z9AM$SAVE_DATE requires 18 words for executable code.
   Procedure Z9AM$SAVE_DATE requires 4 words of local(AUTO) storage.

PL6.E3A0      #002=Z9AM$ONLINE_TREES File=Z9AM.:Z8A6TSI                          SAT 08/09/97 13:40 Page:14   
       61        1        /*T***********************************************************/
       62        2        /*T*                                                         */
       63        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       64        4        /*T*                                                         */
       65        5        /*T***********************************************************/
       66        6        Z9AM$ONLINE_TREES: PROC;
       67        7
       68        8            %INCLUDE Z8A_SYS_FILE;
       69     6283
       70     6284    1       DCL Z8JS$ONLINE_TREES     ENTRY;
       71     6285    1       DCL Z8JS$ABSTRACT_TREES   ENTRY;
       72     6286    1       DCL Z9AC$CLOSE_LO         ENTRY;
       73     6287
       74     6288
       75     6289    1       CALL Z8JS$ONLINE_TREES;
       76     6290    1       CALL Z9AC$CLOSE_LO;
       77     6291    1       CALL M$EXIT;
       78     6292
       79     6293    1   Z9AM$ABSTRACT_TREES:   ENTRY;
       80     6294
       81     6295    1       CALL Z8JS$ABSTRACT_TREES;
       82     6296    1       CALL Z9AC$CLOSE_LO;
       83     6297    1       CALL M$EXIT;
       84     6298
       85     6299
       86     6300    1   END Z9AM$ONLINE_TREES;
       87     6301        %EOD;

PL6.E3A0      #002=Z9AM$ONLINE_TREES File=Z9AM.:Z8A6TSI                          SAT 08/09/97 13:40 Page:15   
--  Include file information  --

   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   Z8A_SYS_FILE.:Z8A6TOU  is referenced.
      No diagnostics issued in procedure Z9AM$ONLINE_TREES.

   Procedure Z9AM$ONLINE_TREES requires 22 words for executable code.
   Procedure Z9AM$ONLINE_TREES requires 4 words of local(AUTO) storage.

PL6.E3A0      #002=Z9AM$ONLINE_TREES File=Z9AM.:Z8A6TSI                          SAT 08/09/97 13:40 Page:16   

 Object Unit name= Z9AM$ONLINE_TREES                          File name= Z9AM.:Z8A6TOU
 UTS= AUG 09 '97 13:40:25.92 SAT                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none    22     26  Z9AM$ONLINE_TREES
    2  RoData even  none     1      1  Z9AM$ONLINE_TREES

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  Z9AM$ONLINE_TREES
     1     13                  yes      Std        0  Z9AM$ABSTRACT_TREES

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 Z8JS$ONLINE_TREES
         yes           Std       0 Z9AC$CLOSE_LO
         yes           Std       0 Z8JS$ABSTRACT_TREES
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC
PL6.E3A0      #002=Z9AM$ONLINE_TREES File=Z9AM.:Z8A6TSI                          SAT 08/09/97 13:40 Page:17   


       61        1        /*T***********************************************************/
       62        2        /*T*                                                         */
       63        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       64        4        /*T*                                                         */
       65        5        /*T***********************************************************/
       66        6        Z9AM$ONLINE_TREES: PROC;

      6  1 000000   000000 700200 xent  Z9AM$ONLINE* TSX0  ! X66_AUTO_0
         1 000001   000004 000000                    ZERO    4,0

       67        7
       68        8            %INCLUDE Z8A_SYS_FILE;
       69     6283
       70     6284    1       DCL Z8JS$ONLINE_TREES     ENTRY;
       71     6285    1       DCL Z8JS$ABSTRACT_TREES   ENTRY;
       72     6286    1       DCL Z9AC$CLOSE_LO         ENTRY;
       73     6287
       74     6288
       75     6289    1       CALL Z8JS$ONLINE_TREES;

   6289  1 000002   000000 631400 2                  EPPR1   0
         1 000003   000000 701000 xent               TSX1    Z8JS$ONLINE_TREES
         1 000004   000000 011000                    NOP     0

       76     6290    1       CALL Z9AC$CLOSE_LO;

   6290  1 000005   000000 631400 2                  EPPR1   0
         1 000006   000000 701000 xent               TSX1    Z9AC$CLOSE_LO
         1 000007   000000 011000                    NOP     0

       77     6291    1       CALL M$EXIT;

   6291  1 000010   000001 713400                    CLIMB   exit
         1 000011   000000 401760                    pmme    nvectors=0
         1 000012   000015 710000 1                  TRA     s:6295

PL6.E3A0      #002=Z9AM$ONLINE_TREES File=Z9AM.:Z8A6TSI                          SAT 08/09/97 13:40 Page:18   
       78     6292
       79     6293    1   Z9AM$ABSTRACT_TREES:   ENTRY;

   6293  1 000013   000000 700200 xent  Z9AM$ABSTRA* TSX0  ! X66_AUTO_0
         1 000014   000004 000000                    ZERO    4,0

       80     6294
       81     6295    1       CALL Z8JS$ABSTRACT_TREES;

   6295  1 000015   000000 631400 2                  EPPR1   0
         1 000016   000000 701000 xent               TSX1    Z8JS$ABSTRACT_TREES
         1 000017   000000 011000                    NOP     0

       82     6296    1       CALL Z9AC$CLOSE_LO;

   6296  1 000020   000000 631400 2                  EPPR1   0
         1 000021   000000 701000 xent               TSX1    Z9AC$CLOSE_LO
         1 000022   000000 011000                    NOP     0

       83     6297    1       CALL M$EXIT;

   6297  1 000023   000001 713400                    CLIMB   exit
         1 000024   000000 401760                    pmme    nvectors=0

       84     6298
       85     6299
       86     6300    1   END Z9AM$ONLINE_TREES;

   6300  1 000025   000000 702200 xent               TSX2  ! X66_ARET
       87     6301        %EOD;

PL6.E3A0      #002=Z9AM$ONLINE_TREES File=Z9AM.:Z8A6TSI                          SAT 08/09/97 13:40 Page:19   
--  Include file information  --

   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   Z8A_SYS_FILE.:Z8A6TOU  is referenced.
      No diagnostics issued in procedure Z9AM$ONLINE_TREES.
PL6.E3A0      #002=Z9AM$ONLINE_TREES File=Z9AM.:Z8A6TSI                          SAT 08/09/97 13:40 Page:20   

 **** Variables and constants ****

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0N  NULL        r     1 M$UC


   Procedure Z9AM$ONLINE_TREES requires 22 words for executable code.
   Procedure Z9AM$ONLINE_TREES requires 4 words of local(AUTO) storage.

PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:21   
       88        1        /*T***********************************************************/
       89        2        /*T*                                                         */
       90        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       91        4        /*T*                                                         */
       92        5        /*T***********************************************************/
       93        6
       94        7         /*======================*/
       95        8           Z9AM$GET_VIRTUAL_SPACE: PROC;
       96        9         /*======================*/
       97       10
       98       11        %EQU PHASE = 0;
       99       12
      100       13        %EQU MIN_BACKUP_PAGES = 15;
      101       14        %EQU AUTO_STORAGE_PAGES = 12;
      102       15        %EQU F_SEQ_IO_PAGES = 4;
      103       16
      104       17        %INCLUDE Z8A_DEFC;
      105       85        %INCLUDE Z8A_COMCOM;
      106      735
      107      736        %INCLUDE Z8A_SYS_FILE;
      108     7011
      109     7012        %VLP_GDDL (FPTN = GDDL_RESULTS, STCLASS = AUTO);
      110     7026
      111     7027        %FPT_GDDL (FPTN = GDDL_FPT, STCLASS = AUTO);
      112     7040
      113     7041        %FPT_OPEN (FPTN = FPT_OPEN, STCLASS = AUTO);
      114     7150
      115     7151        %VLP_VIRTUAL (FPTN = VIRTUAL_VLP, STCLASS = AUTO);
      116     7171
      117     7172        %FPT_OPEN (FPTN = FPT_OPEN_CONST, STCLASS = CONSTANT,
      118     7173                   ORG = KEYED,
      119     7174                   ASN = FILE,
      120     7175                   DISP = SCRATCH,
      121     7176                   FUN = CREATE);
      122     7285
      123     7286        %VLP_VIRTUAL (FPTN = VIRTUAL_VLP_CONST, STCLASS = CONSTANT,
      124     7287                      INITIALIZE = YES,
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:22   
      125     7288                      INITVALUE  = 0,
      126     7289                      PHYSICAL   = 10,
      127     7290                      SEGNUM     = VS1,
      128     7291                      SEGSIZE    = 2097152);
      129     7311
      130     7312        %FPT_GDP (RESULTS = VLR_GDS, PAGES = %F_SEQ_IO_PAGES);
      131     7326        %FPT_GDS (RESULTS=VLR_GDS,FREE=YES,SEGSIZE="%(1024*F_SEQ_IO_PAGES)");
      132     7342        %VLR_GDS (LOGSIZE=%#256K,REALSIZE=10240);
      133     7370    1   DCL FREE$     PTR;
      134     7371    1   DCL NEXT$     PTR;
      135     7372
      136     7373    1   DCL 1 VECT             DALIGNED,
      137     7374    1         2  VECTOR_       BIT(72)  UNAL,
      138     7375    1         2  INFO   REDEF VECTOR_ UNAL,
      139     7376    1           3 BOUND_       UBIN (18)  UNAL,
      140     7377    1           3 *            BIT  (54)  UNAL;
      141     7378
      142     7379        %FPT_FDS (FPTN = FPT_FDS, STCLASS = AUTO);
      143     7394
      144     7395
      145     7396    1   DCL BACKUP_PAGES       SBIN WORD STATIC;
      146     7397    1   DCL OBUF               CHAR (120)  EXT;
      147     7398    1   DCL OFFSET             SBIN WORD;
      148     7399    1   DCL I                  SBIN WORD;
      149     7400    1   DCL SIZE               SBIN WORD;
      150     7401    1   DCL M$VIRTUAL1         DCB;
      151     7402    1   DCL M$VIRTUAL2         DCB;
      152     7403    1   DCL M$VIRTUAL3         DCB;
      153     7404    1   DCL VS_PTR_INDEX       SBIN WORD STATIC INIT (-8);
      154     7405
      155     7406    1   DCL Z9AL$WRITE_TERMINAL   ENTRY;
      156     7407    1   DCL Z9AS$SHRINK_PTR       ENTRY (4);
      157     7408
      158     7409
      159     7410         /* Get real memory size availabe to backup the virtual space */
      160     7411         /* if it is too smmall, issue an error msg and abort         */
      161     7412
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:23   
      162     7413    1      GDDL_FPT.RESULTS_ = VECTOR (GDDL_RESULTS);
      163     7414
      164     7415    1      CALL M$GDDL (GDDL_FPT) ALTRET (BAD_ERR);
      165     7416
      166     7417    1      BACKUP_PAGES = GDDL_RESULTS.AVAIL_PGS# - %AUTO_STORAGE_PAGES -
      167     7418    1                                               %F_SEQ_IO_PAGES ;
      168     7419
      169     7420    1      IF BACKUP_PAGES <= %MIN_BACKUP_PAGES THEN
      170     7421    2        DO;
      171     7422                               /*#32168*/
      172     7423    2          OBUF = 'Not enough real memory to backup the virtual space, up MEM.';
      173     7424
      174     7425    2          CALL Z9AL$WRITE_TERMINAL;
      175     7426    2          CALL M$ERR;
      176     7427    2          RETURN;
      177     7428    2        END;
      178     7429    1      ELSE    /* This is to reserve some pages for Virtual_Space2 */
      179     7430    1        IF BACKUP_PAGES > 600   THEN
      180     7431    1          BACKUP_PAGES = BACKUP_PAGES - 8;
      181     7432    1        ELSE
      182     7433    1          IF BACKUP_PAGES > 300 THEN
      183     7434    1            BACKUP_PAGES = BACKUP_PAGES - 4;
      184     7435    1          ELSE
      185     7436    1            IF BACKUP_PAGES > 180 THEN
      186     7437    1              BACKUP_PAGES = BACKUP_PAGES - 2;
      187     7438
      188     7439         /*  Allocate the fast sequential I/O buffer pages */
      189     7440
      190     7441    1      CALL M$GDP (FPT_GDP) ALTRET (BAD_ERR);
      191     7442
      192     7443    1      FREE$ = VLR_GDS.VECT.PTR$;
      193     7444    1      COMCOM.VS_FREE$ = FREE$;
      194     7445
      195     7446    2      DO I= 1 TO %F_SEQ_IO_PAGES - 1;
      196     7447
      197     7448    2        NEXT$ = PINCRW(FREE$, %PAGE_SIZE);
      198     7449    2        FREE$ -> PAGE.NEXT = NEXT$;
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:24   
      199     7450    2        FREE$ = NEXT$;
      200     7451
      201     7452    2      END;
      202     7453
      203     7454    1      FREE$ -> PAGE.NEXT = ADDR(NIL);
      204     7455
      205     7456         /*  Allocate and open the virtual space */
      206     7457
      207     7458    1      FPT_OPEN = FPT_OPEN_CONST;
      208     7459    1      FPT_OPEN.V.DCB# = DCBNUM (M$VIRTUAL1);
      209     7460    1      FPT_OPEN.V_ = VECTOR (FPT_OPEN.V);
      210     7461    1      FPT_OPEN.VIRTUAL_ = VECTOR (VIRTUAL_VLP);
      211     7462    1      VIRTUAL_VLP = VIRTUAL_VLP_CONST;
      212     7463    1      VIRTUAL_VLP.PHYSICAL# = BACKUP_PAGES;
      213     7464    1      GOTO OPEN_VIRTUAL_SPACE;
      214     7465
      215     7466         /*-----------------------*/
      216     7467    1      Z9AM$GET_VIRTUAL_SPACE2:  ENTRY;
      217     7468         /*-----------------------*/
      218     7469
      219     7470    1       IF BACKUP_PAGES > 592 THEN
      220     7471    1         BACKUP_PAGES = 8;
      221     7472    1       ELSE
      222     7473    1         IF BACKUP_PAGES > 296 THEN
      223     7474    1            BACKUP_PAGES = 4;
      224     7475    1         ELSE
      225     7476    1           BACKUP_PAGES = 2;
      226     7477
      227     7478
      228     7479    1      FPT_OPEN = FPT_OPEN_CONST;
      229     7480    1      FPT_OPEN.V.DCB# = DCBNUM (M$VIRTUAL2);
      230     7481    1      FPT_OPEN.V_ = VECTOR (FPT_OPEN.V);
      231     7482    1      FPT_OPEN.VIRTUAL_ = VECTOR (VIRTUAL_VLP);
      232     7483    1      VIRTUAL_VLP = VIRTUAL_VLP_CONST;
      233     7484    1      VIRTUAL_VLP.PHYSICAL# = BACKUP_PAGES;
      234     7485    1      VIRTUAL_VLP.SEGNUM# = 2;
      235     7486
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:25   
      236     7487
      237     7488    1     OPEN_VIRTUAL_SPACE:
      238     7489
      239     7490
      240     7491    1      CALL M$OPEN (FPT_OPEN) ALTRET (BAD_ERR);
      241     7492
      242     7493         /* Divide this 2M super segment to eight 256K segments */
      243     7494
      244     7495    1      SIZE = 1048576; /* 4 * 256K    bytes */
      245     7496    1      VS_PTR_INDEX = VS_PTR_INDEX + 8;
      246     7497
      247     7498    2      DO I = 0 TO 7;
      248     7499
      249     7500    2        OFFSET = I * SIZE;
      250     7501
      251     7502    2        CALL Z9AS$SHRINK_PTR (VIRTUAL_VLP.PTR$,
      252     7503    2                              OFFSET,
      253     7504    2                              SIZE,
      254     7505    2                              COMCOM.VS_PTR$(I + VS_PTR_INDEX));
      255     7506    2      END;
      256     7507
      257     7508    1      RETURN;
      258     7509
      259     7510    1      BAD_ERR:
      260     7511    1          OBUF = 'Error encountered on allocating the virtual space, compiler error';
      261     7512    1          CALL Z9AL$WRITE_TERMINAL;
      262     7513    1          CALL M$ERR;
      263     7514    1      RETURN;
      264     7515    1    END Z9AM$GET_VIRTUAL_SPACE;

PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:26   
--  Include file information  --

   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   Z8A_SYS_FILE.:Z8A6TOU  is referenced.
   Z8A_COMCOM.:Z8A6TOU  cannot be made into a system file and is referenced.
   Z8A_DEFC.:Z8A6TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure Z9AM$GET_VIRTUAL_SPACE.

   Procedure Z9AM$GET_VIRTUAL_SPACE requires 162 words for executable code.
   Procedure Z9AM$GET_VIRTUAL_SPACE requires 98 words of local(AUTO) storage.

    No errors detected in file Z9AM.:Z8A6TSI    .

PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:27   

 Object Unit name= Z9AM$GET_VIRTUAL_SPACE                     File name= Z9AM.:Z8A6TOU
 UTS= AUG 09 '97 13:40:59.08 SAT                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  LblCom even  none     1      1  ITERATION
    1   DCB   even  none     0      0  M$UC
    2  RoData even  UTS    102    146  Z9AM$GET_VIRTUAL_SPACE
    3   Data  even  none    18     22  Z9AM$GET_VIRTUAL_SPACE
    4  LblCom even  none    30     36  OBUF
    5   DCB   even  none     0      0  M$VIRTUAL1
    6   DCB   even  none     0      0  M$VIRTUAL2
    7   DCB   even  none     0      0  M$VIRTUAL3
    8   Proc  even  none   162    242  Z9AM$GET_VIRTUAL_SPACE
    9  RoData even  none     6      6  Z9AM$GET_VIRTUAL_SPACE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     8      0   yes            yes      Std        0  Z9AM$GET_VIRTUAL_SPACE
     8    124                  yes      Std        0  Z9AM$GET_VIRTUAL_SPACE2

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 Z9AL$WRITE_TERMINAL
         yes           Std       4 Z9AS$SHRINK_PTR
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:28   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     COMCOM                                M$UC                                  M$VIRTUAL1
     M$VIRTUAL2                            M$VIRTUAL3

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:29   


       88        1        /*T***********************************************************/
       89        2        /*T*                                                         */
       90        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       91        4        /*T*                                                         */
       92        5        /*T***********************************************************/
       93        6
       94        7         /*======================*/
       95        8           Z9AM$GET_VIRTUAL_SPACE: PROC;

      8  8 000000   000000 700200 xent  Z9AM$GET_VI* TSX0  ! X66_AUTO_0
         8 000001   000142 000000                    ZERO    98,0

       96        9         /*======================*/
       97       10
       98       11        %EQU PHASE = 0;
       99       12
      100       13        %EQU MIN_BACKUP_PAGES = 15;
      101       14        %EQU AUTO_STORAGE_PAGES = 12;
      102       15        %EQU F_SEQ_IO_PAGES = 4;
      103       16
      104       17        %INCLUDE Z8A_DEFC;
      105       85        %INCLUDE Z8A_COMCOM;
      106      735
      107      736        %INCLUDE Z8A_SYS_FILE;
      108     7011
      109     7012        %VLP_GDDL (FPTN = GDDL_RESULTS, STCLASS = AUTO);
      110     7026
      111     7027        %FPT_GDDL (FPTN = GDDL_FPT, STCLASS = AUTO);
      112     7040
      113     7041        %FPT_OPEN (FPTN = FPT_OPEN, STCLASS = AUTO);
      114     7150
      115     7151        %VLP_VIRTUAL (FPTN = VIRTUAL_VLP, STCLASS = AUTO);
      116     7171
      117     7172        %FPT_OPEN (FPTN = FPT_OPEN_CONST, STCLASS = CONSTANT,
      118     7173                   ORG = KEYED,
      119     7174                   ASN = FILE,
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:30   
      120     7175                   DISP = SCRATCH,
      121     7176                   FUN = CREATE);
      122     7285
      123     7286        %VLP_VIRTUAL (FPTN = VIRTUAL_VLP_CONST, STCLASS = CONSTANT,
      124     7287                      INITIALIZE = YES,
      125     7288                      INITVALUE  = 0,
      126     7289                      PHYSICAL   = 10,
      127     7290                      SEGNUM     = VS1,
      128     7291                      SEGSIZE    = 2097152);
      129     7311
      130     7312        %FPT_GDP (RESULTS = VLR_GDS, PAGES = %F_SEQ_IO_PAGES);
      131     7326        %FPT_GDS (RESULTS=VLR_GDS,FREE=YES,SEGSIZE="%(1024*F_SEQ_IO_PAGES)");
      132     7342        %VLR_GDS (LOGSIZE=%#256K,REALSIZE=10240);
      133     7370    1   DCL FREE$     PTR;
      134     7371    1   DCL NEXT$     PTR;
      135     7372
      136     7373    1   DCL 1 VECT             DALIGNED,
      137     7374    1         2  VECTOR_       BIT(72)  UNAL,
      138     7375    1         2  INFO   REDEF VECTOR_ UNAL,
      139     7376    1           3 BOUND_       UBIN (18)  UNAL,
      140     7377    1           3 *            BIT  (54)  UNAL;
      141     7378
      142     7379        %FPT_FDS (FPTN = FPT_FDS, STCLASS = AUTO);
      143     7394
      144     7395
      145     7396    1   DCL BACKUP_PAGES       SBIN WORD STATIC;
      146     7397    1   DCL OBUF               CHAR (120)  EXT;
      147     7398    1   DCL OFFSET             SBIN WORD;
      148     7399    1   DCL I                  SBIN WORD;
      149     7400    1   DCL SIZE               SBIN WORD;
      150     7401    1   DCL M$VIRTUAL1         DCB;
      151     7402    1   DCL M$VIRTUAL2         DCB;
      152     7403    1   DCL M$VIRTUAL3         DCB;
      153     7404    1   DCL VS_PTR_INDEX       SBIN WORD STATIC INIT (-8);
      154     7405
      155     7406    1   DCL Z9AL$WRITE_TERMINAL   ENTRY;
      156     7407    1   DCL Z9AS$SHRINK_PTR       ENTRY (4);
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:31   
      157     7408
      158     7409
      159     7410         /* Get real memory size availabe to backup the virtual space */
      160     7411         /* if it is too smmall, issue an error msg and abort         */
      161     7412
      162     7413    1      GDDL_FPT.RESULTS_ = VECTOR (GDDL_RESULTS);

   7413  8 000002   000000 235000 9                  LDA     0
         8 000003   200136 452500                    STP2    SIZE+2,,AUTO
         8 000004   200136 236100                    LDQ     SIZE+2,,AUTO
         8 000005   000004 036003                    ADLQ    4,DU
         8 000006   200010 757100                    STAQ    GDDL_FPT,,AUTO

      163     7414
      164     7415    1      CALL M$GDDL (GDDL_FPT) ALTRET (BAD_ERR);

   7415  8 000007   200010 630500                    EPPR0   GDDL_FPT,,AUTO
         8 000010   430014 713400                    CLIMB   alt,+12300
         8 000011   400000 401760                    pmme    nvectors=1
         8 000012   000231 702000 8                  TSX2    BAD_ERR

      165     7416
      166     7417    1      BACKUP_PAGES = GDDL_RESULTS.AVAIL_PGS# - %AUTO_STORAGE_PAGES -

   7417  8 000013   200006 235100                    LDA     GDDL_RESULTS+2,,AUTO
         8 000014   000020 135007                    SBLA    16,DL
         8 000015   000020 755000 3                  STA     BACKUP_PAGES

      167     7418    1                                               %F_SEQ_IO_PAGES ;
      168     7419
      169     7420    1      IF BACKUP_PAGES <= %MIN_BACKUP_PAGES THEN

   7420  8 000016   000017 115007                    CMPA    15,DL
         8 000017   000031 605400 8                  TPNZ    s:7430

      170     7421    2        DO;

PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:32   
      171     7422                               /*#32168*/
      172     7423    2          OBUF = 'Not enough real memory to backup the virtual space, up MEM.';

   7423  8 000020   040000 100400                    MLR     fill='040'O
         8 000021   000106 000073 2                  ADSC9   VIRTUAL_VLP_CONST+12     cn=0,n=59
         8 000022   000000 000170 4                  ADSC9   OBUF                     cn=0,n=120

      173     7424
      174     7425    2          CALL Z9AL$WRITE_TERMINAL;

   7425  8 000023   000001 631400 9                  EPPR1   1
         8 000024   000000 701000 xent               TSX1    Z9AL$WRITE_TERMINAL
         8 000025   000000 011000                    NOP     0

      175     7426    2          CALL M$ERR;

   7426  8 000026   000002 713400                    CLIMB   err
         8 000027   000000 401760                    pmme    nvectors=0

      176     7427    2          RETURN;

   7427  8 000030   000000 702200 xent               TSX2  ! X66_ARET

      177     7428    2        END;
      178     7429    1      ELSE    /* This is to reserve some pages for Virtual_Space2 */
      179     7430    1        IF BACKUP_PAGES > 600   THEN

   7430  8 000031   001130 115007                    CMPA    600,DL
         8 000032   000036 604400 8                  TMOZ    s:7433

      180     7431    1          BACKUP_PAGES = BACKUP_PAGES - 8;

   7431  8 000033   000010 336007                    LCQ     8,DL
         8 000034   000020 056000 3                  ASQ     BACKUP_PAGES
         8 000035   000047 710000 8                  TRA     s:7441

      181     7432    1        ELSE
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:33   
      182     7433    1          IF BACKUP_PAGES > 300 THEN

   7433  8 000036   000454 115007                    CMPA    300,DL
         8 000037   000043 604400 8                  TMOZ    s:7436

      183     7434    1            BACKUP_PAGES = BACKUP_PAGES - 4;

   7434  8 000040   000004 336007                    LCQ     4,DL
         8 000041   000020 056000 3                  ASQ     BACKUP_PAGES
         8 000042   000047 710000 8                  TRA     s:7441

      184     7435    1          ELSE
      185     7436    1            IF BACKUP_PAGES > 180 THEN

   7436  8 000043   000264 115007                    CMPA    180,DL
         8 000044   000047 604400 8                  TMOZ    s:7441

      186     7437    1              BACKUP_PAGES = BACKUP_PAGES - 2;

   7437  8 000045   000002 336007                    LCQ     2,DL
         8 000046   000020 056000 3                  ASQ     BACKUP_PAGES

      187     7438
      188     7439         /*  Allocate the fast sequential I/O buffer pages */
      189     7440
      190     7441    1      CALL M$GDP (FPT_GDP) ALTRET (BAD_ERR);

   7441  8 000047   000000 630400 3                  EPPR0   FPT_GDP
         8 000050   430003 713400                    CLIMB   alt,+12291
         8 000051   400400 401760                    pmme    nvectors=2
         8 000052   000231 702000 8                  TSX2    BAD_ERR

      191     7442
      192     7443    1      FREE$ = VLR_GDS.VECT.PTR$;

   7443  8 000053   000015 236000 3                  LDQ     VLR_GDS+1
         8 000054   200120 756100                    STQ     FREE$,,AUTO
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:34   

      193     7444    1      COMCOM.VS_FREE$ = FREE$;

   7444  8 000055   000543 756000 xsym               STQ     COMCOM+355

      194     7445
      195     7446    2      DO I= 1 TO %F_SEQ_IO_PAGES - 1;

   7446  8 000056   000001 235007                    LDA     1,DL
         8 000057   200133 755100                    STA     I,,AUTO
         8 000060   000070 710000 8                  TRA     s:7452+1

      196     7447
      197     7448    2        NEXT$ = PINCRW(FREE$, %PAGE_SIZE);

   7448  8 000061   200120 236100                    LDQ     FREE$,,AUTO
         8 000062   002000 036003                    ADLQ    1024,DU
         8 000063   200121 756100                    STQ     NEXT$,,AUTO

      198     7449    2        FREE$ -> PAGE.NEXT = NEXT$;

   7449  8 000064   200120 470500                    LDP0    FREE$,,AUTO
         8 000065   001777 756100                    STQ     1023,,PR0

      199     7450    2        FREE$ = NEXT$;

   7450  8 000066   200120 756100                    STQ     FREE$,,AUTO

      200     7451
      201     7452    2      END;

   7452  8 000067   200133 054100                    AOS     I,,AUTO
         8 000070   200133 235100                    LDA     I,,AUTO
         8 000071   000003 115007                    CMPA    3,DL
         8 000072   000061 604400 8                  TMOZ    s:7448

      202     7453
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:35   
      203     7454    1      FREE$ -> PAGE.NEXT = ADDR(NIL);

   7454  8 000073   000002 236000 9                  LDQ     2
         8 000074   200120 470500                    LDP0    FREE$,,AUTO
         8 000075   001777 756100                    STQ     1023,,PR0

      204     7455
      205     7456         /*  Allocate and open the virtual space */
      206     7457
      207     7458    1      FPT_OPEN = FPT_OPEN_CONST;

   7458  8 000076   000100 100400                    MLR     fill='000'O
         8 000077   000000 000350 2                  ADSC9   FPT_OPEN_CONST           cn=0,n=232
         8 000100   200012 000350                    ADSC9   FPT_OPEN,,AUTO           cn=0,n=232

      208     7459    1      FPT_OPEN.V.DCB# = DCBNUM (M$VIRTUAL1);

   7459  8 000101   000000 236007 xsym               LDQ     M$VIRTUAL1,DL
         8 000102   000000 620006                    EAX0    0,QL
         8 000103   200056 740100                    STX0    FPT_OPEN+36,,AUTO

      209     7460    1      FPT_OPEN.V_ = VECTOR (FPT_OPEN.V);

   7460  8 000104   000003 235000 9                  LDA     3
         8 000105   200136 452500                    STP2    SIZE+2,,AUTO
         8 000106   200136 236100                    LDQ     SIZE+2,,AUTO
         8 000107   000056 036003                    ADLQ    46,DU
         8 000110   200012 757100                    STAQ    FPT_OPEN,,AUTO

      210     7461    1      FPT_OPEN.VIRTUAL_ = VECTOR (VIRTUAL_VLP);

   7461  8 000111   000004 235000 9                  LDA     4
         8 000112   200136 452500                    STP2    SIZE+2,,AUTO
         8 000113   200136 236100                    LDQ     SIZE+2,,AUTO
         8 000114   000104 036003                    ADLQ    68,DU
         8 000115   200016 757100                    STAQ    FPT_OPEN+4,,AUTO

PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:36   
      211     7462    1      VIRTUAL_VLP = VIRTUAL_VLP_CONST;

   7462  8 000116   000100 100400                    MLR     fill='000'O
         8 000117   000072 000060 2                  ADSC9   VIRTUAL_VLP_CONST        cn=0,n=48
         8 000120   200104 000060                    ADSC9   VIRTUAL_VLP,,AUTO        cn=0,n=48

      212     7463    1      VIRTUAL_VLP.PHYSICAL# = BACKUP_PAGES;

   7463  8 000121   000020 721000 3                  LXL1    BACKUP_PAGES
         8 000122   200107 741100                    STX1    VIRTUAL_VLP+3,,AUTO

      213     7464    1      GOTO OPEN_VIRTUAL_SPACE;

   7464  8 000123   000172 710000 8                  TRA     OPEN_VIRTUAL_SPACE

      214     7465
      215     7466         /*-----------------------*/
      216     7467    1      Z9AM$GET_VIRTUAL_SPACE2:  ENTRY;

   7467  8 000124   000000 700200 xent  Z9AM$GET_VI* TSX0  ! X66_AUTO_0
         8 000125   000142 000000                    ZERO    98,0

      217     7468         /*-----------------------*/
      218     7469
      219     7470    1       IF BACKUP_PAGES > 592 THEN

   7470  8 000126   000020 235000 3                  LDA     BACKUP_PAGES
         8 000127   001120 115007                    CMPA    592,DL
         8 000130   000134 604400 8                  TMOZ    s:7473

      220     7471    1         BACKUP_PAGES = 8;

   7471  8 000131   000010 236007                    LDQ     8,DL
         8 000132   000020 756000 3                  STQ     BACKUP_PAGES
         8 000133   000143 710000 8                  TRA     s:7479

      221     7472    1       ELSE
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:37   
      222     7473    1         IF BACKUP_PAGES > 296 THEN

   7473  8 000134   000450 115007                    CMPA    296,DL
         8 000135   000141 604400 8                  TMOZ    s:7476

      223     7474    1            BACKUP_PAGES = 4;

   7474  8 000136   000004 236007                    LDQ     4,DL
         8 000137   000020 756000 3                  STQ     BACKUP_PAGES
         8 000140   000143 710000 8                  TRA     s:7479

      224     7475    1         ELSE
      225     7476    1           BACKUP_PAGES = 2;

   7476  8 000141   000002 236007                    LDQ     2,DL
         8 000142   000020 756000 3                  STQ     BACKUP_PAGES

      226     7477
      227     7478
      228     7479    1      FPT_OPEN = FPT_OPEN_CONST;

   7479  8 000143   000100 100400                    MLR     fill='000'O
         8 000144   000000 000350 2                  ADSC9   FPT_OPEN_CONST           cn=0,n=232
         8 000145   200012 000350                    ADSC9   FPT_OPEN,,AUTO           cn=0,n=232

      229     7480    1      FPT_OPEN.V.DCB# = DCBNUM (M$VIRTUAL2);

   7480  8 000146   000000 236007 xsym               LDQ     M$VIRTUAL2,DL
         8 000147   000000 620006                    EAX0    0,QL
         8 000150   200056 740100                    STX0    FPT_OPEN+36,,AUTO

      230     7481    1      FPT_OPEN.V_ = VECTOR (FPT_OPEN.V);

   7481  8 000151   000003 235000 9                  LDA     3
         8 000152   200136 452500                    STP2    SIZE+2,,AUTO
         8 000153   200136 236100                    LDQ     SIZE+2,,AUTO
         8 000154   000056 036003                    ADLQ    46,DU
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:38   
         8 000155   200012 757100                    STAQ    FPT_OPEN,,AUTO

      231     7482    1      FPT_OPEN.VIRTUAL_ = VECTOR (VIRTUAL_VLP);

   7482  8 000156   000004 235000 9                  LDA     4
         8 000157   200136 452500                    STP2    SIZE+2,,AUTO
         8 000160   200136 236100                    LDQ     SIZE+2,,AUTO
         8 000161   000104 036003                    ADLQ    68,DU
         8 000162   200016 757100                    STAQ    FPT_OPEN+4,,AUTO

      232     7483    1      VIRTUAL_VLP = VIRTUAL_VLP_CONST;

   7483  8 000163   000100 100400                    MLR     fill='000'O
         8 000164   000072 000060 2                  ADSC9   VIRTUAL_VLP_CONST        cn=0,n=48
         8 000165   200104 000060                    ADSC9   VIRTUAL_VLP,,AUTO        cn=0,n=48

      233     7484    1      VIRTUAL_VLP.PHYSICAL# = BACKUP_PAGES;

   7484  8 000166   000020 721000 3                  LXL1    BACKUP_PAGES
         8 000167   200107 741100                    STX1    VIRTUAL_VLP+3,,AUTO

      234     7485    1      VIRTUAL_VLP.SEGNUM# = 2;

   7485  8 000170   000002 236007                    LDQ     2,DL
         8 000171   200104 552104                    STBQ    VIRTUAL_VLP,'04'O,AUTO

      235     7486
      236     7487
      237     7488    1     OPEN_VIRTUAL_SPACE:
      238     7489
      239     7490
      240     7491    1      CALL M$OPEN (FPT_OPEN) ALTRET (BAD_ERR);

   7491  8 000172   200012 630500       OPEN_VIRTUA* EPPR0   FPT_OPEN,,AUTO
         8 000173   450000 713400                    CLIMB   alt,open
         8 000174   410400 401760                    pmme    nvectors=18
         8 000175   000231 702000 8                  TSX2    BAD_ERR
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:39   

      241     7492
      242     7493         /* Divide this 2M super segment to eight 256K segments */
      243     7494
      244     7495    1      SIZE = 1048576; /* 4 * 256K    bytes */

   7495  8 000176   000004 235003                    LDA     4,DU
         8 000177   200134 755100                    STA     SIZE,,AUTO

      245     7496    1      VS_PTR_INDEX = VS_PTR_INDEX + 8;

   7496  8 000200   000010 236007                    LDQ     8,DL
         8 000201   000021 056000 3                  ASQ     VS_PTR_INDEX

      246     7497
      247     7498    2      DO I = 0 TO 7;

   7498  8 000202   200133 450100                    STZ     I,,AUTO

      248     7499
      249     7500    2        OFFSET = I * SIZE;

   7500  8 000203   200133 236100                    LDQ     I,,AUTO
         8 000204   200134 402100                    MPY     SIZE,,AUTO
         8 000205   200132 756100                    STQ     OFFSET,,AUTO

      250     7501
      251     7502    2        CALL Z9AS$SHRINK_PTR (VIRTUAL_VLP.PTR$,

   7502  8 000206   200133 236100                    LDQ     I,,AUTO
         8 000207   000021 036000 3                  ADLQ    VS_PTR_INDEX
         8 000210   000513 630406 xsym               EPPR0   COMCOM+331,QL
         8 000211   200141 450500                    STP0    SIZE+5,,AUTO
         8 000212   200134 631500                    EPPR1   SIZE,,AUTO
         8 000213   200140 451500                    STP1    SIZE+4,,AUTO
         8 000214   200132 633500                    EPPR3   OFFSET,,AUTO
         8 000215   200137 453500                    STP3    SIZE+3,,AUTO
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:40   
         8 000216   200110 634500                    EPPR4   VIRTUAL_VLP+4,,AUTO
         8 000217   200136 454500                    STP4    SIZE+2,,AUTO
         8 000220   200136 630500                    EPPR0   SIZE+2,,AUTO
         8 000221   000005 631400 9                  EPPR1   5
         8 000222   000000 701000 xent               TSX1    Z9AS$SHRINK_PTR
         8 000223   000000 011000                    NOP     0

      252     7503    2                              OFFSET,
      253     7504    2                              SIZE,
      254     7505    2                              COMCOM.VS_PTR$(I + VS_PTR_INDEX));
      255     7506    2      END;

   7506  8 000224   200133 054100                    AOS     I,,AUTO
         8 000225   200133 235100                    LDA     I,,AUTO
         8 000226   000007 115007                    CMPA    7,DL
         8 000227   000203 604400 8                  TMOZ    s:7500

      256     7507
      257     7508    1      RETURN;

   7508  8 000230   000000 702200 xent               TSX2  ! X66_ARET

      258     7509
      259     7510    1      BAD_ERR:
      260     7511    1          OBUF = 'Error encountered on allocating the virtual space, compiler error';

   7511  8 000231   040000 100400       BAD_ERR      MLR     fill='040'O
         8 000232   000125 000101 2                  ADSC9   VIRTUAL_VLP_CONST+27     cn=0,n=65
         8 000233   000000 000170 4                  ADSC9   OBUF                     cn=0,n=120

      261     7512    1          CALL Z9AL$WRITE_TERMINAL;

   7512  8 000234   000001 631400 9                  EPPR1   1
         8 000235   000000 701000 xent               TSX1    Z9AL$WRITE_TERMINAL
         8 000236   000000 011000                    NOP     0

      262     7513    1          CALL M$ERR;
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:41   

   7513  8 000237   000002 713400                    CLIMB   err
         8 000240   000000 401760                    pmme    nvectors=0

      263     7514    1      RETURN;

   7514  8 000241   000000 702200 xent               TSX2  ! X66_ARET
      264     7515    1    END Z9AM$GET_VIRTUAL_SPACE;

PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:42   
--  Include file information  --

   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   Z8A_SYS_FILE.:Z8A6TOU  is referenced.
   Z8A_COMCOM.:Z8A6TOU  cannot be made into a system file and is referenced.
   Z8A_DEFC.:Z8A6TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure Z9AM$GET_VIRTUAL_SPACE.
PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:43   

 **** Variables and constants ****

  ****  Section 000 LblCom ITERATION

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN              1 ITERATION

  ****  Section 002 RoData Z9AM$GET_VIRTUAL_SPACE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(2088)  r     1 FPT_OPEN_CONST            72-0-0/w STRC(432)   r     1 VIRTUAL_VLP_CONST

  ****  Section 003  Data  Z9AM$GET_VIRTUAL_SPACE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    20-0-0/w SBIN        r     1 BACKUP_PAGES               0-0-0/d STRC(216)   r     1 FPT_GDP
     6-0-0/d STRC(216)   r     1 FPT_GDS                   14-0-0/d STRC(144)   r     1 VLR_GDS
    21-0-0/w SBIN        r     1 VS_PTR_INDEX

  ****  Section 004 LblCom OBUF

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(120)   r     1 OBUF

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #003=Z9AM$GET_VIRTUAL_SPACE File=Z9AM.:Z8A6TSI                     SAT 08/09/97 13:40 Page:44   
   124-0-0/d STRC(216)         1 FPT_FDS                   12-0-0/d STRC(2088)  r     1 FPT_OPEN
   120-0-0/w PTR         r     1 FREE$                     10-0-0/d STRC(72)    r     1 GDDL_FPT
     4-0-0/d STRC(108)   r     1 GDDL_RESULTS             133-0-0/w SBIN        r     1 I
   121-0-0/w PTR         r     1 NEXT$                    132-0-0/w SBIN        r     1 OFFSET
   134-0-0/w SBIN        r     1 SIZE                     122-0-0/d STRC(72)          1 VECT
   104-0-0/w STRC(432)   r     1 VIRTUAL_VLP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(13248) r     1 COMCOM

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w CHAR(4096)        1 CHARS                      0-0-0/w STRC(72)          1 CONT
     0-0-0N  NULL        r     1 M$UC                       0-0-0N  NULL        r     1 M$VIRTUAL1
     0-0-0N  NULL        r     1 M$VIRTUAL2                 0-0-0N  NULL        r     1 M$VIRTUAL3
     0-0-0/w STRC(36864) r     1 PAGE


   Procedure Z9AM$GET_VIRTUAL_SPACE requires 162 words for executable code.
   Procedure Z9AM$GET_VIRTUAL_SPACE requires 98 words of local(AUTO) storage.

    No errors detected in file Z9AM.:Z8A6TSI    .
